/*! For license information please see zm1be.9.47050a54.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{12677:(a,v,p)=>{"use strict";var P=p(12681),b=p(12687),L=p(12691);p.g.__TYPEDARRAY_POOL||(p.g.__TYPEDARRAY_POOL={UINT8:b([32,0]),UINT16:b([32,0]),UINT32:b([32,0]),INT8:b([32,0]),INT16:b([32,0]),INT32:b([32,0]),FLOAT:b([32,0]),DOUBLE:b([32,0]),DATA:b([32,0]),UINT8C:b([32,0]),BUFFER:b([32,0])});var t="undefined"!==typeof Uint8ClampedArray,V=p.g.__TYPEDARRAY_POOL;V.UINT8C||(V.UINT8C=b([32,0])),V.BUFFER||(V.BUFFER=b([32,0]));var K=V.DATA,C=V.BUFFER;function F(a){if(a){var v=a.length||a.byteLength,p=P.log2(v);K[p].push(a)}}function u(a){a=P.nextPow2(a);var v=P.log2(a),p=K[v];return p.length>0?p.pop():new ArrayBuffer(a)}function c(a){return new Uint8Array(u(a),0,a)}function f(a){return new Uint16Array(u(2*a),0,a)}function H(a){return new Uint32Array(u(4*a),0,a)}function A(a){return new Int8Array(u(a),0,a)}function h(a){return new Int16Array(u(2*a),0,a)}function R(a){return new Int32Array(u(4*a),0,a)}function X(a){return new Float32Array(u(4*a),0,a)}function Q(a){return new Float64Array(u(8*a),0,a)}function s(a){return t?new Uint8ClampedArray(u(a),0,a):c(a)}function D(a){return new DataView(u(a),0,a)}v.free=function(a){if(L(a))C[P.log2(a.length)].push(a);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(a)&&(a=a.buffer),!a)return;var v=a.length||a.byteLength,p=0|P.log2(v);K[p].push(a)}},v.freeUint8=v.freeUint16=v.freeUint32=v.freeInt8=v.freeInt16=v.freeInt32=v.freeFloat32=v.freeFloat=v.freeFloat64=v.freeDouble=v.freeUint8Clamped=v.freeDataView=function(a){F(a.buffer)},v.freeArrayBuffer=F,v.freeBuffer=function(a){C[P.log2(a.length)].push(a)},v.malloc=function(a,v){if(void 0===v||"arraybuffer"===v)return u(a);switch(v){case"uint8":return c(a);case"uint16":return f(a);case"uint32":return H(a);case"int8":return A(a);case"int16":return h(a);case"int32":return R(a);case"float":case"float32":return X(a);case"double":case"float64":return Q(a);case"uint8_clamped":return s(a);case"buffer":throw"Buffer not supported";case"data":case"dataview":return D(a);default:return null}return null},v.mallocArrayBuffer=u,v.mallocUint8=c,v.mallocUint16=f,v.mallocUint32=H,v.mallocInt8=A,v.mallocInt16=h,v.mallocInt32=R,v.mallocFloat32=v.mallocFloat=X,v.mallocFloat64=v.mallocDouble=Q,v.mallocUint8Clamped=s,v.mallocDataView=D,v.clearCache=function(){for(var a=0;a<32;++a)V.UINT8[a].length=0,V.UINT16[a].length=0,V.UINT32[a].length=0,V.INT8[a].length=0,V.INT16[a].length=0,V.INT32[a].length=0,V.FLOAT[a].length=0,V.DOUBLE[a].length=0,V.UINT8C[a].length=0,K[a].length=0,C[a].length=0}},12770:(a,v,p)=>{a.exports=b;var P=p(12130);function b(a,v){if(!(this instanceof b))return new b(a,v);var p=P.create();P.add(p,a,v),this.base=P.min(P.create(),a,p),this.fh=P.clone(v),this.max=P.max(P.create(),a,p),this.mag=P.length(this.fh)}var L=b.prototype;L.width=function(){return this.fh[0]},L.height=function(){return this.fh[1]},L.depth=function(){return this.fh[2]},L.x0=function(){return this.base[0]},L.y0=function(){return this.base[1]},L.z0=function(){return this.base[2]},L.x1=function(){return this.max[0]},L.y1=function(){return this.max[1]},L.z1=function(){return this.max[2]},L.translate=function(a){return P.add(this.max,this.max,a),P.add(this.base,this.base,a),this},L.setPosition=function(a){return P.add(this.max,a,this.fh),P.i(this.base,a),this},L.expand=function(a){var v=P.create(),p=P.create();return P.max(v,a.max,this.max),P.min(p,a.base,this.base),P.od(v,v,p),new b(p,v)},L.intersects=function(a){return!(a.base[0]>this.max[0])&&(!(a.base[1]>this.max[1])&&(!(a.base[2]>this.max[2])&&(!(a.max[0]<this.base[0])&&(!(a.max[1]<this.base[1])&&!(a.max[2]<this.base[2])))))},L.touches=function(a){var v=this.union(a);return null!==v&&(0==v.width()||0==v.height()||0==v.depth())},L.union=function(a){if(!this.intersects(a))return null;var v=Math.max(a.base[0],this.base[0]),p=Math.max(a.base[1],this.base[1]),P=Math.max(a.base[2],this.base[2]);return new b([v,p,P],[Math.min(a.max[0],this.max[0])-v,Math.min(a.max[1],this.max[1])-p,Math.min(a.max[2],this.max[2])-P])}},12681:(a,v)=>{"use strict";function p(a){var v=32;return(a&=-a)&&v--,65535&a&&(v-=16),16711935&a&&(v-=8),252645135&a&&(v-=4),858993459&a&&(v-=2),1431655765&a&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(a){return(a>0)-(a<0)},v.abs=function(a){var v=a>>31;return(a^v)-v},v.min=function(a,v){return v^(a^v)&-(a<v)},v.max=function(a,v){return a^(a^v)&-(a<v)},v.isPow2=function(a){return!(a&a-1)&&!!a},v.log2=function(a){var v,p;return v=(a>65535)<<4,v|=p=((a>>>=v)>255)<<3,v|=p=((a>>>=p)>15)<<2,(v|=p=((a>>>=p)>3)<<1)|(a>>>=p)>>1},v.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},v.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},v.countTrailingZeros=p,v.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},v.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},v.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var P=new Array(256);!function(a){for(var v=0;v<256;++v){var p=v,P=v,b=7;for(p>>>=1;p;p>>>=1)P<<=1,P|=1&p,--b;a[v]=P<<b&255}}(P),v.reverse=function(a){return P[255&a]<<24|P[a>>>8&255]<<16|P[a>>>16&255]<<8|P[a>>>24&255]},v.interleave2=function(a,v){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(a,v){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>v&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},v.interleave3=function(a,v,p){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<2},v.deinterleave3=function(a,v){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>v&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},v.nextCombination=function(a){var v=a|a-1;return v+1|(~v&-~v)-1>>>p(a)+1}},12671:(a,v,p)=>{"use strict";a.exports=function(a,v,p){switch(arguments.length){case 1:return P=[],C(b=a,b,F,!0),P;case 2:return"function"===typeof v?C(a,a,v,!0):function(a,v){return P=[],C(a,v,F,!1),P}(a,v);case 3:return C(a,v,p,!1);default:throw new Error("box-intersect: Invalid arguments")}var b};var P,b=p(12677),L=p(12697),t=p(12708);function V(a,v){for(var p=0;p<a;++p)if(!(v[p]<=v[p+a]))return!0;return!1}function K(a,v,p,P){for(var b=0,L=0,t=0,K=a.length;t<K;++t){var C=a[t];if(!V(v,C)){for(var F=0;F<2*v;++F)p[b++]=C[F];P[L++]=t}}return L}function C(a,v,p,P){var V=a.length,C=v.length;if(!(V<=0||C<=0)){var F=a[0].length>>>1;if(!(F<=0)){var u,c=b.mallocDouble(2*F*V),f=b.mallocInt32(V);if((V=K(a,F,c,f))>0){if(1===F&&P)L.init(V),u=L.sweepComplete(F,p,0,V,c,f,0,V,c,f);else{var H=b.mallocDouble(2*F*C),A=b.mallocInt32(C);(C=K(v,F,H,A))>0&&(L.init(V+C),u=1===F?L.sweepBipartite(F,p,0,V,c,f,0,C,H,A):t(F,p,P,V,c,f,C,H,A),b.free(H),b.free(A))}b.free(c),b.free(f)}return u}}}function F(a,v){P.push([a,v])}},12714:(a,v)=>{"use strict";var p="d",P="ax",b="fp",L="es",t="rs",V="re",K="rb",C="bs",F="be",u="bb",c=[p,P,"vv",t,V,K,"ri",C,F,u,"bi"];function f(a){var v="bruteForce"+(a?"Full":"Partial"),P=[],t=c.slice();a||t.splice(3,0,b);var V=["function "+v+"("+t.join()+"){"];function K(v,b){var t=function(a,v,P){var b="bruteForce"+(a?"Red":"Blue")+(v?"Flip":"")+(P?"Full":""),t=["function ",b,"(",c.join(),"){","var ",L,"=2*",p,";"],V="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",K="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(P?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return a?t.push(V,"Q",":",K):t.push(K,"Q",":",V),P?t.push("if(y1<x0||x1<y0)continue;"):v?t.push("if(y0<=x0||x1<y0)continue;"):t.push("if(y0<x0||x1<y0)continue;"),t.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),v?t.push("yi,xi"):t.push("xi,yi"),t.push(");if(rv!==void 0)return rv;}}}"),{name:b,code:t.join("")}}(v,b,a);P.push(t.code),V.push("return "+t.name+"("+c.join()+");")}V.push("if(re-rs>be-bs){"),a?(K(!0,!1),V.push("}else{"),K(!1,!1)):(V.push("if(fp){"),K(!0,!0),V.push("}else{"),K(!0,!1),V.push("}}else{if(fp){"),K(!1,!0),V.push("}else{"),K(!1,!1),V.push("}")),V.push("}}return "+v);var C=P.join("")+V.join("");return new Function(C)()}v.partial=f(!1),v.full=f(!0)},12708:(a,v,p)=>{"use strict";a.exports=function(a,v,p,L,F,q,T,j,w){!function(a,v){var p=8*b.log2(v+1)*(a+1)|0,L=b.nextPow2(s*p);y.length<L&&(P.free(y),y=P.mallocInt32(L));var t=b.nextPow2(D*p);Z.length<t&&(P.free(Z),Z=P.mallocDouble(t))}(a,L+T);var J,B=0,x=2*a;M(B++,0,0,L,0,T,p?16:0,-1/0,1/0),p||M(B++,0,0,T,0,L,1,-1/0,1/0);for(;B>0;){var r=(B-=1)*s,o=y[r],m=y[r+1],O=y[r+2],Y=y[r+3],l=y[r+4],z=y[r+5],g=B*D,G=Z[g],e=Z[g+1],k=1&z,d=!!(16&z),E=F,W=q,U=j,N=w;if(k&&(E=j,W=w,U=F,N=q),!(2&z&&m>=(O=h(a,o,m,O,E,W,e)))&&!(4&z&&(m=R(a,o,m,O,E,W,G))>=O)){var i=O-m,I=l-Y;if(d){if(a*i*(i+I)<f){if(void 0!==(J=K.scanComplete(a,o,v,m,O,E,W,Y,l,U,N)))return J;continue}}else{if(a*Math.min(i,I)<u){if(void 0!==(J=t(a,o,v,k,m,O,E,W,Y,l,U,N)))return J;continue}if(a*i*I<c){if(void 0!==(J=K.scanBipartite(a,o,v,k,m,O,E,W,Y,l,U,N)))return J;continue}}var aa=H(a,o,m,O,E,W,G,e);if(m<aa)if(a*(aa-m)<u){if(void 0!==(J=V(a,o+1,v,m,aa,E,W,Y,l,U,N)))return J}else if(o===a-2){if(void 0!==(J=k?K.sweepBipartite(a,v,Y,l,U,N,m,aa,E,W):K.sweepBipartite(a,v,m,aa,E,W,Y,l,U,N)))return J}else M(B++,o+1,m,aa,Y,l,k,-1/0,1/0),M(B++,o+1,Y,l,m,aa,1^k,-1/0,1/0);if(aa<O){var va=C(a,o,Y,l,U,N),pa=U[x*va+o],Pa=A(a,o,va,l,U,N,pa);if(Pa<l&&M(B++,o,aa,O,Pa,l,(4|k)+(d?16:0),pa,e),Y<va&&M(B++,o,aa,O,Y,va,(2|k)+(d?16:0),G,pa),va+1===Pa){if(void 0!==(J=d?n(a,o,v,aa,O,E,W,va,U,N[va]):S(a,o,v,k,aa,O,E,W,va,U,N[va])))return J}else if(va<Pa){var ba;if(d){if(aa<(ba=X(a,o,aa,O,E,W,pa))){var La=A(a,o,aa,ba,E,W,pa);if(o===a-2){if(aa<La&&void 0!==(J=K.sweepComplete(a,v,aa,La,E,W,va,Pa,U,N)))return J;if(La<ba&&void 0!==(J=K.sweepBipartite(a,v,La,ba,E,W,va,Pa,U,N)))return J}else aa<La&&M(B++,o+1,aa,La,va,Pa,16,-1/0,1/0),La<ba&&(M(B++,o+1,La,ba,va,Pa,0,-1/0,1/0),M(B++,o+1,va,Pa,La,ba,1,-1/0,1/0))}}else aa<(ba=k?Q(a,o,aa,O,E,W,pa):X(a,o,aa,O,E,W,pa))&&(o===a-2?J=k?K.sweepBipartite(a,v,va,Pa,U,N,aa,ba,E,W):K.sweepBipartite(a,v,aa,ba,E,W,va,Pa,U,N):(M(B++,o+1,aa,ba,va,Pa,k,-1/0,1/0),M(B++,o+1,va,Pa,aa,ba,1^k,-1/0,1/0)))}}}}};var P=p(12677),b=p(12681),L=p(12714),t=L.partial,V=L.full,K=p(12697),C=p(12716),F=p(12725),u=128,c=1<<22,f=1<<22,H=F("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),A=F("lo===p0",["p0"]),h=F("lo<p0",["p0"]),R=F("hi<=p0",["p0"]),X=F("lo<=p0&&p0<=hi",["p0"]),Q=F("lo<p0&&p0<=hi",["p0"]),s=6,D=2,y=P.mallocInt32(1024),Z=P.mallocDouble(1024);function M(a,v,p,P,b,L,t,V,K){var C=s*a;y[C]=v,y[C+1]=p,y[C+2]=P,y[C+3]=b,y[C+4]=L,y[C+5]=t;var F=D*a;Z[F]=V,Z[F+1]=K}function S(a,v,p,P,b,L,t,V,K,C,F){var u=2*a,c=K*u,f=C[c+v];a:for(var H=b,A=b*u;H<L;++H,A+=u){var h=t[A+v],R=t[A+v+a];if(!(f<h||R<f)&&(!P||f!==h)){for(var X,Q=V[H],s=v+1;s<a;++s){h=t[A+s],R=t[A+s+a];var D=C[c+s],y=C[c+s+a];if(R<D||y<h)continue a}if(void 0!==(X=P?p(F,Q):p(Q,F)))return X}}}function n(a,v,p,P,b,L,t,V,K,C){var F=2*a,u=V*F,c=K[u+v];a:for(var f=P,H=P*F;f<b;++f,H+=F){var A=t[f];if(A!==C){var h=L[H+v],R=L[H+v+a];if(!(c<h||R<c)){for(var X=v+1;X<a;++X){h=L[H+X],R=L[H+X+a];var Q=K[u+X],s=K[u+X+a];if(R<Q||s<h)continue a}var D=p(A,C);if(void 0!==D)return D}}}}},12716:(a,v,p)=>{"use strict";a.exports=function(a,v,p,t,V,K){if(t<=p+1)return p;var C=p,F=t,u=t+p>>>1,c=2*a,f=u,H=V[c*u+v];for(;C<F;){if(F-C<b){L(a,v,C,F,V,K),H=V[c*u+v];break}var A=F-C,h=Math.random()*A+C|0,R=V[c*h+v],X=Math.random()*A+C|0,Q=V[c*X+v],s=Math.random()*A+C|0,D=V[c*s+v];R<=Q?D>=Q?(f=X,H=Q):R>=D?(f=h,H=R):(f=s,H=D):Q>=D?(f=X,H=Q):D>=R?(f=h,H=R):(f=s,H=D);for(var y=c*(F-1),Z=c*f,M=0;M<c;++M,++y,++Z){var S=V[y];V[y]=V[Z],V[Z]=S}var n=K[F-1];K[F-1]=K[f],K[f]=n;for(y=c*(F-1),Z=c*(f=P(a,v,C,F-1,V,K,H)),M=0;M<c;++M,++y,++Z){S=V[y];V[y]=V[Z],V[Z]=S}n=K[F-1];if(K[F-1]=K[f],K[f]=n,u<f){for(F=f-1;C<F&&V[c*(F-1)+v]===H;)F-=1;F+=1}else{if(!(f<u))break;for(C=f+1;C<F&&V[c*C+v]===H;)C+=1}}return P(a,v,p,u,V,K,V[c*u+v])};var P=p(12725)("lo<p0",["p0"]),b=8;function L(a,v,p,P,b,L){for(var t=2*a,V=t*(p+1)+v,K=p+1;K<P;++K,V+=t)for(var C=b[V],F=K,u=t*(K-1);F>p&&b[u+v]>C;--F,u-=t){for(var c=u,f=u+t,H=0;H<t;++H,++c,++f){var A=b[c];b[c]=b[f],b[f]=A}var h=L[F];L[F]=L[F-1],L[F-1]=h}}},12725:a=>{"use strict";a.exports=function(a,p){var P="abcdef".split("").concat(p),b=[];a.indexOf("lo")>=0&&b.push("lo=e[k+n]");a.indexOf("hi")>=0&&b.push("hi=e[k+o]");return P.push(v.replace("_",b.join()).replace("$",a)),Function.apply(void 0,P)};var v="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12705:a=>{"use strict";a.exports=function(a,P){P<=4*v?p(0,P-1,a):C(0,P-1,a)};var v=32;function p(a,v,p){for(var P=2*(a+1),b=a+1;b<=v;++b){for(var L=p[P++],t=p[P++],V=b,K=P-2;V-- >a;){var C=p[K-2],F=p[K-1];if(C<L)break;if(C===L&&F<t)break;p[K]=C,p[K+1]=F,K-=2}p[K]=L,p[K+1]=t}}function P(a,v,p){v*=2;var P=p[a*=2],b=p[a+1];p[a]=p[v],p[a+1]=p[v+1],p[v]=P,p[v+1]=b}function b(a,v,p){v*=2,p[a*=2]=p[v],p[a+1]=p[v+1]}function L(a,v,p,P){v*=2,p*=2;var b=P[a*=2],L=P[a+1];P[a]=P[v],P[a+1]=P[v+1],P[v]=P[p],P[v+1]=P[p+1],P[p]=b,P[p+1]=L}function t(a,v,p,P,b){v*=2,b[a*=2]=b[v],b[v]=p,b[a+1]=b[v+1],b[v+1]=P}function V(a,v,p){v*=2;var P=p[a*=2],b=p[v];return!(P<b)&&(P!==b||p[a+1]>p[v+1])}function K(a,v,p,P){var b=P[a*=2];return b<v||b===v&&P[a+1]<p}function C(a,F,u){var c=(F-a+1)/6|0,f=a+c,H=F-c,A=a+F>>1,h=A-c,R=A+c,X=f,Q=h,s=A,D=R,y=H,Z=a+1,M=F-1,S=0;V(X,Q,u)&&(S=X,X=Q,Q=S),V(D,y,u)&&(S=D,D=y,y=S),V(X,s,u)&&(S=X,X=s,s=S),V(Q,s,u)&&(S=Q,Q=s,s=S),V(X,D,u)&&(S=X,X=D,D=S),V(s,D,u)&&(S=s,s=D,D=S),V(Q,y,u)&&(S=Q,Q=y,y=S),V(Q,s,u)&&(S=Q,Q=s,s=S),V(D,y,u)&&(S=D,D=y,y=S);for(var n=u[2*Q],q=u[2*Q+1],T=u[2*D],j=u[2*D+1],w=2*X,J=2*s,B=2*y,x=2*f,r=2*A,o=2*H,m=0;m<2;++m){var O=u[w+m],Y=u[J+m],l=u[B+m];u[x+m]=O,u[r+m]=Y,u[o+m]=l}b(h,a,u),b(R,F,u);for(var z=Z;z<=M;++z)if(K(z,n,q,u))z!==Z&&P(z,Z,u),++Z;else if(!K(z,T,j,u))for(;;){if(K(M,T,j,u)){K(M,n,q,u)?(L(z,Z,M,u),++Z,--M):(P(z,M,u),--M);break}if(--M<z)break}t(a,Z-1,n,q,u),t(F,M+1,T,j,u),Z-2-a<=v?p(a,Z-2,u):C(a,Z-2,u),F-(M+2)<=v?p(M+2,F,u):C(M+2,F,u),M-Z<=v?p(Z,M,u):C(Z,M,u)}},12697:(a,v,p)=>{"use strict";a.exports={init:function(a){var v=b.nextPow2(a);K.length<v&&(P.free(K),K=P.mallocInt32(v));C.length<v&&(P.free(C),C=P.mallocInt32(v));F.length<v&&(P.free(F),F=P.mallocInt32(v));u.length<v&&(P.free(u),u=P.mallocInt32(v));c.length<v&&(P.free(c),c=P.mallocInt32(v));f.length<v&&(P.free(f),f=P.mallocInt32(v));var p=8*v;H.length<p&&(P.free(H),H=P.mallocDouble(p))},sweepBipartite:function(a,v,p,P,b,V,c,f,R,X){for(var Q=0,s=2*a,D=a-1,y=s-1,Z=p;Z<P;++Z){var M=V[Z],S=s*Z;H[Q++]=b[S+D],H[Q++]=-(M+1),H[Q++]=b[S+y],H[Q++]=M}for(Z=c;Z<f;++Z){M=X[Z]+t;var n=s*Z;H[Q++]=R[n+D],H[Q++]=-M,H[Q++]=R[n+y],H[Q++]=M}var q=Q>>>1;L(H,q);var T=0,j=0;for(Z=0;Z<q;++Z){var w=0|H[2*Z+1];if(w>=t)A(F,u,j--,w=w-t|0);else if(w>=0)A(K,C,T--,w);else if(w<=-t){w=-w-t|0;for(var J=0;J<T;++J){if(void 0!==(B=v(K[J],w)))return B}h(F,u,j++,w)}else{w=-w-1|0;for(J=0;J<j;++J){var B;if(void 0!==(B=v(w,F[J])))return B}h(K,C,T++,w)}}},sweepComplete:function(a,v,p,P,b,t,V,R,X,Q){for(var s=0,D=2*a,y=a-1,Z=D-1,M=p;M<P;++M){var S=t[M]+1<<1,n=D*M;H[s++]=b[n+y],H[s++]=-S,H[s++]=b[n+Z],H[s++]=S}for(M=V;M<R;++M){S=Q[M]+1<<1;var q=D*M;H[s++]=X[q+y],H[s++]=1|-S,H[s++]=X[q+Z],H[s++]=1|S}var T=s>>>1;L(H,T);var j=0,w=0,J=0;for(M=0;M<T;++M){var B=0|H[2*M+1],x=1&B;if(M<T-1&&B>>1===H[2*M+3]>>1&&(x=2,M+=1),B<0){for(var r=-(B>>1)-1,o=0;o<J;++o){if(void 0!==(m=v(c[o],r)))return m}if(0!==x)for(o=0;o<j;++o){if(void 0!==(m=v(K[o],r)))return m}if(1!==x)for(o=0;o<w;++o){var m;if(void 0!==(m=v(F[o],r)))return m}0===x?h(K,C,j++,r):1===x?h(F,u,w++,r):2===x&&h(c,f,J++,r)}else{r=(B>>1)-1;0===x?A(K,C,j--,r):1===x?A(F,u,w--,r):2===x&&A(c,f,J--,r)}}},scanBipartite:function(a,v,p,P,b,V,F,u,c,f,R,X){var Q=0,s=2*a,D=v,y=v+a,Z=1,M=1;P?M=t:Z=t;for(var S=b;S<V;++S){var n=S+Z,q=s*S;H[Q++]=F[q+D],H[Q++]=-n,H[Q++]=F[q+y],H[Q++]=n}for(S=c;S<f;++S){n=S+M;var T=s*S;H[Q++]=R[T+D],H[Q++]=-n}var j=Q>>>1;L(H,j);var w=0;for(S=0;S<j;++S){var J=0|H[2*S+1];if(J<0){var B=!1;if((n=-J)>=t?(B=!P,n-=t):(B=!!P,n-=1),B)h(K,C,w++,n);else{var x=X[n],r=s*n,o=R[r+v+1],m=R[r+v+1+a];a:for(var O=0;O<w;++O){var Y=K[O],l=s*Y;if(!(m<F[l+v+1]||F[l+v+1+a]<o)){for(var z=v+2;z<a;++z)if(R[r+z+a]<F[l+z]||F[l+z+a]<R[r+z])continue a;var g,G=u[Y];if(void 0!==(g=P?p(x,G):p(G,x)))return g}}}}else A(K,C,w--,J-Z)}},scanComplete:function(a,v,p,P,b,V,C,F,u,c,f){for(var A=0,h=2*a,R=v,X=v+a,Q=P;Q<b;++Q){var s=Q+t,D=h*Q;H[A++]=V[D+R],H[A++]=-s,H[A++]=V[D+X],H[A++]=s}for(Q=F;Q<u;++Q){s=Q+1;var y=h*Q;H[A++]=c[y+R],H[A++]=-s}var Z=A>>>1;L(H,Z);var M=0;for(Q=0;Q<Z;++Q){var S=0|H[2*Q+1];if(S<0){if((s=-S)>=t)K[M++]=s-t;else{var n=f[s-=1],q=h*s,T=c[q+v+1],j=c[q+v+1+a];a:for(var w=0;w<M;++w){var J=K[w],B=C[J];if(B===n)break;var x=h*J;if(!(j<V[x+v+1]||V[x+v+1+a]<T)){for(var r=v+2;r<a;++r)if(c[q+r+a]<V[x+r]||V[x+r+a]<c[q+r])continue a;var o=p(B,n);if(void 0!==o)return o}}}}else{for(s=S-t,w=M-1;w>=0;--w)if(K[w]===s){for(r=w+1;r<M;++r)K[r-1]=K[r];break}--M}}}};var P=p(12677),b=p(12681),L=p(12705),t=1<<28,V=1024,K=P.mallocInt32(V),C=P.mallocInt32(V),F=P.mallocInt32(V),u=P.mallocInt32(V),c=P.mallocInt32(V),f=P.mallocInt32(V),H=P.mallocDouble(8192);function A(a,v,p,P){var b=v[P],L=a[p-1];a[b]=L,v[L]=b}function h(a,v,p,P){a[p]=P,v[P]=p}},12687:a=>{"use strict";function v(a,p,P){var b=0|a[P];if(b<=0)return[];var L,t=new Array(b);if(P===a.length-1)for(L=0;L<b;++L)t[L]=p;else for(L=0;L<b;++L)t[L]=v(a,p,P+1);return t}a.exports=function(a,p){switch("undefined"===typeof p&&(p=0),typeof a){case"number":if(a>0)return function(a,v){var p,P;for(p=new Array(a),P=0;P<a;++P)p[P]=v;return p}(0|a,p);break;case"object":if("number"===typeof a.length)return v(a,p,0)}return[]}},12644:(a,v,p)=>{a.exports=function(){var a=this;this.components={},this.comps=this.components;var v=this.components,p=1,b={},L=[],t=[],V={timeout:!1,removals:[],multiComps:[]};function K(a,p){var P=v[p],L=b[p],t=L.hash[a];t&&(L.remove(a),P.ab&&(P.multi?(t.forEach((v=>{v&&P.ab(a,v)})),t.length=0):P.ab(a,t)),V.removals.push(L),C())}function C(){V.timeout||(V.timeout=!0,setTimeout(F,1))}function F(){V.timeout=!1,u()}function u(){V.multiComps.length&&function(a){for(var v=0;v<a.length;v++){var{entID:p,data:P}=a[v],b=P.hash[p];if(b){for(var L=0;L<b.length;L++)b[L]||(b.splice(L,1),L--);0===b.length&&(P.remove(p),V.removals.push(P))}}a.length=0}(V.multiComps),V.removals.length&&function(a){for(var v=0;v<a.length;v++){a[v].flush()}a.length=0}(V.removals)}this.Ni=b,this._systems=L,this._renderSystems=t,this.mh=function(v){var P=p++;return Array.isArray(v)&&v.forEach((v=>a.qf(P,v))),P},this.deleteEntity=function(v){return Object.keys(b).forEach((a=>{b[a].hash[v]&&K(v,a)})),a},this.Mh=function(a){if(!a)throw new Error("Missing component definition");var p=a.name;if(!p)throw new Error("Component definition must have a name property.");if("string"!==typeof p)throw new Error("Component name must be a string.");if(""===p)throw new Error("Component name must be a non-empty string.");if(b[p])throw new Error(`Component ${p} already exists.`);var V={};return V.name=p,V.multi=!!a.multi,V.order=isNaN(a.order)?99:a.order,V.stateConstructor=a.stateConstructor||null,V.state=a.state||{},V.Zd=a.Zd||null,V.ab=a.ab||null,V.system=a.system||null,V.he=a.he||null,v[p]=V,b[p]=new P,b[p]._pendingMultiCleanup=!1,b[p]._multiCleanupIDs=V.multi?[]:null,V.system&&(L.push(p),L.sort(((a,p)=>v[a].order-v[p].order))),V.he&&(t.push(p),t.sort(((a,p)=>v[a].order-v[p].order))),p},this.overwriteComponent=function(a,p){var P=v[a];if(!P)throw new Error(`Unknown component: ${a}`);if(!p)throw new Error("Missing component definition");if(P.name!==p.name)throw new Error("Overwriting component must use the same name property.");var V={};V.name=a,V.multi=!!p.multi,V.order=isNaN(p.order)?99:p.order,V.state=p.state||{},V.Zd=p.Zd||null,V.ab=p.ab||null,V.system=p.system||null,V.he=p.he||null,v[a]=V,b[a]._pendingMultiCleanup=!1,b[a]._multiCleanupIDs=V.multi?[]:null;var K=L.indexOf(a);V.system&&K<0&&L.push(a),!V.system&&K>=0&&L.splice(K,1),L.sort(((a,p)=>v[a].order-v[p].order));var C=t.indexOf(a);V.he&&C<0&&t.push(a),!V.he&&C>=0&&t.splice(C,1),t.sort(((a,p)=>v[a].order-v[p].order));var F=V.state;return this.Ng(a).forEach((a=>{for(var v in F)v in a||(a[v]=F[v]);V.Zd&&V.Zd(a.ee,a)})),a},this.deleteComponent=function(p){var P=b[p];if(!P)throw new Error(`Unknown component: ${p}`);P.flush(),P.list.forEach((a=>{a&&K(a.ee||a[0].ee,p)}));var V=L.indexOf(p),C=t.indexOf(p);return V>-1&&L.splice(V,1),C>-1&&t.splice(C,1),b[p].dispose(),delete b[p],delete v[p],a},this.qf=function(a,p,P){var L,t=v[p],V=b[p];if(!V)throw new Error(`Unknown component: ${p}.`);if(V.hash[a]&&!t.multi)throw new Error(`Entity ${a} already has component: ${p}.`);if(t.stateConstructor){if(!(L=new t.stateConstructor).hasOwnProperty("ee"))throw new Error(`Component ${t.name} stateConstructor type does not have property __id`)}else L=Object.assign({},{ee:a},t.state,P);if(L.ee=a,t.multi){var K=V.hash[a];K||(K=[],V.add(a,K)),K.push(L)}else V.add(a,L);return t.Zd&&t.Zd(a,L),this},this.Gf=function(a,v){var p=b[v];if(!p)throw new Error(`Unknown component: ${v}.`);return!!p.hash[a]},this.xf=function(v,p){if(!b[p])throw new Error(`Unknown component: ${p}.`);return K(v,p),a},this.getState=function(a,v){var p=b[v];if(!p)throw new Error(`Unknown component: ${v}.`);return p.hash[a]},this.Ng=function(a){var v=b[a];if(!v)throw new Error(`Unknown component: ${a}.`);return u(),v.list},this.Ik=function(a){if(!b[a])throw new Error(`Unknown component: ${a}.`);var v=b[a].hash;return a=>v[a]},this.Lk=function(a){if(!b[a])throw new Error(`Unknown component: ${a}.`);var v=b[a].hash;return a=>!!v[a]},this.Xd=function(p){u();for(var P=0;P<L.length;P++){var t=L[P],V=v[t],K=b[t];V.system(p,K.list),u()}return a},this.render=function(p){u();for(var P=0;P<t.length;P++){var L=t[P],V=v[L],K=b[L];V.he(p,K.list),u()}return a},this.removeMultiComponent=function(p,P,L){var t=v[P],K=b[P];if(!K)throw new Error(`Unknown component: ${P}.`);if(!t.multi)throw new Error("removeMultiComponent called on non-multi component");return function(a,v,p,P){var b=p.hash[a];if(b){var L=b[P];L&&(b[P]=null,v.ab&&v.ab(a,L),V.multiComps.push({entID:a,data:p}),C())}}(p,t,K,L),a}};var P=p(12651)},12651:a=>{function v(a,v){var p=a._map[v];if(delete a.hash[v],delete a._map[v],p===a.list.length-1)a.list.pop();else{var P=a.list.pop();if(a.list[p]=P,null===P||null===P[0]){var b=a.list.length;for(var L in a._map)if(a._map[L]===b)return void(a._map[L]=p)}else{var t=P.ee||P[0].ee;a._map[t]=p}}}a.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(a,v){if("number"===typeof this._map[a]){var p=this._map[a];this.hash[a]=v,this.list[p]=v}else this._map[a]=this.list.length,this.hash[a]=v,this.list.push(v)}remove(a){var v=this._map[a];this.hash[a]=null,this.list[v]=null,this._pendingRemovals.push(a)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var a=0;a<this._pendingRemovals.length;a++){var p=this._pendingRemovals[a];null===this.hash[p]&&v(this,p)}this._pendingRemovals.length=0}}},12602:a=>{"use strict";var v,p="object"===typeof Reflect?Reflect:null,P=function(a,v,p){return Function.prototype.apply.call(a,v,p)};v=p&&"function"===typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:function(a){return Object.getOwnPropertyNames(a)};var b=Number.isNaN||function(a){return a!==a};function L(){L.init.call(this)}a.exports=L,a.exports.once=function(a,v){return new Promise((function(p,P){function b(p){a.removeListener(v,L),P(p)}function L(){"function"===typeof a.removeListener&&a.removeListener("error",b),p([].slice.call(arguments))}A(a,v,L,{once:!0}),"error"!==v&&function(a,v,p){"function"===typeof a.on&&A(a,"error",v,p)}(a,b,{once:!0})}))},L.EventEmitter=L,L.prototype._events=void 0,L.prototype._eventsCount=0,L.prototype._maxListeners=void 0;var t=10;function V(a){if("function"!==typeof a)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}function K(a){return void 0===a._maxListeners?L.defaultMaxListeners:a._maxListeners}function C(a,v,p,P){var b,L,t,C;if(V(p),void 0===(L=a._events)?(L=a._events=Object.create(null),a._eventsCount=0):(void 0!==L.newListener&&(a.emit("newListener",v,p.listener?p.listener:p),L=a._events),t=L[v]),void 0===t)t=L[v]=p,++a._eventsCount;else if("function"===typeof t?t=L[v]=P?[p,t]:[t,p]:P?t.unshift(p):t.push(p),(b=K(a))>0&&t.length>b&&!t.warned){t.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+t.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.j=a,F.type=v,F.count=t.length,C=F,console&&console.warn&&console.warn(C)}return a}function F(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(a,v,p){var P={fired:!1,wrapFn:void 0,target:a,type:v,listener:p},b=F.bind(P);return b.listener=p,P.wrapFn=b,b}function c(a,v,p){var P=a._events;if(void 0===P)return[];var b=P[v];return void 0===b?[]:"function"===typeof b?p?[b.listener||b]:[b]:p?function(a){for(var v=new Array(a.length),p=0;p<v.length;++p)v[p]=a[p].listener||a[p];return v}(b):H(b,b.length)}function f(a){var v=this._events;if(void 0!==v){var p=v[a];if("function"===typeof p)return 1;if(void 0!==p)return p.length}return 0}function H(a,v){for(var p=new Array(v),P=0;P<v;++P)p[P]=a[P];return p}function A(a,v,p,P){if("function"===typeof a.on)P.once?a.once(v,p):a.on(v,p);else{if("function"!==typeof a.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a);a.addEventListener(v,(function b(L){P.once&&a.removeEventListener(v,b),p(L)}))}}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return t},set:function(a){if("number"!==typeof a||a<0||b(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");t=a}}),L.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},L.prototype.setMaxListeners=function(a){if("number"!==typeof a||a<0||b(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this},L.prototype.getMaxListeners=function(){return K(this)},L.prototype.emit=function(a){for(var v=[],p=1;p<arguments.length;p++)v.push(arguments[p]);var b="error"===a,L=this._events;if(void 0!==L)b=b&&void 0===L.error;else if(!b)return!1;if(b){var t;if(v.length>0&&(t=v[0]),t instanceof Error)throw t;var V=new Error("Unhandled error."+(t?" ("+t.message+")":""));throw V.context=t,V}var K=L[a];if(void 0===K)return!1;if("function"===typeof K)P(K,this,v);else{var C=K.length,F=H(K,C);for(p=0;p<C;++p)P(F[p],this,v)}return!0},L.prototype.addListener=function(a,v){return C(this,a,v,!1)},L.prototype.on=L.prototype.addListener,L.prototype.prependListener=function(a,v){return C(this,a,v,!0)},L.prototype.once=function(a,v){return V(v),this.on(a,u(this,a,v)),this},L.prototype.prependOnceListener=function(a,v){return V(v),this.prependListener(a,u(this,a,v)),this},L.prototype.removeListener=function(a,v){var p,P,b,L,t;if(V(v),void 0===(P=this._events))return this;if(void 0===(p=P[a]))return this;if(p===v||p.listener===v)0===--this._eventsCount?this._events=Object.create(null):(delete P[a],P.removeListener&&this.emit("removeListener",a,p.listener||v));else if("function"!==typeof p){for(b=-1,L=p.length-1;L>=0;L--)if(p[L]===v||p[L].listener===v){t=p[L].listener,b=L;break}if(b<0)return this;0===b?p.shift():function(a,v){for(;v+1<a.length;v++)a[v]=a[v+1];a.pop()}(p,b),1===p.length&&(P[a]=p[0]),void 0!==P.removeListener&&this.emit("removeListener",a,t||v)}return this},L.prototype.off=L.prototype.removeListener,L.prototype.removeAllListeners=function(a){var v,p,P;if(void 0===(p=this._events))return this;if(void 0===p.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==p[a]&&(0===--this._eventsCount?this._events=Object.create(null):delete p[a]),this;if(0===arguments.length){var b,L=Object.keys(p);for(P=0;P<L.length;++P)"removeListener"!==(b=L[P])&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(v=p[a]))this.removeListener(a,v);else if(void 0!==v)for(P=v.length-1;P>=0;P--)this.removeListener(a,v[P]);return this},L.prototype.listeners=function(a){return c(this,a,!0)},L.prototype.rawListeners=function(a){return c(this,a,!1)},L.listenerCount=function(a,v){return"function"===typeof a.listenerCount?a.listenerCount(v):f.call(a,v)},L.prototype.listenerCount=f,L.prototype.eventNames=function(){return this._eventsCount>0?v(this._events):[]}},12897:a=>{"use strict";a.exports=function(a,v,p,P,b,L){var t=+v[0],V=+v[1],K=+v[2],C=+p[0],F=+p[1],u=+p[2],c=Math.sqrt(C*C+F*F+u*u);if(0===c)throw new Error("Can't raycast along a zero vector");return function(a,v,p,P,b,L,t,V,K,C){for(var F=0,u=Math.floor,c=0|u(v),f=0|u(p),H=0|u(P),A=b>0?1:-1,h=L>0?1:-1,R=t>0?1:-1,X=Math.abs(1/b),Q=Math.abs(1/L),s=Math.abs(1/t),D=X<1/0?X*(A>0?c+1-v:v-c):1/0,y=Q<1/0?Q*(h>0?f+1-p:p-f):1/0,Z=s<1/0?s*(R>0?H+1-P:P-H):1/0,M=-1;F<=V;){var S=a(c,f,H);if(S)return K&&(K[0]=v+F*b,K[1]=p+F*L,K[2]=P+F*t),C&&(C[0]=C[1]=C[2]=0,0===M&&(C[0]=-A),1===M&&(C[1]=-h),2===M&&(C[2]=-R)),S;D<y?D<Z?(c+=A,F=D,D+=X,M=0):(H+=R,F=Z,Z+=s,M=2):y<Z?(f+=h,F=y,y+=Q,M=1):(H+=R,F=Z,Z+=s,M=2)}return K&&(K[0]=v+F*b,K[1]=p+F*L,K[2]=P+F*t),C&&(C[0]=C[1]=C[2]=0),0}(a,t,V,K,C/=c,F/=c,u/=c,P="undefined"===typeof P?64:+P,b,L)}},12929:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(12602);function b(){this.Gj=!1,this.stopPropagation=!1,this.Hj=!1,this.disabled=!1}class L{constructor(a,v){this.version="0.7.0";var p=Object.assign({},new b,v||{});this.element=a||document,this.Gj=!!p.Gj,this.stopPropagation=!!p.stopPropagation,this.Hj=!!p.Hj,this.disabled=!!p.disabled,this.filterEvents=(a,v)=>!0,this.down=new P.EventEmitter,this.up=new P.EventEmitter,this.state={},this.Fg={dx:0,dy:0,zk:0,Eg:0,Ak:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?V(this):document.addEventListener("DOMContentLoaded",(a=>{V(this)}),{once:!0})}bind(a){for(var v=arguments.length,p=new Array(v>1?v-1:0),P=1;P<v;P++)p[P-1]=arguments[P];p.forEach((v=>{var p=this._keyBindmap[v]||[];p.includes(a)||(p.push(a),this._keyBindmap[v]=p)})),this.state[a]=!!this.state[a],this.pressCount[a]=this.pressCount[a]||0,this.releaseCount[a]=this.releaseCount[a]||0}unbind(a){for(var v in this._keyBindmap){var p=this._keyBindmap[v],P=p.indexOf(a);P>-1&&p.splice(P,1)}}getBindings(){var a={};for(var v in this._keyBindmap){this._keyBindmap[v].forEach((p=>{a[p]=a[p]||[],a[p].push(v)}))}return a}Xd(){t(this.Fg),t(this.pressCount),t(this.releaseCount)}}function t(a){for(var v in a)a[v]=0}function V(a){window.addEventListener("keydown",H.bind(null,a,!0),!1),window.addEventListener("keyup",H.bind(null,a,!1),!1);var v={passive:!0};a.element.addEventListener("touchstart",u.bind(void 0,a),{passive:!1}),a.element.addEventListener("touchend",f.bind(void 0,a),v),a.element.addEventListener("mousedown",A.bind(null,a,!0),v),window.document.addEventListener("mouseup",A.bind(null,a,!1),v),a.element.addEventListener("touchmove",h.bind(null,a),v),a.element.addEventListener("mousemove",h.bind(null,a),v),window.PointerEvent,a.element.addEventListener("wheel",R.bind(null,a),v),a.element.addEventListener("contextmenu",X.bind(null,a),!1),window.addEventListener("blur",Q.bind(null,a),!1)}var K=0,C=0,F=null;function u(a,v){v.preventDefault(),c(v)}function c(a){let v=!1;for(let p=0;p<a.touches.length;++p)if(a.touches[p].identifier===F){v=!0;break}if(!v){const v=a.changedTouches[0];K=v.clientX,C=v.clientY,F=v.identifier}}function f(a,v){for(var p=v.changedTouches,P=0;P<p.length;++P)p[P].identifier===F&&(F=null)}function H(a,v,p){s(p.code,v,a,p)}function A(a,v,p){if("pointerId"in p)if(v){if(null!==a._touches.currID)return;a._touches.currID=p.pointerId}else{if(a._touches.currID!==p.pointerId)return;a._touches.currID=null}return s("Mouse"+("button"in p?p.button+1:1),v,a,p),!1}function h(a,v){var p=v.movementX||v.mozMovementX||0,P=v.movementY||v.mozMovementY||0;if(v.touches&&0===(p|P)){var b=function(a){c(a);for(let v=0;v<a.changedTouches.length;++v)if(a.changedTouches[v].identifier==F){const p=a.changedTouches[v],P=[p.clientX-K,p.clientY-C];return K=p.clientX,C=p.clientY,P}return console.error(`Did not find touch id ${F}`),[0,0]}(v);p=b[0],P=b[1]}a.Fg.dx+=p,a.Fg.dy+=P}function R(a,v){var p=1;switch(v.deltaMode){case 0:p=1;break;case 1:p=12;break;case 2:p=a.element.clientHeight||window.innerHeight}a.Fg.zk+=(v.deltaX||0)*p,a.Fg.Eg+=(v.deltaY||0)*p,a.Fg.Ak+=(v.deltaZ||0)*p}function X(a,v){if(!a.Hj)return v.preventDefault(),!1}function Q(a){for(var v in a._keyStates)a._keyStates[v]&&(/^Mouse\d/.test(v)||s(v,!1,a,{code:v,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(a,v,p,P){var b=p._keyBindmap[a];b&&(D(p._keyStates[a],v)&&(p._keyStates[a]=v,b.forEach((a=>{(!p.filterEvents||p.filterEvents(P,a))&&function(a,v,p,P){var b=v?p.pressCount:p.releaseCount;b[a]=(b[a]||0)+1;var L=p._bindPressCount[a]||0;(L+=v?1:-1)<0&&(L=0);p._bindPressCount[a]=L;var t=p.state[a];if(D(t,L)){p.state[a]=L>0;var V=v?p.down:p.up;p.disabled||V.emit(a,P)}}(a,v,p,P)}))),"button"in P||(p.Gj&&!P.defaultPrevented&&P.preventDefault(),p.stopPropagation&&P.stopPropagation()))}function D(a,v){return a?!v:v}},12201:a=>{a.exports=function(a,v,p){return a[0]=v[0]+p[0],a[1]=v[1]+p[1],a[2]=v[2]+p[2],a}},12157:(a,v,p)=>{a.exports=function(a,v){var p=P(a[0],a[1],a[2]),t=P(v[0],v[1],v[2]);b(p,p),b(t,t);var V=L(p,t);return V>1?0:Math.acos(V)};var P=p(12162),b=p(12168),L=p(12173)},12261:a=>{a.exports=function(a,v){return a[0]=Math.ceil(v[0]),a[1]=Math.ceil(v[1]),a[2]=Math.ceil(v[2]),a}},12149:a=>{a.exports=function(a){var v=new Float32Array(3);return v[0]=a[0],v[1]=a[1],v[2]=a[2],v}},12180:a=>{a.exports=function(a,v){return a[0]=v[0],a[1]=v[1],a[2]=v[2],a}},12142:a=>{a.exports=function(){var a=new Float32Array(3);return a[0]=0,a[1]=0,a[2]=0,a}},12328:a=>{a.exports=function(a,v,p){var P=v[0],b=v[1],L=v[2],t=p[0],V=p[1],K=p[2];return a[0]=b*K-L*V,a[1]=L*t-P*K,a[2]=P*V-b*t,a}},12277:(a,v,p)=>{a.exports=p(12275)},12275:a=>{a.exports=function(a,v){var p=v[0]-a[0],P=v[1]-a[1],b=v[2]-a[2];return Math.sqrt(p*p+P*P+b*b)}},12238:(a,v,p)=>{a.exports=p(12231)},12231:a=>{a.exports=function(a,v,p){return a[0]=v[0]/p[0],a[1]=v[1]/p[1],a[2]=v[2]/p[2],a}},12173:a=>{a.exports=function(a,v){return a[0]*v[0]+a[1]*v[1]+a[2]*v[2]}},12138:a=>{a.exports=1e-6},12190:(a,v,p)=>{a.exports=function(a,v){var p=a[0],b=a[1],L=a[2],t=v[0],V=v[1],K=v[2];return Math.abs(p-t)<=P*Math.max(1,Math.abs(p),Math.abs(t))&&Math.abs(b-V)<=P*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(L-K)<=P*Math.max(1,Math.abs(L),Math.abs(K))};var P=p(12138)},12198:a=>{a.exports=function(a,v){return a[0]===v[0]&&a[1]===v[1]&&a[2]===v[2]}},12256:a=>{a.exports=function(a,v){return a[0]=Math.floor(v[0]),a[1]=Math.floor(v[1]),a[2]=Math.floor(v[2]),a}},12370:(a,v,p)=>{a.exports=function(a,v,p,b,L,t){var V,K;v||(v=3);p||(p=0);K=b?Math.min(b*v+p,a.length):a.length;for(V=p;V<K;V+=v)P[0]=a[V],P[1]=a[V+1],P[2]=a[V+2],L(P,P,t),a[V]=P[0],a[V+1]=P[1],a[V+2]=P[2];return a};var P=p(12142)()},12162:a=>{a.exports=function(a,v,p){var P=new Float32Array(3);return P[0]=a,P[1]=v,P[2]=p,P}},12130:(a,v,p)=>{a.exports={EPSILON:p(12138),create:p(12142),clone:p(12149),angle:p(12157),Jd:p(12162),i:p(12180),set:p(12185),equals:p(12190),exactEquals:p(12198),add:p(12201),od:p(12205),sub:p(12211),multiply:p(12217),mul:p(12225),divide:p(12231),div:p(12238),min:p(12243),max:p(12252),floor:p(12256),ceil:p(12261),round:p(12263),scale:p(12269),Ld:p(12272),distance:p(12275),dist:p(12277),squaredDistance:p(12286),sqrDist:p(12293),length:p(12299),len:p(12301),squaredLength:p(12304),Nd:p(12311),negate:p(12318),inverse:p(12326),normalize:p(12168),dot:p(12173),cross:p(12328),Dd:p(12337),random:p(12343),transformMat4:p(12347),transformMat3:p(12352),transformQuat:p(12356),Pd:p(12362),Qd:p(12364),Rd:p(12368),forEach:p(12370)}},12326:a=>{a.exports=function(a,v){return a[0]=1/v[0],a[1]=1/v[1],a[2]=1/v[2],a}},12301:(a,v,p)=>{a.exports=p(12299)},12299:a=>{a.exports=function(a){var v=a[0],p=a[1],P=a[2];return Math.sqrt(v*v+p*p+P*P)}},12337:a=>{a.exports=function(a,v,p,P){var b=v[0],L=v[1],t=v[2];return a[0]=b+P*(p[0]-b),a[1]=L+P*(p[1]-L),a[2]=t+P*(p[2]-t),a}},12252:a=>{a.exports=function(a,v,p){return a[0]=Math.max(v[0],p[0]),a[1]=Math.max(v[1],p[1]),a[2]=Math.max(v[2],p[2]),a}},12243:a=>{a.exports=function(a,v,p){return a[0]=Math.min(v[0],p[0]),a[1]=Math.min(v[1],p[1]),a[2]=Math.min(v[2],p[2]),a}},12225:(a,v,p)=>{a.exports=p(12217)},12217:a=>{a.exports=function(a,v,p){return a[0]=v[0]*p[0],a[1]=v[1]*p[1],a[2]=v[2]*p[2],a}},12318:a=>{a.exports=function(a,v){return a[0]=-v[0],a[1]=-v[1],a[2]=-v[2],a}},12168:a=>{a.exports=function(a,v){var p=v[0],P=v[1],b=v[2],L=p*p+P*P+b*b;L>0&&(L=1/Math.sqrt(L),a[0]=v[0]*L,a[1]=v[1]*L,a[2]=v[2]*L);return a}},12343:a=>{a.exports=function(a,v){v=v||1;var p=2*Math.random()*Math.PI,P=2*Math.random()-1,b=Math.sqrt(1-P*P)*v;return a[0]=Math.cos(p)*b,a[1]=Math.sin(p)*b,a[2]=P*v,a}},12362:a=>{a.exports=function(a,v,p,P){var b=p[1],L=p[2],t=v[1]-b,V=v[2]-L,K=Math.sin(P),C=Math.cos(P);return a[0]=v[0],a[1]=b+t*C-V*K,a[2]=L+t*K+V*C,a}},12364:a=>{a.exports=function(a,v,p,P){var b=p[0],L=p[2],t=v[0]-b,V=v[2]-L,K=Math.sin(P),C=Math.cos(P);return a[0]=b+V*K+t*C,a[1]=v[1],a[2]=L+V*C-t*K,a}},12368:a=>{a.exports=function(a,v,p,P){var b=p[0],L=p[1],t=v[0]-b,V=v[1]-L,K=Math.sin(P),C=Math.cos(P);return a[0]=b+t*C-V*K,a[1]=L+t*K+V*C,a[2]=v[2],a}},12263:a=>{a.exports=function(a,v){return a[0]=Math.round(v[0]),a[1]=Math.round(v[1]),a[2]=Math.round(v[2]),a}},12269:a=>{a.exports=function(a,v,p){return a[0]=v[0]*p,a[1]=v[1]*p,a[2]=v[2]*p,a}},12272:a=>{a.exports=function(a,v,p,P){return a[0]=v[0]+p[0]*P,a[1]=v[1]+p[1]*P,a[2]=v[2]+p[2]*P,a}},12185:a=>{a.exports=function(a,v,p,P){return a[0]=v,a[1]=p,a[2]=P,a}},12293:(a,v,p)=>{a.exports=p(12286)},12311:(a,v,p)=>{a.exports=p(12304)},12286:a=>{a.exports=function(a,v){var p=v[0]-a[0],P=v[1]-a[1],b=v[2]-a[2];return p*p+P*P+b*b}},12304:a=>{a.exports=function(a){var v=a[0],p=a[1],P=a[2];return v*v+p*p+P*P}},12211:(a,v,p)=>{a.exports=p(12205)},12205:a=>{a.exports=function(a,v,p){return a[0]=v[0]-p[0],a[1]=v[1]-p[1],a[2]=v[2]-p[2],a}},12352:a=>{a.exports=function(a,v,p){var P=v[0],b=v[1],L=v[2];return a[0]=P*p[0]+b*p[3]+L*p[6],a[1]=P*p[1]+b*p[4]+L*p[7],a[2]=P*p[2]+b*p[5]+L*p[8],a}},12347:a=>{a.exports=function(a,v,p){var P=v[0],b=v[1],L=v[2],t=p[3]*P+p[7]*b+p[11]*L+p[15];return t=t||1,a[0]=(p[0]*P+p[4]*b+p[8]*L+p[12])/t,a[1]=(p[1]*P+p[5]*b+p[9]*L+p[13])/t,a[2]=(p[2]*P+p[6]*b+p[10]*L+p[14])/t,a}},12356:a=>{a.exports=function(a,v,p){var P=v[0],b=v[1],L=v[2],t=p[0],V=p[1],K=p[2],C=p[3],F=C*P+V*L-K*b,u=C*b+K*P-t*L,c=C*L+t*b-V*P,f=-t*P-V*b-K*L;return a[0]=F*C+f*-t+u*-K-c*-V,a[1]=u*C+f*-V+c*-t-F*-K,a[2]=c*C+f*-K+F*-V-u*-t,a}},12624:a=>{"use strict";a.exports=function(a){for(var v=new Array(a),p=0;p<a;++p)v[p]=p;return v}},12691:a=>{a.exports=function(a){return null!=a&&null!=a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}},12904:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ki=!1,this.li=!1,this.ii=30,this.ji=0,this.ti=!1,this.fullscreen=!1,this.ni=function(a){},this.oi=function(){},this.ri=function(){},this.bb=function(){},this.pi=function(a){},this.onFullscreenChanged=function(a){},C((()=>{!function(a,v){a._nowObject=performance||Date,a._lastTick=0,a._renderAccum=0,a._rt=0,a._frameCB=V.bind(null,a),requestAnimationFrame(a._frameCB),v>0&&(a._intervalCB=t.bind(null,a),a._interval=setInterval(a._intervalCB,Math.max(v,1e3/a.ii/2)))}(this,v),function(a,v){if(!v)return;var p=!1,P=!1;document.addEventListener("pointerlockchange",(P=>{p=document.pointerLockElement===v,a.pi(p)})),document.addEventListener("fullscreenchange",(p=>{P=document.fullscreenElement===v,a.onFullscreenChanged(P)})),Object.defineProperty(a,"ti",{get:()=>p,set:a=>{a&&!p?K(v):p&&!a&&function(a){a.exitPointerLock&&a.exitPointerLock()}(document)}}),Object.defineProperty(a,"fullscreen",{get:()=>P,set:a=>{a&&!P?v.requestFullscreen():P&&!a&&document.exitFullscreen()}}),v.addEventListener("click",(b=>{a.ki&&!p&&K(v),a.li&&!P&&v.requestFullscreen()}));var b=()=>a.bb();if(window.ResizeObserver){new ResizeObserver(b).observe(v)}else window.addEventListener("resize",b)}(this,a),this.ri()}))}}var b=3,L=20;function t(a){for(var v=1e3/a.ii,p=a._nowObject.now()+L,P=0;a._nowObject.now()>=a._lastTick+v&&a._nowObject.now()<p&&++P<=b;)a.ni(v),a._lastTick+=v;var t=5*(v+5),V=a._nowObject.now();if(V-a._lastTick>t)for(;V>=a._lastTick+v;)a._lastTick+=v}function V(a){requestAnimationFrame(a._frameCB),t(a);var v=a._nowObject.now(),p=v-a._rt;if(a._rt=v,a.ji>0){a._renderAccum+=p;var P=1e3/a.ji;if(a._renderAccum<P)return;a._renderAccum=Math.min(a._renderAccum-P,P)}var b=1e3/a.ii,L=(v-a._lastTick)/b;a.oi(p,L,b)}function K(a){a.requestPointerLock&&a.requestPointerLock()}var C=a=>{if("loading"===document.readyState){var v=()=>{document.removeEventListener("readystatechange",v),a()};document.addEventListener("readystatechange",v)}else setTimeout(a,1)}},12622:(a,v,p)=>{var P=p(12624),b=p(12633),L="undefined"!==typeof Float64Array;function t(a,v){return a[0]-v[0]}function V(){var a,v=this.stride,p=new Array(v.length);for(a=0;a<p.length;++a)p[a]=[Math.abs(v[a]),a];p.sort(t);var P=new Array(p.length);for(a=0;a<P.length;++a)P[a]=p[a][1];return P}function K(a,v){var p=["View",v,"d",a].join("");v<0&&(p="View_Nil"+a);var b="generic"===a;if(-1===v){var L="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}";return new Function(L)()}if(0===v){L="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}";return new Function("TrivialArray",L)(C[a][0])}L=["'use strict'"];var t=P(v),K=t.map((function(a){return"i"+a})),F="this.offset+"+t.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),u=t.map((function(a){return"b"+a})).join(","),c=t.map((function(a){return"c"+a})).join(",");L.push("function "+p+"(a,"+u+","+c+",d){this.data=a","this.shape=["+u+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+a+"'","proto.dimension="+v),L.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+t.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===v?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),v<4?(L.push("function "+p+"_order(){"),2===v?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+p+"_set("+K.join(",")+",v){"),b?L.push("return this.data.set("+F+",v)}"):L.push("return this.data["+F+"]=v}"),L.push("proto.get=function "+p+"_get("+K.join(",")+"){"),b?L.push("return this.data.get("+F+")}"):L.push("return this.data["+F+"]}"),L.push("proto.index=function "+p+"_index(",K.join(),"){return "+F+"}"),L.push("proto.hi=function "+p+"_hi("+K.join(",")+"){return new "+p+"(this.data,"+t.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+t.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var f=t.map((function(a){return"a"+a+"=this.shape["+a+"]"})),H=t.map((function(a){return"c"+a+"=this.stride["+a+"]"}));L.push("proto.lo=function "+p+"_lo("+K.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+H.join(","));for(var A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");L.push("return new "+p+"(this.data,"+t.map((function(a){return"a"+a})).join(",")+","+t.map((function(a){return"c"+a})).join(",")+",b)}"),L.push("proto.step=function "+p+"_step("+K.join(",")+"){var "+t.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+t.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");L.push("return new "+p+"(this.data,"+t.map((function(a){return"a"+a})).join(",")+","+t.map((function(a){return"b"+a})).join(",")+",c)}");var h=new Array(v),R=new Array(v);for(A=0;A<v;++A)h[A]="a[i"+A+"]",R[A]="b[i"+A+"]";L.push("proto.transpose=function "+p+"_transpose("+K+"){"+K.map((function(a,v){return a+"=("+a+"===undefined?"+v+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+h.join(",")+","+R.join(",")+",this.offset)}"),L.push("proto.pick=function "+p+"_pick("+K+"){var a=[],b=[],c=this.offset");for(A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+t.map((function(a){return"shape["+a+"]"})).join(",")+","+t.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(C[a],V)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,v,p,P){if(void 0===a)return(0,C.array[0])([]);"number"===typeof a&&(a=[a]),void 0===v&&(v=[a.length]);var t=v.length;if(void 0===p){p=new Array(t);for(var V=t-1,F=1;V>=0;--V)p[V]=F,F*=v[V]}if(void 0===P){P=0;for(V=0;V<t;++V)p[V]<0&&(P-=(v[V]-1)*p[V])}for(var u=function(a){if(b(a))return"buffer";if(L)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),c=C[u];c.length<=t+1;)c.push(K(u,c.length-1));return(0,c[t+1])(a,v,p,P)}},12633:a=>{function v(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(v(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&v(a.slice(0,0))}(a)||!!a._isBuffer)}},12772:a=>{"use strict";var v=[],p=[],P=[],b=[],L=[],t=[],V=[],K=[],C=[],F=[],u=[],c=[];a.exports=function(a,f,H,A,h,R){for(var X=V,Q=C,s=F,D=c,y=0;y<3;y++)X[y]=+H[y],s[y]=+f.max[y],Q[y]=+f.base[y];R||(R=1e-10);var Z=function(a,V,C,F,c,f){var H=v,A=p,h=P,R=b,X=L,Q=t,s=K,D=Math.floor,y=0,Z=0,M=0,S=0,n=0;if(q(),0===M)return 0;for(S=w();Z<=M;){if(T(S)&&j())return y;S=w()}for(y+=M,n=0;n<3;n++)F[n]+=C[n],c[n]+=C[n];return y;function q(){if(Z=0,0!==(M=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])))for(var a=0;a<3;a++){var v=C[a]>=0;R[a]=v?1:-1;var p=v?c[a]:F[a];H[a]=v?F[a]:c[a],A[a]=J(p,R[a]),h[a]=B(H[a],R[a]),s[a]=C[a]/M,X[a]=Math.abs(1/s[a]);var P=v?A[a]+1-p:p-A[a];Q[a]=X[a]<1/0?X[a]*P:1/0}}function T(v){for(var p=R[0],P=0===v?A[0]:h[0],b=A[0]+p,L=R[1],t=1===v?A[1]:h[1],V=A[1]+L,K=R[2],C=2===v?A[2]:h[2],F=A[2]+K,u=P;u!=b;u+=p)for(var c=t;c!=V;c+=L)for(var f=C;f!=F;f+=K)if(a(u,c,f))return!0;return!1}function j(){y+=Z;var a=R[S],v=Z/M,p=u;for(n=0;n<3;n++){var P=C[n]*v;F[n]+=P,c[n]+=P,p[n]=C[n]-P}if(a>0?c[S]=Math.round(c[S]):F[S]=Math.round(F[S]),V(y,S,a,p))return!0;for(n=0;n<3;n++)C[n]=p[n];return q(),0===M}function w(){var a=Q[0]<Q[1]?Q[0]<Q[2]?0:2:Q[1]<Q[2]?1:2,v=Q[a]-Z;for(Z=Q[a],A[a]+=R[a],Q[a]+=X[a],n=0;n<3;n++)H[n]+=v*s[n],h[n]=B(H[n],R[n]);return a}function J(a,v){return D(a-v*f)}function B(a,v){return D(a+v*f)}}(a,A,X,Q,s,R);if(!h){for(y=0;y<3;y++)D[y]=H[y]>0?s[y]-f.max[y]:Q[y]-f.base[y];f.translate(D)}return Z}},12932:(a,v,p)=>{"use strict";p.d(v,{d:()=>u});var P=p(12770),b=p(12130);class L{constructor(a,v,p,L,t,V,K){this.Lg=new P(a.base,a.fh),this.mass=v,this.friction=p,this.restitution=L,this.rd=t,this.Tk=V,this.td=!!K,this.dh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Fl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.fg=b.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=b.create(),this._impulses=b.create(),this._sleepFrameCount=10}loadFromCopy(a){b.i(this.Lg.base,a.Lg.base),b.i(this.Lg.fh,a.Lg.fh),b.i(this.Lg.max,a.Lg.max),this.Lg.mag=a.Lg.mag,this.mass=a.mass,this.friction=a.friction,this.restitution=a.restitution,this.rd=a.rd,this.Tk=a.Tk,this.td=a.td,this.dh=a.dh,this.fluidDrag=a.fluidDrag,this.Fl=a.Fl,this.preventFallOffEdge=a.preventFallOffEdge,this.rolledBackLastTick=a.rolledBackLastTick,b.i(this.fg,a.fg),b.i(this.resting,a.resting),this.inFluid=a.inFluid,this._ratioInFluid=a._ratioInFluid,b.i(this._forces,a._forces),b.i(this._impulses,a._impulses),this._sleepFrameCount=a._sleepFrameCount}setPosition(a){t(a),b.od(a,a,this.Lg.base),this.Lg.translate(a),this.kg()}cb(){return b.clone(this.Lg.base)}applyForce(a){t(a),b.add(this._forces,this._forces,a),this.kg()}applyImpulse(a){t(a),b.add(this._impulses,this._impulses,a),this.kg()}kg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var t=a=>{};var V=p(12770),K=p(12130),C=p(12772);function F(){this.dh=.1,this.fluidDrag=.4,this.Bd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function u(a,v,p){a=Object.assign(new F,a),this.gravity=a.gravity||[0,-10,0],this.dh=a.dh||.1,this.Bd=a.Bd||2,this.fluidDrag=a.fluidDrag||.4,this.minBounceImpulse=a.minBounceImpulse,this.bodies=[],this.pk=a.pk,this.testSolid=v,this.testFluid=p}u.prototype.$k=function(a,v,p,P,b,t){a=a||new V([0,0,0],[1,1,1]),"undefined"==typeof v&&(v=1),"undefined"==typeof p&&(p=1),"undefined"==typeof P&&(P=0),"undefined"==typeof b&&(b=1);var K=new L(a,v,p,P,b,t);return this.bodies.push(K),K},u.prototype._k=function(a){var v=this.bodies.indexOf(a);v<0||(this.bodies.splice(v,1),a.Lg=a.Tk=null)};var c=K.create(),f=K.create(),H=K.create(),A=K.create(),h=K.create(),R=K.create(),X=K.create(),Q=new V([0,0,0],[1,1,1]),s=new L(Q,1,1,0,1,(()=>{}),!1);function D(a,v,p){return v=p,v*=1-(1-a.ratioInFluid)**2}u.prototype.Xd=function(a){a/=1e3;var v=O(0,K.squaredLength(this.gravity));this.bodies.forEach((p=>function(a,v,p,P){K.i(h,v.resting),a.pk&&s.loadFromCopy(v);if(v.mass<=0)return K.set(v.fg,0,0,0),K.set(v._forces,0,0,0),void K.set(v._impulses,0,0,0);var b=P||0===v.rd;if(function(a,v,p,P){if(v._sleepFrameCount>0)return!1;if(P)return!0;var b=!1,L=.5*p*p*v.rd;return K.scale(m,a.gravity,L),C(a.testSolid,v.Lg,m,(function(){return b=!0,!0}),!0),b}(a,v,p,b))return;v._sleepFrameCount--,function(a,v){var p=v.Lg,P=Math.floor(p.base[0]),b=Math.floor(p.base[2]),L=Math.floor(p.base[1]),t=Math.floor(p.max[1]);if(!a.testFluid(P,L,b))return v.inFluid=!1,void(v.ratioInFluid=0);var V=1,C=L+1;for(;C<=t&&a.testFluid(P,C,b);)V++,C++;var F=(L+V-p.base[1])/p.fh[1];F>1&&(F=1);var u=p.fh[0]*p.fh[1]*p.fh[2]*F,c=Z;K.scale(c,a.gravity,-a.Bd*u*v.rd),v.applyForce(c),v.inFluid=!0,v.ratioInFluid=F}(a,v),l(v._forces),l(v._impulses),l(v.fg),l(v.resting),K.scale(c,v._forces,1/v.mass),K.Ld(c,c,a.gravity,v.rd),K.scale(f,v._impulses,1/v.mass),K.Ld(f,f,c,p),K.add(v.fg,v.fg,f),v.friction&&(M(a,0,v,f,p),M(a,1,v,f,p),M(a,2,v,f,p));var L=v.fluidDrag>=0?v.fluidDrag:a.fluidDrag,t=v.dh>=0?v.dh:a.dh,V=t,F=t;v.inFluid&&(V=D(v,V,v.fluidDragHoriz>=0?v.fluidDragHoriz:L),F=D(v,F,v.fluidDragVert>=0?v.fluidDragVert:L));V=Math.max(1-V*p/v.mass,0),F=Math.max(1-F*p/v.mass,0),K.set(y,V,F,V),K.multiply(v.fg,v.fg,y),K.scale(H,v.fg,p),K.set(v._forces,0,0,0),K.set(v._impulses,0,0,0),v.td&&Y(q,v.Lg);K.i(R,H),K.set(X,0,0,0),v.preventFallOffEdge&&function(a,v,p,P){if(!v.resting[1]||p[1]>0)return;var b=x;Y(b,v.Lg);for(var L=0;L<3;L+=2){K.set(B,0,0,0),B[L]=p[L];var t=!0;(t=(t=(t=(t=t&&!o(a,b.base[0]+B[0]+1e-5,b.base[1],b.base[2]+B[2]+1e-5))&&!o(a,b.max[0]+B[0]-1e-5,b.base[1],b.base[2]+B[2]+1e-5))&&!o(a,b.base[0]+B[0]+1e-5,b.base[1],b.max[2]+B[2]-1e-5))&&!o(a,b.max[0]+B[0]-1e-5,b.base[1],b.max[2]+B[2]-1e-5))?(P[L]=p[L]>0?1:-1,p[L]=0):0===L&&(K.set(r,p[0],0,0),n(a,b,r,P,v.slideOnCollision))}}(a,v,H,X);n(a,v.Lg,H,v.resting,v.slideOnCollision),v.td&&function(a,v,p,P){if(v.resting[1]>=0&&!v.inFluid)return;var b=0!==v.resting[0],L=0!==v.resting[2];if(!b&&!L)return;var t=Math.abs(P[0]/P[2]),V=4;if(!b&&t>V)return;if(!L&&t<1/V)return;K.add(j,p.base,P);var F=a.testSolid;C(F,p,P,(function(a,v,p,P){if(1!==v)return!0;P[v]=0}));var u=p.base[1],c=v.inFluid?1.951:1.001,f=Math.floor(u+c)-u;K.set(w,0,f,0);var H=!1;if(C(F,p,w,(function(a,v,p,P){return H=!0,!0})),H)return;K.od(J,j,p.base),J[1]=0,n(a,p,J,T,!0);var A=O(p.base[0],j[0]),h=O(p.base[2],j[2]);if(b&&!A&&(!h||!L))return;if(L&&(!A||!b)&&!h)return;var R=!0;if(R=R&&!o(a,p.base[0]+1e-5,p.base[1],p.base[2]+1e-5),R=R&&!o(a,p.max[0]-1e-5,p.base[1],p.base[2]+1e-5),R=R&&!o(a,p.base[0]+1e-5,p.base[1],p.max[2]-1e-5),R=R&&!o(a,p.max[0]-1e-5,p.base[1],p.max[2]-1e-5),R)return;Y(v.Lg,p),v.resting[0]=T[0],v.resting[2]=T[2],v.Fl&&v.Fl()}(a,v,q,R);for(var u=0;u<3;++u)v.resting[u]=v.resting[u]||X[u],A[u]=0,v.resting[u]&&(h[u]||(A[u]=-v.fg[u]),v.fg[u]=0);var Q=K.length(A);Q>.001&&(K.scale(A,A,v.mass),v.Tk&&v.Tk(A),v.restitution>0&&Q>a.minBounceImpulse&&(K.scale(A,A,v.restitution),v.applyImpulse(A)));var S=K.squaredLength(v.fg);S>1e-5&&v.kg();a.pk&&a.pk(v)?(v.loadFromCopy(s),v.rolledBackLastTick=!0):v.rolledBackLastTick=!1}(this,p,a,v)))};var y=K.create([0,0,0]);var Z=K.create();function M(a,v,p,P,b){var L=p.resting[v],t=P[v];if(!p.alwaysApplyHorizFriction||1!==v){if(0===L)return;if(L*t<=0)return}K.i(S,p.fg),S[v]=0;var V=K.length(S);if(!O(V,0)){var C=Math.abs(p.friction*a.gravity[v]*b),F=V>C?(V-C)/V:0;p.fg[(v+1)%3]*=F,p.fg[(v+2)%3]*=F}}var S=K.create();function n(a,v,p,P,b){return K.set(P,0,0,0),C(a.testSolid,v,p,(function(a,v,p,L){P[v]=p,L[v]=0,b||(L[0]=0,L[1]=0,L[2]=0)}))}var q=new V([],[]),T=K.create(),j=K.create(),w=K.create(),J=K.create();var B=K.create(),x=new V([],[]),r=K.create();function o(a,v,p,P){return a.testSolid(Math.floor(v),Math.floor(p-1),Math.floor(P))}var m=K.create();function O(a,v){return Math.abs(a-v)<1e-5}function Y(a,v){for(var p=0;p<3;p++)a.base[p]=v.base[p],a.max[p]=v.max[p],a.fh[p]=v.fh[p]}var l=function(a){}},10792:function(a,v){!function(a){"use strict";var v=function(a,p){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,v){a.__proto__=v}||function(a,v){for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&(a[p]=v[p])},v(a,p)};function p(a,p){if("function"!==typeof p&&null!==p)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function P(){this.constructor=a}v(a,p),a.prototype=null===p?Object.create(p):(P.prototype=p.prototype,new P)}function P(a,v,p,P){var b,L=arguments.length,t=L<3?v:null===P?P=Object.getOwnPropertyDescriptor(v,p):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)t=Reflect.decorate(a,v,p,P);else for(var V=a.length-1;V>=0;V--)(b=a[V])&&(t=(L<3?b(t):L>3?b(v,p,t):b(v,p))||t);return L>3&&t&&Object.defineProperty(v,p,t),t}function b(a,v,p){if(p||2===arguments.length)for(var P,b=0,L=v.length;b<L;b++)!P&&b in v||(P||(P=Array.prototype.slice.call(v,0,b)),P[b]=v[b]);return a.concat(P||Array.prototype.slice.call(v))}var L,t=255,V=213;a.OPERATION=void 0,(L=a.OPERATION||(a.OPERATION={}))[L.ADD=128]="ADD",L[L.REPLACE=0]="REPLACE",L[L.DELETE=64]="DELETE",L[L.DELETE_AND_ADD=192]="DELETE_AND_ADD",L[L.TOUCH=1]="TOUCH",L[L.CLEAR=10]="CLEAR";var K=function(){function v(a,v,p){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=a,this.setParent(v,p)}return v.prototype.setParent=function(a,v,p){var P=this;if(this.indexes||(this.indexes=this.ref instanceof Ja?this.ref._definition.indexes:{}),this.parent=a,this.parentIndex=p,v)if(this.root=v,this.ref instanceof Ja){var b=this.ref._definition;for(var L in b.schema){var t=this.ref[L];if(t&&t.$changes){var V=b.indexes[L];t.$changes.setParent(this.ref,v,V)}}}else"object"===typeof this.ref&&this.ref.forEach((function(a,v){if(a instanceof Ja){var p=a.$changes,b=P.ref.$changes.indexes[v];p.setParent(P.ref,P.root,b)}}))},v.prototype.operation=function(a){this.changes.set(--this.currentCustomOperation,a)},v.prototype.change=function(v,p){void 0===p&&(p=a.OPERATION.ADD);var P="number"===typeof v?v:this.indexes[v];this.assertValidIndex(P,v);var b=this.changes.get(P);b&&b.op!==a.OPERATION.DELETE&&b.op!==a.OPERATION.TOUCH||this.changes.set(P,{op:b&&b.op===a.OPERATION.DELETE?a.OPERATION.DELETE_AND_ADD:p,index:P}),this.allChanges.add(P),this.changed=!0,this.touchParents()},v.prototype.touch=function(v){var p="number"===typeof v?v:this.indexes[v];this.assertValidIndex(p,v),this.changes.has(p)||this.changes.set(p,{op:a.OPERATION.TOUCH,index:p}),this.allChanges.add(p),this.touchParents()},v.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},v.prototype.getType=function(a){if(this.ref._definition)return(v=this.ref._definition).schema[v.fieldsByIndex[a]];var v,p=(v=this.parent._definition).schema[v.fieldsByIndex[this.parentIndex]];return Object.values(p)[0]},v.prototype.getChildrenFilter=function(){var a=this.parent._definition.childFilters;return a&&a[this.parentIndex]},v.prototype.getValue=function(a){return this.ref.getByIndex(a)},v.prototype.delete=function(v){var p="number"===typeof v?v:this.indexes[v];if(void 0!==p){var P=this.getValue(p);this.changes.set(p,{op:a.OPERATION.DELETE,index:p}),this.allChanges.delete(p),delete this.caches[p],P&&P.$changes&&(P.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(v," (").concat(p,")"))},v.prototype.discard=function(v,p){var P=this;void 0===v&&(v=!1),void 0===p&&(p=!1),this.ref instanceof Ja||this.changes.forEach((function(v){if(v.op===a.OPERATION.DELETE){var p=P.ref.getIndex(v.index);delete P.indexes[p]}})),this.changes.clear(),this.changed=v,p&&this.allChanges.clear(),this.currentCustomOperation=0},v.prototype.discardAll=function(){var a=this;this.changes.forEach((function(v){var p=a.getValue(v.index);p&&p.$changes&&p.$changes.discardAll()})),this.discard()},v.prototype.cache=function(a,v){this.caches[a]=v},v.prototype.clone=function(){return new v(this.ref,this.parent,this.root)},v.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},v.prototype.assertValidIndex=function(a,v){if(void 0===a)throw new Error('ChangeTree: missing index for field "'.concat(v,'"'))},v}();function C(a,v,p,P){return a[v]||(a[v]=[]),a[v].push(p),null===P||void 0===P||P.forEach((function(a,v){return p(a,v)})),function(){return u(a[v],a[v].indexOf(p))}}function F(v){var p=this,P="string"!==typeof this.$changes.getType();this.$items.forEach((function(b,L){v.push({refId:p.$changes.refId,op:a.OPERATION.DELETE,field:L,value:void 0,previousValue:b}),P&&p.$changes.root.removeRef(b.$changes.refId)}))}function u(a,v){if(-1===v||v>=a.length)return!1;for(var p=a.length-1,P=v;P<p;P++)a[P]=a[P+1];return a.length=p,!0}var c=function(a,v){var p=a.toString(),P=v.toString();return p<P?-1:p>P?1:0};function f(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,v){return"symbol"===typeof v||isNaN(v)?a[v]:a.at(v)},set:function(a,v,p){if("symbol"===typeof v||isNaN(v))a[v]=p;else{var P=Array.from(a.$items.keys()),b=parseInt(P[v]||v);void 0===p||null===p?a.deleteAt(b):a.setAt(b,p)}return!0},deleteProperty:function(a,v){return"number"===typeof v?a.deleteAt(v):delete a[v],!0}})}var H=function(){function v(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,a)}return v.prototype.Zd=function(v,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,v,p?this.$items:void 0)},v.prototype.ab=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,v)},v.is=function(a){return Array.isArray(a)||void 0!==a.array},Object.defineProperty(v.prototype,"length",{get:function(){return this.$items.size},set:function(a){0===a?this.clear():this.splice(a,this.length-a)},enumerable:!1,configurable:!0}),v.prototype.push=function(){for(var a,v=this,p=[],P=0;P<arguments.length;P++)p[P]=arguments[P];return p.forEach((function(p){a=v.$refId++,v.setAt(a,p)})),a},v.prototype.pop=function(){var a=Array.from(this.$indexes.values()).pop();if(void 0!==a){this.$changes.delete(a),this.$indexes.delete(a);var v=this.$items.get(a);return this.$items.delete(a),v}},v.prototype.at=function(a){var v=Array.from(this.$items.keys())[a];return this.$items.get(v)},v.prototype.setAt=function(v,p){var P,b;if(void 0!==p&&null!==p){if(this.$items.get(v)!==p){void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,v);var L=null!==(b=null===(P=this.$changes.indexes[v])||void 0===P?void 0:P.op)&&void 0!==b?b:a.OPERATION.ADD;this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,p),this.$changes.change(v,L)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},v.prototype.deleteAt=function(a){var v=Array.from(this.$items.keys())[a];return void 0!==v&&this.$deleteAt(v)},v.prototype.$deleteAt=function(a){return this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&F.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.concat=function(){for(var a,p=[],P=0;P<arguments.length;P++)p[P]=arguments[P];return new(v.bind.apply(v,b([void 0],(a=Array.from(this.$items.values())).concat.apply(a,p),!1)))},v.prototype.join=function(a){return Array.from(this.$items.values()).join(a)},v.prototype.reverse=function(){var a=this,v=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(p,P){a.setAt(v[P],p)})),this},v.prototype.shift=function(){var a=Array.from(this.$items.keys()).shift();if(void 0!==a){var v=this.$items.get(a);return this.$deleteAt(a),v}},v.prototype.slice=function(a,p){var P=new v;return P.push.apply(P,Array.from(this.$items.values()).slice(a,p)),P},v.prototype.sort=function(a){var v=this;void 0===a&&(a=c);var p=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(a).forEach((function(a,P){v.setAt(p[P],a)})),this},v.prototype.splice=function(a,v){void 0===v&&(v=this.length-a);for(var p=Array.from(this.$items.keys()),P=[],b=a;b<a+v;b++)P.push(this.$items.get(p[b])),this.$deleteAt(p[b]);return P},v.prototype.unshift=function(){for(var a=this,v=[],p=0;p<arguments.length;p++)v[p]=arguments[p];var P=this.length,b=v.length,L=Array.from(this.$items.values());return v.forEach((function(v,p){a.setAt(p,v)})),L.forEach((function(v,p){a.setAt(b+p,v)})),P+b},v.prototype.indexOf=function(a,v){return Array.from(this.$items.values()).indexOf(a,v)},v.prototype.lastIndexOf=function(a,v){return void 0===v&&(v=this.length-1),Array.from(this.$items.values()).lastIndexOf(a,v)},v.prototype.every=function(a,v){return Array.from(this.$items.values()).every(a,v)},v.prototype.some=function(a,v){return Array.from(this.$items.values()).some(a,v)},v.prototype.forEach=function(a,v){Array.from(this.$items.values()).forEach(a,v)},v.prototype.map=function(a,v){return Array.from(this.$items.values()).map(a,v)},v.prototype.filter=function(a,v){return Array.from(this.$items.values()).filter(a,v)},v.prototype.reduce=function(a,v){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},v.prototype.reduceRight=function(a,v){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},v.prototype.find=function(a,v){return Array.from(this.$items.values()).find(a,v)},v.prototype.findIndex=function(a,v){return Array.from(this.$items.values()).findIndex(a,v)},v.prototype.fill=function(a,v,p){throw new Error("ArraySchema#fill() not implemented")},v.prototype.copyWithin=function(a,v,p){throw new Error("ArraySchema#copyWithin() not implemented")},v.prototype.toString=function(){return this.$items.toString()},v.prototype.toLocaleString=function(){return this.$items.toLocaleString()},v.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},v.prototype.includes=function(a,v){return Array.from(this.$items.values()).includes(a,v)},v.prototype.flatMap=function(a,v){throw new Error("ArraySchema#flatMap() is not supported.")},v.prototype.flat=function(a){throw new Error("ArraySchema#flat() is not supported.")},v.prototype.findLast=function(){var a=Array.from(this.$items.values());return a.findLast.apply(a,arguments)},v.prototype.findLastIndex=function(){var a=Array.from(this.$items.values());return a.findLastIndex.apply(a,arguments)},v.prototype.setIndex=function(a,v){this.$indexes.set(a,v)},v.prototype.getIndex=function(a){return this.$indexes.get(a)},v.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},v.prototype.deleteByIndex=function(a){var v=this.$indexes.get(a);this.$items.delete(v),this.$indexes.delete(a)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){return this.toArray().map((function(a){return"function"===typeof a.toJSON?a.toJSON():a}))},v.prototype.clone=function(a){return a?new(v.bind.apply(v,b([void 0],Array.from(this.$items.values()),!1))):new(v.bind.apply(v,b([void 0],this.map((function(a){return a.$changes?a.clone():a})),!1)))},v}();function A(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,v){return"symbol"!==typeof v&&"undefined"===typeof a[v]?a.get(v):a[v]},set:function(a,v,p){return"symbol"!==typeof v&&-1===v.indexOf("$")&&"Zd"!==v&&"ab"!==v&&"onChange"!==v?a.set(v,p):a[v]=p,!0},deleteProperty:function(a,v){return a.delete(v),!0}})}var h=function(){function v(a){var p=this;if(this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a)if(a instanceof Map||a instanceof v)a.forEach((function(a,v){return p.set(v,a)}));else for(var P in a)this.set(P,a[P])}return v.prototype.Zd=function(v,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,v,p?this.$items:void 0)},v.prototype.ab=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,v)},v.is=function(a){return void 0!==a.map},v.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(v.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(v,Symbol.species,{get:function(){return v},enumerable:!1,configurable:!0}),v.prototype.set=function(v,p){if(void 0===p||null===p)throw new Error("MapSchema#set('".concat(v,"', ").concat(p,"): trying to set ").concat(p," value on '").concat(v,"'."));v=v.toString();var P="undefined"!==typeof this.$changes.indexes[v],b=P?this.$changes.indexes[v]:this.$refId++,L=P?a.OPERATION.REPLACE:a.OPERATION.ADD,t=void 0!==p.$changes;if(t&&p.$changes.setParent(this,this.$changes.root,b),P){if(!t&&this.$items.get(v)===p)return;t&&this.$items.get(v)!==p&&(L=a.OPERATION.ADD)}else this.$changes.indexes[v]=b,this.$indexes.set(b,v);return this.$items.set(v,p),this.$changes.change(v,L),this},v.prototype.get=function(a){return this.$items.get(a)},v.prototype.delete=function(a){return this.$changes.delete(a),this.$items.delete(a)},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&F.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(a){return this.$items.has(a)},v.prototype.forEach=function(a){this.$items.forEach(a)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.keys=function(){return this.$items.keys()},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(a,v){this.$indexes.set(a,v)},v.prototype.getIndex=function(a){return this.$indexes.get(a)},v.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},v.prototype.deleteByIndex=function(a){var v=this.$indexes.get(a);this.$items.delete(v),this.$indexes.delete(a)},v.prototype.toJSON=function(){var a={};return this.forEach((function(v,p){a[p]="function"===typeof v.toJSON?v.toJSON():v})),a},v.prototype.clone=function(a){var p;return a?p=Object.assign(new v,this):(p=new v,this.forEach((function(a,v){a.$changes?p.set(v,a.clone()):p.set(v,a)}))),p},v}(),R={};function X(a,v){R[a]=v}function Q(a){return R[a]}var s=function(){function a(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return a.create=function(v){var p=new a;return p.schema=Object.assign({},v&&v.schema||{}),p.indexes=Object.assign({},v&&v.indexes||{}),p.fieldsByIndex=Object.assign({},v&&v.fieldsByIndex||{}),p.descriptors=Object.assign({},v&&v.descriptors||{}),p.deprecated=Object.assign({},v&&v.deprecated||{}),p},a.prototype.addField=function(a,v){var p=this.getNextFieldIndex();this.fieldsByIndex[p]=a,this.indexes[a]=p,this.schema[a]=Array.isArray(v)?{array:v[0]}:v},a.prototype.hasField=function(a){return void 0!==this.indexes[a]},a.prototype.addFilter=function(a,v){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[a]]=v,this.indexesWithFilters.push(this.indexes[a]),!0},a.prototype.addChildrenFilter=function(a,v){var p=this.indexes[a],P=this.schema[a];if(Q(Object.keys(P)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[p]=v,!0;console.warn("@filterChildren: field '".concat(a,"' can't have children. Ignoring filter."))},a.prototype.getChildrenFilter=function(a){return this.childFilters&&this.childFilters[this.indexes[a]]},a.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},a}();function D(a){return a._context&&a._context.useFilters}var y=function(){function a(){this.types={},this.schemas=new Map,this.useFilters=!1}return a.prototype.has=function(a){return this.schemas.has(a)},a.prototype.get=function(a){return this.types[a]},a.prototype.add=function(a,v){void 0===v&&(v=this.schemas.size),a._definition=s.create(a._definition),a._typeid=v,this.types[v]=a,this.schemas.set(a,v)},a.create=function(v){return void 0===v&&(v={}),function(p){return v.context||(v.context=new a),M(p,v)}},a}(),Z=new y;function M(a,v){return void 0===v&&(v={}),function(p,P){var L=v.context||Z,t=p.constructor;if(t._context=L,!a)throw new Error("".concat(t.name,': @type() reference provided for "').concat(P,"\" is undefined. Make sure you don't have any circular dependencies."));L.has(t)||L.add(t);var V=t._definition;if(V.addField(P,a),V.descriptors[P]){if(V.deprecated[P])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(P,"' definition on '").concat(t.name,"'.\nCheck @type() annotation"))}catch(R){var K=R.stack.split("\n")[4].trim();throw new Error("".concat(R.message," ").concat(K))}}var C=H.is(a),F=!C&&h.is(a);if("string"!==typeof a&&!Ja.is(a)){var u=Object.values(a)[0];"string"===typeof u||L.has(u)||L.add(u)}if(v.manual)V.descriptors[P]={enumerable:!0,configurable:!0,writable:!0};else{var c="_".concat(P);V.descriptors[c]={enumerable:!1,configurable:!1,writable:!0},V.descriptors[P]={get:function(){return this[c]},set:function(a){a!==this[c]&&(void 0!==a&&null!==a?(!C||a instanceof H||(a=new(H.bind.apply(H,b([void 0],a,!1)))),!F||a instanceof h||(a=new h(a)),void 0===a.$proxy&&(F?a=A(a):C&&(a=f(a))),this.$changes.change(P),a.$changes&&a.$changes.setParent(this,this.$changes.root,this._definition.indexes[P])):this[c]&&this.$changes.delete(P),this[c]=a)},enumerable:!0,configurable:!0}}}}function S(a){return function(v,p){var P=v.constructor;P._definition.addFilter(p,a)&&(P._context.useFilters=!0)}}function n(a){return function(v,p){var P=v.constructor;P._definition.addChildrenFilter(p,a)&&(P._context.useFilters=!0)}}function q(a){return void 0===a&&(a=!0),function(v,p){var P=v.constructor._definition;P.deprecated[p]=!0,a&&(P.descriptors[p]={get:function(){throw new Error("".concat(p," is deprecated."))},set:function(a){},enumerable:!1,configurable:!0})}}function T(a,v,p){for(var P in void 0===p&&(p={}),p.context||(p.context=a._context||p.context||Z),v)M(v[P],p)(a.prototype,P);return a}function j(a){for(var v=0,p=0,P=0,b=a.length;P<b;P++)(v=a.charCodeAt(P))<128?p+=1:v<2048?p+=2:v<55296||v>=57344?p+=3:(P++,p+=4);return p}function w(a,v,p){for(var P=0,b=0,L=p.length;b<L;b++)(P=p.charCodeAt(b))<128?a[v++]=P:P<2048?(a[v++]=192|P>>6,a[v++]=128|63&P):P<55296||P>=57344?(a[v++]=224|P>>12,a[v++]=128|P>>6&63,a[v++]=128|63&P):(b++,P=65536+((1023&P)<<10|1023&p.charCodeAt(b)),a[v++]=240|P>>18,a[v++]=128|P>>12&63,a[v++]=128|P>>6&63,a[v++]=128|63&P)}function J(a,v){a.push(255&v)}function B(a,v){a.push(255&v)}function x(a,v){a.push(255&v),a.push(v>>8&255)}function r(a,v){a.push(255&v),a.push(v>>8&255)}function o(a,v){a.push(255&v),a.push(v>>8&255),a.push(v>>16&255),a.push(v>>24&255)}function m(a,v){var p=v>>24,P=v>>16,b=v>>8,L=v;a.push(255&L),a.push(255&b),a.push(255&P),a.push(255&p)}function O(a,v){var p=Math.floor(v/Math.pow(2,32));m(a,v>>>0),m(a,p)}function Y(a,v){var p=v/Math.pow(2,32)|0;m(a,v>>>0),m(a,p)}function l(a,v){k(a,v)}function z(a,v){d(a,v)}var g=new Int32Array(2),G=new Float32Array(g.buffer),e=new Float64Array(g.buffer);function k(a,v){G[0]=v,o(a,g[0])}function d(a,v){e[0]=v,o(a,g[0]),o(a,g[1])}function E(a,v){return B(a,v?1:0)}function W(a,v){v||(v="");var p=j(v),P=0;if(p<32)a.push(160|p),P=1;else if(p<256)a.push(217),B(a,p),P=2;else if(p<65536)a.push(218),r(a,p),P=3;else{if(!(p<4294967296))throw new Error("String too long");a.push(219),m(a,p),P=5}return w(a,a.length,v),P+p}function U(a,v){return isNaN(v)?U(a,0):isFinite(v)?v!==(0|v)?(a.push(203),d(a,v),9):v>=0?v<128?(B(a,v),1):v<256?(a.push(204),B(a,v),2):v<65536?(a.push(205),r(a,v),3):v<4294967296?(a.push(206),m(a,v),5):(a.push(207),Y(a,v),9):v>=-32?(a.push(224|v+32),1):v>=-128?(a.push(208),J(a,v),2):v>=-32768?(a.push(209),x(a,v),3):v>=-2147483648?(a.push(210),o(a,v),5):(a.push(211),O(a,v),9):U(a,v>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var N=Object.freeze({__proto__:null,utf8Write:w,int8:J,uint8:B,int16:x,uint16:r,int32:o,uint32:m,int64:O,uint64:Y,float32:l,float64:z,writeFloat32:k,writeFloat64:d,boolean:E,string:W,number:U});function i(a,v,p){for(var P="",b=0,L=v,t=v+p;L<t;L++){var V=a[L];0!==(128&V)?192!==(224&V)?224!==(240&V)?240!==(248&V)?console.error("Invalid byte "+V.toString(16)):(b=(7&V)<<18|(63&a[++L])<<12|(63&a[++L])<<6|63&a[++L])>=65536?(b-=65536,P+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):P+=String.fromCharCode(b):P+=String.fromCharCode((15&V)<<12|(63&a[++L])<<6|63&a[++L]):P+=String.fromCharCode((31&V)<<6|63&a[++L]):P+=String.fromCharCode(V)}return P}function I(a,v){return aa(a,v)<<24>>24}function aa(a,v){return a[v.offset++]}function va(a,v){return pa(a,v)<<16>>16}function pa(a,v){return a[v.offset++]|a[v.offset++]<<8}function Pa(a,v){return a[v.offset++]|a[v.offset++]<<8|a[v.offset++]<<16|a[v.offset++]<<24}function ba(a,v){return Pa(a,v)>>>0}function La(a,v){return ca(a,v)}function ta(a,v){return fa(a,v)}function Va(a,v){var p=ba(a,v);return Pa(a,v)*Math.pow(2,32)+p}function Ka(a,v){var p=ba(a,v);return ba(a,v)*Math.pow(2,32)+p}var Ca=new Int32Array(2),Fa=new Float32Array(Ca.buffer),ua=new Float64Array(Ca.buffer);function ca(a,v){return Ca[0]=Pa(a,v),Fa[0]}function fa(a,v){return Ca[0]=Pa(a,v),Ca[1]=Pa(a,v),ua[0]}function Ha(a,v){return aa(a,v)>0}function Aa(a,v){var p,P=a[v.offset++];P<192?p=31&P:217===P?p=aa(a,v):218===P?p=pa(a,v):219===P&&(p=ba(a,v));var b=i(a,v.offset,p);return v.offset+=p,b}function ha(a,v){var p=a[v.offset];return p<192&&p>160||217===p||218===p||219===p}function Ra(a,v){var p=a[v.offset++];return p<128?p:202===p?ca(a,v):203===p?fa(a,v):204===p?aa(a,v):205===p?pa(a,v):206===p?ba(a,v):207===p?Ka(a,v):208===p?I(a,v):209===p?va(a,v):210===p?Pa(a,v):211===p?Va(a,v):p>223?-1*(255-p+1):void 0}function Xa(a,v){var p=a[v.offset];return p<128||p>=202&&p<=211}function Qa(a,v){return a[v.offset]<160}function sa(a,v){return a[v.offset-1]===t&&(a[v.offset]<128||a[v.offset]>=202&&a[v.offset]<=211)}var Da=Object.freeze({__proto__:null,int8:I,uint8:aa,int16:va,uint16:pa,int32:Pa,uint32:ba,float32:La,float64:ta,int64:Va,uint64:Ka,readFloat32:ca,readFloat64:fa,boolean:Ha,string:Aa,stringCheck:ha,number:Ra,numberCheck:Xa,arrayCheck:Qa,switchStructureCheck:sa}),ya=function(){function v(a){var v=this;this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return v.add(a)}))}return v.prototype.Zd=function(v,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,v,p?this.$items:void 0)},v.prototype.ab=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,v)},v.is=function(a){return void 0!==a.collection},v.prototype.add=function(a){var v=this.$refId++;return void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,v),this.$changes.indexes[v]=v,this.$indexes.set(v,v),this.$items.set(v,a),this.$changes.change(v),v},v.prototype.at=function(a){var v=Array.from(this.$items.keys())[a];return this.$items.get(v)},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(a){for(var v,p,P=this.$items.entries();(p=P.next())&&!p.done;)if(a===p.value[1]){v=p.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&F.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(a){return Array.from(this.$items.values()).some((function(v){return v===a}))},v.prototype.forEach=function(a){var v=this;this.$items.forEach((function(p,P,b){return a(p,P,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(a,v){this.$indexes.set(a,v)},v.prototype.getIndex=function(a){return this.$indexes.get(a)},v.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},v.prototype.deleteByIndex=function(a){var v=this.$indexes.get(a);this.$items.delete(v),this.$indexes.delete(a)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var a=[];return this.forEach((function(v,p){a.push("function"===typeof v.toJSON?v.toJSON():v)})),a},v.prototype.clone=function(a){var p;return a?p=Object.assign(new v,this):(p=new v,this.forEach((function(a){a.$changes?p.add(a.clone()):p.add(a)}))),p},v}(),Za=function(){function v(a){var v=this;this.$changes=new K(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return v.add(a)}))}return v.prototype.Zd=function(v,p){return void 0===p&&(p=!0),C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,v,p?this.$items:void 0)},v.prototype.ab=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,v)},v.prototype.onChange=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,v)},v.is=function(a){return void 0!==a.set},v.prototype.add=function(v){var p,P;if(this.has(v))return!1;var b=this.$refId++;void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,b);var L=null!==(P=null===(p=this.$changes.indexes[b])||void 0===p?void 0:p.op)&&void 0!==P?P:a.OPERATION.ADD;return this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,v),this.$changes.change(b,L),b},v.prototype.entries=function(){return this.$items.entries()},v.prototype.delete=function(a){for(var v,p,P=this.$items.entries();(p=P.next())&&!p.done;)if(a===p.value[1]){v=p.value[0];break}return void 0!==v&&(this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v))},v.prototype.clear=function(v){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),v&&F.call(this,v),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},v.prototype.has=function(a){for(var v,p=this.$items.values(),P=!1;(v=p.next())&&!v.done;)if(a===v.value){P=!0;break}return P},v.prototype.forEach=function(a){var v=this;this.$items.forEach((function(p,P,b){return a(p,P,v)}))},v.prototype.values=function(){return this.$items.values()},Object.defineProperty(v.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),v.prototype.setIndex=function(a,v){this.$indexes.set(a,v)},v.prototype.getIndex=function(a){return this.$indexes.get(a)},v.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},v.prototype.deleteByIndex=function(a){var v=this.$indexes.get(a);this.$items.delete(v),this.$indexes.delete(a)},v.prototype.toArray=function(){return Array.from(this.$items.values())},v.prototype.toJSON=function(){var a=[];return this.forEach((function(v,p){a.push("function"===typeof v.toJSON?v.toJSON():v)})),a},v.prototype.clone=function(a){var p;return a?p=Object.assign(new v,this):(p=new v,this.forEach((function(a){a.$changes?p.add(a.clone()):p.add(a)}))),p},v}(),Ma=function(){function a(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return a.prototype.addRefId=function(a){this.refIds.has(a)||(this.refIds.add(a),this.containerIndexes.set(a,new Set))},a.get=function(v){return void 0===v.$filterState&&(v.$filterState=new a),v.$filterState},a}(),Sa=function(){function a(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return a.prototype.getNextUniqueId=function(){return this.nextUniqueId++},a.prototype.addRef=function(a,v,p){void 0===p&&(p=!0),this.refs.set(a,v),p&&(this.refCounts[a]=(this.refCounts[a]||0)+1)},a.prototype.removeRef=function(a){this.refCounts[a]=this.refCounts[a]-1,this.deletedRefs.add(a)},a.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},a.prototype.garbageCollectDeletedRefs=function(){var a=this;this.deletedRefs.forEach((function(v){if(!(a.refCounts[v]>0)){var p=a.refs.get(v);if(p instanceof Ja)for(var P in p._definition.schema)"string"!==typeof p._definition.schema[P]&&p[P]&&p[P].$changes&&a.removeRef(p[P].$changes.refId);else{var b=p.$changes.parent._definition,L=b.schema[b.fieldsByIndex[p.$changes.parentIndex]];"function"===typeof Object.values(L)[0]&&Array.from(p.values()).forEach((function(v){return a.removeRef(v.$changes.refId)}))}a.refs.delete(v),delete a.refCounts[v]}})),this.deletedRefs.clear()},a}(),na=function(a){function v(){return null!==a&&a.apply(this,arguments)||this}return p(v,a),v}(Error);function qa(a,v,p,P){var b,L=!1;switch(v){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":b="number",isNaN(a)&&console.log('trying to encode "NaN" in '.concat(p.constructor.name,"#").concat(P));break;case"string":b="string",L=!0;break;case"boolean":return}if(typeof a!==b&&(!L||L&&null!==a)){var t="'".concat(JSON.stringify(a),"'").concat(a&&a.constructor&&" (".concat(a.constructor.name,")")||"");throw new na("a '".concat(b,"' was expected, but ").concat(t," was provided in ").concat(p.constructor.name,"#").concat(P))}}function Ta(a,v,p,P){if(!(a instanceof v))throw new na("a '".concat(v.name,"' was expected, but '").concat(a.constructor.name,"' was provided in ").concat(p.constructor.name,"#").concat(P))}function ja(a,v,p,P,b){qa(p,a,P,b);var L=N[a];if(!L)throw new na("a '".concat(a,"' was expected, but ").concat(p," was provided in ").concat(P.constructor.name,"#").concat(b));L(v,p)}function wa(a,v,p){return Da[a](v,p)}var Ja=function(){function v(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];Object.defineProperties(this,{$changes:{value:new K(this,void 0,new Sa),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var p=this._definition.descriptors;p&&Object.defineProperties(this,p),a[0]&&this.assign(a[0])}return v.onError=function(a){console.error(a)},v.is=function(a){return a._definition&&void 0!==a._definition.schema},v.prototype.onChange=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,v)},v.prototype.ab=function(v){return C(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,v)},v.prototype.assign=function(a){return Object.assign(this,a),this},Object.defineProperty(v.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),v.prototype.setDirty=function(a,v){this.$changes.change(a,v)},v.prototype.listen=function(a,v,p){var P=this;return void 0===p&&(p=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[a]||(this.$callbacks[a]=[]),this.$callbacks[a].push(v),p&&void 0!==this[a]&&v(this[a],void 0),function(){return u(P.$callbacks[a],P.$callbacks[a].indexOf(v))}},v.prototype.decode=function(p,P,b){var L;void 0===P&&(P={offset:0}),void 0===b&&(b=this);var V=[],K=this.$changes.root,C=p.length,F=0;for(K.refs.set(F,this);P.offset<C;){var u=p[P.offset++];if(u!=t){var c=b.$changes,f=void 0!==b._definition,A=f?u>>6<<6:u;if(A!==a.OPERATION.CLEAR){var R=f?u%(A||255):Ra(p,P),X=f?b._definition.fieldsByIndex[R]:"",s=c.getType(R),D=void 0,y=void 0,Z=void 0;if(f?y=b["_".concat(X)]:(y=b.getByIndex(R),(A&a.OPERATION.ADD)===a.OPERATION.ADD?(Z=b instanceof h?Aa(p,P):R,b.setIndex(R,Z)):Z=b.getIndex(R)),(A&a.OPERATION.DELETE)===a.OPERATION.DELETE&&(A!==a.OPERATION.DELETE_AND_ADD&&b.deleteByIndex(R),y&&y.$changes&&K.removeRef(y.$changes.refId),D=null),void 0!==X){if(A===a.OPERATION.DELETE);else if(v.is(s)){var M=Ra(p,P);if(D=K.refs.get(M),A!==a.OPERATION.REPLACE){var S=this.getSchemaType(p,P,s);D||((D=this.createTypeInstance(S)).$changes.refId=M,y&&(D.$callbacks=y.$callbacks,y.$changes.refId&&M!==y.$changes.refId&&K.removeRef(y.$changes.refId))),K.addRef(M,D,D!==y)}}else if("string"===typeof s)D=wa(s,p,P);else{var n=Q(Object.keys(s)[0]),q=Ra(p,P),T=K.refs.has(q)?y||K.refs.get(q):new n.constructor;if((D=T.clone(!0)).$changes.refId=q,y&&(D.$callbacks=y.$callbacks,y.$changes.refId&&q!==y.$changes.refId)){K.removeRef(y.$changes.refId);for(var j=y.entries(),w=void 0;(w=j.next())&&!w.done;){var J=(L=w.value)[0],B=L[1];V.push({refId:q,op:a.OPERATION.DELETE,field:J,value:void 0,previousValue:B})}}K.addRef(q,D,T!==y)}if(null!==D&&void 0!==D)if(D.$changes&&D.$changes.setParent(c.ref,c.root,R),b instanceof v)b[X]=D;else if(b instanceof h)J=Z,b.$items.set(J,D),b.$changes.allChanges.add(R);else if(b instanceof H)b.setAt(R,D);else if(b instanceof ya){var x=b.add(D);b.setIndex(R,x)}else b instanceof Za&&!1!==(x=b.add(D))&&b.setIndex(R,x);y!==D&&V.push({refId:F,op:A,field:X,dynamicIndex:Z,value:D,previousValue:y})}else{console.warn("@colyseus/schema: definition mismatch");for(var r={offset:P.offset};P.offset<C&&(!sa(p,P)||(r.offset=P.offset+1,!K.refs.has(Ra(p,r))));)P.offset++}}else b.clear(V)}else{F=Ra(p,P);var o=K.refs.get(F);if(!o)throw new Error('"refId" not found: '.concat(F));b=o}}return this._triggerChanges(V),K.garbageCollectDeletedRefs(),V},v.prototype.encode=function(p,P,b){void 0===p&&(p=!1),void 0===P&&(P=[]),void 0===b&&(b=!1);for(var L=this.$changes,V=new WeakSet,K=[L],C=1,F=0;F<C;F++){var u=K[F],c=u.ref,f=c instanceof v;u.ensureRefId(),V.add(u),u!==L&&(u.changed||p)&&(B(P,t),U(P,u.refId));for(var H=p?Array.from(u.allChanges):Array.from(u.changes.values()),A=0,R=H.length;A<R;A++){var X=p?{op:a.OPERATION.ADD,index:H[A]}:H[A],s=X.index,D=f?c._definition.fieldsByIndex&&c._definition.fieldsByIndex[s]:s,y=P.length;if(X.op!==a.OPERATION.TOUCH)if(f)B(P,s|X.op);else{if(B(P,X.op),X.op===a.OPERATION.CLEAR)continue;U(P,s)}if(f||(X.op&a.OPERATION.ADD)!=a.OPERATION.ADD||c instanceof h&&W(P,u.ref.$indexes.get(s)),X.op!==a.OPERATION.DELETE){var Z=u.getType(s),M=u.getValue(s);if(M&&M.$changes&&!V.has(M.$changes)&&(K.push(M.$changes),M.$changes.ensureRefId(),C++),X.op!==a.OPERATION.TOUCH){if(v.is(Z))Ta(M,Z,c,D),U(P,M.$changes.refId),(X.op&a.OPERATION.ADD)===a.OPERATION.ADD&&this.tryEncodeTypeId(P,Z,M.constructor);else if("string"===typeof Z)ja(Z,P,M,c,D);else{var S=Q(Object.keys(Z)[0]);Ta(c["_".concat(D)],S.constructor,c,D),U(P,M.$changes.refId)}b&&u.cache(s,P.slice(y))}}}p||b||u.discard()}return P},v.prototype.encodeAll=function(a){return this.encode(!0,[],a)},v.prototype.applyFilters=function(p,P){var b,L;void 0===P&&(P=!1);for(var V=this,K=new Set,C=Ma.get(p),F=[this.$changes],u=1,c=[],f=function(f){var H=F[f];if(K.has(H.refId))return"continue";var A=H.ref,R=A instanceof v;B(c,t),U(c,H.refId);var X=C.refIds.has(H),Q=P||!X;C.addRefId(H);var s=C.containerIndexes.get(H),D=Q?Array.from(H.allChanges):Array.from(H.changes.values());!P&&R&&A._definition.indexesWithFilters&&A._definition.indexesWithFilters.forEach((function(v){!s.has(v)&&H.allChanges.has(v)&&(Q?D.push(v):D.push({op:a.OPERATION.ADD,index:v}))}));for(var y=0,Z=D.length;y<Z;y++){var M=Q?{op:a.OPERATION.ADD,index:D[y]}:D[y];if(M.op!==a.OPERATION.CLEAR){var S=M.index;if(M.op!==a.OPERATION.DELETE){var n=H.getValue(S),q=H.getType(S);if(R){if((T=A._definition.filters&&A._definition.filters[S])&&!T.call(A,p,n,V)){n&&n.$changes&&K.add(n.$changes.refId);continue}}else{var T,j=H.parent;if((T=H.getChildrenFilter())&&!T.call(j,p,A.$indexes.get(S),n,V)){n&&n.$changes&&K.add(n.$changes.refId);continue}}if(n.$changes&&(F.push(n.$changes),u++),M.op!==a.OPERATION.TOUCH)if(M.op===a.OPERATION.ADD||R)c.push.apply(c,null!==(b=H.caches[S])&&void 0!==b?b:[]),s.add(S);else if(s.has(S))c.push.apply(c,null!==(L=H.caches[S])&&void 0!==L?L:[]);else{if(s.add(S),B(c,a.OPERATION.ADD),U(c,S),A instanceof h){var w=H.ref.$indexes.get(S);W(c,w)}n.$changes?U(c,n.$changes.refId):N[q](c,n)}else n.$changes&&!R&&(B(c,a.OPERATION.ADD),U(c,S),A instanceof h&&(w=H.ref.$indexes.get(S),W(c,w)),U(c,n.$changes.refId))}else R?B(c,M.op|S):(B(c,M.op),U(c,S))}else B(c,M.op)}},H=0;H<u;H++)f(H);return c},v.prototype.clone=function(){var a,v=new this.constructor,p=this._definition.schema;for(var P in p)"object"===typeof this[P]&&"function"===typeof(null===(a=this[P])||void 0===a?void 0:a.clone)?v[P]=this[P].clone():v[P]=this[P];return v},v.prototype.toJSON=function(){var a=this._definition.schema,v=this._definition.deprecated,p={};for(var P in a)v[P]||null===this[P]||"undefined"===typeof this[P]||(p[P]="function"===typeof this[P].toJSON?this[P].toJSON():this["_".concat(P)]);return p},v.prototype.discardAllChanges=function(){this.$changes.discardAll()},v.prototype.getByIndex=function(a){return this[this._definition.fieldsByIndex[a]]},v.prototype.deleteByIndex=function(a){this[this._definition.fieldsByIndex[a]]=void 0},v.prototype.tryEncodeTypeId=function(a,v,p){v._typeid!==p._typeid&&(B(a,V),U(a,p._typeid))},v.prototype.getSchemaType=function(a,v,p){var P;return a[v.offset]===V&&(v.offset++,P=this.constructor._context.get(Ra(a,v))),P||p},v.prototype.createTypeInstance=function(a){var v=new a;return v.$changes.root=this.$changes.root,v},v.prototype._triggerChanges=function(p){for(var P,b,L,t,V,K,C,F,u,c=new Set,f=this.$changes.root.refs,H=function(H){var A=p[H],h=A.refId,R=f.get(h),X=R.$callbacks;if((A.op&a.OPERATION.DELETE)===a.OPERATION.DELETE&&A.previousValue instanceof v&&(null===(b=null===(P=A.previousValue.$callbacks)||void 0===P?void 0:P[a.OPERATION.DELETE])||void 0===b||b.forEach((function(a){return a()}))),!X)return"continue";if(R instanceof v){if(!c.has(h))try{null===(L=null===X||void 0===X?void 0:X[a.OPERATION.REPLACE])||void 0===L||L.forEach((function(a){return a()}))}catch(Q){v.onError(Q)}try{X.hasOwnProperty(A.field)&&(null===(t=X[A.field])||void 0===t||t.forEach((function(a){return a(A.value,A.previousValue)})))}catch(Q){v.onError(Q)}}else A.op===a.OPERATION.ADD&&void 0===A.previousValue?null===(V=X[a.OPERATION.ADD])||void 0===V||V.forEach((function(a){var v;return a(A.value,null!==(v=A.dynamicIndex)&&void 0!==v?v:A.field)})):A.op===a.OPERATION.DELETE?void 0!==A.previousValue&&(null===(K=X[a.OPERATION.DELETE])||void 0===K||K.forEach((function(a){var v;return a(A.previousValue,null!==(v=A.dynamicIndex)&&void 0!==v?v:A.field)}))):A.op===a.OPERATION.DELETE_AND_ADD&&(void 0!==A.previousValue&&(null===(C=X[a.OPERATION.DELETE])||void 0===C||C.forEach((function(a){var v;return a(A.previousValue,null!==(v=A.dynamicIndex)&&void 0!==v?v:A.field)}))),null===(F=X[a.OPERATION.ADD])||void 0===F||F.forEach((function(a){var v;return a(A.value,null!==(v=A.dynamicIndex)&&void 0!==v?v:A.field)}))),A.value!==A.previousValue&&(null===(u=X[a.OPERATION.REPLACE])||void 0===u||u.forEach((function(a){var v;return a(A.value,null!==(v=A.dynamicIndex)&&void 0!==v?v:A.field)})));c.add(h)},A=0;A<p.length;A++)H(A)},v._definition=s.create(),v}();function Ba(a){for(var v=[a.$changes],p=1,P={},b=P,L=function(a){var p=v[a];p.changes.forEach((function(a){var v=p.ref,P=a.index,L=v._definition?v._definition.fieldsByIndex[P]:v.$indexes.get(P);b[L]=p.getValue(P)}))},t=0;t<p;t++)L(t);return P}var xa={context:new y},ra=function(a){function v(){return null!==a&&a.apply(this,arguments)||this}return p(v,a),P([M("string",xa)],v.prototype,"name",void 0),P([M("string",xa)],v.prototype,"type",void 0),P([M("number",xa)],v.prototype,"referencedType",void 0),v}(Ja),oa=function(a){function v(){var v=null!==a&&a.apply(this,arguments)||this;return v.fields=new H,v}return p(v,a),P([M("number",xa)],v.prototype,"id",void 0),P([M([ra],xa)],v.prototype,"fields",void 0),v}(Ja),ma=function(a){function v(){var v=null!==a&&a.apply(this,arguments)||this;return v.types=new H,v}return p(v,a),v.encode=function(a){var p=a.constructor,P=new v;P.rootType=p._typeid;var b=function(a,v){for(var p in v){var b=new ra;b.name=p;var L=void 0;if("string"===typeof v[p])L=v[p];else{var t=v[p],V=void 0;Ja.is(t)?(L="ref",V=v[p]):"string"===typeof t[L=Object.keys(t)[0]]?L+=":"+t[L]:V=t[L],b.referencedType=V?V._typeid:-1}b.type=L,a.fields.push(b)}P.types.push(a)},L=p._context.types;for(var t in L){var V=new oa;V.id=Number(t),b(V,L[t]._definition.schema)}return P.encodeAll()},v.decode=function(a,P){var b=new y,L=new v;L.decode(a,P);var t=L.types.reduce((function(a,v){var P=function(a){function v(){return null!==a&&a.apply(this,arguments)||this}return p(v,a),v}(Ja),L=v.id;return a[L]=P,b.add(P,L),a}),{});L.types.forEach((function(a){var v=t[a.id];a.fields.forEach((function(a){var p;if(void 0!==a.referencedType){var P=a.type,L=t[a.referencedType];if(!L){var V=a.type.split(":");P=V[0],L=V[1]}"ref"===P?M(L,{context:b})(v.prototype,a.name):M(((p={})[P]=L,p),{context:b})(v.prototype,a.name)}else M(a.type,{context:b})(v.prototype,a.name)}))}));var V=t[L.rootType],K=new V;for(var C in V._definition.schema){var F=V._definition.schema[C];"string"!==typeof F&&(K[C]="function"===typeof F?new F:new(Q(Object.keys(F)[0]).constructor))}return K},P([M([oa],xa)],v.prototype,"types",void 0),P([M("number",xa)],v.prototype,"rootType",void 0),v}(Ja);X("map",{constructor:h}),X("array",{constructor:H}),X("set",{constructor:Za}),X("collection",{constructor:ya}),a.ArraySchema=H,a.CollectionSchema=ya,a.Context=y,a.MapSchema=h,a.Reflection=ma,a.ReflectionField=ra,a.ReflectionType=oa,a.Schema=Ja,a.SchemaDefinition=s,a.SetSchema=Za,a.decode=Da,a.defineTypes=T,a.deprecated=q,a.dumpChanges=Ba,a.encode=N,a.filter=S,a.filterChildren=n,a.hasFilter=D,a.registerType=X,a.type=M,Object.defineProperty(a,"__esModule",{value:!0})}(v)},12816:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12813:(a,v,p)=>{var P=p(12816),b=p(12819),L=Object.hasOwnProperty,t=Object.create(null);for(var V in P)L.call(P,V)&&(t[P[V]]=V);var K=a.exports={to:{},get:{}};function C(a,v,p){return Math.min(Math.max(v,a),p)}function F(a){var v=Math.round(a).toString(16).toUpperCase();return v.length<2?"0"+v:v}K.get=function(a){var v,p;switch(a.substring(0,3).toLowerCase()){case"hsl":v=K.get.hsl(a),p="hsl";break;case"hwb":v=K.get.hwb(a),p="hwb";break;default:v=K.get.rgb(a),p="rgb"}return v?{model:p,value:v}:null},K.get.rgb=function(a){if(!a)return null;var v,p,b,t=[0,0,0,1];if(v=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(b=v[2],v=v[1],p=0;p<3;p++){var V=2*p;t[p]=parseInt(v.slice(V,V+2),16)}b&&(t[3]=parseInt(b,16)/255)}else if(v=a.match(/^#([a-f0-9]{3,4})$/i)){for(b=(v=v[1])[3],p=0;p<3;p++)t[p]=parseInt(v[p]+v[p],16);b&&(t[3]=parseInt(b+b,16)/255)}else if(v=a.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(p=0;p<3;p++)t[p]=parseInt(v[p+1],0);v[4]&&(v[5]?t[3]=.01*parseFloat(v[4]):t[3]=parseFloat(v[4]))}else{if(!(v=a.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(v=a.match(/^(\w+)$/))?"transparent"===v[1]?[0,0,0,0]:L.call(P,v[1])?((t=P[v[1]])[3]=1,t):null:null;for(p=0;p<3;p++)t[p]=Math.round(2.55*parseFloat(v[p+1]));v[4]&&(v[5]?t[3]=.01*parseFloat(v[4]):t[3]=parseFloat(v[4]))}for(p=0;p<3;p++)t[p]=C(t[p],0,255);return t[3]=C(t[3],0,1),t},K.get.hsl=function(a){if(!a)return null;var v=a.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var p=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,C(parseFloat(v[2]),0,100),C(parseFloat(v[3]),0,100),C(isNaN(p)?1:p,0,1)]}return null},K.get.hwb=function(a){if(!a)return null;var v=a.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(v){var p=parseFloat(v[4]);return[(parseFloat(v[1])%360+360)%360,C(parseFloat(v[2]),0,100),C(parseFloat(v[3]),0,100),C(isNaN(p)?1:p,0,1)]}return null},K.to.hex=function(){var a=b(arguments);return"#"+F(a[0])+F(a[1])+F(a[2])+(a[3]<1?F(Math.round(255*a[3])):"")},K.to.rgb=function(){var a=b(arguments);return a.length<4||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"},K.to.rgb.percent=function(){var a=b(arguments),v=Math.round(a[0]/255*100),p=Math.round(a[1]/255*100),P=Math.round(a[2]/255*100);return a.length<4||1===a[3]?"rgb("+v+"%, "+p+"%, "+P+"%)":"rgba("+v+"%, "+p+"%, "+P+"%, "+a[3]+")"},K.to.hsl=function(){var a=b(arguments);return a.length<4||1===a[3]?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"},K.to.hwb=function(){var a=b(arguments),v="";return a.length>=4&&1!==a[3]&&(v=", "+a[3]),"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+v+")"},K.to.keyword=function(a){return t[a.slice(0,3)]}},12807:(a,v,p)=>{const P=p(12813),b=p(12829),L=["keyword","gray","hex"],t={};for(const f of Object.keys(b))t[[...b[f].labels].sort().join("")]=f;const V={};function K(a,v){if(!(this instanceof K))return new K(a,v);if(v&&v in L&&(v=null),v&&!(v in b))throw new Error("Unknown model: "+v);let p,C;if(null==a)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(a instanceof K)this.model=a.model,this.color=[...a.color],this.valpha=a.valpha;else if("string"===typeof a){const v=P.get(a);if(null===v)throw new Error("Unable to parse color from string: "+a);this.model=v.model,C=b[this.model].channels,this.color=v.value.slice(0,C),this.valpha="number"===typeof v.value[C]?v.value[C]:1}else if(a.length>0){this.model=v||"rgb",C=b[this.model].channels;const p=Array.prototype.slice.call(a,0,C);this.color=c(p,C),this.valpha="number"===typeof a[C]?a[C]:1}else if("number"===typeof a)this.model="rgb",this.color=[a>>16&255,a>>8&255,255&a],this.valpha=1;else{this.valpha=1;const v=Object.keys(a);"alpha"in a&&(v.splice(v.indexOf("alpha"),1),this.valpha="number"===typeof a.alpha?a.alpha:0);const P=v.sort().join("");if(!(P in t))throw new Error("Unable to parse color from object: "+JSON.stringify(a));this.model=t[P];const{labels:L}=b[this.model],V=[];for(p=0;p<L.length;p++)V.push(a[L[p]]);this.color=c(V)}if(V[this.model])for(C=b[this.model].channels,p=0;p<C;p++){const a=V[this.model][p];a&&(this.color[p]=a(this.color[p]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}K.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(a){let v=this.model in P.to?this:this.rgb();v=v.round("number"===typeof a?a:1);const p=1===v.valpha?v.color:[...v.color,this.valpha];return P.to[v.model](p)},percentString(a){const v=this.rgb().round("number"===typeof a?a:1),p=1===v.valpha?v.color:[...v.color,this.valpha];return P.to.rgb.percent(p)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const a={},{channels:v}=b[this.model],{labels:p}=b[this.model];for(let P=0;P<v;P++)a[p[P]]=this.color[P];return 1!==this.valpha&&(a.alpha=this.valpha),a},unitArray(){const a=this.rgb().color;return a[0]/=255,a[1]/=255,a[2]/=255,1!==this.valpha&&a.push(this.valpha),a},unitObject(){const a=this.rgb().object();return a.r/=255,a.g/=255,a.b/=255,1!==this.valpha&&(a.alpha=this.valpha),a},round(a){return a=Math.max(a||0,0),new K([...this.color.map(C(a)),this.valpha],this.model)},alpha(a){return void 0!==a?new K([...this.color,Math.max(0,Math.min(1,a))],this.model):this.valpha},red:F("rgb",0,u(255)),green:F("rgb",1,u(255)),blue:F("rgb",2,u(255)),hue:F(["hsl","hsv","hsl","hwb","hcg"],0,(a=>(a%360+360)%360)),saturationl:F("hsl",1,u(100)),lightness:F("hsl",2,u(100)),saturationv:F("hsv",1,u(100)),value:F("hsv",2,u(100)),chroma:F("hcg",1,u(100)),gray:F("hcg",2,u(100)),white:F("hwb",1,u(100)),wblack:F("hwb",2,u(100)),cyan:F("cmyk",0,u(100)),magenta:F("cmyk",1,u(100)),yellow:F("cmyk",2,u(100)),black:F("cmyk",3,u(100)),x:F("xyz",0,u(95.047)),y:F("xyz",1,u(100)),z:F("xyz",2,u(108.833)),l:F("lab",0,u(100)),a:F("lab",1),b:F("lab",2),keyword(a){return void 0!==a?new K(a):b[this.model].keyword(this.color)},hex(a){return void 0!==a?new K(a):P.to.hex(this.rgb().round().color)},hexa(a){if(void 0!==a)return new K(a);const v=this.rgb().round().color;let p=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===p.length&&(p="0"+p),P.to.hex(v)+p},rgbNumber(){const a=this.rgb().color;return(255&a[0])<<16|(255&a[1])<<8|255&a[2]},luminosity(){const a=this.rgb().color,v=[];for(const[p,P]of a.entries()){const a=P/255;v[p]=a<=.04045?a/12.92:((a+.055)/1.055)**2.4}return.2126*v[0]+.7152*v[1]+.0722*v[2]},contrast(a){const v=this.luminosity(),p=a.luminosity();return v>p?(v+.05)/(p+.05):(p+.05)/(v+.05)},level(a){const v=this.contrast(a);return v>=7?"AAA":v>=4.5?"AA":""},isDark(){const a=this.rgb().color;return(2126*a[0]+7152*a[1]+722*a[2])/1e4<128},isLight(){return!this.isDark()},negate(){const a=this.rgb();for(let v=0;v<3;v++)a.color[v]=255-a.color[v];return a},lighten(a){const v=this.hsl();return v.color[2]+=v.color[2]*a,v},darken(a){const v=this.hsl();return v.color[2]-=v.color[2]*a,v},saturate(a){const v=this.hsl();return v.color[1]+=v.color[1]*a,v},desaturate(a){const v=this.hsl();return v.color[1]-=v.color[1]*a,v},whiten(a){const v=this.hwb();return v.color[1]+=v.color[1]*a,v},blacken(a){const v=this.hwb();return v.color[2]+=v.color[2]*a,v},grayscale(){const a=this.rgb().color,v=.3*a[0]+.59*a[1]+.11*a[2];return K.rgb(v,v,v)},fade(a){return this.alpha(this.valpha-this.valpha*a)},opaquer(a){return this.alpha(this.valpha+this.valpha*a)},rotate(a){const v=this.hsl();let p=v.color[0];return p=(p+a)%360,p=p<0?360+p:p,v.color[0]=p,v},mix(a,v){if(!a||!a.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof a);const p=a.rgb(),P=this.rgb(),b=void 0===v?.5:v,L=2*b-1,t=p.alpha()-P.alpha(),V=((L*t===-1?L:(L+t)/(1+L*t))+1)/2,C=1-V;return K.rgb(V*p.red()+C*P.red(),V*p.green()+C*P.green(),V*p.blue()+C*P.blue(),p.alpha()*b+P.alpha()*(1-b))}};for(const f of Object.keys(b)){if(L.includes(f))continue;const{channels:a}=b[f];K.prototype[f]=function(){if(this.model===f)return new K(this);for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];return v.length>0?new K(v,f):new K([...(P=b[this.model][f].raw(this.color),Array.isArray(P)?P:[P]),this.valpha],f);var P},K[f]=function(){for(var v=arguments.length,p=new Array(v),P=0;P<v;P++)p[P]=arguments[P];let b=p[0];return"number"===typeof b&&(b=c(p,a)),new K(b,f)}}function C(a){return function(v){return function(a,v){return Number(a.toFixed(v))}(v,a)}}function F(a,v,p){a=Array.isArray(a)?a:[a];for(const P of a)(V[P]||(V[P]=[]))[v]=p;return a=a[0],function(P){let b;return void 0!==P?(p&&(P=p(P)),b=this[a](),b.color[v]=P,b):(b=this[a]().color[v],p&&(b=p(b)),b)}}function u(a){return function(v){return Math.max(0,Math.min(a,v))}}function c(a,v){for(let p=0;p<v;p++)"number"!==typeof a[p]&&(a[p]=0);return a}a.exports=K},12833:(a,v,p)=>{const P=p(12838),b={};for(const t of Object.keys(P))b[P[t]]=t;const L={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};a.exports=L;for(const t of Object.keys(L)){if(!("channels"in L[t]))throw new Error("missing channels property: "+t);if(!("labels"in L[t]))throw new Error("missing channel labels property: "+t);if(L[t].labels.length!==L[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:a,labels:v}=L[t];delete L[t].channels,delete L[t].labels,Object.defineProperty(L[t],"channels",{value:a}),Object.defineProperty(L[t],"labels",{value:v})}L.rgb.hsl=function(a){const v=a[0]/255,p=a[1]/255,P=a[2]/255,b=Math.min(v,p,P),L=Math.max(v,p,P),t=L-b;let V,K;L===b?V=0:v===L?V=(p-P)/t:p===L?V=2+(P-v)/t:P===L&&(V=4+(v-p)/t),V=Math.min(60*V,360),V<0&&(V+=360);const C=(b+L)/2;return K=L===b?0:C<=.5?t/(L+b):t/(2-L-b),[V,100*K,100*C]},L.rgb.hsv=function(a){let v,p,P,b,L;const t=a[0]/255,V=a[1]/255,K=a[2]/255,C=Math.max(t,V,K),F=C-Math.min(t,V,K),u=function(a){return(C-a)/6/F+.5};return 0===F?(b=0,L=0):(L=F/C,v=u(t),p=u(V),P=u(K),t===C?b=P-p:V===C?b=1/3+v-P:K===C&&(b=2/3+p-v),b<0?b+=1:b>1&&(b-=1)),[360*b,100*L,100*C]},L.rgb.hwb=function(a){const v=a[0],p=a[1];let P=a[2];const b=L.rgb.hsl(a)[0],t=1/255*Math.min(v,Math.min(p,P));return P=1-1/255*Math.max(v,Math.max(p,P)),[b,100*t,100*P]},L.rgb.cmyk=function(a){const v=a[0]/255,p=a[1]/255,P=a[2]/255,b=Math.min(1-v,1-p,1-P);return[100*((1-v-b)/(1-b)||0),100*((1-p-b)/(1-b)||0),100*((1-P-b)/(1-b)||0),100*b]},L.rgb.keyword=function(a){const v=b[a];if(v)return v;let p,L=1/0;for(const b of Object.keys(P)){const v=P[b],K=(V=v,((t=a)[0]-V[0])**2+(t[1]-V[1])**2+(t[2]-V[2])**2);K<L&&(L=K,p=b)}var t,V;return p},L.keyword.rgb=function(a){return P[a]},L.rgb.xyz=function(a){let v=a[0]/255,p=a[1]/255,P=a[2]/255;v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92;return[100*(.4124*v+.3576*p+.1805*P),100*(.2126*v+.7152*p+.0722*P),100*(.0193*v+.1192*p+.9505*P)]},L.rgb.lab=function(a){const v=L.rgb.xyz(a);let p=v[0],P=v[1],b=v[2];p/=95.047,P/=100,b/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,b=b>.008856?b**(1/3):7.787*b+16/116;return[116*P-16,500*(p-P),200*(P-b)]},L.hsl.rgb=function(a){const v=a[0]/360,p=a[1]/100,P=a[2]/100;let b,L,t;if(0===p)return t=255*P,[t,t,t];b=P<.5?P*(1+p):P+p-P*p;const V=2*P-b,K=[0,0,0];for(let C=0;C<3;C++)L=v+1/3*-(C-1),L<0&&L++,L>1&&L--,t=6*L<1?V+6*(b-V)*L:2*L<1?b:3*L<2?V+(b-V)*(2/3-L)*6:V,K[C]=255*t;return K},L.hsl.hsv=function(a){const v=a[0];let p=a[1]/100,P=a[2]/100,b=p;const L=Math.max(P,.01);P*=2,p*=P<=1?P:2-P,b*=L<=1?L:2-L;return[v,100*(0===P?2*b/(L+b):2*p/(P+p)),100*((P+p)/2)]},L.hsv.rgb=function(a){const v=a[0]/60,p=a[1]/100;let P=a[2]/100;const b=Math.floor(v)%6,L=v-Math.floor(v),t=255*P*(1-p),V=255*P*(1-p*L),K=255*P*(1-p*(1-L));switch(P*=255,b){case 0:return[P,K,t];case 1:return[V,P,t];case 2:return[t,P,K];case 3:return[t,V,P];case 4:return[K,t,P];case 5:return[P,t,V]}},L.hsv.hsl=function(a){const v=a[0],p=a[1]/100,P=a[2]/100,b=Math.max(P,.01);let L,t;t=(2-p)*P;const V=(2-p)*b;return L=p*b,L/=V<=1?V:2-V,L=L||0,t/=2,[v,100*L,100*t]},L.hwb.rgb=function(a){const v=a[0]/360;let p=a[1]/100,P=a[2]/100;const b=p+P;let L;b>1&&(p/=b,P/=b);const t=Math.floor(6*v),V=1-P;L=6*v-t,0!==(1&t)&&(L=1-L);const K=p+L*(V-p);let C,F,u;switch(t){default:case 6:case 0:C=V,F=K,u=p;break;case 1:C=K,F=V,u=p;break;case 2:C=p,F=V,u=K;break;case 3:C=p,F=K,u=V;break;case 4:C=K,F=p,u=V;break;case 5:C=V,F=p,u=K}return[255*C,255*F,255*u]},L.cmyk.rgb=function(a){const v=a[0]/100,p=a[1]/100,P=a[2]/100,b=a[3]/100;return[255*(1-Math.min(1,v*(1-b)+b)),255*(1-Math.min(1,p*(1-b)+b)),255*(1-Math.min(1,P*(1-b)+b))]},L.xyz.rgb=function(a){const v=a[0]/100,p=a[1]/100,P=a[2]/100;let b,L,t;return b=3.2406*v+-1.5372*p+-.4986*P,L=-.9689*v+1.8758*p+.0415*P,t=.0557*v+-.204*p+1.057*P,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,b=Math.min(Math.max(0,b),1),L=Math.min(Math.max(0,L),1),t=Math.min(Math.max(0,t),1),[255*b,255*L,255*t]},L.xyz.lab=function(a){let v=a[0],p=a[1],P=a[2];v/=95.047,p/=100,P/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,p=p>.008856?p**(1/3):7.787*p+16/116,P=P>.008856?P**(1/3):7.787*P+16/116;return[116*p-16,500*(v-p),200*(p-P)]},L.lab.xyz=function(a){let v,p,P;p=(a[0]+16)/116,v=a[1]/500+p,P=p-a[2]/200;const b=p**3,L=v**3,t=P**3;return p=b>.008856?b:(p-16/116)/7.787,v=L>.008856?L:(v-16/116)/7.787,P=t>.008856?t:(P-16/116)/7.787,v*=95.047,p*=100,P*=108.883,[v,p,P]},L.lab.lch=function(a){const v=a[0],p=a[1],P=a[2];let b;b=360*Math.atan2(P,p)/2/Math.PI,b<0&&(b+=360);return[v,Math.sqrt(p*p+P*P),b]},L.lch.lab=function(a){const v=a[0],p=a[1],P=a[2]/360*2*Math.PI;return[v,p*Math.cos(P),p*Math.sin(P)]},L.rgb.ansi16=function(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[p,P,b]=a;let t=null===v?L.rgb.hsv(a)[2]:v;if(t=Math.round(t/50),0===t)return 30;let V=30+(Math.round(b/255)<<2|Math.round(P/255)<<1|Math.round(p/255));return 2===t&&(V+=60),V},L.hsv.ansi16=function(a){return L.rgb.ansi16(L.hsv.rgb(a),a[2])},L.rgb.ansi256=function(a){const v=a[0],p=a[1],P=a[2];if(v===p&&p===P)return v<8?16:v>248?231:Math.round((v-8)/247*24)+232;return 16+36*Math.round(v/255*5)+6*Math.round(p/255*5)+Math.round(P/255*5)},L.ansi16.rgb=function(a){let v=a%10;if(0===v||7===v)return a>50&&(v+=3.5),v=v/10.5*255,[v,v,v];const p=.5*(1+~~(a>50));return[(1&v)*p*255,(v>>1&1)*p*255,(v>>2&1)*p*255]},L.ansi256.rgb=function(a){if(a>=232){const v=10*(a-232)+8;return[v,v,v]}let v;a-=16;return[Math.floor(a/36)/5*255,Math.floor((v=a%36)/6)/5*255,v%6/5*255]},L.rgb.hex=function(a){const v=(((255&Math.round(a[0]))<<16)+((255&Math.round(a[1]))<<8)+(255&Math.round(a[2]))).toString(16).toUpperCase();return"000000".substring(v.length)+v},L.hex.rgb=function(a){const v=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];let p=v[0];3===v[0].length&&(p=p.split("").map((a=>a+a)).join(""));const P=parseInt(p,16);return[P>>16&255,P>>8&255,255&P]},L.rgb.hcg=function(a){const v=a[0]/255,p=a[1]/255,P=a[2]/255,b=Math.max(Math.max(v,p),P),L=Math.min(Math.min(v,p),P),t=b-L;let V,K;return V=t<1?L/(1-t):0,K=t<=0?0:b===v?(p-P)/t%6:b===p?2+(P-v)/t:4+(v-p)/t,K/=6,K%=1,[360*K,100*t,100*V]},L.hsl.hcg=function(a){const v=a[1]/100,p=a[2]/100,P=p<.5?2*v*p:2*v*(1-p);let b=0;return P<1&&(b=(p-.5*P)/(1-P)),[a[0],100*P,100*b]},L.hsv.hcg=function(a){const v=a[1]/100,p=a[2]/100,P=v*p;let b=0;return P<1&&(b=(p-P)/(1-P)),[a[0],100*P,100*b]},L.hcg.rgb=function(a){const v=a[0]/360,p=a[1]/100,P=a[2]/100;if(0===p)return[255*P,255*P,255*P];const b=[0,0,0],L=v%1*6,t=L%1,V=1-t;let K=0;switch(Math.floor(L)){case 0:b[0]=1,b[1]=t,b[2]=0;break;case 1:b[0]=V,b[1]=1,b[2]=0;break;case 2:b[0]=0,b[1]=1,b[2]=t;break;case 3:b[0]=0,b[1]=V,b[2]=1;break;case 4:b[0]=t,b[1]=0,b[2]=1;break;default:b[0]=1,b[1]=0,b[2]=V}return K=(1-p)*P,[255*(p*b[0]+K),255*(p*b[1]+K),255*(p*b[2]+K)]},L.hcg.hsv=function(a){const v=a[1]/100,p=v+a[2]/100*(1-v);let P=0;return p>0&&(P=v/p),[a[0],100*P,100*p]},L.hcg.hsl=function(a){const v=a[1]/100,p=a[2]/100*(1-v)+.5*v;let P=0;return p>0&&p<.5?P=v/(2*p):p>=.5&&p<1&&(P=v/(2*(1-p))),[a[0],100*P,100*p]},L.hcg.hwb=function(a){const v=a[1]/100,p=v+a[2]/100*(1-v);return[a[0],100*(p-v),100*(1-p)]},L.hwb.hcg=function(a){const v=a[1]/100,p=1-a[2]/100,P=p-v;let b=0;return P<1&&(b=(p-P)/(1-P)),[a[0],100*P,100*b]},L.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]},L.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]},L.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]},L.gray.hsl=function(a){return[0,0,a[0]]},L.gray.hsv=L.gray.hsl,L.gray.hwb=function(a){return[0,100,a[0]]},L.gray.cmyk=function(a){return[0,0,0,a[0]]},L.gray.lab=function(a){return[a[0],0,0]},L.gray.hex=function(a){const v=255&Math.round(a[0]/100*255),p=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(p.length)+p},L.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}},12829:(a,v,p)=>{const P=p(12833),b=p(12843),L={};Object.keys(P).forEach((a=>{L[a]={},Object.defineProperty(L[a],"channels",{value:P[a].channels}),Object.defineProperty(L[a],"labels",{value:P[a].labels});const v=b(a);Object.keys(v).forEach((p=>{const P=v[p];L[a][p]=function(a){const v=function(){for(var v=arguments.length,p=new Array(v),P=0;P<v;P++)p[P]=arguments[P];const b=p[0];if(void 0===b||null===b)return b;b.length>1&&(p=b);const L=a(p);if("object"===typeof L)for(let a=L.length,t=0;t<a;t++)L[t]=Math.round(L[t]);return L};return"conversion"in a&&(v.conversion=a.conversion),v}(P),L[a][p].raw=function(a){const v=function(){for(var v=arguments.length,p=new Array(v),P=0;P<v;P++)p[P]=arguments[P];const b=p[0];return void 0===b||null===b?b:(b.length>1&&(p=b),a(p))};return"conversion"in a&&(v.conversion=a.conversion),v}(P)}))})),a.exports=L},12843:(a,v,p)=>{const P=p(12833);function b(a){const v=function(){const a={},v=Object.keys(P);for(let p=v.length,P=0;P<p;P++)a[v[P]]={distance:-1,parent:null};return a}(),p=[a];for(v[a].distance=0;p.length;){const a=p.pop(),b=Object.keys(P[a]);for(let P=b.length,L=0;L<P;L++){const P=b[L],t=v[P];-1===t.distance&&(t.distance=v[a].distance+1,t.parent=a,p.unshift(P))}}return v}function L(a,v){return function(p){return v(a(p))}}function t(a,v){const p=[v[a].parent,a];let b=P[v[a].parent][a],t=v[a].parent;for(;v[t].parent;)p.unshift(v[t].parent),b=L(P[v[t].parent][t],b),t=v[t].parent;return b.conversion=p,b}a.exports=function(a){const v=b(a),p={},P=Object.keys(v);for(let b=P.length,L=0;L<b;L++){const a=P[L];null!==v[a].parent&&(p[a]=t(a,v))}return p}},12838:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10798:function(a,v,p){"use strict";var P=this&&this.__createBinding||(Object.create?function(a,v,p,P){void 0===P&&(P=p);var b=Object.getOwnPropertyDescriptor(v,p);b&&!("get"in b?!v.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return v[p]}}),Object.defineProperty(a,P,b)}:function(a,v,p,P){void 0===P&&(P=p),a[P]=v[p]}),b=this&&this.__setModuleDefault||(Object.create?function(a,v){Object.defineProperty(a,"default",{enumerable:!0,value:v})}:function(a,v){a.default=v}),L=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var v={};if(null!=a)for(var p in a)"default"!==p&&Object.prototype.hasOwnProperty.call(a,p)&&P(v,a,p);return b(v,a),v},t=this&&this.__awaiter||function(a,v,p,P){return new(p||(p=Promise))((function(b,L){function t(a){try{K(P.next(a))}catch(v){L(v)}}function V(a){try{K(P.throw(a))}catch(v){L(v)}}function K(a){var v;a.done?b(a.value):(v=a.value,v instanceof p?v:new p((function(a){a(v)}))).then(t,V)}K((P=P.apply(a,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Auth=v.Platform=void 0;const V=L(p(10726)),K=p(10805),C="colyseus-auth-token";!function(a){a.ios="ios",a.android="android"}(v.Platform||(v.Platform={}));v.Auth=class{constructor(a){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=a.replace("ws","http"),(0,K.getItem)(C,(a=>this.token=a))}get hasToken(){return!!this.token}login(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,void 0,void 0,(function*(){const v=Object.assign({},a);this.hasToken&&(v.token=this.token);const p=yield this.request("post","/auth",v);this.token=p.token,(0,K.setItem)(C,this.token);for(let a in p)this.hasOwnProperty(a)&&(this[a]=p[a]);return this.registerPingService(),this}))}save(){return t(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return t(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return t(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return t(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(a){return t(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:a})}))}acceptFriendRequest(a){return t(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:a})}))}declineFriendRequest(a){return t(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:a})}))}blockUser(a){return t(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:a})}))}unblockUser(a){return t(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:a})}))}request(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t(this,void 0,void 0,(function*(){b.Accept="application/json",this.hasToken&&(b.Authorization="Bearer "+this.token);const L=[];for(const a in p)L.push(`${a}=${p[a]}`);const t=L.length>0?`?${L.join("&")}`:"",K={headers:b};return P&&(K.body=P),(yield V[a](`${this.endpoint}${v}${t}`,K)).data}))}logout(){this.token=void 0,(0,K.removeItem)(C),this.unregisterPingService()}registerPingService(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),a)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10723:function(a,v,p){"use strict";var P,b=this&&this.__awaiter||function(a,v,p,P){return new(p||(p=Promise))((function(b,L){function t(a){try{K(P.next(a))}catch(v){L(v)}}function V(a){try{K(P.throw(a))}catch(v){L(v)}}function K(a){var v;a.done?b(a.value):(v=a.value,v instanceof p?v:new p((function(a){a(v)}))).then(t,V)}K((P=P.apply(a,v||[])).next())}))};Object.defineProperty(v,"__esModule",{value:!0}),v.Client=v.MatchMakeError=void 0;const L=p(10726),t=p(10735),V=p(10744);class K extends Error{constructor(a,v){super(a),this.code=v,Object.setPrototypeOf(this,K.prototype)}}v.MatchMakeError=K;const C="undefined"!==typeof window&&"undefined"!==typeof(null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";v.Client=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;if("string"===typeof a){const v=new URL(a),p="https:"===v.protocol||"wss:"===v.protocol,P=Number(v.port||(p?443:80));this.settings={hostname:v.hostname,pathname:"/"!==v.pathname?v.pathname:"",port:P,secure:p}}else void 0===a.port&&(a.port=a.secure?443:80),void 0===a.pathname&&(a.pathname=""),this.settings=a}joinOrCreate(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",a,v,p)}))}create(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",a,v,p)}))}join(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",a,v,p)}))}joinById(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",a,v,p)}))}reconnect(a,v){return b(this,void 0,void 0,(function*(){if("string"===typeof a&&"string"===typeof v)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[p,P]=a.split(":");return yield this.createMatchMakeRequest("reconnect",p,{reconnectionToken:P},v)}))}getAvailableRooms(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return b(this,void 0,void 0,(function*(){return(yield(0,L.get)(this.getHttpEndpoint(`${a}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(a,v,p){return b(this,void 0,void 0,(function*(){const P=this.createRoom(a.room.name,v);P.roomId=a.room.roomId,P.sessionId=a.sessionId;const L={sessionId:P.sessionId};a.reconnectionToken&&(L.reconnectionToken=a.reconnectionToken);const V=p||P;return P.connect(this.buildEndpoint(a.room,L),a.devMode&&(()=>b(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${P.roomId}'...`);let p=0;const L=()=>b(this,void 0,void 0,(function*(){p++;try{yield this.consumeSeatReservation(a,v,V),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${P.roomId}'`)}catch(b){p<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${p} out of 8)`),setTimeout(L,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(L,2e3)}))),V),new Promise(((a,v)=>{const p=(a,p)=>v(new t.ServerError(a,p));V.onError.once(p),V.onJoin.once((()=>{V.onError.remove(p),a(V)}))}))}))}createMatchMakeRequest(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;return b(this,void 0,void 0,(function*(){const b=(yield(0,L.post)(this.getHttpEndpoint(`${a}/${v}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(p)})).data;if(b.error)throw new K(b.error,b.code);return"reconnect"===a&&(b.reconnectionToken=p.reconnectionToken),yield this.consumeSeatReservation(b,P,t)}))}createRoom(a,v){return new V.Room(a,v)}buildEndpoint(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const p=[];for(const b in v)v.hasOwnProperty(b)&&p.push(`${b}=${v[b]}`);let P=this.settings.secure?"wss://":"ws://";return a.publicAddress?P+=`${a.publicAddress}`:P+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${P}/${a.processId}/${a.roomId}?${p.join("&")}`}getHttpEndpoint(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${a}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10759:(a,v,p)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.Connection=void 0;const P=p(10765);v.Connection=class{constructor(){this.events={},this.transport=new P.WebSocketTransport(this.events)}send(a){this.transport.send(a)}connect(a){this.transport.connect(a)}close(a,v){this.transport.close(a,v)}get isOpen(){return this.transport.isOpen}}},10771:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.utf8Length=v.utf8Read=v.ErrorCode=v.Protocol=void 0,function(a){a[a.HANDSHAKE=9]="HANDSHAKE",a[a.JOIN_ROOM=10]="JOIN_ROOM",a[a.ERROR=11]="ERROR",a[a.LEAVE_ROOM=12]="LEAVE_ROOM",a[a.ROOM_DATA=13]="ROOM_DATA",a[a.ROOM_STATE=14]="ROOM_STATE",a[a.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",a[a.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",a[a.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(v.Protocol||(v.Protocol={})),function(a){a[a.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",a[a.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",a[a.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",a[a.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",a[a.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",a[a.AUTH_FAILED=4215]="AUTH_FAILED",a[a.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(v.ErrorCode||(v.ErrorCode={})),v.utf8Read=function(a,v){const p=a[v++];for(var P="",b=0,L=v,t=v+p;L<t;L++){var V=a[L];if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(b=(7&V)<<18|(63&a[++L])<<12|(63&a[++L])<<6|63&a[++L])>=65536?(b-=65536,P+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):P+=String.fromCharCode(b)}else P+=String.fromCharCode((15&V)<<12|(63&a[++L])<<6|63&a[++L]);else P+=String.fromCharCode((31&V)<<6|63&a[++L]);else P+=String.fromCharCode(V)}return P},v.utf8Length=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",v=0,p=0;for(let P=0,b=a.length;P<b;P++)v=a.charCodeAt(P),v<128?p+=1:v<2048?p+=2:v<55296||v>=57344?p+=3:(P++,p+=4);return p+1}},10744:function(a,v,p){"use strict";var P=this&&this.__createBinding||(Object.create?function(a,v,p,P){void 0===P&&(P=p);var b=Object.getOwnPropertyDescriptor(v,p);b&&!("get"in b?!v.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return v[p]}}),Object.defineProperty(a,P,b)}:function(a,v,p,P){void 0===P&&(P=p),a[P]=v[p]}),b=this&&this.__setModuleDefault||(Object.create?function(a,v){Object.defineProperty(a,"default",{enumerable:!0,value:v})}:function(a,v){a.default=v}),L=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var v={};if(null!=a)for(var p in a)"default"!==p&&Object.prototype.hasOwnProperty.call(a,p)&&P(v,a,p);return b(v,a),v};Object.defineProperty(v,"__esModule",{value:!0}),v.Room=void 0;const t=L(p(10750)),V=p(10759),K=p(10771),C=p(10775),F=p(10783),u=p(10789),c=p(10792),f=p(10735);class H{constructor(a,v){this.onStateChange=(0,u.createSignal)(),this.onError=(0,u.createSignal)(),this.onLeave=(0,u.createSignal)(),this.onJoin=(0,u.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,F.createNanoEvents)(),this.roomId=null,this.name=a,v&&(this.serializer=new((0,C.getSerializer)("schema")),this.rootSchema=v,this.serializer.state=new v),this.onError(((a,v)=>{var p;return null===(p=console.warn)||void 0===p?void 0:p.call(console,`colyseus.js - onError => (${a}) ${v}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const P=new V.Connection;p.connection=P,P.events.onmessage=H.prototype.onMessageCallback.bind(p),P.events.onclose=function(a){var P;if(!p.hasJoined)return null===(P=console.warn)||void 0===P||P.call(console,`Room connection was closed unexpectedly (${a.code}): ${a.reason}`),void p.onError.invoke(a.code,a.reason);a.code===f.CloseCode.DEVMODE_RESTART&&v?v():(p.onLeave.invoke(a.code),p.destroy())},P.events.onerror=function(a){var v;null===(v=console.warn)||void 0===v||v.call(console,`Room, onError (${a.code}): ${a.reason}`),p.onError.invoke(a.code,a.reason)},P.connect(a)}leave(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((v=>{this.onLeave((a=>v(a))),this.connection?a?this.connection.send([K.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(f.CloseCode.CONSENTED)}))}onMessage(a,v){return this.onMessageHandlers.on(this.getMessageHandlerKey(a),v)}send(a,v){const p=[K.Protocol.ROOM_DATA];let P;if("string"===typeof a?c.encode.string(p,a):c.encode.number(p,a),void 0!==v){const a=t.encode(v);P=new Uint8Array(p.length+a.byteLength),P.set(new Uint8Array(p),0),P.set(new Uint8Array(a),p.length)}else P=new Uint8Array(p);this.connection.send(P.buffer)}sendBytes(a,v){const p=[K.Protocol.ROOM_DATA_BYTES];let P;"string"===typeof a?c.encode.string(p,a):c.encode.number(p,a),P=new Uint8Array(p.length+(v.byteLength||v.length)),P.set(new Uint8Array(p),0),P.set(new Uint8Array(v),p.length),this.connection.send(P.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(a){const v=Array.from(new Uint8Array(a.data)),p=v[0];if(p===K.Protocol.JOIN_ROOM){let a=1;const p=(0,K.utf8Read)(v,a);if(a+=(0,K.utf8Length)(p),this.serializerId=(0,K.utf8Read)(v,a),a+=(0,K.utf8Length)(this.serializerId),!this.serializer){const a=(0,C.getSerializer)(this.serializerId);this.serializer=new a}v.length>a&&this.serializer.handshake&&this.serializer.handshake(v,{offset:a}),this.reconnectionToken=`${this.roomId}:${p}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([K.Protocol.JOIN_ROOM])}else if(p===K.Protocol.ERROR){const a={offset:1},p=c.decode.number(v,a),P=c.decode.string(v,a);this.onError.invoke(p,P)}else if(p===K.Protocol.LEAVE_ROOM)this.leave();else if(p===K.Protocol.ROOM_DATA_SCHEMA){const a={offset:1},p=this.serializer.getState().constructor._context.get(c.decode.number(v,a)),P=new p;P.decode(v,a),this.dispatchMessage(p,P)}else if(p===K.Protocol.ROOM_STATE)v.shift(),this.setState(v);else if(p===K.Protocol.ROOM_STATE_PATCH)v.shift(),this.patch(v);else if(p===K.Protocol.ROOM_DATA){const p={offset:1},P=c.decode.stringCheck(v,p)?c.decode.string(v,p):c.decode.number(v,p),b=v.length>p.offset?t.decode(a.data,p.offset):void 0;this.dispatchMessage(P,b)}else if(p===K.Protocol.ROOM_DATA_BYTES){const a={offset:1},p=c.decode.stringCheck(v,a)?c.decode.string(v,a):c.decode.number(v,a);this.dispatchMessage(p,new Uint8Array(v.slice(a.offset)))}}setState(a){this.serializer.setState(a),this.onStateChange.invoke(this.serializer.getState())}patch(a){this.serializer.patch(a),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(a,v){var p;const P=this.getMessageHandlerKey(a);this.onMessageHandlers.events[P]?this.onMessageHandlers.emit(P,v):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",a,v):null===(p=console.warn)||void 0===p||p.call(console,`colyseus.js: onMessage() not registered for type '${a}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(a){switch(typeof a){case"function":return`$${a._typeid}`;case"string":return a;case"number":return`i${a}`;default:throw new Error("invalid message type.")}}}v.Room=H},10805:(a,v)=>{"use strict";let p;function P(){return p||(p="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(a,v){this.cache[a]=v},getItem:function(a){this.cache[a]},removeItem:function(a){delete this.cache[a]}}),p}Object.defineProperty(v,"__esModule",{value:!0}),v.getItem=v.removeItem=v.setItem=void 0,v.setItem=function(a,v){P().setItem(a,v)},v.removeItem=function(a){P().removeItem(a)},v.getItem=function(a,v){const p=P().getItem(a);"undefined"!==typeof Promise&&p instanceof Promise?p.then((a=>v(a))):v(p)}},10783:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createNanoEvents=void 0;v.createNanoEvents=()=>({emit(a){let v=this.events[a]||[];for(var p=arguments.length,P=new Array(p>1?p-1:0),b=1;b<p;b++)P[b-1]=arguments[b];for(let L=0,t=v.length;L<t;L++)v[L](...P)},events:{},on(a,v){var p;return(null===(p=this.events[a])||void 0===p?void 0:p.push(v))||(this.events[a]=[v]),()=>{var p;this.events[a]=null===(p=this.events[a])||void 0===p?void 0:p.filter((a=>v!==a))}}})},10789:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.createSignal=v.EventEmitter=void 0;class p{constructor(){this.handlers=[]}register(a){return this.handlers.push(a),this}invoke(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];this.handlers.forEach((a=>a.apply(this,v)))}invokeAsync(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];return Promise.all(this.handlers.map((a=>a.apply(this,v))))}remove(a){const v=this.handlers.indexOf(a);this.handlers[v]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}v.EventEmitter=p,v.createSignal=function(){const a=new p;function v(v){return a.register(v,null===this)}return v.once=v=>{const p=function(){for(var P=arguments.length,b=new Array(P),L=0;L<P;L++)b[L]=arguments[L];v.apply(this,b),a.remove(p)};a.register(p)},v.remove=v=>a.remove(v),v.invoke=function(){return a.invoke(...arguments)},v.invokeAsync=function(){return a.invokeAsync(...arguments)},v.clear=()=>a.clear(),v}},10735:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.ServerError=v.CloseCode=void 0,function(a){a[a.CONSENTED=4e3]="CONSENTED",a[a.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(v.CloseCode||(v.CloseCode={}));class p extends Error{constructor(a,v){super(v),this.name="ServerError",this.code=a}}v.ServerError=p},10705:(a,v,p)=>{"use strict";v.e=void 0,p(10714);var P=p(10723);Object.defineProperty(v,"e",{enumerable:!0,get:function(){return P.Client}});var b=p(10771);var L=p(10744);var t=p(10798);const V=p(10811);const K=p(10816),C=p(10775);(0,C.registerSerializer)("schema",V.SchemaSerializer),(0,C.registerSerializer)("none",K.NoneSerializer)},10714:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=a=>null!==a&&"object"===typeof a&&a.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10750:(a,v)=>{"use strict";function p(a,v){if(this._offset=v,a instanceof ArrayBuffer)this._buffer=a,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(a))throw new Error("Invalid argument");this._buffer=a.buffer,this._view=new DataView(this._buffer,a.byteOffset,a.byteLength)}}Object.defineProperty(v,"__esModule",{value:!0}),v.decode=v.encode=void 0,p.prototype._array=function(a){for(var v=new Array(a),p=0;p<a;p++)v[p]=this._parse();return v},p.prototype._map=function(a){for(var v={},p=0;p<a;p++)v[this._parse()]=this._parse();return v},p.prototype._str=function(a){var v=function(a,v,p){for(var P="",b=0,L=v,t=v+p;L<t;L++){var V=a.getUint8(L);if(0!==(128&V))if(192!==(224&V))if(224!==(240&V)){if(240!==(248&V))throw new Error("Invalid byte "+V.toString(16));(b=(7&V)<<18|(63&a.getUint8(++L))<<12|(63&a.getUint8(++L))<<6|63&a.getUint8(++L))>=65536?(b-=65536,P+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):P+=String.fromCharCode(b)}else P+=String.fromCharCode((15&V)<<12|(63&a.getUint8(++L))<<6|63&a.getUint8(++L));else P+=String.fromCharCode((31&V)<<6|63&a.getUint8(++L));else P+=String.fromCharCode(V)}return P}(this._view,this._offset,a);return this._offset+=a,v},p.prototype._bin=function(a){var v=this._buffer.slice(this._offset,this._offset+a);return this._offset+=a,v},p.prototype._parse=function(){var a,v=this._view.getUint8(this._offset++),p=0,P=0,b=0,L=0;if(v<192)return v<128?v:v<144?this._map(15&v):v<160?this._array(15&v):this._str(31&v);if(v>223)return-1*(255-v+1);switch(v){case 192:return null;case 194:return!1;case 195:return!0;case 196:return p=this._view.getUint8(this._offset),this._offset+=1,this._bin(p);case 197:return p=this._view.getUint16(this._offset),this._offset+=2,this._bin(p);case 198:return p=this._view.getUint32(this._offset),this._offset+=4,this._bin(p);case 199:if(p=this._view.getUint8(this._offset),P=this._view.getInt8(this._offset+1),this._offset+=2,-1===P){var t=this._view.getUint32(this._offset);return b=this._view.getInt32(this._offset+4),L=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*b+L)+t/1e6)}return[P,this._bin(p)];case 200:return p=this._view.getUint16(this._offset),P=this._view.getInt8(this._offset+2),this._offset+=3,[P,this._bin(p)];case 201:return p=this._view.getUint32(this._offset),P=this._view.getInt8(this._offset+4),this._offset+=5,[P,this._bin(p)];case 202:return a=this._view.getFloat32(this._offset),this._offset+=4,a;case 203:return a=this._view.getFloat64(this._offset),this._offset+=8,a;case 204:return a=this._view.getUint8(this._offset),this._offset+=1,a;case 205:return a=this._view.getUint16(this._offset),this._offset+=2,a;case 206:return a=this._view.getUint32(this._offset),this._offset+=4,a;case 207:return b=this._view.getUint32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,b+L;case 208:return a=this._view.getInt8(this._offset),this._offset+=1,a;case 209:return a=this._view.getInt16(this._offset),this._offset+=2,a;case 210:return a=this._view.getInt32(this._offset),this._offset+=4,a;case 211:return b=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,b+L;case 212:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?void(this._offset+=1):[P,this._bin(1)];case 213:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(2)];case 214:return P=this._view.getInt8(this._offset),this._offset+=1,-1===P?(a=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*a)):[P,this._bin(4)];case 215:return P=this._view.getInt8(this._offset),this._offset+=1,0===P?(b=this._view.getInt32(this._offset)*Math.pow(2,32),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(b+L)):-1===P?(b=this._view.getUint32(this._offset),L=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&b)+L)+(b>>>2)/1e6)):[P,this._bin(8)];case 216:return P=this._view.getInt8(this._offset),this._offset+=1,[P,this._bin(16)];case 217:return p=this._view.getUint8(this._offset),this._offset+=1,this._str(p);case 218:return p=this._view.getUint16(this._offset),this._offset+=2,this._str(p);case 219:return p=this._view.getUint32(this._offset),this._offset+=4,this._str(p);case 220:return p=this._view.getUint16(this._offset),this._offset+=2,this._array(p);case 221:return p=this._view.getUint32(this._offset),this._offset+=4,this._array(p);case 222:return p=this._view.getUint16(this._offset),this._offset+=2,this._map(p);case 223:return p=this._view.getUint32(this._offset),this._offset+=4,this._map(p)}throw new Error("Could not parse")},v.decode=function(a){var v=new p(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),P=v._parse();if(v._offset!==a.byteLength)throw new Error(a.byteLength-v._offset+" trailing bytes");return P};function P(a,v,p){for(var P=0,b=0,L=p.length;b<L;b++)(P=p.charCodeAt(b))<128?a.setUint8(v++,P):P<2048?(a.setUint8(v++,192|P>>6),a.setUint8(v++,128|63&P)):P<55296||P>=57344?(a.setUint8(v++,224|P>>12),a.setUint8(v++,128|P>>6&63),a.setUint8(v++,128|63&P)):(b++,P=65536+((1023&P)<<10|1023&p.charCodeAt(b)),a.setUint8(v++,240|P>>18),a.setUint8(v++,128|P>>12&63),a.setUint8(v++,128|P>>6&63),a.setUint8(v++,128|63&P))}function b(a,v,p){var P=typeof p,L=0,t=0,V=0,K=0,C=0,F=0;if("string"===P){if(C=function(a){for(var v=0,p=0,P=0,b=a.length;P<b;P++)(v=a.charCodeAt(P))<128?p+=1:v<2048?p+=2:v<55296||v>=57344?p+=3:(P++,p+=4);return p}(p),C<32)a.push(160|C),F=1;else if(C<256)a.push(217,C),F=2;else if(C<65536)a.push(218,C>>8,C),F=3;else{if(!(C<4294967296))throw new Error("String too long");a.push(219,C>>24,C>>16,C>>8,C),F=5}return v.push({_str:p,_length:C,_offset:a.length}),F+C}if("number"===P)return Math.floor(p)===p&&isFinite(p)?p>=0?p<128?(a.push(p),1):p<256?(a.push(204,p),2):p<65536?(a.push(205,p>>8,p),3):p<4294967296?(a.push(206,p>>24,p>>16,p>>8,p),5):(V=p/Math.pow(2,32)|0,K=p>>>0,a.push(207,V>>24,V>>16,V>>8,V,K>>24,K>>16,K>>8,K),9):p>=-32?(a.push(p),1):p>=-128?(a.push(208,p),2):p>=-32768?(a.push(209,p>>8,p),3):p>=-2147483648?(a.push(210,p>>24,p>>16,p>>8,p),5):(V=Math.floor(p/Math.pow(2,32)),K=p>>>0,a.push(211,V>>24,V>>16,V>>8,V,K>>24,K>>16,K>>8,K),9):(a.push(203),v.push({_float:p,_length:8,_offset:a.length}),9);if("object"===P){if(null===p)return a.push(192),1;if(Array.isArray(p)){if((C=p.length)<16)a.push(144|C),F=1;else if(C<65536)a.push(220,C>>8,C),F=3;else{if(!(C<4294967296))throw new Error("Array too large");a.push(221,C>>24,C>>16,C>>8,C),F=5}for(L=0;L<C;L++)F+=b(a,v,p[L]);return F}if(p instanceof Date){var u=p.getTime(),c=Math.floor(u/1e3),f=1e6*(u-1e3*c);return c>=0&&f>=0&&c<=17179869183?0===f&&c<=4294967295?(a.push(214,255,c>>24,c>>16,c>>8,c),6):(V=c/4294967296,K=4294967295&c,a.push(215,255,f>>22,f>>14,f>>6,V,K>>24,K>>16,K>>8,K),10):(V=Math.floor(c/4294967296),K=c>>>0,a.push(199,12,255,f>>24,f>>16,f>>8,f,V>>24,V>>16,V>>8,V,K>>24,K>>16,K>>8,K),15)}if(p instanceof ArrayBuffer){if((C=p.byteLength)<256)a.push(196,C),F=2;else if(C<65536)a.push(197,C>>8,C),F=3;else{if(!(C<4294967296))throw new Error("Buffer too large");a.push(198,C>>24,C>>16,C>>8,C),F=5}return v.push({_bin:p,_length:C,_offset:a.length}),F+C}if("function"===typeof p.toJSON)return b(a,v,p.toJSON());var H=[],A="",h=Object.keys(p);for(L=0,t=h.length;L<t;L++)void 0!==p[A=h[L]]&&"function"!==typeof p[A]&&H.push(A);if((C=H.length)<16)a.push(128|C),F=1;else if(C<65536)a.push(222,C>>8,C),F=3;else{if(!(C<4294967296))throw new Error("Object too large");a.push(223,C>>24,C>>16,C>>8,C),F=5}for(L=0;L<C;L++)F+=b(a,v,A=H[L]),F+=b(a,v,p[A]);return F}if("boolean"===P)return a.push(p?195:194),1;if("undefined"===P)return a.push(192),1;if("function"===typeof p.toJSON)return b(a,v,p.toJSON());throw new Error("Could not encode")}v.encode=function(a){var v=[],p=[],L=b(v,p,a),t=new ArrayBuffer(L),V=new DataView(t),K=0,C=0,F=-1;p.length>0&&(F=p[0]._offset);for(var u,c=0,f=0,H=0,A=v.length;H<A;H++)if(V.setUint8(C+H,v[H]),H+1===F){if(c=(u=p[K])._length,f=C+F,u._bin)for(var h=new Uint8Array(u._bin),R=0;R<c;R++)V.setUint8(f+R,h[R]);else u._str?P(V,f,u._str):void 0!==u._float&&V.setFloat64(f,u._float);C+=c,p[++K]&&(F=p[K]._offset)}return t}},10816:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.NoneSerializer=void 0;v.NoneSerializer=class{setState(a){}getState(){return null}patch(a){}teardown(){}handshake(a){}}},10811:(a,v,p)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.SchemaSerializer=void 0;const P=p(10792);v.SchemaSerializer=class{setState(a){return this.state.decode(a)}getState(){return this.state}patch(a){return this.state.decode(a)}teardown(){var a,v;null===(v=null===(a=this.state)||void 0===a?void 0:a.$changes)||void 0===v||v.root.clearRefs()}handshake(a,v){if(this.state){(new P.Reflection).decode(a,v)}else this.state=P.Reflection.decode(a,v)}}},10775:(a,v)=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.getSerializer=v.registerSerializer=void 0;const p={};v.registerSerializer=function(a,v){p[a]=v},v.getSerializer=function(a){const v=p[a];if(!v)throw new Error("missing serializer: "+a);return v}},10765:function(a,v,p){"use strict";var P=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(v,"__esModule",{value:!0}),v.WebSocketTransport=void 0;const b=P(p(10768)),L=globalThis.WebSocket||b.default;v.WebSocketTransport=class{constructor(a){this.events=a}send(a){a instanceof ArrayBuffer?this.ws.send(a):Array.isArray(a)&&this.ws.send(new Uint8Array(a).buffer)}connect(a){this.ws=new L(a,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(a,v){this.ws.close(a,v)}get isOpen(){return this.ws.readyState===L.OPEN}}},10768:a=>{"use strict";a.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},10874:a=>{"use strict";a.exports=function(a){for(var v=new Array(a),p=0;p<a;++p)v[p]=p;return v}},10878:a=>{function v(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(v(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&v(a.slice(0,0))}(a)||!!a._isBuffer)}},10866:(a,v,p)=>{var P=p(10874),b=p(10878),L="undefined"!==typeof Float64Array;function t(a,v){return a[0]-v[0]}function V(){var a,v=this.stride,p=new Array(v.length);for(a=0;a<p.length;++a)p[a]=[Math.abs(v[a]),a];p.sort(t);var P=new Array(p.length);for(a=0;a<P.length;++a)P[a]=p[a][1];return P}function K(a,v){var p=["View",v,"d",a].join("");v<0&&(p="View_Nil"+a);var b="generic"===a;if(-1===v){var L="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}";return new Function(L)()}if(0===v){L="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}";return new Function("TrivialArray",L)(C[a][0])}L=["'use strict'"];var t=P(v),K=t.map((function(a){return"i"+a})),F="this.offset+"+t.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),u=t.map((function(a){return"b"+a})).join(","),c=t.map((function(a){return"c"+a})).join(",");L.push("function "+p+"(a,"+u+","+c+",d){this.data=a","this.shape=["+u+"]","this.stride=["+c+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+a+"'","proto.dimension="+v),L.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+t.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===v?L.push("proto.order=[0]"):(L.push("Object.defineProperty(proto,'order',{get:"),v<4?(L.push("function "+p+"_order(){"),2===v?L.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===v&&L.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):L.push("ORDER})")),L.push("proto.set=function "+p+"_set("+K.join(",")+",v){"),b?L.push("return this.data.set("+F+",v)}"):L.push("return this.data["+F+"]=v}"),L.push("proto.get=function "+p+"_get("+K.join(",")+"){"),b?L.push("return this.data.get("+F+")}"):L.push("return this.data["+F+"]}"),L.push("proto.index=function "+p+"_index(",K.join(),"){return "+F+"}"),L.push("proto.hi=function "+p+"_hi("+K.join(",")+"){return new "+p+"(this.data,"+t.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+t.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var f=t.map((function(a){return"a"+a+"=this.shape["+a+"]"})),H=t.map((function(a){return"c"+a+"=this.stride["+a+"]"}));L.push("proto.lo=function "+p+"_lo("+K.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+H.join(","));for(var A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");L.push("return new "+p+"(this.data,"+t.map((function(a){return"a"+a})).join(",")+","+t.map((function(a){return"c"+a})).join(",")+",b)}"),L.push("proto.step=function "+p+"_step("+K.join(",")+"){var "+t.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+t.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");L.push("return new "+p+"(this.data,"+t.map((function(a){return"a"+a})).join(",")+","+t.map((function(a){return"b"+a})).join(",")+",c)}");var h=new Array(v),R=new Array(v);for(A=0;A<v;++A)h[A]="a[i"+A+"]",R[A]="b[i"+A+"]";L.push("proto.transpose=function "+p+"_transpose("+K+"){"+K.map((function(a,v){return a+"=("+a+"===undefined?"+v+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+h.join(",")+","+R.join(",")+",this.offset)}"),L.push("proto.pick=function "+p+"_pick("+K+"){var a=[],b=[],c=this.offset");for(A=0;A<v;++A)L.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");return L.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),L.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+t.map((function(a){return"shape["+a+"]"})).join(",")+","+t.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",L.join("\n"))(C[a],V)}var C={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,v,p,P){if(void 0===a)return(0,C.array[0])([]);"number"===typeof a&&(a=[a]),void 0===v&&(v=[a.length]);var t=v.length;if(void 0===p){p=new Array(t);for(var V=t-1,F=1;V>=0;--V)p[V]=F,F*=v[V]}if(void 0===P){P=0;for(V=0;V<t;++V)p[V]<0&&(P-=(v[V]-1)*p[V])}for(var u=function(a){if(b(a))return"buffer";if(L)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),c=C[u];c.length<=t+1;)c.push(K(u,c.length-1));return(0,c[t+1])(a,v,p,P)}},10839:a=>{var v;self,v=()=>(()=>{"use strict";var a={d:(v,p)=>{for(var P in p)a.o(p,P)&&!a.o(v,P)&&Object.defineProperty(v,P,{enumerable:!0,get:p[P]})},o:(a,v)=>Object.prototype.hasOwnProperty.call(a,v)},v={};a.d(v,{default:()=>B});var p,P=function(a,v){var p=v.x-a.x,P=v.y-a.y;return Math.sqrt(p*p+P*P)},b=function(a){return a*(Math.PI/180)},L=new Map,t=function(a){L.has(a)&&clearTimeout(L.get(a)),L.set(a,setTimeout(a,100))},V=function(a,v,p){for(var P,b=v.split(/[ ,]+/g),L=0;L<b.length;L+=1)P=b[L],a.addEventListener?a.addEventListener(P,p,!1):a.attachEvent&&a.attachEvent(P,p)},K=function(a,v,p){for(var P,b=v.split(/[ ,]+/g),L=0;L<b.length;L+=1)P=b[L],a.removeEventListener?a.removeEventListener(P,p):a.detachEvent&&a.detachEvent(P,p)},C=function(a){return a.preventDefault(),a.type.match(/^touch/)?a.changedTouches:a},F=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(a,v){v.top||v.right||v.bottom||v.left?(a.style.top=v.top,a.style.right=v.right,a.style.bottom=v.bottom,a.style.left=v.left):(a.style.left=v.x+"px",a.style.top=v.y+"px")},c=function(a,v,p){var P=f(a);for(var b in P)if(P.hasOwnProperty(b))if("string"==typeof v)P[b]=v+" "+p;else{for(var L="",t=0,V=v.length;t<V;t+=1)L+=v[t]+" "+p+", ";P[b]=L.slice(0,-2)}return P},f=function(a){var v={};return v[a]="",["webkit","Moz","o"].forEach((function(p){v[p+a.charAt(0).toUpperCase()+a.slice(1)]=""})),v},H=function(a,v){for(var p in v)v.hasOwnProperty(p)&&(a[p]=v[p]);return a},A=function(a,v){if(a.length)for(var p=0,P=a.length;p<P;p+=1)v(a[p]);else v(a)},h="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,R=window.matchMedia("(any-hover: none)").matches,X=!!("ontouchstart"in window),Q=!!window.PointerEvent,s=!!window.MSPointerEvent,D={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},y={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function M(){}h&&!R?p=D:Q?p={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?p={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:X?(p=D,Z=y):p=y,M.prototype.on=function(a,v){var p,P=this,b=a.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var L=0;L<b.length;L+=1)p=b[L],P._handlers_[p]=P._handlers_[p]||[],P._handlers_[p].push(v);return P},M.prototype.off=function(a,v){var p=this;return p._handlers_=p._handlers_||{},void 0===a?p._handlers_={}:void 0===v?p._handlers_[a]=null:p._handlers_[a]&&p._handlers_[a].indexOf(v)>=0&&p._handlers_[a].splice(p._handlers_[a].indexOf(v),1),p},M.prototype.trigger=function(a,v){var p,P=this,b=a.split(/[ ,]+/g);P._handlers_=P._handlers_||{};for(var L=0;L<b.length;L+=1)p=b[L],P._handlers_[p]&&P._handlers_[p].length&&P._handlers_[p].forEach((function(a){a.call(P,{type:p,target:P},v)}))},M.prototype.config=function(a){var v=this;v.options=v.defaults||{},a&&(v.options=function(a,v){var p={};for(var P in a)a.hasOwnProperty(P)&&v.hasOwnProperty(P)?p[P]=v[P]:a.hasOwnProperty(P)&&(p[P]=a[P]);return p}(v.options,a))},M.prototype.bindEvt=function(a,v){var P=this;return P._domHandlers_=P._domHandlers_||{},P._domHandlers_[v]=function(){"function"==typeof P["on"+v]?P["on"+v].apply(P,arguments):console.warn('[WARNING] : Missing "on'+v+'" handler.')},V(a,p[v],P._domHandlers_[v]),Z[v]&&V(a,Z[v],P._domHandlers_[v]),P},M.prototype.unbindEvt=function(a,v){var P=this;return P._domHandlers_=P._domHandlers_||{},K(a,p[v],P._domHandlers_[v]),Z[v]&&K(a,Z[v],P._domHandlers_[v]),delete P._domHandlers_[v],this};const S=M;function n(a,v){return this.identifier=v.identifier,this.position=v.position,this.frontPosition=v.frontPosition,this.collection=a,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(v),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=n.id,n.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}n.prototype=new S,n.constructor=n,n.id=0,n.prototype.buildEl=function(a){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},n.prototype.stylize=function(){if(this.options.dataOnly)return this;var a=this.options.fadeTime+"ms",v=function(){var a=f("borderRadius");for(var v in a)a.hasOwnProperty(v)&&(a[v]="50%");return a}(),p=c("transition","opacity",a),P={};return P.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},P.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},P.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},H(P.el,p),"circle"===this.options.shape&&H(P.back,v),H(P.front,v),this.applyStyles(P),this},n.prototype.applyStyles=function(a){for(var v in this.ui)if(this.ui.hasOwnProperty(v))for(var p in a[v])this.ui[v].style[p]=a[v][p];return this},n.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},n.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},n.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},n.prototype.show=function(a){var v=this;return v.options.dataOnly||(clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.addToDom(),v.restCallback(),setTimeout((function(){v.ui.el.style.opacity=1}),0),v.showTimeout=setTimeout((function(){v.trigger("shown",v.instance),"function"==typeof a&&a.call(this)}),v.options.fadeTime)),v},n.prototype.hide=function(a){var v=this;if(v.options.dataOnly)return v;if(v.ui.el.style.opacity=v.options.restOpacity,clearTimeout(v.removeTimeout),clearTimeout(v.showTimeout),clearTimeout(v.restTimeout),v.removeTimeout=setTimeout((function(){var p="dynamic"===v.options.mode?"none":"block";v.ui.el.style.display=p,"function"==typeof a&&a.call(v),v.trigger("hidden",v.instance)}),v.options.fadeTime),v.options.restJoystick){var p=v.options.restJoystick,P={};P.x=!0===p||!1!==p.x?0:v.instance.frontPosition.x,P.y=!0===p||!1!==p.y?0:v.instance.frontPosition.y,v.setPosition(a,P)}return v},n.prototype.setPosition=function(a,v){var p=this;p.frontPosition={x:v.x,y:v.y};var P=p.options.fadeTime+"ms",b={};b.front=c("transition",["transform"],P);var L={front:{}};L.front={transform:"translate("+p.frontPosition.x+"px,"+p.frontPosition.y+"px)"},p.applyStyles(b),p.applyStyles(L),p.restTimeout=setTimeout((function(){"function"==typeof a&&a.call(p),p.restCallback()}),p.options.fadeTime)},n.prototype.restCallback=function(){var a=this,v={};v.front=c("transition","none",""),a.applyStyles(v),a.trigger("rested",a.instance)},n.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},n.prototype.computeDirection=function(a){var v,p,P,b=a.angle.radian,L=Math.PI/4,t=Math.PI/2;if(b>L&&b<3*L&&!a.lockX?v="up":b>-L&&b<=L&&!a.lockY?v="left":b>3*-L&&b<=-L&&!a.lockX?v="down":a.lockY||(v="right"),a.lockY||(p=b>-t&&b<t?"left":"right"),a.lockX||(P=b>0?"up":"down"),a.force>this.options.threshold){var V,K={};for(V in this.direction)this.direction.hasOwnProperty(V)&&(K[V]=this.direction[V]);var C={};for(V in this.direction={x:p,y:P,angle:v},a.direction=this.direction,K)K[V]===this.direction[V]&&(C[V]=!0);if(C.x&&C.y&&C.angle)return a;C.x&&C.y||this.trigger("plain",a),C.x||this.trigger("plain:"+p,a),C.y||this.trigger("plain:"+P,a),C.angle||this.trigger("dir dir:"+v,a)}else this.resetDirection();return a};const q=n;function T(a,v){var p=this;p.nipples=[],p.idles=[],p.actives=[],p.ids=[],p.pressureIntervals={},p.manager=a,p.id=T.id,T.id+=1,p.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},p.config(v),"static"!==p.options.mode&&"semi"!==p.options.mode||(p.options.multitouch=!1),p.options.multitouch||(p.options.maxNumberOfNipples=1);var P=getComputedStyle(p.options.zone.parentElement);return P&&"flex"===P.display&&(p.parentIsFlex=!0),p.updateBox(),p.prepareNipples(),p.Ij(),p.begin(),p.nipples}T.prototype=new S,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var a=this,v=a.nipples;v.on=a.on.bind(a),v.off=a.off.bind(a),v.options=a.options,v.destroy=a.destroy.bind(a),v.ids=a.ids,v.id=a.id,v.processOnMove=a.processOnMove.bind(a),v.processOnEnd=a.processOnEnd.bind(a),v.get=function(a){if(void 0===a)return v[0];for(var p=0,P=v.length;p<P;p+=1)if(v[p].identifier===a)return v[p];return!1}},T.prototype.Ij=function(){var a=this;a.bindEvt(a.options.zone,"start"),a.options.zone.style.touchAction="none",a.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var a=this,v=a.options;if("static"===v.mode){var p=a.createNipple(v.position,a.manager.getIdentifier());p.add(),a.idles.push(p)}},T.prototype.createNipple=function(a,v){var p=this,P=p.manager.scroll,b={},L=p.options,t=p.parentIsFlex?P.x:P.x+p.box.left,V=p.parentIsFlex?P.y:P.y+p.box.top;if(a.x&&a.y)b={x:a.x-t,y:a.y-V};else if(a.top||a.right||a.bottom||a.left){var K=document.createElement("DIV");K.style.display="hidden",K.style.top=a.top,K.style.right=a.right,K.style.bottom=a.bottom,K.style.left=a.left,K.style.position="absolute",L.zone.appendChild(K);var C=K.getBoundingClientRect();L.zone.removeChild(K),b=a,a={x:C.left+P.x,y:C.top+P.y}}var F=new q(p,{color:L.color,size:L.size,threshold:L.threshold,fadeTime:L.fadeTime,dataOnly:L.dataOnly,restJoystick:L.restJoystick,restOpacity:L.restOpacity,mode:L.mode,identifier:v,position:a,zone:L.zone,frontPosition:{x:0,y:0},shape:L.shape});return L.dataOnly||(u(F.ui.el,b),u(F.ui.front,F.frontPosition)),p.nipples.push(F),p.trigger("added "+F.identifier+":added",F),p.manager.trigger("added "+F.identifier+":added",F),p.bindNipple(F),F},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(a){var v,p=this,P=function(a,P){v=a.type+" "+P.id+":"+a.type,p.trigger(v,P)};a.on("destroyed",p.onDestroyed.bind(p)),a.on("shown hidden rested dir plain",P),a.on("dir:up dir:right dir:down dir:left",P),a.on("plain:up plain:right plain:down plain:left",P)},T.prototype.pressureFn=function(a,v,p){var P=this,b=0;clearInterval(P.pressureIntervals[p]),P.pressureIntervals[p]=setInterval(function(){var p=a.force||a.pressure||a.webkitForce||0;p!==b&&(v.trigger("pressure",p),P.trigger("pressure "+v.identifier+":pressure",p),b=p)}.bind(P),100)},T.prototype.onstart=function(a){var v=this,p=v.options,P=a;return a=C(a),v.updateBox(),A(a,(function(b){v.actives.length<p.maxNumberOfNipples?v.processOnStart(b):P.type.match(/^touch/)&&(Object.keys(v.manager.ids).forEach((function(p){if(Object.values(P.touches).findIndex((function(a){return a.identifier===p}))<0){var b=[a[0]];b.identifier=p,v.processOnEnd(b)}})),v.actives.length<p.maxNumberOfNipples&&v.processOnStart(b))})),v.manager.bindDocument(),!1},T.prototype.processOnStart=function(a){var v,p=this,b=p.options,L=p.manager.getIdentifier(a),t=a.force||a.pressure||a.webkitForce||0,V={x:a.pageX,y:a.pageY},K=p.getOrCreate(L,V);K.identifier!==L&&p.manager.removeIdentifier(K.identifier),K.identifier=L;var C=function(v){v.trigger("start",v),p.trigger("start "+v.id+":start",v),v.show(),t>0&&p.pressureFn(a,v,v.identifier),p.processOnMove(a)};if((v=p.idles.indexOf(K))>=0&&p.idles.splice(v,1),p.actives.push(K),p.ids.push(K.identifier),"semi"!==b.mode)C(K);else{if(!(P(V,K.position)<=b.catchDistance))return K.destroy(),void p.processOnStart(a);C(K)}return K},T.prototype.getOrCreate=function(a,v){var p,P=this,b=P.options;return/(semi|static)/.test(b.mode)?(p=P.idles[0])?(P.idles.splice(0,1),p):"semi"===b.mode?P.createNipple(v,a):(console.warn("Coudln't find the needed nipple."),!1):p=P.createNipple(v,a)},T.prototype.processOnMove=function(a){var v=this,p=v.options,L=v.manager.getIdentifier(a),t=v.nipples.get(L),V=v.manager.scroll;if(function(a){return isNaN(a.buttons)?0!==a.pressure:0!==a.buttons}(a)){if(!t)return console.error("Found zombie joystick with ID "+L),void v.manager.removeIdentifier(L);if(p.dynamicPage){var K=t.el.getBoundingClientRect();t.position={x:V.x+K.left,y:V.y+K.top}}t.identifier=L;var C=t.options.size/2,F={x:a.pageX,y:a.pageY};p.lockX&&(F.y=t.position.y),p.lockY&&(F.x=t.position.x);var u,c,f,H,A,h,R,X,Q,s,D=P(F,t.position),y=(u=F,f=(c=t.position).x-u.x,H=c.y-u.y,function(a){return a*(180/Math.PI)}(Math.atan2(H,f))),Z=b(y),M=D/C,S={distance:D,position:F};if("circle"===t.options.shape?(A=Math.min(D,C),R=t.position,X=A,s={x:0,y:0},Q=b(Q=y),s.x=R.x-X*Math.cos(Q),s.y=R.y-X*Math.sin(Q),h=s):(h=function(a,v,p){return{x:Math.min(Math.max(a.x,v.x-p),v.x+p),y:Math.min(Math.max(a.y,v.y-p),v.y+p)}}(F,t.position,C),A=P(h,t.position)),p.follow){if(D>C){var n=F.x-h.x,q=F.y-h.y;t.position.x+=n,t.position.y+=q,t.el.style.top=t.position.y-(v.box.top+V.y)+"px",t.el.style.left=t.position.x-(v.box.left+V.x)+"px",D=P(F,t.position)}}else F=h,D=A;var T=F.x-t.position.x,j=F.y-t.position.y;t.frontPosition={x:T,y:j},p.dataOnly||(t.ui.front.style.transform="translate("+T+"px,"+j+"px)");var w={identifier:t.identifier,position:F,force:M,pressure:a.force||a.pressure||a.webkitForce||0,distance:D,angle:{radian:Z,degree:y},vector:{x:T/C,y:-j/C},raw:S,instance:t,lockX:p.lockX,lockY:p.lockY};(w=t.computeDirection(w)).angle={radian:b(180-y),degree:180-y},t.trigger("move",w),v.trigger("move "+t.id+":move",w)}else this.processOnEnd(a)},T.prototype.processOnEnd=function(a){var v=this,p=v.options,P=v.manager.getIdentifier(a),b=v.nipples.get(P),L=v.manager.removeIdentifier(b.identifier);b&&(p.dataOnly||b.hide((function(){"dynamic"===p.mode&&(b.trigger("removed",b),v.trigger("removed "+b.id+":removed",b),v.manager.trigger("removed "+b.id+":removed",b),b.destroy())})),clearInterval(v.pressureIntervals[b.identifier]),b.resetDirection(),b.trigger("end",b),v.trigger("end "+b.id+":end",b),v.ids.indexOf(b.identifier)>=0&&v.ids.splice(v.ids.indexOf(b.identifier),1),v.actives.indexOf(b)>=0&&v.actives.splice(v.actives.indexOf(b),1),/(semi|static)/.test(p.mode)?v.idles.push(b):v.nipples.indexOf(b)>=0&&v.nipples.splice(v.nipples.indexOf(b),1),v.manager.unbindDocument(),/(semi|static)/.test(p.mode)&&(v.manager.ids[L.id]=L.identifier))},T.prototype.onDestroyed=function(a,v){var p=this;p.nipples.indexOf(v)>=0&&p.nipples.splice(p.nipples.indexOf(v),1),p.actives.indexOf(v)>=0&&p.actives.splice(p.actives.indexOf(v),1),p.idles.indexOf(v)>=0&&p.idles.splice(p.idles.indexOf(v),1),p.ids.indexOf(v.identifier)>=0&&p.ids.splice(p.ids.indexOf(v.identifier),1),p.manager.removeIdentifier(v.identifier),p.manager.unbindDocument()},T.prototype.destroy=function(){var a=this;for(var v in a.unbindEvt(a.options.zone,"start"),a.nipples.forEach((function(a){a.destroy()})),a.pressureIntervals)a.pressureIntervals.hasOwnProperty(v)&&clearInterval(a.pressureIntervals[v]);a.trigger("destroyed",a.nipples),a.manager.unbindDocument(),a.off()};const j=T;function w(a){var v=this;v.ids={},v.index=0,v.collections=[],v.scroll=F(),v.config(a),v.prepareCollections();var p=function(){var a;v.collections.forEach((function(p){p.forEach((function(p){a=p.el.getBoundingClientRect(),p.position={x:v.scroll.x+a.left,y:v.scroll.y+a.top}}))}))};V(window,"resize",(function(){t(p)}));var P=function(){v.scroll=F()};return V(window,"scroll",(function(){t(P)})),v.collections}w.prototype=new S,w.constructor=w,w.prototype.prepareCollections=function(){var a=this;a.collections.create=a.create.bind(a),a.collections.on=a.on.bind(a),a.collections.off=a.off.bind(a),a.collections.destroy=a.destroy.bind(a),a.collections.get=function(v){var p;return a.collections.every((function(a){return!(p=a.get(v))})),p}},w.prototype.create=function(a){return this.createCollection(a)},w.prototype.createCollection=function(a){var v=this,p=new j(v,a);return v.bindCollection(p),v.collections.push(p),p},w.prototype.bindCollection=function(a){var v,p=this,P=function(a,P){v=a.type+" "+P.id+":"+a.type,p.trigger(v,P)};a.on("destroyed",p.onDestroyed.bind(p)),a.on("shown hidden rested dir plain",P),a.on("dir:up dir:right dir:down dir:left",P),a.on("plain:up plain:right plain:down plain:left",P)},w.prototype.bindDocument=function(){var a=this;a.binded||(a.bindEvt(document,"move").bindEvt(document,"end"),a.binded=!0)},w.prototype.unbindDocument=function(a){var v=this;Object.keys(v.ids).length&&!0!==a||(v.unbindEvt(document,"move").unbindEvt(document,"end"),v.binded=!1)},w.prototype.getIdentifier=function(a){var v;return a?void 0===(v=void 0===a.identifier?a.pointerId:a.identifier)&&(v=this.latest||0):v=this.index,void 0===this.ids[v]&&(this.ids[v]=this.index,this.index+=1),this.latest=v,this.ids[v]},w.prototype.removeIdentifier=function(a){var v={};for(var p in this.ids)if(this.ids[p]===a){v.id=p,v.identifier=this.ids[p],delete this.ids[p];break}return v},w.prototype.onmove=function(a){return this.onAny("move",a),!1},w.prototype.onend=function(a){return this.onAny("end",a),!1},w.prototype.oncancel=function(a){return this.onAny("end",a),!1},w.prototype.onAny=function(a,v){var p,P=this,b="processOn"+a.charAt(0).toUpperCase()+a.slice(1);v=C(v);var L=function(a,v,p){p.ids.indexOf(v)>=0&&(p[b](a),a._found_=!0)};return A(v,(function(a){p=P.getIdentifier(a),A(P.collections,L.bind(null,a,p)),a._found_||P.removeIdentifier(p)})),!1},w.prototype.destroy=function(){var a=this;a.unbindDocument(!0),a.ids={},a.index=0,a.collections.forEach((function(a){a.destroy()})),a.off()},w.prototype.onDestroyed=function(a,v){var p=this;if(p.collections.indexOf(v)<0)return!1;p.collections.splice(p.collections.indexOf(v),1)};var J=new w;const B={create:function(a){return J.create(a)},factory:J};return v.default})(),a.exports=v()},11056:(a,v,p)=>{"use strict";const{Deflate:P,deflate:b,deflateRaw:L,gzip:t}=p(11064),{Inflate:V,inflate:K,inflateRaw:C,ungzip:F}=p(11143),u=p(11112);a.exports.Deflate=P,a.exports.deflate=b,a.exports.deflateRaw=L,a.exports.gzip=t,a.exports.Inflate=V,a.exports.inflate=K,a.exports.inflateRaw=C,a.exports.ungzip=F,a.exports.constants=u},11064:(a,v,p)=>{"use strict";const P=p(11072),b=p(11120),L=p(11129),t=p(11103),V=p(11137),K=Object.prototype.toString,{Z_NO_FLUSH:C,Z_SYNC_FLUSH:F,Z_FULL_FLUSH:u,Z_FINISH:c,Z_OK:f,Z_STREAM_END:H,Z_DEFAULT_COMPRESSION:A,Z_DEFAULT_STRATEGY:h,Z_DEFLATED:R}=p(11112);function X(a){this.options=b.assign({level:A,method:R,Ja:16384,windowBits:15,memLevel:8,strategy:h},a||{});let v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let p=P.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(p!==f)throw new Error(t[p]);if(v.header&&P.deflateSetHeader(this.strm,v.header),v.dictionary){let a;if(a="string"===typeof v.dictionary?L.string2buf(v.dictionary):"[object ArrayBuffer]"===K.call(v.dictionary)?new Uint8Array(v.dictionary):v.dictionary,p=P.deflateSetDictionary(this.strm,a),p!==f)throw new Error(t[p]);this._dict_set=!0}}function Q(a,v){const p=new X(v);if(p.push(a,!0),p.err)throw p.msg||t[p.err];return p.result}X.prototype.push=function(a,v){const p=this.strm,b=this.options.Ja;let t,V;if(this.ended)return!1;for(V=v===~~v?v:!0===v?c:C,"string"===typeof a?p.input=L.string2buf(a):"[object ArrayBuffer]"===K.call(a)?p.input=new Uint8Array(a):p.input=a,p.next_in=0,p.avail_in=p.input.length;;)if(0===p.avail_out&&(p.output=new Uint8Array(b),p.next_out=0,p.avail_out=b),(V===F||V===u)&&p.avail_out<=6)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else{if(t=P.deflate(p,V),t===H)return p.next_out>0&&this.onData(p.output.subarray(0,p.next_out)),t=P.deflateEnd(this.strm),this.onEnd(t),this.ended=!0,t===f;if(0!==p.avail_out){if(V>0&&p.next_out>0)this.onData(p.output.subarray(0,p.next_out)),p.avail_out=0;else if(0===p.avail_in)break}else this.onData(p.output)}return!0},X.prototype.onData=function(a){this.chunks.push(a)},X.prototype.onEnd=function(a){a===f&&(this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},a.exports.Deflate=X,a.exports.deflate=Q,a.exports.deflateRaw=function(a,v){return(v=v||{}).raw=!0,Q(a,v)},a.exports.gzip=function(a,v){return(v=v||{}).gzip=!0,Q(a,v)},a.exports.constants=p(11112)},11143:(a,v,p)=>{"use strict";const P=p(11151),b=p(11120),L=p(11129),t=p(11103),V=p(11137),K=p(11170),C=Object.prototype.toString,{Z_NO_FLUSH:F,Z_FINISH:u,Z_OK:c,Z_STREAM_END:f,Z_NEED_DICT:H,Z_STREAM_ERROR:A,Z_DATA_ERROR:h,Z_MEM_ERROR:R}=p(11112);function X(a){this.options=b.assign({Ja:65536,windowBits:15,to:""},a||{});const v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,0===v.windowBits&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||a&&a.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&0===(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new V,this.strm.avail_out=0;let p=P.inflateInit2(this.strm,v.windowBits);if(p!==c)throw new Error(t[p]);if(this.header=new K,P.inflateGetHeader(this.strm,this.header),v.dictionary&&("string"===typeof v.dictionary?v.dictionary=L.string2buf(v.dictionary):"[object ArrayBuffer]"===C.call(v.dictionary)&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(p=P.inflateSetDictionary(this.strm,v.dictionary),p!==c)))throw new Error(t[p])}function Q(a,v){const p=new X(v);if(p.push(a),p.err)throw p.msg||t[p.err];return p.result}X.prototype.push=function(a,v){const p=this.strm,b=this.options.Ja,t=this.options.dictionary;let V,K,X;if(this.ended)return!1;for(K=v===~~v?v:!0===v?u:F,"[object ArrayBuffer]"===C.call(a)?p.input=new Uint8Array(a):p.input=a,p.next_in=0,p.avail_in=p.input.length;;){for(0===p.avail_out&&(p.output=new Uint8Array(b),p.next_out=0,p.avail_out=b),V=P.inflate(p,K),V===H&&t&&(V=P.inflateSetDictionary(p,t),V===c?V=P.inflate(p,K):V===h&&(V=H));p.avail_in>0&&V===f&&p.state.wrap>0&&0!==a[p.next_in];)P.inflateReset(p),V=P.inflate(p,K);switch(V){case A:case h:case H:case R:return this.onEnd(V),this.ended=!0,!1}if(X=p.avail_out,p.next_out&&(0===p.avail_out||V===f))if("string"===this.options.to){let a=L.utf8border(p.output,p.next_out),v=p.next_out-a,P=L.buf2string(p.output,a);p.next_out=v,p.avail_out=b-v,v&&p.output.set(p.output.subarray(a,a+v),0),this.onData(P)}else this.onData(p.output.length===p.next_out?p.output:p.output.subarray(0,p.next_out));if(V!==c||0!==X){if(V===f)return V=P.inflateEnd(this.strm),this.onEnd(V),this.ended=!0,!0;if(0===p.avail_in)break}}return!0},X.prototype.onData=function(a){this.chunks.push(a)},X.prototype.onEnd=function(a){a===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},a.exports.Inflate=X,a.exports.inflate=Q,a.exports.inflateRaw=function(a,v){return(v=v||{}).raw=!0,Q(a,v)},a.exports.ungzip=Q,a.exports.constants=p(11112)},11120:a=>{"use strict";const v=(a,v)=>Object.prototype.hasOwnProperty.call(a,v);a.exports.assign=function(a){const p=Array.prototype.slice.call(arguments,1);for(;p.length;){const P=p.shift();if(P){if("object"!==typeof P)throw new TypeError(P+"must be non-object");for(const p in P)v(P,p)&&(a[p]=P[p])}}return a},a.exports.flattenChunks=a=>{let v=0;for(let P=0,b=a.length;P<b;P++)v+=a[P].length;const p=new Uint8Array(v);for(let P=0,b=0,L=a.length;P<L;P++){let v=a[P];p.set(v,b),b+=v.length}return p}},11129:a=>{"use strict";let v=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(P){v=!1}const p=new Uint8Array(256);for(let b=0;b<256;b++)p[b]=b>=252?6:b>=248?5:b>=240?4:b>=224?3:b>=192?2:1;p[254]=p[254]=1,a.exports.string2buf=a=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(a);let v,p,P,b,L,t=a.length,V=0;for(b=0;b<t;b++)p=a.charCodeAt(b),55296===(64512&p)&&b+1<t&&(P=a.charCodeAt(b+1),56320===(64512&P)&&(p=65536+(p-55296<<10)+(P-56320),b++)),V+=p<128?1:p<2048?2:p<65536?3:4;for(v=new Uint8Array(V),L=0,b=0;L<V;b++)p=a.charCodeAt(b),55296===(64512&p)&&b+1<t&&(P=a.charCodeAt(b+1),56320===(64512&P)&&(p=65536+(p-55296<<10)+(P-56320),b++)),p<128?v[L++]=p:p<2048?(v[L++]=192|p>>>6,v[L++]=128|63&p):p<65536?(v[L++]=224|p>>>12,v[L++]=128|p>>>6&63,v[L++]=128|63&p):(v[L++]=240|p>>>18,v[L++]=128|p>>>12&63,v[L++]=128|p>>>6&63,v[L++]=128|63&p);return v};a.exports.buf2string=(a,P)=>{const b=P||a.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(a.subarray(0,P));let L,t;const V=new Array(2*b);for(t=0,L=0;L<b;){let v=a[L++];if(v<128){V[t++]=v;continue}let P=p[v];if(P>4)V[t++]=65533,L+=P-1;else{for(v&=2===P?31:3===P?15:7;P>1&&L<b;)v=v<<6|63&a[L++],P--;P>1?V[t++]=65533:v<65536?V[t++]=v:(v-=65536,V[t++]=55296|v>>10&1023,V[t++]=56320|1023&v)}}return((a,p)=>{if(p<65534&&a.subarray&&v)return String.fromCharCode.apply(null,a.length===p?a:a.subarray(0,p));let P="";for(let v=0;v<p;v++)P+=String.fromCharCode(a[v]);return P})(V,t)},a.exports.utf8border=(a,v)=>{(v=v||a.length)>a.length&&(v=a.length);let P=v-1;for(;P>=0&&128===(192&a[P]);)P--;return P<0||0===P?v:P+p[a[P]]>v?P:v}},11088:a=>{"use strict";a.exports=(a,v,p,P)=>{let b=65535&a,L=a>>>16&65535,t=0;for(;0!==p;){t=p>2e3?2e3:p,p-=t;do{b=b+v[P++]|0,L=L+b|0}while(--t);b%=65521,L%=65521}return b|L<<16}},11112:a=>{"use strict";a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11096:a=>{"use strict";const v=new Uint32Array((()=>{let a,v=[];for(var p=0;p<256;p++){a=p;for(var P=0;P<8;P++)a=1&a?3988292384^a>>>1:a>>>1;v[p]=a}return v})());a.exports=(a,p,P,b)=>{const L=v,t=b+P;a^=-1;for(let v=b;v<t;v++)a=a>>>8^L[255&(a^p[v])];return~a}},11072:(a,v,p)=>{"use strict";const{_tr_init:P,_tr_stored_block:b,_tr_flush_block:L,_tr_tally:t,_tr_align:V}=p(11081),K=p(11088),C=p(11096),F=p(11103),{Z_NO_FLUSH:u,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:f,Z_FINISH:H,Z_BLOCK:A,Z_OK:h,Z_STREAM_END:R,Z_STREAM_ERROR:X,Z_DATA_ERROR:Q,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:D,Z_FILTERED:y,Z_HUFFMAN_ONLY:Z,Z_RLE:M,Z_FIXED:S,Z_DEFAULT_STRATEGY:n,Z_UNKNOWN:q,Z_DEFLATED:T}=p(11112),j=258,w=262,J=103,B=113,x=666,r=(a,v)=>(a.msg=F[v],v),o=a=>(a<<1)-(a>4?9:0),m=a=>{let v=a.length;for(;--v>=0;)a[v]=0};let O=(a,v,p)=>(v<<a.hash_shift^p)&a.hash_mask;const Y=a=>{const v=a.state;let p=v.pending;p>a.avail_out&&(p=a.avail_out),0!==p&&(a.output.set(v.pending_buf.subarray(v.pending_out,v.pending_out+p),a.next_out),a.next_out+=p,v.pending_out+=p,a.total_out+=p,a.avail_out-=p,v.pending-=p,0===v.pending&&(v.pending_out=0))},l=(a,v)=>{L(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,v),a.block_start=a.strstart,Y(a.strm)},z=(a,v)=>{a.pending_buf[a.pending++]=v},g=(a,v)=>{a.pending_buf[a.pending++]=v>>>8&255,a.pending_buf[a.pending++]=255&v},G=(a,v,p,P)=>{let b=a.avail_in;return b>P&&(b=P),0===b?0:(a.avail_in-=b,v.set(a.input.subarray(a.next_in,a.next_in+b),p),1===a.state.wrap?a.adler=K(a.adler,v,b,p):2===a.state.wrap&&(a.adler=C(a.adler,v,b,p)),a.next_in+=b,a.total_in+=b,b)},e=(a,v)=>{let p,P,b=a.max_chain_length,L=a.strstart,t=a.prev_length,V=a.nice_match;const K=a.strstart>a.w_size-w?a.strstart-(a.w_size-w):0,C=a.window,F=a.w_mask,u=a.prev,c=a.strstart+j;let f=C[L+t-1],H=C[L+t];a.prev_length>=a.good_match&&(b>>=2),V>a.lookahead&&(V=a.lookahead);do{if(p=v,C[p+t]===H&&C[p+t-1]===f&&C[p]===C[L]&&C[++p]===C[L+1]){L+=2,p++;do{}while(C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&C[++L]===C[++p]&&L<c);if(P=j-(c-L),L=c-j,P>t){if(a.match_start=v,t=P,P>=V)break;f=C[L+t-1],H=C[L+t]}}}while((v=u[v&F])>K&&0!==--b);return t<=a.lookahead?t:a.lookahead},k=a=>{const v=a.w_size;let p,P,b,L,t;do{if(L=a.window_size-a.lookahead-a.strstart,a.strstart>=v+(v-w)){a.window.set(a.window.subarray(v,v+v),0),a.match_start-=v,a.strstart-=v,a.block_start-=v,P=a.hash_size,p=P;do{b=a.head[--p],a.head[p]=b>=v?b-v:0}while(--P);P=v,p=P;do{b=a.prev[--p],a.prev[p]=b>=v?b-v:0}while(--P);L+=v}if(0===a.strm.avail_in)break;if(P=G(a.strm,a.window,a.strstart+a.lookahead,L),a.lookahead+=P,a.lookahead+a.insert>=3)for(t=a.strstart-a.insert,a.ins_h=a.window[t],a.ins_h=O(a,a.ins_h,a.window[t+1]);a.insert&&(a.ins_h=O(a,a.ins_h,a.window[t+3-1]),a.prev[t&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=t,t++,a.insert--,!(a.lookahead+a.insert<3)););}while(a.lookahead<w&&0!==a.strm.avail_in)},d=(a,v)=>{let p,P;for(;;){if(a.lookahead<w){if(k(a),a.lookahead<w&&v===u)return 1;if(0===a.lookahead)break}if(p=0,a.lookahead>=3&&(a.ins_h=O(a,a.ins_h,a.window[a.strstart+3-1]),p=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==p&&a.strstart-p<=a.w_size-w&&(a.match_length=e(a,p)),a.match_length>=3)if(P=t(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=3){a.match_length--;do{a.strstart++,a.ins_h=O(a,a.ins_h,a.window[a.strstart+3-1]),p=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=O(a,a.ins_h,a.window[a.strstart+1]);else P=t(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(P&&(l(a,!1),0===a.strm.avail_out))return 1}return a.insert=a.strstart<2?a.strstart:2,v===H?(l(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(l(a,!1),0===a.strm.avail_out)?1:2},E=(a,v)=>{let p,P,b;for(;;){if(a.lookahead<w){if(k(a),a.lookahead<w&&v===u)return 1;if(0===a.lookahead)break}if(p=0,a.lookahead>=3&&(a.ins_h=O(a,a.ins_h,a.window[a.strstart+3-1]),p=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==p&&a.prev_length<a.max_lazy_match&&a.strstart-p<=a.w_size-w&&(a.match_length=e(a,p),a.match_length<=5&&(a.strategy===y||3===a.match_length&&a.strstart-a.match_start>4096)&&(a.match_length=2)),a.prev_length>=3&&a.match_length<=a.prev_length){b=a.strstart+a.lookahead-3,P=t(a,a.strstart-1-a.prev_match,a.prev_length-3),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=b&&(a.ins_h=O(a,a.ins_h,a.window[a.strstart+3-1]),p=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!==--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,P&&(l(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(P=t(a,0,a.window[a.strstart-1]),P&&l(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(P=t(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<2?a.strstart:2,v===H?(l(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(l(a,!1),0===a.strm.avail_out)?1:2};function W(a,v,p,P,b){this.good_length=a,this.max_lazy=v,this.nice_length=p,this.max_chain=P,this.func=b}const U=[new W(0,0,0,0,((a,v)=>{let p=65535;for(p>a.pending_buf_size-5&&(p=a.pending_buf_size-5);;){if(a.lookahead<=1){if(k(a),0===a.lookahead&&v===u)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;const P=a.block_start+p;if((0===a.strstart||a.strstart>=P)&&(a.lookahead=a.strstart-P,a.strstart=P,l(a,!1),0===a.strm.avail_out))return 1;if(a.strstart-a.block_start>=a.w_size-w&&(l(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,v===H?(l(a,!0),0===a.strm.avail_out?3:4):(a.strstart>a.block_start&&(l(a,!1),a.strm.avail_out),1)})),new W(4,4,8,4,d),new W(4,5,16,8,d),new W(4,6,32,32,d),new W(4,4,16,16,E),new W(8,16,32,32,E),new W(8,16,128,128,E),new W(8,32,128,256,E),new W(32,128,258,1024,E),new W(32,258,258,4096,E)];function N(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const i=a=>{if(!a||!a.state)return r(a,X);a.total_in=a.total_out=0,a.data_type=q;const v=a.state;return v.pending=0,v.pending_out=0,v.wrap<0&&(v.wrap=-v.wrap),v.status=v.wrap?42:B,a.adler=2===v.wrap?0:1,v.last_flush=u,P(v),h},I=a=>{const v=i(a);var p;return v===h&&((p=a.state).window_size=2*p.w_size,m(p.head),p.max_lazy_match=U[p.level].max_lazy,p.good_match=U[p.level].good_length,p.nice_match=U[p.level].nice_length,p.max_chain_length=U[p.level].max_chain,p.strstart=0,p.block_start=0,p.lookahead=0,p.insert=0,p.match_length=p.prev_length=2,p.match_available=0,p.ins_h=0),v},aa=(a,v,p,P,b,L)=>{if(!a)return X;let t=1;if(v===D&&(v=6),P<0?(t=0,P=-P):P>15&&(t=2,P-=16),b<1||b>9||p!==T||P<8||P>15||v<0||v>9||L<0||L>S)return r(a,X);8===P&&(P=9);const V=new N;return a.state=V,V.strm=a,V.wrap=t,V.gzhead=null,V.w_bits=P,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=b+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+3-1)/3),V.window=new Uint8Array(2*V.w_size),V.head=new Uint16Array(V.hash_size),V.prev=new Uint16Array(V.w_size),V.lit_bufsize=1<<b+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new Uint8Array(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=v,V.strategy=L,V.method=p,I(a)};a.exports.deflateInit=(a,v)=>aa(a,v,T,15,8,n),a.exports.deflateInit2=aa,a.exports.deflateReset=I,a.exports.deflateResetKeep=i,a.exports.deflateSetHeader=(a,v)=>a&&a.state?2!==a.state.wrap?X:(a.state.gzhead=v,h):X,a.exports.deflate=(a,v)=>{let p,P;if(!a||!a.state||v>A||v<0)return a?r(a,X):X;const L=a.state;if(!a.output||!a.input&&0!==a.avail_in||L.status===x&&v!==H)return r(a,0===a.avail_out?s:X);L.strm=a;const K=L.last_flush;if(L.last_flush=v,42===L.status)if(2===L.wrap)a.adler=0,z(L,31),z(L,139),z(L,8),L.gzhead?(z(L,(L.gzhead.text?1:0)+(L.gzhead.hcrc?2:0)+(L.gzhead.extra?4:0)+(L.gzhead.name?8:0)+(L.gzhead.comment?16:0)),z(L,255&L.gzhead.time),z(L,L.gzhead.time>>8&255),z(L,L.gzhead.time>>16&255),z(L,L.gzhead.time>>24&255),z(L,9===L.level?2:L.strategy>=Z||L.level<2?4:0),z(L,255&L.gzhead.os),L.gzhead.extra&&L.gzhead.extra.length&&(z(L,255&L.gzhead.extra.length),z(L,L.gzhead.extra.length>>8&255)),L.gzhead.hcrc&&(a.adler=C(a.adler,L.pending_buf,L.pending,0)),L.gzindex=0,L.status=69):(z(L,0),z(L,0),z(L,0),z(L,0),z(L,0),z(L,9===L.level?2:L.strategy>=Z||L.level<2?4:0),z(L,3),L.status=B);else{let v=T+(L.w_bits-8<<4)<<8,p=-1;p=L.strategy>=Z||L.level<2?0:L.level<6?1:6===L.level?2:3,v|=p<<6,0!==L.strstart&&(v|=32),v+=31-v%31,L.status=B,g(L,v),0!==L.strstart&&(g(L,a.adler>>>16),g(L,65535&a.adler)),a.adler=1}if(69===L.status)if(L.gzhead.extra){for(p=L.pending;L.gzindex<(65535&L.gzhead.extra.length)&&(L.pending!==L.pending_buf_size||(L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),Y(a),p=L.pending,L.pending!==L.pending_buf_size));)z(L,255&L.gzhead.extra[L.gzindex]),L.gzindex++;L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),L.gzindex===L.gzhead.extra.length&&(L.gzindex=0,L.status=73)}else L.status=73;if(73===L.status)if(L.gzhead.name){p=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),Y(a),p=L.pending,L.pending===L.pending_buf_size)){P=1;break}P=L.gzindex<L.gzhead.name.length?255&L.gzhead.name.charCodeAt(L.gzindex++):0,z(L,P)}while(0!==P);L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),0===P&&(L.gzindex=0,L.status=91)}else L.status=91;if(91===L.status)if(L.gzhead.comment){p=L.pending;do{if(L.pending===L.pending_buf_size&&(L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),Y(a),p=L.pending,L.pending===L.pending_buf_size)){P=1;break}P=L.gzindex<L.gzhead.comment.length?255&L.gzhead.comment.charCodeAt(L.gzindex++):0,z(L,P)}while(0!==P);L.gzhead.hcrc&&L.pending>p&&(a.adler=C(a.adler,L.pending_buf,L.pending-p,p)),0===P&&(L.status=J)}else L.status=J;if(L.status===J&&(L.gzhead.hcrc?(L.pending+2>L.pending_buf_size&&Y(a),L.pending+2<=L.pending_buf_size&&(z(L,255&a.adler),z(L,a.adler>>8&255),a.adler=0,L.status=B)):L.status=B),0!==L.pending){if(Y(a),0===a.avail_out)return L.last_flush=-1,h}else if(0===a.avail_in&&o(v)<=o(K)&&v!==H)return r(a,s);if(L.status===x&&0!==a.avail_in)return r(a,s);if(0!==a.avail_in||0!==L.lookahead||v!==u&&L.status!==x){let p=L.strategy===Z?((a,v)=>{let p;for(;;){if(0===a.lookahead&&(k(a),0===a.lookahead)){if(v===u)return 1;break}if(a.match_length=0,p=t(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,p&&(l(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,v===H?(l(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(l(a,!1),0===a.strm.avail_out)?1:2})(L,v):L.strategy===M?((a,v)=>{let p,P,b,L;const V=a.window;for(;;){if(a.lookahead<=j){if(k(a),a.lookahead<=j&&v===u)return 1;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(b=a.strstart-1,P=V[b],P===V[++b]&&P===V[++b]&&P===V[++b])){L=a.strstart+j;do{}while(P===V[++b]&&P===V[++b]&&P===V[++b]&&P===V[++b]&&P===V[++b]&&P===V[++b]&&P===V[++b]&&P===V[++b]&&b<L);a.match_length=j-(L-b),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(p=t(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(p=t(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),p&&(l(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,v===H?(l(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(l(a,!1),0===a.strm.avail_out)?1:2})(L,v):U[L.level].func(L,v);if(3!==p&&4!==p||(L.status=x),1===p||3===p)return 0===a.avail_out&&(L.last_flush=-1),h;if(2===p&&(v===c?V(L):v!==A&&(b(L,0,0,!1),v===f&&(m(L.head),0===L.lookahead&&(L.strstart=0,L.block_start=0,L.insert=0))),Y(a),0===a.avail_out))return L.last_flush=-1,h}return v!==H?h:L.wrap<=0?R:(2===L.wrap?(z(L,255&a.adler),z(L,a.adler>>8&255),z(L,a.adler>>16&255),z(L,a.adler>>24&255),z(L,255&a.total_in),z(L,a.total_in>>8&255),z(L,a.total_in>>16&255),z(L,a.total_in>>24&255)):(g(L,a.adler>>>16),g(L,65535&a.adler)),Y(a),L.wrap>0&&(L.wrap=-L.wrap),0!==L.pending?h:R)},a.exports.deflateEnd=a=>{if(!a||!a.state)return X;const v=a.state.status;return 42!==v&&69!==v&&73!==v&&91!==v&&v!==J&&v!==B&&v!==x?r(a,X):(a.state=null,v===B?r(a,Q):h)},a.exports.deflateSetDictionary=(a,v)=>{let p=v.length;if(!a||!a.state)return X;const P=a.state,b=P.wrap;if(2===b||1===b&&42!==P.status||P.lookahead)return X;if(1===b&&(a.adler=K(a.adler,v,p,0)),P.wrap=0,p>=P.w_size){0===b&&(m(P.head),P.strstart=0,P.block_start=0,P.insert=0);let a=new Uint8Array(P.w_size);a.set(v.subarray(p-P.w_size,p),0),v=a,p=P.w_size}const L=a.avail_in,t=a.next_in,V=a.input;for(a.avail_in=p,a.next_in=0,a.input=v,k(P);P.lookahead>=3;){let a=P.strstart,v=P.lookahead-2;do{P.ins_h=O(P,P.ins_h,P.window[a+3-1]),P.prev[a&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=a,a++}while(--v);P.strstart=a,P.lookahead=2,k(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=2,P.match_available=0,a.next_in=t,a.input=V,a.avail_in=L,P.wrap=b,h},a.exports.deflateInfo="pako deflate (from Nodeca project)"},11170:a=>{"use strict";a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11159:a=>{"use strict";a.exports=function(a,v){let p,P,b,L,t,V,K,C,F,u,c,f,H,A,h,R,X,Q,s,D,y,Z,M,S;const n=a.state;p=a.next_in,M=a.input,P=p+(a.avail_in-5),b=a.next_out,S=a.output,L=b-(v-a.avail_out),t=b+(a.avail_out-257),V=n.dmax,K=n.wsize,C=n.whave,F=n.wnext,u=n.window,c=n.hold,f=n.bits,H=n.lencode,A=n.distcode,h=(1<<n.lenbits)-1,R=(1<<n.distbits)-1;a:do{f<15&&(c+=M[p++]<<f,f+=8,c+=M[p++]<<f,f+=8),X=H[c&h];v:for(;;){if(Q=X>>>24,c>>>=Q,f-=Q,Q=X>>>16&255,0===Q)S[b++]=65535&X;else{if(!(16&Q)){if(0===(64&Q)){X=H[(65535&X)+(c&(1<<Q)-1)];continue v}if(32&Q){n.mode=12;break a}a.msg="invalid literal/length code",n.mode=30;break a}s=65535&X,Q&=15,Q&&(f<Q&&(c+=M[p++]<<f,f+=8),s+=c&(1<<Q)-1,c>>>=Q,f-=Q),f<15&&(c+=M[p++]<<f,f+=8,c+=M[p++]<<f,f+=8),X=A[c&R];p:for(;;){if(Q=X>>>24,c>>>=Q,f-=Q,Q=X>>>16&255,!(16&Q)){if(0===(64&Q)){X=A[(65535&X)+(c&(1<<Q)-1)];continue p}a.msg="invalid distance code",n.mode=30;break a}if(D=65535&X,Q&=15,f<Q&&(c+=M[p++]<<f,f+=8,f<Q&&(c+=M[p++]<<f,f+=8)),D+=c&(1<<Q)-1,D>V){a.msg="invalid distance too far back",n.mode=30;break a}if(c>>>=Q,f-=Q,Q=b-L,D>Q){if(Q=D-Q,Q>C&&n.sane){a.msg="invalid distance too far back",n.mode=30;break a}if(y=0,Z=u,0===F){if(y+=K-Q,Q<s){s-=Q;do{S[b++]=u[y++]}while(--Q);y=b-D,Z=S}}else if(F<Q){if(y+=K+F-Q,Q-=F,Q<s){s-=Q;do{S[b++]=u[y++]}while(--Q);if(y=0,F<s){Q=F,s-=Q;do{S[b++]=u[y++]}while(--Q);y=b-D,Z=S}}}else if(y+=F-Q,Q<s){s-=Q;do{S[b++]=u[y++]}while(--Q);y=b-D,Z=S}for(;s>2;)S[b++]=Z[y++],S[b++]=Z[y++],S[b++]=Z[y++],s-=3;s&&(S[b++]=Z[y++],s>1&&(S[b++]=Z[y++]))}else{y=b-D;do{S[b++]=S[y++],S[b++]=S[y++],S[b++]=S[y++],s-=3}while(s>2);s&&(S[b++]=S[y++],s>1&&(S[b++]=S[y++]))}break}}break}}while(p<P&&b<t);s=f>>3,p-=s,f-=s<<3,c&=(1<<f)-1,a.next_in=p,a.next_out=b,a.avail_in=p<P?P-p+5:5-(p-P),a.avail_out=b<t?t-b+257:257-(b-t),n.hold=c,n.bits=f}},11151:(a,v,p)=>{"use strict";const P=p(11088),b=p(11096),L=p(11159),t=p(11164),{Z_FINISH:V,Z_BLOCK:K,Z_TREES:C,Z_OK:F,Z_STREAM_END:u,Z_NEED_DICT:c,Z_STREAM_ERROR:f,Z_DATA_ERROR:H,Z_MEM_ERROR:A,Z_BUF_ERROR:h,Z_DEFLATED:R}=p(11112),X=12,Q=30,s=a=>(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24);function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const y=a=>{if(!a||!a.state)return f;const v=a.state;return a.total_in=a.total_out=v.total=0,a.msg="",v.wrap&&(a.adler=1&v.wrap),v.mode=1,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new Int32Array(852),v.distcode=v.distdyn=new Int32Array(592),v.sane=1,v.back=-1,F},Z=a=>{if(!a||!a.state)return f;const v=a.state;return v.wsize=0,v.whave=0,v.wnext=0,y(a)},M=(a,v)=>{let p;if(!a||!a.state)return f;const P=a.state;return v<0?(p=0,v=-v):(p=1+(v>>4),v<48&&(v&=15)),v&&(v<8||v>15)?f:(null!==P.window&&P.wbits!==v&&(P.window=null),P.wrap=p,P.wbits=v,Z(a))},S=(a,v)=>{if(!a)return f;const p=new D;a.state=p,p.window=null;const P=M(a,v);return P!==F&&(a.state=null),P};let n,q,T=!0;const j=a=>{if(T){n=new Int32Array(512),q=new Int32Array(32);let v=0;for(;v<144;)a.lens[v++]=8;for(;v<256;)a.lens[v++]=9;for(;v<280;)a.lens[v++]=7;for(;v<288;)a.lens[v++]=8;for(t(1,a.lens,0,288,n,0,a.work,{bits:9}),v=0;v<32;)a.lens[v++]=5;t(2,a.lens,0,32,q,0,a.work,{bits:5}),T=!1}a.lencode=n,a.lenbits=9,a.distcode=q,a.distbits=5},w=(a,v,p,P)=>{let b;const L=a.state;return null===L.window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Uint8Array(L.wsize)),P>=L.wsize?(L.window.set(v.subarray(p-L.wsize,p),0),L.wnext=0,L.whave=L.wsize):(b=L.wsize-L.wnext,b>P&&(b=P),L.window.set(v.subarray(p-P,p-P+b),L.wnext),(P-=b)?(L.window.set(v.subarray(p-P,p),0),L.wnext=P,L.whave=L.wsize):(L.wnext+=b,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=b))),0};a.exports.inflateReset=Z,a.exports.inflateReset2=M,a.exports.inflateResetKeep=y,a.exports.inflateInit=a=>S(a,15),a.exports.inflateInit2=S,a.exports.inflate=(a,v)=>{let p,D,y,Z,M,S,n,q,T,J,B,x,r,o,m,O,Y,l,z,g,G,e,k=0;const d=new Uint8Array(4);let E,W;const U=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return f;p=a.state,p.mode===X&&(p.mode=13),M=a.next_out,y=a.output,n=a.avail_out,Z=a.next_in,D=a.input,S=a.avail_in,q=p.hold,T=p.bits,J=S,B=n,e=F;a:for(;;)switch(p.mode){case 1:if(0===p.wrap){p.mode=13;break}for(;T<16;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(2&p.wrap&&35615===q){p.check=0,d[0]=255&q,d[1]=q>>>8&255,p.check=b(p.check,d,2,0),q=0,T=0,p.mode=2;break}if(p.flags=0,p.head&&(p.head.done=!1),!(1&p.wrap)||(((255&q)<<8)+(q>>8))%31){a.msg="incorrect header check",p.mode=Q;break}if((15&q)!==R){a.msg="unknown compression method",p.mode=Q;break}if(q>>>=4,T-=4,G=8+(15&q),0===p.wbits)p.wbits=G;else if(G>p.wbits){a.msg="invalid window size",p.mode=Q;break}p.dmax=1<<p.wbits,a.adler=p.check=1,p.mode=512&q?10:X,q=0,T=0;break;case 2:for(;T<16;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(p.flags=q,(255&p.flags)!==R){a.msg="unknown compression method",p.mode=Q;break}if(57344&p.flags){a.msg="unknown header flags set",p.mode=Q;break}p.head&&(p.head.text=q>>8&1),512&p.flags&&(d[0]=255&q,d[1]=q>>>8&255,p.check=b(p.check,d,2,0)),q=0,T=0,p.mode=3;case 3:for(;T<32;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.head&&(p.head.time=q),512&p.flags&&(d[0]=255&q,d[1]=q>>>8&255,d[2]=q>>>16&255,d[3]=q>>>24&255,p.check=b(p.check,d,4,0)),q=0,T=0,p.mode=4;case 4:for(;T<16;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.head&&(p.head.xflags=255&q,p.head.os=q>>8),512&p.flags&&(d[0]=255&q,d[1]=q>>>8&255,p.check=b(p.check,d,2,0)),q=0,T=0,p.mode=5;case 5:if(1024&p.flags){for(;T<16;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.length=q,p.head&&(p.head.extra_len=q),512&p.flags&&(d[0]=255&q,d[1]=q>>>8&255,p.check=b(p.check,d,2,0)),q=0,T=0}else p.head&&(p.head.extra=null);p.mode=6;case 6:if(1024&p.flags&&(x=p.length,x>S&&(x=S),x&&(p.head&&(G=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Uint8Array(p.head.extra_len)),p.head.extra.set(D.subarray(Z,Z+x),G)),512&p.flags&&(p.check=b(p.check,D,x,Z)),S-=x,Z+=x,p.length-=x),p.length))break a;p.length=0,p.mode=7;case 7:if(2048&p.flags){if(0===S)break a;x=0;do{G=D[Z+x++],p.head&&G&&p.length<65536&&(p.head.name+=String.fromCharCode(G))}while(G&&x<S);if(512&p.flags&&(p.check=b(p.check,D,x,Z)),S-=x,Z+=x,G)break a}else p.head&&(p.head.name=null);p.length=0,p.mode=8;case 8:if(4096&p.flags){if(0===S)break a;x=0;do{G=D[Z+x++],p.head&&G&&p.length<65536&&(p.head.comment+=String.fromCharCode(G))}while(G&&x<S);if(512&p.flags&&(p.check=b(p.check,D,x,Z)),S-=x,Z+=x,G)break a}else p.head&&(p.head.comment=null);p.mode=9;case 9:if(512&p.flags){for(;T<16;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(q!==(65535&p.check)){a.msg="header crc mismatch",p.mode=Q;break}q=0,T=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),a.adler=p.check=0,p.mode=X;break;case 10:for(;T<32;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}a.adler=p.check=s(q),q=0,T=0,p.mode=11;case 11:if(0===p.havedict)return a.next_out=M,a.avail_out=n,a.next_in=Z,a.avail_in=S,p.hold=q,p.bits=T,c;a.adler=p.check=1,p.mode=X;case X:if(v===K||v===C)break a;case 13:if(p.last){q>>>=7&T,T-=7&T,p.mode=27;break}for(;T<3;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}switch(p.last=1&q,q>>>=1,T-=1,3&q){case 0:p.mode=14;break;case 1:if(j(p),p.mode=20,v===C){q>>>=2,T-=2;break a}break;case 2:p.mode=17;break;case 3:a.msg="invalid block type",p.mode=Q}q>>>=2,T-=2;break;case 14:for(q>>>=7&T,T-=7&T;T<32;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if((65535&q)!==(q>>>16^65535)){a.msg="invalid stored block lengths",p.mode=Q;break}if(p.length=65535&q,q=0,T=0,p.mode=15,v===C)break a;case 15:p.mode=16;case 16:if(x=p.length,x){if(x>S&&(x=S),x>n&&(x=n),0===x)break a;y.set(D.subarray(Z,Z+x),M),S-=x,Z+=x,n-=x,M+=x,p.length-=x;break}p.mode=X;break;case 17:for(;T<14;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(p.nlen=257+(31&q),q>>>=5,T-=5,p.ndist=1+(31&q),q>>>=5,T-=5,p.ncode=4+(15&q),q>>>=4,T-=4,p.nlen>286||p.ndist>30){a.msg="too many length or distance symbols",p.mode=Q;break}p.have=0,p.mode=18;case 18:for(;p.have<p.ncode;){for(;T<3;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.lens[U[p.have++]]=7&q,q>>>=3,T-=3}for(;p.have<19;)p.lens[U[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,E={bits:p.lenbits},e=t(0,p.lens,0,19,p.lencode,0,p.work,E),p.lenbits=E.bits,e){a.msg="invalid code lengths set",p.mode=Q;break}p.have=0,p.mode=19;case 19:for(;p.have<p.nlen+p.ndist;){for(;k=p.lencode[q&(1<<p.lenbits)-1],m=k>>>24,O=k>>>16&255,Y=65535&k,!(m<=T);){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(Y<16)q>>>=m,T-=m,p.lens[p.have++]=Y;else{if(16===Y){for(W=m+2;T<W;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(q>>>=m,T-=m,0===p.have){a.msg="invalid bit length repeat",p.mode=Q;break}G=p.lens[p.have-1],x=3+(3&q),q>>>=2,T-=2}else if(17===Y){for(W=m+3;T<W;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}q>>>=m,T-=m,G=0,x=3+(7&q),q>>>=3,T-=3}else{for(W=m+7;T<W;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}q>>>=m,T-=m,G=0,x=11+(127&q),q>>>=7,T-=7}if(p.have+x>p.nlen+p.ndist){a.msg="invalid bit length repeat",p.mode=Q;break}for(;x--;)p.lens[p.have++]=G}}if(p.mode===Q)break;if(0===p.lens[256]){a.msg="invalid code -- missing end-of-block",p.mode=Q;break}if(p.lenbits=9,E={bits:p.lenbits},e=t(1,p.lens,0,p.nlen,p.lencode,0,p.work,E),p.lenbits=E.bits,e){a.msg="invalid literal/lengths set",p.mode=Q;break}if(p.distbits=6,p.distcode=p.distdyn,E={bits:p.distbits},e=t(2,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,E),p.distbits=E.bits,e){a.msg="invalid distances set",p.mode=Q;break}if(p.mode=20,v===C)break a;case 20:p.mode=21;case 21:if(S>=6&&n>=258){a.next_out=M,a.avail_out=n,a.next_in=Z,a.avail_in=S,p.hold=q,p.bits=T,L(a,B),M=a.next_out,y=a.output,n=a.avail_out,Z=a.next_in,D=a.input,S=a.avail_in,q=p.hold,T=p.bits,p.mode===X&&(p.back=-1);break}for(p.back=0;k=p.lencode[q&(1<<p.lenbits)-1],m=k>>>24,O=k>>>16&255,Y=65535&k,!(m<=T);){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(O&&0===(240&O)){for(l=m,z=O,g=Y;k=p.lencode[g+((q&(1<<l+z)-1)>>l)],m=k>>>24,O=k>>>16&255,Y=65535&k,!(l+m<=T);){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}q>>>=l,T-=l,p.back+=l}if(q>>>=m,T-=m,p.back+=m,p.length=Y,0===O){p.mode=26;break}if(32&O){p.back=-1,p.mode=X;break}if(64&O){a.msg="invalid literal/length code",p.mode=Q;break}p.extra=15&O,p.mode=22;case 22:if(p.extra){for(W=p.extra;T<W;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.length+=q&(1<<p.extra)-1,q>>>=p.extra,T-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=23;case 23:for(;k=p.distcode[q&(1<<p.distbits)-1],m=k>>>24,O=k>>>16&255,Y=65535&k,!(m<=T);){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(0===(240&O)){for(l=m,z=O,g=Y;k=p.distcode[g+((q&(1<<l+z)-1)>>l)],m=k>>>24,O=k>>>16&255,Y=65535&k,!(l+m<=T);){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}q>>>=l,T-=l,p.back+=l}if(q>>>=m,T-=m,p.back+=m,64&O){a.msg="invalid distance code",p.mode=Q;break}p.offset=Y,p.extra=15&O,p.mode=24;case 24:if(p.extra){for(W=p.extra;T<W;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}p.offset+=q&(1<<p.extra)-1,q>>>=p.extra,T-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){a.msg="invalid distance too far back",p.mode=Q;break}p.mode=25;case 25:if(0===n)break a;if(x=B-n,p.offset>x){if(x=p.offset-x,x>p.whave&&p.sane){a.msg="invalid distance too far back",p.mode=Q;break}x>p.wnext?(x-=p.wnext,r=p.wsize-x):r=p.wnext-x,x>p.length&&(x=p.length),o=p.window}else o=y,r=M-p.offset,x=p.length;x>n&&(x=n),n-=x,p.length-=x;do{y[M++]=o[r++]}while(--x);0===p.length&&(p.mode=21);break;case 26:if(0===n)break a;y[M++]=p.length,n--,p.mode=21;break;case 27:if(p.wrap){for(;T<32;){if(0===S)break a;S--,q|=D[Z++]<<T,T+=8}if(B-=n,a.total_out+=B,p.total+=B,B&&(a.adler=p.check=p.flags?b(p.check,y,B,M-B):P(p.check,y,B,M-B)),B=n,(p.flags?q:s(q))!==p.check){a.msg="incorrect data check",p.mode=Q;break}q=0,T=0}p.mode=28;case 28:if(p.wrap&&p.flags){for(;T<32;){if(0===S)break a;S--,q+=D[Z++]<<T,T+=8}if(q!==(4294967295&p.total)){a.msg="incorrect length check",p.mode=Q;break}q=0,T=0}p.mode=29;case 29:e=u;break a;case Q:e=H;break a;case 31:return A;default:return f}return a.next_out=M,a.avail_out=n,a.next_in=Z,a.avail_in=S,p.hold=q,p.bits=T,(p.wsize||B!==a.avail_out&&p.mode<Q&&(p.mode<27||v!==V))&&w(a,a.output,a.next_out,B-a.avail_out)?(p.mode=31,A):(J-=a.avail_in,B-=a.avail_out,a.total_in+=J,a.total_out+=B,p.total+=B,p.wrap&&B&&(a.adler=p.check=p.flags?b(p.check,y,B,a.next_out-B):P(p.check,y,B,a.next_out-B)),a.data_type=p.bits+(p.last?64:0)+(p.mode===X?128:0)+(20===p.mode||15===p.mode?256:0),(0===J&&0===B||v===V)&&e===F&&(e=h),e)},a.exports.inflateEnd=a=>{if(!a||!a.state)return f;let v=a.state;return v.window&&(v.window=null),a.state=null,F},a.exports.inflateGetHeader=(a,v)=>{if(!a||!a.state)return f;const p=a.state;return 0===(2&p.wrap)?f:(p.head=v,v.done=!1,F)},a.exports.inflateSetDictionary=(a,v)=>{const p=v.length;let b,L,t;return a&&a.state?(b=a.state,0!==b.wrap&&11!==b.mode?f:11===b.mode&&(L=1,L=P(L,v,p,0),L!==b.check)?H:(t=w(a,v,p,p),t?(b.mode=31,A):(b.havedict=1,F))):f},a.exports.inflateInfo="pako inflate (from Nodeca project)"},11164:a=>{"use strict";const v=15,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),P=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),b=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),L=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);a.exports=(a,t,V,K,C,F,u,c)=>{const f=c.bits;let H,A,h,R,X,Q,s=0,D=0,y=0,Z=0,M=0,S=0,n=0,q=0,T=0,j=0,w=null,J=0;const B=new Uint16Array(16),x=new Uint16Array(16);let r,o,m,O=null,Y=0;for(s=0;s<=v;s++)B[s]=0;for(D=0;D<K;D++)B[t[V+D]]++;for(M=f,Z=v;Z>=1&&0===B[Z];Z--);if(M>Z&&(M=Z),0===Z)return C[F++]=20971520,C[F++]=20971520,c.bits=1,0;for(y=1;y<Z&&0===B[y];y++);for(M<y&&(M=y),q=1,s=1;s<=v;s++)if(q<<=1,q-=B[s],q<0)return-1;if(q>0&&(0===a||1!==Z))return-1;for(x[1]=0,s=1;s<v;s++)x[s+1]=x[s]+B[s];for(D=0;D<K;D++)0!==t[V+D]&&(u[x[t[V+D]]++]=D);if(0===a?(w=O=u,Q=19):1===a?(w=p,J-=257,O=P,Y-=257,Q=256):(w=b,O=L,Q=-1),j=0,D=0,s=y,X=F,S=M,n=0,h=-1,T=1<<M,R=T-1,1===a&&T>852||2===a&&T>592)return 1;for(;;){r=s-n,u[D]<Q?(o=0,m=u[D]):u[D]>Q?(o=O[Y+u[D]],m=w[J+u[D]]):(o=96,m=0),H=1<<s-n,A=1<<S,y=A;do{A-=H,C[X+(j>>n)+A]=r<<24|o<<16|m}while(0!==A);for(H=1<<s-1;j&H;)H>>=1;if(0!==H?(j&=H-1,j+=H):j=0,D++,0===--B[s]){if(s===Z)break;s=t[V+u[D]]}if(s>M&&(j&R)!==h){for(0===n&&(n=M),X+=y,S=s-n,q=1<<S;S+n<Z&&(q-=B[S+n],!(q<=0));)S++,q<<=1;if(T+=1<<S,1===a&&T>852||2===a&&T>592)return 1;h=j&R,C[h]=M<<24|S<<16|X-F}}return 0!==j&&(C[X+j]=s-n<<24|64<<16),c.bits=M,0}},11103:a=>{"use strict";a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11081:a=>{"use strict";function v(a){let v=a.length;for(;--v>=0;)a[v]=0}const p=256,P=286,b=30,L=15,t=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),V=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),K=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),F=new Array(576);v(F);const u=new Array(60);v(u);const c=new Array(512);v(c);const f=new Array(256);v(f);const H=new Array(29);v(H);const A=new Array(b);function h(a,v,p,P,b){this.static_tree=a,this.extra_bits=v,this.extra_base=p,this.elems=P,this.max_length=b,this.has_stree=a&&a.length}let R,X,Q;function s(a,v){this.dyn_tree=a,this.max_code=0,this.stat_desc=v}v(A);const D=a=>a<256?c[a]:c[256+(a>>>7)],y=(a,v)=>{a.pending_buf[a.pending++]=255&v,a.pending_buf[a.pending++]=v>>>8&255},Z=(a,v,p)=>{a.bi_valid>16-p?(a.bi_buf|=v<<a.bi_valid&65535,y(a,a.bi_buf),a.bi_buf=v>>16-a.bi_valid,a.bi_valid+=p-16):(a.bi_buf|=v<<a.bi_valid&65535,a.bi_valid+=p)},M=(a,v,p)=>{Z(a,p[2*v],p[2*v+1])},S=(a,v)=>{let p=0;do{p|=1&a,a>>>=1,p<<=1}while(--v>0);return p>>>1},n=(a,v,p)=>{const P=new Array(16);let b,t,V=0;for(b=1;b<=L;b++)P[b]=V=V+p[b-1]<<1;for(t=0;t<=v;t++){let v=a[2*t+1];0!==v&&(a[2*t]=S(P[v]++,v))}},q=a=>{let v;for(v=0;v<P;v++)a.dyn_ltree[2*v]=0;for(v=0;v<b;v++)a.dyn_dtree[2*v]=0;for(v=0;v<19;v++)a.bl_tree[2*v]=0;a.dyn_ltree[512]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0},T=a=>{a.bi_valid>8?y(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0},j=(a,v,p,P)=>{const b=2*v,L=2*p;return a[b]<a[L]||a[b]===a[L]&&P[v]<=P[p]},w=(a,v,p)=>{const P=a.heap[p];let b=p<<1;for(;b<=a.heap_len&&(b<a.heap_len&&j(v,a.heap[b+1],a.heap[b],a.depth)&&b++,!j(v,P,a.heap[b],a.depth));)a.heap[p]=a.heap[b],p=b,b<<=1;a.heap[p]=P},J=(a,v,P)=>{let b,L,K,C,F=0;if(0!==a.last_lit)do{b=a.pending_buf[a.d_buf+2*F]<<8|a.pending_buf[a.d_buf+2*F+1],L=a.pending_buf[a.l_buf+F],F++,0===b?M(a,L,v):(K=f[L],M(a,K+p+1,v),C=t[K],0!==C&&(L-=H[K],Z(a,L,C)),b--,K=D(b),M(a,K,P),C=V[K],0!==C&&(b-=A[K],Z(a,b,C)))}while(F<a.last_lit);M(a,256,v)},B=(a,v)=>{const p=v.dyn_tree,P=v.stat_desc.static_tree,b=v.stat_desc.has_stree,t=v.stat_desc.elems;let V,K,C,F=-1;for(a.heap_len=0,a.heap_max=573,V=0;V<t;V++)0!==p[2*V]?(a.heap[++a.heap_len]=F=V,a.depth[V]=0):p[2*V+1]=0;for(;a.heap_len<2;)C=a.heap[++a.heap_len]=F<2?++F:0,p[2*C]=1,a.depth[C]=0,a.opt_len--,b&&(a.static_len-=P[2*C+1]);for(v.max_code=F,V=a.heap_len>>1;V>=1;V--)w(a,p,V);C=t;do{V=a.heap[1],a.heap[1]=a.heap[a.heap_len--],w(a,p,1),K=a.heap[1],a.heap[--a.heap_max]=V,a.heap[--a.heap_max]=K,p[2*C]=p[2*V]+p[2*K],a.depth[C]=(a.depth[V]>=a.depth[K]?a.depth[V]:a.depth[K])+1,p[2*V+1]=p[2*K+1]=C,a.heap[1]=C++,w(a,p,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],((a,v)=>{const p=v.dyn_tree,P=v.max_code,b=v.stat_desc.static_tree,t=v.stat_desc.has_stree,V=v.stat_desc.extra_bits,K=v.stat_desc.extra_base,C=v.stat_desc.max_length;let F,u,c,f,H,A,h=0;for(f=0;f<=L;f++)a.bl_count[f]=0;for(p[2*a.heap[a.heap_max]+1]=0,F=a.heap_max+1;F<573;F++)u=a.heap[F],f=p[2*p[2*u+1]+1]+1,f>C&&(f=C,h++),p[2*u+1]=f,u>P||(a.bl_count[f]++,H=0,u>=K&&(H=V[u-K]),A=p[2*u],a.opt_len+=A*(f+H),t&&(a.static_len+=A*(b[2*u+1]+H)));if(0!==h){do{for(f=C-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[C]--,h-=2}while(h>0);for(f=C;0!==f;f--)for(u=a.bl_count[f];0!==u;)c=a.heap[--F],c>P||(p[2*c+1]!==f&&(a.opt_len+=(f-p[2*c+1])*p[2*c],p[2*c+1]=f),u--)}})(a,v),n(p,F,a.bl_count)},x=(a,v,p)=>{let P,b,L=-1,t=v[1],V=0,K=7,C=4;for(0===t&&(K=138,C=3),v[2*(p+1)+1]=65535,P=0;P<=p;P++)b=t,t=v[2*(P+1)+1],++V<K&&b===t||(V<C?a.bl_tree[2*b]+=V:0!==b?(b!==L&&a.bl_tree[2*b]++,a.bl_tree[32]++):V<=10?a.bl_tree[34]++:a.bl_tree[36]++,V=0,L=b,0===t?(K=138,C=3):b===t?(K=6,C=3):(K=7,C=4))},r=(a,v,p)=>{let P,b,L=-1,t=v[1],V=0,K=7,C=4;for(0===t&&(K=138,C=3),P=0;P<=p;P++)if(b=t,t=v[2*(P+1)+1],!(++V<K&&b===t)){if(V<C)do{M(a,b,a.bl_tree)}while(0!==--V);else 0!==b?(b!==L&&(M(a,b,a.bl_tree),V--),M(a,16,a.bl_tree),Z(a,V-3,2)):V<=10?(M(a,17,a.bl_tree),Z(a,V-3,3)):(M(a,18,a.bl_tree),Z(a,V-11,7));V=0,L=b,0===t?(K=138,C=3):b===t?(K=6,C=3):(K=7,C=4)}};let o=!1;const m=(a,v,p,P)=>{Z(a,0+(P?1:0),3),((a,v,p,P)=>{T(a),P&&(y(a,p),y(a,~p)),a.pending_buf.set(a.window.subarray(v,v+p),a.pending),a.pending+=p})(a,v,p,!0)};a.exports._tr_init=a=>{o||((()=>{let a,v,p,C,s;const D=new Array(16);for(p=0,C=0;C<28;C++)for(H[C]=p,a=0;a<1<<t[C];a++)f[p++]=C;for(f[p-1]=C,s=0,C=0;C<16;C++)for(A[C]=s,a=0;a<1<<V[C];a++)c[s++]=C;for(s>>=7;C<b;C++)for(A[C]=s<<7,a=0;a<1<<V[C]-7;a++)c[256+s++]=C;for(v=0;v<=L;v++)D[v]=0;for(a=0;a<=143;)F[2*a+1]=8,a++,D[8]++;for(;a<=255;)F[2*a+1]=9,a++,D[9]++;for(;a<=279;)F[2*a+1]=7,a++,D[7]++;for(;a<=287;)F[2*a+1]=8,a++,D[8]++;for(n(F,287,D),a=0;a<b;a++)u[2*a+1]=5,u[2*a]=S(a,5);R=new h(F,t,257,P,L),X=new h(u,V,0,b,L),Q=new h(new Array(0),K,0,19,7)})(),o=!0),a.l_desc=new s(a.dyn_ltree,R),a.d_desc=new s(a.dyn_dtree,X),a.bl_desc=new s(a.bl_tree,Q),a.bi_buf=0,a.bi_valid=0,q(a)},a.exports._tr_stored_block=m,a.exports._tr_flush_block=(a,v,P,b)=>{let L,t,V=0;a.level>0?(2===a.strm.data_type&&(a.strm.data_type=(a=>{let v,P=4093624447;for(v=0;v<=31;v++,P>>>=1)if(1&P&&0!==a.dyn_ltree[2*v])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(v=32;v<p;v++)if(0!==a.dyn_ltree[2*v])return 1;return 0})(a)),B(a,a.l_desc),B(a,a.d_desc),V=(a=>{let v;for(x(a,a.dyn_ltree,a.l_desc.max_code),x(a,a.dyn_dtree,a.d_desc.max_code),B(a,a.bl_desc),v=18;v>=3&&0===a.bl_tree[2*C[v]+1];v--);return a.opt_len+=3*(v+1)+5+5+4,v})(a),L=a.opt_len+3+7>>>3,t=a.static_len+3+7>>>3,t<=L&&(L=t)):L=t=P+5,P+4<=L&&-1!==v?m(a,v,P,b):4===a.strategy||t===L?(Z(a,2+(b?1:0),3),J(a,F,u)):(Z(a,4+(b?1:0),3),((a,v,p,P)=>{let b;for(Z(a,v-257,5),Z(a,p-1,5),Z(a,P-4,4),b=0;b<P;b++)Z(a,a.bl_tree[2*C[b]+1],3);r(a,a.dyn_ltree,v-1),r(a,a.dyn_dtree,p-1)})(a,a.l_desc.max_code+1,a.d_desc.max_code+1,V+1),J(a,a.dyn_ltree,a.dyn_dtree)),q(a),b&&T(a)},a.exports._tr_tally=(a,v,P)=>(a.pending_buf[a.d_buf+2*a.last_lit]=v>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&v,a.pending_buf[a.l_buf+a.last_lit]=255&P,a.last_lit++,0===v?a.dyn_ltree[2*P]++:(a.matches++,v--,a.dyn_ltree[2*(f[P]+p+1)]++,a.dyn_dtree[2*D(v)]++),a.last_lit===a.lit_bufsize-1),a.exports._tr_align=a=>{Z(a,2,3),M(a,256,F),(a=>{16===a.bi_valid?(y(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)})(a)}},11137:a=>{"use strict";a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12123:a=>{function v(a,v,p){for(var P=a.length,b=-1/0,L=1/0,t=0;t<P;t++){var V=(p[0][t]-a[t])/v[t],K=(p[1][t]-a[t])/v[t];if(V>K){var C=V;V=K,K=C}if(K<b||V>L)return 1/0;V>b&&(b=V),K<L&&(L=K)}return b>L?1/0:b}a.exports=function(a,p,P,b){var L=v(p,P,b);if(L===1/0)a=null;else{a=a||[];for(var t=0;t<p.length;t++)a[t]=p[t]+P[t]*L}return a},a.exports.distance=v},12857:(a,v,p)=>{"use strict";p.d(v,{c:()=>t});var P=p(29);const b=P.useLayoutEffect;const L=function(a){var v=(0,P.useRef)(a);return b((function(){v.current=a})),v};var t=function(a){var v=L(a);(0,P.lb)((function(){var a=function(a){var p;if(null!=v.current&&(p=v.current(a)),a.defaultPrevented&&(a.returnValue=""),"string"===typeof p)return a.returnValue=p,p};return window.addEventListener("beforeunload",a),function(){window.removeEventListener("beforeunload",a)}}),[])}},12819:(a,v,p)=>{"use strict";var P=p(12827),b=Array.prototype.concat,L=Array.prototype.slice,t=a.exports=function(a){for(var v=[],p=0,t=a.length;p<t;p++){var V=a[p];P(V)?v=b.call(v,L.call(V)):v.push(V)}return v};t.wrap=function(a){return function(){return a(t(arguments))}}},12827:a=>{a.exports=function(a){return!(!a||"string"===typeof a)&&(a instanceof Array||Array.isArray(a)||a.length>=0&&(a.splice instanceof Function||Object.getOwnPropertyDescriptor(a,a.length-1)&&"String"!==a.constructor.name))}},10854:(a,v,p)=>{var P=p(10861);function b(a){for(var v,p,b=0,L=a.length,t=0;t<a.length;){for(v=a[t],p=0;t<L&&a[t]===v;)++t,++p;b+=P.log2(p)/7|0,b+=P.log2(v>>>0)/7|0,b+=2}return b}v.size=b,v.encode=function(a,v){v||(v=new Uint8Array(b(a)));for(var p,P,L=0,t=v.length,V=0;V<a.length;){for(p=a[V],P=0;V<a.length&&a[V]===p;)++V,++P;for(;L<t&&P>=128;)v[L++]=128+(127&P),P>>>=7;if(L>=t)throw new Error("RLE buffer overflow");for(v[L++]=P,p>>>=0;L<t&&p>=128;)v[L++]=128+(127&p),p>>>=7;if(L>=t)throw new Error("RLE buffer overflow");v[L++]=p}return v},v.decode=function(a,v){for(var p,P,b,L,t=v.length,V=a.length,K=0,C=0;C<V;){for(p=0,P=0;C<V&&a[C]>=128;)p+=(127&a[C++])<<P,P+=7;if(p+=a[C++]<<P,C>=V)throw new Error("RLE buffer underrun");if(K+p>t)throw new Error("Chunk buffer overflow");for(b=0,P=0;C<V&&a[C]>=128;)b+=(127&a[C++])<<P,P+=7;if(C>=V)throw new Error("RLE buffer underrun");for(b+=a[C++]<<P,L=0;L<p;++L)v[K++]=b}return v}},10861:(a,v)=>{"use strict";function p(a){var v=32;return(a&=-a)&&v--,65535&a&&(v-=16),16711935&a&&(v-=8),252645135&a&&(v-=4),858993459&a&&(v-=2),1431655765&a&&(v-=1),v}v.INT_BITS=32,v.INT_MAX=2147483647,v.INT_MIN=-1<<31,v.sign=function(a){return(a>0)-(a<0)},v.abs=function(a){var v=a>>31;return(a^v)-v},v.min=function(a,v){return v^(a^v)&-(a<v)},v.max=function(a,v){return a^(a^v)&-(a<v)},v.isPow2=function(a){return!(a&a-1)&&!!a},v.log2=function(a){var v,p;return v=(a>65535)<<4,v|=p=((a>>>=v)>255)<<3,v|=p=((a>>>=p)>15)<<2,(v|=p=((a>>>=p)>3)<<1)|(a>>>=p)>>1},v.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},v.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},v.countTrailingZeros=p,v.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},v.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},v.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var P=new Array(256);!function(a){for(var v=0;v<256;++v){var p=v,P=v,b=7;for(p>>>=1;p;p>>>=1)P<<=1,P|=1&p,--b;a[v]=P<<b&255}}(P),v.reverse=function(a){return P[255&a]<<24|P[a>>>8&255]<<16|P[a>>>16&255]<<8|P[a>>>24&255]},v.interleave2=function(a,v){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},v.deinterleave2=function(a,v){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>v&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},v.interleave3=function(a,v,p){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<2},v.deinterleave3=function(a,v){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>v&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},v.nextCombination=function(a){var v=a|a-1;return v+1|(~v&-~v)-1>>>p(a)+1}},11050:a=>{"use strict";a.exports=function(a,v,p,P){var b=self||window;try{try{var L;try{L=new b.Blob([a])}catch(C){(L=new(b.BlobBuilder||b.WebKitBlobBuilder||b.MozBlobBuilder||b.MSBlobBuilder)).append(a),L=L.getBlob()}var t=b.URL||b.webkitURL,V=t.createObjectURL(L),K=new b[v](V,p);return t.revokeObjectURL(V),K}catch(C){return new b[v]("data:application/javascript,".concat(encodeURIComponent(a)),p)}}catch(C){if(!P)throw Error("Inline worker is not supported");return new b[v](P,p)}}},12106:(a,v,p)=>{"use strict";function P(a,v,p,P,b){var L={};return Object.keys(P).forEach((function(a){L[a]=P[a]})),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=p.slice().reverse().reduce((function(p,P){return P(a,v,p)||p}),L),b&&void 0!==L.initializer&&(L.value=L.initializer?L.initializer.call(b):void 0,L.initializer=void 0),void 0===L.initializer&&(Object.defineProperty(a,v,L),L=null),L}p.d(v,{d:()=>P})},12098:(a,v,p)=>{"use strict";function P(a,v,p,P){p&&Object.defineProperty(a,v,{enumerable:p.enumerable,configurable:p.configurable,writable:p.writable,value:p.initializer?p.initializer.call(P):void 0})}p.d(v,{b:()=>P})},12412:(a,v,p)=>{"use strict";p.d(v,{d:()=>Q,h:()=>h,k:()=>R,m:()=>c,o:()=>A,p:()=>H,s:()=>f});var P=p(11240),b=p(11279),L=p(11263),t=p(11027),V=p(12417),K=p(11515),C=p(11466),F=p(10933),u=p(11287);const c=Object.freeze(new P.i(0,0,0,0)),f=Object.freeze(P.s.Zero()),H=Object.freeze(P.o.Zero()),A=Object.freeze(C.b.Zero()),h=Object.freeze(b.d.Black()),R=Object.freeze(new b.e(0,0,0,0)),X={key:0,repeatCount:0,loopMode:2};class Q{static _PrepareAnimation(a,v,p,L,t,V,K,F){let u;if(!isNaN(parseFloat(t))&&isFinite(t)?u=Q.ANIMATIONTYPE_FLOAT:t instanceof P.i?u=Q.ANIMATIONTYPE_QUATERNION:t instanceof P.s?u=Q.ANIMATIONTYPE_VECTOR3:t instanceof P.o?u=Q.ANIMATIONTYPE_VECTOR2:t instanceof b.d?u=Q.ANIMATIONTYPE_COLOR3:t instanceof b.e?u=Q.ANIMATIONTYPE_COLOR4:t instanceof C.b&&(u=Q.ANIMATIONTYPE_SIZE),void 0==u)return null;const c=new Q(a,v,p,u,K),f=[{frame:0,value:t},{frame:L,value:V}];return c.setKeys(f),void 0!==F&&c.setEasingFunction(F),c}static CreateAnimation(a,v,p,P){const b=new Q(a+"Animation",a,p,v,Q.ANIMATIONLOOPMODE_CONSTANT);return b.setEasingFunction(P),b}static CreateAndStartAnimation(a,v,p,P,b,L,t,V,K,C,F){const u=Q._PrepareAnimation(a,p,P,b,L,t,V,K);return u?(v.va&&(F=v.va()),F?F.beginDirectAnimation(v,[u],0,b,1===u.loopMode,1,C):null):null}static CreateAndStartHierarchyAnimation(a,v,p,P,b,L,t,V,K,C,F){const u=Q._PrepareAnimation(a,P,b,L,t,V,K,C);if(!u)return null;return v.va().beginDirectHierarchyAnimation(v,p,[u],0,L,1===u.loopMode,1,F)}static CreateMergeAndStartAnimation(a,v,p,P,b,L,t,V,K,C){const F=Q._PrepareAnimation(a,p,P,b,L,t,V,K);return F?(v.animations.push(F),v.va().beginAnimation(v,0,b,1===F.loopMode,1,C)):null}static MakeAnimationAdditive(a,v,p){let b;b="object"===typeof v?v:{referenceFrame:v??0,range:p,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let L=a;if(b.cloneOriginalAnimation&&(L=a.clone(),L.name=b.clonedAnimationName||L.name),!L._keys.length)return L;const t=b.referenceFrame&&b.referenceFrame>=0?b.referenceFrame:0;let V=0;const K=L._keys[0];let C=L._keys.length-1;const F=L._keys[C],u={referenceValue:K.value,referencePosition:P.k.fb[0],referenceQuaternion:P.k.Quaternion[0],referenceScaling:P.k.fb[1],keyPosition:P.k.fb[2],keyQuaternion:P.k.Quaternion[1],keyScaling:P.k.fb[3]};let c=K.frame,f=F.frame;if(b.range){const a=L.getRange(b.range);a&&(c=a.from,f=a.to)}else c=b.fromFrame??c,f=b.toFrame??f;if(c!==K.frame&&(V=L.createKeyForFrame(c)),f!==F.frame&&(C=L.createKeyForFrame(f)),1===L._keys.length){const a=L._getKeyValue(L._keys[0]);u.referenceValue=a.clone?a.clone():a}else if(t<=K.frame){const a=L._getKeyValue(K.value);u.referenceValue=a.clone?a.clone():a}else if(t>=F.frame){const a=L._getKeyValue(F.value);u.referenceValue=a.clone?a.clone():a}else{X.key=0;const a=L._interpolate(t,X);u.referenceValue=a.clone?a.clone():a}L.dataType===Q.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():L.dataType===Q.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace());let H=Number.MAX_VALUE;const A=b.clipKeys?[]:null;for(let h=V;h<=C;h++){let a=L._keys[h];if((A||b.cloneOriginalAnimation)&&(a={frame:a.frame,value:a.value.clone?a.value.clone():a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation,lockedTangent:a.lockedTangent},A&&(H===Number.MAX_VALUE&&(H=a.frame),a.frame-=H,A.push(a))),!h||L.dataType===Q.ANIMATIONTYPE_FLOAT||a.value!==K.value)switch(L.dataType){case Q.ANIMATIONTYPE_MATRIX:a.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.Bi(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),P.e.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,a.value);break;case Q.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(a.value,a.value);break;case Q.ANIMATIONTYPE_VECTOR2:case Q.ANIMATIONTYPE_VECTOR3:case Q.ANIMATIONTYPE_COLOR3:case Q.ANIMATIONTYPE_COLOR4:a.value.subtractToRef(u.referenceValue,a.value);break;case Q.ANIMATIONTYPE_SIZE:a.value.width-=u.referenceValue.width,a.value.height-=u.referenceValue.height;break;default:a.value-=u.referenceValue}}return A&&L.setKeys(A,!0),L}static TransitionTo(a,v,p,P,b,L,t){let V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(t<=0)return p[a]=v,V&&V(),null;const K=b*(t/1e3);L.setKeys([{frame:0,value:p[a].clone?p[a].clone():p[a]},{frame:K,value:v}]),p.animations||(p.animations=[]),p.animations.push(L);const C=P.beginAnimation(p,0,K,!1);return C.onAnimationEnd=V,C}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const a of this._runtimeAnimations)if(!a.isStopped())return!0;return!1}constructor(a,v,p,P,b,L){this.name=a,this.targetProperty=v,this.framePerSecond=p,this.dataType=P,this.loopMode=b,this.enableBlending=L,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=v.split("."),this.dataType=P,this.loopMode=void 0===b?Q.ANIMATIONLOOPMODE_CYCLE:b,this.uniqueId=Q._UniqueIdGenerator++}toString(a){let v="Name: "+this.name+", property: "+this.targetProperty;if(v+=", datatype: "+["Float","fb","Quaternion","Matrix","gb","Vector2"][this.dataType],v+=", nKeys: "+(this._keys?this._keys.length:"none"),v+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){v+=", Ranges: {";let a=!0;for(const p in this._ranges)a&&(v+=", ",a=!1),v+=p;v+="}"}return v}addEvent(a){this._events.push(a),this._events.sort(((a,v)=>a.frame-v.frame))}removeEvents(a){for(let v=0;v<this._events.length;v++)this._events[v].frame===a&&(this._events.splice(v,1),v--)}getEvents(){return this._events}createRange(a,v,p){this._ranges[a]||(this._ranges[a]=new V.d(a,v,p))}deleteRange(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const p=this._ranges[a];if(p){if(v){const a=p.from,v=p.to;for(let p=this._keys.length-1;p>=0;p--)this._keys[p].frame>=a&&this._keys[p].frame<=v&&this._keys.splice(p,1)}this._ranges[a]=null}}getRange(a){return this._ranges[a]}getKeys(){return this._keys}getHighestFrame(){let a=0;for(let v=0,p=this._keys.length;v<p;v++)a<this._keys[v].frame&&(a=this._keys[v].frame);return a}getEasingFunction(){return this._easingFunction}setEasingFunction(a){this._easingFunction=a}floatInterpolateFunction(a,v,p){return(0,L.l)(a,v,p)}floatInterpolateFunctionWithTangents(a,v,p,P,b){return(0,L.f)(a,v,p,P,b)}quaternionInterpolateFunction(a,v,p){return P.i.Slerp(a,v,p)}quaternionInterpolateFunctionWithTangents(a,v,p,b,L){return P.i.Hermite(a,v,p,b,L).normalize()}vector3InterpolateFunction(a,v,p){return P.s.Lerp(a,v,p)}vector3InterpolateFunctionWithTangents(a,v,p,b,L){return P.s.Hermite(a,v,p,b,L)}vector2InterpolateFunction(a,v,p){return P.o.Lerp(a,v,p)}vector2InterpolateFunctionWithTangents(a,v,p,b,L){return P.o.Hermite(a,v,p,b,L)}sizeInterpolateFunction(a,v,p){return C.b.Lerp(a,v,p)}color3InterpolateFunction(a,v,p){return b.d.Lerp(a,v,p)}color3InterpolateFunctionWithTangents(a,v,p,P,L){return b.d.Hermite(a,v,p,P,L)}color4InterpolateFunction(a,v,p){return b.e.Lerp(a,v,p)}color4InterpolateFunctionWithTangents(a,v,p,P,L){return b.e.Hermite(a,v,p,P,L)}_getKeyValue(a){return"function"===typeof a?a():a}evaluate(a){return X.key=0,this._interpolate(a,X)}_interpolate(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(v.loopMode===Q.ANIMATIONLOOPMODE_CONSTANT&&v.repeatCount>0)return v.highLimitValue.clone?v.highLimitValue.clone():v.highLimitValue;const P=this._keys,b=P.length;let L=v.key;for(;L>=0&&a<P[L].frame;)--L;for(;L+1<=b-1&&a>=P[L+1].frame;)++L;if(v.key=L,L<0)return p?void 0:this._getKeyValue(P[0].value);if(L+1>b-1)return p?void 0:this._getKeyValue(P[b-1].value);const t=P[L],V=P[L+1];if(p&&(a===t.frame||a===V.frame))return;const K=this._getKeyValue(t.value),C=this._getKeyValue(V.value);if(1===t.interpolation)return V.frame>a?K:C;const F=void 0!==t.outTangent&&void 0!==V.inTangent,u=V.frame-t.frame;let X=(a-t.frame)/u;const s=t.easingFunction||this.getEasingFunction();switch(null!==s&&(X=s.ease(X)),this.dataType){case Q.ANIMATIONTYPE_FLOAT:{const a=F?this.floatInterpolateFunctionWithTangents(K,t.outTangent*u,C,V.inTangent*u,X):this.floatInterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(v.offsetValue??0)*v.repeatCount+a}break}case Q.ANIMATIONTYPE_QUATERNION:{const a=F?this.quaternionInterpolateFunctionWithTangents(K,t.outTangent.scale(u),C,V.inTangent.scale(u),X):this.quaternionInterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a.addInPlace((v.offsetValue||c).scale(v.repeatCount))}return a}case Q.ANIMATIONTYPE_VECTOR3:{const a=F?this.vector3InterpolateFunctionWithTangents(K,t.outTangent.scale(u),C,V.inTangent.scale(u),X):this.vector3InterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a.add((v.offsetValue||f).scale(v.repeatCount))}break}case Q.ANIMATIONTYPE_VECTOR2:{const a=F?this.vector2InterpolateFunctionWithTangents(K,t.outTangent.scale(u),C,V.inTangent.scale(u),X):this.vector2InterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a.add((v.offsetValue||H).scale(v.repeatCount))}break}case Q.ANIMATIONTYPE_SIZE:switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(K,C,X);case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(K,C,X).add((v.offsetValue||A).scale(v.repeatCount))}break;case Q.ANIMATIONTYPE_COLOR3:{const a=F?this.color3InterpolateFunctionWithTangents(K,t.outTangent.scale(u),C,V.inTangent.scale(u),X):this.color3InterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a.add((v.offsetValue||h).scale(v.repeatCount))}break}case Q.ANIMATIONTYPE_COLOR4:{const a=F?this.color4InterpolateFunctionWithTangents(K,t.outTangent.scale(u),C,V.inTangent.scale(u),X):this.color4InterpolateFunction(K,C,X);switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return a;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a.add((v.offsetValue||R).scale(v.repeatCount))}break}case Q.ANIMATIONTYPE_MATRIX:switch(v.loopMode){case Q.ANIMATIONLOOPMODE_CYCLE:case Q.ANIMATIONLOOPMODE_CONSTANT:case Q.ANIMATIONLOOPMODE_YOYO:return Q.AllowMatricesInterpolation?this.matrixInterpolateFunction(K,C,X,v.workValue):K;case Q.ANIMATIONLOOPMODE_RELATIVE:case Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K}}return 0}matrixInterpolateFunction(a,v,p,b){return Q.AllowMatrixDecomposeForInterpolation?b?(P.e.DecomposeLerpToRef(a,v,p,b),b):P.e.DecomposeLerp(a,v,p):b?(P.e.LerpToRef(a,v,p,b),b):P.e.Lerp(a,v,p)}clone(){const a=new Q(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(a.enableBlending=this.enableBlending,a.blendingSpeed=this.blendingSpeed,this._keys&&a.setKeys(this._keys),this._ranges){a._ranges={};for(const v in this._ranges){const p=this._ranges[v];p&&(a._ranges[v]=p.clone())}}return a}setKeys(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=v?a:a.slice(0)}createKeyForFrame(a){X.key=0;const v=this._interpolate(a,X,!0);if(!v)return this._keys[X.key].frame===a?X.key:X.key+1;const p={frame:a,value:v.clone?v.clone():v};return this._keys.splice(X.key+1,0,p),X.key+1}serialize(){const a={};a.name=this.name,a.property=this.targetProperty,a.framePerSecond=this.framePerSecond,a.dataType=this.dataType,a.loopBehavior=this.loopMode,a.enableBlending=this.enableBlending,a.blendingSpeed=this.blendingSpeed;const v=this.dataType;a.keys=[];const p=this.getKeys();for(let P=0;P<p.length;P++){const b=p[P],L={};switch(L.frame=b.frame,v){case Q.ANIMATIONTYPE_FLOAT:L.values=[b.value],void 0!==b.inTangent&&L.values.push(b.inTangent),void 0!==b.outTangent&&(void 0===b.inTangent&&L.values.push(void 0),L.values.push(b.outTangent)),void 0!==b.interpolation&&(void 0===b.inTangent&&L.values.push(void 0),void 0===b.outTangent&&L.values.push(void 0),L.values.push(b.interpolation));break;case Q.ANIMATIONTYPE_QUATERNION:case Q.ANIMATIONTYPE_MATRIX:case Q.ANIMATIONTYPE_VECTOR3:case Q.ANIMATIONTYPE_COLOR3:case Q.ANIMATIONTYPE_COLOR4:L.values=b.value.tj(),void 0!=b.inTangent&&L.values.push(b.inTangent.tj()),void 0!=b.outTangent&&(void 0===b.inTangent&&L.values.push(void 0),L.values.push(b.outTangent.tj())),void 0!==b.interpolation&&(void 0===b.inTangent&&L.values.push(void 0),void 0===b.outTangent&&L.values.push(void 0),L.values.push(b.interpolation))}a.keys.push(L)}a.ranges=[];for(const P in this._ranges){const v=this._ranges[P];if(!v)continue;const p={};p.name=P,p.from=v.from,p.to=v.to,a.ranges.push(p)}return a}static _UniversalLerp(a,v,p){const P=a.constructor;return P.Lerp?P.Lerp(a,v,p):P.Slerp?P.Slerp(a,v,p):a.toFixed?a*(1-p)+p*v:v}static Parse(a){const v=new Q(a.name,a.property,a.framePerSecond,a.dataType,a.loopBehavior),p=a.dataType,L=[];let t,V;for(a.enableBlending&&(v.enableBlending=a.enableBlending),a.blendingSpeed&&(v.blendingSpeed=a.blendingSpeed),V=0;V<a.keys.length;V++){const v=a.keys[V];let K,C,F;switch(p){case Q.ANIMATIONTYPE_FLOAT:t=v.values[0],v.values.length>=2&&(K=v.values[1]),v.values.length>=3&&(C=v.values[2]),v.values.length>=4&&(F=v.values[3]);break;case Q.ANIMATIONTYPE_QUATERNION:if(t=P.i.bh(v.values),v.values.length>=8){const a=P.i.bh(v.values.slice(4,8));a.equals(P.i.Zero())||(K=a)}if(v.values.length>=12){const a=P.i.bh(v.values.slice(8,12));a.equals(P.i.Zero())||(C=a)}v.values.length>=13&&(F=v.values[12]);break;case Q.ANIMATIONTYPE_MATRIX:t=P.e.bh(v.values),v.values.length>=17&&(F=v.values[16]);break;case Q.ANIMATIONTYPE_COLOR3:t=b.d.bh(v.values),v.values[3]&&(K=b.d.bh(v.values[3])),v.values[4]&&(C=b.d.bh(v.values[4])),v.values[5]&&(F=v.values[5]);break;case Q.ANIMATIONTYPE_COLOR4:t=b.e.bh(v.values),v.values[4]&&(K=b.e.bh(v.values[4])),v.values[5]&&(C=b.e.bh(v.values[5])),v.values[6]&&(F=b.e.bh(v.values[6]));break;case Q.ANIMATIONTYPE_VECTOR3:default:t=P.s.bh(v.values),v.values[3]&&(K=P.s.bh(v.values[3])),v.values[4]&&(C=P.s.bh(v.values[4])),v.values[5]&&(F=v.values[5])}const u={};u.frame=v.frame,u.value=t,void 0!=K&&(u.inTangent=K),void 0!=C&&(u.outTangent=C),void 0!=F&&(u.interpolation=F),L.push(u)}if(v.setKeys(L),a.ranges)for(V=0;V<a.ranges.length;V++)t=a.ranges[V],v.createRange(t.name,t.from,t.to);return v}static AppendSerializedAnimations(a,v){u.b.AppendSerializedAnimations(a,v)}static ParseFromFileAsync(a,v){return new Promise(((p,P)=>{const b=new F.b;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){let v=JSON.parse(b.responseText);if(v.animations&&(v=v.animations),v.length){const a=[];for(const p of v)a.push(this.Parse(p));p(a)}else{const P=this.Parse(v);a&&(P.name=a),p(P)}}else P("Unable to load the animation")})),b.open("GET",v),b.send()}))}static ParseFromSnippetAsync(a){return new Promise(((v,p)=>{const P=new F.b;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const p=JSON.parse(JSON.parse(P.responseText).jsonPayload);if(p.animations){const P=JSON.parse(p.animations),b=[];for(const v of P.animations){const p=this.Parse(v);p.snippetId=a,b.push(p)}v(b)}else{const P=JSON.parse(p.animation),b=this.Parse(P);b.snippetId=a,v(b)}}else p("Unable to load the snippet "+a)})),P.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),P.send()}))}}Q._UniqueIdGenerator=0,Q.AllowMatricesInterpolation=!1,Q.AllowMatrixDecomposeForInterpolation=!0,Q.SnippetUrl="https://snippet.babylonjs.com",Q.ANIMATIONTYPE_FLOAT=0,Q.ANIMATIONTYPE_VECTOR3=1,Q.ANIMATIONTYPE_QUATERNION=2,Q.ANIMATIONTYPE_MATRIX=3,Q.ANIMATIONTYPE_COLOR3=4,Q.ANIMATIONTYPE_COLOR4=7,Q.ANIMATIONTYPE_VECTOR2=5,Q.ANIMATIONTYPE_SIZE=6,Q.ANIMATIONLOOPMODE_RELATIVE=0,Q.ANIMATIONLOOPMODE_CYCLE=1,Q.ANIMATIONLOOPMODE_CONSTANT=2,Q.ANIMATIONLOOPMODE_YOYO=4,Q.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,Q.CreateFromSnippetAsync=Q.ParseFromSnippetAsync,(0,t.f)("BABYLON.Animation",Q),K.b._AnimationRangeFactory=(a,v,p)=>new V.d(a,v,p)},12417:(a,v,p)=>{"use strict";p.d(v,{d:()=>P});class P{constructor(a,v,p){this.name=a,this.from=v,this.to=p}clone(){return new P(this.name,this.from,this.to)}}},11778:(a,v,p)=>{"use strict";var P=p(10893),b=p(10905),L=p(10974),t=p(10896);L.e.AudioEngineFactory=(a,v,p)=>new V(a,v,p);class V{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new P.c,this.onAudioLockedObservable=new P.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,t.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const b=document.createElement("audio");this._hostElement=a,this._audioContext=v,this._audioDestination=p;try{b&&b.canPlayType&&(b.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||b.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(L){}try{b&&b.canPlayType&&b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(L){}}lock(){this._triggerSuspendedState()}unlock(){var a,v;if("running"===(null===(a=this._audioContext)||void 0===a?void 0:a.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(v=this._audioContext)||void 0===v||v.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var a;null===(a=this._audioContext)||void 0===a||a.addEventListener("statechange",(()=>{var a;this.unlocked&&"running"!==(null===(a=this._audioContext)||void 0===a?void 0:a.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var a;return null!==(a=this._audioContext)&&void 0!==a&&a.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(a){this.canUseWebAudio=!1,b.d.Error("Web Audio: "+a.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const a=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",v=document.createElement("style");v.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(v),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(a){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=a)}connectToAnalyser(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=a,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12409:(a,v,p)=>{"use strict";p.d(v,{e:()=>t});var P=p(11240),b=p(11254),L=p(11515);class t extends L.b{get _matrix(){return this._compose(),this._j}set _matrix(a){(a.updateFlag!==this._j.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._j.p(a),this._markAsDirtyAndDecompose())}constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(a,v.va(),!1),this.name=a,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=v,this._j=(null===b||void 0===b?void 0:b.clone())??P.e.Identity(),this._restMatrix=L??this._j.clone(),this._bindMatrix=t??this._j.clone(),this._index=V,this._absoluteMatrix=new P.e,this._absoluteBindMatrix=new P.e,this._absoluteInverseBindMatrix=new P.e,this._finalMatrix=new P.e,v.bones.push(this),this.setParent(p,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(a){this.setParent(a)}setParent(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==a){if(this.parent){const a=this.parent.children.indexOf(this);-1!==a&&this.parent.children.splice(a,1)}this._parentNode=a,this.parent&&this.parent.children.push(this),v&&this._updateAbsoluteBindMatrices(),this.Sg()}}getLocalMatrix(){return this._compose(),this._j}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(a){this._restMatrix.p(a)}setRestPose(a){this.setRestMatrix(a)}getBindPose(){return this.getBindMatrix()}setBindMatrix(a){this.Sj(a)}setBindPose(a){this.setBindMatrix(a)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const a=P.k.fb[0],v=P.k.Quaternion[0],p=P.k.fb[1];this.getRestMatrix().decompose(a,v,p),this._linkedTransformNode.position.p(p),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??P.i.Identity(),this._linkedTransformNode.rotationQuaternion.p(v),this._linkedTransformNode.te.p(a)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(a){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=a,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.oe}set position(a){this._decompose(),this.oe.p(a),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(a){this.setRotation(a)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(a){this.setRotationQuaternion(a)}get te(){return this.getScale()}set te(a){this.setScale(a)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=P.s.Zero(),this._localRotation=P.i.Zero(),this.oe=P.s.Zero()),this._j.decompose(this._localScaling,this._localRotation,this.oe))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,P.e.ComposeToRef(this._localScaling,this._localRotation,this.oe,this._j)):this._needToCompose=!1)}Sj(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(a),v&&this._updateAbsoluteBindMatrices(),p?this._matrix=a:this.Sg()}_updateAbsoluteBindMatrices(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a||(a=this._bindMatrix),this.parent?a.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(a),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),v)for(let p=0;p<this.children.length;p++)this.children[p]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Sg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Sg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Sg(),this._needToDecompose=!0}_updatePosition(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this.getLocalMatrix();if(0==v)b?(L.addAtIndex(12,a.x),L.addAtIndex(13,a.y),L.addAtIndex(14,a.z)):L.setTranslationFromFloats(a.x,a.y,a.z);else{let v=null;p&&(v=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const V=t._TmpMats[0],K=t._TmpVecs[0];this.parent?p&&v?(V.p(this.parent.getAbsoluteMatrix()),V.multiplyToRef(v,V)):V.p(this.parent.getAbsoluteMatrix()):P.e.IdentityToRef(V),b&&V.setTranslationFromFloats(0,0,0),V.invert(),P.s.TransformCoordinatesToRef(a,V,K),b?(L.addAtIndex(12,K.x),L.addAtIndex(13,K.y),L.addAtIndex(14,K.z)):L.setTranslationFromFloats(K.x,K.y,K.z)}this._markAsDirtyAndDecompose()}translate(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,v,p,!0)}setPosition(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,v,p,!1)}setAbsolutePosition(a,v){this.setPosition(a,1,v)}scale(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=this.getLocalMatrix(),V=t._TmpMats[0];P.e.ScalingToRef(a,v,p,V),V.multiplyToRef(L,L),V.invert();for(const P of this.children){const b=P.getLocalMatrix();b.multiplyToRef(V,b),b.multiplyAtIndex(12,a),b.multiplyAtIndex(13,v),b.multiplyAtIndex(14,p),P._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),b)for(const P of this.children)P.scale(a,v,p,b)}setScale(a){this._decompose(),this._localScaling.p(a),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(a){this._decompose(),a.p(this._localScaling)}setYawPitchRoll(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0;if(0===b){const V=t._TmpQuat;return P.i.RotationYawPitchRollToRef(a,v,p,V),void this.setRotationQuaternion(V,b,L)}const V=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,L))return;const K=t._TmpMats[1];P.e.RotationYawPitchRollToRef(a,v,p,K),V.multiplyToRef(K,K),this._rotateWithMatrix(K,b,L)}rotate(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3?arguments[3]:void 0;const L=t._TmpMats[0];L.setTranslationFromFloats(0,0,0),P.e.RotationAxisToRef(a,v,L),this._rotateWithMatrix(L,p,b)}setAxisAngle(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3?arguments[3]:void 0;if(0===p){const L=t._TmpQuat;return P.i.RotationAxisToRef(a,v,L),void this.setRotationQuaternion(L,p,b)}const L=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,b))return;const V=t._TmpMats[1];P.e.RotationAxisToRef(a,v,V),L.multiplyToRef(V,V),this._rotateWithMatrix(V,p,b)}setRotation(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(a.y,a.x,a.z,v,p)}setRotationQuaternion(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;if(0===v)return this._decompose(),this._localRotation.p(a),void this._markAsDirtyAndCompose();const b=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,p))return;const L=t._TmpMats[1];P.e.FromQuaternionToRef(a,L),b.multiplyToRef(L,L),this._rotateWithMatrix(L,v,p)}setRotationMatrix(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;if(0===v){const b=t._TmpQuat;return P.i.FromRotationMatrixToRef(a,b),void this.setRotationQuaternion(b,v,p)}const b=t._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,p))return;const L=t._TmpMats[1];L.p(a),b.multiplyToRef(a,L),this._rotateWithMatrix(L,v,p)}_rotateWithMatrix(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;const P=this.getLocalMatrix(),b=P.m[12],L=P.m[13],V=P.m[14],K=this.getParent(),C=t._TmpMats[3],F=t._TmpMats[4];K&&1==v?(p?(C.p(p.getWorldMatrix()),K.getAbsoluteMatrix().multiplyToRef(C,C)):C.p(K.getAbsoluteMatrix()),F.p(C),F.invert(),P.multiplyToRef(C,P),P.multiplyToRef(a,P),P.multiplyToRef(F,P)):1==v&&p?(C.p(p.getWorldMatrix()),F.p(C),F.invert(),P.multiplyToRef(C,P),P.multiplyToRef(a,P),P.multiplyToRef(F,P)):P.multiplyToRef(a,P),P.setTranslationFromFloats(b,L,V),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(a,v){const p=t._TmpMats[2];return a.p(this.getAbsoluteMatrix()),v?(a.multiplyToRef(v.getWorldMatrix(),a),P.e.ScalingToRef(v.te.x,v.te.y,v.te.z,p)):P.e.IdentityToRef(p),a.invert(),!isNaN(a.m[0])&&(p.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyToRef(p,a),!0)}cb(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.s.Zero();return this.getPositionToRef(a,v,p),p}getPositionToRef(){let a=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const a=this.getLocalMatrix();v.x=a.m[12],v.y=a.m[13],v.z=a.m[14]}else{let p=null;a&&(p=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let P=t._TmpMats[0];a&&p?(P.p(this.getAbsoluteMatrix()),P.multiplyToRef(p,P)):P=this.getAbsoluteMatrix(),v.x=P.m[12],v.y=P.m[13],v.z=P.m[14]}}getAbsolutePosition(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=P.s.Zero();return this.getPositionToRef(1,a,v),v}getAbsolutePositionToRef(a,v){this.getPositionToRef(1,a,v)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._j.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this._j);const a=this._skeleton.getPoseMatrix();a&&this._absoluteMatrix.multiplyToRef(a,this._absoluteMatrix)}const a=this.children,v=a.length;for(let p=0;p<v;p++)a[p].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}gf(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.s.Zero();return this.getDirectionToRef(a,v,p),p}getDirectionToRef(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,b=null;v&&(b=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=t._TmpMats[0];L.p(this.getAbsoluteMatrix()),v&&b&&L.multiplyToRef(b,L),P.s.TransformNormalToRef(a,L,p),p.normalize()}getRotation(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.s.Zero();return this.getRotationToRef(a,v,p),p}getRotationToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;const P=t._TmpQuat;this.getRotationQuaternionToRef(a,v,P),P.toEulerAnglesToRef(p)}getRotationQuaternion(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.i.Identity();return this.getRotationQuaternionToRef(a,v,p),p}getRotationQuaternionToRef(){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),v.p(this._localRotation);else{const p=t._TmpMats[0],P=this.getAbsoluteMatrix();a?P.multiplyToRef(a.getWorldMatrix(),p):p.p(P),p.multiplyAtIndex(0,this._scalingDeterminant),p.multiplyAtIndex(1,this._scalingDeterminant),p.multiplyAtIndex(2,this._scalingDeterminant),p.decompose(void 0,v,void 0)}}getRotationMatrix(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0;const p=P.e.Identity();return this.getRotationMatrixToRef(a,v,p),p}getRotationMatrixToRef(){let a=arguments.length>1?arguments[1]:void 0,v=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(v);else{const p=t._TmpMats[0],P=this.getAbsoluteMatrix();a?P.multiplyToRef(a.getWorldMatrix(),p):p.p(P),p.multiplyAtIndex(0,this._scalingDeterminant),p.multiplyAtIndex(1,this._scalingDeterminant),p.multiplyAtIndex(2,this._scalingDeterminant),p.getRotationMatrixToRef(v)}}getAbsolutePositionFromLocal(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.s.Zero();return this.getAbsolutePositionFromLocalToRef(a,v,p),p}getAbsolutePositionFromLocalToRef(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,b=null;v&&(b=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=t._TmpMats[0];L.p(this.getAbsoluteMatrix()),v&&b&&L.multiplyToRef(b,L),P.s.TransformCoordinatesToRef(a,L,p)}getLocalPositionFromAbsolute(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=P.s.Zero();return this.getLocalPositionFromAbsoluteToRef(a,v,p),p}getLocalPositionFromAbsoluteToRef(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,b=null;v&&(b=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=t._TmpMats[0];L.p(this.getAbsoluteMatrix()),v&&b&&L.multiplyToRef(b,L),L.invert(),P.s.TransformCoordinatesToRef(a,L,p)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}t._TmpVecs=(0,b.d)(2,P.s.Zero),t._TmpQuat=P.i.Identity(),t._TmpMats=(0,b.d)(5,P.e.Identity)},11306:(a,v,p)=>{"use strict";p.d(v,{b:()=>L,f:()=>t});var P=p(11309),b=p(10905);class L{get u(){return this._isDisposed}constructor(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,a&&a.va?this._engine=a.va().getEngine():this._engine=a,this._updatable=p,this._instanced=t,this._divisor=K||1,this._label=C,v instanceof P.c?(this._data=null,this._buffer=v):(this._data=v,this._buffer=null),this.byteStride=V?b:b*Float32Array.BYTES_PER_ELEMENT,L||this.create()}createVertexBuffer(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6?arguments[6]:void 0;const K=L?v:v*Float32Array.BYTES_PER_ELEMENT,C=P?L?P:P*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new t(this._engine,this,a,this._updatable,!0,C,void 0===b?this._instanced:b,K,p,void 0,void 0,!0,this._divisor||V)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!a&&this._buffer||(a=a||this._data,a&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a),this._data=a):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(a,this._label),this._data=a):this._buffer=this._engine.createVertexBuffer(a,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ub>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ub,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ub,void 0,this._label));b.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(a){this.create(a)}updateDirectly(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a,P?v:v*Float32Array.BYTES_PER_ELEMENT,p?p*this.byteStride:void 0),this._data=0===v&&void 0===p?a:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class t{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(a){const v=0!=a;this._instanceDivisor=a,v!==this._instanced&&(this._instanced=v,this._computeHashCode())}get _maxVerticesCount(){const a=this.getData();return a?Array.isArray(a)?a.length/(this.byteStride/4)-this.byteOffset/4:(a.byteLength-this.byteOffset)/this.byteStride:0}constructor(a,v,p,P,b,V,K,C,F,u){let c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=arguments.length>11&&void 0!==arguments[11]&&arguments[11],H=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,A=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let h=!1;if(this.Id=a,"object"===typeof P&&null!==P?(h=P.updatable??!1,b=P.postponeInternalCreation,V=P.stride,K=P.instanced,C=P.offset,F=P.size,u=P.type,c=P.normalized??!1,f=P.useBytes??!1,H=P.divisor??1,A=P.takeBufferOwnership??!1,this._label=P.label):h=!!P,v instanceof L?(this._buffer=v,this._ownsBuffer=A):(this._buffer=new L(a,v,h,V,b,K,f,H,this._label),this._ownsBuffer=!0),this.uniqueId=t._Counter++,this._kind=p,void 0===u){const a=this.getData();this.type=a?t.GetDataType(a):t.FLOAT}else this.type=u;const R=t.GetTypeByteLength(this.type);f?(this._size=F||(V?V/R:t.DeduceStride(p)),this.byteStride=V||this._buffer.byteStride||this._size*R,this.byteOffset=C||0):(this._size=F||V||t.DeduceStride(p),this.byteStride=V?V*R:this._buffer.byteStride||this._size*R,this.byteOffset=(C||0)*R),this.normalized=c,this._instanced=void 0!==K&&K,this._instanceDivisor=K?H:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var a;null===(a=this._buffer)||void 0===a||a._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(a,v){const p=this.getData();return p?t.GetFloatData(p,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,a,v):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/t.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/t.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*t.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(a){this._buffer.create(a),this._alignBuffer()}update(a){this._buffer.update(a),this._alignBuffer()}updateDirectly(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(a,v,void 0,p),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(a,v){t.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,a,this.normalized,v)}_alignBuffer(){}static DeduceStride(a){switch(a){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.ColorInstanceKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+a+"'")}}static GetDataType(a){return a instanceof Int8Array?t.BYTE:a instanceof Uint8Array?t.UNSIGNED_BYTE:a instanceof Int16Array?t.SHORT:a instanceof Uint16Array?t.UNSIGNED_SHORT:a instanceof Int32Array?t.INT:a instanceof Uint32Array?t.UNSIGNED_INT:t.FLOAT}static GetTypeByteLength(a){switch(a){case t.BYTE:case t.UNSIGNED_BYTE:return 1;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.INT:case t.UNSIGNED_INT:case t.FLOAT:return 4;default:throw new Error(`Invalid type '${a}'`)}}static ForEach(a,v,p,P,b,L,V,K){if(a instanceof Array){let b=v/4;const t=p/4;for(let v=0;v<L;v+=P){for(let p=0;p<P;p++)K(a[b+p],v+p);b+=t}}else{const C=a instanceof ArrayBuffer?new DataView(a):new DataView(a.buffer,a.byteOffset,a.byteLength),F=t.GetTypeByteLength(b);for(let a=0;a<L;a+=P){let L=v;for(let v=0;v<P;v++){K(t._GetFloatValue(C,b,L,V),a+v),L+=F}v+=p}}}static _GetFloatValue(a,v,p,P){switch(v){case t.BYTE:{let v=a.getInt8(p);return P&&(v=Math.max(v/127,-1)),v}case t.UNSIGNED_BYTE:{let v=a.getUint8(p);return P&&(v/=255),v}case t.SHORT:{let v=a.getInt16(p,!0);return P&&(v=Math.max(v/32767,-1)),v}case t.UNSIGNED_SHORT:{let v=a.getUint16(p,!0);return P&&(v/=65535),v}case t.INT:return a.getInt32(p,!0);case t.UNSIGNED_INT:return a.getUint32(p,!0);case t.FLOAT:return a.getFloat32(p,!0);default:throw new Error(`Invalid component type ${v}`)}}static GetFloatData(a,v,p,P,L,V,K,C){const F=v*t.GetTypeByteLength(p),u=K*v;if(p!==t.FLOAT||L!==F){const b=new Float32Array(u);return t.ForEach(a,P,L,v,p,u,V,((a,v)=>b[v]=a)),b}if(!(a instanceof Array||a instanceof Float32Array)||0!==P||a.length!==u){if(a instanceof Array){const v=P/4;return a.slice(v,v+u)}if(a instanceof ArrayBuffer)return new Float32Array(a,P,u);{const v=a.byteOffset+P;if(0!==(3&v)&&(b.d.Warn("Float array must be aligned to 4-bytes border"),C=!0),C){const p=new Uint8Array(u*Float32Array.BYTES_PER_ELEMENT),P=new Uint8Array(a.buffer,v,p.length);return p.set(P),new Float32Array(p.buffer)}return new Float32Array(a.buffer,v,u)}}return C?a.slice():a}}t._Counter=0,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.ColorInstanceKind="instanceColor",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra"},11309:(a,v,p)=>{"use strict";p.d(v,{c:()=>P});class P{get underlyingResource(){return null}constructor(){this.references=0,this.ub=0,this.is32Bits=!1,this.uniqueId=P._Counter++}}P._Counter=0},12847:(a,v,p)=>{"use strict";p.d(v,{c:()=>J});var P=p(11207),b=p(11210),L=p(10893),t=p(11240),V=p(11515),K=p(11504),C=p(11340),F=p(10920),u=p(11245);class c{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(a){this._idleRotationSpeed=a}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(a){this._idleRotationWaitTime=a}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(a){this._idleRotationSpinupTime=a}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(a){this._attachedCamera=a;const v=this._attachedCamera.va();this._onPrePointerObservableObserver=v.onPrePointerObservable.add((a=>{a.type!==C.e.POINTERDOWN?a.type===C.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const a=F.b.Now;let v=0;null!=this._lastFrameTime&&(v=a-this._lastFrameTime),this._lastFrameTime=a,this._applyUserInteraction();const p=a-this._lastInteractionTime-this._idleRotationWaitTime,P=Math.max(Math.min(p/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*P,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(v/1e3))}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.va();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(a){this._lastInteractionTime=a??F.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<u.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let a=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(a=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?a:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=F.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}p(11724);class f{constructor(){this._easingMode=f.EASINGMODE_EASEIN}setEasingMode(a){const v=Math.min(Math.max(a,0),2);this._easingMode=v}getEasingMode(){return this._easingMode}easeInCore(a){throw new Error("You must implement this method")}ease(a){switch(this._easingMode){case f.EASINGMODE_EASEIN:return this.easeInCore(a);case f.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-a)}return a>=.5?.5*(1-this.easeInCore(2*(1-a)))+.5:.5*this.easeInCore(2*a)}}f.EASINGMODE_EASEIN=0,f.EASINGMODE_EASEOUT=1,f.EASINGMODE_EASEINOUT=2;var H=p(12412);class A{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(a){if(this._autoTransitionRange===a)return;this._autoTransitionRange=a;const v=this._attachedCamera;v&&(a?this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((a=>{if(a&&(a.Zj(!0),a.getBoundingInfo)){const v=a.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*v,this.upperRadiusTransitionRange=.05*v}})):this._onMeshTargetChangedObserver&&v.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(a){this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(a){if(!this._attachedCamera)return;this._radiusBounceTransition||(A.EasingFunction.setEasingMode(A.EasingMode),this._radiusBounceTransition=H.d.CreateAnimation("radius",H.d.ANIMATIONTYPE_FLOAT,60,A.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const v=H.d.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));v&&this._animatables.push(v)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}A.EasingFunction=new class extends f{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=a}easeInCore(a){const v=Math.max(0,this.amplitude);return Math.pow(a,3)-a*v*Math.sin(3.141592653589793*a)}}(.3),A.EasingMode=f.EASINGMODE_EASEOUT;class h{constructor(){this.onTargetFramingAnimationEndObservable=new L.c,this._mode=h.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(a){this._mode=a}get mode(){return this._mode}set radiusScale(a){this._radiusScale=a}get radiusScale(){return this._radiusScale}set positionScale(a){this._positionScale=a}get positionScale(){return this._positionScale}set defaultElevation(a){this._defaultElevation=a}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(a){this._elevationReturnTime=a}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(a){this._elevationReturnWaitTime=a}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(a){this._framingTime=a}get framingTime(){return this._framingTime}init(){}attach(a){this._attachedCamera=a;const v=this._attachedCamera.va();h.EasingFunction.setEasingMode(h.EasingMode),this._onPrePointerObservableObserver=v.onPrePointerObservable.add((a=>{a.type!==C.e.POINTERDOWN?a.type===C.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((a=>{a&&a.getBoundingInfo&&this.zoomOnMesh(a,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.va();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.Zj(!0);const P=a.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(P.minimumWorld,P.maximumWorld,v,p)}zoomOnMeshHierarchy(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.Zj(!0);const P=a.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(P.min,P.max,v,p)}zoomOnMeshesHierarchy(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new t.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new t.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let L=0;L<a.length;L++){const v=a[L].getHierarchyBoundingVectors(!0);t.s.CheckExtends(v.min,P,b),t.s.CheckExtends(v.max,P,b)}this.zoomOnBoundingInfo(P,b,v,p)}zoomOnBoundingInfo(a,v){let p,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const L=a.y,V=L+(v.y-L)*this._positionScale,K=v.od(a).scale(.5);if(P)p=new t.s(0,V,0);else{const v=a.add(K);p=new t.s(v.x,V,v.z)}this._vectorTransition||(this._vectorTransition=H.d.CreateAnimation("target",H.d.ANIMATIONTYPE_VECTOR3,60,h.EasingFunction)),this._betaIsAnimating=!0;let C=H.d.TransitionTo("target",p,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);C&&this._animatables.push(C);let F=0;if(this._mode===h.FitFrustumSidesMode){const p=this._calculateLowerRadiusFromModelBoundingSphere(a,v);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=K.length()+this._attachedCamera.fj),F=p}else this._mode===h.IgnoreBoundsSizeMode&&(F=this._calculateLowerRadiusFromModelBoundingSphere(a,v),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.fj));if(this.autoCorrectCameraLimitsAndSensibility){const p=v.od(a).length();this._attachedCamera.panningSensibility=5e3/p,this._attachedCamera.wheelPrecision=100/F}return this._radiusTransition||(this._radiusTransition=H.d.CreateAnimation("radius",H.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction)),C=H.d.TransitionTo("radius",F,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),b&&b(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),C&&this._animatables.push(C),!0}_calculateLowerRadiusFromModelBoundingSphere(a,v){const p=this._attachedCamera;if(!p)return 0;let P=p._calculateLowerRadiusFromModelBoundingSphere(a,v,this._radiusScale);return p.lowerRadiusLimit&&this._mode===h.IgnoreBoundsSizeMode&&(P=P<p.lowerRadiusLimit?p.lowerRadiusLimit:P),p.upperRadiusLimit&&(P=P>p.upperRadiusLimit?p.upperRadiusLimit:P),P}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const a=F.b.Now-this._lastInteractionTime,v=.5*Math.PI-this._defaultElevation,p=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>p&&a>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=H.d.CreateAnimation("beta",H.d.ANIMATIONTYPE_FLOAT,60,h.EasingFunction));const a=H.d.TransitionTo("beta",v,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));a&&this._animatables.push(a)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=F.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}h.EasingFunction=new class extends f{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=a}easeInCore(a){return this.exponent<=0?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)}},h.EasingMode=f.EASINGMODE_EASEINOUT,h.IgnoreBoundsSizeMode=0,h.FitFrustumSidesMode=1;var R=p(11512),X=p(12396),Q=p(12404),s=p(10889);class D{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(a){a=s.e.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),p=v.getInputElement();let P=0,b=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=L=>{var t,V;const K=L.event,F="touch"===K.pointerType;if(L.type!==C.e.POINTERMOVE&&-1===this.buttons.indexOf(K.button))return;const u=K.target;if(this._altKey=K.altKey,this._ctrlKey=K.ctrlKey,this._metaKey=K.metaKey,this._shiftKey=K.shiftKey,this._buttonsPressed=K.buttons,v.isPointerLock){const a=K.movementX,v=K.movementY;this.onTouch(null,a,v),this._pointA=null,this._pointB=null}else{if(L.type!==C.e.POINTERDOWN&&L.type!==C.e.POINTERDOUBLETAP&&F&&(null===(t=this._pointA)||void 0===t?void 0:t.pointerId)!==K.pointerId&&(null===(V=this._pointB)||void 0===V?void 0:V.pointerId)!==K.pointerId)return;if(L.type!==C.e.POINTERDOWN||-1!==this._currentActiveButton&&!F)if(L.type===C.e.POINTERDOUBLETAP)this.onDoubleTap(K.pointerType);else if(L.type!==C.e.POINTERUP||this._currentActiveButton!==K.button&&!F){if(L.type===C.e.POINTERMOVE)if(a||K.preventDefault(),this._pointA&&null===this._pointB){const a=K.clientX-this._pointA.x,v=K.clientY-this._pointA.y;this._pointA.x=K.clientX,this._pointA.y=K.clientY,this.onTouch(this._pointA,a,v)}else if(this._pointA&&this._pointB){const a=this._pointA.pointerId===K.pointerId?this._pointA:this._pointB;a.x=K.clientX,a.y=K.clientY;const v=this._pointA.x-this._pointB.x,p=this._pointA.y-this._pointB.y,t=v*v+p*p,V={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:K.pointerId,type:L.type};this.onMultiTouch(this._pointA,this._pointB,P,t,b,V),b=V,P=t}}else{try{null===u||void 0===u||u.releasePointerCapture(K.pointerId)}catch(c){}F||(this._pointB=null),v._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==K.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==K.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==P||b)&&(this.onMultiTouch(this._pointA,this._pointB,P,0,b,null),P=0,b=null),this._currentActiveButton=-1,this.onButtonUp(K),a||K.preventDefault()}else{try{null===u||void 0===u||u.setPointerCapture(K.pointerId)}catch(c){}if(null===this._pointA)this._pointA={x:K.clientX,y:K.clientY,pointerId:K.pointerId,type:K.pointerType};else{if(null!==this._pointB)return;this._pointB={x:K.clientX,y:K.clientY,pointerId:K.pointerId,type:K.pointerType}}-1!==this._currentActiveButton||F||(this._currentActiveButton=K.button),this.onButtonDown(K),a||(K.preventDefault(),p&&p.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,C.e.POINTERDOWN|C.e.POINTERUP|C.e.POINTERMOVE|C.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,P=0,b=null,this.onLostFocus()},this._contextMenuBind=a=>this.onContextMenu(a),p&&p.addEventListener("contextmenu",this._contextMenuBind,!1);const L=this.camera.va().getEngine().getHostWindow();L&&s.e.RegisterTopRootEvents(L,[{name:"blur",handler:this._onLostFocus}])}bj(){if(this._onLostFocus){const a=this.camera.va().getEngine().getHostWindow();a&&s.e.UnregisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const a=this.camera.va().getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(a){}onTouch(a,v,p){}onMultiTouch(a,v,p,P,b,L){}onContextMenu(a){a.preventDefault()}onButtonDown(a){}onButtonUp(a){}onLostFocus(){}}(0,P.e)([(0,b.O)()],D.prototype,"buttons",void 0);class y extends D{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(a,v){if(0!==this.panningSensibility&&a&&v){const p=v.x-a.x,P=v.y-a.y;this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility}}_computePinchZoom(a,v){const p=this.camera.radius||y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=p*Math.sqrt(a)/Math.sqrt(v):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(v-a)*p*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(v-a)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(a,v,p){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-v/this.panningSensibility,this.camera.inertialPanningY+=p/this.panningSensibility):(this.camera.inertialAlphaOffset-=v/this.angularSensibilityX,this.camera.inertialBetaOffset-=p/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(a,v,p,P,b,L){0===p&&null===b||0===P&&null===L||(this.multiTouchPanAndZoom?(this._computePinchZoom(p,P),this._computeMultiTouchPanning(b,L)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(P)-Math.sqrt(p))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(p,P),this._isPinching=!0):this._computeMultiTouchPanning(b,L)):this.multiTouchPanning?this._computeMultiTouchPanning(b,L):this.pinchZoom&&this._computePinchZoom(p,P))}onButtonDown(a){this._isPanClick=a.button===this.camera._panningMouseButton}onButtonUp(a){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}y.MinimumRadiusForPinch=.001,(0,P.e)([(0,b.O)()],y.prototype,"buttons",void 0),(0,P.e)([(0,b.O)()],y.prototype,"angularSensibilityX",void 0),(0,P.e)([(0,b.O)()],y.prototype,"angularSensibilityY",void 0),(0,P.e)([(0,b.O)()],y.prototype,"pinchPrecision",void 0),(0,P.e)([(0,b.O)()],y.prototype,"pinchDeltaPercentage",void 0),(0,P.e)([(0,b.O)()],y.prototype,"useNaturalPinchZoom",void 0),(0,P.e)([(0,b.O)()],y.prototype,"pinchZoom",void 0),(0,P.e)([(0,b.O)()],y.prototype,"panningSensibility",void 0),(0,P.e)([(0,b.O)()],y.prototype,"multiTouchPanning",void 0),(0,P.e)([(0,b.O)()],y.prototype,"multiTouchPanAndZoom",void 0),Q.b.ArcRotateCameraPointersInput=y;var Z=p(11344);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(a){a=s.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const p=v.event;if(!p.metaKey)if(v.type===Z.d.KEYDOWN){if(this._ctrlPressed=p.ctrlKey,this._altPressed=p.altKey,-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysReset.indexOf(p.keyCode)){-1===this._keys.indexOf(p.keyCode)&&this._keys.push(p.keyCode),p.preventDefault&&(a||p.preventDefault())}}else if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysReset.indexOf(p.keyCode)){const v=this._keys.indexOf(p.keyCode);v>=0&&this._keys.splice(v,1),p.preventDefault&&(a||p.preventDefault())}})))}bj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let v=0;v<this._keys.length;v++){const p=this._keys[v];-1!==this.keysLeft.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX-=1/this.panningSensibility:a.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset+=1/this.zoomingSensibility:a.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX+=1/this.panningSensibility:a.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(p)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset-=1/this.zoomingSensibility:a.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(p)&&a.useInputToRestoreState&&a.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,P.e)([(0,b.O)()],M.prototype,"keysUp",void 0),(0,P.e)([(0,b.O)()],M.prototype,"keysDown",void 0),(0,P.e)([(0,b.O)()],M.prototype,"keysLeft",void 0),(0,P.e)([(0,b.O)()],M.prototype,"keysRight",void 0),(0,P.e)([(0,b.O)()],M.prototype,"keysReset",void 0),(0,P.e)([(0,b.O)()],M.prototype,"panningSensibility",void 0),(0,P.e)([(0,b.O)()],M.prototype,"zoomingSensibility",void 0),(0,P.e)([(0,b.O)()],M.prototype,"useAltToZoom",void 0),(0,P.e)([(0,b.O)()],M.prototype,"angularSpeed",void 0),Q.b.ArcRotateCameraKeyboardMoveInput=M;var S=p(11356),n=p(11346),q=p(11263);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new t.s(0,0,0),this._globalOffset=new t.s(0,0,0),this._inertialPanning=t.s.Zero()}_computeDeltaFromMouseWheelLegacyEvent(a,v){let p=0;const P=.01*a*this.wheelDeltaPercentage*v;return p=a>0?P/(1+this.wheelDeltaPercentage):P*(1+this.wheelDeltaPercentage),p}attachControl(a){a=s.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==C.e.POINTERWHEEL)return;const p=v.event;let P=0;const b=p.deltaMode===n.e.DOM_DELTA_LINE?40:1,L=-p.deltaY*b;if(this.customComputeDeltaFromMouseWheel)P=this.customComputeDeltaFromMouseWheel(L,this,p);else if(this.wheelDeltaPercentage){if(P=this._computeDeltaFromMouseWheelLegacyEvent(L,this.camera.radius),P>0){let a=this.camera.radius,v=this.camera.inertialRadiusOffset+P;for(let p=0;p<20&&Math.abs(v)>.001;p++)a-=v,v*=this.camera.inertia;a=(0,q.e)(a,0,Number.MAX_VALUE),P=this._computeDeltaFromMouseWheelLegacyEvent(L,a)}}else P=L/(40*this.wheelPrecision);P&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(P)):this.camera.inertialRadiusOffset+=P),p.preventDefault&&(a||p.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,C.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.pe(0)}bj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const a=this.camera;0+a.inertialAlphaOffset+a.inertialBetaOffset+a.inertialRadiusOffset&&(this._updateHitPlane(),a.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(a.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const a=this.camera,v=a.target.od(a.position);this._hitPlane=S.b.FromPositionAndNormal(a.target,v)}_getPosition(){const a=this.camera,v=a.va(),p=v.createPickingRay(v.pointerX,v.pointerY,t.e.Identity(),a,!1);0===a.targetScreenOffset.x&&0===a.targetScreenOffset.y||(this._viewOffset.set(a.targetScreenOffset.x,a.targetScreenOffset.y,0),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),this._globalOffset=t.s.TransformNormal(this._viewOffset,a._cameraTransformMatrix),p.origin.addInPlace(this._globalOffset));let P=0;return this._hitPlane&&(P=p.intersectsPlane(this._hitPlane)??0),p.origin.addInPlace(p.direction.scaleInPlace(P))}_zoomToMouse(a){const v=this.camera,p=1-v.inertia;if(v.lowerRadiusLimit){const P=v.lowerRadiusLimit??0;v.radius-(v.inertialRadiusOffset+a)/p<P&&(a=(v.radius-P)*p-v.inertialRadiusOffset)}if(v.upperRadiusLimit){const P=v.upperRadiusLimit??0;v.radius-(v.inertialRadiusOffset+a)/p>P&&(a=(v.radius-P)*p-v.inertialRadiusOffset)}const P=a/p/v.radius,b=this._getPosition(),L=t.k.fb[6];b.subtractToRef(v.target,L),L.scaleInPlace(P),L.scaleInPlace(p),this._inertialPanning.addInPlace(L),v.inertialRadiusOffset+=a}_zeroIfClose(a){Math.abs(a.x)<u.e&&(a.x=0),Math.abs(a.y)<u.e&&(a.y=0),Math.abs(a.z)<u.e&&(a.z=0)}}(0,P.e)([(0,b.O)()],T.prototype,"wheelPrecision",void 0),(0,P.e)([(0,b.O)()],T.prototype,"zoomToMouseLocation",void 0),(0,P.e)([(0,b.O)()],T.prototype,"wheelDeltaPercentage",void 0),Q.b.ArcRotateCameraMouseWheelInput=T;class j extends Q.d{constructor(a){super(a)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new y),this}addKeyboard(){return this.add(new M),this}}var w=p(11027);V.b.AddNodeConstructor("ArcRotateCamera",((a,v)=>()=>new J(a,0,0,1,t.s.Zero(),v)));class J extends X.c{get target(){return this._target}set target(a){this.setTarget(a)}get targetHost(){return this._targetHost}set targetHost(a){a&&this.setTarget(a)}getTarget(){return this.target}get position(){return this._position}set position(a){this.setPosition(a)}set upVector(a){this._upToYMatrix||(this._yToUpMatrix=new t.e,this._upToYMatrix=new t.e,this._upVector=t.s.Zero()),a.normalize(),this._upVector.p(a),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){t.e.RotationAlignToRef(t.s.UpReadOnly,this._upVector,this._yToUpMatrix),t.e.RotationAlignToRef(this._upVector,t.s.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityX:0}set angularSensibilityX(a){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityX=a)}get angularSensibilityY(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityY:0}set angularSensibilityY(a){const v=this.inputs.attached.pointers;v&&(v.angularSensibilityY=a)}get pinchPrecision(){const a=this.inputs.attached.pointers;return a?a.pinchPrecision:0}set pinchPrecision(a){const v=this.inputs.attached.pointers;v&&(v.pinchPrecision=a)}get pinchDeltaPercentage(){const a=this.inputs.attached.pointers;return a?a.pinchDeltaPercentage:0}set pinchDeltaPercentage(a){const v=this.inputs.attached.pointers;v&&(v.pinchDeltaPercentage=a)}get useNaturalPinchZoom(){const a=this.inputs.attached.pointers;return!!a&&a.useNaturalPinchZoom}set useNaturalPinchZoom(a){const v=this.inputs.attached.pointers;v&&(v.useNaturalPinchZoom=a)}get panningSensibility(){const a=this.inputs.attached.pointers;return a?a.panningSensibility:0}set panningSensibility(a){const v=this.inputs.attached.pointers;v&&(v.panningSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const v=this.inputs.attached.keyboard;v&&(v.keysUp=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const v=this.inputs.attached.keyboard;v&&(v.keysDown=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const v=this.inputs.attached.keyboard;v&&(v.keysRight=a)}get wheelPrecision(){const a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:0}set wheelPrecision(a){const v=this.inputs.attached.mousewheel;v&&(v.wheelPrecision=a)}get zoomToMouseLocation(){const a=this.inputs.attached.mousewheel;return!!a&&a.zoomToMouseLocation}set zoomToMouseLocation(a){const v=this.inputs.attached.mousewheel;v&&(v.zoomToMouseLocation=a)}get wheelDeltaPercentage(){const a=this.inputs.attached.mousewheel;return a?a.wheelDeltaPercentage:0}set wheelDeltaPercentage(a){const v=this.inputs.attached.mousewheel;v&&(v.wheelDeltaPercentage=a)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(a){a!==this.useBouncingBehavior&&(a?(this._bouncingBehavior=new A,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(a){a!==this.useFramingBehavior&&(a?(this._framingBehavior=new h,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(a){a!==this.useAutoRotationBehavior&&(a?(this._autoRotationBehavior=new c,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(a,v,p,P,b,V){var K;let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(a,t.s.Zero(),V,C),K=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=t.s.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=t.o.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new t.e,this.panningAxis=new t.s(1,1,0),this._transformedDirection=new t.s,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new L.c,this.checkCollisions=!1,this.collisionRadius=new t.s(.5,.5,.5),this._previousPosition=t.s.Zero(),this._collisionVelocity=t.s.Zero(),this._newPosition=t.s.Zero(),this._computationVector=t.s.Zero(),this._onCollisionPositionChange=function(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p?(K.setPosition(v),K.Tk&&K.Tk(p)):K._previousPosition.p(K._position);const P=Math.cos(K.alpha),b=Math.sin(K.alpha),L=Math.cos(K.beta);let t=Math.sin(K.beta);0===t&&(t=1e-4);const V=K._getTargetPosition();K._computationVector.qe(K.radius*P*t,K.radius*L,K.radius*b*t),V.addToRef(K._computationVector,K._newPosition),K._position.p(K._newPosition);let C=K.upVector;K.allowUpsideDown&&K.beta<0&&(C=C.clone(),C=C.negate()),K._computeViewMatrix(K._position,V,C),K._viewMatrix.addAtIndex(12,K.targetScreenOffset.x),K._viewMatrix.addAtIndex(13,K.targetScreenOffset.y),K._collisionTriggered=!1},this._target=t.s.Zero(),b&&this.setTarget(b),this.alpha=v,this.beta=p,this.radius=P,this.getViewMatrix(),this.inputs=new j(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new t.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=t.o.Zero()}_updateCache(a){a||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const a=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?a.addToRef(this._targetBoundingCenter,this._target):this._target.p(a)}const a=this._getLockedTargetPosition();return a||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>u.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const b=arguments;v=s.e.BackCompatCameraNoPreventDefault(b),this._useCtrlForPanning=p,this._panningMouseButton=P,"boolean"===typeof b[0]&&(b.length>1&&(this._useCtrlForPanning=b[1]),b.length>2&&(this._panningMouseButton=b[2])),this.inputs.attachElement(v),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}bj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const a=this._scene.getEngine().getDeltaTime()/1e3,v=1-Math.pow(2,-a/this.restoreStateInterpolationFactor);this.setTarget(t.s.Lerp(this.getTarget(),this._storedTarget,v)),t.i.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,t.k.Quaternion[0]),t.i.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,t.k.Quaternion[1]),t.i.SlerpToRef(t.k.Quaternion[1],t.k.Quaternion[0],v,t.k.Quaternion[2]),t.k.Quaternion[2].normalize(),t.k.Quaternion[2].toAlphaBetaGammaToRef(t.k.fb[0]),this.alpha=t.k.fb[0].x,this.beta=t.k.fb[0].y,this.radius+=(this._storedRadius-this.radius)*v,t.o.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,v,this.targetScreenOffset),(t.s.DistanceSquared(this.getTarget(),this._storedTarget)<u.e&&t.k.Quaternion[2].equalsWithEpsilon(t.k.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<u.e&&t.o.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<u.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const a=this.invertRotation?-1:1,v=this._calculateHandednessMultiplier();let p=this.inertialAlphaOffset*v;this.beta<0&&(p*=-1),this.alpha+=p*a,this.beta+=this.inertialBetaOffset*a,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<u.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<u.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*u.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const a=new t.s(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.multiplyInPlace(this.panningAxis),t.s.TransformNormalToRef(a,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const a=this.upVector,v=t.s.CrossToRef(this._transformedDirection,a,this._transformedDirection);t.s.CrossToRef(a,v,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);t.s.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const a=t.k.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.transposeToRef(a),t.s.TransformCoordinatesToRef(this._transformedDirection,a,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*u.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*u.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||t.s.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const a=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const v=Math.round((a-this.alpha)/(2*Math.PI));this.alpha+=2*v*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(a){this._position.equals(a)||(this._position.p(a),this.rebuildAnglesAndRadius())}setTarget(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(P=this.overrideCloneAlphaBetaRadius??P,a.Zj)v&&a.getBoundingInfo?this._targetBoundingCenter=a.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,a.Zj(),this._targetHost=a,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const v=a,P=this._getTargetPosition();if(P&&!p&&P.equals(v))return;this._targetHost=null,this._target=v,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}P||this.rebuildAnglesAndRadius()}_getViewMatrix(){const a=Math.cos(this.alpha),v=Math.sin(this.alpha),p=Math.cos(this.beta);let P=Math.sin(this.beta);0===P&&(P=1e-4),0===this.radius&&(this.radius=1e-4);const b=this._getTargetPosition();if(this._computationVector.qe(this.radius*a*P,this.radius*p,this.radius*v*P),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||t.s.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),b.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const a=this.va().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let a=this.upVector;this.allowUpsideDown&&P<0&&(a=a.negate()),this._computeViewMatrix(this._position,b,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=b,this._viewMatrix}zoomOn(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a||this.va().meshes;const p=K.b.MinMax(a);let P=this._calculateLowerRadiusFromModelBoundingSphere(p.min,p.max);P=Math.max(Math.min(P,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=P*this.zoomOnFactor,this.focusOn({min:p.min,max:p.max,distance:P},v)}focusOn(a){let v,p,P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===a.min){const P=a||this.va().meshes;v=K.b.MinMax(P),p=t.s.Distance(v.min,v.max)}else{v=a,p=a.distance}this._target=K.b.Center(v),P||(this.maxZ=2*p)}createRigCamera(a,v){let p=0;switch(this.cameraRigMode){case R.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.e.RIG_MODE_VR:p=this._cameraRigParams.stereoHalfAngle*(0===v?1:-1);break;case R.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:p=this._cameraRigParams.stereoHalfAngle*(0===v?-1:1)}const P=new J(a,this.alpha+p,this.beta,this.radius,this._target,this.va());return P._cameraRigParams={},P.isRigCamera=!0,P.rigParent=this,P.upVector=this.upVector,P.mode=this.mode,P.orthoLeft=this.orthoLeft,P.orthoRight=this.orthoRight,P.orthoBottom=this.orthoBottom,P.orthoTop=this.orthoTop,P}_updateRigCameras(){const a=this._rigCameras[0],v=this._rigCameras[1];switch(a.beta=v.beta=this.beta,this.cameraRigMode){case R.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case R.e.RIG_MODE_VR:a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case R.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const P=t.s.Distance(a,v),b=this.va().getEngine().getAspectRatio(this),L=Math.tan(this.fov/2),V=L*b,K=.5*P*p,C=K*Math.sqrt(1+1/(V*V)),F=K*Math.sqrt(1+1/(L*L));return Math.max(C,F)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,P.e)([(0,b.O)()],J.prototype,"alpha",void 0),(0,P.e)([(0,b.O)()],J.prototype,"beta",void 0),(0,P.e)([(0,b.O)()],J.prototype,"radius",void 0),(0,P.e)([(0,b.O)()],J.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,P.e)([(0,b.M)("target")],J.prototype,"_target",void 0),(0,P.e)([(0,b.C)("targetHost")],J.prototype,"_targetHost",void 0),(0,P.e)([(0,b.O)()],J.prototype,"inertialAlphaOffset",void 0),(0,P.e)([(0,b.O)()],J.prototype,"inertialBetaOffset",void 0),(0,P.e)([(0,b.O)()],J.prototype,"inertialRadiusOffset",void 0),(0,P.e)([(0,b.O)()],J.prototype,"lowerAlphaLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"upperAlphaLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"lowerBetaLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"upperBetaLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"lowerRadiusLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"upperRadiusLimit",void 0),(0,P.e)([(0,b.O)()],J.prototype,"inertialPanningX",void 0),(0,P.e)([(0,b.O)()],J.prototype,"inertialPanningY",void 0),(0,P.e)([(0,b.O)()],J.prototype,"pinchToPanMaxDistance",void 0),(0,P.e)([(0,b.O)()],J.prototype,"panningDistanceLimit",void 0),(0,P.e)([(0,b.M)()],J.prototype,"panningOriginTarget",void 0),(0,P.e)([(0,b.O)()],J.prototype,"panningInertia",void 0),(0,P.e)([(0,b.O)()],J.prototype,"zoomToMouseLocation",null),(0,P.e)([(0,b.O)()],J.prototype,"zoomOnFactor",void 0),(0,P.e)([(0,b.K)()],J.prototype,"targetScreenOffset",void 0),(0,P.e)([(0,b.O)()],J.prototype,"allowUpsideDown",void 0),(0,P.e)([(0,b.O)()],J.prototype,"useInputToRestoreState",void 0),(0,P.e)([(0,b.O)()],J.prototype,"restoreStateInterpolationFactor",void 0),(0,w.f)("BABYLON.ArcRotateCamera",J)},11512:(a,v,p)=>{"use strict";p.d(v,{e:()=>h});var P=p(11207),b=p(11210),L=p(11223),t=p(10889),V=p(10893),K=p(11240),C=p(11515),F=p(10905),u=p(11027),c=p(10926),f=p(11521),H=p(11354),A=p(11287);class h extends C.b{get position(){return this._position}set position(a){this._position=a}set upVector(a){this._upVector=a}get upVector(){return this._upVector}get screenArea(){let a=0,v=0;if(this.mode===h.PERSPECTIVE_CAMERA)this.fovMode===h.FOVMODE_VERTICAL_FIXED?(v=2*this.fj*Math.tan(this.fov/2),a=this.getEngine().getAspectRatio(this)*v):(a=2*this.fj*Math.tan(this.fov/2),v=a/this.getEngine().getAspectRatio(this));else{const p=this.getEngine().getRenderWidth()/2,P=this.getEngine().getRenderHeight()/2;a=(this.orthoRight??p)-(this.orthoLeft??-p),v=(this.orthoTop??P)-(this.orthoBottom??-P)}return a*v}set orthoLeft(a){this._orthoLeft=a;for(const v of this._rigCameras)v.orthoLeft=a}get orthoLeft(){return this._orthoLeft}set orthoRight(a){this._orthoRight=a;for(const v of this._rigCameras)v.orthoRight=a}get orthoRight(){return this._orthoRight}set orthoBottom(a){this._orthoBottom=a;for(const v of this._rigCameras)v.orthoBottom=a}get orthoBottom(){return this._orthoBottom}set orthoTop(a){this._orthoTop=a;for(const v of this._rigCameras)v.orthoTop=a}get orthoTop(){return this._orthoTop}set mode(a){this._mode=a;for(const v of this._rigCameras)v.mode=a}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(a,v,p){let P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(a,p,!1),this._position=K.s.Zero(),this._upVector=K.s.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.fj=1,this.maxZ=1e4,this.inertia=.9,this._mode=h.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new f.c(0,0,1,1),this.layerMask=268435455,this.fovMode=h.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=h.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new V.c,this.onProjectionMatrixChangedObservable=new V.c,this.onAfterCheckInputsObservable=new V.c,this.onRestoreStateObservable=new V.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new K.e,this._postProcesses=new Array,this._activeMeshes=new L.e(256),this._globalPosition=K.s.Zero(),this._computedViewMatrix=K.e.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=K.e.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=K.i.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),P&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=v,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${a}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Dh"}toString(a){let v="Name: "+this.name;if(v+=", type: "+this.getClassName(),this.animations)for(let p=0;p<this.animations.length;p++)v+=", animation[0]: "+this.animations[p].toString(a);return v}applyVerticalCorrection(){const a=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-a.x:a.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(a){return-1!==this._activeMeshes.indexOf(a)}isReady(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(a)for(const v of this._postProcesses)if(v&&!v.isReady())return!1;return super.isReady(a)}_initCache(){super._initCache(),this._cache.position=new K.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new K.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.fj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(a){a||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let a=this._cache.mode===this.mode&&this._cache.fj===this.fj&&this._cache.maxZ===this.maxZ;if(!a)return!1;const v=this.getEngine();return this.mode===h.PERSPECTIVE_CAMERA?a=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===v.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(a=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===v.getRenderWidth()&&this._cache.renderHeight===v.getRenderHeight(),this.oblique&&(a=a&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),a}attachControl(a,v){}bj(a){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==h.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let a=0;a<this._postProcesses.length;a++)if(null!==this._postProcesses[a])return this._postProcesses[a];return null}_cascadePostProcessesToRigCams(){const a=this._getFirstPostProcess();a&&a.markTextureDirty();for(let v=0,p=this._rigCameras.length;v<p;v++){const a=this._rigCameras[v],p=a._rigPostProcess;if(p){"pass"===p.getEffectName()&&(a.isIntermediate=0===this._postProcesses.length),a._postProcesses=this._postProcesses.slice(0).concat(p),p.markTextureDirty()}else a._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!a.isReusable()&&this._postProcesses.indexOf(a)>-1?(F.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==v||v<0?this._postProcesses.push(a):null===this._postProcesses[v]?this._postProcesses[v]=a:this._postProcesses.splice(v,0,a),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Sg(),this._postProcesses.indexOf(a))}detachPostProcess(a){const v=this._postProcesses.indexOf(a);-1!==v&&(this._postProcesses[v]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Sg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return K.e.Identity()}getViewMatrix(a){return!a&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(a){this._doNotComputeProjectionMatrix=!0,void 0!==a&&(this._projectionMatrix=a)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(a){if(this._doNotComputeProjectionMatrix||!a&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.fj=this.fj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const v=this.getEngine(),p=this.va(),P=v.useReverseDepthBuffer;if(this.mode===h.PERSPECTIVE_CAMERA){let a;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=v.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.fj<=0&&(this.fj=.1),a=p.useRightHandedSystem?K.e.PerspectiveFovRHToRef:K.e.PerspectiveFovLHToRef,a(this.fov,v.getAspectRatio(this),P?this.maxZ:this.fj,P?this.fj:this.maxZ,this._projectionMatrix,this.fovMode===h.FOVMODE_VERTICAL_FIXED,v.isNDCHalfZRange,this.projectionPlaneTilt,P)}else{var b,L,t;const a=v.getRenderWidth()/2,V=v.getRenderHeight()/2;p.useRightHandedSystem?this.oblique?K.e.ObliqueOffCenterRHToRef(this.orthoLeft??-a,this.orthoRight??a,this.orthoBottom??-V,this.orthoTop??V,P?this.maxZ:this.fj,P?this.fj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,v.isNDCHalfZRange):K.e.OrthoOffCenterRHToRef(this.orthoLeft??-a,this.orthoRight??a,this.orthoBottom??-V,this.orthoTop??V,P?this.maxZ:this.fj,P?this.fj:this.maxZ,this._projectionMatrix,v.isNDCHalfZRange):this.oblique?K.e.ObliqueOffCenterLHToRef(this.orthoLeft??-a,this.orthoRight??a,this.orthoBottom??-V,this.orthoTop??V,P?this.maxZ:this.fj,P?this.fj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,v.isNDCHalfZRange):K.e.OrthoOffCenterLHToRef(this.orthoLeft??-a,this.orthoRight??a,this.orthoBottom??-V,this.orthoTop??V,P?this.maxZ:this.fj,P?this.fj:this.maxZ,this._projectionMatrix,v.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(b=this.oblique)||void 0===b?void 0:b.angle,this._cache.obliqueLength=null===(L=this.oblique)||void 0===L?void 0:L.length,this._cache.obliqueOffset=null===(t=this.oblique)||void 0===t?void 0:t.offset,this._cache.renderWidth=v.getRenderWidth(),this._cache.renderHeight=v.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(a){return(this.radius||(this.target?K.s.Distance(this.position,this.target):this.position.length()))+a}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?H.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=H.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),v&&this.rigCameras.length>0){let v=!1;return this.rigCameras.forEach((p=>{p._updateFrustumPlanes(),v=v||a.isInFrustum(p._frustumPlanes)})),v}return a.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(a){return this._updateFrustumPlanes(),a.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,c.c)("Ray")}getForwardRayToRef(a){throw(0,c.c)("Ray")}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const a=this._rigCameras.pop();a&&a.dispose()}if(this._parentContainer){const a=this._parentContainer.cameras.indexOf(this);a>-1&&this._parentContainer.cameras.splice(a,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==h.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let a=this._postProcesses.length;for(;--a>=0;){const v=this._postProcesses[a];v&&v.dispose(this)}}let p=this.customRenderTargets.length;for(;--p>=0;)this.customRenderTargets[p].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(a,v)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(a,v){if(this.cameraRigMode!==a){for(;this._rigCameras.length>0;){const a=this._rigCameras.pop();a&&a.dispose()}if(this.cameraRigMode=a,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=v.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=t.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==h.RIG_MODE_NONE){const a=this.createRigCamera(this.name+"_L",0);a&&(a._isLeftCamera=!0);const v=this.createRigCamera(this.name+"_R",1);v&&(v._isRightCamera=!0),a&&v&&(this._rigCameras.push(a),this._rigCameras.push(v))}this._setRigMode(v),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(a){}_getVRProjectionMatrix(){return K.e.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.fj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(a,v){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[a]=v,"interaxialDistance"===a&&(this._cameraRigParams.stereoHalfAngle=t.e.ToRadians(v/.0637))}createRigCamera(a,v){return null}_updateRigCameras(){for(let a=0;a<this._rigCameras.length;a++)this._rigCameras[a].fj=this.fj,this._rigCameras[a].maxZ=this.maxZ,this._rigCameras[a].fov=this.fov,this._rigCameras[a].upVector.p(this.upVector);this.cameraRigMode===h.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const a=A.b.Serialize(this);return a.uniqueId=this.uniqueId,a.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(a),this.inputs&&this.inputs.serialize(a),A.b.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a.isEnabled=this.isEnabled(),a}clone(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=A.b.Clone(h.GetConstructorFromName(this.getClassName(),a,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return p.name=a,p.parent=v,this.onClonedObservable.notifyObservers(p),p}gf(a){const v=K.s.Zero();return this.getDirectionToRef(a,v),v}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(a,v){K.s.TransformNormalToRef(a,this.getWorldMatrix(),v)}static GetConstructorFromName(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const L=C.b.Construct(a,v,p,{interaxial_distance:P,isStereoscopicSideBySide:b});return L||(()=>h._CreateDefaultParsedCamera(v,p))}Zj(){return this.getWorldMatrix()}static Parse(a,v){const p=a.type,P=h.GetConstructorFromName(p,a.name,v,a.interaxial_distance,a.isStereoscopicSideBySide),b=A.b.Parse(P,a,v);if(void 0!==a.parentId&&(b._waitingParentId=a.parentId),void 0!==a.parentInstanceIndex&&(b._waitingParentInstanceIndex=a.parentInstanceIndex),b.inputs&&(b.inputs.parse(a),b._setupInputs()),a.upVector&&(b.upVector=K.s.bh(a.upVector)),b.setPosition&&(b.position.qe(0,0,0),b.setPosition(K.s.bh(a.position))),a.target&&b.setTarget&&b.setTarget(K.s.bh(a.target)),a.cameraRigMode){const v=a.interaxial_distance?{interaxialDistance:a.interaxial_distance}:{};b.setCameraRigMode(a.cameraRigMode,v)}if(a.animations){for(let v=0;v<a.animations.length;v++){const p=a.animations[v],P=(0,u.c)("BABYLON.Animation");P&&b.animations.push(P.Parse(p))}C.b.ParseAnimationRanges(b,a,v)}return a.autoAnimate&&v.beginAnimation(b,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.isEnabled&&b.Mb(a.isEnabled),b}_calculateHandednessMultiplier(){let a=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(a*=-1),a}}h._CreateDefaultParsedCamera=(a,v)=>{throw(0,c.c)("UniversalCamera")},h.PERSPECTIVE_CAMERA=0,h.ORTHOGRAPHIC_CAMERA=1,h.FOVMODE_VERTICAL_FIXED=0,h.FOVMODE_HORIZONTAL_FIXED=1,h.RIG_MODE_NONE=0,h.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,h.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,h.RIG_MODE_STEREOSCOPIC_INTERLACED=14,h.RIG_MODE_VR=20,h.RIG_MODE_CUSTOM=22,h.ForceAttachControlToAlwaysPreventDefault=!1,(0,P.e)([(0,b.M)("position")],h.prototype,"_position",void 0),(0,P.e)([(0,b.M)("upVector")],h.prototype,"_upVector",void 0),(0,P.e)([(0,b.O)()],h.prototype,"orthoLeft",null),(0,P.e)([(0,b.O)()],h.prototype,"orthoRight",null),(0,P.e)([(0,b.O)()],h.prototype,"orthoBottom",null),(0,P.e)([(0,b.O)()],h.prototype,"orthoTop",null),(0,P.e)([(0,b.O)()],h.prototype,"fov",void 0),(0,P.e)([(0,b.O)()],h.prototype,"projectionPlaneTilt",void 0),(0,P.e)([(0,b.O)()],h.prototype,"fj",void 0),(0,P.e)([(0,b.O)()],h.prototype,"maxZ",void 0),(0,P.e)([(0,b.O)()],h.prototype,"inertia",void 0),(0,P.e)([(0,b.O)()],h.prototype,"mode",null),(0,P.e)([(0,b.O)()],h.prototype,"layerMask",void 0),(0,P.e)([(0,b.O)()],h.prototype,"fovMode",void 0),(0,P.e)([(0,b.O)()],h.prototype,"cameraRigMode",void 0),(0,P.e)([(0,b.O)()],h.prototype,"interaxialDistance",void 0),(0,P.e)([(0,b.O)()],h.prototype,"isStereoscopicSideBySide",void 0)},12404:(a,v,p)=>{"use strict";p.d(v,{b:()=>t,d:()=>V});var P=p(10905),b=p(11287),L=p(11512),t={};class V{constructor(a){this.attachedToElement=!1,this.attached={},this.camera=a,this.checkInputs=()=>{}}add(a){const v=a.getSimpleName();this.attached[v]?P.d.Warn("camera input of type "+v+" already exists on camera"):(this.attached[v]=a,a.camera=this.camera,a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a))),this.attachedToElement&&a.attachControl(this.noPreventDefault))}remove(a){for(const v in this.attached){const p=this.attached[v];if(p===a)return p.bj(),p.camera=null,delete this.attached[v],void this.rebuildInputCheck()}}removeByType(a){for(const v in this.attached){const p=this.attached[v];p.getClassName()===a&&(p.bj(),p.camera=null,delete this.attached[v],this.rebuildInputCheck())}}_addCheckInputs(a){const v=this.checkInputs;return()=>{v(),a()}}attachInput(a){this.attachedToElement&&a.attachControl(this.noPreventDefault)}attachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){a=!L.e.ForceAttachControlToAlwaysPreventDefault&&a,this.attachedToElement=!0,this.noPreventDefault=a;for(const v in this.attached)this.attached[v].attachControl(a)}}detachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const v in this.attached)this.attached[v].bj(),a&&(this.attached[v].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const a in this.attached){const v=this.attached[a];v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(a){const v={};for(const p in this.attached){const a=this.attached[p],P=b.b.Serialize(a);v[a.getClassName()]=P}a.inputsmgr=v}parse(a){const v=a.inputsmgr;if(v){this.clear();for(const a in v){const p=t[a];if(p){const P=v[a],L=b.b.Parse((()=>new p),P,null);this.add(L)}}}else for(const p in this.attached){const v=t[this.attached[p].getClassName()];if(v){const P=b.b.Parse((()=>new v),a,null);this.remove(this.attached[p]),this.add(P)}}}}},12388:(a,v,p)=>{"use strict";p.d(v,{c:()=>y});var P=p(11207),b=p(11210),L=p(11240),t=p(12396),V=p(12404),K=p(11344),C=p(10889);class F{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(a){a=C.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((v=>{const p=v.event;if(!p.metaKey)if(v.type===K.d.KEYDOWN){if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysUpward.indexOf(p.keyCode)||-1!==this.keysDownward.indexOf(p.keyCode)||-1!==this.keysRotateLeft.indexOf(p.keyCode)||-1!==this.keysRotateRight.indexOf(p.keyCode)||-1!==this.keysRotateUp.indexOf(p.keyCode)||-1!==this.keysRotateDown.indexOf(p.keyCode)){-1===this._keys.indexOf(p.keyCode)&&this._keys.push(p.keyCode),a||p.preventDefault()}}else if(-1!==this.keysUp.indexOf(p.keyCode)||-1!==this.keysDown.indexOf(p.keyCode)||-1!==this.keysLeft.indexOf(p.keyCode)||-1!==this.keysRight.indexOf(p.keyCode)||-1!==this.keysUpward.indexOf(p.keyCode)||-1!==this.keysDownward.indexOf(p.keyCode)||-1!==this.keysRotateLeft.indexOf(p.keyCode)||-1!==this.keysRotateRight.indexOf(p.keyCode)||-1!==this.keysRotateUp.indexOf(p.keyCode)||-1!==this.keysRotateDown.indexOf(p.keyCode)){const v=this._keys.indexOf(p.keyCode);v>=0&&this._keys.splice(v,1),a||p.preventDefault()}})))}bj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let v=0;v<this._keys.length;v++){const p=this._keys[v],P=a._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(p)?a._localDirection.qe(-P,0,0):-1!==this.keysUp.indexOf(p)?a._localDirection.qe(0,0,P):-1!==this.keysRight.indexOf(p)?a._localDirection.qe(P,0,0):-1!==this.keysDown.indexOf(p)?a._localDirection.qe(0,0,-P):-1!==this.keysUpward.indexOf(p)?a._localDirection.qe(0,P,0):-1!==this.keysDownward.indexOf(p)?a._localDirection.qe(0,-P,0):-1!==this.keysRotateLeft.indexOf(p)?(a._localDirection.qe(0,0,0),a.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(p)?(a._localDirection.qe(0,0,0),a.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(p)?(a._localDirection.qe(0,0,0),a.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(p)&&(a._localDirection.qe(0,0,0),a.cameraRotation.x+=this._getLocalRotation()),a.va().useRightHandedSystem&&(a._localDirection.z*=-1),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),L.s.TransformNormalToRef(a._localDirection,a._cameraTransformMatrix,a._transformedDirection),a.cameraDirection.addInPlace(a._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const a=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*a}}(0,P.e)([(0,b.O)()],F.prototype,"keysUp",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysUpward",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysDown",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysDownward",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysLeft",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysRight",void 0),(0,P.e)([(0,b.O)()],F.prototype,"rotationSpeed",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysRotateLeft",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysRotateRight",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysRotateUp",void 0),(0,P.e)([(0,b.O)()],F.prototype,"keysRotateDown",void 0),V.b.FreeCameraKeyboardMoveInput=F;var u=p(10893),c=p(11340);class f{constructor(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=a,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new u.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(a){a=C.e.BackCompatCameraNoPreventDefault(arguments);const v=this.camera.getEngine(),p=v.getInputElement();this._pointerInput||(this._pointerInput=P=>{const b=P.event,L="touch"===b.pointerType;if(!this.touchEnabled&&L)return;if(P.type!==c.e.POINTERMOVE&&-1===this.buttons.indexOf(b.button))return;const t=b.target;if(P.type===c.e.POINTERDOWN){if(L&&-1!==this._activePointerId||!L&&-1!==this._currentActiveButton)return;this._activePointerId=b.pointerId;try{null===t||void 0===t||t.setPointerCapture(b.pointerId)}catch(V){}-1===this._currentActiveButton&&(this._currentActiveButton=b.button),this._previousPosition={x:b.clientX,y:b.clientY},a||(b.preventDefault(),p&&p.focus()),v.isPointerLock&&this._onMouseMove&&this._onMouseMove(P.event)}else if(P.type===c.e.POINTERUP){if(L&&this._activePointerId!==b.pointerId||!L&&this._currentActiveButton!==b.button)return;try{null===t||void 0===t||t.releasePointerCapture(b.pointerId)}catch(V){}this._currentActiveButton=-1,this._previousPosition=null,a||b.preventDefault(),this._activePointerId=-1}else if(P.type===c.e.POINTERMOVE&&(this._activePointerId===b.pointerId||!L))if(v.isPointerLock&&this._onMouseMove)this._onMouseMove(P.event);else if(this._previousPosition){const v=this.camera._calculateHandednessMultiplier(),p=(b.clientX-this._previousPosition.x)*v,P=b.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=p/this.angularSensibility,this.camera.cameraRotation.x+=P/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:p,offsetY:P}),this._previousPosition={x:b.clientX,y:b.clientY},a||b.preventDefault()}}),this._onMouseMove=p=>{if(!v.isPointerLock)return;const P=this.camera._calculateHandednessMultiplier(),b=p.movementX*P;this.camera.cameraRotation.y+=b/this.angularSensibility;const L=p.movementY;this.camera.cameraRotation.x+=L/this.angularSensibility,this._previousPosition=null,a||p.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.e.POINTERDOWN|c.e.POINTERUP|c.e.POINTERMOVE),p&&(this._contextMenuBind=a=>this.onContextMenu(a),p.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(a){a.preventDefault()}bj(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,P.e)([(0,b.O)()],f.prototype,"buttons",void 0),(0,P.e)([(0,b.O)()],f.prototype,"angularSensibility",void 0),V.b.FreeCameraMouseInput=f;var H,A=p(11346);class h{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new u.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(a){a=C.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=v=>{if(v.type!==c.e.POINTERWHEEL)return;const p=v.event,P=p.deltaMode===A.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*P*p.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*P*p.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*P*p.deltaZ/this._normalize,p.preventDefault&&(a||p.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,c.e.POINTERWHEEL)}bj(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,P.e)([(0,b.O)()],h.prototype,"wheelPrecisionX",void 0),(0,P.e)([(0,b.O)()],h.prototype,"wheelPrecisionY",void 0),(0,P.e)([(0,b.O)()],h.prototype,"wheelPrecisionZ",void 0),function(a){a[a.MoveRelative=0]="MoveRelative",a[a.RotateRelative=1]="RotateRelative",a[a.MoveScene=2]="MoveScene"}(H||(H={}));class R extends h{constructor(){super(...arguments),this._moveRelative=L.s.Zero(),this._rotateRelative=L.s.Zero(),this._moveScene=L.s.Zero(),this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(a){null===a&&this._wheelXAction!==H.MoveRelative||(this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=a)}get wheelXMoveRelative(){return this._wheelXAction!==H.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(a){null===a&&this._wheelYAction!==H.MoveRelative||(this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=a)}get wheelYMoveRelative(){return this._wheelYAction!==H.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(a){null===a&&this._wheelZAction!==H.MoveRelative||(this._wheelZAction=H.MoveRelative,this._wheelZActionCoordinate=a)}get wheelZMoveRelative(){return this._wheelZAction!==H.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(a){null===a&&this._wheelXAction!==H.RotateRelative||(this._wheelXAction=H.RotateRelative,this._wheelXActionCoordinate=a)}get wheelXRotateRelative(){return this._wheelXAction!==H.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(a){null===a&&this._wheelYAction!==H.RotateRelative||(this._wheelYAction=H.RotateRelative,this._wheelYActionCoordinate=a)}get wheelYRotateRelative(){return this._wheelYAction!==H.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(a){null===a&&this._wheelZAction!==H.RotateRelative||(this._wheelZAction=H.RotateRelative,this._wheelZActionCoordinate=a)}get wheelZRotateRelative(){return this._wheelZAction!==H.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(a){null===a&&this._wheelXAction!==H.MoveScene||(this._wheelXAction=H.MoveScene,this._wheelXActionCoordinate=a)}get wheelXMoveScene(){return this._wheelXAction!==H.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(a){null===a&&this._wheelYAction!==H.MoveScene||(this._wheelYAction=H.MoveScene,this._wheelYActionCoordinate=a)}get wheelYMoveScene(){return this._wheelYAction!==H.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(a){null===a&&this._wheelZAction!==H.MoveScene||(this._wheelZAction=H.MoveScene,this._wheelZActionCoordinate=a)}get wheelZMoveScene(){return this._wheelZAction!==H.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.pe(0),this._rotateRelative.pe(0),this._moveScene.pe(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const a=L.e.Zero();this.camera.getViewMatrix().invertToRef(a);const v=L.s.Zero();L.s.TransformNormalToRef(this._moveRelative,a,v),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(v),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(a,v,p){if(0===a)return;if(null===v||null===p)return;let P=null;switch(v){case H.MoveRelative:P=this._moveRelative;break;case H.RotateRelative:P=this._rotateRelative;break;case H.MoveScene:P=this._moveScene}switch(p){case 0:P.set(a,0,0);break;case 1:P.set(0,a,0);break;case 2:P.set(0,0,a)}}}(0,P.e)([(0,b.O)()],R.prototype,"wheelXMoveRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelYMoveRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelZMoveRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelXRotateRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelYRotateRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelZRotateRelative",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelXMoveScene",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelYMoveScene",null),(0,P.e)([(0,b.O)()],R.prototype,"wheelZMoveScene",null),V.b.FreeCameraMouseWheelInput=R;class X{constructor(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=a,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=C.e.IsSafari()}attachControl(a){a=C.e.BackCompatCameraNoPreventDefault(arguments);let v=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=p=>{const P=p.event,b="mouse"===P.pointerType||this._isSafari&&"undefined"===typeof P.pointerType;if(this.allowMouse||!b)if(p.type===c.e.POINTERDOWN){if(a||P.preventDefault(),this._pointerPressed.push(P.pointerId),1!==this._pointerPressed.length)return;v={x:P.clientX,y:P.clientY}}else if(p.type===c.e.POINTERUP){a||P.preventDefault();const p=this._pointerPressed.indexOf(P.pointerId);if(-1===p)return;if(this._pointerPressed.splice(p,1),0!=p)return;v=null,this._offsetX=null,this._offsetY=null}else if(p.type===c.e.POINTERMOVE){if(a||P.preventDefault(),!v)return;if(0!=this._pointerPressed.indexOf(P.pointerId))return;this._offsetX=P.clientX-v.x,this._offsetY=-(P.clientY-v.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,c.e.POINTERDOWN|c.e.POINTERUP|c.e.POINTERMOVE),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.addEventListener("blur",this._onLostFocus)}}bj(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const a=this.camera,v=a._calculateHandednessMultiplier();a.cameraRotation.y=v*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)a.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const v=a._computeLocalCameraSpeed(),p=new L.s(0,0,0!==this.touchMoveSensibility?v*this._offsetY/this.touchMoveSensibility:0);L.e.RotationYawPitchRollToRef(a.rotation.y,a.rotation.x,0,a._cameraRotationMatrix),a.cameraDirection.addInPlace(L.s.TransformCoordinates(p,a._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,P.e)([(0,b.O)()],X.prototype,"touchAngularSensibility",void 0),(0,P.e)([(0,b.O)()],X.prototype,"touchMoveSensibility",void 0),V.b.FreeCameraTouchInput=X;class Q extends V.d{constructor(a){super(a),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new F),this}addMouse(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new f(a),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new R,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new X),this}clear(){super.clear(),this._mouseInput=null}}var s=p(11027),D=p(10974);class y extends t.c{get angularSensibility(){const a=this.inputs.attached.mouse;return a?a.angularSensibility:0}set angularSensibility(a){const v=this.inputs.attached.mouse;v&&(v.angularSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const v=this.inputs.attached.keyboard;v&&(v.keysUp=a)}get keysUpward(){const a=this.inputs.attached.keyboard;return a?a.keysUpward:[]}set keysUpward(a){const v=this.inputs.attached.keyboard;v&&(v.keysUpward=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const v=this.inputs.attached.keyboard;v&&(v.keysDown=a)}get keysDownward(){const a=this.inputs.attached.keyboard;return a?a.keysDownward:[]}set keysDownward(a){const v=this.inputs.attached.keyboard;v&&(v.keysDownward=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const v=this.inputs.attached.keyboard;v&&(v.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const v=this.inputs.attached.keyboard;v&&(v.keysRight=a)}get keysRotateLeft(){const a=this.inputs.attached.keyboard;return a?a.keysRotateLeft:[]}set keysRotateLeft(a){const v=this.inputs.attached.keyboard;v&&(v.keysRotateLeft=a)}get keysRotateRight(){const a=this.inputs.attached.keyboard;return a?a.keysRotateRight:[]}set keysRotateRight(a){const v=this.inputs.attached.keyboard;v&&(v.keysRotateRight=a)}get keysRotateUp(){const a=this.inputs.attached.keyboard;return a?a.keysRotateUp:[]}set keysRotateUp(a){const v=this.inputs.attached.keyboard;v&&(v.keysRotateUp=a)}get keysRotateDown(){const a=this.inputs.attached.keyboard;return a?a.keysRotateDown:[]}set keysRotateDown(a){const v=this.inputs.attached.keyboard;v&&(v.keysRotateDown=a)}constructor(a,v,p){var P;super(a,v,p,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),P=this,this.ellipsoid=new L.s(.5,1,.5),this.ellipsoidOffset=new L.s(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=L.s.Zero(),this._diffPosition=L.s.Zero(),this._newPosition=L.s.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P._newPosition.p(v),P._newPosition.subtractToRef(P._oldPosition,P._diffPosition),P._diffPosition.length()>D.e.CollisionsEpsilon&&(P.position.addToRef(P._diffPosition,P._deferredPositionUpdate),P._deferOnly?P._deferredUpdated=!0:P.position.p(P._deferredPositionUpdate),P.Tk&&p&&P.Tk(p))},this.inputs=new Q(this),this.inputs.addKeyboard().addMouse()}attachControl(a,v){v=C.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(v)}bj(){this.inputs.detachElement(),this.cameraDirection=new L.s(0,0,0),this.cameraRotation=new L.o(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(a){this._collisionMask=isNaN(a)?-1:a}_collideWithWorld(a){let v;v=this.parent?L.s.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,v.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const p=this.va().collisionCoordinator;this._collider||(this._collider=p.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let P=a;this.applyGravity&&(P=a.add(this.va().gravity)),p.getNewPosition(this._oldPosition,P,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=L.s.Zero(),this._transformedDirection=L.s.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(a){this._needMoveForGravity=a}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,P.e)([(0,b.M)()],y.prototype,"ellipsoid",void 0),(0,P.e)([(0,b.M)()],y.prototype,"ellipsoidOffset",void 0),(0,P.e)([(0,b.O)()],y.prototype,"checkCollisions",void 0),(0,P.e)([(0,b.O)()],y.prototype,"applyGravity",void 0),(0,s.f)("BABYLON.FreeCamera",y)},12396:(a,v,p)=>{"use strict";p.d(v,{c:()=>C});var P=p(11207),b=p(11210),L=p(11512),t=p(11240),V=p(11245),K=p(11549);p(11515).b.AddNodeConstructor("TargetCamera",((a,v)=>()=>new C(a,t.s.Zero(),v)));class C extends L.e{constructor(a,v,p){super(a,v,p,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=t.s.Zero(),this._tmpTargetVector=t.s.Zero(),this.cameraDirection=new t.s(0,0,0),this.cameraRotation=new t.o(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new t.i,this.rotation=new t.s(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=t.s.Zero(),this._initialFocalDistance=1,this._viewMatrix=t.e.Zero(),this._camMatrix=t.e.Zero(),this._cameraTransformMatrix=t.e.Zero(),this._cameraRotationMatrix=t.e.Zero(),this._referencePoint=new t.s(0,0,1),this._transformedReferencePoint=t.s.Zero(),this._deferredPositionUpdate=new t.s,this._deferredRotationQuaternionUpdate=new t.i,this._deferredRotationUpdate=new t.s,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=t.s.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(a){this.getWorldMatrix();const v=this.getTarget().od(this.position);return v.normalize(),v.scaleInPlace(a),this.globalPosition.add(v)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const a=this.lockedTarget;a.Zj().getTranslationToRef(a.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.qe(0,0,0),this.cameraRotation.qe(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new t.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new t.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new t.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(a){a||super._updateCache();const v=this._getLockedTargetPosition();v?this._cache.lockedTarget?this._cache.lockedTarget.p(v):this._cache.lockedTarget=v.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const a=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(a):!a)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const a=this.getEngine();return this.speed*Math.sqrt(a.getDeltaTime()/(100*a.getFps()))}setTarget(a){this.upVector.normalize(),this._initialFocalDistance=a.od(this.position).length(),this.position.z===a.z&&(this.position.z+=V.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),t.e.LookAtLHToRef(this.position,a,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const v=a.od(this.position);v.x>=0?this.rotation.y=-Math.atan(v.z/v.x)+Math.PI/2:this.rotation.y=-Math.atan(v.z/v.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&t.i.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(a){this.setTarget(a)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(t.k.Matrix[0]),t.s.TransformNormalToRef(this.cameraDirection,t.k.Matrix[0],t.k.fb[0]),this._deferredPositionUpdate.addInPlace(t.k.fb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const a=this.invertRotation?-this.inverseRotationSpeed:1,v=this._decideIfNeedsToMove(),p=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),v&&this._updatePosition(),p){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*a,this._deferredRotationUpdate.y+=this.cameraRotation.y*a,!this.noRotationConstraint){const a=1.570796;this._deferredRotationUpdate.x>a&&(this._deferredRotationUpdate.x=a),this._deferredRotationUpdate.x<-a&&(this._deferredRotationUpdate.x=-a)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(t.i.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}v&&(Math.abs(this.cameraDirection.x)<this.speed*V.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*V.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*V.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),p&&(Math.abs(this.cameraRotation.x)<this.speed*V.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*V.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):t.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return t.s.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),t.s.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?K.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(t.i.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),K.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(a,v,p){if(this.ignoreParentScaling){if(this.parent){const P=this.parent.getWorldMatrix();t.s.TransformCoordinatesToRef(a,P,this._globalPosition),t.s.TransformCoordinatesToRef(v,P,this._tmpTargetVector),t.s.TransformNormalToRef(p,P,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(a),this._tmpTargetVector.p(v),this._tmpUpVector.p(p);this.va().useRightHandedSystem?t.e.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):t.e.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?t.e.LookAtRHToRef(a,v,p,this._viewMatrix):t.e.LookAtLHToRef(a,v,p,this._viewMatrix),this.parent){const a=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(a,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(a)}createRigCamera(a,v){if(this.cameraRigMode!==L.e.RIG_MODE_NONE){const v=new C(a,this.position.clone(),this.va());return v.isRigCamera=!0,v.rigParent=this,this.cameraRigMode===L.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new t.i),v._cameraRigParams={},v.rotationQuaternion=new t.i),v.mode=this.mode,v.orthoLeft=this.orthoLeft,v.orthoRight=this.orthoRight,v.orthoTop=this.orthoTop,v.orthoBottom=this.orthoBottom,v}return null}_updateRigCameras(){const a=this._rigCameras[0],v=this._rigCameras[1];switch(this.Zj(),this.cameraRigMode){case L.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case L.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const p=this.cameraRigMode===L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,P=this.cameraRigMode===L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*p,a),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*P,v);break}case L.e.RIG_MODE_VR:a.rotationQuaternion?(a.rotationQuaternion.p(this.rotationQuaternion),v.rotationQuaternion.p(this.rotationQuaternion)):(a.rotation.p(this.rotation),v.rotation.p(this.rotation)),a.position.p(this.position),v.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(a,v){this.getTarget().subtractToRef(this.position,C._TargetFocalPoint),C._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const p=C._TargetFocalPoint.addInPlace(this.position);t.e.TranslationToRef(-p.x,-p.y,-p.z,C._TargetTransformMatrix),C._TargetTransformMatrix.multiplyToRef(t.e.RotationAxis(v.upVector,a),C._RigCamTransformMatrix),t.e.TranslationToRef(p.x,p.y,p.z,C._TargetTransformMatrix),C._RigCamTransformMatrix.multiplyToRef(C._TargetTransformMatrix,C._RigCamTransformMatrix),t.s.TransformCoordinatesToRef(this.position,C._RigCamTransformMatrix,v.position),v.setTarget(p)}getClassName(){return"TargetCamera"}}C._RigCamTransformMatrix=new t.e,C._TargetTransformMatrix=new t.e,C._TargetFocalPoint=new t.s,(0,P.e)([(0,b.M)()],C.prototype,"rotation",void 0),(0,P.e)([(0,b.O)()],C.prototype,"speed",void 0),(0,P.e)([(0,b.C)("lockedTargetId")],C.prototype,"lockedTarget",void 0)},11404:(a,v,p)=>{"use strict";p.d(v,{c:()=>P});class P{constructor(a,v,p){this.bu=a,this.bv=v,this.distance=p,this.faceId=0,this.subMeshId=0}}},11304:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(11240),b=p(11306);class L{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var a;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||p&&!this.pickedMesh.isVerticesDataPresent(b.f.NormalKind))return null;let L,t=this.pickedMesh.ng();0===(null===(a=t)||void 0===a?void 0:a.length)&&(t=null);const V=P.k.fb[0],K=P.k.fb[1],C=P.k.fb[2];if(p){const a=this.pickedMesh.getVerticesData(b.f.NormalKind);let v=t?P.s.FromArrayToRef(a,3*t[3*this.faceId],V):V.qe(a[3*this.faceId*3],a[3*this.faceId*3+1],a[3*this.faceId*3+2]),p=t?P.s.FromArrayToRef(a,3*t[3*this.faceId+1],K):K.qe(a[3*(3*this.faceId+1)],a[3*(3*this.faceId+1)+1],a[3*(3*this.faceId+1)+2]),F=t?P.s.FromArrayToRef(a,3*t[3*this.faceId+2],C):C.qe(a[3*(3*this.faceId+2)],a[3*(3*this.faceId+2)+1],a[3*(3*this.faceId+2)+2]);v=v.scale(this.bu),p=p.scale(this.bv),F=F.scale(1-this.bu-this.bv),L=new P.s(v.x+p.x+F.x,v.y+p.y+F.y,v.z+p.z+F.z)}else{const a=this.pickedMesh.getVerticesData(b.f.PositionKind),v=t?P.s.FromArrayToRef(a,3*t[3*this.faceId],V):V.qe(a[3*this.faceId*3],a[3*this.faceId*3+1],a[3*this.faceId*3+2]),p=t?P.s.FromArrayToRef(a,3*t[3*this.faceId+1],K):K.qe(a[3*(3*this.faceId+1)],a[3*(3*this.faceId+1)+1],a[3*(3*this.faceId+1)+2]),F=t?P.s.FromArrayToRef(a,3*t[3*this.faceId+2],C):C.qe(a[3*(3*this.faceId+2)],a[3*(3*this.faceId+2)+1],a[3*(3*this.faceId+2)+2]),u=v.od(p),c=F.od(p);L=P.s.Cross(u,c)}const F=(a,v)=>{let p=a.getWorldMatrix();a.nonUniformScaling&&(P.k.Matrix[0].p(p),p=P.k.Matrix[0],p.setTranslationFromFloats(0,0,0),p.invert(),p.transposeToRef(P.k.Matrix[1]),p=P.k.Matrix[1]),P.s.TransformNormalToRef(v,p,v)};if(v&&F(this.pickedMesh,L),this.ray){const a=P.k.fb[0].p(L);v||F(this.pickedMesh,a),P.s.Dot(a,this.ray.direction)>0&&L.negateInPlace()}return L.normalize(),L}getTextureCoordinates(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(a))return null;const v=this.pickedMesh.ng();if(!v)return null;const p=this.pickedMesh.getVerticesData(a);if(!p)return null;let L=P.o.bh(p,2*v[3*this.faceId]),t=P.o.bh(p,2*v[3*this.faceId+1]),V=P.o.bh(p,2*v[3*this.faceId+2]);return L=L.scale(this.bu),t=t.scale(this.bv),V=V.scale(1-this.bu-this.bv),new P.o(L.x+t.x+V.x,L.y+t.y+V.y)}}},11470:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});let P=!1},12906:(a,v,p)=>{"use strict";p.d(v,{e:()=>L});var P=p(11223),b=p(12912);class L{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=p,this.yi=[],this._maxBlockCapacity=v||64,this._selectionContent=new P.c(1024),this._creationFunc=a}update(a,v,p){b.c._CreateBlocks(a,v,p,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}xi(a){for(let v=0;v<this.Kh.length;v++){this.Kh[v].addEntry(a)}}Qc(a){for(let v=0;v<this.Kh.length;v++){this.Kh[v].removeEntry(a)}}select(a,v){this._selectionContent.reset();for(let p=0;p<this.Kh.length;p++){this.Kh[p].select(a,this._selectionContent,v)}return v?this._selectionContent.concat(this.yi):this._selectionContent.concatWithNoDuplicate(this.yi),this._selectionContent}intersects(a,v,p){this._selectionContent.reset();for(let P=0;P<this.Kh.length;P++){this.Kh[P].intersects(a,v,this._selectionContent,p)}return p?this._selectionContent.concat(this.yi):this._selectionContent.concatWithNoDuplicate(this.yi),this._selectionContent}intersectsRay(a){this._selectionContent.reset();for(let v=0;v<this.Kh.length;v++){this.Kh[v].intersectsRay(a,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.yi),this._selectionContent}}L.CreationFuncForMeshes=(a,v)=>{const p=a.getBoundingInfo();!a.isBlocked&&p.boundingBox.intersectsMinMax(v.Ci,v.Di)&&v.entries.push(a)},L.CreationFuncForSubMeshes=(a,v)=>{a.getBoundingInfo().boundingBox.intersectsMinMax(v.Ci,v.Di)&&v.entries.push(a)}},12912:(a,v,p)=>{"use strict";p.d(v,{c:()=>L});var P=p(11240),b=p(11421);class L{constructor(a,v,p,P,b,L){this.entries=[],this.Ei=new Array,this._capacity=p,this._depth=P,this._maxDepth=b,this._creationFunc=L,this._minPoint=a,this._maxPoint=v,this.Ei.push(a.clone()),this.Ei.push(v.clone()),this.Ei.push(a.clone()),this.Ei[2].x=v.x,this.Ei.push(a.clone()),this.Ei[3].y=v.y,this.Ei.push(a.clone()),this.Ei[4].z=v.z,this.Ei.push(v.clone()),this.Ei[5].z=a.z,this.Ei.push(v.clone()),this.Ei[6].x=a.x,this.Ei.push(v.clone()),this.Ei[7].y=a.y}get ub(){return this._capacity}get Ci(){return this._minPoint}get Di(){return this._maxPoint}addEntry(a){if(this.Kh)for(let v=0;v<this.Kh.length;v++){this.Kh[v].addEntry(a)}else this._creationFunc(a,this),this.entries.length>this.ub&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(a){if(this.Kh){for(let v=0;v<this.Kh.length;v++){this.Kh[v].removeEntry(a)}return}const v=this.entries.indexOf(a);v>-1&&this.entries.splice(v,1)}addEntries(a){for(let v=0;v<a.length;v++){const p=a[v];this.addEntry(p)}}select(a,v,p){if(b.b.IsInFrustum(this.Ei,a)){if(this.Kh){for(let P=0;P<this.Kh.length;P++){this.Kh[P].select(a,v,p)}return}p?v.concat(this.entries):v.concatWithNoDuplicate(this.entries)}}intersects(a,v,p,P){if(b.b.IntersectsSphere(this._minPoint,this._maxPoint,a,v)){if(this.Kh){for(let b=0;b<this.Kh.length;b++){this.Kh[b].intersects(a,v,p,P)}return}P?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersectsRay(a,v){if(a.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Kh){for(let p=0;p<this.Kh.length;p++){this.Kh[p].intersectsRay(a,v)}return}v.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){L._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(a,v,p,b,t,V,K,C){K.Kh=new Array;const F=new P.s((v.x-a.x)/2,(v.y-a.y)/2,(v.z-a.z)/2);for(let P=0;P<2;P++)for(let v=0;v<2;v++)for(let u=0;u<2;u++){const c=a.add(F.multiplyByFloats(P,v,u)),f=a.add(F.multiplyByFloats(P+1,v+1,u+1)),H=new L(c,f,b,t+1,V,C);H.addEntries(p),K.Kh.push(H)}}}},12915:(a,v,p)=>{"use strict";p.d(v,{c:()=>F});var P=p(11229),b=p(11240),L=p(11539),t=p(11848),V=p(11332),K=p(12906),C=p(10939);P.c.prototype.createOrUpdateSelectionOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,p=this._getComponent(V.c.NAME_OCTREE);p||(p=new F(this),this.o(p)),this.ui||(this.ui=new K.e(K.e.CreationFuncForMeshes,a,v));const P=this.getWorldExtends();return this.ui.update(P.min,P.max,this.meshes),this.ui},Object.defineProperty(P.c.prototype,"selectionOctree",{get:function(){return this.ui},enumerable:!0,configurable:!0}),L.e.prototype.createOrUpdateSubmeshesOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const p=this.va();let P=p._getComponent(V.c.NAME_OCTREE);P||(P=new F(p),p.o(P)),this._submeshesOctree||(this._submeshesOctree=new K.e(K.e.CreationFuncForSubMeshes,a,v)),this.Zj(!0);const b=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(b.minimumWorld,b.maximumWorld,this.rg),this._submeshesOctree};class F{constructor(a){this.name=V.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new t.b(b.s.Zero(),new b.s(1,1,1)),(a=a||C.b.LastCreatedScene)&&(this.sd=a,this.sd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.sd.getActiveSubMeshCandidates=a=>this.getActiveSubMeshCandidates(a),this.sd.getCollidingSubMeshCandidates=(a,v)=>this.getCollidingSubMeshCandidates(a,v),this.sd.getIntersectingSubMeshCandidates=(a,v)=>this.getIntersectingSubMeshCandidates(a,v))}register(){this.sd.onMeshRemovedObservable.add((a=>{const v=this.sd.selectionOctree;if(void 0!==v&&null!==v){const p=v.yi.indexOf(a);-1!==p&&v.yi.splice(p,1)}})),this.sd.onMeshImportedObservable.add((a=>{const v=this.sd.selectionOctree;void 0!==v&&null!==v&&v.xi(a)}))}getActiveMeshCandidates(){var a;return(null===(a=this.sd.ui)||void 0===a?void 0:a.select(this.sd.frustumPlanes))||this.sd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(a){if(a._submeshesOctree&&a.useOctreeForRenderingSelection){return a._submeshesOctree.select(this.sd.frustumPlanes)}return this.sd._getDefaultSubMeshCandidates(a)}getIntersectingSubMeshCandidates(a,v){if(a._submeshesOctree&&a.useOctreeForPicking){t.b.TransformToRef(v,a.getWorldMatrix(),this._tempRay);return a._submeshesOctree.intersectsRay(this._tempRay)}return this.sd._getDefaultSubMeshCandidates(a)}getCollidingSubMeshCandidates(a,v){if(a._submeshesOctree&&a.useOctreeForCollisions){const p=v._velocityWorldLength+Math.max(v._radius.x,v._radius.y,v._radius.z);return a._submeshesOctree.intersects(v._basePointWorld,p)}return this.sd._getDefaultSubMeshCandidates(a)}rebuild(){}dispose(){}}},11421:(a,v,p)=>{"use strict";p.d(v,{b:()=>t});var P=p(11254),b=p(11240),L=p(11245);class t{constructor(a,v,p){this.vectors=(0,P.d)(8,b.s.Zero),this.center=b.s.Zero(),this.centerWorld=b.s.Zero(),this.extendSize=b.s.Zero(),this.extendSizeWorld=b.s.Zero(),this.directions=(0,P.d)(3,b.s.Zero),this.vectorsWorld=(0,P.d)(8,b.s.Zero),this.minimumWorld=b.s.Zero(),this.maximumWorld=b.s.Zero(),this.minimum=b.s.Zero(),this.maximum=b.s.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(a,v,p)}reConstruct(a,v,p){const P=a.x,L=a.y,t=a.z,V=v.x,K=v.y,C=v.z,F=this.vectors;this.minimum.qe(P,L,t),this.maximum.qe(V,K,C),F[0].qe(P,L,t),F[1].qe(V,K,C),F[2].qe(V,L,t),F[3].qe(P,K,t),F[4].qe(P,L,C),F[5].qe(V,K,t),F[6].qe(P,K,C),F[7].qe(V,L,C),v.addToRef(a,this.center).scaleInPlace(.5),v.subtractToRef(a,this.extendSize).scaleInPlace(.5),this._worldMatrix=p||b.e.IdentityReadOnly,this._update(this._worldMatrix)}scale(a){const v=t._TmpVector3,p=this.maximum.subtractToRef(this.minimum,v[0]),P=p.length();p.normalizeFromLength(P);const b=P*a,L=p.scaleInPlace(.5*b),V=this.center.subtractToRef(L,v[1]),K=this.center.addToRef(L,v[2]);return this.reConstruct(V,K,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){const v=this.minimumWorld,p=this.maximumWorld,P=this.directions,L=this.vectorsWorld,t=this.vectors;if(a.isIdentity()){v.p(this.minimum),p.p(this.maximum);for(let a=0;a<8;++a)L[a].p(t[a]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{v.pe(Number.MAX_VALUE),p.pe(-Number.MAX_VALUE);for(let P=0;P<8;++P){const V=L[P];b.s.TransformCoordinatesToRef(t[P],a,V),v.minimizeInPlace(V),p.maximizeInPlace(V)}p.subtractToRef(v,this.extendSizeWorld).scaleInPlace(.5),p.addToRef(v,this.centerWorld).scaleInPlace(.5)}b.s.FromArrayToRef(a.m,0,P[0]),b.s.FromArrayToRef(a.m,4,P[1]),b.s.FromArrayToRef(a.m,8,P[2]),this._worldMatrix=a}isInFrustum(a){return t.IsInFrustum(this.vectorsWorld,a)}isCompletelyInFrustum(a){return t.IsCompletelyInFrustum(this.vectorsWorld,a)}intersectsPoint(a){const v=this.minimumWorld,p=this.maximumWorld,P=v.x,b=v.y,t=v.z,V=p.x,K=p.y,C=p.z,F=a.x,u=a.y,c=a.z,f=-L.e;return!(V-F<f||f>F-P)&&(!(K-u<f||f>u-b)&&!(C-c<f||f>c-t))}intersectsSphere(a){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,a.centerWorld,a.radiusWorld)}intersectsMinMax(a,v){const p=this.minimumWorld,P=this.maximumWorld,b=p.x,L=p.y,t=p.z,V=P.x,K=P.y,C=P.z,F=a.x,u=a.y,c=a.z,f=v.x,H=v.y,A=v.z;return!(V<F||b>f)&&(!(K<u||L>H)&&!(C<c||t>A))}dispose(){var a,v;null===(a=this._drawWrapperFront)||void 0===a||a.dispose(),null===(v=this._drawWrapperBack)||void 0===v||v.dispose()}static Intersects(a,v){return a.intersectsMinMax(v.minimumWorld,v.maximumWorld)}static IntersectsSphere(a,v,p,P){const L=t._TmpVector3[0];b.s.ClampToRef(p,a,v,L);return b.s.DistanceSquared(p,L)<=P*P}static IsCompletelyInFrustum(a,v){for(let p=0;p<6;++p){const P=v[p];for(let v=0;v<8;++v)if(P.dotCoordinate(a[v])<0)return!1}return!0}static IsInFrustum(a,v){for(let p=0;p<6;++p){let P=!0;const b=v[p];for(let v=0;v<8;++v)if(b.dotCoordinate(a[v])>=0){P=!1;break}if(P)return!1}return!0}}t._TmpVector3=(0,P.d)(3,b.s.Zero)},11413:(a,v,p)=>{"use strict";p.d(v,{d:()=>u});var P=p(11254),b=p(11240),L=p(11421),t=p(11427);const V={min:0,max:0},K={min:0,max:0},C=(a,v,p)=>{const P=b.s.Dot(v.centerWorld,a),L=Math.abs(b.s.Dot(v.directions[0],a))*v.extendSize.x+Math.abs(b.s.Dot(v.directions[1],a))*v.extendSize.y+Math.abs(b.s.Dot(v.directions[2],a))*v.extendSize.z;p.min=P-L,p.max=P+L},F=(a,v,p)=>(C(a,v,V),C(a,p,K),!(V.min>K.max||K.min>V.max));class u{constructor(a,v,p){this._isLocked=!1,this.boundingBox=new L.b(a,v,p),this.boundingSphere=new t.b(a,v,p)}reConstruct(a,v,p){this.boundingBox.reConstruct(a,v,p),this.boundingSphere.reConstruct(a,v,p)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(a){this._isLocked=a}update(a){this._isLocked||(this.boundingBox._update(a),this.boundingSphere._update(a))}centerOn(a,v){const p=u._TmpVector3[0].p(a).Bi(v),P=u._TmpVector3[1].p(a).addInPlace(v);return this.boundingBox.reConstruct(p,P,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(p,P,this.boundingBox.getWorldMatrix()),this}encapsulate(a){const v=b.s.Minimize(this.minimum,a),p=b.s.Maximize(this.maximum,a);return this.reConstruct(v,p,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(a){const v=b.k.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(v);const p=b.k.fb[0];return b.s.TransformCoordinatesToRef(a.boundingBox.minimumWorld,v,p),this.encapsulate(p),b.s.TransformCoordinatesToRef(a.boundingBox.maximumWorld,v,p),this.encapsulate(p),this}scale(a){return this.boundingBox.scale(a),this.boundingSphere.scale(a),this}isInFrustum(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===v||3===v)&&this.boundingSphere.isCenterInFrustum(a))return!0;if(!this.boundingSphere.isInFrustum(a))return!1;return!(1!==v&&3!==v)||this.boundingBox.isInFrustum(a)}get diagonalLength(){const a=this.boundingBox;return a.maximumWorld.subtractToRef(a.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(a){return this.boundingBox.isCompletelyInFrustum(a)}_checkCollision(a){return a._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(a){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(a)&&!!this.boundingBox.intersectsPoint(a))}intersects(a,v){if(!t.b.Intersects(this.boundingSphere,a.boundingSphere))return!1;if(!L.b.Intersects(this.boundingBox,a.boundingBox))return!1;if(!v)return!0;const p=this.boundingBox,P=a.boundingBox;return!!F(p.directions[0],p,P)&&(!!F(p.directions[1],p,P)&&(!!F(p.directions[2],p,P)&&(!!F(P.directions[0],p,P)&&(!!F(P.directions[1],p,P)&&(!!F(P.directions[2],p,P)&&(!!F(b.s.Cross(p.directions[0],P.directions[0]),p,P)&&(!!F(b.s.Cross(p.directions[0],P.directions[1]),p,P)&&(!!F(b.s.Cross(p.directions[0],P.directions[2]),p,P)&&(!!F(b.s.Cross(p.directions[1],P.directions[0]),p,P)&&(!!F(b.s.Cross(p.directions[1],P.directions[1]),p,P)&&(!!F(b.s.Cross(p.directions[1],P.directions[2]),p,P)&&(!!F(b.s.Cross(p.directions[2],P.directions[0]),p,P)&&(!!F(b.s.Cross(p.directions[2],P.directions[1]),p,P)&&!!F(b.s.Cross(p.directions[2],P.directions[2]),p,P))))))))))))))}}u._TmpVector3=(0,P.d)(2,b.s.Zero)},11427:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(11254),b=p(11240);class L{constructor(a,v,p){this.center=b.s.Zero(),this.centerWorld=b.s.Zero(),this.minimum=b.s.Zero(),this.maximum=b.s.Zero(),this.reConstruct(a,v,p)}reConstruct(a,v,p){this.minimum.p(a),this.maximum.p(v);const P=b.s.Distance(a,v);v.addToRef(a,this.center).scaleInPlace(.5),this.radius=.5*P,this._update(p||b.e.IdentityReadOnly)}scale(a){const v=this.radius*a,p=L._TmpVector3,P=p[0].pe(v),b=this.center.subtractToRef(P,p[1]),t=this.center.addToRef(P,p[2]);return this.reConstruct(b,t,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){if(a.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{b.s.TransformCoordinatesToRef(this.center,a,this.centerWorld);const v=L._TmpVector3[0];b.s.TransformNormalFromFloatsToRef(1,1,1,a,v),this.radiusWorld=Math.max(Math.abs(v.x),Math.abs(v.y),Math.abs(v.z))*this.radius}}isInFrustum(a){const v=this.centerWorld,p=this.radiusWorld;for(let P=0;P<6;P++)if(a[P].dotCoordinate(v)<=-p)return!1;return!0}isCenterInFrustum(a){const v=this.centerWorld;for(let p=0;p<6;p++)if(a[p].dotCoordinate(v)<0)return!1;return!0}intersectsPoint(a){const v=b.s.DistanceSquared(this.centerWorld,a);return!(this.radiusWorld*this.radiusWorld<v)}static Intersects(a,v){const p=b.s.DistanceSquared(a.centerWorld,v.centerWorld),P=a.radiusWorld+v.radiusWorld;return!(P*P<p)}static CreateFromCenterAndRadius(a,v,p){this._TmpVector3[0].p(a),this._TmpVector3[1].qe(0,0,v),this._TmpVector3[2].p(a),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Bi(this._TmpVector3[1]);const P=new L(this._TmpVector3[0],this._TmpVector3[2]);return P._worldMatrix=p||b.e.Identity(),P}}L._TmpVector3=(0,P.d)(3,b.s.Zero)},11848:(a,v,p)=>{"use strict";p.d(v,{b:()=>f});var P=p(11229),b=p(11512),L=p(11245),t=p(11240),V=p(11254),K=p(11404),C=p(11304),F=p(10939),u=p(11352);const c={internalPickerForMesh:void 0};class f{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.e;this.origin=a,this.direction=v,this.length=p,this.epsilon=P}clone(){return new f(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const P=f._TmpVector3[0].qe(a.x-p,a.y-p,a.z-p),b=f._TmpVector3[1].qe(v.x+p,v.y+p,v.z+p);let L,t,V,K,C=0,F=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<P.x||this.origin.x>b.x)return!1}else if(L=1/this.direction.x,t=(P.x-this.origin.x)*L,V=(b.x-this.origin.x)*L,V===-1/0&&(V=1/0),t>V&&(K=t,t=V,V=K),C=Math.max(t,C),F=Math.min(V,F),C>F)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<P.y||this.origin.y>b.y)return!1}else if(L=1/this.direction.y,t=(P.y-this.origin.y)*L,V=(b.y-this.origin.y)*L,V===-1/0&&(V=1/0),t>V&&(K=t,t=V,V=K),C=Math.max(t,C),F=Math.min(V,F),C>F)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<P.z||this.origin.z>b.z)return!1}else if(L=1/this.direction.z,t=(P.z-this.origin.z)*L,V=(b.z-this.origin.z)*L,V===-1/0&&(V=1/0),t>V&&(K=t,t=V,V=K),C=Math.max(t,C),F=Math.min(V,F),C>F)return!1;return!0}intersectsBox(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(a.minimum,a.maximum,v)}intersectsSphere(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=a.center.x-this.origin.x,P=a.center.y-this.origin.y,b=a.center.z-this.origin.z,L=p*p+P*P+b*b,t=a.radius+v,V=t*t;if(L<=V)return!0;const K=p*this.direction.x+P*this.direction.y+b*this.direction.z;if(K<0)return!1;return L-K*K<=V}intersectsTriangle(a,v,p){const P=f._TmpVector3[0],b=f._TmpVector3[1],L=f._TmpVector3[2],V=f._TmpVector3[3],C=f._TmpVector3[4];v.subtractToRef(a,P),p.subtractToRef(a,b),t.s.CrossToRef(this.direction,b,L);const F=t.s.Dot(P,L);if(0===F)return null;const u=1/F;this.origin.subtractToRef(a,V);const c=t.s.Dot(V,L)*u;if(c<-this.epsilon||c>1+this.epsilon)return null;t.s.CrossToRef(V,P,C);const H=t.s.Dot(this.direction,C)*u;if(H<-this.epsilon||c+H>1+this.epsilon)return null;const A=t.s.Dot(b,C)*u;return A>this.length?null:new K.c(1-c-H,c,A)}intersectsPlane(a){let v;const p=t.s.Dot(a.k,this.direction);if(Math.abs(p)<9.99999997475243e-7)return null;{const P=t.s.Dot(a.k,this.origin);return v=(-a.d-P)/p,v<0?v<-9.99999997475243e-7?null:0:v}}intersectsAxis(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(a){case"y":{const a=(this.origin.y-v)/this.direction.y;return a>0?null:new t.s(this.origin.x+this.direction.x*-a,v,this.origin.z+this.direction.z*-a)}case"x":{const a=(this.origin.x-v)/this.direction.x;return a>0?null:new t.s(v,this.origin.y+this.direction.y*-a,this.origin.z+this.direction.z*-a)}case"z":{const a=(this.origin.z-v)/this.direction.z;return a>0?null:new t.s(this.origin.x+this.direction.x*-a,this.origin.y+this.direction.y*-a,v)}default:return null}}intersectsMesh(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=t.k.Matrix[0];return a.getWorldMatrix().invertToRef(V),this._tmpRay?f.TransformToRef(this,V,this._tmpRay):this._tmpRay=f.Transform(this,V),a.intersects(this._tmpRay,v,p,P,b,L)}intersectsMeshes(a,v,p){p?p.length=0:p=[];for(let P=0;P<a.length;P++){const b=this.intersectsMesh(a[P],v);b.hit&&p.push(b)}return p.sort(this._comparePickingInfo),p}_comparePickingInfo(a,v){return a.distance<v.distance?-1:a.distance>v.distance?1:0}intersectionSegment(a,v,p){const P=this.origin,b=t.k.fb[0],L=t.k.fb[1],V=t.k.fb[2],K=t.k.fb[3];v.subtractToRef(a,b),this.direction.scaleToRef(f._Rayl,V),P.addToRef(V,L),a.subtractToRef(P,K);const C=t.s.Dot(b,b),F=t.s.Dot(b,V),u=t.s.Dot(V,V),c=t.s.Dot(b,K),H=t.s.Dot(V,K),A=C*u-F*F;let h,R,X=A,Q=A;A<f._Smallnum?(h=0,X=1,R=H,Q=u):(h=F*H-u*c,R=C*H-F*c,h<0?(h=0,R=H,Q=u):h>X&&(h=X,R=H+F,Q=u)),R<0?(R=0,-c<0?h=0:-c>C?h=X:(h=-c,X=C)):R>Q&&(R=Q,-c+F<0?h=0:-c+F>C?h=X:(h=-c+F,X=C));const s=Math.abs(h)<f._Smallnum?0:h/X,D=Math.abs(R)<f._Smallnum?0:R/Q,y=t.k.fb[4];V.scaleToRef(D,y);const Z=t.k.fb[5];b.scaleToRef(s,Z),Z.addInPlace(K);const M=t.k.fb[6];Z.subtractToRef(y,M);return D>0&&D<=this.length&&M.lengthSquared()<p*p?Z.length():-1}update(a,v,p,P,b,L,V){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){f._RayDistant||(f._RayDistant=f.Zero()),f._RayDistant.unprojectRayToRef(a,v,p,P,t.e.IdentityReadOnly,L,V);const K=t.k.Matrix[0];b.invertToRef(K),f.TransformToRef(f._RayDistant,K,this)}else this.unprojectRayToRef(a,v,p,P,b,L,V);return this}static Zero(){return new f(t.s.Zero(),t.s.Zero())}static CreateNew(a,v,p,P,b,L,t){return f.Zero().update(a,v,p,P,b,L,t)}static CreateNewFromTo(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.e.IdentityReadOnly;const P=new f(new t.s(0,0,0),new t.s(0,0,0));return f.CreateFromToToRef(a,v,P,p)}static CreateFromToToRef(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.e.IdentityReadOnly;p.origin.p(a);const b=v.subtractToRef(a,p.direction),L=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);return p.length=L,p.direction.normalize(),f.TransformToRef(p,P,p)}static Transform(a,v){const p=new f(new t.s(0,0,0),new t.s(0,0,0));return f.TransformToRef(a,v,p),p}static TransformToRef(a,v,p){t.s.TransformCoordinatesToRef(a.origin,v,p.origin),t.s.TransformNormalToRef(a.direction,v,p.direction),p.length=a.length,p.epsilon=a.epsilon;const P=p.direction,b=P.length();if(0!==b&&1!==b){const a=1/b;P.x*=a,P.y*=a,P.z*=a,p.length*=b}return p}unprojectRayToRef(a,v,p,P,b,L,V){const K=t.k.Matrix[0];b.multiplyToRef(L,K),K.multiplyToRef(V,K),K.invert();const C=F.b.LastCreatedEngine,u=t.k.fb[0];u.x=a/p*2-1,u.y=-(v/P*2-1),u.z=null!==C&&void 0!==C&&C.useReverseDepthBuffer?1:null!==C&&void 0!==C&&C.isNDCHalfZRange?0:-1;const c=t.k.fb[1].qe(u.x,u.y,1-1e-8),f=t.k.fb[2],H=t.k.fb[3];t.s._UnprojectFromInvertedMatrixToRef(u,K,f),t.s._UnprojectFromInvertedMatrixToRef(c,K,H),this.origin.p(f),H.subtractToRef(f,this.direction),this.direction.normalize()}}function H(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=f.Zero();return A(a,v,p,P,t,b,L),t}function A(a,v,p,P,b,L){let V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const C=a.getEngine();if(!L&&!(L=a.activeCamera))return a;const F=L.viewport,u=C.getRenderHeight(),{x:c,y:f,width:H,height:A}=F.toGlobal(C.getRenderWidth(),u),h=1/C.getHardwareScalingLevel();return v=v*h-c,p=p*h-(u-f-A),b.update(v,p,H,A,P||t.e.IdentityReadOnly,V?t.e.IdentityReadOnly:L.getViewMatrix(),L.getProjectionMatrix(),K),a}function h(a,v,p,P,b){if(!C.b)return a;const L=a.getEngine();if(!b&&!(b=a.activeCamera))throw new Error("Active camera not set");const V=b.viewport,K=L.getRenderHeight(),{x:F,y:u,width:c,height:f}=V.toGlobal(L.getRenderWidth(),K),H=t.e.Identity(),A=1/L.getHardwareScalingLevel();return v=v*A-F,p=p*A-(K-u-f),P.update(v,p,c,f,H,H,b.getProjectionMatrix()),a}function R(a,v,p,P,b,L,t,V){const K=v(P,p.enableDistantPicking),C=p.intersects(K,b,t,L,P,V);return C&&C.hit?!b&&null!=a&&C.distance>=a.distance?null:C:null}function X(a,v,p,P,b,L){let V=null;const K=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),F=a.cameraToUseForPointers||a.activeCamera,u=c.internalPickerForMesh||R;for(let C=0;C<a.meshes.length;C++){const c=a.meshes[C];if(p){if(!p(c,-1))continue}else if(!c.isEnabled()||!c.isVisible||!c.Ib)continue;const f=K&&c.isWorldMatrixCameraDependent(),H=c.Zj(f,F);if(c.hasThinInstances&&c.thinInstanceEnablePicking){const a=u(V,v,c,H,!0,!0,L);if(a){if(b)return a;const K=t.k.Matrix[1],C=c.thinInstanceGetWorldMatrices();for(let a=0;a<C.length;a++){if(p&&!p(c,a))continue;C[a].multiplyToRef(H,K);const t=u(V,v,c,K,P,b,L,!0);if(t&&(V=t,V.thinInstanceIndex=a,P))return V}}}else{const a=u(V,v,c,H,P,b,L);if(a&&(V=a,P))return V}}return V||new C.b}function Q(a,v,p,P){if(!C.b)return null;const b=[],L=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),V=a.cameraToUseForPointers||a.activeCamera,K=c.internalPickerForMesh||R;for(let C=0;C<a.meshes.length;C++){const F=a.meshes[C];if(p){if(!p(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.Ib)continue;const u=L&&F.isWorldMatrixCameraDependent(),c=F.Zj(u,V);if(F.hasThinInstances&&F.thinInstanceEnablePicking){if(K(null,v,F,c,!0,!0,P)){const a=t.k.Matrix[1],L=F.thinInstanceGetWorldMatrices();for(let t=0;t<L.length;t++){if(p&&!p(F,t))continue;L[t].multiplyToRef(c,a);const V=K(null,v,F,a,!1,!1,P,!0);V&&(V.thinInstanceIndex=t,b.push(V))}}}else{const a=K(null,v,F,c,!1,!1,P);a&&b.push(a)}}return b}function s(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;P||(P=a.getWorldMatrix()),v.length=p,b?v.origin.p(b):v.origin.p(a.position);const L=t.k.fb[2];L.set(0,0,a._scene.useRightHandedSystem?-1:1);const V=t.k.fb[3];return t.s.TransformNormalToRef(L,P,V),t.s.NormalizeToRef(V,v.direction),v}var D,y;f._TmpVector3=(0,V.d)(6,t.s.Zero),f._RayDistant=f.Zero(),f._Smallnum=1e-8,f._Rayl=1e9,D=P.c,(y=b.e)&&(y.prototype.getForwardRay=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;return s(this,new f(t.s.Zero(),t.s.Zero(),a),a,v,p)},y.prototype.getForwardRayToRef=function(a){return s(this,a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),D&&(u.e._IsPickingAvailable=!0,D.prototype.createPickingRay=function(a,v,p,P){return H(this,a,v,p,P,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),P.c.prototype.createPickingRayToRef=function(a,v,p,P,b){return A(this,a,v,p,P,b,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},P.c.prototype.createPickingRayInCameraSpace=function(a,v,p){return function(a,v,p,P){const b=f.Zero();return h(a,v,p,b,P),b}(this,a,v,p)},P.c.prototype.createPickingRayInCameraSpaceToRef=function(a,v,p,P){return h(this,a,v,p,P)},P.c.prototype.pickWithBoundingInfo=function(a,v,p,P,b){return function(a,v,p,P,b,L){if(!C.b)return null;const V=X(a,(P=>(a._tempPickingRay||(a._tempPickingRay=f.Zero()),A(a,v,p,P,a._tempPickingRay,L||null),a._tempPickingRay)),P,b,!0);return V&&(V.ray=H(a,v,p,t.e.Identity(),L||null)),V}(this,a,v,p,P,b)},P.c.prototype.md=function(a,v,p,P,b,L){return function(a,v,p,P,b,L,V){const K=X(a,((P,b)=>(a._tempPickingRay||(a._tempPickingRay=f.Zero()),A(a,v,p,P,a._tempPickingRay,L||null,!1,b),a._tempPickingRay)),P,b,!1,V);return K&&(K.ray=H(a,v,p,t.e.Identity(),L||null)),K}(this,a,v,p,P,b,L)},P.c.prototype.pickWithRay=function(a,v,p,P){return function(a,v,p,P,b){const L=X(a,(p=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=t.e.Identity()),p.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=f.Zero()),f.TransformToRef(v,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),p,P,!1,b);return L&&(L.ray=v),L}(this,a,v,p,P)},P.c.prototype.multiPick=function(a,v,p,P,b){return function(a,v,p,P,b,L){return Q(a,(P=>H(a,v,p,P,b||null)),P,L)}(this,a,v,p,P,b)},P.c.prototype.multiPickWithRay=function(a,v,p){return function(a,v,p,P){return Q(a,(p=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=t.e.Identity()),p.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=f.Zero()),f.TransformToRef(v,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),p,P)}(this,a,v,p)}},11776:(a,v,p)=>{"use strict";var P=p(11005),b=p(10905),L=p(10947),t=p(11032),V=p(10974),K=p(11017);V.e.prototype._partialLoadFile=function(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(a,(a=>{p[v]=a,p._internalCount++,6===p._internalCount&&P(p)}),void 0,void 0,!0,((a,v)=>{b&&a&&b(a.status+" "+a.statusText,v)}))},V.e.prototype._cascadeLoadFiles=function(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=[];b._internalCount=0;for(let L=0;L<6;L++)this._partialLoadFile(p[L],L,b,v,P)},V.e.prototype._cascadeLoadImgs=function(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5?arguments[5]:void 0;const t=[];t._internalCount=0;for(let V=0;V<6;V++)this._partialLoadImg(P[V],V,t,a,v,p,b,L)},V.e.prototype._partialLoadImg=function(a,v,p,P,b,V){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0;const F=(0,t.b)();(0,L.q)(a,(a=>{p[v]=a,p._internalCount++,P&&P.removePendingData(F),6===p._internalCount&&V&&V(b,p)}),((a,v)=>{P&&P.removePendingData(F),K&&K(a,v)}),P?P.offlineProvider:null,C),P&&P.addPendingData(F)},V.e.prototype.createCubeTextureBase=function(a,v,p,L){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,R=arguments.length>14&&void 0!==arguments[14]&&arguments[14],X=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const Q=H||new P.d(this,7);Q.isCube=!0,Q.url=a,Q.generateMipMaps=!L,Q._lodGenerationScale=c,Q._lodGenerationOffset=f,Q._useSRGBBuffer=!!R&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!L),Q!==H&&(Q.label=a.substring(0,60)),this._doNotHandleContextLost||(Q._extension=F,Q._files=p,Q._buffer=X);const s=a;this._transformTextureUrl&&!H&&(a=this._transformTextureUrl(a));const D=a.split("?")[0],y=D.lastIndexOf("."),Z=F||(y>-1?D.substring(y).toLowerCase():""),M=(0,K.d)(Z),S=(P,K)=>{a===s?V&&P&&V(P.status+" "+P.statusText,K):(b.d.Warn(`Failed to load ${a}, falling back to the ${s}`),this.createCubeTextureBase(s,v,p,!!L,t,V,C,F,u,c,f,Q,A,h,R,X))};if(M)M.then((P=>{const L=a=>{A&&A(Q,a),P.loadCubeData(a,Q,u,t,V)};X?L(X):p&&6===p.length?P.supportCascades?this._cascadeLoadFiles(v,(a=>L(a.map((a=>new Uint8Array(a))))),p,V):V?V("Textures type does not support cascades."):b.d.Warn("Texture loader does not support cascades."):this._loadFile(a,(a=>L(new Uint8Array(a))),void 0,void 0,!0,S)}));else{if(!p||0===p.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(v,Q,((a,v)=>{h&&h(a,v)}),p,V)}return this._internalTexturesCache.push(Q),Q}},11712:(a,v,p)=>{"use strict";p(10974).e.prototype.createDepthStencilTexture=function(a,v,p){if(v.isCube){const p=a.width||a;return this._createDepthStencilCubeTexture(p,v)}return this._createDepthStencilTexture(a,v,p)}},11684:(a,v,p)=>{"use strict";p(11656).ThinEngine.prototype.setAlphaMode=function(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==a){switch(a){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}v||(this.depthCullingState.depthMask=0===a),this._alphaMode=a}else if(!v){const v=0===a;this.depthCullingState.depthMask!==v&&(this.depthCullingState.depthMask=v)}}},11654:(a,v,p)=>{"use strict";var P=p(11656);P.ThinEngine.prototype.updateDynamicIndexBuffer=function(a,v){let p;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(a),p=a.is32Bits?v instanceof Uint32Array?v:new Uint32Array(v):v instanceof Uint16Array?v:new Uint16Array(v),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,p,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},P.ThinEngine.prototype.updateDynamicVertexBuffer=function(a,v,p,P){this.bindArrayBuffer(a),void 0===p&&(p=0);const b=v.byteLength||v.length;void 0===P||P>=b&&0===p?v instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,p,new Float32Array(v)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,p,v):v instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(v).subarray(p,p+P)):(v=v instanceof ArrayBuffer?new Uint8Array(v,p,P):new Uint8Array(v.buffer,v.byteOffset+p,P),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v)),this._resetVertexBufferBinding()}},11701:(a,v,p)=>{"use strict";var P=p(11005),b=p(10905),L=p(11656),t=p(11703);class V extends t.e{constructor(a,v,p,P,b){super(a,v,p,P),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=b}_cloneRenderTargetWrapper(){let a=null;return this._colorTextureArray&&this._depthStencilTextureArray?(a=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),a.texture.isReady=!0):a=super._cloneRenderTargetWrapper(),a}_swapRenderTargetWrapper(a){super._swapRenderTargetWrapper(a),a._framebuffer=this._framebuffer,a._depthStencilBuffer=this._depthStencilBuffer,a._MSAAFramebuffer=this._MSAAFramebuffer,a._colorTextureArray=this._colorTextureArray,a._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,L=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const a=this._engine,v=a._currentFramebuffer,p=this._context;a._bindUnboundFramebuffer(this._framebuffer),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,null),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,null),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.STENCIL_ATTACHMENT,p.RENDERBUFFER,null),a._bindUnboundFramebuffer(v),p.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(a,v,p,P,b,L)}shareDepth(a){super.shareDepth(a);const v=this._context,p=this._depthStencilBuffer,P=a._MSAAFramebuffer||a._framebuffer,b=this._engine;a._depthStencilBuffer&&a._depthStencilBuffer!==p&&v.deleteRenderbuffer(a._depthStencilBuffer),a._depthStencilBuffer=p;const L=a._generateStencilBuffer?v.DEPTH_STENCIL_ATTACHMENT:v.DEPTH_ATTACHMENT;b._bindUnboundFramebuffer(P),v.framebufferRenderbuffer(v.FRAMEBUFFER,L,v.RENDERBUFFER,p),b._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!a._hardwareTexture)return;const b=this._framebuffer,L=this._engine,t=L._currentFramebuffer;if(L._bindUnboundFramebuffer(b),L.webGLVersion>1){const b=this._context,L=b["COLOR_ATTACHMENT"+v];var V;if(a.is2DArray||a.is3D)p=p??(null===(V=this.layerIndices)||void 0===V?void 0:V[v])??0,b.framebufferTextureLayer(b.FRAMEBUFFER,L,a._hardwareTexture.underlyingResource,P,p);else if(a.isCube){var K;p=p??(null===(K=this.faceIndices)||void 0===K?void 0:K[v])??0,b.framebufferTexture2D(b.FRAMEBUFFER,L,b.TEXTURE_CUBE_MAP_POSITIVE_X+p,a._hardwareTexture.underlyingResource,P)}else b.framebufferTexture2D(b.FRAMEBUFFER,L,b.TEXTURE_2D,a._hardwareTexture.underlyingResource,P)}else{const b=this._context,L=b["COLOR_ATTACHMENT"+v+"_WEBGL"],t=void 0!==p?b.TEXTURE_CUBE_MAP_POSITIVE_X+p:b.TEXTURE_2D;b.framebufferTexture2D(b.FRAMEBUFFER,L,t,a._hardwareTexture.underlyingResource,P)}L._bindUnboundFramebuffer(t)}setTexture(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(a,v,p),this._bindTextureRenderTarget(a,v)}setLayerAndFaceIndices(a,v){var p;if(super.setLayerAndFaceIndices(a,v),!this.textures||!this.layerIndices||!this.faceIndices)return;const P=(null===(p=this._attachments)||void 0===p?void 0:p.length)??this.textures.length;for(let b=0;b<P;b++){const a=this.textures[b];a&&(a.is2DArray||a.is3D?this._bindTextureRenderTarget(a,b,this.layerIndices[b]):a.isCube?this._bindTextureRenderTarget(a,b,this.faceIndices[b]):this._bindTextureRenderTarget(a,b))}}setLayerAndFaceIndex(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(a,v,p),!this.textures||!this.layerIndices||!this.faceIndices)return;const P=this.textures[a];P.is2DArray||P.is3D?this._bindTextureRenderTarget(this.textures[a],a,this.layerIndices[a]):P.isCube&&this._bindTextureRenderTarget(this.textures[a],a,this.faceIndices[a])}dispose(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const v=this._context;a||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(v.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(v.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(v.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(a)}}p(11712);L.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(a,v,p){const P=new V(a,v,p,this,this._gl);return this._renderTargetWrapperCache.push(P),P},L.ThinEngine.prototype.createRenderTargetTexture=function(a,v){const p=this._createHardwareRenderTargetWrapper(!1,!1,a);let P,b,L=!0,t=!1,V=!1,K=1;void 0!==v&&"object"===typeof v&&(L=v.generateDepthBuffer??!0,t=!!v.generateStencilBuffer,V=!!v.noColorAttachment,P=v.colorAttachment,K=v.samples??1,b=v.label);const C=P||(V?null:this._createInternalTexture(a,v,!0,5)),F=a.width||a,u=a.height||a,c=this._currentFramebuffer,f=this._gl,H=f.createFramebuffer();if(this._bindUnboundFramebuffer(H),p._depthStencilBuffer=this._setupFramebufferDepthAttachments(t,L,F,u),!C||C.is2DArray||C.is3D||f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,C._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(c),p.label=b??"RenderTargetWrapper",p._framebuffer=H,p._generateDepthBuffer=L,p._generateStencilBuffer=t,p.setTextures(C),P){if(p._samples=P.samples,P.samples>1){const a=P._hardwareTexture.getMSAARenderBuffer(0);p._MSAAFramebuffer=f.createFramebuffer(),this._bindUnboundFramebuffer(p._MSAAFramebuffer),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.RENDERBUFFER,a),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(p,K);return p},L.ThinEngine.prototype._createDepthStencilTexture=function(a,v,p){const L=this._gl,t=a.layers||0,V=a.depth||0;let K=L.TEXTURE_2D;0!==t?K=L.TEXTURE_2D_ARRAY:0!==V&&(K=L.TEXTURE_3D);const C=new P.d(this,12);if(C.label=v.label,!this._caps.depthTextureExtension)return b.d.Error("Depth texture is not supported by your browser or hardware."),C;const F={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...v};if(this._bindTextureDirectly(K,C,!0),this._setupDepthStencilTexture(C,a,0!==F.comparisonFunction&&F.bilinearFiltering,F.comparisonFunction,F.samples),void 0!==F.depthTextureFormat){if(15!==F.depthTextureFormat&&16!==F.depthTextureFormat&&17!==F.depthTextureFormat&&13!==F.depthTextureFormat&&14!==F.depthTextureFormat&&18!==F.depthTextureFormat)return b.d.Error(`Depth texture ${F.depthTextureFormat} format is not supported.`),C;C.format=F.depthTextureFormat}else C.format=F.generateStencil?13:16;const u=17===C.format||13===C.format||18===C.format;let c=L.UNSIGNED_INT;15===C.format?c=L.UNSIGNED_SHORT:17===C.format||13===C.format?c=L.UNSIGNED_INT_24_8:14===C.format?c=L.FLOAT:18===C.format&&(c=L.FLOAT_32_UNSIGNED_INT_24_8_REV);const f=u?L.DEPTH_STENCIL:L.DEPTH_COMPONENT,H=this._getInternalFormatFromDepthTextureFormat(C.format,!0,u);return C.is2DArray?L.texImage3D(K,0,H,C.width,C.height,t,0,f,c,null):C.is3D?L.texImage3D(K,0,H,C.width,C.height,V,0,f,c,null):L.texImage2D(K,0,H,C.width,C.height,0,f,c,null),this._bindTextureDirectly(K,null),this._internalTexturesCache.push(C),p._depthStencilBuffer&&(L.deleteRenderbuffer(p._depthStencilBuffer),p._depthStencilBuffer=null),this._bindUnboundFramebuffer(p._MSAAFramebuffer??p._framebuffer),p._generateStencilBuffer=u,p._depthStencilTextureWithStencil=u,p._depthStencilBuffer=this._setupFramebufferDepthAttachments(p._generateStencilBuffer,p._generateDepthBuffer,p.width,p.height,p.samples,C.format),this._bindUnboundFramebuffer(null),C},L.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(a,v){var p;if(this.webGLVersion<2||!a)return 1;if(a.samples===v)return v;const P=this._gl;v=Math.min(v,this.getCaps().maxMSAASamples),a._depthStencilBuffer&&(P.deleteRenderbuffer(a._depthStencilBuffer),a._depthStencilBuffer=null),a._MSAAFramebuffer&&(P.deleteFramebuffer(a._MSAAFramebuffer),a._MSAAFramebuffer=null);const b=null===(p=a.texture)||void 0===p?void 0:p._hardwareTexture;if(null===b||void 0===b||b.releaseMSAARenderBuffers(),a.texture&&v>1&&"function"===typeof P.renderbufferStorageMultisample){const p=P.createFramebuffer();if(!p)throw new Error("Unable to create multi sampled framebuffer");a._MSAAFramebuffer=p,this._bindUnboundFramebuffer(a._MSAAFramebuffer);const L=this._createRenderBuffer(a.texture.width,a.texture.height,v,-1,this._getRGBABufferInternalSizedFormat(a.texture.type,a.texture.format,a.texture._useSRGBBuffer),P.COLOR_ATTACHMENT0,!1);if(!L)throw new Error("Unable to create multi sampled framebuffer");null===b||void 0===b||b.addMSAARenderBuffer(L)}this._bindUnboundFramebuffer(a._MSAAFramebuffer??a._framebuffer),a.texture&&(a.texture.samples=v),a._samples=v;const L=a._depthStencilTexture?a._depthStencilTexture.format:void 0;return a._depthStencilBuffer=this._setupFramebufferDepthAttachments(a._generateStencilBuffer,a._generateDepthBuffer,a.width,a.height,v,L),this._bindUnboundFramebuffer(null),v},L.ThinEngine.prototype._setupDepthStencilTexture=function(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const L=v.width??v,t=v.height??v,V=v.layers||0,K=v.depth||0;a.baseWidth=L,a.baseHeight=t,a.width=L,a.height=t,a.is2DArray=V>0,a.depth=V||K,a.isReady=!0,a.samples=b,a.generateMipMaps=!1,a.samplingMode=p?2:1,a.type=0,a._comparisonFunction=P;const C=this._gl,F=this._getTextureTarget(a),u=this._getSamplingParameters(a.samplingMode,!1);C.texParameteri(F,C.TEXTURE_MAG_FILTER,u.mag),C.texParameteri(F,C.TEXTURE_MIN_FILTER,u.min),C.texParameteri(F,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(F,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===P?(C.texParameteri(F,C.TEXTURE_COMPARE_FUNC,515),C.texParameteri(F,C.TEXTURE_COMPARE_MODE,C.NONE)):(C.texParameteri(F,C.TEXTURE_COMPARE_FUNC,P),C.texParameteri(F,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE)))}},10961:(a,v,p)=>{"use strict";p.d(v,{b:()=>M,c:()=>y,d:()=>Z,h:()=>J,j:()=>B});class P{constructor(){this.children=[]}isValid(a){return!0}process(a,v){let p="";if(this.line){let C=this.line;const F=v.processor;if(F){var P,b,L,t,V,K;F.lineProcessor&&(C=F.lineProcessor(C,v.isFragment,v.processingContext));const p=(null===(P=v.processor)||void 0===P?void 0:P.attributeKeywordName)??"attribute",u=v.isFragment&&null!==(b=v.processor)&&void 0!==b&&b.varyingFragmentKeywordName?null===(L=v.processor)||void 0===L?void 0:L.varyingFragmentKeywordName:!v.isFragment&&null!==(t=v.processor)&&void 0!==t&&t.varyingVertexKeywordName?null===(V=v.processor)||void 0===V?void 0:V.varyingVertexKeywordName:"varying";if(!v.isFragment&&F.attributeProcessor&&this.line.startsWith(p))C=F.attributeProcessor(this.line,a,v.processingContext);else if(F.varyingProcessor&&(null!==(K=F.varyingCheck)&&void 0!==K&&K.call(F,this.line,v.isFragment)||!F.varyingCheck&&this.line.startsWith(u)))C=F.varyingProcessor(this.line,v.isFragment,a,v.processingContext);else if(F.uniformProcessor&&F.uniformRegexp&&F.uniformRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(C=F.uniformProcessor(this.line,v.isFragment,a,v.processingContext));else if(F.uniformBufferProcessor&&F.uniformBufferRegexp&&F.uniformBufferRegexp.test(this.line))v.lookForClosingBracketForUniformBuffer||(C=F.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0);else if(F.textureProcessor&&F.textureRegexp&&F.textureRegexp.test(this.line))C=F.textureProcessor(this.line,v.isFragment,a,v.processingContext);else if((F.uniformProcessor||F.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!v.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?F.uniformProcessor&&(C=F.uniformProcessor(this.line,v.isFragment,a,v.processingContext)):F.uniformBufferProcessor&&(C=F.uniformBufferProcessor(this.line,v.isFragment,v.processingContext),v.lookForClosingBracketForUniformBuffer=!0)}v.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(v.lookForClosingBracketForUniformBuffer=!1,F.endOfUniformBufferProcessor&&(C=F.endOfUniformBufferProcessor(this.line,v.isFragment,v.processingContext)))}p+=C+"\n"}return this.children.forEach((P=>{p+=P.process(a,v)})),this.additionalDefineKey&&(a[this.additionalDefineKey]=this.additionalDefineValue||"true"),p}}class b{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(a){this._lines.length=0;for(const v of a){if(!v||"\r"===v)continue;if("#"===v[0]){this._lines.push(v);continue}const a=v.trim();if(!a)continue;if(a.startsWith("//")){this._lines.push(v);continue}const p=a.indexOf(";");if(-1===p)this._lines.push(a);else if(p===a.length-1)a.length>1&&this._lines.push(a);else{const a=v.split(";");for(let v=0;v<a.length;v++){let p=a[v];p&&(p=p.trim(),p&&this._lines.push(p+(v!==a.length-1?";":"")))}}}}}class L extends P{process(a,v){for(let p=0;p<this.children.length;p++){const P=this.children[p];if(P.isValid(a))return P.process(a,v)}return""}}class t extends P{isValid(a){return this.testExpression.isTrue(a)}}class V{isTrue(a){return!0}static postfixToInfix(a){const v=[];for(const p of a)if(void 0===V._OperatorPriority[p])v.push(p);else{const a=v[v.length-1],P=v[v.length-2];v.length-=2,v.push(`(${P}${p}${a})`)}return v[v.length-1]}static infixToPostfix(a){const v=V._InfixToPostfixCache.get(a);if(v)return v.accessTime=Date.now(),v.result;if(!a.includes("&&")&&!a.includes("||")&&!a.includes(")")&&!a.includes("("))return[a];const p=[];let P=-1;const b=()=>{F=F.trim(),""!==F&&(p.push(F),F="")},L=a=>{P<V._Stack.length-1&&(V._Stack[++P]=a)},t=()=>V._Stack[P],K=()=>-1===P?"!!INVALID EXPRESSION!!":V._Stack[P--];let C=0,F="";for(;C<a.length;){const v=a.charAt(C),u=C<a.length-1?a.substring(C,2+C):"";if("("===v)F="",L(v);else if(")"===v){for(b();-1!==P&&"("!==t();)p.push(K());K()}else if(V._OperatorPriority[u]>1){for(b();-1!==P&&V._OperatorPriority[t()]>=V._OperatorPriority[u];)p.push(K());L(u),C++}else F+=v;C++}for(b();-1!==P;)"("===t()?K():p.push(K());return V._InfixToPostfixCache.size>=V.InfixToPostfixCacheLimitSize&&V.ClearCache(),V._InfixToPostfixCache.set(a,{result:p,accessTime:Date.now()}),p}static ClearCache(){const a=Array.from(V._InfixToPostfixCache.entries()).sort(((a,v)=>a[1].accessTime-v[1].accessTime));for(let v=0;v<V.InfixToPostfixCacheCleanupSize;v++)V._InfixToPostfixCache.delete(a[v][0])}}V.InfixToPostfixCacheLimitSize=5e4,V.InfixToPostfixCacheCleanupSize=25e3,V._InfixToPostfixCache=new Map,V._OperatorPriority={")":0,"(":1,"||":2,"&&":3},V._Stack=["","","","","","","","","","","","","","","","","","","",""];class K extends V{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=a,this.not=v}isTrue(a){let v=void 0!==a[this.define];return this.not&&(v=!v),v}}class C extends V{isTrue(a){return this.leftOperand.isTrue(a)||this.rightOperand.isTrue(a)}}class F extends V{isTrue(a){return this.leftOperand.isTrue(a)&&this.rightOperand.isTrue(a)}}class u extends V{constructor(a,v,p){super(),this.define=a,this.operand=v,this.testValue=p}isTrue(a){let v=a[this.define];void 0===v&&(v=this.define);let p=!1;const P=parseInt(v),b=parseInt(this.testValue);switch(this.operand){case">":p=P>b;break;case"<":p=P<b;break;case"<=":p=P<=b;break;case">=":p=P>=b;break;case"==":p=P===b;break;case"!=":p=P!==b}return p}}var c=p(10926),f=p(10964);const H=/defined\s*?\((.+?)\)/g,A=/defined\s*?\[(.+?)\]/g,h=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,R=/__decl__/,X=/light\{X\}.(\w*)/g,Q=/\{X\}/g,s=[],D=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(a){a.processor&&a.processor.initializeShaders&&a.processor.initializeShaders(a.processingContext)}function Z(a,v,p,P){var b;null!==(b=v.processor)&&void 0!==b&&b.preProcessShaderCode&&(a=v.processor.preProcessShaderCode(a,v.isFragment)),J(a,v,(a=>{v.processCodeAfterIncludes&&(a=v.processCodeAfterIncludes(v.isFragment?"fragment":"vertex",a,v.defines));const b=function(a,v,p){let P=function(a,v){var p;if(null!==(p=v.processor)&&void 0!==p&&p.noPrecision)return a;const P=v.shouldUseHighPrecisionShader;-1===a.indexOf("precision highp float")?a=P?"precision highp float;\n"+a:"precision mediump float;\n"+a:P||(a=a.replace("precision highp float","precision mediump float"));return a}(a,v);if(!v.processor)return P;if(0===v.processor.shaderLanguage&&-1!==P.indexOf("#version 3")&&(P=P.replace("#version 300 es",""),!v.processor.parseGLES3))return P;const b=v.defines,L=w(v,p);v.processor.preProcessor&&(P=v.processor.preProcessor(P,b,L,v.isFragment,v.processingContext));P=j(P,L,v),v.processor.postProcessor&&(P=v.processor.postProcessor(P,b,v.isFragment,v.processingContext,p?{drawBuffersExtensionDisabled:!p.getCaps().drawBuffersExtension}:{}));null!==p&&void 0!==p&&p._features.needShaderCodeInlining&&(P=p.inlineShaderCode(P));return P}(a,v,P);p(b,a)}))}function M(a,v,p){return p.processor&&p.processor.finalizeShaders?p.processor.finalizeShaders(a,v,p.processingContext):{vertexCode:a,fragmentCode:v}}function S(a){const v=/defined\((.+)\)/.exec(a);if(v&&v.length)return new K(v[1].trim(),"!"===a[0]);const p=["==","!=",">=","<=","<",">"];let P="",b=0;for(P of p)if(b=a.indexOf(P),b>-1)break;if(-1===b)return new K(a);const L=a.substring(0,b).trim(),t=a.substring(b+P.length).trim();return new u(L,P,t)}function n(a,v){const p=new t,P=a.substring(0,v);let b=a.substring(v);return b=b.substring(0,(b.indexOf("//")+1||b.length+1)-1).trim(),p.testExpression="#ifdef"===P?new K(b):"#ifndef"===P?new K(b,!0):function(a){a=a.replace(H,"defined[$1]");const v=V.infixToPostfix(a),p=[];for(const b of v)if("||"!==b&&"&&"!==b)p.push(b);else if(p.length>=2){let a=p[p.length-1],v=p[p.length-2];p.length-=2;const P="&&"==b?new F:new C;"string"===typeof a&&(a=a.replace(A,"defined($1)")),"string"===typeof v&&(v=v.replace(A,"defined($1)")),P.leftOperand="string"===typeof v?S(v):v,P.rightOperand="string"===typeof a?S(a):a,p.push(P)}let P=p[p.length-1];return"string"===typeof P&&(P=P.replace(A,"defined($1)")),"string"===typeof P?S(P):P}(b),p}function q(a,v,p){let b=a.currentLine;for(;T(a,p);){b=a.currentLine;const L=b.substring(0,5).toLowerCase();if("#else"===L){const p=new P;return v.children.push(p),void T(a,p)}if("#elif"===L){const a=n(b,5);v.children.push(a),p=a}}}function T(a,v){for(;a.canRead;){a.lineIndex++;const p=a.currentLine;if(p.indexOf("#")>=0){const P=D.exec(p);if(P&&P.length){switch(P[0]){case"#ifdef":{const P=new L;v.children.push(P);const b=n(p,6);P.children.push(b),q(a,P,b);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const P=new L;v.children.push(P);const b=n(p,7);P.children.push(b),q(a,P,b);break}case"#if":{const P=new L,b=n(p,3);v.children.push(P),P.children.push(b),q(a,P,b);break}}continue}}const b=new P;if(b.line=p,v.children.push(b),"#"===p[0]&&"d"===p[1]){const a=p.replace(";","").split(" ");b.additionalDefineKey=a[1],3===a.length&&(b.additionalDefineValue=a[2])}}return!1}function j(a,v,p){const L=new P,t=new b;return t.lineIndex=-1,t.lines=a.split("\n"),T(t,L),L.process(v,p)}function w(a,v){var p;const P=a.defines,b={};for(const L of P){const a=L.replace("#define","").replace(";","").trim().split(" ");b[a[0]]=a.length>1?a[1]:""}return 0===(null===(p=a.processor)||void 0===p?void 0:p.shaderLanguage)&&(b.GL_ES="true"),b.__VERSION__=a.version,b[a.platformName]="true",(0,f.j)(b,null===v||void 0===v?void 0:v.isNDCHalfZRange,null===v||void 0===v?void 0:v.useReverseDepthBuffer,null===v||void 0===v?void 0:v.useExactSrgbConversions),b}function J(a,v,p){let P;for(s.length=0;null!==(P=h.exec(a));)s.push(P);let b=String(a),L=[a],t=!1;for(const V of s){let a=V[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(R,""),v.supportsUniformBuffers&&(a=a.replace("Vertex","Ubo").replace("Fragment","Ubo")),a+="Declaration"),!v.includesShadersStore[a]){const P=v.shadersRepository+"ShadersInclude/"+a+".fx";return void B.loadFile(P,(P=>{v.includesShadersStore[a]=P,J(L.join(""),v,p)}))}{let p=v.includesShadersStore[a];if(V[2]){const a=V[3].split(",");for(let v=0;v<a.length;v+=2){const P=new RegExp(a[v],"g"),b=a[v+1];p=p.replace(P,b)}}if(V[4]){const a=V[5];if(-1!==a.indexOf("..")){const P=a.split(".."),b=parseInt(P[0]);let L=parseInt(P[1]),t=p.slice(0);p="",isNaN(L)&&(L=v.indexParameters[P[1]]);for(let a=b;a<L;a++)v.supportsUniformBuffers||(t=t.replace(X,((a,v)=>v+"{X}"))),p+=t.replace(Q,a.toString())+"\n"}else v.supportsUniformBuffers||(p=p.replace(X,((a,v)=>v+"{X}"))),p=p.replace(Q,a)}const P=[];for(const a of L){const v=a.split(V[0]);for(let a=0;a<v.length-1;a++)P.push(v[a]),P.push(p);P.push(v[v.length-1])}L=P,t=t||p.indexOf("#include<")>=0||p.indexOf("#include <")>=0}}s.length=0,b=L.join(""),t?J(b.toString(),v,p):p(b)}const B={loadFile:(a,v,p,P,b,L)=>{throw(0,c.c)("FileTools")}}},11673:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{get underlyingResource(){return this._webGLTexture}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=v,!a&&(a=v.createTexture(),!a))throw new Error("Unable to create webGL texture");this.set(a)}setUsage(){}set(a){this._webGLTexture=a}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(a){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(a)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const a of this._MSAARenderBuffers)this._context.deleteRenderbuffer(a);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._MSAARenderBuffers)||void 0===a?void 0:a[v])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10964:(a,v,p)=>{"use strict";p.d(v,{c:()=>b,f:()=>L,j:()=>V,m:()=>t,o:()=>K});var P=p(10926);p(10896);const b={};function L(a,v){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(v?v+"\n":"")+a}function t(a,v,p,L,t,V,K){const C=K||b.loadFile;if(C){return C(a,v,p,L,t,V)}throw(0,P.c)("FileTools")}function V(a,v,p,P){if(a)return v?a.IS_NDC_HALF_ZRANGE="":delete a.IS_NDC_HALF_ZRANGE,p?a.USE_REVERSE_DEPTHBUFFER="":delete a.USE_REVERSE_DEPTHBUFFER,void(P?a.USE_EXACT_SRGB_CONVERSIONS="":delete a.USE_EXACT_SRGB_CONVERSIONS);{let a="";return v&&(a+="#define IS_NDC_HALF_ZRANGE"),p&&(a&&(a+="\n"),a+="#define USE_REVERSE_DEPTHBUFFER"),P&&(a&&(a+="\n"),a+="#define USE_EXACT_SRGB_CONVERSIONS"),a}}function K(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;switch(a){case 3:{const a=(ArrayBuffer,new Int8Array(v));return P&&a.set(new Int8Array(P)),a}case 0:{const a=(ArrayBuffer,new Uint8Array(v));return P&&a.set(new Uint8Array(P)),a}case 4:{const a=v instanceof ArrayBuffer?new Int16Array(v):new Int16Array(p?v/2:v);return P&&a.set(new Int16Array(P)),a}case 5:case 8:case 9:case 10:case 2:{const a=v instanceof ArrayBuffer?new Uint16Array(v):new Uint16Array(p?v/2:v);return P&&a.set(new Uint16Array(P)),a}case 6:{const a=v instanceof ArrayBuffer?new Int32Array(v):new Int32Array(p?v/4:v);return P&&a.set(new Int32Array(P)),a}case 7:case 11:case 12:case 13:case 14:case 15:{const a=v instanceof ArrayBuffer?new Uint32Array(v):new Uint32Array(p?v/4:v);return P&&a.set(new Uint32Array(P)),a}case 1:{const a=v instanceof ArrayBuffer?new Float32Array(v):new Float32Array(p?v/4:v);return P&&a.set(new Float32Array(P)),a}}const b=(ArrayBuffer,new Uint8Array(v));return P&&b.set(new Uint8Array(P)),b}},10974:(a,v,p)=>{"use strict";p.d(v,{e:()=>Q});var P=p(10939),b=p(10905),L=p(10980),t=p(11003),V=p(10920);class K{constructor(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,a&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(a){this._zOffset!==a&&(this._zOffset=a,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(a){this._zOffsetUnits!==a&&(this._zOffsetUnits=a,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(a){this._cullFace!==a&&(this._cullFace=a,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(a){this._cull!==a&&(this._cull=a,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(a){this._depthFunc!==a&&(this._depthFunc=a,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(a){this._depthMask!==a&&(this._depthMask=a,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(a){this._depthTest!==a&&(this._depthTest=a,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(a){this._frontFace!==a&&(this._frontFace=a,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(a){this.isDirty&&(this._isCullDirty&&(this.cull?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(a.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(a.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(a.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(this.zOffset,this.zOffsetUnits)):a.disable(a.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(a.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class C{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(a){this._func!==a&&(this._func=a,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(a){this._funcRef!==a&&(this._funcRef=a,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(a){this._funcMask!==a&&(this._funcMask=a,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(a){this._opStencilFail!==a&&(this._opStencilFail=a,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(a){this._opDepthFail!==a&&(this._opDepthFail=a,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(a){this._opStencilDepthPass!==a&&(this._opStencilDepthPass=a,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(a){this._mask!==a&&(this._mask=a,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(a){this._enabled!==a&&(this._enabled=a,this._isStencilTestDirty=!0)}constructor(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,a&&this.reset()}reset(){var a;this.stencilMaterial=void 0,null===(a=this.stencilGlobal)||void 0===a||a.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(a){var v;if(!a)return;const p=!this.useStencilGlobalOnly&&!(null===(v=this.stencilMaterial)||void 0===v||!v.enabled);this.enabled=p?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=p?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=p?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=p?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=p?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=p?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=p?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=p?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(a.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(a.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(a.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class F{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=F.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=F.KEEP,this.opDepthFail=F.KEEP,this.opStencilDepthPass=F.REPLACE}get stencilFunc(){return this.func}set stencilFunc(a){this.func=a}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(a){this.funcRef=a}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(a){this.funcMask=a}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(a){this.opStencilFail=a}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(a){this.opDepthFail=a}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(a){this.opStencilDepthPass=a}get stencilMask(){return this.mask}set stencilMask(a){this.mask=a}get stencilTest(){return this.enabled}set stencilTest(a){this.enabled=a}}F.ALWAYS=519,F.KEEP=7680,F.REPLACE=7681;class u{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(a){this._alphaBlend!==a&&(this._alphaBlend=a,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(a,v,p,P){this._blendConstants[0]===a&&this._blendConstants[1]===v&&this._blendConstants[2]===p&&this._blendConstants[3]===P||(this._blendConstants[0]=a,this._blendConstants[1]=v,this._blendConstants[2]=p,this._blendConstants[3]=P,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(a,v,p,P){this._blendFunctionParameters[0]===a&&this._blendFunctionParameters[1]===v&&this._blendFunctionParameters[2]===p&&this._blendFunctionParameters[3]===P||(this._blendFunctionParameters[0]=a,this._blendFunctionParameters[1]=v,this._blendFunctionParameters[2]=p,this._blendFunctionParameters[3]=P,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(a,v){this._blendEquationParameters[0]===a&&this._blendEquationParameters[1]===v||(this._blendEquationParameters[0]=a,this._blendEquationParameters[1]=v,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(a){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?a.enable(a.BLEND):a.disable(a.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(a.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(a.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(a.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var c=p(10926),f=p(11005),H=p(10896),A=p(10893),h=p(10964),R=p(11017);function X(a,v){if((0,H.n)()){const{requestAnimationFrame:p}=v||window;if("function"===typeof p)return p(a)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(a);return setTimeout(a,16)}class Q{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(a){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(a){a!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=a,this._depthCullingState.depthFunc=a?518:515)}setColorWrite(a){a!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=a)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(a){if(a)return this.isNDCHalfZRange?a.IS_NDC_HALF_ZRANGE="":delete a.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?a.USE_REVERSE_DEPTHBUFFER="":delete a.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?a.USE_EXACT_SRGB_CONVERSIONS="":delete a.USE_EXACT_SRGB_CONVERSIONS);{let a="";return this.isNDCHalfZRange&&(a+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(a&&(a+="\n"),a+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(a&&(a+="\n"),a+="#define USE_EXACT_SRGB_CONVERSIONS"),a}}_rebuildInternalTextures(){const a=this._internalTexturesCache.slice();for(const v of a)v._rebuild()}_rebuildRenderTargetWrappers(){const a=this._renderTargetWrapperCache.slice();for(const v of a)v._rebuild()}_rebuildEffects(){for(const a in this._compiledEffects){const v=this._compiledEffects[a];v._pipelineContext=null,v._prepareEffect()}L.c.ResetCache()}_rebuildGraphicsResources(){var a;this.wipeCaches(!0),this._rebuildEffects(),null===(a=this._rebuildComputeEffects)||void 0===a||a.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){b.d.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(a){setTimeout((async()=>{this._clearEmptyResources();const v=this._depthCullingState.depthTest,p=this._depthCullingState.depthFunc,P=this._depthCullingState.depthMask,b=this._stencilState.stencilTest;await a(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=v,this._depthCullingState.depthFunc=p,this._depthCullingState.depthMask=P,this._stencilState.stencilTest=b,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(a){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(a){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const a=new Uint8Array(4),v=[a,a,a,a,a,a];this._emptyCubeTexture=this.createRawCubeTexture(v,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(a){if(!a)return this._activeRenderLoops.length=0,void this._cancelFrame();const v=this._activeRenderLoops.indexOf(a);v>=0&&(this._activeRenderLoops.splice(v,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const a=this._frameHandler;if(this._frameHandler=0,(0,H.n)()){const{cancelAnimationFrame:v}=this.getHostWindow()||window;if("function"===typeof v)return v(a)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(a);return clearTimeout(a)}}pj(){this.onBeginFrameObservable.notifyObservers(this)}qj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let a=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(a=!1),a&&(this.pj(),this._renderViews()||this._renderFrame(),this.qj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let a=0;a<this._activeRenderLoops.length;a++){(0,this._activeRenderLoops[a])()}}_renderViews(){return!1}_queueNewFrame(a,v){return X(a,v)}runRenderLoop(a){-1===this._activeRenderLoops.indexOf(a)&&(this._activeRenderLoops.push(a),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(a){this._depthCullingState.depthTest=a}setZOffset(a){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-a:a}getZOffset(){const a=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-a:a}setZOffsetUnits(a){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-a:a}getZOffsetUnits(){const a=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-a:a}getHostWindow(){return(0,H.n)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(a){this._compatibilityMode=!0}_rebuildTextures(){for(const a of this.scenes)a._rebuildTextures();for(const a of this._virtualScenes)a._rebuildTextures()}_releaseRenderTargetWrapper(a){const v=this._renderTargetWrapperCache.indexOf(a);-1!==v&&this._renderTargetWrapperCache.splice(v,1)}get currentViewport(){return this._cachedViewport}setViewport(a,v,p){const P=v||this.getRenderWidth(),b=p||this.getRenderHeight(),L=a.x||0,t=a.y||0;this._cachedViewport=a,this._viewport(L*P,t*b,P*a.width,b*a.height)}createCanvasImage(){return document.createElement("img")}get description(){let a=this.name+this.version;return this._caps.parallelShaderCompile&&(a+=" - Parallel shader compilation"),a}_createTextureBase(a,v,p,L){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0,s=arguments.length>15?arguments[15]:void 0;const D="data:"===(a=a||"").substr(0,5),y="blob:"===a.substr(0,5),Z=D&&-1!==a.indexOf(";base64,"),M=c||new f.d(this,1);M!==c&&(M.label=a.substring(0,60));const S=a;!this._transformTextureUrl||Z||c||u||(a=this._transformTextureUrl(a)),S!==a&&(M._originalUrl=S);const n=a.lastIndexOf(".");let q=A||(n>-1?a.substring(n).toLowerCase():"");q.indexOf("?")>-1&&(q=q.split("?")[0]);const T=(0,R.d)(q,h);L&&L.addPendingData(M),M.url=a,M.generateMipMaps=!v,M.samplingMode=t,M.invertY=p,M._useSRGBBuffer=this._getUseSRGBBuffer(!!s,v),this._doNotHandleContextLost||(M._buffer=u);let j=null;V&&!c&&(j=M.onLoadedObservable.add(V)),c||this._internalTexturesCache.push(M);const w=(p,c)=>{L&&L.removePendingData(M),a===S?(j&&M.onLoadedObservable.remove(j),P.b.UseFallbackTexture&&a!==P.b.FallbackTexture&&this._createTextureBase(P.b.FallbackTexture,v,M.invertY,L,t,null,K,C,F,u,M),p=(p||"Unknown error")+(P.b.UseFallbackTexture?" - Fallback texture was used":""),M.onErrorObservable.notifyObservers({message:p,exception:c}),K&&K(p,c)):(b.d.Warn(`Failed to load ${a}, falling back to ${S}`),this._createTextureBase(S,v,M.invertY,L,t,V,K,C,F,u,M,H,A,h,X,s))};if(T){const v=async a=>{(await T).loadData(a,M,((a,v,p,P,b,V)=>{V?w("TextureLoader failed to load data"):C(M,q,L,{width:a,height:v},M.invertY,!p,P,(()=>(b(),!1)),t)}),X)};u?u instanceof ArrayBuffer?v(new Uint8Array(u)):ArrayBuffer.isView(u)?v(u):K&&K("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(a,(a=>v(new Uint8Array(a))),void 0,L?L.offlineProvider:void 0,!0,((a,v)=>{w("Unable to load "+(a&&a.responseURL,v))}))}else{const p=a=>{y&&!this._doNotHandleContextLost&&(M._buffer=a),C(M,q,L,a,M.invertY,v,!1,F,t)};!D||Z?u&&("string"===typeof u.decoding||u.close)?p(u):Q._FileToolsLoadImage(a||"",p,w,L?L.offlineProvider:null,h,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?Q._FileToolsLoadImage(u,p,w,L?L.offlineProvider:null,h,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):u&&p(u)}return M}_rebuildBuffers(){for(const a of this._uniformBuffers)a._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,H.g)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const a in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,a)&&(this._boundTexturesCache[a]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(a){this._name=a}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(a){this._hardwareScalingLevel=a,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(a){this._doNotHandleContextLost=a}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(a,v,p){var b,L;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new K,this._stencilStateComposer=new C,this._stencilState=new F,this._alphaState=new u,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new A.c,this.onCanvasFocusObservable=new A.c,this.onNewSceneAddedObservable=new A.c,this.onResizeObservable=new A.c,this.onCanvasPointerOutObservable=new A.c,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new A.c,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new A.c,this.onAfterShaderCompilationObservable=new A.c,this.onBeginFrameObservable=new A.c,this.onEndFrameObservable=new A.c,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new A.c,this.onContextRestoredObservable=new A.c,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.uj=new A.c,P.b.Instances.push(this),this.startTime=V.b.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,t.c.SetMatrixPrecision(!!v.useHighPrecisionMatrix),(0,H.k)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=p??!1,v.antialias=a??v.antialias,v.deterministicLockstep=v.deterministicLockstep??!1,v.lockstepMaxSteps=v.lockstepMaxSteps??4,v.timeStep=v.timeStep??1/60,v.audioEngine=v.audioEngine??!0,v.stencil=v.stencil??!0,this._audioContext=(null===(b=v.audioEngineOptions)||void 0===b?void 0:b.audioContext)??null,this._audioDestination=(null===(L=v.audioEngineOptions)||void 0===L?void 0:L.audioDestination)??null,this.premultipliedAlpha=v.premultipliedAlpha??!0,this._doNotHandleContextLost=!!v.doNotHandleContextLost,this._isStencilEnable=!!v.stencil,this.useExactSrgbConversions=v.useExactSrgbConversions??!1;const c=(0,H.n)()&&window.devicePixelRatio||1,f=v.limitDeviceRatio||c;p=p||v.adaptToDeviceRatio||!1,this._hardwareScalingLevel=p?1/Math.min(f,c):1,this._lastDevicePixelRatio=c,this._creationOptions=v}resize(){let a,v,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const a=(0,H.n)()&&window.devicePixelRatio||1,v=this._lastDevicePixelRatio/a;this._lastDevicePixelRatio=a,this._hardwareScalingLevel*=v}if((0,H.n)()&&(0,H.g)())if(this._renderingCanvas){const p=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};a=this._renderingCanvas.clientWidth||p.width||this._renderingCanvas.width||100,v=this._renderingCanvas.clientHeight||p.height||this._renderingCanvas.height||100}else a=window.innerWidth,v=window.innerHeight;else a=this._renderingCanvas?this._renderingCanvas.width:100,v=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(a/this._hardwareScalingLevel,v/this._hardwareScalingLevel,p)}setSize(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(a|=0,v|=0,!p&&this._renderingCanvas.width===a&&this._renderingCanvas.height===v)return!1;if(this._renderingCanvas.width=a,this._renderingCanvas.height=v,this.scenes){for(let a=0;a<this.scenes.length;a++){const v=this.scenes[a];for(let a=0;a<v.cameras.length;a++){v.cameras[a]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(a,v,p,P,b,L,t,V,K,C,F){throw(0,c.c)("engine.rawTexture")}createRawCubeTexture(a,v,p,P,b,L,t,V){throw(0,c.c)("engine.rawTexture")}createRawTexture3D(a,v,p,P,b,L,t,V,K,C,F){throw(0,c.c)("engine.rawTexture")}createRawTexture2DArray(a,v,p,P,b,L,t,V,K,C,F){throw(0,c.c)("engine.rawTexture")}_sharedInit(a){this._renderingCanvas=a}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const a=navigator.userAgent;this.hostInformation.isMobile=-1!==a.indexOf("Mobile")||-1!==a.indexOf("Mac")&&(0,H.g)()&&"ontouchend"in document},this._checkForMobile(),(0,H.n)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(a){return document.createElement("video")}_reportDrawCall(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(a=this._drawCalls)||void 0===a||a.addCount(v,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(a,v){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(a,v){return createImageBitmap(a,v)}resizeImageBitmap(a,v,p){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(a){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(a,v){if("undefined"===typeof document)return new OffscreenCanvas(a,v);const p=document.createElement("canvas");return p.width=a,p.height=v,p}createCanvas(a,v){return Q._CreateCanvas(a,v)}static _FileToolsLoadImage(a,v,p,P,b,L){throw(0,c.c)("FileTools")}_loadFile(a,v,p,P,b,L){const t=(0,h.m)(a,v,p,P,b,L);return this._activeRequests.push(t),t.onCompleteObservable.add((()=>{const a=this._activeRequests.indexOf(t);-1!==a&&this._activeRequests.splice(a,1)})),t}static _FileToolsLoadFile(a,v,p,P,b,L){if(h.c.loadFile)return h.c.loadFile(a,v,p,P,b,L);throw(0,c.c)("FileTools")}dispose(){var a;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(a=this.releaseComputeEffects)||void 0===a||a.call(this),L.c.ResetCache();for(const p of this._activeRequests)p.abort();this._boundRenderFunction=null,this.uj.notifyObservers(this),this.uj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,H.n)()&&window.removeEventListener("resize",this._checkForMobile);const v=P.b.Instances.indexOf(this);v>=0&&P.b.Instances.splice(v,1),P.b.Instances.length||(P.b.OnEnginesDisposedObservable.notifyObservers(this),P.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(a){throw(0,c.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(a,v){for(let p=0;p<P.b.Instances.length;p++){const b=P.b.Instances[p];for(let p=0;p<b.scenes.length;p++)b.scenes[p].markAllMaterialsAsDirty(a,v)}}}Q._RenderPassIdCounter=0,Q._RescalePostProcessFactory=null,Q.CollisionsEpsilon=.001,Q.QueueNewFrame=X},11692:(a,v,p)=>{"use strict";p.d(v,{e:()=>M});var P=p(11005),b=p(10939),L=p(11656),t=p(10920);class V{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new K(a)}sampleFrame(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.b.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const v=a-this._lastFrameTimeMs;this._rollingFrameTime.add(v)}this._lastFrameTimeMs=a}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const a=this._rollingFrameTime.history(0);return 0===a?0:1e3/a}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class K{constructor(a){this._samples=new Array(a),this.reset()}add(a){let v;if(this.isSaturated()){const a=this._samples[this._pos];v=a-this.average,this.average-=v/(this._sampleCount-1),this._m2-=v*(a-this.average)}else this._sampleCount++;v=a-this.average,this.average+=v/this._sampleCount,this._m2+=v*(a-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=a,this._pos++,this._pos%=this._samples.length}history(a){if(a>=this._sampleCount||a>=this._samples.length)return 0;const v=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(v-a)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(a){const v=this._samples.length;return(a%v+v)%v}}var C=p(11665),F=p(10905),u=p(11673),c=(p(11684),p(11037));function f(a,v,p,P){let b,L=1;1===P?b=new Float32Array(v*p*4):2===P?(b=new Uint16Array(v*p*4),L=15360):b=7===P?new Uint32Array(v*p*4):new Uint8Array(v*p*4);for(let t=0;t<v;t++)for(let P=0;P<p;P++){const p=3*(P*v+t),V=4*(P*v+t);b[V+0]=a[p+0],b[V+1]=a[p+1],b[V+2]=a[p+2],b[V+3]=L}return b}function H(a){return function(v,p,b,L,t,V,K,C){let F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const c=a?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,f=a?10:11,H=new P.d(this,f);H.baseWidth=p,H.baseHeight=b,H.baseDepth=L,H.width=p,H.height=b,H.depth=L,H.format=t,H.type=u,H.generateMipMaps=V,H.samplingMode=C,a?H.is3D=!0:H.is2DArray=!0,this._doNotHandleContextLost||(H._bufferView=v),a?this.updateRawTexture3D(H,v,t,K,F,u):this.updateRawTexture2DArray(H,v,t,K,F,u),this._bindTextureDirectly(c,H,!0);const A=this._getSamplingParameters(C,V);return this._gl.texParameteri(c,this._gl.TEXTURE_MAG_FILTER,A.mag),this._gl.texParameteri(c,this._gl.TEXTURE_MIN_FILTER,A.min),V&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),this._internalTexturesCache.push(H),H}}function A(a){return function(v,p,P,b){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const V=a?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,K=this._getWebGLTextureType(t),C=this._getInternalFormat(P),F=this._getRGBABufferInternalSizedFormat(t,P);this._bindTextureDirectly(V,v,!0),this._unpackFlipY(void 0===b||!!b),this._doNotHandleContextLost||(v._bufferView=p,v.format=P,v.invertY=b,v._compression=L),v.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),L&&p?this._gl.compressedTexImage3D(V,0,this.getCaps().s3tc[L],v.width,v.height,v.depth,0,p):this._gl.texImage3D(V,0,F,v.width,v.height,v.depth,0,C,K,p),v.generateMipMaps&&this._gl.generateMipmap(V),this._bindTextureDirectly(V,null),v.isReady=!0}}L.ThinEngine.prototype.updateRawTexture=function(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!a)return;const V=this._getRGBABufferInternalSizedFormat(L,p,t),K=this._getInternalFormat(p),C=this._getWebGLTextureType(L);this._bindTextureDirectly(this._gl.TEXTURE_2D,a,!0),this._unpackFlipY(void 0===P||!!P),this._doNotHandleContextLost||(a._bufferView=v,a.format=p,a.type=L,a.invertY=P,a._compression=b),a.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),b&&v?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[b],a.width,a.height,0,v):this._gl.texImage2D(this._gl.TEXTURE_2D,0,V,a.width,a.height,0,K,C,v),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),a.isReady=!0},L.ThinEngine.prototype.createRawTexture=function(a,v,p,b,L,t,V){let K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const u=new P.d(this,3);u.baseWidth=v,u.baseHeight=p,u.width=v,u.height=p,u.format=b,u.generateMipMaps=L,u.samplingMode=V,u.invertY=t,u._compression=K,u.type=C,u._useSRGBBuffer=this._getUseSRGBBuffer(F,!L),this._doNotHandleContextLost||(u._bufferView=a),this.updateRawTexture(u,a,b,t,K,C,u._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);const c=this._getSamplingParameters(V,L);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),L&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},L.ThinEngine.prototype.createRawCubeTexture=function(a,v,p,b,L,t,V){let K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const C=this._gl,u=new P.d(this,8);u.isCube=!0,u.format=p,u.type=b,this._doNotHandleContextLost||(u._bufferViewArray=a);const f=this._getWebGLTextureType(b);let H=this._getInternalFormat(p);H===C.RGB&&(H=C.RGBA),f!==C.FLOAT||this._caps.textureFloatLinearFiltering?f!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?f!==C.FLOAT||this._caps.textureFloatRender?f!==C.HALF_FLOAT||this._caps.colorBufferFloat||(L=!1,F.d.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(L=!1,F.d.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(L=!1,V=1,F.d.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(L=!1,V=1,F.d.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const A=v,h=A;u.width=A,u.height=h,u.invertY=t,u._compression=K;if(!this.needPOTTextures||(0,c.l)(u.width)&&(0,c.l)(u.height)||(L=!1),a)this.updateRawCubeTexture(u,a,p,b,t,K);else{const a=this._getRGBABufferInternalSizedFormat(b),v=0;this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,u,!0);for(let p=0;p<6;p++)K?C.compressedTexImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+p,v,this.getCaps().s3tc[K],u.width,u.height,0,void 0):C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+p,v,a,u.width,u.height,0,H,f,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),a&&L&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const R=this._getSamplingParameters(V,L);return C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MAG_FILTER,R.mag),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_MIN_FILTER,R.min),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_CUBE_MAP,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,null),u.generateMipMaps=L,u.samplingMode=V,u.isReady=!0,u},L.ThinEngine.prototype.updateRawCubeTexture=function(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;a._bufferViewArray=v,a.format=p,a.type=P,a.invertY=b,a._compression=L;const V=this._gl,K=this._getWebGLTextureType(P);let C=this._getInternalFormat(p);const F=this._getRGBABufferInternalSizedFormat(P);let u=!1;C===V.RGB&&(C=V.RGBA,u=!0),this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,a,!0),this._unpackFlipY(void 0===b||!!b),a.width%4!==0&&V.pixelStorei(V.UNPACK_ALIGNMENT,1);for(let c=0;c<6;c++){let p=v[c];L?V.compressedTexImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+c,t,this.getCaps().s3tc[L],a.width,a.height,0,p):(u&&(p=f(p,a.width,a.height,P)),V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+c,t,F,a.width,a.height,0,C,K,p))}(!this.needPOTTextures||(0,c.l)(a.width)&&(0,c.l)(a.height))&&a.generateMipMaps&&0===t&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),a.isReady=!0},L.ThinEngine.prototype.createRawCubeTextureFromUrl=function(a,v,p,P,b,L,t,V){let K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,u=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const c=this._gl,H=this.createRawCubeTexture(null,p,P,b,!L,u,F,null);null===v||void 0===v||v.addPendingData(H),H.url=a,H.isReady=!1,this._internalTexturesCache.push(H);const A=a=>{const p=H.width,L=t(a);if(L){if(V){const a=this._getWebGLTextureType(b);let v=this._getInternalFormat(P);const t=this._getRGBABufferInternalSizedFormat(b);let K=!1;v===c.RGB&&(v=c.RGBA,K=!0),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,H,!0),this._unpackFlipY(!1);const C=V(L);for(let P=0;P<C.length;P++){const L=p>>P;for(let p=0;p<6;p++){let V=C[P][p];K&&(V=f(V,L,L,b)),c.texImage2D(p,P,t,L,L,0,v,a,V)}}this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(H,L,P,b,u);H.isReady=!0,null===v||void 0===v||v.removePendingData(H),H.onLoadedObservable.notifyObservers(H),H.onLoadedObservable.clear(),K&&K()}};return this._loadFile(a,(a=>{A(a)}),void 0,null===v||void 0===v?void 0:v.offlineProvider,!0,((a,p)=>{null===v||void 0===v||v.removePendingData(H),C&&a&&C(a.status+" "+a.statusText,p)})),H},L.ThinEngine.prototype.createRawTexture2DArray=H(!1),L.ThinEngine.prototype.createRawTexture3D=H(!0),L.ThinEngine.prototype.updateRawTexture2DArray=A(!1),L.ThinEngine.prototype.updateRawTexture3D=A(!0);var h=p(10964);L.ThinEngine.prototype._readTexturePixelsSync=function(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const F=this._gl;if(!F)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const a=F.createFramebuffer();if(!a)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=a}var u,c;(F.bindFramebuffer(F.FRAMEBUFFER,this._dummyFramebuffer),P>-1)?F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_CUBE_MAP_POSITIVE_X+P,null===(u=a._hardwareTexture)||void 0===u?void 0:u.underlyingResource,b):F.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,null===(c=a._hardwareTexture)||void 0===c?void 0:c.underlyingResource,b);let f=void 0!==a.type?this._getWebGLTextureType(a.type):F.UNSIGNED_BYTE;if(V)L||(L=(0,h.o)(a.type,4*v*p));else if(f===F.UNSIGNED_BYTE)L||(L=new Uint8Array(4*v*p)),f=F.UNSIGNED_BYTE;else L||(L=new Float32Array(4*v*p)),f=F.FLOAT;return t&&this.flushFramebuffer(),F.readPixels(K,C,v,p,F.RGBA,f,L),F.bindFramebuffer(F.FRAMEBUFFER,this._currentFramebuffer),L},L.ThinEngine.prototype._readTexturePixels=function(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(a,v,p,P,b,L,t,V,K,C))};p(11654);L.ThinEngine.prototype._createDepthStencilCubeTexture=function(a,v){const p=new P.d(this,12);if(p.isCube=!0,1===this.webGLVersion)return F.d.Error("Depth cube texture is not supported by WebGL 1."),p;const b={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...v},L=this._gl;this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,p,!0),this._setupDepthStencilTexture(p,a,b.bilinearFiltering,b.comparisonFunction);for(let P=0;P<6;P++)b.generateStencil?L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,L.DEPTH24_STENCIL8,a,a,0,L.DEPTH_STENCIL,L.UNSIGNED_INT_24_8,null):L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,L.DEPTH_COMPONENT24,a,a,0,L.DEPTH_COMPONENT,L.UNSIGNED_INT,null);return this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(p),p},L.ThinEngine.prototype._setCubeMapTextureParams=function(a,v,p){const P=this._gl;P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAG_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MIN_FILTER,v?P.LINEAR_MIPMAP_LINEAR:P.LINEAR),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),a.samplingMode=v?3:2,v&&this.getCaps().textureMaxLevel&&void 0!==p&&p>0&&(P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAX_LEVEL,p),a._maxLodLevel=p),this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null)},L.ThinEngine.prototype.createCubeTexture=function(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,H=arguments.length>13&&void 0!==arguments[13]&&arguments[13],A=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const h=this._gl;return this.createCubeTextureBase(a,v,p,!!P,b,L,t,V,K,C,u,f,(a=>this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,a,!0)),((a,v)=>{const p=this.needPOTTextures?(0,c.i)(v[0].width,this._caps.maxCubemapTextureSize):v[0].width,L=p,V=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,a,!0),this._unpackFlipY(!1);const K=t?this._getInternalFormat(t,a._useSRGBBuffer):a._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:h.RGBA;let C=t?this._getInternalFormat(t):h.RGBA;a._useSRGBBuffer&&1===this.webGLVersion&&(C=K);for(let P=0;P<V.length;P++)if(v[P].width!==p||v[P].height!==L){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void F.d.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=p,this._workingCanvas.height=L,this._workingContext.drawImage(v[P],0,0,v[P].width,v[P].height,0,0,p,L),h.texImage2D(V[P],0,K,C,h.UNSIGNED_BYTE,this._workingCanvas)}else h.texImage2D(V[P],0,K,C,h.UNSIGNED_BYTE,v[P]);P||h.generateMipmap(h.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(a,!P),a.width=p,a.height=L,a.isReady=!0,t&&(a.format=t),a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear(),b&&b()}),!!H,A)},L.ThinEngine.prototype.generateMipMapsForCubemap=function(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a.generateMipMaps){const p=this._gl;this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,a,!0),p.generateMipmap(p.TEXTURE_CUBE_MAP),v&&this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)}};p(11701);L.ThinEngine.prototype.setDepthStencilTexture=function(a,v,p,P){void 0!==a&&(v&&(this._boundUniforms[a]=v),p&&p.depthStencilTexture?this._setTexture(a,p,!1,!0,P):this._setTexture(a,null,void 0,void 0,P))},L.ThinEngine.prototype.createRenderTargetCubeTexture=function(a,v){const p=this._createHardwareRenderTargetWrapper(!1,!0,a),b={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...v};b.generateStencilBuffer=b.generateDepthBuffer&&b.generateStencilBuffer,(1!==b.type||this._caps.textureFloatLinearFiltering)&&(2!==b.type||this._caps.textureHalfFloatLinearFiltering)||(b.samplingMode=1);const L=this._gl,t=new P.d(this,5);this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,t,!0);const V=this._getSamplingParameters(b.samplingMode,b.generateMipMaps);1!==b.type||this._caps.textureFloat||(b.type=0,F.d.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MAG_FILTER,V.mag),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MIN_FILTER,V.min),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE);for(let P=0;P<6;P++)L.texImage2D(L.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,this._getRGBABufferInternalSizedFormat(b.type,b.format),a,a,0,this._getInternalFormat(b.format),this._getWebGLTextureType(b.type),null);const K=L.createFramebuffer();return this._bindUnboundFramebuffer(K),p._depthStencilBuffer=this._setupFramebufferDepthAttachments(b.generateStencilBuffer,b.generateDepthBuffer,a,a),b.generateMipMaps&&L.generateMipmap(L.TEXTURE_CUBE_MAP),this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),p._framebuffer=K,p._generateDepthBuffer=b.generateDepthBuffer,p._generateStencilBuffer=b.generateStencilBuffer,t.width=a,t.height=a,t.isReady=!0,t.isCube=!0,t.samples=1,t.generateMipMaps=b.generateMipMaps,t.samplingMode=b.samplingMode,t.type=b.type,t.format=b.format,this._internalTexturesCache.push(t),p.setTextures(t),p};var R=p(11714),X=p(11463),Q=p(11733);L.ThinEngine.prototype.createPrefilteredCubeTexture=function(a,v,p,b){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(a,v,null,!1,(a=>{if(!a)return void(L&&L(null));const t=a.texture;if(C?a.info.sphericalPolynomial&&(t._sphericalPolynomial=a.info.sphericalPolynomial):t._sphericalPolynomial=new R.f,t._source=9,this.getCaps().textureLOD)return void(L&&L(t));const V=this._gl,K=a.width;if(!K)return;const u=[];for(let L=0;L<3;L++){const C=1-L/2,c=b,f=Math.log2(K)*p+b,H=c+(f-c)*C,A=Math.round(Math.min(Math.max(H,0),f)),h=new P.d(this,2);if(h.type=t.type,h.format=t.format,h.width=Math.pow(2,Math.max(Math.log2(K)-A,0)),h.height=h.width,h.isCube=!0,h._cachedWrapU=0,h._cachedWrapV=0,this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,h,!0),h.samplingMode=2,V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),a.isDDS){const v=a.info,p=a.data;this._unpackFlipY(v.isCompressed),Q.d.UploadDDSLevels(this,h,p,v,!0,6,A)}else F.d.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,null);const R=new X.b(v);R._isCube=!0,R._texture=h,h.isReady=!0,u.push(R)}t._lodTextureHigh=u[2],t._lodTextureMid=u[1],t._lodTextureLow=u[0],L&&L(t)}),t,V,K,C,p,b)},L.ThinEngine.prototype.createUniformBuffer=function(a,v){const p=this._gl.createBuffer();if(!p)throw new Error("Unable to create uniform buffer");const P=new C.e(p);return this.bindUniformBuffer(P),a instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,a,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(a),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),P.references=1,P},L.ThinEngine.prototype.createDynamicUniformBuffer=function(a,v){const p=this._gl.createBuffer();if(!p)throw new Error("Unable to create dynamic uniform buffer");const P=new C.e(p);return this.bindUniformBuffer(P),a instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,a,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(a),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),P.references=1,P},L.ThinEngine.prototype.updateUniformBuffer=function(a,v,p,P){this.bindUniformBuffer(a),void 0===p&&(p=0),void 0===P?v instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,p,v):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,p,new Float32Array(v)):v instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,v.subarray(p,p+P)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(v).subarray(p,p+P)),this.bindUniformBuffer(null)},L.ThinEngine.prototype.bindUniformBuffer=function(a){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,a?a.underlyingResource:null)},L.ThinEngine.prototype.bindUniformBufferBase=function(a,v,p){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,v,a?a.underlyingResource:null)},L.ThinEngine.prototype.bindUniformBlock=function(a,v,p){const P=a.program,b=this._gl.getUniformBlockIndex(P,v);4294967295!==b&&this._gl.uniformBlockBinding(P,b,p)};var s=p(10896),D=p(10974);D.e.prototype.displayLoadingUI=function(){if(!(0,s.n)())return;const a=this.loadingScreen;a&&a.displayLoadingUI()},D.e.prototype.hideLoadingUI=function(){if(!(0,s.n)())return;const a=this._loadingScreen;a&&a.hideLoadingUI()},Object.defineProperty(D.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=D.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(a){this._loadingScreen=a},enumerable:!0,configurable:!0}),Object.defineProperty(D.e.prototype,"loadingUIText",{set:function(a){this.loadingScreen.loadingUIText=a},enumerable:!0,configurable:!0}),Object.defineProperty(D.e.prototype,"loadingUIBackgroundColor",{set:function(a){this.loadingScreen.loadingUIBackgroundColor=a},enumerable:!0,configurable:!0}),D.e.prototype.getInputElement=function(){return this._renderingCanvas},D.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},D.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},D.e.prototype.getAspectRatio=function(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const p=a.viewport;return this.getRenderWidth(v)*p.width/(this.getRenderHeight(v)*p.height)},D.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},D.e.prototype._verifyPointerLock=function(){var a;null===(a=this._onPointerLockChange)||void 0===a||a.call(this)},D.e.prototype.setAlphaEquation=function(a){if(this._alphaEquation!==a){switch(a){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=a}},D.e.prototype.getInputElement=function(){return this._renderingCanvas},D.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},D.e.prototype.setDepthFunction=function(a){this._depthCullingState.depthFunc=a},D.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},D.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},D.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},D.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},D.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},D.e.prototype.setDepthWrite=function(a){this._depthCullingState.depthMask=a},D.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},D.e.prototype.setStencilBuffer=function(a){this._stencilState.stencilTest=a},D.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},D.e.prototype.setStencilMask=function(a){this._stencilState.stencilMask=a},D.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},D.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},D.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},D.e.prototype.setStencilFunction=function(a){this._stencilState.stencilFunc=a},D.e.prototype.setStencilFunctionReference=function(a){this._stencilState.stencilFuncRef=a},D.e.prototype.setStencilFunctionMask=function(a){this._stencilState.stencilFuncMask=a},D.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},D.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},D.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},D.e.prototype.setStencilOperationFail=function(a){this._stencilState.stencilOpStencilFail=a},D.e.prototype.setStencilOperationDepthFail=function(a){this._stencilState.stencilOpDepthFail=a},D.e.prototype.setStencilOperationPass=function(a){this._stencilState.stencilOpStencilDepthPass=a},D.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},D.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},D.e.prototype.setAlphaConstants=function(a,v,p,P){this._alphaState.setAlphaBlendConstants(a,v,p,P)},D.e.prototype.getAlphaMode=function(){return this._alphaMode},D.e.prototype.getAlphaEquation=function(){return this._alphaEquation},D.e.prototype.getRenderPassNames=function(){return this._renderPassNames},D.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},D.e.prototype.createRenderPassId=function(a){const v=++D.e._RenderPassIdCounter;return this._renderPassNames[v]=a??"NONAME",v},D.e.prototype.releaseRenderPassId=function(a){this._renderPassNames[a]=void 0;for(let v=0;v<this.scenes.length;++v){const p=this.scenes[v];for(let v=0;v<p.meshes.length;++v){const P=p.meshes[v];if(P.rg)for(let v=0;v<P.rg.length;++v){P.rg[v]._removeDrawWrapper(a)}}}};p(11712);function y(a){if(a.requestPointerLock){const v=a.requestPointerLock();v instanceof Promise?v.then((()=>{a.focus()})).catch((()=>{})):a.focus()}}var Z=p(11042);p(11778);class M extends L.ThinEngine{static get NpmPackage(){return D.e.NpmPackage}static get Version(){return D.e.Version}static get Instances(){return b.b.Instances}static get LastCreatedEngine(){return b.b.LastCreatedEngine}static get LastCreatedScene(){return b.b.LastCreatedScene}static DefaultLoadingScreenFactory(a){return D.e.DefaultLoadingScreenFactory(a)}get _supportsHardwareTextureRescaling(){return!!M._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(a,v,p){if(super(a,v,p,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new V,this._drawCalls=new Z.c,a&&(this._features.supportRenderPasses=!0,p=this._creationOptions,a.getContext)){const v=a;this._sharedInit(v)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(a){super._sharedInit(a),function(a,v,p){a._onCanvasFocus=()=>{a.onCanvasFocusObservable.notifyObservers(a)},a._onCanvasBlur=()=>{a.onCanvasBlurObservable.notifyObservers(a)},a._onCanvasContextMenu=v=>{a.disableContextMenu&&v.preventDefault()},v.addEventListener("focus",a._onCanvasFocus),v.addEventListener("blur",a._onCanvasBlur),v.addEventListener("contextmenu",a._onCanvasContextMenu),a._onBlur=()=>{a.disablePerformanceMonitorInBackground&&a.performanceMonitor.disable(),a._windowIsBackground=!0},a._onFocus=()=>{a.disablePerformanceMonitorInBackground&&a.performanceMonitor.enable(),a._windowIsBackground=!1},a._onCanvasPointerOut=p=>{document.elementFromPoint(p.clientX,p.clientY)!==v&&a.onCanvasPointerOutObservable.notifyObservers(p)};const P=a.getHostWindow();P&&"function"===typeof P.addEventListener&&(P.addEventListener("blur",a._onBlur),P.addEventListener("focus",a._onFocus)),v.addEventListener("pointerout",a._onCanvasPointerOut),p.doNotHandleTouchAction||function(a){a&&a.setAttribute&&(a.setAttribute("touch-action","none"),a.style.touchAction="none",a.style.webkitTapHighlightColor="transparent")}(v),!D.e.audioEngine&&p.audioEngine&&D.e.AudioEngineFactory&&(D.e.audioEngine=D.e.AudioEngineFactory(a.getRenderingCanvas(),a.getAudioContext(),a.getAudioDestination())),(0,s.g)()&&(a._onFullscreenChange=()=>{a.isFullscreen=!!document.fullscreenElement,a.isFullscreen&&a._pointerLockRequested&&v&&y(v)},document.addEventListener("fullscreenchange",a._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",a._onFullscreenChange,!1),a._onPointerLockChange=()=>{a.isPointerLock=document.pointerLockElement===v},document.addEventListener("pointerlockchange",a._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",a._onPointerLockChange,!1)),a.enableOfflineSupport=void 0!==D.e.OfflineProviderFactory,a._deterministicLockstep=!!p.deterministicLockstep,a._lockstepMaxSteps=p.lockstepMaxSteps||0,a._timeStep=p.timeStep||1/60}(this,a,this._creationOptions)}resizeImageBitmap(a,v,p){return function(a,v,p,P){const b=a.createCanvas(p,P).getContext("2d");if(!b)throw new Error("Unable to get 2d context for resizeImageBitmap");return b.drawImage(v,0,0),b.getImageData(0,0,p,P).data}(this,a,v,p)}_createImageBitmapFromSource(a,v){return function(a,v,p){return new Promise(((P,b)=>{const L=new Image;L.onload=()=>{L.decode().then((()=>{a.createImageBitmap(L,p).then((a=>{P(a)}))}))},L.onerror=()=>{b(`Error loading image ${L.src}`)},L.src=v}))}(this,a,v)}switchFullscreen(a){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(a)}enterFullscreen(a){this.isFullscreen||(this._pointerLockRequested=a,this._renderingCanvas&&function(a){const v=a.requestFullscreen||a.webkitRequestFullscreen;v&&v.call(a)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const a=document;document.exitFullscreen?document.exitFullscreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen()}()}setDitheringState(a){a?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(a){a?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(a,v,p,P){const b=this._cachedViewport;return this._cachedViewport=null,this._viewport(a,v,p,P),b}scissorClear(a,v,p,P,b){this.enableScissor(a,v,p,P),this.clear(b,!0,!0,!0),this.disableScissor()}enableScissor(a,v,p,P){const b=this._gl;b.enable(b.SCISSOR_TEST),b.scissor(a,v,p,P)}disableScissor(){const a=this._gl;a.disable(a.SCISSOR_TEST)}_loadFileAsync(a,v,p){return new Promise(((P,b)=>{this._loadFile(a,(a=>{P(a)}),void 0,v,p,((a,v)=>{b(v)}))}))}getVertexShaderSource(a){const v=this._gl.getAttachedShaders(a);return v?this._gl.getShaderSource(v[0]):null}getFragmentShaderSource(a){const v=this._gl.getAttachedShaders(a);return v?this._gl.getShaderSource(v[1]):null}set framebufferDimensionsObject(a){this._framebufferDimensionsObject=a,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const a of this.scenes)a.resetCachedMaterial(),a._rebuildGeometries();for(const a of this._virtualScenes)a.resetCachedMaterial(),a._rebuildGeometries();super._rebuildBuffers()}getFontOffset(a){return function(a){const v=document.createElement("span");v.textContent="Hg",v.style.font=a;const p=document.createElement("div");p.style.display="inline-block",p.style.width="1px",p.style.height="0px",p.style.verticalAlign="bottom";const P=document.createElement("div");P.style.whiteSpace="nowrap",P.appendChild(v),P.appendChild(p),document.body.appendChild(P);let b=0,L=0;try{L=p.getBoundingClientRect().top-v.getBoundingClientRect().top,p.style.verticalAlign="baseline",b=p.getBoundingClientRect().top-v.getBoundingClientRect().top}finally{document.body.removeChild(P)}return{ascent:b,height:L,descent:L-b}}(a)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:a}=this.customAnimationFrameRequester;a&&a(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let a=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(a=!1),a&&(this.pj(),this._renderViews()||this._renderFrame(),this.qj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&y(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}pj(){this._measureFps(),super.pj()}_deletePipelineContext(a){const v=a;v&&v.program&&v.transformFeedback&&(this.deleteTransformFeedback(v.transformFeedback),v.transformFeedback=null),super._deletePipelineContext(a)}createShaderProgram(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;b=b||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const t=super.createShaderProgram(a,v,p,P,b,L);return this.onAfterShaderCompilationObservable.notifyObservers(this),t}_createShaderProgram(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const L=P.createProgram();if(a.program=L,!L)throw new Error("Unable to create program");if(P.attachShader(L,v),P.attachShader(L,p),this.webGLVersion>1&&b){const v=this.createTransformFeedback();this.bindTransformFeedback(v),this.setTranformFeedbackVaryings(L,b),a.transformFeedback=v}return P.linkProgram(L),this.webGLVersion>1&&b&&this.bindTransformFeedback(null),a.context=P,a.vertexShader=v,a.fragmentShader=p,a.isParallelCompiled||this._finalizePipelineContext(a),L}_releaseTexture(a){super._releaseTexture(a)}_releaseRenderTargetWrapper(a){super._releaseRenderTargetWrapper(a),this.scenes.forEach((v=>{v.postProcesses.forEach((v=>{v._outputTexture===a&&(v._outputTexture=null)})),v.cameras.forEach((v=>{v._postProcesses.forEach((v=>{v&&v._outputTexture===a&&(v._outputTexture=null)}))}))}))}_rescaleTexture(a,v,p,P,b){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const L=this.createRenderTargetTexture({width:v.width,height:v.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&M._RescalePostProcessFactory&&(this._rescalePostProcess=M._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const t=()=>{this._rescalePostProcess.onApply=function(v){v._bindTexture("textureSampler",a)};let t=p;t||(t=this.scenes[this.scenes.length-1]),t.postProcessManager.directRender([this._rescalePostProcess],L,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,v,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,P,0,0,v.width,v.height,0),this.unBindFramebuffer(L),L.dispose(),b&&b()},V=this._rescalePostProcess.getEffect();V?V.executeWhenCompiled(t):this._rescalePostProcess.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled(t)}))}}wrapWebGLTexture(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const t=new u.e(a,this._gl),V=new P.d(this,0,!0);return V._hardwareTexture=t,V.baseWidth=b,V.baseHeight=L,V.width=b,V.height=L,V.isReady=!0,V.useMipMaps=v,this.updateTextureSamplingMode(p,V),V}_uploadImageToTexture(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const b=this._gl,L=this._getWebGLTextureType(a.type),t=this._getInternalFormat(a.format),V=this._getRGBABufferInternalSizedFormat(a.type,t),K=a.isCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;this._bindTextureDirectly(K,a,!0),this._unpackFlipY(a.invertY);let C=b.TEXTURE_2D;a.isCube&&(C=b.TEXTURE_CUBE_MAP_POSITIVE_X+p),b.texImage2D(C,P,V,t,L,v),this._bindTextureDirectly(K,null,!0)}updateTextureComparisonFunction(a,v){if(1===this.webGLVersion)return void F.d.Error("WebGL 1 does not support texture comparison.");const p=this._gl;a.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,a,!0),0===v?(p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_COMPARE_FUNC,515),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_COMPARE_MODE,p.NONE)):(p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_COMPARE_FUNC,v),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,a,!0),0===v?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_FUNC,515),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.NONE)):(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_FUNC,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),a._comparisonFunction=v}createInstancesBuffer(a){const v=this._gl.createBuffer();if(!v)throw new Error("Unable to create instance buffer");const p=new C.e(v);return p.ub=a,this.bindArrayBuffer(p),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW),p.references=1,p}deleteInstancesBuffer(a){this._gl.deleteBuffer(a)}_clientWaitAsync(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const P=this._gl;return new Promise(((b,L)=>{const t=()=>{const V=P.clientWaitSync(a,v,0);V!=P.WAIT_FAILED?V!=P.TIMEOUT_EXPIRED?b():setTimeout(t,p):L()};t()}))}_readPixelsAsync(a,v,p,P,b,L,t){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const V=this._gl,K=V.createBuffer();V.bindBuffer(V.PIXEL_PACK_BUFFER,K),V.bufferData(V.PIXEL_PACK_BUFFER,t.byteLength,V.STREAM_READ),V.readPixels(a,v,p,P,b,L,0),V.bindBuffer(V.PIXEL_PACK_BUFFER,null);const C=V.fenceSync(V.SYNC_GPU_COMMANDS_COMPLETE,0);return C?(V.flush(),this._clientWaitAsync(C,0,10).then((()=>(V.deleteSync(C),V.bindBuffer(V.PIXEL_PACK_BUFFER,K),V.getBufferSubData(V.PIXEL_PACK_BUFFER,0,t),V.bindBuffer(V.PIXEL_PACK_BUFFER,null),V.deleteBuffer(K),t)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(a,v){1===b.b.Instances.length&&D.e.audioEngine&&(D.e.audioEngine.dispose(),D.e.audioEngine=null);const p=a.getHostWindow();p&&"function"===typeof p.removeEventListener&&(p.removeEventListener("blur",a._onBlur),p.removeEventListener("focus",a._onFocus)),v&&(v.removeEventListener("focus",a._onCanvasFocus),v.removeEventListener("blur",a._onCanvasBlur),v.removeEventListener("pointerout",a._onCanvasPointerOut),v.removeEventListener("contextmenu",a._onCanvasContextMenu)),(0,s.g)()&&(document.removeEventListener("fullscreenchange",a._onFullscreenChange),document.removeEventListener("mozfullscreenchange",a._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",a._onFullscreenChange),document.removeEventListener("msfullscreenchange",a._onFullscreenChange),document.removeEventListener("pointerlockchange",a._onPointerLockChange),document.removeEventListener("mspointerlockchange",a._onPointerLockChange),document.removeEventListener("mozpointerlockchange",a._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",a._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}M.ALPHA_DISABLE=0,M.ALPHA_ADD=1,M.ALPHA_COMBINE=2,M.ALPHA_SUBTRACT=3,M.ALPHA_MULTIPLY=4,M.ALPHA_MAXIMIZED=5,M.ALPHA_ONEONE=6,M.ALPHA_PREMULTIPLIED=7,M.ALPHA_PREMULTIPLIED_PORTERDUFF=8,M.ALPHA_INTERPOLATE=9,M.ALPHA_SCREENMODE=10,M.DELAYLOADSTATE_NONE=0,M.DELAYLOADSTATE_LOADED=1,M.DELAYLOADSTATE_LOADING=2,M.DELAYLOADSTATE_NOTLOADED=4,M.NEVER=512,M.ALWAYS=519,M.LESS=513,M.EQUAL=514,M.LEQUAL=515,M.GREATER=516,M.GEQUAL=518,M.NOTEQUAL=517,M.KEEP=7680,M.REPLACE=7681,M.INCR=7682,M.DECR=7683,M.INVERT=5386,M.INCR_WRAP=34055,M.DECR_WRAP=34056,M.TEXTURE_CLAMP_ADDRESSMODE=0,M.TEXTURE_WRAP_ADDRESSMODE=1,M.TEXTURE_MIRROR_ADDRESSMODE=2,M.TEXTUREFORMAT_ALPHA=0,M.TEXTUREFORMAT_LUMINANCE=1,M.TEXTUREFORMAT_LUMINANCE_ALPHA=2,M.TEXTUREFORMAT_RGB=4,M.TEXTUREFORMAT_RGBA=5,M.TEXTUREFORMAT_RED=6,M.TEXTUREFORMAT_R=6,M.TEXTUREFORMAT_RG=7,M.TEXTUREFORMAT_RED_INTEGER=8,M.TEXTUREFORMAT_R_INTEGER=8,M.TEXTUREFORMAT_RG_INTEGER=9,M.TEXTUREFORMAT_RGB_INTEGER=10,M.TEXTUREFORMAT_RGBA_INTEGER=11,M.TEXTURETYPE_UNSIGNED_BYTE=0,M.TEXTURETYPE_UNSIGNED_INT=0,M.TEXTURETYPE_FLOAT=1,M.TEXTURETYPE_HALF_FLOAT=2,M.TEXTURETYPE_BYTE=3,M.TEXTURETYPE_SHORT=4,M.TEXTURETYPE_UNSIGNED_SHORT=5,M.TEXTURETYPE_INT=6,M.TEXTURETYPE_UNSIGNED_INTEGER=7,M.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,M.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,M.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,M.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,M.TEXTURETYPE_UNSIGNED_INT_24_8=12,M.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,M.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,M.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,M.TEXTURE_NEAREST_SAMPLINGMODE=1,M.TEXTURE_BILINEAR_SAMPLINGMODE=2,M.TEXTURE_TRILINEAR_SAMPLINGMODE=3,M.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,M.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,M.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,M.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,M.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,M.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,M.TEXTURE_NEAREST_LINEAR=7,M.TEXTURE_NEAREST_NEAREST=1,M.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,M.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,M.TEXTURE_LINEAR_LINEAR=2,M.TEXTURE_LINEAR_NEAREST=12,M.TEXTURE_EXPLICIT_MODE=0,M.TEXTURE_SPHERICAL_MODE=1,M.TEXTURE_PLANAR_MODE=2,M.TEXTURE_CUBIC_MODE=3,M.TEXTURE_PROJECTION_MODE=4,M.TEXTURE_SKYBOX_MODE=5,M.TEXTURE_INVCUBIC_MODE=6,M.TEXTURE_EQUIRECTANGULAR_MODE=7,M.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,M.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,M.SCALEMODE_FLOOR=1,M.SCALEMODE_NEAREST=2,M.SCALEMODE_CEILING=3},10939:(a,v,p)=>{"use strict";p.d(v,{b:()=>b});var P=p(10893);class b{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}b.Instances=[],b.OnEnginesDisposedObservable=new P.c,b._LastCreatedScene=null,b.UseFallbackTexture=!0,b.FallbackTexture=""},12924:(a,v,p)=>{"use strict";p(10905);var P=p(11692);p(11005),p(11309),p(11003),p(11703),p(11662);P.e},11003:(a,v,p)=>{"use strict";p.d(v,{c:()=>P});class P{static SetMatrixPrecision(a){if(P.MatrixTrackPrecisionChange=!1,a&&!P.MatrixUse64Bits&&P.MatrixTrackedMatrices)for(let v=0;v<P.MatrixTrackedMatrices.length;++v){const a=P.MatrixTrackedMatrices[v],p=a.$j;a.$j=new Array(16);for(let v=0;v<16;++v)a.$j[v]=p[v]}P.MatrixUse64Bits=a,P.MatrixCurrentType=P.MatrixUse64Bits?Array:Float32Array,P.MatrixTrackedMatrices=null}}P.MatrixUse64Bits=!1,P.MatrixTrackPrecisionChange=!0,P.MatrixCurrentType=Float32Array,P.MatrixTrackedMatrices=[]},11703:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var a;return(null===(a=this._textures)||void 0===a?void 0:a[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(a){var v,p;if(!this._textures)return-1;const P=this._textures[a],b=(null===(v=this._layerIndices)||void 0===v?void 0:v[a])??0,L=(null===(p=this._faceIndices)||void 0===p?void 0:p[a])??0;return P.isCube?6*b+L:P.is3D?0:b}get samples(){return this._samples}setSamples(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===a&&!p)return a;const P=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,a,v):this._engine.updateRenderTargetTextureSampleCount(this,a);return this._samples=a,P}constructor(a,v,p,P,b){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=a,this._isCube=v,this._size=p,this._engine=P,this._depthStencilTexture=null,this.label=b}setTextures(a){Array.isArray(a)?this._textures=a:this._textures=a?[a]:null}setTexture(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[v]!==a&&(this._textures[v]&&p&&this._textures[v].dispose(),this._textures[v]=a)}setLayerAndFaceIndices(a,v){this._layerIndices=a,this._faceIndices=v}setLayerAndFaceIndex(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==v&&v>=0&&(this._layerIndices[a]=v),void 0!==p&&p>=0&&(this._faceIndices[a]=p)}createDepthStencilTexture(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,t=arguments.length>5?arguments[5]:void 0;return null===(a=this._depthStencilTexture)||void 0===a||a.dispose(),this._depthStencilTextureWithStencil=P,this._depthStencilTextureLabel=t,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:p,comparisonFunction:v,generateStencil:P,isCube:this._isCube,samples:b,depthTextureFormat:L,label:t},this),this._depthStencilTexture}_shareDepth(a){this.shareDepth(a)}shareDepth(a){this._depthStencilTexture&&(a._depthStencilTexture&&a._depthStencilTexture.dispose(),a._depthStencilTexture=this._depthStencilTexture,a._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(a){this.texture&&this.texture._swapAndDie(a),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let a=null;if(this._isMulti){const v=this.textures;if(v&&v.length>0){let p=!1,P=v.length,b=-1;const L=v[v.length-1]._source;14!==L&&12!==L||(p=!0,b=v[v.length-1].format,P--);const t=[],V=[],K=[],C=[],F=[],u=[],c=[],f={};for(let a=0;a<P;++a){const p=v[a];t.push(p.samplingMode),V.push(p.type),K.push(p.format);void 0!==f[p.uniqueId]?(C.push(-1),c.push(0)):(f[p.uniqueId]=a,p.is2DArray?(C.push(35866),c.push(p.depth)):p.isCube?(C.push(34067),c.push(0)):p.is3D?(C.push(32879),c.push(p.depth)):(C.push(3553),c.push(0))),this._faceIndices&&F.push(this._faceIndices[a]??0),this._layerIndices&&u.push(this._layerIndices[a]??0)}const H={samplingModes:t,generateMipMaps:v[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:p,depthTextureFormat:b,types:V,formats:K,textureCount:P,targetTypes:C,faceIndex:F,layerIndex:u,layerCounts:c,label:this.label},A={width:this.width,height:this.height,depth:this.depth};a=this._engine.createMultipleRenderTarget(A,H);for(let h=0;h<P;++h){if(-1!==C[h])continue;const p=f[v[h].uniqueId];a.setTexture(a.textures[p],h)}}}else{var v,p,P,b;const t={};if(t.generateDepthBuffer=this._generateDepthBuffer,t.generateMipMaps=(null===(v=this.texture)||void 0===v?void 0:v.generateMipMaps)??!1,t.generateStencilBuffer=this._generateStencilBuffer,t.samplingMode=null===(p=this.texture)||void 0===p?void 0:p.samplingMode,t.type=null===(P=this.texture)||void 0===P?void 0:P.type,t.format=null===(b=this.texture)||void 0===b?void 0:b.format,t.noColorAttachment=!this._textures,t.label=this.label,this.isCube)a=this._engine.createRenderTargetCubeTexture(this.width,t);else{var L;const v={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(L=this.texture)||void 0===L?void 0:L.depth:void 0};a=this._engine.createRenderTargetTexture(v,t)}a.texture&&(a.texture.isReady=!0)}return a}_swapRenderTargetWrapper(a){if(this._textures&&a._textures)for(let v=0;v<this._textures.length;++v)this._textures[v]._swapAndDie(a._textures[v],!1),a._textures[v].isReady=!0;this._depthStencilTexture&&a._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(a._depthStencilTexture),a._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const a=this._cloneRenderTargetWrapper();if(a){if(this._depthStencilTexture){const v=this._depthStencilTexture.samplingMode,p=this._depthStencilTexture.format,P=2===v||3===v||11===v;a.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,P,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,p,this._depthStencilTextureLabel)}this.samples>1&&a.setSamples(this.samples),a._swapRenderTargetWrapper(this),a.dispose()}}releaseTextures(){if(this._textures)for(let v=0;v<(null===(a=this._textures)||void 0===a?void 0:a.length);++v){var a;this._textures[v].dispose()}this._textures=null}dispose(){var a;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(a=this._depthStencilTexture)||void 0===a||a.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10982:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?P.ShadersRepository:P.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?P.ShadersStore:P.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?P.IncludesShadersStore:P.IncludesShadersStoreWGSL}}P.ShadersRepository="src/Shaders/",P.ShadersStore={},P.IncludesShadersStore={},P.ShadersRepositoryWGSL="src/ShadersWGSL/",P.ShadersStoreWGSL={},P.IncludesShadersStoreWGSL={}},10994:(a,v,p)=>{"use strict";p.d(v,{c:()=>c,d:()=>X,e:()=>f,f:()=>H,g:()=>R,i:()=>u,l:()=>C,m:()=>F,n:()=>K,p:()=>V});class P{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Id._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(a){a&&this.program&&a(this.program)}setEngine(a){this.Id=a}_fillEffectInformation(a,v,p,P,b,L,t,V){const K=this.Id;if(K.supportsUniformBuffers)for(const F in v)a.bindUniformBlock(F,v[F]);let C;for(this.Id.getUniforms(this,p).forEach(((a,v)=>{P[p[v]]=a})),this._uniforms=P,C=0;C<b.length;C++){null==a.getUniform(b[C])&&(b.splice(C,1),C--)}b.forEach(((a,v)=>{L[a]=v}));for(const F of K.getAttributes(this,t))V.push(F)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(a,v){const p=this._valueCache[a],P=v.updateFlag;return(void 0===p||p!==P)&&(this._valueCache[a]=P,!0)}_cacheFloat2(a,v,p){let P=this._valueCache[a];if(!P||2!==P.length)return P=[v,p],this._valueCache[a]=P,!0;let b=!1;return P[0]!==v&&(P[0]=v,b=!0),P[1]!==p&&(P[1]=p,b=!0),b}_cacheFloat3(a,v,p,P){let b=this._valueCache[a];if(!b||3!==b.length)return b=[v,p,P],this._valueCache[a]=b,!0;let L=!1;return b[0]!==v&&(b[0]=v,L=!0),b[1]!==p&&(b[1]=p,L=!0),b[2]!==P&&(b[2]=P,L=!0),L}_cacheFloat4(a,v,p,P,b){let L=this._valueCache[a];if(!L||4!==L.length)return L=[v,p,P,b],this._valueCache[a]=L,!0;let t=!1;return L[0]!==v&&(L[0]=v,t=!0),L[1]!==p&&(L[1]=p,t=!0),L[2]!==P&&(L[2]=P,t=!0),L[3]!==b&&(L[3]=b,t=!0),t}setInt(a,v){const p=this._valueCache[a];void 0!==p&&p===v||this.Id.setInt(this._uniforms[a],v)&&(this._valueCache[a]=v)}setInt2(a,v,p){this._cacheFloat2(a,v,p)&&(this.Id.setInt2(this._uniforms[a],v,p)||(this._valueCache[a]=null))}setInt3(a,v,p,P){this._cacheFloat3(a,v,p,P)&&(this.Id.setInt3(this._uniforms[a],v,p,P)||(this._valueCache[a]=null))}setInt4(a,v,p,P,b){this._cacheFloat4(a,v,p,P,b)&&(this.Id.setInt4(this._uniforms[a],v,p,P,b)||(this._valueCache[a]=null))}setIntArray(a,v){this._valueCache[a]=null,this.Id.setIntArray(this._uniforms[a],v)}setIntArray2(a,v){this._valueCache[a]=null,this.Id.setIntArray2(this._uniforms[a],v)}setIntArray3(a,v){this._valueCache[a]=null,this.Id.setIntArray3(this._uniforms[a],v)}setIntArray4(a,v){this._valueCache[a]=null,this.Id.setIntArray4(this._uniforms[a],v)}setUInt(a,v){const p=this._valueCache[a];void 0!==p&&p===v||this.Id.setUInt(this._uniforms[a],v)&&(this._valueCache[a]=v)}setUInt2(a,v,p){this._cacheFloat2(a,v,p)&&(this.Id.setUInt2(this._uniforms[a],v,p)||(this._valueCache[a]=null))}setUInt3(a,v,p,P){this._cacheFloat3(a,v,p,P)&&(this.Id.setUInt3(this._uniforms[a],v,p,P)||(this._valueCache[a]=null))}setUInt4(a,v,p,P,b){this._cacheFloat4(a,v,p,P,b)&&(this.Id.setUInt4(this._uniforms[a],v,p,P,b)||(this._valueCache[a]=null))}setUIntArray(a,v){this._valueCache[a]=null,this.Id.setUIntArray(this._uniforms[a],v)}setUIntArray2(a,v){this._valueCache[a]=null,this.Id.setUIntArray2(this._uniforms[a],v)}setUIntArray3(a,v){this._valueCache[a]=null,this.Id.setUIntArray3(this._uniforms[a],v)}setUIntArray4(a,v){this._valueCache[a]=null,this.Id.setUIntArray4(this._uniforms[a],v)}setArray(a,v){this._valueCache[a]=null,this.Id.setArray(this._uniforms[a],v)}setArray2(a,v){this._valueCache[a]=null,this.Id.setArray2(this._uniforms[a],v)}setArray3(a,v){this._valueCache[a]=null,this.Id.setArray3(this._uniforms[a],v)}setArray4(a,v){this._valueCache[a]=null,this.Id.setArray4(this._uniforms[a],v)}setMatrices(a,v){v&&(this._valueCache[a]=null,this.Id.setMatrices(this._uniforms[a],v))}setMatrix(a,v){this._cacheMatrix(a,v)&&(this.Id.setMatrices(this._uniforms[a],v.tj())||(this._valueCache[a]=null))}setMatrix3x3(a,v){this._valueCache[a]=null,this.Id.setMatrix3x3(this._uniforms[a],v)}setMatrix2x2(a,v){this._valueCache[a]=null,this.Id.setMatrix2x2(this._uniforms[a],v)}setFloat(a,v){const p=this._valueCache[a];void 0!==p&&p===v||this.Id.setFloat(this._uniforms[a],v)&&(this._valueCache[a]=v)}setVector2(a,v){this._cacheFloat2(a,v.x,v.y)&&(this.Id.setFloat2(this._uniforms[a],v.x,v.y)||(this._valueCache[a]=null))}setFloat2(a,v,p){this._cacheFloat2(a,v,p)&&(this.Id.setFloat2(this._uniforms[a],v,p)||(this._valueCache[a]=null))}setVector3(a,v){this._cacheFloat3(a,v.x,v.y,v.z)&&(this.Id.setFloat3(this._uniforms[a],v.x,v.y,v.z)||(this._valueCache[a]=null))}setFloat3(a,v,p,P){this._cacheFloat3(a,v,p,P)&&(this.Id.setFloat3(this._uniforms[a],v,p,P)||(this._valueCache[a]=null))}setVector4(a,v){this._cacheFloat4(a,v.x,v.y,v.z,v.w)&&(this.Id.setFloat4(this._uniforms[a],v.x,v.y,v.z,v.w)||(this._valueCache[a]=null))}setQuaternion(a,v){this._cacheFloat4(a,v.x,v.y,v.z,v.w)&&(this.Id.setFloat4(this._uniforms[a],v.x,v.y,v.z,v.w)||(this._valueCache[a]=null))}setFloat4(a,v,p,P,b){this._cacheFloat4(a,v,p,P,b)&&(this.Id.setFloat4(this._uniforms[a],v,p,P,b)||(this._valueCache[a]=null))}setColor3(a,v){this._cacheFloat3(a,v.r,v.g,v.b)&&(this.Id.setFloat3(this._uniforms[a],v.r,v.g,v.b)||(this._valueCache[a]=null))}setColor4(a,v,p){this._cacheFloat4(a,v.r,v.g,v.b,p)&&(this.Id.setFloat4(this._uniforms[a],v.r,v.g,v.b,p)||(this._valueCache[a]=null))}setDirectColor4(a,v){this._cacheFloat4(a,v.r,v.g,v.b,v.a)&&(this.Id.setFloat4(this._uniforms[a],v.r,v.g,v.b,v.a)||(this._valueCache[a]=null))}_getVertexShaderCode(){return this.vertexShader?this.Id._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Id._getShaderSource(this.fragmentShader):null}}var b=p(10964);const L=new WeakMap,t={_webGLVersion:2,cachedPipelines:{}};function V(a){let v=L.get(a);if(!v){if(!a)return t;v={_webGLVersion:a.TEXTURE_BINDING_3D?2:1,_context:a,cachedPipelines:{}},L.set(a,v)}return v}function K(a){L.delete(a)}function C(a,v,p,P,b,L){const t=V(P);L||(L=t._createShaderProgramInjection??c);return L(a,h(v,"vertex",P,t._contextWasLost),h(p,"fragment",P,t._contextWasLost),P,b,t.validateShaderPrograms)}function F(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0;const K=V(b);t||(t=K._createShaderProgramInjection??c);const C=K._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return t(a,A(v,"vertex",P,C,b,K._contextWasLost),A(p,"fragment",P,C,b,K._contextWasLost),b,L,K.validateShaderPrograms)}function u(a,v){const p=new P,b=V(a);return b.parallelShaderCompile&&(p.isParallelCompiled=!0),p.context=b._context,p}function c(a,v,p,P){let b=arguments.length>5?arguments[5]:void 0;const L=P.createProgram();if(a.program=L,!L)throw new Error("Unable to create program");return P.attachShader(L,v),P.attachShader(L,p),P.linkProgram(L),a.context=P,a.vertexShader=v,a.fragmentShader=p,a.isParallelCompiled||f(a,P,b),L}function f(a,v,p){const P=a.context,b=a.vertexShader,L=a.fragmentShader,t=a.program;if(!P.getProgramParameter(t,P.LINK_STATUS)){if(!v.getShaderParameter(b,v.COMPILE_STATUS)){const p=v.getShaderInfoLog(b);if(p)throw a.vertexCompilationError=p,new Error("VERTEX SHADER "+p)}if(!v.getShaderParameter(L,v.COMPILE_STATUS)){const p=v.getShaderInfoLog(L);if(p)throw a.fragmentCompilationError=p,new Error("FRAGMENT SHADER "+p)}const p=P.getProgramInfoLog(t);if(p)throw a.programLinkError=p,new Error(p)}if(p){P.validateProgram(t);if(!P.getProgramParameter(t,P.VALIDATE_STATUS)){const v=P.getProgramInfoLog(t);if(v)throw a.programValidationError=v,new Error(v)}}P.deleteShader(b),P.deleteShader(L),a.vertexShader=void 0,a.fragmentShader=void 0,a.onCompiled&&(a.onCompiled(),a.onCompiled=void 0)}function H(a,v,p,P,b,L,t,K,u){let c=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0,H=arguments.length>12?arguments[12]:void 0;const A=V(a.context);f||(f=A.createRawShaderProgramInjection??C),H||(H=A.createShaderProgramInjection??F);const h=a;h.program=P?f(h,v,p,h.context,u):H(h,v,p,K,h.context,u),h.program.__SPECTOR_rebuildProgram=t,c()}function A(a,v,p,P,L,t){return h((0,b.f)(a,p,P),v,L,t)}function h(a,v,p,P){const b=p.createShader("vertex"===v?p.VERTEX_SHADER:p.FRAGMENT_SHADER);if(!b){let a=p.NO_ERROR,b=p.NO_ERROR;for(;(b=p.getError())!==p.NO_ERROR;)a=b;throw new Error(`Something went wrong while creating a gl ${v} shader object. gl error=${a}, gl isContextLost=${p.isContextLost()}, _contextWasLost=${P}`)}return p.shaderSource(b,a),p.compileShader(b),b}function R(a,v){v.useProgram(a)}function X(a,v){const p=a;if(!p.isParallelCompiled)return void v(a);const P=p.onCompiled;p.onCompiled=()=>{null===P||void 0===P||P(),v(a)}}},11656:(a,v,p)=>{"use strict";p.r(v),p.d(v,{ThinEngine:()=>Q});var P=p(10994),b=p(11662),L=p(10905),t=p(10896);class V{constructor(){this.shaderLanguage=0}postProcessor(a,v,p,P,b){if(b.drawBuffersExtensionDisabled){const v=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;a=a.replace(v,"")}return a}}const K=/(flat\s)?\s*varying\s*.*/;class C{constructor(){this.shaderLanguage=0}attributeProcessor(a){return a.replace("attribute","in")}varyingCheck(a,v){return K.test(a)}varyingProcessor(a,v){return a.replace("varying",v?"in":"out")}postProcessor(a,v,p){const P=-1!==a.search(/#extension.+GL_EXT_draw_buffers.+require/);if(a=(a=a.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),p){const v=-1!==a.search(/layout *\(location *= *0\) *out/g);a=(a=(a=(a=(a=(a=(a=a.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(P||v?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==v.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+a}return a}}var F=p(11665),u=p(11037),c=p(10974),f=p(11673),H=p(11005),A=p(10980),h=p(10964),R=p(10991);class X{}class Q extends c.e{get name(){return this._name}set name(a){this._name=a}get version(){return this._webGLVersion}static get ShadersRepository(){return A.c.ShadersRepository}static set ShadersRepository(a){A.c.ShadersRepository=a}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(a){this._framebufferDimensionsObject=a}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(a,v,p,b){if(p=p||{},super(v??p.antialias,p,b),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!a)return;let t=null;if(a.getContext){if(t=a,this._renderingCanvas=t,void 0===p.Bh&&(p.Bh=!1),void 0===p.xrCompatible&&(p.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const a=navigator.userAgent;for(const v of Q.ExceptionList){const P=v.key,b=v.targets;if(new RegExp(P).test(a)){if(v.capture&&v.captureConstraint){const p=v.capture,P=v.captureConstraint,b=new RegExp(p).exec(a);if(b&&b.length>0){if(parseInt(b[b.length-1])>=P)continue}}for(const a of b)switch(a){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":p.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=a=>{a.preventDefault(),this._contextWasLost=!0,L.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},t.addEventListener("webglcontextlost",this._onContextLost,!1),t.addEventListener("webglcontextrestored",this._onContextRestored,!1),p.powerPreference=p.powerPreference||"high-performance"),this._badDesktopOS&&(p.xrCompatible=!1),!p.disableWebGL2Support)try{this._gl=t.getContext("webgl2",p)||t.getContext("experimental-webgl2",p),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(u){}if(!this._gl){if(!t)throw new Error("The provided canvas is null or undefined.");try{this._gl=t.getContext("webgl",p)||t.getContext("experimental-webgl",p)}catch(u){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=a,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const v=this._gl.getContextAttributes();v&&(p.stencil=v.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==p.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=p.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let P=0;P<this._caps.maxVertexAttribs;P++)this._currentBufferPointers[P]=new X;this._shaderProcessor=this.webGLVersion>1?new C:new V;const K=`Babylon.js v${Q.Version}`;L.d.Log(K+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",K);const F=(0,P.p)(this._gl);F.validateShaderPrograms=this.validateShaderPrograms,F.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(a){return null}areAllEffectsReady(){for(const a in this._compiledEffects){if(!this._compiledEffects[a].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const a=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=a&&(this._glRenderer=this._gl.getParameter(a.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(a.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const a=this._gl.getExtension("WEBGL_draw_buffers");if(null!==a){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=a.drawBuffersWEBGL.bind(a),this._caps.maxDrawBuffers=this._gl.getParameter(a.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let v=0;v<16;v++)this._gl["COLOR_ATTACHMENT"+v+"_WEBGL"]=a["COLOR_ATTACHMENT"+v+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const a=this._gl.getExtension("WEBGL_depth_texture");null!=a&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=a.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const a=this._gl.getExtension("OES_vertex_array_object");null!=a&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=a.createVertexArrayOES.bind(a),this._gl.bindVertexArray=a.bindVertexArrayOES.bind(a),this._gl.deleteVertexArray=a.deleteVertexArrayOES.bind(a))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const a=this._gl.getExtension("ANGLE_instanced_arrays");null!=a?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a),this._gl.drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._gl.vertexAttribDivisor=a.vertexAttribDivisorANGLE.bind(a)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),v=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&v&&(this._caps.highPrecisionShaderSupported=0!==a.precision&&0!==v.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const a=this._gl.getExtension("EXT_blend_minmax");null!=a&&(this._caps.blendMinMax=!0,this._gl.MAX=a.MAX_EXT,this._gl.MIN=a.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const a=this._gl.getExtension("EXT_sRGB");null!=a&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:a.SRGB_EXT,SRGB8:a.SRGB_ALPHA_EXT,SRGB8_ALPHA8:a.SRGB_ALPHA_EXT})}if(this._creationOptions){const a=this._creationOptions.forceSRGBBufferSupportState;void 0!==a&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&a)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let v=0;v<this._maxSimultaneousTextures;v++)this._nextFreeTextureSlots.push(v);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const a=this._workingCanvas.getContext("2d");a&&(this._workingContext=a)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const a=this.getGlInfo();return a&&a.renderer?a.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=b;let L=0;if(v&&a){let v=!0;if(this._currentRenderTarget){var t;const p=null===(t=this._currentRenderTarget.texture)||void 0===t?void 0:t.format;if(8===p||9===p||10===p||11===p){var V;const p=null===(V=this._currentRenderTarget.texture)||void 0===V?void 0:V.type;7===p||5===p?(Q._TempClearColorUint32[0]=255*a.r,Q._TempClearColorUint32[1]=255*a.g,Q._TempClearColorUint32[2]=255*a.b,Q._TempClearColorUint32[3]=255*a.a,this._gl.clearBufferuiv(this._gl.COLOR,0,Q._TempClearColorUint32),v=!1):(Q._TempClearColorInt32[0]=255*a.r,Q._TempClearColorInt32[1]=255*a.g,Q._TempClearColorInt32[2]=255*a.b,Q._TempClearColorInt32[3]=255*a.a,this._gl.clearBufferiv(this._gl.COLOR,0,Q._TempClearColorInt32),v=!1)}}v&&(this._gl.clearColor(a.r,a.g,a.b,void 0!==a.a?a.a:1),L|=this._gl.COLOR_BUFFER_BIT)}p&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),L|=this._gl.DEPTH_BUFFER_BIT),P&&(this._gl.clearStencil(0),L|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(L)}_viewport(a,v,p,P){a===this._viewportCached.x&&v===this._viewportCached.y&&p===this._viewportCached.z&&P===this._viewportCached.w||(this._viewportCached.x=a,this._viewportCached.y=v,this._viewportCached.z=p,this._viewportCached.w=P,this._gl.viewport(a,v,p,P))}qj(){super.qj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const K=a;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=a,this._bindUnboundFramebuffer(K._framebuffer);const C=this._gl;var F;if(!a.isMulti)if(a.is2DArray||a.is3D)C.framebufferTextureLayer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,null===(F=a.texture._hardwareTexture)||void 0===F?void 0:F.underlyingResource,t,V),K._currentLOD=t;else if(a.isCube){var u;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(u=a.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,t)}else if(K._currentLOD!==t){var c;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,null===(c=a.texture._hardwareTexture)||void 0===c?void 0:c.underlyingResource,t),K._currentLOD=t}const f=a._depthStencilTexture;if(f){a.is3D&&(a.texture.width===f.width&&a.texture.height===f.height&&a.texture.depth===f.depth||L.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const p=a._depthStencilTextureWithStencil?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT;var H;if(a.is2DArray||a.is3D)C.framebufferTextureLayer(C.FRAMEBUFFER,p,null===(H=f._hardwareTexture)||void 0===H?void 0:H.underlyingResource,t,V);else if(a.isCube){var A;C.framebufferTexture2D(C.FRAMEBUFFER,p,C.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(A=f._hardwareTexture)||void 0===A?void 0:A.underlyingResource,t)}else{var h;C.framebufferTexture2D(C.FRAMEBUFFER,p,C.TEXTURE_2D,null===(h=f._hardwareTexture)||void 0===h?void 0:h.underlyingResource,t)}}K._MSAAFramebuffer&&this._bindUnboundFramebuffer(K._MSAAFramebuffer),this._cachedViewport&&!b?this.setViewport(this._cachedViewport,p,P):(p||(p=a.width,t&&(p/=Math.pow(2,t))),P||(P=a.height,t&&(P/=Math.pow(2,t))),this._viewport(0,0,p,P)),this.wipeCaches()}setState(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==a||p)&&(this._depthCullingState.cull=a);const V=this.cullBackFaces??b??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==V||p)&&(this._depthCullingState.cullFace=V),this.setZOffset(v),this.setZOffsetUnits(t);const K=P?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==K||p)&&(this._depthCullingState.frontFace=K),this._stencilStateComposer.stencilMaterial=L}_bindUnboundFramebuffer(a){this._currentFramebuffer!==a&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,a),this._currentFramebuffer=a)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(a){const v=this._getTextureTarget(a);this._bindTextureDirectly(v,a,!0),this._gl.generateMipmap(v),this._bindTextureDirectly(v,null)}unBindFramebuffer(a){var v;let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0;const b=a;this._currentRenderTarget=null;const L=this._gl;if(b._MSAAFramebuffer){if(a.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(a,p,P);L.bindFramebuffer(L.READ_FRAMEBUFFER,b._MSAAFramebuffer),L.bindFramebuffer(L.DRAW_FRAMEBUFFER,b._framebuffer),L.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,L.COLOR_BUFFER_BIT,L.NEAREST)}null===(v=a.texture)||void 0===v||!v.generateMipMaps||p||a.isCube||this.generateMipmaps(a.texture),P&&(b._MSAAFramebuffer&&this._bindUnboundFramebuffer(b._framebuffer),P()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(a,v,p){return this._createVertexBuffer(a,this._gl.STATIC_DRAW)}_createVertexBuffer(a,v){const p=this._gl.createBuffer();if(!p)throw new Error("Unable to create vertex buffer");const P=new F.e(p);return this.bindArrayBuffer(P),"number"!==typeof a?a instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),v),P.ub=4*a.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,a,v),P.ub=a.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(a),v),P.ub=a),this._resetVertexBufferBinding(),P.references=1,P}createDynamicVertexBuffer(a,v){return this._createVertexBuffer(a,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(a,v,p){const P=this._gl.createBuffer(),b=new F.e(P);if(!P)throw new Error("Unable to create index buffer");this.bindIndexBuffer(b);const L=this._normalizeIndexData(a);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,L,v?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),b.references=1,b.is32Bits=4===L.BYTES_PER_ELEMENT,b}_normalizeIndexData(a){if(2===a.BYTES_PER_ELEMENT)return a;if(this._caps.uintIndices){if(a instanceof Uint32Array)return a;for(let v=0;v<a.length;v++)if(a[v]>=65535)return new Uint32Array(a);return new Uint16Array(a)}return new Uint16Array(a)}bindArrayBuffer(a){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(a,this._gl.ARRAY_BUFFER)}bindUniformBlock(a,v,p){const P=a.program,b=this._gl.getUniformBlockIndex(P,v);this._gl.uniformBlockBinding(P,b,p)}bindIndexBuffer(a){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(a,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(a,v){(this._vaoRecordInProgress||this._currentBoundBuffer[v]!==a)&&(this._gl.bindBuffer(v,a?a.underlyingResource:null),this._currentBoundBuffer[v]=a)}updateArrayBuffer(a){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a)}_vertexAttribPointer(a,v,p,P,b,L,t){const V=this._currentBufferPointers[v];if(!V)return;let K=!1;V.active?(V.buffer!==a&&(V.buffer=a,K=!0),V.size!==p&&(V.size=p,K=!0),V.type!==P&&(V.type=P,K=!0),V.normalized!==b&&(V.normalized=b,K=!0),V.stride!==L&&(V.stride=L,K=!0),V.offset!==t&&(V.offset=t,K=!0)):(K=!0,V.active=!0,V.index=v,V.size=p,V.type=P,V.normalized=b,V.stride=L,V.offset=t,V.buffer=a),(K||this._vaoRecordInProgress)&&(this.bindArrayBuffer(a),P===this._gl.UNSIGNED_INT||P===this._gl.INT?this._gl.vertexAttribIPointer(v,p,P,L,t):this._gl.vertexAttribPointer(v,p,P,b,L,t))}_bindIndexBufferWithCache(a){null!=a&&this._cachedIndexBuffer!==a&&(this._cachedIndexBuffer=a,this.bindIndexBuffer(a),this._uintIndicesCurrentlySet=a.is32Bits)}_bindVertexBuffersAttributes(a,v,p){const P=v.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let b=0;b<P.length;b++){const L=v.getAttributeLocation(b);if(L>=0){const v=P[b];let t=null;if(p&&(t=p[v]),t||(t=a[v]),!t)continue;this._gl.enableVertexAttribArray(L),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[L]=!0);const V=t.getBuffer();V&&(this._vertexAttribPointer(V,L,t.getSize(),t.type,t.normalized,t.byteStride,t.byteOffset),t.getIsInstanced()&&(this._gl.vertexAttribDivisor(L,t.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(L),this._currentInstanceBuffers.push(V))))}}}recordVertexArrayObject(a,v,p,P){const b=this._gl.createVertexArray();if(!b)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(b),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(a,p,P),this.bindIndexBuffer(v),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),b}bindVertexArrayObject(a,v){this._cachedVertexArrayObject!==a&&(this._cachedVertexArrayObject=a,this._gl.bindVertexArray(a),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=v&&v.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(a,v,p,P,b){if(this._cachedVertexBuffers!==a||this._cachedEffectForVertexBuffers!==b){this._cachedVertexBuffers=a,this._cachedEffectForVertexBuffers=b;const v=b.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let L=0;for(let t=0;t<v;t++)if(t<p.length){const v=b.getAttributeLocation(t);v>=0&&(this._gl.enableVertexAttribArray(v),this._vertexAttribArraysEnabled[v]=!0,this._vertexAttribPointer(a,v,p[t],this._gl.FLOAT,!1,P,L)),L+=4*p[t]}}this._bindIndexBufferWithCache(v)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(a,v,p,P){this._cachedVertexBuffers===a&&this._cachedEffectForVertexBuffers===p||(this._cachedVertexBuffers=a,this._cachedEffectForVertexBuffers=p,this._bindVertexBuffersAttributes(a,p,P)),this._bindIndexBufferWithCache(v)}unbindInstanceAttributes(){let a;for(let v=0,p=this._currentInstanceLocations.length;v<p;v++){const p=this._currentInstanceBuffers[v];a!=p&&p.references&&(a=p,this.bindArrayBuffer(p));const P=this._currentInstanceLocations[v];this._gl.vertexAttribDivisor(P,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(a){this._gl.deleteVertexArray(a)}_releaseBuffer(a){return a.references--,0===a.references&&(this._deleteBuffer(a),!0)}_deleteBuffer(a){this._gl.deleteBuffer(a.underlyingResource)}updateAndBindInstancesBuffer(a,v,p){if(this.bindArrayBuffer(a),v&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v),void 0!==p[0].index)this.bindInstancesBuffer(a,p,!0);else for(let P=0;P<4;P++){const v=p[P];this._vertexAttribArraysEnabled[v]||(this._gl.enableVertexAttribArray(v),this._vertexAttribArraysEnabled[v]=!0),this._vertexAttribPointer(a,v,4,this._gl.FLOAT,!1,64,16*P),this._gl.vertexAttribDivisor(v,1),this._currentInstanceLocations.push(v),this._currentInstanceBuffers.push(a)}}bindInstancesBuffer(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(a);let P=0;if(p)for(let b=0;b<v.length;b++){P+=4*v[b].attributeSize}for(let b=0;b<v.length;b++){const p=v[b];void 0===p.index&&(p.index=this._currentEffect.getAttributeLocationByName(p.attributeName)),p.index<0||(this._vertexAttribArraysEnabled[p.index]||(this._gl.enableVertexAttribArray(p.index),this._vertexAttribArraysEnabled[p.index]=!0),this._vertexAttribPointer(a,p.index,p.attributeSize,p.attributeType||this._gl.FLOAT,p.normalized||!1,P,p.offset),this._gl.vertexAttribDivisor(p.index,void 0===p.divisor?1:p.divisor),this._currentInstanceLocations.push(p.index),this._currentInstanceBuffers.push(a))}}disableInstanceAttributeByName(a){if(!this._currentEffect)return;const v=this._currentEffect.getAttributeLocationByName(a);this.disableInstanceAttribute(v)}disableInstanceAttribute(a){let v,p=!1;for(;-1!==(v=this._currentInstanceLocations.indexOf(a));)this._currentInstanceLocations.splice(v,1),this._currentInstanceBuffers.splice(v,1),p=!0,v=this._currentInstanceLocations.indexOf(a);p&&(this._gl.vertexAttribDivisor(a,0),this.disableAttributeByIndex(a))}disableAttributeByIndex(a){this._gl.disableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!1,this._currentBufferPointers[a].active=!1}draw(a,v,p,P){this.drawElementsType(a?0:1,v,p,P)}drawPointClouds(a,v,p){this.drawArraysType(2,a,v,p)}drawUnIndexed(a,v,p,P){this.drawArraysType(a?0:1,v,p,P)}drawElementsType(a,v,p,P){this.applyStates(),this._reportDrawCall();const b=this._drawMode(a),L=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,t=this._uintIndicesCurrentlySet?4:2;P?this._gl.drawElementsInstanced(b,p,L,v*t,P):this._gl.drawElements(b,p,L,v*t)}drawArraysType(a,v,p,P){this.applyStates(),this._reportDrawCall();const b=this._drawMode(a);P?this._gl.drawArraysInstanced(b,v,p,P):this._gl.drawArrays(b,v,p)}_drawMode(a){switch(a){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(a){this._compiledEffects[a._key]&&delete this._compiledEffects[a._key];const v=a.getPipelineContext();v&&this._deletePipelineContext(v)}_deletePipelineContext(a){const v=a;v&&v.program&&(v.program.__SPECTOR_rebuildProgram=null,(0,R.f)(v),this._gl.deleteProgram(v.program))}_getGlobalDefines(a){return(0,h.j)(a,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(a,v,p,b,L,t,V,K,C){let F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;const c="string"===typeof a?a:a.vertexToken||a.vertexSource||a.vertexElement||a.vertex,f="string"===typeof a?a:a.fragmentToken||a.fragmentSource||a.fragmentElement||a.fragment,H=this._getGlobalDefines();let h=L??v.defines??"";H&&(h+=H);const R=c+"+"+f+"@"+h;if(this._compiledEffects[R]){const a=this._compiledEffects[R];return V&&a.isReady()&&V(a),a._refCount++,a}this._gl&&(0,P.p)(this._gl);const X=new A.c(a,v,p,b,this,L,t,V,K,C,R,v.shaderLanguage??F,v.extraInitializationsAsync??u);return this._compiledEffects[R]=X,X}_getShaderSource(a){return this._gl.getShaderSource(a)}createRawShaderProgram(a,v,p,b){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const t=(0,P.p)(this._gl);return t._contextWasLost=this._contextWasLost,t.validateShaderPrograms=this.validateShaderPrograms,(0,P.l)(a,v,p,b||this._gl,L)}createShaderProgram(a,v,p,b,L){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const V=(0,P.p)(this._gl);return V._contextWasLost=this._contextWasLost,V.validateShaderPrograms=this.validateShaderPrograms,(0,P.m)(a,v,p,b,L||this._gl,t)}inlineShaderCode(a){return a}createPipelineContext(a){if(this._gl){(0,P.p)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const v=(0,P.i)(this._gl,a);return v.Id=this,v}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(a){return(0,P.e)(a,this._gl,this.validateShaderPrograms)}_preparePipelineContext(a,v,p,b,L,t,V,K,C,F,u){const c=(0,P.p)(this._gl);return c._contextWasLost=this._contextWasLost,c.validateShaderPrograms=this.validateShaderPrograms,c._createShaderProgramInjection=this._createShaderProgram.bind(this),c.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),c.createShaderProgramInjection=this.createShaderProgram.bind(this),c.loadFileInjection=this._loadFile.bind(this),(0,P.f)(a,v,p,b,L,t,V,K,C,F,u)}_createShaderProgram(a,v,p,b){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,P.c)(a,v,p,b,L)}_isRenderingStateCompiled(a){const v=a;return!this._isDisposed&&!v._isDisposed&&(!!this._gl.getProgramParameter(v.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(v),!0))}_executeWhenRenderingStateIsCompiled(a,v){(0,P.d)(a,v)}getUniforms(a,v){const p=new Array,P=a;for(let b=0;b<v.length;b++)p.push(this._gl.getUniformLocation(P.program,v[b]));return p}getAttributes(a,v){const p=[],P=a;for(let L=0;L<v.length;L++)try{p.push(this._gl.getAttribLocation(P.program,v[L]))}catch(b){p.push(-1)}return p}enableEffect(a){(a=null!==a&&(0,b.d)(a)?a.effect:a)&&a!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(a),this._currentEffect=a,a.onBind&&a.onBind(a),a._onBindObservable&&a._onBindObservable.notifyObservers(a))}setInt(a,v){return!!a&&(this._gl.uniform1i(a,v),!0)}setInt2(a,v,p){return!!a&&(this._gl.uniform2i(a,v,p),!0)}setInt3(a,v,p,P){return!!a&&(this._gl.uniform3i(a,v,p,P),!0)}setInt4(a,v,p,P,b){return!!a&&(this._gl.uniform4i(a,v,p,P,b),!0)}setIntArray(a,v){return!!a&&(this._gl.uniform1iv(a,v),!0)}setIntArray2(a,v){return!(!a||v.length%2!==0)&&(this._gl.uniform2iv(a,v),!0)}setIntArray3(a,v){return!(!a||v.length%3!==0)&&(this._gl.uniform3iv(a,v),!0)}setIntArray4(a,v){return!(!a||v.length%4!==0)&&(this._gl.uniform4iv(a,v),!0)}setUInt(a,v){return!!a&&(this._gl.uniform1ui(a,v),!0)}setUInt2(a,v,p){return!!a&&(this._gl.uniform2ui(a,v,p),!0)}setUInt3(a,v,p,P){return!!a&&(this._gl.uniform3ui(a,v,p,P),!0)}setUInt4(a,v,p,P,b){return!!a&&(this._gl.uniform4ui(a,v,p,P,b),!0)}setUIntArray(a,v){return!!a&&(this._gl.uniform1uiv(a,v),!0)}setUIntArray2(a,v){return!(!a||v.length%2!==0)&&(this._gl.uniform2uiv(a,v),!0)}setUIntArray3(a,v){return!(!a||v.length%3!==0)&&(this._gl.uniform3uiv(a,v),!0)}setUIntArray4(a,v){return!(!a||v.length%4!==0)&&(this._gl.uniform4uiv(a,v),!0)}setArray(a,v){return!!a&&(!(v.length<1)&&(this._gl.uniform1fv(a,v),!0))}setArray2(a,v){return!(!a||v.length%2!==0)&&(this._gl.uniform2fv(a,v),!0)}setArray3(a,v){return!(!a||v.length%3!==0)&&(this._gl.uniform3fv(a,v),!0)}setArray4(a,v){return!(!a||v.length%4!==0)&&(this._gl.uniform4fv(a,v),!0)}setMatrices(a,v){return!!a&&(this._gl.uniformMatrix4fv(a,!1,v),!0)}setMatrix3x3(a,v){return!!a&&(this._gl.uniformMatrix3fv(a,!1,v),!0)}setMatrix2x2(a,v){return!!a&&(this._gl.uniformMatrix2fv(a,!1,v),!0)}setFloat(a,v){return!!a&&(this._gl.uniform1f(a,v),!0)}setFloat2(a,v,p){return!!a&&(this._gl.uniform2f(a,v,p),!0)}setFloat3(a,v,p,P){return!!a&&(this._gl.uniform3f(a,v,p,P),!0)}setFloat4(a,v,p,P,b){return!!a&&(this._gl.uniform4f(a,v,p,P,b),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const a=this._colorWrite;this._gl.colorMask(a,a,a,a)}}wipeCaches(a){this.preventCacheWipeBetweenFrames&&!a||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),a&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(a,v){const p=this._gl;let P=p.NEAREST,b=p.NEAREST;switch(a){case 11:P=p.LINEAR,b=v?p.LINEAR_MIPMAP_NEAREST:p.LINEAR;break;case 3:P=p.LINEAR,b=v?p.LINEAR_MIPMAP_LINEAR:p.LINEAR;break;case 8:P=p.NEAREST,b=v?p.NEAREST_MIPMAP_LINEAR:p.NEAREST;break;case 4:P=p.NEAREST,b=v?p.NEAREST_MIPMAP_NEAREST:p.NEAREST;break;case 5:P=p.NEAREST,b=v?p.LINEAR_MIPMAP_NEAREST:p.LINEAR;break;case 6:P=p.NEAREST,b=v?p.LINEAR_MIPMAP_LINEAR:p.LINEAR;break;case 7:P=p.NEAREST,b=p.LINEAR;break;case 1:P=p.NEAREST,b=p.NEAREST;break;case 9:P=p.LINEAR,b=v?p.NEAREST_MIPMAP_NEAREST:p.NEAREST;break;case 10:P=p.LINEAR,b=v?p.NEAREST_MIPMAP_LINEAR:p.NEAREST;break;case 2:P=p.LINEAR,b=p.LINEAR;break;case 12:P=p.LINEAR,b=p.NEAREST}return{min:b,mag:P}}_createTexture(){const a=this._gl.createTexture();if(!a)throw new Error("Unable to create texture");return a}_createHardwareTexture(){return new f.e(this._createTexture(),this._gl)}_createInternalTexture(a,v){let p,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=!1,t=0,V=3,K=5,C=!1,F=1;void 0!==v&&"object"===typeof v?(b=!!v.generateMipMaps,t=void 0===v.type?0:v.type,V=void 0===v.samplingMode?3:v.samplingMode,K=void 0===v.format?5:v.format,C=void 0!==v.useSRGBBuffer&&v.useSRGBBuffer,F=v.samples??1,p=v.label):b=!!v,C&&(C=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==t||this._caps.textureFloatLinearFiltering)&&(2!==t||this._caps.textureHalfFloatLinearFiltering)||(V=1),1!==t||this._caps.textureFloat||(t=0,L.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const u=this._gl,c=new H.d(this,P),f=a.width||a,A=a.height||a,h=a.depth||0,R=a.layers||0,X=this._getSamplingParameters(V,b),Q=0!==R?u.TEXTURE_2D_ARRAY:0!==h?u.TEXTURE_3D:u.TEXTURE_2D,s=this._getRGBABufferInternalSizedFormat(t,K,C),D=this._getInternalFormat(K),y=this._getWebGLTextureType(t);return this._bindTextureDirectly(Q,c),0!==R?(c.is2DArray=!0,u.texImage3D(Q,0,s,f,A,R,0,D,y,null)):0!==h?(c.is3D=!0,u.texImage3D(Q,0,s,f,A,h,0,D,y,null)):u.texImage2D(Q,0,s,f,A,0,D,y,null),u.texParameteri(Q,u.TEXTURE_MAG_FILTER,X.mag),u.texParameteri(Q,u.TEXTURE_MIN_FILTER,X.min),u.texParameteri(Q,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(Q,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),b&&this._gl.generateMipmap(Q),this._bindTextureDirectly(Q,null),c._useSRGBBuffer=C,c.baseWidth=f,c.baseHeight=A,c.width=f,c.height=A,c.depth=R,c.isReady=!0,c.samples=F,c.generateMipMaps=b,c.samplingMode=V,c.type=t,c.format=K,c.label=p,this._internalTexturesCache.push(c),c}_getUseSRGBBuffer(a,v){return a&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||v)}createTexture(a,v,p,P){var b=this;let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,c=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,A=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(a,v,p,P,L,t,V,(function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];return b._prepareWebGLTexture(...v,F)}),((a,v,p,b,L,t)=>{const V=this._gl,K=p.width===a&&p.height===v;L._creationFlags=A??0;const C=this._getTexImageParametersForCreateTexture(L.format,L._useSRGBBuffer);if(K)return V.texImage2D(V.TEXTURE_2D,0,C.internalFormat,C.format,C.type,p),!1;const F=this._caps.maxTextureSize;if(p.width>F||p.height>F||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=a,this._workingCanvas.height=v,this._workingContext.drawImage(p,0,0,p.width,p.height,0,0,a,v),V.texImage2D(V.TEXTURE_2D,0,C.internalFormat,C.format,C.type,this._workingCanvas),L.width=a,L.height=v,!1);{const a=new H.d(this,2);this._bindTextureDirectly(V.TEXTURE_2D,a,!0),V.texImage2D(V.TEXTURE_2D,0,C.internalFormat,C.format,C.type,p),this._rescaleTexture(a,L,P,C.format,(()=>{this._releaseTexture(a),this._bindTextureDirectly(V.TEXTURE_2D,L,!0),t()}))}return!0}),K,C,F,u,c,f,h)}_getTexImageParametersForCreateTexture(a,v){let p,P;return 1===this.webGLVersion?(p=this._getInternalFormat(a,v),P=p):(p=this._getInternalFormat(a,!1),P=this._getRGBABufferInternalSizedFormat(0,a,v)),{internalFormat:P,format:p,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(a,v,p,P,b){}_unpackFlipY(a){this._unpackFlipYCached!==a&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,a?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=a))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(a){return a.isCube?this._gl.TEXTURE_CUBE_MAP:a.is3D?this._gl.TEXTURE_3D:a.is2DArray||a.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=this._getTextureTarget(v),b=this._getSamplingParameters(a,v.useMipMaps||p);this._setTextureParameterInteger(P,this._gl.TEXTURE_MAG_FILTER,b.mag,v),this._setTextureParameterInteger(P,this._gl.TEXTURE_MIN_FILTER,b.min),p&&(v.generateMipMaps=!0,this._gl.generateMipmap(P)),this._bindTextureDirectly(P,null),v.samplingMode=a}updateTextureDimensions(a,v,p){}updateTextureWrappingMode(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=this._getTextureTarget(a);null!==v&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(v),a),a._cachedWrapU=v),null!==p&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(p),a),a._cachedWrapV=p),(a.is2DArray||a.is3D)&&null!==P&&(this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(P),a),a._cachedWrapR=P),this._bindTextureDirectly(b,null)}_uploadCompressedDataToTextureDirectly(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const V=this._gl;let K=V.TEXTURE_2D;if(a.isCube&&(K=V.TEXTURE_CUBE_MAP_POSITIVE_X+L),a._useSRGBBuffer)switch(v){case 37492:case 36196:this._caps.etc2?v=V.COMPRESSED_SRGB8_ETC2:a._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?v=V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a._useSRGBBuffer=!1;break;case 36492:v=V.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:v=V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?v=V.COMPRESSED_SRGB_S3TC_DXT1_EXT:a._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?v=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:a._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?v=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:a._useSRGBBuffer=!1;break;default:a._useSRGBBuffer=!1}this._gl.compressedTexImage2D(K,t,v,p,P,0,b)}_uploadDataToTextureDirectly(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=this._gl,V=this._getWebGLTextureType(a.type),K=this._getInternalFormat(a.format),C=void 0===b?this._getRGBABufferInternalSizedFormat(a.type,a.format,a._useSRGBBuffer):this._getInternalFormat(b,a._useSRGBBuffer);this._unpackFlipY(a.invertY);let F=t.TEXTURE_2D;a.isCube&&(F=t.TEXTURE_CUBE_MAP_POSITIVE_X+p);const u=Math.round(Math.log(a.width)*Math.LOG2E),c=Math.round(Math.log(a.height)*Math.LOG2E),f=L?a.width:Math.pow(2,Math.max(u-P,0)),H=L?a.height:Math.pow(2,Math.max(c-P,0));t.texImage2D(F,P,C,f,H,0,K,V,v)}updateTextureData(a,v,p,P,b,L){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const C=this._gl,F=this._getWebGLTextureType(a.type),u=this._getInternalFormat(a.format);this._unpackFlipY(a.invertY);let c=C.TEXTURE_2D,f=C.TEXTURE_2D;a.isCube&&(f=C.TEXTURE_CUBE_MAP_POSITIVE_X+t,c=C.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c,a,!0),C.texSubImage2D(f,V,p,P,b,L,u,F,v),K&&this._gl.generateMipmap(f),this._bindTextureDirectly(c,null)}_uploadArrayBufferViewToTexture(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const b=this._gl,L=a.isCube?b.TEXTURE_CUBE_MAP:b.TEXTURE_2D;this._bindTextureDirectly(L,a,!0),this._uploadDataToTextureDirectly(a,v,p,P),this._bindTextureDirectly(L,null,!0)}_prepareWebGLTextureContinuation(a,v,p,P,b){const L=this._gl;if(!L)return;const t=this._getSamplingParameters(b,!p);L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,t.mag),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,t.min),p||P||L.generateMipmap(L.TEXTURE_2D),this._bindTextureDirectly(L.TEXTURE_2D,null),v&&v.removePendingData(a),a.onLoadedObservable.notifyObservers(a),a.onLoadedObservable.clear()}_prepareWebGLTexture(a,v,p,P,b,L,t,V,K,C){const F=this.getCaps().maxTextureSize,c=Math.min(F,this.needPOTTextures?(0,u.i)(P.width,F):P.width),f=Math.min(F,this.needPOTTextures?(0,u.i)(P.height,F):P.height),H=this._gl;H&&(a._hardwareTexture?(this._bindTextureDirectly(H.TEXTURE_2D,a,!0),this._unpackFlipY(void 0===b||!!b),a.baseWidth=P.width,a.baseHeight=P.height,a.width=c,a.height=f,a.isReady=!0,a.type=-1!==a.type?a.type:0,a.format=-1!==a.format?a.format:C??(".jpg"!==v||a._useSRGBBuffer?5:4),V(c,f,P,v,a,(()=>{this._prepareWebGLTextureContinuation(a,p,L,t,K)}))||this._prepareWebGLTextureContinuation(a,p,L,t,K)):p&&p.removePendingData(a))}_getInternalFormatFromDepthTextureFormat(a,v,p){const P=this._gl;if(!v)return P.STENCIL_INDEX8;let b=p?P.DEPTH_STENCIL:P.DEPTH_COMPONENT;return this.webGLVersion>1?15===a?b=P.DEPTH_COMPONENT16:16===a?b=P.DEPTH_COMPONENT24:17===a||13===a?b=p?P.DEPTH24_STENCIL8:P.DEPTH_COMPONENT24:14===a?b=P.DEPTH_COMPONENT32F:18===a&&(b=p?P.DEPTH32F_STENCIL8:P.DEPTH_COMPONENT32F):b=P.DEPTH_COMPONENT16,b}_setupFramebufferDepthAttachments(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,L=arguments.length>5?arguments[5]:void 0;const t=this._gl;L=L??(a?13:14);const V=this._getInternalFormatFromDepthTextureFormat(L,v,a);return a&&v?this._createRenderBuffer(p,P,b,t.DEPTH_STENCIL,V,t.DEPTH_STENCIL_ATTACHMENT):v?this._createRenderBuffer(p,P,b,V,V,t.DEPTH_ATTACHMENT):a?this._createRenderBuffer(p,P,b,V,V,t.STENCIL_ATTACHMENT):null}_createRenderBuffer(a,v,p,P,b,L){let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const V=this._gl.createRenderbuffer();return this._updateRenderBuffer(V,a,v,p,P,b,L,t)}_updateRenderBuffer(a,v,p,P,b,L,t){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const K=this._gl;return K.bindRenderbuffer(K.RENDERBUFFER,a),P>1&&K.renderbufferStorageMultisample?K.renderbufferStorageMultisample(K.RENDERBUFFER,P,L,v,p):K.renderbufferStorage(K.RENDERBUFFER,b,v,p),K.framebufferRenderbuffer(K.FRAMEBUFFER,t,K.RENDERBUFFER,a),V&&K.bindRenderbuffer(K.RENDERBUFFER,null),a}_releaseTexture(a){this._deleteTexture(a._hardwareTexture),this.unbindAllTextures();const v=this._internalTexturesCache.indexOf(a);-1!==v&&this._internalTexturesCache.splice(v,1),a._lodTextureHigh&&a._lodTextureHigh.dispose(),a._lodTextureMid&&a._lodTextureMid.dispose(),a._lodTextureLow&&a._lodTextureLow.dispose(),a._irradianceTexture&&a._irradianceTexture.dispose()}_deleteTexture(a){null===a||void 0===a||a.release()}_setProgram(a){this._currentProgram!==a&&((0,P.g)(a,this._gl),this._currentProgram=a)}bindSamplers(a){const v=a.getPipelineContext();this._setProgram(v.program);const p=a.getSamplers();for(let P=0;P<p.length;P++){const v=a.getUniform(p[P]);v&&(this._boundUniforms[P]=v)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=!1;const t=v&&v._associatedChannel>-1;p&&t&&(this._activeChannel=v._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==v||P){if(this._activateCurrentTexture(),v&&v.isMultiview)throw L.d.Error(["_bindTextureDirectly called with a multiview texture!",a,v]),"_bindTextureDirectly called with a multiview texture!";var V;this._gl.bindTexture(a,(null===v||void 0===v||null===(V=v._hardwareTexture)||void 0===V?void 0:V.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=v,v&&(v._associatedChannel=this._activeChannel)}else p&&(b=!0,this._activateCurrentTexture());return t&&!p&&this._bindSamplerUniformToChannel(v._associatedChannel,this._activeChannel),b}_bindTexture(a,v,p){if(void 0===a)return;v&&(v._associatedChannel=a),this._activeChannel=a;const P=v?this._getTextureTarget(v):this._gl.TEXTURE_2D;this._bindTextureDirectly(P,v)}unbindAllTextures(){for(let a=0;a<this._maxSimultaneousTextures;a++)this._activeChannel=a,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(a,v,p,P){void 0!==a&&(v&&(this._boundUniforms[a]=v),this._setTexture(a,p))}_bindSamplerUniformToChannel(a,v){const p=this._boundUniforms[a];p&&p._currentState!==v&&(this._gl.uniform1i(p,v),p._currentState=v)}_getTextureWrapMode(a){switch(a){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(a,v){let p,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!v)return null!=this._boundTexturesCache[a]&&(this._activeChannel=a,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(v.video){this._activeChannel=a;const p=v.getInternalTexture();p&&(p._associatedChannel=a),v.update()}else if(4===v.delayLoadState)return v.delayLoad(),!1;p=b?v.depthStencilTexture:v.isReady()?v.getInternalTexture():v.isCube?this.emptyCubeTexture:v.is3D?this.emptyTexture3D:v.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!P&&p&&(p._associatedChannel=a);let L=!0;this._boundTexturesCache[a]===p&&(P||this._bindSamplerUniformToChannel(p._associatedChannel,a),L=!1),this._activeChannel=a;const t=this._getTextureTarget(p);if(L&&this._bindTextureDirectly(t,p,P),p&&!p.isMultiview){if(p.isCube&&p._cachedCoordinatesMode!==v.coordinatesMode){p._cachedCoordinatesMode=v.coordinatesMode;const a=3!==v.coordinatesMode&&5!==v.coordinatesMode?1:0;v.wrapU=a,v.wrapV=a}p._cachedWrapU!==v.wrapU&&(p._cachedWrapU=v.wrapU,this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(v.wrapU),p)),p._cachedWrapV!==v.wrapV&&(p._cachedWrapV=v.wrapV,this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(v.wrapV),p)),p.is3D&&p._cachedWrapR!==v.wrapR&&(p._cachedWrapR=v.wrapR,this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(v.wrapR),p)),this._setAnisotropicLevel(t,p,v.anisotropicFilteringLevel)}return!0}setTextureArray(a,v,p,P){if(void 0!==a&&v){this._textureUnits&&this._textureUnits.length===p.length||(this._textureUnits=new Int32Array(p.length));for(let v=0;v<p.length;v++){const P=p[v].getInternalTexture();P?(this._textureUnits[v]=a+v,P._associatedChannel=a+v):this._textureUnits[v]=-1}this._gl.uniform1iv(v,this._textureUnits);for(let a=0;a<p.length;a++)this._setTexture(this._textureUnits[a],p[a],!0)}}_setAnisotropicLevel(a,v,p){const P=this._caps.textureAnisotropicFilterExtension;11!==v.samplingMode&&3!==v.samplingMode&&2!==v.samplingMode&&(p=1),P&&v._cachedAnisotropicFilteringLevel!==p&&(this._setTextureParameterFloat(a,P.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(p,this._caps.maxAnisotropy),v),v._cachedAnisotropicFilteringLevel=p)}_setTextureParameterFloat(a,v,p,P){this._bindTextureDirectly(a,P,!0,!0),this._gl.texParameterf(a,v,p)}_setTextureParameterInteger(a,v,p,P){P&&this._bindTextureDirectly(a,P,!0,!0),this._gl.texParameteri(a,v,p)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let a=0;a<this._caps.maxVertexAttribs;a++)this.disableAttributeByIndex(a)}else for(let a=0,v=this._vertexAttribArraysEnabled.length;a<v;a++)a>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[a]||this.disableAttributeByIndex(a)}releaseEffects(){const a=Object.keys(this._compiledEffects);for(const v of a){this._compiledEffects[v].dispose()}this._compiledEffects={}}dispose(){var a;((0,t.n)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(a=this._gl.getExtension("WEBGL_lose_context"))||void 0===a||a.loseContext());(0,P.n)(this._gl)}attachContextLostEvent(a){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",a,!1)}attachContextRestoredEvent(a){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",a,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(a){const v=this._gl;for(;v.getError()!==v.NO_ERROR;);let p=!0;const P=v.createTexture();v.bindTexture(v.TEXTURE_2D,P),v.texImage2D(v.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(a),1,1,0,v.RGBA,this._getWebGLTextureType(a),null),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST);const b=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,b),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,P,0);const L=v.checkFramebufferStatus(v.FRAMEBUFFER);if(p=p&&L===v.FRAMEBUFFER_COMPLETE,p=p&&v.getError()===v.NO_ERROR,p&&(v.clear(v.COLOR_BUFFER_BIT),p=p&&v.getError()===v.NO_ERROR),p){v.bindFramebuffer(v.FRAMEBUFFER,null);const a=v.RGBA,P=v.UNSIGNED_BYTE,b=new Uint8Array(4);v.readPixels(0,0,1,1,a,P,b),p=p&&v.getError()===v.NO_ERROR}for(v.deleteTexture(P),v.deleteFramebuffer(b),v.bindFramebuffer(v.FRAMEBUFFER,null);!p&&v.getError()!==v.NO_ERROR;);return p}_getWebGLTextureType(a){if(1===this._webGLVersion){switch(a){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(a){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=v?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(a){case 0:p=this._gl.ALPHA;break;case 1:p=this._gl.LUMINANCE;break;case 2:p=this._gl.LUMINANCE_ALPHA;break;case 6:p=this._gl.RED;break;case 7:p=this._gl.RG;break;case 4:p=v?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:p=v?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(a){case 8:p=this._gl.RED_INTEGER;break;case 9:p=this._gl.RG_INTEGER;break;case 10:p=this._gl.RGB_INTEGER;break;case 11:p=this._gl.RGBA_INTEGER}return p}_getRGBABufferInternalSizedFormat(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==v)switch(v){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return p?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(a){case 3:switch(v){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(v){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return p?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(v){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(v){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(v){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(v){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(v){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(v){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(v){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(a,v,p,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const t=b?4:3,V=b?this._gl.RGBA:this._gl.RGB,K=new Uint8Array(P*p*t);return L&&this.flushFramebuffer(),this._gl.readPixels(a,v,p,P,V,this._gl.UNSIGNED_BYTE,K),Promise.resolve(K)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const a=c.e._CreateCanvas(1,1),v=a.getContext("webgl")||a.getContext("experimental-webgl");this._IsSupported=null!=v&&!!window.WebGLRenderingContext}catch(a){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const a=c.e._CreateCanvas(1,1),v=a.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||a.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!v}catch(a){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}Q._TempClearColorUint32=new Uint32Array(4),Q._TempClearColorInt32=new Int32Array(4),Q.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],Q._ConcatenateShader=h.f,Q._IsSupported=null,Q._HasMajorPerformanceCaveat=null},11346:(a,v,p)=>{"use strict";var P;p.d(v,{e:()=>b}),function(a){a[a.PointerMove=0]="PointerMove",a[a.PointerDown=1]="PointerDown",a[a.PointerUp=2]="PointerUp"}(P||(P={}));class b{}b.DOM_DELTA_PIXEL=0,b.DOM_DELTA_LINE=1,b.DOM_DELTA_PAGE=2},11344:(a,v,p)=>{"use strict";p.d(v,{d:()=>P,h:()=>L,l:()=>b});class P{}P.KEYDOWN=1,P.KEYUP=2;class b{constructor(a,v){this.type=a,this.event=v}}class L extends b{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(a){this.skipOnKeyboardObservable=a}constructor(a,v){super(a,v),this.type=a,this.event=v,this.skipOnKeyboardObservable=!1}}},11340:(a,v,p)=>{"use strict";p.d(v,{e:()=>b,g:()=>t,k:()=>V});var P=p(11240);class b{}b.POINTERDOWN=1,b.POINTERUP=2,b.POINTERMOVE=4,b.POINTERWHEEL=8,b.POINTERPICK=16,b.POINTERTAP=32,b.POINTERDOUBLETAP=64;class L{constructor(a,v){this.type=a,this.event=v}}class t extends L{constructor(a,v,p,b){super(a,v),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new P.o(p,b)}}class V extends L{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(a,v),this._pickInfo=p,this._inputManager=P}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10882:(a,v,p)=>{"use strict";p.r(v),p.d(v,{SceneInstrumentation:()=>L});var P=p(10889),b=p(11042);class L{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(a){a!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=a,a?(this._onBeforeActiveMeshesEvaluationObserver=this.sd.onBeforeActiveMeshesEvaluationObservable.add((()=>{P.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.sd.onAfterActiveMeshesEvaluationObservable.add((()=>{P.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.sd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.sd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(a){a!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=a,a?(this._onBeforeRenderTargetsRenderObserver=this.sd.onBeforeRenderTargetsRenderObservable.add((()=>{P.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.sd.onAfterRenderTargetsRenderObservable.add((()=>{P.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.sd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.sd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(a){a!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=a,a?(this._onBeforeParticlesRenderingObserver=this.sd.onBeforeParticlesRenderingObservable.add((()=>{P.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.sd.onAfterParticlesRenderingObservable.add((()=>{P.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.sd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.sd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(a){a!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=a,this.sd.spriteManagers&&(a?(this._onBeforeSpritesRenderingObserver=this.sd.onBeforeSpritesRenderingObservable.add((()=>{P.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.sd.onAfterSpritesRenderingObservable.add((()=>{P.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.sd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.sd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(a){a!==this._capturePhysicsTime&&this.sd.onBeforePhysicsObservable&&(this._capturePhysicsTime=a,a?(this._onBeforePhysicsObserver=this.sd.onBeforePhysicsObservable.add((()=>{P.e.StartPerformanceCounter("kb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.sd.onAfterPhysicsObservable.add((()=>{P.e.EndPerformanceCounter("kb"),this._physicsTime.endMonitoring()}))):(this.sd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.sd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(a){a!==this._captureAnimationsTime&&(this._captureAnimationsTime=a,a?this._onAfterAnimationsObserver=this.sd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.sd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(a){this._captureFrameTime=a}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(a){this._captureInterFrameTime=a}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(a){a!==this._captureRenderTime&&(this._captureRenderTime=a,a?(this._onBeforeDrawPhaseObserver=this.sd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),P.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.sd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),P.e.EndPerformanceCounter("Main render")}))):(this.sd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.sd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(a){a!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=a,a?(this._onBeforeCameraRenderObserver=this.sd.onBeforeCameraRenderObservable.add((a=>{this._cameraRenderTime.beginMonitoring(),P.e.StartPerformanceCounter(`Rendering camera ${a.name}`)})),this._onAfterCameraRenderObserver=this.sd.onAfterCameraRenderObservable.add((a=>{this._cameraRenderTime.endMonitoring(!1),P.e.EndPerformanceCounter(`Rendering camera ${a.name}`)}))):(this.sd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.sd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.sd.getEngine()._drawCalls}constructor(a){this.sd=a,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new b.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new b.c,this._captureFrameTime=!1,this._frameTime=new b.c,this._captureRenderTime=!1,this._renderTime=new b.c,this._captureInterFrameTime=!1,this._interFrameTime=new b.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new b.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new b.c,this._capturePhysicsTime=!1,this._physicsTime=new b.c,this._captureAnimationsTime=!1,this._animationsTime=new b.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new b.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=a.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(P.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.sd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=a.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(P.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.qj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.qj(),this._captureParticlesRenderTime&&this._particlesRenderTime.qj(),this._captureSpritesRenderTime&&this._spritesRenderTime.qj(),this._captureRenderTime&&this._renderTime.qj(),this._captureCameraRenderTime&&this._cameraRenderTime.qj()}))}dispose(){this.sd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.sd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.sd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.sd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.sd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.sd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.sd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.sd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.sd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.sd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.sd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.sd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.sd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.sd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.sd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.sd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.sd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.sd=null}}},12498:(a,v,p)=>{"use strict";p.d(v,{d:()=>F});var P=p(11207),b=p(11210),L=p(11240),t=p(11515),V=p(12456),K=p(12504),C=p(11027);t.b.AddNodeConstructor("Light_Type_1",((a,v)=>()=>new F(a,L.s.Zero(),v)));class F extends K.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(a){this._shadowFrustumSize=a,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(a){this._shadowOrthoScale=a,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(a){this._orthoLeft=a}get orthoRight(){return this._orthoRight}set orthoRight(a){this._orthoRight=a}get orthoTop(){return this._orthoTop}set orthoTop(a){this._orthoTop=a}get orthoBottom(){return this._orthoBottom}set orthoBottom(a){this._orthoBottom=a}constructor(a,v,p){super(a,p),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=v.scale(-1),this.direction=v}getClassName(){return"mb"}getTypeID(){return V.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(a,v,p){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(a):this._setDefaultAutoExtendShadowProjectionMatrix(a,v,p)}_setDefaultFixedFrustumShadowProjectionMatrix(a){const v=this.va().activeCamera;v&&L.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:v.fj,void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,a,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(a,v,p){const P=this.va().activeCamera;if(!P)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const a=L.s.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let P=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let t=0;t<p.length;t++){const V=p[t];if(!V)continue;const K=V.getBoundingInfo().boundingBox;for(let p=0;p<K.vectorsWorld.length;p++)L.s.TransformCoordinatesToRef(K.vectorsWorld[p],v,a),a.x<this._orthoLeft&&(this._orthoLeft=a.x),a.y<this._orthoBottom&&(this._orthoBottom=a.y),a.x>this._orthoRight&&(this._orthoRight=a.x),a.y>this._orthoTop&&(this._orthoTop=a.y),this.autoCalcShadowZBounds&&(a.z<P&&(P=a.z),a.z>b&&(b=a.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=P,this._shadowMaxZ=b)}const b=this._orthoRight-this._orthoLeft,t=this._orthoTop-this._orthoBottom,V=void 0!==this.shadowMinZ?this.shadowMinZ:P.fj,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,C=this.va().getEngine().useReverseDepthBuffer;L.e.OrthoOffCenterLHToRef(this._orthoLeft-b*this.shadowOrthoScale,this._orthoRight+b*this.shadowOrthoScale,this._orthoBottom-t*this.shadowOrthoScale,this._orthoTop+t*this.shadowOrthoScale,C?K:V,C?V:K,a,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,v){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,v),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,v),this)}transferToNodeMaterialEffect(a,v){return this.computeTransformedInformation()?(a.setFloat3(v,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(a.setFloat3(v,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(a){const v=this._scene.getEngine();return!v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}getDepthMaxZ(a){const v=this._scene.getEngine();return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:1}prepareLightSpecificDefines(a,v){a["DIRLIGHT"+v]=!0}}(0,P.e)([(0,b.O)()],F.prototype,"shadowFrustumSize",null),(0,P.e)([(0,b.O)()],F.prototype,"shadowOrthoScale",null),(0,P.e)([(0,b.O)()],F.prototype,"autoUpdateExtends",void 0),(0,P.e)([(0,b.O)()],F.prototype,"autoCalcShadowZBounds",void 0),(0,P.e)([(0,b.O)("orthoLeft")],F.prototype,"_orthoLeft",void 0),(0,P.e)([(0,b.O)("orthoRight")],F.prototype,"_orthoRight",void 0),(0,P.e)([(0,b.O)("orthoTop")],F.prototype,"_orthoTop",void 0),(0,P.e)([(0,b.O)("orthoBottom")],F.prototype,"_orthoBottom",void 0),(0,C.f)("BABYLON.DirectionalLight",F)},12850:(a,v,p)=>{"use strict";p.d(v,{e:()=>F});var P=p(11207),b=p(11210),L=p(11240),t=p(11279),V=p(11515),K=p(12456),C=p(11027);V.b.AddNodeConstructor("Light_Type_3",((a,v)=>()=>new F(a,L.s.Zero(),v)));class F extends K.b{constructor(a,v,p){super(a,p),this.groundColor=new t.d(0,0,0),this.direction=v||L.s.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"nb"}setDirectionToTarget(a){return this.direction=L.s.Normalize(a.od(L.s.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(a,v){const p=L.s.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",p.x,p.y,p.z,0,v),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.jj),v),this}transferToNodeMaterialEffect(a,v){const p=L.s.Normalize(this.direction);return a.setFloat3(v,p.x,p.y,p.z),this}Zj(){return this._worldMatrix||(this._worldMatrix=L.e.Identity()),this._worldMatrix}getTypeID(){return K.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(a,v){a["HEMILIGHT"+v]=!0}}(0,P.e)([(0,b.l)()],F.prototype,"groundColor",void 0),(0,P.e)([(0,b.M)()],F.prototype,"direction",void 0),(0,C.f)("BABYLON.HemisphericLight",F)},12456:(a,v,p)=>{"use strict";p.d(v,{b:()=>c});var P=p(11207),b=p(11210),L=p(11240),t=p(11279),V=p(11515),K=p(11301),C=p(11027),F=p(11374),u=p(11287);class c extends V.b{get range(){return this._range}set range(a){this._range=a,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(a){this._intensityMode=a,this._computePhotometricScale()}get radius(){return this._radius}set radius(a){this._radius=a,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(a){this._shadowEnabled!==a&&(this._shadowEnabled=a,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(a){this._includedOnlyMeshes=a,this._hookArrayForIncludedOnly(a)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(a){this._excludedMeshes=a,this._hookArrayForExcluded(a)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(a){this._excludeWithLayerMask=a,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(a){this._includeOnlyWithLayerMask=a,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(a){this._lightmapMode!==a&&(this._lightmapMode=a,this._markMeshesAsLightDirty())}getViewMatrix(a){return null}getProjectionMatrix(a,v){return null}constructor(a,v){super(a,v,!1),this.Fh=new t.d(1,1,1),this.Gh=new t.d(1,1,1),this.falloffType=c.FALLOFF_DEFAULT,this.jj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=c.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new K.b(this.va().getEngine(),void 0,void 0,a),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(a,v){return this}_bindLight(a,v,p,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const L=a.toString();let V=!1;if(this._uniformBuffer.bindToEffect(p,"Light"+L),this._renderId!==v.getRenderId()||this._lastUseSpecular!==P||!this._uniformBuffer.useUbo){this._renderId=v.getRenderId(),this._lastUseSpecular=P;const a=this.getScaledIntensity();this.transferToEffect(p,L),this.Fh.scaleToRef(a,t.h.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",t.h.gb[0],this.range,L),P&&(this.Gh.scaleToRef(a,t.h.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",t.h.gb[1],this.radius,L)),V=!0}if(this.transferTexturesToEffect(p,L),v.shadowsEnabled&&this.shadowEnabled&&b){const a=this.getShadowGenerator(v.activeCamera)??this.getShadowGenerator();a&&(a.bindShadowLight(L,p),V=!0)}V?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(a){let v="Name: "+this.name;if(v+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let p=0;p<this.animations.length;p++)v+=", animation[0]: "+this.animations[p].toString(a);return v}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Mb(a){super.Mb(a),this._resyncMeshes()}getShadowGenerator(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(a)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return L.s.Zero()}canAffectMesh(a){return!a||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(a))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(a))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&a.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&a.layerMask)))}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const a=this._shadowGenerators.values();for(let v=a.next();!0!==v.done;v=a.next()){v.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const a=this._parentContainer.lights.indexOf(this);a>-1&&this._parentContainer.lights.splice(a,1),this._parentContainer=null}for(const p of this.va().meshes)p._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(a,v)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.jj}clone(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=c.GetConstructorFromName(this.getTypeID(),a,this.va());if(!p)return null;const P=u.b.Clone(p,this);return a&&(P.name=a),v&&(P.parent=v),P.Mb(this.isEnabled()),this.onClonedObservable.notifyObservers(P),P}serialize(){const a=u.b.Serialize(this);return a.uniqueId=this.uniqueId,a.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(a),this.excludedMeshes.length>0&&(a.excludedMeshesIds=[],this.excludedMeshes.forEach((v=>{a.excludedMeshesIds.push(v.id)}))),this.includedOnlyMeshes.length>0&&(a.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((v=>{a.includedOnlyMeshesIds.push(v.id)}))),u.b.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a.isEnabled=this.isEnabled(),a}static GetConstructorFromName(a,v,p){const P=V.b.Construct("Light_Type_"+a,v,p);return P||null}static Parse(a,v){const p=c.GetConstructorFromName(a.type,a.name,v);if(!p)return null;const P=u.b.Parse(p,a,v);if(a.excludedMeshesIds&&(P._excludedMeshesIds=a.excludedMeshesIds),a.includedOnlyMeshesIds&&(P._includedOnlyMeshesIds=a.includedOnlyMeshesIds),void 0!==a.parentId&&(P._waitingParentId=a.parentId),void 0!==a.parentInstanceIndex&&(P._waitingParentInstanceIndex=a.parentInstanceIndex),void 0!==a.falloffType&&(P.falloffType=a.falloffType),void 0!==a.lightmapMode&&(P.lightmapMode=a.lightmapMode),a.animations){for(let v=0;v<a.animations.length;v++){const p=a.animations[v],b=(0,C.c)("BABYLON.Animation");b&&P.animations.push(b.Parse(p))}V.b.ParseAnimationRanges(P,a,v)}return a.autoAnimate&&v.beginAnimation(P,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.isEnabled&&P.Mb(a.isEnabled),P}_hookArrayForExcluded(a){var v=this;const p=a.push;a.push=function(){for(var P=arguments.length,b=new Array(P),L=0;L<P;L++)b[L]=arguments[L];const t=p.apply(a,b);for(const a of b)a._resyncLightSource(v);return t};const P=a.splice;a.splice=(v,p)=>{const b=P.apply(a,[v,p]);for(const a of b)a._resyncLightSource(this);return b};for(const b of a)b._resyncLightSource(this)}_hookArrayForIncludedOnly(a){var v=this;const p=a.push;a.push=function(){for(var P=arguments.length,b=new Array(P),L=0;L<P;L++)b[L]=arguments[L];const t=p.apply(a,b);return v._resyncMeshes(),t};const P=a.splice;a.splice=(v,p)=>{const b=P.apply(a,[v,p]);return this._resyncMeshes(),b},this._resyncMeshes()}_resyncMeshes(){for(const a of this.va().meshes)a._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const a of this.va().meshes)-1!==a.lightSources.indexOf(this)&&a._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let a=0;const v=this.getTypeID();let p=this.intensityMode;switch(p===c.INTENSITYMODE_AUTOMATIC&&(p=v===c.LIGHTTYPEID_DIRECTIONALLIGHT?c.INTENSITYMODE_ILLUMINANCE:c.INTENSITYMODE_LUMINOUSINTENSITY),v){case c.LIGHTTYPEID_POINTLIGHT:case c.LIGHTTYPEID_SPOTLIGHT:switch(p){case c.INTENSITYMODE_LUMINOUSPOWER:a=1/(4*Math.PI);break;case c.INTENSITYMODE_LUMINOUSINTENSITY:a=1;break;case c.INTENSITYMODE_LUMINANCE:a=this.radius*this.radius}break;case c.LIGHTTYPEID_DIRECTIONALLIGHT:switch(p){case c.INTENSITYMODE_ILLUMINANCE:a=1;break;case c.INTENSITYMODE_LUMINANCE:{let v=this.radius;v=Math.max(v,.001);a=2*Math.PI*(1-Math.cos(v));break}}break;case c.LIGHTTYPEID_HEMISPHERICLIGHT:a=1}return a}_reorderLightsInScene(){const a=this.va();0!=this._renderPriority&&(a.requireLightSorting=!0),this.va().sortLightsByPriority()}}c.FALLOFF_DEFAULT=F.e.FALLOFF_DEFAULT,c.FALLOFF_PHYSICAL=F.e.FALLOFF_PHYSICAL,c.FALLOFF_GLTF=F.e.FALLOFF_GLTF,c.FALLOFF_STANDARD=F.e.FALLOFF_STANDARD,c.LIGHTMAP_DEFAULT=F.e.LIGHTMAP_DEFAULT,c.LIGHTMAP_SPECULAR=F.e.LIGHTMAP_SPECULAR,c.LIGHTMAP_SHADOWSONLY=F.e.LIGHTMAP_SHADOWSONLY,c.INTENSITYMODE_AUTOMATIC=F.e.INTENSITYMODE_AUTOMATIC,c.INTENSITYMODE_LUMINOUSPOWER=F.e.INTENSITYMODE_LUMINOUSPOWER,c.INTENSITYMODE_LUMINOUSINTENSITY=F.e.INTENSITYMODE_LUMINOUSINTENSITY,c.INTENSITYMODE_ILLUMINANCE=F.e.INTENSITYMODE_ILLUMINANCE,c.INTENSITYMODE_LUMINANCE=F.e.INTENSITYMODE_LUMINANCE,c.LIGHTTYPEID_POINTLIGHT=F.e.LIGHTTYPEID_POINTLIGHT,c.LIGHTTYPEID_DIRECTIONALLIGHT=F.e.LIGHTTYPEID_DIRECTIONALLIGHT,c.LIGHTTYPEID_SPOTLIGHT=F.e.LIGHTTYPEID_SPOTLIGHT,c.LIGHTTYPEID_HEMISPHERICLIGHT=F.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,P.e)([(0,b.l)()],c.prototype,"diffuse",void 0),(0,P.e)([(0,b.l)()],c.prototype,"specular",void 0),(0,P.e)([(0,b.O)()],c.prototype,"falloffType",void 0),(0,P.e)([(0,b.O)()],c.prototype,"intensity",void 0),(0,P.e)([(0,b.O)()],c.prototype,"range",null),(0,P.e)([(0,b.O)()],c.prototype,"intensityMode",null),(0,P.e)([(0,b.O)()],c.prototype,"radius",null),(0,P.e)([(0,b.O)()],c.prototype,"_renderPriority",void 0),(0,P.e)([(0,b.e)("_reorderLightsInScene")],c.prototype,"renderPriority",void 0),(0,P.e)([(0,b.O)("shadowEnabled")],c.prototype,"_shadowEnabled",void 0),(0,P.e)([(0,b.O)("excludeWithLayerMask")],c.prototype,"_excludeWithLayerMask",void 0),(0,P.e)([(0,b.O)("includeOnlyWithLayerMask")],c.prototype,"_includeOnlyWithLayerMask",void 0),(0,P.e)([(0,b.O)("lightmapMode")],c.prototype,"_lightmapMode",void 0)},11374:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{static CompareLightsPriority(a,v){return a.shadowEnabled!==v.shadowEnabled?(v.shadowEnabled?1:0)-(a.shadowEnabled?1:0):v.renderPriority-a.renderPriority}}P.FALLOFF_DEFAULT=0,P.FALLOFF_PHYSICAL=1,P.FALLOFF_GLTF=2,P.FALLOFF_STANDARD=3,P.LIGHTMAP_DEFAULT=0,P.LIGHTMAP_SPECULAR=1,P.LIGHTMAP_SHADOWSONLY=2,P.INTENSITYMODE_AUTOMATIC=0,P.INTENSITYMODE_LUMINOUSPOWER=1,P.INTENSITYMODE_LUMINOUSINTENSITY=2,P.INTENSITYMODE_ILLUMINANCE=3,P.INTENSITYMODE_LUMINANCE=4,P.LIGHTTYPEID_POINTLIGHT=0,P.LIGHTTYPEID_DIRECTIONALLIGHT=1,P.LIGHTTYPEID_SPOTLIGHT=2,P.LIGHTTYPEID_HEMISPHERICLIGHT=3},12504:(a,v,p)=>{"use strict";p.d(v,{e:()=>K});var P=p(11207),b=p(11210),L=p(11240),t=p(12456),V=p(11549);class K extends t.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=L.e.Identity(),this._projectionMatrix=L.e.Identity()}_setPosition(a){this._position=a}get position(){return this._position}set position(a){this._setPosition(a)}_setDirection(a){this._direction=a}get direction(){return this._direction}set direction(a){this._setDirection(a)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(a){this._shadowMinZ=a,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(a){this._shadowMaxZ=a,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=L.s.Zero()),L.s.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=L.s.Zero()),L.s.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(a){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(a){return this.direction=L.s.Normalize(a.od(this.position)),this.direction}getRotation(){this.direction.normalize();const a=L.s.Cross(this.direction,V.b.Y),v=L.s.Cross(a,this.direction);return L.s.RotationFromAxis(a,v,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=L.s.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Zj(a){return!a&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=L.e.Identity()),L.e.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(a){return void 0!==this.shadowMinZ?this.shadowMinZ:a.fj}getDepthMaxZ(a){return void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ}setShadowProjectionMatrix(a,v,p){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(v,p,a):this._setDefaultShadowProjectionMatrix(a,v,p),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(a){const v=L.k.fb[0];let p=this.position;this.computeTransformedInformation()&&(p=this.transformedPosition),L.s.NormalizeToRef(this.getShadowDirection(a),v),1===Math.abs(L.s.Dot(v,L.s.Up()))&&(v.z=1e-13);const P=L.k.fb[1];return p.addToRef(v,P),L.e.LookAtLHToRef(p,P,L.s.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(a,v){return this.setShadowProjectionMatrix(this._projectionMatrix,a??this._viewMatrix,v??[]),this._projectionMatrix}}(0,P.e)([(0,b.M)()],K.prototype,"position",null),(0,P.e)([(0,b.M)()],K.prototype,"direction",null),(0,P.e)([(0,b.O)()],K.prototype,"shadowMinZ",null),(0,P.e)([(0,b.O)()],K.prototype,"shadowMaxZ",null)},11837:(a,v,p)=>{"use strict";p.d(v,{c:()=>t,d:()=>L,g:()=>V});const P={},b={};function L(a,v){P[a]=v}function t(a,v){b[a]=v}function V(a){return b[a]?b[a]:null}},11607:(a,v,p)=>{"use strict";p.d(v,{d:()=>B,h:()=>y});var P,b=p(10889),L=p(10893),t=p(11229),V=p(10939),K=p(10905),C=p(11536),F=p(10947),u=p(10955),c=p(11032),f=p(10974);!function(a){a[a.Clean=0]="Clean",a[a.Stop=1]="Stop",a[a.Sync=2]="Sync",a[a.NoSync=3]="NoSync"}(P||(P={}));const H=new L.c,A={};let h=!1;function R(){return A[".babylon"]}function X(a){const v=A[a];return v||(K.d.Warn("Unable to find a plugin to load "+a+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),R())}function Q(a,v,p){let P="Unable to load from "+(a.rawData?"binary data":a.url);return v?P+=`: ${v}`:p&&(P+=`: ${p}`),P}function s(a,v,p,P,b,L,t,V,K){var C;const u="data:"===(c=a.url).substring(0,5)?c.substring(5):null;var c;if(a.rawData&&!t)throw"When using ArrayBufferView to load data the file extension must be provided.";const h=t?X(t):u?function(a){for(const v in A){const p=A[v].plugin;if(p.canDirectLoad&&p.canDirectLoad(a))return A[v]}return R()}(a.url):function(a){const v=a.indexOf("?");-1!==v&&(a=a.substring(0,v));const p=a.lastIndexOf(".");return X(a.substring(p,a.length).toLowerCase())}(a.url);if(!h)throw new Error(`No plugin or fallback for ${t??a.url}`);if(!1===(null===K||void 0===K||null===(C=K[h.plugin.name])||void 0===C?void 0:C.enabled))throw new Error(`The '${h.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(a.rawData&&!h.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(a=>{if(h.plugin.createPlugin){const v=h.plugin.createPlugin(K??{});return v instanceof Promise?(v.then(a).catch((a=>{b("Error instantiating plugin.",a)})),null):(a(v),v)}return a(h.plugin),h.plugin})((K=>{var C;if(!K)throw`The loader plugin corresponding to the '${t}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(H.notifyObservers(K),u&&(K.canDirectLoad&&K.canDirectLoad(a.url)||!(0,F.k)(a.url))){if(K.directLoad){const a=K.directLoad(v,u);a instanceof Promise?a.then((a=>{p(K,a)})).catch((a=>{b("Error in directLoad of _loadData: "+a,a)})):p(K,a)}else p(K,u);return}const c=h.isBinary,A=(a,P)=>{v.u?b("Scene has been disposed"):p(K,a,P)};let R=null,X=!1;null===(C=K.uj)||void 0===C||C.add((()=>{X=!0,R&&(R.abort(),R=null),L()}));const Q=()=>{if(X)return;const p=(a,v)=>{b(null===a||void 0===a?void 0:a.statusText,v)};if(!K.loadFile&&a.rawData)throw"Plugin does not support loading ArrayBufferView.";R=K.loadFile?K.loadFile(v,a.rawData||a.file||a.url,a.rootUrl,A,P,c,p,V):v._loadFile(a.file||a.url,A,P,!0,c,p)},s=v.getEngine();let D=s.enableOfflineSupport;if(D){let p=!1;for(const P of v.disableOfflineSupportExceptionRules)if(P.test(a.url)){p=!0;break}D=!p}D&&f.e.OfflineProviderFactory?v.offlineProvider=f.e.OfflineProviderFactory(a.url,Q,s.disableManifestCheck):Q()}))}function D(a,v){let p,P,L=null,t=null;if(v)if(v.name)p=`file:${v.name}`,P=v.name,L=v;else if(ArrayBuffer.isView(v))p="",P=(0,c.b)(),t=v;else if(v.startsWith("data:"))p=v,P="";else if(a){const L=v;if("/"===L.substring(0,1))return b.e.Error("Wrong sceneFilename parameter"),null;p=a+L,P=L}else p=v,P=b.e.GetFilename(v),a=b.e.GetFolderPath(v);else p=a,P=b.e.GetFilename(a),a=b.e.GetFolderPath(a);return{url:p,rootUrl:a,name:P,file:L,rawData:t}}function y(a){if("string"===typeof a.extensions){const v=a.extensions;A[v.toLowerCase()]={plugin:a,isBinary:!1}}else{const v=a.extensions;Object.keys(v).forEach((p=>{A[p.toLowerCase()]={plugin:a,isBinary:v[p].isBinary}}))}}function Z(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.b.LastCreatedScene,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!P)return K.d.Error("No scene available to import mesh to"),null;const f=D(v,p);if(!f)return null;const H={};P.addPendingData(H);const A=()=>{P.removePendingData(H)},h=(a,v)=>{const p=Q(f,a,v);t?t(P,p,new u.g(p,u.e.SceneLoaderError,v)):K.d.Error(p),A()},R=L?a=>{try{L(a)}catch(v){h("Error in onProgress callback: "+v,v)}}:void 0,X=(a,v,p,L,t,V,K,C)=>{if(P.importedMeshesFiles.push(f.url),b)try{b(a,v,p,L,t,V,K,C)}catch(F){h("Error in onSuccess callback: "+F,F)}P.removePendingData(H)};return s(f,P,((v,p,b)=>{if(v.rewriteRootURL&&(f.rootUrl=v.rewriteRootURL(f.rootUrl,b)),v.importMesh){const b=[],L=[],t=[];if(!v.importMesh(a,P,p,f.rootUrl,b,L,t,h))return;P.loadingPluginName=v.name,X(b,L,t,[],[],[],[],[])}else{v.importMeshAsync(a,P,p,f.rootUrl,R,f.name).then((a=>{P.loadingPluginName=v.name,X(a.meshes,a.Bj,a.skeletons,a.animationGroups,a.transformNodes,a.geometries,a.lights,a.spriteManagers)})).catch((a=>{h(a.message,a)}))}}),R,h,A,C,F,c)}function M(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedEngine,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return p?n(a,v,new t.c(p),P,L,K,C,F,u):(b.e.Error("No engine available"),null)}function S(a,v,p,P,b,L,t){return new Promise(((V,K)=>{M(a,v,p,(a=>{V(a)}),P,((a,v,p)=>{K(p||new Error(v))}),b,L,t)}))}function n(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!p)return K.d.Error("No scene available to append to"),null;const f=D(a,v);if(!f)return null;const H={};p.addPendingData(H);const A=()=>{p.removePendingData(H)};C.b.ShowLoadingScreen&&!h&&(h=!0,p.getEngine().displayLoadingUI(),p.executeWhenReady((()=>{p.getEngine().hideLoadingUI(),h=!1})));const R=(a,v)=>{const P=Q(f,a,v);L?L(p,P,new u.g(P,u.e.SceneLoaderError,v)):K.d.Error(P),A()},X=b?a=>{try{b(a)}catch(v){R("Error in onProgress callback",v)}}:void 0,y=()=>{if(P)try{P(p)}catch(a){R("Error in onSuccess callback",a)}p.removePendingData(H)};return s(f,p,((a,v)=>{if(a.load){if(!a.load(p,v,f.rootUrl,R))return;p.loadingPluginName=a.name,y()}else{a.loadAsync(p,v,f.rootUrl,X,f.name).then((()=>{p.loadingPluginName=a.name,y()})).catch((a=>{R(a.message,a)}))}}),X,R,A,t,F,c)}function q(a,v,p,P,b,L,t){return new Promise(((V,K)=>{n(a,v,p,(a=>{V(a)}),P,((a,v,p)=>{K(p||new Error(v))}),b,L,t)}))}function T(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!p)return K.d.Error("No scene available to load asset container to"),null;const c=D(a,v);if(!c)return null;const f={};p.addPendingData(f);const H=()=>{p.removePendingData(f)},A=(a,v)=>{const P=Q(c,a,v);L?L(p,P,new u.g(P,u.e.SceneLoaderError,v)):K.d.Error(P),H()},h=b?a=>{try{b(a)}catch(v){A("Error in onProgress callback",v)}}:void 0,R=a=>{if(P)try{P(a)}catch(v){A("Error in onSuccess callback",v)}p.removePendingData(f)};return s(c,p,((a,v)=>{if(a.loadAssetContainer){const P=a.loadAssetContainer(p,v,c.rootUrl,A);if(!P)return;P.populateRootNodes(),p.loadingPluginName=a.name,R(P)}else if(a.loadAssetContainerAsync){a.loadAssetContainerAsync(p,v,c.rootUrl,h,c.name).then((v=>{v.populateRootNodes(),p.loadingPluginName=a.name,R(v)})).catch((a=>{A(a.message,a)}))}else A("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),h,A,H,t,C,F)}function j(a,v,p,P,b,L,t){return new Promise(((V,K)=>{T(a,v,p,(a=>{V(a)}),P,((a,v,p)=>{K(p||new Error(v))}),b,L,t)}))}function w(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.b.LastCreatedScene,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!p)return void K.d.Error("No scene available to load animations to");if(P){for(const a of p.animatables)a.reset();p.stopAllAnimations(),p.animationGroups.slice().forEach((a=>{a.dispose()}));p.getNodes().forEach((a=>{a.animations&&(a.animations=[])}))}else switch(b){case 0:p.animationGroups.slice().forEach((a=>{a.dispose()}));break;case 1:p.animationGroups.forEach((a=>{a.stop()}));break;case 2:p.animationGroups.forEach((a=>{a.reset(),a.restart()}));break;case 3:break;default:return void K.d.Error("Unknown animation group loading mode value '"+b+"'")}const H=p.animatables.length;T(a,v,p,(a=>{a.mergeAnimationsTo(p,p.animatables.slice(H),L),a.dispose(),p.onAnimationFileImportedObservable.notifyObservers(p),t&&t(p)}),C,F,u,c,f)}function J(a,v,p,P,b,L,t,V,K,C){return new Promise(((F,u)=>{w(a,v,p,P,b,L,(a=>{F(a)}),t,((a,v,p)=>{u(p||new Error(v))}),V,K,C)}))}class B{static get ForceFullSceneLoadingForIncremental(){return C.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(a){C.b.ForceFullSceneLoadingForIncremental=a}static get ShowLoadingScreen(){return C.b.ShowLoadingScreen}static set ShowLoadingScreen(a){C.b.ShowLoadingScreen=a}static get loggingLevel(){return C.b.loggingLevel}static set loggingLevel(a){C.b.loggingLevel=a}static get CleanBoneMatrixWeights(){return C.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(a){C.b.CleanBoneMatrixWeights=a}static GetDefaultPlugin(){return R()}static GetPluginForExtension(a){var v;return null===(v=X(a))||void 0===v?void 0:v.plugin}static IsPluginForExtensionAvailable(a){return function(a){return!!A[a]}(a)}static RegisterPlugin(a){y(a)}static ImportMesh(a,v,p,P,b,L,t,V,K){return Z(a,v,p,P,b,L,t,V,K)}static ImportMeshAsync(a,v,p,P,b,L,t){return function(a,v,p,P,b,L,t,V){return new Promise(((K,C)=>{Z(a,v,p,P,((a,v,p,P,b,L,t,V)=>{K({meshes:a,Bj:v,skeletons:p,animationGroups:P,transformNodes:b,geometries:L,lights:t,spriteManagers:V})}),b,((a,v,p)=>{C(p||new Error(v))}),L,t,V)}))}(a,v,p,P,b,L,t)}static Load(a,v,p,P,b,L,t,V){return M(a,v,p,P,b,L,t,V)}static LoadAsync(a,v,p,P,b,L){return S(a,v,p,P,b,L)}static Append(a,v,p,P,b,L,t,V){return n(a,v,p,P,b,L,t,V)}static AppendAsync(a,v,p,P,b,L){return q(a,v,p,P,b,L)}static LoadAssetContainer(a,v,p,P,b,L,t,V){return T(a,v,p,P,b,L,t,V)}static LoadAssetContainerAsync(a,v,p,P,b,L){return j(a,v,p,P,b,L)}static ImportAnimations(a,v,p,P,b,L,t,V,K,C,F){w(a,v,p,P,b,L,t,V,K,C,F)}static ImportAnimationsAsync(a,v,p,P,b,L,t,V,K,C,F){return J(a,v,p,P,b,L,V,C,F)}}B.NO_LOGGING=0,B.MINIMAL_LOGGING=1,B.SUMMARY_LOGGING=2,B.DETAILED_LOGGING=3,B.OnPluginActivatedObservable=H},11536:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{static get ForceFullSceneLoadingForIncremental(){return P._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(a){P._ForceFullSceneLoadingForIncremental=a}static get ShowLoadingScreen(){return P._ShowLoadingScreen}static set ShowLoadingScreen(a){P._ShowLoadingScreen=a}static get loggingLevel(){return P._LoggingLevel}static set loggingLevel(a){P._LoggingLevel=a}static get CleanBoneMatrixWeights(){return P._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(a){P._CleanBoneMatrixWeights=a}}P._ForceFullSceneLoadingForIncremental=!1,P._ShowLoadingScreen=!0,P._CleanBoneMatrixWeights=!1,P._LoggingLevel=0},12434:(a,v,p)=>{"use strict";p.d(v,{c:()=>l});var P=p(11207),b=p(11210),L=p(10905),t=p(11223),V=p(12421),K=p(11229),C=p(11240),F=p(11306),u=p(11454),c=p(11491);class f extends u.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class H extends c.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"PBRBRDF",90,new f,v),this._useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=a._dirtyCallbacks[16],this._enable(!0)}prepareDefines(a){a.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,a.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,a.SPHERICAL_HARMONICS=this._useSphericalHarmonics,a.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}H.DEFAULT_USE_ENERGY_CONSERVATION=!0,H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,H.DEFAULT_USE_SPHERICAL_HARMONICS=!0,H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useEnergyConservation",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSphericalHarmonics",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var A=p(11381),h=p(11279),R=p(11271),X=p(11390),Q=p(11456),s=p(11460),D=p(11476),y=(p(12437),p(11481)),Z=p(11440);class M extends u.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class S extends c.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"PBRClearCoat",100,new M,v),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.roughness=0,this._indexOfRefraction=S._DefaultIndexOfRefraction,this.indexOfRefraction=S._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=h.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1]}isReadyForSubMesh(a,v,p){if(!this._isEnabled)return!0;const P=this._material._disableBumpMap;if(a._areTexturesDirty&&v.texturesEnabled){if(this._texture&&D.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&D.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(p.getCaps().standardDerivatives&&this._bumpTexture&&D.e.ClearCoatBumpTextureEnabled&&!P&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&D.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(a,v){this._isEnabled?(a.CLEARCOAT=!0,a.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,a.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,a._areTexturesDirty&&v.texturesEnabled&&(this._texture&&D.e.ClearCoatTextureEnabled?(0,Z.S)(this._texture,a,"CLEARCOAT_TEXTURE"):a.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&D.e.ClearCoatTextureEnabled?(0,Z.S)(this._textureRoughness,a,"CLEARCOAT_TEXTURE_ROUGHNESS"):a.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&D.e.ClearCoatBumpTextureEnabled?(0,Z.S)(this._bumpTexture,a,"CLEARCOAT_BUMP"):a.CLEARCOAT_BUMP=!1,a.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===S._DefaultIndexOfRefraction,this._isTintEnabled?(a.CLEARCOAT_TINT=!0,this._tintTexture&&D.e.ClearCoatTintTextureEnabled?((0,Z.S)(this._tintTexture,a,"CLEARCOAT_TINT_TEXTURE"),a.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):a.CLEARCOAT_TINT_TEXTURE=!1):(a.CLEARCOAT_TINT=!1,a.CLEARCOAT_TINT_TEXTURE=!1))):(a.CLEARCOAT=!1,a.CLEARCOAT_TEXTURE=!1,a.CLEARCOAT_TEXTURE_ROUGHNESS=!1,a.CLEARCOAT_BUMP=!1,a.CLEARCOAT_TINT=!1,a.CLEARCOAT_TINT_TEXTURE=!1,a.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,a.CLEARCOAT_DEFAULTIOR=!1,a.CLEARCOAT_TEXTUREDIRECTUV=0,a.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,a.CLEARCOAT_BUMPDIRECTUV=0,a.CLEARCOAT_REMAP_F0=!1,a.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,a.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(a,v,p,P){if(!this._isEnabled)return;const b=P.materialDefines,L=this._material.isFrozen,t=this._material._disableBumpMap,V=this._material._invertNormalMapX,K=this._material._invertNormalMapY;if(!a.useUbo||!L||!a.isSync){var C,F,u,c;if((this._texture||this._textureRoughness)&&D.e.ClearCoatTextureEnabled)a.updateFloat4("vClearCoatInfos",(null===(C=this._texture)||void 0===C?void 0:C.coordinatesIndex)??0,(null===(F=this._texture)||void 0===F?void 0:F.level)??0,(null===(u=this._textureRoughness)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(c=this._textureRoughness)||void 0===c?void 0:c.level)??0),this._texture&&(0,Z.s)(this._texture,a,"clearCoat"),this._textureRoughness&&!b.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,Z.s)(this._textureRoughness,a,"clearCoatRoughness");this._bumpTexture&&p.getCaps().standardDerivatives&&D.e.ClearCoatTextureEnabled&&!t&&(a.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,Z.s)(this._bumpTexture,a,"clearCoatBump"),v._mirroredCameraPosition?a.updateFloat2("vClearCoatTangentSpaceParams",V?1:-1,K?1:-1):a.updateFloat2("vClearCoatTangentSpaceParams",V?-1:1,K?-1:1)),this._tintTexture&&D.e.ClearCoatTintTextureEnabled&&(a.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,Z.s)(this._tintTexture,a,"clearCoatTint")),a.updateFloat2("vClearCoatParams",this.jj,this.roughness);const P=1-this._indexOfRefraction,L=1+this._indexOfRefraction,f=Math.pow(-P/L,2),H=1/this._indexOfRefraction;a.updateFloat4("vClearCoatRefractionParams",f,H,P,L),this._isTintEnabled&&(a.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),a.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}v.texturesEnabled&&(this._texture&&D.e.ClearCoatTextureEnabled&&a.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!b.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&D.e.ClearCoatTextureEnabled&&a.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&p.getCaps().standardDerivatives&&D.e.ClearCoatBumpTextureEnabled&&!t&&a.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&D.e.ClearCoatTintTextureEnabled&&a.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(a){return this._texture===a||(this._textureRoughness===a||(this._bumpTexture===a||this._tintTexture===a))}getActiveTextures(a){this._texture&&a.push(this._texture),this._textureRoughness&&a.push(this._textureRoughness),this._bumpTexture&&a.push(this._bumpTexture),this._tintTexture&&a.push(this._tintTexture)}getAnimatables(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&a.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&a.push(this._tintTexture)}dispose(a){var v,p,P,b;a&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(p=this._textureRoughness)||void 0===p||p.dispose(),null===(P=this._bumpTexture)||void 0===P||P.dispose(),null===(b=this._tintTexture)||void 0===b||b.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(a,v,p){return a.CLEARCOAT_BUMP&&v.addFallback(p++,"CLEARCOAT_BUMP"),a.CLEARCOAT_TINT&&v.addFallback(p++,"CLEARCOAT_TINT"),a.CLEARCOAT&&v.addFallback(p++,"CLEARCOAT"),p}getSamplers(a){a.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}S._DefaultIndexOfRefraction=1.5,(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isEnabled",void 0),(0,P.e)([(0,b.O)()],S.prototype,"intensity",void 0),(0,P.e)([(0,b.O)()],S.prototype,"roughness",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"indexOfRefraction",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"texture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMainTexture",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"textureRoughness",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"remapF0OnInterfaceChange",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isTintEnabled",void 0),(0,P.e)([(0,b.l)()],S.prototype,"tintColor",void 0),(0,P.e)([(0,b.O)()],S.prototype,"tintColorAtDistance",void 0),(0,P.e)([(0,b.O)()],S.prototype,"tintThickness",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"tintTexture",void 0);class n extends u.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class q extends c.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"PBRIridescence",110,new n,v),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.minimumThickness=q._DefaultMinimumThickness,this.maximumThickness=q._DefaultMaximumThickness,this.indexOfRefraction=q._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1]}isReadyForSubMesh(a,v){if(!this._isEnabled)return!0;if(a._areTexturesDirty&&v.texturesEnabled){if(this._texture&&D.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&D.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(a,v){this._isEnabled?(a.IRIDESCENCE=!0,a._areTexturesDirty&&v.texturesEnabled&&(this._texture&&D.e.IridescenceTextureEnabled?(0,Z.S)(this._texture,a,"IRIDESCENCE_TEXTURE"):a.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&D.e.IridescenceTextureEnabled?(0,Z.S)(this._thicknessTexture,a,"IRIDESCENCE_THICKNESS_TEXTURE"):a.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(a.IRIDESCENCE=!1,a.IRIDESCENCE_TEXTURE=!1,a.IRIDESCENCE_THICKNESS_TEXTURE=!1,a.IRIDESCENCE_TEXTUREDIRECTUV=0,a.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(a,v){if(!this._isEnabled)return;const p=this._material.isFrozen;if(!a.useUbo||!p||!a.isSync){var P,b,L,t;if((this._texture||this._thicknessTexture)&&D.e.IridescenceTextureEnabled)a.updateFloat4("vIridescenceInfos",(null===(P=this._texture)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(b=this._texture)||void 0===b?void 0:b.level)??0,(null===(L=this._thicknessTexture)||void 0===L?void 0:L.coordinatesIndex)??0,(null===(t=this._thicknessTexture)||void 0===t?void 0:t.level)??0),this._texture&&(0,Z.s)(this._texture,a,"iridescence"),this._thicknessTexture&&(0,Z.s)(this._thicknessTexture,a,"iridescenceThickness");a.updateFloat4("vIridescenceParams",this.jj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}v.texturesEnabled&&(this._texture&&D.e.IridescenceTextureEnabled&&a.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&D.e.IridescenceTextureEnabled&&a.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(a){return this._texture===a||this._thicknessTexture===a}getActiveTextures(a){this._texture&&a.push(this._texture),this._thicknessTexture&&a.push(this._thicknessTexture)}getAnimatables(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&a.push(this._thicknessTexture)}dispose(a){var v,p;a&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(p=this._thicknessTexture)||void 0===p||p.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(a,v,p){return a.IRIDESCENCE&&v.addFallback(p++,"IRIDESCENCE"),p}getSamplers(a){a.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}q._DefaultMinimumThickness=100,q._DefaultMaximumThickness=400,q._DefaultIndexOfRefraction=1.3,(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isEnabled",void 0),(0,P.e)([(0,b.O)()],q.prototype,"intensity",void 0),(0,P.e)([(0,b.O)()],q.prototype,"minimumThickness",void 0),(0,P.e)([(0,b.O)()],q.prototype,"maximumThickness",void 0),(0,P.e)([(0,b.O)()],q.prototype,"indexOfRefraction",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"texture",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"thicknessTexture",void 0);class T extends u.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class j extends c.b{set angle(a){this.direction.x=Math.cos(a),this.direction.y=Math.sin(a)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"PBRAnisotropic",110,new T,v),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.direction=new C.o(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=a._dirtyCallbacks[16]}isReadyForSubMesh(a,v){return!this._isEnabled||!(a._areTexturesDirty&&v.texturesEnabled&&this._texture&&D.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(a,v,p){this._isEnabled?(a.ANISOTROPIC=this._isEnabled,this._isEnabled&&!p.isVerticesDataPresent(F.f.TangentKind)&&(a._needUVs=!0,a.MAINUV1=!0),a._areTexturesDirty&&v.texturesEnabled&&(this._texture&&D.e.AnisotropicTextureEnabled?(0,Z.S)(this._texture,a,"ANISOTROPIC_TEXTURE"):a.ANISOTROPIC_TEXTURE=!1),a._areMiscDirty&&(a.ANISOTROPIC_LEGACY=this._legacy)):(a.ANISOTROPIC=!1,a.ANISOTROPIC_TEXTURE=!1,a.ANISOTROPIC_TEXTUREDIRECTUV=0,a.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(a,v){if(!this._isEnabled)return;const p=this._material.isFrozen;a.useUbo&&p&&a.isSync||(this._texture&&D.e.AnisotropicTextureEnabled&&(a.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,Z.s)(this._texture,a,"anisotropy")),a.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.jj)),v.texturesEnabled&&this._texture&&D.e.AnisotropicTextureEnabled&&a.setTexture("anisotropySampler",this._texture)}hasTexture(a){return this._texture===a}getActiveTextures(a){this._texture&&a.push(this._texture)}getAnimatables(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture)}dispose(a){a&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(a,v,p){return a.ANISOTROPIC&&v.addFallback(p++,"ANISOTROPIC"),p}getSamplers(a){a.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(a,v,p){super.parse(a,v,p),void 0===a.legacy&&(this.legacy=!0)}}(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isEnabled",void 0),(0,P.e)([(0,b.O)()],j.prototype,"intensity",void 0),(0,P.e)([(0,b.K)()],j.prototype,"direction",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"texture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsMiscDirty")],j.prototype,"legacy",void 0);class w extends u.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class J extends c.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"Sheen",120,new w,v),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.jj=1,this.color=h.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1]}isReadyForSubMesh(a,v){if(!this._isEnabled)return!0;if(a._areTexturesDirty&&v.texturesEnabled){if(this._texture&&D.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&D.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(a,v){this._isEnabled?(a.SHEEN=!0,a.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,a.SHEEN_ROUGHNESS=null!==this._roughness,a.SHEEN_ALBEDOSCALING=this._albedoScaling,a.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,a._areTexturesDirty&&v.texturesEnabled&&(this._texture&&D.e.SheenTextureEnabled?((0,Z.S)(this._texture,a,"SHEEN_TEXTURE"),a.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):a.SHEEN_TEXTURE=!1,this._textureRoughness&&D.e.SheenTextureEnabled?(0,Z.S)(this._textureRoughness,a,"SHEEN_TEXTURE_ROUGHNESS"):a.SHEEN_TEXTURE_ROUGHNESS=!1)):(a.SHEEN=!1,a.SHEEN_TEXTURE=!1,a.SHEEN_TEXTURE_ROUGHNESS=!1,a.SHEEN_LINKWITHALBEDO=!1,a.SHEEN_ROUGHNESS=!1,a.SHEEN_ALBEDOSCALING=!1,a.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,a.SHEEN_GAMMATEXTURE=!1,a.SHEEN_TEXTUREDIRECTUV=0,a.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(a,v,p,P){if(!this._isEnabled)return;const b=P.materialDefines,L=this._material.isFrozen;if(!a.useUbo||!L||!a.isSync){var t,V,K,C;if((this._texture||this._textureRoughness)&&D.e.SheenTextureEnabled)a.updateFloat4("vSheenInfos",(null===(t=this._texture)||void 0===t?void 0:t.coordinatesIndex)??0,(null===(V=this._texture)||void 0===V?void 0:V.level)??0,(null===(K=this._textureRoughness)||void 0===K?void 0:K.coordinatesIndex)??0,(null===(C=this._textureRoughness)||void 0===C?void 0:C.level)??0),this._texture&&(0,Z.s)(this._texture,a,"sheen"),this._textureRoughness&&!b.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,Z.s)(this._textureRoughness,a,"sheenRoughness");a.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.jj),null!==this._roughness&&a.updateFloat("vSheenRoughness",this._roughness)}v.texturesEnabled&&(this._texture&&D.e.SheenTextureEnabled&&a.setTexture("sheenSampler",this._texture),this._textureRoughness&&!b.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&D.e.SheenTextureEnabled&&a.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(a){return this._texture===a||this._textureRoughness===a}getActiveTextures(a){this._texture&&a.push(this._texture),this._textureRoughness&&a.push(this._textureRoughness)}getAnimatables(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&a.push(this._textureRoughness)}dispose(a){var v,p;a&&(null===(v=this._texture)||void 0===v||v.dispose(),null===(p=this._textureRoughness)||void 0===p||p.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(a,v,p){return a.SHEEN&&v.addFallback(p++,"SHEEN"),p}getSamplers(a){a.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"isEnabled",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"linkSheenWithAlbedo",void 0),(0,P.e)([(0,b.O)()],J.prototype,"intensity",void 0),(0,P.e)([(0,b.l)()],J.prototype,"color",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"texture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"useRoughnessFromMainTexture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"roughness",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"textureRoughness",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],J.prototype,"albedoScaling",void 0);class B extends u.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class x extends c.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(a){this._scene.enableSubSurfaceForPrePass()&&a&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(a))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(a){this._volumeIndexOfRefraction=a>=1?a:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"PBRSubSurface",130,new B,v),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=h.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=h.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=a.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=a._dirtyCallbacks[32]}isReadyForSubMesh(a,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(a._areTexturesDirty&&v.texturesEnabled){if(this._thicknessTexture&&D.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&D.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&D.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const a=this._getRefractionTexture(v);if(a&&D.e.RefractionTextureEnabled&&!a.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(a,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return a.SUBSURFACE=!1,a.SS_DISPERSION=!1,a.SS_TRANSLUCENCY=!1,a.SS_SCATTERING=!1,a.SS_REFRACTION=!1,a.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,a.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,a.SS_THICKNESSANDMASK_TEXTURE=!1,a.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,a.SS_HAS_THICKNESS=!1,a.SS_REFRACTIONINTENSITY_TEXTURE=!1,a.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,a.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,a.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,a.SS_REFRACTIONMAP_3D=!1,a.SS_REFRACTIONMAP_OPPOSITEZ=!1,a.SS_LODINREFRACTIONALPHA=!1,a.SS_GAMMAREFRACTION=!1,a.SS_RGBDREFRACTION=!1,a.SS_LINEARSPECULARREFRACTION=!1,a.SS_LINKREFRACTIONTOTRANSPARENCY=!1,a.SS_ALBEDOFORREFRACTIONTINT=!1,a.SS_ALBEDOFORTRANSLUCENCYTINT=!1,a.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,a.SS_USE_THICKNESS_AS_DEPTH=!1,a.SS_USE_GLTF_TEXTURES=!1,a.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(a.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(a._areTexturesDirty){if(a.SUBSURFACE=!0,a.SS_DISPERSION=this._isDispersionEnabled,a.SS_TRANSLUCENCY=this._isTranslucencyEnabled,a.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,a.SS_SCATTERING=this._isScatteringEnabled,a.SS_THICKNESSANDMASK_TEXTURE=!1,a.SS_REFRACTIONINTENSITY_TEXTURE=!1,a.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,a.SS_HAS_THICKNESS=!1,a.SS_USE_GLTF_TEXTURES=!1,a.SS_REFRACTION=!1,a.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,a.SS_REFRACTIONMAP_3D=!1,a.SS_GAMMAREFRACTION=!1,a.SS_RGBDREFRACTION=!1,a.SS_LINEARSPECULARREFRACTION=!1,a.SS_REFRACTIONMAP_OPPOSITEZ=!1,a.SS_LODINREFRACTIONALPHA=!1,a.SS_LINKREFRACTIONTOTRANSPARENCY=!1,a.SS_ALBEDOFORREFRACTIONTINT=!1,a.SS_ALBEDOFORTRANSLUCENCYTINT=!1,a.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,a.SS_USE_THICKNESS_AS_DEPTH=!1,a.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,a._areTexturesDirty&&v.texturesEnabled&&(this._thicknessTexture&&D.e.ThicknessTextureEnabled&&(0,Z.S)(this._thicknessTexture,a,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&D.e.RefractionIntensityTextureEnabled&&(0,Z.S)(this._refractionIntensityTexture,a,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&D.e.TranslucencyIntensityTextureEnabled&&(0,Z.S)(this._translucencyIntensityTexture,a,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&D.e.TranslucencyColorTextureEnabled&&(0,Z.S)(this._translucencyColorTexture,a,"SS_TRANSLUCENCYCOLOR_TEXTURE")),a.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,a.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,a.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,a.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&v.texturesEnabled){const p=this._getRefractionTexture(v);p&&D.e.RefractionTextureEnabled&&(a.SS_REFRACTION=!0,a.SS_REFRACTIONMAP_3D=p.isCube,a.SS_GAMMAREFRACTION=p.gammaSpace,a.SS_RGBDREFRACTION=p.isRGBD,a.SS_LINEARSPECULARREFRACTION=p.linearSpecularLOD,a.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&p.isCube?!p.invertZ:p.invertZ,a.SS_LODINREFRACTIONALPHA=p.lodLevelInAlpha,a.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,a.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,a.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=p.isCube&&p.boundingBoxSize,a.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(a.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(a,v,p,P){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)a.updateFloat2("vThicknessParam",0,0);else{P.getRenderingMesh().getWorldMatrix().decompose(C.k.fb[0]);const v=Math.max(Math.abs(C.k.fb[0].x),Math.abs(C.k.fb[0].y),Math.abs(C.k.fb[0].z));a.updateFloat2("vThicknessParam",this.minimumThickness*v,(this.maximumThickness-this.minimumThickness)*v)}}bindForSubMesh(a,v,p,P){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const b=P.materialDefines,L=this._material.isFrozen,t=this._material.realTimeFiltering,V=b.LODBASEDMICROSFURACE,K=this._getRefractionTexture(v);if(!a.useUbo||!L||!a.isSync){if(this._thicknessTexture&&D.e.ThicknessTextureEnabled&&(a.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,Z.s)(this._thicknessTexture,a,"thickness")),this._refractionIntensityTexture&&D.e.RefractionIntensityTextureEnabled&&b.SS_REFRACTIONINTENSITY_TEXTURE&&(a.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,Z.s)(this._refractionIntensityTexture,a,"refractionIntensity")),this._translucencyColorTexture&&D.e.TranslucencyColorTextureEnabled&&b.SS_TRANSLUCENCYCOLOR_TEXTURE&&(a.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,Z.s)(this._translucencyColorTexture,a,"translucencyColor")),this._translucencyIntensityTexture&&D.e.TranslucencyIntensityTextureEnabled&&b.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(a.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,Z.s)(this._translucencyIntensityTexture,a,"translucencyIntensity")),K&&D.e.RefractionTextureEnabled){a.Sj("refractionMatrix",K.getRefractionTextureMatrix());let v=1;K.isCube||K.depth&&(v=K.depth);const p=K.getSize().width,P=this.volumeIndexOfRefraction;if(a.updateFloat4("vRefractionInfos",K.level,1/P,v,this._invertRefractionY?-1:1),a.updateFloat4("vRefractionMicrosurfaceInfos",p,K.lodGenerationScale,K.lodGenerationOffset,1/this.indexOfRefraction),t&&a.updateFloat2("vRefractionFilteringInfo",p,Math.log2(p)),K.boundingBoxSize){const v=K;a.updateVector3("vRefractionPosition",v.boundingBoxPosition),a.updateVector3("vRefractionSize",v.boundingBoxSize)}}this._isScatteringEnabled&&a.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),a.updateColor3("vDiffusionDistance",this.diffusionDistance),a.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),a.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),a.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),a.updateFloat("dispersion",this.dispersion)}v.texturesEnabled&&(this._thicknessTexture&&D.e.ThicknessTextureEnabled&&a.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&D.e.RefractionIntensityTextureEnabled&&b.SS_REFRACTIONINTENSITY_TEXTURE&&a.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&D.e.TranslucencyIntensityTextureEnabled&&b.SS_TRANSLUCENCYINTENSITY_TEXTURE&&a.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&D.e.TranslucencyColorTextureEnabled&&b.SS_TRANSLUCENCYCOLOR_TEXTURE&&a.setTexture("translucencyColorSampler",this._translucencyColorTexture),K&&D.e.RefractionTextureEnabled&&(V?a.setTexture("refractionSampler",K):(a.setTexture("refractionSampler",K._lodTextureMid||K),a.setTexture("refractionSamplerLow",K._lodTextureLow||K),a.setTexture("refractionSamplerHigh",K._lodTextureHigh||K))))}_getRefractionTexture(a){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?a.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(a){D.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&a.push(this._refractionTexture)}hasTexture(a){return this._thicknessTexture===a||(this._refractionTexture===a||(this._refractionIntensityTexture===a||(this._translucencyIntensityTexture===a||this._translucencyColorTexture===a)))}hasRenderTargetTextures(){return!!(D.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(a){this._thicknessTexture&&a.push(this._thicknessTexture),this._refractionTexture&&a.push(this._refractionTexture),this._translucencyColorTexture&&a.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&a.push(this._translucencyIntensityTexture)}getAnimatables(a){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&a.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&a.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&a.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&a.push(this._translucencyIntensityTexture)}dispose(a){a&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(a,v,p){return a.SS_SCATTERING&&v.addFallback(p++,"SS_SCATTERING"),a.SS_TRANSLUCENCY&&v.addFallback(p++,"SS_TRANSLUCENCY"),p}getSamplers(a){a.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isRefractionEnabled",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isTranslucencyEnabled",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isDispersionEnabled",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markScenePrePassDirty")],x.prototype,"isScatteringEnabled",void 0),(0,P.e)([(0,b.O)()],x.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,P.e)([(0,b.O)()],x.prototype,"refractionIntensity",void 0),(0,P.e)([(0,b.O)()],x.prototype,"translucencyIntensity",void 0),(0,P.e)([(0,b.O)()],x.prototype,"useAlbedoToTintRefraction",void 0),(0,P.e)([(0,b.O)()],x.prototype,"useAlbedoToTintTranslucency",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"thicknessTexture",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"refractionTexture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"indexOfRefraction",void 0),(0,P.e)([(0,b.O)()],x.prototype,"_volumeIndexOfRefraction",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"volumeIndexOfRefraction",null),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertRefractionY",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"linkRefractionWithTransparency",void 0),(0,P.e)([(0,b.O)()],x.prototype,"minimumThickness",void 0),(0,P.e)([(0,b.O)()],x.prototype,"maximumThickness",void 0),(0,P.e)([(0,b.O)()],x.prototype,"useThicknessAsDepth",void 0),(0,P.e)([(0,b.l)()],x.prototype,"tintColor",void 0),(0,P.e)([(0,b.O)()],x.prototype,"tintColorAtDistance",void 0),(0,P.e)([(0,b.O)()],x.prototype,"dispersion",void 0),(0,P.e)([(0,b.l)()],x.prototype,"diffusionDistance",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMaskFromThicknessTexture",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"refractionIntensityTexture",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"translucencyIntensityTexture",void 0),(0,P.e)([(0,b.l)()],x.prototype,"translucencyColor",void 0),(0,P.e)([(0,b.H)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"translucencyColorTexture",void 0),(0,P.e)([(0,b.O)(),(0,b.e)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useGltfStyleTextures",void 0);var r=p(11484),o=p(11448),m=p(11497);const O={effect:null,subMesh:null};class Y extends u.b{constructor(a){super(a),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class l extends Q.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(a){this._realTimeFiltering=a,this.Sg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(a){this._realTimeFilteringQuality=a,this.Sg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(a){a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=a||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(a,v){super(a,v,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||l.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new C.t(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=l.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=h.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new h.d(0,0,0),this._albedoColor=new h.d(1,1,1),this._reflectivityColor=new h.d(1,1,1),this._reflectionColor=new h.d(1,1,1),this._emissiveColor=new h.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=l.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new t.e(16),this._globalAmbientColor=new h.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new H(this),this.clearCoat=new S(this),this.iridescence=new q(this),this.anisotropy=new j(this),this.sheen=new J(this),this.subSurface=new x(this),this.detailMap=new r.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),D.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,V.e)(this.va()),this.prePassConfiguration=new A.c}get hasRenderTargetTextures(){return!!(D.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var a;return this._transparencyMode===l.PBRMATERIAL_OPAQUE||this._transparencyMode===l.PBRMATERIAL_ALPHATEST||(null===(a=this.subSurface)||void 0===a?void 0:a.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var a;return!!this._forceAlphaTest||(null===(a=this.subSurface)||void 0===a||!a.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===l.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Ge&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==l.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Ge||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(a,v,p){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const P=v._drawWrapper;if(P.effect&&this.isFrozen&&P._wasPreviouslyReady&&P._wasPreviouslyUsingInstances===p)return!0;v.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),v.materialDefines=new Y(this._eventInfo.defineNames));const b=v.materialDefines;if(this._isReadyForSubMesh(v))return!0;const t=this.va(),V=t.getEngine();if(b._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,t.texturesEnabled)){if(this._albedoTexture&&D.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&D.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&D.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const a=this._getReflectionTexture();if(a&&D.e.ReflectionTextureEnabled){if(!a.isReadyOrNotBlocking())return!1;var K;if(a.irradianceTexture){if(!a.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!a.sphericalPolynomial&&null!==(K=a.getInternalTexture())&&void 0!==K&&K._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&D.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&D.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(D.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(V.getCaps().standardDerivatives&&this._bumpTexture&&D.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&D.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=b,this._eventInfo.subMesh=v,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(b._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;V.getCaps().standardDerivatives||a.isVerticesDataPresent(F.f.NormalKind)||(a.createNormals(!0),L.d.Warn("PBRMaterial: Normals have been created for the mesh: "+a.name));const C=v.effect,u=b._areLightsDisposed;let c=this._prepareEffect(a,b,this.onCompiled,this.onError,p,null,v.getRenderingMesh().hasThinInstances),f=!1;if(c)if(this._onEffectCreatedObservable&&(O.effect=c,O.subMesh=v,this._onEffectCreatedObservable.notifyObservers(O)),this.allowShaderHotSwapping&&C&&!c.isReady()){if(c=C,b.markAsUnprocessed(),f=this.isFrozen,u)return b._areLightsDisposed=!0,!1}else t.resetCachedMaterial(),v.setEffect(c,b,this._materialContext);return!(!v.effect||!v.effect.isReady())&&(b._renderId=t.getRenderId(),P._wasPreviouslyReady=!f,P._wasPreviouslyUsingInstances=!!p,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(a,v){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(a,v,L,t,V),!v.isDirty)return null;v.markAsProcessed();const K=this.va().getEngine(),C=new y.b;let u=0;v.USESPHERICALINVERTEX&&C.addFallback(u++,"USESPHERICALINVERTEX"),v.FOG&&C.addFallback(u,"FOG"),v.SPECULARAA&&C.addFallback(u,"SPECULARAA"),v.POINTSIZE&&C.addFallback(u,"POINTSIZE"),v.LOGARITHMICDEPTH&&C.addFallback(u,"LOGARITHMICDEPTH"),v.PARALLAX&&C.addFallback(u,"PARALLAX"),v.PARALLAX_RHS&&C.addFallback(u,"PARALLAX_RHS"),v.PARALLAXOCCLUSION&&C.addFallback(u++,"PARALLAXOCCLUSION"),v.ENVIRONMENTBRDF&&C.addFallback(u++,"ENVIRONMENTBRDF"),v.TANGENT&&C.addFallback(u++,"TANGENT"),v.BUMP&&C.addFallback(u++,"BUMP"),u=(0,Z.w)(v,C,this._maxSimultaneousLights,u++),v.SPECULARTERM&&C.addFallback(u++,"SPECULARTERM"),v.USESPHERICALFROMREFLECTIONMAP&&C.addFallback(u++,"USESPHERICALFROMREFLECTIONMAP"),v.USEIRRADIANCEMAP&&C.addFallback(u++,"USEIRRADIANCEMAP"),v.LIGHTMAP&&C.addFallback(u++,"LIGHTMAP"),v.NORMAL&&C.addFallback(u++,"NORMAL"),v.AMBIENT&&C.addFallback(u++,"AMBIENT"),v.EMISSIVE&&C.addFallback(u++,"EMISSIVE"),v.VERTEXCOLOR&&C.addFallback(u++,"VERTEXCOLOR"),v.MORPHTARGETS&&C.addFallback(u++,"MORPHTARGETS"),v.MULTIVIEW&&C.addFallback(0,"MULTIVIEW");const c=[F.f.PositionKind];v.NORMAL&&c.push(F.f.NormalKind),v.TANGENT&&c.push(F.f.TangentKind);for(let p=1;p<=6;++p)v["UV"+p]&&c.push(`uv${1===p?"":p}`);v.VERTEXCOLOR&&c.push(F.f.ColorKind),(0,Z.A)(c,a,v,C),(0,Z.E)(c,v),(0,Z.F)(c,a,v),(0,Z.y)(c,a,v);let f="pbr";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],h=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],X=["Material","Scene","Mesh"],Q={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:v.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=C,this._eventInfo.fallbackRank=u,this._eventInfo.defines=v,this._eventInfo.uniforms=H,this._eventInfo.attributes=c,this._eventInfo.samplers=h,this._eventInfo.uniformBuffersNames=X,this._eventInfo.customCode=void 0,this._eventInfo.mesh=a,this._eventInfo.indexParameters=Q,this._callbackPluginEventGeneric(128,this._eventInfo),m.e.AddUniformsAndSamplers(H,h),A.c.AddUniforms(H),A.c.AddSamplers(h),(0,o.e)(H),R.c&&(R.c.PrepareUniforms(H,v),R.c.PrepareSamplers(h,v)),(0,Z.hb)({uniformsNames:H,uniformBuffersNames:X,samplers:h,defines:v,maxSimultaneousLights:this._maxSimultaneousLights});const s={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,H,X,h,v,c,s));const D=v.toString(),M=K.createEffect(f,{attributes:c,uniformsNames:H,uniformBuffersNames:X,samplers:h,defines:D,fallbacks:C,onCompiled:P,onError:b,indexParameters:Q,processFinalCode:s.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:v.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([p.e(21),p.e(43)]).then(p.bind(p,13689)),Promise.all([p.e(22),p.e(44)]).then(p.bind(p,13714))]):await Promise.all([Promise.all([p.e(25),p.e(45)]).then(p.bind(p,13718)),Promise.all([p.e(27),p.e(46)]).then(p.bind(p,13738))]),this._shadersLoaded=!0}},K);return this._eventInfo.customCode=void 0,M}_prepareDefines(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const L=this.va(),t=L.getEngine();(0,Z.P)(L,a,v,!0,this._maxSimultaneousLights,this._disableLighting),v._needNormals=!0,(0,Z.Y)(L,v);const V=this.needAlphaBlendingForMesh(a)&&this.va().useOrderIndependentTransparency;if((0,Z.eb)(L,v,this.canRenderToMRT&&!V),(0,Z.ab)(L,v,V),m.e.PrepareDefines(t.currentRenderPassId,a,v),v.METALLICWORKFLOW=this.isMetallicWorkflow(),v._areTexturesDirty){v._needUVs=!1;for(let a=1;a<=6;++a)v["MAINUV"+a]=!1;if(L.texturesEnabled){v.ALBEDODIRECTUV=0,v.AMBIENTDIRECTUV=0,v.OPACITYDIRECTUV=0,v.EMISSIVEDIRECTUV=0,v.REFLECTIVITYDIRECTUV=0,v.MICROSURFACEMAPDIRECTUV=0,v.METALLIC_REFLECTANCEDIRECTUV=0,v.REFLECTANCEDIRECTUV=0,v.BUMPDIRECTUV=0,v.LIGHTMAPDIRECTUV=0,t.getCaps().textureLOD&&(v.LODBASEDMICROSFURACE=!0),this._albedoTexture&&D.e.DiffuseTextureEnabled?((0,Z.S)(this._albedoTexture,v,"ALBEDO"),v.GAMMAALBEDO=this._albedoTexture.gammaSpace):v.ALBEDO=!1,this._ambientTexture&&D.e.AmbientTextureEnabled?((0,Z.S)(this._ambientTexture,v,"AMBIENT"),v.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):v.AMBIENT=!1,this._opacityTexture&&D.e.OpacityTextureEnabled?((0,Z.S)(this._opacityTexture,v,"OPACITY"),v.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):v.OPACITY=!1;const a=this._getReflectionTexture();if(a&&D.e.ReflectionTextureEnabled){switch(v.REFLECTION=!0,v.GAMMAREFLECTION=a.gammaSpace,v.RGBDREFLECTION=a.isRGBD,v.LODINREFLECTIONALPHA=a.lodLevelInAlpha,v.LINEARSPECULARREFLECTION=a.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(v.NUM_SAMPLES=""+this.realTimeFilteringQuality,t._features.needTypeSuffixInShaderConstants&&(v.NUM_SAMPLES=v.NUM_SAMPLES+"u"),v.REALTIME_FILTERING=!0):v.REALTIME_FILTERING=!1,v.INVERTCUBICMAP=a.coordinatesMode===s.c.INVCUBIC_MODE,v.REFLECTIONMAP_3D=a.isCube,v.REFLECTIONMAP_OPPOSITEZ=v.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!a.invertZ:a.invertZ,v.REFLECTIONMAP_CUBIC=!1,v.REFLECTIONMAP_EXPLICIT=!1,v.REFLECTIONMAP_PLANAR=!1,v.REFLECTIONMAP_PROJECTION=!1,v.REFLECTIONMAP_SKYBOX=!1,v.REFLECTIONMAP_SPHERICAL=!1,v.REFLECTIONMAP_EQUIRECTANGULAR=!1,v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.coordinatesMode){case s.c.EXPLICIT_MODE:v.REFLECTIONMAP_EXPLICIT=!0;break;case s.c.PLANAR_MODE:v.REFLECTIONMAP_PLANAR=!0;break;case s.c.PROJECTION_MODE:v.REFLECTIONMAP_PROJECTION=!0;break;case s.c.SKYBOX_MODE:v.REFLECTIONMAP_SKYBOX=!0;break;case s.c.SPHERICAL_MODE:v.REFLECTIONMAP_SPHERICAL=!0;break;case s.c.EQUIRECTANGULAR_MODE:v.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case s.c.FIXED_EQUIRECTANGULAR_MODE:v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case s.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case s.c.CUBIC_MODE:case s.c.INVCUBIC_MODE:default:v.REFLECTIONMAP_CUBIC=!0,v.USE_LOCAL_REFLECTIONMAP_CUBIC=!!a.boundingBoxSize}a.coordinatesMode!==s.c.SKYBOX_MODE&&(a.irradianceTexture?(v.USEIRRADIANCEMAP=!0,v.USESPHERICALFROMREFLECTIONMAP=!1):a.isCube&&(v.USESPHERICALFROMREFLECTIONMAP=!0,v.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||t.getCaps().maxVaryingVectors<=8?v.USESPHERICALINVERTEX=!1:v.USESPHERICALINVERTEX=!0))}else v.REFLECTION=!1,v.REFLECTIONMAP_3D=!1,v.REFLECTIONMAP_SPHERICAL=!1,v.REFLECTIONMAP_PLANAR=!1,v.REFLECTIONMAP_CUBIC=!1,v.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,v.REFLECTIONMAP_PROJECTION=!1,v.REFLECTIONMAP_SKYBOX=!1,v.REFLECTIONMAP_EXPLICIT=!1,v.REFLECTIONMAP_EQUIRECTANGULAR=!1,v.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,v.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,v.INVERTCUBICMAP=!1,v.USESPHERICALFROMREFLECTIONMAP=!1,v.USEIRRADIANCEMAP=!1,v.USESPHERICALINVERTEX=!1,v.REFLECTIONMAP_OPPOSITEZ=!1,v.LODINREFLECTIONALPHA=!1,v.GAMMAREFLECTION=!1,v.RGBDREFLECTION=!1,v.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&D.e.LightmapTextureEnabled?((0,Z.S)(this._lightmapTexture,v,"LIGHTMAP"),v.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,v.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,v.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):v.LIGHTMAP=!1,this._emissiveTexture&&D.e.EmissiveTextureEnabled?((0,Z.S)(this._emissiveTexture,v,"EMISSIVE"),v.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):v.EMISSIVE=!1,D.e.SpecularTextureEnabled?(this._metallicTexture?((0,Z.S)(this._metallicTexture,v,"REFLECTIVITY"),v.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,v.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,v.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,v.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,v.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,Z.S)(this._reflectivityTexture,v,"REFLECTIVITY"),v.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,v.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,v.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):v.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(v.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,Z.S)(this._metallicReflectanceTexture,v,"METALLIC_REFLECTANCE"),v.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):v.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,Z.S)(this._reflectanceTexture,v,"REFLECTANCE"),v.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):v.REFLECTANCE=!1):(v.METALLIC_REFLECTANCE=!1,v.REFLECTANCE=!1),this._microSurfaceTexture?(0,Z.S)(this._microSurfaceTexture,v,"MICROSURFACEMAP"):v.MICROSURFACEMAP=!1):(v.REFLECTIVITY=!1,v.MICROSURFACEMAP=!1),t.getCaps().standardDerivatives&&this._bumpTexture&&D.e.BumpTextureEnabled&&!this._disableBumpMap?((0,Z.S)(this._bumpTexture,v,"BUMP"),this._useParallax&&this._albedoTexture&&D.e.DiffuseTextureEnabled?(v.PARALLAX=!0,v.PARALLAX_RHS=L.useRightHandedSystem,v.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):v.PARALLAX=!1,v.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(v.BUMP=!1,v.PARALLAX=!1,v.PARALLAX_RHS=!1,v.PARALLAXOCCLUSION=!1,v.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&D.e.ReflectionTextureEnabled?(v.ENVIRONMENTBRDF=!0,v.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(v.ENVIRONMENTBRDF=!1,v.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?v.ALPHAFROMALBEDO=!0:v.ALPHAFROMALBEDO=!1}v.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===l.LIGHTFALLOFF_STANDARD?(v.USEPHYSICALLIGHTFALLOFF=!1,v.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===l.LIGHTFALLOFF_GLTF?(v.USEPHYSICALLIGHTFALLOFF=!1,v.USEGLTFLIGHTFALLOFF=!0):(v.USEPHYSICALLIGHTFALLOFF=!0,v.USEGLTFLIGHTFALLOFF=!1),v.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.oh&&this._twoSidedLighting?v.TWOSIDEDLIGHTING=!0:v.TWOSIDEDLIGHTING=!1,v.SPECULARAA=t.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(v._areTexturesDirty||v._areMiscDirty)&&(v.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,v.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,v.ALPHABLEND=this.needAlphaBlendingForMesh(a),v.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,v.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),v._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(v),v.FORCENORMALFORWARD=this._forceNormalForward,v.RADIANCEOCCLUSION=this._useRadianceOcclusion,v.HORIZONOCCLUSION=this._useHorizonOcclusion,v._areMiscDirty&&((0,Z.U)(a,L,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a)||this._forceAlphaTest,v,this._applyDecalMapAfterDetailMap),v.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!a.isVerticesDataPresent(F.f.NormalKind),v.DEBUGMODE=this._debugMode),(0,Z.N)(L,t,this,v,!!p,P,b),this._eventInfo.defines=v,this._eventInfo.mesh=a,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,Z.J)(a,v,!0,!0,!0,this._transparencyMode!==l.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(a,v,p){const P={clipPlane:!1,useInstances:!1,...p};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const p=new Y(this._eventInfo.defineNames),b=this._prepareEffect(a,p,void 0,void 0,P.useInstances,P.clipPlane,a.hasThinInstances);this._onEffectCreatedObservable&&(O.effect=b,O.subMesh=null,this._onEffectCreatedObservable.notifyObservers(O)),b.isReady()?v&&v(this):b.onCompileObservable.add((()=>{v&&v(this)}))})()}buildUniformLayout(){const a=this._uniformBuffer;a.addUniform("vAlbedoInfos",2),a.addUniform("vAmbientInfos",4),a.addUniform("vOpacityInfos",2),a.addUniform("vEmissiveInfos",2),a.addUniform("vLightmapInfos",2),a.addUniform("vReflectivityInfos",3),a.addUniform("vMicroSurfaceSamplerInfos",2),a.addUniform("vReflectionInfos",2),a.addUniform("vReflectionFilteringInfo",2),a.addUniform("vReflectionPosition",3),a.addUniform("vReflectionSize",3),a.addUniform("vBumpInfos",3),a.addUniform("albedoMatrix",16),a.addUniform("ambientMatrix",16),a.addUniform("opacityMatrix",16),a.addUniform("emissiveMatrix",16),a.addUniform("lightmapMatrix",16),a.addUniform("reflectivityMatrix",16),a.addUniform("microSurfaceSamplerMatrix",16),a.addUniform("bumpMatrix",16),a.addUniform("vTangentSpaceParams",2),a.addUniform("reflectionMatrix",16),a.addUniform("vReflectionColor",3),a.addUniform("vAlbedoColor",4),a.addUniform("vLightingIntensity",4),a.addUniform("vReflectionMicrosurfaceInfos",3),a.addUniform("pointSize",1),a.addUniform("vReflectivityColor",4),a.addUniform("vEmissiveColor",3),a.addUniform("vAmbientColor",3),a.addUniform("vDebugMode",2),a.addUniform("vMetallicReflectanceFactors",4),a.addUniform("vMetallicReflectanceInfos",2),a.addUniform("metallicReflectanceMatrix",16),a.addUniform("vReflectanceInfos",2),a.addUniform("reflectanceMatrix",16),a.addUniform("vSphericalL00",3),a.addUniform("vSphericalL1_1",3),a.addUniform("vSphericalL10",3),a.addUniform("vSphericalL11",3),a.addUniform("vSphericalL2_2",3),a.addUniform("vSphericalL2_1",3),a.addUniform("vSphericalL20",3),a.addUniform("vSphericalL21",3),a.addUniform("vSphericalL22",3),a.addUniform("vSphericalX",3),a.addUniform("vSphericalY",3),a.addUniform("vSphericalZ",3),a.addUniform("vSphericalXX_ZZ",3),a.addUniform("vSphericalYY_ZZ",3),a.addUniform("vSphericalZZ",3),a.addUniform("vSphericalXY",3),a.addUniform("vSphericalYZ",3),a.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(a,v,p){const P=this.va(),b=p.materialDefines;if(!b)return;const L=p.effect;if(!L)return;this._activeEffect=L,v.getMeshUniformBuffer().bindToEffect(L,"Mesh"),v.transferToEffect(a);const t=P.getEngine();this._uniformBuffer.bindToEffect(L,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,P,v,a,this.isFrozen),m.e.Bind(t.currentRenderPassId,this._activeEffect,v,a),this._eventInfo.subMesh=p,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),b.OBJECTSPACE_NORMALMAP&&(a.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const V=this._mustRebind(P,L,p,v.visibility);(0,Z.b)(v,this._activeEffect,this.prePassConfiguration);let C=null;const F=this._uniformBuffer;if(V){if(this.bindViewProjection(L),C=this._getReflectionTexture(),!F.useUbo||!this.isFrozen||!F.isSync||p._drawWrapper._forceRebindOnNextCall){var u;if(P.texturesEnabled){if(this._albedoTexture&&D.e.DiffuseTextureEnabled&&(F.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,Z.s)(this._albedoTexture,F,"albedo")),this._ambientTexture&&D.e.AmbientTextureEnabled&&(F.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,Z.s)(this._ambientTexture,F,"ambient")),this._opacityTexture&&D.e.OpacityTextureEnabled&&(F.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,Z.s)(this._opacityTexture,F,"opacity")),C&&D.e.ReflectionTextureEnabled){if(F.Sj("reflectionMatrix",C.getReflectionTextureMatrix()),F.updateFloat2("vReflectionInfos",C.level,0),C.boundingBoxSize){const a=C;F.updateVector3("vReflectionPosition",a.boundingBoxPosition),F.updateVector3("vReflectionSize",a.boundingBoxSize)}if(this.realTimeFiltering){const a=C.getSize().width;F.updateFloat2("vReflectionFilteringInfo",a,Math.log2(a))}if(!b.USEIRRADIANCEMAP){const a=C.sphericalPolynomial;if(b.USESPHERICALFROMREFLECTIONMAP&&a)if(b.SPHERICAL_HARMONICS){const v=a.preScaledHarmonics;F.updateVector3("vSphericalL00",v.l00),F.updateVector3("vSphericalL1_1",v.l1_1),F.updateVector3("vSphericalL10",v.l10),F.updateVector3("vSphericalL11",v.l11),F.updateVector3("vSphericalL2_2",v.l2_2),F.updateVector3("vSphericalL2_1",v.l2_1),F.updateVector3("vSphericalL20",v.l20),F.updateVector3("vSphericalL21",v.l21),F.updateVector3("vSphericalL22",v.l22)}else F.updateFloat3("vSphericalX",a.x.x,a.x.y,a.x.z),F.updateFloat3("vSphericalY",a.y.x,a.y.y,a.y.z),F.updateFloat3("vSphericalZ",a.z.x,a.z.y,a.z.z),F.updateFloat3("vSphericalXX_ZZ",a.xx.x-a.zz.x,a.xx.y-a.zz.y,a.xx.z-a.zz.z),F.updateFloat3("vSphericalYY_ZZ",a.yy.x-a.zz.x,a.yy.y-a.zz.y,a.yy.z-a.zz.z),F.updateFloat3("vSphericalZZ",a.zz.x,a.zz.y,a.zz.z),F.updateFloat3("vSphericalXY",a.xy.x,a.xy.y,a.xy.z),F.updateFloat3("vSphericalYZ",a.yz.x,a.yz.y,a.yz.z),F.updateFloat3("vSphericalZX",a.zx.x,a.zx.y,a.zx.z)}F.updateFloat3("vReflectionMicrosurfaceInfos",C.getSize().width,C.lodGenerationScale,C.lodGenerationOffset)}this._emissiveTexture&&D.e.EmissiveTextureEnabled&&(F.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,Z.s)(this._emissiveTexture,F,"emissive")),this._lightmapTexture&&D.e.LightmapTextureEnabled&&(F.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,Z.s)(this._lightmapTexture,F,"lightmap")),D.e.SpecularTextureEnabled&&(this._metallicTexture?(F.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,Z.s)(this._metallicTexture,F,"reflectivity")):this._reflectivityTexture&&(F.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,Z.s)(this._reflectivityTexture,F,"reflectivity")),this._metallicReflectanceTexture&&(F.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,Z.s)(this._metallicReflectanceTexture,F,"metallicReflectance")),this._reflectanceTexture&&b.REFLECTANCE&&(F.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,Z.s)(this._reflectanceTexture,F,"reflectance")),this._microSurfaceTexture&&(F.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,Z.s)(this._microSurfaceTexture,F,"microSurfaceSampler"))),this._bumpTexture&&t.getCaps().standardDerivatives&&D.e.BumpTextureEnabled&&!this._disableBumpMap&&(F.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,Z.s)(this._bumpTexture,F,"bump"),P._mirroredCameraPosition?F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):F.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&F.updateFloat("pointSize",this.pointSize),b.METALLICWORKFLOW){var c;h.h.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,h.h.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,F.updateColor4("vReflectivityColor",h.h.gb[0],1);const a=(null===(c=this.subSurface)||void 0===c?void 0:c._indexOfRefraction)??1.5,v=1,p=Math.pow((a-v)/(a+v),2);this._metallicReflectanceColor.scaleToRef(p*this._metallicF0Factor,h.h.gb[0]);const P=this._metallicF0Factor;F.updateColor4("vMetallicReflectanceFactors",h.h.gb[0],P)}else F.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);F.updateColor3("vEmissiveColor",D.e.EmissiveTextureEnabled?this._emissiveColor:h.d.BlackReadOnly),F.updateColor3("vReflectionColor",this._reflectionColor),!b.SS_REFRACTION&&null!==(u=this.subSurface)&&void 0!==u&&u._linkRefractionWithTransparency?F.updateColor4("vAlbedoColor",this._albedoColor,1):F.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*P.environmentIntensity,this._lightingInfos.w=this._specularIntensity,F.updateVector4("vLightingIntensity",this._lightingInfos),P.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),F.updateColor3("vAmbientColor",this._globalAmbientColor),F.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}P.texturesEnabled&&(this._albedoTexture&&D.e.DiffuseTextureEnabled&&F.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&D.e.AmbientTextureEnabled&&F.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&D.e.OpacityTextureEnabled&&F.setTexture("opacitySampler",this._opacityTexture),C&&D.e.ReflectionTextureEnabled&&(b.LODBASEDMICROSFURACE?F.setTexture("reflectionSampler",C):(F.setTexture("reflectionSampler",C._lodTextureMid||C),F.setTexture("reflectionSamplerLow",C._lodTextureLow||C),F.setTexture("reflectionSamplerHigh",C._lodTextureHigh||C)),b.USEIRRADIANCEMAP&&F.setTexture("irradianceSampler",C.irradianceTexture)),b.ENVIRONMENTBRDF&&F.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&D.e.EmissiveTextureEnabled&&F.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&D.e.LightmapTextureEnabled&&F.setTexture("lightmapSampler",this._lightmapTexture),D.e.SpecularTextureEnabled&&(this._metallicTexture?F.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&F.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&F.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&b.REFLECTANCE&&F.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&F.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&t.getCaps().standardDerivatives&&D.e.BumpTextureEnabled&&!this._disableBumpMap&&F.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(v)&&this.va().depthPeelingRenderer.bind(L),this._eventInfo.subMesh=p,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,o.g)(this._activeEffect,this,P),this.bindEyePosition(L)}else P.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(V||!this.isFrozen){var f;if(P.lightsEnabled&&!this._disableLighting&&(0,Z.f)(P,v,this._activeEffect,b,this._maxSimultaneousLights),(P.fogEnabled&&v.applyFog&&P.fogMode!==K.c.FOGMODE_NONE||C||this.subSurface.refractionTexture||v.receiveShadows||b.PREPASS)&&this.bindView(L),(0,Z.c)(P,v,this._activeEffect,!0),b.NUM_MORPH_INFLUENCERS&&(0,Z.m)(v,this._activeEffect),b.BAKED_VERTEX_ANIMATION_TEXTURE)null===(f=v.bakedVertexAnimationManager)||void 0===f||f.bind(L,b.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,Z.j)(b,this._activeEffect,P)}this._afterBind(v,this._activeEffect,p),F.update()}getAnimatables(){const a=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&a.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&a.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&a.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&a.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?a.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&a.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&a.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&a.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&a.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&a.push(this._microSurfaceTexture),a}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const a=super.getActiveTextures();return this._albedoTexture&&a.push(this._albedoTexture),this._ambientTexture&&a.push(this._ambientTexture),this._opacityTexture&&a.push(this._opacityTexture),this._reflectionTexture&&a.push(this._reflectionTexture),this._emissiveTexture&&a.push(this._emissiveTexture),this._reflectivityTexture&&a.push(this._reflectivityTexture),this._metallicTexture&&a.push(this._metallicTexture),this._metallicReflectanceTexture&&a.push(this._metallicReflectanceTexture),this._reflectanceTexture&&a.push(this._reflectanceTexture),this._microSurfaceTexture&&a.push(this._microSurfaceTexture),this._bumpTexture&&a.push(this._bumpTexture),this._lightmapTexture&&a.push(this._lightmapTexture),a}hasTexture(a){return!!super.hasTexture(a)||(this._albedoTexture===a||(this._ambientTexture===a||(this._opacityTexture===a||(this._reflectionTexture===a||(this._emissiveTexture===a||(this._reflectivityTexture===a||(this._metallicTexture===a||(this._metallicReflectanceTexture===a||(this._reflectanceTexture===a||(this._microSurfaceTexture===a||(this._bumpTexture===a||this._lightmapTexture===a)))))))))))}setPrePassRenderer(){var a;if(null===(a=this.subSurface)||void 0===a||!a.isScatteringEnabled)return!1;const v=this.va().enableSubSurfaceForPrePass();return v&&(v.enabled=!0),!0}dispose(a,v){var p,P,b,L,t,V,K,C,F,u,c,f;(this._breakShaderLoadedCheck=!0,v)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(p=this._albedoTexture)||void 0===p||p.dispose(),null===(P=this._ambientTexture)||void 0===P||P.dispose(),null===(b=this._opacityTexture)||void 0===b||b.dispose(),null===(L=this._reflectionTexture)||void 0===L||L.dispose(),null===(t=this._emissiveTexture)||void 0===t||t.dispose(),null===(V=this._metallicTexture)||void 0===V||V.dispose(),null===(K=this._reflectivityTexture)||void 0===K||K.dispose(),null===(C=this._bumpTexture)||void 0===C||C.dispose(),null===(F=this._lightmapTexture)||void 0===F||F.dispose(),null===(u=this._metallicReflectanceTexture)||void 0===u||u.dispose(),null===(c=this._reflectanceTexture)||void 0===c||c.dispose(),null===(f=this._microSurfaceTexture)||void 0===f||f.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(a,v)}}l.PBRMATERIAL_OPAQUE=X.c.MATERIAL_OPAQUE,l.PBRMATERIAL_ALPHATEST=X.c.MATERIAL_ALPHATEST,l.PBRMATERIAL_ALPHABLEND=X.c.MATERIAL_ALPHABLEND,l.PBRMATERIAL_ALPHATESTANDBLEND=X.c.MATERIAL_ALPHATESTANDBLEND,l.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,l.LIGHTFALLOFF_PHYSICAL=0,l.LIGHTFALLOFF_GLTF=1,l.LIGHTFALLOFF_STANDARD=2,l.ForceGLSL=!1,(0,P.e)([(0,b.w)()],l.prototype,"_imageProcessingConfiguration",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsMiscDirty")],l.prototype,"debugMode",void 0)},11017:(a,v,p)=>{"use strict";p.d(v,{d:()=>t});var P=p(10905);const b=new Map;function L(a,v){(function(a){return b.delete(a)})(a)&&P.d.Warn(`Extension with the name '${name}' already exists`),b.set(a,v)}function t(a,v){"image/ktx"!==v&&"image/ktx2"!==v||(a=".ktx"),b.has(a)||(a.endsWith(".dds")&&L(".dds",(()=>p.e(12).then(p.bind(p,13101)).then((a=>new a._DDSTextureLoader)))),a.endsWith(".basis")&&L(".basis",(()=>p.e(13).then(p.bind(p,13110)).then((a=>new a._BasisTextureLoader)))),a.endsWith(".env")&&L(".env",(()=>p.e(14).then(p.bind(p,13113)).then((a=>new a._ENVTextureLoader)))),a.endsWith(".hdr")&&L(".hdr",(()=>p.e(15).then(p.bind(p,13118)).then((a=>new a._HDRTextureLoader)))),(a.endsWith(".ktx")||a.endsWith(".ktx2"))&&(L(".ktx",(()=>p.e(16).then(p.bind(p,13124)).then((a=>new a._KTXTextureLoader)))),L(".ktx2",(()=>p.e(16).then(p.bind(p,13124)).then((a=>new a._KTXTextureLoader))))),a.endsWith(".tga")&&L(".tga",(()=>p.e(17).then(p.bind(p,13132)).then((a=>new a._TGATextureLoader)))),a.endsWith(".exr")&&L(".exr",(()=>p.e(18).then(p.bind(p,13141)).then((a=>new a._ExrTextureLoader)))));const P=b.get(a);return P?Promise.resolve(P(v)):null}},11463:(a,v,p)=>{"use strict";p.d(v,{b:()=>c});var P=p(11207),b=p(11210),L=p(10893),t=p(11240),V=p(10939),K=p(11032),C=(p(10947),p(11466));class F{get wrapU(){return this._wrapU}set wrapU(a){this._wrapU=a}get wrapV(){return this._wrapV}set wrapV(a){this._wrapV=a}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(a){this._texture&&(this._texture.isCube=a)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(a){this._texture&&(this._texture.is3D=a)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(a){this._texture&&(this._texture.is2DArray=a)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(a){return void 0!==(null===a||void 0===a?void 0:a.shareDepth)}constructor(a){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=C.b.Zero(),this._cachedBaseSize=C.b.Zero(),this._initialSamplingMode=2,this._texture=F._IsRenderTargetWrapper(a)?a.texture:a,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(a){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(a,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var u=p(11287);class c extends F{set Ge(a){this._hasAlpha!==a&&(this._hasAlpha=a,this._scene&&this._scene.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))))}get Ge(){return this._hasAlpha}set getAlphaFromRGB(a){this._getAlphaFromRGB!==a&&(this._getAlphaFromRGB=a,this._scene&&this._scene.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(a){this._coordinatesIndex!==a&&(this._coordinatesIndex=a,this._scene&&this._scene.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(a){this._coordinatesMode!==a&&(this._coordinatesMode=a,this._scene&&this._scene.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(a){this._wrapU=a}get wrapV(){return this._wrapV}set wrapV(a){this._wrapV=a}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(a){this._texture?this._texture.isCube=a:this._isCube=a}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(a){this._texture&&(this._texture.is3D=a)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(a){this._texture&&(this._texture.is2DArray=a)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(a){var v;if(this._texture){if(this._texture._gammaSpace===a)return;this._texture._gammaSpace=a}else{if(this._gammaSpace===a)return;this._gammaSpace=a}null===(v=this.va())||void 0===v||v.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(a){var v;a!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=a),null===(v=this.va())||void 0===v||v.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(a){this._texture&&(this._texture._lodGenerationOffset=a)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(a){this._texture&&(this._texture._lodGenerationScale=a)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(a){this._texture&&(this._texture._linearSpecularLOD=a)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(a){this._texture&&(this._texture._irradianceTexture=a)}get uid(){return this._uid||(this._uid=(0,K.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.uj=new L.c,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,a?c._IsScene(a)?this._scene=a:this._engine=a:this._scene=V.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=v,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return t.e.IdentityReadOnly}getReflectionTextureMatrix(){return t.e.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(a){}get canRescale(){return!1}_getFromCache(a,v,p,P,b,L){const t=this._getEngine();if(!t)return null;const V=t._getUseSRGBBuffer(!!b,v),K=t.getLoadedTexturesCache();for(let C=0;C<K.length;C++){const t=K[C];if((void 0===b||V===t._useSRGBBuffer)&&(void 0===P||P===t.invertY)&&t.url===a&&t.generateMipMaps===!v&&(!p||p===t.samplingMode)&&(void 0===L||L===t.isCube))return t.incrementReferences(),t}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const a=this.va();a&&a.markAllMaterialsAsDirty(1)}readPixels(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const C=this._getEngine();if(!C)return null;const F=this.getSize();let u=F.width,c=F.height;0!==v&&(u/=Math.pow(2,v),c/=Math.pow(2,v),u=Math.round(u),c=Math.round(c)),V=Math.min(u,V),K=Math.min(c,K);try{return this._texture.isCube?C._readTexturePixels(this._texture,V,K,a,v,p,P,b,L,t):C._readTexturePixels(this._texture,V,K,-1,v,p,P,b,L,t)}catch(f){return null}}_readPixelsSync(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const L=this.getSize();let t=L.width,V=L.height;const K=this._getEngine();if(!K)return null;0!=v&&(t/=Math.pow(2,v),V/=Math.pow(2,v),t=Math.round(t),V=Math.round(V));try{return this._texture.isCube?K._readTexturePixelsSync(this._texture,t,V,a,v,p,P,b):K._readTexturePixelsSync(this._texture,t,V,-1,v,p,P,b)}catch(C){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const a=this._scene.textures.indexOf(this);if(a>=0&&this._scene.textures.splice(a,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const a=this._parentContainer.textures.indexOf(this);a>-1&&this._parentContainer.textures.splice(a,1),this._parentContainer=null}}this.uj.notifyObservers(this),this.uj.clear(),this.metadata=null,super.dispose()}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!a)return null;const v=u.b.Serialize(this);return u.b.AppendSerializedAnimations(this,v),v}static WhenAllReady(a,v){let p=a.length;if(0!==p)for(let P=0;P<a.length;P++){const b=a[P];if(b.isReady())0===--p&&v();else{const a=b.onLoadObservable;a?a.addOnce((()=>{0===--p&&v()})):0===--p&&v()}}else v()}static _IsScene(a){return"Scene"===a.getClassName()}}c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,P.e)([(0,b.O)()],c.prototype,"uniqueId",void 0),(0,P.e)([(0,b.O)()],c.prototype,"name",void 0),(0,P.e)([(0,b.O)()],c.prototype,"metadata",void 0),(0,P.e)([(0,b.O)("Ge")],c.prototype,"_hasAlpha",void 0),(0,P.e)([(0,b.O)("getAlphaFromRGB")],c.prototype,"_getAlphaFromRGB",void 0),(0,P.e)([(0,b.O)()],c.prototype,"level",void 0),(0,P.e)([(0,b.O)("coordinatesIndex")],c.prototype,"_coordinatesIndex",void 0),(0,P.e)([(0,b.O)()],c.prototype,"optimizeUVAllocation",void 0),(0,P.e)([(0,b.O)("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),(0,P.e)([(0,b.O)()],c.prototype,"wrapU",null),(0,P.e)([(0,b.O)()],c.prototype,"wrapV",null),(0,P.e)([(0,b.O)()],c.prototype,"wrapR",void 0),(0,P.e)([(0,b.O)()],c.prototype,"anisotropicFilteringLevel",void 0),(0,P.e)([(0,b.O)()],c.prototype,"isCube",null),(0,P.e)([(0,b.O)()],c.prototype,"is3D",null),(0,P.e)([(0,b.O)()],c.prototype,"is2DArray",null),(0,P.e)([(0,b.O)()],c.prototype,"gammaSpace",null),(0,P.e)([(0,b.O)()],c.prototype,"invertZ",void 0),(0,P.e)([(0,b.O)()],c.prototype,"lodLevelInAlpha",void 0),(0,P.e)([(0,b.O)()],c.prototype,"lodGenerationOffset",null),(0,P.e)([(0,b.O)()],c.prototype,"lodGenerationScale",null),(0,P.e)([(0,b.O)()],c.prototype,"linearSpecularLOD",null),(0,P.e)([(0,b.H)()],c.prototype,"irradianceTexture",null),(0,P.e)([(0,b.O)()],c.prototype,"isRenderTarget",void 0)},12437:(a,v,p)=>{"use strict";var P=p(11738),b=p(11463);b.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(b.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=P.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((a=>{this._texture._sphericalPolynomial=a,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(a){this._texture&&(this._texture._sphericalPolynomial=a)},enumerable:!0,configurable:!0})},12476:(a,v,p)=>{"use strict";p.d(v,{e:()=>c});var P=p(11207),b=p(11210),L=p(10889),t=p(11240),V=p(11463),K=p(11460),C=p(11027),F=p(10893),u=p(11287);p(11776);class c extends V.b{set boundingBoxSize(a){if(this._boundingBoxSize&&this._boundingBoxSize.equals(a))return;this._boundingBoxSize=a;const v=this.va();v&&v.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(a){this._rotationY=a,this.setReflectionTextureMatrix(t.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(a,v,p){let P="";return a.forEach((a=>P+=a)),new c(P,v,null,p,a)}static CreateFromPrefilteredData(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const L=new c(a,v,null,!1,null,null,null,void 0,!0,p,P);return v.useDelayedTextureLoading=b,L}constructor(a,v){var p;let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,R=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0;super(v),this.onLoadObservable=new F.c,this.boundingBoxPosition=t.s.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new t.e,this._buffer=null,this.name=a,this.url=a,this._noMipmap=b,this.Ge=!1,this.isCube=!0,this._textureMatrix=t.e.Identity(),this.coordinatesMode=K.c.CUBIC_MODE;let Q=null,s=null;null===P||Array.isArray(P)?(this._noMipmap=b,this._format=u,this._createPolynomials=H,Q=P,this._loaderOptions=R,this._useSRGBBuffer=X,this._lodScale=A,this._lodOffset=h):(Q=P.extensions??null,this._noMipmap=P.noMipmap??!1,L=P.files??null,s=P.buffer??null,this._format=P.format??5,c=P.prefiltered??!1,f=P.forcedExtension??null,this._createPolynomials=P.createPolynomials??!1,this._lodScale=P.lodScale??.8,this._lodOffset=P.lodOffset??0,this._loaderOptions=P.loaderOptions,this._useSRGBBuffer=P.useSRGBBuffer,V=P.X??null,C=P.onError??null),(a||L)&&this.updateURL(a,f,V,c,C,Q,null===(p=this.va())||void 0===p?void 0:p.useDelayedTextureLoading,L,s)}getClassName(){return"CubeTexture"}updateURL(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=a),this.url=a,v&&(this._forcedExtension=v);const C=a.lastIndexOf("."),F=v||(C>-1?a.substring(C).toLowerCase():""),u=0===F.indexOf(".dds"),c=0===F.indexOf(".env"),f=0===F.indexOf(".basis");if(c?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=P,P&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),V)this._files=V;else if(f||c||u||L||(L=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,L){for(let v=0;v<L.length;v++)this._files.push(a+L[v]);this._extensions=L}this._buffer=K,t?(this.delayLoadState=4,this._delayedOnLoad=p,this._delayedOnError=b):this._loadTexture(p,b)}delayLoad(a){4===this.delayLoadState&&(a&&(this._forcedExtension=a),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(a){var v,p;if(a.updateFlag===this._textureMatrix.updateFlag)return;a.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(p=this.va())||void 0===p||p.markAllMaterialsAsDirty(1,(a=>-1!==a.getActiveTextures().indexOf(this))));if(this._textureMatrix=a,null===(v=this.va())||void 0===v||!v.useRightHandedSystem)return;const P=t.k.fb[0],b=t.k.Quaternion[0],L=t.k.fb[1];this._textureMatrix.decompose(P,b,L),b.z*=-1,b.w*=-1,t.e.ComposeToRef(P,b,L,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var a;return null!==(a=this.va())&&void 0!==a&&a.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=this.va(),P=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const b=()=>{var v;(this.onLoadObservable.notifyObservers(this),P)&&(P.dispose(),null===(v=this.va())||void 0===v||v.markAllMaterialsAsDirty(1));a&&a()},t=(a,p)=>{this._loadingError=!0,this._errorObject={message:a,exception:p},v&&v(a,p),K.c.OnTextureLoadErrorObservable.notifyObservers(this)};var V;this._texture?this._texture.isReady?L.e.SetImmediate((()=>b())):this._texture.onLoadedObservable.add((()=>b())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,p,this._lodScale,this._lodOffset,a,t,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,p,this._files,this._noMipmap,a,t,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(V=this._texture)||void 0===V||V.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(a,v,p){const P=u.b.Parse((()=>{let P=!1;return a.prefiltered&&(P=a.prefiltered),new c(p+(a.url??a.name),v,a.extensions,!1,a.files||null,null,null,void 0,P,a.forcedExtension)}),a,v);if(a.boundingBoxPosition&&(P.boundingBoxPosition=t.s.bh(a.boundingBoxPosition)),a.boundingBoxSize&&(P.boundingBoxSize=t.s.bh(a.boundingBoxSize)),a.animations)for(let b=0;b<a.animations.length;b++){const v=a.animations[b],p=(0,C.c)("BABYLON.Animation");p&&P.animations.push(p.Parse(v))}return P}clone(){let a=0;const v=u.b.Clone((()=>{const v=new c(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return a=v.uniqueId,v}),this);return v.uniqueId=a,v}}(0,P.e)([(0,b.O)()],c.prototype,"url",void 0),(0,P.e)([(0,b.M)()],c.prototype,"boundingBoxPosition",void 0),(0,P.e)([(0,b.M)()],c.prototype,"boundingBoxSize",null),(0,P.e)([(0,b.O)("rotationY")],c.prototype,"rotationY",null),(0,P.e)([(0,b.O)("files")],c.prototype,"_files",void 0),(0,P.e)([(0,b.O)("forcedExtension")],c.prototype,"_forcedExtension",void 0),(0,P.e)([(0,b.O)("extensions")],c.prototype,"_extensions",void 0),(0,P.e)([(0,b.z)("textureMatrix")],c.prototype,"_textureMatrix",void 0),(0,P.e)([(0,b.z)("textureMatrixRefraction")],c.prototype,"_textureMatrixRefraction",void 0),K.c._CubeTextureParser=c.Parse,(0,C.f)("BABYLON.CubeTexture",c)},12874:(a,v,p)=>{"use strict";p.d(v,{e:()=>K});var P=p(10905),b=p(11460),L=p(11037),t=p(11656),V=p(11005);t.ThinEngine.prototype.createDynamicTexture=function(a,v,p,P){const b=new V.d(this,4);return b.baseWidth=a,b.baseHeight=v,p&&(a=this.needPOTTextures?(0,L.i)(a,this._caps.maxTextureSize):a,v=this.needPOTTextures?(0,L.i)(v,this._caps.maxTextureSize):v),b.width=a,b.height=v,b.isReady=!1,b.generateMipMaps=p,b.samplingMode=P,this.updateTextureSamplingMode(P,b),this._internalTexturesCache.push(b),b},t.ThinEngine.prototype.updateDynamicTexture=function(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!a)return;const t=this._gl,V=t.TEXTURE_2D,K=this._bindTextureDirectly(V,a,!0,L);this._unpackFlipY(void 0===p?a.invertY:p),P&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const C=this._getWebGLTextureType(a.type),F=this._getInternalFormat(b||a.format),u=this._getRGBABufferInternalSizedFormat(a.type,F);t.texImage2D(V,0,u,F,C,v),a.generateMipMaps&&t.generateMipmap(V),K||this._bindTextureDirectly(V,null),P&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),b&&(a.format=b),a._dynamicTextureSource=v,a._premulAlpha=P,a.invertY=p||!1,a.isReady=!0};class K extends b.c{constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,V=arguments.length>6?arguments[6]:void 0;const K=!p||p._isScene;super(null,K?p:null===p||void 0===p?void 0:p.sd,K?!P:p,V,L,void 0,void 0,void 0,void 0,t),this.name=a,this.wrapU=b.c.CLAMP_ADDRESSMODE,this.wrapV=b.c.CLAMP_ADDRESSMODE,this._generateMipMaps=P;const C=this._getEngine();if(!C)return;if(v.getContext)this._canvas=v,this._ownCanvas=!1,this._texture=C.createDynamicTexture(this._canvas.width,this._canvas.height,P,L);else{this._canvas=C.createCanvas(1,1),this._ownCanvas=!0;const a=v;a.width||0===a.width?this._texture=C.createDynamicTexture(a.width,a.height,P,L):this._texture=C.createDynamicTexture(v,v,P,L)}const F=this.getSize();this._canvas.width!==F.width&&(this._canvas.width=F.width),this._canvas.height!==F.height&&(this._canvas.height=F.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(a){this._canvas.width=a.width,this._canvas.height=a.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(a.width,a.height,this._generateMipMaps,this.samplingMode)}scale(a){const v=this.getSize();v.width*=a,v.height*=a,this._recreate(v)}scaleTo(a,v){const p=this.getSize();p.width=a,p.height=v,this._recreate(p)}getContext(){return this._context}clear(a){const v=this.getSize();a&&(this._context.fillStyle=a),this._context.clearRect(0,0,v.width,v.height)}update(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===a||a,v,this._format||void 0,void 0,p)}drawText(a,v,p,P,b,L,t){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const K=this.getSize();if(L&&(this._context.fillStyle=L,this._context.fillRect(0,0,K.width,K.height)),this._context.font=P,null===v||void 0===v){const p=this._context.measureText(a);v=(K.width-p.width)/2}if(null===p||void 0===p){const a=parseInt(P.replace(/\D/g,""));p=K.height/2+a/3.65}this._context.fillStyle=b||"",this._context.fillText(a,v,p),V&&this.update(t)}dispose(){var a,v;(super.dispose(),this._ownCanvas)&&(null===(a=this._canvas)||void 0===a||null===(v=a.remove)||void 0===v||v.call(a));this._canvas=null,this._context=null}clone(){const a=this.va();if(!a)return this;const v=this.getSize(),p=new K(this.name,v,a,this._generateMipMaps);return p.Ge=this.Ge,p.level=this.level,p.wrapU=this.wrapU,p.wrapV=this.wrapV,p}serialize(){const a=this.va();a&&!a.isReady()&&P.d.Warn("The scene must be ready before serializing the dynamic texture");const v=super.serialize();return K._IsCanvasElement(this._canvas)&&(v.base64String=this._canvas.toDataURL()),v.invertY=this._invertY,v.samplingMode=this.samplingMode,v}static _IsCanvasElement(a){return void 0!==a.toDataURL}_rebuild(){this.update()}}},11005:(a,v,p)=>{"use strict";p.d(v,{d:()=>t});var P,b=p(10893),L=p(11011);!function(a){a[a.Unknown=0]="Unknown",a[a.Url=1]="Url",a[a.Temp=2]="Temp",a[a.Raw=3]="Raw",a[a.Dynamic=4]="Dynamic",a[a.RenderTarget=5]="RenderTarget",a[a.MultiRenderTarget=6]="MultiRenderTarget",a[a.Cube=7]="Cube",a[a.CubeRaw=8]="CubeRaw",a[a.CubePrefiltered=9]="CubePrefiltered",a[a.Raw3D=10]="Raw3D",a[a.Raw2DArray=11]="Raw2DArray",a[a.DepthStencil=12]="DepthStencil",a[a.CubeRawRGBD=13]="CubeRawRGBD",a[a.Depth=14]="Depth"}(P||(P={}));class t extends L.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(a){this.generateMipMaps=a}get uniqueId(){return this._uniqueId}_setUniqueId(a){this._uniqueId=a}getEngine(){return this._engine}get source(){return this._source}constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new b.c,this.onErrorObservable=new b.c,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=a,this._source=v,this._uniqueId=t._Counter++,p||(this._hardwareTexture=a._createHardwareTexture())}incrementReferences(){this._references++}updateSize(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,a,v,p),this.width=a,this.height=v,this.depth=p,this.baseWidth=a,this.baseHeight=v,this.baseDepth=p,this._size=a*v*p}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const a=this.onRebuildCallback(this),v=v=>{v._swapAndDie(this,!1),this.isReady=a.isReady};return void(a.isAsync?a.proxy.then(v):v(a.proxy))}let a;switch(this.source){case 2:case 12:case 14:break;case 1:return void(a=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(a=>{a._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:a=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),a._swapAndDie(this,!1),this.isReady=!0;break;case 10:a=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),a._swapAndDie(this,!1),this.isReady=!0;break;case 11:a=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),a._swapAndDie(this,!1),this.isReady=!0;break;case 4:a=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),a._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(a=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{a._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:a=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),a._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return a=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(a=>{a&&a._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(a._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(a){var v;let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(v=this._hardwareTexture)||void 0===v||v.setUsage(a._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),a._hardwareTexture=this._hardwareTexture,p&&(a._isRGBD=this._isRGBD),this._lodTextureHigh&&(a._lodTextureHigh&&a._lodTextureHigh.dispose(),a._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(a._lodTextureMid&&a._lodTextureMid.dispose(),a._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(a._lodTextureLow&&a._lodTextureLow.dispose(),a._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(a._irradianceTexture&&a._irradianceTexture.dispose(),a._irradianceTexture=this._irradianceTexture);const P=this._engine.getLoadedTexturesCache();let b=P.indexOf(this);-1!==b&&P.splice(b,1),b=P.indexOf(a),-1===b&&P.push(a)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}t._Counter=0},11676:(a,v,p)=>{"use strict";p.d(v,{d:()=>b});var P=p(11460);class b extends P.c{constructor(a,v,p,b,L){let t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0;super(null,L,!t,V,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,F),this.format=b,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==C||(K=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==C||(K=1),this._texture=this._engine.createRawTexture(a,v,p,b,t,V,K,null,C,F??0,u??!1),this.wrapU=P.c.CLAMP_ADDRESSMODE,this.wrapV=P.c.CLAMP_ADDRESSMODE)}update(a){this._getEngine().updateRawTexture(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const a=new b(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return a._texture=this._texture,this._texture.incrementReferences(),a}static CreateLuminanceTexture(a,v,p,P){return new b(a,v,p,1,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(a,v,p,P){return new b(a,v,p,2,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(a,v,p,P){return new b(a,v,p,0,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(a,v,p,P){return new b(a,v,p,4,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(a,v,p,P){return new b(a,v,p,5,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(a,v,p,P){return new b(a,v,p,5,P,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(a,v,p,L){let t=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.c.TRILINEAR_SAMPLINGMODE;return new b(a,v,p,6,L,t,V,K,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(a,v,p,L){let t=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.c.TRILINEAR_SAMPLINGMODE;return new b(a,v,p,6,L,t,V,K,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12043:(a,v,p)=>{"use strict";p.d(v,{b:()=>b});var P=p(11460);class b extends P.c{get depth(){return this._depth}constructor(a,v,p,b,L,t){let V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:P.c.TRILINEAR_SAMPLINGMODE,F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;super(null,t,!V,K),this.format=L,this._texture=t.getEngine().createRawTexture2DArray(a,v,p,b,L,V,K,C,null,F,u),this._depth=b,this.is2DArray=!0}update(a){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(a,v,p,P,L){return new b(a,v,p,P,5,L,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11751:(a,v,p)=>{"use strict";p.d(v,{b:()=>c});var P=p(10893),b=p(11240),L=p(11460),t=p(11318),V=p(11325),K=p(11254),C=p(11037),F=p(10980),u=p(10905);F.c.prototype.setDepthStencilTexture=function(a,v){this._engine.setDepthStencilTexture(this._samplers[a],this._uniforms[a],v,a)};class c extends L.c{get renderList(){return this._renderList}set renderList(a){this._renderList!==a&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),a&&(this._unObserveRenderList=(0,K.i)(a,this._renderListHasChanged)),this._renderList=a)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(a){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(a)}set onBeforeRender(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)}set onAfterRender(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)}set onClear(a){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(a)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(a,v){let p;p=Array.isArray(a)?a:[a];for(let P=0;P<p.length;++P)for(let a=0;a<this._renderPassIds.length;++a)p[P].setMaterialForRenderPass(this._renderPassIds[a],void 0!==v?Array.isArray(v)?v[a]:v:void 0)}get isMulti(){var a;return(null===(a=this._renderTarget)||void 0===a?void 0:a.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(a){if(this._boundingBoxSize&&this._boundingBoxSize.equals(a))return;this._boundingBoxSize=a;const v=this.va();v&&v.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var a;return(null===(a=this._renderTarget)||void 0===a?void 0:a._depthStencilTexture)??null}constructor(a,v,p){let t,K=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:L.c.TRILINEAR_SAMPLINGMODE,f=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],H=arguments.length>9&&void 0!==arguments[9]&&arguments[9],A=arguments.length>10&&void 0!==arguments[10]&&arguments[10],h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,R=arguments.length>12&&void 0!==arguments[12]&&arguments[12],X=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0,s=arguments.length>15&&void 0!==arguments[15]&&arguments[15],D=arguments.length>16&&void 0!==arguments[16]&&arguments[16],y=!0;if("object"===typeof K){const a=K;K=!!a.generateMipMaps,C=a.doNotChangeAspectRatio??!0,F=a.type??0,u=!!a.isCube,c=a.samplingMode??L.c.TRILINEAR_SAMPLINGMODE,f=a.generateDepthBuffer??!0,H=!!a.generateStencilBuffer,A=!!a.isMulti,h=a.format??5,R=!!a.delayAllocation,X=a.samples,Q=a.creationFlags,s=!!a.noColorAttachment,D=!!a.useSRGBBuffer,t=a.colorAttachment,y=a.gammaSpace??y}if(super(null,p,!K,void 0,c,void 0,void 0,void 0,void 0,h),this._unObserveRenderList=null,this._renderListHasChanged=(a,v)=>{const p=this._renderList?this._renderList.length:0;var P;(0===v&&p>0||0===p)&&(null===(P=this.va())||void 0===P||P.meshes.forEach((a=>{a._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new P.c,this.onAfterUnbindObservable=new P.c,this.onBeforeRenderObservable=new P.c,this.onAfterRenderObservable=new P.c,this.onClearObservable=new P.c,this.onResizeObservable=new P.c,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=b.s.Zero(),this._dumpToolsLoading=!1,!(p=this.va()))return;const Z=this.va().getEngine();this._gammaSpace=y,this._coordinatesMode=L.c.PROJECTION_MODE,this.renderList=[],this.name=a,this.isRenderTarget=!0,this._initialSizeParameter=v,this._renderPassIds=[],this._isCubeData=u,this._processSizeParameter(v),this.renderPassId=this._renderPassIds[0],this._resizeObserver=Z.onResizeObservable.add((()=>{})),this._generateMipMaps=!!K,this._doNotChangeAspectRatio=C,this._renderingManager=new V.e(p),this._renderingManager._useSceneAutoClearSetup=!0,A||(this._renderTargetOptions={generateMipMaps:K,type:F,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:f,generateStencilBuffer:H,samples:X,creationFlags:Q,noColorAttachment:s,useSRGBBuffer:D,colorAttachment:t,label:this.name},this.samplingMode===L.c.NEAREST_SAMPLINGMODE&&(this.wrapU=L.c.CLAMP_ADDRESSMODE,this.wrapV=L.c.CLAMP_ADDRESSMODE),R||(u?(this._renderTarget=p.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=L.c.INVCUBIC_MODE,this._textureMatrix=b.e.Identity()):this._renderTarget=p.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==X&&(this.samples=X)))}createDepthStencilTexture(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,t=arguments.length>5?arguments[5]:void 0;null===(a=this._renderTarget)||void 0===a||a.createDepthStencilTexture(v,p,P,b,L,t)}_releaseRenderPassId(){if(this._scene){const a=this._scene.getEngine();for(let v=0;v<this._renderPassIds.length;++v)a.releaseRenderPassId(this._renderPassIds[v])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const a=this._scene.getEngine(),v=this._isCubeData?6:this.getRenderLayers()||1;for(let p=0;p<v;++p)this._renderPassIds[p]=a.createRenderPassId(`RenderTargetTexture - ${this.name}#${p}`)}_processSizeParameter(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a.ratio){this._sizeRatio=a.ratio;const v=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(v.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(v.getRenderHeight(),this._sizeRatio)}}else this._size=a;v&&this._createRenderPassId()}get samples(){var a;return(null===(a=this._renderTarget)||void 0===a?void 0:a.samples)??this._samples}set samples(a){this._renderTarget&&(this._samples=this._renderTarget.setSamples(a))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(a){this._refreshRate=a,this.resetRefreshCounter()}addPostProcess(a){if(!this._postProcessManager){const a=this.va();if(!a)return;this._postProcessManager=new t.d(a),this._postProcesses=new Array}this._postProcesses.push(a),this._postProcesses[0].cj=!1}clearPostProcesses(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(a)for(const a of this._postProcesses)a.dispose();this._postProcesses=[]}}removePostProcess(a){if(!this._postProcesses)return;const v=this._postProcesses.indexOf(a);-1!==v&&(this._postProcesses.splice(v,1),this._postProcesses.length>0&&(this._postProcesses[0].cj=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const a=this._size.layers;if(a)return a;const v=this._size.depth;return v||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(a){const v=Math.max(1,this.getRenderSize()*a);this.resize(v)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(a){var v;const p=this.isCube;null===(v=this._renderTarget)||void 0===v||v.dispose(),this._renderTarget=null;const P=this.va();P&&(this._processSizeParameter(a,!1),this._renderTarget=p?P.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):P.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(a,v)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(p.bind(p,12469)).then((a=>this._dumpTools=a))),this._render(!1,!1,!0)}_render(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=this.va();if(!P)return p;const b=P.getEngine();if(void 0!==this.useCameraPostProcesses&&(a=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let a=0;a<this._waitingRenderList.length;a++){const v=this._waitingRenderList[a],p=P.getMeshById(v);p&&this.renderList.push(p)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const a=this.va();if(!a)return p;const v=a.meshes;for(let p=0;p<v.length;p++){const a=v[p];this.renderListPredicate(a)&&this.renderList.push(a)}}const L=b.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const t=this.activeCamera??P.activeCamera,V=P.activeCamera;t&&(t!==P.activeCamera&&(P.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(!0)),P.activeCamera=t),b.setViewport(t.rigParent?t.rigParent.viewport:t.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let K=p;if(p){P.getViewMatrix()||P.updateTransformMatrix();const a=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let L=0;L<a&&K;L++){let a=null;const v=this.renderList?this.renderList:P.getActiveMeshes().data,t=this.renderList?this.renderList.length:P.getActiveMeshes().length;b.currentRenderPassId=this._renderPassIds[L],this.onBeforeRenderObservable.notifyObservers(L),this.getCustomRenderList&&(a=this.getCustomRenderList(L,v,t)),a||(a=v),this._doNotChangeAspectRatio||P.updateTransformMatrix(!0);for(let P=0;P<a.length&&K;++P){const v=a[P];if(v.isEnabled()&&!v.isBlocked&&v.isVisible&&v.rg)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(v,this.refreshRate,p)){K=!1;continue}}else if(!v.isReady(!0)){K=!1;continue}}this.onAfterRenderObservable.notifyObservers(L),(this.is2DArray||this.is3D||this.isCube)&&(P.incrementRenderId(),P.resetCachedMaterial())}const v=this.particleSystemList||P.Bj;for(const p of v)p.isReady()||(K=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let C=0;C<6;C++)this._renderToTarget(C,a,v,void 0,t),P.incrementRenderId(),P.resetCachedMaterial();else this._renderToTarget(0,a,v,void 0,t);else for(let C=0;C<this.getRenderLayers();C++)this._renderToTarget(0,a,v,C,t),P.incrementRenderId(),P.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),b.currentRenderPassId=L,P.activeCamera=V,V&&(this.activeCamera&&this.activeCamera!==P.activeCamera&&P.setTransformMatrix(V.getViewMatrix(),V.getProjectionMatrix(!0)),b.setViewport(V.viewport)),P.resetCachedMaterial(),K}_bestReflectionRenderTargetDimension(a,v){const p=a*v,P=(0,C.q)(p+16384/(128+p));return Math.min((0,C.e)(a),P)}_prepareRenderingManager(a,v,p,P){const b=this.va();if(!b)return;this._renderingManager.reset();const L=b.getRenderId();for(let V=0;V<v;V++){const v=a[V];if(v&&!v.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(v,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!v.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!v._internalAbstractMeshDataInfo._currentLODIsUpToDate&&p&&(v._internalAbstractMeshDataInfo._currentLOD=b.customLODSelector?b.customLODSelector(v,p):v.getLOD(p),v._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!v._internalAbstractMeshDataInfo._currentLOD)continue;let a,t=v._internalAbstractMeshDataInfo._currentLOD;if(t!==v&&0!==t.billboardMode&&t.Zj(),t._preActivateForIntermediateRendering(L),a=!(!P||!p)&&0===(v.layerMask&p.layerMask),v.isEnabled()&&v.isVisible&&v.rg&&!a){if(t!==v&&t._activate(L,!0),v._activate(L,!0)&&v.rg.length){v.isAnInstance?v._internalAbstractMeshDataInfo._actAsRegularMesh&&(t=v):t._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,t._internalAbstractMeshDataInfo._isActiveIntermediate=!0,b._prepareSkeleton(t);for(let a=0;a<t.rg.length;a++){const v=t.rg[a];this._renderingManager.dispatch(v,t)}}v._postActivate()}}}const t=this.particleSystemList||b.Bj;for(let V=0;V<t.length;V++){const a=t[V],v=a.j;a.isStarted()&&v&&(!v.position||v.isEnabled())&&this._renderingManager.dispatchParticles(a)}}_bindFrameBuffer(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=this.va();if(!p)return;const P=p.getEngine();this._renderTarget&&P.bindFramebuffer(this._renderTarget,this.isCube?a:void 0,void 0,void 0,this.ignoreCameraViewport,0,v)}_unbindFrameBuffer(a,v){this._renderTarget&&a.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(v)}))}_prepareFrame(a,v,p,P){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):P&&a.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(v,p)}_renderToTarget(a,v,p){var P,b;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const V=this.va();if(!V)return;const K=V.getEngine();this._prepareFrame(V,a,L,v),null===(P=K._debugPushGroup)||void 0===P||P.call(K,`render to face #${a} layer #${L}`,2),this.is2DArray||this.is3D?(K.currentRenderPassId=this._renderPassIds[L],this.onBeforeRenderObservable.notifyObservers(L)):(K.currentRenderPassId=this._renderPassIds[a],this.onBeforeRenderObservable.notifyObservers(a));if(K.snapshotRendering&&1===K.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(K):this.skipInitialClear||K.clear(this.clearColor||V.clearColor,!0,!0,!0);else{var C;let P=null;const b=this.renderList?this.renderList:V.getActiveMeshes().data,F=this.renderList?this.renderList.length:V.getActiveMeshes().length;this.getCustomRenderList&&(P=this.getCustomRenderList(this.is2DArray||this.is3D?L:a,b,F)),P?this._prepareRenderingManager(P,P.length,t,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(b,F,t,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),P=b);for(const v of V._beforeRenderTargetClearStage)v.action(this,a,L);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(K):this.skipInitialClear||K.clear(this.clearColor||V.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||V.updateTransformMatrix(!0);for(const v of V._beforeRenderTargetDrawStage)v.action(this,a,L);this._renderingManager.render(this.customRenderFunction,P,this.renderParticles,this.renderSprites);for(const v of V._afterRenderTargetDrawStage)v.action(this,a,L);const c=(null===(C=this._texture)||void 0===C?void 0:C.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,a,this._postProcesses,this.ignoreCameraViewport):v&&V.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,a);for(const v of V._afterRenderTargetPostProcessStage)v.action(this,a,L);this._texture&&(this._texture.generateMipMaps=c),this._doNotChangeAspectRatio||V.updateTransformMatrix(!0),p&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),K):u.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(b=K._debugPopGroup)||void 0===b||b.call(K,2),this._unbindFrameBuffer(K,a),this._texture&&this.isCube&&5===a&&K.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(a,v,p,P)}setRenderingAutoClearDepthStencil(a,v){this._renderingManager.setRenderingAutoClearDepthStencil(a,v),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const a=this.getSize(),v=new c(this.name,a,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return v.Ge=this.Ge,v.level=this.level,v.coordinatesMode=this.coordinatesMode,this.renderList&&(v.renderList=this.renderList.slice(0)),v}serialize(){if(!this.name)return null;const a=super.serialize();if(a.renderTargetSize=this.getRenderSize(),a.renderList=[],this.renderList)for(let v=0;v<this.renderList.length;v++)a.renderList.push(this.renderList[v].id);return a}disposeFramebufferObjects(){var a;null===(a=this._renderTarget)||void 0===a||a.dispose(!0)}releaseInternalTexture(){var a;null===(a=this._renderTarget)||void 0===a||a.releaseTextures(),this._texture=null}dispose(){var a;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const v=this.va();if(!v)return;let p=v.customRenderTargets.indexOf(this);p>=0&&v.customRenderTargets.splice(p,1);for(const P of v.cameras)p=P.customRenderTargets.indexOf(this),p>=0&&P.customRenderTargets.splice(p,1);null===(a=this._renderTarget)||void 0===a||a.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===c.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=c.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}c.REFRESHRATE_RENDER_ONCE=0,c.REFRESHRATE_RENDER_ONEVERYFRAME=1,c.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,L.c._CreateRenderTargetTexture=(a,v,p,P,b)=>new c(a,v,p,P)},11460:(a,v,p)=>{"use strict";p.d(v,{c:()=>Q});var P=p(11207),b=p(11210),L=p(10893),t=p(11240),V=p(11463),K=p(11027),C=p(10926),F=p(10968),u=p(11025),c=p(11356),f=p(10959);function H(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=v.width,b=v.height;if(a instanceof Float32Array){let v=a.byteLength/a.BYTES_PER_ELEMENT;const p=new Uint8Array(v);for(;--v>=0;){let P=a[v];P<0?P=0:P>1&&(P=1),p[v]=255*P}a=p}const L=document.createElement("canvas");L.width=P,L.height=b;const t=L.getContext("2d");if(!t)return null;const V=t.createImageData(P,b);if(V.data.set(a),t.putImageData(V,0,0),p){const a=document.createElement("canvas");a.width=P,a.height=b;const v=a.getContext("2d");return v?(v.translate(0,b),v.scale(1,-1),v.drawImage(L,0,0),a.toDataURL("image/png")):null}return L.toDataURL("image/png")}function A(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const P=a.getInternalTexture();if(!P)return null;const b=a._readPixelsSync(v,p);return b?H(b,a.getSize(),P.invertY):null}async function h(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const P=a.getInternalTexture();if(!P)return null;const b=await a.readPixels(v,p);return b?H(b,a.getSize(),P.invertY):null}var R=p(11470),X=p(11287);class Q extends V.b{static _CreateVideoTexture(a,v,p){arguments.length>5&&void 0!==arguments[5]||Q.TRILINEAR_SAMPLINGMODE;throw(0,C.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(a){this._isBlocking=a}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(a,v,p,P){let b,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q.TRILINEAR_SAMPLINGMODE,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9?arguments[9]:void 0,f=arguments.length>10?arguments[10]:void 0,H=arguments.length>11?arguments[11]:void 0,A=arguments.length>12?arguments[12]:void 0,h=arguments.length>13?arguments[13]:void 0;super(v),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new L.c,this._isBlocking=!0,this.name=a||"",this.url=a;let X=!1,s=null,D=!0;"object"===typeof p&&null!==p?(b=p.noMipmap??!1,P=p.invertY??!R.b,t=p.samplingMode??Q.TRILINEAR_SAMPLINGMODE,V=p.X??null,K=p.onError??null,C=p.buffer??null,u=p.deleteBuffer??!1,c=p.format,f=p.mimeType,H=p.loaderOptions,A=p.creationFlags,X=p.useSRGBBuffer??!1,s=p.internalTexture??null,D=p.gammaSpace??D):b=!!p,this._gammaSpace=D,this._noMipmap=b,this._invertY=void 0===P?!R.b:P,this._initialSamplingMode=t,this._buffer=C,this._deleteBuffer=u,this._mimeType=f,this._loaderOptions=H,this._creationFlags=A,this._useSRGBBuffer=X,this._forcedExtension=h,c&&(this._format=c);const y=this.va(),Z=this._getEngine();if(!Z)return;Z.onBeforeTextureInitObservable.notifyObservers(this);const M=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),V&&V(),!this.isBlocking&&y&&y.resetCachedMaterial()},S=(a,v)=>{this._loadingError=!0,this._errorObject={message:a,exception:v},K&&K(a,v),Q.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!s)return this._delayedOnLoad=M,void(this._delayedOnError=S);if(this._texture=s??this._getFromCache(this.url,b,t,this._invertY,X,this.isCube),this._texture)if(this._texture.isReady)F.b.SetImmediate((()=>M()));else{const a=this._texture.onLoadedObservable.add(M);this._texture.onErrorObservable.add((v=>{var p;S(v.message,v.exception),null===(p=this._texture)||void 0===p||p.onLoadedObservable.remove(a)}))}else if(y&&y.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=M,this._delayedOnError=S;else{try{this._texture=Z.createTexture(this.url,b,this._invertY,y,t,M,S,this._buffer,void 0,this._format,this._forcedExtension,f,H,A,X)}catch(n){throw S("error loading",n),n}u&&(this._buffer=null)}}updateURL(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(a=>a.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=a),this.url=a,this._buffer=v,this._forcedExtension=P,this.delayLoadState=4,p&&(this._delayedOnLoad=p),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const a=this.va();a&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?F.b.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=a.getEngine().createTexture(this.url,this._noMipmap,this._invertY,a,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(a,v,p,P){a*=this._cachedUScale,v*=this._cachedVScale,a-=this.uRotationCenter*this._cachedUScale,v-=this.vRotationCenter*this._cachedVScale,p-=this.wRotationCenter,t.s.TransformCoordinatesFromFloatsToRef(a,v,p,this._rowGenerationMatrix,P),P.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,P.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,P.z+=this.wRotationCenter}getTextureMatrix(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*a===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*a,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=t.e.Zero(),this._rowGenerationMatrix=new t.e,this._t0=t.s.Zero(),this._t1=t.s.Zero(),this._t2=t.s.Zero()),t.e.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(t.e.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,t.k.Matrix[0]),t.e.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,t.k.Matrix[1]),t.e.ScalingToRef(this._cachedUScale,this._cachedVScale,0,t.k.Matrix[2]),t.e.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,t.k.Matrix[3]),t.k.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(t.k.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(t.k.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(t.k.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Bi(this._t0),this._t2.Bi(this._t0),t.e.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const v=this.va();if(!v)return this._cachedTextureMatrix;const p=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&p!==this._cachedIdentity3x2&&v.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const a=this.va();if(!a)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==Q.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===a.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=t.e.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=t.e.Zero());const v=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case Q.PLANAR_MODE:t.e.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case Q.PROJECTION_MODE:{t.e.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const v=a.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=v.updateFlag,v.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:t.e.IdentityToRef(this._cachedReflectionTextureMatrix)}return v&&a.markAllMaterialsAsDirty(1,(a=>a.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const a={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return X.b.Clone((()=>new Q(this._texture?this._texture.url:null,this.va(),a)),this)}serialize(){var a;const v=this.name;Q.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const p=super.serialize(Q._SerializeInternalTextureUniqueId);if(!p)return null;var P;((Q.SerializeBuffers||Q.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(p.base64String=this._buffer,p.name=p.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?p.base64String="data:image/png;base64,"+(0,f.n)(this._buffer):(Q.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(p.base64String=!this._engine||this._engine._features.supportSyncTextureRead?A(this):h(this))),p.invertY=this._invertY,p.samplingMode=this.samplingMode,p._creationFlags=this._creationFlags,p._useSRGBBuffer=this._useSRGBBuffer,Q._SerializeInternalTextureUniqueId)&&(p.internalTextureUniqueId=null===(P=this._texture)||void 0===P?void 0:P.uniqueId);return p.internalTextureLabel=null===(a=this._texture)||void 0===a?void 0:a.label,p.noMipmap=this._noMipmap,this.name=v,p}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(a,v,p){if(a.customType){const P=u.e.Instantiate(a.customType).Parse(a,v,p);return a.samplingMode&&P.updateSamplingMode&&P._samplingMode&&P._samplingMode!==a.samplingMode&&P.updateSamplingMode(a.samplingMode),P}if(a.isCube&&!a.isRenderTarget)return Q._CubeTextureParser(a,v,p);const P=void 0!==a.internalTextureUniqueId;if(!a.name&&!a.isRenderTarget&&!P)return null;let b;if(P){const p=v.getEngine().getLoadedTexturesCache();for(const v of p)if(v.uniqueId===a.internalTextureUniqueId){b=v;break}}const L=v=>{if(v&&v._texture&&(v._texture._cachedWrapU=null,v._texture._cachedWrapV=null,v._texture._cachedWrapR=null),a.samplingMode){const p=a.samplingMode;v&&v.samplingMode!==p&&v.updateSamplingMode(p)}if(v&&a.animations)for(let p=0;p<a.animations.length;p++){const P=a.animations[p],b=(0,K.c)("BABYLON.Animation");b&&v.animations.push(b.Parse(P))}v&&v._texture&&(P&&!b&&v._texture._setUniqueId(a.internalTextureUniqueId),v._texture.label=a.internalTextureLabel)};return X.b.Parse((()=>{let P=!0;if(a.noMipmap&&(P=!1),a.mirrorPlane){const p=Q._CreateMirror(a.name,a.renderTargetSize,v,P);return p._waitingRenderList=a.renderList,p.mirrorPlane=c.b.bh(a.mirrorPlane),L(p),p}if(a.isRenderTarget){let p=null;if(a.isCube){if(v.reflectionProbes)for(let P=0;P<v.reflectionProbes.length;P++){const p=v.reflectionProbes[P];if(p.name===a.name)return p.cubeTexture}}else p=Q._CreateRenderTargetTexture(a.name,a.renderTargetSize,v,P,a._creationFlags??0),p._waitingRenderList=a.renderList;return L(p),p}if(a.isVideo){const b=Q._CreateVideoTexture(p+(a.url||a.name),p+(a.src||a.url),v,P,a.invertY,a.samplingMode,a.settings||{});return L(b),b}{let t;if(a.base64String&&!b)t=Q.CreateFromBase64String(a.base64String,a.base64String,v,!P,a.invertY,a.samplingMode,(()=>{L(t)}),a._creationFlags??0,a._useSRGBBuffer??!1),t.name=a.name;else{let V;V=a.name&&(a.name.indexOf("://")>0||a.name.startsWith("data:"))?a.name:p+a.name,a.url&&(a.url.startsWith("data:")||Q.UseSerializedUrlIfAny)&&(V=a.url);const K={noMipmap:!P,invertY:a.invertY,samplingMode:a.samplingMode,X:()=>{L(t)},internalTexture:b};t=new Q(V,v,K)}return t}}),a,v)}static CreateFromBase64String(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Q.TRILINEAR_SAMPLINGMODE;return new Q("data:"+v,p,P,b,L,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Q.TRILINEAR_SAMPLINGMODE,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,F=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0;return"data:"!==a.substring(0,5)&&(a="data:"+a),new Q(a,p,b,L,t,V,K,v,P,C,void 0,void 0,F,u)}}Q.SerializeBuffers=!0,Q.ForceSerializeBuffers=!1,Q.OnTextureLoadErrorObservable=new L.c,Q._SerializeInternalTextureUniqueId=!1,Q._CubeTextureParser=(a,v,p)=>{throw(0,C.c)("CubeTexture")},Q._CreateMirror=(a,v,p,P)=>{throw(0,C.c)("MirrorTexture")},Q._CreateRenderTargetTexture=(a,v,p,P,b)=>{throw(0,C.c)("RenderTargetTexture")},Q.NEAREST_SAMPLINGMODE=1,Q.NEAREST_NEAREST_MIPLINEAR=8,Q.BILINEAR_SAMPLINGMODE=2,Q.LINEAR_LINEAR_MIPNEAREST=11,Q.TRILINEAR_SAMPLINGMODE=3,Q.LINEAR_LINEAR_MIPLINEAR=3,Q.NEAREST_NEAREST_MIPNEAREST=4,Q.NEAREST_LINEAR_MIPNEAREST=5,Q.NEAREST_LINEAR_MIPLINEAR=6,Q.NEAREST_LINEAR=7,Q.NEAREST_NEAREST=1,Q.LINEAR_NEAREST_MIPNEAREST=9,Q.LINEAR_NEAREST_MIPLINEAR=10,Q.LINEAR_LINEAR=2,Q.LINEAR_NEAREST=12,Q.EXPLICIT_MODE=0,Q.SPHERICAL_MODE=1,Q.PLANAR_MODE=2,Q.CUBIC_MODE=3,Q.PROJECTION_MODE=4,Q.SKYBOX_MODE=5,Q.INVCUBIC_MODE=6,Q.EQUIRECTANGULAR_MODE=7,Q.FIXED_EQUIRECTANGULAR_MODE=8,Q.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Q.CLAMP_ADDRESSMODE=0,Q.WRAP_ADDRESSMODE=1,Q.MIRROR_ADDRESSMODE=2,Q.UseSerializedUrlIfAny=!1,(0,P.e)([(0,b.O)()],Q.prototype,"url",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"uOffset",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"vOffset",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"uScale",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"vScale",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"uAng",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"vAng",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"wAng",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"uRotationCenter",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"vRotationCenter",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"wRotationCenter",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"homogeneousRotationInUVTransform",void 0),(0,P.e)([(0,b.O)()],Q.prototype,"isBlocking",null),(0,K.f)("BABYLON.Texture",Q),X.b._TextureParser=Q.Parse},11011:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{get wrapU(){return this._cachedWrapU}set wrapU(a){this._cachedWrapU=a}get wrapV(){return this._cachedWrapV}set wrapV(a){this._cachedWrapV=a}get wrapR(){return this._cachedWrapR}set wrapR(a){this._cachedWrapR=a}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(a){this._cachedAnisotropicFilteringLevel=a}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(a){this._comparisonFunction=a}get useMipMaps(){return this._useMipMaps}set useMipMaps(a){this._useMipMaps=a}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=a,this._cachedWrapV=v,this._cachedWrapR=p,this._cachedAnisotropicFilteringLevel=P,this.samplingMode=b,this._comparisonFunction=L,this}compareSampler(a){return this._cachedWrapU===a._cachedWrapU&&this._cachedWrapV===a._cachedWrapV&&this._cachedWrapR===a._cachedWrapR&&this._cachedAnisotropicFilteringLevel===a._cachedAnisotropicFilteringLevel&&this.samplingMode===a.samplingMode&&this._comparisonFunction===a._comparisonFunction&&this._useMipMaps===a._useMipMaps}}},11448:(a,v,p)=>{"use strict";function P(a){-1===a.indexOf("vClipPlane")&&a.push("vClipPlane"),-1===a.indexOf("vClipPlane2")&&a.push("vClipPlane2"),-1===a.indexOf("vClipPlane3")&&a.push("vClipPlane3"),-1===a.indexOf("vClipPlane4")&&a.push("vClipPlane4"),-1===a.indexOf("vClipPlane5")&&a.push("vClipPlane5"),-1===a.indexOf("vClipPlane6")&&a.push("vClipPlane6")}function b(a,v,p){const P=!!(a.clipPlane??v.clipPlane),b=!!(a.clipPlane2??v.clipPlane2),L=!!(a.clipPlane3??v.clipPlane3),t=!!(a.clipPlane4??v.clipPlane4),V=!!(a.clipPlane5??v.clipPlane5),K=!!(a.clipPlane6??v.clipPlane6);P&&p.push("#define CLIPPLANE"),b&&p.push("#define CLIPPLANE2"),L&&p.push("#define CLIPPLANE3"),t&&p.push("#define CLIPPLANE4"),V&&p.push("#define CLIPPLANE5"),K&&p.push("#define CLIPPLANE6")}function L(a,v,p){let P=!1;const b=!!(a.clipPlane??v.clipPlane),L=!!(a.clipPlane2??v.clipPlane2),t=!!(a.clipPlane3??v.clipPlane3),V=!!(a.clipPlane4??v.clipPlane4),K=!!(a.clipPlane5??v.clipPlane5),C=!!(a.clipPlane6??v.clipPlane6);return p.CLIPPLANE!==b&&(p.CLIPPLANE=b,P=!0),p.CLIPPLANE2!==L&&(p.CLIPPLANE2=L,P=!0),p.CLIPPLANE3!==t&&(p.CLIPPLANE3=t,P=!0),p.CLIPPLANE4!==V&&(p.CLIPPLANE4=V,P=!0),p.CLIPPLANE5!==K&&(p.CLIPPLANE5=K,P=!0),p.CLIPPLANE6!==C&&(p.CLIPPLANE6=C,P=!0),P}function t(a,v,p){let P=v.clipPlane??p.clipPlane;V(a,"vClipPlane",P),P=v.clipPlane2??p.clipPlane2,V(a,"vClipPlane2",P),P=v.clipPlane3??p.clipPlane3,V(a,"vClipPlane3",P),P=v.clipPlane4??p.clipPlane4,V(a,"vClipPlane4",P),P=v.clipPlane5??p.clipPlane5,V(a,"vClipPlane5",P),P=v.clipPlane6??p.clipPlane6,V(a,"vClipPlane6",P)}function V(a,v,p){p&&a.setFloat4(v,p.k.x,p.k.y,p.k.z,p.d)}p.d(v,{e:()=>P,g:()=>t,k:()=>L,m:()=>b})},11291:(a,v,p)=>{"use strict";function P(a){a.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}p.d(v,{b:()=>P})},11662:(a,v,p)=>{"use strict";function P(a){return void 0===a.getPipelineContext}p.d(v,{d:()=>P})},11438:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{static GetEffect(a){return void 0===a.getPipelineContext?a.effect:a}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=a.createDrawContext(),v&&(this.materialContext=a.createMaterialContext())}setEffect(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var P;(this.effect=a,void 0!==v&&(this.defines=v),p)&&(null===(P=this.drawContext)||void 0===P||P.reset())}dispose(){var a;null===(a=this.drawContext)||void 0===a||a.dispose()}}},10991:(a,v,p)=>{"use strict";p.d(v,{b:()=>u,d:()=>f,e:()=>C,f:()=>F});var P=p(10896),b=p(10994),L=p(10982),t=p(10905),V=p(10961),K=p(10964);function C(a,v){return(0,b.p)(v).cachedPipelines[a]}function F(a){const v=a._name,p=a.context;if(v&&p){const a=(0,b.p)(p),P=a.cachedPipelines[v];null===P||void 0===P||P.dispose(),delete a.cachedPipelines[v]}}function u(a,v,p,b,L,t,K){let C,F;const u=(0,P.n)()?null===t||void 0===t?void 0:t.getHostDocument():null;C="string"===typeof v?v:v.vertexSource?"source:"+v.vertexSource:v.vertexElement?(null===u||void 0===u?void 0:u.getElementById(v.vertexElement))||v.vertexElement:v.vertex||v,F="string"===typeof v?v:v.fragmentSource?"source:"+v.fragmentSource:v.fragmentElement?(null===u||void 0===u?void 0:u.getElementById(v.fragmentElement))||v.fragmentElement:v.fragment||v;const f=[void 0,void 0],H=()=>{if(f[0]&&f[1]){a.isFragment=!0;const[P,C]=f;(0,V.d)(C,a,((t,C)=>{K&&(K._fragmentSourceCodeBeforeMigration=C),p&&(t=p("fragment",t));const F=(0,V.b)(P,t,a);a=null;const u=function(a,v,p,P){if(p){return{vertexSourceCode:(1===P?"//":"")+"#define SHADER_NAME vertex:"+(p.vertexElement||p.vertex||p.spectorName||p)+"\n"+a,fragmentSourceCode:(1===P?"//":"")+"#define SHADER_NAME fragment:"+(p.fragmentElement||p.fragment||p.spectorName||p)+"\n"+v}}return{vertexSourceCode:a,fragmentSourceCode:v}}(F.vertexCode,F.fragmentCode,v,L);null===b||void 0===b||b(u.vertexSourceCode,u.fragmentSourceCode)}),t)}};c(C,"Vertex","",(v=>{(0,V.c)(a),(0,V.d)(v,a,((a,P)=>{K&&(K._rawVertexSourceCode=v,K._vertexSourceCodeBeforeMigration=P),p&&(a=p("vertex",a)),f[0]=a,H()}),t)}),L),c(F,"Fragment","Pixel",(a=>{K&&(K._rawFragmentSourceCode=a),f[1]=a,H()}),L)}function c(a,v,p,b,t,V){if("undefined"!==typeof HTMLElement&&a instanceof HTMLElement){return void b((0,P.d)(a))}if("source:"===a.substring(0,7))return void b(a.substring(7));if("base64:"===a.substring(0,7)){return void b(window.atob(a.substring(7)))}const C=L.e.GetShadersStore(t);if(C[a+v+"Shader"])return void b(C[a+v+"Shader"]);if(p&&C[a+p+"Shader"])return void b(C[a+p+"Shader"]);let F;if(F="."===a[0]||"/"===a[0]||a.indexOf("http")>-1?a:L.e.GetShadersRepository(t)+a,!(V=V||K.m))throw new Error("loadFileInjection is not defined");V(F+"."+v.toLowerCase()+".fx",b)}const f=(a,v,p,P)=>{try{const L=a.existingPipelineContext||v(a.shaderProcessingContext);if(L._name=a.name,a.name&&a.context){(0,b.p)(a.context).cachedPipelines[a.name]=L}return p(L,a.vertex,a.fragment,!!a.createAsRaw,"","",a.rebuildRebind,a.defines,a.transformFeedbackVaryings,"",(()=>{P(L,(()=>{var v;null===(v=a.onRenderingStateCompiled)||void 0===v||v.call(a,L)}))})),L}catch(L){throw t.d.Error("Error compiling effect"),L}}},10980:(a,v,p)=>{"use strict";p.d(v,{c:()=>V});var P=p(10893),b=p(10905),L=p(10982),t=p(10991);class V{static get ShadersRepository(){return L.e.ShadersRepository}static set ShadersRepository(a){L.e.ShadersRepository=a}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new P.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9?arguments[9]:void 0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,A=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new P.c,this.onErrorObservable=new P.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=a,this._key=f;const h=this._key.replace(/\r/g,"").replace(/\n/g,"|");let R;if(v.attributes){const a=v;if(this._engine=p,this._attributesNames=a.attributes,this._uniformsNames=a.uniformsNames.concat(a.samplers),this._samplerList=a.samplers.slice(),this.defines=a.defines,this.onError=a.onError,this.onCompiled=a.onCompiled,this._fallbacks=a.fallbacks,this._indexParameters=a.indexParameters,this._transformFeedbackVaryings=a.transformFeedbackVaryings||null,this._multiTarget=!!a.multiTarget,this._shaderLanguage=a.shaderLanguage??0,a.uniformBuffersNames){this._uniformBuffersNamesList=a.uniformBuffersNames.slice();for(let v=0;v<a.uniformBuffersNames.length;v++)this._uniformBuffersNames[a.uniformBuffersNames[v]]=v}this._processFinalCode=a.processFinalCode??null,this._processCodeAfterIncludes=a.processCodeAfterIncludes??void 0,R=a.existingPipelineContext}else this._engine=L,this.defines=null==K?"":K,this._uniformsNames=p.concat(b),this._samplerList=b?b.slice():[],this._attributesNames=v,this._uniformBuffersNamesList=[],this._shaderLanguage=H,this.onError=u,this.onCompiled=F,this._indexParameters=c,this._fallbacks=C;"WEBGL2"===this._engine.shaderPlatformName&&(R=(0,t.e)(h,this._engine._gl)??R),this._attributeLocationByName={},this.uniqueId=V._UniqueIdSeed++,R?(this._pipelineContext=R,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,A)}async _processShaderCodeAsync(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3?arguments[3]:void 0;P&&await P(),this._processingContext=p||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const b={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:a??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:L.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:L.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,t.b)(b,this.name,this._processFinalCode,((a,p)=>{this._vertexSourceCode=a,this._fragmentSourceCode=p,this._prepareEffect(v)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(a){return this._attributes[a]}getAttributeLocationByName(a){return this._attributeLocationByName[a]}getAttributesCount(){return this._attributes.length}getUniformIndex(a){return this._uniformsNames.indexOf(a)}getUniform(a){return this._uniforms[a]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(a){this.isReady()?a(this):(this.onCompileObservable.add((v=>{a(v)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(a){try{if(this._isReadyInternal())return}catch(v){return void this._processCompilationErrors(v,a)}this._isDisposed||setTimeout((()=>{this._checkIsReady(a)}),16)}get vertexSourceCode(){var a;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(a=this._pipelineContext)||void 0===a?void 0:a._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var a;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(a,v,p,P){this._isReady=!1,this._vertexSourceCodeOverride=a,this._fragmentSourceCodeOverride=v,this.onError=(a,v)=>{P&&P(v)},this.onCompiled=()=>{var a,v;const P=this.getEngine().scenes;if(P)for(let p=0;p<P.length;p++)P[p].markAllMaterialsAsDirty(63);null===(a=(v=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===a||a.call(v,p)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(a){if(this._pipelineContext=a,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let v=0;v<this._attributesNames.length;v++){const a=this._attributesNames[v];this._attributeLocationByName[a]=this._attributes[v]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),V.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this._pipelineContext;this._isReady=!1;try{const p=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),P=p?null:this.defines,b=p?this._vertexSourceCodeOverride:this._vertexSourceCode,L=p?this._fragmentSourceCodeOverride:this._fragmentSourceCode,V=this._engine;this._pipelineContext=(0,t.d)({existingPipelineContext:a?v:null,vertex:b,fragment:L,context:"WEBGL2"===V.shaderPlatformName?V._gl:void 0,rebuildRebind:(a,v,p,P)=>this._rebuildProgram(a,v,p,P),defines:P,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:p,parallelShaderCompile:V._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:p=>{v&&!a&&this._engine._deletePipelineContext(v),p&&this._onRenderingStateCompiled(p)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(v)}catch(p){this._processCompilationErrors(p,v)}}_getShaderCodeAndErrorLine(a,v,p){const P=p?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let b=null;if(v&&a){const L=v.match(P);if(L&&2===L.length){const v=parseInt(L[1]),P=a.split("\n",-1);P.length>=v&&(b=`Offending line [${v}] in ${p?"fragment":"vertex"} code: ${P[v-1]}`)}}return[a,b]}_processCompilationErrors(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=a.message;const p=this._attributesNames,P=this._fallbacks;if(b.d.Error("Unable to compile effect:"),b.d.Error("Uniforms: "+this._uniformsNames.map((function(a){return" "+a}))),b.d.Error("Attributes: "+p.map((function(a){return" "+a}))),b.d.Error("Defines:\n"+this.defines),V.LogShaderCodeOnCompilationError){var L,t;let a=null,v=null,p=null;var K;if(null!==(L=this._pipelineContext)&&void 0!==L&&L._getVertexShaderCode()&&([p,a]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),p&&(b.d.Error("Vertex code:"),b.d.Error(p))),null!==(t=this._pipelineContext)&&void 0!==t&&t._getFragmentShaderCode())[p,v]=this._getShaderCodeAndErrorLine(null===(K=this._pipelineContext)||void 0===K?void 0:K._getFragmentShaderCode(),this._compilationError,!0),p&&(b.d.Error("Fragment code:"),b.d.Error(p));a&&b.d.Error(a),v&&b.d.Error(v)}b.d.Error("Error: "+this._compilationError);const C=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};v&&(this._pipelineContext=v,this._isReady=!0,C()),P?(this._pipelineContext=null,P.hasMoreFallbacks?(this._allFallbacksProcessed=!1,b.d.Error("Trying next fallback."),this.defines=P.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,C(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,v||C())}get isSupported(){return""===this._compilationError}_bindTexture(a,v){this._engine._bindTexture(this._samplers[a],v,a)}setTexture(a,v){this._engine.setTexture(this._samplers[a],this._uniforms[a],v,a)}setTextureArray(a,v){const p=a+"Ex";if(-1===this._samplerList.indexOf(p+"0")){const P=this._samplerList.indexOf(a);for(let a=1;a<v.length;a++){const v=p+(a-1).toString();this._samplerList.splice(P+a,0,v)}let b=0;for(const a of this._samplerList)this._samplers[a]=b,b+=1}this._engine.setTextureArray(this._samplers[a],this._uniforms[a],v,a)}bindUniformBuffer(a,v){const p=this._uniformBuffersNames[v];void 0===p||V._BaseCache[p]===a&&this._engine._features.useUBOBindingCache||(V._BaseCache[p]=a,this._engine.bindUniformBufferBase(a,p,v))}bindUniformBlock(a,v){this._engine.bindUniformBlock(this._pipelineContext,a,v)}setInt(a,v){return this._pipelineContext.setInt(a,v),this}setInt2(a,v,p){return this._pipelineContext.setInt2(a,v,p),this}setInt3(a,v,p,P){return this._pipelineContext.setInt3(a,v,p,P),this}setInt4(a,v,p,P,b){return this._pipelineContext.setInt4(a,v,p,P,b),this}setIntArray(a,v){return this._pipelineContext.setIntArray(a,v),this}setIntArray2(a,v){return this._pipelineContext.setIntArray2(a,v),this}setIntArray3(a,v){return this._pipelineContext.setIntArray3(a,v),this}setIntArray4(a,v){return this._pipelineContext.setIntArray4(a,v),this}setUInt(a,v){return this._pipelineContext.setUInt(a,v),this}setUInt2(a,v,p){return this._pipelineContext.setUInt2(a,v,p),this}setUInt3(a,v,p,P){return this._pipelineContext.setUInt3(a,v,p,P),this}setUInt4(a,v,p,P,b){return this._pipelineContext.setUInt4(a,v,p,P,b),this}setUIntArray(a,v){return this._pipelineContext.setUIntArray(a,v),this}setUIntArray2(a,v){return this._pipelineContext.setUIntArray2(a,v),this}setUIntArray3(a,v){return this._pipelineContext.setUIntArray3(a,v),this}setUIntArray4(a,v){return this._pipelineContext.setUIntArray4(a,v),this}setFloatArray(a,v){return this._pipelineContext.setArray(a,v),this}setFloatArray2(a,v){return this._pipelineContext.setArray2(a,v),this}setFloatArray3(a,v){return this._pipelineContext.setArray3(a,v),this}setFloatArray4(a,v){return this._pipelineContext.setArray4(a,v),this}setArray(a,v){return this._pipelineContext.setArray(a,v),this}setArray2(a,v){return this._pipelineContext.setArray2(a,v),this}setArray3(a,v){return this._pipelineContext.setArray3(a,v),this}setArray4(a,v){return this._pipelineContext.setArray4(a,v),this}setMatrices(a,v){return this._pipelineContext.setMatrices(a,v),this}setMatrix(a,v){return this._pipelineContext.setMatrix(a,v),this}setMatrix3x3(a,v){return this._pipelineContext.setMatrix3x3(a,v),this}setMatrix2x2(a,v){return this._pipelineContext.setMatrix2x2(a,v),this}setFloat(a,v){return this._pipelineContext.setFloat(a,v),this}setBool(a,v){return this._pipelineContext.setInt(a,v?1:0),this}setVector2(a,v){return this._pipelineContext.setVector2(a,v),this}setFloat2(a,v,p){return this._pipelineContext.setFloat2(a,v,p),this}setVector3(a,v){return this._pipelineContext.setVector3(a,v),this}setFloat3(a,v,p,P){return this._pipelineContext.setFloat3(a,v,p,P),this}setVector4(a,v){return this._pipelineContext.setVector4(a,v),this}setQuaternion(a,v){return this._pipelineContext.setQuaternion(a,v),this}setFloat4(a,v,p,P,b){return this._pipelineContext.setFloat4(a,v,p,P,b),this}setColor3(a,v){return this._pipelineContext.setColor3(a,v),this}setColor4(a,v,p){return this._pipelineContext.setColor4(a,v,p),this}setDirectColor4(a,v){return this._pipelineContext.setDirectColor4(a,v),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,t.f)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;v&&(L.e.GetShadersStore(P)[`${a}PixelShader`]=v),p&&(L.e.GetShadersStore(P)[`${a}VertexShader`]=p)}static ResetCache(){V._BaseCache={}}}V.LogShaderCodeOnCompilationError=!0,V.AutomaticallyClearCodeCache=!1,V._UniqueIdSeed=0,V._BaseCache={},V.ShadersStore=L.e.ShadersStore,V.IncludesShadersStore=L.e.IncludesShadersStore},11481:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(a,v){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=new Array),this._defines[a].push(v)}addCPUSkinningFallback(a,v){this._mesh=v,a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(a,v){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,a=a.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),v._bonesComputationForcedToCPU=!0;const p=this._mesh.va();for(let a=0;a<p.meshes.length;a++){const P=p.meshes[a];if(P.material){if(P.computeBonesUsingShaders&&0!==P.numBoneInfluencers)if(P.material.getEffect()===v)P.computeBonesUsingShaders=!1;else if(P.rg)for(const a of P.rg){if(a.effect===v){P.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&P.computeBonesUsingShaders&&P.numBoneInfluencers>0&&(P.computeBonesUsingShaders=!1)}}else{const v=this._defines[this._currentRank];if(v)for(let p=0;p<v.length;p++)a=a.replace("#define "+v[p],"");this._currentRank++}return a}}},11764:(a,v,p)=>{"use strict";p.d(v,{b:()=>C,e:()=>F});var P=p(11306),b=p(11521),L=p(10893),t=p(10980),V=p(11438);p(11769);const K={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class C{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K;this._fullscreenViewport=new b.c(0,0,1,1);const p=v.xa??K.xa,L=v.indices??K.indices;this.Id=a,this._vertexBuffers={[P.f.PositionKind]:new P.f(a,p,P.f.PositionKind,!1,!1,2)},this._indexBuffer=a.createIndexBuffer(L),this._onContextRestoredObserver=a.onContextRestoredObservable.add((()=>{this._indexBuffer=a.createIndexBuffer(L);for(const a in this._vertexBuffers){this._vertexBuffers[a]._rebuild()}}))}setViewport(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Id.setViewport(a)}bindBuffers(a){this.Id.bindBuffers(this._vertexBuffers,this._indexBuffer,a)}applyEffectWrapper(a){this.Id.setState(!0),this.Id.depthCullingState.depthTest=!1,this.Id.stencilState.stencilTest=!1,this.Id.enableEffect(a.drawWrapper),this.bindBuffers(a.effect),a.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Id.depthCullingState.depthTest,this._savedStateStencilTest=this.Id.stencilState.stencilTest}restoreStates(){this.Id.depthCullingState.depthTest=this._savedStateDepthTest,this.Id.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Id.drawElementsType(0,0,6)}_isRenderTargetTexture(a){return void 0!==a.renderTarget}render(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!a.effect.isReady())return;this.saveStates(),this.setViewport();const p=null===v?null:this._isRenderTargetTexture(v)?v.renderTarget:v;p&&this.Id.bindFramebuffer(p),this.applyEffectWrapper(a),this.draw(),p&&this.Id.unBindFramebuffer(p),this.restoreStates()}dispose(){const a=this._vertexBuffers[P.f.PositionKind];a&&(a.dispose(),delete this._vertexBuffers[P.f.PositionKind]),this._indexBuffer&&this.Id._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Id.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class F{static RegisterShaderCodeProcessing(a,v){v?F._CustomShaderCodeProcessing[a??""]=v:delete F._CustomShaderCodeProcessing[a??""]}static _GetShaderCodeProcessing(a){return F._CustomShaderCodeProcessing[a]??F._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(a){this.options.name=a}isReady(){var a;return(null===(a=this._drawWrapper.effect)||void 0===a?void 0:a.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(a){this._drawWrapper.effect=a}constructor(a){this.alphaMode=0,this.onEffectCreatedObservable=new L.c(void 0,!0),this.onApplyObservable=new L.c,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...a,name:a.name||"effectWrapper",Id:a.Id,uniforms:a.uniforms||a.uniformNames||[],uniformNames:void 0,samplers:a.samplers||a.samplerNames||[],samplerNames:void 0,attributeNames:a.attributeNames||["position"],uniformBuffers:a.uniformBuffers||[],defines:a.defines||"",useShaderStore:a.useShaderStore||!1,vertexUrl:a.vertexUrl||a.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:a.fragmentShader||"pass",indexParameters:a.indexParameters,blockCompilation:a.blockCompilation||!1,shaderLanguage:a.shaderLanguage||0,onCompiled:a.onCompiled||void 0,extraInitializations:a.extraInitializations||void 0,extraInitializationsAsync:a.extraInitializationsAsync||void 0,useAsPostProcess:a.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),a.vertexUrl||a.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Id.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new V.e(this.options.Id),this._webGPUReady=1===this.options.shaderLanguage;const v=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,v,this.options.extraInitializations)}_gatherImports(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(a&&this._webGPUReady?v.push(Promise.all([p.e(37).then(p.bind(p,13653))])):v.push(Promise.all([Promise.resolve().then(p.bind(p,11769))])))}_postConstructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,P&&this._importPromises.push(...P);const b=this.options.Id.isWebGPU&&!F.ForceGLSL;this._gatherImports(b,this._importPromises),void 0!==p&&p(b,this._importPromises),b&&this._webGPUReady&&(this.options.shaderLanguage=1),a||this.updateEffect(v)}updateEffect(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,K=arguments.length>7?arguments[7]:void 0;const C=F._GetShaderCodeProcessing(this.name);if(null!==C&&void 0!==C&&C.defineCustomBindings){var u,c;const P=(null===(u=v)||void 0===u?void 0:u.slice())??[];P.push(...this.options.uniforms);const b=(null===(c=p)||void 0===c?void 0:c.slice())??[];b.push(...this.options.samplers),a=C.defineCustomBindings(this.name,a,P,b),v=P,p=b}this.options.defines=a||"";const f=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let H;H=this.options.extraInitializationsAsync?async()=>{null===f||void 0===f||f(),await this.options.extraInitializationsAsync}:f,this.options.useShaderStore?this._drawWrapper.effect=this.options.Id.createEffect({vertex:V??this._shaderPath.vertex,fragment:K??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:v||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:p||this.options.samplers,defines:null!==a?a:"",fallbacks:null,onCompiled:b??this.options.onCompiled,onError:L??null,indexParameters:P||this.options.indexParameters,processCodeAfterIncludes:null!==C&&void 0!==C&&C.processCodeAfterIncludes?(a,v)=>C.processCodeAfterIncludes(this.name,a,v):null,processFinalCode:null!==C&&void 0!==C&&C.processFinalCode?(a,v)=>C.processFinalCode(this.name,a,v):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:H},this.options.Id):this._drawWrapper.effect=new t.c(this._shaderPath,this.options.attributeNames,v||this.options.uniforms,p||this.options.samplerNames,this.options.Id,a,void 0,b||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,H),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var a,v;this.options.useAsPostProcess&&(this.options.Id.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(a=F._GetShaderCodeProcessing(this.name))||void 0===a||null===(v=a.bindCustomBindings)||void 0===v||v.call(a,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}F.ForceGLSL=!1,F._CustomShaderCodeProcessing={}},11296:(a,v,p)=>{"use strict";p.d(v,{d:()=>L,g:()=>b});var P=p(11291);function b(a,v){v.EXPOSURE&&a.push("exposureLinear"),v.CONTRAST&&a.push("contrast"),v.COLORGRADING&&a.push("colorTransformSettings"),(v.VIGNETTE||v.DITHER)&&a.push("vInverseScreenSize"),v.VIGNETTE&&(a.push("vignetteSettings1"),a.push("vignetteSettings2")),v.COLORCURVES&&(0,P.b)(a),v.DITHER&&a.push("ditherIntensity")}function L(a,v){v.COLORGRADING&&a.push("txColorTransform")}},11271:(a,v,p)=>{"use strict";p.d(v,{c:()=>f});var P=p(11207),b=p(11210),L=p(10893),t=p(11279),V=p(11287),K=p(11291);class C{constructor(){this._dirty=!0,this._tempColor=new t.e(0,0,0,0),this._globalCurve=new t.e(0,0,0,0),this._highlightsCurve=new t.e(0,0,0,0),this._midtonesCurve=new t.e(0,0,0,0),this._shadowsCurve=new t.e(0,0,0,0),this._positiveCurve=new t.e(0,0,0,0),this._negativeCurve=new t.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(a){this._globalHue=a,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(a){this._globalDensity=a,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(a){this._globalSaturation=a,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(a){this._globalExposure=a,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(a){this._highlightsHue=a,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(a){this._highlightsDensity=a,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(a){this._highlightsSaturation=a,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(a){this._highlightsExposure=a,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(a){this._midtonesHue=a,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(a){this._midtonesDensity=a,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(a){this._midtonesSaturation=a,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(a){this._midtonesExposure=a,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(a){this._shadowsHue=a,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(a){this._shadowsDensity=a,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(a){this._shadowsSaturation=a,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(a){this._shadowsExposure=a,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";a._dirty&&(a._dirty=!1,a._getColorGradingDataToRef(a._globalHue,a._globalDensity,a._globalSaturation,a._globalExposure,a._globalCurve),a._getColorGradingDataToRef(a._highlightsHue,a._highlightsDensity,a._highlightsSaturation,a._highlightsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._highlightsCurve),a._getColorGradingDataToRef(a._midtonesHue,a._midtonesDensity,a._midtonesSaturation,a._midtonesExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._midtonesCurve),a._getColorGradingDataToRef(a._shadowsHue,a._shadowsDensity,a._shadowsSaturation,a._shadowsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._shadowsCurve),a._highlightsCurve.subtractToRef(a._midtonesCurve,a._positiveCurve),a._midtonesCurve.subtractToRef(a._shadowsCurve,a._negativeCurve)),v&&(v.setFloat4(p,a._positiveCurve.r,a._positiveCurve.g,a._positiveCurve.b,a._positiveCurve.a),v.setFloat4(P,a._midtonesCurve.r,a._midtonesCurve.g,a._midtonesCurve.b,a._midtonesCurve.a),v.setFloat4(b,a._negativeCurve.r,a._negativeCurve.g,a._negativeCurve.b,a._negativeCurve.a))}_getColorGradingDataToRef(a,v,p,P,b){null!=a&&(a=C._Clamp(a,0,360),v=C._Clamp(v,-100,100),p=C._Clamp(p,-100,100),P=C._Clamp(P,-100,100),v=C._ApplyColorGradingSliderNonlinear(v),v*=.5,P=C._ApplyColorGradingSliderNonlinear(P),v<0&&(v*=-1,a=(a+180)%360),C._FromHSBToRef(a,v,50+.25*P,b),b.scaleToRef(2,b),b.a=1+.01*p)}static _ApplyColorGradingSliderNonlinear(a){a/=100;let v=Math.abs(a);return v=Math.pow(v,2),a<0&&(v*=-1),v*=100,v}static _FromHSBToRef(a,v,p,P){let b=C._Clamp(a,0,360);const L=C._Clamp(v/100,0,1),t=C._Clamp(p/100,0,1);if(0===L)P.r=t,P.g=t,P.b=t;else{b/=60;const a=Math.floor(b),v=b-a,p=t*(1-L),V=t*(1-L*v),K=t*(1-L*(1-v));switch(a){case 0:P.r=t,P.g=K,P.b=p;break;case 1:P.r=V,P.g=t,P.b=p;break;case 2:P.r=p,P.g=t,P.b=K;break;case 3:P.r=p,P.g=V,P.b=t;break;case 4:P.r=K,P.g=p,P.b=t;break;default:P.r=t,P.g=p,P.b=V}}P.a=1}static _Clamp(a,v,p){return Math.min(Math.max(a,v),p)}clone(){return V.b.Clone((()=>new C),this)}serialize(){return V.b.Serialize(this)}static Parse(a){return V.b.Parse((()=>new C),a,null,null)}}C.PrepareUniforms=K.b,(0,P.e)([(0,b.O)()],C.prototype,"_globalHue",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_globalDensity",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_globalSaturation",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_globalExposure",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_highlightsHue",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_highlightsDensity",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_highlightsSaturation",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_highlightsExposure",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_midtonesHue",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_midtonesDensity",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_midtonesSaturation",void 0),(0,P.e)([(0,b.O)()],C.prototype,"_midtonesExposure",void 0),V.b._ColorCurvesParser=C.Parse;var F=p(11037),u=p(11296),c=p(11027);class f{constructor(){this.colorCurves=new C,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=f.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new t.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=f.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new L.c}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(a){this._colorCurvesEnabled!==a&&(this._colorCurvesEnabled=a,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(a){this._colorGradingTexture!==a&&(this._colorGradingTexture=a,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(a){this._colorGradingEnabled!==a&&(this._colorGradingEnabled=a,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(a){this._colorGradingWithGreenDepth!==a&&(this._colorGradingWithGreenDepth=a,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(a){this._colorGradingBGR!==a&&(this._colorGradingBGR=a,this._updateParameters())}get exposure(){return this._exposure}set exposure(a){this._exposure!==a&&(this._exposure=a,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(a){this._toneMappingEnabled!==a&&(this._toneMappingEnabled=a,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(a){this._toneMappingType!==a&&(this._toneMappingType=a,this._updateParameters())}get contrast(){return this._contrast}set contrast(a){this._contrast!==a&&(this._contrast=a,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(a){this.vignetteCenterY=a}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(a){this.vignetteCenterX=a}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(a){this._vignetteBlendMode!==a&&(this._vignetteBlendMode=a,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(a){this._vignetteEnabled!==a&&(this._vignetteEnabled=a,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(a){this._ditheringEnabled!==a&&(this._ditheringEnabled=a,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(a){this._ditheringIntensity!==a&&(this._ditheringIntensity=a,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(a){this._skipFinalColorClamp!==a&&(this._skipFinalColorClamp=a,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(a){this._applyByPostProcess!==a&&(this._applyByPostProcess=a,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(a){this._isEnabled!==a&&(this._isEnabled=a,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(a){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return a.VIGNETTE=!1,a.TONEMAPPING=0,a.CONTRAST=!1,a.EXPOSURE=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.DITHER=!1,a.IMAGEPROCESSING=!1,a.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(a.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(a.VIGNETTE=this.vignetteEnabled,a.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===f._VIGNETTEMODE_MULTIPLY,a.VIGNETTEBLENDMODEOPAQUE=!a.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case f.TONEMAPPING_KHR_PBR_NEUTRAL:a.TONEMAPPING=3;break;case f.TONEMAPPING_ACES:a.TONEMAPPING=2;break;default:a.TONEMAPPING=1}else a.TONEMAPPING=0;a.CONTRAST=1!==this.contrast,a.EXPOSURE=1!==this.exposure,a.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,a.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,a.COLORGRADING?a.COLORGRADING3D=this.colorGradingTexture.is3D:a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,a.SAMPLER3DBGRMAP=this.colorGradingBGR,a.DITHER=this._ditheringEnabled,a.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,a.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,a.IMAGEPROCESSING=a.VIGNETTE||!!a.TONEMAPPING||a.CONTRAST||a.EXPOSURE||a.COLORCURVES||a.COLORGRADING||a.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(a,v){if(this._colorCurvesEnabled&&this.colorCurves&&C.Bind(this.colorCurves,a),this._vignetteEnabled||this._ditheringEnabled){const p=1/a.getEngine().getRenderWidth(),P=1/a.getEngine().getRenderHeight();if(a.setFloat2("vInverseScreenSize",p,P),this._ditheringEnabled&&a.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const b=null!=v?v:P/p;let L=Math.tan(.5*this.vignetteCameraFov),t=L*b;const V=Math.sqrt(t*L);t=(0,F.m)(t,V,this.vignetteStretch),L=(0,F.m)(L,V,this.vignetteStretch),a.setFloat4("vignetteSettings1",t,L,-t*this.vignetteCenterX,-L*this.vignetteCenterY);const K=-2*this.vignetteWeight;a.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,K)}}if(a.setFloat("exposureLinear",this.exposure),a.setFloat("contrast",this.contrast),this.colorGradingTexture){a.setTexture("txColorTransform",this.colorGradingTexture);const v=this.colorGradingTexture.getSize().height;a.setFloat4("colorTransformSettings",(v-1)/v,.5/v,v,this.colorGradingTexture.level)}}clone(){return V.b.Clone((()=>new f),this)}serialize(){return V.b.Serialize(this)}static Parse(a){const v=V.b.Parse((()=>new f),a,null,null);return void 0!==a.vignetteCentreX&&(v.vignetteCenterX=a.vignetteCentreX),void 0!==a.vignetteCentreY&&(v.vignetteCenterY=a.vignetteCentreY),v}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}f.TONEMAPPING_STANDARD=0,f.TONEMAPPING_ACES=1,f.TONEMAPPING_KHR_PBR_NEUTRAL=2,f.PrepareUniforms=u.g,f.PrepareSamplers=u.d,f._VIGNETTEMODE_MULTIPLY=0,f._VIGNETTEMODE_OPAQUE=1,(0,P.e)([(0,b.j)()],f.prototype,"colorCurves",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_colorCurvesEnabled",void 0),(0,P.e)([(0,b.H)("colorGradingTexture")],f.prototype,"_colorGradingTexture",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_colorGradingEnabled",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_colorGradingWithGreenDepth",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_colorGradingBGR",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_exposure",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_toneMappingEnabled",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_toneMappingType",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_contrast",void 0),(0,P.e)([(0,b.O)()],f.prototype,"vignetteStretch",void 0),(0,P.e)([(0,b.O)()],f.prototype,"vignetteCenterX",void 0),(0,P.e)([(0,b.O)()],f.prototype,"vignetteCenterY",void 0),(0,P.e)([(0,b.O)()],f.prototype,"vignetteWeight",void 0),(0,P.e)([(0,b.o)()],f.prototype,"vignetteColor",void 0),(0,P.e)([(0,b.O)()],f.prototype,"vignetteCameraFov",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_vignetteBlendMode",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_vignetteEnabled",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_ditheringEnabled",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_ditheringIntensity",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_skipFinalColorClamp",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_applyByPostProcess",void 0),(0,P.e)([(0,b.O)()],f.prototype,"_isEnabled",void 0),V.b._ImageProcessingConfigurationParser=f.Parse,(0,c.f)("BABYLON.ImageProcessingConfiguration",f)},11484:(a,v,p)=>{"use strict";p.d(v,{d:()=>u});var P=p(11207),b=p(11390),L=p(11210),t=p(11476),V=p(11454),K=p(11491),C=p(11440);class F extends V.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class u extends K.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(a,"DetailMap",140,new F,v),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=b.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=a._dirtyCallbacks[1]}isReadyForSubMesh(a,v,p){return!this._isEnabled||!(a._areTexturesDirty&&v.texturesEnabled&&p.getCaps().standardDerivatives&&this._texture&&t.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(a,v){if(this._isEnabled){a.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const p=v.getEngine();a._areTexturesDirty&&(p.getCaps().standardDerivatives&&this._texture&&t.e.DetailTextureEnabled&&this._isEnabled?((0,C.S)(this._texture,a,"DETAIL"),a.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):a.DETAIL=!1)}else a.DETAIL=!1}bindForSubMesh(a,v){if(!this._isEnabled)return;const p=this._material.isFrozen;a.useUbo&&p&&a.isSync||this._texture&&t.e.DetailTextureEnabled&&(a.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,C.s)(this._texture,a,"detail")),v.texturesEnabled&&this._texture&&t.e.DetailTextureEnabled&&a.setTexture("detailSampler",this._texture)}hasTexture(a){return this._texture===a}getActiveTextures(a){this._texture&&a.push(this._texture)}getAnimatables(a){this._texture&&this._texture.animations&&this._texture.animations.length>0&&a.push(this._texture)}dispose(a){var v;a&&(null===(v=this._texture)||void 0===v||v.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(a){a.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,P.e)([(0,L.H)("detailTexture"),(0,L.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,P.e)([(0,L.O)()],u.prototype,"diffuseBlendLevel",void 0),(0,P.e)([(0,L.O)()],u.prototype,"roughnessBlendLevel",void 0),(0,P.e)([(0,L.O)()],u.prototype,"bumpLevel",void 0),(0,P.e)([(0,L.O)(),(0,L.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"normalBlendMethod",void 0),(0,P.e)([(0,L.O)(),(0,L.e)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0)},11390:(a,v,p)=>{"use strict";p.d(v,{c:()=>h});var P=p(11207),b=p(11210),L=p(10889),t=p(10893),V=p(10939),K=p(11395),C=p(11301),F=p(10905),u=p(11356),c=p(11438),f=p(11287);class H{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(a){this._func=a}get funcRef(){return this._funcRef}set funcRef(a){this._funcRef=a}get funcMask(){return this._funcMask}set funcMask(a){this._funcMask=a}get opStencilFail(){return this._opStencilFail}set opStencilFail(a){this._opStencilFail=a}get opDepthFail(){return this._opDepthFail}set opDepthFail(a){this._opDepthFail=a}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(a){this._opStencilDepthPass=a}get mask(){return this._mask}set mask(a){this._mask=a}get enabled(){return this._enabled}set enabled(a){this._enabled=a}getClassName(){return"MaterialStencilState"}copyTo(a){f.b.Clone((()=>a),this)}serialize(){return f.b.Serialize(this)}parse(a,v,p){f.b.Parse((()=>this),a,v,p)}}(0,P.e)([(0,b.O)()],H.prototype,"func",null),(0,P.e)([(0,b.O)()],H.prototype,"funcRef",null),(0,P.e)([(0,b.O)()],H.prototype,"funcMask",null),(0,P.e)([(0,b.O)()],H.prototype,"opStencilFail",null),(0,P.e)([(0,b.O)()],H.prototype,"opDepthFail",null),(0,P.e)([(0,b.O)()],H.prototype,"opStencilDepthPass",null),(0,P.e)([(0,b.O)()],H.prototype,"mask",null),(0,P.e)([(0,b.O)()],H.prototype,"enabled",null);var A=p(11440);class h{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(a){if(this._alpha===a)return;const v=this._alpha;this._alpha=a,1!==v&&1!==a||this.Sg(h.MiscDirtyFlag+h.PrePassDirtyFlag)}get alpha(){return this._alpha}set oh(a){this._backFaceCulling!==a&&(this._backFaceCulling=a,this.Sg(h.TextureDirtyFlag))}get oh(){return this._backFaceCulling}set cullBackFaces(a){this._cullBackFaces!==a&&(this._cullBackFaces=a,this.Sg(h.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(a){this._blockDirtyMechanism!==a&&(this._blockDirtyMechanism=a,a||this.oj())}atomicMaterialsUpdate(a){this.blockDirtyMechanism=!0;try{a(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new t.c),this._onBindObservable}set onBind(a){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(a)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new t.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new t.c),this._onEffectCreatedObservable}set alphaMode(a){this._alphaMode!==a&&(this._alphaMode=a,this.Sg(h.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(a){this._needDepthPrePass!==a&&(this._needDepthPrePass=a,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(a){this._fogEnabled!==a&&(this._fogEnabled=a,this.Sg(h.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(a){this.fillMode=a?h.WireFrameFillMode:h.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(a){this.fillMode=a?h.PointFillMode:h.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(a){this._fillMode!==a&&(this._fillMode=a,this.Sg(h.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){const v=this.va().getEngine().getCaps().fragmentDepthSupported;a&&!v&&F.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=a&&v,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(a){this._drawWrapper=a}constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.uj=new t.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new H,this._useUBO=!1,this._fillMode=h.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=a;const b=v||V.b.LastCreatedScene;b&&(this._scene=b,this._dirtyCallbacks={},this._forceGLSL=P,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=a||L.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new c.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new C.b(this._scene.getEngine(),void 0,void 0,a),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),p||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),h.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var a;const v=this.va().getEngine();null===(a=this._uniformBuffer)||void 0===a||a.dispose(),v.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new C.b(v,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new C.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(a){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.oj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.oj(),this.checkReadyOnlyOnce=!1}isReady(a,v){return!0}isReadyForSubMesh(a,v,p){const P=v.materialDefines;return!!P&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=P,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(a){return null!==this.sideOrientation?this.sideOrientation:a.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(a){this._transparencyMode!==a&&(this._transparencyMode=a,this._forceAlphaTest=a===h.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===h.MATERIAL_OPAQUE||this._transparencyMode===h.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(a){return a.visibility<1||!this._disableAlphaBlending&&(a.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(a){return!this.needAlphaBlendingForMesh(a)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}oj(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this.va().meshes;for(const p of v)if(p.rg)for(const v of p.rg)if(v.Ha()===this)for(const p of v._drawWrappers)p&&this._materialContext===p.materialContext&&(p._wasPreviouslyReady=!1,p._wasPreviouslyUsingInstances=null,p._forceRebindOnNextCall=a);a&&this.Sg(h.AllDirtyFlag)}_preBind(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=this._scene.getEngine(),P=(null==v?this.sideOrientation:v)===h.ClockWiseSideOrientation;return p.enableEffect(a||this._getDrawWrapper()),p.setState(this.oh,this.zOffset,!1,P,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),P}bind(a,v){}buildUniformLayout(){const a=this._uniformBuffer;this._eventInfo.ubo=a,this._callbackPluginEventGeneric(8,this._eventInfo),a.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(a,v,p){const P=p._drawWrapper;this._eventInfo.subMesh=p,this._callbackPluginEventBindForSubMesh(this._eventInfo),P._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(a){}bindView(a){this._useUBO?this._needToBindSceneUbo=!0:a.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(a){this._useUBO?this._needToBindSceneUbo=!0:(a.setMatrix("viewProjection",this.va().getTransformMatrix()),a.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(a,v){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(a,v)}_afterBind(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&v&&(this._needToBindSceneUbo=!1,(0,A.q)(v,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=a?a.visibility:1,this._onBindObservable&&a&&this._onBindObservable.notifyObservers(a),this.disableDepthWrite){const a=this._scene.getEngine();this._cachedDepthWriteState=a.getDepthWrite(),a.setDepthWrite(!1)}if(this.disableColorWrite){const a=this._scene.getEngine();this._cachedColorWriteState=a.getColorWrite(),a.setColorWrite(!1)}if(0!==this.depthFunction){const a=this._scene.getEngine();this._cachedDepthFunctionState=a.getDepthFunction()||0,a.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(a){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=a,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(a){return null}_clonePlugins(a,v){const p={};if(this._serializePlugins(p),h._ParsePlugins(p,a,this._scene,v),this.pluginManager)for(const P of this.pluginManager._plugins){const v=a.pluginManager.getPlugin(P.name);v&&P.copyTo(v)}}getBindedMeshes(){if(this.meshMap){const a=[];for(const v in this.meshMap){const p=this.meshMap[v];p&&a.push(p)}return a}return this._scene.meshes.filter((a=>a.material===this))}forceCompilation(a,v,p,P){const b={clipPlane:!1,useInstances:!1,...p},L=this.va(),t=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const V=()=>{if(!this._scene||!this._scene.getEngine())return;const p=L.clipPlane;if(b.clipPlane&&(L.clipPlane=new u.b(0,0,0,1)),this._storeEffectOnSubMeshes){let p=!0,L=null;if(a.rg){const v=new K.d(0,0,0,0,0,a,void 0,!1,!1);v.materialDefines&&(v.materialDefines._renderId=-1),this.isReadyForSubMesh(a,v,b.useInstances)||(v.effect&&v.effect.getCompilationError()&&v.effect.allFallbacksProcessed()?L=v.effect.getCompilationError():(p=!1,setTimeout(V,16)))}p&&(this.allowShaderHotSwapping=t,L&&P&&P(L),v&&v(this))}else this.isReady()?(this.allowShaderHotSwapping=t,v&&v(this)):setTimeout(V,16);b.clipPlane&&(L.clipPlane=p)};V()}forceCompilationAsync(a,v){return new Promise(((p,P)=>{this.forceCompilation(a,(()=>{p()}),v,(a=>{P(a)}))}))}Sg(a){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(h._DirtyCallbackArray.length=0,a&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),a&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),a&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),a&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),a&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),a&h.PrePassDirtyFlag&&h._DirtyCallbackArray.push(h._PrePassDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const a=this.va().meshes;for(const v of a)if(v.rg)for(const a of v.rg)a.Ha()===this&&a.resetDrawCache()}_markAllSubMeshesAsDirty(a){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const v=this.va().meshes;for(const p of v)if(p.rg)for(const v of p.rg)if(v.Ha(!1)===this)for(const p of v._drawWrappers)p&&p.defines&&p.defines.markAllAsDirty&&this._materialContext===p.materialContext&&a(p.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const a=this.va().enablePrePassRenderer();a&&a.Sg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(h._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const a=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.uj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(a)}))}}setPrePassRenderer(a){return!1}dispose(a,v,p){const P=this.va();if(P.stopAnimation(this),P.freeProcessedMaterials(),P.removeMaterial(this),this._eventInfo.forceDisposeTextures=v,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const a=this._parentContainer.materials.indexOf(this);a>-1&&this._parentContainer.materials.splice(a,1),this._parentContainer=null}if(!0!==p)if(this.meshMap)for(const b in this.meshMap){const v=this.meshMap[b];v&&(v.material=null,this.releaseVertexArrayObject(v,a))}else{const v=P.meshes;for(const p of v)p.material!==this||p.sourceMesh||(p.material=null,this.releaseVertexArrayObject(p,a))}this._uniformBuffer.dispose(),a&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.uj.notifyObservers(this),this.uj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(a,v){const p=a.Oj;if(p)if(this._storeEffectOnSubMeshes){if(a.rg)for(const P of a.rg)p._releaseVertexArrayObject(P.effect),v&&P.effect&&P.effect.dispose()}else p._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const a=f.b.Serialize(this);return a.stencil=this.stencil.serialize(),a.uniqueId=this.uniqueId,this._serializePlugins(a),a}_serializePlugins(a){if(a.plugins={},this.pluginManager)for(const v of this.pluginManager._plugins)a.plugins[v.getClassName()]=v.serialize()}static Parse(a,v,p){if(a.customType){if("BABYLON.PBRMaterial"===a.customType&&a.overloadedAlbedo&&(a.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return F.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else a.customType="BABYLON.StandardMaterial";const P=L.e.Instantiate(a.customType).Parse(a,v,p);return P._loadedUniqueId=a.uniqueId,P}static _ParsePlugins(a,v,p,P){if(a.plugins)for(const V in a.plugins){var b,t;const K=a.plugins[V];let C=null===(b=v.pluginManager)||void 0===b?void 0:b.getPlugin(K.name);if(!C){const a=L.e.Instantiate("BABYLON."+V);a&&(C=new a(v))}null===(t=C)||void 0===t||t.parse(K,p,P)}}}h.TriangleFillMode=0,h.WireFrameFillMode=1,h.PointFillMode=2,h.PointListDrawMode=3,h.LineListDrawMode=4,h.LineLoopDrawMode=5,h.LineStripDrawMode=6,h.TriangleStripDrawMode=7,h.TriangleFanDrawMode=8,h.ClockWiseSideOrientation=0,h.CounterClockWiseSideOrientation=1,h.TextureDirtyFlag=1,h.LightDirtyFlag=2,h.FresnelDirtyFlag=4,h.AttributesDirtyFlag=8,h.MiscDirtyFlag=16,h.PrePassDirtyFlag=32,h.AllDirtyFlag=63,h.MATERIAL_OPAQUE=0,h.MATERIAL_ALPHATEST=1,h.MATERIAL_ALPHABLEND=2,h.MATERIAL_ALPHATESTANDBLEND=3,h.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,h.MATERIAL_NORMALBLENDMETHOD_RNM=1,h.OnEventObservable=new t.c,h._AllDirtyCallBack=a=>a.markAllAsDirty(),h._ImageProcessingDirtyCallBack=a=>a.markAsImageProcessingDirty(),h._TextureDirtyCallBack=a=>a.markAsTexturesDirty(),h._FresnelDirtyCallBack=a=>a.markAsFresnelDirty(),h._MiscDirtyCallBack=a=>a.markAsMiscDirty(),h._PrePassDirtyCallBack=a=>a.markAsPrePassDirty(),h._LightsDirtyCallBack=a=>a.markAsLightDirty(),h._AttributeDirtyCallBack=a=>a.markAsAttributesDirty(),h._FresnelAndMiscDirtyCallBack=a=>{h._FresnelDirtyCallBack(a),h._MiscDirtyCallBack(a)},h._TextureAndMiscDirtyCallBack=a=>{h._TextureDirtyCallBack(a),h._MiscDirtyCallBack(a)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=a=>{for(const v of h._DirtyCallbackArray)v(a)},(0,P.e)([(0,b.O)()],h.prototype,"id",void 0),(0,P.e)([(0,b.O)()],h.prototype,"uniqueId",void 0),(0,P.e)([(0,b.O)()],h.prototype,"name",void 0),(0,P.e)([(0,b.O)()],h.prototype,"metadata",void 0),(0,P.e)([(0,b.O)()],h.prototype,"checkReadyOnEveryCall",void 0),(0,P.e)([(0,b.O)()],h.prototype,"checkReadyOnlyOnce",void 0),(0,P.e)([(0,b.O)()],h.prototype,"state",void 0),(0,P.e)([(0,b.O)("alpha")],h.prototype,"_alpha",void 0),(0,P.e)([(0,b.O)("oh")],h.prototype,"_backFaceCulling",void 0),(0,P.e)([(0,b.O)("cullBackFaces")],h.prototype,"_cullBackFaces",void 0),(0,P.e)([(0,b.O)()],h.prototype,"sideOrientation",void 0),(0,P.e)([(0,b.O)("alphaMode")],h.prototype,"_alphaMode",void 0),(0,P.e)([(0,b.O)()],h.prototype,"_needDepthPrePass",void 0),(0,P.e)([(0,b.O)()],h.prototype,"disableDepthWrite",void 0),(0,P.e)([(0,b.O)()],h.prototype,"disableColorWrite",void 0),(0,P.e)([(0,b.O)()],h.prototype,"forceDepthWrite",void 0),(0,P.e)([(0,b.O)()],h.prototype,"depthFunction",void 0),(0,P.e)([(0,b.O)()],h.prototype,"separateCullingPass",void 0),(0,P.e)([(0,b.O)("fogEnabled")],h.prototype,"_fogEnabled",void 0),(0,P.e)([(0,b.O)()],h.prototype,"pointSize",void 0),(0,P.e)([(0,b.O)()],h.prototype,"zOffset",void 0),(0,P.e)([(0,b.O)()],h.prototype,"zOffsetUnits",void 0),(0,P.e)([(0,b.O)()],h.prototype,"pointsCloud",null),(0,P.e)([(0,b.O)()],h.prototype,"fillMode",null),(0,P.e)([(0,b.O)()],h.prototype,"useLogarithmicDepth",null),(0,P.e)([(0,b.O)()],h.prototype,"transparencyMode",null)},11454:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{constructor(a){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=a,a)for(const v in a)Object.prototype.hasOwnProperty.call(a,v)&&this._setDefaultValue(v)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||a,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const a of Object.keys(this))"_"!==a[0]&&this._keys.push(a);if(this._externalProperties)for(const a in this._externalProperties)-1===this._keys.indexOf(a)&&this._keys.push(a)}isEqual(a){if(this._keys.length!==a._keys.length)return!1;for(let v=0;v<this._keys.length;v++){const p=this._keys[v];if(this[p]!==a[p])return!1}return!0}cloneTo(a){this._keys.length!==a._keys.length&&(a._keys=this._keys.slice(0));for(let v=0;v<this._keys.length;v++){const p=this._keys[v];a[p]=this[p]}}reset(){this._keys.forEach((a=>this._setDefaultValue(a)))}_setDefaultValue(a){var v,p,P,b;const L=(null===(v=this._externalProperties)||void 0===v||null===(p=v[a])||void 0===p?void 0:p.type)??typeof this[a],t=null===(P=this._externalProperties)||void 0===P||null===(b=P[a])||void 0===b?void 0:b.default;switch(L){case"number":this[a]=t??0;break;case"string":this[a]=t??"";break;default:this[a]=t??!1}}toString(){let a="";for(let v=0;v<this._keys.length;v++){const p=this._keys[v],P=this[p];switch(typeof P){case"number":case"string":a+="#define "+p+" "+P+"\n";break;default:P&&(a+="#define "+p+"\n")}}return a}}},11476:(a,v,p)=>{"use strict";p.d(v,{e:()=>b});var P=p(10974);class b{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(a){this._DiffuseTextureEnabled!==a&&(this._DiffuseTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(a){this._DetailTextureEnabled!==a&&(this._DetailTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(a){this._DecalMapEnabled!==a&&(this._DecalMapEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(a){this._AmbientTextureEnabled!==a&&(this._AmbientTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(a){this._OpacityTextureEnabled!==a&&(this._OpacityTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(a){this._ReflectionTextureEnabled!==a&&(this._ReflectionTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(a){this._EmissiveTextureEnabled!==a&&(this._EmissiveTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(a){this._SpecularTextureEnabled!==a&&(this._SpecularTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(a){this._BumpTextureEnabled!==a&&(this._BumpTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(a){this._LightmapTextureEnabled!==a&&(this._LightmapTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(a){this._RefractionTextureEnabled!==a&&(this._RefractionTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(a){this._ColorGradingTextureEnabled!==a&&(this._ColorGradingTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(a){this._FresnelEnabled!==a&&(this._FresnelEnabled=a,P.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(a){this._ClearCoatTextureEnabled!==a&&(this._ClearCoatTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(a){this._ClearCoatBumpTextureEnabled!==a&&(this._ClearCoatBumpTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(a){this._ClearCoatTintTextureEnabled!==a&&(this._ClearCoatTintTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(a){this._SheenTextureEnabled!==a&&(this._SheenTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(a){this._AnisotropicTextureEnabled!==a&&(this._AnisotropicTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(a){this._ThicknessTextureEnabled!==a&&(this._ThicknessTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(a){this._RefractionIntensityTextureEnabled!==a&&(this._RefractionIntensityTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(a){this._TranslucencyIntensityTextureEnabled!==a&&(this._TranslucencyIntensityTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(a){this._TranslucencyColorTextureEnabled!==a&&(this._TranslucencyColorTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(a){this._IridescenceTextureEnabled!==a&&(this._IridescenceTextureEnabled=a,P.e.MarkAllMaterialsAsDirty(1))}}b._DiffuseTextureEnabled=!0,b._DetailTextureEnabled=!0,b._DecalMapEnabled=!0,b._AmbientTextureEnabled=!0,b._OpacityTextureEnabled=!0,b._ReflectionTextureEnabled=!0,b._EmissiveTextureEnabled=!0,b._SpecularTextureEnabled=!0,b._BumpTextureEnabled=!0,b._LightmapTextureEnabled=!0,b._RefractionTextureEnabled=!0,b._ColorGradingTextureEnabled=!0,b._FresnelEnabled=!0,b._ClearCoatTextureEnabled=!0,b._ClearCoatBumpTextureEnabled=!0,b._ClearCoatTintTextureEnabled=!0,b._SheenTextureEnabled=!0,b._AnisotropicTextureEnabled=!0,b._ThicknessTextureEnabled=!0,b._RefractionIntensityTextureEnabled=!0,b._TranslucencyIntensityTextureEnabled=!0,b._TranslucencyColorTextureEnabled=!0,b._IridescenceTextureEnabled=!0},11440:(a,v,p)=>{"use strict";p.d(v,{A:()=>D,E:()=>y,F:()=>u,J:()=>T,N:()=>q,P:()=>S,S:()=>A,U:()=>M,Y:()=>j,ab:()=>w,b:()=>X,c:()=>F,eb:()=>J,f:()=>s,hb:()=>x,j:()=>C,jb:()=>c,m:()=>f,q:()=>H,s:()=>h,w:()=>Z,y:()=>R});var P=p(10905),b=p(11279),L=p(10939),t=p(11374),V=p(11448);const K=b.d.Black();function C(a,v,p){if(!a||a.LOGARITHMICDEPTH||a.indexOf&&a.indexOf("LOGARITHMICDEPTH")>=0){const a=p.activeCamera;1===a.mode&&P.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),v.setFloat("logarithmicDepthConstant",2/(Math.log(a.maxZ+1)/Math.LN2))}}function F(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];p&&a.fogEnabled&&(!v||v.applyFog)&&0!==a.fogMode&&(p.setFloat4("vFogInfos",a.fogMode,a.fogStart,a.fogEnd,a.fogDensity),P?(a.fogColor.toLinearSpaceToRef(K,a.getEngine().useExactSrgbConversions),p.setColor3("vFogColor",K)):p.setColor3("vFogColor",a.fogColor))}function u(a,v,p){const b=p.NUM_MORPH_INFLUENCERS;if(b>0&&L.b.LastCreatedEngine){const t=L.b.LastCreatedEngine.getCaps().maxVertexAttribs,V=v.morphTargetManager;if(null!==V&&void 0!==V&&V.isUsingTextureForTargets)return;const K=V&&V.supportsNormals&&p.NORMAL,C=V&&V.supportsTangents&&p.TANGENT,F=V&&V.supportsUVs&&p.UV1;for(let p=0;p<b;p++)a.push("position"+p),K&&a.push("normal"+p),C&&a.push("tangent"+p),F&&a.push("uv_"+p),a.length>t&&P.d.Error("Cannot add more vertex attributes for mesh "+v.name)}}function c(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"),v&&(a.push("previousWorld0"),a.push("previousWorld1"),a.push("previousWorld2"),a.push("previousWorld3"))}function f(a,v){const p=a.morphTargetManager;a&&p&&v.setFloatArray("morphTargetInfluences",p.influences)}function H(a,v){v.bindToEffect(a,"Scene")}function A(a,v,p){v._needUVs=!0,v[p]=!0,a.optimizeUVAllocation&&a.getTextureMatrix().isIdentityAs3x2()?(v[p+"DIRECTUV"]=a.coordinatesIndex+1,v["MAINUV"+(a.coordinatesIndex+1)]=!0):v[p+"DIRECTUV"]=0}function h(a,v,p){const P=a.getTextureMatrix();v.Sj(p+"Matrix",P)}function R(a,v,p){p.BAKED_VERTEX_ANIMATION_TEXTURE&&p.INSTANCES&&a.push("bakedVertexAnimationSettingsInstanced")}function X(a,v,p){var P;if(v&&a&&(a.computeBonesUsingShaders&&v._bonesComputationForcedToCPU&&(a.computeBonesUsingShaders=!1),a.useBones&&a.computeBonesUsingShaders&&a.skeleton)){const b=a.skeleton;if(b.isUsingTextureForMatrices&&v.getUniformIndex("boneTextureWidth")>-1){const p=b.getTransformMatrixTexture(a);v.setTexture("boneSampler",p),v.setFloat("boneTextureWidth",4*(b.bones.length+1))}else{const L=b.getTransformMatrices(a);L&&(v.setMatrices("mBones",L),p&&a.va().prePassRenderer&&a.va().prePassRenderer.getIndex(2)&&(p.previousBones[a.uniqueId]||(p.previousBones[a.uniqueId]=L.slice()),v.setMatrices("mPreviousBones",p.previousBones[a.uniqueId]),P=L,p.previousBones[a.uniqueId].set(P)))}}}function Q(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];a._bindLight(v,p,P,b,L)}function s(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const L=Math.min(v.lightSources.length,b);for(let t=0;t<L;t++){Q(v.lightSources[t],t,a,p,"boolean"===typeof P?P:P.SPECULARTERM,v.receiveShadows)}}function D(a,v,p,P){p.NUM_BONE_INFLUENCERS>0&&(P.addCPUSkinningFallback(0,v),a.push("matricesIndices"),a.push("matricesWeights"),p.NUM_BONE_INFLUENCERS>4&&(a.push("matricesIndicesExtra"),a.push("matricesWeightsExtra")))}function y(a,v){(v.INSTANCES||v.THIN_INSTANCES)&&c(a,!!v.PREPASS_VELOCITY),v.INSTANCESCOLOR&&a.push("instanceColor")}function Z(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=0;for(let L=0;L<p&&a["LIGHT"+L];L++)L>0&&(b=P+L,v.addFallback(b,"LIGHT"+L)),a.SHADOWS||(a["SHADOW"+L]&&v.addFallback(P,"SHADOW"+L),a["SHADOWPCF"+L]&&v.addFallback(P,"SHADOWPCF"+L),a["SHADOWPCSS"+L]&&v.addFallback(P,"SHADOWPCSS"+L),a["SHADOWPOISSON"+L]&&v.addFallback(P,"SHADOWPOISSON"+L),a["SHADOWESM"+L]&&v.addFallback(P,"SHADOWESM"+L),a["SHADOWCLOSEESM"+L]&&v.addFallback(P,"SHADOWCLOSEESM"+L));return b++}function M(a,v,p,P,b,L,t){let V=arguments.length>7&&void 0!==arguments[7]&&arguments[7];t._areMiscDirty&&(t.LOGARITHMICDEPTH=p,t.POINTSIZE=P,t.FOG=b&&function(a,v){return v.fogEnabled&&a.applyFog&&0!==v.fogMode}(a,v),t.NONUNIFORMSCALING=a.nonUniformScaling,t.ALPHATEST=L,t.DECAL_AFTER_DETAIL=V)}function S(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!p._areLightsDirty)return p._needNormals;let t=0;const V={needNormals:p._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(a.lightsEnabled&&!L)for(const C of v.lightSources)if(n(a,v,C,t,p,P,V),t++,t===b)break;p.SPECULARTERM=V.specularEnabled,p.SHADOWS=V.shadowEnabled;for(let C=t;C<b;C++)void 0!==p["LIGHT"+C]&&(p["LIGHT"+C]=!1,p["HEMILIGHT"+C]=!1,p["POINTLIGHT"+C]=!1,p["DIRLIGHT"+C]=!1,p["SPOTLIGHT"+C]=!1,p["SHADOW"+C]=!1,p["SHADOWCSM"+C]=!1,p["SHADOWCSMDEBUG"+C]=!1,p["SHADOWCSMNUM_CASCADES"+C]=!1,p["SHADOWCSMUSESHADOWMAXZ"+C]=!1,p["SHADOWCSMNOBLEND"+C]=!1,p["SHADOWCSM_RIGHTHANDED"+C]=!1,p["SHADOWPCF"+C]=!1,p["SHADOWPCSS"+C]=!1,p["SHADOWPOISSON"+C]=!1,p["SHADOWESM"+C]=!1,p["SHADOWCLOSEESM"+C]=!1,p["SHADOWCUBE"+C]=!1,p["SHADOWLOWQUALITY"+C]=!1,p["SHADOWMEDIUMQUALITY"+C]=!1);const K=a.getEngine().getCaps();return void 0===p.SHADOWFLOAT&&(V.needRebuild=!0),p.SHADOWFLOAT=V.shadowEnabled&&(K.textureFloatRender&&K.textureFloatLinearFiltering||K.textureHalfFloatRender&&K.textureHalfFloatLinearFiltering),p.LIGHTMAPEXCLUDED=V.lightmapMode,V.needRebuild&&p.rebuild(),V.needNormals}function n(a,v,p,P,b,L,V){switch(V.needNormals=!0,void 0===b["LIGHT"+P]&&(V.needRebuild=!0),b["LIGHT"+P]=!0,b["SPOTLIGHT"+P]=!1,b["HEMILIGHT"+P]=!1,b["POINTLIGHT"+P]=!1,b["DIRLIGHT"+P]=!1,p.prepareLightSpecificDefines(b,P),b["LIGHT_FALLOFF_PHYSICAL"+P]=!1,b["LIGHT_FALLOFF_GLTF"+P]=!1,b["LIGHT_FALLOFF_STANDARD"+P]=!1,p.falloffType){case t.e.FALLOFF_GLTF:b["LIGHT_FALLOFF_GLTF"+P]=!0;break;case t.e.FALLOFF_PHYSICAL:b["LIGHT_FALLOFF_PHYSICAL"+P]=!0;break;case t.e.FALLOFF_STANDARD:b["LIGHT_FALLOFF_STANDARD"+P]=!0}if(L&&!p.Gh.equalsFloats(0,0,0)&&(V.specularEnabled=!0),b["SHADOW"+P]=!1,b["SHADOWCSM"+P]=!1,b["SHADOWCSMDEBUG"+P]=!1,b["SHADOWCSMNUM_CASCADES"+P]=!1,b["SHADOWCSMUSESHADOWMAXZ"+P]=!1,b["SHADOWCSMNOBLEND"+P]=!1,b["SHADOWCSM_RIGHTHANDED"+P]=!1,b["SHADOWPCF"+P]=!1,b["SHADOWPCSS"+P]=!1,b["SHADOWPOISSON"+P]=!1,b["SHADOWESM"+P]=!1,b["SHADOWCLOSEESM"+P]=!1,b["SHADOWCUBE"+P]=!1,b["SHADOWLOWQUALITY"+P]=!1,b["SHADOWMEDIUMQUALITY"+P]=!1,v&&v.receiveShadows&&a.shadowsEnabled&&p.shadowEnabled){const v=p.getShadowGenerator(a.activeCamera)??p.getShadowGenerator();if(v){const a=v.getShadowMap();a&&a.renderList&&a.renderList.length>0&&(V.shadowEnabled=!0,v.prepareDefines(b,P))}}p.lightmapMode!=t.e.LIGHTMAP_DEFAULT?(V.lightmapMode=!0,b["LIGHTMAPEXCLUDED"+P]=!0,b["LIGHTMAPNOSPECULAR"+P]=p.lightmapMode==t.e.LIGHTMAP_SHADOWSONLY):(b["LIGHTMAPEXCLUDED"+P]=!1,b["LIGHTMAPNOSPECULAR"+P]=!1)}function q(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=function(a,v){let p=!1;if(a.activeCamera){const P=v.CAMERA_ORTHOGRAPHIC?1:0,b=v.CAMERA_PERSPECTIVE?1:0,L=1===a.activeCamera.mode?1:0,t=0===a.activeCamera.mode?1:0;(P^L||b^t)&&(v.CAMERA_ORTHOGRAPHIC=1===L,v.CAMERA_PERSPECTIVE=1===t,p=!0)}return p}(a,P);!1!==L&&(K=(0,V.k)(p,a,P)),P.DEPTHPREPASS!==!v.getColorWrite()&&(P.DEPTHPREPASS=!P.DEPTHPREPASS,K=!0),P.INSTANCES!==b&&(P.INSTANCES=b,K=!0),P.THIN_INSTANCES!==t&&(P.THIN_INSTANCES=t,K=!0),K&&P.markAsUnprocessed()}function T(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!v._areAttributesDirty&&v._needNormals===v._normals&&v._needUVs===v._uvs)return!1;v._normals=v._needNormals,v._uvs=v._needUVs,v.NORMAL=v._needNormals&&a.isVerticesDataPresent("normal"),v._needNormals&&a.isVerticesDataPresent("tangent")&&(v.TANGENT=!0);for(let V=1;V<=6;++V)v["UV"+V]=!!v._needUVs&&a.isVerticesDataPresent(`uv${1===V?"":V}`);if(p){const p=a.useVertexColors&&a.isVerticesDataPresent("color");v.VERTEXCOLOR=p,v.VERTEXALPHA=a.hasVertexAlpha&&p&&L}return a.isVerticesDataPresent("instanceColor")&&(a.hasInstances||a.hasThinInstances)&&(v.INSTANCESCOLOR=!0),P&&function(a,v){if(a.useBones&&a.computeBonesUsingShaders&&a.skeleton){v.NUM_BONE_INFLUENCERS=a.numBoneInfluencers;const p=void 0!==v.BONETEXTURE;if(a.skeleton.isUsingTextureForMatrices&&p)v.BONETEXTURE=!0;else{v.BonesPerMesh=a.skeleton.bones.length+1,v.BONETEXTURE=!p&&void 0;const P=a.va().prePassRenderer;if(P&&P.enabled){const p=-1===P.excludedSkinnedMesh.indexOf(a);v.BONES_VELOCITY_ENABLED=p}}}else v.NUM_BONE_INFLUENCERS=0,v.BonesPerMesh=0,void 0!==v.BONETEXTURE&&(v.BONETEXTURE=!1)}(a,v),b&&function(a,v){const p=a.morphTargetManager;p?(v.MORPHTARGETS_UV=p.supportsUVs&&v.UV1,v.MORPHTARGETS_TANGENT=p.supportsTangents&&v.TANGENT,v.MORPHTARGETS_NORMAL=p.supportsNormals&&v.NORMAL,v.NUM_MORPH_INFLUENCERS=p.numMaxInfluencers||p.numInfluencers,v.MORPHTARGETS=v.NUM_MORPH_INFLUENCERS>0,v.MORPHTARGETS_TEXTURE=p.isUsingTextureForTargets):(v.MORPHTARGETS_UV=!1,v.MORPHTARGETS_TANGENT=!1,v.MORPHTARGETS_NORMAL=!1,v.MORPHTARGETS=!1,v.NUM_MORPH_INFLUENCERS=0)}(a,v),t&&function(a,v){const p=a.bakedVertexAnimationManager;v.BAKED_VERTEX_ANIMATION_TEXTURE=!(!p||!p.isEnabled)}(a,v),!0}function j(a,v){if(a.activeCamera){const p=v.MULTIVIEW;v.MULTIVIEW=null!==a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1,v.MULTIVIEW!=p&&v.markAsUnprocessed()}}function w(a,v,p){const P=v.ORDER_INDEPENDENT_TRANSPARENCY,b=v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;v.ORDER_INDEPENDENT_TRANSPARENCY=a.useOrderIndependentTransparency&&p,v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!a.getEngine().getCaps().textureFloatLinearFiltering,P===v.ORDER_INDEPENDENT_TRANSPARENCY&&b===v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||v.markAsUnprocessed()}function J(a,v,p){const P=v.PREPASS;if(!v._arePrePassDirty)return;const b=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(a.prePassRenderer&&a.prePassRenderer.enabled&&p){v.PREPASS=!0,v.SCENE_MRT_COUNT=a.prePassRenderer.mrtCount,v.PREPASS_NORMAL_WORLDSPACE=a.prePassRenderer.generateNormalsInWorldSpace,v.PREPASS_COLOR=!0,v.PREPASS_COLOR_INDEX=0;for(let p=0;p<b.length;p++){const P=a.prePassRenderer.getIndex(b[p].type);-1!==P?(v[b[p].define]=!0,v[b[p].index]=P):v[b[p].define]=!1}}else{v.PREPASS=!1;for(let a=0;a<b.length;a++)v[b[a].define]=!1}v.PREPASS!=P&&(v.markAsUnprocessed(),v.markAsImageProcessingDirty())}function B(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];b&&b.push("Light"+a),L||(v.push("vLightData"+a,"vLightDiffuse"+a,"vLightSpecular"+a,"vLightDirection"+a,"vLightFalloff"+a,"vLightGround"+a,"lightMatrix"+a,"shadowsInfo"+a,"depthValues"+a),p.push("shadowTexture"+a),p.push("depthTexture"+a),v.push("viewFrustumZ"+a,"cascadeBlendFactor"+a,"lightSizeUVCorrection"+a,"depthCorrection"+a,"penumbraDarkness"+a,"frustumLengths"+a),P&&(p.push("projectionLightTexture"+a),v.push("textureProjectionMatrix"+a)))}function x(a,v,p){let P,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,L=null;if(a.uniformsNames){const t=a;P=t.uniformsNames,L=t.uniformBuffersNames,v=t.samplers,p=t.defines,b=t.maxSimultaneousLights||0}else P=a,v||(v=[]);for(let t=0;t<b&&p["LIGHT"+t];t++)B(t,P,v,p["PROJECTEDLIGHTTEXTURE"+t],L);p.NUM_MORPH_INFLUENCERS&&(P.push("morphTargetInfluences"),P.push("morphTargetCount")),p.BAKED_VERTEX_ANIMATION_TEXTURE&&(P.push("bakedVertexAnimationSettings"),P.push("bakedVertexAnimationTextureSizeInverted"),P.push("bakedVertexAnimationTime"),v.push("bakedVertexAnimationTexture"))}},11497:(a,v,p)=>{"use strict";p.d(v,{e:()=>L});var P,b=p(11240);!function(a){a[a.Zero=0]="Zero",a[a.One=1]="One",a[a.MaxViewZ=2]="MaxViewZ"}(P||(P={}));class L{static CreateConfiguration(a){return L._Configurations[a]={defines:{},previousWorldMatrices:{},previousViewProjection:b.e.Zero(),currentViewProjection:b.e.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},L._Configurations[a]}static DeleteConfiguration(a){delete L._Configurations[a]}static GetConfiguration(a){return L._Configurations[a]}static AddUniformsAndSamplers(a,v){a.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(a,v){for(const p of v)if(p.rg)for(const v of p.rg)v._removeDrawWrapper(a)}static PrepareDefines(a,v,p){if(!p._arePrePassDirty)return;const P=L._Configurations[a];if(!P)return;p.PREPASS=!0,p.PREPASS_COLOR=!1,p.PREPASS_COLOR_INDEX=-1;let b=0;for(let t=0;t<L.GeometryTextureDescriptions.length;t++){const a=L.GeometryTextureDescriptions[t],v=a.define,V=a.defineIndex,K=P.defines[V];void 0!==K?(p[v]=!0,p[V]=K,b++):(p[v]=!1,delete p[V])}p.SCENE_MRT_COUNT=b,p.BONES_VELOCITY_ENABLED=v.useBones&&v.computeBonesUsingShaders&&v.skeleton&&!v.skeleton.isUsingTextureForMatrices&&-1===P.excludedSkinnedMesh.indexOf(v)}static Bind(a,v,p,P){const b=L._Configurations[a];if(b&&(void 0!==b.defines.PREPASS_VELOCITY_INDEX||void 0!==b.defines.PREPASS_VELOCITY_LINEAR_INDEX)){b.previousWorldMatrices[p.uniqueId]||(b.previousWorldMatrices[p.uniqueId]=P.clone());const a=p.va();b.previousViewProjection||(b.previousViewProjection=a.getTransformMatrix().clone(),b.currentViewProjection=a.getTransformMatrix().clone());const L=a.getEngine();if(b.currentViewProjection.updateFlag!==a.getTransformMatrix().updateFlag?(b.lastUpdateFrameId=L.frameId,b.previousViewProjection.p(b.currentViewProjection),b.currentViewProjection.p(a.getTransformMatrix())):b.lastUpdateFrameId!==L.frameId&&(b.lastUpdateFrameId=L.frameId,b.previousViewProjection.p(b.currentViewProjection)),v.setMatrix("previousWorld",b.previousWorldMatrices[p.uniqueId]),v.setMatrix("previousViewProjection",b.previousViewProjection),b.previousWorldMatrices[p.uniqueId]=P.clone(),p.useBones&&p.computeBonesUsingShaders&&p.skeleton){const a=p.skeleton;if(!a.isUsingTextureForMatrices||-1===v.getUniformIndex("boneTextureWidth")){const P=a.getTransformMatrices(p);P&&(b.previousBones[p.uniqueId]||(b.previousBones[p.uniqueId]=P.slice()),v.setMatrices("mPreviousBones",b.previousBones[p.uniqueId]),b.previousBones[p.uniqueId].set(P))}}}}}L.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],L._Configurations={}},11491:(a,v,p)=>{"use strict";p.d(v,{b:()=>R});var P=p(11207),b=p(11210),L=p(11390),t=p(10939),V=p(10961),K=p(10982);const C=new RegExp("^([gimus]+)!");class F{constructor(a){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=a,this._scene=a.va(),this._engine=this._scene.getEngine()}_addPlugin(a){for(let P=0;P<this._plugins.length;++P)if(this._plugins[P].name===a.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!a.isCompatible(this._material.shaderLanguage))throw`The plugin "${a.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const v=a.getClassName();F._MaterialPluginClassToMainDefine[v]||(F._MaterialPluginClassToMainDefine[v]="MATERIALPLUGIN_"+ ++F._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(a,v)=>this._handlePluginEvent(a,v),this._plugins.push(a),this._plugins.sort(((a,v)=>a.priority-v.priority)),this._codeInjectionPoints={};const p={};p[F._MaterialPluginClassToMainDefine[v]]={type:"boolean",default:!0};for(const P of this._plugins)P.collectDefines(p),this._collectPointNames("vertex",P.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",P.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=p,!0}_activatePlugin(a){-1===this._activePlugins.indexOf(a)&&(this._activePlugins.push(a),this._activePlugins.sort(((a,v)=>a.priority-v.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),a.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(a),this._activePluginsForExtraEvents.sort(((a,v)=>a.priority-v.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(a){for(let v=0;v<this._plugins.length;++v)if(this._plugins[v].name===a)return this._plugins[v];return null}_handlePluginEventIsReadyForSubMesh(a){let v=!0;for(const p of this._activePlugins)v=v&&p.isReadyForSubMesh(a.defines,this._scene,this._engine,a.subMesh);a.isReadyForSubMesh=v}_handlePluginEventPrepareDefinesBeforeAttributes(a){for(const v of this._activePlugins)v.prepareDefinesBeforeAttributes(a.defines,this._scene,a.mesh)}_handlePluginEventPrepareDefines(a){for(const v of this._activePlugins)v.prepareDefines(a.defines,this._scene,a.mesh)}_handlePluginEventHardBindForSubMesh(a){for(const v of this._activePluginsForExtraEvents)v.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,a.subMesh)}_handlePluginEventBindForSubMesh(a){for(const v of this._activePlugins)v.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,a.subMesh)}_handlePluginEventHasRenderTargetTextures(a){let v=!1;for(const p of this._activePluginsForExtraEvents)if(v=p.hasRenderTargetTextures(),v)break;a.hasRenderTargetTextures=v}_handlePluginEventFillRenderTargetTextures(a){for(const v of this._activePluginsForExtraEvents)v.fillRenderTargetTextures(a.renderTargets)}_handlePluginEvent(a,v){switch(a){case 512:{const a=v;for(const v of this._activePlugins)v.getActiveTextures(a.activeTextures);break}case 256:{const a=v;for(const v of this._activePlugins)v.getAnimatables(a.animatables);break}case 1024:{const a=v;let p=!1;for(const v of this._activePlugins)if(p=v.hasTexture(a.texture),p)break;a.hasTexture=p;break}case 2:{const a=v;for(const v of this._plugins)v.dispose(a.forceDisposeTextures);break}case 4:v.defineNames=this._defineNamesFromPlugins;break;case 128:{const a=v;for(const v of this._activePlugins)a.fallbackRank=v.addFallbacks(a.defines,a.fallbacks,a.fallbackRank),v.getAttributes(a.attributes,this._scene,a.mesh);this._uniformList.length>0&&a.uniforms.push(...this._uniformList),this._samplerList.length>0&&a.samplers.push(...this._samplerList),this._uboList.length>0&&a.uniformBuffersNames.push(...this._uboList),a.customCode=this._injectCustomCode(a,a.customCode);break}case 8:{const a=v;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const p=1===this._material.shaderLanguage;for(const v of this._plugins){const P=v.getUniforms(this._material.shaderLanguage);if(P){if(P.ubo)for(const v of P.ubo){if(v.size&&v.type){const P=v.arraySize??0;if(a.ubo.addUniform(v.name,v.size,P),p){let a;switch(v.type){case"mat4":a="mat4x4f";break;case"float":a="f32";break;default:a=`${v.type}f`}this._uboDeclaration+=`uniform ${v.name}: ${a}${P>0?`[${P}]`:""};\n`}else this._uboDeclaration+=`${v.type} ${v.name}${P>0?`[${P}]`:""};\n`}this._uniformList.push(v.name)}P.vertex&&(this._vertexDeclaration+=P.vertex+"\n"),P.fragment&&(this._fragmentDeclaration+=P.fragment+"\n")}v.getSamplers(this._samplerList),v.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(a,v){if(v)for(const p in v)this._codeInjectionPoints[a]||(this._codeInjectionPoints[a]={}),this._codeInjectionPoints[a][p]=!0}_injectCustomCode(a,v){return(p,P)=>{var b;v&&(P=v(p,P)),this._uboDeclaration&&(P=P.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(P=P.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(P=P.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const L=null===(b=this._codeInjectionPoints)||void 0===b?void 0:b[p];if(!L)return P;let t=null;for(let v in L){let b="";for(const P of this._activePlugins){var F;let L=null===(F=P.getCustomCode(p,this._material.shaderLanguage))||void 0===F?void 0:F[v];if(L){if(P.resolveIncludes){if(null===t){const v=0;t={defines:[],indexParameters:a.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:K.e.GetShadersRepository(v),includesShadersStore:K.e.GetIncludesShadersStore(v),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}t.isFragment="fragment"===p,(0,V.h)(L,t,(a=>L=a))}b+=L+"\n"}}if(b.length>0)if("!"===v.charAt(0)){v=v.substring(1);let a="g";if("!"===v.charAt(0))a="",v=v.substring(1);else{const p=C.exec(v);p&&p.length>=2&&(a=p[1],v=v.substring(a.length+1))}a.indexOf("g")<0&&(a+="g");const p=P,L=new RegExp(v,a);let t=L.exec(p);for(;null!==t;){let a=b;for(let v=0;v<t.length;++v)a=a.replace("$"+v,t[v]);P=P.replace(t[0],a),t=L.exec(p)}}else{const a="#define "+v;P=P.replace(a,"\n"+b+"\n"+a)}}return P}}}F._MaterialPluginClassToMainDefine={},F._MaterialPluginCounter=0,t.b.OnEnginesDisposedObservable.add((()=>{H()}));const u=[];let c=!1,f=null;function H(){u.length=0,c=!1,L.c.OnEventObservable.remove(f),f=null}var A=p(11287),h=p(11027);class R{isCompatible(a){return 0===a}_enable(a){a&&this._pluginManager._activatePlugin(this)}constructor(a,v,p,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=a,this.name=v,this.priority=p,this.resolveIncludes=t,a.pluginManager||(a.pluginManager=new F(a),a.uj.add((()=>{a.pluginManager=void 0}))),this._pluginDefineNames=P,this._pluginManager=a.pluginManager,b&&this._pluginManager._addPlugin(this),L&&this._enable(!0),this.markAllDefinesAsDirty=a._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(a,v,p,P){return!0}hardBindForSubMesh(a,v,p,P){}bindForSubMesh(a,v,p,P){}dispose(a){}getCustomCode(a){return null}collectDefines(a){if(this._pluginDefineNames)for(const v of Object.keys(this._pluginDefineNames)){if("_"===v[0])continue;const p=typeof this._pluginDefineNames[v];a[v]={type:"number"===p?"number":"string"===p?"string":"boolean"===p?"boolean":"object",default:this._pluginDefineNames[v]}}}prepareDefinesBeforeAttributes(a,v,p){}prepareDefines(a,v,p){}hasTexture(a){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(a){}getActiveTextures(a){}getAnimatables(a){}addFallbacks(a,v,p){return p}getSamplers(a){}getAttributes(a,v,p){}getUniformBuffersNames(a){}getUniforms(){return{}}copyTo(a){A.b.Clone((()=>a),this)}serialize(){return A.b.Serialize(this)}parse(a,v,p){A.b.Parse((()=>this),a,v,p)}}(0,P.e)([(0,b.O)()],R.prototype,"name",void 0),(0,P.e)([(0,b.O)()],R.prototype,"priority",void 0),(0,P.e)([(0,b.O)()],R.prototype,"resolveIncludes",void 0),(0,P.e)([(0,b.O)()],R.prototype,"registerForExtraEvents",void 0),(0,h.f)("BABYLON.MaterialPluginBase",R)},11552:(a,v,p)=>{"use strict";p.d(v,{c:()=>t});var P=p(11390),b=p(11234),L=p(11027);class t extends P.c{get sg(){return this._subMaterials}set sg(a){this._subMaterials=a,this._hookArray(a)}getChildren(){return this.sg}constructor(a,v){super(a,v,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.sg=[],this._storeEffectOnSubMeshes=!0}_hookArray(a){var v=this;const p=a.push;a.push=function(){for(var P=arguments.length,b=new Array(P),L=0;L<P;L++)b[L]=arguments[L];const t=p.apply(a,b);return v._markAllSubMeshesAsTexturesDirty(),t};const P=a.splice;a.splice=(v,p)=>{const b=P.apply(a,[v,p]);return this._markAllSubMeshesAsTexturesDirty(),b}}getSubMaterial(a){return a<0||a>=this.sg.length?this.va().defaultMaterial:this.sg[a]}getActiveTextures(){return super.getActiveTextures().concat(...this.sg.map((a=>a?a.getActiveTextures():[])))}hasTexture(a){if(super.hasTexture(a))return!0;for(let p=0;p<this.sg.length;p++){var v;if(null!==(v=this.sg[p])&&void 0!==v&&v.hasTexture(a))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(a,v,p){for(let P=0;P<this.sg.length;P++){const b=this.sg[P];if(b){if(b._storeEffectOnSubMeshes){if(!b.isReadyForSubMesh(a,v,p))return!1;continue}if(!b.isReady(a))return!1}}return!0}clone(a,v){const p=new t(a,this.va());for(let P=0;P<this.sg.length;P++){let b=null;const L=this.sg[P];b=v&&L?L.clone(a+"-"+L.name):this.sg[P],p.sg.push(b)}return p}serialize(){const a={};a.name=this.name,a.id=this.id,a.uniqueId=this.uniqueId,b.c&&(a.tags=b.c.GetTags(this)),a.materialsUniqueIds=[],a.materials=[];for(let v=0;v<this.sg.length;v++){const p=this.sg[v];p?(a.materialsUniqueIds.push(p.uniqueId),a.materials.push(p.id)):(a.materialsUniqueIds.push(null),a.materials.push(null))}return a}dispose(a,v,p){const P=this.va();if(!P)return;if(p)for(let L=0;L<this.sg.length;L++){const p=this.sg[L];p&&p.dispose(a,v)}const b=P.multiMaterials.indexOf(this);b>=0&&P.multiMaterials.splice(b,1),super.dispose(a,v)}static ParseMultiMaterial(a,v){const p=new t(a.name,v);return p.id=a.id,p._loadedUniqueId=a.uniqueId,b.c&&b.c.AddTagsTo(p,a.tags),a.materialsUniqueIds?p._waitingSubMaterialsUniqueIds=a.materialsUniqueIds:a.materials.forEach((a=>p.sg.push(v.getLastMaterialById(a)))),p}}(0,L.f)("BABYLON.MultiMaterial",t)},11381:(a,v,p)=>{"use strict";p.d(v,{c:()=>P});class P{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(a){a.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(a){}bindForSubMesh(a,v,p,P,b){if(v.prePassRenderer&&v.prePassRenderer.enabled&&v.prePassRenderer.currentRTisSceneRT&&(-1!==v.prePassRenderer.getIndex(2)||-1!==v.prePassRenderer.getIndex(11))){this.previousWorldMatrices[p.uniqueId]||(this.previousWorldMatrices[p.uniqueId]=P.clone()),this.previousViewProjection||(this.previousViewProjection=v.getTransformMatrix().clone(),this.currentViewProjection=v.getTransformMatrix().clone());const b=v.getEngine();this.currentViewProjection.updateFlag!==v.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=b.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(v.getTransformMatrix())):this._lastUpdateFrameId!==b.frameId&&(this._lastUpdateFrameId=b.frameId,this.previousViewProjection.p(this.currentViewProjection)),a.setMatrix("previousWorld",this.previousWorldMatrices[p.uniqueId]),a.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[p.uniqueId]=P.clone()}}}},11456:(a,v,p)=>{"use strict";p.d(v,{c:()=>L});var P=p(11240),b=p(11390);class L extends b.c{constructor(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(a,v,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new P.e,this._storeEffectOnSubMeshes=p}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(a,v){return!!a&&(!this._storeEffectOnSubMeshes||(!a.rg||0===a.rg.length||this.isReadyForSubMesh(a,a.rg[0],v)))}_isReadyForSubMesh(a){const v=a.materialDefines;return!(this.checkReadyOnEveryCall||!a.effect||!v||v._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(a){this._activeEffect.setMatrix("world",a)}bindOnlyNormalMatrix(a){this._activeEffect.setMatrix("normalMatrix",a)}bind(a,v){v&&this.bindForSubMesh(a,v,v.rg[0])}_afterBind(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;super._afterBind(a,v,p),this.va()._cachedEffect=v,p?p._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return p._drawWrapper._forceRebindOnNextCall||a.isCachedMaterialInvalid(this,v,P)}dispose(a,v,p){this._activeEffect=void 0,super.dispose(a,v,p)}}},11203:(a,v,p)=>{"use strict";p.d(v,{c:()=>n});var P=p(11207),b=p(11210),L=p(11223),t=p(11229),V=p(11240),K=p(11279),C=p(11306),F=p(11381),u=p(11271),c=p(11390),f=p(11454),H=p(11456),A=p(11460),h=p(11027),R=p(11476),X=p(11481),Q=p(11484),s=p(11448),D=p(11440),y=p(11287),Z=p(11497);const M={effect:null,subMesh:null};class S extends f.b{constructor(a){super(a),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(a){const v=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const p of v)this[p]=p===a}}class n extends H.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(a){a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=a||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(a){this.imageProcessingConfiguration.colorCurvesEnabled=a}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(a){this.imageProcessingConfiguration.colorGradingEnabled=a}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(a){this._imageProcessingConfiguration.toneMappingEnabled=a}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(a){this._imageProcessingConfiguration.exposure=a}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(a){this._imageProcessingConfiguration.contrast=a}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(a){this._imageProcessingConfiguration.colorGradingTexture=a}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(a){this._imageProcessingConfiguration.colorCurves=a}get canRenderToMRT(){return!0}constructor(a,v){super(a,v,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||n.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new K.d(0,0,0),this.diffuseColor=new K.d(1,1,1),this.specularColor=new K.d(1,1,1),this.emissiveColor=new K.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new L.e(16),this._worldViewProjectionMatrix=V.e.Zero(),this._globalAmbientColor=new K.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new Q.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new F.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"ob"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===c.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Ge&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==c.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Ge||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(a,v){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const b=v._drawWrapper;if(b.effect&&this.isFrozen&&b._wasPreviouslyReady&&b._wasPreviouslyUsingInstances===P)return!0;v.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),v.materialDefines=new S(this._eventInfo.defineNames));const L=this.va(),t=v.materialDefines;if(this._isReadyForSubMesh(v))return!0;const V=L.getEngine();t._needNormals=(0,D.P)(L,a,t,!0,this._maxSimultaneousLights,this._disableLighting),(0,D.Y)(L,t);const K=this.needAlphaBlendingForMesh(a)&&this.va().useOrderIndependentTransparency;if((0,D.eb)(L,t,this.canRenderToMRT&&!K),(0,D.ab)(L,t,K),Z.e.PrepareDefines(V.currentRenderPassId,a,t),t._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,t._needUVs=!1;for(let a=1;a<=6;++a)t["MAINUV"+a]=!1;if(L.texturesEnabled){if(t.DIFFUSEDIRECTUV=0,t.BUMPDIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.SPECULARDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._diffuseTexture,t,"DIFFUSE")}else t.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._ambientTexture,t,"AMBIENT")}else t.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else t.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(t._needNormals=!0,t.REFLECTION=!0,t.ROUGHNESS=this._roughness>0,t.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,t.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===A.c.INVCUBIC_MODE,t.REFLECTIONMAP_3D=this._reflectionTexture.isCube,t.REFLECTIONMAP_OPPOSITEZ=t.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,t.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case A.c.EXPLICIT_MODE:t.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case A.c.PLANAR_MODE:t.setReflectionMode("REFLECTIONMAP_PLANAR");break;case A.c.PROJECTION_MODE:t.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case A.c.SKYBOX_MODE:t.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case A.c.SPHERICAL_MODE:t.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case A.c.EQUIRECTANGULAR_MODE:t.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case A.c.FIXED_EQUIRECTANGULAR_MODE:t.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case A.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case A.c.CUBIC_MODE:case A.c.INVCUBIC_MODE:default:t.setReflectionMode("REFLECTIONMAP_CUBIC")}t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else t.REFLECTION=!1,t.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._emissiveTexture,t,"EMISSIVE")}else t.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else t.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,D.S)(this._specularTexture,t,"SPECULAR"),t.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else t.SPECULAR=!1;if(L.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,D.S)(this._bumpTexture,t,"BUMP"),t.PARALLAX=this._useParallax,t.PARALLAX_RHS=L.useRightHandedSystem,t.PARALLAXOCCLUSION=this._useParallaxOcclusion,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;t._needUVs=!0,t.REFRACTION=!0,t.REFRACTIONMAP_3D=this._refractionTexture.isCube,t.RGBDREFRACTION=this._refractionTexture.isRGBD,t.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else t.REFRACTION=!1;t.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else t.DIFFUSE=!1,t.AMBIENT=!1,t.OPACITY=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.LIGHTMAP=!1,t.BUMP=!1,t.REFRACTION=!1;t.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),t.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,t.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,t.SPECULAROVERALPHA=this._useSpecularOverAlpha,t.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,t.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,t.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(a)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=t,this._eventInfo.subMesh=v,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(t._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(t),t.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,t.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}t._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(t.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,t.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,t.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,t.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,t.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,t.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,t._needNormals=!0,t.FRESNEL=!0):t.FRESNEL=!1),(0,D.U)(a,L,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a)||this._forceAlphaTest,t,this._applyDecalMapAfterDetailMap),(0,D.N)(L,V,this,t,P,null,v.getRenderingMesh().hasThinInstances),this._eventInfo.defines=t,this._eventInfo.mesh=a,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,D.J)(a,t,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let c=!1;if(t.isDirty){const P=t._areLightsDisposed;t.markAsProcessed();const b=new X.b;t.REFLECTION&&b.addFallback(0,"REFLECTION"),t.SPECULAR&&b.addFallback(0,"SPECULAR"),t.BUMP&&b.addFallback(0,"BUMP"),t.PARALLAX&&b.addFallback(1,"PARALLAX"),t.PARALLAX_RHS&&b.addFallback(1,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&b.addFallback(0,"PARALLAXOCCLUSION"),t.SPECULAROVERALPHA&&b.addFallback(0,"SPECULAROVERALPHA"),t.FOG&&b.addFallback(1,"FOG"),t.POINTSIZE&&b.addFallback(0,"POINTSIZE"),t.LOGARITHMICDEPTH&&b.addFallback(0,"LOGARITHMICDEPTH"),(0,D.w)(t,b,this._maxSimultaneousLights),t.SPECULARTERM&&b.addFallback(0,"SPECULARTERM"),t.DIFFUSEFRESNEL&&b.addFallback(1,"DIFFUSEFRESNEL"),t.OPACITYFRESNEL&&b.addFallback(2,"OPACITYFRESNEL"),t.REFLECTIONFRESNEL&&b.addFallback(3,"REFLECTIONFRESNEL"),t.EMISSIVEFRESNEL&&b.addFallback(4,"EMISSIVEFRESNEL"),t.FRESNEL&&b.addFallback(4,"FRESNEL"),t.MULTIVIEW&&b.addFallback(0,"MULTIVIEW");const K=[C.f.PositionKind];t.NORMAL&&K.push(C.f.NormalKind),t.TANGENT&&K.push(C.f.TangentKind);for(let a=1;a<=6;++a)t["UV"+a]&&K.push(`uv${1===a?"":a}`);t.VERTEXCOLOR&&K.push(C.f.ColorKind),(0,D.A)(K,a,t,b),(0,D.E)(K,t),(0,D.F)(K,a,t),(0,D.y)(K,a,t);let f="default";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],A=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],h=["Material","Scene","Mesh"],R={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=b,this._eventInfo.fallbackRank=0,this._eventInfo.defines=t,this._eventInfo.uniforms=H,this._eventInfo.attributes=K,this._eventInfo.samplers=A,this._eventInfo.uniformBuffersNames=h,this._eventInfo.customCode=void 0,this._eventInfo.mesh=a,this._eventInfo.indexParameters=R,this._callbackPluginEventGeneric(128,this._eventInfo),Z.e.AddUniformsAndSamplers(H,A),F.c.AddUniforms(H),F.c.AddSamplers(A),u.c&&(u.c.PrepareUniforms(H,t),u.c.PrepareSamplers(A,t)),(0,D.hb)({uniformsNames:H,uniformBuffersNames:h,samplers:A,defines:t,maxSimultaneousLights:this._maxSimultaneousLights}),(0,s.e)(H);const Q={};this.customShaderNameResolve&&(f=this.customShaderNameResolve(f,H,h,A,t,K,Q));const y=t.toString(),S=v.effect;let n=L.getEngine().createEffect(f,{attributes:K,uniformsNames:H,uniformBuffersNames:h,samplers:A,defines:y,fallbacks:b,onCompiled:this.onCompiled,onError:this.onError,indexParameters:R,processFinalCode:Q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([p.e(21),p.e(19)]).then(p.bind(p,13145)),Promise.all([p.e(22),p.e(20)]).then(p.bind(p,13293))]):await Promise.all([Promise.all([p.e(25),p.e(24)]).then(p.bind(p,13367)),Promise.all([p.e(27),p.e(26)]).then(p.bind(p,13515))]),this._shadersLoaded=!0}},V);if(this._eventInfo.customCode=void 0,n)if(this._onEffectCreatedObservable&&(M.effect=n,M.subMesh=v,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&S&&!n.isReady()){if(n=S,t.markAsUnprocessed(),c=this.isFrozen,P)return t._areLightsDisposed=!0,!1}else L.resetCachedMaterial(),v.setEffect(n,t,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(t._renderId=L.getRenderId(),b._wasPreviouslyReady=!c,b._wasPreviouslyUsingInstances=P,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const a=this._uniformBuffer;a.addUniform("diffuseLeftColor",4),a.addUniform("diffuseRightColor",4),a.addUniform("opacityParts",4),a.addUniform("reflectionLeftColor",4),a.addUniform("reflectionRightColor",4),a.addUniform("refractionLeftColor",4),a.addUniform("refractionRightColor",4),a.addUniform("emissiveLeftColor",4),a.addUniform("emissiveRightColor",4),a.addUniform("vDiffuseInfos",2),a.addUniform("vAmbientInfos",2),a.addUniform("vOpacityInfos",2),a.addUniform("vReflectionInfos",2),a.addUniform("vReflectionPosition",3),a.addUniform("vReflectionSize",3),a.addUniform("vEmissiveInfos",2),a.addUniform("vLightmapInfos",2),a.addUniform("vSpecularInfos",2),a.addUniform("vBumpInfos",3),a.addUniform("diffuseMatrix",16),a.addUniform("ambientMatrix",16),a.addUniform("opacityMatrix",16),a.addUniform("reflectionMatrix",16),a.addUniform("emissiveMatrix",16),a.addUniform("lightmapMatrix",16),a.addUniform("specularMatrix",16),a.addUniform("bumpMatrix",16),a.addUniform("vTangentSpaceParams",2),a.addUniform("pointSize",1),a.addUniform("alphaCutOff",1),a.addUniform("refractionMatrix",16),a.addUniform("vRefractionInfos",4),a.addUniform("vRefractionPosition",3),a.addUniform("vRefractionSize",3),a.addUniform("vSpecularColor",4),a.addUniform("vEmissiveColor",3),a.addUniform("vDiffuseColor",4),a.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(a,v,p){const P=this.va(),b=p.materialDefines;if(!b)return;const L=p.effect;if(!L)return;this._activeEffect=L,v.getMeshUniformBuffer().bindToEffect(L,"Mesh"),v.transferToEffect(a),this._uniformBuffer.bindToEffect(L,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,P,v,a,this.isFrozen),Z.e.Bind(P.getEngine().currentRenderPassId,this._activeEffect,v,a),this._eventInfo.subMesh=p,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),b.OBJECTSPACE_NORMALMAP&&(a.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const V=this._mustRebind(P,L,p,v.visibility);(0,D.b)(v,L);const C=this._uniformBuffer;if(V){if(this.bindViewProjection(L),!C.useUbo||!this.isFrozen||!C.isSync||p._drawWrapper._forceRebindOnNextCall){if(n.FresnelEnabled&&b.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(C.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),C.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&C.updateColor4("opacityParts",new K.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(C.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),C.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(C.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),C.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(C.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),C.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),P.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(C.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,D.s)(this._diffuseTexture,C,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(C.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,D.s)(this._ambientTexture,C,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(C.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,D.s)(this._opacityTexture,C,"opacity")),this._hasAlphaChannel()&&C.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled&&(C.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),C.Sj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const a=this._reflectionTexture;C.updateVector3("vReflectionPosition",a.boundingBoxPosition),C.updateVector3("vReflectionSize",a.boundingBoxSize)}if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(C.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,D.s)(this._emissiveTexture,C,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(C.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,D.s)(this._lightmapTexture,C,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(C.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,D.s)(this._specularTexture,C,"specular")),this._bumpTexture&&P.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(C.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,D.s)(this._bumpTexture,C,"bump"),P._mirroredCameraPosition?C.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):C.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){let a=1;if(this._refractionTexture.isCube||(C.Sj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(a=this._refractionTexture.depth)),C.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,a,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const a=this._refractionTexture;C.updateVector3("vRefractionPosition",a.boundingBoxPosition),C.updateVector3("vRefractionSize",a.boundingBoxSize)}}}this.pointsCloud&&C.updateFloat("pointSize",this.pointSize),C.updateColor4("vSpecularColor",this.specularColor,this.specularPower),C.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:K.d.BlackReadOnly),C.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),P.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),C.updateColor3("vAmbientColor",this._globalAmbientColor)}P.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&L.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&L.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&L.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?L.setTexture("reflectionCubeSampler",this._reflectionTexture):L.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&L.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&L.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&L.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&P.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&L.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?L.setTexture("refractionCubeSampler",this._refractionTexture):L.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(v)&&this.va().depthPeelingRenderer.bind(L),this._eventInfo.subMesh=p,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,s.g)(L,this,P),this.bindEyePosition(L)}else P.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(V||!this.isFrozen){var F;if(P.lightsEnabled&&!this._disableLighting&&(0,D.f)(P,v,L,b,this._maxSimultaneousLights),(P.fogEnabled&&v.applyFog&&P.fogMode!==t.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||v.receiveShadows||b.PREPASS)&&this.bindView(L),(0,D.c)(P,v,L),b.NUM_MORPH_INFLUENCERS&&(0,D.m)(v,L),b.BAKED_VERTEX_ANIMATION_TEXTURE)null===(F=v.bakedVertexAnimationManager)||void 0===F||F.bind(L,b.INSTANCES);this.useLogarithmicDepth&&(0,D.j)(b,L,P),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(v,this._activeEffect,p),C.update()}getAnimatables(){const a=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&a.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&a.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&a.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&a.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&a.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&a.push(this._refractionTexture),a}getActiveTextures(){const a=super.getActiveTextures();return this._diffuseTexture&&a.push(this._diffuseTexture),this._ambientTexture&&a.push(this._ambientTexture),this._opacityTexture&&a.push(this._opacityTexture),this._reflectionTexture&&a.push(this._reflectionTexture),this._emissiveTexture&&a.push(this._emissiveTexture),this._specularTexture&&a.push(this._specularTexture),this._bumpTexture&&a.push(this._bumpTexture),this._lightmapTexture&&a.push(this._lightmapTexture),this._refractionTexture&&a.push(this._refractionTexture),a}hasTexture(a){return!!super.hasTexture(a)||(this._diffuseTexture===a||(this._ambientTexture===a||(this._opacityTexture===a||(this._reflectionTexture===a||(this._emissiveTexture===a||(this._specularTexture===a||(this._bumpTexture===a||(this._lightmapTexture===a||this._refractionTexture===a))))))))}dispose(a,v){var p,P,b,L,t,V,K,C,F;v&&(null===(p=this._diffuseTexture)||void 0===p||p.dispose(),null===(P=this._ambientTexture)||void 0===P||P.dispose(),null===(b=this._opacityTexture)||void 0===b||b.dispose(),null===(L=this._reflectionTexture)||void 0===L||L.dispose(),null===(t=this._emissiveTexture)||void 0===t||t.dispose(),null===(V=this._specularTexture)||void 0===V||V.dispose(),null===(K=this._bumpTexture)||void 0===K||K.dispose(),null===(C=this._lightmapTexture)||void 0===C||C.dispose(),null===(F=this._refractionTexture)||void 0===F||F.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(a,v)}clone(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const P=y.b.Clone((()=>new n(a,this.va())),this,{cloneTexturesOnlyOnce:v});return P.name=a,P.id=a,this.stencil.copyTo(P.stencil),this._clonePlugins(P,p),P}static Parse(a,v,p){const P=y.b.Parse((()=>new n(a.name,v)),a,v,p);return a.stencil&&P.stencil.parse(a.stencil,v,p),c.c._ParsePlugins(a,P,v,p),P}static get DiffuseTextureEnabled(){return R.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(a){R.e.DiffuseTextureEnabled=a}static get DetailTextureEnabled(){return R.e.DetailTextureEnabled}static set DetailTextureEnabled(a){R.e.DetailTextureEnabled=a}static get AmbientTextureEnabled(){return R.e.AmbientTextureEnabled}static set AmbientTextureEnabled(a){R.e.AmbientTextureEnabled=a}static get OpacityTextureEnabled(){return R.e.OpacityTextureEnabled}static set OpacityTextureEnabled(a){R.e.OpacityTextureEnabled=a}static get ReflectionTextureEnabled(){return R.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(a){R.e.ReflectionTextureEnabled=a}static get EmissiveTextureEnabled(){return R.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(a){R.e.EmissiveTextureEnabled=a}static get SpecularTextureEnabled(){return R.e.SpecularTextureEnabled}static set SpecularTextureEnabled(a){R.e.SpecularTextureEnabled=a}static get BumpTextureEnabled(){return R.e.BumpTextureEnabled}static set BumpTextureEnabled(a){R.e.BumpTextureEnabled=a}static get LightmapTextureEnabled(){return R.e.LightmapTextureEnabled}static set LightmapTextureEnabled(a){R.e.LightmapTextureEnabled=a}static get RefractionTextureEnabled(){return R.e.RefractionTextureEnabled}static set RefractionTextureEnabled(a){R.e.RefractionTextureEnabled=a}static get ColorGradingTextureEnabled(){return R.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(a){R.e.ColorGradingTextureEnabled=a}static get FresnelEnabled(){return R.e.FresnelEnabled}static set FresnelEnabled(a){R.e.FresnelEnabled=a}}n.ForceGLSL=!1,(0,P.e)([(0,b.H)("diffuseTexture")],n.prototype,"_diffuseTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"diffuseTexture",void 0),(0,P.e)([(0,b.H)("ambientTexture")],n.prototype,"_ambientTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,P.e)([(0,b.H)("opacityTexture")],n.prototype,"_opacityTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,P.e)([(0,b.H)("reflectionTexture")],n.prototype,"_reflectionTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,P.e)([(0,b.H)("emissiveTexture")],n.prototype,"_emissiveTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,P.e)([(0,b.H)("specularTexture")],n.prototype,"_specularTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularTexture",void 0),(0,P.e)([(0,b.H)("bumpTexture")],n.prototype,"_bumpTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,P.e)([(0,b.H)("lightmapTexture")],n.prototype,"_lightmapTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"lightmapTexture",void 0),(0,P.e)([(0,b.H)("refractionTexture")],n.prototype,"_refractionTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,P.e)([(0,b.l)("ambient")],n.prototype,"ambientColor",void 0),(0,P.e)([(0,b.l)("diffuse")],n.prototype,"diffuseColor",void 0),(0,P.e)([(0,b.l)("specular")],n.prototype,"specularColor",void 0),(0,P.e)([(0,b.l)("emissive")],n.prototype,"emissiveColor",void 0),(0,P.e)([(0,b.O)()],n.prototype,"specularPower",void 0),(0,P.e)([(0,b.O)("useAlphaFromDiffuseTexture")],n.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromDiffuseTexture",void 0),(0,P.e)([(0,b.O)("useEmissiveAsIllumination")],n.prototype,"_useEmissiveAsIllumination",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useEmissiveAsIllumination",void 0),(0,P.e)([(0,b.O)("linkEmissiveWithDiffuse")],n.prototype,"_linkEmissiveWithDiffuse",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkEmissiveWithDiffuse",void 0),(0,P.e)([(0,b.O)("useSpecularOverAlpha")],n.prototype,"_useSpecularOverAlpha",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,P.e)([(0,b.O)("useReflectionOverAlpha")],n.prototype,"_useReflectionOverAlpha",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useReflectionOverAlpha",void 0),(0,P.e)([(0,b.O)("disableLighting")],n.prototype,"_disableLighting",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,P.e)([(0,b.O)("useObjectSpaceNormalMap")],n.prototype,"_useObjectSpaceNormalMap",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,P.e)([(0,b.O)("useParallax")],n.prototype,"_useParallax",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,P.e)([(0,b.O)("useParallaxOcclusion")],n.prototype,"_useParallaxOcclusion",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,P.e)([(0,b.O)()],n.prototype,"parallaxScaleBias",void 0),(0,P.e)([(0,b.O)("roughness")],n.prototype,"_roughness",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,P.e)([(0,b.O)()],n.prototype,"indexOfRefraction",void 0),(0,P.e)([(0,b.O)()],n.prototype,"invertRefractionY",void 0),(0,P.e)([(0,b.O)()],n.prototype,"alphaCutOff",void 0),(0,P.e)([(0,b.O)("useLightmapAsShadowmap")],n.prototype,"_useLightmapAsShadowmap",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,P.e)([(0,b.s)("diffuseFresnelParameters")],n.prototype,"_diffuseFresnelParameters",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"diffuseFresnelParameters",void 0),(0,P.e)([(0,b.s)("opacityFresnelParameters")],n.prototype,"_opacityFresnelParameters",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],n.prototype,"opacityFresnelParameters",void 0),(0,P.e)([(0,b.s)("reflectionFresnelParameters")],n.prototype,"_reflectionFresnelParameters",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"reflectionFresnelParameters",void 0),(0,P.e)([(0,b.s)("refractionFresnelParameters")],n.prototype,"_refractionFresnelParameters",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"refractionFresnelParameters",void 0),(0,P.e)([(0,b.s)("emissiveFresnelParameters")],n.prototype,"_emissiveFresnelParameters",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"emissiveFresnelParameters",void 0),(0,P.e)([(0,b.O)("useReflectionFresnelFromSpecular")],n.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"useReflectionFresnelFromSpecular",void 0),(0,P.e)([(0,b.O)("useGlossinessFromSpecularMapAlpha")],n.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,P.e)([(0,b.O)("maxSimultaneousLights")],n.prototype,"_maxSimultaneousLights",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,P.e)([(0,b.O)("invertNormalMapX")],n.prototype,"_invertNormalMapX",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,P.e)([(0,b.O)("invertNormalMapY")],n.prototype,"_invertNormalMapY",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,P.e)([(0,b.O)("twoSidedLighting")],n.prototype,"_twoSidedLighting",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,P.e)([(0,b.O)("applyDecalMapAfterDetailMap")],n.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,P.e)([(0,b.e)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,h.f)("BABYLON.StandardMaterial",n),t.c.DefaultMaterialFactory=a=>new n("default material",a)},11301:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(10905),b=p(10889);class L{constructor(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=a,this._noUBO=!a.supportsUniformBuffers||b,this._dynamic=p,this._name=P??"no-name",this._data=v||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Sj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Sj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(a){let v;if(v=a<=2?a:4,this._uniformLocationPointer%v!==0){const a=this._uniformLocationPointer;this._uniformLocationPointer+=v-this._uniformLocationPointer%v;const p=this._uniformLocationPointer-a;for(let v=0;v<p;v++)this._data.push(0)}}addUniform(a,v){let p,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[a]){if(P>0){if(v instanceof Array)throw"addUniform should not be use with Array in UBO: "+a;if(this._fillAlignment(4),this._uniformArraySizes[a]={strideSize:v,arraySize:P},16==v)v*=P;else{v=v*P+(4-v)*P}p=[];for(let a=0;a<v;a++)p.push(0)}else{if(v instanceof Array)p=v,v=p.length;else{p=[];for(let a=0;a<v;a++)p.push(0)}this._fillAlignment(v)}this._uniformSizes[a]=v,this._uniformLocations[a]=this._uniformLocationPointer,this._uniformLocationPointer+=v;for(let a=0;a<v;a++)this._data.push(p[a]);this._needSync=!0}}addMatrix(a,v){this.addUniform(a,Array.prototype.slice.call(v.tj()))}addFloat2(a,v,p){const P=[v,p];this.addUniform(a,P)}addFloat3(a,v,p,P){const b=[v,p,P];this.addUniform(a,b)}addColor3(a,v){const p=[v.r,v.g,v.b];this.addUniform(a,p)}addColor4(a,v,p){const P=[v.r,v.g,v.b,p];this.addUniform(a,P)}addVector3(a,v){const p=[v.x,v.y,v.z];this.addUniform(a,p)}addMatrix3x3(a){this.addUniform(a,12)}addMatrix2x2(a){this.addUniform(a,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const a=[];let v=0;for(const p in this._uniformLocations)if(a.push(p),10===++v)break;return a.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(a,v){for(let p=0;p<a.length;++p)if(a[p]!==v[p])return!1;return!0}_copyBuffer(a,v){for(let p=0;p<a.length;++p)v[p]=a[p]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(L._UpdatedUbosInFrame[this._name]||(L._UpdatedUbosInFrame[this._name]=0),L._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(a,v,p){this._checkNewFrame();let b=this._uniformLocations[a];if(void 0===b){if(this._buffer)return void P.d.Error("Cannot add an uniform after UBO has been created. uniformName="+a);this.addUniform(a,p),b=this._uniformLocations[a]}if(this._buffer||this.create(),this._dynamic)for(let P=0;P<p;P++)this._bufferData[b+P]=v[P];else{let a=!1;for(let P=0;P<p;P++)(16===p&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[b+P]!==Math.fround(v[P]))&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[b+P]=v[P]);this._needSync=this._needSync||a}}updateUniformArray(a,v,p){this._checkNewFrame();const L=this._uniformLocations[a];if(void 0===L)return void P.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const t=this._uniformArraySizes[a];if(this._dynamic)for(let P=0;P<p;P++)this._bufferData[L+P]=v[P];else{let a=!1,P=0,V=0;for(let K=0;K<p;K++)if(this._bufferData[L+4*V+P]!==b.e.FloatRound(v[K])&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[L+4*V+P]=v[K]),P++,P===t.strideSize){for(;P<4;P++)this._bufferData[L+4*V+P]=0;P=0,V++}this._needSync=this._needSync||a}}_cacheMatrix(a,v){this._checkNewFrame();const p=this._valueCache[a],P=v.updateFlag;return(void 0===p||p!==P)&&(this._valueCache[a]=P,!0)}_updateMatrix3x3ForUniform(a,v){for(let p=0;p<3;p++)L._TempBuffer[4*p]=v[3*p],L._TempBuffer[4*p+1]=v[3*p+1],L._TempBuffer[4*p+2]=v[3*p+2],L._TempBuffer[4*p+3]=0;this.updateUniform(a,L._TempBuffer,12)}_updateMatrix3x3ForEffect(a,v){this._currentEffect.setMatrix3x3(a,v)}_updateMatrix2x2ForEffect(a,v){this._currentEffect.setMatrix2x2(a,v)}_updateMatrix2x2ForUniform(a,v){for(let p=0;p<2;p++)L._TempBuffer[4*p]=v[2*p],L._TempBuffer[4*p+1]=v[2*p+1],L._TempBuffer[4*p+2]=0,L._TempBuffer[4*p+3]=0;this.updateUniform(a,L._TempBuffer,8)}_updateFloatForEffect(a,v){this._currentEffect.setFloat(a,v)}_updateFloatForUniform(a,v){L._TempBuffer[0]=v,this.updateUniform(a,L._TempBuffer,1)}_updateFloat2ForEffect(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(a+P,v,p)}_updateFloat2ForUniform(a,v,p){L._TempBuffer[0]=v,L._TempBuffer[1]=p,this.updateUniform(a,L._TempBuffer,2)}_updateFloat3ForEffect(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(a+b,v,p,P)}_updateFloat3ForUniform(a,v,p,P){L._TempBuffer[0]=v,L._TempBuffer[1]=p,L._TempBuffer[2]=P,this.updateUniform(a,L._TempBuffer,3)}_updateFloat4ForEffect(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(a+L,v,p,P,b)}_updateFloat4ForUniform(a,v,p,P,b){L._TempBuffer[0]=v,L._TempBuffer[1]=p,L._TempBuffer[2]=P,L._TempBuffer[3]=b,this.updateUniform(a,L._TempBuffer,4)}_updateFloatArrayForEffect(a,v){this._currentEffect.setFloatArray(a,v)}_updateFloatArrayForUniform(a,v){this.updateUniformArray(a,v,v.length)}_updateArrayForEffect(a,v){this._currentEffect.setArray(a,v)}_updateArrayForUniform(a,v){this.updateUniformArray(a,v,v.length)}_updateIntArrayForEffect(a,v){this._currentEffect.setIntArray(a,v)}_updateIntArrayForUniform(a,v){L._TempBufferInt32View.set(v),this.updateUniformArray(a,L._TempBuffer,v.length)}_updateUIntArrayForEffect(a,v){this._currentEffect.setUIntArray(a,v)}_updateUIntArrayForUniform(a,v){L._TempBufferUInt32View.set(v),this.updateUniformArray(a,L._TempBuffer,v.length)}_updateMatrixForEffect(a,v){this._currentEffect.setMatrix(a,v)}_updateMatrixForUniform(a,v){this._cacheMatrix(a,v)&&this.updateUniform(a,v.tj(),16)}_updateMatricesForEffect(a,v){this._currentEffect.setMatrices(a,v)}_updateMatricesForUniform(a,v){this.updateUniform(a,v,v.length)}_updateVector3ForEffect(a,v){this._currentEffect.setVector3(a,v)}_updateVector3ForUniform(a,v){L._TempBuffer[0]=v.x,L._TempBuffer[1]=v.y,L._TempBuffer[2]=v.z,this.updateUniform(a,L._TempBuffer,3)}_updateVector4ForEffect(a,v){this._currentEffect.setVector4(a,v)}_updateVector4ForUniform(a,v){L._TempBuffer[0]=v.x,L._TempBuffer[1]=v.y,L._TempBuffer[2]=v.z,L._TempBuffer[3]=v.w,this.updateUniform(a,L._TempBuffer,4)}_updateColor3ForEffect(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(a+p,v)}_updateColor3ForUniform(a,v){L._TempBuffer[0]=v.r,L._TempBuffer[1]=v.g,L._TempBuffer[2]=v.b,this.updateUniform(a,L._TempBuffer,3)}_updateColor4ForEffect(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(a+P,v,p)}_updateDirectColor4ForEffect(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(a+p,v)}_updateColor4ForUniform(a,v,p){L._TempBuffer[0]=v.r,L._TempBuffer[1]=v.g,L._TempBuffer[2]=v.b,L._TempBuffer[3]=p,this.updateUniform(a,L._TempBuffer,4)}_updateDirectColor4ForUniform(a,v){L._TempBuffer[0]=v.r,L._TempBuffer[1]=v.g,L._TempBuffer[2]=v.b,L._TempBuffer[3]=v.a,this.updateUniform(a,L._TempBuffer,4)}_updateIntForEffect(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(a+p,v)}_updateIntForUniform(a,v){L._TempBufferInt32View[0]=v,this.updateUniform(a,L._TempBuffer,1)}_updateInt2ForEffect(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(a+P,v,p)}_updateInt2ForUniform(a,v,p){L._TempBufferInt32View[0]=v,L._TempBufferInt32View[1]=p,this.updateUniform(a,L._TempBuffer,2)}_updateInt3ForEffect(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(a+b,v,p,P)}_updateInt3ForUniform(a,v,p,P){L._TempBufferInt32View[0]=v,L._TempBufferInt32View[1]=p,L._TempBufferInt32View[2]=P,this.updateUniform(a,L._TempBuffer,3)}_updateInt4ForEffect(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(a+L,v,p,P,b)}_updateInt4ForUniform(a,v,p,P,b){L._TempBufferInt32View[0]=v,L._TempBufferInt32View[1]=p,L._TempBufferInt32View[2]=P,L._TempBufferInt32View[3]=b,this.updateUniform(a,L._TempBuffer,4)}_updateUIntForEffect(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(a+p,v)}_updateUIntForUniform(a,v){L._TempBufferUInt32View[0]=v,this.updateUniform(a,L._TempBuffer,1)}_updateUInt2ForEffect(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(a+P,v,p)}_updateUInt2ForUniform(a,v,p){L._TempBufferUInt32View[0]=v,L._TempBufferUInt32View[1]=p,this.updateUniform(a,L._TempBuffer,2)}_updateUInt3ForEffect(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(a+b,v,p,P)}_updateUInt3ForUniform(a,v,p,P){L._TempBufferUInt32View[0]=v,L._TempBufferUInt32View[1]=p,L._TempBufferUInt32View[2]=P,this.updateUniform(a,L._TempBuffer,3)}_updateUInt4ForEffect(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(a+L,v,p,P,b)}_updateUInt4ForUniform(a,v,p,P,b){L._TempBufferUInt32View[0]=v,L._TempBufferUInt32View[1]=p,L._TempBufferUInt32View[2]=P,L._TempBufferUInt32View[3]=b,this.updateUniform(a,L._TempBuffer,4)}setTexture(a,v){this._currentEffect.setTexture(a,v)}setTextureArray(a,v){this._currentEffect.setTextureArray(a,v)}bindTexture(a,v){this._currentEffect._bindTexture(a,v)}updateUniformDirectly(a,v){this.updateUniform(a,v,v.length),this.update()}bindToEffect(a,v){this._currentEffect=a,this._currentEffectName=v}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(a){if(!this._buffers)return this._buffer===a;for(let v=0;v<this._buffers.length;++v){if(this._buffers[v][0]===a)return this._bufferIndex=v,this._buffer=a,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const a=this._engine._uniformBuffers,v=a.indexOf(this);if(-1!==v&&(a[v]=a[a.length-1],a.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let p=0;p<this._buffers.length;++p){const a=this._buffers[p][0];this._engine._releaseBuffer(a)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}L._UpdatedUbosInFrame={},L._MAX_UNIFORM_SIZE=256,L._TempBuffer=new Float32Array(L._MAX_UNIFORM_SIZE),L._TempBufferInt32View=new Int32Array(L._TempBuffer.buffer),L._TempBufferUInt32View=new Uint32Array(L._TempBuffer.buffer)},11549:(a,v,p)=>{"use strict";p.d(v,{b:()=>t,c:()=>P});var P,b,L=p(11240);!function(a){a[a.LOCAL=0]="LOCAL",a[a.WORLD=1]="WORLD",a[a.BONE=2]="BONE"}(P||(P={}));class t{}t.X=new L.s(1,0,0),t.Y=new L.s(0,1,0),t.Z=new L.s(0,0,1),function(a){a[a.X=0]="X",a[a.Y=1]="Y",a[a.Z=2]="Z"}(b||(b={}))},11279:(a,v,p)=>{"use strict";p.d(v,{d:()=>u,e:()=>c,h:()=>f});var P=p(11254),b=p(11027),L=p(11245),t=p(11263);function V(a){return Math.pow(a,L.m)}function K(a){return a<=.04045?.0773993808*a:Math.pow(.947867299*(a+.055),2.4)}function C(a){return Math.pow(a,L.k)}function F(a){return a<=.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}class u{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=a,this.g=v,this.b=p}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let a=255*this.r|0;return a=397*a^255*this.g,a=397*a^255*this.b,a}toArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[v]=this.r,a[v+1]=this.g,a[v+2]=this.b,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(a,v,this),this}toColor4(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new c(this.r,this.g,this.b,a)}tj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(a){return new u(this.r*a.r,this.g*a.g,this.b*a.b)}multiplyToRef(a,v){return v.r=this.r*a.r,v.g=this.g*a.g,v.b=this.b*a.b,v}multiplyInPlace(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyByFloats(a,v,p){return new u(this.r*a,this.g*v,this.b*p)}divide(a){throw new ReferenceError("Can not divide a color")}divideToRef(a,v){throw new ReferenceError("Can not divide a color")}divideInPlace(a){throw new ReferenceError("Can not divide a color")}minimizeInPlace(a){return this.minimizeInPlaceFromFloats(a.r,a.g,a.b)}maximizeInPlace(a){return this.maximizeInPlaceFromFloats(a.r,a.g,a.b)}minimizeInPlaceFromFloats(a,v,p){return this.r=Math.min(a,this.r),this.g=Math.min(v,this.g),this.b=Math.min(p,this.b),this}maximizeInPlaceFromFloats(a,v,p){return this.r=Math.max(a,this.r),this.g=Math.max(v,this.g),this.b=Math.max(p,this.b),this}floorToRef(a){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(a){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b}equalsFloats(a,v,p){return this.equalsToFloats(a,v,p)}equalsToFloats(a,v,p){return this.r===a&&this.g===v&&this.b===p}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.e;return(0,t.w)(this.r,a.r,v)&&(0,t.w)(this.g,a.g,v)&&(0,t.w)(this.b,a.b,v)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(a){throw new ReferenceError("Can not negate a color")}scale(a){return new u(this.r*a,this.g*a,this.b*a)}scaleInPlace(a){return this.r*=a,this.g*=a,this.b*=a,this}scaleToRef(a,v){return v.r=this.r*a,v.g=this.g*a,v.b=this.b*a,v}scaleAndAddToRef(a,v){return v.r+=this.r*a,v.g+=this.g*a,v.b+=this.b*a,v}clampToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2?arguments[2]:void 0;return p.r=(0,t.e)(this.r,a,v),p.g=(0,t.e)(this.g,a,v),p.b=(0,t.e)(this.b,a,v),p}add(a){return new u(this.r+a.r,this.g+a.g,this.b+a.b)}addInPlace(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addInPlaceFromFloats(a,v,p){return this.r+=a,this.g+=v,this.b+=p,this}addToRef(a,v){return v.r=this.r+a.r,v.g=this.g+a.g,v.b=this.b+a.b,v}od(a){return new u(this.r-a.r,this.g-a.g,this.b-a.b)}subtractToRef(a,v){return v.r=this.r-a.r,v.g=this.g-a.g,v.b=this.b-a.b,v}Bi(a){return this.r-=a.r,this.g-=a.g,this.b-=a.b,this}subtractFromFloats(a,v,p){return new u(this.r-a,this.g-v,this.b-p)}subtractFromFloatsToRef(a,v,p,P){return P.r=this.r-a,P.g=this.g-v,P.b=this.b-p,P}clone(){return new u(this.r,this.g,this.b)}p(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}qe(a,v,p){return this.r=a,this.g=v,this.b=p,this}set(a,v,p){return this.qe(a,v,p)}pe(a){return this.r=this.g=this.b=a,this}toHexString(){const a=Math.round(255*this.r),v=Math.round(255*this.g),p=Math.round(255*this.b);return"#"+(0,t.u)(a)+(0,t.u)(v)+(0,t.u)(p)}fromHexString(a){return"#"!==a.substring(0,1)||7!==a.length||(this.r=parseInt(a.substring(1,3),16)/255,this.g=parseInt(a.substring(3,5),16)/255,this.b=parseInt(a.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new u)}toHSVToRef(a){const v=this.r,p=this.g,P=this.b,b=Math.max(v,p,P),L=Math.min(v,p,P);let t=0,V=0;const K=b,C=b-L;return 0!==b&&(V=C/b),b!=L&&(b==v?(t=(p-P)/C,p<P&&(t+=6)):b==p?t=(P-v)/C+2:b==P&&(t=(v-p)/C+4),t*=60),a.r=t,a.g=V,a.b=K,a}toLinearSpace(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=new u;return this.toLinearSpaceToRef(v,a),v}toLinearSpaceToRef(a){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(a.r=K(this.r),a.g=K(this.g),a.b=K(this.b)):(a.r=V(this.r),a.g=V(this.g),a.b=V(this.b)),this}toGammaSpace(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=new u;return this.toGammaSpaceToRef(v,a),v}toGammaSpaceToRef(a){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(a.r=F(this.r),a.g=F(this.g),a.b=F(this.b)):(a.r=C(this.r),a.g=C(this.g),a.b=C(this.b)),this}static HSVtoRGBToRef(a,v,p,P){const b=p*v,L=a/60,t=b*(1-Math.abs(L%2-1));let V=0,K=0,C=0;L>=0&&L<=1?(V=b,K=t):L>=1&&L<=2?(V=t,K=b):L>=2&&L<=3?(K=b,C=t):L>=3&&L<=4?(K=t,C=b):L>=4&&L<=5?(V=t,C=b):L>=5&&L<=6&&(V=b,C=t);const F=p-b;return P.r=V+F,P.g=K+F,P.b=C+F,P}static FromHSV(a,v,p){const P=new u(0,0,0);return u.HSVtoRGBToRef(a,v,p,P),P}static FromHexString(a){return new u(0,0,0).fromHexString(a)}static bh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new u(a[v],a[v+1],a[v+2])}static FromArrayToRef(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;p.r=a[v],p.g=a[v+1],p.b=a[v+2]}static FromInts(a,v,p){return new u(a/255,v/255,p/255)}static Lerp(a,v,p){const P=new u(0,0,0);return u.LerpToRef(a,v,p,P),P}static LerpToRef(a,v,p,P){P.r=a.r+(v.r-a.r)*p,P.g=a.g+(v.g-a.g)*p,P.b=a.b+(v.b-a.b)*p}static Hermite(a,v,p,P,b){const L=b*b,t=b*L,V=2*t-3*L+1,K=-2*t+3*L,C=t-2*L+b,F=t-L,c=a.r*V+p.r*K+v.r*C+P.r*F,f=a.g*V+p.g*K+v.g*C+P.g*F,H=a.b*V+p.b*K+v.b*C+P.b*F;return new u(c,f,H)}static Hermite1stDerivative(a,v,p,P,b){const L=u.Black();return this.Hermite1stDerivativeToRef(a,v,p,P,b,L),L}static Hermite1stDerivativeToRef(a,v,p,P,b,L){const t=b*b;L.r=6*(t-b)*a.r+(3*t-4*b+1)*v.r+6*(-t+b)*p.r+(3*t-2*b)*P.r,L.g=6*(t-b)*a.g+(3*t-4*b+1)*v.g+6*(-t+b)*p.g+(3*t-2*b)*P.g,L.b=6*(t-b)*a.b+(3*t-4*b+1)*v.b+6*(-t+b)*p.b+(3*t-2*b)*P.b}static Red(){return new u(1,0,0)}static Green(){return new u(0,1,0)}static Blue(){return new u(0,0,1)}static Black(){return new u(0,0,0)}static get BlackReadOnly(){return u._BlackReadOnly}static White(){return new u(1,1,1)}static Purple(){return new u(.5,0,.5)}static Magenta(){return new u(1,0,1)}static Yellow(){return new u(1,1,0)}static Gray(){return new u(.5,.5,.5)}static Teal(){return new u(0,1,1)}static Random(){return new u(Math.random(),Math.random(),Math.random())}}u._BlackReadOnly=u.Black(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class c{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=a,this.g=v,this.b=p,this.a=P}tj(){return[this.r,this.g,this.b,this.a]}toArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[v]=this.r,a[v+1]=this.g,a[v+2]=this.b,a[v+3]=this.a,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=a[v],this.g=a[v+1],this.b=a[v+2],this.a=a[v+3],this}equals(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a}add(a){return new c(this.r+a.r,this.g+a.g,this.b+a.b,this.a+a.a)}addToRef(a,v){return v.r=this.r+a.r,v.g=this.g+a.g,v.b=this.b+a.b,v.a=this.a+a.a,v}addInPlace(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this.a+=a.a,this}addInPlaceFromFloats(a,v,p,P){return this.r+=a,this.g+=v,this.b+=p,this.a+=P,this}od(a){return new c(this.r-a.r,this.g-a.g,this.b-a.b,this.a-a.a)}subtractToRef(a,v){return v.r=this.r-a.r,v.g=this.g-a.g,v.b=this.b-a.b,v.a=this.a-a.a,v}Bi(a){return this.r-=a.r,this.g-=a.g,this.b-=a.b,this.a-=a.a,this}subtractFromFloats(a,v,p,P){return new c(this.r-a,this.g-v,this.b-p,this.a-P)}subtractFromFloatsToRef(a,v,p,P,b){return b.r=this.r-a,b.g=this.g-v,b.b=this.b-p,b.a=this.a-P,b}scale(a){return new c(this.r*a,this.g*a,this.b*a,this.a*a)}scaleInPlace(a){return this.r*=a,this.g*=a,this.b*=a,this.a*=a,this}scaleToRef(a,v){return v.r=this.r*a,v.g=this.g*a,v.b=this.b*a,v.a=this.a*a,v}scaleAndAddToRef(a,v){return v.r+=this.r*a,v.g+=this.g*a,v.b+=this.b*a,v.a+=this.a*a,v}clampToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2?arguments[2]:void 0;return p.r=(0,t.e)(this.r,a,v),p.g=(0,t.e)(this.g,a,v),p.b=(0,t.e)(this.b,a,v),p.a=(0,t.e)(this.a,a,v),p}multiply(a){return new c(this.r*a.r,this.g*a.g,this.b*a.b,this.a*a.a)}multiplyToRef(a,v){return v.r=this.r*a.r,v.g=this.g*a.g,v.b=this.b*a.b,v.a=this.a*a.a,v}multiplyInPlace(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this.a*=a.a,this}multiplyByFloats(a,v,p,P){return new c(this.r*a,this.g*v,this.b*p,this.a*P)}divide(a){throw new ReferenceError("Can not divide a color")}divideToRef(a,v){throw new ReferenceError("Can not divide a color")}divideInPlace(a){throw new ReferenceError("Can not divide a color")}minimizeInPlace(a){return this.r=Math.min(this.r,a.r),this.g=Math.min(this.g,a.g),this.b=Math.min(this.b,a.b),this.a=Math.min(this.a,a.a),this}maximizeInPlace(a){return this.r=Math.max(this.r,a.r),this.g=Math.max(this.g,a.g),this.b=Math.max(this.b,a.b),this.a=Math.max(this.a,a.a),this}minimizeInPlaceFromFloats(a,v,p,P){return this.r=Math.min(a,this.r),this.g=Math.min(v,this.g),this.b=Math.min(p,this.b),this.a=Math.min(P,this.a),this}maximizeInPlaceFromFloats(a,v,p,P){return this.r=Math.max(a,this.r),this.g=Math.max(v,this.g),this.b=Math.max(p,this.b),this.a=Math.max(P,this.a),this}floorToRef(a){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(a){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(a){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.e;return(0,t.w)(this.r,a.r,v)&&(0,t.w)(this.g,a.g,v)&&(0,t.w)(this.b,a.b,v)&&(0,t.w)(this.a,a.a,v)}equalsToFloats(a,v,p,P){return this.r===a&&this.g===v&&this.b===p&&this.a===P}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"pb"}getHashCode(){let a=255*this.r|0;return a=397*a^255*this.g,a=397*a^255*this.b,a=397*a^255*this.a,a}clone(){return(new c).p(this)}p(a){return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,this}qe(a,v,p,P){return this.r=a,this.g=v,this.b=p,this.a=P,this}set(a,v,p,P){return this.qe(a,v,p,P)}pe(a){return this.r=this.g=this.b=this.a=a,this}toHexString(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=Math.round(255*this.r),p=Math.round(255*this.g),P=Math.round(255*this.b);if(a)return"#"+(0,t.u)(v)+(0,t.u)(p)+(0,t.u)(P);const b=Math.round(255*this.a);return"#"+(0,t.u)(v)+(0,t.u)(p)+(0,t.u)(P)+(0,t.u)(b)}fromHexString(a){return"#"!==a.substring(0,1)||9!==a.length&&7!==a.length||(this.r=parseInt(a.substring(1,3),16)/255,this.g=parseInt(a.substring(3,5),16)/255,this.b=parseInt(a.substring(5,7),16)/255,9===a.length&&(this.a=parseInt(a.substring(7,9),16)/255)),this}toLinearSpace(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=new c;return this.toLinearSpaceToRef(v,a),v}toLinearSpaceToRef(a){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(a.r=K(this.r),a.g=K(this.g),a.b=K(this.b)):(a.r=V(this.r),a.g=V(this.g),a.b=V(this.b)),a.a=this.a,this}toGammaSpace(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=new c;return this.toGammaSpaceToRef(v,a),v}toGammaSpaceToRef(a){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(a.r=F(this.r),a.g=F(this.g),a.b=F(this.b)):(a.r=C(this.r),a.g=C(this.g),a.b=C(this.b)),a.a=this.a,this}static FromHexString(a){return"#"!==a.substring(0,1)||9!==a.length&&7!==a.length?new c(0,0,0,0):new c(0,0,0,1).fromHexString(a)}static Lerp(a,v,p){return c.LerpToRef(a,v,p,new c)}static LerpToRef(a,v,p,P){return P.r=a.r+(v.r-a.r)*p,P.g=a.g+(v.g-a.g)*p,P.b=a.b+(v.b-a.b)*p,P.a=a.a+(v.a-a.a)*p,P}static Hermite(a,v,p,P,b){const L=b*b,t=b*L,V=2*t-3*L+1,K=-2*t+3*L,C=t-2*L+b,F=t-L,u=a.r*V+p.r*K+v.r*C+P.r*F,f=a.g*V+p.g*K+v.g*C+P.g*F,H=a.b*V+p.b*K+v.b*C+P.b*F,A=a.a*V+p.a*K+v.a*C+P.a*F;return new c(u,f,H,A)}static Hermite1stDerivative(a,v,p,P,b){const L=new c;return this.Hermite1stDerivativeToRef(a,v,p,P,b,L),L}static Hermite1stDerivativeToRef(a,v,p,P,b,L){const t=b*b;L.r=6*(t-b)*a.r+(3*t-4*b+1)*v.r+6*(-t+b)*p.r+(3*t-2*b)*P.r,L.g=6*(t-b)*a.g+(3*t-4*b+1)*v.g+6*(-t+b)*p.g+(3*t-2*b)*P.g,L.b=6*(t-b)*a.b+(3*t-4*b+1)*v.b+6*(-t+b)*p.b+(3*t-2*b)*P.b,L.a=6*(t-b)*a.a+(3*t-4*b+1)*v.a+6*(-t+b)*p.a+(3*t-2*b)*P.a}static FromColor3(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c(a.r,a.g,a.b,v)}static bh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(a[v],a[v+1],a[v+2],a[v+3])}static FromArrayToRef(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;p.r=a[v],p.g=a[v+1],p.b=a[v+2],p.a=a[v+3]}static FromInts(a,v,p,P){return new c(a/255,v/255,p/255,P/255)}static CheckColors4(a,v){if(a.length===3*v){const v=[];for(let p=0;p<a.length;p+=3){const P=p/3*4;v[P]=a[p],v[P+1]=a[p+1],v[P+2]=a[p+2],v[P+3]=1}return v}return a}}Object.defineProperties(c.prototype,{dimension:{value:[4]},rank:{value:1}});class f{}f.gb=(0,P.d)(3,u.Black),f.pb=(0,P.d)(3,(()=>new c(0,0,0,0))),(0,b.f)("BABYLON.Color3",u),(0,b.f)("BABYLON.Color4",c)},11245:(a,v,p)=>{"use strict";p.d(v,{e:()=>t,g:()=>L,k:()=>P,m:()=>b});const P=1/2.2,b=2.2,L=(1+Math.sqrt(5))/2,t=.001},11354:(a,v,p)=>{"use strict";p.d(v,{c:()=>b});var P=p(11356);class b{static GetPlanes(a){const v=[];for(let p=0;p<6;p++)v.push(new P.b(0,0,0,0));return b.GetPlanesToRef(a,v),v}static GetNearPlaneToRef(a,v){const p=a.m;v.k.x=p[3]+p[2],v.k.y=p[7]+p[6],v.k.z=p[11]+p[10],v.d=p[15]+p[14],v.normalize()}static GetFarPlaneToRef(a,v){const p=a.m;v.k.x=p[3]-p[2],v.k.y=p[7]-p[6],v.k.z=p[11]-p[10],v.d=p[15]-p[14],v.normalize()}static GetLeftPlaneToRef(a,v){const p=a.m;v.k.x=p[3]+p[0],v.k.y=p[7]+p[4],v.k.z=p[11]+p[8],v.d=p[15]+p[12],v.normalize()}static GetRightPlaneToRef(a,v){const p=a.m;v.k.x=p[3]-p[0],v.k.y=p[7]-p[4],v.k.z=p[11]-p[8],v.d=p[15]-p[12],v.normalize()}static GetTopPlaneToRef(a,v){const p=a.m;v.k.x=p[3]-p[1],v.k.y=p[7]-p[5],v.k.z=p[11]-p[9],v.d=p[15]-p[13],v.normalize()}static GetBottomPlaneToRef(a,v){const p=a.m;v.k.x=p[3]+p[1],v.k.y=p[7]+p[5],v.k.z=p[11]+p[9],v.d=p[15]+p[13],v.normalize()}static GetPlanesToRef(a,v){b.GetNearPlaneToRef(a,v[0]),b.GetFarPlaneToRef(a,v[1]),b.GetLeftPlaneToRef(a,v[2]),b.GetRightPlaneToRef(a,v[3]),b.GetTopPlaneToRef(a,v[4]),b.GetBottomPlaneToRef(a,v[5])}static IsPointInFrustum(a,v){for(let p=0;p<6;p++)if(v[p].dotCoordinate(a)<0)return!1;return!0}}},11429:(a,v,p)=>{"use strict";p.d(v,{d:()=>V,g:()=>K});var P=p(11207),b=p(11240),L=p(11210);class t{static extractMinAndMaxIndexed(a,v,p,P,b,L){for(let t=p;t<p+P;t++){const p=3*v[t],P=a[p],V=a[p+1],K=a[p+2];b.minimizeInPlaceFromFloats(P,V,K),L.maximizeInPlaceFromFloats(P,V,K)}}static extractMinAndMax(a,v,p,P,b,L){for(let t=v,V=v*P;t<v+p;t++,V+=P){const v=a[V],p=a[V+1],P=a[V+2];b.minimizeInPlaceFromFloats(v,p,P),L.maximizeInPlaceFromFloats(v,p,P)}}}function V(a,v,p,P){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const V=new b.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new b.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t.extractMinAndMaxIndexed(a,v,p,P,V,K),L&&(V.x-=V.x*L.x+L.y,V.y-=V.y*L.x+L.y,V.z-=V.z*L.x+L.y,K.x+=K.x*L.x+L.y,K.y+=K.y*L.x+L.y,K.z+=K.z*L.x+L.y),{minimum:V,maximum:K}}function K(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4?arguments[4]:void 0;const V=new b.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new b.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return L||(L=3),t.extractMinAndMax(a,v,p,L,V,K),P&&(V.x-=V.x*P.x+P.y,V.y-=V.y*P.x+P.y,V.z-=V.z*P.x+P.y,K.x+=K.x*P.x+P.y,K.y+=K.y*P.x+P.y,K.z+=K.z*P.x+P.y),{minimum:V,maximum:K}}(0,P.e)([L.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P,b]=v;return!Array.isArray(P)&&!Array.isArray(b)}))],t,"extractMinAndMaxIndexed",null),(0,P.e)([L.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P]=v;return!Array.isArray(P)}))],t,"extractMinAndMax",null)},11720:(a,v,p)=>{"use strict";p.d(v,{c:()=>P.k});p(11549),p(11279),p(11245),p(11354),p(11724),p(11356),p(11466);var P=p(11240);p(11521)},11724:(a,v,p)=>{"use strict";p.d(v,{c:()=>V,f:()=>F,g:()=>u});var P,b=p(11263),L=p(11240),t=p(11245);!function(a){a[a.CW=0]="CW",a[a.CCW=1]="CCW"}(P||(P={}));class V{static Interpolate(a,v,p,P,b){const L=1-3*P+3*v,t=3*P-6*v,V=3*v;let K=a;for(let C=0;C<5;C++){const v=K*K;K-=(L*(v*K)+t*v+V*K-a)*(1/(3*L*v+2*t*K+V)),K=Math.min(1,Math.max(0,K))}return 3*Math.pow(1-K,2)*K*p+3*(1-K)*Math.pow(K,2)*b+Math.pow(K,3)}}class K{constructor(a){this._radians=a,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(a,v){const p=v.od(a),P=Math.atan2(p.y,p.x);return new K(P)}static BetweenTwoVectors(a,v){let p=a.lengthSquared()*v.lengthSquared();if(0===p)return new K(Math.PI/2);p=Math.sqrt(p);let P=a.dot(v)/p;P=(0,b.e)(P,-1,1);const L=Math.acos(P);return new K(L)}static FromRadians(a){return new K(a)}static FromDegrees(a){return new K(a*Math.PI/180)}}class C{constructor(a,v,p){this.startPoint=a,this.midPoint=v,this.endPoint=p;const P=Math.pow(v.x,2)+Math.pow(v.y,2),b=(Math.pow(a.x,2)+Math.pow(a.y,2)-P)/2,t=(P-Math.pow(p.x,2)-Math.pow(p.y,2))/2,V=(a.x-v.x)*(v.y-p.y)-(v.x-p.x)*(a.y-v.y);this.centerPoint=new L.o((b*(v.y-p.y)-t*(a.y-v.y))/V,((a.x-v.x)*t-(v.x-p.x)*b)/V),this.radius=this.centerPoint.od(this.startPoint).length(),this.startAngle=K.BetweenTwoPoints(this.centerPoint,this.startPoint);const C=this.startAngle.degrees();let F=K.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=K.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();F-C>180&&(F-=360),F-C<-180&&(F+=360),u-F>180&&(u-=360),u-F<-180&&(u+=360),this.orientation=F-C<0?0:1,this.angle=K.FromDegrees(0===this.orientation?C-u:u-C)}}class F{constructor(a,v){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new L.o(a,v))}addLineTo(a,v){if(this.closed)return this;const p=new L.o(a,v),P=this._points[this._points.length-1];return this._points.push(p),this._length+=p.od(P).length(),this}addArcTo(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const t=this._points[this._points.length-1],V=new L.o(a,v),K=new L.o(p,P),F=new C(t,V,K);let u=F.angle.radians()/b;0===F.orientation&&(u*=-1);let c=F.startAngle.radians()+u;for(let L=0;L<b;L++){const a=Math.cos(c)*F.radius+F.centerPoint.x,v=Math.sin(c)*F.radius+F.centerPoint.y;this.addLineTo(a,v),c+=u}return this}addQuadraticCurveTo(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const L=(a,v,p,P)=>(1-a)*(1-a)*v+2*a*(1-a)*p+a*a*P,t=this._points[this._points.length-1];for(let V=0;V<=b;V++){const K=V/b,C=L(K,t.x,a,p),F=L(K,t.y,v,P);this.addLineTo(C,F)}return this}addBezierCurveTo(a,v,p,P,b,L){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const V=(a,v,p,P,b)=>(1-a)*(1-a)*(1-a)*v+3*a*(1-a)*(1-a)*p+3*a*a*(1-a)*P+a*a*a*b,K=this._points[this._points.length-1];for(let C=0;C<=t;C++){const F=C/t,u=V(F,K.x,a,p,b),c=V(F,K.y,v,P,L);this.addLineTo(u,c)}return this}isPointInside(a){let v=!1;const p=this._points.length;for(let P=p-1,b=0;b<p;P=b++){let p=this._points[P],L=this._points[b],t=L.x-p.x,V=L.y-p.y;if(Math.abs(V)>Number.EPSILON){if(V<0&&(p=this._points[b],t=-t,L=this._points[P],V=-V),a.y<p.y||a.y>L.y)continue;if(a.y===p.y&&a.x===p.x)return!0;{const P=V*(a.x-p.x)-t*(a.y-p.y);if(0===P)return!0;if(P<0)continue;v=!v}}else{if(a.y!==p.y)continue;if(L.x<=a.x&&a.x<=p.x||p.x<=a.x&&a.x<=L.x)return!0}}return v}close(){return this.closed=!0,this}length(){let a=this._length;if(this.closed){const v=this._points[this._points.length-1];a+=this._points[0].od(v).length()}return a}area(){const a=this._points.length;let v=0;for(let p=a-1,P=0;P<a;p=P++)v+=this._points[p].x*this._points[P].y-this._points[P].x*this._points[p].y;return.5*v}getPoints(){return this._points}getPointAtLengthPosition(a){if(a<0||a>1)return L.o.Zero();const v=a*this.length();let p=0;for(let P=0;P<this._points.length;P++){const a=(P+1)%this._points.length,b=this._points[P],t=this._points[a].od(b),V=t.length()+p;if(v>=p&&v<=V){const a=t.normalize(),P=v-p;return new L.o(b.x+a.x*P,b.y+a.y*P)}p=V}return L.o.Zero()}static StartingAt(a,v){return new F(a,v)}}class u{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=a,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:L.s.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:L.e.Identity()};for(let b=0;b<a.length;b++)this._curve[b]=a[b].clone();this._raw=p||!1,this._alignTangentsWithPath=P,this._compute(v,P)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(a){return this._updatePointAtData(a).point}getTangentAt(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(a,v),v?L.s.TransformCoordinates(L.s.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(a,v),v?L.s.TransformCoordinates(L.s.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(a,v),v?L.s.TransformCoordinates(L.s.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(a){return this.length()*a}getPreviousPointIndexAt(a){return this._updatePointAtData(a),this._pointAtData.previousPointArrayIndex}getSubPositionAt(a){return this._updatePointAtData(a),this._pointAtData.subPosition}getClosestPositionTo(a){let v=Number.MAX_VALUE,p=0;for(let P=0;P<this._curve.length-1;P++){const b=this._curve[P+0],t=this._curve[P+1].od(b).normalize(),V=this._distances[P+1]-this._distances[P+0],K=Math.min(Math.max(L.s.Dot(t,a.od(b).normalize()),0)*L.s.Distance(b,a)/V,1),C=L.s.Distance(b.add(t.scale(K*V)),a);C<v&&(v=C,p=(this._distances[P+0]+V*K)/this.length())}return p}slice(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(a<0&&(a=1- -1*a%1),v<0&&(v=1- -1*v%1),a>v){const p=a;a=v,v=p}const p=this.getCurve(),P=this.getPointAt(a);let b=this.getPreviousPointIndexAt(a);const L=this.getPointAt(v),t=this.getPreviousPointIndexAt(v)+1,V=[];return 0!==a&&(b++,V.push(P)),V.push(...p.slice(b,t)),1===v&&1!==a||V.push(L),new u(V,this.getNormalAt(a),this._raw,this._alignTangentsWithPath)}update(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let P=0;P<a.length;P++)this._curve[P].x=a[P].x,this._curve[P].y=a[P].y,this._curve[P].z=a[P].z;return this._compute(v,p),this}_compute(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const p=this._curve.length;if(p<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[p-1]=this._curve[p-1].od(this._curve[p-2]),this._raw||this._tangents[p-1].normalize();const P=this._tangents[0],b=this._normalVector(P,a);let t,V,K,C,F;this._normals[0]=b,this._raw||this._normals[0].normalize(),this._binormals[0]=L.s.Cross(P,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let u=1;u<p;u++)t=this._getLastNonNullVector(u),u<p-1&&(V=this._getFirstNonNullVector(u),this._tangents[u]=v?V:t.add(V),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+this._curve[u].od(this._curve[u-1]).length(),K=this._tangents[u],F=this._binormals[u-1],this._normals[u]=L.s.Cross(F,K),this._raw||(0===this._normals[u].length()?(C=this._normals[u-1],this._normals[u]=C.clone()):this._normals[u].normalize()),this._binormals[u]=L.s.Cross(K,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(a){let v=1,p=this._curve[a+v].od(this._curve[a]);for(;0===p.length()&&a+v+1<this._curve.length;)v++,p=this._curve[a+v].od(this._curve[a]);return p}_getLastNonNullVector(a){let v=1,p=this._curve[a].od(this._curve[a-v]);for(;0===p.length()&&a>v+1;)v++,p=this._curve[a].od(this._curve[a-v]);return p}_normalVector(a,v){let p,P=a.length();if(0===P&&(P=1),void 0===v||null===v){let v;v=(0,b.w)(Math.abs(a.y)/P,1,t.e)?(0,b.w)(Math.abs(a.x)/P,1,t.e)?(0,b.w)(Math.abs(a.z)/P,1,t.e)?L.s.Zero():new L.s(0,0,1):new L.s(1,0,0):new L.s(0,-1,0),p=L.s.Cross(a,v)}else p=L.s.Cross(a,v),L.s.CrossToRef(p,a,p);return p.normalize(),p}_updatePointAtData(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===a)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=a;const p=this.getPoints();if(a<=0)return this._setPointAtData(0,0,p[0],0,v);if(a>=1)return this._setPointAtData(1,1,p[p.length-1],p.length-1,v);let P,b=p[0],t=0;const V=a*this.length();for(let K=1;K<p.length;K++){P=p[K];const C=L.s.Distance(b,P);if(t+=C,t===V)return this._setPointAtData(a,1,P,K,v);if(t>V){const p=(t-V)/C,L=b.od(P),F=P.add(L.scaleInPlace(p));return this._setPointAtData(a,1-p,F,K-1,v)}b=P}return this._pointAtData}_setPointAtData(a,v,p,P,b){return this._pointAtData.point=p,this._pointAtData.position=a,this._pointAtData.subPosition=v,this._pointAtData.previousPointArrayIndex=P,this._pointAtData.interpolateReady=b,b&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=L.e.Identity();const a=this._pointAtData.previousPointArrayIndex;if(a!==this._tangents.length-1){const v=a+1,p=this._tangents[a].clone(),P=this._normals[a].clone(),b=this._binormals[a].clone(),t=this._tangents[v].clone(),V=this._normals[v].clone(),K=this._binormals[v].clone(),C=L.i.RotationQuaternionFromAxis(P,b,p),F=L.i.RotationQuaternionFromAxis(V,K,t);L.i.Slerp(C,F,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11356:(a,v,p)=>{"use strict";p.d(v,{b:()=>b});var P=p(11240);class b{constructor(a,v,p,b){this.k=new P.s(a,v,p),this.d=b}tj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new b(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let a=this.k.getHashCode();return a=397*a^this.d,a}normalize(){const a=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let v=0;return 0!==a&&(v=1/a),this.k.x*=v,this.k.y*=v,this.k.z*=v,this.d*=v,this}transform(a){const v=b._TmpMatrix;a.invertToRef(v);const p=v.m,P=this.k.x,L=this.k.y,t=this.k.z,V=this.d,K=P*p[0]+L*p[1]+t*p[2]+V*p[3],C=P*p[4]+L*p[5]+t*p[6]+V*p[7],F=P*p[8]+L*p[9]+t*p[10]+V*p[11],u=P*p[12]+L*p[13]+t*p[14]+V*p[15];return new b(K,C,F,u)}dotCoordinate(a){return this.k.x*a.x+this.k.y*a.y+this.k.z*a.z+this.d}copyFromPoints(a,v,p){const P=v.x-a.x,b=v.y-a.y,L=v.z-a.z,t=p.x-a.x,V=p.y-a.y,K=p.z-a.z,C=b*K-L*V,F=L*t-P*K,u=P*V-b*t,c=Math.sqrt(C*C+F*F+u*u);let f;return f=0!==c?1/c:0,this.k.x=C*f,this.k.y=F*f,this.k.z=u*f,this.d=-(this.k.x*a.x+this.k.y*a.y+this.k.z*a.z),this}isFrontFacingTo(a,v){return P.s.Dot(this.k,a)<=v}signedDistanceTo(a){return P.s.Dot(a,this.k)+this.d}static bh(a){return new b(a[0],a[1],a[2],a[3])}static FromPoints(a,v,p){const P=new b(0,0,0,0);return P.copyFromPoints(a,v,p),P}static FromPositionAndNormal(a,v){const p=new b(0,0,0,0);return this.FromPositionAndNormalToRef(a,v,p)}static FromPositionAndNormalToRef(a,v,p){return p.k.p(v),p.k.normalize(),p.d=-a.dot(p.k),p}static SignedDistanceToPlaneFromPositionAndNormal(a,v,p){const b=-(v.x*a.x+v.y*a.y+v.z*a.z);return P.s.Dot(p,v)+b}}b._TmpMatrix=P.e.Identity()},11263:(a,v,p)=>{"use strict";function P(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(a-v)<=p}function b(a,v){return a===v?a:Math.random()*(v-a)+a}function L(a,v,p){return a+(v-a)*p}function t(a,v,p,P,b){const L=b*b,t=b*L;return a*(2*t-3*L+1)+p*(-2*t+3*L)+v*(t-2*L+b)+P*(t-L)}function V(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(p,Math.max(v,a))}function K(a){return a-=2*Math.PI*Math.floor((a+Math.PI)/(2*Math.PI))}function C(a){const v=a.toString(16);return a<=15?("0"+v).toUpperCase():v.toUpperCase()}function F(a){if(Math.log2)return Math.floor(Math.log2(a));if(a<0)return NaN;if(0===a)return-1/0;let v=0;if(a<1){for(;a<1;)v++,a*=2;v=-v}else if(a>1)for(;a>1;)v++,a=Math.floor(a/2);return v}function u(a,v){const p=a%v;return 0===p?v:u(v,p)}p.d(v,{e:()=>V,f:()=>t,h:()=>u,k:()=>F,l:()=>L,n:()=>K,r:()=>b,u:()=>C,w:()=>P})},11466:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{constructor(a,v){this.width=a,this.height=v}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let a=0|this.width;return a=397*a^this.height,a}p(a){this.width=a.width,this.height=a.height}qe(a,v){return this.width=a,this.height=v,this}set(a,v){return this.qe(a,v)}multiplyByFloats(a,v){return new P(this.width*a,this.height*v)}clone(){return new P(this.width,this.height)}equals(a){return!!a&&(this.width===a.width&&this.height===a.height)}get surface(){return this.width*this.height}static Zero(){return new P(0,0)}add(a){return new P(this.width+a.width,this.height+a.height)}od(a){return new P(this.width-a.width,this.height-a.height)}scale(a){return new P(this.width*a,this.height*a)}static Lerp(a,v,p){const b=a.width+(v.width-a.width)*p,L=a.height+(v.height-a.height)*p;return new P(b,L)}}},11240:(a,v,p)=>{"use strict";p.d(v,{e:()=>H,i:()=>f,k:()=>h,o:()=>F,s:()=>u,t:()=>c});var P=p(11245),b=p(11254),L=p(11027),t=p(11003),V=p(10939),K=p(11263);const C=a=>parseInt(a.toString().replace(/\W/g,""));class F{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=a,this.y=v}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let a=C(this.x);return a=397*a^C(this.y),a}toArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[v]=this.x,a[v+1]=this.y,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return F.FromArrayToRef(a,v,this),this}tj(){return[this.x,this.y]}p(a){return this.x=a.x,this.y=a.y,this}qe(a,v){return this.x=a,this.y=v,this}set(a,v){return this.qe(a,v)}pe(a){return this.qe(a,a)}add(a){return new F(this.x+a.x,this.y+a.y)}addToRef(a,v){return v.x=this.x+a.x,v.y=this.y+a.y,v}addInPlace(a){return this.x+=a.x,this.y+=a.y,this}addInPlaceFromFloats(a,v){return this.x+=a,this.y+=v,this}addVector3(a){return new F(this.x+a.x,this.y+a.y)}od(a){return new F(this.x-a.x,this.y-a.y)}subtractToRef(a,v){return v.x=this.x-a.x,v.y=this.y-a.y,v}Bi(a){return this.x-=a.x,this.y-=a.y,this}multiplyInPlace(a){return this.x*=a.x,this.y*=a.y,this}multiply(a){return new F(this.x*a.x,this.y*a.y)}multiplyToRef(a,v){return v.x=this.x*a.x,v.y=this.y*a.y,v}multiplyByFloats(a,v){return new F(this.x*a,this.y*v)}divide(a){return new F(this.x/a.x,this.y/a.y)}divideToRef(a,v){return v.x=this.x/a.x,v.y=this.y/a.y,v}divideInPlace(a){return this.x=this.x/a.x,this.y=this.y/a.y,this}minimizeInPlace(a){return this.minimizeInPlaceFromFloats(a.x,a.y)}maximizeInPlace(a){return this.maximizeInPlaceFromFloats(a.x,a.y)}minimizeInPlaceFromFloats(a,v){return this.x=Math.min(a,this.x),this.y=Math.min(v,this.y),this}maximizeInPlaceFromFloats(a,v){return this.x=Math.max(a,this.x),this.y=Math.max(v,this.y),this}subtractFromFloats(a,v){return new F(this.x-a,this.y-v)}subtractFromFloatsToRef(a,v,p){return p.x=this.x-a,p.y=this.y-v,p}negate(){return new F(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(a){return a.x=-this.x,a.y=-this.y,a}scaleInPlace(a){return this.x*=a,this.y*=a,this}scale(a){return new F(this.x*a,this.y*a)}scaleToRef(a,v){return v.x=this.x*a,v.y=this.y*a,v}scaleAndAddToRef(a,v){return v.x+=this.x*a,v.y+=this.y*a,v}equals(a){return a&&this.x===a.x&&this.y===a.y}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return a&&(0,K.w)(this.x,a.x,v)&&(0,K.w)(this.y,a.y,v)}equalsToFloats(a,v){return this.x===a&&this.y===v}floor(){return new F(Math.floor(this.x),Math.floor(this.y))}floorToRef(a){return a.x=Math.floor(this.x),a.y=Math.floor(this.y),a}fract(){return new F(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(a){return a.x=this.x-Math.floor(this.x),a.y=this.y-Math.floor(this.y),a}rotateToRef(a,v){const p=Math.cos(a),P=Math.sin(a),b=p*this.x-P*this.y,L=P*this.x+p*this.y;return v.x=b,v.y=L,v}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(a){return 0===a||1===a?this:this.scaleInPlace(1/a)}normalizeToNew(){const a=new F;return this.normalizeToRef(a),a}normalizeToRef(a){const v=this.length();return 0===v&&(a.x=this.x,a.y=this.y),this.scaleToRef(1/v,a)}clone(){return new F(this.x,this.y)}dot(a){return this.x*a.x+this.y*a.y}static Zero(){return new F(0,0)}static One(){return new F(1,1)}static Random(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new F((0,K.r)(a,v),(0,K.r)(a,v))}static RandomToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,K.r)(a,v),(0,K.r)(a,v))}static get ZeroReadOnly(){return F._ZeroReadOnly}static bh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new F(a[v],a[v+1])}static FromArrayToRef(a,v,p){return p.x=a[v],p.y=a[v+1],p}static FromFloatsToRef(a,v,p){return p.qe(a,v),p}static CatmullRom(a,v,p,P,b){const L=b*b,t=b*L,V=.5*(2*v.x+(-a.x+p.x)*b+(2*a.x-5*v.x+4*p.x-P.x)*L+(-a.x+3*v.x-3*p.x+P.x)*t),K=.5*(2*v.y+(-a.y+p.y)*b+(2*a.y-5*v.y+4*p.y-P.y)*L+(-a.y+3*v.y-3*p.y+P.y)*t);return new F(V,K)}static ClampToRef(a,v,p,P){return P.x=(0,K.e)(a.x,v.x,p.x),P.y=(0,K.e)(a.y,v.y,p.y),P}static Clamp(a,v,p){const P=(0,K.e)(a.x,v.x,p.x),b=(0,K.e)(a.y,v.y,p.y);return new F(P,b)}static Hermite(a,v,p,P,b){const L=b*b,t=b*L,V=2*t-3*L+1,K=-2*t+3*L,C=t-2*L+b,u=t-L,c=a.x*V+p.x*K+v.x*C+P.x*u,f=a.y*V+p.y*K+v.y*C+P.y*u;return new F(c,f)}static Hermite1stDerivative(a,v,p,P,b){return this.Hermite1stDerivativeToRef(a,v,p,P,b,new F)}static Hermite1stDerivativeToRef(a,v,p,P,b,L){const t=b*b;return L.x=6*(t-b)*a.x+(3*t-4*b+1)*v.x+6*(-t+b)*p.x+(3*t-2*b)*P.x,L.y=6*(t-b)*a.y+(3*t-4*b+1)*v.y+6*(-t+b)*p.y+(3*t-2*b)*P.y,L}static Lerp(a,v,p){return F.LerpToRef(a,v,p,new F)}static LerpToRef(a,v,p,P){return P.x=a.x+(v.x-a.x)*p,P.y=a.y+(v.y-a.y)*p,P}static Dot(a,v){return a.x*v.x+a.y*v.y}static Normalize(a){return F.NormalizeToRef(a,new F)}static NormalizeToRef(a,v){return a.normalizeToRef(v),v}static Minimize(a,v){const p=a.x<v.x?a.x:v.x,P=a.y<v.y?a.y:v.y;return new F(p,P)}static Maximize(a,v){const p=a.x>v.x?a.x:v.x,P=a.y>v.y?a.y:v.y;return new F(p,P)}static Transform(a,v){return F.TransformToRef(a,v,new F)}static TransformToRef(a,v,p){const P=v.m,b=a.x*P[0]+a.y*P[4]+P[12],L=a.x*P[1]+a.y*P[5]+P[13];return p.x=b,p.y=L,p}static PointInTriangle(a,v,p,P){const b=.5*(-p.y*P.x+v.y*(-p.x+P.x)+v.x*(p.y-P.y)+p.x*P.y),L=b<0?-1:1,t=(v.y*P.x-v.x*P.y+(P.y-v.y)*a.x+(v.x-P.x)*a.y)*L,V=(v.x*p.y-v.y*p.x+(v.y-p.y)*a.x+(p.x-v.x)*a.y)*L;return t>0&&V>0&&t+V<2*b*L}static Distance(a,v){return Math.sqrt(F.DistanceSquared(a,v))}static DistanceSquared(a,v){const p=a.x-v.x,P=a.y-v.y;return p*p+P*P}static Center(a,v){return F.CenterToRef(a,v,new F)}static CenterToRef(a,v,p){return p.qe((a.x+v.x)/2,(a.y+v.y)/2)}static DistanceOfPointFromSegment(a,v,p){const P=F.DistanceSquared(v,p);if(0===P)return F.Distance(a,v);const b=p.od(v),L=Math.max(0,Math.min(1,F.Dot(a.od(v),b)/P)),t=v.add(b.multiplyByFloats(L,L));return F.Distance(a,t)}}F._ZeroReadOnly=F.Zero(),Object.defineProperties(F.prototype,{dimension:{value:[2]},rank:{value:1}});class u{get x(){return this._x}set x(a){this._x=a,this._isDirty=!0}get y(){return this._y}set y(a){this._y=a,this._isDirty=!0}get z(){return this._z}set z(a){this._z=a,this._isDirty=!0}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=a,this._y=v,this._z=p}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"fb"}getHashCode(){let a=C(this._x);return a=397*a^C(this._y),a=397*a^C(this._z),a}tj(){return[this._x,this._y,this._z]}toArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[v]=this._x,a[v+1]=this._y,a[v+2]=this._z,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(a,v,this),this}toQuaternion(){return f.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._isDirty=!0,this}addInPlaceFromFloats(a,v,p){return this._x+=a,this._y+=v,this._z+=p,this._isDirty=!0,this}add(a){return new u(this._x+a._x,this._y+a._y,this._z+a._z)}addToRef(a,v){return v._x=this._x+a._x,v._y=this._y+a._y,v._z=this._z+a._z,v._isDirty=!0,v}Bi(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._isDirty=!0,this}od(a){return new u(this._x-a._x,this._y-a._y,this._z-a._z)}subtractToRef(a,v){return this.subtractFromFloatsToRef(a._x,a._y,a._z,v)}subtractFromFloats(a,v,p){return new u(this._x-a,this._y-v,this._z-p)}subtractFromFloatsToRef(a,v,p,P){return P._x=this._x-a,P._y=this._y-v,P._z=this._z-p,P._isDirty=!0,P}negate(){return new u(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(a){return a._x=-1*this._x,a._y=-1*this._y,a._z=-1*this._z,a._isDirty=!0,a}scaleInPlace(a){return this._x*=a,this._y*=a,this._z*=a,this._isDirty=!0,this}scale(a){return new u(this._x*a,this._y*a,this._z*a)}scaleToRef(a,v){return v._x=this._x*a,v._y=this._y*a,v._z=this._z*a,v._isDirty=!0,v}getNormalToRef(a){const v=this.length();let p=Math.acos(this.y/v);const P=Math.atan2(this.z,this.x);p>Math.PI/2?p-=Math.PI/2:p+=Math.PI/2;const b=v*Math.sin(p)*Math.cos(P),L=v*Math.cos(p),t=v*Math.sin(p)*Math.sin(P);return a.set(b,L,t),a}applyRotationQuaternionToRef(a,v){const p=this._x,P=this._y,b=this._z,L=a._x,t=a._y,V=a._z,K=a._w,C=2*(t*b-V*P),F=2*(V*p-L*b),u=2*(L*P-t*p);return v._x=p+K*C+t*u-V*F,v._y=P+K*F+V*C-L*u,v._z=b+K*u+L*F-t*C,v._isDirty=!0,v}applyRotationQuaternionInPlace(a){return this.applyRotationQuaternionToRef(a,this)}applyRotationQuaternion(a){return this.applyRotationQuaternionToRef(a,new u)}scaleAndAddToRef(a,v){return v._x+=this._x*a,v._y+=this._y*a,v._z+=this._z*a,v._isDirty=!0,v}projectOnPlane(a,v){return this.projectOnPlaneToRef(a,v,new u)}projectOnPlaneToRef(a,v,p){const P=a.k,b=a.d,L=A.fb[0];this.subtractToRef(v,L),L.normalize();const t=u.Dot(L,P);if(Math.abs(t)<1e-10)p.pe(1/0);else{const a=-(u.Dot(v,P)+b)/t,V=L.scaleInPlace(a);v.addToRef(V,p)}return p}equals(a){return a&&this._x===a._x&&this._y===a._y&&this._z===a._z}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return a&&(0,K.w)(this._x,a._x,v)&&(0,K.w)(this._y,a._y,v)&&(0,K.w)(this._z,a._z,v)}equalsToFloats(a,v,p){return this._x===a&&this._y===v&&this._z===p}multiplyInPlace(a){return this._x*=a._x,this._y*=a._y,this._z*=a._z,this._isDirty=!0,this}multiply(a){return this.multiplyByFloats(a._x,a._y,a._z)}multiplyToRef(a,v){return v._x=this._x*a._x,v._y=this._y*a._y,v._z=this._z*a._z,v._isDirty=!0,v}multiplyByFloats(a,v,p){return new u(this._x*a,this._y*v,this._z*p)}divide(a){return new u(this._x/a._x,this._y/a._y,this._z/a._z)}divideToRef(a,v){return v._x=this._x/a._x,v._y=this._y/a._y,v._z=this._z/a._z,v._isDirty=!0,v}divideInPlace(a){return this._x=this._x/a._x,this._y=this._y/a._y,this._z=this._z/a._z,this._isDirty=!0,this}minimizeInPlace(a){return this.minimizeInPlaceFromFloats(a._x,a._y,a._z)}maximizeInPlace(a){return this.maximizeInPlaceFromFloats(a._x,a._y,a._z)}minimizeInPlaceFromFloats(a,v,p){return a<this._x&&(this.x=a),v<this._y&&(this.y=v),p<this._z&&(this.z=p),this}maximizeInPlaceFromFloats(a,v,p){return a>this._x&&(this.x=a),v>this._y&&(this.y=v),p>this._z&&(this.z=p),this}isNonUniformWithinEpsilon(a){const v=Math.abs(this._x),p=Math.abs(this._y);if(!(0,K.w)(v,p,a))return!0;const P=Math.abs(this._z);return!(0,K.w)(v,P,a)||!(0,K.w)(p,P,a)}get isNonUniform(){const a=Math.abs(this._x);if(a!==Math.abs(this._y))return!0;return a!==Math.abs(this._z)}floorToRef(a){return a._x=Math.floor(this._x),a._y=Math.floor(this._y),a._z=Math.floor(this._z),a._isDirty=!0,a}floor(){return new u(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(a){return a._x=this.x-Math.floor(this._x),a._y=this.y-Math.floor(this._y),a._z=this.z-Math.floor(this._z),a._isDirty=!0,a}fract(){return new u(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(a){if("xyz"===(a=a.toLowerCase()))return this;const v=A.fb[0].p(this);return this.x=v[a[0]],this.y=v[a[1]],this.z=v[a[2]],this}rotateByQuaternionToRef(a,v){return a.toRotationMatrix(A.Matrix[0]),u.TransformCoordinatesToRef(this,A.Matrix[0],v),v}rotateByQuaternionAroundPointToRef(a,v,p){return this.subtractToRef(v,A.fb[0]),A.fb[0].rotateByQuaternionToRef(a,A.fb[0]),v.addToRef(A.fb[0],p),p}cross(a){return u.CrossToRef(this,a,new u)}normalizeFromLength(a){return 0===a||1===a?this:this.scaleInPlace(1/a)}normalizeToNew(){return this.normalizeToRef(new u)}normalizeToRef(a){const v=this.length();return 0===v||1===v?(a._x=this._x,a._y=this._y,a._z=this._z,a._isDirty=!0,a):this.scaleToRef(1/v,a)}clone(){return new u(this._x,this._y,this._z)}p(a){return this.qe(a._x,a._y,a._z)}qe(a,v,p){return this._x=a,this._y=v,this._z=p,this._isDirty=!0,this}set(a,v,p){return this.qe(a,v,p)}pe(a){return this._x=this._y=this._z=a,this._isDirty=!0,this}static GetClipFactor(a,v,p,P){const b=u.Dot(a,p);return(b-P)/(b-u.Dot(v,p))}static GetAngleBetweenVectors(a,v,p){const P=a.normalizeToRef(A.fb[1]),b=v.normalizeToRef(A.fb[2]);let L=u.Dot(P,b);L=(0,K.e)(L,-1,1);const t=Math.acos(L),V=A.fb[3];return u.CrossToRef(P,b,V),u.Dot(V,p)>0?isNaN(t)?0:t:isNaN(t)?-Math.PI:-Math.acos(L)}static GetAngleBetweenVectorsOnPlane(a,v,p){A.fb[0].p(a);const P=A.fb[0];A.fb[1].p(v);const b=A.fb[1];A.fb[2].p(p);const L=A.fb[2],t=A.fb[3],V=A.fb[4];P.normalize(),b.normalize(),L.normalize(),u.CrossToRef(L,P,t),u.CrossToRef(t,L,V);const C=Math.atan2(u.Dot(b,t),u.Dot(b,V));return(0,K.n)(C)}static PitchYawRollToMoveBetweenPointsToRef(a,v,p){const P=h.fb[0];return v.subtractToRef(a,P),p._y=Math.atan2(P.x,P.z)||0,p._x=Math.atan2(Math.sqrt(P.x**2+P.z**2),P.y)||0,p._z=0,p._isDirty=!0,p}static PitchYawRollToMoveBetweenPoints(a,v){const p=u.Zero();return u.PitchYawRollToMoveBetweenPointsToRef(a,v,p)}static SlerpToRef(a,v,p,b){p=(0,K.e)(p,0,1);const L=A.fb[0],t=A.fb[1];L.p(a);const V=L.length();L.normalizeFromLength(V),t.p(v);const C=t.length();t.normalizeFromLength(C);const F=u.Dot(L,t);let c,f;if(F<1-P.e){const a=Math.acos(F),v=1/Math.sin(a);c=Math.sin((1-p)*a)*v,f=Math.sin(p*a)*v}else c=1-p,f=p;return L.scaleInPlace(c),t.scaleInPlace(f),b.p(L).addInPlace(t),b.scaleInPlace((0,K.l)(V,C,p)),b}static SmoothToRef(a,v,p,P,b){return u.SlerpToRef(a,v,0===P?1:p/P,b),b}static bh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new u(a[v],a[v+1],a[v+2])}static FromFloatArray(a,v){return u.bh(a,v)}static FromArrayToRef(a,v,p){return p._x=a[v],p._y=a[v+1],p._z=a[v+2],p._isDirty=!0,p}static FromFloatArrayToRef(a,v,p){return u.FromArrayToRef(a,v,p)}static FromFloatsToRef(a,v,p,P){return P.qe(a,v,p),P}static Zero(){return new u(0,0,0)}static One(){return new u(1,1,1)}static Up(){return new u(0,1,0)}static get UpReadOnly(){return u._UpReadOnly}static get DownReadOnly(){return u._DownReadOnly}static get RightReadOnly(){return u._RightReadOnly}static get LeftReadOnly(){return u._LeftReadOnly}static get LeftHandedForwardReadOnly(){return u._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return u._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return u._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return u._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return u._ZeroReadOnly}static get OneReadOnly(){return u._OneReadOnly}static Down(){return new u(0,-1,0)}static Forward(){return new u(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new u(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new u(1,0,0)}static Left(){return new u(-1,0,0)}static Random(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new u((0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v))}static RandomToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v))}static TransformCoordinates(a,v){const p=u.Zero();return u.TransformCoordinatesToRef(a,v,p),p}static TransformCoordinatesToRef(a,v,p){return u.TransformCoordinatesFromFloatsToRef(a._x,a._y,a._z,v,p),p}static TransformCoordinatesFromFloatsToRef(a,v,p,P,b){const L=P.m,t=a*L[0]+v*L[4]+p*L[8]+L[12],V=a*L[1]+v*L[5]+p*L[9]+L[13],K=a*L[2]+v*L[6]+p*L[10]+L[14],C=1/(a*L[3]+v*L[7]+p*L[11]+L[15]);return b._x=t*C,b._y=V*C,b._z=K*C,b._isDirty=!0,b}static TransformNormal(a,v){const p=u.Zero();return u.TransformNormalToRef(a,v,p),p}static TransformNormalToRef(a,v,p){return this.TransformNormalFromFloatsToRef(a._x,a._y,a._z,v,p),p}static TransformNormalFromFloatsToRef(a,v,p,P,b){const L=P.m;return b._x=a*L[0]+v*L[4]+p*L[8],b._y=a*L[1]+v*L[5]+p*L[9],b._z=a*L[2]+v*L[6]+p*L[10],b._isDirty=!0,b}static CatmullRom(a,v,p,P,b){const L=b*b,t=b*L,V=.5*(2*v._x+(-a._x+p._x)*b+(2*a._x-5*v._x+4*p._x-P._x)*L+(-a._x+3*v._x-3*p._x+P._x)*t),K=.5*(2*v._y+(-a._y+p._y)*b+(2*a._y-5*v._y+4*p._y-P._y)*L+(-a._y+3*v._y-3*p._y+P._y)*t),C=.5*(2*v._z+(-a._z+p._z)*b+(2*a._z-5*v._z+4*p._z-P._z)*L+(-a._z+3*v._z-3*p._z+P._z)*t);return new u(V,K,C)}static Clamp(a,v,p){const P=new u;return u.ClampToRef(a,v,p,P),P}static ClampToRef(a,v,p,P){let b=a._x;b=b>p._x?p._x:b,b=b<v._x?v._x:b;let L=a._y;L=L>p._y?p._y:L,L=L<v._y?v._y:L;let t=a._z;return t=t>p._z?p._z:t,t=t<v._z?v._z:t,P.qe(b,L,t),P}static CheckExtends(a,v,p){v.minimizeInPlace(a),p.maximizeInPlace(a)}static Hermite(a,v,p,P,b){const L=b*b,t=b*L,V=2*t-3*L+1,K=-2*t+3*L,C=t-2*L+b,F=t-L,c=a._x*V+p._x*K+v._x*C+P._x*F,f=a._y*V+p._y*K+v._y*C+P._y*F,H=a._z*V+p._z*K+v._z*C+P._z*F;return new u(c,f,H)}static Hermite1stDerivative(a,v,p,P,b){const L=new u;return this.Hermite1stDerivativeToRef(a,v,p,P,b,L),L}static Hermite1stDerivativeToRef(a,v,p,P,b,L){const t=b*b;return L._x=6*(t-b)*a._x+(3*t-4*b+1)*v._x+6*(-t+b)*p._x+(3*t-2*b)*P._x,L._y=6*(t-b)*a._y+(3*t-4*b+1)*v._y+6*(-t+b)*p._y+(3*t-2*b)*P._y,L._z=6*(t-b)*a._z+(3*t-4*b+1)*v._z+6*(-t+b)*p._z+(3*t-2*b)*P._z,L._isDirty=!0,L}static Lerp(a,v,p){const P=new u(0,0,0);return u.LerpToRef(a,v,p,P),P}static LerpToRef(a,v,p,P){return P._x=a._x+(v._x-a._x)*p,P._y=a._y+(v._y-a._y)*p,P._z=a._z+(v._z-a._z)*p,P._isDirty=!0,P}static Dot(a,v){return a._x*v._x+a._y*v._y+a._z*v._z}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z}static Cross(a,v){const p=new u;return u.CrossToRef(a,v,p),p}static CrossToRef(a,v,p){const P=a._y*v._z-a._z*v._y,b=a._z*v._x-a._x*v._z,L=a._x*v._y-a._y*v._x;return p.qe(P,b,L),p}static Normalize(a){const v=u.Zero();return u.NormalizeToRef(a,v),v}static NormalizeToRef(a,v){return a.normalizeToRef(v),v}static Project(a,v,p,P){const b=new u;return u.ProjectToRef(a,v,p,P,b),b}static ProjectToRef(a,v,p,P,b){var L;const t=P.width,K=P.height,C=P.x,F=P.y,c=A.Matrix[1],f=null===(L=V.b.LastCreatedEngine)||void 0===L?void 0:L.isNDCHalfZRange,h=f?1:.5,R=f?0:.5;H.FromValuesToRef(t/2,0,0,0,0,-K/2,0,0,0,0,h,0,C+t/2,K/2+F,R,1,c);const X=A.Matrix[0];return v.multiplyToRef(p,X),X.multiplyToRef(c,X),u.TransformCoordinatesToRef(a,X,b),b}static Reflect(a,v){return this.ReflectToRef(a,v,new u)}static ReflectToRef(a,v,p){const P=h.fb[0];return P.p(v).scaleInPlace(2*u.Dot(a,v)),p.p(a).Bi(P)}static _UnprojectFromInvertedMatrixToRef(a,v,p){u.TransformCoordinatesToRef(a,v,p);const P=v.m,b=a._x*P[3]+a._y*P[7]+a._z*P[11]+P[15];return(0,K.w)(b,1)&&p.scaleInPlace(1/b),p}static UnprojectFromTransform(a,v,p,P,b){return this.Unproject(a,v,p,P,b,H.IdentityReadOnly)}static Unproject(a,v,p,P,b,L){const t=new u;return u.UnprojectToRef(a,v,p,P,b,L,t),t}static UnprojectToRef(a,v,p,P,b,L,t){return u.UnprojectFloatsToRef(a._x,a._y,a._z,v,p,P,b,L,t),t}static UnprojectFloatsToRef(a,v,p,P,b,L,t,K,C){var F;const c=A.Matrix[0];L.multiplyToRef(t,c),c.multiplyToRef(K,c),c.invert();const f=A.fb[0];return f.x=a/P*2-1,f.y=-(v/b*2-1),null!==(F=V.b.LastCreatedEngine)&&void 0!==F&&F.isNDCHalfZRange?f.z=p:f.z=2*p-1,u._UnprojectFromInvertedMatrixToRef(f,c,C),C}static Minimize(a,v){const p=new u;return p.p(a),p.minimizeInPlace(v),p}static Maximize(a,v){const p=new u;return p.p(a),p.maximizeInPlace(v),p}static Distance(a,v){return Math.sqrt(u.DistanceSquared(a,v))}static DistanceSquared(a,v){const p=a._x-v._x,P=a._y-v._y,b=a._z-v._z;return p*p+P*P+b*b}static ProjectOnTriangleToRef(a,v,p,b,L){const t=A.fb[0],V=A.fb[1],C=A.fb[2],F=A.fb[3],c=A.fb[4];p.subtractToRef(v,t),b.subtractToRef(v,V),b.subtractToRef(p,C);const f=t.length(),H=V.length(),h=C.length();if(f<P.e||H<P.e||h<P.e)return L.p(v),u.Distance(a,v);a.subtractToRef(v,c),u.CrossToRef(t,V,F);const R=F.length();if(R<P.e)return L.p(v),u.Distance(a,v);F.normalizeFromLength(R);let X=c.length();if(X<P.e)return L.p(v),0;c.normalizeFromLength(X);const Q=u.Dot(F,c),s=A.fb[5],D=A.fb[6];s.p(F).scaleInPlace(-X*Q),D.p(a).addInPlace(s);const y=A.fb[4],Z=A.fb[5],M=A.fb[7],S=A.fb[8];y.p(t).scaleInPlace(1/f),S.p(V).scaleInPlace(1/H),y.addInPlace(S).scaleInPlace(-1),Z.p(t).scaleInPlace(-1/f),S.p(C).scaleInPlace(1/h),Z.addInPlace(S).scaleInPlace(-1),M.p(C).scaleInPlace(-1/h),S.p(V).scaleInPlace(-1/H),M.addInPlace(S).scaleInPlace(-1);const n=A.fb[9];let q;n.p(D).Bi(v),u.CrossToRef(y,n,S),q=u.Dot(S,F);const T=q;n.p(D).Bi(p),u.CrossToRef(Z,n,S),q=u.Dot(S,F);const j=q;n.p(D).Bi(b),u.CrossToRef(M,n,S),q=u.Dot(S,F);const w=q,J=A.fb[10];let B,x;T>0&&j<0?(J.p(t),B=v,x=p):j>0&&w<0?(J.p(C),B=p,x=b):(J.p(V).scaleInPlace(-1),B=b,x=v);const r=A.fb[9],o=A.fb[4];B.subtractToRef(D,S),x.subtractToRef(D,r),u.CrossToRef(S,r,o);if(!(u.Dot(o,F)<0))return L.p(D),Math.abs(X*Q);const m=A.fb[5];u.CrossToRef(J,o,m),m.normalize();const O=A.fb[9];O.p(B).Bi(D);const Y=O.length();if(Y<P.e)return L.p(B),u.Distance(a,B);O.normalizeFromLength(Y);const l=u.Dot(m,O),z=A.fb[7];z.p(D).addInPlace(m.scaleInPlace(Y*l)),S.p(z).Bi(B),X=J.length(),J.normalizeFromLength(X);let g=u.Dot(S,J)/Math.max(X,P.e);return g=(0,K.e)(g,0,1),z.p(B).addInPlace(J.scaleInPlace(g*X)),L.p(z),u.Distance(a,z)}static Center(a,v){return u.CenterToRef(a,v,u.Zero())}static CenterToRef(a,v,p){return p.qe((a._x+v._x)/2,(a._y+v._y)/2,(a._z+v._z)/2)}static RotationFromAxis(a,v,p){const P=new u;return u.RotationFromAxisToRef(a,v,p,P),P}static RotationFromAxisToRef(a,v,p,P){const b=A.Quaternion[0];return f.RotationQuaternionFromAxisToRef(a,v,p,b),b.toEulerAnglesToRef(P),P}}u._UpReadOnly=u.Up(),u._DownReadOnly=u.Down(),u._LeftHandedForwardReadOnly=u.Forward(!1),u._RightHandedForwardReadOnly=u.Forward(!0),u._LeftHandedBackwardReadOnly=u.Backward(!1),u._RightHandedBackwardReadOnly=u.Backward(!0),u._RightReadOnly=u.Right(),u._LeftReadOnly=u.Left(),u._ZeroReadOnly=u.Zero(),u._OneReadOnly=u.One(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class c{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=a,this.y=v,this.z=p,this.w=P}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let a=C(this.x);return a=397*a^C(this.y),a=397*a^C(this.z),a=397*a^C(this.w),a}tj(){return[this.x,this.y,this.z,this.w]}toArray(a,v){return void 0===v&&(v=0),a[v]=this.x,a[v+1]=this.y,a[v+2]=this.z,a[v+3]=this.w,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return c.FromArrayToRef(a,v,this),this}addInPlace(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addInPlaceFromFloats(a,v,p,P){return this.x+=a,this.y+=v,this.z+=p,this.w+=P,this}add(a){return new c(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)}addToRef(a,v){return v.x=this.x+a.x,v.y=this.y+a.y,v.z=this.z+a.z,v.w=this.w+a.w,v}Bi(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}od(a){return new c(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)}subtractToRef(a,v){return v.x=this.x-a.x,v.y=this.y-a.y,v.z=this.z-a.z,v.w=this.w-a.w,v}subtractFromFloats(a,v,p,P){return new c(this.x-a,this.y-v,this.z-p,this.w-P)}subtractFromFloatsToRef(a,v,p,P,b){return b.x=this.x-a,b.y=this.y-v,b.z=this.z-p,b.w=this.w-P,b}negate(){return new c(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(a){return a.x=-this.x,a.y=-this.y,a.z=-this.z,a.w=-this.w,a}scaleInPlace(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}scale(a){return new c(this.x*a,this.y*a,this.z*a,this.w*a)}scaleToRef(a,v){return v.x=this.x*a,v.y=this.y*a,v.z=this.z*a,v.w=this.w*a,v}scaleAndAddToRef(a,v){return v.x+=this.x*a,v.y+=this.y*a,v.z+=this.z*a,v.w+=this.w*a,v}equals(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return a&&(0,K.w)(this.x,a.x,v)&&(0,K.w)(this.y,a.y,v)&&(0,K.w)(this.z,a.z,v)&&(0,K.w)(this.w,a.w,v)}equalsToFloats(a,v,p,P){return this.x===a&&this.y===v&&this.z===p&&this.w===P}multiplyInPlace(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiply(a){return new c(this.x*a.x,this.y*a.y,this.z*a.z,this.w*a.w)}multiplyToRef(a,v){return v.x=this.x*a.x,v.y=this.y*a.y,v.z=this.z*a.z,v.w=this.w*a.w,v}multiplyByFloats(a,v,p,P){return new c(this.x*a,this.y*v,this.z*p,this.w*P)}divide(a){return new c(this.x/a.x,this.y/a.y,this.z/a.z,this.w/a.w)}divideToRef(a,v){return v.x=this.x/a.x,v.y=this.y/a.y,v.z=this.z/a.z,v.w=this.w/a.w,v}divideInPlace(a){return this.divideToRef(a,this)}minimizeInPlace(a){return a.x<this.x&&(this.x=a.x),a.y<this.y&&(this.y=a.y),a.z<this.z&&(this.z=a.z),a.w<this.w&&(this.w=a.w),this}maximizeInPlace(a){return a.x>this.x&&(this.x=a.x),a.y>this.y&&(this.y=a.y),a.z>this.z&&(this.z=a.z),a.w>this.w&&(this.w=a.w),this}minimizeInPlaceFromFloats(a,v,p,P){return this.x=Math.min(a,this.x),this.y=Math.min(v,this.y),this.z=Math.min(p,this.z),this.w=Math.min(P,this.w),this}maximizeInPlaceFromFloats(a,v,p,P){return this.x=Math.max(a,this.x),this.y=Math.max(v,this.y),this.z=Math.max(p,this.z),this.w=Math.max(P,this.w),this}floorToRef(a){return a.x=Math.floor(this.x),a.y=Math.floor(this.y),a.z=Math.floor(this.z),a.w=Math.floor(this.w),a}floor(){return new c(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(a){return a.x=this.x-Math.floor(this.x),a.y=this.y-Math.floor(this.y),a.z=this.z-Math.floor(this.z),a.w=this.w-Math.floor(this.w),a}fract(){return new c(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(a){return 0===a||1===a?this:this.scaleInPlace(1/a)}normalizeToNew(){return this.normalizeToRef(new c)}normalizeToRef(a){const v=this.length();return 0===v||1===v?(a.x=this.x,a.y=this.y,a.z=this.z,a.w=this.w,a):this.scaleToRef(1/v,a)}toVector3(){return new u(this.x,this.y,this.z)}clone(){return new c(this.x,this.y,this.z,this.w)}p(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this}qe(a,v,p,P){return this.x=a,this.y=v,this.z=p,this.w=P,this}set(a,v,p,P){return this.qe(a,v,p,P)}pe(a){return this.x=this.y=this.z=this.w=a,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}static bh(a,v){return v||(v=0),new c(a[v],a[v+1],a[v+2],a[v+3])}static FromArrayToRef(a,v,p){return p.x=a[v],p.y=a[v+1],p.z=a[v+2],p.w=a[v+3],p}static FromFloatArrayToRef(a,v,p){return c.FromArrayToRef(a,v,p),p}static FromFloatsToRef(a,v,p,P,b){return b.x=a,b.y=v,b.z=p,b.w=P,b}static Zero(){return new c(0,0,0,0)}static One(){return new c(1,1,1,1)}static Random(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new c((0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v))}static RandomToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2?arguments[2]:void 0;return p.x=(0,K.r)(a,v),p.y=(0,K.r)(a,v),p.z=(0,K.r)(a,v),p.w=(0,K.r)(a,v),p}static Clamp(a,v,p){return c.ClampToRef(a,v,p,new c)}static ClampToRef(a,v,p,P){return P.x=(0,K.e)(a.x,v.x,p.x),P.y=(0,K.e)(a.y,v.y,p.y),P.z=(0,K.e)(a.z,v.z,p.z),P.w=(0,K.e)(a.w,v.w,p.w),P}static CheckExtends(a,v,p){v.minimizeInPlace(a),p.maximizeInPlace(a)}static get ZeroReadOnly(){return c._ZeroReadOnly}static Normalize(a){return c.NormalizeToRef(a,new c)}static NormalizeToRef(a,v){return a.normalizeToRef(v),v}static Minimize(a,v){const p=new c;return p.p(a),p.minimizeInPlace(v),p}static Maximize(a,v){const p=new c;return p.p(a),p.maximizeInPlace(v),p}static Distance(a,v){return Math.sqrt(c.DistanceSquared(a,v))}static DistanceSquared(a,v){const p=a.x-v.x,P=a.y-v.y,b=a.z-v.z,L=a.w-v.w;return p*p+P*P+b*b+L*L}static Center(a,v){return c.CenterToRef(a,v,new c)}static CenterToRef(a,v,p){return p.x=(a.x+v.x)/2,p.y=(a.y+v.y)/2,p.z=(a.z+v.z)/2,p.w=(a.w+v.w)/2,p}static TransformCoordinates(a,v){return c.TransformCoordinatesToRef(a,v,new c)}static TransformCoordinatesToRef(a,v,p){return c.TransformCoordinatesFromFloatsToRef(a._x,a._y,a._z,v,p),p}static TransformCoordinatesFromFloatsToRef(a,v,p,P,b){const L=P.m,t=a*L[0]+v*L[4]+p*L[8]+L[12],V=a*L[1]+v*L[5]+p*L[9]+L[13],K=a*L[2]+v*L[6]+p*L[10]+L[14],C=a*L[3]+v*L[7]+p*L[11]+L[15];return b.x=t,b.y=V,b.z=K,b.w=C,b}static TransformNormal(a,v){return c.TransformNormalToRef(a,v,new c)}static TransformNormalToRef(a,v,p){const P=v.m,b=a.x*P[0]+a.y*P[4]+a.z*P[8],L=a.x*P[1]+a.y*P[5]+a.z*P[9],t=a.x*P[2]+a.y*P[6]+a.z*P[10];return p.x=b,p.y=L,p.z=t,p.w=a.w,p}static TransformNormalFromFloatsToRef(a,v,p,P,b,L){const t=b.m;return L.x=a*t[0]+v*t[4]+p*t[8],L.y=a*t[1]+v*t[5]+p*t[9],L.z=a*t[2]+v*t[6]+p*t[10],L.w=P,L}static FromVector3(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new c(a._x,a._y,a._z,v)}static Dot(a,v){return a.x*v.x+a.y*v.y+a.z*v.z+a.w*v.w}}c._ZeroReadOnly=c.Zero(),Object.defineProperties(c.prototype,{dimension:{value:[4]},rank:{value:1}});class f{get x(){return this._x}set x(a){this._x=a,this._isDirty=!0}get y(){return this._y}set y(a){this._y=a,this._isDirty=!0}get z(){return this._z}set z(a){this._z=a,this._isDirty=!0}get w(){return this._w}set w(a){this._w=a,this._isDirty=!0}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=a,this._y=v,this._z=p,this._w=P}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let a=C(this._x);return a=397*a^C(this._y),a=397*a^C(this._z),a=397*a^C(this._w),a}tj(){return[this._x,this._y,this._z,this._w]}toArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[v]=this._x,a[v+1]=this._y,a[v+2]=this._z,a[v+3]=this._w,this}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return f.FromArrayToRef(a,v,this)}equals(a){return a&&this._x===a._x&&this._y===a._y&&this._z===a._z&&this._w===a._w}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.e;return a&&(0,K.w)(this._x,a._x,v)&&(0,K.w)(this._y,a._y,v)&&(0,K.w)(this._z,a._z,v)&&(0,K.w)(this._w,a._w,v)}clone(){return new f(this._x,this._y,this._z,this._w)}p(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._w=a._w,this._isDirty=!0,this}qe(a,v,p,P){return this._x=a,this._y=v,this._z=p,this._w=P,this._isDirty=!0,this}set(a,v,p,P){return this.qe(a,v,p,P)}pe(a){return this.qe(a,a,a,a)}add(a){return new f(this._x+a._x,this._y+a._y,this._z+a._z,this._w+a._w)}addInPlace(a){return this._x+=a._x,this._y+=a._y,this._z+=a._z,this._w+=a._w,this._isDirty=!0,this}addToRef(a,v){return v._x=this._x+a._x,v._y=this._y+a._y,v._z=this._z+a._z,v._w=this._w+a._w,v._isDirty=!0,v}addInPlaceFromFloats(a,v,p,P){return this._x+=a,this._y+=v,this._z+=p,this._w+=P,this._isDirty=!0,this}subtractToRef(a,v){return v._x=this._x-a._x,v._y=this._y-a._y,v._z=this._z-a._z,v._w=this._w-a._w,v._isDirty=!0,v}subtractFromFloats(a,v,p,P){return this.subtractFromFloatsToRef(a,v,p,P,new f)}subtractFromFloatsToRef(a,v,p,P,b){return b._x=this._x-a,b._y=this._y-v,b._z=this._z-p,b._w=this._w-P,b._isDirty=!0,b}od(a){return new f(this._x-a._x,this._y-a._y,this._z-a._z,this._w-a._w)}Bi(a){return this._x-=a._x,this._y-=a._y,this._z-=a._z,this._w-=a._w,this._isDirty=!0,this}scale(a){return new f(this._x*a,this._y*a,this._z*a,this._w*a)}scaleToRef(a,v){return v._x=this._x*a,v._y=this._y*a,v._z=this._z*a,v._w=this._w*a,v._isDirty=!0,v}scaleInPlace(a){return this._x*=a,this._y*=a,this._z*=a,this._w*=a,this._isDirty=!0,this}scaleAndAddToRef(a,v){return v._x+=this._x*a,v._y+=this._y*a,v._z+=this._z*a,v._w+=this._w*a,v._isDirty=!0,v}multiply(a){const v=new f(0,0,0,1);return this.multiplyToRef(a,v),v}multiplyToRef(a,v){const p=this._x*a._w+this._y*a._z-this._z*a._y+this._w*a._x,P=-this._x*a._z+this._y*a._w+this._z*a._x+this._w*a._y,b=this._x*a._y-this._y*a._x+this._z*a._w+this._w*a._z,L=-this._x*a._x-this._y*a._y-this._z*a._z+this._w*a._w;return v.qe(p,P,b,L),v}multiplyInPlace(a){return this.multiplyToRef(a,this)}multiplyByFloats(a,v,p,P){return this._x*=a,this._y*=v,this._z*=p,this._w*=P,this._isDirty=!0,this}divide(a){throw new ReferenceError("Can not divide a quaternion")}divideToRef(a,v){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(a){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new f)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(a){return a._x=-this._x,a._y=-this._y,a._z=-this._z,a._w=-this._w,a._isDirty=!0,a}equalsToFloats(a,v,p,P){return this._x===a&&this._y===v&&this._z===p&&this._w===P}floorToRef(a){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(a){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(a){return a.qe(-this._x,-this._y,-this._z,this._w),a}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new f(-this._x,-this._y,-this._z,this._w)}invert(){const a=this.conjugate(),v=this.lengthSquared();return 0==v||1==v||a.scaleInPlace(1/v),a}invertInPlace(){this.conjugateInPlace();const a=this.lengthSquared();return 0==a||1==a||this.scaleInPlace(1/a),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(a){return 0===a||1===a?this:this.scaleInPlace(1/a)}normalizeToNew(){const a=new f(0,0,0,1);return this.normalizeToRef(a),a}normalizeToRef(a){const v=this.length();return 0===v||1===v?a.qe(this._x,this._y,this._z,this._w):this.scaleToRef(1/v,a)}toEulerAngles(){const a=u.Zero();return this.toEulerAnglesToRef(a),a}toEulerAnglesToRef(a){const v=this._z,p=this._x,P=this._y,b=this._w,L=P*v-p*b,t=.4999999;if(L<-t)a._y=2*Math.atan2(P,b),a._x=Math.PI/2,a._z=0,a._isDirty=!0;else if(L>t)a._y=2*Math.atan2(P,b),a._x=-Math.PI/2,a._z=0,a._isDirty=!0;else{const t=b*b,V=v*v,K=p*p,C=P*P;a._z=Math.atan2(2*(p*P+v*b),-V-K+C+t),a._x=Math.asin(-2*L),a._y=Math.atan2(2*(v*p+P*b),V-K-C+t),a._isDirty=!0}return a}toAlphaBetaGammaToRef(a){const v=this._z,p=this._x,P=this._y,b=this._w,L=Math.sqrt(p*p+P*P),t=Math.sqrt(v*v+b*b),V=2*Math.atan2(L,t),K=2*Math.atan2(v,b),C=2*Math.atan2(P,p),F=(K+C)/2,u=(K-C)/2;return a.set(u,V,F),a}toRotationMatrix(a){return H.FromQuaternionToRef(this,a),a}fromRotationMatrix(a){return f.FromRotationMatrixToRef(a,this),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}static FromRotationMatrix(a){const v=new f;return f.FromRotationMatrixToRef(a,v),v}static FromRotationMatrixToRef(a,v){const p=a.m,P=p[0],b=p[4],L=p[8],t=p[1],V=p[5],K=p[9],C=p[2],F=p[6],u=p[10],c=P+V+u;let f;return c>0?(f=.5/Math.sqrt(c+1),v._w=.25/f,v._x=(F-K)*f,v._y=(L-C)*f,v._z=(t-b)*f,v._isDirty=!0):P>V&&P>u?(f=2*Math.sqrt(1+P-V-u),v._w=(F-K)/f,v._x=.25*f,v._y=(b+t)/f,v._z=(L+C)/f,v._isDirty=!0):V>u?(f=2*Math.sqrt(1+V-P-u),v._w=(L-C)/f,v._x=(b+t)/f,v._y=.25*f,v._z=(K+F)/f,v._isDirty=!0):(f=2*Math.sqrt(1+u-P-V),v._w=(t-b)/f,v._x=(L+C)/f,v._y=(K+F)/f,v._z=.25*f,v._isDirty=!0),v}static Dot(a,v){return a._x*v._x+a._y*v._y+a._z*v._z+a._w*v._w}static AreClose(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const P=f.Dot(a,v);return 1-P*P<=p}static SmoothToRef(a,v,p,P,b){let L=0===P?1:p/P;return L=(0,K.e)(L,0,1),f.SlerpToRef(a,v,L,b),b}static Zero(){return new f(0,0,0,0)}static Inverse(a){return new f(-a._x,-a._y,-a._z,a._w)}static InverseToRef(a,v){return v.set(-a._x,-a._y,-a._z,a._w),v}static Identity(){return new f(0,0,0,1)}static IsIdentity(a){return a&&0===a._x&&0===a._y&&0===a._z&&1===a._w}static RotationAxis(a,v){return f.RotationAxisToRef(a,v,new f)}static RotationAxisToRef(a,v,p){p._w=Math.cos(v/2);const P=Math.sin(v/2)/a.length();return p._x=a._x*P,p._y=a._y*P,p._z=a._z*P,p._isDirty=!0,p}static bh(a,v){return v||(v=0),new f(a[v],a[v+1],a[v+2],a[v+3])}static FromArrayToRef(a,v,p){return p._x=a[v],p._y=a[v+1],p._z=a[v+2],p._w=a[v+3],p._isDirty=!0,p}static FromFloatsToRef(a,v,p,P,b){return b.qe(a,v,p,P),b}static FromEulerAngles(a,v,p){const P=new f;return f.RotationYawPitchRollToRef(v,a,p,P),P}static FromEulerAnglesToRef(a,v,p,P){return f.RotationYawPitchRollToRef(v,a,p,P),P}static FromEulerVector(a){const v=new f;return f.RotationYawPitchRollToRef(a._y,a._x,a._z,v),v}static FromEulerVectorToRef(a,v){return f.RotationYawPitchRollToRef(a._y,a._x,a._z,v),v}static FromUnitVectorsToRef(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.e;const L=u.Dot(a,v)+1;return L<b?Math.abs(a.x)>Math.abs(a.z)?p.set(-a.y,a.x,0,0):p.set(0,-a.z,a.y,0):(u.CrossToRef(a,v,h.fb[0]),p.set(h.fb[0].x,h.fb[0].y,h.fb[0].z,L)),p.normalize()}static RotationYawPitchRoll(a,v,p){const P=new f;return f.RotationYawPitchRollToRef(a,v,p,P),P}static RotationYawPitchRollToRef(a,v,p,P){const b=.5*p,L=.5*v,t=.5*a,V=Math.sin(b),K=Math.cos(b),C=Math.sin(L),F=Math.cos(L),u=Math.sin(t),c=Math.cos(t);return P._x=c*C*K+u*F*V,P._y=u*F*K-c*C*V,P._z=c*F*V-u*C*K,P._w=c*F*K+u*C*V,P._isDirty=!0,P}static RotationAlphaBetaGamma(a,v,p){const P=new f;return f.RotationAlphaBetaGammaToRef(a,v,p,P),P}static RotationAlphaBetaGammaToRef(a,v,p,P){const b=.5*(p+a),L=.5*(p-a),t=.5*v;return P._x=Math.cos(L)*Math.sin(t),P._y=Math.sin(L)*Math.sin(t),P._z=Math.sin(b)*Math.cos(t),P._w=Math.cos(b)*Math.cos(t),P._isDirty=!0,P}static RotationQuaternionFromAxis(a,v,p){const P=new f(0,0,0,0);return f.RotationQuaternionFromAxisToRef(a,v,p,P),P}static RotationQuaternionFromAxisToRef(a,v,p,P){const b=A.Matrix[0];return a=a.normalizeToRef(A.fb[0]),v=v.normalizeToRef(A.fb[1]),p=p.normalizeToRef(A.fb[2]),H.FromXYZAxesToRef(a,v,p,b),f.FromRotationMatrixToRef(b,P),P}static FromLookDirectionLH(a,v){const p=new f;return f.FromLookDirectionLHToRef(a,v,p),p}static FromLookDirectionLHToRef(a,v,p){const P=A.Matrix[0];return H.LookDirectionLHToRef(a,v,P),f.FromRotationMatrixToRef(P,p),p}static FromLookDirectionRH(a,v){const p=new f;return f.FromLookDirectionRHToRef(a,v,p),p}static FromLookDirectionRHToRef(a,v,p){const P=A.Matrix[0];return H.LookDirectionRHToRef(a,v,P),f.FromRotationMatrixToRef(P,p)}static Slerp(a,v,p){const P=f.Identity();return f.SlerpToRef(a,v,p,P),P}static SlerpToRef(a,v,p,P){let b,L,t=a._x*v._x+a._y*v._y+a._z*v._z+a._w*v._w,V=!1;if(t<0&&(V=!0,t=-t),t>.999999)L=1-p,b=V?-p:p;else{const a=Math.acos(t),v=1/Math.sin(a);L=Math.sin((1-p)*a)*v,b=V?-Math.sin(p*a)*v:Math.sin(p*a)*v}return P._x=L*a._x+b*v._x,P._y=L*a._y+b*v._y,P._z=L*a._z+b*v._z,P._w=L*a._w+b*v._w,P._isDirty=!0,P}static Hermite(a,v,p,P,b){const L=b*b,t=b*L,V=2*t-3*L+1,K=-2*t+3*L,C=t-2*L+b,F=t-L,u=a._x*V+p._x*K+v._x*C+P._x*F,c=a._y*V+p._y*K+v._y*C+P._y*F,H=a._z*V+p._z*K+v._z*C+P._z*F,A=a._w*V+p._w*K+v._w*C+P._w*F;return new f(u,c,H,A)}static Hermite1stDerivative(a,v,p,P,b){const L=new f;return this.Hermite1stDerivativeToRef(a,v,p,P,b,L),L}static Hermite1stDerivativeToRef(a,v,p,P,b,L){const t=b*b;return L._x=6*(t-b)*a._x+(3*t-4*b+1)*v._x+6*(-t+b)*p._x+(3*t-2*b)*P._x,L._y=6*(t-b)*a._y+(3*t-4*b+1)*v._y+6*(-t+b)*p._y+(3*t-2*b)*P._y,L._z=6*(t-b)*a._z+(3*t-4*b+1)*v._z+6*(-t+b)*p._z+(3*t-2*b)*P._z,L._w=6*(t-b)*a._w+(3*t-4*b+1)*v._w+6*(-t+b)*p._w+(3*t-2*b)*P._w,L._isDirty=!0,L}static Normalize(a){const v=f.Zero();return f.NormalizeToRef(a,v),v}static NormalizeToRef(a,v){return a.normalizeToRef(v),v}static Clamp(a,v,p){const P=new f;return f.ClampToRef(a,v,p,P),P}static ClampToRef(a,v,p,P){return P.qe((0,K.e)(a.x,v.x,p.x),(0,K.e)(a.y,v.y,p.y),(0,K.e)(a.z,v.z,p.z),(0,K.e)(a.w,v.w,p.w))}static Random(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new f((0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v))}static RandomToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).qe((0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v),(0,K.r)(a,v))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(a,v){return Math.sqrt(f.DistanceSquared(a,v))}static DistanceSquared(a,v){const p=a.x-v.x,P=a.y-v.y,b=a.z-v.z,L=a.w-v.w;return p*p+P*P+b*b+L*L}static Center(a,v){return f.CenterToRef(a,v,f.Zero())}static CenterToRef(a,v,p){return p.qe((a.x+v.x)/2,(a.y+v.y)/2,(a.z+v.z)/2,(a.w+v.w)/2)}}Object.defineProperties(f.prototype,{dimension:{value:[4]},rank:{value:1}});class H{static get Use64Bits(){return t.c.MatrixUse64Bits}get m(){return this.$j}markAsUpdated(){this.updateFlag=H._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=a,this._isIdentity3x2=a||p,this._isIdentityDirty=!this._isIdentity&&v,this._isIdentity3x2Dirty=!this._isIdentity3x2&&P}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,t.c.MatrixTrackPrecisionChange&&t.c.MatrixTrackedMatrices.push(this),this.$j=new t.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const a=this.$j;this._isIdentity=1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.$j[0]||1!==this.$j[5]||1!==this.$j[15]||0!==this.$j[1]||0!==this.$j[2]||0!==this.$j[3]||0!==this.$j[4]||0!==this.$j[6]||0!==this.$j[7]||0!==this.$j[8]||0!==this.$j[9]||0!==this.$j[10]||0!==this.$j[11]||0!==this.$j[12]||0!==this.$j[13]||0!==this.$j[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const a=this.$j,v=a[0],p=a[1],P=a[2],b=a[3],L=a[4],t=a[5],V=a[6],K=a[7],C=a[8],F=a[9],u=a[10],c=a[11],f=a[12],H=a[13],A=a[14],h=a[15],R=u*h-A*c,X=F*h-H*c,Q=F*A-H*u,s=C*h-f*c,D=C*A-u*f,y=C*H-f*F;return v*+(t*R-V*X+K*Q)+p*-(L*R-V*s+K*D)+P*+(L*X-t*s+K*y)+b*-(L*Q-t*D+V*y)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!a)return this.$j;const p=this.$j;for(let P=0;P<16;P++)a[v+P]=p[P];return this}tj(){return this.$j}pd(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H.FromArrayToRef(a,v,this)}qe(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];return H.FromArrayToRef(v,0,this)}set(){const a=this.$j;for(let v=0;v<16;v++)a[v]=v<0||arguments.length<=v?void 0:arguments[v];return this.markAsUpdated(),this}pe(a){const v=this.$j;for(let p=0;p<16;p++)v[p]=a;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return H.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(a){const v=new H;return this.addToRef(a,v),v}addToRef(a,v){const p=this.$j,P=v.$j,b=a.m;for(let L=0;L<16;L++)P[L]=p[L]+b[L];return v.markAsUpdated(),v}addToSelf(a){const v=this.$j,p=a.m;return v[0]+=p[0],v[1]+=p[1],v[2]+=p[2],v[3]+=p[3],v[4]+=p[4],v[5]+=p[5],v[6]+=p[6],v[7]+=p[7],v[8]+=p[8],v[9]+=p[9],v[10]+=p[10],v[11]+=p[11],v[12]+=p[12],v[13]+=p[13],v[14]+=p[14],v[15]+=p[15],this.markAsUpdated(),this}addInPlace(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]+=p[P];return this.markAsUpdated(),this}addInPlaceFromFloats(){const a=this.$j;for(let v=0;v<16;v++)a[v]+=v<0||arguments.length<=v?void 0:arguments[v];return this.markAsUpdated(),this}od(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]-=p[P];return this.markAsUpdated(),this}subtractToRef(a,v){const p=this.$j,P=a.m,b=v.$j;for(let L=0;L<16;L++)b[L]=p[L]-P[L];return v.markAsUpdated(),v}Bi(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]-=p[P];return this.markAsUpdated(),this}subtractFromFloats(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];return this.subtractFromFloatsToRef(...v,new H)}subtractFromFloatsToRef(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];const P=v.pop(),b=this.$j,L=P.$j,t=v;for(let V=0;V<16;V++)L[V]=b[V]-t[V];return P.markAsUpdated(),P}invertToRef(a){if(!0===this._isIdentity)return H.IdentityToRef(a),a;const v=this.$j,p=v[0],P=v[1],b=v[2],L=v[3],t=v[4],V=v[5],K=v[6],C=v[7],F=v[8],u=v[9],c=v[10],f=v[11],A=v[12],h=v[13],R=v[14],X=v[15],Q=c*X-R*f,s=u*X-h*f,D=u*R-h*c,y=F*X-A*f,Z=F*R-c*A,M=F*h-A*u,S=+(V*Q-K*s+C*D),n=-(t*Q-K*y+C*Z),q=+(t*s-V*y+C*M),T=-(t*D-V*Z+K*M),j=p*S+P*n+b*q+L*T;if(0===j)return a.p(this),a;const w=1/j,J=K*X-R*C,B=V*X-h*C,x=V*R-h*K,r=t*X-A*C,o=t*R-A*K,m=t*h-A*V,O=K*f-c*C,Y=V*f-u*C,l=V*c-u*K,z=t*f-F*C,g=t*c-F*K,G=t*u-F*V,e=-(P*Q-b*s+L*D),k=+(p*Q-b*y+L*Z),d=-(p*s-P*y+L*M),E=+(p*D-P*Z+b*M),W=+(P*J-b*B+L*x),U=-(p*J-b*r+L*o),N=+(p*B-P*r+L*m),i=-(p*x-P*o+b*m),I=-(P*O-b*Y+L*l),aa=+(p*O-b*z+L*g),va=-(p*Y-P*z+L*G),pa=+(p*l-P*g+b*G);return H.FromValuesToRef(S*w,e*w,W*w,I*w,n*w,k*w,U*w,aa*w,q*w,d*w,N*w,va*w,T*w,E*w,i*w,pa*w,a),a}addAtIndex(a,v){return this.$j[a]+=v,this.markAsUpdated(),this}multiplyAtIndex(a,v){return this.$j[a]*=v,this.markAsUpdated(),this}setTranslationFromFloats(a,v,p){return this.$j[12]=a,this.$j[13]=v,this.$j[14]=p,this.markAsUpdated(),this}addTranslationFromFloats(a,v,p){return this.$j[12]+=a,this.$j[13]+=v,this.$j[14]+=p,this.markAsUpdated(),this}setTranslation(a){return this.setTranslationFromFloats(a._x,a._y,a._z)}getTranslation(){return new u(this.$j[12],this.$j[13],this.$j[14])}getTranslationToRef(a){return a.x=this.$j[12],a.y=this.$j[13],a.z=this.$j[14],a}removeRotationAndScaling(){const a=this.m;return H.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,a[12],a[13],a[14],a[15],this),this._updateIdentityStatus(0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]),this}p(a){a.copyToArray(this.$j);const v=a;return this.updateFlag=v.updateFlag,this._updateIdentityStatus(v._isIdentity,v._isIdentityDirty,v._isIdentity3x2,v._isIdentity3x2Dirty),this}copyToArray(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=this.$j;return a[v]=p[0],a[v+1]=p[1],a[v+2]=p[2],a[v+3]=p[3],a[v+4]=p[4],a[v+5]=p[5],a[v+6]=p[6],a[v+7]=p[7],a[v+8]=p[8],a[v+9]=p[9],a[v+10]=p[10],a[v+11]=p[11],a[v+12]=p[12],a[v+13]=p[13],a[v+14]=p[14],a[v+15]=p[15],this}multiply(a){const v=new H;return this.multiplyToRef(a,v),v}multiplyInPlace(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]*=p[P];return this.markAsUpdated(),this}multiplyByFloats(){const a=this.$j;for(let v=0;v<16;v++)a[v]*=v<0||arguments.length<=v?void 0:arguments[v];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];const P=v.pop(),b=this.$j,L=P.$j,t=v;for(let V=0;V<16;V++)L[V]=b[V]*t[V];return P.markAsUpdated(),P}multiplyToRef(a,v){return this._isIdentity?(v.p(a),v):a._isIdentity?(v.p(this),v):(this.multiplyToArray(a,v.$j,0),v.markAsUpdated(),v)}multiplyToArray(a,v,p){const P=this.$j,b=a.m,L=P[0],t=P[1],V=P[2],K=P[3],C=P[4],F=P[5],u=P[6],c=P[7],f=P[8],H=P[9],A=P[10],h=P[11],R=P[12],X=P[13],Q=P[14],s=P[15],D=b[0],y=b[1],Z=b[2],M=b[3],S=b[4],n=b[5],q=b[6],T=b[7],j=b[8],w=b[9],J=b[10],B=b[11],x=b[12],r=b[13],o=b[14],m=b[15];return v[p]=L*D+t*S+V*j+K*x,v[p+1]=L*y+t*n+V*w+K*r,v[p+2]=L*Z+t*q+V*J+K*o,v[p+3]=L*M+t*T+V*B+K*m,v[p+4]=C*D+F*S+u*j+c*x,v[p+5]=C*y+F*n+u*w+c*r,v[p+6]=C*Z+F*q+u*J+c*o,v[p+7]=C*M+F*T+u*B+c*m,v[p+8]=f*D+H*S+A*j+h*x,v[p+9]=f*y+H*n+A*w+h*r,v[p+10]=f*Z+H*q+A*J+h*o,v[p+11]=f*M+H*T+A*B+h*m,v[p+12]=R*D+X*S+Q*j+s*x,v[p+13]=R*y+X*n+Q*w+s*r,v[p+14]=R*Z+X*q+Q*J+s*o,v[p+15]=R*M+X*T+Q*B+s*m,this}divide(a){return this.divideToRef(a,new H)}divideToRef(a,v){const p=this.$j,P=a.m,b=v.$j;for(let L=0;L<16;L++)b[L]=p[L]/P[L];return v.markAsUpdated(),v}divideInPlace(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]/=p[P];return this.markAsUpdated(),this}minimizeInPlace(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]=Math.min(v[P],p[P]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const a=this.$j;for(let v=0;v<16;v++)a[v]=Math.min(a[v],v<0||arguments.length<=v?void 0:arguments[v]);return this.markAsUpdated(),this}maximizeInPlace(a){const v=this.$j,p=a.m;for(let P=0;P<16;P++)v[P]=Math.min(v[P],p[P]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const a=this.$j;for(let v=0;v<16;v++)a[v]=Math.min(a[v],v<0||arguments.length<=v?void 0:arguments[v]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new H)}negateInPlace(){const a=this.$j;for(let v=0;v<16;v++)a[v]=-a[v];return this.markAsUpdated(),this}negateToRef(a){const v=this.$j,p=a.$j;for(let P=0;P<16;P++)p[P]=-v[P];return a.markAsUpdated(),a}equals(a){const v=a;if(!v)return!1;if((this._isIdentity||v._isIdentity)&&!this._isIdentityDirty&&!v._isIdentityDirty)return this._isIdentity&&v._isIdentity;const p=this.m,P=v.m;return p[0]===P[0]&&p[1]===P[1]&&p[2]===P[2]&&p[3]===P[3]&&p[4]===P[4]&&p[5]===P[5]&&p[6]===P[6]&&p[7]===P[7]&&p[8]===P[8]&&p[9]===P[9]&&p[10]===P[10]&&p[11]===P[11]&&p[12]===P[12]&&p[13]===P[13]&&p[14]===P[14]&&p[15]===P[15]}equalsWithEpsilon(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=this.$j,P=a.m;for(let b=0;b<16;b++)if(!(0,K.w)(p[b],P[b],v))return!1;return!0}equalsToFloats(){const a=this.$j;for(let v=0;v<16;v++)if(a[v]!=(v<0||arguments.length<=v?void 0:arguments[v]))return!1;return!0}floor(){return this.floorToRef(new H)}floorToRef(a){const v=this.$j,p=a.$j;for(let P=0;P<16;P++)p[P]=Math.floor(v[P]);return a.markAsUpdated(),a}fract(){return this.fractToRef(new H)}fractToRef(a){const v=this.$j,p=a.$j;for(let P=0;P<16;P++)p[P]=v[P]-Math.floor(v[P]);return a.markAsUpdated(),a}clone(){const a=new H;return a.p(this),a}getClassName(){return"Matrix"}getHashCode(){let a=C(this.$j[0]);for(let v=1;v<16;v++)a=397*a^C(this.$j[v]);return a}decomposeToTransformNode(a){return a.rotationQuaternion=a.rotationQuaternion||new f,this.decompose(a.te,a.rotationQuaternion,a.position)}decompose(a,v,p,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return p&&p.pe(0),a&&a.pe(1),v&&v.qe(0,0,0,1),!0;const L=this.$j;if(p&&p.qe(L[12],L[13],L[14]),(a=a||A.fb[0]).x=Math.sqrt(L[0]*L[0]+L[1]*L[1]+L[2]*L[2]),a.y=Math.sqrt(L[4]*L[4]+L[5]*L[5]+L[6]*L[6]),a.z=Math.sqrt(L[8]*L[8]+L[9]*L[9]+L[10]*L[10]),P){const v=(b?P.absoluteScaling.x:P.te.x)<0?-1:1,p=(b?P.absoluteScaling.y:P.te.y)<0?-1:1,L=(b?P.absoluteScaling.z:P.te.z)<0?-1:1;a.x*=v,a.y*=p,a.z*=L}else this.determinant()<=0&&(a.y*=-1);if(0===a._x||0===a._y||0===a._z)return v&&v.qe(0,0,0,1),!1;if(v){const p=1/a._x,P=1/a._y,b=1/a._z;H.FromValuesToRef(L[0]*p,L[1]*p,L[2]*p,0,L[4]*P,L[5]*P,L[6]*P,0,L[8]*b,L[9]*b,L[10]*b,0,0,0,0,1,A.Matrix[0]),f.FromRotationMatrixToRef(A.Matrix[0],v)}return!0}getRow(a){if(a<0||a>3)return null;const v=4*a;return new c(this.$j[v+0],this.$j[v+1],this.$j[v+2],this.$j[v+3])}getRowToRef(a,v){if(a>=0&&a<=3){const p=4*a;v.x=this.$j[p+0],v.y=this.$j[p+1],v.z=this.$j[p+2],v.w=this.$j[p+3]}return v}setRow(a,v){return this.setRowFromFloats(a,v.x,v.y,v.z,v.w)}transpose(){const a=new H;return H.TransposeToRef(this,a),a}transposeToRef(a){return H.TransposeToRef(this,a),a}setRowFromFloats(a,v,p,P,b){if(a<0||a>3)return this;const L=4*a;return this.$j[L+0]=v,this.$j[L+1]=p,this.$j[L+2]=P,this.$j[L+3]=b,this.markAsUpdated(),this}scale(a){const v=new H;return this.scaleToRef(a,v),v}scaleToRef(a,v){for(let p=0;p<16;p++)v.$j[p]=this.$j[p]*a;return v.markAsUpdated(),v}scaleAndAddToRef(a,v){for(let p=0;p<16;p++)v.$j[p]+=this.$j[p]*a;return v.markAsUpdated(),v}scaleInPlace(a){const v=this.$j;for(let p=0;p<16;p++)v[p]*=a;return this.markAsUpdated(),this}toNormalMatrix(a){const v=A.Matrix[0];this.invertToRef(v),v.transposeToRef(a);const p=a.$j;return H.FromValuesToRef(p[0],p[1],p[2],0,p[4],p[5],p[6],0,p[8],p[9],p[10],0,0,0,0,1,a),a}getRotationMatrix(){const a=new H;return this.getRotationMatrixToRef(a),a}getRotationMatrixToRef(a){const v=A.fb[0];if(!this.decompose(v))return H.IdentityToRef(a),a;const p=this.$j,P=1/v._x,b=1/v._y,L=1/v._z;return H.FromValuesToRef(p[0]*P,p[1]*P,p[2]*P,0,p[4]*b,p[5]*b,p[6]*b,0,p[8]*L,p[9]*L,p[10]*L,0,0,0,0,1,a),a}toggleModelMatrixHandInPlace(){const a=this.$j;return a[2]*=-1,a[6]*=-1,a[8]*=-1,a[9]*=-1,a[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const a=this.$j;return a[8]*=-1,a[9]*=-1,a[10]*=-1,a[11]*=-1,this.markAsUpdated(),this}static bh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const p=new H;return H.FromArrayToRef(a,v,p),p}static FromArrayToRef(a,v,p){for(let P=0;P<16;P++)p.$j[P]=a[P+v];return p.markAsUpdated(),p}static FromFloat32ArrayToRefScaled(a,v,p,P){return P.$j[0]=a[0+v]*p,P.$j[1]=a[1+v]*p,P.$j[2]=a[2+v]*p,P.$j[3]=a[3+v]*p,P.$j[4]=a[4+v]*p,P.$j[5]=a[5+v]*p,P.$j[6]=a[6+v]*p,P.$j[7]=a[7+v]*p,P.$j[8]=a[8+v]*p,P.$j[9]=a[9+v]*p,P.$j[10]=a[10+v]*p,P.$j[11]=a[11+v]*p,P.$j[12]=a[12+v]*p,P.$j[13]=a[13+v]*p,P.$j[14]=a[14+v]*p,P.$j[15]=a[15+v]*p,P.markAsUpdated(),P}static get IdentityReadOnly(){return H._IdentityReadOnly}static FromValuesToRef(a,v,p,P,b,L,t,V,K,C,F,u,c,f,H,A,h){const R=h.$j;R[0]=a,R[1]=v,R[2]=p,R[3]=P,R[4]=b,R[5]=L,R[6]=t,R[7]=V,R[8]=K,R[9]=C,R[10]=F,R[11]=u,R[12]=c,R[13]=f,R[14]=H,R[15]=A,h.markAsUpdated()}static FromValues(a,v,p,P,b,L,t,V,K,C,F,u,c,f,A,h){const R=new H,X=R.$j;return X[0]=a,X[1]=v,X[2]=p,X[3]=P,X[4]=b,X[5]=L,X[6]=t,X[7]=V,X[8]=K,X[9]=C,X[10]=F,X[11]=u,X[12]=c,X[13]=f,X[14]=A,X[15]=h,R.markAsUpdated(),R}static Compose(a,v,p){const P=new H;return H.ComposeToRef(a,v,p,P),P}static ComposeToRef(a,v,p,P){const b=P.$j,L=v._x,t=v._y,V=v._z,K=v._w,C=L+L,F=t+t,u=V+V,c=L*C,f=L*F,H=L*u,A=t*F,h=t*u,R=V*u,X=K*C,Q=K*F,s=K*u,D=a._x,y=a._y,Z=a._z;return b[0]=(1-(A+R))*D,b[1]=(f+s)*D,b[2]=(H-Q)*D,b[3]=0,b[4]=(f-s)*y,b[5]=(1-(c+R))*y,b[6]=(h+X)*y,b[7]=0,b[8]=(H+Q)*Z,b[9]=(h-X)*Z,b[10]=(1-(c+A))*Z,b[11]=0,b[12]=p._x,b[13]=p._y,b[14]=p._z,b[15]=1,P.markAsUpdated(),P}static Identity(){const a=H.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return a._updateIdentityStatus(!0),a}static IdentityToRef(a){return H.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,a),a._updateIdentityStatus(!0),a}static Zero(){const a=H.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return a._updateIdentityStatus(!1),a}static RotationX(a){const v=new H;return H.RotationXToRef(a,v),v}static Invert(a){const v=new H;return a.invertToRef(v),v}static RotationXToRef(a,v){const p=Math.sin(a),P=Math.cos(a);return H.FromValuesToRef(1,0,0,0,0,P,p,0,0,-p,P,0,0,0,0,1,v),v._updateIdentityStatus(1===P&&0===p),v}static RotationY(a){const v=new H;return H.RotationYToRef(a,v),v}static RotationYToRef(a,v){const p=Math.sin(a),P=Math.cos(a);return H.FromValuesToRef(P,0,-p,0,0,1,0,0,p,0,P,0,0,0,0,1,v),v._updateIdentityStatus(1===P&&0===p),v}static RotationZ(a){const v=new H;return H.RotationZToRef(a,v),v}static RotationZToRef(a,v){const p=Math.sin(a),P=Math.cos(a);return H.FromValuesToRef(P,p,0,0,-p,P,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(1===P&&0===p),v}static RotationAxis(a,v){const p=new H;return H.RotationAxisToRef(a,v,p),p}static RotationAxisToRef(a,v,p){const P=Math.sin(-v),b=Math.cos(-v),L=1-b;a=a.normalizeToRef(A.fb[0]);const t=p.$j;return t[0]=a._x*a._x*L+b,t[1]=a._x*a._y*L-a._z*P,t[2]=a._x*a._z*L+a._y*P,t[3]=0,t[4]=a._y*a._x*L+a._z*P,t[5]=a._y*a._y*L+b,t[6]=a._y*a._z*L-a._x*P,t[7]=0,t[8]=a._z*a._x*L-a._y*P,t[9]=a._z*a._y*L+a._x*P,t[10]=a._z*a._z*L+b,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,p.markAsUpdated(),p}static RotationAlignToRef(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=u.Dot(v,a),t=p.$j;if(L<-1+P.e)t[0]=-1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=b?1:-1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=b?-1:1,t[11]=0;else{const p=u.Cross(v,a),P=1/(1+L);t[0]=p._x*p._x*P+L,t[1]=p._y*p._x*P-p._z,t[2]=p._z*p._x*P+p._y,t[3]=0,t[4]=p._x*p._y*P+p._z,t[5]=p._y*p._y*P+L,t[6]=p._z*p._y*P-p._x,t[7]=0,t[8]=p._x*p._z*P-p._y,t[9]=p._y*p._z*P+p._x,t[10]=p._z*p._z*P+L,t[11]=0}return t[12]=0,t[13]=0,t[14]=0,t[15]=1,p.markAsUpdated(),p}static RotationYawPitchRoll(a,v,p){const P=new H;return H.RotationYawPitchRollToRef(a,v,p,P),P}static RotationYawPitchRollToRef(a,v,p,P){return f.RotationYawPitchRollToRef(a,v,p,A.Quaternion[0]),A.Quaternion[0].toRotationMatrix(P),P}static Scaling(a,v,p){const P=new H;return H.ScalingToRef(a,v,p,P),P}static ScalingToRef(a,v,p,P){return H.FromValuesToRef(a,0,0,0,0,v,0,0,0,0,p,0,0,0,0,1,P),P._updateIdentityStatus(1===a&&1===v&&1===p),P}static Translation(a,v,p){const P=new H;return H.TranslationToRef(a,v,p,P),P}static TranslationToRef(a,v,p,P){return H.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,a,v,p,1,P),P._updateIdentityStatus(0===a&&0===v&&0===p),P}static Lerp(a,v,p){const P=new H;return H.LerpToRef(a,v,p,P),P}static LerpToRef(a,v,p,P){const b=P.$j,L=a.m,t=v.m;for(let V=0;V<16;V++)b[V]=L[V]*(1-p)+t[V]*p;return P.markAsUpdated(),P}static DecomposeLerp(a,v,p){const P=new H;return H.DecomposeLerpToRef(a,v,p,P),P}static DecomposeLerpToRef(a,v,p,P){const b=A.fb[0],L=A.Quaternion[0],t=A.fb[1];a.decompose(b,L,t);const V=A.fb[2],K=A.Quaternion[1],C=A.fb[3];v.decompose(V,K,C);const F=A.fb[4];u.LerpToRef(b,V,p,F);const c=A.Quaternion[2];f.SlerpToRef(L,K,p,c);const h=A.fb[5];return u.LerpToRef(t,C,p,h),H.ComposeToRef(F,c,h,P),P}static LookAtLH(a,v,p){const P=new H;return H.LookAtLHToRef(a,v,p,P),P}static LookAtLHToRef(a,v,p,P){const b=A.fb[0],L=A.fb[1],t=A.fb[2];v.subtractToRef(a,t),t.normalize(),u.CrossToRef(p,t,b);const V=b.lengthSquared();0===V?b.x=1:b.normalizeFromLength(Math.sqrt(V)),u.CrossToRef(t,b,L),L.normalize();const K=-u.Dot(b,a),C=-u.Dot(L,a),F=-u.Dot(t,a);return H.FromValuesToRef(b._x,L._x,t._x,0,b._y,L._y,t._y,0,b._z,L._z,t._z,0,K,C,F,1,P),P}static LookAtRH(a,v,p){const P=new H;return H.LookAtRHToRef(a,v,p,P),P}static LookAtRHToRef(a,v,p,P){const b=A.fb[0],L=A.fb[1],t=A.fb[2];a.subtractToRef(v,t),t.normalize(),u.CrossToRef(p,t,b);const V=b.lengthSquared();0===V?b.x=1:b.normalizeFromLength(Math.sqrt(V)),u.CrossToRef(t,b,L),L.normalize();const K=-u.Dot(b,a),C=-u.Dot(L,a),F=-u.Dot(t,a);return H.FromValuesToRef(b._x,L._x,t._x,0,b._y,L._y,t._y,0,b._z,L._z,t._z,0,K,C,F,1,P),P}static LookDirectionLH(a,v){const p=new H;return H.LookDirectionLHToRef(a,v,p),p}static LookDirectionLHToRef(a,v,p){const P=A.fb[0];P.p(a),P.scaleInPlace(-1);const b=A.fb[1];return u.CrossToRef(v,P,b),H.FromValuesToRef(b._x,b._y,b._z,0,v._x,v._y,v._z,0,P._x,P._y,P._z,0,0,0,0,1,p),p}static LookDirectionRH(a,v){const p=new H;return H.LookDirectionRHToRef(a,v,p),p}static LookDirectionRHToRef(a,v,p){const P=A.fb[2];return u.CrossToRef(v,a,P),H.FromValuesToRef(P._x,P._y,P._z,0,v._x,v._y,v._z,0,a._x,a._y,a._z,0,0,0,0,1,p),p}static OrthoLH(a,v,p,P,b){const L=new H;return H.OrthoLHToRef(a,v,p,P,L,b),L}static OrthoLHToRef(a,v,p,P,b,L){const t=2/a,V=2/v,K=2/(P-p),C=-(P+p)/(P-p);return H.FromValuesToRef(t,0,0,0,0,V,0,0,0,0,K,0,0,0,C,1,b),L&&b.multiplyToRef(R,b),b._updateIdentityStatus(1===t&&1===V&&1===K&&0===C),b}static OrthoOffCenterLH(a,v,p,P,b,L,t){const V=new H;return H.OrthoOffCenterLHToRef(a,v,p,P,b,L,V,t),V}static OrthoOffCenterLHToRef(a,v,p,P,b,L,t,V){const K=2/(v-a),C=2/(P-p),F=2/(L-b),u=-(L+b)/(L-b),c=(a+v)/(a-v),f=(P+p)/(p-P);return H.FromValuesToRef(K,0,0,0,0,C,0,0,0,0,F,0,c,f,u,1,t),V&&t.multiplyToRef(R,t),t.markAsUpdated(),t}static ObliqueOffCenterLHToRef(a,v,p,P,b,L,t,V,K,C,F){const u=-t*Math.cos(V),c=-t*Math.sin(V);return H.TranslationToRef(0,0,-K,A.Matrix[1]),H.FromValuesToRef(1,0,0,0,0,1,0,0,u,c,1,0,0,0,0,1,A.Matrix[0]),A.Matrix[1].multiplyToRef(A.Matrix[0],A.Matrix[0]),H.TranslationToRef(0,0,K,A.Matrix[1]),A.Matrix[0].multiplyToRef(A.Matrix[1],A.Matrix[0]),H.OrthoOffCenterLHToRef(a,v,p,P,b,L,C,F),A.Matrix[0].multiplyToRef(C,C),C}static OrthoOffCenterRH(a,v,p,P,b,L,t){const V=new H;return H.OrthoOffCenterRHToRef(a,v,p,P,b,L,V,t),V}static OrthoOffCenterRHToRef(a,v,p,P,b,L,t,V){return H.OrthoOffCenterLHToRef(a,v,p,P,b,L,t,V),t.$j[10]*=-1,t}static ObliqueOffCenterRHToRef(a,v,p,P,b,L,t,V,K,C,F){const u=t*Math.cos(V),c=t*Math.sin(V);return H.TranslationToRef(0,0,K,A.Matrix[1]),H.FromValuesToRef(1,0,0,0,0,1,0,0,u,c,1,0,0,0,0,1,A.Matrix[0]),A.Matrix[1].multiplyToRef(A.Matrix[0],A.Matrix[0]),H.TranslationToRef(0,0,-K,A.Matrix[1]),A.Matrix[0].multiplyToRef(A.Matrix[1],A.Matrix[0]),H.OrthoOffCenterRHToRef(a,v,p,P,b,L,C,F),A.Matrix[0].multiplyToRef(C,C),C}static PerspectiveLH(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const t=new H,V=2*p/a,K=2*p/v,C=(P+p)/(P-p),F=-2*P*p/(P-p),u=Math.tan(L);return H.FromValuesToRef(V,0,0,0,0,K,0,u,0,0,C,1,0,0,F,0,t),b&&t.multiplyToRef(R,t),t._updateIdentityStatus(!1),t}static PerspectiveFovLH(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const V=new H;return H.PerspectiveFovLHToRef(a,v,p,P,V,!0,b,L,t),V}static PerspectiveFovLHToRef(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const C=p,F=P,u=1/Math.tan(.5*a),c=L?u/v:u,f=L?u:u*v,A=K&&0===C?-1:0!==F?(F+C)/(F-C):1,h=K&&0===C?2*F:0!==F?-2*F*C/(F-C):-2*C,X=Math.tan(V);return H.FromValuesToRef(c,0,0,0,0,f,0,X,0,0,A,1,0,0,h,0,b),t&&b.multiplyToRef(R,b),b._updateIdentityStatus(!1),b}static PerspectiveFovReverseLHToRef(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const K=1/Math.tan(.5*a),C=L?K/v:K,F=L?K:K*v,u=Math.tan(V);return H.FromValuesToRef(C,0,0,0,0,F,0,u,0,0,-p,1,0,0,1,0,b),t&&b.multiplyToRef(R,b),b._updateIdentityStatus(!1),b}static PerspectiveFovRH(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const V=new H;return H.PerspectiveFovRHToRef(a,v,p,P,V,!0,b,L,t),V}static PerspectiveFovRHToRef(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const C=p,F=P,u=1/Math.tan(.5*a),c=L?u/v:u,f=L?u:u*v,A=K&&0===C?1:0!==F?-(F+C)/(F-C):-1,h=K&&0===C?2*F:0!==F?-2*F*C/(F-C):-2*C,X=Math.tan(V);return H.FromValuesToRef(c,0,0,0,0,f,0,X,0,0,A,-1,0,0,h,0,b),t&&b.multiplyToRef(R,b),b._updateIdentityStatus(!1),b}static PerspectiveFovReverseRHToRef(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const K=1/Math.tan(.5*a),C=L?K/v:K,F=L?K:K*v,u=Math.tan(V);return H.FromValuesToRef(C,0,0,0,0,F,0,u,0,0,-p,-1,0,0,-1,0,b),t&&b.multiplyToRef(R,b),b._updateIdentityStatus(!1),b}static GetFinalMatrix(a,v,p,P,b,L){const t=a.width,V=a.height,K=a.x,C=a.y,F=H.FromValues(t/2,0,0,0,0,-V/2,0,0,0,0,L-b,0,K+t/2,V/2+C,b,1),u=new H;return v.multiplyToRef(p,u),u.multiplyToRef(P,u),u.multiplyToRef(F,u)}static GetAsMatrix2x2(a){const v=a.m,p=[v[0],v[1],v[4],v[5]];return t.c.MatrixUse64Bits?p:new Float32Array(p)}static GetAsMatrix3x3(a){const v=a.m,p=[v[0],v[1],v[2],v[4],v[5],v[6],v[8],v[9],v[10]];return t.c.MatrixUse64Bits?p:new Float32Array(p)}static Transpose(a){const v=new H;return H.TransposeToRef(a,v),v}static TransposeToRef(a,v){const p=a.m,P=p[0],b=p[4],L=p[8],t=p[12],V=p[1],K=p[5],C=p[9],F=p[13],u=p[2],c=p[6],f=p[10],H=p[14],A=p[3],h=p[7],R=p[11],X=p[15],Q=v.$j;return Q[0]=P,Q[1]=b,Q[2]=L,Q[3]=t,Q[4]=V,Q[5]=K,Q[6]=C,Q[7]=F,Q[8]=u,Q[9]=c,Q[10]=f,Q[11]=H,Q[12]=A,Q[13]=h,Q[14]=R,Q[15]=X,v.markAsUpdated(),v._updateIdentityStatus(a._isIdentity,a._isIdentityDirty),v}static Reflection(a){const v=new H;return H.ReflectionToRef(a,v),v}static ReflectionToRef(a,v){a.normalize();const p=a.k.x,P=a.k.y,b=a.k.z,L=-2*p,t=-2*P,V=-2*b;return H.FromValuesToRef(L*p+1,t*p,V*p,0,L*P,t*P+1,V*P,0,L*b,t*b,V*b+1,0,L*a.d,t*a.d,V*a.d,1,v),v}static FromXYZAxesToRef(a,v,p,P){return H.FromValuesToRef(a._x,a._y,a._z,0,v._x,v._y,v._z,0,p._x,p._y,p._z,0,0,0,0,1,P),P}static FromQuaternionToRef(a,v){const p=a._x*a._x,P=a._y*a._y,b=a._z*a._z,L=a._x*a._y,t=a._z*a._w,V=a._z*a._x,K=a._y*a._w,C=a._y*a._z,F=a._x*a._w;return v.$j[0]=1-2*(P+b),v.$j[1]=2*(L+t),v.$j[2]=2*(V-K),v.$j[3]=0,v.$j[4]=2*(L-t),v.$j[5]=1-2*(b+p),v.$j[6]=2*(C+F),v.$j[7]=0,v.$j[8]=2*(V+K),v.$j[9]=2*(C-F),v.$j[10]=1-2*(P+p),v.$j[11]=0,v.$j[12]=0,v.$j[13]=0,v.$j[14]=0,v.$j[15]=1,v.markAsUpdated(),v}}H._UpdateFlagSeed=0,H._IdentityReadOnly=H.Identity(),Object.defineProperties(H.prototype,{dimension:{value:[4,4]},rank:{value:2}});class A{}A.fb=(0,b.f)(11,u.Zero),A.Matrix=(0,b.f)(2,H.Identity),A.Quaternion=(0,b.f)(3,f.Zero);class h{}h.Vector2=(0,b.f)(3,F.Zero),h.fb=(0,b.f)(13,u.Zero),h.Vector4=(0,b.f)(3,c.Zero),h.Quaternion=(0,b.f)(3,f.Zero),h.Matrix=(0,b.f)(8,H.Identity),(0,L.f)("BABYLON.Vector2",F),(0,L.f)("BABYLON.Vector3",u),(0,L.f)("BABYLON.Vector4",c),(0,L.f)("BABYLON.Matrix",H);const R=H.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11521:(a,v,p)=>{"use strict";p.d(v,{c:()=>P});class P{constructor(a,v,p,P){this.x=a,this.y=v,this.width=p,this.height=P}toGlobal(a,v){return new P(this.x*a,this.y*v,this.width*a,this.height*v)}toGlobalToRef(a,v,p){return p.x=this.x*a,p.y=this.y*v,p.width=this.width*a,p.height=this.height*v,this}clone(){return new P(this.x,this.y,this.width,this.height)}}},11714:(a,v,p)=>{"use strict";p.d(v,{d:()=>C,f:()=>F});var P=p(11240),b=p(11720);const L=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],t=[()=>1,a=>a.y,a=>a.z,a=>a.x,a=>a.x*a.y,a=>a.y*a.z,a=>3*a.z*a.z-1,a=>a.x*a.z,a=>a.x*a.x-a.y*a.y],V=(a,v)=>L[a]*t[a](v),K=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class C{constructor(){this.preScaled=!1,this.l00=P.s.Zero(),this.l1_1=P.s.Zero(),this.l10=P.s.Zero(),this.l11=P.s.Zero(),this.l2_2=P.s.Zero(),this.l2_1=P.s.Zero(),this.l20=P.s.Zero(),this.l21=P.s.Zero(),this.l22=P.s.Zero()}addLight(a,v,p){b.c.fb[0].set(v.r,v.g,v.b);const P=b.c.fb[0],L=b.c.fb[1];P.scaleToRef(p,L),L.scaleToRef(V(0,a),b.c.fb[2]),this.l00.addInPlace(b.c.fb[2]),L.scaleToRef(V(1,a),b.c.fb[2]),this.l1_1.addInPlace(b.c.fb[2]),L.scaleToRef(V(2,a),b.c.fb[2]),this.l10.addInPlace(b.c.fb[2]),L.scaleToRef(V(3,a),b.c.fb[2]),this.l11.addInPlace(b.c.fb[2]),L.scaleToRef(V(4,a),b.c.fb[2]),this.l2_2.addInPlace(b.c.fb[2]),L.scaleToRef(V(5,a),b.c.fb[2]),this.l2_1.addInPlace(b.c.fb[2]),L.scaleToRef(V(6,a),b.c.fb[2]),this.l20.addInPlace(b.c.fb[2]),L.scaleToRef(V(7,a),b.c.fb[2]),this.l21.addInPlace(b.c.fb[2]),L.scaleToRef(V(8,a),b.c.fb[2]),this.l22.addInPlace(b.c.fb[2])}scaleInPlace(a){this.l00.scaleInPlace(a),this.l1_1.scaleInPlace(a),this.l10.scaleInPlace(a),this.l11.scaleInPlace(a),this.l2_2.scaleInPlace(a),this.l2_1.scaleInPlace(a),this.l20.scaleInPlace(a),this.l21.scaleInPlace(a),this.l22.scaleInPlace(a)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(K[0]),this.l1_1.scaleInPlace(K[1]),this.l10.scaleInPlace(K[2]),this.l11.scaleInPlace(K[3]),this.l2_2.scaleInPlace(K[4]),this.l2_1.scaleInPlace(K[5]),this.l20.scaleInPlace(K[6]),this.l21.scaleInPlace(K[7]),this.l22.scaleInPlace(K[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(L[0]),this.l1_1.scaleInPlace(L[1]),this.l10.scaleInPlace(L[2]),this.l11.scaleInPlace(L[3]),this.l2_2.scaleInPlace(L[4]),this.l2_1.scaleInPlace(L[5]),this.l20.scaleInPlace(L[6]),this.l21.scaleInPlace(L[7]),this.l22.scaleInPlace(L[8])}updateFromArray(a){return P.s.FromArrayToRef(a[0],0,this.l00),P.s.FromArrayToRef(a[1],0,this.l1_1),P.s.FromArrayToRef(a[2],0,this.l10),P.s.FromArrayToRef(a[3],0,this.l11),P.s.FromArrayToRef(a[4],0,this.l2_2),P.s.FromArrayToRef(a[5],0,this.l2_1),P.s.FromArrayToRef(a[6],0,this.l20),P.s.FromArrayToRef(a[7],0,this.l21),P.s.FromArrayToRef(a[8],0,this.l22),this}updateFromFloatsArray(a){return P.s.FromFloatsToRef(a[0],a[1],a[2],this.l00),P.s.FromFloatsToRef(a[3],a[4],a[5],this.l1_1),P.s.FromFloatsToRef(a[6],a[7],a[8],this.l10),P.s.FromFloatsToRef(a[9],a[10],a[11],this.l11),P.s.FromFloatsToRef(a[12],a[13],a[14],this.l2_2),P.s.FromFloatsToRef(a[15],a[16],a[17],this.l2_1),P.s.FromFloatsToRef(a[18],a[19],a[20],this.l20),P.s.FromFloatsToRef(a[21],a[22],a[23],this.l21),P.s.FromFloatsToRef(a[24],a[25],a[26],this.l22),this}static bh(a){return(new C).updateFromArray(a)}static FromPolynomial(a){const v=new C;return v.l00=a.xx.scale(.376127).add(a.yy.scale(.376127)).add(a.zz.scale(.376126)),v.l1_1=a.y.scale(.977204),v.l10=a.z.scale(.977204),v.l11=a.x.scale(.977204),v.l2_2=a.xy.scale(1.16538),v.l2_1=a.yz.scale(1.16538),v.l20=a.zz.scale(1.34567).od(a.xx.scale(.672834)).od(a.yy.scale(.672834)),v.l21=a.zx.scale(1.16538),v.l22=a.xx.scale(1.16538).od(a.yy.scale(1.16538)),v.l1_1.scaleInPlace(-1),v.l11.scaleInPlace(-1),v.l2_1.scaleInPlace(-1),v.l21.scaleInPlace(-1),v.scaleInPlace(Math.PI),v}}class F{constructor(){this.x=P.s.Zero(),this.y=P.s.Zero(),this.z=P.s.Zero(),this.xx=P.s.Zero(),this.yy=P.s.Zero(),this.zz=P.s.Zero(),this.xy=P.s.Zero(),this.yz=P.s.Zero(),this.zx=P.s.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=C.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(a){b.c.fb[0].qe(a.r,a.g,a.b);const v=b.c.fb[0];this.xx.addInPlace(v),this.yy.addInPlace(v),this.zz.addInPlace(v)}scaleInPlace(a){this.x.scaleInPlace(a),this.y.scaleInPlace(a),this.z.scaleInPlace(a),this.xx.scaleInPlace(a),this.yy.scaleInPlace(a),this.zz.scaleInPlace(a),this.yz.scaleInPlace(a),this.zx.scaleInPlace(a),this.xy.scaleInPlace(a)}updateFromHarmonics(a){return this._harmonics=a,this.x.p(a.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(a.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(a.l10),this.z.scaleInPlace(1.02333),this.xx.p(a.l00),b.c.fb[0].p(a.l20).scaleInPlace(.247708),b.c.fb[1].p(a.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Bi(b.c.fb[0]).addInPlace(b.c.fb[1]),this.yy.p(a.l00),this.yy.scaleInPlace(.886277).Bi(b.c.fb[0]).Bi(b.c.fb[1]),this.zz.p(a.l00),b.c.fb[0].p(a.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(b.c.fb[0]),this.yz.p(a.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(a.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(a.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(a){return(new F).updateFromHarmonics(a)}static bh(a){const v=new F;return P.s.FromArrayToRef(a[0],0,v.x),P.s.FromArrayToRef(a[1],0,v.y),P.s.FromArrayToRef(a[2],0,v.z),P.s.FromArrayToRef(a[3],0,v.xx),P.s.FromArrayToRef(a[4],0,v.yy),P.s.FromArrayToRef(a[5],0,v.zz),P.s.FromArrayToRef(a[6],0,v.yz),P.s.FromArrayToRef(a[7],0,v.zx),P.s.FromArrayToRef(a[8],0,v.xy),v}}},11560:(a,v,p)=>{"use strict";p.d(v,{e:()=>C});var P=p(11240),b=p(11279),L=p(11504),t=p(11528),V=p(11470);p(11568);function K(a){let v=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const p=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let K=[];const C=a.width||a.size||1,F=a.height||a.size||1,u=a.depth||a.size||1,c=a.wrap||!1;let f=void 0===a.topBaseAt?1:a.topBaseAt,H=void 0===a.bottomBaseAt?0:a.bottomBaseAt;f=(f+4)%4,H=(H+4)%4;let A=[2,0,3,1][f],h=[2,0,1,3][H],R=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){v=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],R=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let a=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],p=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const P=[17,18,19,16],b=[22,23,20,21];for(;A>0;)a.unshift(a.pop()),P.unshift(P.pop()),A--;for(;h>0;)p.unshift(p.pop()),b.unshift(b.pop()),h--;a=a.flat(),p=p.flat(),R=R.concat(a).concat(p),v.push(P[0],P[2],P[3],P[0],P[1],P[2]),v.push(b[0],b[2],b[3],b[0],b[1],b[2])}const X=[C/2,F/2,u/2];K=R.reduce(((a,v,p)=>a.concat(v*X[p%3])),[]);const Q=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,s=a.faceUV||new Array(6),D=a.faceColors,y=[];for(let t=0;t<6;t++)void 0===s[t]&&(s[t]=new P.t(0,0,1,1)),D&&void 0===D[t]&&(D[t]=new b.e(1,1,1,1));for(let P=0;P<6;P++)if(L.push(s[P].z,V.b?1-s[P].w:s[P].w),L.push(s[P].x,V.b?1-s[P].w:s[P].w),L.push(s[P].x,V.b?1-s[P].y:s[P].y),L.push(s[P].z,V.b?1-s[P].y:s[P].y),D)for(let a=0;a<4;a++)y.push(D[P].r,D[P].g,D[P].b,D[P].a);t.e._ComputeSides(Q,K,v,p,L,a.frontUVs,a.backUVs);const Z=new t.e;if(Z.indices=v,Z.xa=K,Z.ya=p,Z.Aa=L,D){const a=Q===t.e.DOUBLESIDE?y.concat(y):y;Z.za=a}return Z}function C(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new L.b(a,p);v.sideOrientation=L.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return K(v).Ca(P,v.updatable),P}t.e.CreateBox=K,L.b.CreateBox=function(a,v){return C(a,{size:v,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11839:(a,v,p)=>{"use strict";p.d(v,{d:()=>V});var P=p(11504),b=p(11528),L=p(11470);function t(a){const v=[],p=[],P=[],t=[],V=a.radius||.5,K=a.tessellation||64,C=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,F=0===a.sideOrientation?0:a.sideOrientation||b.e.DEFAULTSIDE;v.push(0,0,0),t.push(.5,.5);const u=2*Math.PI*C,c=1===C?u/K:u/(K-1);let f=0;for(let b=0;b<K;b++){const a=Math.cos(f),p=Math.sin(f),P=(a+1)/2,b=(1-p)/2;v.push(V*a,V*p,0),t.push(P,L.b?1-b:b),f+=c}1===C&&(v.push(v[3],v[4],v[5]),t.push(t[2],L.b?1-t[3]:t[3]));const H=v.length/3;for(let b=1;b<H-1;b++)p.push(b+1,0,b);b.e.ComputeNormals(v,p,P),b.e._ComputeSides(F,v,p,P,t,a.frontUVs,a.backUVs);const A=new b.e;return A.indices=p,A.xa=v,A.ya=P,A.Aa=t,A}function V(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new P.b(a,p);v.sideOrientation=P.b._GetDefaultSideOrientation(v.sideOrientation),b._originalBuilderSideOrientation=v.sideOrientation;return t(v).Ca(b,v.updatable),b}b.e.CreateDisc=t,P.b.CreateDisc=function(a,v,p){return V(a,{radius:v,tessellation:p,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11568:(a,v,p)=>{"use strict";p.d(v,{g:()=>h,c:()=>X,i:()=>R});var P=p(11240),b=p(11279),L=p(11504),t=p(11528),V=p(11306);L.b._GroundMeshParser=(a,v)=>K.Parse(a,v);class K extends L.b{constructor(a,v){super(a,v),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=a,this._subdivisionsY=a,this.subdivide(a);const p=this;p.createOrUpdateSubmeshesOctree&&p.createOrUpdateSubmeshesOctree(v)}getHeightAtCoordinates(a,v){const p=this.getWorldMatrix(),b=P.k.Matrix[5];p.invertToRef(b);const L=P.k.fb[8];if(P.s.TransformCoordinatesFromFloatsToRef(a,0,v,b,L),a=L.x,v=L.z,a<this._minX||a>=this._maxX||v<=this._minZ||v>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const t=this._getFacetAt(a,v),V=-(t.x*a+t.z*v+t.w)/t.y;return P.s.TransformCoordinatesFromFloatsToRef(0,V,0,p,L),L.y}getNormalAtCoordinates(a,v){const p=new P.s(0,1,0);return this.getNormalAtCoordinatesToRef(a,v,p),p}getNormalAtCoordinatesToRef(a,v,p){const b=this.getWorldMatrix(),L=P.k.Matrix[5];b.invertToRef(L);const t=P.k.fb[8];if(P.s.TransformCoordinatesFromFloatsToRef(a,0,v,L,t),a=t.x,v=t.z,a<this._minX||a>this._maxX||v<this._minZ||v>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const V=this._getFacetAt(a,v);return P.s.TransformNormalFromFloatsToRef(V.x,V.y,V.z,b,p),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(a,v){const p=Math.floor((a+this._maxX)*this._subdivisionsX/this._width),P=Math.floor(-(v+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),b=this._heightQuads[P*this._subdivisionsX+p];let L;return L=v<b.slope.x*a+b.slope.y?b.facet1:b.facet2,L}_initHeightQuads(){const a=this._subdivisionsX,v=this._subdivisionsY;this._heightQuads=new Array;for(let p=0;p<v;p++)for(let v=0;v<a;v++){const b={slope:P.o.Zero(),facet1:new P.t(0,0,0,0),facet2:new P.t(0,0,0,0)};this._heightQuads[p*a+v]=b}return this}_computeHeightQuads(){const a=this.getVerticesData(V.f.PositionKind);if(!a)return this;const v=P.k.fb[3],p=P.k.fb[2],b=P.k.fb[1],L=P.k.fb[0],t=P.k.fb[4],K=P.k.fb[5],C=P.k.fb[6],F=P.k.fb[7],u=P.k.fb[8];let c=0,f=0,H=0,A=0,h=0,R=0,X=0;const Q=this._subdivisionsX,s=this._subdivisionsY;for(let V=0;V<s;V++)for(let s=0;s<Q;s++){c=3*s,f=V*(Q+1)*3,H=(V+1)*(Q+1)*3,v.x=a[f+c],v.y=a[f+c+1],v.z=a[f+c+2],p.x=a[f+c+3],p.y=a[f+c+4],p.z=a[f+c+5],b.x=a[H+c],b.y=a[H+c+1],b.z=a[H+c+2],L.x=a[H+c+3],L.y=a[H+c+4],L.z=a[H+c+5],A=(L.z-v.z)/(L.x-v.x),h=v.z-A*v.x,p.subtractToRef(v,t),b.subtractToRef(v,K),L.subtractToRef(v,C),P.s.CrossToRef(C,K,F),P.s.CrossToRef(t,C,u),F.normalize(),u.normalize(),R=-(F.x*v.x+F.y*v.y+F.z*v.z),X=-(u.x*p.x+u.y*p.y+u.z*p.z);const D=this._heightQuads[V*Q+s];D.slope.qe(A,h),D.facet1.qe(F.x,F.y,F.z,R),D.facet2.qe(u.x,u.y,u.z,X)}return this}serialize(a){super.serialize(a),a.subdivisionsX=this._subdivisionsX,a.subdivisionsY=this._subdivisionsY,a.minX=this._minX,a.maxX=this._maxX,a.fj=this._minZ,a.maxZ=this._maxZ,a.width=this._width,a.height=this._height}static Parse(a,v){const p=new K(a.name,v);return p._subdivisionsX=a.subdivisionsX||1,p._subdivisionsY=a.subdivisionsY||1,p._minX=a.minX,p._maxX=a.maxX,p._minZ=a.fj,p._maxZ=a.maxZ,p._width=a.width,p._height=a.height,p}}var C=p(10889),F=p(10939),u=p(11245),c=p(11470);function f(a){const v=[],p=[],b=[],L=[];let V,K;const C=a.width||a.size||1,F=a.height||a.size||1,u=0|(a.subdivisionsX||a.subdivisions||1),f=0|(a.subdivisionsY||a.subdivisions||1);for(V=0;V<=f;V++)for(K=0;K<=u;K++){const a=new P.s(K*C/u-C/2,0,(f-V)*F/f-F/2),v=new P.s(0,1,0);p.push(a.x,a.y,a.z),b.push(v.x,v.y,v.z),L.push(K/u,c.b?V/f:1-V/f)}for(V=0;V<f;V++)for(K=0;K<u;K++)v.push(K+1+(V+1)*(u+1)),v.push(K+1+V*(u+1)),v.push(K+V*(u+1)),v.push(K+(V+1)*(u+1)),v.push(K+1+(V+1)*(u+1)),v.push(K+V*(u+1));const H=new t.e;return H.indices=v,H.xa=p,H.ya=b,H.Aa=L,H}function H(a){const v=void 0!==a.xmin&&null!==a.xmin?a.xmin:-1,p=void 0!==a.zmin&&null!==a.zmin?a.zmin:-1,b=void 0!==a.xmax&&null!==a.xmax?a.xmax:1,L=void 0!==a.zmax&&null!==a.zmax?a.zmax:1,V=a.subdivisions||{w:1,h:1},K=a.precision||{w:1,h:1},C=[],F=[],u=[],c=[];let f,H,A,h;V.h=V.h<1?1:V.h,V.w=V.w<1?1:V.w,K.w=K.w<1?1:K.w,K.h=K.h<1?1:K.h;const R=(b-v)/V.w,X=(L-p)/V.h;function Q(a,v,p,b){const L=F.length/3,t=K.w+1;for(f=0;f<K.h;f++)for(H=0;H<K.w;H++){const a=[L+H+f*t,L+(H+1)+f*t,L+(H+1)+(f+1)*t,L+H+(f+1)*t];C.push(a[1]),C.push(a[2]),C.push(a[3]),C.push(a[0]),C.push(a[1]),C.push(a[3])}const V=P.s.Zero(),A=new P.s(0,1,0);for(f=0;f<=K.h;f++)for(V.z=f*(b-v)/K.h+v,H=0;H<=K.w;H++)V.x=H*(p-a)/K.w+a,V.y=0,F.push(V.x,V.y,V.z),u.push(A.x,A.y,A.z),c.push(H/K.w,f/K.h)}for(A=0;A<V.h;A++)for(h=0;h<V.w;h++)Q(v+h*R,p+A*X,v+(h+1)*R,p+(A+1)*X);const s=new t.e;return s.indices=C,s.xa=F,s.ya=u,s.Aa=c,s}function A(a){const v=[],p=[],L=[],V=[];let K,C;const F=a.colorFilter||new b.d(.3,.59,.11),c=a.alphaFilter||0;let f=!1;if(a.minHeight>a.maxHeight){f=!0;const v=a.maxHeight;a.maxHeight=a.minHeight,a.minHeight=v}for(K=0;K<=a.subdivisions;K++)for(C=0;C<=a.subdivisions;C++){const v=new P.s(C*a.width/a.subdivisions-a.width/2,0,(a.subdivisions-K)*a.height/a.subdivisions-a.height/2),b=4*(((v.x+a.width/2)/a.width*(a.bufferWidth-1)|0)+((1-(v.z+a.height/2)/a.height)*(a.bufferHeight-1)|0)*a.bufferWidth);let t=a.buffer[b]/255,H=a.buffer[b+1]/255,A=a.buffer[b+2]/255;const h=a.buffer[b+3]/255;f&&(t=1-t,H=1-H,A=1-A);const R=t*F.r+H*F.g+A*F.b;v.y=h>=c?a.minHeight+(a.maxHeight-a.minHeight)*R:a.minHeight-u.e,a.heightBuffer&&(a.heightBuffer[K*(a.subdivisions+1)+C]=v.y),p.push(v.x,v.y,v.z),L.push(0,0,0),V.push(C/a.subdivisions,1-K/a.subdivisions)}for(K=0;K<a.subdivisions;K++)for(C=0;C<a.subdivisions;C++){const P=C+1+(K+1)*(a.subdivisions+1),b=C+1+K*(a.subdivisions+1),L=C+K*(a.subdivisions+1),t=C+(K+1)*(a.subdivisions+1),V=p[3*P+1]>=a.minHeight,F=p[3*b+1]>=a.minHeight,u=p[3*L+1]>=a.minHeight;V&&F&&u&&(v.push(P),v.push(b),v.push(L));p[3*t+1]>=a.minHeight&&V&&u&&(v.push(t),v.push(P),v.push(L))}t.e.ComputeNormals(p,v,L);const H=new t.e;return H.indices=v,H.xa=p,H.ya=L,H.Aa=V,H}function h(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const p=new K(a,arguments.length>2?arguments[2]:void 0);p._setReady(!1),p._subdivisionsX=v.subdivisionsX||v.subdivisions||1,p._subdivisionsY=v.subdivisionsY||v.subdivisions||1,p._width=v.width||1,p._height=v.height||1,p._maxX=p._width/2,p._maxZ=p._height/2,p._minX=-p._maxX,p._minZ=-p._maxZ;return f(v).Ca(p,v.updatable),p._setReady(!0),p}function R(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new L.b(a,p);return H(v).Ca(P,v.updatable),P}function X(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=p.width||10,t=p.height||10,V=p.subdivisions||1,u=p.minHeight||0,c=p.maxHeight||1,f=p.colorFilter||new b.d(.3,.59,.11),H=p.alphaFilter||0,h=p.updatable,R=p.onReady;P=P||F.b.LastCreatedScene;const X=new K(a,P);let Q;X._subdivisionsX=V,X._subdivisionsY=V,X._width=L,X._height=t,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ,X._setReady(!1),p.passHeightBufferInCallback&&(Q=new Float32Array((V+1)*(V+1)));const s=(a,v,p)=>{A({width:L,height:t,subdivisions:V,minHeight:u,maxHeight:c,colorFilter:f,buffer:a,bufferWidth:v,bufferHeight:p,alphaFilter:H,heightBuffer:Q}).Ca(X,h),R&&R(X,Q),X._setReady(!0)};if("string"===typeof v){const a=a=>{var v;const p=a.width,b=a.height;if(P.u)return;const L=null===(v=P)||void 0===v?void 0:v.getEngine().resizeImageBitmap(a,p,b);s(L,p,b)};C.e.LoadImage(v,a,p.onError?p.onError:()=>{},P.offlineProvider)}else s(v.data,v.width,v.height);return X}t.e.CreateGround=f,t.e.CreateTiledGround=H,t.e.CreateGroundFromHeightMap=A,L.b.CreateGround=(a,v,p,P,b,L)=>h(a,{width:v,height:p,subdivisions:P,updatable:L},b),L.b.CreateTiledGround=(a,v,p,P,b,L,t,V,K)=>R(a,{xmin:v,zmin:p,xmax:P,zmax:b,subdivisions:L,precision:t,updatable:K},V),L.b.CreateGroundFromHeightMap=(a,v,p,P,b,L,t,V,K,C,F)=>X(a,v,{width:p,height:P,subdivisions:b,minHeight:L,maxHeight:t,updatable:K,onReady:C,alphaFilter:F},V)},12867:(a,v,p)=>{"use strict";p.d(v,{b:()=>j,f:()=>q,g:()=>T});var P=p(11240),b=p(11504),L=p(11528),t=p(11279),V=p(11306),K=p(12450),C=p(11390),F=p(11287),u=p(11229),c=p(11460),f=p(11027),H=p(11481),A=p(10933),h=p(11456),R=p(10939),X=p(11448),Q=p(11440);const s={effect:null,subMesh:null};class D extends h.c{constructor(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(a,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new P.e,this._cachedWorldViewProjectionMatrix=new P.e,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=p,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...b}}get shaderPath(){return this._shaderPath}set shaderPath(a){this._shaderPath=a}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(a){-1===this._options.uniforms.indexOf(a)&&this._options.uniforms.push(a)}setTexture(a,v){return-1===this._options.samplers.indexOf(a)&&this._options.samplers.push(a),this._textures[a]=v,this}removeTexture(a){delete this._textures[a]}setTextureArray(a,v){return-1===this._options.samplers.indexOf(a)&&this._options.samplers.push(a),this._checkUniform(a),this._textureArrays[a]=v,this}setExternalTexture(a,v){return-1===this._options.externalTextures.indexOf(a)&&this._options.externalTextures.push(a),this._externalTextures[a]=v,this}setFloat(a,v){return this._checkUniform(a),this._floats[a]=v,this}setInt(a,v){return this._checkUniform(a),this._ints[a]=v,this}setUInt(a,v){return this._checkUniform(a),this._uints[a]=v,this}setFloats(a,v){return this._checkUniform(a),this._floatsArrays[a]=v,this}setColor3(a,v){return this._checkUniform(a),this._colors3[a]=v,this}setColor3Array(a,v){return this._checkUniform(a),this._colors3Arrays[a]=v.reduce(((a,v)=>(v.toArray(a,a.length),a)),[]),this}setColor4(a,v){return this._checkUniform(a),this._colors4[a]=v,this}setColor4Array(a,v){return this._checkUniform(a),this._colors4Arrays[a]=v.reduce(((a,v)=>(v.toArray(a,a.length),a)),[]),this}setVector2(a,v){return this._checkUniform(a),this._vectors2[a]=v,this}setVector3(a,v){return this._checkUniform(a),this._vectors3[a]=v,this}setVector4(a,v){return this._checkUniform(a),this._vectors4[a]=v,this}setQuaternion(a,v){return this._checkUniform(a),this._quaternions[a]=v,this}setQuaternionArray(a,v){return this._checkUniform(a),this._quaternionsArrays[a]=v.reduce(((a,v)=>(v.toArray(a,a.length),a)),[]),this}setMatrix(a,v){return this._checkUniform(a),this._matrices[a]=v,this}setMatrices(a,v){this._checkUniform(a);const p=new Float32Array(16*v.length);for(let P=0;P<v.length;P++){v[P].copyToArray(p,16*P)}return this._matrixArrays[a]=p,this}setMatrix3x3(a,v){return this._checkUniform(a),this._matrices3x3[a]=v,this}setMatrix2x2(a,v){return this._checkUniform(a),this._matrices2x2[a]=v,this}setArray2(a,v){return this._checkUniform(a),this._vectors2Arrays[a]=v,this}setArray3(a,v){return this._checkUniform(a),this._vectors3Arrays[a]=v,this}setArray4(a,v){return this._checkUniform(a),this._vectors4Arrays[a]=v,this}setUniformBuffer(a,v){return-1===this._options.uniformBuffers.indexOf(a)&&this._options.uniformBuffers.push(a),this._uniformBuffers[a]=v,this}setTextureSampler(a,v){return-1===this._options.samplerObjects.indexOf(a)&&this._options.samplerObjects.push(a),this._textureSamplers[a]=v,this}setStorageBuffer(a,v){return-1===this._options.storageBuffers.indexOf(a)&&this._options.storageBuffers.push(a),this._storageBuffers[a]=v,this}setDefine(a,v){const p=a.trimEnd()+" ",P=this.options.defines.findIndex((v=>v===a||v.startsWith(p)));return P>=0&&this.options.defines.splice(P,1),("boolean"!==typeof v||v)&&this.options.defines.push(p+v),this}isReadyForSubMesh(a,v,p){return this.isReady(a,p,v)}isReady(a,v,p){var P;const b=p&&this._storeEffectOnSubMeshes;if(this.isFrozen){const a=b?p._drawWrapper:this._drawWrapper;if(a.effect&&a._wasPreviouslyReady&&a._wasPreviouslyUsingInstances===v)return!0}const L=this.va(),t=L.getEngine(),K=[],C=[],F=new H.b;let c=this._shaderPath,f=this._options.uniforms,A=this._options.uniformBuffers,h=this._options.samplers;t.getCaps().multiview&&L.activeCamera&&L.activeCamera.outputRenderTarget&&L.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,K.push("#define MULTIVIEW"),-1!==f.indexOf("viewProjection")&&-1===f.indexOf("viewProjectionR")&&f.push("viewProjectionR"));for(let V=0;V<this._options.defines.length;V++){const a=0===this._options.defines[V].indexOf("#define")?this._options.defines[V]:`#define ${this._options.defines[V]}`;K.push(a)}for(let V=0;V<this._options.attributes.length;V++)C.push(this._options.attributes[V]);if(a&&a.isVerticesDataPresent(V.f.ColorKind)&&(-1===C.indexOf(V.f.ColorKind)&&C.push(V.f.ColorKind),K.push("#define VERTEXCOLOR")),v&&(K.push("#define INSTANCES"),(0,Q.jb)(C,this._materialHelperNeedsPreviousMatrices),null!==a&&void 0!==a&&a.hasThinInstances&&(K.push("#define THIN_INSTANCES"),a&&a.isVerticesDataPresent(V.f.ColorInstanceKind)&&(C.push(V.f.ColorInstanceKind),K.push("#define INSTANCESCOLOR")))),a&&a.useBones&&a.computeBonesUsingShaders&&a.skeleton){C.push(V.f.MatricesIndicesKind),C.push(V.f.MatricesWeightsKind),a.numBoneInfluencers>4&&(C.push(V.f.MatricesIndicesExtraKind),C.push(V.f.MatricesWeightsExtraKind));const v=a.skeleton;K.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),F.addCPUSkinningFallback(0,a),v.isUsingTextureForMatrices?(K.push("#define BONETEXTURE"),-1===f.indexOf("boneTextureWidth")&&f.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(K.push("#define BonesPerMesh "+(v.bones.length+1)),-1===f.indexOf("mBones")&&f.push("mBones"))}else K.push("#define NUM_BONE_INFLUENCERS 0");let R=0;const D=a?a.morphTargetManager:null;if(D){const a=D.supportsUVs&&-1!==K.indexOf("#define UV1"),v=D.supportsTangents&&-1!==K.indexOf("#define TANGENT"),p=D.supportsNormals&&-1!==K.indexOf("#define NORMAL");R=D.numMaxInfluencers||D.numInfluencers,a&&K.push("#define MORPHTARGETS_UV"),v&&K.push("#define MORPHTARGETS_TANGENT"),p&&K.push("#define MORPHTARGETS_NORMAL"),R>0&&K.push("#define MORPHTARGETS"),D.isUsingTextureForTargets&&(K.push("#define MORPHTARGETS_TEXTURE"),-1===f.indexOf("morphTargetTextureIndices")&&f.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),K.push("#define NUM_MORPH_INFLUENCERS "+R);for(let P=0;P<R;P++)C.push(V.f.PositionKind+P),p&&C.push(V.f.NormalKind+P),v&&C.push(V.f.TangentKind+P),a&&C.push(V.f.UVKind+"_"+P);R>0&&(f=f.slice(),f.push("morphTargetInfluences"),f.push("morphTargetCount"),f.push("morphTargetTextureInfo"),f.push("morphTargetTextureIndices"))}else K.push("#define NUM_MORPH_INFLUENCERS 0");if(a){const v=a.bakedVertexAnimationManager;v&&v.isEnabled&&(K.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===f.indexOf("bakedVertexAnimationSettings")&&f.push("bakedVertexAnimationSettings"),-1===f.indexOf("bakedVertexAnimationTextureSizeInverted")&&f.push("bakedVertexAnimationTextureSizeInverted"),-1===f.indexOf("bakedVertexAnimationTime")&&f.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,Q.y)(C,a,K)}for(const V in this._textures)if(!this._textures[V].isReady())return!1;a&&this._shouldTurnAlphaTestOn(a)&&K.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,X.e)(f),(0,X.m)(this,L,K)),L.fogEnabled&&null!==a&&void 0!==a&&a.applyFog&&L.fogMode!==u.c.FOGMODE_NONE&&(K.push("#define FOG"),-1===f.indexOf("view")&&f.push("view"),-1===f.indexOf("vFogInfos")&&f.push("vFogInfos"),-1===f.indexOf("vFogColor")&&f.push("vFogColor")),this._useLogarithmicDepth&&(K.push("#define LOGARITHMICDEPTH"),-1===f.indexOf("logarithmicDepthConstant")&&f.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(f=f.slice(),A=A.slice(),h=h.slice(),c=this.customShaderNameResolve(this.name,f,A,h,K,C));const y=b?p._getDrawWrapper(void 0,!0):this._drawWrapper,Z=(null===y||void 0===y?void 0:y.effect)??null,M=(null===y||void 0===y?void 0:y.defines)??null,S=K.join("\n");let n=Z;return M!==S&&(n=t.createEffect(c,{attributes:C,uniformsNames:f,uniformBuffersNames:A,samplers:h,defines:S,fallbacks:F,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:R},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},t),b?p.setEffect(n,S,this._materialContext):y&&y.setEffect(n,S),this._onEffectCreatedObservable&&(s.effect=n,s.subMesh=p??(null===a||void 0===a?void 0:a.rg[0])??null,this._onEffectCreatedObservable.notifyObservers(s))),y._wasPreviouslyUsingInstances=!!v,!((null===(P=n)||void 0===P||!P.isReady())??1)&&(Z!==n&&L.resetCachedMaterial(),y._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(a,v){const p=this.va(),P=v??this.getEffect();P&&(-1!==this._options.uniforms.indexOf("world")&&P.setMatrix("world",a),-1!==this._options.uniforms.indexOf("worldView")&&(a.multiplyToRef(p.getViewMatrix(),this._cachedWorldViewMatrix),P.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(a.multiplyToRef(p.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),P.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&P.setMatrix("view",p.getViewMatrix()))}bindForSubMesh(a,v,p){var P;this.bind(a,v,null===(P=p._drawWrapperOverride)||void 0===P?void 0:P.effect,p)}bind(a,v,p,P){const b=P&&this._storeEffectOnSubMeshes,L=p??(b?P.effect:this.getEffect());if(!L)return;const t=this.va();this._activeEffect=L,this.bindOnlyWorldMatrix(a,p);const V=this._options.uniformBuffers;let K=!1;if(L&&V&&V.length>0&&t.getEngine().supportsUniformBuffers)for(let u=0;u<V.length;++u){switch(V[u]){case"Mesh":v&&(v.getMeshUniformBuffer().bindToEffect(L,"Mesh"),v.transferToEffect(a));break;case"Scene":(0,Q.q)(L,t.getSceneUniformBuffer()),t.finalizeSceneUbo(),K=!0}}const C=v&&b?this._mustRebind(t,L,P,v.visibility):t.getCachedMaterial()!==this;if(L&&C){let a;for(a in K||-1===this._options.uniforms.indexOf("view")||L.setMatrix("view",t.getViewMatrix()),K||-1===this._options.uniforms.indexOf("projection")||L.setMatrix("projection",t.getProjectionMatrix()),K||-1===this._options.uniforms.indexOf("viewProjection")||(L.setMatrix("viewProjection",t.getTransformMatrix()),this._multiview&&L.setMatrix("viewProjectionR",t._transformMatrixR)),t.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&L.setVector3("cameraPosition",t.activeCamera.globalPosition),(0,Q.b)(v,L),(0,X.g)(L,this,t),this._useLogarithmicDepth&&(0,Q.j)(b?P.materialDefines:L.defines,L,t),v&&(0,Q.c)(t,v,L),this._textures)L.setTexture(a,this._textures[a]);for(a in this._textureArrays)L.setTextureArray(a,this._textureArrays[a]);for(a in this._ints)L.setInt(a,this._ints[a]);for(a in this._uints)L.setUInt(a,this._uints[a]);for(a in this._floats)L.setFloat(a,this._floats[a]);for(a in this._floatsArrays)L.setArray(a,this._floatsArrays[a]);for(a in this._colors3)L.setColor3(a,this._colors3[a]);for(a in this._colors3Arrays)L.setArray3(a,this._colors3Arrays[a]);for(a in this._colors4){const v=this._colors4[a];L.setFloat4(a,v.r,v.g,v.b,v.a)}for(a in this._colors4Arrays)L.setArray4(a,this._colors4Arrays[a]);for(a in this._vectors2)L.setVector2(a,this._vectors2[a]);for(a in this._vectors3)L.setVector3(a,this._vectors3[a]);for(a in this._vectors4)L.setVector4(a,this._vectors4[a]);for(a in this._quaternions)L.setQuaternion(a,this._quaternions[a]);for(a in this._matrices)L.setMatrix(a,this._matrices[a]);for(a in this._matrixArrays)L.setMatrices(a,this._matrixArrays[a]);for(a in this._matrices3x3)L.setMatrix3x3(a,this._matrices3x3[a]);for(a in this._matrices2x2)L.setMatrix2x2(a,this._matrices2x2[a]);for(a in this._vectors2Arrays)L.setArray2(a,this._vectors2Arrays[a]);for(a in this._vectors3Arrays)L.setArray3(a,this._vectors3Arrays[a]);for(a in this._vectors4Arrays)L.setArray4(a,this._vectors4Arrays[a]);for(a in this._quaternionsArrays)L.setArray4(a,this._quaternionsArrays[a]);for(a in this._uniformBuffers){const v=this._uniformBuffers[a].getBuffer();v&&L.bindUniformBuffer(v,a)}const p=t.getEngine(),V=p.setExternalTexture;if(V)for(a in this._externalTextures)V.call(p,a,this._externalTextures[a]);const C=p.setTextureSampler;if(C)for(a in this._textureSamplers)C.call(p,a,this._textureSamplers[a]);const F=p.setStorageBuffer;if(F)for(a in this._storageBuffers)F.call(p,a,this._storageBuffers[a])}if(L&&v&&(C||!this.isFrozen)){const a=v.morphTargetManager;a&&a.numInfluencers>0&&(0,Q.m)(v,L);const p=v.bakedVertexAnimationManager;if(p&&p.isEnabled){var F;const a=b?P._drawWrapper:this._drawWrapper;null===(F=v.bakedVertexAnimationManager)||void 0===F||F.bind(L,!!a._wasPreviouslyUsingInstances)}}this._afterBind(v,L,P)}getActiveTextures(){const a=super.getActiveTextures();for(const v in this._textures)a.push(this._textures[v]);for(const v in this._textureArrays){const p=this._textureArrays[v];for(let v=0;v<p.length;v++)a.push(p[v])}return a}hasTexture(a){if(super.hasTexture(a))return!0;for(const v in this._textures)if(this._textures[v]===a)return!0;for(const v in this._textureArrays){const p=this._textureArrays[v];for(let v=0;v<p.length;v++)if(p[v]===a)return!0}return!1}clone(a){const v=F.b.Clone((()=>new D(a,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);v.name=a,v.id=a,"object"===typeof v._shaderPath&&(v._shaderPath={...v._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((a=>{const v=this._options[a];Array.isArray(v)&&(this._options[a]=v.slice(0))})),this.stencil.copyTo(v.stencil);for(const p in this._textures)v.setTexture(p,this._textures[p]);for(const p in this._textureArrays)v.setTextureArray(p,this._textureArrays[p]);for(const p in this._externalTextures)v.setExternalTexture(p,this._externalTextures[p]);for(const p in this._ints)v.setInt(p,this._ints[p]);for(const p in this._uints)v.setUInt(p,this._uints[p]);for(const p in this._floats)v.setFloat(p,this._floats[p]);for(const p in this._floatsArrays)v.setFloats(p,this._floatsArrays[p]);for(const p in this._colors3)v.setColor3(p,this._colors3[p]);for(const p in this._colors3Arrays)v._colors3Arrays[p]=this._colors3Arrays[p];for(const p in this._colors4)v.setColor4(p,this._colors4[p]);for(const p in this._colors4Arrays)v._colors4Arrays[p]=this._colors4Arrays[p];for(const p in this._vectors2)v.setVector2(p,this._vectors2[p]);for(const p in this._vectors3)v.setVector3(p,this._vectors3[p]);for(const p in this._vectors4)v.setVector4(p,this._vectors4[p]);for(const p in this._quaternions)v.setQuaternion(p,this._quaternions[p]);for(const p in this._quaternionsArrays)v._quaternionsArrays[p]=this._quaternionsArrays[p];for(const p in this._matrices)v.setMatrix(p,this._matrices[p]);for(const p in this._matrixArrays)v._matrixArrays[p]=this._matrixArrays[p].slice();for(const p in this._matrices3x3)v.setMatrix3x3(p,this._matrices3x3[p]);for(const p in this._matrices2x2)v.setMatrix2x2(p,this._matrices2x2[p]);for(const p in this._vectors2Arrays)v.setArray2(p,this._vectors2Arrays[p]);for(const p in this._vectors3Arrays)v.setArray3(p,this._vectors3Arrays[p]);for(const p in this._vectors4Arrays)v.setArray4(p,this._vectors4Arrays[p]);for(const p in this._uniformBuffers)v.setUniformBuffer(p,this._uniformBuffers[p]);for(const p in this._textureSamplers)v.setTextureSampler(p,this._textureSamplers[p]);for(const p in this._storageBuffers)v.setStorageBuffer(p,this._storageBuffers[p]);return v}dispose(a,v,p){if(v){let a;for(a in this._textures)this._textures[a].dispose();for(a in this._textureArrays){const v=this._textureArrays[a];for(let a=0;a<v.length;a++)v[a].dispose()}}this._textures={},super.dispose(a,v,p)}serialize(){const a=F.b.Serialize(this);let v;for(v in a.customType="BABYLON.ShaderMaterial",a.uniqueId=this.uniqueId,a.options=this._options,a.shaderPath=this._shaderPath,a.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,a.stencil=this.stencil.serialize(),a.textures={},this._textures)a.textures[v]=this._textures[v].serialize();for(v in a.textureArrays={},this._textureArrays){a.textureArrays[v]=[];const p=this._textureArrays[v];for(let P=0;P<p.length;P++)a.textureArrays[v].push(p[P].serialize())}for(v in a.ints={},this._ints)a.ints[v]=this._ints[v];for(v in a.uints={},this._uints)a.uints[v]=this._uints[v];for(v in a.floats={},this._floats)a.floats[v]=this._floats[v];for(v in a.floatsArrays={},this._floatsArrays)a.floatsArrays[v]=this._floatsArrays[v];for(v in a.colors3={},this._colors3)a.colors3[v]=this._colors3[v].tj();for(v in a.colors3Arrays={},this._colors3Arrays)a.colors3Arrays[v]=this._colors3Arrays[v];for(v in a.colors4={},this._colors4)a.colors4[v]=this._colors4[v].tj();for(v in a.colors4Arrays={},this._colors4Arrays)a.colors4Arrays[v]=this._colors4Arrays[v];for(v in a.vectors2={},this._vectors2)a.vectors2[v]=this._vectors2[v].tj();for(v in a.vectors3={},this._vectors3)a.vectors3[v]=this._vectors3[v].tj();for(v in a.vectors4={},this._vectors4)a.vectors4[v]=this._vectors4[v].tj();for(v in a.quaternions={},this._quaternions)a.quaternions[v]=this._quaternions[v].tj();for(v in a.matrices={},this._matrices)a.matrices[v]=this._matrices[v].tj();for(v in a.matrixArray={},this._matrixArrays)a.matrixArray[v]=this._matrixArrays[v];for(v in a.matrices3x3={},this._matrices3x3)a.matrices3x3[v]=this._matrices3x3[v];for(v in a.matrices2x2={},this._matrices2x2)a.matrices2x2[v]=this._matrices2x2[v];for(v in a.vectors2Arrays={},this._vectors2Arrays)a.vectors2Arrays[v]=this._vectors2Arrays[v];for(v in a.vectors3Arrays={},this._vectors3Arrays)a.vectors3Arrays[v]=this._vectors3Arrays[v];for(v in a.vectors4Arrays={},this._vectors4Arrays)a.vectors4Arrays[v]=this._vectors4Arrays[v];for(v in a.quaternionsArrays={},this._quaternionsArrays)a.quaternionsArrays[v]=this._quaternionsArrays[v];return a}static Parse(a,v,p){const b=F.b.Parse((()=>new D(a.name,v,a.shaderPath,a.options,a.storeEffectOnSubMeshes)),a,v,p);let L;for(L in a.stencil&&b.stencil.parse(a.stencil,v,p),a.textures)b.setTexture(L,c.c.Parse(a.textures[L],v,p));for(L in a.textureArrays){const P=a.textureArrays[L],t=[];for(let a=0;a<P.length;a++)t.push(c.c.Parse(P[a],v,p));b.setTextureArray(L,t)}for(L in a.ints)b.setInt(L,a.ints[L]);for(L in a.uints)b.setUInt(L,a.uints[L]);for(L in a.floats)b.setFloat(L,a.floats[L]);for(L in a.floatsArrays)b.setFloats(L,a.floatsArrays[L]);for(L in a.colors3)b.setColor3(L,t.d.bh(a.colors3[L]));for(L in a.colors3Arrays){const v=a.colors3Arrays[L].reduce(((a,v,p)=>(p%3===0?a.push([v]):a[a.length-1].push(v),a)),[]).map((a=>t.d.bh(a)));b.setColor3Array(L,v)}for(L in a.colors4)b.setColor4(L,t.e.bh(a.colors4[L]));for(L in a.colors4Arrays){const v=a.colors4Arrays[L].reduce(((a,v,p)=>(p%4===0?a.push([v]):a[a.length-1].push(v),a)),[]).map((a=>t.e.bh(a)));b.setColor4Array(L,v)}for(L in a.vectors2)b.setVector2(L,P.o.bh(a.vectors2[L]));for(L in a.vectors3)b.setVector3(L,P.s.bh(a.vectors3[L]));for(L in a.vectors4)b.setVector4(L,P.t.bh(a.vectors4[L]));for(L in a.quaternions)b.setQuaternion(L,P.i.bh(a.quaternions[L]));for(L in a.matrices)b.setMatrix(L,P.e.bh(a.matrices[L]));for(L in a.matrixArray)b._matrixArrays[L]=new Float32Array(a.matrixArray[L]);for(L in a.matrices3x3)b.setMatrix3x3(L,a.matrices3x3[L]);for(L in a.matrices2x2)b.setMatrix2x2(L,a.matrices2x2[L]);for(L in a.vectors2Arrays)b.setArray2(L,a.vectors2Arrays[L]);for(L in a.vectors3Arrays)b.setArray3(L,a.vectors3Arrays[L]);for(L in a.vectors4Arrays)b.setArray4(L,a.vectors4Arrays[L]);for(L in a.quaternionsArrays)b.setArray4(L,a.quaternionsArrays[L]);return b}static ParseFromFileAsync(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((b,L)=>{const t=new A.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const v=JSON.parse(t.responseText),L=this.Parse(v,p||R.b.LastCreatedScene,P);a&&(L.name=a),b(L)}else L("Unable to load the ShaderMaterial")})),t.open("GET",v),t.send()}))}static ParseFromSnippetAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((P,b)=>{const L=new A.b;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const b=JSON.parse(JSON.parse(L.responseText).jsonPayload),t=JSON.parse(b.shaderMaterial),V=this.Parse(t,v||R.b.LastCreatedScene,p);V.snippetId=a,P(V)}else b("Unable to load the snippet "+a)})),L.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),L.send()}))}}D.SnippetUrl="https://snippet.babylonjs.com",D.CreateFromSnippetAsync=D.ParseFromSnippetAsync,(0,f.f)("BABYLON.ShaderMaterial",D),b.b._LinesMeshParser=(a,v)=>y.Parse(a,v);class y extends b.b{_isShaderMaterial(a){return"ShaderMaterial"===a.getClassName()}constructor(a){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,L=arguments.length>7?arguments[7]:void 0;super(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v,arguments.length>4?arguments[4]:void 0),this.useVertexColor=P,this.useVertexAlpha=b,this.color=new t.d(1,1,1),this.alpha=1,this._shaderLanguage=0,v&&(this.color=v.color.clone(),this.alpha=v.alpha,this.useVertexColor=v.useVertexColor,this.useVertexAlpha=v.useVertexAlpha),this.intersectionThreshold=.1;const K={attributes:[V.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===b?K.needAlphaBlending=!1:K.defines.push("#define VERTEXALPHA"),P?(K.defines.push("#define VERTEXCOLOR"),K.attributes.push(V.f.ColorKind)):(K.uniforms.push("color"),this._color4=new t.e),L)this.material=L;else{this.va().getEngine().isWebGPU&&!y.ForceGLSL&&(this._shaderLanguage=1),K.shaderLanguage=this._shaderLanguage,K.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([p.e(23).then(p.bind(p,13746)),p.e(47).then(p.bind(p,13755))]):await Promise.all([p.e(28).then(p.bind(p,13762)),p.e(48).then(p.bind(p,13765))])},this.material=new D("colorShader",this.va(),"color",K,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(a){this._lineMaterial=a,this._lineMaterial.fillMode=C.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(a){}_bind(a,v){if(!this._geometry)return this;const p=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(v,p):this._geometry._bind(v,p,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:a,g:v,b:p}=this.color;this._color4.set(a,v,p,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(a,v,p){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const P=this.va().getEngine();return this._unIndexed?P.drawArraysType(C.c.LineListDrawMode,a.verticesStart,a.verticesCount,p):P.drawElementsType(C.c.LineListDrawMode,a.indexStart,a.indexCount,p),this}dispose(a){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(a)}clone(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;return new y(a,this.va(),v,this,p)}createInstance(a){const v=new Z(a,this);if(this.instancedBuffers){v.instancedBuffers={};for(const a in this.instancedBuffers)v.instancedBuffers[a]=this.instancedBuffers[a]}return v}serialize(a){super.serialize(a),a.color=this.color.tj(),a.alpha=this.alpha}static Parse(a,v){const p=new y(a.name,v);return p.color=t.d.bh(a.color),p.alpha=a.alpha,p}}y.ForceGLSL=!1;class Z extends K.b{constructor(a,v){super(a,v),this.intersectionThreshold=v.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var M=p(10905);function S(a){const v=[],p=[],P=a.lines,b=a.za,t=[];let V=0;for(let L=0;L<P.length;L++){const a=P[L];for(let P=0;P<a.length;P++){const{x:K,y:C,z:F}=a[P];if(p.push(K,C,F),b){const a=b[L],{r:v,g:p,b:V,a:K}=a[P];t.push(v,p,V,K)}P>0&&(v.push(V-1),v.push(V)),V++}}const K=new L.e;return K.indices=v,K.xa=p,b&&(K.za=t),K}function n(a){const v=a.dashSize||3,p=a.gapSize||1,b=a.dashNb||200,t=a.points,V=[],K=[],C=P.s.Zero();let F=0,u=0,c=0,f=0,H=0,A=0,h=0;for(h=0;h<t.length-1;h++)t[h+1].subtractToRef(t[h],C),F+=C.length();for(c=F/b,f=v*c/(v+p),h=0;h<t.length-1;h++){t[h+1].subtractToRef(t[h],C),u=Math.floor(C.length()/c),C.normalize();for(let a=0;a<u;a++)H=c*a,V.push(t[h].x+H*C.x,t[h].y+H*C.y,t[h].z+H*C.z),V.push(t[h].x+(H+f)*C.x,t[h].y+(H+f)*C.y,t[h].z+(H+f)*C.z),K.push(A,A+1),A+=2}const R=new L.e;return R.xa=V,R.indices=K,R}function q(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=v.instance,b=v.lines,L=v.za;if(P){const a=P.getVerticesData(V.f.PositionKind);let v,p;L&&(v=P.getVerticesData(V.f.ColorKind));let t=0,K=0;for(let P=0;P<b.length;P++){const V=b[P];for(let b=0;b<V.length;b++)a[t]=V[b].x,a[t+1]=V[b].y,a[t+2]=V[b].z,L&&v&&(p=L[P],v[K]=p[b].r,v[K+1]=p[b].g,v[K+2]=p[b].b,v[K+3]=p[b].a,K+=4),t+=3}return P.updateVerticesData(V.f.PositionKind,a,!1,!1),L&&v&&P.updateVerticesData(V.f.ColorKind,v,!1,!1),P.refreshBoundingInfo(),P}const t=new y(a,p,null,void 0,void 0,!!L,v.useVertexAlpha,v.material);return S(v).Ca(t,v.updatable),t}function T(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=v.za?[v.za]:null;return q(a,{lines:[v.points],updatable:v.updatable,instance:v.instance,za:P,useVertexAlpha:v.useVertexAlpha,material:v.material},p)}function j(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=v.points,t=v.instance,V=v.gapSize||1,K=v.dashSize||3;if(t){const a=a=>{const v=P.s.Zero(),p=a.length/6;let b=0,V=0,K=0,C=0,F=0,u=0,c=0,f=0;for(c=0;c<L.length-1;c++)L[c+1].subtractToRef(L[c],v),b+=v.length();K=b/p;const H=t._creationDataStorage.dashSize;for(C=H*K/(H+t._creationDataStorage.gapSize),c=0;c<L.length-1;c++)for(L[c+1].subtractToRef(L[c],v),V=Math.floor(v.length()/K),v.normalize(),f=0;f<V&&u<a.length;)F=K*f,a[u]=L[c].x+F*v.x,a[u+1]=L[c].y+F*v.y,a[u+2]=L[c].z+F*v.z,a[u+3]=L[c].x+(F+C)*v.x,a[u+4]=L[c].y+(F+C)*v.y,a[u+5]=L[c].z+(F+C)*v.z,u+=6,f++;for(;u<a.length;)a[u]=L[c].x,a[u+1]=L[c].y,a[u+2]=L[c].z,u+=3};return(v.dashNb||v.dashSize||v.gapSize||v.useVertexAlpha||v.material)&&M.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),t.updateMeshPositions(a,!1),t}const C=new y(a,p,null,void 0,void 0,void 0,v.useVertexAlpha,v.material);return n(v).Ca(C,v.updatable),C._creationDataStorage=new b.f,C._creationDataStorage.dashSize=K,C._creationDataStorage.gapSize=V,C}L.e.CreateLineSystem=S,L.e.CreateDashedLines=n,b.b.qb=function(a,v){return T(a,{points:v,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},b.b.CreateDashedLines=function(a,v,p,P,b){return j(a,{points:v,dashSize:p,gapSize:P,dashNb:b,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11614:(a,v,p)=>{"use strict";p.d(v,{b:()=>V,c:()=>K});var P=p(11504),b=p(11528),L=p(11470);function t(a){const v=[],p=[],P=[],t=[],V=a.width||a.size||1,K=a.height||a.size||1,C=0===a.sideOrientation?0:a.sideOrientation||b.e.DEFAULTSIDE,F=V/2,u=K/2;p.push(-F,-u,0),P.push(0,0,-1),t.push(0,L.b?1:0),p.push(F,-u,0),P.push(0,0,-1),t.push(1,L.b?1:0),p.push(F,u,0),P.push(0,0,-1),t.push(1,L.b?0:1),p.push(-F,u,0),P.push(0,0,-1),t.push(0,L.b?0:1),v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),b.e._ComputeSides(C,p,v,P,t,a.frontUVs,a.backUVs);const c=new b.e;return c.indices=v,c.xa=p,c.ya=P,c.Aa=t,c}function V(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new P.b(a,p);v.sideOrientation=P.b._GetDefaultSideOrientation(v.sideOrientation),b._originalBuilderSideOrientation=v.sideOrientation;return t(v).Ca(b,v.updatable),v.sourcePlane&&(b.translate(v.sourcePlane.k,-v.sourcePlane.d),b.setDirection(v.sourcePlane.k.scale(-1))),b}const K={ug:V};b.e.ug=t,P.b.ug=(a,v,p,P,b)=>V(a,{size:v,width:v,height:v,sideOrientation:b,updatable:P},p)},11834:(a,v,p)=>{"use strict";p.d(v,{e:()=>K});var P=p(11240),b=p(11504),L=p(11528),t=p(11470);function V(a){const v=0|(a.segments||32),p=a.diameterX||a.diameter||1,b=a.diameterY||a.diameter||1,V=a.diameterZ||a.diameter||1,K=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,C=a.slice&&a.slice<=0?1:a.slice||1,F=0===a.sideOrientation?0:a.sideOrientation||L.e.DEFAULTSIDE,u=!!a.dedupTopBottomIndices,c=new P.s(p/2,b/2,V/2),f=2+v,H=2*f,A=[],h=[],R=[],X=[];for(let L=0;L<=f;L++){const a=L/f,v=a*Math.PI*C;for(let p=0;p<=H;p++){const b=p/H,L=b*Math.PI*2*K,V=P.e.RotationZ(-v),C=P.e.RotationY(L),F=P.s.TransformCoordinates(P.s.Up(),V),u=P.s.TransformCoordinates(F,C),f=u.multiply(c),A=u.divide(c).normalize();h.push(f.x,f.y,f.z),R.push(A.x,A.y,A.z),X.push(b,t.b?1-a:a)}if(L>0){const a=h.length/3;for(let v=a-2*(H+1);v+H+2<a;v++)u?(L>1&&(A.push(v),A.push(v+1),A.push(v+H+1)),(L<f||C<1)&&(A.push(v+H+1),A.push(v+1),A.push(v+H+2))):(A.push(v),A.push(v+1),A.push(v+H+1),A.push(v+H+1),A.push(v+1),A.push(v+H+2))}}L.e._ComputeSides(F,h,A,R,X,a.frontUVs,a.backUVs);const Q=new L.e;return Q.indices=A,Q.xa=h,Q.ya=R,Q.Aa=X,Q}function K(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return V(v).Ca(P,v.updatable),P}L.e.CreateSphere=V,b.b.CreateSphere=(a,v,p,P,b,L)=>K(a,{segments:v,diameterX:p,diameterY:p,diameterZ:p,sideOrientation:L,updatable:b},P)},12486:(a,v,p)=>{"use strict";p.d(v,{b:()=>u});var P=p(10889),b=p(12491),L=p(11532),t=p(11306),V=p(11528),K=p(10905);function C(a,v,p,P,b){let L=null,t=null,V=null;try{let K;L=new a.Decoder,t=new a.DecoderBuffer,t.Init(v,v.byteLength);const C=L.GetEncodedGeometryType(t);switch(C){case a.TRIANGULAR_MESH:{const v=new a.Mesh;if(K=L.DecodeBufferToMesh(t,v),!K.ok()||0===v.ptr)throw new Error(K.error_msg());const p=3*v.num_faces(),b=4*p,C=a._malloc(b);try{L.GetTrianglesUInt32Array(v,b,C);const t=new Uint32Array(p);t.set(new Uint32Array(a.HEAPF32.buffer,C,p)),P(t)}finally{a._free(C)}V=v;break}case a.POINT_CLOUD:{const v=new a.PointCloud;if(K=L.DecodeBufferToPointCloud(t,v),!K.ok()||!v.ptr)throw new Error(K.error_msg());V=v;break}default:throw new Error(`Invalid geometry type ${C}`)}const F=V.num_points(),u=(v,p,P,L)=>{const t=L.data_type(),V=L.num_components(),K=L.normalized(),C=L.byte_stride(),u=L.byte_offset(),c={[a.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:a.HEAPF32},[a.DT_INT8]:{typedArrayConstructor:Int8Array,heap:a.HEAP8},[a.DT_INT16]:{typedArrayConstructor:Int16Array,heap:a.HEAP16},[a.DT_INT32]:{typedArrayConstructor:Int32Array,heap:a.HEAP32},[a.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:a.HEAPU8},[a.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:a.HEAPU16},[a.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:a.HEAPU32}}[t];if(!c)throw new Error(`Invalid data type ${t}`);const f=F*V,H=f*c.typedArrayConstructor.BYTES_PER_ELEMENT,A=a._malloc(H);try{v.GetAttributeDataArrayForAllPoints(p,L,t,H,A);const a=new c.typedArrayConstructor(c.heap.buffer,A,f);b(P,a.slice(),V,u,C,K)}finally{a._free(A)}};if(p)for(const a in p){const v=p[a],P=L.GetAttributeByUniqueId(V,v);u(L,V,a,P)}else{const v={position:a.POSITION,k:a.NORMAL,color:a.COLOR,uv:a.TEX_COORD};for(const a in v){const p=L.GetAttributeId(V,v[a]);if(-1!==p){const v=L.GetAttribute(V,p);u(L,V,a,v)}}}return F}finally{V&&a.destroy(V),t&&a.destroy(t),L&&a.destroy(L)}}function F(){let a;onmessage=v=>{const p=v.data;switch(p.id){case"init":{const v=p.decoder;v.url&&importScripts(v.url);const P=v.wasmBinary?{wasmBinary:v.wasmBinary}:{};a=DracoDecoderModule(P),postMessage({id:"initDone"});break}case"decodeMesh":if(!a)throw new Error("Draco decoder module is not available");a.then((a=>{const v=C(a,p.dataView,p.attributes,(a=>{postMessage({id:"indices",data:a},[a.buffer])}),((a,v,p,P,b,L)=>{postMessage({id:"attribute",kind:a,data:v,size:p,byteOffset:P,byteStride:b,normalized:L},[v.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:v})}))}}}class u{static get DecoderAvailable(){const a=u.Configuration.decoder;return!!(a.wasmUrl&&a.wasmBinaryUrl&&"object"===typeof WebAssembly||a.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return u._Default||(u._Default=new u),u._Default}static ResetDefault(a){u._Default&&(a||u._Default.dispose(),u._Default=null)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.DefaultNumWorkers;const v=u.Configuration.decoder;if(v.workerPool||"object"===typeof a&&a.workerPool)this._workerPoolPromise=Promise.resolve(v.workerPool||a.workerPool);else{const p=v.wasmBinary||"object"===typeof a&&a.wasmBinary,L="number"===typeof a?a:a.numWorkers,t=L&&"function"===typeof Worker&&"function"===typeof URL,V=t||!t&&!v.jsModule,K=v.wasmUrl&&v.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:V?P.e.GetBabylonScriptURL(v.wasmUrl,!0):"",wasmBinaryPromise:p?Promise.resolve(p):P.e.LoadFileAsync(P.e.GetBabylonScriptURL(v.wasmBinaryUrl,!0))}:{url:V?P.e.GetBabylonScriptURL(v.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};t?this._workerPoolPromise=K.wasmBinaryPromise.then((a=>{const v=`${C}(${F})()`,p=URL.createObjectURL(new Blob([v],{type:"application/javascript"}));return new b.e(L,(()=>function(a,v,p){return new Promise(((P,b)=>{const L=v=>{a.removeEventListener("error",L),a.removeEventListener("message",t),b(v)},t=v=>{"initDone"===v.data.id&&(a.removeEventListener("error",L),a.removeEventListener("message",t),P(a))};if(a.addEventListener("error",L),a.addEventListener("message",t),v){const P=v.slice(0);a.postMessage({id:"init",decoder:{url:p,wasmBinary:P}},[P])}else a.postMessage({id:"init",decoder:{url:p}})}))}(new Worker(p),a,K.url)))})):this._decoderModulePromise=K.wasmBinaryPromise.then((async a=>{if("undefined"===typeof DracoDecoderModule&&!v.jsModule){if(!K.url)throw new Error("Draco decoder module is not available");await P.e.LoadBabylonScriptAsync(K.url)}return await(p=a,b=v.jsModule,new Promise((a=>{(b||DracoDecoderModule)({wasmBinary:p}).then((v=>{a({module:v})}))})));var p,b}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((a=>{a.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(a,v,p){const P=a instanceof ArrayBuffer?new Int8Array(a):new Int8Array(a.buffer,a.byteOffset,a.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((a=>new Promise(((b,L)=>{a.push(((a,t)=>{let V=null;const C=[],F=v=>{a.removeEventListener("error",F),a.removeEventListener("message",u),L(v),t()},u=v=>{const P=v.data;switch(P.id){case"decodeMeshDone":a.removeEventListener("error",F),a.removeEventListener("message",u),b({indices:V,attributes:C,totalVertices:P.totalVertices}),t();break;case"indices":V=P.data;break;case"attribute":C.push({kind:P.kind,data:P.data,size:P.size,byteOffset:P.byteOffset,byteStride:P.byteStride,normalized:(L=P.kind,c=P.normalized,p&&void 0!==p[L]?(c!==p[L]&&K.d.Warn(`Normalized flag from Draco data (${c}) does not match normalized flag from glTF accessor (${p[L]}). Using flag from glTF accessor.`),p[L]):c)})}var L,c};a.addEventListener("error",F),a.addEventListener("message",u);const c=P.slice();a.postMessage({id:"decodeMesh",dataView:c,attributes:v},[c.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((a=>{let p=null;const b=[],L=C(a.module,P,v,(a=>{p=a}),((a,v,p,P,L,t)=>{b.push({kind:a,data:v,size:p,byteOffset:P,byteStride:L,normalized:t})}));return{indices:p,attributes:b,totalVertices:L}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(a,v,p,P){const b=await this.decodeMeshToMeshDataAsync(p,P),V=new L.c(a,v);b.indices&&V.setIndices(b.indices);for(const L of b.attributes)V.setVerticesBuffer(new t.f(v.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),b.totalVertices);return V}async _decodeMeshToGeometryForGltfAsync(a,v,p,P,b){const V=await this.decodeMeshToMeshDataAsync(p,P,b),K=new L.c(a,v);V.indices&&K.setIndices(V.indices);for(const L of V.attributes)K.setVerticesBuffer(new t.f(v.getEngine(),L.data,L.kind,!1,void 0,L.byteStride,void 0,L.byteOffset,L.size,void 0,L.normalized,!0),V.totalVertices);return K}async decodeMeshAsync(a,v){const p=await this.decodeMeshToMeshDataAsync(a,v),P=new V.e;p.indices&&(P.indices=p.indices);for(const b of p.attributes){const a=t.f.GetFloatData(b.data,b.size,t.f.GetDataType(b.data),b.byteOffset,b.byteStride,b.normalized,p.totalVertices);P.set(a,b.kind)}return P}}u.Configuration={decoder:{wasmUrl:`${P.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${P.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${P.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},u.DefaultNumWorkers=u.GetDefaultNumWorkers(),u._Default=null},11665:(a,v,p)=>{"use strict";p.d(v,{e:()=>b});var P=p(11309);class b extends P.c{constructor(a){super(),this._buffer=a}get underlyingResource(){return this._buffer}}},11539:(a,v,p)=>{"use strict";p.d(v,{e:()=>Z});var P=p(11207),b=p(10893),L=p(11240),t=p(11306),V=p(11528),K=p(11544),C=p(11304),F=p(11413),u=p(11301);class c{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new L.s(0,0,0),this._diffPositionForCollisions=new L.s(0,0,0),this._collisionResponse=!0}}var f=p(10926),H=p(11429),A=p(11279),h=p(11245),R=p(11549),X=p(11027),Q=p(11210),s=p(10974);class D{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=L.s.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class y{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new D,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new c,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class Z extends K.c{static get BILLBOARDMODE_NONE(){return K.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return K.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return K.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return K.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return K.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return K.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(a){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=a}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(a){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=a}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(a){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=a}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(a){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=a}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(a){this._internalAbstractMeshDataInfo._collisionRetryCount=a}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(a){this._internalAbstractMeshDataInfo._morphTargetManager!==a&&(this._internalAbstractMeshDataInfo._morphTargetManager=a,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(a){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==a&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=a,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(a){return!!super._updateNonUniformScalingState(a)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(a){this._internalAbstractMeshDataInfo._rawBoundingInfo=a}set Tk(a){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(a)}set onCollisionPositionChange(a){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(a)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(a){if(this._internalAbstractMeshDataInfo._visibility===a)return;const v=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=a,(1===v&&1!==a||1!==v&&1===a)&&this._markSubMeshesAsDirty((a=>{a.markAsMiscDirty(),a.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(a){this._internalAbstractMeshDataInfo._inheritVisibility=a}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let a=this._parentNode;for(;a;){const v=a.isVisible;if("undefined"!==typeof v)return v;a=a.parent}}return this._isVisible}set isVisible(a){this._isVisible=a}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(a){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=a}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(a){this._internalAbstractMeshDataInfo._renderingGroupId=a}get material(){return this._internalAbstractMeshDataInfo._material}set material(a){this._setMaterial(a)}_setMaterial(a){this._internalAbstractMeshDataInfo._material!==a&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=a,a&&a.meshMap&&(a.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.rg&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(a){var v;return null===(v=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===v?void 0:v[a]}setMaterialForRenderPass(a,v){this.resetDrawCache(a),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[a]=v}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(a){this._internalAbstractMeshDataInfo._receiveShadows!==a&&(this._internalAbstractMeshDataInfo._receiveShadows=a,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(a){this._internalAbstractMeshDataInfo._hasVertexAlpha!==a&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=a,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(a){this._internalAbstractMeshDataInfo._useVertexColors!==a&&(this._internalAbstractMeshDataInfo._useVertexColors=a,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(a){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==a&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=a,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(a){this._internalAbstractMeshDataInfo._numBoneInfluencers!==a&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=a,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(a){this._internalAbstractMeshDataInfo._applyFog!==a&&(this._internalAbstractMeshDataInfo._applyFog=a,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(a){this._internalAbstractMeshDataInfo._enableDistantPicking=a}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(a){a!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=a,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(a){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(a)?-1:a}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(a){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=a}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(a){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(a)?-1:a}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(a){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=a}get lightSources(){return this._lightSources}set skeleton(a){const v=this._internalAbstractMeshDataInfo._skeleton;v&&v.needInitialSkinMatrix&&v._unregisterMeshWithPoseMatrix(this),a&&a.needInitialSkinMatrix&&a._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=a,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(a){var v;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(a,p,!1),v=this,this._internalAbstractMeshDataInfo=new y,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Oi=Z.Pi,this.onCollideObservable=new b.c,this.onCollisionPositionChangeObservable=new b.c,this.onMaterialChangedObservable=new b.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Ib=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=A.d.Red(),this.outlineWidth=.02,this.overlayColor=A.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.xb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new L.s(.5,1,.5),this.ellipsoidOffset=new L.s(0,0,0),this.edgesWidth=1,this.edgesColor=new A.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Ec:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new b.c,this._onCollisionPositionChange=function(a,p){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;p.subtractToRef(v._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>s.e.CollisionsEpsilon&&v.position.addInPlace(v._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),P&&v.onCollideObservable.notifyObservers(P),v.onCollisionPositionChangeObservable.notifyObservers(v.position)},p=this.va(),p.xi(this),this._resyncLightSources(),this._uniformBuffer=new u.b(this.va().getEngine(),void 0,void 0,a,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),p.performancePriority){case 2:this.Da=!0;case 1:this.xb=!0,this.Ib=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(a){const v=this._uniformBuffer;v.Sj("world",a),v.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),v.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(a){let v="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");v+=", # of submeshes: "+(this.rg?this.rg.length:0);const p=this._internalAbstractMeshDataInfo._skeleton;return p&&(v+=", skeleton: "+p.name),a&&(v+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],v+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Ec?"YES":"NO")),v}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==K.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(v||this.actionManager.isRecursive)){if(!a)return this.actionManager;if(this.actionManager.hasSpecificTrigger(a))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(a,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.rg){for(const a of this.rg)a._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const a of this.va().lights)a.isEnabled()&&a.canAffectMesh(this)&&this._lightSources.push(a);this._markSubMeshesAsLightDirty()}_resyncLightSource(a){const v=a.isEnabled()&&a.canAffectMesh(this),p=this._lightSources.indexOf(a);let P=!1;if(-1===p){if(!v)return;this._lightSources.push(a)}else{if(v)return;P=!0,this._lightSources.splice(p,1)}this._markSubMeshesAsLightDirty(P)}_unBindEffect(){for(const a of this.rg)a.setEffect(null)}_removeLightSource(a,v){const p=this._lightSources.indexOf(a);-1!==p&&(this._lightSources.splice(p,1),this._markSubMeshesAsLightDirty(v))}_markSubMeshesAsDirty(a){if(this.rg)for(const v of this.rg)for(let p=0;p<v._drawWrappers.length;++p){const P=v._drawWrappers[p];P&&P.defines&&P.defines.markAllAsDirty&&a(P.defines)}}_markSubMeshesAsLightDirty(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((v=>v.markAsLightDirty(a)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((a=>a.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((a=>a.markAsMiscDirty()))}Sg(a){return this._currentRenderId=Number.MAX_VALUE,super.Sg(a),this._isDirty=!0,this}resetDrawCache(a){if(this.rg)for(const v of this.rg)v.resetDrawCache(a)}get isBlocked(){return!1}getLOD(a){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}ng(){return null}getVerticesData(a){return null}Ga(a,v,p,P){return this}updateVerticesData(a,v,p,P){return this}setIndices(a,v){return this}isVerticesDataPresent(a){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(a){return this._boundingInfo=a,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(a,v,p){return this._boundingInfo=new F.d(a,v,p),this._boundingInfo}normalizeToUnitCube(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(a,v,p)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(t.f.MatricesIndicesKind)&&this.isVerticesDataPresent(t.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(a){}_activate(a,v){return this._renderId=a,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===K.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(a,v,p){return this.position.addInPlace(this.calcMovePOV(a,v,p)),this}calcMovePOV(a,v,p){const P=new L.e;(this.rotationQuaternion?this.rotationQuaternion:L.i.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(P);const b=L.s.Zero(),t=this.definedFacingForward?-1:1;return L.s.TransformCoordinatesFromFloatsToRef(a*t,v,p*t,P,b),b}rotatePOV(a,v,p){return this.rotation.addInPlace(this.calcRotatePOV(a,v,p)),this}calcRotatePOV(a,v,p){const P=this.definedFacingForward?1:-1;return new L.s(a*P,v,p*P)}Fa(a,v){if(a){const p=(0,H.g)(a,0,this.getTotalVertices(),v);this._boundingInfo?this._boundingInfo.reConstruct(p.minimum,p.maximum):this._boundingInfo=new F.d(p.minimum,p.maximum)}if(this.rg)for(let p=0;p<this.rg.length;p++)this.rg[p].refreshBoundingInfo(a);this.Ea()}_refreshBoundingInfoDirect(a){if(this._boundingInfo?this._boundingInfo.reConstruct(a.minimum,a.maximum):this._boundingInfo=new F.d(a.minimum,a.maximum),this.rg)for(let v=0;v<this.rg.length;v++)this.rg[v].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(a,v,p,P,b,V,K){!function(a,v,p,P,b,V,K){const C=L.k.fb[0],F=L.k.Matrix[0],u=L.k.Matrix[1],c=v===t.f.NormalKind?L.s.TransformNormalFromFloatsToRef:L.s.TransformCoordinatesFromFloatsToRef;for(let t=0,f=0;t<a.length;t+=3,f+=4){let v,H;for(F.reset(),v=0;v<4;v++)H=b[f+v],H>0&&(L.e.FromFloat32ArrayToRefScaled(p,Math.floor(16*P[f+v]),H,u),F.addToSelf(u));if(V&&K)for(v=0;v<4;v++)H=K[f+v],H>0&&(L.e.FromFloat32ArrayToRefScaled(p,Math.floor(16*V[f+v]),H,u),F.addToSelf(u));c(a[t],a[t+1],a[t+2],F,C),C.toArray(a,t)}}(a,v,p,P,b,V,K)}_getData(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.f.PositionKind;const P=a.cache,b=a=>{if(P){const v=P._vertexData||(P._vertexData={});return v[a]||this.copyVerticesData(a,v),v[a]}return this.getVerticesData(a)};if(v||(v=b(p)),!v)return null;if(P?(P._outputData?P._outputData.set(v):P._outputData=new Float32Array(v),v=P._outputData):(a.applyMorph&&this.morphTargetManager||a.applySkeleton&&this.skeleton)&&(v=v.slice()),a.applyMorph&&this.morphTargetManager&&function(a,v,p){let P=null;switch(v){case t.f.PositionKind:P=a=>a.getPositions();break;case t.f.NormalKind:P=a=>a.getNormals();break;case t.f.TangentKind:P=a=>a.getTangents();break;case t.f.UVKind:P=a=>a.getUVs();break;default:return}for(let b=0;b<a.length;b++){let v=a[b];for(let L=0;L<p.numTargets;L++){const t=p.getTarget(L),V=t.influence;if(0!==V){const p=P(t);p&&(v+=(p[b]-a[b])*V)}}a[b]=v}}(v,p,this.morphTargetManager),a.applySkeleton&&this.skeleton){const a=b(t.f.MatricesIndicesKind),P=b(t.f.MatricesWeightsKind);if(P&&a){const L=this.numBoneInfluencers>4,V=L?b(t.f.MatricesIndicesExtraKind):null,K=L?b(t.f.MatricesWeightsExtraKind):null,C=this.skeleton.getTransformMatrices(this);Z._ApplySkeleton(v,p,C,a,P,V,K)}}if(!1!==a.updatePositionsArray&&p===t.f.PositionKind){const a=this._internalAbstractMeshDataInfo._positions||[],p=a.length;if(a.length=v.length/3,p<a.length)for(let v=p;v<a.length;v++)a[v]=new L.s;for(let P=0,b=0;P<a.length;P++,b+=3)a[P].qe(v[b],v[b+1],v[b+2]);this._internalAbstractMeshDataInfo._positions=a}return v}getNormalsData(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:a,applyMorph:v,updatePositionsArray:!1},null,t.f.NormalKind)}be(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:a,applyMorph:v,updatePositionsArray:!1},p,t.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new F.d(L.s.Zero(),L.s.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(a){if(!this.rg)return this;const v=this.rg.length;for(let p=0;p<v;p++){const P=this.rg[p];(v>1||!P.IsGlobal)&&P.updateBoundingInfo(a)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(a){return this.getBoundingInfo().isInFrustum(a,this.Oi)}isCompletelyInFrustum(a){return this.getBoundingInfo().isCompletelyInFrustum(a)}intersectsMesh(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;const P=this.getBoundingInfo(),b=a.getBoundingInfo();if(P.intersects(b,v))return!0;if(p)for(const L of this.getChildMeshes())if(L.intersectsMesh(a,v,!0))return!0;return!1}intersectsPoint(a){return this.getBoundingInfo().intersectsPoint(a)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(a){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=a}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(a){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const v=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=v.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,v.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,a,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(a,v,p){var P;if(this._generatePointsArray(),!this._positions)return this;if(!a._lastColliderWorldVertices||!a._lastColliderTransformMatrix.equals(v)){a._lastColliderTransformMatrix=v.clone(),a._lastColliderWorldVertices=[],a._trianglePlanes=[];const p=a.verticesStart,P=a.verticesStart+a.verticesCount;for(let b=p;b<P;b++)a._lastColliderWorldVertices.push(L.s.TransformCoordinates(this._positions[b],v))}return p._collide(a._trianglePlanes,a._lastColliderWorldVertices,this.ng(),a.indexStart,a.indexStart+a.indexCount,a.verticesStart,!!a.Ha(),this,this._shouldConvertRHS(),7===(null===(P=a.Ha())||void 0===P?void 0:P.fillMode)),this}_processCollisionsForSubMeshes(a,v){const p=this._scene.getCollidingSubMeshCandidates(this,a),P=p.length;for(let b=0;b<P;b++){const L=p.data[b];P>1&&!L._checkCollision(a)||this._collideForSubMesh(L,v,a)}return this}_shouldConvertRHS(){return!1}_checkCollision(a){if(!this.getBoundingInfo()._checkCollision(a))return this;const v=L.k.Matrix[0],p=L.k.Matrix[1];return L.e.ScalingToRef(1/a._radius.x,1/a._radius.y,1/a._radius.z,v),this.worldMatrixFromCache.multiplyToRef(v,p),this._processCollisionsForSubMeshes(a,p),this}_generatePointsArray(){return!1}intersects(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=new C.b,K=this.getClassName(),F="InstancedLinesMesh"===K||"LinesMesh"===K||"GreasedLineMesh"===K?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.rg)return V;if(!t&&(!a.intersectsSphere(u.boundingSphere,F)||!a.intersectsBox(u.boundingBox,F)))return V;if(P)return V.hit=!t,V.pickedMesh=t?null:this,V.distance=t?0:L.s.Distance(a.origin,u.boundingSphere.center),V.subMeshId=0,V;if(!this._generatePointsArray())return V;let c=null;const f=this._scene.getIntersectingSubMeshCandidates(this,a),H=f.length;let A=!1;for(let L=0;L<H;L++){const a=f.data[L].Ha();if(a&&(7==a.fillMode||0==a.fillMode||1==a.fillMode||2==a.fillMode||4==a.fillMode)){A=!0;break}}if(!A)return V.hit=!0,V.pickedMesh=this,V.distance=L.s.Distance(a.origin,u.boundingSphere.center),V.subMeshId=-1,V;for(let L=0;L<H;L++){const P=f.data[L];if(H>1&&!t&&!P.canIntersects(a))continue;const b=P.intersects(a,this._positions,this.ng(),v,p);if(b&&(v||!c||b.distance<c.distance)&&(c=b,c.subMeshId=L,v))break}if(c){const v=b??this.getWorldMatrix(),p=L.k.fb[0],P=L.k.fb[1];L.s.TransformCoordinatesToRef(a.origin,v,p),a.direction.scaleToRef(c.distance,P);const t=L.s.TransformNormal(P,v).addInPlace(p);return V.hit=!0,V.distance=L.s.Distance(p,t),V.pickedPoint=t,V.pickedMesh=this,V.bu=c.bu||0,V.bv=c.bv||0,V.subMeshFaceId=c.faceId,V.faceId=c.faceId+f.data[c.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),V.subMeshId=c.subMeshId,V}return V}clone(a,v,p){return null}releaseSubMeshes(){if(this.rg)for(;this.rg.length;)this.rg[0].dispose();else this.rg=[];return this}dispose(a){let v,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const P=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),P.freeActiveMeshes(),P.freeRenderingGroups(),P.renderingManager.maintainStateBetweenFrames&&P.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((a=>a!==this&&a.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),v=0;v<this._intersectionsInProgress.length;v++){const a=this._intersectionsInProgress[v],p=a._intersectionsInProgress.indexOf(this);a._intersectionsInProgress.splice(p,1)}this._intersectionsInProgress.length=0;P.lights.forEach((a=>{let v=a.includedOnlyMeshes.indexOf(this);-1!==v&&a.includedOnlyMeshes.splice(v,1),v=a.excludedMeshes.indexOf(this),-1!==v&&a.excludedMeshes.splice(v,1);const p=a.getShadowGenerators();if(p){const a=p.values();for(let p=a.next();!0!==p.done;p=a.next()){const a=p.value.getShadowMap();a&&a.renderList&&(v=a.renderList.indexOf(this),-1!==v&&a.renderList.splice(v,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const b=P.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,b.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),b.wipeCaches(),P.Qc(this),this._parentContainer){const a=this._parentContainer.meshes.indexOf(this);a>-1&&this._parentContainer.meshes.splice(a,1),this._parentContainer=null}if(p&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!a)for(v=0;v<P.Bj.length;v++)P.Bj[v].j===this&&(P.Bj[v].dispose(),v--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(a,p)}_initFacetData(){const a=this._internalAbstractMeshDataInfo._facetData;a.facetNormals||(a.facetNormals=[]),a.facetPositions||(a.facetPositions=[]),a.facetPartitioning||(a.facetPartitioning=new Array),a.facetNb=this.ng().length/3|0,a.partitioningSubdivisions=a.partitioningSubdivisions?a.partitioningSubdivisions:10,a.partitioningBBoxRatio=a.partitioningBBoxRatio?a.partitioningBBoxRatio:1.01;for(let v=0;v<a.facetNb;v++)a.facetNormals[v]=L.s.Zero(),a.facetPositions[v]=L.s.Zero();return a.facetDataEnabled=!0,this}updateFacetData(){const a=this._internalAbstractMeshDataInfo._facetData;a.facetDataEnabled||this._initFacetData();const v=this.getVerticesData(t.f.PositionKind),p=this.ng(),P=this.getVerticesData(t.f.NormalKind),b=this.getBoundingInfo();if(a.facetDepthSort&&!a.facetDepthSortEnabled){if(a.facetDepthSortEnabled=!0,p instanceof Uint16Array)a.depthSortedIndices=new Uint16Array(p);else if(p instanceof Uint32Array)a.depthSortedIndices=new Uint32Array(p);else{let v=!1;for(let a=0;a<p.length;a++)if(p[a]>65535){v=!0;break}a.depthSortedIndices=v?new Uint32Array(p):new Uint16Array(p)}if(a.facetDepthSortFunction=function(a,v){return v.sqDistance-a.sqDistance},!a.facetDepthSortFrom){const v=this.va().activeCamera;a.facetDepthSortFrom=v?v.position:L.s.Zero()}a.depthSortedFacets=[];for(let v=0;v<a.facetNb;v++){const p={ind:3*v,sqDistance:0};a.depthSortedFacets.push(p)}a.invertedMatrix=L.e.Identity(),a.facetDepthSortOrigin=L.s.Zero()}a.bbSize.x=b.maximum.x-b.minimum.x>h.e?b.maximum.x-b.minimum.x:h.e,a.bbSize.y=b.maximum.y-b.minimum.y>h.e?b.maximum.y-b.minimum.y:h.e,a.bbSize.z=b.maximum.z-b.minimum.z>h.e?b.maximum.z-b.minimum.z:h.e;let K=a.bbSize.x>a.bbSize.y?a.bbSize.x:a.bbSize.y;if(K=K>a.bbSize.z?K:a.bbSize.z,a.subDiv.max=a.partitioningSubdivisions,a.subDiv.X=Math.floor(a.subDiv.max*a.bbSize.x/K),a.subDiv.Y=Math.floor(a.subDiv.max*a.bbSize.y/K),a.subDiv.Z=Math.floor(a.subDiv.max*a.bbSize.z/K),a.subDiv.X=a.subDiv.X<1?1:a.subDiv.X,a.subDiv.Y=a.subDiv.Y<1?1:a.subDiv.Y,a.subDiv.Z=a.subDiv.Z<1?1:a.subDiv.Z,a.facetParameters.facetNormals=this.getFacetLocalNormals(),a.facetParameters.facetPositions=this.getFacetLocalPositions(),a.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),a.facetParameters.bInfo=b,a.facetParameters.bbSize=a.bbSize,a.facetParameters.subDiv=a.subDiv,a.facetParameters.ratio=this.partitioningBBoxRatio,a.facetParameters.depthSort=a.facetDepthSort,a.facetDepthSort&&a.facetDepthSortEnabled&&(this.Zj(!0),this._worldMatrix.invertToRef(a.invertedMatrix),L.s.TransformCoordinatesToRef(a.facetDepthSortFrom,a.invertedMatrix,a.facetDepthSortOrigin),a.facetParameters.distanceTo=a.facetDepthSortOrigin),a.facetParameters.depthSortedFacets=a.depthSortedFacets,P&&V.e.ComputeNormals(v,p,P,a.facetParameters),a.facetDepthSort&&a.facetDepthSortEnabled){a.depthSortedFacets.sort(a.facetDepthSortFunction);const v=a.depthSortedIndices.length/3|0;for(let P=0;P<v;P++){const v=a.depthSortedFacets[P].ind;a.depthSortedIndices[3*P]=p[v],a.depthSortedIndices[3*P+1]=p[v+1],a.depthSortedIndices[3*P+2]=p[v+2]}this.updateIndices(a.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const a=this._internalAbstractMeshDataInfo._facetData;return a.facetNormals||this.updateFacetData(),a.facetNormals}getFacetLocalPositions(){const a=this._internalAbstractMeshDataInfo._facetData;return a.facetPositions||this.updateFacetData(),a.facetPositions}getFacetLocalPartitioning(){const a=this._internalAbstractMeshDataInfo._facetData;return a.facetPartitioning||this.updateFacetData(),a.facetPartitioning}getFacetPosition(a){const v=L.s.Zero();return this.getFacetPositionToRef(a,v),v}getFacetPositionToRef(a,v){const p=this.getFacetLocalPositions()[a],P=this.getWorldMatrix();return L.s.TransformCoordinatesToRef(p,P,v),this}getFacetNormal(a){const v=L.s.Zero();return this.getFacetNormalToRef(a,v),v}getFacetNormalToRef(a,v){const p=this.getFacetLocalNormals()[a];return L.s.TransformNormalToRef(p,this.getWorldMatrix(),v),this}getFacetsAtLocalCoordinates(a,v,p){const P=this.getBoundingInfo(),b=this._internalAbstractMeshDataInfo._facetData,L=Math.floor((a-P.minimum.x*b.partitioningBBoxRatio)*b.subDiv.X*b.partitioningBBoxRatio/b.bbSize.x),t=Math.floor((v-P.minimum.y*b.partitioningBBoxRatio)*b.subDiv.Y*b.partitioningBBoxRatio/b.bbSize.y),V=Math.floor((p-P.minimum.z*b.partitioningBBoxRatio)*b.subDiv.Z*b.partitioningBBoxRatio/b.bbSize.z);return L<0||L>b.subDiv.max||t<0||t>b.subDiv.max||V<0||V>b.subDiv.max?null:b.facetPartitioning[L+b.subDiv.max*t+b.subDiv.max*b.subDiv.max*V]}getClosestFacetAtCoordinates(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const V=this.getWorldMatrix(),K=L.k.Matrix[5];V.invertToRef(K);const C=L.k.fb[8];L.s.TransformCoordinatesFromFloatsToRef(a,v,p,K,C);const F=this.getClosestFacetAtLocalCoordinates(C.x,C.y,C.z,P,b,t);return P&&L.s.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,V,P),F}getClosestFacetAtLocalCoordinates(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=null,V=0,K=0,C=0,F=0,u=0,c=0,f=0,H=0;const A=this.getFacetLocalPositions(),h=this.getFacetLocalNormals(),R=this.getFacetsAtLocalCoordinates(a,v,p);if(!R)return null;let X,Q,s,D=Number.MAX_VALUE,y=D;for(let Z=0;Z<R.length;Z++)X=R[Z],Q=h[X],s=A[X],F=(a-s.x)*Q.x+(v-s.y)*Q.y+(p-s.z)*Q.z,(!b||b&&L&&F>=0||b&&!L&&F<=0)&&(F=Q.x*s.x+Q.y*s.y+Q.z*s.z,u=-(Q.x*a+Q.y*v+Q.z*p-F)/(Q.x*Q.x+Q.y*Q.y+Q.z*Q.z),c=a+Q.x*u,f=v+Q.y*u,H=p+Q.z*u,V=c-a,K=f-v,C=H-p,y=V*V+K*K+C*C,y<D&&(D=y,t=X,P&&(P.x=c,P.y=f,P.z=H)));return t}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const a=this._internalAbstractMeshDataInfo._facetData;return a.facetDataEnabled&&(a.facetDataEnabled=!1,a.facetPositions=[],a.facetNormals=[],a.facetPartitioning=new Array,a.facetParameters=null,a.depthSortedIndices=new Uint32Array(0)),this}updateIndices(a,v){return this}createNormals(a){const v=this.getVerticesData(t.f.PositionKind),p=this.ng();let P;return P=this.isVerticesDataPresent(t.f.NormalKind)?this.getVerticesData(t.f.NormalKind):[],V.e.ComputeNormals(v,p,P,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(t.f.NormalKind,P,a),this}alignWithNormal(a,v){v||(v=R.b.Y);const p=L.k.fb[0],P=L.k.fb[1];return L.s.CrossToRef(v,a,P),L.s.CrossToRef(a,P,p),this.rotationQuaternion?L.i.RotationQuaternionFromAxisToRef(p,a,P,this.rotationQuaternion):L.s.RotationFromAxisToRef(p,a,P,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,f.c)("EdgesRenderer")}enableEdgesRendering(a,v,p){throw(0,f.c)("EdgesRenderer")}Cj(){return this._scene.Bj.filter((a=>a.j===this))}}Z.OCCLUSION_TYPE_NONE=0,Z.OCCLUSION_TYPE_OPTIMISTIC=1,Z.OCCLUSION_TYPE_STRICT=2,Z.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Z.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Z.CULLINGSTRATEGY_STANDARD=0,Z.Pi=1,Z.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Z.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,P.e)([Q.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P,b,L,t,V]=v;return!Array.isArray(P)&&!Array.isArray(b)&&!Array.isArray(L)&&!Array.isArray(t)&&!Array.isArray(V)}))],Z,"_ApplySkeleton",null),(0,X.f)("BABYLON.AbstractMesh",Z)},11532:(a,v,p)=>{"use strict";p.d(v,{c:()=>h});var P=p(11240),b=p(11279),L=p(11528),t=p(11306),V=p(11395),K=p(11536),C=p(11413),F=p(10889),u=p(11234),c=p(11429),f=p(10939),H=p(11470),A=p(10905);class h{get boundingBias(){return this._boundingBias}set boundingBias(a){this._boundingBias?this._boundingBias.p(a):this._boundingBias=a.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(a){const v=new h(h.RandomId(),a.va());return v.Ca(a),v}get meshes(){return this._meshes}constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=v||f.b.LastCreatedScene,this._scene&&(this.id=a,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=P,p?this.setAllVerticesData(p,P):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),b&&(this.Ca(b),b.Zj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let a=0;a<this._meshes.length;a++)if(!this._meshes[a].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const a=new Set;for(const v in this._vertexBuffers)a.add(this._vertexBuffers[v].getWrapperBuffer());a.forEach((a=>{a._rebuild()}))}setAllVerticesData(a,v){a.applyToGeometry(this,v),this._notifyUpdate()}Ga(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;p&&Array.isArray(v)&&(v=new Float32Array(v));const b=new t.f(this._engine,v,a,{updatable:p,postponeInternalCreation:0===this._meshes.length,stride:P,label:"Geometry_"+this.id+"_"+a});this.setVerticesBuffer(b)}removeVerticesData(a){this._vertexBuffers[a]&&(this._vertexBuffers[a].dispose(),delete this._vertexBuffers[a]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const b=a.getKind();this._vertexBuffers[b]&&p&&this._vertexBuffers[b].dispose(),a._buffer&&a._buffer._increaseReferences(),this._vertexBuffers[b]=a;const L=this._meshes,V=L.length;if(b===t.f.PositionKind){this._totalVertices=v??a._maxVerticesCount,this._updateExtend(a.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const p=this._extend&&this._extend.minimum||new P.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),b=this._extend&&this._extend.maximum||new P.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let a=0;a<V;a++){const v=L[a];v.buildBoundingInfo(p,b),v._createGlobalSubMesh(v.isUnIndexed),v.Zj(!0),v.synchronizeInstances()}}this._notifyUpdate(b)}updateVerticesDataDirectly(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=this.getVertexBuffer(a);b&&(b.updateDirectly(v,p,P),this._notifyUpdate(a))}updateVerticesData(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=this.getVertexBuffer(a);P&&(P.update(v),a===t.f.PositionKind&&this.Ea(p,v),this._notifyUpdate(a))}Ea(a,v){if(a&&this._updateExtend(v),this._resetPointsArrayCache(),a){const a=this._meshes;for(const v of a){v.hasBoundingInfo?v.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):v.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const a=v.rg;for(const v of a)v.refreshBoundingInfo()}}}_bind(a,v,p,P){if(!a)return;void 0===v&&(v=this._indexBuffer);const b=this.getVertexBuffers();if(!b)return;if(v!=this._indexBuffer||!this._vertexArrayObjects&&!P)return void this._engine.bindBuffers(b,v,a,p);const L=P||this._vertexArrayObjects,t=this._engine;L[a.key]||(L[a.key]=t.recordVertexArrayObject(b,v,a,p)),t.bindVertexArrayObject(L[a.key],v)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(a,v,p){const P=this.getVertexBuffer(a);return P?P.getFloatData(this._totalVertices,p||v&&1!==this._meshes.length):null}copyVerticesData(a,v){const p=this.getVertexBuffer(a);if(!p)return;v[a]||(v[a]=new Float32Array(this._totalVertices*p.getSize()));const P=p.getData();P&&function(a,v,p,P,b,L,V,K){const C=v*t.f.GetTypeByteLength(p),F=V*v;if(K.length!==F)throw new Error("Output length is not valid");if(p===t.f.FLOAT&&b===C)if(a instanceof Array){const v=P/4;K.set(a,v)}else if(a instanceof ArrayBuffer){const v=new Float32Array(a,P,F);K.set(v)}else{const v=a.byteOffset+P;if(v%4)return A.d.Warn("CopyFloatData: copied misaligned data."),void K.set(new Float32Array(a.buffer.slice(v,v+4*F)));const p=new Float32Array(a.buffer,v,F);K.set(p)}else t.f.ForEach(a,P,b,v,p,F,L,((a,v)=>K[v]=a))}(P,p.getSize(),p.type,p.byteOffset,p.byteStride,p.normalized,this._totalVertices,v[a])}isVertexBufferUpdatable(a){const v=this._vertexBuffers[a];return!!v&&v.isUpdatable()}getVertexBuffer(a){return this.isReady()?this._vertexBuffers[a]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(a){return this._vertexBuffers?void 0!==this._vertexBuffers[a]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(a)}getVerticesDataKinds(){const a=[];let v;if(!this._vertexBuffers&&this._delayInfo)for(v in this._delayInfo)a.push(v);else for(v in this._vertexBuffers)a.push(v);return a}updateIndices(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const P=a.length!==this._indices.length;if(p||(this._indices=a.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,a,v),P)for(const a of this._meshes)a._createGlobalSubMesh(!0)}else this.setIndices(a,null,!0)}setIndexBuffer(a,v,p){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=a,this._totalVertices=v,this._totalIndices=p,a.is32Bits||(a.is32Bits=this._totalIndices>65535);for(const P of this._meshes)P._createGlobalSubMesh(!0),P.synchronizeInstances();this._notifyUpdate()}setIndices(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=a,this._indexBufferIsUpdatable=p,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,p,"Geometry_"+this.id+"_IndexBuffer")),void 0!=v&&(this._totalVertices=v);for(const b of this._meshes)b._createGlobalSubMesh(!P),b.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}ng(a,v){if(!this.isReady())return null;const p=this._indices;return v||a&&1!==this._meshes.length?p.slice():p}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a&&this._vertexArrayObjects&&this._vertexArrayObjects[a.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[a.key]),delete this._vertexArrayObjects[a.key])}releaseForMesh(a,v){const p=this._meshes,P=p.indexOf(a);-1!==P&&(p.splice(P,1),this._vertexArrayObjects&&a._invalidateInstanceVertexArrayObject(),a._geometry=null,0===p.length&&v&&this.dispose())}Ca(a){if(a._geometry===this)return;const v=a._geometry;v&&v.releaseForMesh(a),this._vertexArrayObjects&&a._invalidateInstanceVertexArrayObject();const p=this._meshes;a._geometry=this,a._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),p.push(a),this.isReady()?this._applyToMesh(a):this._boundingInfo&&a.setBoundingInfo(this._boundingInfo)}_updateExtend(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!a&&(a=this.getVerticesData(t.f.PositionKind),!a))return;this._extend=(0,c.g)(a,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(a){const v=this._meshes.length;for(const p in this._vertexBuffers)1===v&&this._vertexBuffers[p].create(),p===t.f.PositionKind&&(this._extend||this._updateExtend(),a.buildBoundingInfo(this._extend.minimum,this._extend.maximum),a._createGlobalSubMesh(a.isUnIndexed),a.Ea());1===v&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),a._syncGeometryWithMorphTargetManager(),a.synchronizeInstances()}_notifyUpdate(a){this.onGeometryUpdated&&this.onGeometryUpdated(this,a),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const v of this._meshes)v._markSubMeshesAsAttributesDirty()}load(a,v){2!==this.delayLoadState&&(this.isReady()?v&&v():(this.delayLoadState=2,this._queueLoad(a,v)))}_queueLoad(a,v){this.delayLoadingFile&&(a.addPendingData(this),a._loadFile(this.delayLoadingFile,(p=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(p),this),this.delayLoadState=1,this._delayInfo=[],a.removePendingData(this);const P=this._meshes,b=P.length;for(let a=0;a<b;a++)this._applyToMesh(P[a]);v&&v()}),void 0,!0))}toLeftHanded(){const a=this.ng(!1);if(null!=a&&a.length>0){for(let v=0;v<a.length;v+=3){const p=a[v+0];a[v+0]=a[v+2],a[v+2]=p}this.setIndices(a)}const v=this.getVerticesData(t.f.PositionKind,!1);if(null!=v&&v.length>0){for(let a=0;a<v.length;a+=3)v[a+2]=-v[a+2];this.Ga(t.f.PositionKind,v,!1)}const p=this.getVerticesData(t.f.NormalKind,!1);if(null!=p&&p.length>0){for(let a=0;a<p.length;a+=3)p[a+2]=-p[a+2];this.Ga(t.f.NormalKind,p,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const a=this.getVerticesData(t.f.PositionKind);if(!a||0===a.length)return!1;for(let v=3*this._positionsCache.length,p=this._positionsCache.length;v<a.length;v+=3,++p)this._positionsCache[p]=P.s.bh(a,v);for(let v=0,p=0;v<a.length;v+=3,++p)this._positionsCache[p].set(a[0+v],a[1+v],a[2+v]);return this._positionsCache.length=a.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const p in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[p]);this._vertexArrayObjects={};const a=this._meshes,v=a.length;for(let p=0;p<v;p++)a[p]._invalidateInstanceVertexArrayObject()}}dispose(){const a=this._meshes,v=a.length;let p;for(p=0;p<v;p++)this.releaseForMesh(a[p]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const P in this._vertexBuffers)this._vertexBuffers[P].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const a=this._parentContainer.geometries.indexOf(this);a>-1&&this._parentContainer.geometries.splice(a,1),this._parentContainer=null}this._isDisposed=!0}i(a){const v=new L.e;v.indices=[];const p=this.ng();if(p)for(let L=0;L<p.length;L++)v.indices.push(p[L]);let P,b=!1,t=!1;for(P in this._vertexBuffers){const a=this.getVerticesData(P);if(a&&(a instanceof Float32Array?v.set(new Float32Array(a),P):v.set(a.slice(0),P),!t)){const a=this.getVertexBuffer(P);a&&(b=a.isUpdatable(),t=!b)}}const V=new h(a,this._scene,v,b);for(P in V.delayLoadState=this.delayLoadState,V.delayLoadingFile=this.delayLoadingFile,V._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)V._delayInfo=V._delayInfo||[],V._delayInfo.push(P);return V._boundingInfo=new C.d(this._extend.minimum,this._extend.maximum),V}serialize(){const a={};return a.id=this.id,a.uniqueId=this.uniqueId,a.updatable=this._updatable,u.c&&u.c.HasTags(this)&&(a.tags=u.c.GetTags(this)),a}_toNumberArray(a){return Array.isArray(a)?a:Array.prototype.slice.call(a)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const a in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,a)&&(this._vertexBuffers[a]._buffer._data=null)}serializeVerticeData(){const a=this.serialize();return this.isVerticesDataPresent(t.f.PositionKind)&&(a.xa=this._toNumberArray(this.getVerticesData(t.f.PositionKind)),this.isVertexBufferUpdatable(t.f.PositionKind)&&(a.xa._updatable=!0)),this.isVerticesDataPresent(t.f.NormalKind)&&(a.ya=this._toNumberArray(this.getVerticesData(t.f.NormalKind)),this.isVertexBufferUpdatable(t.f.NormalKind)&&(a.ya._updatable=!0)),this.isVerticesDataPresent(t.f.TangentKind)&&(a.tangents=this._toNumberArray(this.getVerticesData(t.f.TangentKind)),this.isVertexBufferUpdatable(t.f.TangentKind)&&(a.tangents._updatable=!0)),this.isVerticesDataPresent(t.f.UVKind)&&(a.Aa=this._toNumberArray(this.getVerticesData(t.f.UVKind)),this.isVertexBufferUpdatable(t.f.UVKind)&&(a.Aa._updatable=!0)),this.isVerticesDataPresent(t.f.UV2Kind)&&(a.uvs2=this._toNumberArray(this.getVerticesData(t.f.UV2Kind)),this.isVertexBufferUpdatable(t.f.UV2Kind)&&(a.uvs2._updatable=!0)),this.isVerticesDataPresent(t.f.UV3Kind)&&(a.uvs3=this._toNumberArray(this.getVerticesData(t.f.UV3Kind)),this.isVertexBufferUpdatable(t.f.UV3Kind)&&(a.uvs3._updatable=!0)),this.isVerticesDataPresent(t.f.UV4Kind)&&(a.uvs4=this._toNumberArray(this.getVerticesData(t.f.UV4Kind)),this.isVertexBufferUpdatable(t.f.UV4Kind)&&(a.uvs4._updatable=!0)),this.isVerticesDataPresent(t.f.UV5Kind)&&(a.uvs5=this._toNumberArray(this.getVerticesData(t.f.UV5Kind)),this.isVertexBufferUpdatable(t.f.UV5Kind)&&(a.uvs5._updatable=!0)),this.isVerticesDataPresent(t.f.UV6Kind)&&(a.uvs6=this._toNumberArray(this.getVerticesData(t.f.UV6Kind)),this.isVertexBufferUpdatable(t.f.UV6Kind)&&(a.uvs6._updatable=!0)),this.isVerticesDataPresent(t.f.ColorKind)&&(a.za=this._toNumberArray(this.getVerticesData(t.f.ColorKind)),this.isVertexBufferUpdatable(t.f.ColorKind)&&(a.za._updatable=!0)),this.isVerticesDataPresent(t.f.MatricesIndicesKind)&&(a.matricesIndices=this._toNumberArray(this.getVerticesData(t.f.MatricesIndicesKind)),a.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(t.f.MatricesIndicesKind)&&(a.matricesIndices._updatable=!0)),this.isVerticesDataPresent(t.f.MatricesWeightsKind)&&(a.matricesWeights=this._toNumberArray(this.getVerticesData(t.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(t.f.MatricesWeightsKind)&&(a.matricesWeights._updatable=!0)),a.indices=this._toNumberArray(this.ng()),a}static ExtractFromMesh(a,v){const p=a._geometry;return p?p.i(v):null}static RandomId(){return F.e.RandomId()}static _GetGeometryByLoadedUniqueId(a,v){for(let p=0;p<v.geometries.length;p++)if(v.geometries[p]._loadedUniqueId===a)return v.geometries[p];return null}static _ImportGeometry(a,v){const p=v.va(),P=a.geometryUniqueId,L=a.geometryId;if(P||L){const a=P?this._GetGeometryByLoadedUniqueId(P,p):p.getGeometryById(L);a&&a.Ca(v)}else if(a instanceof ArrayBuffer){const p=v._binaryInfo;if(p.positionsAttrDesc&&p.positionsAttrDesc.count>0){const P=new Float32Array(a,p.positionsAttrDesc.offset,p.positionsAttrDesc.count);v.Ga(t.f.PositionKind,P,!1)}if(p.normalsAttrDesc&&p.normalsAttrDesc.count>0){const P=new Float32Array(a,p.normalsAttrDesc.offset,p.normalsAttrDesc.count);v.Ga(t.f.NormalKind,P,!1)}if(p.tangetsAttrDesc&&p.tangetsAttrDesc.count>0){const P=new Float32Array(a,p.tangetsAttrDesc.offset,p.tangetsAttrDesc.count);v.Ga(t.f.TangentKind,P,!1)}if(p.uvsAttrDesc&&p.uvsAttrDesc.count>0){const P=new Float32Array(a,p.uvsAttrDesc.offset,p.uvsAttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UVKind,P,!1)}if(p.uvs2AttrDesc&&p.uvs2AttrDesc.count>0){const P=new Float32Array(a,p.uvs2AttrDesc.offset,p.uvs2AttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UV2Kind,P,!1)}if(p.uvs3AttrDesc&&p.uvs3AttrDesc.count>0){const P=new Float32Array(a,p.uvs3AttrDesc.offset,p.uvs3AttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UV3Kind,P,!1)}if(p.uvs4AttrDesc&&p.uvs4AttrDesc.count>0){const P=new Float32Array(a,p.uvs4AttrDesc.offset,p.uvs4AttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UV4Kind,P,!1)}if(p.uvs5AttrDesc&&p.uvs5AttrDesc.count>0){const P=new Float32Array(a,p.uvs5AttrDesc.offset,p.uvs5AttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UV5Kind,P,!1)}if(p.uvs6AttrDesc&&p.uvs6AttrDesc.count>0){const P=new Float32Array(a,p.uvs6AttrDesc.offset,p.uvs6AttrDesc.count);if(H.b)for(let a=1;a<P.length;a+=2)P[a]=1-P[a];v.Ga(t.f.UV6Kind,P,!1)}if(p.colorsAttrDesc&&p.colorsAttrDesc.count>0){const P=new Float32Array(a,p.colorsAttrDesc.offset,p.colorsAttrDesc.count);v.Ga(t.f.ColorKind,P,!1,p.colorsAttrDesc.stride)}if(p.matricesIndicesAttrDesc&&p.matricesIndicesAttrDesc.count>0){const P=new Int32Array(a,p.matricesIndicesAttrDesc.offset,p.matricesIndicesAttrDesc.count),b=[];for(let a=0;a<P.length;a++){const v=P[a];b.push(255&v),b.push((65280&v)>>8),b.push((16711680&v)>>16),b.push(v>>24&255)}v.Ga(t.f.MatricesIndicesKind,b,!1)}if(p.matricesIndicesExtraAttrDesc&&p.matricesIndicesExtraAttrDesc.count>0){const P=new Int32Array(a,p.matricesIndicesExtraAttrDesc.offset,p.matricesIndicesExtraAttrDesc.count),b=[];for(let a=0;a<P.length;a++){const v=P[a];b.push(255&v),b.push((65280&v)>>8),b.push((16711680&v)>>16),b.push(v>>24&255)}v.Ga(t.f.MatricesIndicesExtraKind,b,!1)}if(p.matricesWeightsAttrDesc&&p.matricesWeightsAttrDesc.count>0){const P=new Float32Array(a,p.matricesWeightsAttrDesc.offset,p.matricesWeightsAttrDesc.count);v.Ga(t.f.MatricesWeightsKind,P,!1)}if(p.indicesAttrDesc&&p.indicesAttrDesc.count>0){const P=new Int32Array(a,p.indicesAttrDesc.offset,p.indicesAttrDesc.count);v.setIndices(P,null)}if(p.subMeshesAttrDesc&&p.subMeshesAttrDesc.count>0){const P=new Int32Array(a,p.subMeshesAttrDesc.offset,5*p.subMeshesAttrDesc.count);v.rg=[];for(let a=0;a<p.subMeshesAttrDesc.count;a++){const p=P[5*a+0],b=P[5*a+1],L=P[5*a+2],t=P[5*a+3],K=P[5*a+4];V.d.AddToMesh(p,b,L,t,K,v)}}}else if(a.xa&&a.ya&&a.indices){if(v.Ga(t.f.PositionKind,a.xa,a.xa._updatable),v.Ga(t.f.NormalKind,a.ya,a.ya._updatable),a.tangents&&v.Ga(t.f.TangentKind,a.tangents,a.tangents._updatable),a.Aa&&v.Ga(t.f.UVKind,a.Aa,a.Aa._updatable),a.uvs2&&v.Ga(t.f.UV2Kind,a.uvs2,a.uvs2._updatable),a.uvs3&&v.Ga(t.f.UV3Kind,a.uvs3,a.uvs3._updatable),a.uvs4&&v.Ga(t.f.UV4Kind,a.uvs4,a.uvs4._updatable),a.uvs5&&v.Ga(t.f.UV5Kind,a.uvs5,a.uvs5._updatable),a.uvs6&&v.Ga(t.f.UV6Kind,a.uvs6,a.uvs6._updatable),a.za&&v.Ga(t.f.ColorKind,b.e.CheckColors4(a.za,a.xa.length/3),a.za._updatable),a.matricesIndices)if(a.matricesIndices._isExpanded)delete a.matricesIndices._isExpanded,v.Ga(t.f.MatricesIndicesKind,a.matricesIndices,a.matricesIndices._updatable);else{const p=[];for(let v=0;v<a.matricesIndices.length;v++){const P=a.matricesIndices[v];p.push(255&P),p.push((65280&P)>>8),p.push((16711680&P)>>16),p.push(P>>24&255)}v.Ga(t.f.MatricesIndicesKind,p,a.matricesIndices._updatable)}if(a.matricesIndicesExtra)if(a.matricesIndicesExtra._isExpanded)delete a.matricesIndices._isExpanded,v.Ga(t.f.MatricesIndicesExtraKind,a.matricesIndicesExtra,a.matricesIndicesExtra._updatable);else{const p=[];for(let v=0;v<a.matricesIndicesExtra.length;v++){const P=a.matricesIndicesExtra[v];p.push(255&P),p.push((65280&P)>>8),p.push((16711680&P)>>16),p.push(P>>24&255)}v.Ga(t.f.MatricesIndicesExtraKind,p,a.matricesIndicesExtra._updatable)}a.matricesWeights&&(h._CleanMatricesWeights(a,v),v.Ga(t.f.MatricesWeightsKind,a.matricesWeights,a.matricesWeights._updatable)),a.matricesWeightsExtra&&v.Ga(t.f.MatricesWeightsExtraKind,a.matricesWeightsExtra,a.matricesWeights._updatable),v.setIndices(a.indices,null)}if(a.rg){v.rg=[];for(let p=0;p<a.rg.length;p++){const P=a.rg[p];V.d.AddToMesh(P.materialIndex,P.verticesStart,P.verticesCount,P.indexStart,P.indexCount,v)}}v._shouldGenerateFlatShading&&(v.convertToFlatShadedMesh(),v._shouldGenerateFlatShading=!1),v.Zj(!0),p.onMeshImportedObservable.notifyObservers(v)}static _CleanMatricesWeights(a,v){const p=.001;if(!K.b.CleanBoneMatrixWeights)return;let P=0;if(!(a.skeletonId>-1))return;{const p=v.va().getLastSkeletonById(a.skeletonId);if(!p)return;P=p.bones.length}const b=v.getVerticesData(t.f.MatricesIndicesKind),L=v.getVerticesData(t.f.MatricesIndicesExtraKind),V=a.matricesWeights,C=a.matricesWeightsExtra,F=a.numBoneInfluencer,u=V.length;for(let t=0;t<u;t+=4){let a=0,v=-1;for(let P=0;P<4;P++){const b=V[t+P];a+=b,b<p&&v<0&&(v=P)}if(C)for(let P=0;P<4;P++){const b=C[t+P];a+=b,b<p&&v<0&&(v=P+4)}if((v<0||v>F-1)&&(v=F-1),a>p){const v=1/a;for(let a=0;a<4;a++)V[t+a]*=v;if(C)for(let a=0;a<4;a++)C[t+a]*=v}else v>=4?(C[t+v-4]=1-a,L[t+v-4]=P):(V[t+v]=1-a,b[t+v]=P)}v.Ga(t.f.MatricesIndicesKind,b),a.matricesWeightsExtra&&v.Ga(t.f.MatricesIndicesExtraKind,L)}static Parse(a,v,p){const b=new h(a.id,v,void 0,a.updatable);return b._loadedUniqueId=a.uniqueId,u.c&&u.c.AddTagsTo(b,a.tags),a.delayLoadingFile?(b.delayLoadState=4,b.delayLoadingFile=p+a.delayLoadingFile,b._boundingInfo=new C.d(P.s.bh(a.boundingBoxMinimum),P.s.bh(a.boundingBoxMaximum)),b._delayInfo=[],a.hasUVs&&b._delayInfo.push(t.f.UVKind),a.hasUVs2&&b._delayInfo.push(t.f.UV2Kind),a.hasUVs3&&b._delayInfo.push(t.f.UV3Kind),a.hasUVs4&&b._delayInfo.push(t.f.UV4Kind),a.hasUVs5&&b._delayInfo.push(t.f.UV5Kind),a.hasUVs6&&b._delayInfo.push(t.f.UV6Kind),a.hasColors&&b._delayInfo.push(t.f.ColorKind),a.hasMatricesIndices&&b._delayInfo.push(t.f.MatricesIndicesKind),a.hasMatricesWeights&&b._delayInfo.push(t.f.MatricesWeightsKind),b._delayLoadingFunction=L.e.ImportVertexData):L.e.ImportVertexData(a,b),v.pushGeometry(b,!0),b}}},12450:(a,v,p)=>{"use strict";p.d(v,{b:()=>c});var P=p(11240),b=p(10905),L=p(11539),t=p(11504),V=p(10911),K=p(11544),C=p(11306),F=p(10889),u=p(11027);t.b._instancedMeshFactory=(a,v)=>{const p=new c(a,v);if(v.instancedBuffers){p.instancedBuffers={};for(const a in v.instancedBuffers)p.instancedBuffers[a]=v.instancedBuffers[a]}return p};class c extends L.e{constructor(a,v){super(a,v.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,v.Rj(this),this._sourceMesh=v,this._unIndexed=v._unIndexed,this.position.p(v.position),this.rotation.p(v.rotation),this.te.p(v.te),v.rotationQuaternion&&(this.rotationQuaternion=v.rotationQuaternion.clone()),this.animations=v.animations.slice();for(const p of v.getAnimationRanges())null!=p&&this.createAnimationRange(p.name,p.from,p.to);this.infiniteDistance=v.infiniteDistance,this.setPivotMatrix(v.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(a){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.receiveShadows)!==a&&F.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(a){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.material)!==a&&F.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(a){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.visibility)!==a&&F.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(a){var v;(null===(v=this._sourceMesh)||void 0===v?void 0:v.skeleton)!==a&&F.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(a){this._sourceMesh&&a!==this._sourceMesh.renderingGroupId&&b.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(a){return this._sourceMesh.createInstance(a)}isReady(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(a,!0)}getVerticesData(a,v,p){return this._sourceMesh.getVerticesData(a,v,p)}copyVerticesData(a,v){this._sourceMesh.copyVerticesData(a,v)}Ga(a,v,p,P){return this.sourceMesh&&this.sourceMesh.Ga(a,v,p,P),this.sourceMesh}updateVerticesData(a,v,p,P){return this.sourceMesh&&this.sourceMesh.updateVerticesData(a,v,p,P),this.sourceMesh}setIndices(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(a,v),this.sourceMesh}isVerticesDataPresent(a){return this._sourceMesh.isVerticesDataPresent(a)}ng(){return this._sourceMesh.ng()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let a,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;a="object"===typeof v?v:{applySkeleton:v,applyMorph:p};const P=this._sourceMesh.Oj?this._sourceMesh.Oj.boundingBias:null;return this.Fa(this._sourceMesh._getData(a,null,C.f.PositionKind),P),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(a,v){if(super._activate(a,v),this._sourceMesh.rg||b.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,a),v){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==K.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new P.e);const a=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,P.k.fb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Zj(!0)),this._currentLOD.position.p(P.k.fb[7]),this._currentLOD._masterMesh=a,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(a){if(!a)return this;const v=this.sourceMesh.getLODLevels();if(v&&0!==v.length){const v=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(a,v.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(a){return this.sourceMesh._preActivateForIntermediateRendering(a)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.rg)for(let a=0;a<this._sourceMesh.rg.length;a++)this._sourceMesh.rg[a].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;const P=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(a);if(V.b.DeepCopy(this,P,["name","rg","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Aj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),v&&(P.parent=v),!p)for(let b=0;b<this.va().meshes.length;b++){const a=this.va().meshes[b];a.parent===this&&a.clone(a.name,P)}return P.Zj(!0),this.onClonedObservable.notifyObservers(P),P}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Qj(this),super.dispose(a,v)}_serializeAsParent(a){super._serializeAsParent(a),a.parentId=this._sourceMesh.uniqueId,a.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;const P=this.clone("Clone of "+(this.name||this.id),a||this.parent,!0,v&&v.newSourcedMesh);P&&p&&p(this,P);for(const b of this.getChildTransformNodes(!0))b.instantiateHierarchy(P,v,p);return P}}t.b.prototype.registerInstancedBuffer=function(a,v){var p,P;if(null===(p=this._userInstancedBuffersStorage)||void 0===p||null===(P=p.vertexBuffers[a])||void 0===P||P.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const a of this.instances)a.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[a]=null,this._userInstancedBuffersStorage.strides[a]=v,this._userInstancedBuffersStorage.sizes[a]=32*v,this._userInstancedBuffersStorage.data[a]=new Float32Array(this._userInstancedBuffersStorage.sizes[a]),this._userInstancedBuffersStorage.vertexBuffers[a]=new C.f(this.getEngine(),this._userInstancedBuffersStorage.data[a],a,!0,!1,v,!0);for(const b of this.instances)b.instancedBuffers[a]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},t.b.prototype._processInstancedBuffers=function(a,v){const p=a?a.length:0;for(const P in this.instancedBuffers){let b=this._userInstancedBuffersStorage.sizes[P];const L=this._userInstancedBuffersStorage.strides[P],t=(p+1)*L;for(;b<t;)b*=2;this._userInstancedBuffersStorage.data[P].length!=b&&(this._userInstancedBuffersStorage.data[P]=new Float32Array(b),this._userInstancedBuffersStorage.sizes[P]=b,this._userInstancedBuffersStorage.vertexBuffers[P]&&(this._userInstancedBuffersStorage.vertexBuffers[P].dispose(),this._userInstancedBuffersStorage.vertexBuffers[P]=null));const V=this._userInstancedBuffersStorage.data[P];let K=0;if(v){const a=this.instancedBuffers[P];a.toArray?a.toArray(V,K):a.copyToArray?a.copyToArray(V,K):V[K]=a,K+=L}for(let v=0;v<p;v++){const p=a[v].instancedBuffers[P];p.toArray?p.toArray(V,K):p.copyToArray?p.copyToArray(V,K):V[K]=p,K+=L}this._userInstancedBuffersStorage.vertexBuffers[P]?this._userInstancedBuffersStorage.vertexBuffers[P].updateDirectly(V,0):(this._userInstancedBuffersStorage.vertexBuffers[P]=new C.f(this.getEngine(),this._userInstancedBuffersStorage.data[P],P,!0,!1,L,!0),this._invalidateInstanceVertexArrayObject())}},t.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const a in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[a]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},t.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const a in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[a]&&this._userInstancedBuffersStorage.vertexBuffers[a].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,u.f)("BABYLON.InstancedMesh",c)},11504:(a,v,p)=>{"use strict";p.d(v,{b:()=>J,f:()=>n});var P=p(10893),b=p(10889),L=p(10911),t=p(11234),V=p(11506),K=p(11512),C=p(11240),F=p(11279),u=p(11515),c=p(11306),f=p(11528),H=p(11532),A=p(11539),h=p(11395),R=p(11390),X=p(11552),Q=p(11536),s=p(11287),D=p(10905),y=p(11027),Z=p(10926),M=p(11332);class S{constructor(a,v){this.distanceOrScreenCoverage=a,this.mesh=v}}class n{}class q{constructor(){this.visibleInstances={},this.batchCache=new T,this.batchCacheReplacementModeInFrozenMode=new T,this.instancesBufferSize=2048}}class T{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class j{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class w{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class J extends A.e{static _GetDefaultSideOrientation(a){return a||J.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(a){this._internalMeshDataInfo._useLODScreenCoverage=a,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(a){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==a&&(a&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(c.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(c.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=a,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new P.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new P.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new P.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new P.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new P.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(a){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(a)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(a){this._internalMeshDataInfo._forcedInstanceCount=a}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(a){this._internalMeshDataInfo._sideOrientation=a,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===a||!this._scene.useRightHandedSystem&&0===a}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(a){this.sideOrientation=a,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(a){this._internalMeshDataInfo._overrideRenderingFillMode=a}get material(){return this._internalAbstractMeshDataInfo._material}set material(a){a&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(a.sideOrientation=null),this._setMaterial(a)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(a){this._unIndexed!==a&&(this._unIndexed=a,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(a){this._instanceDataStorage.manualUpdate=a}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(a){this._instanceDataStorage.previousManualUpdate=a}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(a){this._instanceDataStorage.forceMatrixUpdates=a}_copySource(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const P=this.va();if(a._geometry&&a._geometry.Ca(this),L.b.DeepCopy(a,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Oj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Aj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=a,P.useClonedMeshMap&&(a._internalMeshDataInfo.meshMap||(a._internalMeshDataInfo.meshMap={}),a._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=a._originalBuilderSideOrientation,this._creationDataStorage=a._creationDataStorage,a._ranges){const v=a._ranges;for(const a in v)Object.prototype.hasOwnProperty.call(v,a)&&v[a]&&this.createAnimationRange(a,v[a].from,v[a].to)}if(a.metadata&&a.metadata.clone?this.metadata=a.metadata.clone():this.metadata=a.metadata,this._internalMetadata=a._internalMetadata,t.c&&t.c.HasTags(a)&&t.c.AddTagsTo(this,t.c.GetTags(a,!0)),this.Mb(a.isEnabled(!1)),this.parent=a.parent,this.setPivotMatrix(a.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+a.id,this.material=a.material,!v){const v=a.getDescendants(!0);for(let a=0;a<v.length;a++){const p=v[a];p.clone&&p.clone(this.name+"."+p.name,this)}}if(a.morphTargetManager&&(this.morphTargetManager=a.morphTargetManager),P.getPhysicsEngine){const v=P.getPhysicsEngine();if(p&&v)if(1===v.getPluginVersion()){const p=v.getImpostorForPhysicsObject(a);p&&(this.physicsImpostor=p.clone(this))}else 2===v.getPluginVersion()&&a.physicsBody&&a.physicsBody.clone(this)}for(let b=0;b<P.Bj.length;b++){const v=P.Bj[b];v.j===a&&v.clone(v.name,this)}this.skeleton=a.skeleton,this.refreshBoundingInfo(!0,!0),this.Zj(!0)}constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4?arguments[4]:void 0,t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(a,v),this._internalMeshDataInfo=new w,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new q,this._thinInstanceDataStorage=new j,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=J.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,v=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(a,v,p)=>{a&&p&&(this._uniformBuffer?this.transferToEffect(v):p.bindOnlyWorldMatrix(v))},b&&this._copySource(b,L,t),null!==p&&(this.parent=p),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=a=>{a.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new P.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),b&&b.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;const P=0===this.getTotalVertices()||v&&v.doNotInstantiate&&(!0===v.doNotInstantiate||v.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),a||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));P.parent=a||this.parent,P.position=this.position.clone(),P.te=this.te.clone(),this.rotationQuaternion?P.rotationQuaternion=this.rotationQuaternion.clone():P.rotation=this.rotation.clone(),p&&p(this,P);for(const b of this.getChildTransformNodes(!0))"InstancedMesh"===b.getClassName()&&"Mesh"===P.getClassName()&&b.sourceMesh===this?b.instantiateHierarchy(P,{doNotInstantiate:v&&v.doNotInstantiate||!1,newSourcedMesh:P},p):b.instantiateHierarchy(P,v,p);return P}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(a){let v=super.toString(a);if(v+=", n vertices: "+this.getTotalVertices(),v+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let p=0;p<this.animations.length;p++)v+=", animation[0]: "+this.animations[p].toString(a);if(a)if(this._geometry){const a=this.ng(),p=this.getVerticesData(c.f.PositionKind);p&&a&&(v+=", flat shading: "+(p.length/3===a.length?"YES":"NO"))}else v+=", flat shading: UNKNOWN";return v}_unBindEffect(){super._unBindEffect();for(const a of this.instances)a._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const a=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((v,p)=>v.distanceOrScreenCoverage<p.distanceOrScreenCoverage?a:v.distanceOrScreenCoverage>p.distanceOrScreenCoverage?-a:0))}addLODLevel(a,v){if(v&&v._masterMesh)return D.d.Warn("You cannot use a mesh as LOD level twice"),this;const p=new S(a,v);return this._internalMeshDataInfo._LODLevels.push(p),v&&(v._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(a){const v=this._internalMeshDataInfo;for(let p=0;p<v._LODLevels.length;p++){const P=v._LODLevels[p];if(P.distanceOrScreenCoverage===a)return P.mesh}return null}removeLODLevel(a){const v=this._internalMeshDataInfo;for(let p=0;p<v._LODLevels.length;p++)v._LODLevels[p].mesh===a&&(v._LODLevels.splice(p,1),a&&(a._masterMesh=null));return this._sortLODLevels(),this}getLOD(a,v){const p=this._internalMeshDataInfo;if(!p._LODLevels||0===p._LODLevels.length)return this;const P=v||this.getBoundingInfo().boundingSphere,b=a.mode===K.e.ORTHOGRAPHIC_CAMERA?a.fj:P.centerWorld.od(a.globalPosition).length();let L=b,t=1;if(p._useLODScreenCoverage){const v=a.screenArea;let p=P.radiusWorld*a.fj/b;p=p*p*Math.PI,L=p/v,t=-1}if(t*p._LODLevels[p._LODLevels.length-1].distanceOrScreenCoverage>t*L)return this.onLODLevelSelection&&this.onLODLevelSelection(L,this,this),this;for(let V=0;V<p._LODLevels.length;V++){const a=p._LODLevels[V];if(t*a.distanceOrScreenCoverage<t*L){if(a.mesh){if(4===a.mesh.delayLoadState)return a.mesh._checkDelayState(),this;if(2===a.mesh.delayLoadState)return this;a.mesh._preActivate(),a.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(L,this,a.mesh),a.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(L,this,this),this}get Oj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(a,v,p,P){var b,L;if(!this._geometry)return null;let t=P||null===(b=this._userInstancedBuffersStorage)||void 0===b||null===(L=b.vertexBuffers[a])||void 0===L?void 0:L.getFloatData(this.instances.length+1,p||v&&1!==this._geometry.meshes.length);return t||(t=this._geometry.getVerticesData(a,v,p)),t}copyVerticesData(a,v){this._geometry&&this._geometry.copyVerticesData(a,v)}getVertexBuffer(a,v){var p;return this._geometry?(v||null===(p=this._userInstancedBuffersStorage)||void 0===p?void 0:p.vertexBuffers[a])??this._geometry.getVertexBuffer(a):null}isVerticesDataPresent(a,v){var p;return this._geometry?!v&&void 0!==(null===(p=this._userInstancedBuffersStorage)||void 0===p?void 0:p.vertexBuffers[a])||this._geometry.isVerticesDataPresent(a):!!this._delayInfo&&-1!==this._delayInfo.indexOf(a)}isVertexBufferUpdatable(a,v){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(a);if(!v){var p;const v=null===(p=this._userInstancedBuffersStorage)||void 0===p?void 0:p.vertexBuffers[a];if(v)return v.isUpdatable()}return this._geometry.isVertexBufferUpdatable(a)}getVerticesDataKinds(a){if(!this._geometry){const a=[];return this._delayInfo&&this._delayInfo.forEach((function(v){a.push(v)})),a}const v=this._geometry.getVerticesDataKinds();if(!a&&this._userInstancedBuffersStorage)for(const p in this._userInstancedBuffersStorage.vertexBuffers)-1===v.indexOf(p)&&v.push(p);return v}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}ng(a,v){return this._geometry?this._geometry.ng(a,v):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(a))return!1;if(!this.rg||0===this.rg.length)return!0;if(!a)return!0;const p=this.getEngine(),P=this.va(),b=v||p.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Zj();const L=this.material||P.defaultMaterial;if(L)if(L._storeEffectOnSubMeshes)for(const c of this.rg){const a=c.Ha();if(a)if(a._storeEffectOnSubMeshes){if(!a.isReadyForSubMesh(this,c,b))return!1}else if(!a.isReady(this,b))return!1}else if(!L.isReady(this,b))return!1;const t=p.currentRenderPassId;for(const c of this.lightSources){const a=c.getShadowGenerators();if(!a)continue;const v=a.values();for(let P=v.next();!0!==P.done;P=v.next()){var V,K,C,F;const a=P.value;if(a&&(null===(V=a.getShadowMap())||void 0===V||!V.renderList||null!==(K=a.getShadowMap())&&void 0!==K&&K.renderList&&-1!==(null===(C=a.getShadowMap())||void 0===C||null===(F=C.renderList)||void 0===F?void 0:F.indexOf(this)))){const v=a.getShadowMap().renderPassIds??[p.currentRenderPassId];for(let P=0;P<v.length;++P){p.currentRenderPassId=v[P];for(const v of this.rg){var u;if(!a.isReady(v,b,(null===(u=v.Ha())||void 0===u?void 0:u.needAlphaBlendingForMesh(this))??!1))return p.currentRenderPassId=t,!1}}p.currentRenderPassId=t}}}for(const c of this._internalMeshDataInfo._LODLevels)if(c.mesh&&!c.mesh.isReady(b))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Wh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(a){this._instanceDataStorage.overridenInstanceCount=a}_preActivate(){const a=this._internalMeshDataInfo,v=this.va().getRenderId();return a._preActivateId===v||(a._preActivateId=v,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(a){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=a),this}_registerInstanceForRenderId(a,v){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:v,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[v]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=v,this._instanceDataStorage.visibleInstances[v]=new Array),this._instanceDataStorage.visibleInstances[v].push(a),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let a,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;a="object"===typeof v?v:{applySkeleton:v,applyMorph:p};const P=this.Oj?this.Oj.boundingBias:null;return this.Fa(this._getData(a,null,c.f.PositionKind),P),this}_createGlobalSubMesh(a){const v=this.getTotalVertices();if(!v||!this.ng())return null;if(this.rg&&this.rg.length>0){const p=this.ng();if(!p)return null;const P=p.length;let b=!1;if(a)b=!0;else for(const a of this.rg){if(a.indexStart+a.indexCount>P){b=!0;break}if(a.verticesStart+a.verticesCount>v){b=!0;break}}if(!b)return this.rg[0]}return this.releaseSubMeshes(),new h.d(0,0,v,0,this.getTotalIndices(),this)}subdivide(a){if(a<1)return;const v=this.getTotalIndices();let p=v/a|0,P=0;for(;p%3!==0;)p++;this.releaseSubMeshes();for(let b=0;b<a&&!(P>=v);b++)h.d.CreateFromIndices(0,P,b===a-1?v-P:p,this,void 0,!1),P+=p;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(a,v,p,P);else{const P=new f.e;P.set(v,a);const b=this.va();new H.c(H.c.RandomId(),b,P,p,this)}return this}removeVerticesData(a){this._geometry&&this._geometry.removeVerticesData(a)}markVerticesDataAsUpdatable(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const p=this.getVertexBuffer(a);p&&p.isUpdatable()!==v&&this.Ga(a,this.getVerticesData(a),v)}setVerticesBuffer(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=H.c.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(a,null,v),this}updateVerticesData(a,v,p,P){return this._geometry?(P?(this.makeGeometryUnique(),this.updateVerticesData(a,v,p,!1)):this._geometry.updateVerticesData(a,v,p),this):this}updateMeshPositions(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const p=this.getVerticesData(c.f.PositionKind);if(!p)return this;if(a(p),this.updateVerticesData(c.f.PositionKind,p,!1,!1),v){const a=this.ng(),v=this.getVerticesData(c.f.NormalKind);if(!v)return this;f.e.ComputeNormals(p,a,v),this.updateVerticesData(c.f.NormalKind,v,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const a=this._geometry,v=this._geometry.i(H.c.RandomId());return a.releaseForMesh(this,!0),v.Ca(this),this}setIndexBuffer(a,v,p){let P=this._geometry;P||(P=new H.c(H.c.RandomId(),this.va(),void 0,void 0,this)),P.setIndexBuffer(a,v,p)}setIndices(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(a,v,p,P);else{const v=new f.e;v.indices=a;const P=this.va();new H.c(H.c.RandomId(),P,v,p,this)}return this}updateIndices(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(a,v,p),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(a,v,p){let P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const b=this.va().getEngine();let L;if(this._unIndexed)if(this._getRenderingFillMode(p)===R.c.WireFrameFillMode)L=a._getLinesIndexBuffer(this.ng(),b);else L=null;else switch(this._getRenderingFillMode(p)){case R.c.PointFillMode:L=null;break;case R.c.WireFrameFillMode:L=a._getLinesIndexBuffer(this.ng(),b);break;default:case R.c.TriangleFillMode:L=this._geometry.getIndexBuffer()}return this._bindDirect(v,L,P)}_bindDirect(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(a),p&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(a,v,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(a,v),this):this}_draw(a,v,p){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const P=this.va().getEngine();return this._unIndexed&&v!==R.c.WireFrameFillMode||v==R.c.PointFillMode?P.drawArraysType(v,a.verticesStart,a.verticesCount,this.forcedInstanceCount||p):v==R.c.WireFrameFillMode?P.drawElementsType(v,0,a._linesIndexCount,this.forcedInstanceCount||p):P.drawElementsType(v,a.indexStart,a.indexCount,this.forcedInstanceCount||p),this}registerBeforeRender(a){return this.onBeforeRenderObservable.add(a),this}unregisterBeforeRender(a){return this.onBeforeRenderObservable.removeCallback(a),this}registerAfterRender(a){return this.onAfterRenderObservable.add(a),this}unregisterAfterRender(a){return this.onAfterRenderObservable.removeCallback(a),this}_getInstancesRenderList(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(v)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[a]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[a]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const p=this.va(),P=p._isInIntermediateRendering(),b=P?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,L=this._instanceDataStorage.batchCache;if(L.mustReturn=!1,L.renderSelf[a]=v||!b&&this.isEnabled()&&this.isVisible,L.visibleInstances[a]=null,this._instanceDataStorage.visibleInstances&&!v){const v=this._instanceDataStorage.visibleInstances,b=p.getRenderId(),t=P?v.intermediateDefaultRenderId:v.defaultRenderId;L.visibleInstances[a]=v[b],!L.visibleInstances[a]&&t&&(L.visibleInstances[a]=v[t])}return L.hardwareInstancedRendering[a]=!v&&this._instanceDataStorage.hardwareInstancedRendering&&null!==L.visibleInstances[a]&&void 0!==L.visibleInstances[a],this._instanceDataStorage.previousBatch=L,L}_renderWithInstances(a,v,p,P,b){const L=p.visibleInstances[a._id],t=L?L.length:0,V=this._instanceDataStorage,K=V.instancesBufferSize;let F=V.instancesBuffer,u=V.instancesPreviousBuffer;const f=16*(t+1)*4;for(;V.instancesBufferSize<f;)V.instancesBufferSize*=2;V.instancesData&&K==V.instancesBufferSize||(V.instancesData=new Float32Array(V.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!V.instancesPreviousData||K!=V.instancesBufferSize)&&(V.instancesPreviousData=new Float32Array(V.instancesBufferSize/4));let H=0,A=0;const h=p.renderSelf[a._id],R=!F||K!==V.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!V.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||V.isFrozen&&!R)A=(h?1:0)+t;else{const v=this.getWorldMatrix();if(h&&(this._scene.needsPreviousWorldMatrices&&(V.masterMeshPreviousWorldMatrix?(V.masterMeshPreviousWorldMatrix.copyToArray(V.instancesPreviousData,H),V.masterMeshPreviousWorldMatrix.p(v)):(V.masterMeshPreviousWorldMatrix=v.clone(),V.masterMeshPreviousWorldMatrix.copyToArray(V.instancesPreviousData,H))),v.copyToArray(V.instancesData,H),H+=16,A++),L){var X;if(J.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(X=a.Ha())&&void 0!==X&&X.needAlphaBlendingForMesh(a.getRenderingMesh())){const a=this._scene.activeCamera.globalPosition;for(let v=0;v<L.length;v++){const p=L[v];p._distanceToCamera=C.s.Distance(p.getBoundingInfo().boundingSphere.centerWorld,a)}L.sort(((a,v)=>a._distanceToCamera>v._distanceToCamera?-1:a._distanceToCamera<v._distanceToCamera?1:0))}for(let a=0;a<L.length;a++){const v=L[a],p=v.getWorldMatrix();p.copyToArray(V.instancesData,H),this._scene.needsPreviousWorldMatrices&&(v._previousWorldMatrix?(v._previousWorldMatrix.copyToArray(V.instancesPreviousData,H),v._previousWorldMatrix.p(p)):(v._previousWorldMatrix=p.clone(),v._previousWorldMatrix.copyToArray(V.instancesPreviousData,H))),H+=16,A++}}}return R?(F&&F.dispose(),u&&u.dispose(),F=new c.b(b,V.instancesData,!0,16,!1,!0),V.instancesBuffer=F,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=F.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=F.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=F.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=F.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new c.b(b,V.instancesPreviousData,!0,16,!1,!0),V.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(F.updateDirectly(V.instancesData,0,A),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(V.instancesPreviousData,0,A)),this._processInstancedBuffers(L,h),this.va()._activeIndices.addCount(a.indexCount*A,!1),b._currentDrawContext&&(b._currentDrawContext.useInstancing=!0),this._bind(a,P,v),this._draw(a,v,A),!this._scene.needsPreviousWorldMatrices||R||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(V.instancesData,0,A),b.unbindInstanceAttributes(),this}_renderWithThinInstances(a,v,p,P){var b;const L=(null===(b=this._thinInstanceDataStorage)||void 0===b?void 0:b.instancesCount)??0;this.va()._activeIndices.addCount(a.indexCount*L,!1),P._currentDrawContext&&(P._currentDrawContext.useInstancing=!0),this._bind(a,p,v),this._draw(a,v,L),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,L):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),P.unbindInstanceAttributes()}_processInstancedBuffers(a,v){}_processRendering(a,v,p,P,b,L,t,V){const K=this.va(),C=K.getEngine();if(P=this._getRenderingFillMode(P),L&&v.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(v,P,p,C),this;if(L)this._renderWithInstances(v,P,b,p,C);else{C._currentDrawContext&&(C._currentDrawContext.useInstancing=!1);let p=0;b.renderSelf[v._id]&&(t&&t(!1,a.getWorldMatrix(),V),p++,this._draw(v,P,this._instanceDataStorage.overridenInstanceCount));const L=b.visibleInstances[v._id];if(L){const a=L.length;p+=a;for(let p=0;p<a;p++){const a=L[p].getWorldMatrix();t&&t(!0,a,V),this._draw(v,P)}}K._activeIndices.addCount(v.indexCount*p,!1)}return this}_rebuild(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(a&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const v in this._userInstancedBuffersStorage.vertexBuffers){const p=this._userInstancedBuffersStorage.vertexBuffers[v];p&&(a&&p.dispose(),this._userInstancedBuffersStorage.vertexBuffers[v]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(a)}_freeze(){if(this.rg){for(let a=0;a<this.rg.length;a++)this._getInstancesRenderList(a);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(a,v,p,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const L=this._scene.getEngine(),t=L.currentRenderPassId;if(void 0!==a&&(L.currentRenderPassId=a),P)(!b||b&&P.isInFrustum(this._scene._frustumPlanes))&&this.render(P,!!v,p);else for(let V=0;V<this.rg.length;V++){const a=this.rg[V];(!b||b&&a.isInFrustum(this._scene._frustumPlanes))&&this.render(a,!!v,p)}return void 0!==a&&(L.currentRenderPassId=t),this}directRender(){if(!this.rg)return this;for(const a of this.rg)this.render(a,!1);return this}render(a,v,p){var P,b,L;const t=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const V=(null===(P=t.activeCameras)||void 0===P?void 0:P.length)??0;if((V>1&&t.activeCamera===t.activeCameras[0]||V<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const K=this._getInstancesRenderList(a._id,!!p);if(K.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const C=t.getEngine();let F=0,u=null;this.ignoreCameraMaxZ&&t.activeCamera&&!t._isInIntermediateRendering()&&(F=t.activeCamera.maxZ,u=t.activeCamera,t.activeCamera.maxZ=0,t.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const c=a.getRenderingMesh(),f=K.hardwareInstancedRendering[a._id]||c.hasThinInstances||!!this._userInstancedBuffersStorage&&!a.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,H=this._instanceDataStorage,A=a.Ha();if(!A)return u&&(u.maxZ=F,t.updateTransformMatrix(!0)),this;if(H.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===A){if(A._storeEffectOnSubMeshes&&(null===(b=a._drawWrapper)||void 0===b||!b._wasPreviouslyReady)||!A._storeEffectOnSubMeshes&&!A._getDrawWrapper()._wasPreviouslyReady)return u&&(u.maxZ=F,t.updateTransformMatrix(!0)),this}else{if(A._storeEffectOnSubMeshes){if(!A.isReadyForSubMesh(this,a,f))return u&&(u.maxZ=F,t.updateTransformMatrix(!0)),this}else if(!A.isReady(this,f))return u&&(u.maxZ=F,t.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=A}let h;v&&C.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),h=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?a._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const X=(null===(L=h)||void 0===L?void 0:L.effect)??null;for(const R of t._beforeRenderingMeshStage)R.action(this,a,K,X);if(!h||!X)return u&&(u.maxZ=F,t.updateTransformMatrix(!0)),this;const Q=p||this;let s;if(H.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.oh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)s=H.sideOrientation;else{const a=Q._getWorldMatrixDeterminant();s=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),a<0&&(s=s===R.c.ClockWiseSideOrientation?R.c.CounterClockWiseSideOrientation:R.c.ClockWiseSideOrientation),H.sideOrientation=s}const D=this._internalMeshDataInfo._effectiveMaterial._preBind(h,s);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&C.setDepthWrite(!0);const y=this._internalMeshDataInfo._effectiveMaterial,Z=y.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(a,X,Z,!1);const M=Q.getWorldMatrix();y._storeEffectOnSubMeshes?y.bindForSubMesh(M,this,a):y.bind(M,this),!y.oh&&y.separateCullingPass&&(C.setState(!0,y.zOffset,!1,!D,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._processRendering(this,a,X,Z,K,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),C.setState(!0,y.zOffset,!1,D,y.cullBackFaces,y.stencil,y.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(a)),this._processRendering(this,a,X,Z,K,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const R of t._afterRenderingMeshStage)R.action(this,a,K,X);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=F,t.updateTransformMatrix(!0)),2!==t.performancePriority||H.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(c.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(c.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const a=this.getVerticesData(c.f.MatricesWeightsKind),v=a.length;for(let p=0;p<v;p+=4){const v=a[p]+a[p+1]+a[p+2]+a[p+3];if(0===v)a[p]=1;else{const P=1/v;a[p]*=P,a[p+1]*=P,a[p+2]*=P,a[p+3]*=P}}this.Ga(c.f.MatricesWeightsKind,a)}_normalizeSkinWeightsAndExtra(){const a=this.getVerticesData(c.f.MatricesWeightsExtraKind),v=this.getVerticesData(c.f.MatricesWeightsKind),p=v.length;for(let P=0;P<p;P+=4){let p=v[P]+v[P+1]+v[P+2]+v[P+3];if(p+=a[P]+a[P+1]+a[P+2]+a[P+3],0===p)v[P]=1;else{const b=1/p;v[P]*=b,v[P+1]*=b,v[P+2]*=b,v[P+3]*=b,a[P]*=b,a[P+1]*=b,a[P+2]*=b,a[P+3]*=b}}this.Ga(c.f.MatricesWeightsKind,v),this.Ga(c.f.MatricesWeightsKind,a)}validateSkinning(){const a=this.getVerticesData(c.f.MatricesWeightsExtraKind),v=this.getVerticesData(c.f.MatricesWeightsKind);if(null===v||null==this.skeleton)return{skinned:!1,valid:!0,vm:"not skinned"};const p=v.length;let P=0,b=0,L=0,t=0;const V=null===a?4:8,K=[];for(let c=0;c<=V;c++)K[c]=0;for(let c=0;c<p;c+=4){let p=v[c],C=p,F=0===C?0:1;for(let b=1;b<V;b++){const L=b<4?v[c+b]:a[c+b-4];L>p&&P++,0!==L&&F++,C+=L,p=L}if(K[F]++,F>L&&(L=F),0===C)b++;else{const p=1/C;let P=0;for(let b=0;b<V;b++)P+=b<4?Math.abs(v[c+b]-v[c+b]*p):Math.abs(a[c+b-4]-a[c+b-4]*p);P>.001&&t++}}const C=this.skeleton.bones.length,F=this.getVerticesData(c.f.MatricesIndicesKind),u=this.getVerticesData(c.f.MatricesIndicesExtraKind);let f=0;for(let c=0;c<p;c+=4)for(let a=0;a<V;a++){const v=a<4?F[c+a]:u[c+a-4];(v>=C||v<0)&&f++}return{skinned:!0,valid:0===b&&0===t&&0===f,vm:"Number of Weights = "+p/4+"\nMaximum influences = "+L+"\nMissing Weights = "+b+"\nNot Sorted = "+P+"\nNot Normalized = "+t+"\nWeightCounts = ["+K+"]\nNumber of bones = "+C+"\nBad Bone Indices = "+f}}_checkDelayState(){const a=this.va();return this._geometry?this._geometry.load(a):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(a)),this}_queueLoad(a){a.addPendingData(this);const v=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return b.e.LoadFile(this.delayLoadingFile,(v=>{v instanceof ArrayBuffer?this._delayLoadingFunction(v,this):this._delayLoadingFunction(JSON.parse(v),this),this.instances.forEach((a=>{a.refreshBoundingInfo(),a._syncSubMeshes()})),this.delayLoadState=1,a.removePendingData(this)}),(()=>{}),a.offlineProvider,v),this}isInFrustum(a){return 2!==this.delayLoadState&&(!!super.isInFrustum(a)&&(this._checkDelayState(),!0))}setMaterialById(a){const v=this.va().materials;let p;for(p=v.length-1;p>-1;p--)if(v[p].id===a)return this.material=v[p],this;const P=this.va().multiMaterials;for(p=P.length-1;p>-1;p--)if(P[p].id===a)return this.material=P[p],this;return this}getAnimatables(){const a=[];return this.material&&a.push(this.material),this.skeleton&&a.push(this.skeleton),a}bakeTransformIntoVertices(a){if(!this.isVerticesDataPresent(c.f.PositionKind))return this;const v=this.rg.splice(0);this._resetPointsArrayCache();let p=this.getVerticesData(c.f.PositionKind);const P=C.s.Zero();let b;for(b=0;b<p.length;b+=3)C.s.TransformCoordinatesFromFloatsToRef(p[b],p[b+1],p[b+2],a,P).toArray(p,b);if(this.Ga(c.f.PositionKind,p,this.getVertexBuffer(c.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.f.NormalKind)){for(p=this.getVerticesData(c.f.NormalKind),b=0;b<p.length;b+=3)C.s.TransformNormalFromFloatsToRef(p[b],p[b+1],p[b+2],a,P).normalize().toArray(p,b);this.Ga(c.f.NormalKind,p,this.getVertexBuffer(c.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(c.f.TangentKind)){for(p=this.getVerticesData(c.f.TangentKind),b=0;b<p.length;b+=4)C.s.TransformNormalFromFloatsToRef(p[b],p[b+1],p[b+2],a,P).normalize().toArray(p,b);this.Ga(c.f.TangentKind,p,this.getVertexBuffer(c.f.TangentKind).isUpdatable())}return a.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.rg=v,this}bakeCurrentTransformIntoVertices(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Zj(!0)),this.resetLocalMatrix(a),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),a,this,v,p)}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const p=this._internalMeshDataInfo;if(p._onBeforeDrawObservable&&p._onBeforeDrawObservable.clear(),p._onBeforeBindObservable&&p._onBeforeBindObservable.clear(),p._onBeforeRenderObservable&&p._onBeforeRenderObservable.clear(),p._onAfterRenderObservable&&p._onAfterRenderObservable.clear(),p._onBetweenPassObservable&&p._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(p.meshMap)for(const a in p.meshMap){const v=p.meshMap[a];v&&(v._internalMeshDataInfo._source=null,p.meshMap[a]=void 0)}p._source&&p._source._internalMeshDataInfo.meshMap&&(p._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const a=this.va().meshes;for(const v of a){const a=v;a._internalMeshDataInfo&&a._internalMeshDataInfo._source&&a._internalMeshDataInfo._source===this&&(a._internalMeshDataInfo._source=null)}}p._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(a,v)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(a,v,p,P,L,t){let V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7?arguments[7]:void 0;const C=this.va();return b.e.LoadImage(a,(a=>{const b=a.width,K=a.height,C=this.getEngine().createCanvas(b,K).getContext("2d");C.drawImage(a,0,0);const F=C.getImageData(0,0,b,K).data;this.applyDisplacementMapFromBuffer(F,b,K,v,p,L,t,V),P&&P(this)}),K||(()=>{}),C.offlineProvider),this}applyDisplacementMapFromBuffer(a,v,p,P,b,L,t){let V=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(c.f.PositionKind)||!this.isVerticesDataPresent(c.f.NormalKind)||!this.isVerticesDataPresent(c.f.UVKind))return D.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const K=this.getVerticesData(c.f.PositionKind,!0,!0),F=this.getVerticesData(c.f.NormalKind),u=this.getVerticesData(c.f.UVKind);let H=C.s.Zero();const A=C.s.Zero(),h=C.o.Zero();L=L||C.o.Zero(),t=t||new C.o(1,1);for(let c=0;c<K.length;c+=3){C.s.FromArrayToRef(K,c,H),C.s.FromArrayToRef(F,c,A),C.o.FromArrayToRef(u,c/3*2,h);const V=4*((Math.abs(h.x*t.x+L.x%1)*(v-1)%v|0)+(Math.abs(h.y*t.y+L.y%1)*(p-1)%p|0)*v),f=.3*(a[V]/255)+.59*(a[V+1]/255)+.11*(a[V+2]/255);A.normalize(),A.scaleInPlace(P+(b-P)*f),H=H.add(A),H.toArray(K,c)}return f.e.ComputeNormals(K,this.ng(),F),V?(this.Ga(c.f.PositionKind,K),this.Ga(c.f.NormalKind,F),this.Ga(c.f.UVKind,u)):(this.updateVerticesData(c.f.PositionKind,K),this.updateVerticesData(c.f.NormalKind,F)),this}_getFlattenedNormals(a,v){const p=new Float32Array(3*a.length);let P=0;const b=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let L=0;L<a.length;L+=3){const t=C.s.bh(v,3*a[L]),V=C.s.bh(v,3*a[L+1]),K=C.s.bh(v,3*a[L+2]),F=t.od(V),u=K.od(V),c=C.s.Normalize(C.s.Cross(F,u));b&&c.scaleInPlace(-1);for(let a=0;a<3;a++)p[P++]=c.x,p[P++]=c.y,p[P++]=c.z}return p}_convertToUnIndexedMesh(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this.getVerticesDataKinds().filter((a=>{var v;return!(null!==(v=this.getVertexBuffer(a))&&void 0!==v&&v.getIsInstanced())})),p=this.ng(),P={},b=(a,v)=>{const P=new Float32Array(p.length*v);let b=0;for(let L=0;L<p.length;L++)for(let t=0;t<v;t++)P[b++]=a[p[L]*v+t];return P},L=this.getBoundingInfo(),t=this.Oj?this.rg.slice(0):[];for(const V of v)P[V]=this.getVerticesData(V);for(const V of v){const v=this.getVertexBuffer(V),L=v.getSize();if(a&&V===c.f.NormalKind){const a=this._getFlattenedNormals(p,P[c.f.PositionKind]);this.Ga(c.f.NormalKind,a,v.isUpdatable(),L)}else this.Ga(V,b(P[V],L),v.isUpdatable(),L)}if(this.morphTargetManager){for(let v=0;v<this.morphTargetManager.numTargets;v++){const P=this.morphTargetManager.getTarget(v),L=P.getPositions();P.setPositions(b(L,3));const t=P.getNormals();t&&P.setNormals(a?this._getFlattenedNormals(p,L):b(t,3));const V=P.getTangents();V&&P.setTangents(b(V,3));const K=P.getUVs();K&&P.setUVs(b(K,2))}this.morphTargetManager.synchronize()}for(let V=0;V<p.length;V++)p[V]=V;this.setIndices(p),this._unIndexed=!0,this.releaseSubMeshes();for(const V of t){const a=V.getBoundingInfo();h.d.AddToMesh(V.materialIndex,V.indexStart,V.indexCount,V.indexStart,V.indexCount,this).setBoundingInfo(a)}return this.setBoundingInfo(L),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=f.e.ExtractFromMesh(this);let p;if(a&&this.isVerticesDataPresent(c.f.NormalKind)&&v.ya){for(p=0;p<v.ya.length;p++)v.ya[p]*=-1;this.Ga(c.f.NormalKind,v.ya,this.isVertexBufferUpdatable(c.f.NormalKind))}if(v.indices){let a;for(p=0;p<v.indices.length;p+=3)a=v.indices[p+1],v.indices[p+1]=v.indices[p+2],v.indices[p+2]=a;this.setIndices(v.indices,null,this.isVertexBufferUpdatable(c.f.PositionKind),!0)}return this}increaseVertices(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const v=f.e.ExtractFromMesh(this),p=v.indices&&!Array.isArray(v.indices)&&Array.from?Array.from(v.indices):v.indices,P=v.xa&&!Array.isArray(v.xa)&&Array.from?Array.from(v.xa):v.xa,b=v.Aa&&!Array.isArray(v.Aa)&&Array.from?Array.from(v.Aa):v.Aa,L=v.ya&&!Array.isArray(v.ya)&&Array.from?Array.from(v.ya):v.ya;if(p&&P){v.indices=p,v.xa=P,b&&(v.Aa=b),L&&(v.ya=L);const t=a+1,V=new Array;for(let a=0;a<t+1;a++)V[a]=new Array;let K,F;const u=new C.s(0,0,0),f=new C.s(0,0,0),H=new C.o(0,0),A=new Array,h=new Array,R=new Array;let X,Q,s,D=P.length;b&&(Q=b.length),L&&(s=L.length);for(let a=0;a<p.length;a+=3){h[0]=p[a],h[1]=p[a+1],h[2]=p[a+2];for(let a=0;a<3;a++)if(K=h[a],F=h[(a+1)%3],void 0===R[K]&&void 0===R[F]?(R[K]=new Array,R[F]=new Array):(void 0===R[K]&&(R[K]=new Array),void 0===R[F]&&(R[F]=new Array)),void 0===R[K][F]&&void 0===R[F][K]){R[K][F]=[],u.x=(P[3*F]-P[3*K])/t,u.y=(P[3*F+1]-P[3*K+1])/t,u.z=(P[3*F+2]-P[3*K+2])/t,L&&(f.x=(L[3*F]-L[3*K])/t,f.y=(L[3*F+1]-L[3*K+1])/t,f.z=(L[3*F+2]-L[3*K+2])/t),b&&(H.x=(b[2*F]-b[2*K])/t,H.y=(b[2*F+1]-b[2*K+1])/t),R[K][F].push(K);for(let a=1;a<t;a++)R[K][F].push(P.length/3),P[D++]=P[3*K]+a*u.x,P[D++]=P[3*K+1]+a*u.y,P[D++]=P[3*K+2]+a*u.z,L&&(L[s++]=L[3*K]+a*f.x,L[s++]=L[3*K+1]+a*f.y,L[s++]=L[3*K+2]+a*f.z),b&&(b[Q++]=b[2*K]+a*H.x,b[Q++]=b[2*K+1]+a*H.y);R[K][F].push(F),R[F][K]=new Array,X=R[K][F].length;for(let a=0;a<X;a++)R[F][K][a]=R[K][F][X-1-a]}V[0][0]=p[a],V[1][0]=R[p[a]][p[a+1]][1],V[1][1]=R[p[a]][p[a+2]][1];for(let v=2;v<t;v++){V[v][0]=R[p[a]][p[a+1]][v],V[v][v]=R[p[a]][p[a+2]][v],u.x=(P[3*V[v][v]]-P[3*V[v][0]])/v,u.y=(P[3*V[v][v]+1]-P[3*V[v][0]+1])/v,u.z=(P[3*V[v][v]+2]-P[3*V[v][0]+2])/v,L&&(f.x=(L[3*V[v][v]]-L[3*V[v][0]])/v,f.y=(L[3*V[v][v]+1]-L[3*V[v][0]+1])/v,f.z=(L[3*V[v][v]+2]-L[3*V[v][0]+2])/v),b&&(H.x=(b[2*V[v][v]]-b[2*V[v][0]])/v,H.y=(b[2*V[v][v]+1]-b[2*V[v][0]+1])/v);for(let a=1;a<v;a++)V[v][a]=P.length/3,P[D++]=P[3*V[v][0]]+a*u.x,P[D++]=P[3*V[v][0]+1]+a*u.y,P[D++]=P[3*V[v][0]+2]+a*u.z,L&&(L[s++]=L[3*V[v][0]]+a*f.x,L[s++]=L[3*V[v][0]+1]+a*f.y,L[s++]=L[3*V[v][0]+2]+a*f.z),b&&(b[Q++]=b[2*V[v][0]]+a*H.x,b[Q++]=b[2*V[v][0]+1]+a*H.y)}V[t]=R[p[a+1]][p[a+2]],A.push(V[0][0],V[1][0],V[1][1]);for(let a=1;a<t;a++){let v;for(v=0;v<a;v++)A.push(V[a][v],V[a+1][v],V[a+1][v+1]),A.push(V[a][v],V[a+1][v+1],V[a][v+1]);A.push(V[a][v],V[a+1][v],V[a+1][v+1])}}v.indices=A,v.Ca(this,this.isVertexBufferUpdatable(c.f.PositionKind))}else D.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const a=f.e.ExtractFromMesh(this),v=a.Aa,p=a.indices,P=a.xa,b=a.za,L=a.matricesIndices,t=a.matricesWeights,V=a.matricesIndicesExtra,K=a.matricesWeightsExtra;if(void 0===p||void 0===P||null===p||null===P)D.d.Warn("VertexData contains empty entries");else{const C=new Array,F=new Array,u=new Array,H=new Array,A=new Array,h=new Array,R=new Array,X=new Array;let Q=new Array,s=0;const D={};let y,Z;for(let a=0;a<p.length;a+=3){Z=[p[a],p[a+1],p[a+2]],Q=[];for(let a=0;a<3;a++){Q[a]="";for(let v=0;v<3;v++)Math.abs(P[3*Z[a]+v])<1e-8&&(P[3*Z[a]+v]=0),Q[a]+=P[3*Z[a]+v]+"|"}if(Q[0]!=Q[1]&&Q[0]!=Q[2]&&Q[1]!=Q[2])for(let a=0;a<3;a++){if(y=D[Q[a]],void 0===y){D[Q[a]]=s,y=s++;for(let v=0;v<3;v++)C.push(P[3*Z[a]+v]);if(null!==b&&void 0!==b)for(let v=0;v<4;v++)H.push(b[4*Z[a]+v]);if(null!==v&&void 0!==v)for(let p=0;p<2;p++)u.push(v[2*Z[a]+p]);if(null!==L&&void 0!==L)for(let v=0;v<4;v++)A.push(L[4*Z[a]+v]);if(null!==t&&void 0!==t)for(let v=0;v<4;v++)h.push(t[4*Z[a]+v]);if(null!==V&&void 0!==V)for(let v=0;v<4;v++)R.push(V[4*Z[a]+v]);if(null!==K&&void 0!==K)for(let v=0;v<4;v++)X.push(K[4*Z[a]+v])}F.push(y)}}const M=new Array;f.e.ComputeNormals(C,F,M),a.xa=C,a.indices=F,a.ya=M,null!==v&&void 0!==v&&(a.Aa=u),null!==b&&void 0!==b&&(a.za=H),null!==L&&void 0!==L&&(a.matricesIndices=A),null!==t&&void 0!==t&&(a.matricesWeights=h),null!==V&&void 0!==V&&(a.matricesIndicesExtra=R),null!==t&&void 0!==t&&(a.matricesWeightsExtra=X),a.Ca(this,this.isVertexBufferUpdatable(c.f.PositionKind))}}static _instancedMeshFactory(a,v){throw(0,Z.c)("InstancedMesh")}static _PhysicsImpostorParser(a,v,p){throw(0,Z.c)("PhysicsImpostor")}createInstance(a){const v=J._instancedMeshFactory(a,this);return v.parent=this.parent,v}synchronizeInstances(){for(let a=0;a<this.instances.length;a++){this.instances[a]._syncSubMeshes()}return this}optimizeIndices(a){const v=this.ng(),p=this.getVerticesData(c.f.PositionKind);if(!p||!v)return this;const P=[];for(let b=0;b<p.length;b+=3)P.push(C.s.bh(p,b));const L=[];return b.b.SyncAsyncForLoop(P.length,40,(a=>{const v=P.length-1-a,p=P[v];for(let b=0;b<v;++b){const a=P[b];if(p.equals(a)){L[v]=b;break}}}),(()=>{for(let a=0;a<v.length;++a)v[a]=L[v[a]]||v[a];const p=this.rg.slice(0);this.setIndices(v),this.rg=p,a&&a(this)})),this}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.name=this.name,a.id=this.id,a.uniqueId=this.uniqueId,a.type=this.getClassName(),t.c&&t.c.HasTags(this)&&(a.tags=t.c.GetTags(this)),a.position=this.position.tj(),this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.tj():this.rotation&&(a.rotation=this.rotation.tj()),a.te=this.te.tj(),this._postMultiplyPivotMatrix?a.pivotMatrix=this.getPivotMatrix().tj():a.localMatrix=this.getPivotMatrix().tj(),a.isEnabled=this.isEnabled(!1),a.isVisible=this.isVisible,a.infiniteDistance=this.infiniteDistance,a.pickable=this.Ib,a.receiveShadows=this.receiveShadows,a.billboardMode=this.billboardMode,a.visibility=this.visibility,a.xb=this.xb,a.checkCollisions=this.checkCollisions,a.ellipsoid=this.ellipsoid.tj(),a.ellipsoidOffset=this.ellipsoidOffset.tj(),a.Da=this.Da,a.isBlocker=this.isBlocker,a.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(a),a.isUnIndexed=this.isUnIndexed;const v=this._geometry;if(v&&this.rg){a.geometryUniqueId=v.uniqueId,a.geometryId=v.id,a.rg=[];for(let v=0;v<this.rg.length;v++){const p=this.rg[v];a.rg.push({materialIndex:p.materialIndex,verticesStart:p.verticesStart,verticesCount:p.verticesCount,indexStart:p.indexStart,indexCount:p.indexCount})}}if(this.material?this.material.doNotSerialize||(a.materialUniqueId=this.material.uniqueId,a.materialId=this.material.id):(this.material=null,a.materialUniqueId=this._scene.defaultMaterial.uniqueId,a.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(a.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(a.skeletonId=this.skeleton.id,a.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(M.c.NAME_PHYSICSENGINE)){const v=this.getPhysicsImpostor();v&&(a.physicsMass=v.getParam("mass"),a.physicsFriction=v.getParam("friction"),a.physicsRestitution=v.getParam("mass"),a.physicsImpostor=v.type)}this.metadata&&(a.metadata=this.metadata),a.instances=[];for(let p=0;p<this.instances.length;p++){const v=this.instances[p];if(v.doNotSerialize)continue;const P={name:v.name,id:v.id,isEnabled:v.isEnabled(!1),isVisible:v.isVisible,Ib:v.Ib,checkCollisions:v.checkCollisions,position:v.position.tj(),te:v.te.tj()};if(v.parent&&v.parent._serializeAsParent(P),v.rotationQuaternion?P.rotationQuaternion=v.rotationQuaternion.tj():v.rotation&&(P.rotation=v.rotation.tj()),this.va()._getComponent(M.c.NAME_PHYSICSENGINE)){const a=v.getPhysicsImpostor();a&&(P.physicsMass=a.getParam("mass"),P.physicsFriction=a.getParam("friction"),P.physicsRestitution=a.getParam("mass"),P.physicsImpostor=a.type)}v.metadata&&(P.metadata=v.metadata),v.actionManager&&(P.actions=v.actionManager.serialize(v.name)),a.instances.push(P),s.b.AppendSerializedAnimations(v,P),P.ranges=v.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(a.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const v={data:{},sizes:{},strides:{}};for(const a in this._userThinInstanceBuffersStorage.data)v.data[a]=Array.from(this._userThinInstanceBuffersStorage.data[a]),v.sizes[a]=this._userThinInstanceBuffersStorage.sizes[a],v.strides[a]=this._userThinInstanceBuffersStorage.strides[a];a.thinInstances.userThinInstance=v}return s.b.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a.layerMask=this.layerMask,a.alphaIndex=this.alphaIndex,a.hasVertexAlpha=this.hasVertexAlpha,a.overlayAlpha=this.overlayAlpha,a.overlayColor=this.overlayColor.tj(),a.renderOverlay=this.renderOverlay,a.applyFog=this.applyFog,this.actionManager&&(a.actions=this.actionManager.serialize(this.name)),a}_syncGeometryWithMorphTargetManager(){if(!this.Oj)return;this._markSubMeshesAsAttributesDirty();const a=this._internalAbstractMeshDataInfo._morphTargetManager;if(a&&a.vertexCount){if(a.vertexCount!==this.getTotalVertices())return D.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(a.isUsingTextureForTargets)return;for(let v=0;v<a.numInfluencers;v++){const p=a.getActiveTarget(v),P=p.getPositions();if(!P)return void D.d.Error("Invalid morph target. Target must have positions.");this.Oj.Ga(c.f.PositionKind+v,P,!1,3);const b=p.getNormals();b&&this.Oj.Ga(c.f.NormalKind+v,b,!1,3);const L=p.getTangents();L&&this.Oj.Ga(c.f.TangentKind+v,L,!1,3);const t=p.getUVs();t&&this.Oj.Ga(c.f.UVKind+"_"+v,t,!1,2)}}else{let a=0;for(;this.Oj.isVerticesDataPresent(c.f.PositionKind+a);)this.Oj.removeVerticesData(c.f.PositionKind+a),this.Oj.isVerticesDataPresent(c.f.NormalKind+a)&&this.Oj.removeVerticesData(c.f.NormalKind+a),this.Oj.isVerticesDataPresent(c.f.TangentKind+a)&&this.Oj.removeVerticesData(c.f.TangentKind+a),this.Oj.isVerticesDataPresent(c.f.UVKind+a)&&this.Oj.removeVerticesData(c.f.UVKind+"_"+a),a++}}static Parse(a,v,p){let P;if(P=a.type&&"LinesMesh"===a.type?J._LinesMeshParser(a,v):a.type&&"GroundMesh"===a.type?J._GroundMeshParser(a,v):a.type&&"GoldbergMesh"===a.type?J._GoldbergMeshParser(a,v):a.type&&"GreasedLineMesh"===a.type?J._GreasedLineMeshParser(a,v):a.type&&"TrailMesh"===a.type?J._TrailMeshParser(a,v):new J(a.name,v),P.id=a.id,P._waitingParsedUniqueId=a.uniqueId,t.c&&t.c.AddTagsTo(P,a.tags),P.position=C.s.bh(a.position),void 0!==a.metadata&&(P.metadata=a.metadata),a.rotationQuaternion?P.rotationQuaternion=C.i.bh(a.rotationQuaternion):a.rotation&&(P.rotation=C.s.bh(a.rotation)),P.te=C.s.bh(a.te),a.localMatrix?P.setPreTransformMatrix(C.e.bh(a.localMatrix)):a.pivotMatrix&&P.setPivotMatrix(C.e.bh(a.pivotMatrix)),P.Mb(a.isEnabled),P.isVisible=a.isVisible,P.infiniteDistance=a.infiniteDistance,P.xb=!!a.xb,P.showBoundingBox=a.showBoundingBox,P.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox,void 0!==a.applyFog&&(P.applyFog=a.applyFog),void 0!==a.pickable&&(P.Ib=a.pickable),void 0!==a.alphaIndex&&(P.alphaIndex=a.alphaIndex),P.receiveShadows=a.receiveShadows,void 0!==a.billboardMode&&(P.billboardMode=a.billboardMode),void 0!==a.visibility&&(P.visibility=a.visibility),P.checkCollisions=a.checkCollisions,P.Da=!!a.Da,a.ellipsoid&&(P.ellipsoid=C.s.bh(a.ellipsoid)),a.ellipsoidOffset&&(P.ellipsoidOffset=C.s.bh(a.ellipsoidOffset)),null!=a.overrideMaterialSideOrientation&&(P.sideOrientation=a.overrideMaterialSideOrientation),void 0!==a.sideOrientation&&(P.sideOrientation=a.sideOrientation),void 0!==a.isBlocker&&(P.isBlocker=a.isBlocker),P._shouldGenerateFlatShading=a.useFlatShading,a.Ec&&(P._waitingData.Ec=a.Ec),void 0!==a.parentId&&(P._waitingParentId=a.parentId),void 0!==a.parentInstanceIndex&&(P._waitingParentInstanceIndex=a.parentInstanceIndex),void 0!==a.actions&&(P._waitingData.actions=a.actions),void 0!==a.overlayAlpha&&(P.overlayAlpha=a.overlayAlpha),void 0!==a.overlayColor&&(P.overlayColor=F.d.bh(a.overlayColor)),void 0!==a.renderOverlay&&(P.renderOverlay=a.renderOverlay),P.isUnIndexed=!!a.isUnIndexed,P.hasVertexAlpha=a.hasVertexAlpha,a.delayLoadingFile?(P.delayLoadState=4,P.delayLoadingFile=p+a.delayLoadingFile,P.buildBoundingInfo(C.s.bh(a.boundingBoxMinimum),C.s.bh(a.boundingBoxMaximum)),a._binaryInfo&&(P._binaryInfo=a._binaryInfo),P._delayInfo=[],a.hasUVs&&P._delayInfo.push(c.f.UVKind),a.hasUVs2&&P._delayInfo.push(c.f.UV2Kind),a.hasUVs3&&P._delayInfo.push(c.f.UV3Kind),a.hasUVs4&&P._delayInfo.push(c.f.UV4Kind),a.hasUVs5&&P._delayInfo.push(c.f.UV5Kind),a.hasUVs6&&P._delayInfo.push(c.f.UV6Kind),a.hasColors&&P._delayInfo.push(c.f.ColorKind),a.hasMatricesIndices&&P._delayInfo.push(c.f.MatricesIndicesKind),a.hasMatricesWeights&&P._delayInfo.push(c.f.MatricesWeightsKind),P._delayLoadingFunction=H.c._ImportGeometry,Q.b.ForceFullSceneLoadingForIncremental&&P._checkDelayState()):H.c._ImportGeometry(a,P),a.materialUniqueId?P._waitingMaterialId=a.materialUniqueId:a.materialId&&(P._waitingMaterialId=a.materialId),a.morphTargetManagerId>-1&&(P._waitingMorphTargetManagerId=a.morphTargetManagerId),void 0!==a.skeletonId&&null!==a.skeletonId&&(P.skeleton=v.getLastSkeletonById(a.skeletonId),a.numBoneInfluencers&&(P.numBoneInfluencers=a.numBoneInfluencers)),a.animations){for(let v=0;v<a.animations.length;v++){const p=a.animations[v],b=(0,y.c)("BABYLON.Animation");b&&P.animations.push(b.Parse(p))}u.b.ParseAnimationRanges(P,a,v)}if(a.autoAnimate&&v.beginAnimation(P,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),a.layerMask&&!isNaN(a.layerMask)?P.layerMask=Math.abs(parseInt(a.layerMask)):P.layerMask=268435455,a.physicsImpostor&&(P.physicsImpostor=J._PhysicsImpostorParser(v,P,a)),a.lodMeshIds&&(P._waitingData.lods={ids:a.lodMeshIds,distances:a.lodDistances?a.lodDistances:null,coverages:a.lodCoverages?a.lodCoverages:null}),a.instances)for(let b=0;b<a.instances.length;b++){const p=a.instances[b],L=P.createInstance(p.name);if(p.id&&(L.id=p.id),t.c&&(p.tags?t.c.AddTagsTo(L,p.tags):t.c.AddTagsTo(L,a.tags)),L.position=C.s.bh(p.position),void 0!==p.metadata&&(L.metadata=p.metadata),void 0!==p.parentId&&(L._waitingParentId=p.parentId),void 0!==p.parentInstanceIndex&&(L._waitingParentInstanceIndex=p.parentInstanceIndex),void 0!==p.isEnabled&&null!==p.isEnabled&&L.Mb(p.isEnabled),void 0!==p.isVisible&&null!==p.isVisible&&(L.isVisible=p.isVisible),void 0!==p.Ib&&null!==p.Ib&&(L.Ib=p.Ib),p.rotationQuaternion?L.rotationQuaternion=C.i.bh(p.rotationQuaternion):p.rotation&&(L.rotation=C.s.bh(p.rotation)),L.te=C.s.bh(p.te),void 0!=p.checkCollisions&&null!=p.checkCollisions&&(L.checkCollisions=p.checkCollisions),void 0!=p.pickable&&null!=p.pickable&&(L.Ib=p.pickable),void 0!=p.showBoundingBox&&null!=p.showBoundingBox&&(L.showBoundingBox=p.showBoundingBox),void 0!=p.showSubMeshesBoundingBox&&null!=p.showSubMeshesBoundingBox&&(L.showSubMeshesBoundingBox=p.showSubMeshesBoundingBox),void 0!=p.alphaIndex&&null!=p.showSubMeshesBoundingBox&&(L.alphaIndex=p.alphaIndex),p.physicsImpostor&&(L.physicsImpostor=J._PhysicsImpostorParser(v,L,p)),void 0!==p.actions&&(L._waitingData.actions=p.actions),p.animations){for(let a=0;a<p.animations.length;a++){const v=p.animations[a],P=(0,y.c)("BABYLON.Animation");P&&L.animations.push(P.Parse(v))}u.b.ParseAnimationRanges(L,p,v),p.autoAnimate&&v.beginAnimation(L,p.autoAnimateFrom,p.autoAnimateTo,p.autoAnimateLoop,p.autoAnimateSpeed||1)}}if(a.thinInstances){const v=a.thinInstances;if(P.thinInstanceEnablePicking=!!v.enablePicking,v.matrixData?(P.Rb("matrix",new Float32Array(v.matrixData),16,!1),P._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,P._thinInstanceDataStorage.instancesCount=v.instancesCount):P._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,a.thinInstances.userThinInstance){const v=a.thinInstances.userThinInstance;for(const a in v.data)P.Rb(a,new Float32Array(v.data[a]),v.strides[a],!1),P._userThinInstanceBuffersStorage.sizes[a]=v.sizes[a]}}return P}setPositionsForCPUSkinning(){const a=this._internalMeshDataInfo;if(!a._sourcePositions){const v=this.getVerticesData(c.f.PositionKind);if(!v)return a._sourcePositions;a._sourcePositions=new Float32Array(v),this.isVertexBufferUpdatable(c.f.PositionKind)||this.Ga(c.f.PositionKind,v,!0)}return a._sourcePositions}setNormalsForCPUSkinning(){const a=this._internalMeshDataInfo;if(!a._sourceNormals){const v=this.getVerticesData(c.f.NormalKind);if(!v)return a._sourceNormals;a._sourceNormals=new Float32Array(v),this.isVertexBufferUpdatable(c.f.NormalKind)||this.Ga(c.f.NormalKind,v,!0)}return a._sourceNormals}applySkeleton(a){if(!this.Oj)return this;if(this.Oj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Oj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(c.f.PositionKind))return this;if(!this.isVerticesDataPresent(c.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(c.f.MatricesWeightsKind))return this;const v=this.isVerticesDataPresent(c.f.NormalKind),p=this._internalMeshDataInfo;if(!p._sourcePositions){const a=this.rg.slice();this.setPositionsForCPUSkinning(),this.rg=a}v&&!p._sourceNormals&&this.setNormalsForCPUSkinning();let P=this.getVerticesData(c.f.PositionKind);if(!P)return this;P instanceof Float32Array||(P=new Float32Array(P));let b=this.getVerticesData(c.f.NormalKind);if(v){if(!b)return this;b instanceof Float32Array||(b=new Float32Array(b))}const L=this.getVerticesData(c.f.MatricesIndicesKind),t=this.getVerticesData(c.f.MatricesWeightsKind);if(!t||!L)return this;const V=this.numBoneInfluencers>4,K=V?this.getVerticesData(c.f.MatricesIndicesExtraKind):null,F=V?this.getVerticesData(c.f.MatricesWeightsExtraKind):null,u=a.getTransformMatrices(this),f=C.s.Zero(),H=new C.e,A=new C.e;let h,R=0;for(let c=0;c<P.length;c+=3,R+=4){let a;for(h=0;h<4;h++)a=t[R+h],a>0&&(C.e.FromFloat32ArrayToRefScaled(u,Math.floor(16*L[R+h]),a,A),H.addToSelf(A));if(V)for(h=0;h<4;h++)a=F[R+h],a>0&&(C.e.FromFloat32ArrayToRefScaled(u,Math.floor(16*K[R+h]),a,A),H.addToSelf(A));C.s.TransformCoordinatesFromFloatsToRef(p._sourcePositions[c],p._sourcePositions[c+1],p._sourcePositions[c+2],H,f),f.toArray(P,c),v&&(C.s.TransformNormalFromFloatsToRef(p._sourceNormals[c],p._sourceNormals[c+1],p._sourceNormals[c+2],H,f),f.toArray(b,c)),H.reset()}return this.updateVerticesData(c.f.PositionKind,P),v&&this.updateVerticesData(c.f.NormalKind,b),this}static MinMax(a){let v=null,p=null;return a.forEach((function(a){const P=a.getBoundingInfo().boundingBox;v&&p?(v.minimizeInPlace(P.minimumWorld),p.maximizeInPlace(P.maximumWorld)):(v=P.minimumWorld,p=P.maximumWorld)})),v&&p?{min:v,max:p}:{min:C.s.Zero(),max:C.s.Zero()}}static Center(a){const v=a instanceof Array?J.MinMax(a):a;return C.s.Center(v.min,v.max)}static MergeMeshes(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;return(0,V.f)(J._MergeMeshesCoroutine(a,v,p,P,b,L,!1))}static MergeMeshesAsync(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;return(0,V.e)(J._MergeMeshesCoroutine(a,v,p,P,b,L,!0),(0,V.c)())}static*_MergeMeshesCoroutine(a){let v,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0;if(0===(a=a.filter(Boolean)).length)return null;if(!P){let p=0;for(v=0;v<a.length;v++)if(p+=a[v].getTotalVertices(),p>=65536)return D.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}t&&(L=!1);const K=new Array,C=new Array,F=new Array,u=a[0].sideOrientation;for(v=0;v<a.length;v++){const p=a[v];if(p.isAnInstance)return D.d.Warn("Cannot merge instance meshes."),null;if(u!==p.sideOrientation)return D.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(L&&F.push(p.getTotalIndices()),t)if(p.material){const a=p.material;if(a instanceof X.c){for(let v=0;v<a.sg.length;v++)K.indexOf(a.sg[v])<0&&K.push(a.sg[v]);for(let v=0;v<p.rg.length;v++)C.push(K.indexOf(a.sg[p.rg[v].materialIndex])),F.push(p.rg[v].indexCount)}else{K.indexOf(a)<0&&K.push(a);for(let v=0;v<p.rg.length;v++)C.push(K.indexOf(a)),F.push(p.rg[v].indexCount)}}else for(let a=0;a<p.rg.length;a++)C.push(0),F.push(p.rg[a].indexCount)}const c=a[0],H=a=>{const v=a.Zj(!0);return{vertexData:f.e.ExtractFromMesh(a,!1,!1),transform:v}},{vertexData:A,transform:R}=H(c);V&&(yield);const Q=new Array(a.length-1);for(let f=1;f<a.length;f++)Q[f-1]=H(a[f]),V&&(yield);const s=A._mergeCoroutine(R,Q,P,V,!p);let y=s.next();for(;!y.done;)V&&(yield),y=s.next();const Z=y.value;b||(b=new J(c.name+"_merged",c.va()));const M=Z._applyToCoroutine(b,void 0,V);let S=M.next();for(;!S.done;)V&&(yield),S=M.next();if(b.checkCollisions=c.checkCollisions,b.sideOrientation=c.sideOrientation,p)for(v=0;v<a.length;v++)a[v].dispose();if(L||t){b.releaseSubMeshes(),v=0;let a=0;for(;v<F.length;)h.d.CreateFromIndices(0,a,F[v],b,void 0,!1),a+=F[v],v++;for(const v of b.rg)v.refreshBoundingInfo();b.Zj(!0)}if(t){const a=new X.c(c.name+"_merged",c.va());a.sg=K;for(let v=0;v<b.rg.length;v++)b.rg[v].materialIndex=C[v];b.material=a}else b.material=c.material;return b}Rj(a){a._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(a)}Qj(a){const v=a._indexInSourceMeshInstanceArray;if(-1!=v){if(v!==this.instances.length-1){const a=this.instances[this.instances.length-1];this.instances[v]=a,a._indexInSourceMeshInstanceArray=v}a._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===R.c.CounterClockWiseSideOrientation}_getRenderingFillMode(a){const v=this.va();return v.forcePointsCloud?R.c.PointFillMode:v.forceWireframe?R.c.WireFrameFillMode:this.overrideRenderingFillMode??a}setMaterialByID(a){return this.setMaterialById(a)}static CreateRibbon(a,v,p,P,b,L,t,V,K){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(a,v,p,P,b,L){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(a,v,p,P,b){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(a,v,p,P,b,L){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(a,v,p,P){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(a,v,p,P,b,L,t,V,K){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(a,v,p,P,b,L,t){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(a,v,p,P,b,L,t,V,K,C){throw new Error("Import MeshBuilder to populate this function")}static qb(a,v,p,P,b){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(a,v,p,P,b,L,t,V){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(a,v,p,P,b,L,t){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(a,v,p,P,b,L,t,V){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(a,v,p,P,b,L,t,V,K,C){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(a,v,p,P,b,L,t,V,K,C,F,u){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(a,v,p,P,b,L,t){throw new Error("Import MeshBuilder to populate this function")}static ug(a,v,p,P,b){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(a,v,p,P,b,L){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(a,v,p,P,b,L,t,V,K){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(a,v,p,P,b,L,t,V,K,C,F){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(a,v,p,P,b,L,t,V,K,C){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(a,v,p){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(a,v,p){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(a,v,p,P,b,L){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(a,v,p){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(a){throw new Error("Import MeshBuilder to populate this function")}}J.FRONTSIDE=f.e.FRONTSIDE,J.BACKSIDE=f.e.BACKSIDE,J.DOUBLESIDE=f.e.DOUBLESIDE,J.DEFAULTSIDE=f.e.DEFAULTSIDE,J.NO_CAP=0,J.CAP_START=1,J.CAP_END=2,J.CAP_ALL=3,J.NO_FLIP=0,J.FLIP_TILE=1,J.ROTATE_TILE=2,J.FLIP_ROW=3,J.ROTATE_ROW=4,J.FLIP_N_ROTATE_TILE=5,J.FLIP_N_ROTATE_ROW=6,J.CENTER=0,J.LEFT=1,J.RIGHT=2,J.TOP=3,J.BOTTOM=4,J.INSTANCEDMESH_SORT_TRANSPARENT=!1,J._GroundMeshParser=(a,v)=>{throw(0,Z.c)("GroundMesh")},J._GoldbergMeshParser=(a,v)=>{throw(0,Z.c)("GoldbergMesh")},J._LinesMeshParser=(a,v)=>{throw(0,Z.c)("LinesMesh")},J._GreasedLineMeshParser=(a,v)=>{throw(0,Z.c)("GreasedLineMesh")},J._GreasedLineRibbonMeshParser=(a,v)=>{throw(0,Z.c)("GreasedLineRibbonMesh")},J._TrailMeshParser=(a,v)=>{throw(0,Z.c)("TrailMesh")},(0,y.f)("BABYLON.Mesh",J)},11528:(a,v,p)=>{"use strict";p.d(v,{e:()=>H});var P=p(11207),b=p(11240),L=p(11306),t=p(10926),V=p(11279),K=p(10905),C=p(11210),F=p(11506),u=p(10955),c=p(11395);class f{}class H{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,F.d)(this._applyToCoroutine.bind(this)),this.uniqueId=H._UniqueIDGenerator,H._UniqueIDGenerator++}set(a,v){switch(a.length||K.d.Warn(`Setting vertex data kind '${v}' with an empty array`),v){case L.f.PositionKind:this.xa=a;break;case L.f.NormalKind:this.ya=a;break;case L.f.TangentKind:this.tangents=a;break;case L.f.UVKind:this.Aa=a;break;case L.f.UV2Kind:this.uvs2=a;break;case L.f.UV3Kind:this.uvs3=a;break;case L.f.UV4Kind:this.uvs4=a;break;case L.f.UV5Kind:this.uvs5=a;break;case L.f.UV6Kind:this.uvs6=a;break;case L.f.ColorKind:this.za=a;break;case L.f.MatricesIndicesKind:this.matricesIndices=a;break;case L.f.MatricesWeightsKind:this.matricesWeights=a;break;case L.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=a;break;case L.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=a}}Ca(a,v){return this._applyTo(a,v,!1),this}applyToGeometry(a,v){return this._applyTo(a,v,!1),this}updateMesh(a){return this._update(a),this}updateGeometry(a){return this._update(a),this}*_applyToCoroutine(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;if(this.xa&&(a.Ga(L.f.PositionKind,this.xa,v),p&&(yield)),this.ya&&(a.Ga(L.f.NormalKind,this.ya,v),p&&(yield)),this.tangents&&(a.Ga(L.f.TangentKind,this.tangents,v),p&&(yield)),this.Aa&&(a.Ga(L.f.UVKind,this.Aa,v),p&&(yield)),this.uvs2&&(a.Ga(L.f.UV2Kind,this.uvs2,v),p&&(yield)),this.uvs3&&(a.Ga(L.f.UV3Kind,this.uvs3,v),p&&(yield)),this.uvs4&&(a.Ga(L.f.UV4Kind,this.uvs4,v),p&&(yield)),this.uvs5&&(a.Ga(L.f.UV5Kind,this.uvs5,v),p&&(yield)),this.uvs6&&(a.Ga(L.f.UV6Kind,this.uvs6,v),p&&(yield)),this.za&&(a.Ga(L.f.ColorKind,this.za,v),this.hasVertexAlpha&&void 0!==a.hasVertexAlpha&&(a.hasVertexAlpha=!0),p&&(yield)),this.matricesIndices&&(a.Ga(L.f.MatricesIndicesKind,this.matricesIndices,v),p&&(yield)),this.matricesWeights&&(a.Ga(L.f.MatricesWeightsKind,this.matricesWeights,v),p&&(yield)),this.matricesIndicesExtra&&(a.Ga(L.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,v),p&&(yield)),this.matricesWeightsExtra&&(a.Ga(L.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,v),p&&(yield)),this.indices?(a.setIndices(this.indices,null,v),p&&(yield)):a.setIndices([],null),a.rg&&this.materialInfos&&this.materialInfos.length>1){const v=a;v.rg=[];for(const a of this.materialInfos)new c.d(a.materialIndex,a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,v)}return this}_update(a,v,p){return this.xa&&a.updateVerticesData(L.f.PositionKind,this.xa,v,p),this.ya&&a.updateVerticesData(L.f.NormalKind,this.ya,v,p),this.tangents&&a.updateVerticesData(L.f.TangentKind,this.tangents,v,p),this.Aa&&a.updateVerticesData(L.f.UVKind,this.Aa,v,p),this.uvs2&&a.updateVerticesData(L.f.UV2Kind,this.uvs2,v,p),this.uvs3&&a.updateVerticesData(L.f.UV3Kind,this.uvs3,v,p),this.uvs4&&a.updateVerticesData(L.f.UV4Kind,this.uvs4,v,p),this.uvs5&&a.updateVerticesData(L.f.UV5Kind,this.uvs5,v,p),this.uvs6&&a.updateVerticesData(L.f.UV6Kind,this.uvs6,v,p),this.za&&a.updateVerticesData(L.f.ColorKind,this.za,v,p),this.matricesIndices&&a.updateVerticesData(L.f.MatricesIndicesKind,this.matricesIndices,v,p),this.matricesWeights&&a.updateVerticesData(L.f.MatricesWeightsKind,this.matricesWeights,v,p),this.matricesIndicesExtra&&a.updateVerticesData(L.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,v,p),this.matricesWeightsExtra&&a.updateVerticesData(L.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,v,p),this.indices&&a.setIndices(this.indices,null),this}static _TransformVector3Coordinates(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.length;const L=b.k.fb[0],t=b.k.fb[1];for(let V=p;V<p+P;V+=3)b.s.FromArrayToRef(a,V,L),b.s.TransformCoordinatesToRef(L,v,t),a[V]=t.x,a[V+1]=t.y,a[V+2]=t.z}static _TransformVector3Normals(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.length;const L=b.k.fb[0],t=b.k.fb[1];for(let V=p;V<p+P;V+=3)b.s.FromArrayToRef(a,V,L),b.s.TransformNormalToRef(L,v,t),a[V]=t.x,a[V+1]=t.y,a[V+2]=t.z}static _TransformVector4Normals(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.length;const L=b.k.Vector4[0],t=b.k.Vector4[1];for(let V=p;V<p+P;V+=4)b.t.FromArrayToRef(a,V,L),b.t.TransformNormalToRef(L,v,t),a[V]=t.x,a[V+1]=t.y,a[V+2]=t.z,a[V+3]=t.w}static _FlipFaces(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.length;for(let P=v;P<v+p;P+=3){const v=a[P+1];a[P+1]=a[P+2],a[P+2]=v}}transform(a){const v=a.determinant()<0;return this.xa&&H._TransformVector3Coordinates(this.xa,a),this.ya&&H._TransformVector3Normals(this.ya,a),this.tangents&&H._TransformVector4Normals(this.tangents,a),v&&this.indices&&H._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const a=[];for(const v of this.materialInfos){const p=new H;if(this.xa&&(p.xa=this.xa.slice(3*v.verticesStart,3*(v.verticesCount+v.verticesStart))),this.ya&&(p.ya=this.ya.slice(3*v.verticesStart,3*(v.verticesCount+v.verticesStart))),this.tangents&&(p.tangents=this.tangents.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.za&&(p.za=this.za.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.Aa&&(p.Aa=this.Aa.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs2&&(p.uvs2=this.uvs2.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs3&&(p.uvs3=this.uvs3.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs4&&(p.uvs4=this.uvs4.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs5&&(p.uvs5=this.uvs5.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.uvs6&&(p.uvs6=this.uvs6.slice(2*v.verticesStart,2*(v.verticesCount+v.verticesStart))),this.matricesIndices&&(p.matricesIndices=this.matricesIndices.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesIndicesExtra&&(p.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesWeights&&(p.matricesWeights=this.matricesWeights.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.matricesWeightsExtra&&(p.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*v.verticesStart,4*(v.verticesCount+v.verticesStart))),this.indices){p.indices=[];for(let a=v.indexStart;a<v.indexStart+v.indexCount;a++)p.indices.push(this.indices[a]-v.verticesStart)}const P=new f;P.indexStart=0,P.indexCount=p.indices?p.indices.length:0,P.materialIndex=v.materialIndex,P.verticesStart=0,P.verticesCount=(p.xa?p.xa.length:0)/3,p.materialInfos=[P],a.push(p)}return a}merge(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const L=Array.isArray(a)?a.map((a=>({vertexData:a}))):[{vertexData:a}];return(0,F.f)(this._mergeCoroutine(void 0,L,v,!1,p,P,b))}*_mergeCoroutine(a,v){var p,P;let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let F=v.map((a=>a.vertexData)),u=this;if(C)for(const L of F)L&&(L._validate(),!this.ya&&L.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&L.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&L.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&L.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&L.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&L.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&L.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&L.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&L.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&L.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&L.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&L.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&L.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const L of F)if(L)if(C)this.ya&&!L.ya&&(L.ya=new Float32Array(L.xa.length)),this.tangents&&!L.tangents&&(L.tangents=new Float32Array(L.xa.length/3*4)),this.Aa&&!L.Aa&&(L.Aa=new Float32Array(L.xa.length/3*2)),this.uvs2&&!L.uvs2&&(L.uvs2=new Float32Array(L.xa.length/3*2)),this.uvs3&&!L.uvs3&&(L.uvs3=new Float32Array(L.xa.length/3*2)),this.uvs4&&!L.uvs4&&(L.uvs4=new Float32Array(L.xa.length/3*2)),this.uvs5&&!L.uvs5&&(L.uvs5=new Float32Array(L.xa.length/3*2)),this.uvs6&&!L.uvs6&&(L.uvs6=new Float32Array(L.xa.length/3*2)),this.za&&!L.za&&(L.za=new Float32Array(L.xa.length/3*4),L.za.fill(1)),this.matricesIndices&&!L.matricesIndices&&(L.matricesIndices=new Float32Array(L.xa.length/3*4)),this.matricesWeights&&!L.matricesWeights&&(L.matricesWeights=new Float32Array(L.xa.length/3*4)),this.matricesIndicesExtra&&!L.matricesIndicesExtra&&(L.matricesIndicesExtra=new Float32Array(L.xa.length/3*4)),this.matricesWeightsExtra&&!L.matricesWeightsExtra&&(L.matricesWeightsExtra=new Float32Array(L.xa.length/3*4));else if(L._validate(),!this.ya!==!L.ya||!this.tangents!==!L.tangents||!this.Aa!==!L.Aa||!this.uvs2!==!L.uvs2||!this.uvs3!==!L.uvs3||!this.uvs4!==!L.uvs4||!this.uvs5!==!L.uvs5||!this.uvs6!==!L.uvs6||!this.za!==!L.za||!this.matricesIndices!==!L.matricesIndices||!this.matricesWeights!==!L.matricesWeights||!this.matricesIndicesExtra!==!L.matricesIndicesExtra||!this.matricesWeightsExtra!==!L.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(K){let p=0,P=0,b=0;const L=[];let t=null;const V=[];for(const v of this.splitBasedOnMaterialID())V.push({vertexData:v,transform:a});for(const a of v)if(a.vertexData)for(const v of a.vertexData.splitBasedOnMaterialID())V.push({vertexData:v,transform:a.transform});V.sort(((a,v)=>{const p=a.vertexData.materialInfos?a.vertexData.materialInfos[0].materialIndex:0,P=v.vertexData.materialInfos?v.vertexData.materialInfos[0].materialIndex:0;return p>P?1:p===P?0:-1}));for(const a of V){const v=a.vertexData;if(p=v.materialInfos?v.materialInfos[0].materialIndex:0,t&&t.materialIndex===p)t.indexCount+=v.indices.length,t.verticesCount+=v.xa.length/3;else{const a=new f;a.materialIndex=p,a.indexStart=P,a.indexCount=v.indices.length,a.verticesStart=b,a.verticesCount=v.xa.length/3,L.push(a),t=a}P+=v.indices.length,b+=v.xa.length/3}const K=V.splice(0,1)[0];u=K.vertexData,a=K.transform,F=V.map((a=>a.vertexData)),v=V,this.materialInfos=L}const c=F.reduce(((a,v)=>{var p;return a+((null===(p=v.indices)||void 0===p?void 0:p.length)??0)}),(null===(p=u.indices)||void 0===p?void 0:p.length)??0);let A=V||F.some((a=>a.indices===u.indices))?null===(P=u.indices)||void 0===P?void 0:P.slice():u.indices;if(c>0){var h;let p=(null===(h=A)||void 0===h?void 0:h.length)??0;if(A||(A=new Array(c)),A.length!==c){if(Array.isArray(A))A.length=c;else{const a=b||A instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);a.set(A),A=a}a&&a.determinant()<0&&H._FlipFaces(A,0,p)}let P=u.xa?u.xa.length/3:0;for(const{vertexData:a,transform:b}of v)if(a.indices){for(let v=0;v<a.indices.length;v++)A[p+v]=a.indices[v]+P;b&&b.determinant()<0&&H._FlipFaces(A,p,a.indices.length),P+=a.xa.length/3,p+=a.indices.length,t&&(yield)}}return this.indices=A,this.xa=H._MergeElement(L.f.PositionKind,u.xa,a,v.map((a=>[a.vertexData.xa,a.transform]))),t&&(yield),u.ya&&(this.ya=H._MergeElement(L.f.NormalKind,u.ya,a,v.map((a=>[a.vertexData.ya,a.transform]))),t&&(yield)),u.tangents&&(this.tangents=H._MergeElement(L.f.TangentKind,u.tangents,a,v.map((a=>[a.vertexData.tangents,a.transform]))),t&&(yield)),u.Aa&&(this.Aa=H._MergeElement(L.f.UVKind,u.Aa,a,v.map((a=>[a.vertexData.Aa,a.transform]))),t&&(yield)),u.uvs2&&(this.uvs2=H._MergeElement(L.f.UV2Kind,u.uvs2,a,v.map((a=>[a.vertexData.uvs2,a.transform]))),t&&(yield)),u.uvs3&&(this.uvs3=H._MergeElement(L.f.UV3Kind,u.uvs3,a,v.map((a=>[a.vertexData.uvs3,a.transform]))),t&&(yield)),u.uvs4&&(this.uvs4=H._MergeElement(L.f.UV4Kind,u.uvs4,a,v.map((a=>[a.vertexData.uvs4,a.transform]))),t&&(yield)),u.uvs5&&(this.uvs5=H._MergeElement(L.f.UV5Kind,u.uvs5,a,v.map((a=>[a.vertexData.uvs5,a.transform]))),t&&(yield)),u.uvs6&&(this.uvs6=H._MergeElement(L.f.UV6Kind,u.uvs6,a,v.map((a=>[a.vertexData.uvs6,a.transform]))),t&&(yield)),u.za&&(this.za=H._MergeElement(L.f.ColorKind,u.za,a,v.map((a=>[a.vertexData.za,a.transform]))),(void 0!==u.hasVertexAlpha||v.some((a=>void 0!==a.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=u.hasVertexAlpha||v.some((a=>a.vertexData.hasVertexAlpha))),t&&(yield)),u.matricesIndices&&(this.matricesIndices=H._MergeElement(L.f.MatricesIndicesKind,u.matricesIndices,a,v.map((a=>[a.vertexData.matricesIndices,a.transform]))),t&&(yield)),u.matricesWeights&&(this.matricesWeights=H._MergeElement(L.f.MatricesWeightsKind,u.matricesWeights,a,v.map((a=>[a.vertexData.matricesWeights,a.transform]))),t&&(yield)),u.matricesIndicesExtra&&(this.matricesIndicesExtra=H._MergeElement(L.f.MatricesIndicesExtraKind,u.matricesIndicesExtra,a,v.map((a=>[a.vertexData.matricesIndicesExtra,a.transform]))),t&&(yield)),u.matricesWeightsExtra&&(this.matricesWeightsExtra=H._MergeElement(L.f.MatricesWeightsExtraKind,u.matricesWeightsExtra,a,v.map((a=>[a.vertexData.matricesWeightsExtra,a.transform])))),this}static _MergeElement(a,v,p,P){const b=P.filter((a=>null!==a[0]&&void 0!==a[0]));if(!v&&0==b.length)return v;if(!v)return this._MergeElement(a,b[0][0],b[0][1],b.slice(1));const t=b.reduce(((a,v)=>a+v[0].length),v.length),V=a===L.f.PositionKind?H._TransformVector3Coordinates:a===L.f.NormalKind?H._TransformVector3Normals:a===L.f.TangentKind?H._TransformVector4Normals:()=>{};if(v instanceof Float32Array){const a=new Float32Array(t);a.set(v),p&&V(a,p,0,v.length);let P=v.length;for(const[v,p]of b)a.set(v,P),p&&V(a,p,P,v.length),P+=v.length;return a}{const a=new Array(t);for(let p=0;p<v.length;p++)a[p]=v[p];p&&V(a,p,0,v.length);let P=v.length;for(const[v,p]of b){for(let p=0;p<v.length;p++)a[P+p]=v[p];p&&V(a,p,P,v.length),P+=v.length}return a}}_validate(){if(!this.xa)throw new u.g("Positions are required",u.e.MeshInvalidPositionsError);const a=(a,v)=>{const p=L.f.DeduceStride(a);if(v.length%p!==0)throw new Error("The "+a+"s array count must be a multiple of "+p);return v.length/p},v=a(L.f.PositionKind,this.xa),p=(p,P)=>{const b=a(p,P);if(b!==v)throw new Error("The "+p+"s element count ("+b+") does not match the positions count ("+v+")")};this.ya&&p(L.f.NormalKind,this.ya),this.tangents&&p(L.f.TangentKind,this.tangents),this.Aa&&p(L.f.UVKind,this.Aa),this.uvs2&&p(L.f.UV2Kind,this.uvs2),this.uvs3&&p(L.f.UV3Kind,this.uvs3),this.uvs4&&p(L.f.UV4Kind,this.uvs4),this.uvs5&&p(L.f.UV5Kind,this.uvs5),this.uvs6&&p(L.f.UV6Kind,this.uvs6),this.za&&p(L.f.ColorKind,this.za),this.matricesIndices&&p(L.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&p(L.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&p(L.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&p(L.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const a=this.serialize();return H.Parse(a)}serialize(){const a={};if(this.xa&&(a.xa=Array.from(this.xa)),this.ya&&(a.ya=Array.from(this.ya)),this.tangents&&(a.tangents=Array.from(this.tangents)),this.Aa&&(a.Aa=Array.from(this.Aa)),this.uvs2&&(a.uvs2=Array.from(this.uvs2)),this.uvs3&&(a.uvs3=Array.from(this.uvs3)),this.uvs4&&(a.uvs4=Array.from(this.uvs4)),this.uvs5&&(a.uvs5=Array.from(this.uvs5)),this.uvs6&&(a.uvs6=Array.from(this.uvs6)),this.za&&(a.za=Array.from(this.za),a.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(a.matricesIndices=Array.from(this.matricesIndices),a.matricesIndices._isExpanded=!0),this.matricesWeights&&(a.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(a.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),a.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(a.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),a.indices=Array.from(this.indices),this.materialInfos){a.materialInfos=[];for(const v of this.materialInfos){const p={indexStart:v.indexStart,indexCount:v.indexCount,materialIndex:v.materialIndex,verticesStart:v.verticesStart,verticesCount:v.verticesCount};a.materialInfos.push(p)}}return a}static ExtractFromMesh(a,v,p){return H._ExtractFrom(a,v,p)}static ExtractFromGeometry(a,v,p){return H._ExtractFrom(a,v,p)}static _ExtractFrom(a,v,p){const P=new H;if(a.isVerticesDataPresent(L.f.PositionKind)&&(P.xa=a.getVerticesData(L.f.PositionKind,v,p)),a.isVerticesDataPresent(L.f.NormalKind)&&(P.ya=a.getVerticesData(L.f.NormalKind,v,p)),a.isVerticesDataPresent(L.f.TangentKind)&&(P.tangents=a.getVerticesData(L.f.TangentKind,v,p)),a.isVerticesDataPresent(L.f.UVKind)&&(P.Aa=a.getVerticesData(L.f.UVKind,v,p)),a.isVerticesDataPresent(L.f.UV2Kind)&&(P.uvs2=a.getVerticesData(L.f.UV2Kind,v,p)),a.isVerticesDataPresent(L.f.UV3Kind)&&(P.uvs3=a.getVerticesData(L.f.UV3Kind,v,p)),a.isVerticesDataPresent(L.f.UV4Kind)&&(P.uvs4=a.getVerticesData(L.f.UV4Kind,v,p)),a.isVerticesDataPresent(L.f.UV5Kind)&&(P.uvs5=a.getVerticesData(L.f.UV5Kind,v,p)),a.isVerticesDataPresent(L.f.UV6Kind)&&(P.uvs6=a.getVerticesData(L.f.UV6Kind,v,p)),a.isVerticesDataPresent(L.f.ColorKind)){const b=a.Oj||a,t=b.getVertexBuffer(L.f.ColorKind),V=b.getVerticesData(L.f.ColorKind,v,p);if(3===t.getSize()){const a=new Float32Array(4*V.length/3);for(let v=0,p=0;v<V.length;v+=3,p+=4)a[p]=V[v],a[p+1]=V[v+1],a[p+2]=V[v+2],a[p+3]=1;P.za=a}else{if(4!==t.getSize())throw new Error(`Unexpected number of color components: ${t.getSize()}`);P.za=V}}return a.isVerticesDataPresent(L.f.MatricesIndicesKind)&&(P.matricesIndices=a.getVerticesData(L.f.MatricesIndicesKind,v,p)),a.isVerticesDataPresent(L.f.MatricesWeightsKind)&&(P.matricesWeights=a.getVerticesData(L.f.MatricesWeightsKind,v,p)),a.isVerticesDataPresent(L.f.MatricesIndicesExtraKind)&&(P.matricesIndicesExtra=a.getVerticesData(L.f.MatricesIndicesExtraKind,v,p)),a.isVerticesDataPresent(L.f.MatricesWeightsExtraKind)&&(P.matricesWeightsExtra=a.getVerticesData(L.f.MatricesWeightsExtraKind,v,p)),P.indices=a.ng(v,p),P}static CreateRibbon(a){throw(0,t.c)("ribbonBuilder")}static CreateBox(a){throw(0,t.c)("boxBuilder")}static CreateTiledBox(a){throw(0,t.c)("tiledBoxBuilder")}static CreateTiledPlane(a){throw(0,t.c)("tiledPlaneBuilder")}static CreateSphere(a){throw(0,t.c)("sphereBuilder")}static CreateCylinder(a){throw(0,t.c)("cylinderBuilder")}static CreateTorus(a){throw(0,t.c)("torusBuilder")}static CreateLineSystem(a){throw(0,t.c)("linesBuilder")}static CreateDashedLines(a){throw(0,t.c)("linesBuilder")}static CreateGround(a){throw(0,t.c)("groundBuilder")}static CreateTiledGround(a){throw(0,t.c)("groundBuilder")}static CreateGroundFromHeightMap(a){throw(0,t.c)("groundBuilder")}static ug(a){throw(0,t.c)("planeBuilder")}static CreateDisc(a){throw(0,t.c)("discBuilder")}static CreatePolygon(a,v,p,P,b,L,V){throw(0,t.c)("polygonBuilder")}static CreateIcoSphere(a){throw(0,t.c)("icoSphereBuilder")}static CreatePolyhedron(a){throw(0,t.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||b.s.Up();throw(0,t.c)("capsuleBuilder")}static CreateTorusKnot(a){throw(0,t.c)("torusKnotBuilder")}static ComputeNormals(a,v,p,P){let L=0,t=0,V=0,K=0,C=0,F=0,u=0,c=0,f=0,H=0,A=0,h=0,R=0,X=0,Q=0,s=0,D=0,y=0,Z=0,M=0,S=!1,n=!1,q=!1,T=!1,j=1,w=0,J=null;P&&(S=!!P.facetNormals,n=!!P.facetPositions,q=!!P.facetPartitioning,j=!0===P.useRightHandedSystem?-1:1,w=P.ratio||0,T=!!P.depthSort,J=P.distanceTo,T&&void 0===J&&(J=b.s.Zero()));let B=0,x=0,r=0,o=0;for(q&&P&&P.bbSize&&(B=P.subDiv.X*w/P.bbSize.x,x=P.subDiv.Y*w/P.bbSize.y,r=P.subDiv.Z*w/P.bbSize.z,o=P.subDiv.max*P.subDiv.max,P.facetPartitioning.length=0),L=0;L<a.length;L++)p[L]=0;const m=v.length/3|0;for(L=0;L<m;L++){if(h=3*v[3*L],R=h+1,X=h+2,Q=3*v[3*L+1],s=Q+1,D=Q+2,y=3*v[3*L+2],Z=y+1,M=y+2,t=a[h]-a[Q],V=a[R]-a[s],K=a[X]-a[D],C=a[y]-a[Q],F=a[Z]-a[s],u=a[M]-a[D],c=j*(V*u-K*F),f=j*(K*C-t*u),H=j*(t*F-V*C),A=Math.sqrt(c*c+f*f+H*H),A=0===A?1:A,c/=A,f/=A,H/=A,S&&P&&(P.facetNormals[L].x=c,P.facetNormals[L].y=f,P.facetNormals[L].z=H),n&&P&&(P.facetPositions[L].x=(a[h]+a[Q]+a[y])/3,P.facetPositions[L].y=(a[R]+a[s]+a[Z])/3,P.facetPositions[L].z=(a[X]+a[D]+a[M])/3),q&&P){const v=Math.floor((P.facetPositions[L].x-P.bInfo.minimum.x*w)*B),p=Math.floor((P.facetPositions[L].y-P.bInfo.minimum.y*w)*x),b=Math.floor((P.facetPositions[L].z-P.bInfo.minimum.z*w)*r),t=Math.floor((a[h]-P.bInfo.minimum.x*w)*B),V=Math.floor((a[R]-P.bInfo.minimum.y*w)*x),K=Math.floor((a[X]-P.bInfo.minimum.z*w)*r),C=Math.floor((a[Q]-P.bInfo.minimum.x*w)*B),F=Math.floor((a[s]-P.bInfo.minimum.y*w)*x),u=Math.floor((a[D]-P.bInfo.minimum.z*w)*r),c=Math.floor((a[y]-P.bInfo.minimum.x*w)*B),f=Math.floor((a[Z]-P.bInfo.minimum.y*w)*x),H=Math.floor((a[M]-P.bInfo.minimum.z*w)*r),A=t+P.subDiv.max*V+o*K,S=C+P.subDiv.max*F+o*u,n=c+P.subDiv.max*f+o*H,q=v+P.subDiv.max*p+o*b;P.facetPartitioning[q]=P.facetPartitioning[q]?P.facetPartitioning[q]:new Array,P.facetPartitioning[A]=P.facetPartitioning[A]?P.facetPartitioning[A]:new Array,P.facetPartitioning[S]=P.facetPartitioning[S]?P.facetPartitioning[S]:new Array,P.facetPartitioning[n]=P.facetPartitioning[n]?P.facetPartitioning[n]:new Array,P.facetPartitioning[A].push(L),S!=A&&P.facetPartitioning[S].push(L),n!=S&&n!=A&&P.facetPartitioning[n].push(L),q!=A&&q!=S&&q!=n&&P.facetPartitioning[q].push(L)}if(T&&P&&P.facetPositions){const a=P.depthSortedFacets[L];a.ind=3*L,a.sqDistance=b.s.DistanceSquared(P.facetPositions[L],J)}p[h]+=c,p[R]+=f,p[X]+=H,p[Q]+=c,p[s]+=f,p[D]+=H,p[y]+=c,p[Z]+=f,p[M]+=H}for(L=0;L<p.length/3;L++)c=p[3*L],f=p[3*L+1],H=p[3*L+2],A=Math.sqrt(c*c+f*f+H*H),A=0===A?1:A,c/=A,f/=A,H/=A,p[3*L]=c,p[3*L+1]=f,p[3*L+2]=H}static _ComputeSides(a,v,p,P,L,t,V){const K=p.length,C=P.length;let F,u;switch(a=a||H.DEFAULTSIDE){case H.FRONTSIDE:break;case H.BACKSIDE:for(F=0;F<K;F+=3){const a=p[F];p[F]=p[F+2],p[F+2]=a}for(u=0;u<C;u++)P[u]=-P[u];break;case H.DOUBLESIDE:{const a=v.length,c=a/3;for(let p=0;p<a;p++)v[a+p]=v[p];for(F=0;F<K;F+=3)p[F+K]=p[F+2]+c,p[F+1+K]=p[F+1]+c,p[F+2+K]=p[F]+c;for(u=0;u<C;u++)P[C+u]=-P[u];const f=L.length;let H=0;for(H=0;H<f;H++)L[H+f]=L[H];for(t=t||new b.t(0,0,1,1),V=V||new b.t(0,0,1,1),H=0,F=0;F<f/2;F++)L[H]=t.x+(t.z-t.x)*L[H],L[H+1]=t.y+(t.w-t.y)*L[H+1],L[H+f]=V.x+(V.z-V.x)*L[H+f],L[H+f+1]=V.y+(V.w-V.y)*L[H+f+1],H+=2;break}}}static Parse(a){const v=new H,p=a.xa;p&&v.set(p,L.f.PositionKind);const P=a.ya;P&&v.set(P,L.f.NormalKind);const b=a.tangents;b&&v.set(b,L.f.TangentKind);const t=a.Aa;t&&v.set(t,L.f.UVKind);const K=a.uvs2;K&&v.set(K,L.f.UV2Kind);const C=a.uvs3;C&&v.set(C,L.f.UV3Kind);const F=a.uvs4;F&&v.set(F,L.f.UV4Kind);const u=a.uvs5;u&&v.set(u,L.f.UV5Kind);const c=a.uvs6;c&&v.set(c,L.f.UV6Kind);const A=a.za;A&&(v.set(V.e.CheckColors4(A,p.length/3),L.f.ColorKind),void 0!==a.hasVertexAlpha&&(v.hasVertexAlpha=a.hasVertexAlpha));const h=a.matricesIndices;h&&v.set(h,L.f.MatricesIndicesKind);const R=a.matricesWeights;R&&v.set(R,L.f.MatricesWeightsKind);const X=a.indices;X&&(v.indices=X);const Q=a.materialInfos;if(Q){v.materialInfos=[];for(const a of Q){const p=new f;p.indexCount=a.indexCount,p.indexStart=a.indexStart,p.verticesCount=a.verticesCount,p.verticesStart=a.verticesStart,p.materialIndex=a.materialIndex,v.materialInfos.push(p)}}return v}static ImportVertexData(a,v){const p=H.Parse(a);v.setAllVerticesData(p,a.updatable)}}H.FRONTSIDE=0,H.BACKSIDE=1,H.DOUBLESIDE=2,H.DEFAULTSIDE=0,H._UniqueIDGenerator=0,(0,P.e)([C.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P]=v;return!Array.isArray(P)}))],H,"_TransformVector3Coordinates",null),(0,P.e)([C.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P]=v;return!Array.isArray(P)}))],H,"_TransformVector3Normals",null),(0,P.e)([C.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P]=v;return!Array.isArray(P)}))],H,"_TransformVector4Normals",null),(0,P.e)([C.f.filter((function(){for(var a=arguments.length,v=new Array(a),p=0;p<a;p++)v[p]=arguments[p];let[P]=v;return!Array.isArray(P)}))],H,"_FlipFaces",null)},12859:(a,v,p)=>{"use strict";p.d(v,{e:()=>Aa});var P=p(11240),b=p(11504),L=p(11306),t=p(11528),V=p(11470);function K(a){let v=a.pathArray;const p=a.closeArray||!1,P=a.closePath||!1,b=a.invertUV||!1,K=Math.floor(v[0].length/2);let C=a.offset||K;C=C>K?K:Math.floor(C);const F=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,u=a.Aa,c=a.za,f=[],H=[],A=[],h=[],R=[],X=[],Q=[],s=[];let D;const y=[],Z=[];let M,S,n;if(v.length<2){const a=[],p=[];for(S=0;S<v[0].length-C;S++)a.push(v[0][S]),p.push(v[0][S+C]);v=[a,p]}let q=0;const T=P?1:0,j=p?1:0;let w,J,B,x,r,o;for(D=v[0].length,M=0;M<v.length+j;M++){for(Q[M]=0,R[M]=[0],w=M===v.length?v[0]:v[M],J=w.length,D=D<J?D:J,n=0;n<J;)f.push(w[n].x,w[n].y,w[n].z),n>0&&(B=w[n].od(w[n-1]).length(),x=B+Q[M],R[M].push(x),Q[M]=x),n++;P&&(n--,f.push(w[0].x,w[0].y,w[0].z),B=w[n].od(w[0]).length(),x=B+Q[M],R[M].push(x),Q[M]=x),y[M]=J+T,Z[M]=q,q+=J+T}let m,O,Y=null,l=null;for(S=0;S<D+T;S++)for(s[S]=0,X[S]=[0],M=0;M<v.length-1+j;M++)r=v[M],o=M===v.length-1?v[0]:v[M+1],S===D?(Y=r[0],l=o[0]):(Y=r[S],l=o[S]),B=l.od(Y).length(),x=B+s[S],X[S].push(x),s[S]=x;if(u)for(M=0;M<u.length;M++)h.push(u[M].x,V.b?1-u[M].y:u[M].y);else for(M=0;M<v.length+j;M++)for(S=0;S<D+T;S++)m=0!=Q[M]?R[M][S]/Q[M]:0,O=0!=s[S]?X[S][M]/s[S]:0,b?h.push(O,m):h.push(m,V.b?1-O:O);M=0;let z=0,g=y[M]-1,G=y[M+1]-1,e=g<G?g:G,k=Z[1]-Z[0];const d=y.length-1;for(;z<=e&&M<d;)H.push(z,z+k,z+1),H.push(z+k+1,z+1,z+k),z+=1,z===e&&(M++,k=Z[M+1]-Z[M],g=y[M]-1,G=y[M+1]-1,z=Z[M],e=g<G?g+z:G+z);if(t.e.ComputeNormals(f,H,A),P){let a=0,p=0;for(M=0;M<v.length;M++){a=3*Z[M],p=M+1<v.length?3*(Z[M+1]-1):A.length-3,A[a]=.5*(A[a]+A[p]),A[a+1]=.5*(A[a+1]+A[p+1]),A[a+2]=.5*(A[a+2]+A[p+2]);const P=Math.sqrt(A[a]*A[a]+A[a+1]*A[a+1]+A[a+2]*A[a+2]);A[a]/=P,A[a+1]/=P,A[a+2]/=P,A[p]=A[a],A[p+1]=A[a+1],A[p+2]=A[a+2]}}if(p){let a=3*Z[0],p=3*Z[v.length];for(S=0;S<D+T;S++){A[a]=.5*(A[a]+A[p]),A[a+1]=.5*(A[a+1]+A[p+1]),A[a+2]=.5*(A[a+2]+A[p+2]);const v=Math.sqrt(A[a]*A[a]+A[a+1]*A[a+1]+A[a+2]*A[a+2]);A[a]/=v,A[a+1]/=v,A[a+2]/=v,A[p]=A[a],A[p+1]=A[a+1],A[p+2]=A[a+2],a+=3,p+=3}}t.e._ComputeSides(F,f,H,A,h,a.frontUVs,a.backUVs);let E=null;if(c){E=new Float32Array(4*c.length);for(let a=0;a<c.length;a++)E[4*a]=c[a].r,E[4*a+1]=c[a].g,E[4*a+2]=c[a].b,E[4*a+3]=c[a].a}const W=new t.e,U=new Float32Array(f),N=new Float32Array(A),i=new Float32Array(h);return W.indices=H,W.xa=U,W.ya=N,W.Aa=i,E&&W.set(E,L.f.ColorKind),P&&(W._idx=Z),W}function C(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=v.pathArray,F=v.closeArray,u=v.closePath,c=b.b._GetDefaultSideOrientation(v.sideOrientation),f=v.instance,H=v.updatable;if(f){const a=P.k.fb[0].pe(Number.MAX_VALUE),p=P.k.fb[1].pe(-Number.MAX_VALUE),K=v=>{let P=C[0].length;const L=f;let t=0;const V=L._originalBuilderSideOrientation===b.b.DOUBLESIDE?2:1;for(let b=1;b<=V;++b)for(let V=0;V<C.length;++V){const b=C[V],K=b.length;P=P<K?P:K;for(let L=0;L<P;++L){const P=b[L];v[t]=P.x,v[t+1]=P.y,v[t+2]=P.z,a.minimizeInPlaceFromFloats(P.x,P.y,P.z),p.maximizeInPlaceFromFloats(P.x,P.y,P.z),t+=3}if(L._creationDataStorage&&L._creationDataStorage.closePath){const a=b[0];v[t]=a.x,v[t+1]=a.y,v[t+2]=a.z,t+=3}}},F=f.getVerticesData(L.f.PositionKind);if(K(F),f.hasBoundingInfo?f.getBoundingInfo().reConstruct(a,p,f._worldMatrix):f.buildBoundingInfo(a,p,f._worldMatrix),f.updateVerticesData(L.f.PositionKind,F,!1,!1),v.za){const a=f.getVerticesData(L.f.ColorKind);for(let p=0,P=0;p<v.za.length;p++,P+=4){const b=v.za[p];a[P]=b.r,a[P+1]=b.g,a[P+2]=b.b,a[P+3]=b.a}f.updateVerticesData(L.f.ColorKind,a,!1,!1)}if(v.Aa){const a=f.getVerticesData(L.f.UVKind);for(let p=0;p<v.Aa.length;p++)a[2*p]=v.Aa[p].x,a[2*p+1]=V.b?1-v.Aa[p].y:v.Aa[p].y;f.updateVerticesData(L.f.UVKind,a,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){const a=f.ng(),v=f.getVerticesData(L.f.NormalKind),p=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(t.e.ComputeNormals(F,a,v,p),f._creationDataStorage&&f._creationDataStorage.closePath){let a=0,p=0;for(let P=0;P<C.length;P++)a=3*f._creationDataStorage.idx[P],p=P+1<C.length?3*(f._creationDataStorage.idx[P+1]-1):v.length-3,v[a]=.5*(v[a]+v[p]),v[a+1]=.5*(v[a+1]+v[p+1]),v[a+2]=.5*(v[a+2]+v[p+2]),v[p]=v[a],v[p+1]=v[a+1],v[p+2]=v[a+2]}f.areNormalsFrozen||f.updateVerticesData(L.f.NormalKind,v,!1,!1)}return f}{const P=new b.b(a,p);P._originalBuilderSideOrientation=c,P._creationDataStorage=new b.f;const L=K(v);return u&&(P._creationDataStorage.idx=L._idx),P._creationDataStorage.closePath=u,P._creationDataStorage.closeArray=F,L.Ca(P,H),P}}t.e.CreateRibbon=K,b.b.CreateRibbon=function(a,v){return C(a,{pathArray:v,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var F=p(11839),u=p(11560),c=p(11279);function f(a){const v=a.pattern||b.b.NO_FLIP,p=a.tileWidth||a.tileSize||1,P=a.tileHeight||a.tileSize||1,L=a.alignHorizontal||0,V=a.alignVertical||0,K=a.width||a.size||1,C=Math.floor(K/p);let F=K-C*p;const u=a.height||a.size||1,c=Math.floor(u/P);let f=u-c*P;const H=p*C/2,A=P*c/2;let h=0,R=0,X=0,Q=0,s=0,D=0;if(F>0||f>0){switch(X=-H,Q=-A,s=H,D=A,L){case b.b.CENTER:F/=2,X-=F,s+=F;break;case b.b.LEFT:s+=F,h=-F/2;break;case b.b.RIGHT:X-=F,h=F/2}switch(V){case b.b.CENTER:f/=2,Q-=f,D+=f;break;case b.b.BOTTOM:D+=f,R=-f/2;break;case b.b.TOP:Q-=f,R=f/2}}const y=[],Z=[],M=[];M[0]=[0,0,1,0,1,1,0,1],M[1]=[0,0,1,0,1,1,0,1],v!==b.b.ROTATE_TILE&&v!==b.b.ROTATE_ROW||(M[1]=[1,1,0,1,0,0,1,0]),v!==b.b.FLIP_TILE&&v!==b.b.FLIP_ROW||(M[1]=[1,0,0,0,0,1,1,1]),v!==b.b.FLIP_N_ROTATE_TILE&&v!==b.b.FLIP_N_ROTATE_ROW||(M[1]=[0,1,1,1,1,0,0,0]);let S=[];const n=[],q=[];let T=0;for(let t=0;t<c;t++)for(let a=0;a<C;a++)y.push(a*p-H+h,t*P-A+R,0),y.push((a+1)*p-H+h,t*P-A+R,0),y.push((a+1)*p-H+h,(t+1)*P-A+R,0),y.push(a*p-H+h,(t+1)*P-A+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),S=v===b.b.FLIP_TILE||v===b.b.ROTATE_TILE||v===b.b.FLIP_N_ROTATE_TILE?S.concat(M[(a%2+t%2)%2]):v===b.b.FLIP_ROW||v===b.b.ROTATE_ROW||v===b.b.FLIP_N_ROTATE_ROW?S.concat(M[t%2]):S.concat(M[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(F>0||f>0){const a=f>0&&(V===b.b.CENTER||V===b.b.TOP),t=f>0&&(V===b.b.CENTER||V===b.b.BOTTOM),K=F>0&&(L===b.b.CENTER||L===b.b.RIGHT),u=F>0&&(L===b.b.CENTER||L===b.b.LEFT);let M,j,w,J,B=[];if(a&&K&&(y.push(X+h,Q+R,0),y.push(-H+h,Q+R,0),y.push(-H+h,Q+f+R,0),y.push(X+h,Q+f+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,M=1-F/p,j=1-f/P,w=1,J=1,B=[M,j,w,j,w,J,M,J],v===b.b.ROTATE_ROW&&(B=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),v===b.b.FLIP_ROW&&(B=[1-M,j,1-w,j,1-w,J,1-M,J]),v===b.b.FLIP_N_ROTATE_ROW&&(B=[M,1-j,w,1-j,w,1-J,M,1-J]),S=S.concat(B),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&u&&(y.push(H+h,Q+R,0),y.push(s+h,Q+R,0),y.push(s+h,Q+f+R,0),y.push(H+h,Q+f+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,M=0,j=1-f/P,w=F/p,J=1,B=[M,j,w,j,w,J,M,J],(v===b.b.ROTATE_ROW||v===b.b.ROTATE_TILE&&C%2===0)&&(B=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),(v===b.b.FLIP_ROW||v===b.b.FLIP_TILE&&C%2===0)&&(B=[1-M,j,1-w,j,1-w,J,1-M,J]),(v===b.b.FLIP_N_ROTATE_ROW||v===b.b.FLIP_N_ROTATE_TILE&&C%2===0)&&(B=[M,1-j,w,1-j,w,1-J,M,1-J]),S=S.concat(B),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&K&&(y.push(X+h,A+R,0),y.push(-H+h,A+R,0),y.push(-H+h,D+R,0),y.push(X+h,D+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,M=1-F/p,j=0,w=1,J=f/P,B=[M,j,w,j,w,J,M,J],(v===b.b.ROTATE_ROW&&c%2===1||v===b.b.ROTATE_TILE&&c%1===0)&&(B=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),(v===b.b.FLIP_ROW&&c%2===1||v===b.b.FLIP_TILE&&c%2===0)&&(B=[1-M,j,1-w,j,1-w,J,1-M,J]),(v===b.b.FLIP_N_ROTATE_ROW&&c%2===1||v===b.b.FLIP_N_ROTATE_TILE&&c%2===0)&&(B=[M,1-j,w,1-j,w,1-J,M,1-J]),S=S.concat(B),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&u&&(y.push(H+h,A+R,0),y.push(s+h,A+R,0),y.push(s+h,D+R,0),y.push(H+h,D+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,M=0,j=0,w=F/p,J=f/P,B=[M,j,w,j,w,J,M,J],(v===b.b.ROTATE_ROW&&c%2===1||v===b.b.ROTATE_TILE&&(c+C)%2===1)&&(B=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),(v===b.b.FLIP_ROW&&c%2===1||v===b.b.FLIP_TILE&&(c+C)%2===1)&&(B=[1-M,j,1-w,j,1-w,J,1-M,J]),(v===b.b.FLIP_N_ROTATE_ROW&&c%2===1||v===b.b.FLIP_N_ROTATE_TILE&&(c+C)%2===1)&&(B=[M,1-j,w,1-j,w,1-J,M,1-J]),S=S.concat(B),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a){const a=[];M=0,j=1-f/P,w=1,J=1,a[0]=[M,j,w,j,w,J,M,J],a[1]=[M,j,w,j,w,J,M,J],v!==b.b.ROTATE_TILE&&v!==b.b.ROTATE_ROW||(a[1]=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),v!==b.b.FLIP_TILE&&v!==b.b.FLIP_ROW||(a[1]=[1-M,j,1-w,j,1-w,J,1-M,J]),v!==b.b.FLIP_N_ROTATE_TILE&&v!==b.b.FLIP_N_ROTATE_ROW||(a[1]=[M,1-j,w,1-j,w,1-J,M,1-J]);for(let P=0;P<C;P++)y.push(P*p-H+h,Q+R,0),y.push((P+1)*p-H+h,Q+R,0),y.push((P+1)*p-H+h,Q+f+R,0),y.push(P*p-H+h,Q+f+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,S=v===b.b.FLIP_TILE||v===b.b.ROTATE_TILE||v===b.b.FLIP_N_ROTATE_TILE?S.concat(a[(P+1)%2]):v===b.b.FLIP_ROW||v===b.b.ROTATE_ROW||v===b.b.FLIP_N_ROTATE_ROW?S.concat(a[1]):S.concat(a[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const a=[];M=0,j=0,w=1,J=f/P,a[0]=[M,j,w,j,w,J,M,J],a[1]=[M,j,w,j,w,J,M,J],v!==b.b.ROTATE_TILE&&v!==b.b.ROTATE_ROW||(a[1]=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),v!==b.b.FLIP_TILE&&v!==b.b.FLIP_ROW||(a[1]=[1-M,j,1-w,j,1-w,J,1-M,J]),v!==b.b.FLIP_N_ROTATE_TILE&&v!==b.b.FLIP_N_ROTATE_ROW||(a[1]=[M,1-j,w,1-j,w,1-J,M,1-J]);for(let P=0;P<C;P++)y.push(P*p-H+h,D-f+R,0),y.push((P+1)*p-H+h,D-f+R,0),y.push((P+1)*p-H+h,D+R,0),y.push(P*p-H+h,D+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,S=v===b.b.FLIP_TILE||v===b.b.ROTATE_TILE||v===b.b.FLIP_N_ROTATE_TILE?S.concat(a[(P+c)%2]):v===b.b.FLIP_ROW||v===b.b.ROTATE_ROW||v===b.b.FLIP_N_ROTATE_ROW?S.concat(a[c%2]):S.concat(a[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const a=[];M=1-F/p,j=0,w=1,J=1,a[0]=[M,j,w,j,w,J,M,J],a[1]=[M,j,w,j,w,J,M,J],v!==b.b.ROTATE_TILE&&v!==b.b.ROTATE_ROW||(a[1]=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),v!==b.b.FLIP_TILE&&v!==b.b.FLIP_ROW||(a[1]=[1-M,j,1-w,j,1-w,J,1-M,J]),v!==b.b.FLIP_N_ROTATE_TILE&&v!==b.b.FLIP_N_ROTATE_ROW||(a[1]=[M,1-j,w,1-j,w,1-J,M,1-J]);for(let p=0;p<c;p++)y.push(X+h,p*P-A+R,0),y.push(X+F+h,p*P-A+R,0),y.push(X+F+h,(p+1)*P-A+R,0),y.push(X+h,(p+1)*P-A+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,S=v===b.b.FLIP_TILE||v===b.b.ROTATE_TILE||v===b.b.FLIP_N_ROTATE_TILE?S.concat(a[(p+1)%2]):v===b.b.FLIP_ROW||v===b.b.ROTATE_ROW||v===b.b.FLIP_N_ROTATE_ROW?S.concat(a[p%2]):S.concat(a[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const a=[];M=0,j=0,w=F/P,J=1,a[0]=[M,j,w,j,w,J,M,J],a[1]=[M,j,w,j,w,J,M,J],v!==b.b.ROTATE_TILE&&v!==b.b.ROTATE_ROW||(a[1]=[1-M,1-j,1-w,1-j,1-w,1-J,1-M,1-J]),v!==b.b.FLIP_TILE&&v!==b.b.FLIP_ROW||(a[1]=[1-M,j,1-w,j,1-w,J,1-M,J]),v!==b.b.FLIP_N_ROTATE_TILE&&v!==b.b.FLIP_N_ROTATE_ROW||(a[1]=[M,1-j,w,1-j,w,1-J,M,1-J]);for(let p=0;p<c;p++)y.push(s-F+h,p*P-A+R,0),y.push(s+h,p*P-A+R,0),y.push(s+h,(p+1)*P-A+R,0),y.push(s-F+h,(p+1)*P-A+R,0),q.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,S=v===b.b.FLIP_TILE||v===b.b.ROTATE_TILE||v===b.b.FLIP_N_ROTATE_TILE?S.concat(a[(p+C)%2]):v===b.b.FLIP_ROW||v===b.b.ROTATE_ROW||v===b.b.FLIP_N_ROTATE_ROW?S.concat(a[p%2]):S.concat(a[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const j=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE;t.e._ComputeSides(j,y,q,Z,S,a.frontUVs,a.backUVs);const w=new t.e;w.indices=q,w.xa=y,w.ya=Z,w.Aa=S;const J=j===t.e.DOUBLESIDE?n.concat(n):n;return w.za=J,w}function H(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return f(v).Ca(P,v.updatable),P}function A(a){const v=a.faceUV||new Array(6),p=a.faceColors,L=a.pattern||b.b.NO_FLIP,K=a.width||a.size||1,C=a.height||a.size||1,F=a.depth||a.size||1,u=a.tileWidth||a.tileSize||1,H=a.tileHeight||a.tileSize||1,A=a.alignHorizontal||0,h=a.alignVertical||0,R=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE;for(let b=0;b<6;b++)void 0===v[b]&&(v[b]=new P.t(0,0,1,1)),p&&void 0===p[b]&&(p[b]=new c.e(1,1,1,1));const X=K/2,Q=C/2,s=F/2,D=[];for(let P=0;P<2;P++)D[P]=f({pattern:L,tileWidth:u,tileHeight:H,width:K,height:C,alignVertical:h,alignHorizontal:A,sideOrientation:R});for(let P=2;P<4;P++)D[P]=f({pattern:L,tileWidth:u,tileHeight:H,width:F,height:C,alignVertical:h,alignHorizontal:A,sideOrientation:R});let y=h;h===b.b.BOTTOM?y=b.b.TOP:h===b.b.TOP&&(y=b.b.BOTTOM);for(let P=4;P<6;P++)D[P]=f({pattern:L,tileWidth:u,tileHeight:H,width:K,height:F,alignVertical:y,alignHorizontal:A,sideOrientation:R});let Z=[],M=[],S=[],n=[];const q=[],T=[],j=[],w=[];let J=0,B=0;for(let b=0;b<6;b++){const a=D[b].xa.length;T[b]=[],j[b]=[];for(let v=0;v<a/3;v++)T[b].push(new P.s(D[b].xa[3*v],D[b].xa[3*v+1],D[b].xa[3*v+2])),j[b].push(new P.s(D[b].ya[3*v],D[b].ya[3*v+1],D[b].ya[3*v+2]));J=D[b].Aa.length,w[b]=[];for(let p=0;p<J;p+=2)w[b][p]=v[b].x+(v[b].z-v[b].x)*D[b].Aa[p],w[b][p+1]=v[b].y+(v[b].w-v[b].y)*D[b].Aa[p+1],V.b&&(w[b][p+1]=1-w[b][p+1]);if(S=S.concat(w[b]),n=n.concat(D[b].indices.map((a=>a+B))),B+=T[b].length,p)for(let v=0;v<4;v++)q.push(p[b].r,p[b].g,p[b].b,p[b].a)}const x=new P.s(0,0,s),r=P.e.RotationY(Math.PI);Z=T[0].map((a=>P.s.TransformNormal(a,r).add(x))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]),M=j[0].map((a=>P.s.TransformNormal(a,r))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]),Z=Z.concat(T[1].map((a=>a.od(x))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),M=M.concat(j[1].map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]));const o=new P.s(X,0,0),m=P.e.RotationY(-Math.PI/2);Z=Z.concat(T[2].map((a=>P.s.TransformNormal(a,m).add(o))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),M=M.concat(j[2].map((a=>P.s.TransformNormal(a,m))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]));const O=P.e.RotationY(Math.PI/2);Z=Z.concat(T[3].map((a=>P.s.TransformNormal(a,O).od(o))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),M=M.concat(j[3].map((a=>P.s.TransformNormal(a,O))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]));const Y=new P.s(0,Q,0),l=P.e.RotationX(Math.PI/2);Z=Z.concat(T[4].map((a=>P.s.TransformNormal(a,l).add(Y))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),M=M.concat(j[4].map((a=>P.s.TransformNormal(a,l))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[]));const z=P.e.RotationX(-Math.PI/2);Z=Z.concat(T[5].map((a=>P.s.TransformNormal(a,z).od(Y))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),M=M.concat(j[5].map((a=>P.s.TransformNormal(a,z))).map((a=>[a.x,a.y,a.z])).reduce(((a,v)=>a.concat(v)),[])),t.e._ComputeSides(R,Z,n,M,S);const g=new t.e;if(g.indices=n,g.xa=Z,g.ya=M,g.Aa=S,p){const a=R===t.e.DOUBLESIDE?q.concat(q):q;g.za=a}return g}function h(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return A(v).Ca(P,v.updatable),P}t.e.CreateTiledPlane=f;t.e.CreateTiledBox=A;var R=p(11834),X=p(11229),Q=p(11549);function s(a){const v=a.height||2;let p=0===a.diameterTop?0:a.diameterTop||a.diameter||1,L=0===a.diameterBottom?0:a.diameterBottom||a.diameter||1;p=p||1e-5,L=L||1e-5;const K=0|(a.tessellation||24),C=0|(a.subdivisions||1),F=!!a.hasRings,u=!!a.enclose,f=0===a.cap?0:a.cap||b.b.CAP_ALL,H=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,A=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,h=a.faceUV||new Array(3),R=a.faceColors,X=2+(1+(1!==H&&u?2:0))*(F?C:1);let s;for(s=0;s<X;s++)R&&void 0===R[s]&&(R[s]=new c.e(1,1,1,1));for(s=0;s<X;s++)h&&void 0===h[s]&&(h[s]=new P.t(0,0,1,1));const D=[],y=[],Z=[],M=[],S=[],n=2*Math.PI*H/K;let q,T,j;const w=(L-p)/2/v,J=P.s.Zero(),B=P.s.Zero(),x=P.s.Zero(),r=P.s.Zero(),o=P.s.Zero(),m=Q.b.Y;let O,Y,l,z=1,g=1,G=0,e=0;for(O=0;O<=C;O++)for(T=O/C,j=(T*(p-L)+L)/2,z=F&&0!==O&&O!==C?2:1,l=0;l<z;l++){for(F&&(g+=l),u&&(g+=2*l),Y=0;Y<=K;Y++)q=Y*n,J.x=Math.cos(-q)*j,J.y=-v/2+T*v,J.z=Math.sin(-q)*j,0===p&&O===C?(B.x=Z[Z.length-3*(K+1)],B.y=Z[Z.length-3*(K+1)+1],B.z=Z[Z.length-3*(K+1)+2]):(B.x=J.x,B.z=J.z,B.y=Math.sqrt(B.x*B.x+B.z*B.z)*w,B.normalize()),0===Y&&(x.p(J),r.p(B)),y.push(J.x,J.y,J.z),Z.push(B.x,B.y,B.z),e=F?G!==g?h[g].y:h[g].w:h[g].y+(h[g].w-h[g].y)*T,M.push(h[g].x+(h[g].z-h[g].x)*Y/K,V.b?1-e:e),R&&S.push(R[g].r,R[g].g,R[g].b,R[g].a);1!==H&&u&&(y.push(J.x,J.y,J.z),y.push(0,J.y,0),y.push(0,J.y,0),y.push(x.x,x.y,x.z),P.s.CrossToRef(m,B,o),o.normalize(),Z.push(o.x,o.y,o.z,o.x,o.y,o.z),P.s.CrossToRef(r,m,o),o.normalize(),Z.push(o.x,o.y,o.z,o.x,o.y,o.z),e=F?G!==g?h[g+1].y:h[g+1].w:h[g+1].y+(h[g+1].w-h[g+1].y)*T,M.push(h[g+1].x,V.b?1-e:e),M.push(h[g+1].z,V.b?1-e:e),e=F?G!==g?h[g+2].y:h[g+2].w:h[g+2].y+(h[g+2].w-h[g+2].y)*T,M.push(h[g+2].x,V.b?1-e:e),M.push(h[g+2].z,V.b?1-e:e),R&&(S.push(R[g+1].r,R[g+1].g,R[g+1].b,R[g+1].a),S.push(R[g+1].r,R[g+1].g,R[g+1].b,R[g+1].a),S.push(R[g+2].r,R[g+2].g,R[g+2].b,R[g+2].a),S.push(R[g+2].r,R[g+2].g,R[g+2].b,R[g+2].a))),G!==g&&(G=g)}const k=1!==H&&u?K+4:K;for(O=0,g=0;g<C;g++){let a=0,v=0,p=0,P=0;for(Y=0;Y<K;Y++)a=O*(k+1)+Y,v=(O+1)*(k+1)+Y,p=O*(k+1)+(Y+1),P=(O+1)*(k+1)+(Y+1),D.push(a,v,p),D.push(P,p,v);1!==H&&u&&(D.push(a+2,v+2,p+2),D.push(P+2,p+2,v+2),D.push(a+4,v+4,p+4),D.push(P+4,p+4,v+4)),O=F?O+2:O+1}const d=a=>{const b=a?p/2:L/2;if(0===b)return;let t,C,F;const u=a?h[X-1]:h[0];let c=null;R&&(c=a?R[X-1]:R[0]);const f=y.length/3,A=a?v/2:-v/2,Q=new P.s(0,A,0);y.push(Q.x,Q.y,Q.z),Z.push(0,a?1:-1,0);const s=u.y+.5*(u.w-u.y);M.push(u.x+.5*(u.z-u.x),V.b?1-s:s),c&&S.push(c.r,c.g,c.b,c.a);const n=new P.o(.5,.5);for(F=0;F<=K;F++){t=2*Math.PI*F*H/K;const v=Math.cos(-t),p=Math.sin(-t);C=new P.s(v*b,A,p*b);const L=new P.o(v*n.x+.5,p*n.y+.5);y.push(C.x,C.y,C.z),Z.push(0,a?1:-1,0);const f=u.y+(u.w-u.y)*L.y;M.push(u.x+(u.z-u.x)*L.x,V.b?1-f:f),c&&S.push(c.r,c.g,c.b,c.a)}for(F=0;F<K;F++)a?(D.push(f),D.push(f+(F+2)),D.push(f+(F+1))):(D.push(f),D.push(f+(F+1)),D.push(f+(F+2)))};f!==b.b.CAP_START&&f!==b.b.CAP_ALL||d(!1),f!==b.b.CAP_END&&f!==b.b.CAP_ALL||d(!0),t.e._ComputeSides(A,y,D,Z,M,a.frontUVs,a.backUVs);const E=new t.e;return E.indices=D,E.xa=y,E.ya=Z,E.Aa=M,R&&(E.za=S),E}function D(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return s(v).Ca(P,v.updatable),P}function y(a){const v=[],p=[],b=[],L=[],K=a.diameter||1,C=a.thickness||.5,F=0|(a.tessellation||16),u=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,c=F+1;for(let t=0;t<=F;t++){const a=t/F,u=t*Math.PI*2/F-Math.PI/2,f=P.e.Translation(K/2,0,0).multiply(P.e.RotationY(u));for(let K=0;K<=F;K++){const u=1-K/F,H=K*Math.PI*2/F+Math.PI,A=Math.cos(H),h=Math.sin(H);let R=new P.s(A,h,0),X=R.scale(C/2);const Q=new P.o(a,u);X=P.s.TransformCoordinates(X,f),R=P.s.TransformNormal(R,f),p.push(X.x,X.y,X.z),b.push(R.x,R.y,R.z),L.push(Q.x,V.b?1-Q.y:Q.y);const s=(t+1)%c,D=(K+1)%c;v.push(t*c+K),v.push(t*c+D),v.push(s*c+K),v.push(t*c+D),v.push(s*c+D),v.push(s*c+K)}}t.e._ComputeSides(u,p,v,b,L,a.frontUVs,a.backUVs);const f=new t.e;return f.indices=v,f.xa=p,f.ya=b,f.Aa=L,f}function Z(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return y(v).Ca(P,v.updatable),P}t.e.CreateCylinder=s,b.b.CreateCylinder=(a,v,p,P,L,t,V,K,C)=>{void 0!==V&&V instanceof X.c||(void 0!==V&&(C=K||b.b.DEFAULTSIDE,K=V),V=t,t=1);return D(a,{height:v,diameterTop:p,diameterBottom:P,tessellation:L,subdivisions:t,sideOrientation:C,updatable:K},V)};function M(a){const v=[],p=[],b=[],L=[],K=a.radius||2,C=a.tube||.5,F=a.radialSegments||32,u=a.tubularSegments||32,c=a.p||2,f=a.q||3,H=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,A=a=>{const v=Math.cos(a),p=Math.sin(a),b=f/c*a,L=Math.cos(b),t=K*(2+L)*.5*v,V=K*(2+L)*p*.5,C=K*Math.sin(b)*.5;return new P.s(t,V,C)};let h,R;for(h=0;h<=F;h++){const a=h%F/F*2*c*Math.PI,v=A(a),b=A(a+.01),t=b.od(v);let K=b.add(v);const f=P.s.Cross(t,K);for(K=P.s.Cross(f,t),f.normalize(),K.normalize(),R=0;R<u;R++){const a=R%u/u*2*Math.PI,P=-C*Math.cos(a),b=C*Math.sin(a);p.push(v.x+P*K.x+b*f.x),p.push(v.y+P*K.y+b*f.y),p.push(v.z+P*K.z+b*f.z),L.push(h/F),L.push(V.b?1-R/u:R/u)}}for(h=0;h<F;h++)for(R=0;R<u;R++){const a=(R+1)%u,p=h*u+R,P=(h+1)*u+R,b=(h+1)*u+a,L=h*u+a;v.push(L),v.push(P),v.push(p),v.push(L),v.push(b),v.push(P)}t.e.ComputeNormals(p,v,b),t.e._ComputeSides(H,p,v,b,L,a.frontUVs,a.backUVs);const X=new t.e;return X.indices=v,X.xa=p,X.ya=b,X.Aa=L,X}function S(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return M(v).Ca(P,v.updatable),P}t.e.CreateTorus=y,b.b.CreateTorus=(a,v,p,P,b,L,t)=>Z(a,{diameter:v,thickness:p,tessellation:P,sideOrientation:t,updatable:L},b);t.e.CreateTorusKnot=M,b.b.CreateTorusKnot=(a,v,p,P,b,L,t,V,K,C)=>S(a,{radius:v,tube:p,radialSegments:P,tubularSegments:b,p:L,q:t,sideOrientation:C,updatable:K},V);var n=p(12867),q=p(10905),T=p(11724),j=p(11245),w=p(10939);class J extends P.o{constructor(a,v){super(a.x,a.y),this.index=v}}class B{constructor(){this.elements=[]}add(a){const v=[];return a.forEach((a=>{const p=new J(a,this.elements.length);v.push(p),this.elements.push(p)})),v}computeBounds(){const a=new P.o(this.elements[0].x,this.elements[0].y),v=new P.o(this.elements[0].x,this.elements[0].y);return this.elements.forEach((p=>{p.x<a.x?a.x=p.x:p.x>v.x&&(v.x=p.x),p.y<a.y?a.y=p.y:p.y>v.y&&(v.y=p.y)})),{min:a,max:v,width:v.x-a.x,height:v.y-a.y}}}class x{_addToepoint(a){for(const v of a)this._epoints.push(v.x,v.y)}constructor(a,v,p){let P,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new B,this._outlinepoints=new B,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=b,this._name=a,this._scene=p||w.b.LastCreatedScene,P=v instanceof T.f?v.getPoints():v,this._addToepoint(P),this._points.add(P),this._outlinepoints.add(P),"undefined"===typeof this.bjsEarcut&&q.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(a){this._points.add(a);const v=new B;return v.add(a),this._holes.push(v),this._eholes.push(this._epoints.length/2),this._addToepoint(a),this}build(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const P=new b.b(this._name,this._scene),t=this.buildVertexData(v,p);return P.Ga(L.f.PositionKind,t.xa,a),P.Ga(L.f.NormalKind,t.ya,a),P.Ga(L.f.UVKind,t.Aa,a),P.setIndices(t.indices),P}buildVertexData(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const p=new t.e,P=[],b=[],L=[],V=this._points.computeBounds();this._points.elements.forEach((a=>{P.push(0,1,0),b.push(a.x,0,a.y),L.push((a.x-V.min.x)/V.width,(a.y-V.min.y)/V.height)}));const K=[],C=this.bjsEarcut(this._epoints,this._eholes,2);for(let t=0;t<C.length;t++)K.push(C[t]);if(a>0){const p=b.length/3;this._points.elements.forEach((v=>{P.push(0,-1,0),b.push(v.x,-a,v.y),L.push(1-(v.x-V.min.x)/V.width,1-(v.y-V.min.y)/V.height)}));const t=K.length;for(let a=0;a<t;a+=3){const v=K[a+0],P=K[a+1],b=K[a+2];K.push(b+p),K.push(P+p),K.push(v+p)}this._addSide(b,P,L,K,V,this._outlinepoints,a,!1,v),this._holes.forEach((p=>{this._addSide(b,P,L,K,V,p,a,!0,v)}))}return p.indices=K,p.xa=b,p.ya=P,p.Aa=L,p}_addSide(a,v,p,b,L,t,V,K,C){let F=a.length/3,u=0;for(let c=0;c<t.elements.length;c++){const f=t.elements[c],H=t.elements[(c+1)%t.elements.length];a.push(f.x,0,f.y),a.push(f.x,-V,f.y),a.push(H.x,0,H.y),a.push(H.x,-V,H.y);const A=t.elements[(c+t.elements.length-1)%t.elements.length],h=t.elements[(c+2)%t.elements.length];let R=new P.s(-(H.y-f.y),0,H.x-f.x),X=new P.s(-(f.y-A.y),0,f.x-A.x),Q=new P.s(-(h.y-H.y),0,h.x-H.x);K||(R=R.scale(-1),X=X.scale(-1),Q=Q.scale(-1));const s=R.normalizeToNew();let D=X.normalizeToNew(),y=Q.normalizeToNew();const Z=P.s.Dot(D,s);D=Z>C?Z<j.e-1?new P.s(f.x,0,f.y).od(new P.s(H.x,0,H.y)).normalize():X.add(R).normalize():s;const M=P.s.Dot(Q,R);y=M>C?M<j.e-1?new P.s(H.x,0,H.y).od(new P.s(f.x,0,f.y)).normalize():Q.add(R).normalize():s,p.push(u/L.width,0),p.push(u/L.width,1),u+=R.length(),p.push(u/L.width,0),p.push(u/L.width,1),v.push(D.x,D.y,D.z),v.push(D.x,D.y,D.z),v.push(y.x,y.y,y.z),v.push(y.x,y.y,y.z),K?(b.push(F),b.push(F+2),b.push(F+1),b.push(F+1),b.push(F+2),b.push(F+3)):(b.push(F),b.push(F+1),b.push(F+2),b.push(F+1),b.push(F+3),b.push(F+2)),F+=4}}}function r(a,v,p,b,K,C,F){const u=p||new Array(3),f=b,H=[],A=F||!1;for(let L=0;L<3;L++)void 0===u[L]&&(u[L]=new P.t(0,0,1,1)),f&&void 0===f[L]&&(f[L]=new c.e(1,1,1,1));const h=a.getVerticesData(L.f.PositionKind),R=a.getVerticesData(L.f.NormalKind),X=a.getVerticesData(L.f.UVKind),Q=a.ng(),s=h.length/9;let D=0,y=0,Z=0,M=0,S=0;const n=[0];if(A)for(let P=s;P<h.length/3;P+=4)y=h[3*(P+2)]-h[3*P],Z=h[3*(P+2)+2]-h[3*P+2],M=Math.sqrt(y*y+Z*Z),S+=M,n.push(S);let q=0,T=0;for(let P=0;P<R.length;P+=3)Math.abs(R[P+1])<.001&&(T=1),Math.abs(R[P+1]-1)<.001&&(T=0),Math.abs(R[P+1]+1)<.001&&(T=2),q=P/3,1===T?(D=q-s,X[2*q]=D%4<1.5?A?u[T].x+(u[T].z-u[T].x)*n[Math.floor(D/4)]/S:u[T].x:A?u[T].x+(u[T].z-u[T].x)*n[Math.floor(D/4)+1]/S:u[T].z,X[2*q+1]=D%2===0?V.b?1-u[T].w:u[T].w:V.b?1-u[T].y:u[T].y):(X[2*q]=(1-X[2*q])*u[T].x+X[2*q]*u[T].z,X[2*q+1]=(1-X[2*q+1])*u[T].y+X[2*q+1]*u[T].w,V.b&&(X[2*q+1]=1-X[2*q+1])),f&&H.push(f[T].r,f[T].g,f[T].b,f[T].a);t.e._ComputeSides(v,h,Q,R,X,K,C);const j=new t.e;if(j.indices=Q,j.xa=h,j.ya=R,j.Aa=X,f){const a=v===t.e.DOUBLESIDE?H.concat(H):H;j.za=a}return j}function o(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation);const t=v.shape,V=v.holes||[],K=v.depth||0,C=v.smoothingThreshold||2,F=[];let u=[];for(let b=0;b<t.length;b++)F[b]=new P.o(t[b].x,t[b].z);F[0].equalsWithEpsilon(F[F.length-1],1e-8)&&F.pop();const c=new x(a,F,p||w.b.LastCreatedScene,L);for(let b=0;b<V.length;b++){u=[];for(let a=0;a<V[b].length;a++)u.push(new P.o(V[b][a].x,V[b][a].z));c.addHole(u)}const f=c.build(!1,K,C);f._originalBuilderSideOrientation=v.sideOrientation;return r(f,v.sideOrientation,v.faceUV,v.faceColors,v.frontUVs,v.backUVs,v.wrap).Ca(f,v.updatable),f}function m(a,v){return o(a,v,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function O(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=v.path,L=v.shape,t=v.scale||1,V=v.rotation||0,K=0===v.cap?0:v.cap||b.b.NO_CAP,C=v.updatable,F=b.b._GetDefaultSideOrientation(v.sideOrientation),u=v.instance||null,c=v.invertUV||!1,f=v.closeShape||!1;return l(a,L,P,t,V,null,null,v.closePath||!1,f,K,!1,p,!!C,F,u,c,v.frontUVs||null,v.backUVs||null,v.firstNormal||null,!!v.adjustFrame)}function Y(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=v.path,L=v.shape,t=v.scaleFunction||(()=>1),V=v.rotationFunction||(()=>0),K=v.closePath||v.ribbonCloseArray||!1,C=v.closeShape||v.ribbonClosePath||!1,F=0===v.cap?0:v.cap||b.b.NO_CAP,u=v.updatable,c=v.firstNormal||null,f=v.adjustFrame||!1;return l(a,L,P,null,null,t,V,K,C,F,!0,p,!!u,b.b._GetDefaultSideOrientation(v.sideOrientation),v.instance||null,v.invertUV||!1,v.frontUVs||null,v.backUVs||null,c,f)}function l(a,v,p,L,t,V,K,F,u,c,f,H,A,h,R,X,Q,s,D,y){const Z=(a,v,p,L,t,V,K,C,F,u,c)=>{const f=p.getTangents(),H=p.getNormals(),A=p.getBinormals(),h=p.getDistances();if(c)for(let b=0;b<f.length;b++)if(0==f[b].x&&0==f[b].y&&0==f[b].z&&f[b].p(f[b-1]),0==H[b].x&&0==H[b].y&&0==H[b].z&&H[b].p(H[b-1]),0==A[b].x&&0==A[b].y&&0==A[b].z&&A[b].p(A[b-1]),b>0){let a=f[b-1];P.s.Dot(a,f[b])<0&&f[b].scaleInPlace(-1),a=H[b-1],P.s.Dot(a,H[b])<0&&H[b].scaleInPlace(-1),a=A[b-1],P.s.Dot(a,A[b])<0&&A[b].scaleInPlace(-1)}let R=0;const X=u&&C?C:()=>null!==V?V:0,Q=u&&K?K:()=>null!==t?t:1;let s=F===b.b.NO_CAP||F===b.b.CAP_END?0:2;const D=P.k.Matrix[0];for(let b=0;b<v.length;b++){const p=[],t=X(b,h[b]),V=Q(b,h[b]);P.e.RotationAxisToRef(f[b],R,D);for(let L=0;L<a.length;L++){const t=f[b].scale(a[L].z).add(H[b].scale(a[L].x)).add(A[b].scale(a[L].y)),K=P.s.Zero();P.s.TransformCoordinatesToRef(t,D,K),K.scaleInPlace(V).addInPlace(v[b]),p[L]=K}L[s]=p,R+=t,s++}const y=a=>{const v=Array(),p=P.s.Zero();let b;for(b=0;b<a.length;b++)p.addInPlace(a[b]);for(p.scaleInPlace(1/a.length),b=0;b<a.length;b++)v.push(p);return v};switch(F){case b.b.NO_CAP:break;case b.b.CAP_START:L[0]=y(L[2]),L[1]=L[2];break;case b.b.CAP_END:L[s]=L[s-1],L[s+1]=y(L[s-1]);break;case b.b.CAP_ALL:L[0]=y(L[2]),L[1]=L[2],L[s]=L[s-1],L[s+1]=y(L[s-1])}return L};let M,S;if(R){const a=R._creationDataStorage;return M=D?a.path3D.update(p,D):a.path3D.update(p),S=Z(v,p,a.path3D,a.pathArray,L,t,V,K,a.cap,f,y),R=C("",{pathArray:S,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:R},H||void 0)}M=D?new T.g(p,D):new T.g(p);S=Z(v,p,M,new Array,L,t,V,K,c=c<0||c>3?0:c,f,y);const n=C(a,{pathArray:S,closeArray:F,closePath:u,updatable:A,sideOrientation:h,invertUV:X,frontUVs:Q||void 0,backUVs:s||void 0},H);return n._creationDataStorage.pathArray=S,n._creationDataStorage.path3D=M,n._creationDataStorage.cap=c,n}t.e.CreatePolygon=r,b.b.CreatePolygon=function(a,v,p,P,b,L){return o(a,{shape:v,holes:P,updatable:b,sideOrientation:L},p,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},b.b.ExtrudePolygon=function(a,v,p,P,b,L,t){return m(a,{shape:v,holes:b,depth:p,updatable:L,sideOrientation:t},P,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function z(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=v.arc?v.arc<=0||v.arc>1?1:v.arc:1,t=void 0===v.closed||v.closed,V=v.shape,K=v.radius||1,F=v.tessellation||64,u=v.clip||0,c=v.updatable,f=b.b._GetDefaultSideOrientation(v.sideOrientation),H=v.cap||b.b.NO_CAP,A=2*Math.PI,h=[],R=v.invertUV||!1;let X=0,Q=0;const s=A/F*L;let D,y;for(X=0;X<=F-u;X++){for(y=[],H!=b.b.CAP_START&&H!=b.b.CAP_ALL||(y.push(new P.s(0,V[0].y,0)),y.push(new P.s(Math.cos(X*s)*V[0].x*K,V[0].y,Math.sin(X*s)*V[0].x*K))),Q=0;Q<V.length;Q++)D=new P.s(Math.cos(X*s)*V[Q].x*K,V[Q].y,Math.sin(X*s)*V[Q].x*K),y.push(D);H!=b.b.CAP_END&&H!=b.b.CAP_ALL||(y.push(new P.s(Math.cos(X*s)*V[V.length-1].x*K,V[V.length-1].y,Math.sin(X*s)*V[V.length-1].x*K)),y.push(new P.s(0,V[V.length-1].y,0))),h.push(y)}return C(a,{pathArray:h,closeArray:t,sideOrientation:f,updatable:c,invertUV:R,frontUVs:v.frontUVs,backUVs:v.backUVs},p)}b.b.ExtrudeShape=function(a,v,p,P,L,t){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0,F=arguments.length>9?arguments[9]:void 0;return O(a,{shape:v,path:p,scale:P,rotation:L,cap:0===t?0:t||b.b.NO_CAP,sideOrientation:C,instance:F,updatable:K},V)},b.b.ExtrudeShapeCustom=(a,v,p,P,L,t,V,K,C,F,u,c)=>Y(a,{shape:v,path:p,scaleFunction:P,rotationFunction:L,ribbonCloseArray:t,ribbonClosePath:V,cap:0===K?0:K||b.b.NO_CAP,sideOrientation:u,instance:c,updatable:F},C);b.b.CreateLathe=(a,v,p,P,b,L,t)=>z(a,{shape:v,radius:p,tessellation:P,sideOrientation:t,updatable:L},b);var g=p(11614),G=p(11568);function e(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=v.path;let t=v.instance,V=1;void 0!==v.radius?V=v.radius:t&&(V=t._creationDataStorage.radius);const K=v.tessellation||64,F=v.radiusFunction||null;let u=v.cap||b.b.NO_CAP;const c=v.invertUV||!1,f=v.updatable,H=b.b._GetDefaultSideOrientation(v.sideOrientation);v.arc=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1;const A=(a,v,p,L,t,V,K,C)=>{const F=v.getTangents(),u=v.getNormals(),c=v.getDistances(),f=2*Math.PI/t*C,H=V||(()=>L);let A,h,R,X;const Q=P.k.Matrix[0];let s=K===b.b.NO_CAP||K===b.b.CAP_END?0:2;for(let b=0;b<a.length;b++){h=H(b,c[b]),A=Array(),R=u[b];for(let v=0;v<t;v++)P.e.RotationAxisToRef(F[b],f*v,Q),X=A[v]?A[v]:P.s.Zero(),P.s.TransformCoordinatesToRef(R,Q,X),X.scaleInPlace(h).addInPlace(a[b]),A[v]=X;p[s]=A,s++}const D=(v,p)=>{const P=Array();for(let b=0;b<v;b++)P.push(a[p]);return P};switch(K){case b.b.NO_CAP:break;case b.b.CAP_START:p[0]=D(t,0),p[1]=p[2].slice(0);break;case b.b.CAP_END:p[s]=p[s-1].slice(0),p[s+1]=D(t,a.length-1);break;case b.b.CAP_ALL:p[0]=D(t,0),p[1]=p[2].slice(0),p[s]=p[s-1].slice(0),p[s+1]=D(t,a.length-1)}return p};let h,R;if(t){const a=t._creationDataStorage,p=v.arc||a.arc;return h=a.path3D.update(L),R=A(L,h,a.pathArray,V,a.tessellation,F,a.cap,p),t=C("",{pathArray:R,instance:t}),a.path3D=h,a.pathArray=R,a.arc=p,a.radius=V,t}h=new T.g(L);u=u<0||u>3?0:u,R=A(L,h,new Array,V,K,F,u,v.arc);const X=C(a,{pathArray:R,closePath:!0,closeArray:!1,updatable:f,sideOrientation:H,invertUV:c,frontUVs:v.frontUVs,backUVs:v.backUVs},p);return X._creationDataStorage.pathArray=R,X._creationDataStorage.path3D=h,X._creationDataStorage.tessellation=K,X._creationDataStorage.cap=u,X._creationDataStorage.arc=v.arc,X._creationDataStorage.radius=V,X}function k(a){const v=[];v[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},v[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},v[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},v[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},v[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},v[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},v[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},v[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},v[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},v[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},v[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},v[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},v[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},v[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},v[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const p=a.type&&(a.type<0||a.type>=v.length)?0:a.type||0,b=a.size,L=a.sizeX||b||1,K=a.sizeY||b||1,C=a.sizeZ||b||1,F=a.custom||v[p],u=F.face.length,f=a.faceUV||new Array(u),H=a.faceColors,A=void 0===a.flat||a.flat,h=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,R=[],X=[],Q=[],s=[],D=[];let y=0,Z=0;const M=[];let S,n,q,T,j,w,J=0,B=0;if(A)for(B=0;B<u;B++)H&&void 0===H[B]&&(H[B]=new c.e(1,1,1,1)),f&&void 0===f[B]&&(f[B]=new P.t(0,0,1,1));if(A)for(B=0;B<u;B++){const a=F.face[B].length;for(q=2*Math.PI/a,T=.5*Math.tan(q/2),j=.5,J=0;J<a;J++)R.push(F.vertex[F.face[B][J]][0]*L,F.vertex[F.face[B][J]][1]*K,F.vertex[F.face[B][J]][2]*C),M.push(y),y++,S=f[B].x+(f[B].z-f[B].x)*(.5+T),n=f[B].y+(f[B].w-f[B].y)*(j-.5),s.push(S,V.b?1-n:n),w=T*Math.cos(q)-j*Math.sin(q),j=T*Math.sin(q)+j*Math.cos(q),T=w,H&&D.push(H[B].r,H[B].g,H[B].b,H[B].a);for(J=0;J<a-2;J++)X.push(M[0+Z],M[J+2+Z],M[J+1+Z]);Z+=a}else{for(J=0;J<F.vertex.length;J++)R.push(F.vertex[J][0]*L,F.vertex[J][1]*K,F.vertex[J][2]*C),s.push(0,V.b?1:0);for(B=0;B<u;B++)for(J=0;J<F.face[B].length-2;J++)X.push(F.face[B][0],F.face[B][J+2],F.face[B][J+1])}t.e.ComputeNormals(R,X,Q),t.e._ComputeSides(h,R,X,Q,s,a.frontUVs,a.backUVs);const x=new t.e;return x.xa=R,x.indices=X,x.ya=Q,x.Aa=s,H&&A&&(x.za=D),x}function d(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return k(v).Ca(P,v.updatable),P}b.b.CreateTube=(a,v,p,P,b,L,t,V,K,C)=>e(a,{path:v,radius:p,tessellation:P,radiusFunction:b,arc:1,cap:L,updatable:V,sideOrientation:K,instance:C},t);function E(a){const v=a.sideOrientation||t.e.DEFAULTSIDE,p=a.radius||1,b=void 0===a.flat||a.flat,L=0|(a.subdivisions||4),K=a.radiusX||p,C=a.radiusY||p,F=a.radiusZ||p,u=(1+Math.sqrt(5))/2,c=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],H=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],A=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],h=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],R=[],X=[],Q=[],s=[];let D=0;const y=new Array(3),Z=new Array(3);let M;for(M=0;M<3;M++)y[M]=P.s.Zero(),Z[M]=P.o.Zero();for(let t=0;t<20;t++){for(M=0;M<3;M++){const a=f[3*t+M];y[M].qe(c[3*H[a]],c[3*H[a]+1],c[3*H[a]+2]),y[M].normalize(),Z[M].qe(.134765625*A[2*a]+.05859375+-.0390625*h[t],.2333984375*A[2*a+1]+.025390625+.01953125*h[t])}const a=(a,v,p,t)=>{const u=P.s.Lerp(y[0],y[2],v/L),c=P.s.Lerp(y[1],y[2],v/L),f=L===v?y[2]:P.s.Lerp(u,c,a/(L-v));let H;if(f.normalize(),b){const a=P.s.Lerp(y[0],y[2],t/L),v=P.s.Lerp(y[1],y[2],t/L);H=P.s.Lerp(a,v,p/(L-t))}else H=new P.s(f.x,f.y,f.z);H.x/=K,H.y/=C,H.z/=F,H.normalize();const A=P.o.Lerp(Z[0],Z[2],v/L),h=P.o.Lerp(Z[1],Z[2],v/L),M=L===v?Z[2]:P.o.Lerp(A,h,a/(L-v));X.push(f.x*K,f.y*C,f.z*F),Q.push(H.x,H.y,H.z),s.push(M.x,V.b?1-M.y:M.y),R.push(D),D++};for(let v=0;v<L;v++)for(let p=0;p+v<L;p++)a(p,v,p+1/3,v+1/3),a(p+1,v,p+1/3,v+1/3),a(p,v+1,p+1/3,v+1/3),p+v+1<L&&(a(p+1,v,p+2/3,v+2/3),a(p+1,v+1,p+2/3,v+2/3),a(p,v+1,p+2/3,v+2/3))}t.e._ComputeSides(v,X,R,Q,s,a.frontUVs,a.backUVs);const S=new t.e;return S.indices=R,S.xa=X,S.ya=Q,S.Aa=s,S}function W(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new b.b(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),P._originalBuilderSideOrientation=v.sideOrientation;return E(v).Ca(P,v.updatable),P}t.e.CreatePolyhedron=k,b.b.CreatePolyhedron=(a,v,p)=>d(a,v,p);t.e.CreateIcoSphere=E,b.b.CreateIcoSphere=(a,v,p)=>W(a,v,p);var U=p(11263);const N=new P.s(1,0,0),i=new P.s(-1,0,0),I=new P.s(0,1,0),aa=new P.s(0,-1,0),va=new P.s(0,0,1),pa=new P.s(0,0,-1);class Pa{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.s.Zero(),v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.s.Up(),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.o.Zero(),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=a,this.k=v,this.uv=p,this.vertexIdx=b,this.vertexIdxForBones=L,this.localPositionOverride=t,this.localNormalOverride=V,this.matrixIndicesOverride=K,this.matrixWeightsOverride=C}clone(){var a,v,p,P;return new Pa(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(a=this.localPositionOverride)||void 0===a?void 0:a.slice(),null===(v=this.localNormalOverride)||void 0===v?void 0:v.slice(),null===(p=this.matrixIndicesOverride)||void 0===p?void 0:p.slice(),null===(P=this.matrixWeightsOverride)||void 0===P?void 0:P.slice())}}function ba(a,v,p){var K,C,F,u;const c=!!v.skeleton,f=p.localMode||c,H=v.ng(),A=c?v.be(!0,!0):v.getVerticesData(L.f.PositionKind),h=c?v.getNormalsData(!0,!0):v.getVerticesData(L.f.NormalKind),R=f?c?v.getVerticesData(L.f.PositionKind):A:null,X=f?c?v.getVerticesData(L.f.NormalKind):h:null,Q=v.getVerticesData(L.f.UVKind),s=c?v.getVerticesData(L.f.MatricesIndicesKind):null,D=c?v.getVerticesData(L.f.MatricesWeightsKind):null,y=c?v.getVerticesData(L.f.MatricesIndicesExtraKind):null,Z=c?v.getVerticesData(L.f.MatricesWeightsExtraKind):null,M=p.position||P.s.Zero();let S=p.k||P.s.Up();const n=p.size||P.s.One(),q=p.angle||0;if(!S){const a=new P.s(0,0,1),p=v.va().activeCamera,b=P.s.TransformCoordinates(a,p.getWorldMatrix());S=p.globalPosition.od(b)}const T=-Math.atan2(S.z,S.x)-Math.PI/2,j=Math.sqrt(S.x*S.x+S.z*S.z),w=Math.atan2(S.y,j),J=new t.e;J.indices=[],J.xa=[],J.ya=[],J.Aa=[],J.matricesIndices=c?[]:null,J.matricesWeights=c?[]:null,J.matricesIndicesExtra=y?[]:null,J.matricesWeightsExtra=Z?[]:null;let B=0;const x=(a,v)=>{const b=new Pa;if(!H||!A||!h)return b;const L=H[a];if(b.vertexIdx=3*L,b.vertexIdxForBones=4*L,b.position=new P.s(A[3*L],A[3*L+1],A[3*L+2]),P.s.TransformCoordinatesToRef(b.position,v,b.position),b.k=new P.s(h[3*L],h[3*L+1],h[3*L+2]),P.s.TransformNormalToRef(b.k,v,b.k),p.captureUVS&&Q){const a=Q[2*L+1];b.uv=new P.o(Q[2*L],V.b?1-a:a)}return b},r=[0,0,0,0],o=(a,v)=>{if(0===a.length)return a;const p=.5*Math.abs(P.s.Dot(n,v)),b=(a,v,p,P)=>{for(let b=0;b<P;++b)if(a[p+b]===v)return p+b;return-1},L=(a,L)=>{const t=P.s.GetClipFactor(a.position,L.position,v,p);let V=r,K=r;if(s&&D){const v=a.matrixIndicesOverride?0:a.vertexIdxForBones,p=a.matrixIndicesOverride??s,P=a.matrixWeightsOverride??D,C=L.matrixIndicesOverride?0:L.vertexIdxForBones,F=L.matrixIndicesOverride??s,u=L.matrixWeightsOverride??D;V=[0,0,0,0],K=[0,0,0,0];let c=0;for(let a=0;a<4;++a)if(P[v+a]>0){const L=b(F,p[v+a],C,4);V[c]=p[v+a],K[c]=(0,U.l)(P[v+a],L>=0?u[L]:0,t),c++}for(let a=0;a<4&&c<4;++a){const P=F[C+a];-1===b(p,P,v,4)&&(V[c]=P,K[c]=(0,U.l)(0,u[C+a],t),c++)}const f=K[0]+K[1]+K[2]+K[3];K[0]/=f,K[1]/=f,K[2]/=f,K[3]/=f}const C=a.localPositionOverride?a.localPositionOverride[0]:(null===R||void 0===R?void 0:R[a.vertexIdx])??0,F=a.localPositionOverride?a.localPositionOverride[1]:(null===R||void 0===R?void 0:R[a.vertexIdx+1])??0,u=a.localPositionOverride?a.localPositionOverride[2]:(null===R||void 0===R?void 0:R[a.vertexIdx+2])??0,c=L.localPositionOverride?L.localPositionOverride[0]:(null===R||void 0===R?void 0:R[L.vertexIdx])??0,f=L.localPositionOverride?L.localPositionOverride[1]:(null===R||void 0===R?void 0:R[L.vertexIdx+1])??0,H=L.localPositionOverride?L.localPositionOverride[2]:(null===R||void 0===R?void 0:R[L.vertexIdx+2])??0,A=a.localNormalOverride?a.localNormalOverride[0]:(null===X||void 0===X?void 0:X[a.vertexIdx])??0,h=a.localNormalOverride?a.localNormalOverride[1]:(null===X||void 0===X?void 0:X[a.vertexIdx+1])??0,Q=a.localNormalOverride?a.localNormalOverride[2]:(null===X||void 0===X?void 0:X[a.vertexIdx+2])??0,y=A+((L.localNormalOverride?L.localNormalOverride[0]:(null===X||void 0===X?void 0:X[L.vertexIdx])??0)-A)*t,Z=h+((L.localNormalOverride?L.localNormalOverride[1]:(null===X||void 0===X?void 0:X[L.vertexIdx+1])??0)-h)*t,M=Q+((L.localNormalOverride?L.localNormalOverride[2]:(null===X||void 0===X?void 0:X[L.vertexIdx+2])??0)-Q)*t,S=Math.sqrt(y*y+Z*Z+M*M);return new Pa(P.s.Lerp(a.position,L.position,t),P.s.Lerp(a.k,L.k,t).normalize(),P.o.Lerp(a.uv,L.uv,t),-1,-1,R?[C+(c-C)*t,F+(f-F)*t,u+(H-u)*t]:null,X?[y/S,Z/S,M/S]:null,V,K)};let t=null;a.length>3&&(t=[]);for(let V=0;V<a.length;V+=3){let b=0,K=null,C=null,F=null,u=null;const c=P.s.Dot(a[V].position,v)-p>0,f=P.s.Dot(a[V+1].position,v)-p>0,H=P.s.Dot(a[V+2].position,v)-p>0;switch(b=(c?1:0)+(f?1:0)+(H?1:0),b){case 0:a.length>3?(t.push(a[V]),t.push(a[V+1]),t.push(a[V+2])):t=a;break;case 1:if(t=t??new Array,c&&(K=a[V+1],C=a[V+2],F=L(a[V],K),u=L(a[V],C)),f){K=a[V],C=a[V+2],F=L(a[V+1],K),u=L(a[V+1],C),t.push(F),t.push(C.clone()),t.push(K.clone()),t.push(C.clone()),t.push(F.clone()),t.push(u);break}H&&(K=a[V],C=a[V+1],F=L(a[V+2],K),u=L(a[V+2],C)),K&&C&&F&&u&&(t.push(K.clone()),t.push(C.clone()),t.push(F),t.push(u),t.push(F.clone()),t.push(C.clone()));break;case 2:t=t??new Array,c||(K=a[V].clone(),C=L(K,a[V+1]),F=L(K,a[V+2]),t.push(K),t.push(C),t.push(F)),f||(K=a[V+1].clone(),C=L(K,a[V+2]),F=L(K,a[V]),t.push(K),t.push(C),t.push(F)),H||(K=a[V+2].clone(),C=L(K,a[V]),F=L(K,a[V+1]),t.push(K),t.push(C),t.push(F))}}return t},m=v instanceof b.b?v:null,O=null===m||void 0===m?void 0:m._thinInstanceDataStorage.matrixData,Y=(null===m||void 0===m?void 0:m._b)||1,l=P.k.Matrix[0];l.p(P.e.IdentityReadOnly);for(let b=0;b<Y;++b){if(null!==m&&void 0!==m&&m.hasThinInstances&&O){const a=16*b;l.setRowFromFloats(0,O[a+0],O[a+1],O[a+2],O[a+3]),l.setRowFromFloats(1,O[a+4],O[a+5],O[a+6],O[a+7]),l.setRowFromFloats(2,O[a+8],O[a+9],O[a+10],O[a+11]),l.setRowFromFloats(3,O[a+12],O[a+13],O[a+14],O[a+15])}const a=P.e.RotationYawPitchRoll(T,w,q).multiply(P.e.Translation(M.x,M.y,M.z)),L=P.e.Invert(a),t=v.getWorldMatrix(),K=l.multiply(t).multiply(L),C=new Array(3);for(let v=0;v<H.length;v+=3){let a=C;if(a[0]=x(v,K),a[1]=x(v+1,K),a[2]=x(v+2,K),!(p.cullBackFaces&&-a[0].k.z<=0&&-a[1].k.z<=0&&-a[2].k.z<=0)&&(a=o(a,N),a&&(a=o(a,i),a&&(a=o(a,I),a&&(a=o(a,aa),a&&(a=o(a,va),a&&(a=o(a,pa),a)))))))for(let v=0;v<a.length;v++){const P=a[v];if(J.indices.push(B),f?(P.localPositionOverride?(J.xa[3*B]=P.localPositionOverride[0],J.xa[3*B+1]=P.localPositionOverride[1],J.xa[3*B+2]=P.localPositionOverride[2]):R&&(J.xa[3*B]=R[P.vertexIdx],J.xa[3*B+1]=R[P.vertexIdx+1],J.xa[3*B+2]=R[P.vertexIdx+2]),P.localNormalOverride?(J.ya[3*B]=P.localNormalOverride[0],J.ya[3*B+1]=P.localNormalOverride[1],J.ya[3*B+2]=P.localNormalOverride[2]):X&&(J.ya[3*B]=X[P.vertexIdx],J.ya[3*B+1]=X[P.vertexIdx+1],J.ya[3*B+2]=X[P.vertexIdx+2])):(P.position.toArray(J.xa,3*B),P.k.toArray(J.ya,3*B)),J.matricesIndices&&J.matricesWeights&&(P.matrixIndicesOverride?(J.matricesIndices[4*B]=P.matrixIndicesOverride[0],J.matricesIndices[4*B+1]=P.matrixIndicesOverride[1],J.matricesIndices[4*B+2]=P.matrixIndicesOverride[2],J.matricesIndices[4*B+3]=P.matrixIndicesOverride[3]):(s&&(J.matricesIndices[4*B]=s[P.vertexIdxForBones],J.matricesIndices[4*B+1]=s[P.vertexIdxForBones+1],J.matricesIndices[4*B+2]=s[P.vertexIdxForBones+2],J.matricesIndices[4*B+3]=s[P.vertexIdxForBones+3]),y&&J.matricesIndicesExtra&&(J.matricesIndicesExtra[4*B]=y[P.vertexIdxForBones],J.matricesIndicesExtra[4*B+1]=y[P.vertexIdxForBones+1],J.matricesIndicesExtra[4*B+2]=y[P.vertexIdxForBones+2],J.matricesIndicesExtra[4*B+3]=y[P.vertexIdxForBones+3])),P.matrixWeightsOverride?(J.matricesWeights[4*B]=P.matrixWeightsOverride[0],J.matricesWeights[4*B+1]=P.matrixWeightsOverride[1],J.matricesWeights[4*B+2]=P.matrixWeightsOverride[2],J.matricesWeights[4*B+3]=P.matrixWeightsOverride[3]):(D&&(J.matricesWeights[4*B]=D[P.vertexIdxForBones],J.matricesWeights[4*B+1]=D[P.vertexIdxForBones+1],J.matricesWeights[4*B+2]=D[P.vertexIdxForBones+2],J.matricesWeights[4*B+3]=D[P.vertexIdxForBones+3]),Z&&J.matricesWeightsExtra&&(J.matricesWeightsExtra[4*B]=Z[P.vertexIdxForBones],J.matricesWeightsExtra[4*B+1]=Z[P.vertexIdxForBones+1],J.matricesWeightsExtra[4*B+2]=Z[P.vertexIdxForBones+2],J.matricesWeightsExtra[4*B+3]=Z[P.vertexIdxForBones+3]))),p.captureUVS)P.uv.toArray(J.Aa,2*B);else{J.Aa.push(.5+P.position.x/n.x);const a=.5+P.position.y/n.y;J.Aa.push(V.b?1-a:a)}B++}}}0===J.indices.length&&(J.indices=null),0===J.xa.length&&(J.xa=null),0===J.ya.length&&(J.ya=null),0===J.Aa.length&&(J.Aa=null),0===(null===(K=J.matricesIndices)||void 0===K?void 0:K.length)&&(J.matricesIndices=null),0===(null===(C=J.matricesWeights)||void 0===C?void 0:C.length)&&(J.matricesWeights=null),0===(null===(F=J.matricesIndicesExtra)||void 0===F?void 0:F.length)&&(J.matricesIndicesExtra=null),0===(null===(u=J.matricesWeightsExtra)||void 0===u?void 0:u.length)&&(J.matricesWeightsExtra=null);const z=new b.b(a,v.va());return J.Ca(z),f?(z.skeleton=v.skeleton,z.parent=v):(z.position=M.clone(),z.rotation=new P.s(w,T,q)),z.Zj(!0),z.refreshBoundingInfo(!0,!0),z}function La(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const v=0|Math.max(a.subdivisions?a.subdivisions:2,1),p=0|Math.max(a.tessellation?a.tessellation:16,3),b=Math.max(a.height?a.height:1,0),L=Math.max(a.radius?a.radius:.25,0),K=0|Math.max(a.capSubdivisions?a.capSubdivisions:6,1),C=p,F=v,u=Math.max(a.radiusTop?a.radiusTop:L,0),c=Math.max(a.radiusBottom?a.radiusBottom:L,0),f=b-(u+c),H=2*Math.PI,A=Math.max(a.topCapSubdivisions?a.topCapSubdivisions:K,1),h=Math.max(a.bottomCapSubdivisions?a.bottomCapSubdivisions:K,1),R=Math.acos((c-u)/b);let X=[];const Q=[],s=[],D=[];let y=0;const Z=[],M=.5*f,S=.5*Math.PI;let n,q;const T=P.s.Zero(),j=P.s.Zero(),w=Math.cos(R),J=Math.sin(R),B=new P.o(u*J,M+u*w).od(new P.o(c*J,c*w-M)).length(),x=u*R+B+c*(S-R);let r=0;for(q=0;q<=A;q++){const a=[],v=S-R*(q/A);r+=u*R/A;const p=Math.cos(v),P=Math.sin(v),b=p*u;for(n=0;n<=C;n++){const v=n/C,L=v*H+0,t=Math.sin(L),K=Math.cos(L);j.x=b*t,j.y=M+P*u,j.z=b*K,Q.push(j.x,j.y,j.z),T.set(p*t,P,p*K),s.push(T.x,T.y,T.z),D.push(v,V.b?r/x:1-r/x),a.push(y),y++}Z.push(a)}const o=b-u-c+w*u-w*c,m=J*(c-u)/o;for(q=1;q<=F;q++){const a=[];r+=B/F;const v=J*(q*(c-u)/F+u);for(n=0;n<=C;n++){const p=n/C,P=p*H+0,b=Math.sin(P),L=Math.cos(P);j.x=v*b,j.y=M+w*u-q*o/F,j.z=v*L,Q.push(j.x,j.y,j.z),T.set(b,m,L).normalize(),s.push(T.x,T.y,T.z),D.push(p,V.b?r/x:1-r/x),a.push(y),y++}Z.push(a)}for(q=1;q<=h;q++){const a=[],v=S-R-(Math.PI-R)*(q/h);r+=c*R/h;const p=Math.cos(v),P=Math.sin(v),b=p*c;for(n=0;n<=C;n++){const v=n/C,L=v*H+0,t=Math.sin(L),K=Math.cos(L);j.x=b*t,j.y=P*c-M,j.z=b*K,Q.push(j.x,j.y,j.z),T.set(p*t,P,p*K),s.push(T.x,T.y,T.z),D.push(v,V.b?r/x:1-r/x),a.push(y),y++}Z.push(a)}for(n=0;n<C;n++)for(q=0;q<A+F+h;q++){const a=Z[q][n],v=Z[q+1][n],p=Z[q+1][n+1],P=Z[q][n+1];X.push(a),X.push(v),X.push(P),X.push(v),X.push(p),X.push(P)}if(X=X.reverse(),a.orientation&&!a.orientation.equals(P.s.Up())){const v=new P.e;a.orientation.clone().scale(.5*Math.PI).cross(P.s.Up()).toQuaternion().toRotationMatrix(v);const p=P.s.Zero();for(let a=0;a<Q.length;a+=3)p.set(Q[a],Q[a+1],Q[a+2]),P.s.TransformCoordinatesToRef(p.clone(),v,p),Q[a]=p.x,Q[a+1]=p.y,Q[a+2]=p.z}const O=new t.e;return O.xa=Q,O.ya=s,O.Aa=D,O.indices=X,O}function ta(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:P.s.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new b.b(a,p);return La(v).Ca(L,v.updatable),L}b.b.CreateDecal=(a,v,p,P,b,L)=>ba(a,v,{position:p,k:P,size:b,angle:L});b.b.CreateCapsule=(a,v,p)=>ta(a,v,p),t.e.CreateCapsule=La;class Va{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=a,this.y=v,a!==Math.floor(a)&&(a=Math.floor(a),q.d.Warn("x is not an integer, floor(x) used")),v!==Math.floor(v)&&(v=Math.floor(v),q.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Va(this.x,this.y)}rotate60About(a){const v=this.x;return this.x=a.x+a.y-this.y,this.y=v+this.y-a.x,this}rotateNeg60About(a){const v=this.x;return this.x=v+this.y-a.y,this.y=a.x+a.y-v,this}rotate120(a,v){a!==Math.floor(a)&&(a=Math.floor(a),q.d.Warn("m not an integer only floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),q.d.Warn("n not an integer only floor(n) used"));const p=this.x;return this.x=a-p-this.y,this.y=v+p,this}rotateNeg120(a,v){a!==Math.floor(a)&&(a=Math.floor(a),q.d.Warn("m is not an integer, floor(m) used")),v!==Math.floor(v)&&(v=Math.floor(v),q.d.Warn("n is not an integer,   floor(n) used"));const p=this.x;return this.x=this.y-v,this.y=a+v-p-this.y,this}toCartesianOrigin(a,v){const p=P.s.Zero();return p.x=a.x+2*this.x*v+this.y*v,p.y=a.y+Math.sqrt(3)*this.y*v,p}static Zero(){return new Va(0,0)}}class Ka{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Ca("icosahedron","Regular",[[0,j.g,-1],[-j.g,1,0],[-1,0,-j.g],[1,0,-j.g],[j.g,1,0],[0,j.g,1],[-1,0,j.g],[-j.g,-1,0],[0,-j.g,-1],[j.g,-1,0],[1,0,j.g],[0,-j.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let a=12;const v={},p=this.m,P=this.n;let b,L,t,V,K,C=p,F=1,u=0;0!==P&&(C=(0,U.h)(p,P)),F=p/C,u=P/C;const c=Va.Zero(),f=new Va(p,P),H=new Va(-P,p+P),A=Va.Zero(),h=Va.Zero(),R=Va.Zero();let X,Q,s,D,y=[];const Z=[],M=this.vertByDist,S=(p,P,b,L)=>{X=p+"|"+b,Q=P+"|"+L,X in v||Q in v?X in v&&!(Q in v)?v[Q]=v[X]:Q in v&&!(X in v)&&(v[X]=v[Q]):(v[X]=a,v[Q]=a,a++),M[b][0]>2?Z[v[X]]=[-M[b][0],M[b][1],v[X]]:Z[v[X]]=[y[M[b][0]],M[b][1],v[X]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let n=0;n<20;n++){if(y=this.IDATA.face[n],t=y[2],V=y[1],K=y[0],s=c.x+"|"+c.y,X=n+"|"+s,X in v||(v[X]=t,Z[t]=[y[M[s][0]],M[s][1]]),s=f.x+"|"+f.y,X=n+"|"+s,X in v||(v[X]=V,Z[V]=[y[M[s][0]],M[s][1]]),s=H.x+"|"+H.y,X=n+"|"+s,X in v||(v[X]=K,Z[K]=[y[M[s][0]],M[s][1]]),b=this.IDATA.edgematch[n][0],L=this.IDATA.edgematch[n][1],"B"===L)for(let a=1;a<C;a++)h.x=p-a*(F+u),h.y=P+a*F,R.x=-a*u,R.y=a*(F+u),s=h.x+"|"+h.y,D=R.x+"|"+R.y,S(n,b,s,D);if("O"===L)for(let a=1;a<C;a++)R.x=-a*u,R.y=a*(F+u),A.x=a*F,A.y=a*u,s=R.x+"|"+R.y,D=A.x+"|"+A.y,S(n,b,s,D);if(b=this.IDATA.edgematch[n][2],L=this.IDATA.edgematch[n][3],L&&"A"===L)for(let a=1;a<C;a++)A.x=a*F,A.y=a*u,h.x=p-(C-a)*(F+u),h.y=P+(C-a)*F,s=A.x+"|"+A.y,D=h.x+"|"+h.y,S(n,b,s,D);for(let p=0;p<this.vertices.length;p++)s=this.vertices[p].x+"|"+this.vertices[p].y,X=n+"|"+s,X in v||(v[X]=a++,M[s][0]>2?Z[v[X]]=[-M[s][0],M[s][1],v[X]]:Z[v[X]]=[y[M[s][0]],M[s][1],v[X]])}this.closestTo=Z,this.vecToidx=v}calcCoeffs(){const a=this.m,v=this.n,p=Math.sqrt(3)/3,P=a*a+v*v+a*v;this.coau=(a+v)/P,this.cobu=-v/P,this.coav=-p*(a-v)/P,this.cobv=p*(2*a+v)/P}createInnerFacets(){const a=this.m,v=this.n;for(let p=0;p<v+a+1;p++)for(let a=this.min[p];a<this.max[p]+1;a++)a<this.max[p]&&a<this.max[p+1]+1&&this.innerFacets.push(["|"+a+"|"+p,"|"+a+"|"+(p+1),"|"+(a+1)+"|"+p]),p>0&&a<this.max[p-1]&&a+1<this.max[p]+1&&this.innerFacets.push(["|"+a+"|"+p,"|"+(a+1)+"|"+p,"|"+(a+1)+"|"+(p-1)])}edgeVecsABOB(){const a=this.m,v=this.n,p=new Va(-v,a+v);for(let P=1;P<a+v;P++){const a=new Va(this.min[P],P),v=new Va(this.min[P-1],P-1),b=new Va(this.min[P+1],P+1),L=a.clone(),t=v.clone(),V=b.clone();L.rotate60About(p),t.rotate60About(p),V.rotate60About(p);const K=new Va(this.max[L.y],L.y),C=new Va(this.max[L.y-1],L.y-1),F=new Va(this.max[L.y-1]-1,L.y-1);L.x===K.x&&L.y===K.y||(L.x!==C.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,C,F]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,F,K])):L.y===V.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,v,C]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([a,C,b])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,v,C]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,C,K])))}}mapABOBtoOBOA(){const a=new Va(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const p=[];for(let P=0;P<3;P++)a.x=this.isoVecsABOB[v][P].x,a.y=this.isoVecsABOB[v][P].y,0===this.vertexTypes[v][P]&&a.rotateNeg120(this.m,this.n),p.push(a.clone());this.isoVecsOBOA.push(p)}}mapABOBtoBAOA(){const a=new Va(0,0);for(let v=0;v<this.isoVecsABOB.length;v++){const p=[];for(let P=0;P<3;P++)a.x=this.isoVecsABOB[v][P].x,a.y=this.isoVecsABOB[v][P].y,1===this.vertexTypes[v][P]&&a.rotate120(this.m,this.n),p.push(a.clone());this.isoVecsBAOA.push(p)}}MapToFace(a,v){const p=this.IDATA.face[a],b=p[2],L=p[1],t=p[0],V=P.s.bh(this.IDATA.vertex[b]),K=P.s.bh(this.IDATA.vertex[L]),C=P.s.bh(this.IDATA.vertex[t]),F=K.od(V),u=C.od(V),c=F.scale(this.coau).add(u.scale(this.cobu)),f=F.scale(this.coav).add(u.scale(this.cobv)),H=[];let A,h=P.k.fb[0];for(let P=0;P<this.cartesian.length;P++)h=c.scale(this.cartesian[P].x).add(f.scale(this.cartesian[P].y)).add(V),H[P]=[h.x,h.y,h.z],A=a+"|"+this.vertices[P].x+"|"+this.vertices[P].y,v.vertex[this.vecToidx[A]]=[h.x,h.y,h.z]}build(a,v){const p=[],P=Va.Zero(),b=new Va(a,v),L=new Va(-v,a+v);p.push(P,b,L);for(let s=v;s<a+1;s++)for(let v=0;v<a+1-s;v++)p.push(new Va(v,s));if(v>0){const P=(0,U.h)(a,v),b=a/P,L=v/P;for(let V=1;V<P;V++)p.push(new Va(V*b,V*L)),p.push(new Va(-V*L,V*(b+L))),p.push(new Va(a-V*(b+L),v+V*b));const t=a/v;for(let V=1;V<v;V++)for(let P=0;P<V*t;P++)p.push(new Va(P,V)),p.push(new Va(P,V).rotate120(a,v)),p.push(new Va(P,V).rotateNeg120(a,v))}p.sort(((a,v)=>a.x-v.x)),p.sort(((a,v)=>a.y-v.y));const t=new Array(a+v+1),V=new Array(a+v+1);for(let s=0;s<t.length;s++)t[s]=1/0,V[s]=-1/0;let K=0,C=0;const F=p.length;for(let s=0;s<F;s++)C=p[s].x,K=p[s].y,t[K]=Math.min(C,t[K]),V[K]=Math.max(C,V[K]);const u=(p,P)=>{const b=p.clone();return"A"===P&&b.rotateNeg120(a,v),"B"===P&&b.rotate120(a,v),b.x<0?b.y:b.x+b.y},c=[],f=[],H=[],A=[],h={},R=[];let X=-1,Q=-1;for(let s=0;s<F;s++)c[s]=p[s].toCartesianOrigin(new Va(0,0),.5),f[s]=u(p[s],"O"),H[s]=u(p[s],"A"),A[s]=u(p[s],"B"),f[s]===H[s]&&H[s]===A[s]?(X=3,Q=f[s]):f[s]===H[s]?(X=4,Q=f[s]):H[s]===A[s]?(X=5,Q=H[s]):A[s]===f[s]&&(X=6,Q=f[s]),f[s]<H[s]&&f[s]<A[s]&&(X=2,Q=f[s]),H[s]<f[s]&&H[s]<A[s]&&(X=1,Q=H[s]),A[s]<H[s]&&A[s]<f[s]&&(X=0,Q=A[s]),R.push([X,Q,p[s].x,p[s].y]);R.sort(((a,v)=>a[2]-v[2])),R.sort(((a,v)=>a[3]-v[3])),R.sort(((a,v)=>a[1]-v[1])),R.sort(((a,v)=>a[0]-v[0]));for(let s=0;s<R.length;s++)h[R[s][2]+"|"+R[s][3]]=[R[s][0],R[s][1],s];return this.m=a,this.n=v,this.vertices=p,this.vertByDist=h,this.cartesian=c,this.min=t,this.max=V,this}}class Ca{constructor(a,v,p,P){this.name=a,this.category=v,this.vertex=p,this.face=P}}class Fa extends Ca{innerToData(a,v){for(let p=0;p<v.innerFacets.length;p++)this.face.push(v.innerFacets[p].map((p=>v.vecToidx[a+p])))}mapABOBtoDATA(a,v){const p=v.IDATA.edgematch[a][0];for(let P=0;P<v.isoVecsABOB.length;P++){const b=[];for(let L=0;L<3;L++)0===v.vertexTypes[P][L]?b.push(a+"|"+v.isoVecsABOB[P][L].x+"|"+v.isoVecsABOB[P][L].y):b.push(p+"|"+v.isoVecsABOB[P][L].x+"|"+v.isoVecsABOB[P][L].y);this.face.push([v.vecToidx[b[0]],v.vecToidx[b[1]],v.vecToidx[b[2]]])}}mapOBOAtoDATA(a,v){const p=v.IDATA.edgematch[a][0];for(let P=0;P<v.isoVecsOBOA.length;P++){const b=[];for(let L=0;L<3;L++)1===v.vertexTypes[P][L]?b.push(a+"|"+v.isoVecsOBOA[P][L].x+"|"+v.isoVecsOBOA[P][L].y):b.push(p+"|"+v.isoVecsOBOA[P][L].x+"|"+v.isoVecsOBOA[P][L].y);this.face.push([v.vecToidx[b[0]],v.vecToidx[b[1]],v.vecToidx[b[2]]])}}mapBAOAtoDATA(a,v){const p=v.IDATA.edgematch[a][2];for(let P=0;P<v.isoVecsBAOA.length;P++){const b=[];for(let L=0;L<3;L++)1===v.vertexTypes[P][L]?b.push(a+"|"+v.isoVecsBAOA[P][L].x+"|"+v.isoVecsBAOA[P][L].y):b.push(p+"|"+v.isoVecsBAOA[P][L].x+"|"+v.isoVecsBAOA[P][L].y);this.face.push([v.vecToidx[b[0]],v.vecToidx[b[1]],v.vecToidx[b[2]]])}}orderData(a){const v=[];for(let L=0;L<13;L++)v[L]=[];const p=a.closestTo;for(let L=0;L<p.length;L++)p[L][0]>-1?p[L][1]>0&&v[p[L][0]].push([L,p[L][1]]):v[12].push([L,p[L][0]]);const P=[];for(let L=0;L<12;L++)P[L]=L;let b=12;for(let L=0;L<12;L++){v[L].sort(((a,v)=>a[1]-v[1]));for(let a=0;a<v[L].length;a++)P[v[L][a][0]]=b++}for(let L=0;L<v[12].length;L++)P[v[12][L][0]]=b++;for(let L=0;L<this.vertex.length;L++)this.vertex[L].push(P[L]);this.vertex.sort(((a,v)=>a[3]-v[3]));for(let L=0;L<this.vertex.length;L++)this.vertex[L].pop();for(let L=0;L<this.face.length;L++)for(let a=0;a<this.face[L].length;a++)this.face[L][a]=P[this.face[L][a]];this.sharedNodes=v[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(a,v){const p=[],P=[];let b=v.pop();P.push(b);let L=this.face[b].indexOf(a);L=(L+2)%3;let t=this.face[b][L];p.push(t);let V=0;for(;v.length>0;)b=v[V],this.face[b].indexOf(t)>-1?(L=(this.face[b].indexOf(t)+1)%3,t=this.face[b][L],p.push(t),P.push(b),v.splice(V,1),V=0):V++;return this.adjacentFaces.push(p),P}toGoldbergPolyhedronData(){const a=new Ca("GeoDual","Goldberg",[],[]);a.name="GD dual";const v=this.vertex.length,p=new Array(v);for(let K=0;K<v;K++)p[K]=[];for(let K=0;K<this.face.length;K++)for(let a=0;a<3;a++)p[this.face[K][a]].push(K);let P=0,b=0,L=0,t=[],V=[];this.adjacentFaces=[];for(let K=0;K<p.length;K++)a.face[K]=this.setOrder(K,p[K].concat([])),p[K].forEach((v=>{P=0,b=0,L=0,t=this.face[v];for(let a=0;a<3;a++)V=this.vertex[t[a]],P+=V[0],b+=V[1],L+=V[2];a.vertex[v]=[P/3,b/3,L/3]}));return a}static BuildGeodesicData(a){const v=new Fa("Geodesic-m-n","Geodesic",[[0,j.g,-1],[-j.g,1,0],[-1,0,-j.g],[1,0,-j.g],[j.g,1,0],[0,j.g,1],[-1,0,j.g],[-j.g,-1,0],[0,-j.g,-1],[j.g,-1,0],[1,0,j.g],[0,-j.g,1]],[]);a.setIndices(),a.calcCoeffs(),a.createInnerFacets(),a.edgeVecsABOB(),a.mapABOBtoOBOA(),a.mapABOBtoBAOA();for(let p=0;p<a.IDATA.face.length;p++)a.MapToFace(p,v),v.innerToData(p,a),"B"===a.IDATA.edgematch[p][1]&&v.mapABOBtoDATA(p,a),"O"===a.IDATA.edgematch[p][1]&&v.mapOBOAtoDATA(p,a),"A"===a.IDATA.edgematch[p][3]&&v.mapBAOAtoDATA(p,a);v.orderData(a);return v.vertex=v.vertex.map((function(a){const v=a[0],p=a[1],P=a[2],b=Math.sqrt(v*v+p*p+P*P);return a[0]*=1/b,a[1]*=1/b,a[2]*=1/b,a})),v}}b.b._GoldbergMeshParser=(a,v)=>ua.Parse(a,v);class ua extends b.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(a,v){return void 0===v?(a>this.goldbergData.nbUnsharedFaces-1&&(q.d.Warn("Maximum number of unshared faces used"),a=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+a):(a>11&&(q.d.Warn("Last pole used"),a=11),v>this.goldbergData.nbFacesAtPole-1&&(q.d.Warn("Maximum number of faces at a pole used"),v=this.goldbergData.nbFacesAtPole-1),12+a*this.goldbergData.nbFacesAtPole+v)}_changeGoldbergFaceColors(a){for(let p=0;p<a.length;p++){const v=a[p][0],P=a[p][1],b=a[p][2];for(let a=v;a<P+1;a++)this.goldbergData.faceColors[a]=b}const v=[];for(let p=0;p<12;p++)for(let a=0;a<5;a++)v.push(this.goldbergData.faceColors[p].r,this.goldbergData.faceColors[p].g,this.goldbergData.faceColors[p].b,this.goldbergData.faceColors[p].a);for(let p=12;p<this.goldbergData.faceColors.length;p++)for(let a=0;a<6;a++)v.push(this.goldbergData.faceColors[p].r,this.goldbergData.faceColors[p].g,this.goldbergData.faceColors[p].b,this.goldbergData.faceColors[p].a);return v}setGoldbergFaceColors(a){const v=this._changeGoldbergFaceColors(a);this.Ga(L.f.ColorKind,v)}updateGoldbergFaceColors(a){const v=this._changeGoldbergFaceColors(a);this.updateVerticesData(L.f.ColorKind,v)}_changeGoldbergFaceUVs(a){const v=this.getVerticesData(L.f.UVKind);for(let p=0;p<a.length;p++){const P=a[p][0],b=a[p][1],L=a[p][2],t=a[p][3],V=a[p][4],K=[],C=[];let F,u;for(let a=0;a<5;a++)F=L.x+t*Math.cos(V+a*Math.PI/2.5),u=L.y+t*Math.sin(V+a*Math.PI/2.5),F<0&&(F=0),F>1&&(F=1),K.push(F,u);for(let a=0;a<6;a++)F=L.x+t*Math.cos(V+a*Math.PI/3),u=L.y+t*Math.sin(V+a*Math.PI/3),F<0&&(F=0),F>1&&(F=1),C.push(F,u);for(let a=P;a<Math.min(12,b+1);a++)for(let p=0;p<5;p++)v[10*a+2*p]=K[2*p],v[10*a+2*p+1]=K[2*p+1];for(let a=Math.max(12,P);a<b+1;a++)for(let p=0;p<6;p++)v[12*a-24+2*p]=C[2*p],v[12*a-23+2*p]=C[2*p+1]}return v}setGoldbergFaceUVs(a){const v=this._changeGoldbergFaceUVs(a);this.Ga(L.f.UVKind,v)}updateGoldbergFaceUVs(a){const v=this._changeGoldbergFaceUVs(a);this.updateVerticesData(L.f.UVKind,v)}placeOnGoldbergFaceAt(a,v,p){const b=P.s.RotationFromAxis(this.goldbergData.faceXaxis[v],this.goldbergData.faceYaxis[v],this.goldbergData.faceZaxis[v]);a.rotation=b,a.position=this.goldbergData.faceCenters[v].add(this.goldbergData.faceXaxis[v].scale(p.x)).add(this.goldbergData.faceYaxis[v].scale(p.y)).add(this.goldbergData.faceZaxis[v].scale(p.z))}serialize(a){super.serialize(a),a.type="GoldbergMesh";const v={};if(v.adjacentFaces=this.goldbergData.adjacentFaces,v.nbSharedFaces=this.goldbergData.nbSharedFaces,v.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,v.nbFaces=this.goldbergData.nbFaces,v.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){v.faceColors=[];for(const a of this.goldbergData.faceColors)v.faceColors.push(a.tj())}if(this.goldbergData.faceCenters){v.faceCenters=[];for(const a of this.goldbergData.faceCenters)v.faceCenters.push(a.tj())}if(this.goldbergData.faceZaxis){v.faceZaxis=[];for(const a of this.goldbergData.faceZaxis)v.faceZaxis.push(a.tj())}if(this.goldbergData.faceYaxis){v.faceYaxis=[];for(const a of this.goldbergData.faceYaxis)v.faceYaxis.push(a.tj())}if(this.goldbergData.faceXaxis){v.faceXaxis=[];for(const a of this.goldbergData.faceXaxis)v.faceXaxis.push(a.tj())}a.goldbergData=v}static Parse(a,v){const p=a.goldbergData;p.faceColors=p.faceColors.map((a=>c.e.bh(a))),p.faceCenters=p.faceCenters.map((a=>P.s.bh(a))),p.faceZaxis=p.faceZaxis.map((a=>P.s.bh(a))),p.faceXaxis=p.faceXaxis.map((a=>P.s.bh(a))),p.faceYaxis=p.faceYaxis.map((a=>P.s.bh(a)));const b=new ua(a.name,v);return b.goldbergData=p,b}}var ca=p(11544);class fa{constructor(a){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=a}moveTo(a,v){this._currentPath=new T.f(a,v),this._tempPaths.push(this._currentPath)}lineTo(a,v){this._currentPath.addLineTo(a,v)}quadraticCurveTo(a,v,p,P){this._currentPath.addQuadraticCurveTo(a,v,p,P,this._resolution)}bezierCurveTo(a,v,p,P,b,L){this._currentPath.addBezierCurveTo(a,v,p,P,b,L,this._resolution)}extractHoles(){for(const a of this._tempPaths)a.area()>0?this._holes.push(a):this._paths.push(a);if(!this._paths.length&&this._holes.length){const a=this._holes;this._holes=this._paths,this._paths=a}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Ha(a,v,p,P,b,L){const t=L.glyphs[a]||L.glyphs["?"];if(!t)return null;const V=new fa(b);if(t.o){const a=t.o.split(" ");for(let b=0,L=a.length;b<L;){switch(a[b++]){case"m":{const L=parseInt(a[b++])*v+p,t=parseInt(a[b++])*v+P;V.moveTo(L,t);break}case"l":{const L=parseInt(a[b++])*v+p,t=parseInt(a[b++])*v+P;V.lineTo(L,t);break}case"q":{const L=parseInt(a[b++])*v+p,t=parseInt(a[b++])*v+P,K=parseInt(a[b++])*v+p,C=parseInt(a[b++])*v+P;V.quadraticCurveTo(K,C,L,t);break}case"b":{const L=parseInt(a[b++])*v+p,t=parseInt(a[b++])*v+P,K=parseInt(a[b++])*v+p,C=parseInt(a[b++])*v+P,F=parseInt(a[b++])*v+p,u=parseInt(a[b++])*v+P;V.bezierCurveTo(K,C,F,u,L,t);break}}}}return V.extractHoles(),{offsetX:t.ha*v,shapePath:V}}const Aa={CreateBox:u.e,CreateTiledBox:h,CreateSphere:R.e,CreateDisc:F.d,CreateIcoSphere:W,CreateRibbon:C,CreateCylinder:D,CreateTorus:Z,CreateTorusKnot:S,CreateLineSystem:n.f,qb:n.g,CreateDashedLines:n.b,ExtrudeShape:O,ExtrudeShapeCustom:Y,CreateLathe:z,CreateTiledPlane:H,ug:g.b,CreateGround:G.g,CreateTiledGround:G.i,CreateGroundFromHeightMap:G.c,CreatePolygon:o,ExtrudePolygon:m,CreateTube:e,CreatePolyhedron:d,CreateGeodesic:function(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=v.m||1;P!==Math.floor(P)&&(P=Math.floor(P),q.d.Warn("m not an integer only floor(m) used"));let b=v.n||0;if(b!==Math.floor(b)&&(b=Math.floor(b),q.d.Warn("n not an integer only floor(n) used")),b>P){const a=b;b=P,P=a,q.d.Warn("n > m therefore m and n swapped")}const L=new Ka;return L.build(P,b),d(a,{custom:Fa.BuildGeodesicData(L),size:v.size,sizeX:v.sizeX,sizeY:v.sizeY,sizeZ:v.sizeZ,faceUV:v.faceUV,faceColors:v.faceColors,flat:v.flat,updatable:v.updatable,sideOrientation:v.sideOrientation,frontUVs:v.frontUVs,backUVs:v.backUVs},p)},CreateGoldberg:function(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=v.size,K=v.sizeX||L||1,C=v.sizeY||L||1,F=v.sizeZ||L||1;let u=v.m||1;u!==Math.floor(u)&&(u=Math.floor(u),q.d.Warn("m not an integer only floor(m) used"));let f=v.n||0;if(f!==Math.floor(f)&&(f=Math.floor(f),q.d.Warn("n not an integer only floor(n) used")),f>u){const a=f;f=u,u=a,q.d.Warn("n > m therefore m and n swapped")}const H=new Ka;H.build(u,f);const A=Fa.BuildGeodesicData(H),h=A.toGoldbergPolyhedronData(),R=new ua(a,p);v.sideOrientation=b.b._GetDefaultSideOrientation(v.sideOrientation),R._originalBuilderSideOrientation=v.sideOrientation;(function(a,v){const p=a.size,b=a.sizeX||p||1,L=a.sizeY||p||1,K=a.sizeZ||p||1,C=0===a.sideOrientation?0:a.sideOrientation||t.e.DEFAULTSIDE,F=[],u=[],c=[],f=[];let H=1/0,A=-1/0,h=1/0,R=-1/0;for(let P=0;P<v.vertex.length;P++)H=Math.min(H,v.vertex[P][0]*b),A=Math.max(A,v.vertex[P][0]*b),h=Math.min(h,v.vertex[P][1]*L),R=Math.max(R,v.vertex[P][1]*L);let X=0;for(let t=0;t<v.face.length;t++){const a=v.face[t],p=P.s.bh(v.vertex[a[0]]),C=P.s.bh(v.vertex[a[2]]),Q=P.s.bh(v.vertex[a[1]]),s=C.od(p),D=Q.od(p),y=P.s.Cross(D,s).normalize();for(let P=0;P<a.length;P++){c.push(y.x,y.y,y.z);const p=v.vertex[a[P]];F.push(p[0]*b,p[1]*L,p[2]*K);const t=(p[1]*L-h)/(R-h);f.push((p[0]*b-H)/(A-H),V.b?1-t:t)}for(let v=0;v<a.length-2;v++)u.push(X,X+v+2,X+v+1);X+=a.length}t.e._ComputeSides(C,F,u,c,f);const Q=new t.e;return Q.xa=F,Q.indices=u,Q.ya=c,Q.Aa=f,Q})(v,h).Ca(R,v.updatable),R.goldbergData.nbSharedFaces=A.sharedNodes,R.goldbergData.nbUnsharedFaces=A.poleNodes,R.goldbergData.adjacentFaces=A.adjacentFaces,R.goldbergData.nbFaces=R.goldbergData.nbSharedFaces+R.goldbergData.nbUnsharedFaces,R.goldbergData.nbFacesAtPole=(R.goldbergData.nbUnsharedFaces-12)/12;for(let b=0;b<A.vertex.length;b++)R.goldbergData.faceCenters.push(P.s.bh(A.vertex[b])),R.goldbergData.faceCenters[b].x*=K,R.goldbergData.faceCenters[b].y*=C,R.goldbergData.faceCenters[b].z*=F,R.goldbergData.faceColors.push(new c.e(1,1,1,1));for(let b=0;b<h.face.length;b++){const a=h.face[b],v=P.s.bh(h.vertex[a[0]]),p=P.s.bh(h.vertex[a[2]]),L=P.s.bh(h.vertex[a[1]]),t=p.od(v),V=L.od(v),K=P.s.Cross(V,t).normalize(),C=P.s.Cross(V,K).normalize();R.goldbergData.faceXaxis.push(V.normalize()),R.goldbergData.faceYaxis.push(K),R.goldbergData.faceZaxis.push(C)}return R},CreateDecal:ba,CreateCapsule:ta,CreateText:function(a,v,p){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const K=function(a,v,p,P){const b=Array.from(a),L=v/P.resolution,t=(P.boundingBox.yMax-P.boundingBox.yMin+P.underlineThickness)*L,V=[];let K=0,C=0;for(let F=0;F<b.length;F++){const a=b[F];if("\n"===a)K=0,C-=t;else{const v=Ha(a,L,K,C,p,P);v&&(K+=v.offsetX,V.push(v.shapePath))}}return V}(v,L.size||50,L.resolution||8,p),C=[];let F=0;for(const H of K){if(!H.paths.length)continue;const v=H.holes.slice();for(const p of H.paths){var u,c;const K=[],f=[],H=p.getPoints();for(const a of H)f.push(new P.s(a.x,0,a.y));const A=v.slice();for(const a of A){const b=a.getPoints();let L=!1;for(const a of b)if(p.isPointInside(a)){L=!0;break}if(!L)continue;const t=[];for(const a of b)t.push(new P.s(a.x,0,a.y));K.push(t),v.splice(v.indexOf(a),1)}if(!K.length&&v.length)for(const a of v){const v=a.getPoints(),p=[];for(const a of v)p.push(new P.s(a.x,0,a.y));K.push(p)}const h=m(a,{shape:f,holes:K.length?K:void 0,depth:L.depth||1,faceUV:L.faceUV||(null===(u=L.perLetterFaceUV)||void 0===u?void 0:u.call(L,F)),faceColors:L.faceColors||(null===(c=L.perLetterFaceColors)||void 0===c?void 0:c.call(L,F)),sideOrientation:b.b._GetDefaultSideOrientation(L.sideOrientation||b.b.DOUBLESIDE)},t,V);C.push(h),F++}}const f=b.b.MergeMeshes(C,!0,!0);if(f){const v=f.getBoundingInfo().boundingBox;f.position.x+=-(v.minimumWorld.x+v.maximumWorld.x)/2,f.position.y+=-(v.minimumWorld.y+v.maximumWorld.y)/2,f.position.z+=-(v.minimumWorld.z+v.maximumWorld.z)/2+v.extendSize.z,f.name=a;const p=new ca.c("pivot",t);p.rotation.x=-Math.PI/2,f.parent=p,f.bakeCurrentTransformIntoVertices(),f.parent=null,p.dispose()}return f}}},11395:(a,v,p)=>{"use strict";p.d(v,{d:()=>K});var P=p(11306),b=p(11404),L=p(11413),t=p(11429),V=p(11438);class K{get materialDefines(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(a=this._getDrawWrapper())||void 0===a?void 0:a.defines}set materialDefines(a){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=a}_getDrawWrapper(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a??this._engine.currentRenderPassId;let p=this._drawWrappers[a];return!p&&v&&(this._drawWrappers[a]=p=new V.e(this._mesh.va().getEngine())),p}_removeDrawWrapper(a){var v;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(v=this._drawWrappers[a])||void 0===v||v.dispose());this._drawWrappers[a]=void 0}get effect(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(a=this._getDrawWrapper())||void 0===a?void 0:a.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(a){this._mainDrawWrapperOverride=a}setEffect(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=this._drawWrapper;b.setEffect(a,v,P),void 0!==p&&(b.materialContext=p),a||(b.defines=null,b.materialContext=void 0)}resetDrawCache(a){if(this._drawWrappers){if(void 0!==a)return void this._removeDrawWrapper(a);for(const a of this._drawWrappers)null===a||void 0===a||a.dispose()}this._drawWrappers=[]}static AddToMesh(a,v,p,P,b,L,t){return new K(a,v,p,P,b,L,t,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(a,v,p,P,b,L,t){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],K=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=a,this.verticesStart=v,this.verticesCount=p,this.indexStart=P,this.indexCount=b,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=L,this._renderingMesh=t||L,K&&L.rg.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=L.rg.length-1,V&&(this.refreshBoundingInfo(),L.Zj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(a){return this._boundingInfo=a,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const a=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return a||this._renderingMesh}Ha(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!v)return a?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(v)){const a=v.getSubMaterial(this.materialIndex);return this._currentMaterial!==a&&(this._currentMaterial=a,this.resetDrawCache()),a}return v}_isMultiMaterial(a){return void 0!==a.getSubMaterial}refreshBoundingInfo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Oj)return this;if(a||(a=this._renderingMesh.getVerticesData(P.f.PositionKind)),!a)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const v=this._renderingMesh.ng();let p;if(0===this.indexStart&&this.indexCount===v.length){const a=this._renderingMesh.getBoundingInfo();p={minimum:a.minimum.clone(),maximum:a.maximum.clone()}}else p=(0,t.d)(a,v,this.indexStart,this.indexCount,this._renderingMesh.Oj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(p.minimum,p.maximum):this._boundingInfo=new L.d(p.minimum,p.maximum),this}_checkCollision(a){return this.getBoundingInfo()._checkCollision(a)}updateBoundingInfo(a){let v=this.getBoundingInfo();return v||(this.refreshBoundingInfo(),v=this.getBoundingInfo()),v&&v.update(a),this}isInFrustum(a){const v=this.getBoundingInfo();return!!v&&v.isInFrustum(a,this._mesh.Oi)}isCompletelyInFrustum(a){const v=this.getBoundingInfo();return!!v&&v.isCompletelyInFrustum(a)}render(a){return this._renderingMesh.render(this,a,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(a,v){if(!this._linesIndexBuffer){const p=[];for(let v=this.indexStart;v<this.indexStart+this.indexCount;v+=3)p.push(a[v],a[v+1],a[v+1],a[v+2],a[v+2],a[v]);this._linesIndexBuffer=v.createIndexBuffer(p),this._linesIndexCount=p.length}return this._linesIndexBuffer}canIntersects(a){const v=this.getBoundingInfo();return!!v&&a.intersectsBox(v.boundingBox)}intersects(a,v,p,P,b){const L=this.Ha();if(!L)return null;let t=3,V=!1;switch(L.fillMode){case 3:case 5:case 6:case 8:return null;case 7:t=1,V=!0}return 4===L.fillMode?p.length?this._intersectLines(a,v,p,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(a,v,p,this._mesh.intersectionThreshold,P):!p.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(a,v,p,P,b):this._intersectTriangles(a,v,p,t,V,P,b)}_intersectLines(a,v,p,P,L){let t=null;for(let V=this.indexStart;V<this.indexStart+this.indexCount;V+=2){const K=v[p[V]],C=v[p[V+1]],F=a.intersectionSegment(K,C,P);if(!(F<0)&&((L||!t||F<t.distance)&&(t=new b.c(null,null,F),t.faceId=V/2,L)))break}return t}_intersectUnIndexedLines(a,v,p,P,L){let t=null;for(let V=this.verticesStart;V<this.verticesStart+this.verticesCount;V+=2){const p=v[V],K=v[V+1],C=a.intersectionSegment(p,K,P);if(!(C<0)&&((L||!t||C<t.distance)&&(t=new b.c(null,null,C),t.faceId=V/2,L)))break}return t}_intersectTriangles(a,v,p,P,b,L,t){let V=null,K=-1;for(let C=this.indexStart;C<this.indexStart+this.indexCount-(3-P);C+=P){K++;const P=p[C],F=p[C+1],u=p[C+2];if(b&&4294967295===u){C+=2;continue}const c=v[P],f=v[F],H=v[u];if(!c||!f||!H)continue;if(t&&!t(c,f,H,a,P,F,u))continue;const A=a.intersectsTriangle(c,f,H);if(A){if(A.distance<0)continue;if((L||!V||A.distance<V.distance)&&(V=A,V.faceId=K,L))break}}return V}_intersectUnIndexedTriangles(a,v,p,P,b){let L=null;for(let t=this.verticesStart;t<this.verticesStart+this.verticesCount;t+=3){const p=v[t],V=v[t+1],K=v[t+2];if(b&&!b(p,V,K,a,-1,-1,-1))continue;const C=a.intersectsTriangle(p,V,K);if(C){if(C.distance<0)continue;if((P||!L||C.distance<L.distance)&&(L=C,L.faceId=t/3,P))break}}return L}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(a,v){const p=new K(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,a,v,!1);if(!this.IsGlobal){const a=this.getBoundingInfo();if(!a)return p;p._boundingInfo=new L.d(a.minimum,a.maximum)}return p}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const a=this._mesh.rg.indexOf(this);this._mesh.rg.splice(a,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(a,v,p,P,b){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],t=Number.MAX_VALUE,V=-Number.MAX_VALUE;const C=(b||P).ng();for(let K=v;K<v+p;K++){const a=C[K];a<t&&(t=a),a>V&&(V=a)}return new K(a,t,V-t+1,v,p,P,b,L)}}},12482:(a,v,p)=>{"use strict";var P=p(11504),b=p(11306),L=p(11240),t=p(10905),V=p(11413);P.b.prototype.thinInstanceAdd=function(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return t.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(a)?a.length:1);const p=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(a))for(let P=0;P<a.length;++P)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,a[P],P===a.length-1&&v);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,a,v);return p},P.b.prototype.thinInstanceAddSelf=function(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(L.e.IdentityReadOnly,a)},P.b.prototype.thinInstanceRegisterAttribute=function(a,v){a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),this.removeVerticesData(a),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[a]=v,this._userThinInstanceBuffersStorage.sizes[a]=v*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[a]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[a]),this._userThinInstanceBuffersStorage.vertexBuffers[a]=new b.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[a],a,!0,!1,v,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[a])},P.b.prototype.thinInstanceSetMatrixAt=function(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||a>=this._thinInstanceDataStorage.instancesCount)return!1;const P=this._thinInstanceDataStorage.matrixData;return v.copyToArray(P,16*a),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[a]=v),p&&(this.dc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},P.b.prototype.thinInstanceSetAttributeAt=function(a,v,p){let P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[a]||v>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(a,0),this._userThinInstanceBuffersStorage.data[a].set(p,v*this._userThinInstanceBuffersStorage.strides[a]),P&&this.dc(a),!0)},Object.defineProperty(P.b.prototype,"_b",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(a){var v;const p=this._thinInstanceDataStorage.matrixData??(null===(v=this.source)||void 0===v?void 0:v._thinInstanceDataStorage.matrixData);a<=(p?p.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=a)},enumerable:!0,configurable:!0}),P.b.prototype._thinInstanceCreateMatrixBuffer=function(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const P=new b.b(this.getEngine(),v,!p,16,!1,!0);for(let b=0;b<4;b++)this.setVerticesBuffer(P.createVertexBuffer(a+b,4*b,4));return P},P.b.prototype.Rb=function(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var L;if(p=p||16,"matrix"===a)null===(L=this._thinInstanceDataStorage.matrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=v?v.length:32*p,this._thinInstanceDataStorage.matrixData=v,this._thinInstanceDataStorage.worldMatrices=null,null!==v?(this._thinInstanceDataStorage.instancesCount=v.length/p,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",v,P),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===a){var t;null===(t=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===t||t.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=v,null!==v&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",v,P))}else{var V;if(a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),null===v)null!==(V=this._userThinInstanceBuffersStorage)&&void 0!==V&&V.data[a]&&(this.removeVerticesData(a),delete this._userThinInstanceBuffersStorage.data[a],delete this._userThinInstanceBuffersStorage.strides[a],delete this._userThinInstanceBuffersStorage.sizes[a],delete this._userThinInstanceBuffersStorage.vertexBuffers[a]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[a]=v,this._userThinInstanceBuffersStorage.strides[a]=p,this._userThinInstanceBuffersStorage.sizes[a]=v.length,this._userThinInstanceBuffersStorage.vertexBuffers[a]=new b.f(this.getEngine(),v,a,!P,!1,p,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[a])}},P.b.prototype.dc=function(a){var v;if("matrix"===a)this.Xj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(a),null===(v=this._thinInstanceDataStorage.matrixBuffer)||void 0===v||v.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===a){var p;this.Xj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(a),null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var P;a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),null!==(P=this._userThinInstanceBuffersStorage)&&void 0!==P&&P.vertexBuffers[a]&&(this.Xj&&!this._userThinInstanceBuffersStorage.vertexBuffers[a].isUpdatable()&&this._thinInstanceRecreateBuffer(a),this._userThinInstanceBuffersStorage.vertexBuffers[a].updateDirectly(this._userThinInstanceBuffersStorage.data[a],0))}},P.b.prototype.thinInstancePartialBufferUpdate=function(a,v,p){var P;"matrix"===a?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(v,p):(a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),null!==(P=this._userThinInstanceBuffersStorage)&&void 0!==P&&P.vertexBuffers[a]&&this._userThinInstanceBuffersStorage.vertexBuffers[a].updateDirectly(v,p))},P.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const a=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let v=0;v<this._thinInstanceDataStorage.instancesCount;++v)this._thinInstanceDataStorage.worldMatrices[v]=L.e.bh(a,16*v)}return this._thinInstanceDataStorage.worldMatrices},P.b.prototype.thinInstanceRefreshBoundingInfo=function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const P=this._thinInstanceDataStorage.boundingVectors;if(a||!this.rawBoundingInfo){P.length=0,this.refreshBoundingInfo(v,p);const a=this.getBoundingInfo();this.rawBoundingInfo=new V.d(a.minimum,a.maximum)}const b=this.getBoundingInfo(),t=this._thinInstanceDataStorage.matrixData;if(0===P.length)for(let L=0;L<b.boundingBox.vectors.length;++L)P.push(b.boundingBox.vectors[L].clone());L.k.fb[0].pe(Number.POSITIVE_INFINITY),L.k.fb[1].pe(Number.NEGATIVE_INFINITY);for(let V=0;V<this._thinInstanceDataStorage.instancesCount;++V){L.e.FromArrayToRef(t,16*V,L.k.Matrix[0]);for(let a=0;a<P.length;++a)L.s.TransformCoordinatesToRef(P[a],L.k.Matrix[0],L.k.fb[2]),L.k.fb[0].minimizeInPlace(L.k.fb[2]),L.k.fb[1].maximizeInPlace(L.k.fb[2])}b.reConstruct(L.k.fb[0],L.k.fb[1]),this.Ea()},P.b.prototype._thinInstanceRecreateBuffer=function(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var p;if("matrix"===a)null===(p=this._thinInstanceDataStorage.matrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,v);else if("previousMatrix"===a){var P;if(this._scene.needsPreviousWorldMatrices)null===(P=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===P||P.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,v)}else{var L;a===b.f.ColorKind&&(a=b.f.ColorInstanceKind),null===(L=this._userThinInstanceBuffersStorage.vertexBuffers[a])||void 0===L||L.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[a]=new b.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[a],a,!v,!1,this._userThinInstanceBuffersStorage.strides[a],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[a])}},P.b.prototype._thinInstanceUpdateBufferSize=function(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a===b.f.ColorKind&&(a=b.f.ColorInstanceKind);const p="matrix"===a;if(!p&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[a]))return;const P=p?16:this._userThinInstanceBuffersStorage.strides[a],L=p?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[a];let t=p?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[a];const V=(this._thinInstanceDataStorage.instancesCount+v)*P;let K=L;for(;K<V;)K*=2;if(!t||L!=K){if(t){const a=new Float32Array(K);a.set(t,0),t=a}else t=new Float32Array(K);var C,F,u;if(p){if(null===(C=this._thinInstanceDataStorage.matrixBuffer)||void 0===C||C.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,!1),this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.matrixBufferSize=K,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(F=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===F||F.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,!1)}else null===(u=this._userThinInstanceBuffersStorage.vertexBuffers[a])||void 0===u||u.dispose(),this._userThinInstanceBuffersStorage.data[a]=t,this._userThinInstanceBuffersStorage.sizes[a]=K,this._userThinInstanceBuffersStorage.vertexBuffers[a]=new b.f(this.getEngine(),t,a,!0,!1,P,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[a])}},P.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},P.b.prototype._disposeThinInstanceSpecificData=function(){var a;null!==(a=this._thinInstanceDataStorage)&&void 0!==a&&a.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11544:(a,v,p)=>{"use strict";p.d(v,{c:()=>u});var P=p(11207),b=p(11210),L=p(11287),t=p(10893),V=p(11240),K=p(11515),C=p(11027);const F=V.e.Compose(V.s.One(),V.i.FromEulerAngles(0,Math.PI,0),V.s.Zero());class u extends K.b{get billboardMode(){return this._billboardMode}set billboardMode(a){this._billboardMode!==a&&(this._billboardMode=a,this._cache.useBillboardPosition=0!==(this._billboardMode&u.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(a){a!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=a,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(a){this._infiniteDistance!==a&&(this._infiniteDistance=a)}constructor(a){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new V.s(0,0,1),this._up=new V.s(0,1,0),this._right=new V.s(1,0,0),this._position=V.s.Zero(),this._rotation=V.s.Zero(),this._rotationQuaternion=null,this._scaling=V.s.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=u.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._j=V.e.Zero(),this._usePivotMatrix=!1,this._absolutePosition=V.s.Zero(),this._absoluteScaling=V.s.Zero(),this._absoluteRotationQuaternion=V.i.Identity(),this._pivotMatrix=V.e.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new t.c,this._nonUniformScaling=!1,v&&this.va().addTransformNode(this)}getClassName(){return"rb"}get position(){return this._position}set position(a){this._position=a,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(a){this._rotation=a,this._rotationQuaternion=null,this._markAsDirtyInternal()}get te(){return this._scaling}set te(a){this._scaling=a,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(a){this._rotationQuaternion=a,a&&this._rotation.pe(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return V.s.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return V.s.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return V.s.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(a){return this._poseMatrix?(this._poseMatrix.p(a),this):(this._poseMatrix=a.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=V.e.Identity()),this._poseMatrix}_isSynchronized(){const a=this._cache;return this._billboardMode===a.billboardMode&&this._billboardMode===u.BILLBOARDMODE_NONE&&(!a.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const a=this._cache;a.localMatrixUpdated=!1,a.billboardMode=-1,a.infiniteDistance=!1,a.useBillboardPosition=!1,a.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(a){return this.setPivotMatrix(a,!1)}setPivotMatrix(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(a),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=v,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=V.e.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;const P=this.clone("Clone of "+(this.name||this.id),a||this.parent,!0);P&&p&&p(this,P);for(const b of this.getChildTransformNodes(!0))b.instantiateHierarchy(P,v,p);return P}Ec(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return a?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.pe(0),this._rotationQuaternion=this._rotationQuaternion||V.i.Identity(),a.decompose(this._scaling,this._rotationQuaternion,this._position),this.Zj(!0)):(this._worldMatrix=a,this._absolutePosition.qe(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Zj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Zj(!0),this}get Aj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Zj(),this._absolutePosition}setAbsolutePosition(a){if(!a)return this;let v,p,P;if(void 0===a.x){if(arguments.length<3)return this;v=arguments[0],p=arguments[1],P=arguments[2]}else v=a.x,p=a.y,P=a.z;if(this.parent){const a=V.k.Matrix[0];this.parent.getWorldMatrix().invertToRef(a),V.s.TransformCoordinatesFromFloatsToRef(v,p,P,a,this.position)}else this.position.x=v,this.position.y=p,this.position.z=P;return this._absolutePosition.p(a),this}setPositionWithLocalVector(a){return this.Zj(),this.position=V.s.TransformNormal(a,this._j),this}getPositionExpressedInLocalSpace(){this.Zj();const a=V.k.Matrix[0];return this._j.invertToRef(a),V.s.TransformNormal(this.position,a)}locallyTranslate(a){return this.Zj(!0),this.position=V.s.TransformCoordinates(a,this._j),this}lookAt(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const L=u._LookAtVectorCache,t=0===b?this.position:this.getAbsolutePosition();if(a.subtractToRef(t,L),this.setDirection(L,v,p,P),1===b&&this.parent)if(this.rotationQuaternion){const a=V.k.Matrix[0];this.rotationQuaternion.toRotationMatrix(a);const v=V.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(v),v.invert(),a.multiplyToRef(v,a),this.rotationQuaternion.fromRotationMatrix(a)}else{const a=V.k.Quaternion[0];V.i.FromEulerVectorToRef(this.rotation,a);const v=V.k.Matrix[0];a.toRotationMatrix(v);const p=V.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.invert(),v.multiplyToRef(p,v),a.fromRotationMatrix(v),a.toEulerAnglesToRef(this.rotation)}return this}gf(a){const v=V.s.Zero();return this.getDirectionToRef(a,v),v}getDirectionToRef(a,v){return V.s.TransformNormalToRef(a,this.getWorldMatrix(),v),this}setDirection(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const b=-Math.atan2(a.z,a.x)+Math.PI/2,L=Math.sqrt(a.x*a.x+a.z*a.z),t=-Math.atan2(a.y,L);return this.rotationQuaternion?V.i.RotationYawPitchRollToRef(b+v,t+p,P,this.rotationQuaternion):(this.rotation.x=t+p,this.rotation.y=b+v,this.rotation.z=P),this}setPivotPoint(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Zj(!0);const p=this.getWorldMatrix();if(1==v){const v=V.k.Matrix[0];p.invertToRef(v),a=V.s.TransformCoordinates(a,v)}return this.setPivotMatrix(V.e.Translation(-a.x,-a.y,-a.z),!0)}getPivotPoint(){const a=V.s.Zero();return this.getPivotPointToRef(a),a}getPivotPointToRef(a){return a.x=-this._pivotMatrix.m[12],a.y=-this._pivotMatrix.m[13],a.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const a=V.s.Zero();return this.getAbsolutePivotPointToRef(a),a}getAbsolutePivotPointToRef(a){return this.getPivotPointToRef(a),V.s.TransformCoordinatesToRef(a,this.getWorldMatrix(),a),this}Sg(a){if(this._isDirty)return this;if(this._children)for(const v of this._children)v.Sg(a);return super.Sg(a)}setParent(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!a&&!this.parent)return this;const P=V.k.Quaternion[0],b=V.k.fb[0],L=V.k.fb[1],t=V.k.Matrix[1];V.e.IdentityToRef(t);const K=V.k.Matrix[0];this.Zj(!0);let C=this.rotationQuaternion;return C||(C=u._TmpRotation,V.i.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,C)),V.e.ComposeToRef(this.te,C,this.position,K),this.parent&&K.multiplyToRef(this.parent.Zj(!0),K),a&&(a.Zj(!0).invertToRef(t),K.multiplyToRef(t,K)),K.decompose(L,P,b,v?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(P):P.toEulerAnglesToRef(this.rotation),this.te.p(L),this.position.p(b),this.parent=a,p&&this.setPivotMatrix(V.e.Identity()),this}addChild(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.setParent(this,v),this}removeChild(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a.setParent(null,v),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(a){return this._nonUniformScaling!==a&&(this._nonUniformScaling=a,!0)}attachToBone(a,v){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=v,this.parent=a,a.getSkeleton().prepare(!0),a.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=a?this._currentParentWhenAttachingToBone:null,this):(a&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(a,v,p){let P;if(a.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.pe(0)),p&&0!==p){if(this.parent){const p=this.parent.getWorldMatrix(),P=V.k.Matrix[0];p.invertToRef(P),a=V.s.TransformNormal(a,P),p.determinant()<0&&(v*=-1)}P=V.i.RotationAxisToRef(a,v,u._RotationAxisCache),P.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else P=V.i.RotationAxisToRef(a,v,u._RotationAxisCache),this.rotationQuaternion.multiplyToRef(P,this.rotationQuaternion);return this}rotateAround(a,v,p){v.normalize(),this.rotationQuaternion||(this.rotationQuaternion=V.i.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.pe(0));const P=V.k.fb[0],b=V.k.fb[1],L=V.k.fb[2],t=V.k.Quaternion[0],K=V.k.Matrix[0],C=V.k.Matrix[1],F=V.k.Matrix[2],u=V.k.Matrix[3];return a.subtractToRef(this.position,P),V.e.TranslationToRef(P.x,P.y,P.z,K),V.e.TranslationToRef(-P.x,-P.y,-P.z,C),V.e.RotationAxisToRef(v,p,F),C.multiplyToRef(F,u),u.multiplyToRef(K,u),u.decompose(b,t,L),this.position.addInPlace(L),t.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(a,v,p){const P=a.scale(v);if(p&&0!==p)this.setAbsolutePosition(this.getAbsolutePosition().add(P));else{const a=this.getPositionExpressedInLocalSpace().add(P);this.setPositionWithLocalVector(a)}return this}addRotation(a,v,p){let P;this.rotationQuaternion?P=this.rotationQuaternion:(P=V.k.Quaternion[1],V.i.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,P));const b=V.k.Quaternion[0];return V.i.RotationYawPitchRollToRef(v,a,p,b),P.multiplyInPlace(b),this.rotationQuaternion||P.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Zj(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const p=this.va().getRenderId();if(!this._isDirty&&!a&&(this._currentRenderId===p||this.isSynchronized()))return this._currentRenderId=p,this._worldMatrix;v=v||this.va().activeCamera,this._updateCache();const P=this._cache;P.pivotMatrixUpdated=!1,P.billboardMode=this.billboardMode,P.infiniteDistance=this.infiniteDistance,P.parent=this._parentNode,this._currentRenderId=p,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const b=this._getEffectiveParent(),L=u._TmpScaling;let t,K=this._position;if(this._infiniteDistance&&!this.parent&&v){const a=v.getWorldMatrix(),p=new V.s(a.m[12],a.m[13],a.m[14]);K=u._TmpTranslation,K.qe(this._position.x+p.x,this._position.y+p.y,this._position.z+p.z)}if(L.qe(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,t=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(V.i.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.qe(0,0,0))}}else t=u._TmpRotation,V.i.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,t);if(this._usePivotMatrix){const a=V.k.Matrix[1];V.e.ScalingToRef(L.x,L.y,L.z,a);const v=V.k.Matrix[0];t.toRotationMatrix(v),this._pivotMatrix.multiplyToRef(a,V.k.Matrix[4]),V.k.Matrix[4].multiplyToRef(v,this._j),this._postMultiplyPivotMatrix&&this._j.multiplyToRef(this._pivotMatrixInverse,this._j),this._j.addTranslationFromFloats(K.x,K.y,K.z)}else V.e.ComposeToRef(L,t,K,this._j);if(b&&b.getWorldMatrix){if(a&&b.Zj(a),P.useBillboardPath){if(this._transformToBoneReferal){const a=this.parent;a.getSkeleton().prepare(),a.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),V.k.Matrix[7])}else V.k.Matrix[7].p(b.getWorldMatrix());const a=V.k.fb[5],v=V.k.fb[6],p=V.k.Quaternion[0];V.k.Matrix[7].decompose(v,p,a),V.e.ScalingToRef(v.x,v.y,v.z,V.k.Matrix[7]),V.k.Matrix[7].setTranslation(a),u.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(p,a),this._j.setTranslation(a)),this._j.multiplyToRef(V.k.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const a=this.parent;a.getSkeleton().prepare(),this._j.multiplyToRef(a.getFinalMatrix(),V.k.Matrix[6]),V.k.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._j.multiplyToRef(b.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this._j);if(P.useBillboardPath&&v&&this.billboardMode&&!P.useBillboardPosition){const a=V.k.fb[0];if(this._worldMatrix.getTranslationToRef(a),V.k.Matrix[1].p(v.getViewMatrix()),this._scene.useRightHandedSystem&&V.k.Matrix[1].multiplyToRef(F,V.k.Matrix[1]),V.k.Matrix[1].setTranslationFromFloats(0,0,0),V.k.Matrix[1].invertToRef(V.k.Matrix[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){V.k.Matrix[0].decompose(void 0,V.k.Quaternion[0],void 0);const a=V.k.fb[1];V.k.Quaternion[0].toEulerAnglesToRef(a),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(a.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(a.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(a.z=0),V.e.RotationYawPitchRollToRef(a.y,a.x,a.z,V.k.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(V.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(V.k.fb[0])}else if(P.useBillboardPath&&v&&P.useBillboardPosition){const a=V.k.fb[0];this._worldMatrix.getTranslationToRef(a);const p=v.globalPosition;this._worldMatrix.invertToRef(V.k.Matrix[1]);const P=V.k.fb[1];V.s.TransformCoordinatesToRef(p,V.k.Matrix[1],P),P.normalize();const b=-Math.atan2(P.z,P.x)+Math.PI/2,L=Math.sqrt(P.x*P.x+P.z*P.z),t=-Math.atan2(P.y,L);if(V.i.RotationYawPitchRollToRef(b,t,0,V.k.Quaternion[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){const a=V.k.fb[1];V.k.Quaternion[0].toEulerAnglesToRef(a),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(a.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(a.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(a.z=0),V.e.RotationYawPitchRollToRef(a.y,a.x,a.z,V.k.Matrix[0])}else V.e.FromQuaternionToRef(V.k.Quaternion[0],V.k.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(V.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(V.k.fb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):b&&b._nonUniformScaling?this._updateNonUniformScalingState(b._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.qe(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=V.e.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Zj(),a){const a=this.getChildren();for(let v=0;v<a.length;++v){const p=a[v];if(p){p.Zj();const a=V.k.Matrix[0];p._j.multiplyToRef(this._j,a);const v=V.k.Quaternion[0];a.decompose(p.te,v,p.position),p.rotationQuaternion?p.rotationQuaternion.p(v):v.toEulerAnglesToRef(p.rotation)}}}this.te.qe(1,1,1),this.position.qe(0,0,0),this.rotation.qe(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=V.i.Identity()),this._worldMatrix=V.e.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(a){return this.onAfterWorldMatrixUpdateObservable.add(a),this}unregisterAfterWorldMatrixUpdate(a){return this.onAfterWorldMatrixUpdateObservable.removeCallback(a),this}getPositionInCameraSpace(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return a||(a=this.va().activeCamera),V.s.TransformCoordinates(this.getAbsolutePosition(),a.getViewMatrix())}getDistanceToCamera(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return a||(a=this.va().activeCamera),this.getAbsolutePosition().od(a.globalPosition).length()}clone(a,v,p){const P=L.b.Clone((()=>new u(a,this.va())),this);if(P.name=a,P.id=a,v&&(P.parent=v),!p){const v=this.getDescendants(!0);for(let p=0;p<v.length;p++){const b=v[p];b.clone&&b.clone(a+"."+b.name,P)}}return P}serialize(a){const v=L.b.Serialize(this,a);return v.type=this.getClassName(),v.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(v),v.localMatrix=this.getPivotMatrix().tj(),v.isEnabled=this.isEnabled(),L.b.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v}static Parse(a,v,p){const P=L.b.Parse((()=>new u(a.name,v)),a,v,p);if(a.localMatrix?P.setPreTransformMatrix(V.e.bh(a.localMatrix)):a.pivotMatrix&&P.setPivotMatrix(V.e.bh(a.pivotMatrix)),P.Mb(a.isEnabled),P._waitingParsedUniqueId=a.uniqueId,void 0!==a.parentId&&(P._waitingParentId=a.parentId),void 0!==a.parentInstanceIndex&&(P._waitingParentInstanceIndex=a.parentInstanceIndex),a.animations){for(let v=0;v<a.animations.length;v++){const p=a.animations[v],b=(0,C.c)("BABYLON.Animation");b&&P.animations.push(b.Parse(p))}K.b.ParseAnimationRanges(P,a,v)}return a.autoAnimate&&v.beginAnimation(P,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),P}getChildTransformNodes(a,v){const p=[];return this._getDescendants(p,a,(a=>(!v||v(a))&&a instanceof u)),p}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const a=this._parentContainer.transformNodes.indexOf(this);a>-1&&this._parentContainer.transformNodes.splice(a,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),a){const a=this.getChildTransformNodes(!0);for(const v of a)v.parent=null,v.Zj(!0)}super.dispose(a,v)}normalizeToUnitCube(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0,P=null,b=null;v&&(this.rotationQuaternion?(b=this.rotationQuaternion.clone(),this.rotationQuaternion.qe(0,0,0,1)):this.rotation&&(P=this.rotation.clone(),this.rotation.qe(0,0,0)));const L=this.getHierarchyBoundingVectors(a,p),t=L.max.od(L.min),V=Math.max(t.x,t.y,t.z);if(0===V)return this;const K=1/V;return this.te.scaleInPlace(K),v&&(this.rotationQuaternion&&b?this.rotationQuaternion.p(b):this.rotation&&P&&this.rotation.p(P)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}u.BILLBOARDMODE_NONE=0,u.BILLBOARDMODE_X=1,u.BILLBOARDMODE_Y=2,u.BILLBOARDMODE_Z=4,u.BILLBOARDMODE_ALL=7,u.BILLBOARDMODE_USE_POSITION=128,u.BillboardUseParentOrientation=!1,u._TmpRotation=V.i.Zero(),u._TmpScaling=V.s.Zero(),u._TmpTranslation=V.s.Zero(),u._LookAtVectorCache=new V.s(0,0,0),u._RotationAxisCache=new V.i,(0,P.e)([(0,b.M)("position")],u.prototype,"_position",void 0),(0,P.e)([(0,b.M)("rotation")],u.prototype,"_rotation",void 0),(0,P.e)([(0,b.F)("rotationQuaternion")],u.prototype,"_rotationQuaternion",void 0),(0,P.e)([(0,b.M)("te")],u.prototype,"_scaling",void 0),(0,P.e)([(0,b.O)("billboardMode")],u.prototype,"_billboardMode",void 0),(0,P.e)([(0,b.O)()],u.prototype,"scalingDeterminant",void 0),(0,P.e)([(0,b.O)("infiniteDistance")],u.prototype,"_infiniteDistance",void 0),(0,P.e)([(0,b.O)()],u.prototype,"ignoreNonUniformScaling",void 0),(0,P.e)([(0,b.O)()],u.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11738:(a,v,p)=>{"use strict";p.d(v,{d:()=>C});var P=p(11240),b=p(11263),L=p(11714),t=p(11245),V=p(11279);class K{constructor(a,v,p,P){this.name=a,this.worldAxisForNormal=v,this.worldAxisForFileX=p,this.worldAxisForFileY=P}}class C{static ConvertCubeMapTextureToSphericalPolynomial(a){var v;if(!a.isCube)return null;null===(v=a.va())||void 0===v||v.getEngine().flushFramebuffer();const p=a.getSize().width,P=a.readPixels(0,void 0,void 0,!1),b=a.readPixels(1,void 0,void 0,!1);let L,t;a.isRenderTarget?(L=a.readPixels(3,void 0,void 0,!1),t=a.readPixels(2,void 0,void 0,!1)):(L=a.readPixels(2,void 0,void 0,!1),t=a.readPixels(3,void 0,void 0,!1));const V=a.readPixels(4,void 0,void 0,!1),K=a.readPixels(5,void 0,void 0,!1),C=a.gammaSpace;let F=0;return 1!=a.textureType&&2!=a.textureType||(F=1),new Promise((a=>{Promise.all([b,P,L,t,V,K]).then((v=>{let[P,b,L,t,V,K]=v;const u={size:p,right:b,left:P,up:L,down:t,front:V,back:K,format:5,type:F,gammaSpace:C};a(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(a,v){return Math.atan2(a*v,Math.sqrt(a*a+v*v+1))}static ConvertCubeMapToSphericalPolynomial(a){const v=new L.d;let p=0;const P=2/a.size,K=P,C=.5*P,F=C-1;for(let L=0;L<6;L++){const u=this._FileFaces[L],c=a[u.name];let f=F;const H=5===a.format?4:3;for(let L=0;L<a.size;L++){let A=F;for(let K=0;K<a.size;K++){const F=u.worldAxisForFileX.scale(A).add(u.worldAxisForFileY.scale(f)).add(u.worldAxisForNormal);F.normalize();const h=this._AreaElement(A-C,f-C)-this._AreaElement(A-C,f+C)-this._AreaElement(A+C,f-C)+this._AreaElement(A+C,f+C);let R=c[L*a.size*H+K*H+0],X=c[L*a.size*H+K*H+1],Q=c[L*a.size*H+K*H+2];isNaN(R)&&(R=0),isNaN(X)&&(X=0),isNaN(Q)&&(Q=0),0===a.type&&(R/=255,X/=255,Q/=255),a.gammaSpace&&(R=Math.pow((0,b.e)(R),t.m),X=Math.pow((0,b.e)(X),t.m),Q=Math.pow((0,b.e)(Q),t.m));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const a=Math.max(R,X,Q);if(a>s){const v=s/a;R*=v,X*=v,Q*=v}}else R=(0,b.e)(R,0,s),X=(0,b.e)(X,0,s),Q=(0,b.e)(Q,0,s);const D=new V.d(R,X,Q);v.addLight(F,D,h),p+=h,A+=P}f+=K}}const u=6*(4*Math.PI)/6/p;return v.scaleInPlace(u),v.convertIncidentRadianceToIrradiance(),v.convertIrradianceToLambertianRadiance(),L.f.FromHarmonics(v)}}C._FileFaces=[new K("right",new P.s(1,0,0),new P.s(0,0,-1),new P.s(0,-1,0)),new K("left",new P.s(-1,0,0),new P.s(0,0,1),new P.s(0,-1,0)),new K("up",new P.s(0,1,0),new P.s(1,0,0),new P.s(0,0,1)),new K("down",new P.s(0,-1,0),new P.s(1,0,0),new P.s(0,0,-1)),new K("front",new P.s(0,0,1),new P.s(1,0,0),new P.s(0,-1,0)),new K("back",new P.s(0,0,-1),new P.s(-1,0,0),new P.s(0,-1,0))],C.MAX_HDRI_VALUE=4096,C.PRESERVE_CLAMPED_COLORS=!1},11254:(a,v,p)=>{"use strict";function P(a,v){const p=[];for(let P=0;P<a;++P)p.push(v());return p}function b(a,v){return P(a,v)}p.d(v,{d:()=>P,f:()=>b,i:()=>t});const L=["push","splice","pop","shift","unshift"];function t(a,v){const p=L.map((p=>function(a,v,p){const P=a[v];if("function"!==typeof P)return null;const b=function(){const P=a.length,L=b.previous.apply(a,arguments);return p(v,P),L};return P.next=b,b.previous=P,a[v]=b,()=>{const p=b.previous;if(!p)return;const P=b.next;P?(p.next=P,P.previous=p):(p.next=void 0,a[v]=p),b.next=void 0,b.previous=void 0}}(a,p,v)));return()=>{p.forEach((a=>{null===a||void 0===a||a()}))}}},12421:(a,v,p)=>{"use strict";p.d(v,{e:()=>t});var P=p(11460),b=p(12425);let L=0;const t=a=>{if(!a.environmentBRDFTexture){const v=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;const p=a._blockEntityCollection;a._blockEntityCollection=!1;const t=P.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+L++,a,!0,!1,P.c.BILINEAR_SAMPLINGMODE);a._blockEntityCollection=p;const V=a.getEngine().getLoadedTexturesCache(),K=V.indexOf(t.getInternalTexture());-1!==K&&V.splice(K,1),t.isRGBD=!0,t.wrapU=P.c.CLAMP_ADDRESSMODE,t.wrapV=P.c.CLAMP_ADDRESSMODE,a.environmentBRDFTexture=t,a.useDelayedTextureLoading=v,b.b.ExpandRGBDTexture(t);const C=a.getEngine().onContextRestoredObservable.add((()=>{t.isRGBD=!0;const v=a.onBeforeRenderObservable.add((()=>{t.isReady()&&(a.onBeforeRenderObservable.remove(v),b.b.ExpandRGBDTexture(t))}))}));a.uj.add((()=>{a.getEngine().onContextRestoredObservable.remove(C)}))}return a.environmentBRDFTexture}},11506:(a,v,p)=>{"use strict";function P(a,v,p){try{const P=a.next();P.done?v(P):P.value?P.value.then((()=>{P.value=void 0,v(P)}),p):v(P)}catch(P){p(P)}}function b(){let a,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(p,b,L)=>{const t=performance.now();void 0===a||t-a>v?(a=t,setTimeout((()=>{P(p,b,L)}),0)):P(p,b,L)}}function L(a,v,p,P,b){const L=()=>{let t;const V=a=>{a.done?p(a.value):void 0===t?t=!0:L()};do{t=void 0,b&&b.aborted?P(new Error("Aborted")):v(a,V,P),void 0===t&&(t=!1)}while(t)};L()}function t(a,v){let p;return L(a,P,(a=>p=a),(a=>{throw a}),v),p}function V(a,v,p){return new Promise(((P,b)=>{L(a,v,P,b,p)}))}function K(a,v){return function(){return t(a(...arguments),v)}}p.d(v,{c:()=>b,d:()=>K,e:()=>V,f:()=>t})},11733:(a,v,p)=>{"use strict";p.d(v,{d:()=>H});var P=p(11263),b=p(10905),L=p(11738),t=p(11747);p(11776);const V=131072,K=131072;function C(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}const F=C("DXT1"),u=C("DXT3"),c=C("DXT5"),f=C("DX10");class H{static GetDDSInfo(a){const v=new Int32Array(a.buffer,a.byteOffset,31),p=new Int32Array(a.buffer,a.byteOffset,35);let P=1;v[2]&V&&(P=Math.max(1,v[7]));const b=v[21],L=b===f?p[32]:0;let t=0;switch(b){case 113:t=2;break;case 116:t=1;break;case f:if(10===L){t=2;break}if(2===L){t=1;break}}return{width:v[4],height:v[3],mipmapCount:P,isFourCC:4===(4&v[20]),isRGB:64===(64&v[20]),isLuminance:(v[20]&K)===K,isCube:512===(512&v[28]),isCompressed:b===F||b===u||b===c,dxgiFormat:L,textureType:t}}static _GetHalfFloatAsFloatRGBAArrayBuffer(a,v,p,P,b,L){const V=new Float32Array(P),K=new Uint16Array(b,p);let C=0;for(let F=0;F<v;F++)for(let v=0;v<a;v++){const p=4*(v+F*a);V[C]=(0,t.f)(K[p]),V[C+1]=(0,t.f)(K[p+1]),V[C+2]=(0,t.f)(K[p+2]),H.StoreLODInAlphaChannel?V[C+3]=L:V[C+3]=(0,t.f)(K[p+3]),C+=4}return V}static _GetHalfFloatRGBAArrayBuffer(a,v,p,P,b,L){if(H.StoreLODInAlphaChannel){const V=new Uint16Array(P),K=new Uint16Array(b,p);let C=0;for(let p=0;p<v;p++)for(let v=0;v<a;v++){const P=4*(v+p*a);V[C]=K[P],V[C+1]=K[P+1],V[C+2]=K[P+2],V[C+3]=(0,t.g)(L),C+=4}return V}return new Uint16Array(b,p,P)}static _GetFloatRGBAArrayBuffer(a,v,p,P,b,L){if(H.StoreLODInAlphaChannel){const t=new Float32Array(P),V=new Float32Array(b,p);let K=0;for(let p=0;p<v;p++)for(let v=0;v<a;v++){const P=4*(v+p*a);t[K]=V[P],t[K+1]=V[P+1],t[K+2]=V[P+2],t[K+3]=L,K+=4}return t}return new Float32Array(b,p,P)}static _GetFloatAsHalfFloatRGBAArrayBuffer(a,v,p,P,b,L){const V=new Uint16Array(P),K=new Float32Array(b,p);let C=0;for(let F=0;F<v;F++)for(let v=0;v<a;v++)V[C]=(0,t.g)(K[C]),V[C+1]=(0,t.g)(K[C+1]),V[C+2]=(0,t.g)(K[C+2]),H.StoreLODInAlphaChannel?V[C+3]=(0,t.g)(L):V[C+3]=(0,t.g)(K[C+3]),C+=4;return V}static _GetFloatAsUIntRGBAArrayBuffer(a,v,p,b,L,t){const V=new Uint8Array(b),K=new Float32Array(L,p);let C=0;for(let F=0;F<v;F++)for(let v=0;v<a;v++){const p=4*(v+F*a);V[C]=255*(0,P.e)(K[p]),V[C+1]=255*(0,P.e)(K[p+1]),V[C+2]=255*(0,P.e)(K[p+2]),H.StoreLODInAlphaChannel?V[C+3]=t:V[C+3]=255*(0,P.e)(K[p+3]),C+=4}return V}static _GetHalfFloatAsUIntRGBAArrayBuffer(a,v,p,b,L,V){const K=new Uint8Array(b),C=new Uint16Array(L,p);let F=0;for(let u=0;u<v;u++)for(let v=0;v<a;v++){const p=4*(v+u*a);K[F]=255*(0,P.e)((0,t.f)(C[p])),K[F+1]=255*(0,P.e)((0,t.f)(C[p+1])),K[F+2]=255*(0,P.e)((0,t.f)(C[p+2])),H.StoreLODInAlphaChannel?K[F+3]=V:K[F+3]=255*(0,P.e)((0,t.f)(C[p+3])),F+=4}return K}static _GetRGBAArrayBuffer(a,v,p,P,b,L,t,V,K){const C=new Uint8Array(P),F=new Uint8Array(b,p);let u=0;for(let c=0;c<v;c++)for(let v=0;v<a;v++){const p=4*(v+c*a);C[u]=F[p+L],C[u+1]=F[p+t],C[u+2]=F[p+V],C[u+3]=F[p+K],u+=4}return C}static _ExtractLongWordOrder(a){return 0===a||255===a||-16777216===a?0:1+H._ExtractLongWordOrder(a>>8)}static _GetRGBArrayBuffer(a,v,p,P,b,L,t,V){const K=new Uint8Array(P),C=new Uint8Array(b,p);let F=0;for(let u=0;u<v;u++)for(let v=0;v<a;v++){const p=3*(v+u*a);K[F]=C[p+L],K[F+1]=C[p+t],K[F+2]=C[p+V],F+=3}return K}static _GetLuminanceArrayBuffer(a,v,p,P,b){const L=new Uint8Array(P),t=new Uint8Array(b,p);let V=0;for(let K=0;K<v;K++)for(let v=0;v<a;v++){const p=v+K*a;L[V]=t[p],V++}return L}static UploadDDSLevels(a,v,p,P,t,K){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,A=arguments.length>7?arguments[7]:void 0,h=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],R=null;P.sphericalPolynomial&&(R=[]);const X=!!a.getCaps().s3tc;v.generateMipMaps=t;const Q=new Int32Array(p.buffer,p.byteOffset,31);let s,D,y,Z,M,S,n,q=0,T=0,j=1;if(542327876!==Q[0])return void b.d.Error("Invalid magic number in DDS header");if(!P.isFourCC&&!P.isRGB&&!P.isLuminance)return void b.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(P.isCompressed&&!X)return void b.d.Error("Compressed textures are not supported on this platform.");let w=Q[22];Z=Q[1]+4;let J=!1;if(P.isFourCC)switch(s=Q[21],s){case F:j=8,T=33777;break;case u:j=16,T=33778;break;case c:j=16,T=33779;break;case 113:J=!0,w=64;break;case 116:J=!0,w=128;break;case f:{Z+=20;let a=!1;switch(P.dxgiFormat){case 10:J=!0,w=64,a=!0;break;case 2:J=!0,w=128,a=!0;break;case 88:P.isRGB=!0,P.isFourCC=!1,w=32,a=!0}if(a)break}default:return void b.d.Error(["Unsupported FourCC code:",(B=s,String.fromCharCode(255&B,B>>8&255,B>>16&255,B>>24&255))])}var B;const x=H._ExtractLongWordOrder(Q[23]),r=H._ExtractLongWordOrder(Q[24]),o=H._ExtractLongWordOrder(Q[25]),m=H._ExtractLongWordOrder(Q[26]);J&&(T=a._getRGBABufferInternalSizedFormat(P.textureType)),S=1,Q[2]&V&&!1!==t&&(S=Math.max(1,Q[7]));const O=A||0,Y=a.getCaps();for(let b=O;b<K;b++){for(D=Q[4],y=Q[3],n=0;n<S;++n){if(-1===C||C===n){const L=-1===C?n:0;if(!P.isCompressed&&P.isFourCC){v.format=5,q=D*y*4;let P=null;if(a._badOS||a._badDesktopOS||!Y.textureHalfFloat&&!Y.textureFloat)128===w?(P=H._GetFloatAsUIntRGBAArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,L),R&&0==L&&R.push(H._GetFloatRGBAArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,L))):64===w&&(P=H._GetHalfFloatAsUIntRGBAArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,L),R&&0==L&&R.push(H._GetHalfFloatAsFloatRGBAArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,L))),v.type=0;else{const a=Y.textureFloat&&(h&&Y.textureFloatLinearFiltering||!h),b=Y.textureHalfFloat&&(h&&Y.textureHalfFloatLinearFiltering||!h),t=(128===w||64===w&&!b)&&a?1:(64===w||128===w&&!a)&&b?2:0;let V,K=null;if(128===w)switch(t){case 1:V=H._GetFloatRGBAArrayBuffer,K=null;break;case 2:V=H._GetFloatAsHalfFloatRGBAArrayBuffer,K=H._GetFloatRGBAArrayBuffer;break;case 0:V=H._GetFloatAsUIntRGBAArrayBuffer,K=H._GetFloatRGBAArrayBuffer}else switch(t){case 1:V=H._GetHalfFloatAsFloatRGBAArrayBuffer,K=null;break;case 2:V=H._GetHalfFloatRGBAArrayBuffer,K=H._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:V=H._GetHalfFloatAsUIntRGBAArrayBuffer,K=H._GetHalfFloatAsFloatRGBAArrayBuffer}v.type=t,P=V(D,y,p.byteOffset+Z,q,p.buffer,L),R&&0==L&&R.push(K?K(D,y,p.byteOffset+Z,q,p.buffer,L):P)}P&&a._uploadDataToTextureDirectly(v,P,b,L)}else if(P.isRGB)v.type=0,24===w?(v.format=4,q=D*y*3,M=H._GetRGBArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,x,r,o),a._uploadDataToTextureDirectly(v,M,b,L)):(v.format=5,q=D*y*4,M=H._GetRGBAArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer,x,r,o,m),a._uploadDataToTextureDirectly(v,M,b,L));else if(P.isLuminance){const P=a._getUnpackAlignement(),t=D;q=Math.floor((D+P-1)/P)*P*(y-1)+t,M=H._GetLuminanceArrayBuffer(D,y,p.byteOffset+Z,q,p.buffer),v.format=1,v.type=0,a._uploadDataToTextureDirectly(v,M,b,L)}else q=Math.max(4,D)/4*Math.max(4,y)/4*j,M=new Uint8Array(p.buffer,p.byteOffset+Z,q),v.type=0,a._uploadCompressedDataToTextureDirectly(v,T,D,y,M,b,L)}Z+=w?D*y*(w/8):q,D*=.5,y*=.5,D=Math.max(1,D),y=Math.max(1,y)}if(void 0!==A)break}R&&R.length>0?P.sphericalPolynomial=L.d.ConvertCubeMapToSphericalPolynomial({size:Q[4],right:R[0],left:R[1],up:R[2],down:R[3],front:R[4],back:R[5],format:5,type:1,gammaSpace:!1}):P.sphericalPolynomial=void 0}}H.StoreLODInAlphaChannel=!1},11218:(a,v,p)=>{"use strict";p.d(v,{c:()=>L,e:()=>t});const P={},b={};function L(a){const v=a.getClassName();return b[v]||(b[v]={}),b[v]}function t(a){const v=a.getClassName();if(P[v])return P[v];P[v]={};const p=P[v];let L=a,t=v;for(;t;){const a=b[t];for(const b in a)p[b]=a[b];let v,P=!1;do{if(v=Object.getPrototypeOf(L),!v.getClassName){P=!0;break}if(v.getClassName()!==t)break;L=v}while(v);if(P)break;t=v.getClassName(),L=v}return p}},11210:(a,v,p)=>{"use strict";p.d(v,{C:()=>c,F:()=>h,H:()=>V,K:()=>F,M:()=>u,O:()=>t,e:()=>L,f:()=>X,j:()=>f,l:()=>K,o:()=>H,s:()=>C,w:()=>A,z:()=>R});var P=p(11218);function b(a,v){return(p,b)=>{const L=(0,P.c)(p);L[b]||(L[b]={type:a,sourceName:v})}}function L(a){return function(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(p,P)=>{const b=v||"_"+P;Object.defineProperty(p,P,{get:function(){return this[b]},set:function(v){"function"===typeof this.equals&&this.equals(v)||this[b]!==v&&(this[b]=v,p[a].apply(this))},enumerable:!0,configurable:!0})}}(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function t(a){return b(0,a)}function V(a){return b(1,a)}function K(a){return b(2,a)}function C(a){return b(3,a)}function F(a){return b(4,a)}function u(a){return b(5,a)}function c(a){return b(6,a)}function f(a){return b(7,a)}function H(a){return b(8,a)}function A(a){return b(9,a)}function h(a){return b(10,a)}function R(a){return b(12,a)}function X(a,v,p,P){const b=p.value;p.value=function(){let p=b;if("undefined"!==typeof _native&&_native[v]){const a=_native[v];p=P?function(){return P(...arguments)?a(...arguments):b(...arguments)}:a}return a[v]=p,p(...arguments)}}X.filter=function(a){return(v,p,P)=>X(v,p,P,a)}},11287:(a,v,p)=>{"use strict";p.d(v,{b:()=>C});var P=p(10926),b=p(11234),L=p(11279),t=p(11240),V=p(11218);const K=function(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const L=a();b.c&&b.c.HasTags(v)&&b.c.AddTagsTo(L,b.c.GetTags(v,!0));const t=(0,V.e)(L),K={};for(const b in t){const a=t[b],V=v[b],F=a.type;if(void 0!==V&&null!==V&&("uniqueId"!==b||C.AllowLoadingUniqueId))switch(F){case 0:case 6:case 11:L[b]=V;break;case 1:P.cloneTexturesOnlyOnce&&K[V.uniqueId]?L[b]=K[V.uniqueId]:(L[b]=p||V.isRenderTarget?V:V.clone(),K[V.uniqueId]=L[b]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:L[b]=p?V:V.clone()}}return L};class C{static AppendSerializedAnimations(a,v){if(a.animations){v.animations=[];for(let p=0;p<a.animations.length;p++){const P=a.animations[p];v.animations.push(P.serialize())}}}static Serialize(a,v){v||(v={}),b.c&&(v.tags=b.c.GetTags(a));const p=(0,V.e)(a);for(const P in p){const b=p[P],L=b.sourceName||P,t=b.type,V=a[P];if(void 0!==V&&null!==V&&("uniqueId"!==P||C.AllowLoadingUniqueId))switch(t){case 0:v[L]=V;break;case 1:case 3:case 7:case 9:v[L]=V.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:v[L]=V.tj();break;case 6:case 11:v[L]=V.id}}return v}static ParseProperties(a,v,p,P){P||(P="");const b=(0,V.e)(v);for(const V in b){const K=b[V],F=a[K.sourceName||V],u=K.type;if(void 0!==F&&null!==F&&("uniqueId"!==V||C.AllowLoadingUniqueId)){const a=v;switch(u){case 0:a[V]=F;break;case 1:p&&(a[V]=C._TextureParser(F,p,P));break;case 2:a[V]=L.d.bh(F);break;case 3:a[V]=C._FresnelParametersParser(F);break;case 4:a[V]=t.o.bh(F);break;case 5:a[V]=t.s.bh(F);break;case 6:p&&(a[V]=p.getLastMeshById(F));break;case 7:a[V]=C._ColorCurvesParser(F);break;case 8:a[V]=L.e.bh(F);break;case 9:a[V]=C._ImageProcessingConfigurationParser(F);break;case 10:a[V]=t.i.bh(F);break;case 11:p&&(a[V]=p.getCameraById(F));break;case 12:a[V]=t.e.bh(F)}}}}static Parse(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=a();return b.c&&b.c.AddTagsTo(L,v.tags),C.ParseProperties(v,L,p,P),L}static Clone(a,v){return K(a,v,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(a,v){return K(a,v,!0)}}C.AllowLoadingUniqueId=!1,C._ImageProcessingConfigurationParser=a=>{throw(0,P.c)("ImageProcessingConfiguration")},C._FresnelParametersParser=a=>{throw(0,P.c)("FresnelParameters")},C._ColorCurvesParser=a=>{throw(0,P.c)("ColorCurves")},C._TextureParser=(a,v,p)=>{throw(0,P.c)("Texture")}},10911:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(10905);const b=(a,v,p)=>a?a.getClassName&&"Mesh"===a.getClassName()?null:!a.getClassName||"SubMesh"!==a.getClassName()&&"PhysicsBody"!==a.getClassName()?a.clone?a.clone():Array.isArray(a)?a.slice():p&&"object"===typeof a?{...a}:null:a.clone(v):null;class L{static DeepCopy(a,v,p,L){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const V=function(a){const v=[];do{Object.getOwnPropertyNames(a).forEach((function(a){-1===v.indexOf(a)&&v.push(a)}))}while(a=Object.getPrototypeOf(a));return v}(a);for(const C of V){if("_"===C[0]&&(!L||-1===L.indexOf(C)))continue;if(C.endsWith("Observable"))continue;if(p&&-1!==p.indexOf(C))continue;const V=a[C],F=typeof V;if("function"!==F)try{if("object"===F)if(V instanceof Uint8Array)v[C]=Uint8Array.from(V);else if(V instanceof Array){if(v[C]=[],V.length>0)if("object"==typeof V[0])for(let a=0;a<V.length;a++){const p=b(V[a],v,t);-1===v[C].indexOf(p)&&v[C].push(p)}else v[C]=V.slice(0)}else v[C]=b(V,v,t);else v[C]=V}catch(K){P.d.Warn(K.message)}}}}},10926:(a,v,p)=>{"use strict";p.d(v,{c:()=>b});const P={};function b(a){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!P[a])return P[a]=!0,`${a} needs to be imported before as it contains a side-effect required by your code.`}},10896:(a,v,p)=>{"use strict";function P(){return"undefined"!==typeof window}function b(){return"undefined"!==typeof navigator}function L(){return"undefined"!==typeof document}function t(a){let v="",p=a.firstChild;for(;p;)3===p.nodeType&&(v+=p.textContent),p=p.nextSibling;return v}p.d(v,{d:()=>t,g:()=>L,k:()=>b,n:()=>P})},12469:(a,v,p)=>{"use strict";p.r(v),p.d(v,{Dispose:()=>c,DumpData:()=>u,DumpDataAsync:()=>F,DumpFramebuffer:()=>C,DumpTools:()=>f});var P=p(11764),b=p(10889),L=p(11263),t=p(10939);let V,K=null;async function C(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0;const V=await p.readPixels(0,0,a,v);u(a,v,new Uint8Array(V.buffer),P,b,L,!0,void 0,t)}function F(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0;return new Promise((K=>{u(a,v,p,(a=>K(a)),P,b,L,t,V)}))}function u(a,v,C,F){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return K||(K=new Promise(((a,v)=>{let b,L=null;const K={Bh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(p.bind(p,11656)).then((C=>{let{ThinEngine:F}=C;try{b=new OffscreenCanvas(100,100),L=new F(b,!1,K)}catch(f){b=document.createElement("canvas"),L=new F(b,!1,K)}t.b.Instances.pop(),t.b.OnEnginesDisposedObservable.add((a=>{L&&a!==L&&!L.u&&0===t.b.Instances.length&&c()})),L.getCaps().parallelShaderCompile=void 0;const u=new P.b(L);p.e(34).then(p.bind(p,13637)).then((p=>{let{passPixelShader:t}=p;if(!L)return void v("Engine is not defined");const K=new P.e({Id:L,name:t.name,fragmentShader:t.shader,samplerNames:["textureSampler"]});V={canvas:b,Id:L,renderer:u,wrapper:K},a(V)}))})).catch(v)}))),await K})().then((p=>{if(p.Id.setSize(a,v,!0),C instanceof Float32Array){const a=new Uint8Array(C.length);let v=C.length;for(;v--;){const p=C[v];a[v]=Math.round(255*(0,L.e)(p))}C=a}const P=p.Id.createRawTexture(C,a,v,5,!1,!H,1);p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",P),p.renderer.draw(),A?b.e.ToBlob(p.canvas,(a=>{const v=new FileReader;v.onload=a=>{const v=a.target.result;F&&F(v)},v.readAsArrayBuffer(a)}),u,h):b.e.EncodeScreenshotCanvasData(p.canvas,F,u,f,h),P.dispose()}))}function c(){var a;V?(V.wrapper.dispose(),V.renderer.dispose(),V.Id.dispose()):null===(a=K)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.Id.dispose()}));K=null,V=null}const f={DumpData:u,DumpDataAsync:F,DumpFramebuffer:C,Dispose:c};b.e.DumpData=u,b.e.DumpDataAsync=F,b.e.DumpFramebuffer=C},12464:(a,v,p)=>{"use strict";p.d(v,{c:()=>H,f:()=>R,j:()=>s,k:()=>D});var P=p(10889),b=p(11240),L=p(11263),t=p(11714),V=p(11005),K=p(11463),C=(p(11229),p(11757)),F=p(10905);p(12425),p(12437),p(12469);const u="image/png",c=2,f=[134,22,135,150,246,214,150,54];function H(a){const v=new DataView(a.buffer,a.byteOffset,a.byteLength);let p=0;for(let t=0;t<f.length;t++)if(v.getUint8(p++)!==f[t])return F.d.Error("Not a babylon environment map"),null;let P="",b=0;for(;b=v.getUint8(p++);)P+=String.fromCharCode(b);let L=JSON.parse(P);return L=A(L),L.Gh&&(L.Gh.specularDataPosition=p,L.Gh.lodGenerationScale=L.Gh.lodGenerationScale||.8),L}function A(a){if(a.version>c)throw new Error(`Unsupported babylon environment map version "${a.version}". Latest supported version is "${c}".`);return 2===a.version?a:a={...a,version:2,imageType:u}}function h(a,v){const p=(v=A(v)).Gh;let P=Math.log2(v.width);if(P=Math.round(P)+1,p.mipmaps.length!==6*P)throw new Error(`Unsupported specular mipmaps number "${p.mipmaps.length}"`);const b=new Array(P);for(let L=0;L<P;L++){b[L]=new Array(6);for(let v=0;v<6;v++){const P=p.mipmaps[6*L+v];b[L][v]=new Uint8Array(a.buffer,a.byteOffset+p.specularDataPosition+P.position,P.length)}}return b}function R(a,v,p){const P=(p=A(p)).Gh;if(!P)return Promise.resolve();a._lodGenerationScale=P.lodGenerationScale;return Q(a,h(v,p),p.imageType)}function X(a,v,p,P,b,L,t,V,K,C,F){return new Promise(((u,c)=>{if(p){const p=v.createTexture(null,!0,!0,null,1,null,(a=>{c(a)}),a);null===P||void 0===P||P.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{P.externalTextureSamplerBinding=!0,P.onApply=P=>{P._bindTexture("textureSampler",p),P.setFloat2("scale",1,v._features.needsInvertingBitmap&&a instanceof ImageBitmap?-1:1)},v.scenes.length&&(v.scenes[0].postProcessManager.directRender([P],C,!0,L,t),v.restoreDefaultFramebuffer(),p.dispose(),URL.revokeObjectURL(b),u())}))}))}else{if(v._uploadImageToTexture(F,a,L,t),V){const p=K[t];p&&v._uploadImageToTexture(p._texture,a,L,0)}u()}}))}async function Q(a,v){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u;if(!P.e.IsExponentOfTwo(a.width))throw new Error("Texture size must be a power of two");const t=(0,L.k)(a.width)+1,F=a.getEngine();let c=!1,f=!1,H=null,A=null,h=null;const R=F.getCaps();a.format=5,a.type=0,a.generateMipMaps=!0,a._cachedAnisotropicFilteringLevel=null,F.updateTextureSamplingMode(3,a),R.textureLOD?F._features.supportRenderAndCopyToLodForFloatTextures?R.textureHalfFloatRender&&R.textureHalfFloatLinearFiltering?(c=!0,a.type=2):R.textureFloatRender&&R.textureFloatLinearFiltering&&(c=!0,a.type=1):c=!1:(c=!1,f=!0,h={});let Q=0;if(c)F.isWebGPU?(Q=1,await p.e(39).then(p.bind(p,13664))):await p.e(41).then(p.bind(p,13676)),H=new C.e("rgbdDecode","rgbdDecode",null,null,1,null,3,F,!1,void 0,a.type,void 0,null,!1,void 0,Q),a._isRGBD=!1,a.invertY=!1,A=F.createRenderTargetCubeTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:a.type,format:5});else if(a._isRGBD=!0,a.invertY=!0,f){const v=3,p=a._lodGenerationScale,P=a._lodGenerationOffset;for(let b=0;b<v;b++){const L=(t-1)*p+P,C=P+(L-P)*(1-b/(v-1)),u=Math.round(Math.min(Math.max(C,0),L)),c=new V.d(F,2);c.isCube=!0,c.invertY=!0,c.generateMipMaps=!1,F.updateTextureSamplingMode(2,c);const f=new K.b(null);switch(f._isCube=!0,f._texture=c,h[u]=f,b){case 0:a._lodTextureLow=f;break;case 1:a._lodTextureMid=f;break;case 2:a._lodTextureHigh=f}}}const s=[];for(let p=0;p<v.length;p++)for(let P=0;P<6;P++){const L=v[p][P],t=new Blob([L],{type:b}),V=URL.createObjectURL(t);let K;if(F._features.forceBitmapOverHTMLImageElement)K=F.createImageBitmap(t,{premultiplyAlpha:"none"}).then((v=>X(v,F,c,H,V,P,p,f,h,A,a)));else{const v=new Image;v.src=V,K=new Promise(((b,L)=>{v.onload=()=>{X(v,F,c,H,V,P,p,f,h,A,a).then((()=>b())).catch((a=>{L(a)}))},v.onerror=a=>{L(a)}}))}s.push(K)}if(v.length<t){let p;const P=Math.pow(2,t-1-v.length),b=P*P*4;switch(a.type){case 0:p=new Uint8Array(b);break;case 2:p=new Uint16Array(b);break;case 1:p=new Float32Array(b)}for(let L=v.length;L<t;L++)for(let v=0;v<6;v++)F._uploadArrayBufferViewToTexture(a,p,v,L)}return Promise.all(s).then((()=>{A&&(F._releaseTexture(a),A._swapAndDie(a)),H&&H.dispose(),f&&(a._lodTextureHigh&&a._lodTextureHigh._texture&&(a._lodTextureHigh._texture.isReady=!0),a._lodTextureMid&&a._lodTextureMid._texture&&(a._lodTextureMid._texture.isReady=!0),a._lodTextureLow&&a._lodTextureLow._texture&&(a._lodTextureLow._texture.isReady=!0))}))}function s(a,v){const p=(v=A(v)).irradiance;if(!p)return;const P=new t.f;b.s.FromArrayToRef(p.x,0,P.x),b.s.FromArrayToRef(p.y,0,P.y),b.s.FromArrayToRef(p.z,0,P.z),b.s.FromArrayToRef(p.xx,0,P.xx),b.s.FromArrayToRef(p.yy,0,P.yy),b.s.FromArrayToRef(p.zz,0,P.zz),b.s.FromArrayToRef(p.yz,0,P.yz),b.s.FromArrayToRef(p.zx,0,P.zx),b.s.FromArrayToRef(p.xy,0,P.xy),a._sphericalPolynomial=P}function D(a,v,p,P,b){const L=Q(a.getEngine().createRawCubeTexture(null,a.width,a.format,a.type,a.generateMipMaps,a.invertY,a.samplingMode,a._compression),v).then((()=>a));return a.onRebuildCallback=a=>({proxy:L,isReady:!0,isAsync:!0}),a._source=13,a._bufferViewArrayArray=v,a._lodGenerationScale=P,a._lodGenerationOffset=b,a._sphericalPolynomial=p,Q(a,v).then((()=>(a.isReady=!0,a)))}},10955:(a,v,p)=>{"use strict";p.d(v,{b:()=>P,e:()=>b,g:()=>L});class P extends Error{}P._setPrototypeOf=Object.setPrototypeOf||((a,v)=>(a.__proto__=v,a));const b={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class L extends P{constructor(a,v,p){super(a),this.errorCode=v,this.innerError=p,this.name="RuntimeError",P._setPrototypeOf(this,L.prototype)}}},10947:(a,v,p)=>{"use strict";p.d(v,{e:()=>j,g:()=>Q,k:()=>q,p:()=>M,l:()=>h,q:()=>y,r:()=>Z,u:()=>S,x:()=>s});var P=p(10933),b=p(10896),L=p(10893);class t{}t.FilesToLoad={};var V=p(10955),K=p(10959),C=p(10961),F=p(10939),u=p(10905),c=p(10968),f=p(10964),H=p(10974);const A=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class h extends V.g{constructor(a,v){super(a,V.e.LoadFileError),this.name="LoadFileError",V.b._setPrototypeOf(this,h.prototype),v instanceof P.b?this.request=v:this.file=v}}class R extends V.g{constructor(a,v){super(a,V.e.RequestFileError),this.request=v,this.name="RequestFileError",V.b._setPrototypeOf(this,R.prototype)}}class X extends V.g{constructor(a,v){super(a,V.e.ReadFileError),this.file=v,this.name="ReadFileError",V.b._setPrototypeOf(this,X.prototype)}}const Q={DefaultRetryStrategy:class{static ExponentialBackoff(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(p,P,b)=>0!==P.status||b>=a||-1!==p.indexOf("file:")?-1:Math.pow(2,b)*v}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:a=>a,ScriptBaseUrl:"",ScriptPreprocessUrl:a=>a,CleanUrl:a=>a=a.replace(/#/gm,"%23")},s=(a,v)=>{if((!a||0!==a.indexOf("data:"))&&Q.CorsBehavior)if("string"===typeof Q.CorsBehavior||Q.CorsBehavior instanceof String)v.crossOrigin=Q.CorsBehavior;else{const p=Q.CorsBehavior(a);p&&(v.crossOrigin=p)}},D={getRequiredSize:null},y=function(a,v,p,b){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",V=arguments.length>5?arguments[5]:void 0;const C=F.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===C||void 0===C||!C._features.forceBitmapOverHTMLImageElement))return p("LoadImage is only supported in web or BabylonNative environments."),null;let u,c=!1;a instanceof ArrayBuffer||ArrayBuffer.isView(a)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(u=URL.createObjectURL(new Blob([a],{type:L})),c=!0):u=`data:${L};base64,`+(0,K.n)(a):a instanceof Blob?(u=URL.createObjectURL(a),c=!0):(u=Q.CleanUrl(a),u=Q.PreprocessUrl(u));const f=v=>{if(p){const P=u||a.toString();p(`Error while trying to load image: ${0===P.indexOf("http")||P.length<=128?P:P.slice(0,128)+"..."}`,v)}};if(null!==C&&void 0!==C&&C._features.forceBitmapOverHTMLImageElement)return M(u,(P=>{C.createImageBitmap(new Blob([P],{type:L}),{premultiplyAlpha:"none",...V}).then((a=>{v(a),c&&URL.revokeObjectURL(u)})).catch((v=>{p&&p("Error while trying to load image: "+a,v)}))}),void 0,b||void 0,!0,((a,v)=>{f(v)})),null;const H=new Image;if(D.getRequiredSize){const v=D.getRequiredSize(a);v.width&&(H.width=v.width),v.height&&(H.height=v.height)}s(u,H);const A=[],h=()=>{A.forEach((a=>{a.target.removeEventListener(a.name,a.handler)})),A.length=0};A.push({target:H,name:"load",handler:()=>{h(),v(H),c&&H.src&&URL.revokeObjectURL(H.src)}}),A.push({target:H,name:"error",handler:a=>{h(),f(a),c&&H.src&&URL.revokeObjectURL(H.src)}}),A.push({target:document,name:"securitypolicyviolation",handler:a=>{if(a.blockedURI!==H.src||"vm"===a.disposition)return;h();const v=new Error(`CSP violation of policy ${a.effectiveDirective} ${a.blockedURI}. Current policy is ${a.originalPolicy}`);F.b.UseFallbackTexture=!1,f(v),c&&H.src&&URL.revokeObjectURL(H.src),H.src=""}}),A.forEach((a=>{a.target.addEventListener(a.name,a.handler)}));const R="blob:"===u.substring(0,5),X="data:"===u.substring(0,5),y=()=>{R||X||!P.b.IsCustomRequestAvailable?H.src=u:M(u,((a,v,p)=>{const P=new Blob([a],{type:!L&&p?p:L}),b=URL.createObjectURL(P);c=!0,H.src=b}),void 0,b||void 0,!0,((a,v)=>{f(v)}))},Z=()=>{b&&b.loadImage(u,H)};if(!R&&!X&&b&&b.enableTexturesOffline)b.open(Z,y);else{if(-1!==u.indexOf("file:")){const a=decodeURIComponent(u.substring(5).toLowerCase());if(t.FilesToLoad[a]&&"undefined"!==typeof URL){try{let v;try{v=URL.createObjectURL(t.FilesToLoad[a])}catch(S){v=URL.createObjectURL(t.FilesToLoad[a])}H.src=v,c=!0}catch(n){H.src=""}return H}}y()}return H},Z=(a,v,p,P,b)=>{const t=new FileReader,V={onCompleteObservable:new L.c,abort:()=>t.abort()};return t.onloadend=()=>V.onCompleteObservable.notifyObservers(V),b&&(t.onerror=()=>{b(new X(`Unable to read ${a.name}`,a))}),t.onload=a=>{v(a.target.result)},p&&(t.onprogress=p),P?t.readAsArrayBuffer(a):t.readAsText(a),V},M=(a,v,p,P,b,K,C)=>{if(a.name)return Z(a,v,p,b,K?a=>{K(void 0,a)}:void 0);const F=a;if(-1!==F.indexOf("file:")){let a=decodeURIComponent(F.substring(5).toLowerCase());0===a.indexOf("./")&&(a=a.substring(2));const P=t.FilesToLoad[a];if(P)return Z(P,v,p,b,K?a=>K(void 0,new h(a.message,a.file)):void 0)}const{match:f,type:H}=T(F);if(f){const a={onCompleteObservable:new L.c,abort:()=>()=>{}};try{const a=b?j(F):w(F);v(a,void 0,H)}catch(V){K?K(void 0,V):u.d.Error(V.message||"Failed to parse the Data URL")}return c.b.SetImmediate((()=>{a.onCompleteObservable.notifyObservers(a)})),a}return S(F,((a,p)=>{v(a,null===p||void 0===p?void 0:p.responseURL,null===p||void 0===p?void 0:p.getResponseHeader("content-type"))}),p,P,b,K?a=>{K(a.request,new h(a.message,a.request))}:void 0,C)},S=(a,v,p,t,V,K,C)=>{a=Q.CleanUrl(a),a=Q.PreprocessUrl(a);const F=Q.BaseUrl+a;let c=!1;const f={onCompleteObservable:new L.c,abort:()=>c=!0},H=()=>{let a,L=new P.b,t=null;const H=()=>{L&&(p&&L.removeEventListener("progress",p),a&&L.removeEventListener("readystatechange",a),L.removeEventListener("loadend",A))};let A=()=>{H(),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear(),p=void 0,a=null,A=null,K=void 0,C=void 0,v=void 0};f.abort=()=>{c=!0,A&&A(),L&&L.readyState!==(XMLHttpRequest.DONE||4)&&L.abort(),null!==t&&(clearTimeout(t),t=null),L=null};const h=a=>{const v=a.message||"Unknown error";K&&L?K(new R(v,L)):u.d.Error(v)},X=u=>{if(L){if(L.open("GET",F),C)try{C(L)}catch(f){return void h(f)}V&&(L.responseType="arraybuffer"),p&&L.addEventListener("progress",p),A&&L.addEventListener("loadend",A),a=()=>{if(!c&&L&&L.readyState===(XMLHttpRequest.DONE||4)){if(a&&L.removeEventListener("readystatechange",a),L.status>=200&&L.status<300||0===L.status&&(!(0,b.n)()||n())){try{v&&v(V?L.response:L.responseText,L)}catch(f){h(f)}return}const p=Q.DefaultRetryStrategy;if(p){const a=p(F,L,u);if(-1!==a)return H(),L=new P.b,void(t=setTimeout((()=>X(u+1)),a))}const C=new R("Error status: "+L.status+" "+L.statusText+" - Unable to load "+F,L);K&&K(C)}},L.addEventListener("readystatechange",a),L.send()}};X(0)};if(t&&t.enableSceneOffline){const P=a=>{a&&a.status>400?K&&K(a):H()},b=()=>{t&&t.loadFile(Q.BaseUrl+a,(a=>{!c&&v&&v(a),f.onCompleteObservable.notifyObservers(f)}),p?a=>{!c&&p&&p(a)}:void 0,P,V)};t.open(b,P)}else H();return f},n=()=>"undefined"!==typeof location&&"file:"===location.protocol,q=a=>A.test(a),T=a=>{const v=A.exec(a);if(null===v||0===v.length)return{match:!1,type:""};return{match:!0,type:v[0].replace("data:","").replace("base64,","")}};function j(a){return(0,K.c)(a.split(",")[1])}const w=a=>(0,K.g)(a.split(",")[1]);let J;H.e._FileToolsLoadImage=y,f.c.loadFile=M,C.j.loadFile=M;((a,v,p,P,b,L,t,V,K,C)=>{J={DecodeBase64UrlToBinary:a,DecodeBase64UrlToString:v,DefaultRetryStrategy:p.DefaultRetryStrategy,BaseUrl:p.BaseUrl,CorsBehavior:p.CorsBehavior,PreprocessUrl:p.PreprocessUrl,IsBase64DataUrl:P,IsFileURL:b,LoadFile:L,LoadImage:t,ReadFile:V,RequestFile:K,SetCorsBehavior:C},Object.defineProperty(J,"DefaultRetryStrategy",{get:function(){return p.DefaultRetryStrategy},set:function(a){p.DefaultRetryStrategy=a}}),Object.defineProperty(J,"BaseUrl",{get:function(){return p.BaseUrl},set:function(a){p.BaseUrl=a}}),Object.defineProperty(J,"PreprocessUrl",{get:function(){return p.PreprocessUrl},set:function(a){p.PreprocessUrl=a}}),Object.defineProperty(J,"CorsBehavior",{get:function(){return p.CorsBehavior},set:function(a){p.CorsBehavior=a}})})(j,w,Q,q,n,M,y,Z,S,s)},11032:(a,v,p)=>{"use strict";function P(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(a=>{const v=16*Math.random()|0;return("x"===a?v:3&v|8).toString(16)}))}p.d(v,{b:()=>P})},11025:(a,v,p)=>{"use strict";p.d(v,{e:()=>L});var P=p(10905),b=p(11027);class L{static Instantiate(a){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[a])return this.RegisteredExternalClasses[a];const v=(0,b.c)(a);if(v)return v;P.d.Warn(a+" not found, you may have missed an import.");const p=a.split(".");let L=window||this;for(let P=0,b=p.length;P<b;P++)L=L[p[P]];return"function"!==typeof L?null:L}}L.RegisteredExternalClasses={}},10905:(a,v,p)=>{"use strict";p.d(v,{d:()=>P});class P{static _CheckLimit(a,v){let p=P._LogLimitOutputs[a];return p?p.current++:(p={limit:v,current:1},P._LogLimitOutputs[a]=p),p.current<=p.limit}static _GenerateLimitMessage(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const p=P._LogLimitOutputs[a];if(!p||!P.MessageLimitReached)return;const b=this._Levels[v];p.current===p.limit&&P[b.name](P.MessageLimitReached.replace(/%LIMIT%/g,""+p.limit).replace(/%TYPE%/g,b.name??""))}static _AddLogEntry(a){P._LogCache=a+P._LogCache,P.OnNewCacheEntry&&P.OnNewCacheEntry(a)}static _FormatMessage(a){const v=a=>a<10?"0"+a:""+a,p=new Date;return"["+v(p.getHours())+":"+v(p.getMinutes())+":"+v(p.getSeconds())+"]: "+a}static _LogDisabled(a,v){}static _LogEnabled(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;const b=Array.isArray(v)?v[0]:v;if(void 0!==p&&!P._CheckLimit(b,p))return;const L=P._FormatMessage(b),t=this._Levels[a],V=Array.isArray(v)?v.slice(1):[];t.logFunc&&t.logFunc("BJS - "+L,...V);const K=`<div style='color:${t.color}'>${L}</div><br>`;P._AddLogEntry(K),P._GenerateLimitMessage(b,a)}static get LogCache(){return P._LogCache}static ClearLogCache(){P._LogCache="",P._LogLimitOutputs={},P.errorsCount=0}static set LogLevels(a){P.Log=P._LogDisabled,P.Warn=P._LogDisabled,P.Error=P._LogDisabled,[P.MessageLogLevel,P.WarningLogLevel,P.ErrorLogLevel].forEach((v=>{if((a&v)===v){const a=this._Levels[v];P[a.name]=P._LogEnabled.bind(P,v)}}))}}P.NoneLogLevel=0,P.MessageLogLevel=1,P.WarningLogLevel=2,P.ErrorLogLevel=4,P.AllLogLevel=7,P.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",P._LogCache="",P._LogLimitOutputs={},P._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],P.errorsCount=0,P.Log=P._LogEnabled.bind(P,P.MessageLogLevel),P.Warn=P._LogEnabled.bind(P,P.WarningLogLevel),P.Error=P._LogEnabled.bind(P,P.ErrorLogLevel)},10893:(a,v,p)=>{"use strict";p.d(v,{c:()=>L});class P{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0;this.initialize(a,v,p,P)}initialize(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0;return this.mask=a,this.skipNextObservers=v,this.target=p,this.currentTarget=P,this}}class b{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=a,this.mask=v,this.scope=p,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class L{static FromPromise(a,v){const p=new L;return a.then((a=>{p.notifyObservers(a)})).catch((a=>{if(!v)throw a;v.notifyObservers(a)})),p}get observers(){return this._observers}constructor(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=v,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new P(0),a&&(this._onObserverAdded=a)}add(a){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!a)return null;const P=new b(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return P.unregisterOnNextCall=p,v?this._observers.unshift(P):this._observers.push(P),this._onObserverAdded&&this._onObserverAdded(P),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(P,this._lastNotifiedValue),P._remove=()=>{this.remove(P)},P}addOnce(a){return this.add(a,void 0,void 0,void 0,!0)}remove(a){if(!a)return!1;a._remove=null;return-1!==this._observers.indexOf(a)&&(this._deferUnregister(a),!0)}removeCallback(a,v){for(let p=0;p<this._observers.length;p++){const P=this._observers[p];if(!P._willBeUnregistered&&(P.callback===a&&(!v||v===P.scope)))return this._deferUnregister(P),!0}return!1}_deferUnregister(a){a._willBeUnregistered||(this._numObserversMarkedAsDeleted++,a.unregisterOnNextCall=!1,a._willBeUnregistered=!0,setTimeout((()=>{this._remove(a)}),0))}_remove(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!a)return!1;const p=this._observers.indexOf(a);return-1!==p&&(v&&this._numObserversMarkedAsDeleted--,this._observers.splice(p,1),!0)}makeObserverTopPriority(a){this._remove(a,!1),this._observers.unshift(a)}makeObserverBottomPriority(a){this._remove(a,!1),this._observers.push(a)}notifyObservers(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),!this._observers.length)return!0;const L=this._eventState;L.mask=v,L.target=p,L.currentTarget=P,L.skipNextObservers=!1,L.lastReturnValue=a,L.userInfo=b;for(const t of this._observers)if(!t._willBeUnregistered&&(t.mask&v&&(t.unregisterOnNextCall&&this._deferUnregister(t),t.scope?L.lastReturnValue=t.callback.apply(t.scope,[a,L]):L.lastReturnValue=t.callback(a,L)),L.skipNextObservers))return!1;return!0}notifyObserver(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=v),a._willBeUnregistered)return;const P=this._eventState;P.mask=p,P.skipNextObservers=!1,a.unregisterOnNextCall&&this._deferUnregister(a),a.callback(v,P)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const a=this._observers.pop();a&&(a._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const a=new L;return a._observers=this._observers.slice(0),a}hasSpecificMask(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const v of this._observers)if(v.mask&a||v.mask===a)return!0;return!1}}},11042:(a,v,p)=>{"use strict";p.d(v,{c:()=>b});var P=p(10920);class b{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(a,v){b.Enabled&&(this._current+=a,v&&this._fetchResult())}beginMonitoring(){b.Enabled&&(this._startMonitoringTime=P.b.Now)}endMonitoring(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!b.Enabled)return;a&&this.fetchNewFrame();const v=P.b.Now;this._current=v-this._startMonitoringTime,a&&this._fetchResult()}qj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const a=P.b.Now;a-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=a,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}b.Enabled=!0},10920:(a,v,p)=>{"use strict";p.d(v,{b:()=>b});var P=p(10896);class b{static get Now(){return(0,P.n)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12425:(a,v,p)=>{"use strict";p.d(v,{b:()=>L});var P=p(11757),b=p(11747);class L{static ExpandRGBDTexture(a){const v=a._texture;if(!v||!a.isRGBD)return;const b=v.getEngine(),L=b.getCaps(),t=v.isReady;let V=!1;L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering?(V=!0,v.type=2):L.textureFloatRender&&L.textureFloatLinearFiltering&&(V=!0,v.type=1),V&&(v.isReady=!1,v._isRGBD=!1,v.invertY=!1);const K=async()=>{const L=b.isWebGPU,t=L?1:0;v.isReady=!1,L?await Promise.all([p.e(39).then(p.bind(p,13664)),p.e(40).then(p.bind(p,13672))]):await Promise.all([p.e(41).then(p.bind(p,13676)),p.e(42).then(p.bind(p,13682))]);const V=new P.e("rgbdDecode","rgbdDecode",null,null,1,null,3,b,!1,void 0,v.type,void 0,null,!1,void 0,t);V.externalTextureSamplerBinding=!0;const K=b.createRenderTargetTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:v.samplingMode,type:v.type,format:5});V.onEffectCreatedObservable.addOnce((p=>{p.executeWhenCompiled((()=>{V.onApply=a=>{a._bindTexture("textureSampler",v),a.setFloat2("scale",1,1)},a.va().postProcessManager.directRender([V],K,!0),b.restoreDefaultFramebuffer(),b._releaseTexture(v),V&&V.dispose(),K._swapAndDie(v),v.isReady=!0}))}))};V&&(t?K():a.onLoadObservable.addOnce(K))}static EncodeTextureToRGBD(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,b.b)("rgbdEncode",a,v,p,1,5)}}},11223:(a,v,p)=>{"use strict";p.d(v,{c:()=>b,e:()=>P});class P{constructor(a){this.length=0,this.data=new Array(a),this._id=P._GlobalId++}push(a){this.data[this.length++]=a,this.length>this.data.length&&(this.data.length*=2)}forEach(a){for(let v=0;v<this.length;v++)a(this.data[v])}sort(a){this.data.sort(a)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let v=0;v<a.length;v++)this.data[this.length++]=(a.data||a)[v]}}indexOf(a){const v=this.data.indexOf(a);return v>=this.length?-1:v}contains(a){return-1!==this.indexOf(a)}}P._GlobalId=0;class b extends P{constructor(){super(...arguments),this._duplicateId=0}push(a){super.push(a),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(a){return(!a.__smartArrayFlags||a.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(a),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let v=0;v<a.length;v++){const p=(a.data||a)[v];this.pushNoDuplicate(p)}}}}},10959:(a,v,p)=>{"use strict";p.d(v,{c:()=>t,g:()=>L,j:()=>P,n:()=>b});const P=a=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(a);let v="";for(let p=0;p<a.byteLength;p++)v+=String.fromCharCode(a[p]);return v},b=a=>{const v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let p,P,b,L,t,V,K,C="",F=0;const u=ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a);for(;F<u.length;)p=u[F++],P=F<u.length?u[F++]:Number.NaN,b=F<u.length?u[F++]:Number.NaN,L=p>>2,t=(3&p)<<4|P>>4,V=(15&P)<<2|b>>6,K=63&b,isNaN(P)?V=K=64:isNaN(b)&&(K=64),C+=v.charAt(L)+v.charAt(t)+v.charAt(V)+v.charAt(K);return C},L=a=>atob(a),t=a=>{const v=L(a),p=v.length,P=new Uint8Array(new ArrayBuffer(p));for(let b=0;b<p;b++)P[b]=v.charCodeAt(b);return P.buffer}},11234:(a,v,p)=>{"use strict";p.d(v,{c:()=>b});class P{static Eval(a,v){return"true"===(a=a.match(/\([^()]*\)/g)?a.replace(/\([^()]*\)/g,(a=>(a=a.slice(1,a.length-1),P._HandleParenthesisContent(a,v)))):P._HandleParenthesisContent(a,v))||"false"!==a&&P.Eval(a,v)}static _HandleParenthesisContent(a,v){let p;v=v||(a=>"true"===a);const b=a.split("||");for(const L in b)if(Object.prototype.hasOwnProperty.call(b,L)){let a=P._SimplifyNegation(b[L].trim());const t=a.split("&&");if(t.length>1)for(let b=0;b<t.length;++b){const L=P._SimplifyNegation(t[b].trim());if(p="true"!==L&&"false"!==L?"!"===L[0]?!v(L.substring(1)):v(L):"true"===L,!p){a="false";break}}if(p||"true"===a){p=!0;break}p="true"!==a&&"false"!==a?"!"===a[0]?!v(a.substring(1)):v(a):"true"===a}return p?"true":"false"}static _SimplifyNegation(a){return"!true"===(a=(a=a.replace(/^[\s!]+/,(a=>(a=a.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?a="false":"!false"===a&&(a="true"),a}}class b{static EnableFor(a){a._tags=a._tags||{},a.hasTags=()=>b.HasTags(a),a.addTags=v=>b.AddTagsTo(a,v),a.removeTags=v=>b.RemoveTagsFrom(a,v),a.matchesTagsQuery=v=>b.MatchesQuery(a,v)}static DisableFor(a){delete a._tags,delete a.hasTags,delete a.addTags,delete a.removeTags,delete a.matchesTagsQuery}static HasTags(a){if(!a._tags)return!1;const v=a._tags;for(const p in v)if(Object.prototype.hasOwnProperty.call(v,p))return!0;return!1}static GetTags(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!a._tags)return null;if(v){const v=[];for(const p in a._tags)Object.prototype.hasOwnProperty.call(a._tags,p)&&!0===a._tags[p]&&v.push(p);return v.join(" ")}return a._tags}static AddTagsTo(a,v){if(!v)return;if("string"!==typeof v)return;v.split(" ").forEach((function(v){b._AddTagTo(a,v)}))}static _AddTagTo(a,v){""!==(v=v.trim())&&"true"!==v&&"false"!==v&&(v.match(/[\s]/)||v.match(/^([!]|([|]|[&]){2})/)||(b.EnableFor(a),a._tags[v]=!0))}static RemoveTagsFrom(a,v){if(!b.HasTags(a))return;const p=v.split(" ");for(const P in p)b._RemoveTagFrom(a,p[P])}static _RemoveTagFrom(a,v){delete a._tags[v]}static MatchesQuery(a,v){return void 0===v||(""===v?b.HasTags(a):P.Eval(v,(v=>b.HasTags(a)&&a._tags[v])))}}},11747:(a,v,p)=>{"use strict";p.d(v,{b:()=>K,f:()=>c,g:()=>u});p(11460),p(11751);var P=p(11757),b=p(10974),L=p(11027),t=p(11287);class V extends P.e{getClassName(){return"PassPostProcess"}constructor(a,v){super(a,"pass",null,null,v,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(a,v){a?(this._webGPUReady=!0,v.push(Promise.all([p.e(33).then(p.bind(p,13629))]))):v.push(Promise.all([p.e(34).then(p.bind(p,13637))])),super._gatherImports(a,v)}static _Parse(a,v,p,P){return t.b.Parse((()=>new V(a.name,a.options,v,a.renderTargetSamplingMode,a._engine,a.reusable)),a,p,P)}}(0,L.f)("BABYLON.PassPostProcess",V);P.e;function K(a,v,p,b,L,t,V,K){const C=v.getEngine();return v.isReady=!1,L=L??v.samplingMode,b=b??v.type,t=t??v.format,V=V??v.width,K=K??v.height,-1===b&&(b=0),new Promise((F=>{const u=new P.e("postprocess",a,null,null,1,null,L,C,!1,void 0,b,void 0,null,!1,t);u.externalTextureSamplerBinding=!0;const c=C.createRenderTargetTexture({width:V,height:K},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:L,type:b,format:t});u.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{u.onApply=a=>{a._bindTexture("textureSampler",v),a.setFloat2("scale",1,1)},p.postProcessManager.directRender([u],c,!0),C.restoreDefaultFramebuffer(),C._releaseTexture(v),u&&u.dispose(),c._swapAndDie(v),v.type=b,v.format=5,v.isReady=!0,F(v)}))}))}))}let C,F;function u(a){C||(C=new Float32Array(1),F=new Int32Array(C.buffer)),C[0]=a;const v=F[0];let p=v>>16&32768,P=v>>12&2047;const b=v>>23&255;return b<103?p:b>142?(p|=31744,p|=(255==b?0:1)&&8388607&v,p):b<113?(P|=2048,p|=(P>>114-b)+(P>>113-b&1),p):(p|=b-112<<10|P>>1,p+=1&P,p)}function c(a){const v=(32768&a)>>15,p=(31744&a)>>10,P=1023&a;return 0===p?(v?-1:1)*Math.pow(2,-14)*(P/Math.pow(2,10)):31==p?P?NaN:1/0*(v?-1:1):(v?-1:1)*Math.pow(2,p-15)*(1+P/Math.pow(2,10))}b.e._RescalePostProcessFactory=a=>new V("rescale",1,null,2,a,!1,0)},10968:(a,v,p)=>{"use strict";p.d(v,{b:()=>b});var P=p(10896);class b{static SetImmediate(a){(0,P.n)()&&window.setImmediate?window.setImmediate(a):setTimeout(a,1)}}},11037:(a,v,p)=>{"use strict";function P(a){let v=1;do{v*=2}while(v<a);return v===a}function b(a,v,p){return a*(1-p)+v*p}function L(a){const v=t(a),p=V(a);return v-a>a-p?p:v}function t(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,++a}function V(a){return a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,(a|=a>>16)-(a>>1)}function K(a,v){let p;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:p=V(a);break;case 2:p=L(a);break;default:p=t(a)}return Math.min(p,v)}p.d(v,{e:()=>V,i:()=>K,l:()=>P,m:()=>b,q:()=>L})},10889:(a,v,p)=>{"use strict";p.d(v,{b:()=>R,e:()=>h});var P=p(10893),b=p(10896),L=p(10905),t=p(10911),V=p(10920),K=p(10926),C=p(10933),F=p(10939),u=p(10947),c=p(10968),f=p(11025),H=p(11032),A=p(11037);class h{static get BaseUrl(){return u.g.BaseUrl}static set BaseUrl(a){u.g.BaseUrl=a}static get CleanUrl(){return u.g.CleanUrl}static set CleanUrl(a){u.g.CleanUrl=a}static IsAbsoluteUrl(a){return 0===a.indexOf("//")||-1!==a.indexOf("://")&&(-1!==a.indexOf(".")&&(-1!==a.indexOf("/")&&(!(a.indexOf(":")>a.indexOf("/"))&&(a.indexOf("://")<a.indexOf(".")||(0===a.indexOf("data:")||0===a.indexOf("blob:"))))))}static set ScriptBaseUrl(a){u.g.ScriptBaseUrl=a}static get ScriptBaseUrl(){return u.g.ScriptBaseUrl}static set ScriptPreprocessUrl(a){u.g.ScriptPreprocessUrl=a}static get ScriptPreprocessUrl(){return u.g.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.g.DefaultRetryStrategy}static set DefaultRetryStrategy(a){u.g.DefaultRetryStrategy=a}static get CorsBehavior(){return u.g.CorsBehavior}static set CorsBehavior(a){u.g.CorsBehavior=a}static get UseFallbackTexture(){return F.b.UseFallbackTexture}static set UseFallbackTexture(a){F.b.UseFallbackTexture=a}static get RegisteredExternalClasses(){return f.e.RegisteredExternalClasses}static set RegisteredExternalClasses(a){f.e.RegisteredExternalClasses=a}static get fallbackTexture(){return F.b.FallbackTexture}static set fallbackTexture(a){F.b.FallbackTexture=a}static FetchToRef(a,v,p,P,b,L){const t=4*((Math.abs(a)*p%p|0)+(Math.abs(v)*P%P|0)*p);L.r=b[t]/255,L.g=b[t+1]/255,L.b=b[t+2]/255,L.a=b[t+3]/255}static Mix(a,v,p){return 0}static Instantiate(a){return f.e.Instantiate(a)}static SetImmediate(a){c.b.SetImmediate(a)}static IsExponentOfTwo(a){return!0}static FloatRound(a){return Math.fround(a)}static GetFilename(a){const v=a.lastIndexOf("/");return v<0?a:a.substring(v+1)}static GetFolderPath(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const p=a.lastIndexOf("/");return p<0?v?a:"":a.substring(0,p+1)}static ToDegrees(a){return 180*a/Math.PI}static ToRadians(a){return a*Math.PI/180}static SmoothAngleChange(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const P=this.ToRadians(a),b=this.ToRadians(v);return this.ToDegrees(Math.atan2((1-p)*Math.sin(b)+p*Math.sin(P),(1-p)*Math.cos(b)+p*Math.cos(P)))}static MakeArray(a,v){return!0===v||void 0!==a&&null!=a?Array.isArray(a)?a:[a]:null}static GetPointerPrefix(a){return(0,b.n)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(a,v){(0,u.x)(a,v)}static SetReferrerPolicyBehavior(a,v){v.referrerPolicy=a}static get PreprocessUrl(){return u.g.PreprocessUrl}static set PreprocessUrl(a){u.g.PreprocessUrl=a}static LoadImage(a,v,p,P,b,L){return(0,u.q)(a,v,p,P,b,L)}static LoadFile(a,v,p,P,b,L){return(0,u.p)(a,v,p,P,b,L)}static LoadFileAsync(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((p,P)=>{(0,u.p)(a,(a=>{p(a)}),void 0,void 0,v,((a,v)=>{P(v)}))}))}static GetBabylonScriptURL(a,v){if(!a)return"";if(h.ScriptBaseUrl&&a.startsWith(h._DefaultCdnUrl)){const v="/"===h.ScriptBaseUrl[h.ScriptBaseUrl.length-1]?h.ScriptBaseUrl.substring(0,h.ScriptBaseUrl.length-1):h.ScriptBaseUrl;a=a.replace(h._DefaultCdnUrl,v)}return a=h.ScriptPreprocessUrl(a),v&&(a=h.GetAbsoluteUrl(a)),a}static LoadBabylonScript(a,v,p,P){a=h.GetBabylonScriptURL(a),h.LoadScript(a,v,p)}static LoadBabylonScriptAsync(a){return a=h.GetBabylonScriptURL(a),h.LoadScriptAsync(a)}static LoadScript(a,v,p,P){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(a),v&&v()}catch(K){null===p||void 0===p||p(`Unable to load script '${a}' in worker`,K)}return}if(!(0,b.n)())return void(null===p||void 0===p||p(`Cannot load script '${a}' outside of a window or a worker`));const t=document.getElementsByTagName("head")[0],V=document.createElement("script");L?(V.setAttribute("type","module"),V.innerText=a):(V.setAttribute("type","text/javascript"),V.setAttribute("src",a)),P&&(V.id=P),V.onload=()=>{v&&v()},V.onerror=v=>{p&&p(`Unable to load script '${a}'`,v)},t.appendChild(V)}static LoadScriptAsync(a,v){return new Promise(((p,P)=>{this.LoadScript(a,(()=>{p()}),((a,v)=>{P(v||new Error(a))}),v)}))}static ReadFileAsDataURL(a,v,p){const b=new FileReader,L={onCompleteObservable:new P.c,abort:()=>b.abort()};return b.onloadend=()=>{L.onCompleteObservable.notifyObservers(L)},b.onload=a=>{v(a.target.result)},b.onprogress=p,b.readAsDataURL(a),L}static ReadFile(a,v,p,P,b){return(0,u.r)(a,v,p,P,b)}static FileAsURL(a){const v=new Blob([a]);return window.URL.createObjectURL(v)}static Format(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return a.toFixed(v)}static DeepCopy(a,v,p,P){t.b.DeepCopy(a,v,p,P)}static IsEmpty(a){for(const v in a)if(Object.prototype.hasOwnProperty.call(a,v))return!1;return!0}static RegisterTopRootEvents(a,v){for(let P=0;P<v.length;P++){const b=v[P];a.addEventListener(b.name,b.handler,!1);try{window.parent&&window.parent.addEventListener(b.name,b.handler,!1)}catch(p){}}}static UnregisterTopRootEvents(a,v){for(let P=0;P<v.length;P++){const b=v[P];a.removeEventListener(b.name,b.handler);try{a.parent&&a.parent.removeEventListener(b.name,b.handler)}catch(p){}}}static async DumpFramebuffer(a,v,p,P){throw(0,K.c)("DumpTools")}static DumpData(a,v,p,P){throw(0,K.c)("DumpTools")}static DumpDataAsync(a,v,p){throw(0,K.c)("DumpTools")}static _IsOffScreenCanvas(a){return void 0!==a.convertToBlob}static ToBlob(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",P=arguments.length>3?arguments[3]:void 0;h._IsOffScreenCanvas(a)||a.toBlob||(a.toBlob=function(a,v,p){setTimeout((()=>{const P=atob(this.toDataURL(v,p).split(",")[1]),b=P.length,L=new Uint8Array(b);for(let a=0;a<b;a++)L[a]=P.charCodeAt(a);a(new Blob([L]))}))}),h._IsOffScreenCanvas(a)?a.convertToBlob({type:p,quality:P}).then((a=>v(a))):a.toBlob((function(a){v(a)}),p,P)}static DownloadBlob(a,v){if("download"in document.createElement("a")){if(!v){const a=new Date;v="screenshot_"+((a.getFullYear()+"-"+(a.getMonth()+1)).slice(2)+"-"+a.getDate()+"_"+a.getHours()+"-"+("0"+a.getMinutes()).slice(-2))+".png"}h.Download(a,v)}else if(a&&"undefined"!==typeof URL){const v=URL.createObjectURL(a),p=window.open("");if(!p)return;const P=p.document.createElement("img");P.onload=function(){URL.revokeObjectURL(v)},P.src=v,p.document.body.appendChild(P)}}static EncodeScreenshotCanvasData(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;if("string"!==typeof P&&v){if(v){if(h._IsOffScreenCanvas(a))return void a.convertToBlob({type:p,quality:b}).then((a=>{const p=new FileReader;p.readAsDataURL(a),p.onloadend=()=>{const a=p.result;v(a)}}));const P=a.toDataURL(p,b);v(P)}}else this.ToBlob(a,(function(a){a&&h.DownloadBlob(a,P),v&&v("")}),p,b)}static Download(a,v){if("undefined"===typeof URL)return;const p=window.URL.createObjectURL(a),P=document.createElement("a");document.body.appendChild(P),P.style.display="none",P.href=p,P.download=v,P.addEventListener("click",(()=>{P.parentElement&&P.parentElement.removeChild(P)})),P.click(),window.URL.revokeObjectURL(p)}static BackCompatCameraNoPreventDefault(a){return"boolean"===typeof a[0]?a[0]:"boolean"===typeof a[1]&&a[1]}static CreateScreenshot(a,v,p,P){throw(0,K.c)("ScreenshotTools")}static CreateScreenshotAsync(a,v,p){throw(0,K.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(a,v,p,P){throw(0,K.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(a,v,p){throw(0,K.c)("ScreenshotTools")}static RandomId(){return(0,H.b)()}static IsBase64(a){return(0,u.k)(a)}static DecodeBase64(a){return(0,u.e)(a)}static get errorsCount(){return L.d.errorsCount}static Log(a){L.d.Log(a)}static Warn(a){L.d.Warn(a)}static Error(a){L.d.Error(a)}static get LogCache(){return L.d.LogCache}static ClearLogCache(){L.d.ClearLogCache()}static set LogLevels(a){L.d.LogLevels=a}static set PerformanceLogLevel(a){return(a&h.PerformanceUserMarkLogLevel)===h.PerformanceUserMarkLogLevel?(h.StartPerformanceCounter=h._StartUserMark,void(h.EndPerformanceCounter=h._EndUserMark)):(a&h.PerformanceConsoleLogLevel)===h.PerformanceConsoleLogLevel?(h.StartPerformanceCounter=h._StartPerformanceConsole,void(h.EndPerformanceCounter=h._EndPerformanceConsole)):(h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,void(h.EndPerformanceCounter=h._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(a,v){}static _EndPerformanceCounterDisabled(a,v){}static _StartUserMark(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h._Performance){if(!(0,b.n)())return;h._Performance=window.performance}v&&h._Performance.mark&&h._Performance.mark(a+"-Begin")}static _EndUserMark(a){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&h._Performance.mark&&(h._Performance.mark(a+"-End"),h._Performance.measure(a,a+"-Begin",a+"-End"))}static _StartPerformanceConsole(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];v&&(h._StartUserMark(a,v),console.time&&console.time(a))}static _EndPerformanceConsole(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];v&&(h._EndUserMark(a,v),console.timeEnd(a))}static get Now(){return V.b.Now}static GetClassName(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=null;if(!v&&a.getClassName)p=a.getClassName();else{if(a instanceof Object){p=(v?a:Object.getPrototypeOf(a)).constructor.__bjsclassName__}p||(p=typeof a)}return p}static First(a,v){for(const p of a)if(v(p))return p;return null}static getFullClassName(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=null,P=null;if(!v&&a.getClassName)p=a.getClassName();else{if(a instanceof Object){const b=v?a:Object.getPrototypeOf(a);p=b.constructor.__bjsclassName__,P=b.constructor.__bjsmoduleName__}p||(p=typeof a)}return p?(null!=P?P+".":"")+p:null}static DelayAsync(a){return new Promise((v=>{setTimeout((()=>{v()}),a)}))}static IsSafari(){return!!(0,b.k)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}h.UseCustomRequestHeaders=!1,h.CustomRequestHeaders=C.b.CustomRequestHeaders,h.GetDOMTextContent=b.d,h._DefaultCdnUrl="https://cdn.babylonjs.com",h.GetAbsoluteUrl="object"===typeof document?a=>{const v=document.createElement("a");return v.href=a,v.href}:"function"===typeof URL&&"object"===typeof location?a=>new URL(a,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},h.NoneLogLevel=L.d.NoneLogLevel,h.MessageLogLevel=L.d.MessageLogLevel,h.WarningLogLevel=L.d.WarningLogLevel,h.ErrorLogLevel=L.d.ErrorLogLevel,h.AllLogLevel=L.d.AllLogLevel,h.IsWindowObjectExist=b.n,h.PerformanceNoneLogLevel=0,h.PerformanceUserMarkLogLevel=1,h.PerformanceConsoleLogLevel=2,h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,h.EndPerformanceCounter=h._EndPerformanceCounterDisabled;class R{constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=a,this.index=P-1,this._done=!1,this._fn=v,this._successCallback=p}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(a,v,p){const P=new R(a,v,p,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return P.executeNext(),P}static SyncAsyncForLoop(a,v,p,P,b){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return R.Run(Math.ceil(a/v),(P=>{b&&b()?P.breakLoop():setTimeout((()=>{for(let L=0;L<v;++L){const t=P.index*v+L;if(t>=a)break;if(p(t),b&&b()){P.breakLoop();break}}P.executeNext()}),L)}),P)}}h.Mix=A.m,h.IsExponentOfTwo=A.l,F.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11027:(a,v,p)=>{"use strict";p.d(v,{c:()=>L,f:()=>b});const P={};function b(a,v){P[a]=v}function L(a){return P[a]}},11365:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{static get UniqueId(){const a=this._UniqueIdCounter;return this._UniqueIdCounter++,a}}P._UniqueIdCounter=1},10933:(a,v,p)=>{"use strict";p.d(v,{b:()=>P});class P{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(P.CustomRequestHeaders).length>0||P.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const a in P.CustomRequestHeaders){const v=P.CustomRequestHeaders[a];v&&this._xhr.setRequestHeader(a,v)}}_shouldSkipRequestModifications(a){return P.SkipRequestModificationForBabylonCDN&&(a.includes("preview.babylonjs.com")||a.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(a){this._xhr.onprogress=a}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(a){this._xhr.responseType=a}get timeout(){return this._xhr.timeout}set timeout(a){this._xhr.timeout=a}addEventListener(a,v,p){this._xhr.addEventListener(a,v,p)}removeEventListener(a,v,p){this._xhr.removeEventListener(a,v,p)}abort(){this._xhr.abort()}send(a){P.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(a)}open(a,v){for(const p of P.CustomRequestModifiers){if(this._shouldSkipRequestModifications(v))return;p(this._xhr,v)}v=(v=v.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=v,this._xhr.open(a,v,!0)}setRequestHeader(a,v){this._xhr.setRequestHeader(a,v)}getResponseHeader(a){return this._xhr.getResponseHeader(a)}}P.CustomRequestHeaders={},P.CustomRequestModifiers=new Array,P.SkipRequestModificationForBabylonCDN=!0},12491:(a,v,p)=>{"use strict";p.d(v,{e:()=>b});class P{constructor(a){this._pendingActions=new Array,this._workerInfos=a.map((a=>({workerPromise:Promise.resolve(a),idle:!0})))}dispose(){for(const a of this._workerInfos)a.workerPromise.then((a=>{a.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(a){this._executeOnIdleWorker(a)||this._pendingActions.push(a)}_executeOnIdleWorker(a){for(const v of this._workerInfos)if(v.idle)return this._execute(v,a),!0;return!1}_execute(a,v){a.idle=!1,a.workerPromise.then((p=>{v(p,(()=>{const v=this._pendingActions.shift();v?this._execute(a,v):a.idle=!0}))}))}}class b extends P{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.DefaultOptions;super([]),this._maxWorkers=a,this._createWorkerAsync=v,this._options=p}push(a){if(!this._executeOnIdleWorker(a))if(this._workerInfos.length<this._maxWorkers){const v={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(v),this._execute(v,a)}else this._pendingActions.push(a)}_execute(a,v){a.timeoutId&&(clearTimeout(a.timeoutId),delete a.timeoutId),super._execute(a,((p,P)=>{v(p,(()=>{P(),a.idle&&(a.timeoutId=setTimeout((()=>{a.workerPromise.then((a=>{a.terminate()}));const v=this._workerInfos.indexOf(a);-1!==v&&this._workerInfos.splice(v,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}b.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11646:(a,v,p)=>{"use strict";p.d(v,{d:()=>Ra});var P=p(11240),b=p(11454);class L extends b.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var t=p(11279),V=(p(11654),p(11027));class K{get noiseTexture(){return this._noiseTexture}set noiseTexture(a){this._noiseTexture!==a&&(this._noiseTexture=a,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(a){this._isAnimationSheetEnabled!=a&&(this._isAnimationSheetEnabled=a,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){this._useLogarithmicDepth=a&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:P.s.Zero()}set direction1(a){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=a)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:P.s.Zero()}set direction2(a){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=a)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:P.s.Zero()}set minEmitBox(a){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=a)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:P.s.Zero()}set maxEmitBox(a){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=a)}get billboardMode(){return this._billboardMode}set billboardMode(a){this._billboardMode!==a&&(this._billboardMode=a,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(a){this._isBillboardBased!==a&&(this._isBillboardBased=a,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(a){this._attachImageProcessingConfiguration(a)}_attachImageProcessingConfiguration(a){a!==this._imageProcessingConfiguration&&(!a&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=a)}_reset(){}_removeGradientAndTexture(a,v,p){if(!v)return this;let P=0;for(const b of v){if(b.gradient===a){v.splice(P,1);break}P++}return p&&p.dispose(),this}constructor(a){this.animations=[],this.renderingGroupId=0,this.j=P.s.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new P.s(10,10,10),this.onAnimationEnd=null,this.blendMode=K.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new P.o(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.lg=new P.s(0,0,0),this._useLogarithmicDepth=!1,this.gravity=P.s.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new t.e(1,1,1,1),this.color2=new t.e(1,1,1,1),this.colorDead=new t.e(0,0,0,1),this.textureMask=new t.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new L,this.id=a,this.name=a}createPointEmitter(a,v){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new P.s(0,1,0),arguments.length>2&&void 0!==arguments[2]||new P.s(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new P.s(0,1,0),arguments.length>4&&void 0!==arguments[4]||new P.s(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new P.s(0,1,0),arguments.length>3&&void 0!==arguments[3]||new P.s(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(a,v,p,P){throw new Error("Method not implemented.")}}K.BLENDMODE_ONEONE=0,K.BLENDMODE_STANDARD=1,K.BLENDMODE_ADD=2,K.BLENDMODE_MULTIPLY=3,K.BLENDMODE_MULTIPLYADD=4,(0,V.f)("BABYLON.BaseParticleSystem",K);var C=p(11263),F=p(10911);class u{constructor(){this.direction1=new P.s(0,1,0),this.direction2=new P.s(0,1,0),this.minEmitBox=new P.s(-.5,-.5,-.5),this.maxEmitBox=new P.s(.5,.5,.5)}startDirectionFunction(a,v,p,b){const L=(0,C.r)(this.direction1.x,this.direction2.x),t=(0,C.r)(this.direction1.y,this.direction2.y),V=(0,C.r)(this.direction1.z,this.direction2.z);if(b)return v.x=L,v.y=t,void(v.z=V);P.s.TransformNormalFromFloatsToRef(L,t,V,a,v)}startPositionFunction(a,v,p,b){const L=(0,C.r)(this.minEmitBox.x,this.maxEmitBox.x),t=(0,C.r)(this.minEmitBox.y,this.maxEmitBox.y),V=(0,C.r)(this.minEmitBox.z,this.maxEmitBox.z);if(b)return v.x=L,v.y=t,void(v.z=V);P.s.TransformCoordinatesFromFloatsToRef(L,t,V,a,v)}clone(){const a=new u;return F.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2),a.setVector3("minEmitBox",this.minEmitBox),a.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3),a.addUniform("minEmitBox",3),a.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.tj(),a.direction2=this.direction2.tj(),a.minEmitBox=this.minEmitBox.tj(),a.maxEmitBox=this.maxEmitBox.tj(),a}parse(a){P.s.FromArrayToRef(a.direction1,0,this.direction1),P.s.FromArrayToRef(a.direction2,0,this.direction2),P.s.FromArrayToRef(a.minEmitBox,0,this.minEmitBox),P.s.FromArrayToRef(a.maxEmitBox,0,this.maxEmitBox)}}class c{get radius(){return this._radius}set radius(a){this._radius=a,this._buildHeight()}get angle(){return this._angle}set angle(a){this._angle=a,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=p,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=v,this.radius=a}startDirectionFunction(a,v,p,b){b?P.k.fb[0].p(p.oe).normalize():p.position.subtractToRef(a.getTranslation(),P.k.fb[0]).normalize();const L=(0,C.r)(0,this.directionRandomizer),t=(0,C.r)(0,this.directionRandomizer),V=(0,C.r)(0,this.directionRandomizer);v.x=P.k.fb[0].x+L,v.y=P.k.fb[0].y+t,v.z=P.k.fb[0].z+V,v.normalize()}startPositionFunction(a,v,p,b){const L=(0,C.r)(0,2*Math.PI);let t;this.emitFromSpawnPointOnly?t=1e-4:(t=(0,C.r)(0,this.heightRange),t=1-t*t);let V=this._radius-(0,C.r)(0,this._radius*this.radiusRange);V*=t;const K=V*Math.sin(L),F=V*Math.cos(L),u=t*this._height;if(b)return v.x=K,v.y=u,void(v.z=F);P.s.TransformCoordinatesFromFloatsToRef(K,u,F,a,v)}clone(){const a=new c(this._radius,this._angle,this.directionRandomizer);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat2("radius",this._radius,this.radiusRange),a.setFloat("coneAngle",this._angle),a.setFloat2("height",this._height,this.heightRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",2),a.addUniform("coneAngle",1),a.addUniform("height",2),a.addUniform("directionRandomizer",1)}getEffectDefines(){let a="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(a+="\n#define CONEEMITTERSPAWNPOINT"),a}getClassName(){return"ConeParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this._radius,a.angle=this._angle,a.directionRandomizer=this.directionRandomizer,a.radiusRange=this.radiusRange,a.heightRange=this.heightRange,a.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,a}parse(a){this.radius=a.radius,this.angle=a.angle,this.directionRandomizer=a.directionRandomizer,this.radiusRange=void 0!==a.radiusRange?a.radiusRange:1,this.heightRange=void 0!==a.radiusRange?a.heightRange:1,this.emitFromSpawnPointOnly=void 0!==a.emitFromSpawnPointOnly&&a.emitFromSpawnPointOnly}}class f extends c{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0);super(a,v),this.direction1=p,this.direction2=b}startDirectionFunction(a,v){const p=(0,C.r)(this.direction1.x,this.direction2.x),b=(0,C.r)(this.direction1.y,this.direction2.y),L=(0,C.r)(this.direction1.z,this.direction2.z);P.s.TransformNormalFromFloatsToRef(p,b,L,a,v)}clone(){const a=new f(this.radius,this.angle,this.direction1,this.direction2);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.tj(),a.direction2=this.direction2.tj(),a}parse(a){super.parse(a),this.direction1.p(a.direction1),this.direction2.p(a.direction2)}}class H{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=a,this.height=v,this.radiusRange=p,this.directionRandomizer=b,this._tempVector=P.s.Zero()}startDirectionFunction(a,v,p,b,L){p.position.subtractToRef(a.getTranslation(),this._tempVector),this._tempVector.normalize(),P.s.TransformNormalToRef(this._tempVector,L,this._tempVector);const t=(0,C.r)(-this.directionRandomizer/2,this.directionRandomizer/2);let V=Math.atan2(this._tempVector.x,this._tempVector.z);V+=(0,C.r)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=t,this._tempVector.x=Math.sin(V),this._tempVector.z=Math.cos(V),this._tempVector.normalize(),b?v.p(this._tempVector):P.s.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,a,v)}startPositionFunction(a,v,p,b){const L=(0,C.r)(-this.height/2,this.height/2),t=(0,C.r)(0,2*Math.PI),V=(0,C.r)((1-this.radiusRange)*(1-this.radiusRange),1),K=Math.sqrt(V)*this.radius,F=K*Math.cos(t),u=K*Math.sin(t);b?v.qe(F,L,u):P.s.TransformCoordinatesFromFloatsToRef(F,L,u,a,v)}clone(){const a=new H(this.radius,this.directionRandomizer);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.height=this.height,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.height=a.height,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class A extends H{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.s(0,1,0);super(a,v,p),this.direction1=b,this.direction2=L}startDirectionFunction(a,v,p,b){const L=(0,C.r)(this.direction1.x,this.direction2.x),t=(0,C.r)(this.direction1.y,this.direction2.y),V=(0,C.r)(this.direction1.z,this.direction2.z);b?v.qe(L,t,V):P.s.TransformNormalFromFloatsToRef(L,t,V,a,v)}clone(){const a=new A(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.tj(),a.direction2=this.direction2.tj(),a}parse(a){super.parse(a),P.s.FromArrayToRef(a.direction1,0,this.direction1),P.s.FromArrayToRef(a.direction2,0,this.direction2)}}class h{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=v,this.directionRandomizer=p}startDirectionFunction(a,v,p,b){const L=p.position.od(a.getTranslation()).normalize(),t=(0,C.r)(0,this.directionRandomizer),V=(0,C.r)(0,this.directionRandomizer),K=(0,C.r)(0,this.directionRandomizer);L.x+=t,L.y+=V,L.z+=K,L.normalize(),b?v.p(L):P.s.TransformNormalFromFloatsToRef(L.x,L.y,L.z,a,v)}startPositionFunction(a,v,p,b){const L=this.radius-(0,C.r)(0,this.radius*this.radiusRange),t=(0,C.r)(0,1),V=(0,C.r)(0,2*Math.PI),K=Math.acos(2*t-1),F=L*Math.cos(V)*Math.sin(K),u=L*Math.cos(K),c=L*Math.sin(V)*Math.sin(K);b?v.qe(F,Math.abs(u),c):P.s.TransformCoordinatesFromFloatsToRef(F,Math.abs(u),c,a,v)}clone(){const a=new h(this.radius,this.directionRandomizer);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class R{constructor(){this.direction1=new P.s(0,1,0),this.direction2=new P.s(0,1,0)}startDirectionFunction(a,v,p,b){const L=(0,C.r)(this.direction1.x,this.direction2.x),t=(0,C.r)(this.direction1.y,this.direction2.y),V=(0,C.r)(this.direction1.z,this.direction2.z);b?v.qe(L,t,V):P.s.TransformNormalFromFloatsToRef(L,t,V,a,v)}startPositionFunction(a,v,p,b){b?v.qe(0,0,0):P.s.TransformCoordinatesFromFloatsToRef(0,0,0,a,v)}clone(){const a=new R;return F.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.tj(),a.direction2=this.direction2.tj(),a}parse(a){P.s.FromArrayToRef(a.direction1,0,this.direction1),P.s.FromArrayToRef(a.direction2,0,this.direction2)}}class X{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=v,this.directionRandomizer=p}startDirectionFunction(a,v,p,b){const L=p.position.od(a.getTranslation()).normalize(),t=(0,C.r)(0,this.directionRandomizer),V=(0,C.r)(0,this.directionRandomizer),K=(0,C.r)(0,this.directionRandomizer);L.x+=t,L.y+=V,L.z+=K,L.normalize(),b?v.p(L):P.s.TransformNormalFromFloatsToRef(L.x,L.y,L.z,a,v)}startPositionFunction(a,v,p,b){const L=this.radius-(0,C.r)(0,this.radius*this.radiusRange),t=(0,C.r)(0,1),V=(0,C.r)(0,2*Math.PI),K=Math.acos(2*t-1),F=L*Math.cos(V)*Math.sin(K),u=L*Math.cos(K),c=L*Math.sin(V)*Math.sin(K);b?v.qe(F,u,c):P.s.TransformCoordinatesFromFloatsToRef(F,u,c,a,v)}clone(){const a=new X(this.radius,this.directionRandomizer);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class Q extends X{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.s(0,1,0),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0);super(a),this.direction1=v,this.direction2=p}startDirectionFunction(a,v){const p=(0,C.r)(this.direction1.x,this.direction2.x),b=(0,C.r)(this.direction1.y,this.direction2.y),L=(0,C.r)(this.direction1.z,this.direction2.z);P.s.TransformNormalFromFloatsToRef(p,b,L,a,v)}clone(){const a=new Q(this.radius,this.direction1,this.direction2);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.tj(),a.direction2=this.direction2.tj(),a}parse(a){super.parse(a),this.direction1.p(a.direction1),this.direction2.p(a.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(a,v,p,b){const L=P.k.fb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,p,L);const a=P.k.fb[1];L.subtractToRef(p.position,a),a.scaleToRef(1/p.lifeTime,L)}else L.set(0,0,0);b?v.p(L):P.s.TransformNormalToRef(L,a,v)}startPositionFunction(a,v,p,b){const L=P.k.fb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,p,L):L.set(0,0,0),b?v.p(L):P.s.TransformCoordinatesToRef(L,a,v)}clone(){const a=new s;return F.b.DeepCopy(this,a),a}applyToShader(a){}buildUniformLayout(a){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.particlePositionGenerator=this.particlePositionGenerator,a.particleDestinationGenerator=this.particleDestinationGenerator,a}parse(a){a.particlePositionGenerator&&(this.particlePositionGenerator=a.particlePositionGenerator),a.particleDestinationGenerator&&(this.particleDestinationGenerator=a.particleDestinationGenerator)}}var D=p(11306);class y{get mesh(){return this._mesh}set mesh(a){this._mesh!==a&&(this._mesh=a,a?(this._indices=a.ng(),this._positions=a.getVerticesData(D.f.PositionKind),this._normals=a.getVerticesData(D.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=P.s.Zero(),this._mesh=null,this.direction1=new P.s(0,1,0),this.direction2=new P.s(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=a}startDirectionFunction(a,v,p,b){if(this.useMeshNormalsForDirection&&this._normals)return void P.s.TransformNormalToRef(this._storedNormal,a,v);const L=(0,C.r)(this.direction1.x,this.direction2.x),t=(0,C.r)(this.direction1.y,this.direction2.y),V=(0,C.r)(this.direction1.z,this.direction2.z);b?v.qe(L,t,V):P.s.TransformNormalFromFloatsToRef(L,t,V,a,v)}startPositionFunction(a,v,p,b){if(!this._indices||!this._positions)return;const L=3*Math.random()*(this._indices.length/3)|0,t=Math.random(),V=Math.random()*(1-t),K=1-t-V,C=this._indices[L],F=this._indices[L+1],u=this._indices[L+2],c=P.k.fb[0],f=P.k.fb[1],H=P.k.fb[2],A=P.k.fb[3];P.s.FromArrayToRef(this._positions,3*C,c),P.s.FromArrayToRef(this._positions,3*F,f),P.s.FromArrayToRef(this._positions,3*u,H),A.x=t*c.x+V*f.x+K*H.x,A.y=t*c.y+V*f.y+K*H.y,A.z=t*c.z+V*f.z+K*H.z,b?v.qe(A.x,A.y,A.z):P.s.TransformCoordinatesFromFloatsToRef(A.x,A.y,A.z,a,v),this.useMeshNormalsForDirection&&this._normals&&(P.s.FromArrayToRef(this._normals,3*C,c),P.s.FromArrayToRef(this._normals,3*F,f),P.s.FromArrayToRef(this._normals,3*u,H),this._storedNormal.x=t*c.x+V*f.x+K*H.x,this._storedNormal.y=t*c.y+V*f.y+K*H.y,this._storedNormal.z=t*c.z+V*f.z+K*H.z)}clone(){const a=new y(this.mesh);return F.b.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var a;const v={};return v.type=this.getClassName(),v.direction1=this.direction1.tj(),v.direction2=this.direction2.tj(),v.meshId=null===(a=this.mesh)||void 0===a?void 0:a.id,v.useMeshNormalsForDirection=this.useMeshNormalsForDirection,v}parse(a,v){P.s.FromArrayToRef(a.direction1,0,this.direction1),P.s.FromArrayToRef(a.direction2,0,this.direction2),a.meshId&&v&&(this.mesh=v.getLastMeshById(a.meshId)),this.useMeshNormalsForDirection=a.useMeshNormalsForDirection}}var Z=p(10980);class M{_isUbo(a){return void 0!==a.addUniform}constructor(a){this._isUbo(a)?(this.setMatrix3x3=a.updateMatrix3x3.bind(a),this.setMatrix2x2=a.updateMatrix2x2.bind(a),this.setFloat=a.updateFloat.bind(a),this.setFloat2=a.updateFloat2.bind(a),this.setFloat3=a.updateFloat3.bind(a),this.setFloat4=a.updateFloat4.bind(a),this.setFloatArray=a.updateFloatArray.bind(a),this.setArray=a.updateArray.bind(a),this.setIntArray=a.updateIntArray.bind(a),this.setMatrix=a.Sj.bind(a),this.setMatrices=a.updateMatrices.bind(a),this.setVector3=a.updateVector3.bind(a),this.setVector4=a.updateVector4.bind(a),this.setColor3=a.updateColor3.bind(a),this.setColor4=a.updateColor4.bind(a),this.setDirectColor4=a.updateDirectColor4.bind(a),this.setInt=a.updateInt.bind(a),this.setInt2=a.updateInt2.bind(a),this.setInt3=a.updateInt3.bind(a),this.setInt4=a.updateInt4.bind(a)):(this.setMatrix3x3=a.setMatrix3x3.bind(a),this.setMatrix2x2=a.setMatrix2x2.bind(a),this.setFloat=a.setFloat.bind(a),this.setFloat2=a.setFloat2.bind(a),this.setFloat3=a.setFloat3.bind(a),this.setFloat4=a.setFloat4.bind(a),this.setFloatArray=a.setFloatArray.bind(a),this.setArray=a.setArray.bind(a),this.setIntArray=a.setIntArray.bind(a),this.setMatrix=a.setMatrix.bind(a),this.setMatrices=a.setMatrices.bind(a),this.setVector3=a.setVector3.bind(a),this.setVector4=a.setVector4.bind(a),this.setColor3=a.setColor3.bind(a),this.setColor4=a.setColor4.bind(a),this.setDirectColor4=a.setDirectColor4.bind(a),this.setInt=a.setInt.bind(a),this.setInt2=a.setInt2.bind(a),this.setInt3=a.setInt3.bind(a),this.setInt4=a.setInt4.bind(a))}}var S=p(10982);const n="gpuUpdateParticlesPixelShader",q="#version 300 es\nvoid main() {discard;}\n";S.e.ShadersStore[n]=q;const T="gpuUpdateParticlesVertexShader",j="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";S.e.ShadersStore[T]=j;(0,V.f)("BABYLON.WebGL2ParticleSystem",class{constructor(a,v){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=a,this._engine=v,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var a;return(null===(a=this._updateEffect)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=a,this._updateEffect=new Z.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new M(this._updateEffect)}createVertexBuffers(a,v){this._updateVAO.push(this._createUpdateVAO(a)),this._renderVAO.push(this._engine.recordVertexArrayObject(v,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=v}createParticleBuffer(a){return a}bindDrawBuffers(a,v,p){p?this._engine.bindBuffers(this._renderVertexBuffers,p,v):this._engine.bindVertexArrayObject(this._renderVAO[a],null)}preUpdateParticleBuffer(){const a=this._engine;if(this._engine.enableEffect(this._updateEffect),!a.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(a,v,p){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[a],null);const P=this._engine;P.bindTransformFeedbackBuffer(v.getBuffer()),P.setRasterizerState(!1),P.beginTransformFeedback(!0),P.drawArraysType(3,0,p),P.endTransformFeedback(),P.setRasterizerState(!0),P.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let a=0;a<this._updateVAO.length;a++)this._engine.releaseVertexArrayObject(this._updateVAO[a]);this._updateVAO.length=0;for(let a=0;a<this._renderVAO.length;a++)this._engine.releaseVertexArrayObject(this._renderVAO[a]);this._renderVAO.length=0}_createUpdateVAO(a){const v={};v.position=a.createVertexBuffer("position",0,3);let p=3;v.age=a.createVertexBuffer("age",p,1),p+=1,v.size=a.createVertexBuffer("size",p,3),p+=3,v.life=a.createVertexBuffer("life",p,1),p+=1,v.seed=a.createVertexBuffer("seed",p,4),p+=4,v.direction=a.createVertexBuffer("direction",p,3),p+=3,this._parent.particleEmitterType instanceof s&&(v.initialPosition=a.createVertexBuffer("initialPosition",p,3),p+=3),this._parent._colorGradientsTexture||(v.color=a.createVertexBuffer("color",p,4),p+=4),this._parent._isBillboardBased||(v.initialDirection=a.createVertexBuffer("initialDirection",p,3),p+=3),this._parent.noiseTexture&&(v.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",p,3),p+=3,v.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",p,3),p+=3),this._parent._angularSpeedGradientsTexture?(v.angle=a.createVertexBuffer("angle",p,1),p+=1):(v.angle=a.createVertexBuffer("angle",p,2),p+=2),this._parent._isAnimationSheetEnabled&&(v.cellIndex=a.createVertexBuffer("cellIndex",p,1),p+=1,this._parent.spriteRandomStartCell&&(v.cellStartOffset=a.createVertexBuffer("cellStartOffset",p,1),p+=1));const P=this._engine.recordVertexArrayObject(v,null,this._updateEffect);return this._engine.bindArrayBuffer(null),P}});class w{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,P=arguments.length>3?arguments[3]:void 0;this._engine=a,this._label=P,this._engine._storageBuffers.push(this),this._create(v,p)}_create(a,v){this._bufferSize=a,this._creationFlags=v,this._buffer=this._engine.createStorageBuffer(a,v,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(a,v,p){this._buffer&&this._engine.updateStorageBuffer(this._buffer,a,v,p)}read(a,v,p,P){return this._engine.readFromStorageBuffer(this._buffer,a,v,p,P)}dispose(){const a=this._engine._storageBuffers,v=a.indexOf(this);-1!==v&&(a[v]=a[a.length-1],a.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var J=p(11207),B=p(11210),x=p(11287),r=p(11460),o=p(11365),m=p(10905),O=p(11011),Y=p(11042);class l{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Y.c}_addDuration(a,v){a<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==a?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(v,!1),this._gpuTimeInFrameId=a):this.counter.addCount(v,!1))}}class z{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=a,this._engine=v,this.uniqueId=o.e.UniqueId,v.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new l),this._engine.getCaps().supportComputeShaders?P.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=p,this._options={bindingsMapping:{},defines:[],...P}):m.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):m.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const P=this._bindings[a];this._bindings[a]={type:p?0:4,object:v,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!P||P.object!==v||P.type!==this._bindings[a].type)}setStorageTexture(a,v){const p=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==v),this._bindings[a]={type:1,object:v,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setExternalTexture(a,v){const p=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==v),this._bindings[a]={type:6,object:v,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setVideoTexture(a,v){return!!v.externalTexture&&(this.setExternalTexture(a,v.externalTexture),!0)}setUniformBuffer(a,v){const p=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==v),this._bindings[a]={type:z._BufferIsDataBuffer(v)?7:2,object:v,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setStorageBuffer(a,v){const p=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!p||p.object!==v),this._bindings[a]={type:z._BufferIsDataBuffer(v)?7:3,object:v,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}setTextureSampler(a,v){const p=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!p||!v.compareSampler(p.object)),this._bindings[a]={type:5,object:v,indexInGroupEntries:null===p||void 0===p?void 0:p.indexInGroupEntries}}isReady(){let a=this._effect;for(const b in this._bindings){const a=this._bindings[b],v=a.type,p=a.object;switch(v){case 0:case 4:case 1:if(!p.isReady())return!1;break;case 6:if(!p.isReady())return!1;break}}const v=[],p=this._shaderPath;if(this._options.defines)for(let b=0;b<this._options.defines.length;b++)v.push(this._options.defines[b]);const P=v.join("\n");return this._cachedDefines!==P&&(this._cachedDefines=P,a=this._engine.createComputeEffect(p,{defines:P,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=a),!!a.isReady()}dispatch(a,v,p){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,a,v,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const p=z._BufferIsDataBuffer(a)?a:a.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,p,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const v in this._bindings){const p=this._bindings[v];if(!this._options.bindingsMapping[v])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+v+"'");switch(p.type){case 0:{const P=this._samplers[v],b=p.object;var a;if(!P||!b._texture||!P.compareSampler(b._texture))this._samplers[v]=(new O.e).setParameters(b.wrapU,b.wrapV,b.wrapR,b.anisotropicFilteringLevel,b._texture.samplingMode,null===(a=b._texture)||void 0===a?void 0:a._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const a=p.object;a.getBuffer()!==p.buffer&&(p.buffer=a.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((b=>{const L=()=>{this.dispatch(a,v,p)?b():setTimeout(L,P)};L()}))}serialize(){const a=x.b.Serialize(this);a.options=this._options,a.shaderPath=this._shaderPath,a.Ij={},a.textures={};for(const v in this._bindings){const p=this._bindings[v],P=p.object;switch(p.type){case 0:case 4:case 1:{const b=P.serialize();b&&(a.textures[v]=b,a.Ij[v]={type:p.type});break}}}return a}static Parse(a,v,p){const P=x.b.Parse((()=>new z(a.name,v.getEngine(),a.shaderPath,a.options)),a,v,p);for(const b in a.textures){const L=a.Ij[b],t=r.c.Parse(a.textures[b],v,p);0===L.type?P.setTexture(b,t):4===L.type?P.setTexture(b,t,!1):P.setStorageTexture(b,t)}return P}static _BufferIsDataBuffer(a){return void 0!==a.underlyingResource}}(0,J.e)([(0,B.O)()],z.prototype,"name",void 0),(0,J.e)([(0,B.O)()],z.prototype,"fastMode",void 0),(0,V.f)("BABYLON.ComputeShader",z);var g=p(11301);const G="gpuUpdateParticlesComputeShader",e="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";S.e.ShadersStoreWGSL[G]=e;(0,V.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(a,v){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=a,this._engine=v}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var a;return(null===(a=this._updateComputeShader)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){var v;const p={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(p.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(p.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(p.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(p.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(p.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(p.noiseTexture={group:1,binding:11}),this._updateComputeShader=new z("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:p,defines:a.split("\n")}),null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=new g.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new M(this._simParamsComputeShader)}createVertexBuffers(a,v){this._renderVertexBuffers.push(v)}createParticleBuffer(a){const v=new w(this._engine,4*a.length,11,"ComputeShaderParticleSystemBuffer");return v.update(a),this._bufferComputeShader.push(v),v.getBuffer()}bindDrawBuffers(a,v,p){this._engine.bindBuffers(this._renderVertexBuffers[a],p,v)}preUpdateParticleBuffer(){}updateParticleBuffer(a,v,p){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[a]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^a]),this._updateComputeShader.dispatch(Math.ceil(p/64))}releaseBuffers(){var a;for(let v=0;v<this._bufferComputeShader.length;++v)this._bufferComputeShader[v].dispose();this._bufferComputeShader.length=0,null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class k{constructor(a,v,p){this.gradient=a,this.color1=v,this.color2=p}getColorToRef(a){this.color2?t.e.LerpToRef(this.color1,this.color2,Math.random(),a):a.p(this.color1)}}class d{constructor(a,v){this.gradient=a,this.color=v}}class E{constructor(a,v,p){this.gradient=a,this.factor1=v,this.factor2=p}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class W{static GetCurrentGradient(a,v,p){if(v[0].gradient>a)return void p(v[0],v[0],1);for(let b=0;b<v.length-1;b++){const P=v[b],L=v[b+1];if(a>=P.gradient&&a<=L.gradient){return void p(P,L,(a-P.gradient)/(L.gradient-P.gradient))}}const P=v.length-1;p(v[P],v[P],1)}}var U=p(10893),N=p(11676),i=p(10939);class I{constructor(a){this.particleSystem=a,this.position=P.s.Zero(),this.direction=P.s.Zero(),this.color=new t.e(0,0,0,0),this.colorStep=new t.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new P.o(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new t.e(0,0,0,0),this._currentColor2=new t.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=I._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let a=this.age,v=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===v?(v=1,a=this._randomCellOffset):a+=this._randomCellOffset);const p=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let P;P=this._initialSpriteCellLoop?(0,C.e)(a*v%this.lifeTime/this.lifeTime):(0,C.e)(a*v/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+P*p|0}_inheritParticleInfoToSubEmitter(a){if(a.particleSystem.j.position){const v=a.particleSystem.j;if(v.position.p(this.position),a.inheritDirection){const a=P.k.fb[0];this.direction.normalizeToRef(a),v.setDirection(a,0,Math.PI/2)}}else{a.particleSystem.j.p(this.position)}this.direction.scaleToRef(a.inheritedVelocityAmount/2,P.k.fb[0]),a.particleSystem._inheritedVelocityOffset.p(P.k.fb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((a=>{this._inheritParticleInfoToSubEmitter(a)}))}_reset(){this.age=0,this.id=I._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(a){a.position.p(this.position),this._initialDirection?a._initialDirection?a._initialDirection.p(this._initialDirection):a._initialDirection=this._initialDirection.clone():a._initialDirection=null,a.direction.p(this.direction),this.oe&&(a.oe?a.oe.p(this.oe):a.oe=this.oe.clone()),a.color.p(this.color),a.colorStep.p(this.colorStep),a.lifeTime=this.lifeTime,a.age=this.age,a._randomCellOffset=this._randomCellOffset,a.size=this.size,a.scale.p(this.scale),a.angle=this.angle,a.angularSpeed=this.angularSpeed,a.particleSystem=this.particleSystem,a.cellIndex=this.cellIndex,a.id=this.id,a._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(a._currentColorGradient=this._currentColorGradient,a._currentColor1.p(this._currentColor1),a._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(a._currentSizeGradient=this._currentSizeGradient,a._currentSize1=this._currentSize1,a._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(a._currentAngularSpeedGradient=this._currentAngularSpeedGradient,a._currentAngularSpeed1=this._currentAngularSpeed1,a._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(a._currentVelocityGradient=this._currentVelocityGradient,a._currentVelocity1=this._currentVelocity1,a._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(a._currentLimitVelocityGradient=this._currentLimitVelocityGradient,a._currentLimitVelocity1=this._currentLimitVelocity1,a._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(a._currentDragGradient=this._currentDragGradient,a._currentDrag1=this._currentDrag1,a._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(a._initialStartSpriteCellID=this._initialStartSpriteCellID,a._initialEndSpriteCellID=this._initialEndSpriteCellID,a._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(a.remapData&&this.remapData?a.remapData.p(this.remapData):a.remapData=new P.t(0,0,0,0)),this._randomNoiseCoordinates1&&(a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),a._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(a._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),a._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}I._Count=0;var aa=p(11438),va=(p(11684),p(11448)),pa=p(11440),Pa=p(11296);class ba extends K{set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}get useRampGradients(){return this._useRampGradients}set useRampGradients(a){this._useRampGradients!==a&&(this._useRampGradients=a,this._resetEffect())}get particles(){return this.Dj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Dj.length}getClassName(){return"sb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[v])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new aa.e(this._engine),this._customWrappers[v].effect=a,this._customWrappers[v].drawContext&&(this._customWrappers[v].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new U.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(a),this._emitterInverseWorldMatrix=P.e.Identity(),this._inheritedVelocityOffset=new P.s,this.uj=new U.c,this.onStoppedObservable=new U.c,this.Dj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new t.e(0,0,0,0),this._colorDiff=new t.e(0,0,0,0),this._scaledDirection=P.s.Zero(),this._scaledGravity=P.s.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=a=>{},this.recycleParticle=a=>{const v=this.Dj.pop();v!==a&&v.copyTo(a),this._stockParticles.push(v)},this._createParticle=()=>{let a;return 0!==this._stockParticles.length?(a=this._stockParticles.pop(),a._reset()):a=new I(this),this._prepareParticle(a),a},this._shadersLoaded=!1,this._capacity=v,this._epsilon=V,this._isAnimationSheetEnabled=L,p&&"Scene"!==p.getClassName()?(this._engine=p,this.defaultProjectionMatrix=P.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=p||i.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Bj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=b,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new u;let K=null;this.updateFunction=a=>{let v=null;var p;this.noiseTexture&&(v=this.noiseTexture.getSize(),null===(p=this.noiseTexture.getContent())||void 0===p||p.then((a=>{K=a})));const b=a===this.Dj;for(let L=0;L<a.length;L++){const p=a[L];let V=this._scaledUpdateSpeed;const F=p.age;if(p.age+=V,p.age>p.lifeTime){const a=p.age-F;V=(p.lifeTime-F)*V/a,p.age=p.lifeTime}const u=p.age/p.lifeTime;this._colorGradients&&this._colorGradients.length>0?W.GetCurrentGradient(u,this._colorGradients,((a,v,P)=>{a!==p._currentColorGradient&&(p._currentColor1.p(p._currentColor2),v.getColorToRef(p._currentColor2),p._currentColorGradient=a),t.e.LerpToRef(p._currentColor1,p._currentColor2,P,p.color)})):(p.colorStep.scaleToRef(V,this._scaledColorStep),p.color.addInPlace(this._scaledColorStep),p.color.a<0&&(p.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&W.GetCurrentGradient(u,this._angularSpeedGradients,((a,v,P)=>{a!==p._currentAngularSpeedGradient&&(p._currentAngularSpeed1=p._currentAngularSpeed2,p._currentAngularSpeed2=v.getFactor(),p._currentAngularSpeedGradient=a),p.angularSpeed=(0,C.l)(p._currentAngularSpeed1,p._currentAngularSpeed2,P)})),p.angle+=p.angularSpeed*V;let c=V;if(this._velocityGradients&&this._velocityGradients.length>0&&W.GetCurrentGradient(u,this._velocityGradients,((a,v,P)=>{a!==p._currentVelocityGradient&&(p._currentVelocity1=p._currentVelocity2,p._currentVelocity2=v.getFactor(),p._currentVelocityGradient=a),c*=(0,C.l)(p._currentVelocity1,p._currentVelocity2,P)})),p.direction.scaleToRef(c,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&W.GetCurrentGradient(u,this._limitVelocityGradients,((a,v,P)=>{a!==p._currentLimitVelocityGradient&&(p._currentLimitVelocity1=p._currentLimitVelocity2,p._currentLimitVelocity2=v.getFactor(),p._currentLimitVelocityGradient=a);const b=(0,C.l)(p._currentLimitVelocity1,p._currentLimitVelocity2,P);p.direction.length()>b&&p.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&W.GetCurrentGradient(u,this._dragGradients,((a,v,P)=>{a!==p._currentDragGradient&&(p._currentDrag1=p._currentDrag2,p._currentDrag2=v.getFactor(),p._currentDragGradient=a);const b=(0,C.l)(p._currentDrag1,p._currentDrag2,P);this._scaledDirection.scaleInPlace(1-b)})),this.isLocal&&p.oe?(p.oe.addInPlace(this._scaledDirection),P.s.TransformCoordinatesToRef(p.oe,this._emitterWorldMatrix,p.position)):p.position.addInPlace(this._scaledDirection),K&&v&&p._randomNoiseCoordinates1){const a=this._fetchR(p._randomNoiseCoordinates1.x,p._randomNoiseCoordinates1.y,v.width,v.height,K),b=this._fetchR(p._randomNoiseCoordinates1.z,p._randomNoiseCoordinates2.x,v.width,v.height,K),L=this._fetchR(p._randomNoiseCoordinates2.y,p._randomNoiseCoordinates2.z,v.width,v.height,K),t=P.k.fb[0],C=P.k.fb[1];t.qe((2*a-1)*this.noiseStrength.x,(2*b-1)*this.noiseStrength.y,(2*L-1)*this.noiseStrength.z),t.scaleToRef(V,C),p.direction.addInPlace(C)}this.gravity.scaleToRef(V,this._scaledGravity),p.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&W.GetCurrentGradient(u,this._sizeGradients,((a,v,P)=>{a!==p._currentSizeGradient&&(p._currentSize1=p._currentSize2,p._currentSize2=v.getFactor(),p._currentSizeGradient=a),p.size=(0,C.l)(p._currentSize1,p._currentSize2,P)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&W.GetCurrentGradient(u,this._colorRemapGradients,((a,v,P)=>{const b=(0,C.l)(a.factor1,v.factor1,P),L=(0,C.l)(a.factor2,v.factor2,P);p.remapData.x=b,p.remapData.y=L-b})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&W.GetCurrentGradient(u,this._alphaRemapGradients,((a,v,P)=>{const b=(0,C.l)(a.factor1,v.factor1,P),L=(0,C.l)(a.factor2,v.factor2,P);p.remapData.z=b,p.remapData.w=L-b}))),this._isAnimationSheetEnabled&&p.updateCellIndex(),p._inheritParticleInfoToSubEmitters(),p.age>=p.lifeTime&&(this._emitFromParticle(p),p._attachedSubEmitters&&(p._attachedSubEmitters.forEach((a=>{a.particleSystem.disposeOnStop=!0,a.particleSystem.stop()})),p._attachedSubEmitters=null),this.recycleParticle(p),b&&L--)}}}serialize(a){throw new Error("Method not implemented.")}clone(a,v){throw new Error("Method not implemented.")}_addFactorGradient(a,v,p,P){const b=new E(v,p,P);a.push(b),a.sort(((a,v)=>a.gradient<v.gradient?-1:a.gradient>v.gradient?1:0))}_removeFactorGradient(a,v){if(!a)return;let p=0;for(const P of a){if(P.gradient===v){a.splice(p,1);break}p++}}addLifeTimeGradient(a,v,p){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,a,v,p),this}removeLifeTimeGradient(a){return this._removeFactorGradient(this._lifeTimeGradients,a),this}addSizeGradient(a,v,p){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,v,p),this}removeSizeGradient(a){return this._removeFactorGradient(this._sizeGradients,a),this}addColorRemapGradient(a,v,p){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,a,v,p),this}removeColorRemapGradient(a){return this._removeFactorGradient(this._colorRemapGradients,a),this}addAlphaRemapGradient(a,v,p){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,a,v,p),this}removeAlphaRemapGradient(a){return this._removeFactorGradient(this._alphaRemapGradients,a),this}addAngularSpeedGradient(a,v,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,v,p),this}removeAngularSpeedGradient(a){return this._removeFactorGradient(this._angularSpeedGradients,a),this}addVelocityGradient(a,v,p){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,v,p),this}removeVelocityGradient(a){return this._removeFactorGradient(this._velocityGradients,a),this}addLimitVelocityGradient(a,v,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,v,p),this}removeLimitVelocityGradient(a){return this._removeFactorGradient(this._limitVelocityGradients,a),this}addDragGradient(a,v,p){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,v,p),this}removeDragGradient(a){return this._removeFactorGradient(this._dragGradients,a),this}addEmitRateGradient(a,v,p){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,a,v,p),this}removeEmitRateGradient(a){return this._removeFactorGradient(this._emitRateGradients,a),this}addStartSizeGradient(a,v,p){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,a,v,p),this}removeStartSizeGradient(a){return this._removeFactorGradient(this._startSizeGradients,a),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const a=new Uint8Array(4*this._rawTextureWidth),v=t.h.gb[0];for(let p=0;p<this._rawTextureWidth;p++){const P=p/this._rawTextureWidth;W.GetCurrentGradient(P,this._rampGradients,((P,b,L)=>{t.d.LerpToRef(P.color,b.color,L,v),a[4*p]=255*v.r,a[4*p+1]=255*v.g,a[4*p+2]=255*v.b,a[4*p+3]=255}))}this._rampGradientsTexture=N.d.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((a,v)=>a.gradient<v.gradient?-1:a.gradient>v.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(a,v){this._rampGradients||(this._rampGradients=[]);const p=new d(a,v);return this._rampGradients.push(p),this._syncRampGradientTexture(),this}removeRampGradient(a){return this._removeGradientAndTexture(a,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(a,v,p){this._colorGradients||(this._colorGradients=[]);const P=new k(a,v,p);return this._colorGradients.push(P),this._colorGradients.sort(((a,v)=>a.gradient<v.gradient?-1:a.gradient>v.gradient?1:0)),this}removeColorGradient(a){if(!this._colorGradients)return this;let v=0;for(const p of this._colorGradients){if(p.gradient===a){this._colorGradients.splice(v,1);break}v++}return this}resetDrawCache(){for(const a of this._drawWrappers)if(a)for(const v of a)null===v||void 0===v||v.dispose();this._drawWrappers=[]}_fetchR(a,v,p,P,b){return b[4*(((a=.5*Math.abs(a)+.5)*p%p|0)+((v=.5*Math.abs(v)+.5)*P%P|0)*p)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const a=this._engine,v=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*v),this._vertexBuffer=new D.b(a,this._vertexData,!0,v);let p=0;const P=this._vertexBuffer.createVertexBuffer(D.f.PositionKind,p,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.f.PositionKind]=P,p+=3;const b=this._vertexBuffer.createVertexBuffer(D.f.ColorKind,p,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.f.ColorKind]=b,p+=4;const L=this._vertexBuffer.createVertexBuffer("angle",p,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=L,p+=1;const t=this._vertexBuffer.createVertexBuffer("size",p,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=t,p+=2,this._isAnimationSheetEnabled){const a=this._vertexBuffer.createVertexBuffer("cellIndex",p,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=a,p+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const a=this._vertexBuffer.createVertexBuffer("direction",p,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=a,p+=3}if(this._useRampGradients){const a=this._vertexBuffer.createVertexBuffer("remapData",p,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=a,p+=4}let V;if(this._useInstancing){const v=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new D.b(a,v,!1,2),V=this._spriteBuffer.createVertexBuffer("offset",0,2)}else V=this._vertexBuffer.createVertexBuffer("offset",p,2,this._vertexBufferSize,this._useInstancing),p+=2;this._vertexBuffers.offset=V,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const a=[],v=[];let p=0;for(let P=0;P<this._capacity;P++)a.push(p),a.push(p+1),a.push(p+2),a.push(p),a.push(p+2),a.push(p+3),v.push(p,p+1,p+1,p+2,p+2,p+3,p+3,p,p,p+3),p+=4;this._indexBuffer=this._engine.createIndexBuffer(a),this._linesIndexBuffer=this._engine.createIndexBuffer(v)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(a)setTimeout((()=>{this.start(0)}),a);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var v;-1!==(null===(v=this.j)||void 0===v?void 0:v.getClassName().indexOf("Mesh"))&&this.j.Zj(!0);const a=this.noiseTexture;if(a&&a.onGeneratedObservable)a.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),a.render()}))}));else for(let v=0;v<this.preWarmCycles;v++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(a))}_postStop(a){}reset(){this._stockParticles.length=0,this.Dj.length=0}_appendParticleVertex(a,v,p,b){let L=a*this._vertexBufferSize;if(this._vertexData[L++]=v.position.x+this.lg.x,this._vertexData[L++]=v.position.y+this.lg.y,this._vertexData[L++]=v.position.z+this.lg.z,this._vertexData[L++]=v.color.r,this._vertexData[L++]=v.color.g,this._vertexData[L++]=v.color.b,this._vertexData[L++]=v.color.a,this._vertexData[L++]=v.angle,this._vertexData[L++]=v.scale.x*v.size,this._vertexData[L++]=v.scale.y*v.size,this._isAnimationSheetEnabled&&(this._vertexData[L++]=v.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[L++]=v.direction.x,this._vertexData[L++]=v.direction.y,this._vertexData[L++]=v.direction.z);else if(v._initialDirection){let a=v._initialDirection;this.isLocal&&(P.s.TransformNormalToRef(a,this._emitterWorldMatrix,P.k.fb[0]),a=P.k.fb[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[L++]=a.x,this._vertexData[L++]=a.y,this._vertexData[L++]=a.z}else{let a=v.direction;this.isLocal&&(P.s.TransformNormalToRef(a,this._emitterWorldMatrix,P.k.fb[0]),a=P.k.fb[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[L++]=a.x,this._vertexData[L++]=a.y,this._vertexData[L++]=a.z}this._useRampGradients&&v.remapData&&(this._vertexData[L++]=v.remapData.x,this._vertexData[L++]=v.remapData.y,this._vertexData[L++]=v.remapData.z,this._vertexData[L++]=v.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===p?p=this._epsilon:1===p&&(p=1-this._epsilon),0===b?b=this._epsilon:1===b&&(b=1-this._epsilon)),this._vertexData[L++]=p,this._vertexData[L++]=b)}_prepareParticle(a){}_update(a){if(this._alive=this.Dj.length>0,this.j.position){const a=this.j;this._emitterWorldMatrix=a.getWorldMatrix()}else{const a=this.j;this._emitterWorldMatrix=P.e.Translation(a.x,a.y,a.z)}let v;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Dj);for(let p=0;p<a&&this.Dj.length!==this._capacity;p++){if(v=this._createParticle(),this.Dj.push(v),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const a=(0,C.e)(this._actualFrame/this.targetStopDuration);W.GetCurrentGradient(a,this._lifeTimeGradients,((p,P)=>{const b=p,L=P,t=b.getFactor(),V=L.getFactor(),K=(a-b.gradient)/(L.gradient-b.gradient);v.lifeTime=(0,C.l)(t,V,K)}))}else v.lifeTime=(0,C.r)(this.minLifeTime,this.maxLifeTime);const a=(0,C.r)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,v.position,v,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,v.position,v,this.isLocal),this.isLocal&&(v.oe?v.oe.p(v.position):v.oe=v.position.clone(),P.s.TransformCoordinatesToRef(v.oe,this._emitterWorldMatrix,v.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,v.direction,v,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,v.direction,v,this.isLocal,this._emitterInverseWorldMatrix),0===a?v._initialDirection?v._initialDirection.p(v.direction):v._initialDirection=v.direction.clone():v._initialDirection=null,v.direction.scaleInPlace(a),this._sizeGradients&&0!==this._sizeGradients.length?(v._currentSizeGradient=this._sizeGradients[0],v._currentSize1=v._currentSizeGradient.getFactor(),v.size=v._currentSize1,this._sizeGradients.length>1?v._currentSize2=this._sizeGradients[1].getFactor():v._currentSize2=v._currentSize1):v.size=(0,C.r)(this.minSize,this.maxSize),v.scale.qe((0,C.r)(this.minScaleX,this.maxScaleX),(0,C.r)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const a=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(a,this._startSizeGradients,((a,p,P)=>{a!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=p.getFactor(),this._currentStartSizeGradient=a);const b=(0,C.l)(this._currentStartSize1,this._currentStartSize2,P);v.scale.scaleInPlace(b)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(v._currentAngularSpeedGradient=this._angularSpeedGradients[0],v.angularSpeed=v._currentAngularSpeedGradient.getFactor(),v._currentAngularSpeed1=v.angularSpeed,this._angularSpeedGradients.length>1?v._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():v._currentAngularSpeed2=v._currentAngularSpeed1):v.angularSpeed=(0,C.r)(this.minAngularSpeed,this.maxAngularSpeed),v.angle=(0,C.r)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(v._currentVelocityGradient=this._velocityGradients[0],v._currentVelocity1=v._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?v._currentVelocity2=this._velocityGradients[1].getFactor():v._currentVelocity2=v._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(v._currentLimitVelocityGradient=this._limitVelocityGradients[0],v._currentLimitVelocity1=v._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?v._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():v._currentLimitVelocity2=v._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(v._currentDragGradient=this._dragGradients[0],v._currentDrag1=v._currentDragGradient.getFactor(),this._dragGradients.length>1?v._currentDrag2=this._dragGradients[1].getFactor():v._currentDrag2=v._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)v._currentColorGradient=this._colorGradients[0],v._currentColorGradient.getColorToRef(v.color),v._currentColor1.p(v.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(v._currentColor2):v._currentColor2.p(v.color);else{const a=(0,C.r)(0,1);t.e.LerpToRef(this.color1,this.color2,a,v.color),this.colorDead.subtractToRef(v.color,this._colorDiff),this._colorDiff.scaleToRef(1/v.lifeTime,v.colorStep)}this._isAnimationSheetEnabled&&(v._initialStartSpriteCellID=this.startSpriteCellID,v._initialEndSpriteCellID=this.endSpriteCellID,v._initialSpriteCellLoop=this.spriteCellLoop),v.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(v.remapData=new P.t(0,1,0,1)),this.noiseTexture&&(v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.qe(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2.qe(Math.random(),Math.random(),Math.random())):(v._randomNoiseCoordinates1=new P.s(Math.random(),Math.random(),Math.random()),v._randomNoiseCoordinates2=new P.s(Math.random(),Math.random(),Math.random()))),v._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=[D.f.PositionKind,D.f.ColorKind,"angle","offset","size"];return a&&P.push("cellIndex"),v||P.push("direction"),p&&P.push("remapData"),P}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,va.e)(P),a&&P.push("particlesInfos"),v&&P.push("logarithmicDepthConstant"),p&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,va.m)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&a.push("#define FOG")),this._isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),v===K.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&a.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case 2:a.push("#define BILLBOARDY");break;case 8:case 9:a.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&a.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:a.push("#define BILLBOARDMODE_ALL")}p&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,v,p){v.push(...ba._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),a.push(...ba._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),p.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Pa.g)(a,this._imageProcessingConfigurationDefines),(0,Pa.d)(p,this._imageProcessingConfigurationDefines))}_getWrapper(a){const v=this._getCustomDrawWrapper(a);if(null!==v&&void 0!==v&&v.effect)return v;const p=[];this.fillDefines(p,a);const P=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let b=this._drawWrappers[P];b||(b=this._drawWrappers[P]=[]);let L=b[a];L||(L=new aa.e(this._engine),L.drawContext&&(L.drawContext.useInstancing=this._useInstancing),b[a]=L);const t=p.join("\n");if(L.defines!==t){const a=[],v=[],p=[];this.fillUniformsAttributesAndSamplerNames(v,a,p),L.setEffect(this._engine.createEffect("particles",a,v,p,t,void 0,void 0,void 0,void 0,this._shaderLanguage),t)}return L}animate(){var a;let v,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!p&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(p?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this.manualEmitCount>-1)v=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let a=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(v,this._emitRateGradients,((v,p,P)=>{v!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=p.getFactor(),this._currentEmitRateGradient=v),a=(0,C.l)(this._currentEmitRate1,this._currentEmitRate2,P)}))}v=a*this._scaledUpdateSpeed|0,this._newPartsExcess+=a*this._scaledUpdateSpeed-v}if(this._newPartsExcess>1&&(v+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?v=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(v),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!p){let a=0;for(let v=0;v<this.Dj.length;v++){const p=this.Dj[v];this._appendParticleVertices(a,p),a+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Dj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(a,v){this._appendParticleVertex(a++,v,0,0),this._useInstancing||(this._appendParticleVertex(a++,v,1,0),this._appendParticleVertex(a++,v,1,1),this._appendParticleVertex(a++,v,0,1))}rebuild(){var a;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(a=this._spriteBuffer)||void 0===a||a._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!ba.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(p.bind(p,11926)),Promise.resolve().then(p.bind(p,11881))])):await Promise.all([Promise.resolve().then(p.bind(p,11864)),Promise.resolve().then(p.bind(p,11851))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==K.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(K.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(K.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(a){const v=this._getWrapper(a),p=v.effect,b=this._engine;b.enableEffect(v);const L=this.defaultViewMatrix??this._scene.getViewMatrix();if(p.setTexture("diffuseSampler",this.particleTexture),p.setMatrix("view",L),p.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();p.setFloat3("particlesInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,this.spriteCellWidth/a.width)}if(p.setVector2("translationPivot",this.translationPivot),p.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;p.setVector3("eyePosition",a.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),p.setTexture("rampSampler",this._rampGradientsTexture));const t=p.defines;var V,C,F,u,c,f;(this._scene&&((0,va.g)(p,this,this._scene),this.applyFog&&(0,pa.c)(this._scene,void 0,p)),t.indexOf("#define BILLBOARDMODE_ALL")>=0&&(L.invertToRef(P.k.Matrix[0]),p.setMatrix("invView",P.k.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?b.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,p):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,p)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?b.bindBuffers(this._vertexBuffers,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBuffer:this._indexBuffer,p):b.bindBuffers(this._vertexBuffers,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null,p);switch(this.useLogarithmicDepth&&this._scene&&(0,pa.j)(t,p,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),a){case K.BLENDMODE_ADD:b.setAlphaMode(1);break;case K.BLENDMODE_ONEONE:b.setAlphaMode(6);break;case K.BLENDMODE_STANDARD:b.setAlphaMode(2);break;case K.BLENDMODE_MULTIPLY:b.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),this._useInstancing)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?b.drawElementsType(6,0,10,this.Dj.length):b.drawArraysType(7,0,4,this.Dj.length):null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?b.drawElementsType(1,0,10*this.Dj.length):b.drawElementsType(0,0,6*this.Dj.length);return this.Dj.length}render(){if(!this.isReady()||!this.Dj.length)return 0;const a=this._engine;a.setState&&(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0));let v=0;return v=this.blendMode===K.BLENDMODE_MULTIPLYADD?this._render(K.BLENDMODE_MULTIPLY)+this._render(K.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),v}_onDispose(){}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(v,p),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const a=this._scene.Bj.indexOf(this);a>-1&&this._scene.Bj.splice(a,1),this._scene._activeParticleSystems.dispose()}this.uj.notifyObservers(this),this.uj.clear(),this.onStoppedObservable.clear(),this.reset()}}ba.ForceGLSL=!1;var La,ta=p(10926);!function(a){a[a.ATTACHED=0]="ATTACHED",a[a.END=1]="END"}(La||(La={}));class Va{constructor(a){if(this.particleSystem=a,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!a.j||!a.j.dispose){const v=(0,V.c)("BABYLON.AbstractMesh");a.j=new v("SubemitterSystemEmitter",a.va()),a._disposeEmitterOnDispose=!0}}clone(){let a=this.particleSystem.j;if(a){if(a instanceof P.s)a=a.clone();else if(-1!==a.getClassName().indexOf("Mesh")){a=new((0,V.c)("BABYLON.Mesh"))("",a.va()),a.isVisible=!1}}else a=new P.s;const v=new Va(this.particleSystem.clone(this.particleSystem.name,a));return v.particleSystem.name+="Clone",v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem._disposeEmitterOnDispose=!0,v.particleSystem.disposeOnStop=!0,v}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return v.type=this.type,v.inheritDirection=this.inheritDirection,v.inheritedVelocityAmount=this.inheritedVelocityAmount,v.particleSystem=this.particleSystem.serialize(a),v}static _ParseParticleSystem(a,v,p){throw(0,ta.c)("ParseParticle")}static Parse(a,v,p){const P=a.particleSystem,b=new Va(Va._ParseParticleSystem(P,v,p,!0));return b.type=a.type,b.inheritDirection=a.inheritDirection,b.inheritedVelocityAmount=a.inheritedVelocityAmount,b.particleSystem._isSubEmitter=!0,b}dispose(){this.particleSystem.dispose()}}var Ka=p(10974);function Ca(a,v){const p=new R;return p.direction1=a,p.direction2=v,p}function Fa(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ua(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ca(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.s(0,1,0),p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0);return new Q(a,v,p)}function fa(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Ha(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0),L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.s(0,1,0);return new A(a,v,p,b,L)}function Aa(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new c(a,v)}function ha(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0);return new f(a,v,p,b)}class Ra extends ba{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=a=>{if(!this._subEmitters||0===this._subEmitters.length)return;const v=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[v].forEach((v=>{if(1===v.type){const p=v.clone();a._inheritParticleInfoToSubEmitter(p),p.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(p.particleSystem),p.particleSystem.start()}}))}}createPointEmitter(a,v){const p=Ca(a,v);return this.particleEmitterType=p,p}createHemisphericEmitter(){const a=Fa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=ua(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=ca(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.s(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=fa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=Ha(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.s(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=Aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=ha(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,v,p,P){const b=new u;return this.particleEmitterType=b,this.direction1=a,this.direction2=v,this.minEmitBox=p,this.maxEmitBox=P,b}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((a=>{a instanceof Ra?this._subEmitters.push([new Va(a)]):a instanceof Va?this._subEmitters.push([a]):a instanceof Array&&this._subEmitters.push(a)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((a=>{a.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const a=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==a&&this._rootParticleSystem.activeSubSystems.splice(a,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(a){a&&this._stopSubEmitters()}_prepareParticle(a){if(this._subEmitters&&this._subEmitters.length>0){const v=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];a._attachedSubEmitters=[],v.forEach((v=>{if(0===v.type){const p=v.clone();a._attachedSubEmitters.push(p),p.particleSystem.start()}}))}}_onDispose(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var p;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),a)&&(null===(p=this.particles)||void 0===p||p.forEach((a=>{if(a._attachedSubEmitters)for(let v=a._attachedSubEmitters.length-1;v>=0;v-=1)a._attachedSubEmitters[v].dispose()})));if(v&&this.activeSubSystems)for(let P=this.activeSubSystems.length-1;P>=0;P-=1)this.activeSubSystems[P].dispose();if(this._subEmitters&&this._subEmitters.length){for(let a=0;a<this._subEmitters.length;a++)for(const v of this._subEmitters[a])v.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(a,v,p,b){let L;L=p instanceof Ka.e?null:p;const K=(0,V.c)("BABYLON.Texture");if(K&&L&&(a.texture?v.particleTexture=K.Parse(a.texture,L,b):a.textureName&&(v.particleTexture=new K(b+a.textureName,L,!1,void 0===a.invertY||a.invertY),v.particleTexture.name=a.textureName)),a.emitterId||0===a.emitterId||void 0!==a.j?a.emitterId&&L?v.j=L.getLastMeshById(a.emitterId):v.j=P.s.bh(a.j):v.j=P.s.Zero(),v.isLocal=!!a.isLocal,void 0!==a.renderingGroupId&&(v.renderingGroupId=a.renderingGroupId),void 0!==a.isBillboardBased&&(v.isBillboardBased=a.isBillboardBased),void 0!==a.billboardMode&&(v.billboardMode=a.billboardMode),void 0!==a.useLogarithmicDepth&&(v.useLogarithmicDepth=a.useLogarithmicDepth),a.animations){for(let p=0;p<a.animations.length;p++){const P=a.animations[p],b=(0,V.c)("BABYLON.Animation");b&&v.animations.push(b.Parse(P))}v.beginAnimationOnStart=a.beginAnimationOnStart,v.beginAnimationFrom=a.beginAnimationFrom,v.beginAnimationTo=a.beginAnimationTo,v.beginAnimationLoop=a.beginAnimationLoop}if(a.autoAnimate&&L&&L.beginAnimation(v,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),v.startDelay=0|a.startDelay,v.minAngularSpeed=a.minAngularSpeed,v.maxAngularSpeed=a.maxAngularSpeed,v.minSize=a.minSize,v.maxSize=a.maxSize,a.minScaleX&&(v.minScaleX=a.minScaleX,v.maxScaleX=a.maxScaleX,v.minScaleY=a.minScaleY,v.maxScaleY=a.maxScaleY),void 0!==a.preWarmCycles&&(v.preWarmCycles=a.preWarmCycles,v.preWarmStepOffset=a.preWarmStepOffset),void 0!==a.minInitialRotation&&(v.minInitialRotation=a.minInitialRotation,v.maxInitialRotation=a.maxInitialRotation),v.minLifeTime=a.minLifeTime,v.maxLifeTime=a.maxLifeTime,v.minEmitPower=a.minEmitPower,v.maxEmitPower=a.maxEmitPower,v.emitRate=a.emitRate,v.gravity=P.s.bh(a.gravity),a.noiseStrength&&(v.noiseStrength=P.s.bh(a.noiseStrength)),v.color1=t.e.bh(a.color1),v.color2=t.e.bh(a.color2),v.colorDead=t.e.bh(a.colorDead),v.updateSpeed=a.updateSpeed,v.targetStopDuration=a.targetStopDuration,v.blendMode=a.blendMode,a.colorGradients)for(const P of a.colorGradients)v.addColorGradient(P.gradient,t.e.bh(P.color1),P.color2?t.e.bh(P.color2):void 0);if(a.rampGradients){for(const p of a.rampGradients)v.addRampGradient(p.gradient,t.d.bh(p.color));v.useRampGradients=a.useRampGradients}if(a.colorRemapGradients)for(const P of a.colorRemapGradients)v.addColorRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.alphaRemapGradients)for(const P of a.alphaRemapGradients)v.addAlphaRemapGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.sizeGradients)for(const P of a.sizeGradients)v.addSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.angularSpeedGradients)for(const P of a.angularSpeedGradients)v.addAngularSpeedGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.velocityGradients)for(const P of a.velocityGradients)v.addVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.dragGradients)for(const P of a.dragGradients)v.addDragGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.emitRateGradients)for(const P of a.emitRateGradients)v.addEmitRateGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.startSizeGradients)for(const P of a.startSizeGradients)v.addStartSizeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.lifeTimeGradients)for(const P of a.lifeTimeGradients)v.addLifeTimeGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);if(a.limitVelocityGradients){for(const p of a.limitVelocityGradients)v.addLimitVelocityGradient(p.gradient,void 0!==p.factor1?p.factor1:p.factor,p.factor2);v.limitVelocityDamping=a.limitVelocityDamping}if(a.noiseTexture&&L){const p=(0,V.c)("BABYLON.ProceduralTexture");v.noiseTexture=p.Parse(a.noiseTexture,L,b)}let C;if(a.particleEmitterType){switch(a.particleEmitterType.type){case"SphereParticleEmitter":C=new X;break;case"SphereDirectedParticleEmitter":C=new Q;break;case"ConeEmitter":case"ConeParticleEmitter":C=new c;break;case"ConeDirectedParticleEmitter":C=new f;break;case"CylinderParticleEmitter":C=new H;break;case"CylinderDirectedParticleEmitter":C=new A;break;case"HemisphericParticleEmitter":C=new h;break;case"PointParticleEmitter":C=new R;break;case"MeshParticleEmitter":C=new y;break;case"CustomParticleEmitter":C=new s;break;default:C=new u}C.parse(a.particleEmitterType,L)}else C=new u,C.parse(a,L);v.particleEmitterType=C,v.startSpriteCellID=a.startSpriteCellID,v.endSpriteCellID=a.endSpriteCellID,v.spriteCellLoop=a.spriteCellLoop??!0,v.spriteCellWidth=a.spriteCellWidth,v.spriteCellHeight=a.spriteCellHeight,v.spriteCellChangeSpeed=a.spriteCellChangeSpeed,v.spriteRandomStartCell=a.spriteRandomStartCell,v.disposeOnStop=a.disposeOnStop??!1,v.manualEmitCount=a.manualEmitCount??-1}static Parse(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const V=a.name;let K,C,F=null,u=null;if(v instanceof Ka.e?K=v:(C=v,K=C.getEngine()),a.customShader&&K.createEffectForParticles){u=a.customShader;const v=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";F=K.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,v)}const c=new Ra(V,L||a.ub,v,F,a.isAnimationSheetEnabled);if(c.customShader=u,c._rootUrl=p,a.id&&(c.id=a.id),a.subEmitters){c.subEmitters=[];for(const P of a.subEmitters){const a=[];for(const b of P)a.push(Va.Parse(b,v,p));c.subEmitters.push(a)}}return Ra._Parse(a,c,v,p),a.textureMask&&(c.textureMask=t.e.bh(a.textureMask)),a.lg&&(c.lg=P.s.bh(a.lg)),a.preventAutoStart&&(c.preventAutoStart=a.preventAutoStart),b||c.preventAutoStart||c.start(),c}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};if(Ra._Serialize(v,this,a),v.textureMask=this.textureMask.tj(),v.customShader=this.customShader,v.preventAutoStart=this.preventAutoStart,v.lg=this.lg.tj(),this.subEmitters){v.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const p of this._subEmitters){const P=[];for(const v of p)P.push(v.serialize(a));v.subEmitters.push(P)}}return v}static _Serialize(a,v,p){if(a.name=v.name,a.id=v.id,a.ub=v.getCapacity(),a.disposeOnStop=v.disposeOnStop,a.manualEmitCount=v.manualEmitCount,v.j.position){const p=v.j;a.emitterId=p.id}else{const p=v.j;a.j=p.tj()}v.particleEmitterType&&(a.particleEmitterType=v.particleEmitterType.serialize()),v.particleTexture&&(p?a.texture=v.particleTexture.serialize():(a.textureName=v.particleTexture.name,a.invertY=!!v.particleTexture._invertY)),a.isLocal=v.isLocal,x.b.AppendSerializedAnimations(v,a),a.beginAnimationOnStart=v.beginAnimationOnStart,a.beginAnimationFrom=v.beginAnimationFrom,a.beginAnimationTo=v.beginAnimationTo,a.beginAnimationLoop=v.beginAnimationLoop,a.startDelay=v.startDelay,a.renderingGroupId=v.renderingGroupId,a.isBillboardBased=v.isBillboardBased,a.billboardMode=v.billboardMode,a.minAngularSpeed=v.minAngularSpeed,a.maxAngularSpeed=v.maxAngularSpeed,a.minSize=v.minSize,a.maxSize=v.maxSize,a.minScaleX=v.minScaleX,a.maxScaleX=v.maxScaleX,a.minScaleY=v.minScaleY,a.maxScaleY=v.maxScaleY,a.minEmitPower=v.minEmitPower,a.maxEmitPower=v.maxEmitPower,a.minLifeTime=v.minLifeTime,a.maxLifeTime=v.maxLifeTime,a.emitRate=v.emitRate,a.gravity=v.gravity.tj(),a.noiseStrength=v.noiseStrength.tj(),a.color1=v.color1.tj(),a.color2=v.color2.tj(),a.colorDead=v.colorDead.tj(),a.updateSpeed=v.updateSpeed,a.targetStopDuration=v.targetStopDuration,a.blendMode=v.blendMode,a.preWarmCycles=v.preWarmCycles,a.preWarmStepOffset=v.preWarmStepOffset,a.minInitialRotation=v.minInitialRotation,a.maxInitialRotation=v.maxInitialRotation,a.startSpriteCellID=v.startSpriteCellID,a.spriteCellLoop=v.spriteCellLoop,a.endSpriteCellID=v.endSpriteCellID,a.spriteCellChangeSpeed=v.spriteCellChangeSpeed,a.spriteCellWidth=v.spriteCellWidth,a.spriteCellHeight=v.spriteCellHeight,a.spriteRandomStartCell=v.spriteRandomStartCell,a.isAnimationSheetEnabled=v.isAnimationSheetEnabled,a.useLogarithmicDepth=v.useLogarithmicDepth;const P=v.getColorGradients();if(P){a.colorGradients=[];for(const v of P){const p={gradient:v.gradient,color1:v.color1.tj()};v.color2?p.color2=v.color2.tj():p.color2=v.color1.tj(),a.colorGradients.push(p)}}const b=v.getRampGradients();if(b){a.rampGradients=[];for(const v of b){const p={gradient:v.gradient,color:v.color.tj()};a.rampGradients.push(p)}a.useRampGradients=v.useRampGradients}const L=v.getColorRemapGradients();if(L){a.colorRemapGradients=[];for(const v of L){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.colorRemapGradients.push(p)}}const t=v.getAlphaRemapGradients();if(t){a.alphaRemapGradients=[];for(const v of t){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.alphaRemapGradients.push(p)}}const V=v.getSizeGradients();if(V){a.sizeGradients=[];for(const v of V){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.sizeGradients.push(p)}}const K=v.getAngularSpeedGradients();if(K){a.angularSpeedGradients=[];for(const v of K){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.angularSpeedGradients.push(p)}}const C=v.getVelocityGradients();if(C){a.velocityGradients=[];for(const v of C){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.velocityGradients.push(p)}}const F=v.getDragGradients();if(F){a.dragGradients=[];for(const v of F){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.dragGradients.push(p)}}const u=v.getEmitRateGradients();if(u){a.emitRateGradients=[];for(const v of u){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.emitRateGradients.push(p)}}const c=v.getStartSizeGradients();if(c){a.startSizeGradients=[];for(const v of c){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.startSizeGradients.push(p)}}const f=v.getLifeTimeGradients();if(f){a.lifeTimeGradients=[];for(const v of f){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.lifeTimeGradients.push(p)}}const H=v.getLimitVelocityGradients();if(H){a.limitVelocityGradients=[];for(const v of H){const p={gradient:v.gradient,factor1:v.factor1};void 0!==v.factor2?p.factor2=v.factor2:p.factor2=v.factor1,a.limitVelocityGradients.push(p)}a.limitVelocityDamping=v.limitVelocityDamping}v.noiseTexture&&(a.noiseTexture=v.noiseTexture.serialize())}clone(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let b=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){b=this.customShader;const a=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",v=L.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,a);P[0]?P[0].effect=v:this.setCustomEffect(v,0)}const t=this.serialize(p),V=Ra.Parse(t,this._scene||this._engine,this._rootUrl);return V.name=a,V.customShader=b,V._customWrappers=P,void 0===v&&(v=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=v,this.preventAutoStart||V.start(),V}}Ra.BILLBOARDMODE_Y=2,Ra.BILLBOARDMODE_ALL=7,Ra.BILLBOARDMODE_STRETCHED=8,Ra.BILLBOARDMODE_STRETCHED_LOCAL=9,Va._ParseParticleSystem=Ra.Parse;var Xa=p(11271),Qa=p(11229),sa=p(11692);sa.e.prototype.createTransformFeedback=function(){const a=this._gl.createTransformFeedback();if(!a)throw new Error("Unable to create Transform Feedback");return a},sa.e.prototype.deleteTransformFeedback=function(a){this._gl.deleteTransformFeedback(a)},sa.e.prototype.bindTransformFeedback=function(a){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,a)},sa.e.prototype.beginTransformFeedback=function(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(a?this._gl.POINTS:this._gl.TRIANGLES)},sa.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},sa.e.prototype.setTranformFeedbackVaryings=function(a,v){this._gl.transformFeedbackVaryings(a,v,this._gl.INTERLEAVED_ATTRIBS)},sa.e.prototype.bindTransformFeedbackBuffer=function(a){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a?a.underlyingResource:null)},sa.e.prototype.readTransformFeedbackBuffer=function(a){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a)};const Da="clipPlaneFragmentDeclaration2",ya="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";S.e.IncludesShadersStore[Da]=ya;p(11784),p(11786),p(11791),p(11794),p(11802),p(11805),p(11809),p(11811);const Za="gpuRenderParticlesPixelShader",Ma="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";S.e.ShadersStore[Za]=Ma;const Sa="clipPlaneVertexDeclaration2",na="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";S.e.IncludesShadersStore[Sa]=na;p(11815),p(11821),p(11823),p(11826);const qa="gpuRenderParticlesVertexShader",Ta="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";S.e.ShadersStore[qa]=Ta;class ja extends K{static get IsSupported(){if(!i.b.LastCreatedEngine)return!1;const a=i.b.LastCreatedEngine.getCaps();return a.supportTransformFeedbacks||a.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(a){this._maxActiveParticleCount=Math.min(a,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(a){this.maxActiveParticleCount=a}createPointEmitter(a,v){const p=Ca(a,v);return this.particleEmitterType=p,p}createHemisphericEmitter(){const a=Fa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=ua(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=ca(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P.s(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=fa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=Ha(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new P.s(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=Aa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=ha(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P.s(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.s(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,v,p,P){const b=new u;return this.particleEmitterType=b,this.direction1=a,this.direction2=v,this.minEmitBox=p,this.maxEmitBox=P,b}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Ra.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Ra.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Ra.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";a?setTimeout((()=>{this.start(0)}),a):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var a;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[v])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[v]=new aa.e(this._engine),this._customWrappers[v].effect=a}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new U.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(a,v,p){return super._removeGradientAndTexture(a,v,p),this._releaseBuffers(),this}addColorGradient(a,v){this._colorGradients||(this._colorGradients=[]);const p=new k(a,v);return this._colorGradients.push(p),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(a&&this._colorGradients.sort(((a,v)=>a.gradient<v.gradient?-1:a.gradient>v.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(a){return this._removeGradientAndTexture(a,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const v in this._drawWrappers){var a;null===(a=this._drawWrappers[v].drawContext)||void 0===a||a.reset()}}_addFactorGradient(a,v,p){const P=new E(v,p);a.push(P),this._releaseBuffers()}addSizeGradient(a,v){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,v),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(a){return this._removeGradientAndTexture(a,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(a,v){if(!a)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&a.sort(((a,v)=>a.gradient<v.gradient?-1:a.gradient>v.gradient?1:0));const p=this;p[v]&&(p[v].dispose(),p[v]=null)}addAngularSpeedGradient(a,v){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,v),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(a){return this._removeGradientAndTexture(a,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(a,v){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,v),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(a){return this._removeGradientAndTexture(a,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(a,v){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,v),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(a){return this._removeGradientAndTexture(a,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(a,v){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,v),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(a){return this._removeGradientAndTexture(a,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(a){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(a),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.uj=new U.c,this.onStoppedObservable=new U.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,p&&"Scene"!==p.getClassName()?(this._engine=p,this.defaultProjectionMatrix=P.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=p||i.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Bj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,V.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,V.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,V.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=b,this._drawWrappers={0:new aa.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(v=v??{}).randomTextureSize||delete v.randomTextureSize;const t={ub:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...v},K=v;isFinite(K)&&(t.ub=K),this._capacity=t.ub,this._maxActiveParticleCount=t.ub,this._currentActiveCount=0,this._isAnimationSheetEnabled=L,this.particleEmitterType=new u;const C=Math.min(this._engine.getCaps().maxTextureSize,t.randomTextureSize);let F=[];for(let P=0;P<C;++P)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture=new N.d(new Float32Array(F),C,1,5,p,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,F=[];for(let P=0;P<C;++P)F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random());this._randomTexture2=new N.d(new Float32Array(F),C,1,5,p,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=C}_reset(){this._releaseBuffers()}_createVertexBuffers(a,v,p){const P={};P.position=v.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let b=3;P.age=v.createVertexBuffer("age",b,1,this._attributesStrideSize,!0),b+=1,P.size=v.createVertexBuffer("size",b,3,this._attributesStrideSize,!0),b+=3,P.life=v.createVertexBuffer("life",b,1,this._attributesStrideSize,!0),b+=1,b+=4,this.billboardMode===Ra.BILLBOARDMODE_STRETCHED&&(P.direction=v.createVertexBuffer("direction",b,3,this._attributesStrideSize,!0)),b+=3,this._platform.alignDataInBuffer&&(b+=1),this.particleEmitterType instanceof s&&(b+=3,this._platform.alignDataInBuffer&&(b+=1)),this._colorGradientsTexture||(P.color=v.createVertexBuffer("color",b,4,this._attributesStrideSize,!0),b+=4),this._isBillboardBased||(P.initialDirection=v.createVertexBuffer("initialDirection",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),this.noiseTexture&&(P.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1),P.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),P.angle=v.createVertexBuffer("angle",b,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?b++:b+=2,this._isAnimationSheetEnabled&&(P.cellIndex=v.createVertexBuffer("cellIndex",b,1,this._attributesStrideSize,!0),b+=1,this.spriteRandomStartCell&&(P.cellStartOffset=v.createVertexBuffer("cellStartOffset",b,1,this._attributesStrideSize,!0),b+=1)),P.offset=p.createVertexBuffer("offset",0,2),P.uv=p.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(P),this._platform.createVertexBuffers(a,P),this.resetDrawCache()}_initialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!a)return;const v=this._engine,p=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const b=this.particleEmitterType instanceof s,L=P.k.fb[0];let t=0;for(let P=0;P<this._capacity;P++)if(p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(0),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),b?(this.particleEmitterType.particleDestinationGenerator(P,null,L),p.push(L.x),p.push(L.y),p.push(L.z)):(p.push(0),p.push(0),p.push(0)),this._platform.alignDataInBuffer&&p.push(0),t+=16,b&&(this.particleEmitterType.particlePositionGenerator(P,null,L),p.push(L.x),p.push(L.y),p.push(L.z),this._platform.alignDataInBuffer&&p.push(0),t+=4),this._colorGradientsTexture||(p.push(0),p.push(0),p.push(0),p.push(0),t+=4),this.isBillboardBased||(p.push(0),p.push(0),p.push(0),this._platform.alignDataInBuffer&&p.push(0),t+=4),this.noiseTexture&&(p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),this._platform.alignDataInBuffer&&p.push(0),p.push(Math.random()),p.push(Math.random()),p.push(Math.random()),this._platform.alignDataInBuffer&&p.push(0),t+=8),p.push(0),t+=1,this._angularSpeedGradientsTexture||(p.push(0),t+=1),this._isAnimationSheetEnabled&&(p.push(0),t+=1,this.spriteRandomStartCell&&(p.push(0),t+=1)),this._platform.alignDataInBuffer){let a=3-(t+3&3);for(t+=a;a-- >0;)p.push(0)}const V=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),K=this._platform.createParticleBuffer(p),C=this._platform.createParticleBuffer(p);this._buffer0=new D.b(v,K,!1,this._attributesStrideSize),this._buffer1=new D.b(v,C,!1,this._attributesStrideSize),this._spriteBuffer=new D.b(v,V,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let a=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(a+="\n#define BILLBOARD"),this._colorGradientsTexture&&(a+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(a+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(a+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(a+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(a+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(a+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(a+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(a+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(a+="\n#define NOISE"),this.isLocal&&(a+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===a||(this._cachedUpdateDefines=a,this._updateBuffer=this._platform.createUpdateBuffer(a)),this._platform.isUpdateBufferReady()}_getWrapper(a){const v=this._getCustomDrawWrapper(a);if(null!==v&&void 0!==v&&v.effect)return v;const p=[];this.fillDefines(p,a);let P=this._drawWrappers[a];P||(P=new aa.e(this._engine),P.drawContext&&(P.drawContext.useInstancing=!0),this._drawWrappers[a]=P);const b=p.join("\n");if(P.defines!==b){const a=[],v=[],p=[];this.fillUniformsAttributesAndSamplerNames(v,a,p),P.setEffect(this._engine.createEffect("gpuRenderParticles",a,v,p,b),b)}return P}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=[D.f.PositionKind,"age","life","size","angle"];return a||b.push(D.f.ColorKind),v&&b.push("cellIndex"),p||b.push("initialDirection"),P&&b.push("direction"),b.push("offset",D.f.UVKind),b}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=["emitterWM","lg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,va.e)(P),a&&P.push("sheetInfos"),v&&P.push("logarithmicDepthConstant"),p&&(P.push("vFogInfos"),P.push("vFogColor")),P}fillDefines(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,va.m)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Qa.c.FOGMODE_NONE&&a.push("#define FOG")),v===Ra.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this.isLocal&&a.push("#define LOCAL"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case Ra.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case Ra.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case Ra.BILLBOARDMODE_ALL:a.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&a.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),p&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,v,p){v.push(...ja._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Ra.BILLBOARDMODE_STRETCHED)),a.push(...ja._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),p.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Xa.c.PrepareUniforms(a,this._imageProcessingConfigurationDefines),Xa.c.PrepareSamplers(p,this._imageProcessingConfigurationDefines))}animate(){var a;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(v?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(a,v){const p=this[v];if(!a||!a.length||p)return;const P=new Float32Array(this._rawTextureWidth);for(let b=0;b<this._rawTextureWidth;b++){const v=b/this._rawTextureWidth;W.GetCurrentGradient(v,a,((a,v,p)=>{P[b]=(0,C.l)(a.factor1,v.factor1,p)}))}this[v]=N.d.CreateRTexture(P,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[v].name=v.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const a=new Uint8Array(4*this._rawTextureWidth),v=t.h.pb[0];for(let p=0;p<this._rawTextureWidth;p++){const P=p/this._rawTextureWidth;W.GetCurrentGradient(P,this._colorGradients,((P,b,L)=>{t.e.LerpToRef(P.color1,b.color1,L,v),a[4*p]=255*v.r,a[4*p+1]=255*v.g,a[4*p+2]=255*v.b,a[4*p+3]=255*v.a}))}this._colorGradientsTexture=N.d.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(a,v){var p,b,L,t;const V=this._getWrapper(a),K=V.effect;this._engine.enableEffect(V);const C=(null===(p=this._scene)||void 0===p?void 0:p.getViewMatrix())||P.e.IdentityReadOnly;if(K.setMatrix("view",C),K.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),K.setTexture("diffuseSampler",this.particleTexture),K.setVector2("translationPivot",this.translationPivot),K.setVector3("lg",this.lg),this.isLocal&&K.setMatrix("emitterWM",v),this._colorGradientsTexture?K.setTexture("colorGradientSampler",this._colorGradientsTexture):K.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();K.setFloat3("sheetInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,a.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;K.setVector3("eyePosition",a.globalPosition)}const F=K.defines;if(this._scene&&((0,va.g)(K,this,this._scene),this.applyFog&&(0,pa.c)(this._scene,void 0,K)),F.indexOf("#define BILLBOARDMODE_ALL")>=0){const a=C.clone();a.invert(),K.setMatrix("invView",a)}switch(this.useLogarithmicDepth&&this._scene&&(0,pa.j)(F,K,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(K),a){case Ra.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case Ra.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case Ra.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case Ra.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,K,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(K),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(a){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!a)if(this.j.position){a=this.j.getWorldMatrix()}else{const v=this.j;a=P.k.Matrix[0],P.e.TranslationToRef(v.x,v.y,v.z,a)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",a),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const v=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=v}render(){let a,v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!v&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const a=0|this._accumulatedCount;this._accumulatedCount-=a,this._currentActiveCount+=a}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){a=this.j.getWorldMatrix()}else{const v=this.j;a=P.k.Matrix[0],P.e.TranslationToRef(v.x,v.y,v.z,a)}const b=this._engine;this.updateInAnimate||this._update(a);let L=0;return v||p||(b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0),L=this.blendMode===Ra.BLENDMODE_MULTIPLYADD?this._render(Ra.BLENDMODE_MULTIPLY,a)+this._render(Ra.BLENDMODE_ADD,a):this._render(this.blendMode,a),this._engine.setAlphaMode(0)),L}rebuild(){const a=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(a,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,a()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const v in this._drawWrappers){this._drawWrappers[v].dispose()}if(this._drawWrappers={},this._scene){const a=this._scene.Bj.indexOf(this);a>-1&&this._scene.Bj.splice(a,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let v=0;v<this._renderVertexBuffers.length;++v){const a=this._renderVertexBuffers[v];for(const v in a)a[v].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.uj.notifyObservers(this),this.uj.clear()}clone(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P={...this._customWrappers};let b=null;const L=this._engine;if(L.createEffectForParticles&&null!=this.customShader){b=this.customShader;const a=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";P[0]=L.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,a,void 0,void 0,void 0,this)}const t=this.serialize(p),V=ja.Parse(t,this._scene||this._engine,this._rootUrl);return V.name=a,V.customShader=b,V._customWrappers=P,void 0===v&&(v=this.j),this.noiseTexture&&(V.noiseTexture=this.noiseTexture.clone()),V.j=v,V}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={};return Ra._Serialize(v,this,a),v.activeParticleCount=this.activeParticleCount,v.randomTextureSize=this._randomTextureSize,v.customShader=this.customShader,v}static Parse(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0;const L=a.name;let t,V;v instanceof Ka.e?t=v:(V=v,t=V.getEngine());const K=new ja(L,{ub:b||a.ub,randomTextureSize:a.randomTextureSize},v,null,a.isAnimationSheetEnabled);if(K._rootUrl=p,a.customShader&&t.createEffectForParticles){const v=a.customShader,p=v.shaderOptions.defines.length>0?v.shaderOptions.defines.join("\n"):"",P=t.createEffectForParticles(v.shaderPath.fragmentElement,v.shaderOptions.uniforms,v.shaderOptions.samplers,p,void 0,void 0,void 0,K);K.setCustomEffect(P,0),K.customShader=v}return a.id&&(K.id=a.id),a.activeParticleCount&&(K.activeParticleCount=a.activeParticleCount),Ra._Parse(a,K,v,p),a.preventAutoStart&&(K.preventAutoStart=a.preventAutoStart),P||K.preventAutoStart||K.start(),K}}var wa=p(10889),Ja=p(11834),Ba=p(11203);class xa{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(a){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const v of this.systems)v.j=a;this._emitterNode=a}setEmitterAsSphere(a,v,p){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:a,renderingGroupId:v};const P=(0,Ja.e)("emitterSphere",{diameter:a.diameter,segments:a.segments},p);P.renderingGroupId=v;const b=new Ba.c("emitterSphereMaterial",p);b.emissiveColor=a.color,P.material=b;for(const L of this.systems)L.j=P;this._emitterNode=P}start(a){for(const v of this.systems)a&&(v.j=a),v.start()}dispose(){for(const a of this.systems)a.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v={systems:[]};for(const p of this.systems)v.systems.push(p.serialize(a));return this._emitterNode&&(v.j=this._emitterCreationOptions),v}static Parse(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;const b=new xa,L=this.BaseAssetsUrl+"/textures/";v=v||i.b.LastCreatedScene;for(const t of a.systems)b.systems.push(p?ja.Parse(t,v,L,!0,P):Ra.Parse(t,v,L,!0,P));if(a.j){const p=a.j.options;if("Sphere"===a.j.kind)b.setEmitterAsSphere({diameter:p.diameter,segments:p.segments,color:t.d.bh(p.color)},a.j.renderingGroupId,v)}return b}}xa.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ra=p(10933);class oa{static CreateDefault(a){let v,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,P=arguments.length>2?arguments[2]:void 0;return v=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ja("default system",{ub:p},P):new Ra("default system",p,P),v.j=a,v.particleTexture=new r.c("https://assets.babylonjs.com/textures/flare.png",v.va()),v.createConeEmitter(.1,Math.PI/4),v.color1=new t.e(1,1,1,1),v.color2=new t.e(1,1,1,1),v.colorDead=new t.e(1,1,1,0),v.minSize=.1,v.maxSize=.1,v.minEmitPower=2,v.maxEmitPower=2,v.updateSpeed=1/60,v.emitRate=30,v}static CreateAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3?arguments[3]:void 0;v||(v=i.b.LastCreatedScene);const b={};return v.addPendingData(b),new Promise(((L,t)=>{if(p&&!ja.IsSupported)return v.removePendingData(b),t("Particle system with GPU is not supported.");wa.e.LoadFile(`${oa.BaseAssetsUrl}/systems/${a}.json`,(a=>{v.removePendingData(b);const t=JSON.parse(a.toString());return L(xa.Parse(t,v,p,P))}),void 0,void 0,void 0,(()=>(v.removePendingData(b),t(`An error occurred with the creation of your particle system. Check if your type '${a}' exists.`))))}))}static ExportSet(a){const v=new xa;for(const p of a)v.systems.push(p);return v}static ParseFromFileAsync(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",L=arguments.length>5?arguments[5]:void 0;return new Promise(((t,V)=>{const K=new ra.b;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const v=JSON.parse(K.responseText);let V;V=P?ja.Parse(v,p,b,!1,L):Ra.Parse(v,p,b,!1,L),a&&(V.name=a),t(V)}else V("Unable to load the particle system")})),K.open("GET",v),K.send()}))}static ParseFromSnippetAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",b=arguments.length>4?arguments[4]:void 0;if("_BLANK"===a){const a=this.CreateDefault(null);return a.start(),Promise.resolve(a)}return new Promise(((L,t)=>{const V=new ra.b;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const t=JSON.parse(JSON.parse(V.responseText).jsonPayload),K=JSON.parse(t.particleSystem);let C;C=p?ja.Parse(K,v,P,!1,b):Ra.Parse(K,v,P,!1,b),C.snippetId=a,L(C)}else t("Unable to load the snippet "+a)})),V.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),V.send()}))}}oa.BaseAssetsUrl=xa.BaseAssetsUrl,oa.SnippetUrl="https://snippet.babylonjs.com",oa.CreateFromSnippetAsync=oa.ParseFromSnippetAsync;var ma=p(11504),Oa=p(11332),Ya=p(11837);(0,Ya.d)(Oa.c.NAME_PARTICLESYSTEM,((a,v,p,P)=>{const b=(0,Ya.g)(Oa.c.NAME_PARTICLESYSTEM);if(b&&void 0!==a.Bj&&null!==a.Bj)for(let L=0,t=a.Bj.length;L<t;L++){const t=a.Bj[L];p.Bj.push(b(t,v,P))}})),(0,Ya.c)(Oa.c.NAME_PARTICLESYSTEM,((a,v,p)=>{if(a.activeParticleCount){return ja.Parse(a,v,p)}return Ra.Parse(a,v,p)})),Ka.e.prototype.createEffectForParticles=function(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,K=arguments.length>7?arguments[7]:void 0,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,F=[],u=[];const c=[];return K?K.fillUniformsAttributesAndSamplerNames(u,F,c):(F=Ra._GetAttributeNamesOrOptions(),u=Ra._GetEffectCreationOptions()),-1===b.indexOf(" BILLBOARD")&&(b+="\n#define BILLBOARD\n"),null!==K&&void 0!==K&&K.isAnimationSheetEnabled&&-1===b.indexOf(" ANIMATESHEET")&&(b+="\n#define ANIMATESHEET\n"),-1===P.indexOf("diffuseSampler")&&P.push("diffuseSampler"),this.createEffect({vertex:(null===K||void 0===K?void 0:K.vertexShaderName)??"particles",fragmentElement:a},F,u.concat(v),c.concat(P),b,L,t,V,void 0,C,(async()=>{0===C?await Promise.resolve().then(p.bind(p,11864)):await Promise.resolve().then(p.bind(p,11926))}))},ma.b.prototype.getEmittedParticleSystems=function(){const a=[];for(let v=0;v<this.va().Bj.length;v++){const p=this.va().Bj[v];p.j===this&&a.push(p)}return a},ma.b.prototype.getHierarchyEmittedParticleSystems=function(){const a=[],v=this.getDescendants();v.push(this);for(let p=0;p<this.va().Bj.length;p++){const P=this.va().Bj[p],b=P.j;b.position&&-1!==v.indexOf(b)&&a.push(P)}return a};p(11413),p(11427),p(11539);p(11528),p(11839),p(11549),p(11395),p(11552);p(11720);var la;p(11848),p(11463);!function(a){a[a.Color=2]="Color",a[a.UV=1]="UV",a[a.Random=0]="Random",a[a.Stated=3]="Stated"}(la||(la={}));p(11851),p(11864),p(11881),p(11926)},11757:(a,v,p)=>{"use strict";p.d(v,{e:()=>H});var P=p(11207),b=p(11223),L=p(10893),t=p(11240),V=p(10980),K=p(11210),C=p(11287),F=p(11027),u=p(10974),c=p(11037),f=p(11764);u.e.prototype.setTextureFromPostProcess=function(a,v,p){var P;let b=null;v&&(v._forcedOutputTexture?b=v._forcedOutputTexture:v._textures.data[v._currentRenderTextureInd]&&(b=v._textures.data[v._currentRenderTextureInd])),this._bindTexture(a,(null===(P=b)||void 0===P?void 0:P.texture)??null,p)},u.e.prototype.setTextureFromPostProcessOutput=function(a,v,p){var P;this._bindTexture(a,(null===v||void 0===v||null===(P=v._outputTexture)||void 0===P?void 0:P.texture)??null,p)},V.c.prototype.setTextureFromPostProcess=function(a,v){this._engine.setTextureFromPostProcess(this._samplers[a],v,a)},V.c.prototype.setTextureFromPostProcessOutput=function(a,v){this._engine.setTextureFromPostProcessOutput(this._samplers[a],v,a)};class H{static get ForceGLSL(){return f.e.ForceGLSL}static set ForceGLSL(a){f.e.ForceGLSL=a}static RegisterShaderCodeProcessing(a,v){f.e.RegisterShaderCodeProcessing(a,v)}get name(){return this._effectWrapper.name}set name(a){this._effectWrapper.name=a}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(a){this._effectWrapper.alphaMode=a}get samples(){return this._samples}set samples(a){this._samples=Math.min(a,this._engine.getCaps().maxMSAASamples),this._textures.forEach((a=>{a.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(a){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),a&&(this._onActivateObserver=this.onActivateObservable.add(a))}set onSizeChanged(a){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(a)}set onApply(a){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(a)}set onBeforeRender(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)}set onAfterRender(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(a){this._forcedOutputTexture=a}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.qe(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(a,v,p,P,V,K){var C;let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",X=arguments.length>12?arguments[12]:void 0,Q=arguments.length>13&&void 0!==arguments[13]&&arguments[13],s=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,D=arguments.length>15?arguments[15]:void 0,y=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.cj=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new b.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new t.o(1,1),this._texelSize=t.o.Zero(),this.onActivateObservable=new L.c,this.onSizeChangedObservable=new L.c,this.onApplyObservable=new L.c,this.onBeforeRenderObservable=new L.c,this.onAfterRenderObservable=new L.c;let Z,M=1,S=null;if(p&&!Array.isArray(p)){const a=p;p=a.uniforms??null,P=a.samplers??null,M=a.size??1,K=a.camera??null,F=a.samplingMode??1,u=a.Id,c=a.reusable,A=Array.isArray(a.defines)?a.defines.join("\n"):a.defines??null,h=a.textureType??0,R=a.vertexUrl??"postprocess",X=a.indexParameters,Q=a.blockCompilation??!1,s=a.textureFormat??5,D=a.shaderLanguage??0,S=a.uniformBuffers??null,y=a.extraInitializations,Z=a.effectWrapper}else V&&(M="number"===typeof V?V:{width:V.width,height:V.height});const n=!!Z;if(this._effectWrapper=Z??new f.e({name:a,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:v,Id:u||(null===(C=K)||void 0===C?void 0:C.va().getEngine()),uniforms:p,samplers:P,uniformBuffers:S,defines:A,vertexUrl:R,indexParameters:X,blockCompilation:Q,shaderLanguage:D,extraInitializations:y}),this.name=a,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=K?(this._camera=K,this._scene=K.va(),K.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=M,this.renderTargetSamplingMode=F||1,this._reusable=c||!1,this._textureType=h,this._textureFormat=s,this._shaderLanguage=D||0,this._samplers=P||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=v,this._vertexUrl=R,this._parameters=p||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=S||[],this._indexParameters=X,!n){this._webGPUReady=1===this._shaderLanguage;const a=[];this._gatherImports(this._engine.isWebGPU&&!H.ForceGLSL,a),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(Q,A,y,a)}}_gatherImports(){let a=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?a.push(Promise.all([p.e(37).then(p.bind(p,13653))])):a.push(Promise.all([Promise.resolve().then(p.bind(p,11769))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(a){return this._disposeTextures(),this._shareOutputWithPostProcess=a,this}useOwnOutput(){0==this._textures.length&&(this._textures=new b.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0,V=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(a,v,p,P,b,L,t,V),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let b=0;b<this._textureCache.length;b++)if(this._textureCache[b].texture.width===a.width&&this._textureCache[b].texture.height===a.height&&this._textureCache[b].postProcessChannel===p&&this._textureCache[b].texture._generateDepthBuffer===v.generateDepthBuffer&&this._textureCache[b].texture.samples===v.samples)return this._textureCache[b].texture;const P=this._engine.createRenderTargetTexture(a,v);return this._textureCache.push({texture:P,postProcessChannel:p,lastUsedRenderId:-1}),P}_flushTextureCache(){const a=this._renderId;for(let v=this._textureCache.length-1;v>=0;v--)if(a-this._textureCache[v].lastUsedRenderId>100){let a=!1;for(let p=0;p<this._textures.length;p++)if(this._textures.data[p]===this._textureCache[v].texture){a=!0;break}a||(this._textureCache[v].texture.dispose(),this._textureCache.splice(v,1))}}resize(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=a,this.height=v;let L=null;if(p)for(let K=0;K<p._postProcesses.length;K++)if(null!==p._postProcesses[K]){L=p._postProcesses[K];break}const t={width:this.width,height:this.height},V={generateMipMaps:P,generateDepthBuffer:b||L===this,generateStencilBuffer:(b||L===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(t,V,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(t,V,1)),this._texelSize.qe(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let a;if(this._shareOutputWithPostProcess)a=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)a=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let v;a=this.inputTexture;for(let p=0;p<this._textureCache.length;p++)if(this._textureCache[p].texture===a){v=this._textureCache[p];break}v&&(v.lastUsedRenderId=this._renderId)}return a}activate(a){var v,p;let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const L=(a=a||this._camera).va(),t=L.getEngine(),V=t.getCaps().maxTextureSize,K=(P?P.width:this._engine.getRenderWidth(!0))*this._options|0,C=(P?P.height:this._engine.getRenderHeight(!0))*this._options|0;let F=this._options.width||K,u=this._options.height||C;const f=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let H=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const a=t.currentViewport;a&&(F*=a.width,u*=a.height)}(f||this.alwaysForcePOT)&&(this._options.width||(F=t.needPOTTextures?(0,c.i)(F,V,this.scaleMode):F),this._options.height||(u=t.needPOTTextures?(0,c.i)(u,V,this.scaleMode):u)),this.width===F&&this.height===u&&(H=this._getTarget())||this.resize(F,u,a,f,b),this._textures.forEach((a=>{a.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(a,this.samples)})),this._flushTextureCache(),this._renderId++}return H||(H=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.qe(K/F,C/u),this._engine.bindFramebuffer(H,0,K,C,this.forceFullscreenViewport)):(this._scaleRatio.qe(1,1),this._engine.bindFramebuffer(H,0,void 0,void 0,this.forceFullscreenViewport)),null===(v=(p=this._engine)._debugInsertMarker)||void 0===v||v.call(p,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(a),this.cj&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:L.clearColor,L._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),H}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let a;var v;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),a=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(v=a)||void 0===v?void 0:v.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let a=this._textureCache.length-1;a>=0;a--)this._textureCache[a].texture.dispose();this._textureCache.length=0}setPrePassRenderer(a){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=a.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(a){let v;if(a=a||this._camera,this._disposeTextures(),this._scene&&(v=this._scene.postProcesses.indexOf(this),-1!==v&&this._scene.postProcesses.splice(v,1)),this._parentContainer){const a=this._parentContainer.postProcesses.indexOf(this);a>-1&&this._parentContainer.postProcesses.splice(a,1),this._parentContainer=null}if(v=this._engine.postProcesses.indexOf(this),-1!==v&&this._engine.postProcesses.splice(v,1),a){if(a.detachPostProcess(this),v=a._postProcesses.indexOf(this),0===v&&a._postProcesses.length>0){const a=this._camera._getFirstPostProcess();a&&a.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const a=C.b.Serialize(this),v=this.getCamera()||this._scene&&this._scene.activeCamera;return a.customType="BABYLON."+this.getClassName(),a.cameraId=v?v.id:null,a.reusable=this._reusable,a.textureType=this._textureType,a.fragmentUrl=this._fragmentUrl,a.parameters=this._parameters,a.samplers=this._samplers,a.uniformBuffers=this._uniformBuffers,a.options=this._options,a.defines=this._postProcessDefines,a.textureFormat=this._textureFormat,a.vertexUrl=this._vertexUrl,a.indexParameters=this._indexParameters,a}clone(){const a=this.serialize();a._engine=this._engine,a.cameraId=null;const v=H.Parse(a,this._scene,"");return v?(v.onActivateObservable=this.onActivateObservable.clone(),v.onSizeChangedObservable=this.onSizeChangedObservable.clone(),v.onApplyObservable=this.onApplyObservable.clone(),v.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),v.onAfterRenderObservable=this.onAfterRenderObservable.clone(),v._prePassEffectConfiguration=this._prePassEffectConfiguration,v):null}static Parse(a,v,p){const P=(0,F.c)(a.customType);if(!P||!P._Parse)return null;const b=v?v.getCameraById(a.cameraId):null;return P._Parse(a,b,v,p)}static _Parse(a,v,p,P){return C.b.Parse((()=>new H(a.name,a.fragmentUrl,a.parameters,a.samplers,a.options,v,a.renderTargetSamplingMode,a._engine,a.reusable,a.defines,a.textureType,a.vertexUrl,a.indexParameters,!1,a.textureFormat)),a,p,P)}}(0,P.e)([(0,K.O)()],H.prototype,"uniqueId",void 0),(0,P.e)([(0,K.O)()],H.prototype,"name",null),(0,P.e)([(0,K.O)()],H.prototype,"width",void 0),(0,P.e)([(0,K.O)()],H.prototype,"height",void 0),(0,P.e)([(0,K.O)()],H.prototype,"renderTargetSamplingMode",void 0),(0,P.e)([(0,K.o)()],H.prototype,"clearColor",void 0),(0,P.e)([(0,K.O)()],H.prototype,"cj",void 0),(0,P.e)([(0,K.O)()],H.prototype,"forceAutoClearInAlphaMode",void 0),(0,P.e)([(0,K.O)()],H.prototype,"alphaMode",null),(0,P.e)([(0,K.O)()],H.prototype,"alphaConstants",void 0),(0,P.e)([(0,K.O)()],H.prototype,"enablePixelPerfectMode",void 0),(0,P.e)([(0,K.O)()],H.prototype,"forceFullscreenViewport",void 0),(0,P.e)([(0,K.O)()],H.prototype,"scaleMode",void 0),(0,P.e)([(0,K.O)()],H.prototype,"alwaysForcePOT",void 0),(0,P.e)([(0,K.O)("samples")],H.prototype,"_samples",void 0),(0,P.e)([(0,K.O)()],H.prototype,"adaptScaleToCurrentViewport",void 0),(0,F.f)("BABYLON.PostProcess",H)},11318:(a,v,p)=>{"use strict";p.d(v,{d:()=>L});var P=p(11306),b=p(10893);class L{constructor(a){this._vertexBuffers={},this.onBeforeRenderObservable=new b.c,this._scene=a}_prepareBuffers(){if(this._vertexBuffers[P.f.PositionKind])return;const a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1),this._vertexBuffers[P.f.PositionKind]=new P.f(this._scene.getEngine(),a,P.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(a)}_rebuild(){const a=this._vertexBuffers[P.f.PositionKind];a&&(a._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=this._scene.activeCamera;return!!p&&(v=v||p._postProcesses.filter((a=>null!=a)),!(!v||0===v.length||!this._scene.postProcessesEnabled)&&(v[0].activate(p,a,null!==v&&void 0!==v),!0))}directRender(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=this._scene.getEngine();for(let K=0;K<a.length;K++){var V;if(K<a.length-1)a[K+1].activate(this._scene.activeCamera,null===v||void 0===v?void 0:v.texture);else v?t.bindFramebuffer(v,P,void 0,void 0,p,b):L||t.restoreDefaultFramebuffer(),null===(V=t._debugInsertMarker)||void 0===V||V.call(t,`post process ${a[K].name} output`);const C=a[K],F=C.apply();F&&(C.onBeforeRenderObservable.notifyObservers(F),this._prepareBuffers(),t.bindBuffers(this._vertexBuffers,this._indexBuffer,F),t.drawElementsType(0,0,6),C.onAfterRenderObservable.notifyObservers(F))}t.setDepthBuffer(!0),t.setDepthWrite(!0)}_finalizeFrame(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const L=this._scene.activeCamera;if(!L)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(P=P||L._postProcesses.filter((a=>null!=a))).length||!this._scene.postProcessesEnabled)return;const t=this._scene.getEngine();for(let K=0,C=P.length;K<C;K++){const F=P[K];var V;if(K<C-1)F._outputTexture=P[K+1].activate(L,null===v||void 0===v?void 0:v.texture);else v?(t.bindFramebuffer(v,p,void 0,void 0,b),F._outputTexture=v):(t.restoreDefaultFramebuffer(),F._outputTexture=null),null===(V=t._debugInsertMarker)||void 0===V||V.call(t,`post process ${P[K].name} output`);if(a)break;const u=F.apply();u&&(F.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),t.bindBuffers(this._vertexBuffers,this._indexBuffer,u),t.drawElementsType(0,0,6),F.onAfterRenderObservable.notifyObservers(u))}t.setDepthBuffer(!0),t.setDepthWrite(!0),t.setAlphaMode(0)}dispose(){const a=this._vertexBuffers[P.f.PositionKind];a&&(a.dispose(),this._vertexBuffers[P.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11325:(a,v,p)=>{"use strict";p.d(v,{e:()=>V});var P=p(11223),b=p(11240);class L{set opaqueSortCompareFn(a){this._opaqueSortCompareFn=a||L.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(a){this._alphaTestSortCompareFn=a||L.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(a){this._transparentSortCompareFn=a||L.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=a,this._opaqueSubMeshes=new P.e(256),this._transparentSubMeshes=new P.e(256),this._alphaTestSubMeshes=new P.e(256),this._depthOnlySubMeshes=new P.e(256),this._particleSystems=new P.e(256),this._spriteManagers=new P.e(256),this._empty=!0,this._edgesRenderers=new P.c(16),this._scene=v,this.opaqueSortCompareFn=p,this.alphaTestSortCompareFn=b,this.transparentSortCompareFn=L}render(a,v,p,P){if(a)return void a(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const b=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(b.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),b.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const L=b.getStencilBuffer();if(b.setStencilBuffer(!1),v&&this._renderSprites(),p&&this._renderParticles(P),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(b.setStencilBuffer(L),this._scene.useOrderIndependentTransparency){const a=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);a.length&&this._renderTransparent(a)}else this._renderTransparent(this._transparentSubMeshes);b.setAlphaMode(0)}if(b.setStencilBuffer(!1),this._edgesRenderers.length){for(let a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();b.setAlphaMode(0)}b.setStencilBuffer(L)}_renderOpaqueSorted(a){L._RenderSorted(a,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(a){L._RenderSorted(a,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(a){L._RenderSorted(a,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(a,v,p,P){let t,V=0;const K=p?p.globalPosition:L._ZeroVector;if(P)for(;V<a.length;V++)t=a.data[V],t._alphaIndex=t.getMesh().alphaIndex,t._distanceToCamera=b.s.Distance(t.getBoundingInfo().boundingSphere.centerWorld,K);const C=a.length===a.data.length?a.data:a.data.slice(0,a.length);v&&C.sort(v);const F=C[0].getMesh().va();for(V=0;V<C.length;V++)if(t=C[V],!F._activeMeshesFrozenButKeepClipping||t.isInFrustum(F._frustumPlanes)){if(P){const a=t.Ha();if(a&&a.needDepthPrePass){const v=a.va().getEngine();v.setColorWrite(!1),v.setAlphaMode(0),t.render(!1),v.setColorWrite(!0)}}t.render(P)}}static defaultTransparentSortCompare(a,v){return a._alphaIndex>v._alphaIndex?1:a._alphaIndex<v._alphaIndex?-1:L.backToFrontSortCompare(a,v)}static backToFrontSortCompare(a,v){return a._distanceToCamera<v._distanceToCamera?1:a._distanceToCamera>v._distanceToCamera?-1:0}static frontToBackSortCompare(a,v){return a._distanceToCamera<v._distanceToCamera?-1:a._distanceToCamera>v._distanceToCamera?1:0}static PainterSortCompare(a,v){const p=a.getMesh(),P=v.getMesh();return p.material&&P.material?p.material.uniqueId-P.material.uniqueId:p.uniqueId-P.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(a,v,p){void 0===v&&(v=a.getMesh()),void 0===p&&(p=a.Ha()),null!==p&&void 0!==p&&(p.needAlphaBlendingForMesh(v)?this._transparentSubMeshes.push(a):p.needAlphaTesting()?(p.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._alphaTestSubMeshes.push(a)):(p.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._opaqueSubMeshes.push(a)),v._renderingGroup=this,v._edgesRenderer&&v.isEnabled()&&v.isVisible&&v._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(v._edgesRenderer),this._empty=!1)}dispatchSprites(a){this._spriteManagers.push(a),this._empty=!1}dispatchParticles(a){this._particleSystems.push(a),this._empty=!1}_renderParticles(a){if(0===this._particleSystems.length)return;const v=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let p=0;p<this._particleSystems.length;p++){const P=this._particleSystems.data[p];if(0===(v&&v.layerMask&P.layerMask))continue;const b=P.j;b.position&&a&&-1===a.indexOf(b)||this._scene._activeParticles.addCount(P.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const a=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let v=0;v<this._spriteManagers.length;v++){const p=this._spriteManagers.data[v];0!==(a&&a.layerMask&p.layerMask)&&p.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}L._ZeroVector=b.s.Zero();class t{}class V{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(a){a!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=a,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const a of this._scene.meshes)if(a.rg)for(const v of a.rg)v._wasDispatched=!1;if(this._scene.spriteManagers)for(const a of this._scene.spriteManagers)a._wasDispatched=!1;for(const a of this._scene.Bj)a._wasDispatched=!1}constructor(a){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new t,this._maintainStateBetweenFrames=!1,this._scene=a;for(let v=V.MIN_RENDERINGGROUPS;v<V.MAX_RENDERINGGROUPS;v++)this._autoClearDepthStencil[v]={cj:!0,depth:!0,stencil:!0}}getRenderingGroup(a){const v=a||0;return this._prepareRenderingGroup(v),this._renderingGroups[v]}_clearDepthStencilBuffer(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,a,v),this._depthStencilBufferAlreadyCleaned=!0)}render(a,v,p,P){const b=this._renderingGroupInfo;if(b.sd=this._scene,b.camera=this._scene.activeCamera,this._scene.spriteManagers&&P)for(let L=0;L<this._scene.spriteManagers.length;L++){const a=this._scene.spriteManagers[L];this.dispatchSprites(a)}for(let L=V.MIN_RENDERINGGROUPS;L<V.MAX_RENDERINGGROUPS;L++){this._depthStencilBufferAlreadyCleaned=L===V.MIN_RENDERINGGROUPS;const t=this._renderingGroups[L];if(!t||t._empty)continue;const K=1<<L;if(b.renderingGroupId=L,this._scene.onBeforeRenderingGroupObservable.notifyObservers(b,K),V.AUTOCLEAR){const a=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(L):this._autoClearDepthStencil[L];a&&a.cj&&this._clearDepthStencilBuffer(a.depth,a.stencil)}for(const a of this._scene._beforeRenderingGroupDrawStage)a.action(L);t.render(a,P,p,v);for(const a of this._scene._afterRenderingGroupDrawStage)a.action(L);this._scene.onAfterRenderingGroupObservable.notifyObservers(b,K)}}reset(){if(!this.maintainStateBetweenFrames)for(let a=V.MIN_RENDERINGGROUPS;a<V.MAX_RENDERINGGROUPS;a++){const v=this._renderingGroups[a];v&&v.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let a=V.MIN_RENDERINGGROUPS;a<V.MAX_RENDERINGGROUPS;a++){const v=this._renderingGroups[a];v&&v.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let a=V.MIN_RENDERINGGROUPS;a<V.MAX_RENDERINGGROUPS;a++){const v=this._renderingGroups[a];v&&v.dispose()}}_prepareRenderingGroup(a){void 0===this._renderingGroups[a]&&(this._renderingGroups[a]=new L(a,this._scene,this._customOpaqueSortCompareFn[a],this._customAlphaTestSortCompareFn[a],this._customTransparentSortCompareFn[a]))}dispatchSprites(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchSprites(a))}dispatchParticles(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchParticles(a))}dispatch(a,v,p){void 0===v&&(v=a.getMesh()),this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(v.renderingGroupId).dispatch(a,v,p))}setRenderingOrder(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[a]=v,this._customAlphaTestSortCompareFn[a]=p,this._customTransparentSortCompareFn[a]=P,this._renderingGroups[a]){const v=this._renderingGroups[a];v.opaqueSortCompareFn=this._customOpaqueSortCompareFn[a],v.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[a],v.transparentSortCompareFn=this._customTransparentSortCompareFn[a]}}setRenderingAutoClearDepthStencil(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[a]={cj:v,depth:p,stencil:P}}getAutoClearDepthStencilSetup(a){return this._autoClearDepthStencil[a]}}V.MAX_RENDERINGGROUPS=4,V.MIN_RENDERINGGROUPS=0,V.AUTOCLEAR=!0},11909:(a,v,p)=>{"use strict";const P="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11883:(a,v,p)=>{"use strict";const P="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11945:(a,v,p)=>{"use strict";const P="clipPlaneVertex",b="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11934:(a,v,p)=>{"use strict";const P="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11921:(a,v,p)=>{"use strict";const P="fogFragment",b="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11902:(a,v,p)=>{"use strict";const P="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11951:(a,v,p)=>{"use strict";const P="fogVertex",b="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11937:(a,v,p)=>{"use strict";const P="fogVertexDeclaration",b="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11894:(a,v,p)=>{"use strict";const P="helperFunctions",b="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11888:(a,v,p)=>{"use strict";const P="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11899:(a,v,p)=>{"use strict";const P="imageProcessingFunctions",b="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";p(10982).e.IncludesShadersStoreWGSL[P]=b},11891:(a,v,p)=>{"use strict";const P="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11914:(a,v,p)=>{"use strict";const P="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11955:(a,v,p)=>{"use strict";const P="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";p(10982).e.IncludesShadersStoreWGSL[P]=b},11881:(a,v,p)=>{"use strict";p.r(v),p.d(v,{particlesPixelShaderWGSL:()=>t});var P=p(10982);p(11883),p(11888),p(11891),p(11894),p(11899),p(11902),p(11909),p(11914),p(11921);const b="particlesPixelShader",L="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.e.ShadersStoreWGSL[b]=L;const t={name:b,shader:L}},11926:(a,v,p)=>{"use strict";p.r(v),p.d(v,{particlesVertexShaderWGSL:()=>t});var P=p(10982);p(11934),p(11937),p(11891),p(11945),p(11951),p(11955);const b="particlesVertexShader",L="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.e.ShadersStoreWGSL[b]=L;const t={name:b,shader:L}},11805:(a,v,p)=>{"use strict";const P="clipPlaneFragment",b="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11858:(a,v,p)=>{"use strict";const P="clipPlaneFragmentDeclaration",b="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11821:(a,v,p)=>{"use strict";const P="clipPlaneVertex",b="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11872:(a,v,p)=>{"use strict";const P="clipPlaneVertexDeclaration",b="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11811:(a,v,p)=>{"use strict";const P="fogFragment",b="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11802:(a,v,p)=>{"use strict";const P="fogFragmentDeclaration",b="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11823:(a,v,p)=>{"use strict";const P="fogVertex",b="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11815:(a,v,p)=>{"use strict";const P="fogVertexDeclaration",b="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11791:(a,v,p)=>{"use strict";const P="helperFunctions",b="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";p(10982).e.IncludesShadersStore[P]=b},11784:(a,v,p)=>{"use strict";const P="imageProcessingDeclaration",b="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11794:(a,v,p)=>{"use strict";const P="imageProcessingFunctions",b="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";p(10982).e.IncludesShadersStore[P]=b},11786:(a,v,p)=>{"use strict";const P="logDepthDeclaration",b="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11809:(a,v,p)=>{"use strict";const P="logDepthFragment",b="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11826:(a,v,p)=>{"use strict";const P="logDepthVertex",b="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";p(10982).e.IncludesShadersStore[P]=b},11851:(a,v,p)=>{"use strict";p.r(v),p.d(v,{particlesPixelShader:()=>t});var P=p(10982);p(11858),p(11784),p(11786),p(11791),p(11794),p(11802),p(11805),p(11809),p(11811);const b="particlesPixelShader",L="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";P.e.ShadersStore[b]=L;const t={name:b,shader:L}},11864:(a,v,p)=>{"use strict";p.r(v),p.d(v,{particlesVertexShader:()=>t});var P=p(10982);p(11872),p(11815),p(11786),p(11821),p(11823),p(11826);const b="particlesVertexShader",L="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";P.e.ShadersStore[b]=L;const t={name:b,shader:L}},11769:(a,v,p)=>{"use strict";p.r(v),p.d(v,{postprocessVertexShader:()=>L});const P="postprocessVertexShader",b="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";p(10982).e.ShadersStore[P]=b;const L={name:P,shader:b}},11352:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});class P{}P._IsPickingAvailable=!1},11515:(a,v,p)=>{"use strict";p.d(v,{b:()=>u});var P=p(11207),b=p(11240),L=p(11210),t=p(10893),V=p(10939),K=p(10926),C=p(11287);class F{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new t.c,this._onClonedObservable=new t.c}}class u{static AddNodeConstructor(a,v){this._NodeConstructors[a]=v}static Construct(a,v,p,P){const b=this._NodeConstructors[a];return b?b(v,p,P):null}set accessibilityTag(a){this._accessibilityTag=a,this.onAccessibilityTagChangedObservable.notifyObservers(a)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(a){this._nodeDataStorage._doNotSerialize=a}u(){return this._nodeDataStorage._isDisposed}set parent(a){if(this._parentNode===a)return;const v=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const v=this._parentNode._children.indexOf(this);-1!==v&&this._parentNode._children.splice(v,1),a||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=a,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),v||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(a){a.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const a=this._scene.rootNodes,v=a.length-1;a[this._nodeDataStorage._sceneRootNodesIndex]=a[v],a[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}getClassName(){return"Node"}set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new F,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new t.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=b.e.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.uj=new t.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=a,this.id=a,this._scene=v||V.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),p&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(a)||(a.init(),this._scene.isLoading&&!v?this._scene.onDataLoadedObservable.addOnce((()=>{a.attach(this)})):a.attach(this),this._behaviors.push(a)),this}removeBehavior(a){const v=this._behaviors.indexOf(a);return-1===v||(this._behaviors[v].detach(),this._behaviors.splice(v,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(a){for(const v of this._behaviors)if(v.name===a)return v;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Zj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(a){!a&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(a){return this.parent?this.parent._getActionManagerForTrigger(a,!1):null}_updateCache(a){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Sg(a){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((a=>{a._syncParentEnabledState()}))}Mb(a){this._nodeDataStorage._isEnabled!==a&&(this._nodeDataStorage._isEnabled=a,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(a))}isDescendantOf(a){return!!this.parent&&(this.parent===a||this.parent.isDescendantOf(a))}_getDescendants(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;if(this._children)for(let P=0;P<this._children.length;P++){const b=this._children[P];p&&!p(b)||a.push(b),v||b._getDescendants(a,!1,p)}}getDescendants(a,v){const p=[];return this._getDescendants(p,a,v),p}getChildMeshes(a,v){const p=[];return this._getDescendants(p,a,(a=>(!v||v(a))&&void 0!==a.Oi)),p}getChildren(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(v,a)}_setReady(a){a!==this._nodeDataStorage._isReady&&(a?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(a){for(let v=0;v<this.animations.length;v++){const p=this.animations[v];if(p.name===a)return p}return null}createAnimationRange(a,v,p){if(!this._ranges[a]){this._ranges[a]=u._AnimationRangeFactory(a,v,p);for(let P=0,b=this.animations.length;P<b;P++)this.animations[P]&&this.animations[P].createRange(a,v,p)}}deleteAnimationRange(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let p=0,P=this.animations.length;p<P;p++)this.animations[p]&&this.animations[p].deleteRange(a,v);this._ranges[a]=null}getAnimationRange(a){return this._ranges[a]||null}clone(a,v,p){const P=C.b.Clone((()=>new u(a,this.va())),this);if(v&&(P.parent=v),!p){const v=this.getDescendants(!0);for(let p=0;p<v.length;p++){const b=v[p];b.clone(a+"."+b.name,P)}}return P}getAnimationRanges(){const a=[];let v;for(v in this._ranges)a.push(this._ranges[v]);return a}beginAnimation(a,v,p,P){const b=this.getAnimationRange(a);return b?this._scene.beginAnimation(this,b.from,b.to,v,p,P):null}serializeAnimationRanges(){const a=[];for(const v in this._ranges){const p=this._ranges[v];if(!p)continue;const P={};P.name=v,P.from=p.from,P.to=p.to,a.push(P)}return a}Zj(a){return this._worldMatrix||(this._worldMatrix=b.e.Identity()),this._worldMatrix}dispose(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!a){const p=this.getDescendants(!0);for(const P of p)P.dispose(a,v)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.uj.notifyObservers(this),this.uj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const p of this._behaviors)p.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(a,v,p){if(v.ranges)for(let P=0;P<v.ranges.length;P++){const p=v.ranges[P];a.createAnimationRange(p.name,p.from,p.to)}}getHierarchyBoundingVectors(){let a,v,p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Zj(!0);const L=this;if(L.getBoundingInfo&&L.rg){const p=L.getBoundingInfo();a=p.boundingBox.minimumWorld.clone(),v=p.boundingBox.maximumWorld.clone()}else a=new b.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new b.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(p){const p=this.getDescendants(!1);for(const L of p){const p=L;if(p.Zj(!0),P&&!P(p))continue;if(!p.getBoundingInfo||0===p.getTotalVertices())continue;const t=p.getBoundingInfo().boundingBox,V=t.minimumWorld,K=t.maximumWorld;b.s.CheckExtends(V,a,v),b.s.CheckExtends(K,a,v)}}return{min:a,max:v}}}u._AnimationRangeFactory=(a,v,p)=>{throw(0,K.c)("AnimationRange")},u._NodeConstructors={},(0,P.e)([(0,L.O)()],u.prototype,"name",void 0),(0,P.e)([(0,L.O)()],u.prototype,"id",void 0),(0,P.e)([(0,L.O)()],u.prototype,"uniqueId",void 0),(0,P.e)([(0,L.O)()],u.prototype,"state",void 0),(0,P.e)([(0,L.O)()],u.prototype,"metadata",void 0)},11229:(a,v,p)=>{"use strict";p.d(v,{c:()=>aa});var P=p(10889),b=p(10920),L=p(10893),t=p(11223);class V{constructor(){this._count=0,this._data={}}p(a){this.clear(),a.forEach(((a,v)=>this.add(a,v)))}get(a){const v=this._data[a];if(void 0!==v)return v}getOrAddWithFactory(a,v){let p=this.get(a);return void 0!==p||(p=v(a),p&&this.add(a,p)),p}getOrAdd(a,v){const p=this.get(a);return void 0!==p?p:(this.add(a,v),v)}contains(a){return void 0!==this._data[a]}add(a,v){return void 0===this._data[a]&&(this._data[a]=v,++this._count,!0)}set(a,v){return void 0!==this._data[a]&&(this._data[a]=v,!0)}getAndRemove(a){const v=this.get(a);return void 0!==v?(delete this._data[a],--this._count,v):null}remove(a){return!!this.contains(a)&&(delete this._data[a],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(a){for(const v in this._data){a(v,this._data[v])}}first(a){for(const v in this._data){const p=a(v,this._data[v]);if(p)return p}return null}}var K=p(11234),C=p(11240),F=p(11271),u=p(11301),c=p(11304);class f{constructor(a,v,p,P,b,L){this.source=a,this.pointerX=v,this.pointerY=p,this.meshUnderPointer=P,this.sourceEvent=b,this.additionalData=L}static CreateNew(a,v,p){const P=a.va();return new f(a,P.pointerX,P.pointerY,P.meshUnderPointer||a,v,p)}static CreateNewFromSprite(a,v,p,P){return new f(a,v.pointerX,v.pointerY,v.meshUnderPointer,p,P)}static CreateNewFromScene(a,v){return new f(null,a.pointerX,a.pointerY,a.meshUnderPointer,v)}static CreateNewFromPrimitive(a,v,p,P){return new f(a,v.x,v.y,null,p,P)}}var H=p(11318),A=p(11325),h=p(11332),R=p(10896),X=p(10939),Q=p(10926),s=p(11340);class D{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const a in D.Triggers)if(Object.prototype.hasOwnProperty.call(D.Triggers,a))return!0;return!1}static get HasPickTriggers(){for(const a in D.Triggers)if(Object.prototype.hasOwnProperty.call(D.Triggers,a)){const v=parseInt(a);if(v>=1&&v<=7)return!0}return!1}static HasSpecificTrigger(a){for(const v in D.Triggers)if(Object.prototype.hasOwnProperty.call(D.Triggers,v)){if(parseInt(v)===a)return!0}return!1}}D.Triggers={};var y,Z,M,S,n,q,T,j=p(11344);!function(a){a[a.Generic=0]="Generic",a[a.Keyboard=1]="Keyboard",a[a.Mouse=2]="Mouse",a[a.Touch=3]="Touch",a[a.DualShock=4]="DualShock",a[a.Xbox=5]="Xbox",a[a.Switch=6]="Switch",a[a.DualSense=7]="DualSense"}(y||(y={})),function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.LeftClick=2]="LeftClick",a[a.MiddleClick=3]="MiddleClick",a[a.RightClick=4]="RightClick",a[a.BrowserBack=5]="BrowserBack",a[a.BrowserForward=6]="BrowserForward",a[a.MouseWheelX=7]="MouseWheelX",a[a.MouseWheelY=8]="MouseWheelY",a[a.MouseWheelZ=9]="MouseWheelZ",a[a.Move=12]="Move"}(Z||(Z={})),function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.LeftClick=2]="LeftClick",a[a.MiddleClick=3]="MiddleClick",a[a.RightClick=4]="RightClick",a[a.BrowserBack=5]="BrowserBack",a[a.BrowserForward=6]="BrowserForward",a[a.MouseWheelX=7]="MouseWheelX",a[a.MouseWheelY=8]="MouseWheelY",a[a.MouseWheelZ=9]="MouseWheelZ",a[a.DeltaHorizontal=10]="DeltaHorizontal",a[a.DeltaVertical=11]="DeltaVertical"}(M||(M={})),function(a){a[a.Cross=0]="Cross",a[a.Circle=1]="Circle",a[a.Square=2]="Square",a[a.Triangle=3]="Triangle",a[a.L1=4]="L1",a[a.R1=5]="R1",a[a.L2=6]="L2",a[a.R2=7]="R2",a[a.Share=8]="Share",a[a.Options=9]="Options",a[a.L3=10]="L3",a[a.R3=11]="R3",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.TouchPad=17]="TouchPad",a[a.LStickXAxis=18]="LStickXAxis",a[a.LStickYAxis=19]="LStickYAxis",a[a.RStickXAxis=20]="RStickXAxis",a[a.RStickYAxis=21]="RStickYAxis"}(S||(S={})),function(a){a[a.Cross=0]="Cross",a[a.Circle=1]="Circle",a[a.Square=2]="Square",a[a.Triangle=3]="Triangle",a[a.L1=4]="L1",a[a.R1=5]="R1",a[a.L2=6]="L2",a[a.R2=7]="R2",a[a.Create=8]="Create",a[a.Options=9]="Options",a[a.L3=10]="L3",a[a.R3=11]="R3",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.TouchPad=17]="TouchPad",a[a.LStickXAxis=18]="LStickXAxis",a[a.LStickYAxis=19]="LStickYAxis",a[a.RStickXAxis=20]="RStickXAxis",a[a.RStickYAxis=21]="RStickYAxis"}(n||(n={})),function(a){a[a.A=0]="A",a[a.B=1]="B",a[a.X=2]="X",a[a.Y=3]="Y",a[a.LB=4]="LB",a[a.RB=5]="RB",a[a.LT=6]="LT",a[a.RT=7]="RT",a[a.Back=8]="Back",a[a.Start=9]="Start",a[a.LS=10]="LS",a[a.RS=11]="RS",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.LStickXAxis=17]="LStickXAxis",a[a.LStickYAxis=18]="LStickYAxis",a[a.RStickXAxis=19]="RStickXAxis",a[a.RStickYAxis=20]="RStickYAxis"}(q||(q={})),function(a){a[a.B=0]="B",a[a.A=1]="A",a[a.Y=2]="Y",a[a.X=3]="X",a[a.L=4]="L",a[a.R=5]="R",a[a.ZL=6]="ZL",a[a.ZR=7]="ZR",a[a.Minus=8]="Minus",a[a.Plus=9]="Plus",a[a.LS=10]="LS",a[a.RS=11]="RS",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.Capture=17]="Capture",a[a.LStickXAxis=18]="LStickXAxis",a[a.LStickYAxis=19]="LStickYAxis",a[a.RStickXAxis=20]="RStickXAxis",a[a.RStickYAxis=21]="RStickYAxis"}(T||(T={}));var w=p(11346);class J{static CreateDeviceEvent(a,v,p,P,b,L,t){switch(a){case y.Keyboard:return this._CreateKeyboardEvent(p,P,b,L);case y.Mouse:if(p===Z.MouseWheelX||p===Z.MouseWheelY||p===Z.MouseWheelZ)return this._CreateWheelEvent(a,v,p,P,b,L);case y.Touch:return this._CreatePointerEvent(a,v,p,P,b,L,t);default:throw`Unable to generate event for device ${y[a]}`}}static _CreatePointerEvent(a,v,p,P,b,L,t){const V=this._CreateMouseEvent(a,v,p,P,b,L);a===y.Mouse?(V.deviceType=y.Mouse,V.pointerId=1,V.pointerType="mouse"):(V.deviceType=y.Touch,V.pointerId=t??v,V.pointerType="touch");let K=0;return K+=b.pollInput(a,v,Z.LeftClick),K+=2*b.pollInput(a,v,Z.RightClick),K+=4*b.pollInput(a,v,Z.MiddleClick),V.buttons=K,p===Z.Move?V.type="pointermove":p>=Z.LeftClick&&p<=Z.RightClick&&(V.type=1===P?"pointerdown":"pointerup",V.button=p-2),V}static _CreateWheelEvent(a,v,p,P,b,L){const t=this._CreateMouseEvent(a,v,p,P,b,L);switch(t.pointerId=1,t.type="wheel",t.deltaMode=w.e.DOM_DELTA_PIXEL,t.deltaX=0,t.deltaY=0,t.deltaZ=0,p){case Z.MouseWheelX:t.deltaX=P;break;case Z.MouseWheelY:t.deltaY=P;break;case Z.MouseWheelZ:t.deltaZ=P}return t}static _CreateMouseEvent(a,v,p,P,b,L){const t=this._CreateEvent(L),V=b.pollInput(a,v,Z.Horizontal),K=b.pollInput(a,v,Z.Vertical);return L?(t.movementX=0,t.movementY=0,t.offsetX=t.movementX-L.getBoundingClientRect().x,t.offsetY=t.movementY-L.getBoundingClientRect().y):(t.movementX=b.pollInput(a,v,10),t.movementY=b.pollInput(a,v,11),t.offsetX=0,t.offsetY=0),this._CheckNonCharacterKeys(t,b),t.clientX=V,t.clientY=K,t.x=V,t.y=K,t.deviceType=a,t.deviceSlot=v,t.inputIndex=p,t}static _CreateKeyboardEvent(a,v,p,P){const b=this._CreateEvent(P);return this._CheckNonCharacterKeys(b,p),b.deviceType=y.Keyboard,b.deviceSlot=0,b.inputIndex=a,b.type=1===v?"keydown":"keyup",b.key=String.fromCharCode(a),b.keyCode=a,b}static _CheckNonCharacterKeys(a,v){const p=v.isDeviceAvailable(y.Keyboard),P=p&&1===v.pollInput(y.Keyboard,0,18),b=p&&1===v.pollInput(y.Keyboard,0,17),L=p&&(1===v.pollInput(y.Keyboard,0,91)||1===v.pollInput(y.Keyboard,0,92)||1===v.pollInput(y.Keyboard,0,93)),t=p&&1===v.pollInput(y.Keyboard,0,16);a.altKey=P,a.ctrlKey=b,a.metaKey=L,a.shiftKey=t}static _CreateEvent(a){const v={preventDefault:()=>{}};return v.target=a,v}}class B{constructor(a,v,p){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(a,v,((a,v,P,b)=>{const L=J.CreateDeviceEvent(a,v,P,b,this);p(a,v,L)})):this._createDummyNativeInput()}pollInput(a,v,p){return this._nativeInput.pollInput(a,v,p)}isDeviceAvailable(a){return a===y.Mouse||a===y.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const x=Object.keys(Z).length/2;class r{constructor(a,v,p,b){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=P.e.IsSafari(),this._usingMacOS=(0,R.k)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=a=>{},this._keyboardUpEvent=a=>{},this._keyboardBlurEvent=a=>{},this._pointerMoveEvent=a=>{},this._pointerDownEvent=a=>{},this._pointerUpEvent=a=>{},this._pointerCancelEvent=a=>{},this._pointerWheelEvent=a=>{},this._pointerBlurEvent=a=>{},this._pointerMacOSChromeOutEvent=a=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,R.k)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,R.k)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=a=>{},this._gamepadDisconnectedEvent=a=>{},this._eventPrefix=P.e.GetPointerPrefix(a),this._engine=a,this._onDeviceConnected=v,this._onDeviceDisconnected=p,this._onInputChanged=b,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(a,v,p){const b=this._inputs[a][v];if(!b)throw`Unable to find device ${y[a]}`;a>=y.DualShock&&a<=y.DualSense&&this._updateDevice(a,v,p);const L=b[p];if(void 0===L)throw`Unable to find input ${p} for device ${y[a]} in slot ${v}`;return p===Z.Move&&P.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),L}isDeviceAvailable(a){return void 0!==this._inputs[a]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const a=null===this||void 0===this?void 0:this._engine.getInputElement();if(a&&(!this._eventsAttached||this._elementToAttachTo!==a)){if(this._disableEvents(),this._inputs)for(const a of this._inputs)if(a)for(const v in a){const p=a[+v];if(p)for(let a=0;a<p.length;a++)p[a]=0}this._elementToAttachTo=a,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const a=navigator.getGamepads();for(const v of a)v&&this._addGamePad(v)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(y.Mouse,0,0,0)}_addGamePad(a){const v=this._getGamepadDeviceType(a.id),p=a.index;this._gamepads=this._gamepads||new Array(a.index+1),this._registerDevice(v,p,a.buttons.length+a.axes.length),this._gamepads[p]=v}_addPointerDevice(a,v,p,P){this._pointerActive||(this._pointerActive=!0),this._registerDevice(a,v,x);const b=this._inputs[a][v];b[0]=p,b[1]=P}_registerDevice(a,v,p){if(void 0===v)throw`Unable to register device ${y[a]} to undefined slot.`;if(this._inputs[a]||(this._inputs[a]={}),!this._inputs[a][v]){const P=new Array(p);P.fill(0),this._inputs[a][v]=P,this._onDeviceConnected(a,v)}}_unregisterDevice(a,v){this._inputs[a][v]&&(delete this._inputs[a][v],this._onDeviceDisconnected(a,v))}_handleKeyActions(){this._keyboardDownEvent=a=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(y.Keyboard,0,255));const v=this._inputs[y.Keyboard][0];if(v){v[a.keyCode]=1;const p=a;p.inputIndex=a.keyCode,this._usingMacOS&&a.metaKey&&"Meta"!==a.key&&(this._metaKeys.includes(a.keyCode)||this._metaKeys.push(a.keyCode)),this._onInputChanged(y.Keyboard,0,p)}},this._keyboardUpEvent=a=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(y.Keyboard,0,255));const v=this._inputs[y.Keyboard][0];if(v){v[a.keyCode]=0;const p=a;if(p.inputIndex=a.keyCode,this._usingMacOS&&"Meta"===a.key&&this._metaKeys.length>0){for(const a of this._metaKeys){const p=J.CreateDeviceEvent(y.Keyboard,0,a,0,this,this._elementToAttachTo);v[a]=0,this._onInputChanged(y.Keyboard,0,p)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(y.Keyboard,0,p)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const a=this._inputs[y.Keyboard][0];for(let v=0;v<a.length;v++)if(0!==a[v]){a[v]=0;const p=J.CreateDeviceEvent(y.Keyboard,0,v,0,this,this._elementToAttachTo);this._onInputChanged(y.Keyboard,0,p)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,R.k)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let P=0;P<this._maxTouchPoints;P++)this._activeTouchIds[P]=-1;this._pointerMoveEvent=a=>{const v=this._getPointerType(a);let p=v===y.Mouse?0:this._activeTouchIds.indexOf(a.pointerId);if(v===y.Touch&&-1===p){const b=this._activeTouchIds.indexOf(-1);if(!(b>=0))return void P.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);p=b,this._activeTouchIds[b]=a.pointerId,this._onDeviceConnected(v,p)}this._inputs[v]||(this._inputs[v]={}),this._inputs[v][p]||this._addPointerDevice(v,p,a.clientX,a.clientY);const b=this._inputs[v][p];if(b){const P=a;P.inputIndex=Z.Move,b[Z.Horizontal]=a.clientX,b[Z.Vertical]=a.clientY,v===y.Touch&&0===b[Z.LeftClick]&&(b[Z.LeftClick]=1),void 0===a.pointerId&&(a.pointerId=this._mouseId),this._onInputChanged(v,p,P),this._usingSafari||-1===a.button||(P.inputIndex=a.button+2,b[a.button+2]=b[a.button+2]?0:1,this._onInputChanged(v,p,P))}},this._pointerDownEvent=a=>{const v=this._getPointerType(a);let p=v===y.Mouse?0:a.pointerId;if(v===y.Touch){let v=this._activeTouchIds.indexOf(a.pointerId);if(-1===v&&(v=this._activeTouchIds.indexOf(-1)),!(v>=0))return void P.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);p=v,this._activeTouchIds[v]=a.pointerId}this._inputs[v]||(this._inputs[v]={}),this._inputs[v][p]?v===y.Touch&&this._onDeviceConnected(v,p):this._addPointerDevice(v,p,a.clientX,a.clientY);const b=this._inputs[v][p];if(b){const P=b[Z.Horizontal],t=b[Z.Vertical];if(v===y.Mouse){if(void 0===a.pointerId&&(a.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(L){}}else if(a.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(a.pointerId)}catch(L){}b[Z.Horizontal]=a.clientX,b[Z.Vertical]=a.clientY,b[a.button+2]=1;const V=a;V.inputIndex=a.button+2,this._onInputChanged(v,p,V),P===a.clientX&&t===a.clientY||(V.inputIndex=Z.Move,this._onInputChanged(v,p,V))}},this._pointerUpEvent=a=>{var v;const p=this._getPointerType(a),P=p===y.Mouse?0:this._activeTouchIds.indexOf(a.pointerId);if(p===y.Touch){if(-1===P)return;this._activeTouchIds[P]=-1}const b=null===(v=this._inputs[p])||void 0===v?void 0:v[P];if(b&&0!==b[a.button+2]){var L,t,V,K;const v=b[Z.Horizontal],C=b[Z.Vertical];b[Z.Horizontal]=a.clientX,b[Z.Vertical]=a.clientY,b[a.button+2]=0;const F=a;void 0===a.pointerId&&(a.pointerId=this._mouseId),v===a.clientX&&C===a.clientY||(F.inputIndex=Z.Move,this._onInputChanged(p,P,F)),F.inputIndex=a.button+2,p===y.Mouse&&this._mouseId>=0&&null!==(L=(t=this._elementToAttachTo).hasPointerCapture)&&void 0!==L&&L.call(t,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):a.pointerId&&null!==(V=(K=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(K,a.pointerId)&&this._elementToAttachTo.releasePointerCapture(a.pointerId),this._onInputChanged(p,P,F),p===y.Touch&&this._onDeviceDisconnected(p,P)}},this._pointerCancelEvent=a=>{if("mouse"===a.pointerType){var v,p;const a=this._inputs[y.Mouse][0];this._mouseId>=0&&null!==(v=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==v&&v.call(p,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let v=Z.LeftClick;v<=Z.BrowserForward;v++)if(1===a[v]){a[v]=0;const p=J.CreateDeviceEvent(y.Mouse,0,v,0,this,this._elementToAttachTo);this._onInputChanged(y.Mouse,0,p)}}else{var P,b;const v=this._activeTouchIds.indexOf(a.pointerId);if(-1===v)return;null!==(P=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==P&&P.call(b,a.pointerId)&&this._elementToAttachTo.releasePointerCapture(a.pointerId),this._inputs[y.Touch][v][Z.LeftClick]=0;const p=J.CreateDeviceEvent(y.Touch,v,Z.LeftClick,0,this,this._elementToAttachTo,a.pointerId);this._onInputChanged(y.Touch,v,p),this._activeTouchIds[v]=-1,this._onDeviceDisconnected(y.Touch,v)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let a=!1;const v=function(){};try{const p=Object.defineProperty({},"passive",{get:function(){a=!0}});this._elementToAttachTo.addEventListener("test",v,p),this._elementToAttachTo.removeEventListener("test",v,p)}catch(p){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(y.Mouse)){var a,v;const p=this._inputs[y.Mouse][0];this._mouseId>=0&&null!==(a=(v=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(v,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let a=Z.LeftClick;a<=Z.BrowserForward;a++)if(1===p[a]){p[a]=0;const v=J.CreateDeviceEvent(y.Mouse,0,a,0,this,this._elementToAttachTo);this._onInputChanged(y.Mouse,0,v)}}if(this.isDeviceAvailable(y.Touch)){const a=this._inputs[y.Touch];for(let v=0;v<this._activeTouchIds.length;v++){var p,P,b;const L=this._activeTouchIds[v];if(null!==(p=(P=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(P,L)&&this._elementToAttachTo.releasePointerCapture(L),-1!==L&&1===(null===(b=a[v])||void 0===b?void 0:b[Z.LeftClick])){a[v][Z.LeftClick]=0;const p=J.CreateDeviceEvent(y.Touch,v,Z.LeftClick,0,this,this._elementToAttachTo,L);this._onInputChanged(y.Touch,v,p),this._activeTouchIds[v]=-1,this._onDeviceDisconnected(y.Touch,v)}}}},this._pointerWheelEvent=a=>{const v=y.Mouse;this._inputs[v]||(this._inputs[v]=[]),this._inputs[v][0]||(this._pointerActive=!0,this._registerDevice(v,0,x));const p=this._inputs[v][0];if(p){p[Z.MouseWheelX]=a.deltaX||0,p[Z.MouseWheelY]=a.deltaY||a.wheelDelta||0,p[Z.MouseWheelZ]=a.deltaZ||0;const P=a;void 0===a.pointerId&&(a.pointerId=this._mouseId),0!==p[Z.MouseWheelX]&&(P.inputIndex=Z.MouseWheelX,this._onInputChanged(v,0,P)),0!==p[Z.MouseWheelY]&&(P.inputIndex=Z.MouseWheelY,this._onInputChanged(v,0,P)),0!==p[Z.MouseWheelZ]&&(P.inputIndex=Z.MouseWheelZ,this._onInputChanged(v,0,P))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=a=>{a.buttons>1&&this._pointerCancelEvent(a)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!a&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(y.Mouse)){const a=this._inputs[y.Mouse][0];a[Z.MouseWheelX]=0,a[Z.MouseWheelY]=0,a[Z.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=a=>{this._addGamePad(a.gamepad)},this._gamepadDisconnectedEvent=a=>{if(this._gamepads){const v=this._getGamepadDeviceType(a.gamepad.id),p=a.gamepad.index;this._unregisterDevice(v,p),delete this._gamepads[p]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(a,v,p){const P=navigator.getGamepads()[v];if(P&&a===this._gamepads[v]){const b=this._inputs[a][v];p>=P.buttons.length?b[p]=P.axes[p-P.buttons.length].valueOf():b[p]=P.buttons[p].value}}_getGamepadDeviceType(a){return-1!==a.indexOf("054c")?-1!==a.indexOf("0ce6")?y.DualSense:y.DualShock:-1!==a.indexOf("Xbox One")||-1!==a.search("Xbox 360")||-1!==a.search("xinput")?y.Xbox:-1!==a.indexOf("057e")?y.Switch:y.Generic}_getPointerType(a){let v=y.Mouse;return("touch"===a.pointerType||"pen"===a.pointerType||a.touches)&&(v=y.Touch),v}}class o{constructor(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=v,this.deviceSlot=p,this.onInputChangedObservable=new L.c,this._deviceInputSystem=a}getInput(a){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,a)}}class m{constructor(a){this._registeredManagers=new Array,this._refCount=0,this.registerManager=a=>{for(let v=0;v<this._devices.length;v++){const p=this._devices[v];for(const P in p){const p=+P;a._addDevice(new o(this._deviceInputSystem,v,p))}}this._registeredManagers.push(a)},this.unregisterManager=a=>{const v=this._registeredManagers.indexOf(a);v>-1&&this._registeredManagers.splice(v,1)};const v=Object.keys(y).length/2;this._devices=new Array(v);const p=(a,v)=>{this._devices[a]||(this._devices[a]=new Array),this._devices[a][v]||(this._devices[a][v]=v);for(const p of this._registeredManagers){const P=new o(this._deviceInputSystem,a,v);p._addDevice(P)}},P=(a,v)=>{var p;null!==(p=this._devices[a])&&void 0!==p&&p[v]&&delete this._devices[a][v];for(const P of this._registeredManagers)P._removeDevice(a,v)},b=(a,v,p)=>{if(p)for(const P of this._registeredManagers)P._onInputChanged(a,v,p)};"undefined"!==typeof _native?this._deviceInputSystem=new B(p,P,b):this._deviceInputSystem=new r(a,p,P,b)}dispose(){this._deviceInputSystem.dispose()}}class O{getDeviceSource(a,v){if(void 0===v){if(void 0===this._firstDevice[a])return null;v=this._firstDevice[a]}return this._devices[a]&&void 0!==this._devices[a][v]?this._devices[a][v]:null}getDeviceSources(a){return this._devices[a]?this._devices[a].filter((a=>!!a)):[]}constructor(a){const v=Object.keys(y).length/2;this._devices=new Array(v),this._firstDevice=new Array(v),this._engine=a,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new m(a)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new L.c((a=>{for(const v of this._devices)if(v)for(const p of v)p&&this.onDeviceConnectedObservable.notifyObserver(a,p)})),this.onDeviceDisconnectedObservable=new L.c,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=a.uj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.uj.remove(this._onDisposeObserver)}_addDevice(a){this._devices[a.deviceType]||(this._devices[a.deviceType]=new Array),this._devices[a.deviceType][a.deviceSlot]||(this._devices[a.deviceType][a.deviceSlot]=a,this._updateFirstDevices(a.deviceType)),this.onDeviceConnectedObservable.notifyObservers(a)}_removeDevice(a,v){var p,P;const b=null===(p=this._devices[a])||void 0===p?void 0:p[v];this.onDeviceDisconnectedObservable.notifyObservers(b),null!==(P=this._devices[a])&&void 0!==P&&P[v]&&delete this._devices[a][v],this._updateFirstDevices(a)}_onInputChanged(a,v,p){var P,b;null===(P=this._devices[a])||void 0===P||null===(b=P[v])||void 0===b||b.onInputChangedObservable.notifyObservers(p)}_updateFirstDevices(a){switch(a){case y.Keyboard:case y.Mouse:this._firstDevice[a]=0;break;case y.Touch:case y.DualSense:case y.DualShock:case y.Xbox:case y.Switch:case y.Generic:{delete this._firstDevice[a];const v=this._devices[a];if(v)for(let p=0;p<v.length;p++)if(v[p]){this._firstDevice[a]=p;break}break}}}}var Y=p(11352);class l{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(a){this._singleClick=a}set doubleClick(a){this._doubleClick=a}set hasSwiped(a){this._hasSwiped=a}set ignore(a){this._ignore=a}}class z{constructor(a){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new C.o(0,0),this._previousStartingPointerPosition=new C.o(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=a||X.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(a){return this._meshUnderPointerId[a]||null}get unTranslatedPointer(){return new C.o(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(a){this._pointerX=a}get pointerY(){return this._pointerY}set pointerY(a){this._pointerY=a}_updatePointerPosition(a){const v=this._scene.getEngine().getInputElementClientRect();v&&(this._pointerX=a.clientX-v.left,this._pointerY=a.clientY-v.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(a,v){const p=this._scene,P=p.getEngine(),b=P.getInputElement();b&&(b.tabIndex=P.canvasTabIndex,p.doNotHandleCursors||(b.style.cursor=p.defaultCursor)),this._setCursorAndPointerOverMesh(a,v,p);for(const K of p._pointerMoveStage){var L;const p=!(null===(L=a=a||this._pickMove(v))||void 0===L||!L.pickedMesh);a=K.action(this._unTranslatedPointerX,this._unTranslatedPointerY,a,p,b)}const t=v.inputIndex>=Z.MouseWheelX&&v.inputIndex<=Z.MouseWheelZ?s.e.POINTERWHEEL:s.e.POINTERMOVE;let V;p.onPointerMove&&(a=a||this._pickMove(v),p.onPointerMove(v,a,t)),a?(V=new s.k(t,v,a),this._setRayOnPointerInfo(a,v)):(V=new s.k(t,v,null,this),this._movePointerInfo=V),p.onPointerObservable.hasObservers()&&p.onPointerObservable.notifyObservers(V,t)}_setRayOnPointerInfo(a,v){const p=this._scene;a&&Y.e._IsPickingAvailable&&(a.ray||(a.ray=p.createPickingRay(v.offsetX,v.offsetY,C.e.Identity(),p.activeCamera)))}_addCameraPointerObserver(a,v){return this._cameraObserverCount++,this._scene.onPointerObservable.add(a,v)}_removeCameraPointerObserver(a){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(a)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(a,v,p){const P=this._scene,b=new s.g(p,v,this._unTranslatedPointerX,this._unTranslatedPointerY);return a&&(b.originalPickingInfo=a,b.ray=a.ray,"xr-near"===v.pointerType&&a.originMesh&&(b.nearInteractionPickingInfo=a)),P.onPrePointerObservable.notifyObservers(b,p),!!b.skipOnPointerObservable}_pickMove(a){const v=this._scene,p=v.md(this._unTranslatedPointerX,this._unTranslatedPointerY,v.pointerMovePredicate,v.pointerMoveFastCheck,v.cameraToUseForPointers,v.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(p,a,v),p}_setCursorAndPointerOverMesh(a,v,p){const P=p.getEngine().getInputElement();if(null!==a&&void 0!==a&&a.pickedMesh){if(this.setPointerOverMesh(a.pickedMesh,v.pointerId,a,v),!p.doNotHandleCursors&&P&&this._pointerOverMesh){const a=this._pointerOverMesh._getActionManagerForTrigger();a&&a.hasPointerTriggers&&(P.style.cursor=a.hoverCursor||p.hoverCursor)}}else this.setPointerOverMesh(null,v.pointerId,a,v)}simulatePointerMove(a,v){const p=new PointerEvent("pointermove",v);p.inputIndex=Z.Move,this._checkPrePointerObservable(a,p,s.e.POINTERMOVE)||this._processPointerMove(a,p)}simulatePointerDown(a,v){const p=new PointerEvent("pointerdown",v);p.inputIndex=p.button+2,this._checkPrePointerObservable(a,p,s.e.POINTERDOWN)||this._processPointerDown(a,p)}_processPointerDown(a,v){var p;const P=this._scene;if(null!==(p=a)&&void 0!==p&&p.pickedMesh){this._pickedDownMesh=a.pickedMesh;const p=a.pickedMesh._getActionManagerForTrigger();if(p){if(p.hasPickTriggers)switch(p.processTrigger(5,f.CreateNew(a.pickedMesh,v,a)),v.button){case 0:p.processTrigger(2,f.CreateNew(a.pickedMesh,v,a));break;case 1:p.processTrigger(4,f.CreateNew(a.pickedMesh,v,a));break;case 2:p.processTrigger(3,f.CreateNew(a.pickedMesh,v,a))}p.hasSpecificTrigger(8)&&window.setTimeout((()=>{const a=P.md(this._unTranslatedPointerX,this._unTranslatedPointerY,(a=>a.Ib&&a.isVisible&&a.isReady()&&a.actionManager&&a.actionManager.hasSpecificTrigger(8)&&a===this._pickedDownMesh),!1,P.cameraToUseForPointers);null!==a&&void 0!==a&&a.pickedMesh&&p&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>z.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,p.processTrigger(8,f.CreateNew(a.pickedMesh,v)))}),z.LongPressDelay)}}else for(const t of P._pointerDownStage)a=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,a,v,!1);let b;const L=s.e.POINTERDOWN;a?(P.onPointerDown&&P.onPointerDown(v,a,L),b=new s.k(L,v,a),this._setRayOnPointerInfo(a,v)):b=new s.k(L,v,null,this),P.onPointerObservable.hasObservers()&&P.onPointerObservable.notifyObservers(b,L)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(a,v,p){const P=new PointerEvent("pointerup",v);P.inputIndex=Z.Move;const b=new l;p?b.doubleClick=!0:b.singleClick=!0,this._checkPrePointerObservable(a,P,s.e.POINTERUP)||this._processPointerUp(a,P,b)}_processPointerUp(a,v,p){var P;const b=this._scene;if(null!==(P=a)&&void 0!==P&&P.pickedMesh){if(this._pickedUpMesh=a.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(b.onPointerPick&&b.onPointerPick(v,a),p.singleClick&&!p.ignore&&b.onPointerObservable.observers.length>this._cameraObserverCount)){const p=s.e.POINTERPICK,P=new s.k(p,v,a);this._setRayOnPointerInfo(a,v),b.onPointerObservable.notifyObservers(P,p)}const P=a.pickedMesh._getActionManagerForTrigger();if(P&&!p.ignore){P.processTrigger(7,f.CreateNew(a.pickedMesh,v,a)),!p.hasSwiped&&p.singleClick&&P.processTrigger(1,f.CreateNew(a.pickedMesh,v,a));const b=a.pickedMesh._getActionManagerForTrigger(6);p.doubleClick&&b&&b.processTrigger(6,f.CreateNew(a.pickedMesh,v,a))}}else if(!p.ignore)for(const L of b._pointerUpStage)a=L.action(this._unTranslatedPointerX,this._unTranslatedPointerY,a,v,p.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const a=this._pickedDownMesh._getActionManagerForTrigger(16);a&&a.processTrigger(16,f.CreateNew(this._pickedDownMesh,v))}if(!p.ignore){const P=new s.k(s.e.POINTERUP,v,a);if(this._setRayOnPointerInfo(a,v),b.onPointerObservable.notifyObservers(P,s.e.POINTERUP),b.onPointerUp&&b.onPointerUp(v,a,s.e.POINTERUP),!p.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let P=0;if(p.singleClick?P=s.e.POINTERTAP:p.doubleClick&&(P=s.e.POINTERDOUBLETAP),P){const p=new s.k(P,v,a);b.onPointerObservable.hasObservers()&&b.onPointerObservable.hasSpecificMask(P)&&b.onPointerObservable.notifyObservers(p,P)}}}}isPointerCaptured(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[a]}attachControl(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=this._scene,L=b.getEngine();P||(P=L.getInputElement()),this._alreadyAttached&&this.bj(),P&&(this._alreadyAttachedTo=P),this._deviceSourceManager=new O(L),this._initActionManager=a=>{if(!this._meshPickProceed){const v=b.skipPointerUpPicking||0===b._registeredActions&&!this._checkForPicking()&&!b.onPointerUp?null:b.md(this._unTranslatedPointerX,this._unTranslatedPointerY,b.pointerUpPredicate,b.pointerUpFastCheck,b.cameraToUseForPointers,b.pointerUpTrianglePredicate);this._currentPickResult=v,v&&(a=v.hit&&v.pickedMesh?v.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return a},this._delayedSimpleClick=(a,v,p)=>{if((Date.now()-this._previousStartingPointerTime>z.DoubleClickDelay&&!this._doubleClickOccured||a!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,v.singleClick=!0,v.ignore=!1,this._delayedClicks[a])){const v=this._delayedClicks[a].evt,p=s.e.POINTERTAP,P=new s.k(p,v,this._currentPickResult);b.onPointerObservable.hasObservers()&&b.onPointerObservable.hasSpecificMask(p)&&b.onPointerObservable.notifyObservers(P,p),this._delayedClicks[a]=null}},this._initClickEvent=(a,v,p,P)=>{const b=new l;this._currentPickResult=null;let L=null,t=a.hasSpecificMask(s.e.POINTERPICK)||v.hasSpecificMask(s.e.POINTERPICK)||a.hasSpecificMask(s.e.POINTERTAP)||v.hasSpecificMask(s.e.POINTERTAP)||a.hasSpecificMask(s.e.POINTERDOUBLETAP)||v.hasSpecificMask(s.e.POINTERDOUBLETAP);!t&&D&&(L=this._initActionManager(L,b),L&&(t=L.hasPickTriggers));let V=!1;if(t){const t=p.button;if(b.hasSwiped=this._isPointerSwiping(),!b.hasSwiped){let F=!z.ExclusiveDoubleClickMode;if(F||(F=!a.hasSpecificMask(s.e.POINTERDOUBLETAP)&&!v.hasSpecificMask(s.e.POINTERDOUBLETAP),F&&!D.HasSpecificTrigger(6)&&(L=this._initActionManager(L,b),L&&(F=!L.hasSpecificTrigger(6)))),F)(Date.now()-this._previousStartingPointerTime>z.DoubleClickDelay||t!==this._previousButtonPressed)&&(b.singleClick=!0,P(b,this._currentPickResult),V=!0);else{const a={evt:p,clickInfo:b,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,t,b,P),z.DoubleClickDelay)};this._delayedClicks[t]=a}let u=a.hasSpecificMask(s.e.POINTERDOUBLETAP)||v.hasSpecificMask(s.e.POINTERDOUBLETAP);if(!u&&D.HasSpecificTrigger(6)&&(L=this._initActionManager(L,b),L&&(u=L.hasSpecificTrigger(6))),u)if(t===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<z.DoubleClickDelay&&!this._doubleClickOccured){if(b.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=t,z.ExclusiveDoubleClickMode){var K;if(this._delayedClicks[t])clearTimeout(null===(K=this._delayedClicks[t])||void 0===K?void 0:K.timeoutId),this._delayedClicks[t]=null;P(b,this._previousPickResult)}else P(b,this._currentPickResult);else{var C;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,b.doubleClick=!0,b.ignore=!1,z.ExclusiveDoubleClickMode&&this._delayedClicks[t])clearTimeout(null===(C=this._delayedClicks[t])||void 0===C?void 0:C.timeoutId),this._delayedClicks[t]=null;P(b,this._currentPickResult)}V=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=t}}V||P(b,this._currentPickResult)},this._onPointerMove=a=>{if(this._updatePointerPosition(a),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>z.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>z.DragMovementThreshold),L.isPointerLock&&L._verifyPointerLock(),this._checkPrePointerObservable(null,a,a.inputIndex>=Z.MouseWheelX&&a.inputIndex<=Z.MouseWheelZ?s.e.POINTERWHEEL:s.e.POINTERMOVE))return;if(!b.cameraToUseForPointers&&!b.activeCamera)return;if(b.kj)return void this._processPointerMove(new c.b,a);b.pointerMovePredicate||(b.pointerMovePredicate=a=>a.Ib&&a.isVisible&&a.isReady()&&a.isEnabled()&&(a.enablePointerMoveEvents||b.constantlyUpdateMeshUnderPointer||null!==a._getActionManagerForTrigger())&&(!b.cameraToUseForPointers||0!==(b.cameraToUseForPointers.layerMask&a.layerMask)));const v=b._registeredActions>0||b.constantlyUpdateMeshUnderPointer?this._pickMove(a):null;this._processPointerMove(v,a)},this._onPointerDown=a=>{const v=this._activePointerIds.indexOf(-1);if(-1===v?this._activePointerIds.push(a.pointerId):this._activePointerIds[v]=a.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,z.ExclusiveDoubleClickMode)for(let P=0;P<this._delayedClicks.length;P++)if(this._delayedClicks[P])if(a.button===P){var p;clearTimeout(null===(p=this._delayedClicks[P])||void 0===p?void 0:p.timeoutId)}else{const a=this._delayedClicks[P].clickInfo;this._doubleClickOccured=!1,a.singleClick=!0,a.ignore=!1;const v=this._delayedClicks[P].evt,p=s.e.POINTERTAP,L=new s.k(p,v,this._currentPickResult);b.onPointerObservable.hasObservers()&&b.onPointerObservable.hasSpecificMask(p)&&b.onPointerObservable.notifyObservers(L,p),this._delayedClicks[P]=null}if(this._updatePointerPosition(a),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=a.button),b.preventDefaultOnPointerDown&&P&&(a.preventDefault(),P.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,a,s.e.POINTERDOWN))return;if(!b.cameraToUseForPointers&&!b.activeCamera)return;let L;this._pointerCaptures[a.pointerId]=!0,b.pointerDownPredicate||(b.pointerDownPredicate=a=>a.Ib&&a.isVisible&&a.isReady()&&a.isEnabled()&&(!b.cameraToUseForPointers||0!==(b.cameraToUseForPointers.layerMask&a.layerMask))),this._pickedDownMesh=null,L=b.skipPointerDownPicking||0===b._registeredActions&&!this._checkForPicking()&&!b.onPointerDown?new c.b:b.md(this._unTranslatedPointerX,this._unTranslatedPointerY,b.pointerDownPredicate,b.pointerDownFastCheck,b.cameraToUseForPointers,b.pointerDownTrianglePredicate),this._processPointerDown(L,a)},this._onPointerUp=a=>{const v=this._activePointerIds.indexOf(a.pointerId);-1!==v&&(this._activePointerIds[v]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(a),b.preventDefaultOnPointerUp&&P&&(a.preventDefault(),P.focus()),this._initClickEvent(b.onPrePointerObservable,b.onPointerObservable,a,((v,p)=>{if(b.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!v.ignore)){if(this._checkPrePointerObservable(null,a,s.e.POINTERUP))return this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===a.buttons&&(this._pointerCaptures[a.pointerId]=!1));v.hasSwiped||(v.singleClick&&b.onPrePointerObservable.hasSpecificMask(s.e.POINTERTAP)&&this._checkPrePointerObservable(null,a,s.e.POINTERTAP)&&(this._skipPointerTap=!0),v.doubleClick&&b.onPrePointerObservable.hasSpecificMask(s.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,a,s.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[a.pointerId]?(0===a.buttons&&(this._pointerCaptures[a.pointerId]=!1),(b.cameraToUseForPointers||b.activeCamera)&&(b.pointerUpPredicate||(b.pointerUpPredicate=a=>a.Ib&&a.isVisible&&a.isReady()&&a.isEnabled()&&(!b.cameraToUseForPointers||0!==(b.cameraToUseForPointers.layerMask&a.layerMask))),!this._meshPickProceed&&(D&&D.HasTriggers||this._checkForPicking()||b.onPointerUp)&&this._initActionManager(null,v),p||(p=this._currentPickResult),this._processPointerUp(p,a,v),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===a.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=a=>{const v=j.d.KEYDOWN;if(b.onPreKeyboardObservable.hasObservers()){const p=new j.h(v,a);if(b.onPreKeyboardObservable.notifyObservers(p,v),p.skipOnKeyboardObservable)return}if(b.onKeyboardObservable.hasObservers()){const p=new j.l(v,a);b.onKeyboardObservable.notifyObservers(p,v)}b.actionManager&&b.actionManager.processTrigger(14,f.CreateNewFromScene(b,a))},this._onKeyUp=a=>{const v=j.d.KEYUP;if(b.onPreKeyboardObservable.hasObservers()){const p=new j.h(v,a);if(b.onPreKeyboardObservable.notifyObservers(p,v),p.skipOnKeyboardObservable)return}if(b.onKeyboardObservable.hasObservers()){const p=new j.l(v,a);b.onKeyboardObservable.notifyObservers(p,v)}b.actionManager&&b.actionManager.processTrigger(15,f.CreateNewFromScene(b,a))},this._deviceSourceManager.onDeviceConnectedObservable.add((P=>{P.deviceType===y.Mouse?P.onInputChangedObservable.add((b=>{this._originMouseEvent=b,b.inputIndex===Z.LeftClick||b.inputIndex===Z.MiddleClick||b.inputIndex===Z.RightClick||b.inputIndex===Z.BrowserBack||b.inputIndex===Z.BrowserForward?v&&1===P.getInput(b.inputIndex)?this._onPointerDown(b):a&&0===P.getInput(b.inputIndex)&&this._onPointerUp(b):p&&(b.inputIndex===Z.Move?this._onPointerMove(b):b.inputIndex!==Z.MouseWheelX&&b.inputIndex!==Z.MouseWheelY&&b.inputIndex!==Z.MouseWheelZ||this._onPointerMove(b))})):P.deviceType===y.Touch?P.onInputChangedObservable.add((b=>{b.inputIndex===Z.LeftClick&&(v&&1===P.getInput(b.inputIndex)?(this._onPointerDown(b),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):a&&0===P.getInput(b.inputIndex)&&(this._onPointerUp(b),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),p&&b.inputIndex===Z.Move&&this._onPointerMove(b)})):P.deviceType===y.Keyboard&&P.onInputChangedObservable.add((a=>{"keydown"===a.type?this._onKeyDown(a):"keyup"===a.type&&this._onKeyUp(a)}))})),this._alreadyAttached=!0}bj(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0,P=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[v]===a&&(!a||!a._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const b=this._meshUnderPointerId[v];let L;b&&(L=b._getActionManagerForTrigger(10),L&&L.processTrigger(10,f.CreateNew(b,P,{pointerId:v}))),a?(this._meshUnderPointerId[v]=a,this._pointerOverMesh=a,L=a._getActionManagerForTrigger(9),L&&L.processTrigger(9,f.CreateNew(a,P,{pointerId:v,pickResult:p}))):(delete this._meshUnderPointerId[v],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(a){this._pointerOverMesh===a&&(this._pointerOverMesh=null),this._pickedDownMesh===a&&(this._pickedDownMesh=null),this._pickedUpMesh===a&&(this._pickedUpMesh=null);for(const v in this._meshUnderPointerId)this._meshUnderPointerId[v]===a&&delete this._meshUnderPointerId[v]}}z.DragMovementThreshold=10,z.LongPressDelay=500,z.DoubleClickDelay=300,z.ExclusiveDoubleClickMode=!1;var g=p(11042),G=p(11279),e=p(11354),k=p(11365),d=p(10947),E=p(11374),W=p(11254);class U{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.kj=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var N,i=p(10905),I=p(11027);!function(a){a[a.BackwardCompatible=0]="BackwardCompatible",a[a.Intermediate=1]="Intermediate",a[a.Aggressive=2]="Aggressive"}(N||(N={}));class aa{static DefaultMaterialFactory(a){throw(0,Q.c)("ob")}static CollisionCoordinatorFactory(){throw(0,Q.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(a){a!==this._clearColor&&(this._clearColor=a,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(a){if(a!==this._performancePriority){switch(this._performancePriority=a,a){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.kj=!1,this.cj=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.kj=!0,this.cj=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.kj=!0,this.cj=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(a)}}set forceWireframe(a){this._forceWireframe!==a&&(this._forceWireframe=a,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(a){this._skipFrustumClipping!==a&&(this._skipFrustumClipping=a)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(a){this._forcePointsCloud!==a&&(this._forcePointsCloud=a,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(a){this._environmentTexture!==a&&(this._environmentTexture=a,this.markAllMaterialsAsDirty(1))}getNodes(){let a=[];return a=a.concat(this.meshes),a=a.concat(this.lights),a=a.concat(this.cameras),a=a.concat(this.transformNodes),this.skeletons.forEach((v=>a=a.concat(v.bones))),a}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}set beforeRender(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),a&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a))}set afterRender(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),a&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(a))}set beforeCameraRender(a){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(a)}set afterCameraRender(a){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(a)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(a){this._pointerPickingConfiguration.pointerDownPredicate=a}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(a){this._pointerPickingConfiguration.pointerUpPredicate=a}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(a){this._pointerPickingConfiguration.pointerMovePredicate=a}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(a){this._pointerPickingConfiguration.pointerDownFastCheck=a}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(a){this._pointerPickingConfiguration.pointerUpFastCheck=a}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(a){this._pointerPickingConfiguration.pointerMoveFastCheck=a}get kj(){return this._pointerPickingConfiguration.kj}set kj(a){this._pointerPickingConfiguration.kj=a}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(a){this._pointerPickingConfiguration.skipPointerDownPicking=a}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(a){this._pointerPickingConfiguration.skipPointerUpPicking=a}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return z.DragMovementThreshold}static set DragMovementThreshold(a){z.DragMovementThreshold=a}static get LongPressDelay(){return z.LongPressDelay}static set LongPressDelay(a){z.LongPressDelay=a}static get DoubleClickDelay(){return z.DoubleClickDelay}static set DoubleClickDelay(a){z.DoubleClickDelay=a}static get ExclusiveDoubleClickMode(){return z.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(a){z.ExclusiveDoubleClickMode=a}bindEyePosition(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const P=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,b=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return C.k.Vector4[0].set(P.x,P.y,P.z,b?-1:1),a&&(p?a.setFloat3(v,C.k.Vector4[0].x,C.k.Vector4[0].y,C.k.Vector4[0].z):a.setVector4(v,C.k.Vector4[0])),C.k.Vector4[0]}finalizeSceneUbo(){const a=this.getSceneUniformBuffer(),v=this.bindEyePosition(null);return a.updateFloat4("vEyePosition",v.x,v.y,v.z,v.w),a.update(),a}set useRightHandedSystem(a){this._useRightHandedSystem!==a&&(this._useRightHandedSystem=a,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(a){this._currentStepId=a}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(a){this._fogEnabled!==a&&(this._fogEnabled=a,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(a){this._fogMode!==a&&(this._fogMode=a,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(a){this._shadowsEnabled!==a&&(this._shadowsEnabled=a,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(a){this._lightsEnabled!==a&&(this._lightsEnabled=a,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(a){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),a&&(this._unObserveActiveCameras=(0,W.i)(a,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=a}get activeCamera(){return this._activeCamera}set activeCamera(a){a!==this._activeCamera&&(this._activeCamera=a,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.Gi||(this.Gi=aa.DefaultMaterialFactory(this)),this.Gi}set defaultMaterial(a){this.Gi=a}set texturesEnabled(a){this._texturesEnabled!==a&&(this._texturesEnabled=a,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(a){if(this._frameGraph)return this._frameGraph=a,void(a||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=a,a&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(a){this._skeletonsEnabled!==a&&(this._skeletonsEnabled=a,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=aa.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const a of this._transientComponents)a.register();this._transientComponents.length=0}}o(a){this._components.push(a),this._transientComponents.push(a);const v=a;v.addFromContainer&&v.serialize&&this._serializableComponents.push(v)}_getComponent(a){for(const v of this._components)if(v.name===a)return v;return null}constructor(a,v){this._inputManager=new z(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.cj=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new G.e(.2,.2,.3,1),this.onClearColorChangedObservable=new L.c,this.ambientColor=new G.d(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new L.c,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Bj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.kk=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.uj=new L.c,this._onDisposeObserver=null,this.onBeforeRenderObservable=new L.c,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new L.c,this.onAfterRenderCameraObservable=new L.c,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new L.c,this.onAfterAnimationsObservable=new L.c,this.onBeforeDrawPhaseObservable=new L.c,this.onAfterDrawPhaseObservable=new L.c,this.onReadyObservable=new L.c,this.onBeforeCameraRenderObservable=new L.c,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new L.c,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new L.c,this.onAfterActiveMeshesEvaluationObservable=new L.c,this.onBeforeParticlesRenderingObservable=new L.c,this.onAfterParticlesRenderingObservable=new L.c,this.onDataLoadedObservable=new L.c,this.onNewCameraAddedObservable=new L.c,this.onCameraRemovedObservable=new L.c,this.onNewLightAddedObservable=new L.c,this.onLightRemovedObservable=new L.c,this.onNewGeometryAddedObservable=new L.c,this.onGeometryRemovedObservable=new L.c,this.onNewTransformNodeAddedObservable=new L.c,this.onTransformNodeRemovedObservable=new L.c,this.onNewMeshAddedObservable=new L.c,this.onMeshRemovedObservable=new L.c,this.onNewSkeletonAddedObservable=new L.c,this.onSkeletonRemovedObservable=new L.c,this.onNewMaterialAddedObservable=new L.c,this.onNewMultiMaterialAddedObservable=new L.c,this.onMaterialRemovedObservable=new L.c,this.onMultiMaterialRemovedObservable=new L.c,this.onNewTextureAddedObservable=new L.c,this.onTextureRemovedObservable=new L.c,this.onBeforeRenderTargetsRenderObservable=new L.c,this.onAfterRenderTargetsRenderObservable=new L.c,this.onBeforeStepObservable=new L.c,this.onAfterStepObservable=new L.c,this.onActiveCameraChanged=new L.c,this.onActiveCamerasChanged=new L.c,this.onBeforeRenderingGroupObservable=new L.c,this.onAfterRenderingGroupObservable=new L.c,this.onMeshImportedObservable=new L.c,this.onAnimationFileImportedObservable=new L.c,this._registeredForLateAnimationBindings=new t.c(256),this._pointerPickingConfiguration=new U,this.onPrePointerObservable=new L.c,this.onPointerObservable=new L.c,this.onPreKeyboardObservable=new L.c,this.onKeyboardObservable=new L.c,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=aa.FOGMODE_NONE,this.fogColor=new G.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new C.s(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new t.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new g.c,this._activeIndices=new g.c,this._activeParticles=new g.c,this._activeBones=new g.c,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new t.e(256),this._processedMaterials=new t.e(256),this._renderTargets=new t.c(256),this._materialsRenderTargets=new t.c(256),this._activeParticleSystems=new t.e(256),this._activeSkeletons=new t.c(32),this._softwareSkinnedMeshes=new t.c(32),this._activeAnimatables=new Array,this._transformMatrix=C.e.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=h.e.Create(),this._beforeClearStage=h.e.Create(),this._beforeRenderTargetClearStage=h.e.Create(),this._gatherRenderTargetsStage=h.e.Create(),this._gatherActiveCameraRenderTargetsStage=h.e.Create(),this._isReadyForMeshStage=h.e.Create(),this._beforeEvaluateActiveMeshStage=h.e.Create(),this._evaluateSubMeshStage=h.e.Create(),this._preActiveMeshStage=h.e.Create(),this._cameraDrawRenderTargetStage=h.e.Create(),this._beforeCameraDrawStage=h.e.Create(),this._beforeRenderTargetDrawStage=h.e.Create(),this._beforeRenderingGroupDrawStage=h.e.Create(),this._beforeRenderingMeshStage=h.e.Create(),this._afterRenderingMeshStage=h.e.Create(),this._afterRenderingGroupDrawStage=h.e.Create(),this._afterCameraDrawStage=h.e.Create(),this._afterCameraPostProcessStage=h.e.Create(),this._afterRenderTargetDrawStage=h.e.Create(),this._afterRenderTargetPostProcessStage=h.e.Create(),this._afterRenderStage=h.e.Create(),this._pointerMoveStage=h.e.Create(),this._pointerDownStage=h.e.Create(),this._pointerUpStage=h.e.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const p={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...v};a=this._engine=a||X.b.LastCreatedEngine,p.virtual?a._virtualScenes.push(this):(X.b._LastCreatedScene=this,a.scenes.push(this)),this._uid=null,this._renderingManager=new A.e(this),H.d&&(this.postProcessManager=new H.d(this)),(0,R.n)()&&this.attachControl(),this._createUbo(),F.c&&(this._imageProcessingConfiguration=new F.c),this.setDefaultCandidateProviders(),p.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=p.useMaterialMeshMap,this.useClonedMeshMap=p.useClonedMeshMap,v&&v.virtual||a.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(a){return this._defaultSubMeshCandidates.data=a.rg,this._defaultSubMeshCandidates.length=a.rg.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=a=>this._getDefaultSubMeshCandidates(a),this.getIntersectingSubMeshCandidates=(a,v)=>this._getDefaultSubMeshCandidates(a),this.getCollidingSubMeshCandidates=(a,v)=>this._getDefaultSubMeshCandidates(a)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(a){this._inputManager.pointerX=a}get pointerY(){return this._inputManager.pointerY}set pointerY(a){this._inputManager.pointerY=a}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==v||this._cachedMaterial!==a||this._cachedVisibility!==p}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(a,v){return this._inputManager.simulatePointerMove(a,v),this}simulatePointerDown(a,v){return this._inputManager.simulatePointerDown(a,v),this}simulatePointerUp(a,v,p){return this._inputManager.simulatePointerUp(a,v,p),this}isPointerCaptured(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(a)}attachControl(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(a,v,p)}bj(){this._inputManager.bj()}isReady(){var a,v;let p,P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const b=this.getEngine(),L=b.currentRenderPassId;b.currentRenderPassId=(null===(a=this.activeCamera)||void 0===a?void 0:a.renderPassId)??L;let t=!0;for(this._pendingData.length>0&&(t=!1),null===(v=this.prePassRenderer)||void 0===v||v.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&t&&(t=this.depthPeelingRenderer.isReady()),P&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),p=0;p<this.meshes.length;p++){const a=this.meshes[p];if(!a.rg||0===a.rg.length)continue;if(!a.isReady(!0)){t=!1;continue}const v=a.hasThinInstances||"InstancedMesh"===a.getClassName()||"InstancedLinesMesh"===a.getClassName()||b.getCaps().instancedArrays&&a.instances.length>0;for(const p of this._isReadyForMeshStage)p.action(a,v)||(t=!1);if(!P)continue;const L=a.material||this.defaultMaterial;if(L)if(L._storeEffectOnSubMeshes)for(const p of a.rg){const a=p.Ha();a&&a.hasRenderTargetTextures&&null!=a.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(a)&&(this._processedMaterials.push(a),this._materialsRenderTargets.concatWithNoDuplicate(a.getRenderTargetTextures()))}else L.hasRenderTargetTextures&&null!=L.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(L)&&(this._processedMaterials.push(L),this._materialsRenderTargets.concatWithNoDuplicate(L.getRenderTargetTextures()))}if(P)for(p=0;p<this._materialsRenderTargets.length;++p){this._materialsRenderTargets.data[p].isReadyForRendering()||(t=!1)}for(p=0;p<this.geometries.length;p++){2===this.geometries[p].delayLoadState&&(t=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const V of this.activeCameras)V.isReady(!0)||(t=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(t=!1));for(const V of this.Bj)V.isReady()||(t=!1);if(this.layers)for(const V of this.layers)V.isReady()||(t=!1);return b.areAllEffectsReady()||(t=!1),b.currentRenderPassId=L,t}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(a){this.onBeforeRenderObservable.add(a)}unregisterBeforeRender(a){this.onBeforeRenderObservable.removeCallback(a)}registerAfterRender(a){this.onAfterRenderObservable.add(a)}unregisterAfterRender(a){this.onAfterRenderObservable.removeCallback(a)}_executeOnceBeforeRender(a){const v=()=>{a(),setTimeout((()=>{this.unregisterBeforeRender(v)}))};this.registerBeforeRender(v)}executeOnceBeforeRender(a,v){void 0!==v?setTimeout((()=>{this._executeOnceBeforeRender(a)}),v):this._executeOnceBeforeRender(a)}addPendingData(a){this._pendingData.push(a)}removePendingData(a){const v=this.isLoading,p=this._pendingData.indexOf(a);-1!==p&&this._pendingData.splice(p,1),v&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(a),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(v)}whenReadyAsync(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((v=>{this.executeWhenReady((()=>{v()}),a)}))}_checkIsReady(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(a)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(a)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=b.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(a,v,p,P){p||P||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===a.updateFlag&&this._projectionUpdateFlag===v.updateFlag||(this._viewUpdateFlag=a.updateFlag,this._projectionUpdateFlag=v.updateFlag,this._viewMatrix=a,this._projectionMatrix=v,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?e.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(p,P):this._sceneUbo.useUbo&&(this._sceneUbo.Sj("viewProjection",this._transformMatrix),this._sceneUbo.Sj("view",this._viewMatrix),this._sceneUbo.Sj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(a){const v=new u.b(this._engine,void 0,!1,a??"sd");return v.addUniform("viewProjection",16),v.addUniform("view",16),v.addUniform("projection",16),v.addUniform("vEyePosition",4),v}setSceneUniformBuffer(a){this._sceneUbo=a,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return k.e.UniqueId}xi(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(a),a._resyncLightSources(),a.parent||a._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(a),v&&a.getChildMeshes().forEach((a=>{this.xi(a)})))}Qc(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const p=this.meshes.indexOf(a);return-1!==p&&(this.meshes.splice(p,1),a.parent||a._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(a),this.onMeshRemovedObservable.notifyObservers(a),v&&a.getChildMeshes().forEach((a=>{this.Qc(a)})),p}addTransformNode(a){this._blockEntityCollection||a.va()===this&&-1!==a._indexInSceneTransformNodesArray||(a._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(a),a.parent||a._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(a))}removeTransformNode(a){const v=a._indexInSceneTransformNodesArray;if(-1!==v){if(v!==this.transformNodes.length-1){const a=this.transformNodes[this.transformNodes.length-1];this.transformNodes[v]=a,a._indexInSceneTransformNodesArray=v}a._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),a.parent||a._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(a),v}removeSkeleton(a){const v=this.skeletons.indexOf(a);return-1!==v&&(this.skeletons.splice(v,1),this.onSkeletonRemovedObservable.notifyObservers(a),this._executeActiveContainerCleanup(this._activeSkeletons)),v}removeMorphTargetManager(a){const v=this.morphTargetManagers.indexOf(a);return-1!==v&&this.morphTargetManagers.splice(v,1),v}removeLight(a){const v=this.lights.indexOf(a);if(-1!==v){for(const v of this.meshes)v._removeLightSource(a,!1);this.lights.splice(v,1),this.sortLightsByPriority(),a.parent||a._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(a),v}removeCamera(a){const v=this.cameras.indexOf(a);if(-1!==v&&(this.cameras.splice(v,1),a.parent||a._removeFromSceneRootNodes()),this.activeCameras){const v=this.activeCameras.indexOf(a);-1!==v&&this.activeCameras.splice(v,1)}return this.activeCamera===a&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(a),v}removeParticleSystem(a){const v=this.Bj.indexOf(a);return-1!==v&&(this.Bj.splice(v,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),v}removeAnimation(a){const v=this.animations.indexOf(a);return-1!==v&&this.animations.splice(v,1),v}stopAnimation(a,v,p){}removeAnimationGroup(a){const v=this.animationGroups.indexOf(a);return-1!==v&&this.animationGroups.splice(v,1),v}removeMultiMaterial(a){const v=this.multiMaterials.indexOf(a);return-1!==v&&this.multiMaterials.splice(v,1),this.onMultiMaterialRemovedObservable.notifyObservers(a),v}removeMaterial(a){const v=a._indexInSceneMaterialArray;if(-1!==v&&v<this.materials.length){if(v!==this.materials.length-1){const a=this.materials[this.materials.length-1];this.materials[v]=a,a._indexInSceneMaterialArray=v}a._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(a),v}removeActionManager(a){const v=this.actionManagers.indexOf(a);return-1!==v&&this.actionManagers.splice(v,1),v}removeTexture(a){const v=this.textures.indexOf(a);return-1!==v&&this.textures.splice(v,1),this.onTextureRemovedObservable.notifyObservers(a),v}addLight(a){if(!this._blockEntityCollection){this.lights.push(a),this.sortLightsByPriority(),a.parent||a._addToSceneRootNodes();for(const v of this.meshes)-1===v.lightSources.indexOf(a)&&(v.lightSources.push(a),v._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(a)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(E.e.CompareLightsPriority)}addCamera(a){this._blockEntityCollection||(this.cameras.push(a),this.onNewCameraAddedObservable.notifyObservers(a),a.parent||a._addToSceneRootNodes())}addSkeleton(a){this._blockEntityCollection||(this.skeletons.push(a),this.onNewSkeletonAddedObservable.notifyObservers(a))}addParticleSystem(a){this._blockEntityCollection||this.Bj.push(a)}addAnimation(a){this._blockEntityCollection||this.animations.push(a)}addAnimationGroup(a){this._blockEntityCollection||this.animationGroups.push(a)}addMultiMaterial(a){this._blockEntityCollection||(this.multiMaterials.push(a),this.onNewMultiMaterialAddedObservable.notifyObservers(a))}addMaterial(a){this._blockEntityCollection||a.va()===this&&-1!==a._indexInSceneMaterialArray||(a._indexInSceneMaterialArray=this.materials.length,this.materials.push(a),this.onNewMaterialAddedObservable.notifyObservers(a))}addMorphTargetManager(a){this._blockEntityCollection||this.morphTargetManagers.push(a)}addGeometry(a){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[a.uniqueId]=this.geometries.length),this.geometries.push(a))}addActionManager(a){this.actionManagers.push(a)}addTexture(a){this._blockEntityCollection||(this.textures.push(a),this.onNewTextureAddedObservable.notifyObservers(a))}switchActiveCamera(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.bj(),this.activeCamera=a,v&&a.attachControl())}setActiveCameraById(a){const v=this.getCameraById(a);return v?(this.activeCamera=v,v):null}setActiveCameraByName(a){const v=this.getCameraByName(a);return v?(this.activeCamera=v,v):null}getAnimationGroupByName(a){for(let v=0;v<this.animationGroups.length;v++)if(this.animationGroups[v].name===a)return this.animationGroups[v];return null}_getMaterial(a,v){for(let p=0;p<this.materials.length;p++){const a=this.materials[p];if(v(a))return a}if(a)for(let p=0;p<this.multiMaterials.length;p++){const a=this.multiMaterials[p];if(v(a))return a}return null}getMaterialByUniqueID(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(v,(v=>v.uniqueId===a))}getMaterialById(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(v,(v=>v.id===a))}getMaterialByName(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(v,(v=>v.name===a))}getLastMaterialById(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let p=this.materials.length-1;p>=0;p--)if(this.materials[p].id===a)return this.materials[p];if(v)for(let p=this.multiMaterials.length-1;p>=0;p--)if(this.multiMaterials[p].id===a)return this.multiMaterials[p];return null}getTextureByUniqueId(a){for(let v=0;v<this.textures.length;v++)if(this.textures[v].uniqueId===a)return this.textures[v];return null}getTextureByName(a){for(let v=0;v<this.textures.length;v++)if(this.textures[v].name===a)return this.textures[v];return null}getCameraById(a){for(let v=0;v<this.cameras.length;v++)if(this.cameras[v].id===a)return this.cameras[v];return null}getCameraByUniqueId(a){for(let v=0;v<this.cameras.length;v++)if(this.cameras[v].uniqueId===a)return this.cameras[v];return null}getCameraByName(a){for(let v=0;v<this.cameras.length;v++)if(this.cameras[v].name===a)return this.cameras[v];return null}getBoneById(a){for(let v=0;v<this.skeletons.length;v++){const p=this.skeletons[v];for(let v=0;v<p.bones.length;v++)if(p.bones[v].id===a)return p.bones[v]}return null}getBoneByName(a){for(let v=0;v<this.skeletons.length;v++){const p=this.skeletons[v];for(let v=0;v<p.bones.length;v++)if(p.bones[v].name===a)return p.bones[v]}return null}getLightByName(a){for(let v=0;v<this.lights.length;v++)if(this.lights[v].name===a)return this.lights[v];return null}getLightById(a){for(let v=0;v<this.lights.length;v++)if(this.lights[v].id===a)return this.lights[v];return null}getLightByUniqueId(a){for(let v=0;v<this.lights.length;v++)if(this.lights[v].uniqueId===a)return this.lights[v];return null}getParticleSystemById(a){for(let v=0;v<this.Bj.length;v++)if(this.Bj[v].id===a)return this.Bj[v];return null}getGeometryById(a){for(let v=0;v<this.geometries.length;v++)if(this.geometries[v].id===a)return this.geometries[v];return null}_getGeometryByUniqueId(a){if(this._geometriesByUniqueId){const v=this._geometriesByUniqueId[a];if(void 0!==v)return this.geometries[v]}else for(let v=0;v<this.geometries.length;v++)if(this.geometries[v].uniqueId===a)return this.geometries[v];return null}pushGeometry(a,v){return!(!v&&this._getGeometryByUniqueId(a.uniqueId))&&(this.addGeometry(a),this.onNewGeometryAddedObservable.notifyObservers(a),!0)}removeGeometry(a){let v;if(this._geometriesByUniqueId){if(v=this._geometriesByUniqueId[a.uniqueId],void 0===v)return!1}else if(v=this.geometries.indexOf(a),v<0)return!1;if(v!==this.geometries.length-1){const a=this.geometries[this.geometries.length-1];a&&(this.geometries[v]=a,this._geometriesByUniqueId&&(this._geometriesByUniqueId[a.uniqueId]=v))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[a.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(a),!0}getGeometries(){return this.geometries}getMeshById(a){for(let v=0;v<this.meshes.length;v++)if(this.meshes[v].id===a)return this.meshes[v];return null}getMeshesById(a){return this.meshes.filter((function(v){return v.id===a}))}getTransformNodeById(a){for(let v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].id===a)return this.transformNodes[v];return null}getTransformNodeByUniqueId(a){for(let v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].uniqueId===a)return this.transformNodes[v];return null}getTransformNodesById(a){return this.transformNodes.filter((function(v){return v.id===a}))}getMeshByUniqueId(a){for(let v=0;v<this.meshes.length;v++)if(this.meshes[v].uniqueId===a)return this.meshes[v];return null}getLastMeshById(a){for(let v=this.meshes.length-1;v>=0;v--)if(this.meshes[v].id===a)return this.meshes[v];return null}getLastTransformNodeById(a){for(let v=this.transformNodes.length-1;v>=0;v--)if(this.transformNodes[v].id===a)return this.transformNodes[v];return null}getLastEntryById(a){let v;for(v=this.meshes.length-1;v>=0;v--)if(this.meshes[v].id===a)return this.meshes[v];for(v=this.transformNodes.length-1;v>=0;v--)if(this.transformNodes[v].id===a)return this.transformNodes[v];for(v=this.cameras.length-1;v>=0;v--)if(this.cameras[v].id===a)return this.cameras[v];for(v=this.lights.length-1;v>=0;v--)if(this.lights[v].id===a)return this.lights[v];return null}getNodeById(a){const v=this.getMeshById(a);if(v)return v;const p=this.getTransformNodeById(a);if(p)return p;const P=this.getLightById(a);if(P)return P;const b=this.getCameraById(a);if(b)return b;const L=this.getBoneById(a);return L||null}getNodeByName(a){const v=this.getMeshByName(a);if(v)return v;const p=this.getTransformNodeByName(a);if(p)return p;const P=this.getLightByName(a);if(P)return P;const b=this.getCameraByName(a);if(b)return b;const L=this.getBoneByName(a);return L||null}getMeshByName(a){for(let v=0;v<this.meshes.length;v++)if(this.meshes[v].name===a)return this.meshes[v];return null}getTransformNodeByName(a){for(let v=0;v<this.transformNodes.length;v++)if(this.transformNodes[v].name===a)return this.transformNodes[v];return null}getLastSkeletonById(a){for(let v=this.skeletons.length-1;v>=0;v--)if(this.skeletons[v].id===a)return this.skeletons[v];return null}getSkeletonByUniqueId(a){for(let v=0;v<this.skeletons.length;v++)if(this.skeletons[v].uniqueId===a)return this.skeletons[v];return null}getSkeletonById(a){for(let v=0;v<this.skeletons.length;v++)if(this.skeletons[v].id===a)return this.skeletons[v];return null}getSkeletonByName(a){for(let v=0;v<this.skeletons.length;v++)if(this.skeletons[v].name===a)return this.skeletons[v];return null}getMorphTargetManagerById(a){for(let v=0;v<this.morphTargetManagers.length;v++)if(this.morphTargetManagers[v].uniqueId===a)return this.morphTargetManagers[v];return null}getMorphTargetById(a){for(let v=0;v<this.morphTargetManagers.length;++v){const p=this.morphTargetManagers[v];for(let v=0;v<p.numTargets;++v){const P=p.getTarget(v);if(P.id===a)return P}}return null}getMorphTargetByName(a){for(let v=0;v<this.morphTargetManagers.length;++v){const p=this.morphTargetManagers[v];for(let v=0;v<p.numTargets;++v){const P=p.getTarget(v);if(P.name===a)return P}}return null}getPostProcessByName(a){for(let v=0;v<this.postProcesses.length;++v){const p=this.postProcesses[v];if(p.name===a)return p}return null}isActiveMesh(a){return-1!==this._activeMeshes.indexOf(a)}get uid(){return this._uid||(this._uid=P.e.RandomId()),this._uid}addExternalData(a,v){return this._externalData||(this._externalData=new V),this._externalData.add(a,v)}getExternalData(a){return this._externalData?this._externalData.get(a):null}getOrAddExternalDataWithFactory(a,v){return this._externalData||(this._externalData=new V),this._externalData.getOrAddWithFactory(a,v)}removeExternalData(a){return this._externalData.remove(a)}_evaluateSubMesh(a,v,p,P){if(P||a.isInFrustum(this._frustumPlanes)){for(const P of this._evaluateSubMeshStage)P.action(v,a);const p=a.Ha();null!==p&&void 0!==p&&(p.hasRenderTargetTextures&&null!=p.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(p)&&(this._processedMaterials.push(p),this._materialsRenderTargets.concatWithNoDuplicate(p.getRenderTargetTextures())),this._renderingManager.dispatch(a,v,p))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(a){this._preventFreeActiveMeshesAndRenderingGroups!==a&&(a&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=a)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let a=0;a<this.activeCameras.length;a++){const v=this.activeCameras[a];v&&v._activeMeshes&&v._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let a=0;a<this.textures.length;a++){const v=this.textures[a];v&&v.renderList&&v.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=b,this._skipEvaluateActiveMeshesCompletely=a,P)for(let a=0;a<this._activeMeshes.length;a++)this._activeMeshes.data[a]._freeze();v&&v()}else p&&p("No active camera found")})),this}unfreezeActiveMeshes(){for(let a=0;a<this.meshes.length;a++){const v=this.meshes[a];v._internalAbstractMeshDataInfo&&(v._internalAbstractMeshDataInfo._isActive=!1)}for(let a=0;a<this._activeMeshes.length;a++)this._activeMeshes.data[a]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(a){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>a.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var a;if(this._activeMeshes.length>0)null===(a=this.activeCamera)||void 0===a||a._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const a=this._activeMeshes.length;for(let v=0;v<a;v++){this._activeMeshes.data[v].Zj()}}if(this._activeParticleSystems){const a=this._activeParticleSystems.length;for(let v=0;v<a;v++)this._activeParticleSystems.data[v].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const P of this._beforeEvaluateActiveMeshStage)P.action();const v=this.getActiveMeshCandidates(),p=v.length;for(let P=0;P<p;P++){const a=v.data[P];if(a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,a.isBlocked)continue;if(this._totalVertices.addCount(a.getTotalVertices(),!1),!a.isReady()||!a.isEnabled()||a.te.hasAZeroComponent)continue;a.Zj(),a.actionManager&&a.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(a);let p=this.customLODSelector?this.customLODSelector(a,this.activeCamera):a.getLOD(this.activeCamera);if(a._internalAbstractMeshDataInfo._currentLOD=p,a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==p&&null!==p&&(p!==a&&0!==p.billboardMode&&p.Zj(),a._preActivate(),a.isVisible&&a.visibility>0&&0!==(a.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||a.xb||a.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(a),this.activeCamera._activeMeshes.push(a),p!==a&&p._activate(this._renderId,!1);for(const v of this._preActiveMeshStage)v.action(a);a._activate(this._renderId,!1)&&(a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(p=a):p._internalAbstractMeshDataInfo._onlyForInstances=!1,p._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(a,p)),a._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let a=0;a<this.Bj.length;a++){const v=this.Bj[a];if(!v.isStarted()||!v.j)continue;const p=v.j;p.position&&!p.isEnabled()||(this._activeParticleSystems.push(v),v.animate(),this._renderingManager.dispatchParticles(v))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(a){this._skeletonsEnabled&&a.skeleton&&(this._activeSkeletons.pushNoDuplicate(a.skeleton)&&(a.skeleton.prepare(),this._activeBones.addCount(a.skeleton.bones.length,!1)),a.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(a)&&this.frameGraph&&a.applySkeleton(a.skeleton))}_activeMesh(a,v){this._prepareSkeleton(v);let p=a.hasInstances||a.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||v.xb;if(v&&v.rg&&v.rg.length>0){const P=this.getActiveSubMeshCandidates(v),b=P.length;p=p||1===b;for(let L=0;L<b;L++){const b=P.data[L];this._evaluateSubMesh(b,v,a,p)}}}updateTransformMatrix(a){const v=this.activeCamera;if(v)if(v._renderingMultiview){const p=v._rigCameras[0],P=v._rigCameras[1];this.setTransformMatrix(p.getViewMatrix(),p.getProjectionMatrix(a),P.getViewMatrix(),P.getProjectionMatrix(a))}else this.setTransformMatrix(v.getViewMatrix(),v.getProjectionMatrix(a))}_bindFrameBuffer(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&a._multiviewTexture?a._multiviewTexture._bindFrameBuffer():a&&a.outputRenderTarget?a.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),v&&this._clearFrameBuffer(a)}_clearFrameBuffer(a){if(a&&a._multiviewTexture);else if(a&&a.outputRenderTarget&&!a._renderingMultiview){const v=a.outputRenderTarget;v.onClearObservable.hasObservers()?v.onClearObservable.notifyObservers(this._engine):v.skipInitialClear||a.isRightCamera||(this.cj&&this._engine.clear(v.clearColor||this._clearColor,!v._cleared,!0,!0),v._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(a,v){var p;let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(a&&a._skipRendering)return;const L=this._engine;if(this._activeCamera=a,!this.activeCamera)throw new Error("Active camera not set");if(L.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&b){let v=!0;a._renderingMultiview&&a.outputRenderTarget&&(v=a.outputRenderTarget.skipInitialClear,this.cj&&(this._defaultFrameBufferCleared=!1,a.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),a._renderingMultiview&&a.outputRenderTarget&&(a.outputRenderTarget.skipInitialClear=v)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let P=0;P<this._softwareSkinnedMeshes.length;P++){const a=this._softwareSkinnedMeshes.data[P];a.applySkeleton(a.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),a.customRenderTargets&&a.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(a.customRenderTargets),v&&v.customRenderTargets&&v.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(v.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const P of this._gatherActiveCameraRenderTargetsStage)P.action(this._renderTargets);let t=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){P.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let a=0;a<this._renderTargets.length;a++){const v=this._renderTargets.data[a];if(v._shouldRender()){this._renderId++;const a=v.activeCamera&&v.activeCamera!==this.activeCamera;v.render(a,this.dumpNextRenderTargets),t=!0}}P.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const a of this._cameraDrawRenderTargetStage)t=a.action(this.activeCamera)||t;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(p=a.outputRenderTarget)||void 0===p?void 0:p.renderPassId)??a.renderPassId??0,t&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||a._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const P of this._beforeCameraDrawStage)P.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),L.snapshotRendering&&1===L.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const P of this._afterCameraDrawStage)P.action(this.activeCamera);if(this.postProcessManager&&!a._multiviewTexture){const v=a.outputRenderTarget?a.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(a.isIntermediate,v)}for(const P of this._afterCameraPostProcessStage)P.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===a.cameraRigMode||a._renderingMultiview)return a._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(a,void 0,v),void this.onAfterRenderCameraObservable.notifyObservers(a);if(a._useMultiviewToSingleView)this._renderMultiviewToSingleView(a);else{this.onBeforeCameraRenderObservable.notifyObservers(a);for(let v=0;v<a._rigCameras.length;v++)this._renderForCamera(a._rigCameras[v],a)}this._activeCamera=a,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(a)}_checkIntersections(){for(let a=0;a<this._meshesForIntersections.length;a++){const v=this._meshesForIntersections.data[a];if(v.actionManager)for(let a=0;v.actionManager&&a<v.actionManager.actions.length;a++){const p=v.actionManager.actions[a];if(12===p.trigger||13===p.trigger){const a=p.getTriggerParameter(),P=a.mesh?a.mesh:a,b=P.intersectsMesh(v,a.usePreciseIntersection),L=v._intersectionsInProgress.indexOf(P);b&&-1===L?12===p.trigger?(p._executeCurrent(f.CreateNew(v,void 0,P)),v._intersectionsInProgress.push(P)):13===p.trigger&&v._intersectionsInProgress.push(P):!b&&L>-1&&(13===p.trigger&&p._executeCurrent(f.CreateNew(v,void 0,P)),v.actionManager.hasSpecificTrigger(13,(a=>{const v=a.mesh?a.mesh:a;return P===v}))&&13!==p.trigger||v._intersectionsInProgress.splice(L,1))}}}}_advancePhysicsEngineStep(a){}_animate(a){}animate(){if(this._engine.isDeterministicLockStep()){let a=Math.max(aa.MinDeltaTime,Math.min(this._engine.getDeltaTime(),aa.MaxDeltaTime))+this._timeAccumulator;const v=this._engine.getTimeStep(),p=1e3/v/1e3;let P=0;const b=this._engine.getLockstepMaxSteps();let L=Math.floor(a/v);for(L=Math.min(L,b);a>0&&P<L;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=v*p,this._animate(v),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(v),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,P++,a-=v;this._timeAccumulator=a<0?0:a}else{const a=this.useConstantAnimationDeltaTime?16:Math.max(aa.MinDeltaTime,Math.min(this._engine.getDeltaTime(),aa.MaxDeltaTime));this._animationRatio=.06*a,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(a)}}_clear(){(this.autoClearDepthAndStencil||this.cj)&&this._engine.clear(this._clearColor,this.cj||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(a){var v;if(null===a||void 0===a||!a.outputRenderTarget||null!==a&&void 0!==a&&a.isRigCamera||(a.outputRenderTarget._cleared=!1),null!==a&&void 0!==a&&null!==(v=a.rigCameras)&&void 0!==v&&v.length)for(let p=0;p<a.rigCameras.length;++p){const v=a.rigCameras[p].outputRenderTarget;v&&(v._cleared=!1)}}resetDrawCache(a){if(this.meshes)for(const v of this.meshes)v.resetDrawCache(a)}_renderWithFrameGraph(){var a;let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),v)for(const b of this.cameras)if(b.update(),0!==b.cameraRigMode)for(let a=0;a<b._rigCameras.length;a++)b._rigCameras[a].update();for(const b of this._beforeClearStage)b.action();const p=this.getActiveMeshCandidates(),P=p.length;for(let b=0;b<P;b++){const a=p.data[b];a.isBlocked||(this._totalVertices.addCount(a.getTotalVertices(),!1),a.isReady()&&a.isEnabled()&&!a.te.hasAZeroComponent&&(a.Zj(),a.actionManager&&a.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(a)))}if(this.particlesEnabled)for(let b=0;b<this.Bj.length;b++){const a=this.Bj[b];if(!a.isStarted()||!a.j)continue;const v=a.j;v.position&&!v.isEnabled()||(this._activeParticleSystems.push(a),a.animate())}null===(a=this.frameGraph)||void 0===a||a.execute()}render(){var a;let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(a=this.activeCameras)&&void 0!==a&&a.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),p||this.animate();for(const a of this._beforeCameraUpdateStage)a.action();if(v)if(this.activeCameras&&this.activeCameras.length>0)for(let a=0;a<this.activeCameras.length;a++){const v=this.activeCameras[a];if(v.update(),0!==v.cameraRigMode)for(let a=0;a<v._rigCameras.length;a++)v._rigCameras[a].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let a=0;a<this.activeCamera._rigCameras.length;a++)this.activeCamera._rigCameras[a].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(v,p);else{var b;const a=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const v=null!==(b=this.activeCameras)&&void 0!==b&&b.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){P.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let p=0;p<this.customRenderTargets.length;p++){const P=this.customRenderTargets[p];if(P._shouldRender()){if(this._renderId++,this.activeCamera=P.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");a.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),P.render(v!==this.activeCamera,this.dumpNextRenderTargets)}}P.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===v||void 0===v?void 0:v.renderPassId)??0,this.activeCamera=v,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const p of this._beforeClearStage)p.action();this._clearFrameBuffer(this.activeCamera);for(const p of this._gatherRenderTargetsStage)p.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let p=0;p<this.activeCameras.length;p++)this._processSubCameras(this.activeCameras[p],p>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const a of this._afterRenderStage)a.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let a=0;a<this._toBeDisposed.length;a++){const v=this._toBeDisposed[a];v&&v.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let a=0;a<this.materials.length;a++)this.materials[a].freeze()}unfreezeMaterials(){for(let a=0;a<this.materials.length;a++)this.materials[a].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((a=>{a.onAnimationEndObservable.clear(),a.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const a=this._activeRequests.slice();for(const b of a)b.abort();this._activeRequests.length=0;try{this.uj.notifyObservers(this)}catch(P){i.d.Error("An error occurred while calling onDisposeObservable!",P)}this.bj();if(this._engine.getInputElement())for(let b=0;b<this.cameras.length;b++)this.cameras[b].bj();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(a=>a.dispose(!0))),this._disposeList(this.transformNodes,(a=>a.dispose(!0)));const v=this.cameras;this._disposeList(v),this.Gi&&this.Gi.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.Bj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let p=this._engine.scenes.indexOf(this);p>-1&&this._engine.scenes.splice(p,1),X.b._LastCreatedScene===this&&(this._engine.scenes.length>0?X.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:X.b._LastCreatedScene=null),p=this._engine._virtualScenes.indexOf(this),p>-1&&this._engine._virtualScenes.splice(p,1),this._engine.wipeCaches(!0),this.uj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(a,v){const p=a.slice(0);v=v??(a=>a.dispose());for(const P of p)v(P);a.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let a=0;a<this.meshes.length;a++){const v=this.meshes[a].Oj;v&&v.clearCachedData()}}cleanCachedTextureBuffer(){for(const a of this.textures){a._buffer&&(a._buffer=null)}}getWorldExtends(a){const v=new C.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new C.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a=a||(()=>!0),this.meshes.filter(a).forEach((a=>{if(a.Zj(!0),!a.rg||0===a.rg.length||a.infiniteDistance)return;const P=a.getBoundingInfo(),b=P.boundingBox.minimumWorld,L=P.boundingBox.maximumWorld;C.s.CheckExtends(b,v,p),C.s.CheckExtends(L,v,p)})),{min:v,max:p}}createPickingRay(a,v,p,P){throw(0,Q.c)("Ray")}createPickingRayToRef(a,v,p,P,b){throw(0,Q.c)("Ray")}createPickingRayInCameraSpace(a,v,p){throw(0,Q.c)("Ray")}createPickingRayInCameraSpaceToRef(a,v,p,P){throw(0,Q.c)("Ray")}md(a,v,p,P,b,L){const t=(0,Q.c)("Ray",!0);return t&&i.d.Warn(t),new c.b}pickWithBoundingInfo(a,v,p,P,b){const L=(0,Q.c)("Ray",!0);return L&&i.d.Warn(L),new c.b}pickWithRay(a,v,p,P){throw(0,Q.c)("Ray")}multiPick(a,v,p,P,b){throw(0,Q.c)("Ray")}multiPickWithRay(a,v,p){throw(0,Q.c)("Ray")}setPointerOverMesh(a,v,p){this._inputManager.setPointerOverMesh(a,v,p)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const a of this.geometries)a._rebuild();for(const a of this.meshes)a._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const a of this._components)a.rebuild();for(const a of this.Bj)a.rebuild();if(this.spriteManagers)for(const a of this.spriteManagers)a.rebuild()}_rebuildTextures(){for(const a of this.textures)a._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(a,v,p){if(void 0===v)return a;const P=[];for(const b in a){const L=a[b];K.c&&K.c.MatchesQuery(L,v)&&(!p||p(L))&&P.push(L)}return P}getMeshesByTags(a,v){return this._getByTags(this.meshes,a,v)}getCamerasByTags(a,v){return this._getByTags(this.cameras,a,v)}getLightsByTags(a,v){return this._getByTags(this.lights,a,v)}getMaterialByTags(a,v){return this._getByTags(this.materials,a,v).concat(this._getByTags(this.multiMaterials,a,v))}getTransformNodesByTags(a,v){return this._getByTags(this.transformNodes,a,v)}setRenderingOrder(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(a,v,p,P)}setRenderingAutoClearDepthStencil(a,v){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(a,v,p,P)}getAutoClearDepthStencilSetup(a){return this._renderingManager.getAutoClearDepthStencilSetup(a)}_forceBlockMaterialDirtyMechanism(a){this._blockMaterialDirtyMechanism=a}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(a){this._blockMaterialDirtyMechanism!==a&&(this._blockMaterialDirtyMechanism=a,a||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(a,v){if(!this._blockMaterialDirtyMechanism)for(const p of this.materials)v&&!v(p)||p.Sg(a)}_loadFile(a,v,p,P,b,L,t){const V=(0,d.p)(a,v,p,P?this.offlineProvider:void 0,b,L,t);return this._activeRequests.push(V),V.onCompleteObservable.add((a=>{this._activeRequests.splice(this._activeRequests.indexOf(a),1)})),V}_loadFileAsync(a,v,p,P,b){return new Promise(((L,t)=>{this._loadFile(a,(a=>{L(a)}),v,p,P,((a,v)=>{t(v)}),b)}))}_requestFile(a,v,p,P,b,L,t){const V=(0,d.u)(a,v,p,P?this.offlineProvider:void 0,b,L,t);return this._activeRequests.push(V),V.onCompleteObservable.add((a=>{this._activeRequests.splice(this._activeRequests.indexOf(a),1)})),V}_requestFileAsync(a,v,p,P,b){return new Promise(((L,t)=>{this._requestFile(a,(a=>{L(a)}),v,p,P,(a=>{t(a)}),b)}))}_readFile(a,v,p,P,b){const L=(0,d.r)(a,v,p,P,b);return this._activeRequests.push(L),L.onCompleteObservable.add((a=>{this._activeRequests.splice(this._activeRequests.indexOf(a),1)})),L}_readFileAsync(a,v,p){return new Promise(((P,b)=>{this._readFile(a,(a=>{P(a)}),v,p,(a=>{b(a)}))}))}getPerfCollector(){throw(0,Q.c)("performanceViewerSceneExtension")}setActiveCameraByID(a){return this.setActiveCameraById(a)}getMaterialByID(a){return this.getMaterialById(a)}getLastMaterialByID(a){return this.getLastMaterialById(a)}getTextureByUniqueID(a){return this.getTextureByUniqueId(a)}getCameraByID(a){return this.getCameraById(a)}getCameraByUniqueID(a){return this.getCameraByUniqueId(a)}getBoneByID(a){return this.getBoneById(a)}getLightByID(a){return this.getLightById(a)}getLightByUniqueID(a){return this.getLightByUniqueId(a)}getParticleSystemByID(a){return this.getParticleSystemById(a)}getGeometryByID(a){return this.getGeometryById(a)}getMeshByID(a){return this.getMeshById(a)}getMeshByUniqueID(a){return this.getMeshByUniqueId(a)}getLastMeshByID(a){return this.getLastMeshById(a)}getMeshesByID(a){return this.getMeshesById(a)}getTransformNodeByID(a){return this.getTransformNodeById(a)}getTransformNodeByUniqueID(a){return this.getTransformNodeByUniqueId(a)}getTransformNodesByID(a){return this.getTransformNodesById(a)}getNodeByID(a){return this.getNodeById(a)}getLastEntryByID(a){return this.getLastEntryById(a)}getLastSkeletonByID(a){return this.getLastSkeletonById(a)}}aa.FOGMODE_NONE=0,aa.FOGMODE_EXP=1,aa.FOGMODE_EXP2=2,aa.FOGMODE_LINEAR=3,aa.MinDeltaTime=1,aa.MaxDeltaTime=1e3,(0,I.f)("BABYLON.Scene",aa)},11332:(a,v,p)=>{"use strict";p.d(v,{c:()=>P,e:()=>b});class P{}P.NAME_EFFECTLAYER="EffectLayer",P.NAME_LAYER="Layer",P.NAME_LENSFLARESYSTEM="LensFlareSystem",P.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",P.NAME_PARTICLESYSTEM="sb",P.NAME_GAMEPAD="Gamepad",P.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",P.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",P.NAME_PREPASSRENDERER="PrePassRenderer",P.NAME_DEPTHRENDERER="DepthRenderer",P.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",P.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",P.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",P.NAME_SPRITE="Sprite",P.NAME_SUBSURFACE="SubSurface",P.NAME_OUTLINERENDERER="Outline",P.NAME_PROCEDURALTEXTURE="ProceduralTexture",P.NAME_SHADOWGENERATOR="ShadowGenerator",P.NAME_OCTREE="tb",P.NAME_PHYSICSENGINE="PhysicsEngine",P.NAME_AUDIO="Audio",P.NAME_FLUIDRENDERER="FluidRenderer",P.STEP_ISREADYFORMESH_EFFECTLAYER=0,P.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,P.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,P.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,P.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,P.STEP_BEFORECAMERADRAW_PREPASS=0,P.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,P.STEP_BEFORECAMERADRAW_LAYER=2,P.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,P.STEP_BEFORERENDERTARGETDRAW_LAYER=1,P.STEP_BEFORERENDERINGMESH_PREPASS=0,P.STEP_BEFORERENDERINGMESH_OUTLINE=1,P.STEP_AFTERRENDERINGMESH_PREPASS=0,P.STEP_AFTERRENDERINGMESH_OUTLINE=1,P.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,P.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,P.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,P.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,P.STEP_BEFORECLEAR_PREPASS=1,P.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,P.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,P.STEP_AFTERRENDERTARGETDRAW_LAYER=1,P.STEP_AFTERCAMERADRAW_PREPASS=0,P.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,P.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,P.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,P.STEP_AFTERCAMERADRAW_LAYER=4,P.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,P.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,P.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,P.STEP_AFTERRENDER_AUDIO=0,P.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,P.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,P.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,P.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,P.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,P.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,P.STEP_POINTERMOVE_SPRITE=0,P.STEP_POINTERDOWN_SPRITE=0,P.STEP_POINTERUP_SPRITE=0;class b extends Array{constructor(a){super(...a)}static Create(){return Object.create(b.prototype)}registerStep(a,v,p){let P=0,b=Number.MAX_VALUE;for(;P<this.length;P++){if(b=this[P].index,a<b)break}this.splice(P,0,{index:a,component:v,action:p.bind(v)})}clear(){this.length=0}}},11207:(a,v,p)=>{"use strict";p.d(v,{e:()=>P});function P(a,v,p,P){var b,L=arguments.length,t=L<3?v:null===P?P=Object.getOwnPropertyDescriptor(v,p):P;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)t=Reflect.decorate(a,v,p,P);else for(var V=a.length-1;V>=0;V--)(b=a[V])&&(t=(L<3?b(t):L>3?b(v,p,t):b(v,p))||t);return L>3&&t&&Object.defineProperty(v,p,t),t}Object.create;Object.create},12382:(a,v,p)=>{"use strict";class P{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((a,v)=>{this._resolve=a,this._reject=v}))}}var b=p(11240),L=p(11279),t=p(10889),V=p(11512),K=p(12388),C=p(12409),F=p(10893),u=p(11676),c=p(12412),f=p(12417),H=p(10939),A=p(10905),h=p(10911);class R{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(a){this._useTextureToStoreBoneMatrices=a,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(a,v,p){this.name=a,this.id=v,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=b.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new F.c,this.bones=[],this._scene=p||H.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const P=this._scene.getEngine().getCaps();this._canUseTextureForBones=P.textureFloat&&P.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((a=>!a.getParent()))}getTransformMatrices(a){if(this.needInitialSkinMatrix){if(!a)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return a._bonesTransformMatrices||this.prepare(!0),a._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(a){return this.needInitialSkinMatrix&&a._transformMatrixTexture?a._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(a){let v=`Name: ${this.name}, nBones: ${this.bones.length}`;if(v+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,a){v+=", Ranges: {";let a=!0;for(const p in this._ranges)a&&(v+=", ",a=!1),v+=p;v+="}"}return v}getBoneIndexByName(a){for(let v=0,p=this.bones.length;v<p;v++)if(this.bones[v].name===a)return v;return-1}createAnimationRange(a,v,p){if(!this._ranges[a]){this._ranges[a]=new f.d(a,v,p);for(let P=0,b=this.bones.length;P<b;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].createRange(a,v,p)}}deleteAnimationRange(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let p=0,P=this.bones.length;p<P;p++)this.bones[p].animations[0]&&this.bones[p].animations[0].deleteRange(a,v);this._ranges[a]=null}getAnimationRange(a){return this._ranges[a]||null}getAnimationRanges(){const a=[];let v;for(v in this._ranges)a.push(this._ranges[v]);return a}copyAnimationRange(a,v){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[v]||!a.getAnimationRange(v))return!1;let P=!0;const b=this._getHighestAnimationFrame()+1,L={},t=a.bones;let V,K;for(K=0,V=t.length;K<V;K++)L[t[K].name]=t[K];this.bones.length!==t.length&&(A.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${t.length}`),P=!1);const C=p&&this.dimensionsAtRest&&a.dimensionsAtRest?this.dimensionsAtRest.divide(a.dimensionsAtRest):null;for(K=0,V=this.bones.length;K<V;K++){const a=this.bones[K].name,t=L[a];t?P=P&&this.bones[K].copyAnimationRange(t,v,b,p,C):(A.d.Warn("copyAnimationRange: not same rig, missing source bone "+a),P=!1)}const F=a.getAnimationRange(v);return F&&(this._ranges[v]=new f.d(v,F.from+b,F.to+b)),P}returnToRest(){for(const a of this.bones)-1!==a._index&&a.returnToRest()}_getHighestAnimationFrame(){let a=0;for(let v=0,p=this.bones.length;v<p;v++)if(this.bones[v].animations[0]){const p=this.bones[v].animations[0].getHighestFrame();a<p&&(a=p)}return a}beginAnimation(a,v,p,P){const b=this.getAnimationRange(a);return b?this._scene.beginAnimation(this,b.from,b.to,v,p,P):null}static MakeAnimationAdditive(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2?arguments[2]:void 0;const P=a.getAnimationRange(p);if(!P)return null;const b=a._scene.getAllAnimatablesByTarget(a);let L=null;for(let V=0;V<b.length;V++){const a=b[V];if(a.fromFrame===(null===P||void 0===P?void 0:P.from)&&a.toFrame===(null===P||void 0===P?void 0:P.to)){L=a;break}}const t=a.getAnimatables();for(let V=0;V<t.length;V++){const a=t[V].animations;if(a)for(let P=0;P<a.length;P++)c.d.MakeAnimationAdditive(a[P],v,p)}return L&&(L.isAdditive=!0),a}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(a){this._meshesWithPoseMatrix.push(a)}_unregisterMeshWithPoseMatrix(a){const v=this._meshesWithPoseMatrix.indexOf(a);v>-1&&this._meshesWithPoseMatrix.splice(v,1)}_computeTransformMatrices(a,v){this.onBeforeComputeObservable.notifyObservers(this);for(let p=0;p<this.bones.length;p++){const P=this.bones[p];P._childUpdateId++;const b=P.getParent();if(b?P.getLocalMatrix().multiplyToRef(b.getFinalMatrix(),P.getFinalMatrix()):v?P.getLocalMatrix().multiplyToRef(v,P.getFinalMatrix()):P.getFinalMatrix().p(P.getLocalMatrix()),-1!==P._index){const v=null===P._index?p:P._index;P.getAbsoluteInverseBindMatrix().multiplyToArray(P.getFinalMatrix(),a,16*v)}}this._identity.copyToArray(a,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const a=this.va().getRenderId();if(this._currentRenderId===a)return;this._currentRenderId=a}if(this._numBonesWithLinkedTransformNode>0)for(const a of this.bones)if(a._linkedTransformNode){const v=a._linkedTransformNode;a.position=v.position,v.rotationQuaternion?a.rotationQuaternion=v.rotationQuaternion:a.rotation=v.rotation,a.te=v.te}if(this.needInitialSkinMatrix)for(const a of this._meshesWithPoseMatrix){const v=a.getPoseMatrix();let p=this._isDirty;if(a._bonesTransformMatrices&&a._bonesTransformMatrices.length===16*(this.bones.length+1)||(a._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),p=!0),p){if(this._synchronizedWithMesh!==a){this._synchronizedWithMesh=a;for(const a of this.bones)if(!a.getParent()){a.getBindMatrix().multiplyToRef(v,b.k.Matrix[1]),a._updateAbsoluteBindMatrices(b.k.Matrix[1])}if(this.isUsingTextureForMatrices){const v=4*(this.bones.length+1);a._transformMatrixTexture&&a._transformMatrixTexture.getSize().width===v||(a._transformMatrixTexture&&a._transformMatrixTexture.dispose(),a._transformMatrixTexture=u.d.CreateRGBATexture(a._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(a._bonesTransformMatrices,v),this.isUsingTextureForMatrices&&a._transformMatrixTexture&&a._transformMatrixTexture.update(a._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=u.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables}clone(a,v){const p=new R(a,v||a,this._scene);p.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){const a=this.bones[P];let v=null;const b=a.getParent();if(b){const a=this.bones.indexOf(b);v=p.bones[a]}const L=new C.e(a.name,p,v,a.getBindMatrix().clone(),a.getRestMatrix().clone());L._index=a._index,a._linkedTransformNode&&L.linkTransformNode(a._linkedTransformNode),h.b.DeepCopy(a.animations,L.animations)}if(this._ranges){p._ranges={};for(const a in this._ranges){const v=this._ranges[a];v&&(p._ranges[a]=v.clone())}}return this._isDirty=!0,p.prepare(!0),p}enableBlending(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((v=>{v.animations.forEach((v=>{v.enableBlending=!0,v.blendingSpeed=a}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const a=this._parentContainer.skeletons.indexOf(this);a>-1&&this._parentContainer.skeletons.splice(a,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const a={};a.name=this.name,a.id=this.id,this.dimensionsAtRest&&(a.dimensionsAtRest=this.dimensionsAtRest.tj()),a.bones=[],a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let p=0;p<this.bones.length;p++){var v;const P=this.bones[p],b=P.getParent(),L={parentBoneIndex:b?this.bones.indexOf(b):-1,index:P.getIndex(),name:P.name,id:P.id,matrix:P.getBindMatrix().tj(),rest:P.getRestMatrix().tj(),linkedTransformNodeId:null===(v=P.getTransformNode())||void 0===v?void 0:v.id};a.bones.push(L),P.length&&(L.length=P.length),P.metadata&&(L.metadata=P.metadata),P.animations&&P.animations.length>0&&(L.animation=P.animations[0].serialize()),a.ranges=[];for(const v in this._ranges){const p=this._ranges[v];if(!p)continue;const P={};P.name=v,P.from=p.from,P.to=p.to,a.ranges.push(P)}}return a}static Parse(a,v){const p=new R(a.name,a.id,v);let P;for(a.dimensionsAtRest&&(p.dimensionsAtRest=b.s.bh(a.dimensionsAtRest)),p.needInitialSkinMatrix=a.needInitialSkinMatrix,P=0;P<a.bones.length;P++){const v=a.bones[P],L=a.bones[P].index;let t=null;v.parentBoneIndex>-1&&(t=p.bones[v.parentBoneIndex]);const V=v.rest?b.e.bh(v.rest):null,K=new C.e(v.name,p,t,b.e.bh(v.matrix),V,null,L);void 0!==v.id&&null!==v.id&&(K.id=v.id),v.length&&(K.length=v.length),v.metadata&&(K.metadata=v.metadata),v.animation&&K.animations.push(c.d.Parse(v.animation)),void 0!==v.linkedTransformNodeId&&null!==v.linkedTransformNodeId&&(p._hasWaitingData=!0,K._waitingTransformNodeId=v.linkedTransformNodeId)}if(a.ranges)for(P=0;P<a.ranges.length;P++){const v=a.ranges[P];p.createAnimationRange(v.name,v.from,v.to)}return p}computeAbsoluteMatrices(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||a)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(a)}getPoseMatrix(){let a=null;return this._meshesWithPoseMatrix.length>0&&(a=this._meshesWithPoseMatrix[0].getPoseMatrix()),a}sortBones(){const a=[],v=new Array(this.bones.length);for(let p=0;p<this.bones.length;p++)this._sortBones(p,a,v);this.bones=a}_sortBones(a,v,p){if(p[a])return;p[a]=!0;const P=this.bones[a];if(!P)return;void 0===P._index&&(P._index=a);const b=P.getParent();b&&this._sortBones(this.bones.indexOf(b),v,p),v.push(P)}setCurrentPoseAsRest(){this.bones.forEach((a=>{a.setCurrentPoseAsRest()}))}}var X=p(11390),Q=p(11207),s=p(11210),D=p(12421),y=p(12434),Z=p(11027),M=p(11287);class S extends y.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(a){this.subSurface.refractionTexture=a,a?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(a){this.subSurface.indexOfRefraction=a}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(a){this.subSurface.invertRefractionY=a}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(a){this.subSurface.linkRefractionWithTransparency=a,a&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===y.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(a){a!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=a?y.c.LIGHTFALLOFF_PHYSICAL:y.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===y.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(a){a!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=a?y.c.LIGHTFALLOFF_GLTF:y.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(a){this.imageProcessingConfiguration.colorCurvesEnabled=a}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(a){this.imageProcessingConfiguration.colorGradingEnabled=a}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(a){this._imageProcessingConfiguration.toneMappingEnabled=a}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(a){this._imageProcessingConfiguration.exposure=a}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(a){this._imageProcessingConfiguration.contrast=a}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(a){this._imageProcessingConfiguration.colorGradingTexture=a}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(a){this._imageProcessingConfiguration.colorCurves=a}constructor(a,v){super(a,v,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=L.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new L.d(0,0,0),this.albedoColor=new L.d(1,1,1),this.reflectivityColor=new L.d(1,1,1),this.reflectionColor=new L.d(1,1,1),this.emissiveColor=new L.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,D.e)(this.va())}getClassName(){return"PBRMaterial"}clone(a){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const P=M.b.Clone((()=>new S(a,this.va())),this,{cloneTexturesOnlyOnce:v});return P.id=a,P.name=a,this.stencil.copyTo(P.stencil),this._clonePlugins(P,p),P}serialize(){const a=super.serialize();return a.customType="BABYLON.PBRMaterial",a}static Parse(a,v,p){const P=M.b.Parse((()=>new S(a.name,v)),a,v,p);return a.stencil&&P.stencil.parse(a.stencil,v,p),X.c._ParsePlugins(a,P,v,p),a.clearCoat&&P.clearCoat.parse(a.clearCoat,v,p),a.anisotropy&&P.anisotropy.parse(a.anisotropy,v,p),a.brdf&&P.brdf.parse(a.brdf,v,p),a.sheen&&P.sheen.parse(a.sheen,v,p),a.subSurface&&P.subSurface.parse(a.subSurface,v,p),a.iridescence&&P.iridescence.parse(a.iridescence,v,p),P}}S.PBRMATERIAL_OPAQUE=y.c.PBRMATERIAL_OPAQUE,S.PBRMATERIAL_ALPHATEST=y.c.PBRMATERIAL_ALPHATEST,S.PBRMATERIAL_ALPHABLEND=y.c.PBRMATERIAL_ALPHABLEND,S.PBRMATERIAL_ALPHATESTANDBLEND=y.c.PBRMATERIAL_ALPHATESTANDBLEND,S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=y.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"directIntensity",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveIntensity",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentIntensity",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularIntensity",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"disableBumpMap",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureStrength",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicTexture",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallic",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicF0Factor",void 0),(0,Q.e)([(0,s.l)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceColor",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectanceTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurfaceTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,Q.e)([(0,s.H)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty",null)],S.prototype,"lightmapTexture",void 0),(0,Q.e)([(0,s.l)("ambient"),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientColor",void 0),(0,Q.e)([(0,s.l)("albedo"),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoColor",void 0),(0,Q.e)([(0,s.l)("reflectivity"),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityColor",void 0),(0,Q.e)([(0,s.l)("reflection"),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionColor",void 0),(0,Q.e)([(0,s.l)("emissive"),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveColor",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurface",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromAlbedoTexture",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"forceAlphaTest",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"alphaCutOff",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientInGrayScale",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,Q.e)([(0,s.O)()],S.prototype,"usePhysicalLightFalloff",null),(0,Q.e)([(0,s.O)()],S.prototype,"useGLTFLightFalloff",null),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOverAlpha",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"parallaxScaleBias",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceIrradianceInFragment",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAlphaFresnel",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLinearAlphaFresnel",void 0),(0,Q.e)([(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentBRDFTexture",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceNormalForward",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"enableSpecularAntiAliasing",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useHorizonOcclusion",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOcclusion",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"unlit",void 0),(0,Q.e)([(0,s.O)(),(0,s.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,Z.f)("BABYLON.PBRMaterial",S);var n=p(11460),q=p(11544),T=p(11306),j=p(11532),w=p(11539),J=p(11504);class B{get influence(){return this._influence}set influence(a){if(this._influence===a)return;const v=this._influence;this._influence=a,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===v||0===a)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=a,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new F.c,this._onDataLayoutChanged=new F.c,this._animationPropertiesOverride=null,this.id=a,this._scene=p||H.b.LastCreatedScene,this.influence=v,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(a){const v=this.hasPositions;this._positions=a,v!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(a){const v=this.hasNormals;this._normals=a,v!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(a){const v=this.hasTangents;this._tangents=a,v!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(a){const v=this.hasUVs;this._uvs=a,v!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const a=M.b.Clone((()=>new B(this.name,this.influence,this._scene)),this);return a._positions=this._positions,a._normals=this._normals,a._tangents=this._tangents,a._uvs=this._uvs,a}serialize(){const a={};return a.name=this.name,a.influence=this.influence,a.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(a.id=this.id),this.hasNormals&&(a.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(a.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(a.Aa=Array.prototype.slice.call(this.getUVs())),M.b.AppendSerializedAnimations(this,a),a}getClassName(){return"MorphTarget"}static Parse(a,v){const p=new B(a.name,a.influence);if(p.setPositions(a.xa),null!=a.id&&(p.id=a.id),a.ya&&p.setNormals(a.ya),a.tangents&&p.setTangents(a.tangents),a.Aa&&p.setUVs(a.Aa),a.animations){for(let v=0;v<a.animations.length;v++){const P=a.animations[v],b=(0,Z.c)("BABYLON.Animation");b&&p.animations.push(b.Parse(P))}a.autoAnimate&&v&&v.beginAnimation(p,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1)}return p}static FromMesh(a,v,p){v||(v=a.name);const P=new B(v,p,a.va());return P.setPositions(a.getVerticesData(T.f.PositionKind)),a.isVerticesDataPresent(T.f.NormalKind)&&P.setNormals(a.getVerticesData(T.f.NormalKind)),a.isVerticesDataPresent(T.f.TangentKind)&&P.setTangents(a.getVerticesData(T.f.TangentKind)),a.isVerticesDataPresent(T.f.UVKind)&&P.setUVs(a.getVerticesData(T.f.UVKind)),P}}(0,Q.e)([(0,s.O)()],B.prototype,"id",void 0);var x=p(11223),r=p(12043);class o{set areUpdatesFrozen(a){a?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new x.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,a||(a=H.b.LastCreatedScene),this._scene=a,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const a=this._scene.getEngine().getCaps();this._canUseTextureForTargets=a.canUseGLVertexID&&a.textureFloat&&a.maxVertexTextureImageUnits>0&&a.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(a){this._numMaxInfluencers!==a&&(this._numMaxInfluencers=a,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(a){this._useTextureToStoreTargets=a}get isUsingTextureForTargets(){var a;return o.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(a=this._scene)&&void 0!==a&&a.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(a){return this._activeTargets.data[a]}getTarget(a){return this._targets[a]}getTargetByName(a){for(const v of this._targets)if(v.name===a)return v;return null}addTarget(a){this._targets.push(a),this._targetInfluenceChangedObservers.push(a.onInfluenceChanged.add((a=>{this._syncActiveTargets(a)}))),this._targetDataLayoutChangedObservers.push(a._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(a){const v=this._targets.indexOf(a);v>=0&&(this._targets.splice(v,1),a.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(v,1)[0]),a._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(v,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(a)}_bind(a){a.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),a.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),a.setTexture("morphTargets",this._targetStoreTexture),a.setInt("morphTargetCount",this.numInfluencers)}clone(){const a=new o(this._scene);for(const v of this._targets)a.addTarget(v.clone());return a.enableNormalMorphing=this.enableNormalMorphing,a.enableTangentMorphing=this.enableTangentMorphing,a.enableUVMorphing=this.enableUVMorphing,a}serialize(){const a={};a.id=this.uniqueId,a.targets=[];for(const v of this._targets)a.targets.push(v.serialize());return a}_syncActiveTargets(a){if(this.areUpdatesFrozen)return;let v=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let p=-1;for(const P of this._targets){if(p++,0===P.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=o.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(P),this._morphTargetTextureIndices[v]=p,this._tempInfluences[v++]=P.influence,this._supportsNormals=this._supportsNormals&&P.hasNormals,this._supportsTangents=this._supportsTangents&&P.hasTangents,this._supportsUVs=this._supportsUVs&&P.hasUVs;const a=P.getPositions();if(a){const v=a.length/3;if(0===this._vertexCount)this._vertexCount=v;else if(this._vertexCount!==v)return void A.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==v&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,v)),this._influences&&this._influences.length===v||(this._influences=new Float32Array(v));for(let P=0;P<v;P++)this._influences[P]=this._tempInfluences[P];a&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const a=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>a&&(this._textureHeight=Math.ceil(this._textureWidth/a),this._textureWidth=a);let v=!0;if(this._targetStoreTexture){const a=this._targetStoreTexture.getSize();a.width===this._textureWidth&&a.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(v=!1)}if(v){this._targetStoreTexture&&this._targetStoreTexture.dispose();const a=this._targets.length,v=new Float32Array(a*this._textureWidth*this._textureHeight*4);let p=0;for(let P=0;P<a;P++){const a=this._targets[P],b=a.getPositions(),L=a.getNormals(),t=a.getUVs(),V=a.getTangents();if(!b)return void(0===P&&A.d.Error("Invalid morph target. Target must have positions."));p=P*this._textureWidth*this._textureHeight*4;for(let P=0;P<this._vertexCount;P++)v[p]=b[3*P],v[p+1]=b[3*P+1],v[p+2]=b[3*P+2],p+=4,this._supportsNormals&&L&&(v[p]=L[3*P],v[p+1]=L[3*P+1],v[p+2]=L[3*P+2],p+=4),this._supportsUVs&&t&&(v[p]=t[2*P],v[p+1]=t[2*P+1],p+=4),this._supportsTangents&&V&&(v[p]=V[3*P],v[p+1]=V[3*P+1],v[p+2]=V[3*P+2],p+=4)}this._targetStoreTexture=r.b.CreateRGBATexture(v,this._textureWidth,this._textureHeight,a,this._scene,!1,!1,1,1)}}for(const a of this._scene.meshes)a.morphTargetManager===this&&a._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const a=this._parentContainer.morphTargetManagers.indexOf(this);a>-1&&this._parentContainer.morphTargetManagers.splice(a,1),this._parentContainer=null}for(const a of this._targets)this._scene.stopAnimation(a)}}static Parse(a,v){const p=new o(v);for(const P of a.targets)p.addTarget(B.Parse(P,v));return p}}o.EnableTextureStorage=!0,o.MaxActiveMorphTargetsInVertexAttributeMode=8;var m=p(12445),O=p(10947),Y=p(11413);function l(a,v,p,P){return b.s.bh(v,p).scaleInPlace(P)}class z{constructor(a,v,p,P){this.type=a,this.name=v,this.getValue=p,this.getStride=P}_buildAnimation(a,v,p){const P=new c.d(a,this.name,v,this.type);return P.setKeys(p),P}}class g extends z{buildAnimations(a,v,p,P,b){b(a._babylonTransformNode,this._buildAnimation(v,p,P))}}const G={translation:[new g(c.d.ANIMATIONTYPE_VECTOR3,"position",l,(()=>3))],rotation:[new g(c.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(a,v,p,P){return b.i.bh(v,p).scaleInPlace(P)}),(()=>4))],scale:[new g(c.d.ANIMATIONTYPE_VECTOR3,"te",l,(()=>3))],weights:[new class extends z{buildAnimations(a,v,p,P,b){if(a._numMorphTargets)for(let L=0;L<a._numMorphTargets;L++){const t=new c.d(`${v}_${L}`,this.name,p,this.type);if(t.setKeys(P.map((a=>({frame:a.frame,inTangent:a.inTangent?a.inTangent[L]:void 0,value:a.value[L],outTangent:a.outTangent?a.outTangent[L]:void 0,interpolation:a.interpolation})))),a._primitiveBabylonMeshes)for(const v of a._primitiveBabylonMeshes)if(v.morphTargetManager){const a=v.morphTargetManager.getTarget(L),p=t.clone();a.animations.push(p),b(a,p)}}}}(c.d.ANIMATIONTYPE_FLOAT,"influence",(function(a,v,p,P){const b=new Array(a._numMorphTargets);for(let L=0;L<b.length;L++)b[L]=v[p++]*P;return b}),(a=>a._numMorphTargets))]},e=new Map,k=e;function d(a,v,p){E(a)&&A.d.Warn(`Extension with the name '${a}' already exists`),e.set(a,{isGLTFExtension:v,factory:p})}function E(a){return e.delete(a)}function W(){const a=a=>a&&"object"===typeof a;for(var v=arguments.length,p=new Array(v),P=0;P<v;P++)p[P]=arguments[P];return p.reduce(((v,p)=>(Object.keys(p).forEach((P=>{const b=v[P],L=p[P];Array.isArray(b)&&Array.isArray(L)?v[P]=b.concat(...L):a(b)&&a(L)?v[P]=W(b,L):v[P]=L})),v)),{})}class U{static Get(a,v,p){if(!v||void 0==p||!v[p])throw new Error(`${a}: Failed to find index (${p})`);return v[p]}static TryGet(a,v){return a&&void 0!=v&&a[v]?a[v]:null}static Assign(a){if(a)for(let v=0;v<a.length;v++)a[v].index=v}}class N{static RegisterExtension(a,v){d(a,!1,v)}static UnregisterExtension(a){return E(a)}get Zi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(a){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=a}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((a=>a.dispose&&a.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(a,v,p,P,b,L){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=v,this._assetContainer=p,this._loadData(P);let L=null;if(a){const v={};if(this._gltf.nodes)for(const a of this._gltf.nodes)a.name&&(v[a.name]=a.index);L=(a instanceof Array?a:[a]).map((a=>{const p=v[a];if(void 0===p)throw new Error(`Failed to find node '${a}'`);return p}))}return this._loadAsync(b,t,L,(()=>({meshes:this._getMeshes(),Bj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=a,this._loadData(v),this._loadAsync(p,b,null,(()=>{})))))}_loadAsync(a,v,p,P){return Promise.resolve().then((async()=>{this._rootUrl=a,this._uniqueRootUrl=!a.startsWith("file:")&&v?a:`${a}${Date.now()}/`,this._fileName=v,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const b=`${m.i[m.i.LOADING]} => ${m.i[m.i.READY]}`,L=`${m.i[m.i.LOADING]} => ${m.i[m.i.COMPLETE]}`;this._parent._startPerformanceCounter(b),this._parent._startPerformanceCounter(L),this._parent._setState(m.i.LOADING),this._extensionsOnLoading();const V=new Array;if(!this.parent.loadOnlyMaterials)if(p)V.push(this.loadSceneAsync("/nodes",{nodes:p,index:-1}));else if(void 0!=this._gltf.sd||this._gltf.scenes&&this._gltf.scenes[0]){const a=U.Get("/scene",this._gltf.scenes,this._gltf.sd||0);V.push(this.loadSceneAsync(`/scenes/${a.index}`,a))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let a=0;a<this._gltf.materials.length;++a){const v=this._gltf.materials[a],p="/materials/"+a,P=X.c.TriangleFillMode;V.push(this._loadMaterialAsync(p,v,null,P,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&V.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&V.push(this._compileShadowGeneratorsAsync());return Promise.all(V).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Mb(!0),this._extensionsOnReady(),this._parent._setState(m.i.READY),this._startAnimations(),P()))).then((a=>(this._parent._endPerformanceCounter(b),t.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(L),this._parent._setState(m.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(a=>{this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()}))})),a)))})).catch((a=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()),a}))}_loadData(a){if(this._gltf=a.json,this._setupData(),a.bin){const v=this._gltf.buffers;if(v&&v[0]&&!v[0].uri){const p=v[0];(p.byteLength<a.bin.byteLength-3||p.byteLength>a.bin.byteLength)&&A.d.Warn(`Binary buffer length (${p.byteLength}) from JSON does not match chunk length (${a.bin.byteLength})`),this._bin=a.bin}else A.d.Warn("Unexpected BIN chunk")}}_setupData(){if(U.Assign(this._gltf.accessors),U.Assign(this._gltf.animations),U.Assign(this._gltf.buffers),U.Assign(this._gltf.bufferViews),U.Assign(this._gltf.cameras),U.Assign(this._gltf.images),U.Assign(this._gltf.materials),U.Assign(this._gltf.meshes),U.Assign(this._gltf.nodes),U.Assign(this._gltf.samplers),U.Assign(this._gltf.scenes),U.Assign(this._gltf.skins),U.Assign(this._gltf.textures),this._gltf.nodes){const a={};for(const p of this._gltf.nodes)if(p.children)for(const v of p.children)a[v]=p.index;const v=this._createRootNode();for(const p of this._gltf.nodes){const P=a[p.index];p.parent=void 0===P?v:this._gltf.nodes[P]}}}async _loadExtensionsAsync(){const a=[];if(k.forEach(((v,p)=>{var P;!1===(null===(P=this.parent.extensionOptions[p])||void 0===P?void 0:P.enabled)?v.isGLTFExtension&&this.isExtensionUsed(p)&&A.d.Warn(`Extension ${p} is used but has been explicitly disabled.`):v.isGLTFExtension&&!this.isExtensionUsed(p)||a.push((async()=>{const a=await v.factory(this);return a.name!==p&&A.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${a.name} !== ${p}`),this._parent.onExtensionLoadedObservable.notifyObservers(a),a})())})),this._extensions.push(...await Promise.all(a)),this._extensions.sort(((a,v)=>(a.order||Number.MAX_VALUE)-(v.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const p of this._gltf.extensionsRequired){if(!this._extensions.some((a=>a.name===p&&a.enabled))){var v;if(!1===(null===(v=this.parent.extensionOptions[p])||void 0===v?void 0:v.enabled))throw new Error(`Required extension ${p} is disabled`);throw new Error(`Required extension ${p} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new J.b("__root__",this._babylonScene);this._rootBabylonMesh=a,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Mb(!1);const v={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case m.h.AUTO:this._babylonScene.useRightHandedSystem||(v.rotation=[0,1,0,0],v.scale=[1,1,-1],N._LoadTransform(v,this._rootBabylonMesh));break;case m.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(a),v}loadSceneAsync(a,v){const p=this._extensionsLoadSceneAsync(a,v);if(p)return p;const P=new Array;if(this.logOpen(`${a} ${v.name||""}`),v.nodes)for(const b of v.nodes){const v=U.Get(`${a}/nodes/${b}`,this._gltf.nodes,b);P.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(a=>{a.parent=this._rootBabylonMesh})))}for(const b of this._postSceneLoadActions)b();return P.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(P).then((()=>{}))}_forEachPrimitive(a,v){if(a._primitiveBabylonMeshes)for(const p of a._primitiveBabylonMeshes)v(p)}_getGeometries(){const a=[],v=this._gltf.nodes;if(v)for(const p of v)this._forEachPrimitive(p,(v=>{const p=v.Oj;p&&-1===a.indexOf(p)&&a.push(p)}));return a}_getMeshes(){const a=[];this._rootBabylonMesh instanceof w.e&&a.push(this._rootBabylonMesh);const v=this._gltf.nodes;if(v)for(const p of v)this._forEachPrimitive(p,(v=>{a.push(v)}));return a}_getTransformNodes(){const a=[],v=this._gltf.nodes;if(v)for(const p of v)p._babylonTransformNode&&"rb"===p._babylonTransformNode.getClassName()&&a.push(p._babylonTransformNode),p._babylonTransformNodeForSkin&&a.push(p._babylonTransformNodeForSkin);return a}_getSkeletons(){const a=[],v=this._gltf.skins;if(v)for(const p of v)p._data&&a.push(p._data.babylonSkeleton);return a}_getAnimationGroups(){const a=[],v=this._gltf.animations;if(v)for(const p of v)p._babylonAnimationGroup&&a.push(p._babylonAnimationGroup);return a}_startAnimations(){switch(this._parent.animationStartMode){case m.f.NONE:break;case m.f.FIRST:{const a=this._getAnimationGroups();0!==a.length&&a[0].start(!0);break}case m.f.ALL:{const a=this._getAnimationGroups();for(const v of a)v.start(!0);break}default:return void A.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadNodeAsync(a,v,p);if(P)return P;if(v._babylonTransformNode)throw new Error(`${a}: Invalid recursive node hierarchy`);const b=new Array;this.logOpen(`${a} ${v.name||""}`);const L=P=>{if(N.AddPointerMetadata(P,a),N._LoadTransform(v,P),void 0!=v.camera){const p=U.Get(`${a}/camera`,this._gltf.cameras,v.camera);b.push(this.loadCameraAsync(`/cameras/${p.index}`,p,(a=>{a.parent=P})))}if(v.children)for(const p of v.children){const v=U.Get(`${a}/children/${p}`,this._gltf.nodes,p);b.push(this.loadNodeAsync(`/nodes/${v.index}`,v,(a=>{a.parent=P})))}p(P)},t=void 0!=v.mesh,V=this._parent.loadSkins&&void 0!=v.skin;if(!t||V){const a=v.name||`node${v.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new q.c(a,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==v.mesh?v._babylonTransformNode=p:v._babylonTransformNodeForSkin=p,L(p)}if(t)if(V){const p=U.Get(`${a}/mesh`,this._gltf.meshes,v.mesh);b.push(this._loadMeshAsync(`/meshes/${p.index}`,v,p,(p=>{const P=v._babylonTransformNodeForSkin;p.metadata=W(P.metadata,p.metadata||{});const L=U.Get(`${a}/skin`,this._gltf.skins,v.skin);b.push(this._loadSkinAsync(`/skins/${L.index}`,v,L,(a=>{this._forEachPrimitive(v,(v=>{v.skeleton=a})),this._postSceneLoadActions.push((()=>{if(void 0!=L.skeleton){const a=U.Get(`/skins/${L.index}/skeleton`,this._gltf.nodes,L.skeleton).parent;v.index===a.index?p.parent=P.parent:p.parent=a._babylonTransformNode}else p.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:P,skinnedNode:p})}))})))})))}else{const p=U.Get(`${a}/mesh`,this._gltf.meshes,v.mesh);b.push(this._loadMeshAsync(`/meshes/${p.index}`,v,p,L))}return this.logClose(),Promise.all(b).then((()=>(this._forEachPrimitive(v,(a=>{a.Oj&&a.Oj.useBoundingInfoFromGeometry?a.Ea():a.refreshBoundingInfo(!0,!0)})),v._babylonTransformNode)))}_loadMeshAsync(a,v,p,P){const b=p.primitives;if(!b||!b.length)throw new Error(`${a}: Primitives are missing`);void 0==b[0].index&&U.Assign(b);const L=new Array;this.logOpen(`${a} ${p.name||""}`);const t=v.name||`node${v.index}`;if(1===b.length){const P=p.primitives[0];L.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${P.index}`,t,v,p,P,(a=>{v._babylonTransformNode=a,v._primitiveBabylonMeshes=[a]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,v._babylonTransformNode=new q.c(t,this._babylonScene),v._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._primitiveBabylonMeshes=[];for(const P of b)L.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${P.index}`,`${t}_primitive${P.index}`,v,p,P,(a=>{a.parent=v._babylonTransformNode,v._primitiveBabylonMeshes.push(a)})))}return P(v._babylonTransformNode),this.logClose(),Promise.all(L).then((()=>v._babylonTransformNode))}_loadMeshPrimitiveAsync(a,v,p,P,b,L){const t=this._extensionsLoadMeshPrimitiveAsync(a,v,p,P,b,L);if(t)return t;this.logOpen(`${a}`);const V=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==p.skin&&!P.primitives[0].targets;let K,C;if(V&&b._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,K=b._instanceData.babylonSourceMesh.createInstance(v),K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C=b._instanceData.promise;else{const L=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new J.b(v,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.sideOrientation=this._babylonScene.useRightHandedSystem?X.c.CounterClockWiseSideOrientation:X.c.ClockWiseSideOrientation,this._createMorphTargets(a,p,P,b,t),L.push(this._loadVertexDataAsync(a,b,t).then((v=>this._loadMorphTargetsAsync(a,b,t,v).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,v.Ca(t),v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const F=N._GetDrawMode(a,b.mode);if(void 0==b.material){let a=this._defaultBabylonMaterialData[F];a||(a=this._createDefaultMaterial("__GLTFLoader._default",F),this._parent.onMaterialLoadedObservable.notifyObservers(a),this._defaultBabylonMaterialData[F]=a),t.material=a}else if(!this.parent.skipMaterials){const v=U.Get(`${a}/material`,this._gltf.materials,b.material);L.push(this._loadMaterialAsync(`/materials/${v.index}`,v,t,F,(a=>{t.material=a})))}C=Promise.all(L),V&&(b._instanceData={babylonSourceMesh:t,promise:C}),K=t}return N.AddPointerMetadata(K,a),this._parent.onMeshLoadedObservable.notifyObservers(K),L(K),this.logClose(),C.then((()=>K))}_loadVertexDataAsync(a,v,p){const P=this._extensionsLoadVertexDataAsync(a,v,p);if(P)return P;const L=v.attributes;if(!L)throw new Error(`${a}: Attributes are missing`);const t=new Array,V=new j.c(p.name,this._babylonScene);if(void 0==v.indices)p.isUnIndexed=!0;else{const p=U.Get(`${a}/indices`,this._gltf.accessors,v.indices);t.push(this._loadIndicesAccessorAsync(`/accessors/${p.index}`,p).then((a=>{V.setIndices(a)})))}const K=(v,P,K)=>{if(void 0==L[v])return;p._delayInfo=p._delayInfo||[],-1===p._delayInfo.indexOf(P)&&p._delayInfo.push(P);const C=U.Get(`${a}/attributes/${v}`,this._gltf.accessors,L[v]);t.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,P).then((a=>{if(a.getKind()===T.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!p.skeleton&&C.min&&C.max){const a=b.k.fb[0].qe(...C.min),v=b.k.fb[1].qe(...C.max);if(C.normalized&&5126!==C.componentType){let p=1;switch(C.componentType){case 5120:p=127;break;case 5121:p=255;break;case 5122:p=32767;break;case 5123:p=65535}const P=1/p;a.scaleInPlace(P),v.scaleInPlace(P)}V._boundingInfo=new Y.d(a,v),V.useBoundingInfoFromGeometry=!0}V.setVerticesBuffer(a,C.count)}))),P==T.f.MatricesIndicesExtraKind&&(p.numBoneInfluencers=8),K&&K(C)};return K("POSITION",T.f.PositionKind),K("NORMAL",T.f.NormalKind),K("TANGENT",T.f.TangentKind),K("TEXCOORD_0",T.f.UVKind),K("TEXCOORD_1",T.f.UV2Kind),K("TEXCOORD_2",T.f.UV3Kind),K("TEXCOORD_3",T.f.UV4Kind),K("TEXCOORD_4",T.f.UV5Kind),K("TEXCOORD_5",T.f.UV6Kind),K("JOINTS_0",T.f.MatricesIndicesKind),K("WEIGHTS_0",T.f.MatricesWeightsKind),K("JOINTS_1",T.f.MatricesIndicesExtraKind),K("WEIGHTS_1",T.f.MatricesWeightsExtraKind),K("COLOR_0",T.f.ColorKind,(a=>{"VEC4"===a.type&&(p.hasVertexAlpha=!0)})),Promise.all(t).then((()=>V))}_createMorphTargets(a,v,p,P,b){if(!P.targets||!this._parent.loadMorphTargets)return;if(void 0==v._numMorphTargets)v._numMorphTargets=P.targets.length;else if(P.targets.length!==v._numMorphTargets)throw new Error(`${a}: Primitives do not have the same number of targets`);const L=p.extras?p.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,b.morphTargetManager=new o(this._babylonScene),b.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.morphTargetManager.areUpdatesFrozen=!0;for(let t=0;t<P.targets.length;t++){const a=v.weights?v.weights[t]:p.weights?p.weights[t]:0,P=L?L[t]:`morphTarget${t}`;b.morphTargetManager.addTarget(new B(P,a,b.va()))}}_loadMorphTargetsAsync(a,v,p,P){if(!v.targets||!this._parent.loadMorphTargets)return Promise.resolve();const b=new Array,L=p.morphTargetManager;for(let t=0;t<L.numTargets;t++){const p=L.getTarget(t);b.push(this._loadMorphTargetVertexDataAsync(`${a}/targets/${t}`,P,v.targets[t],p))}return Promise.all(b).then((()=>{L.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(a,v,p,P){const b=new Array,L=(P,L,t)=>{if(void 0==p[P])return;const V=v.getVertexBuffer(L);if(!V)return;const K=U.Get(`${a}/${P}`,this._gltf.accessors,p[P]);b.push(this._loadFloatAccessorAsync(`/accessors/${K.index}`,K).then((a=>{t(V,a)})))};return L("POSITION",T.f.PositionKind,((a,v)=>{const p=new Float32Array(v.length);a.forEach(v.length,((a,P)=>{p[P]=v[P]+a})),P.setPositions(p)})),L("NORMAL",T.f.NormalKind,((a,v)=>{const p=new Float32Array(v.length);a.forEach(p.length,((a,P)=>{p[P]=v[P]+a})),P.setNormals(p)})),L("TANGENT",T.f.TangentKind,((a,v)=>{const p=new Float32Array(v.length/3*4);let b=0;a.forEach(v.length/3*4,((a,P)=>{(P+1)%4!==0&&(p[b]=v[b]+a,b++)})),P.setTangents(p)})),Promise.all(b).then((()=>{}))}static _LoadTransform(a,v){if(void 0!=a.skin)return;let p=b.s.Zero(),P=b.i.Identity(),L=b.s.One();if(a.matrix){b.e.bh(a.matrix).decompose(L,P,p)}else a.translation&&(p=b.s.bh(a.translation)),a.rotation&&(P=b.i.bh(a.rotation)),a.scale&&(L=b.s.bh(a.scale));v.position=p,v.rotationQuaternion=P,v.te=L}_loadSkinAsync(a,v,p,P){if(!this._parent.loadSkins)return Promise.resolve();const b=this._extensionsLoadSkinAsync(a,v,p);if(b)return b;if(p._data)return P(p._data.babylonSkeleton),p._data.promise;const L=`skeleton${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new R(p.name||L,L,this._babylonScene);t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(a,p,t);const V=this._loadSkinInverseBindMatricesDataAsync(a,p).then((a=>{this._updateBoneMatrices(t,a)}));return p._data={babylonSkeleton:t,promise:V},P(t),V}_loadBones(a,v,p){if(void 0==v.skeleton||this._parent.alwaysComputeSkeletonRootNode){const p=this._findSkeletonRootNode(`${a}/joints`,v.joints);if(p)if(void 0===v.skeleton)v.skeleton=p.index;else{const P=(a,v)=>{for(;v.parent;v=v.parent)if(v.parent===a)return!0;return!1},b=U.Get(`${a}/skeleton`,this._gltf.nodes,v.skeleton);b===p||P(b,p)||(A.d.Warn(`${a}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),v.skeleton=p.index)}else A.d.Warn(`${a}: Failed to find common root`)}const P={};for(const b of v.joints){const L=U.Get(`${a}/joints/${b}`,this._gltf.nodes,b);this._loadBone(L,v,p,P)}}_findSkeletonRootNode(a,v){if(0===v.length)return null;const p={};for(const b of v){const v=[];let P=U.Get(`${a}/${b}`,this._gltf.nodes,b);for(;-1!==P.index;)v.unshift(P),P=P.parent;p[b]=v}let P=null;for(let b=0;;++b){let a=p[v[0]];if(b>=a.length)return P;const L=a[b];for(let t=1;t<v.length;++t)if(a=p[v[t]],b>=a.length||L!==a[b])return P;P=L}}_loadBone(a,v,p,P){a._isJoint=!0;let b=P[a.index];if(b)return b;let L=null;a.index!==v.skeleton&&(a.parent&&-1!==a.parent.index?L=this._loadBone(a.parent,v,p,P):void 0!==v.skeleton&&A.d.Warn(`/skins/${v.index}/skeleton: Skeleton node is not a common root`));const t=v.joints.indexOf(a.index);return b=new C.e(a.name||`joint${a.index}`,p,L,this._getNodeMatrix(a),null,null,t),P[a.index]=b,this._postSceneLoadActions.push((()=>{b.linkTransformNode(a._babylonTransformNode)})),b}_loadSkinInverseBindMatricesDataAsync(a,v){if(void 0==v.inverseBindMatrices)return Promise.resolve(null);const p=U.Get(`${a}/inverseBindMatrices`,this._gltf.accessors,v.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${p.index}`,p)}_updateBoneMatrices(a,v){for(const p of a.bones){const a=b.e.Identity(),P=p._index;v&&-1!==P&&(b.e.FromArrayToRef(v,16*P,a),a.invertToRef(a));const L=p.getParent();L&&a.multiplyToRef(L.getAbsoluteInverseBindMatrix(),a),p.Sj(a,!1,!1),p._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(a){return a.matrix?b.e.bh(a.matrix):b.e.Compose(a.scale?b.s.bh(a.scale):b.s.One(),a.rotation?b.i.bh(a.rotation):b.i.Identity(),a.translation?b.s.bh(a.translation):b.s.Zero())}loadCameraAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadCameraAsync(a,v,p);if(P)return P;const L=new Array;this.logOpen(`${a} ${v.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new K.c(v.name||`camera${v.index}`,b.s.Zero(),this._babylonScene,!1);switch(t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.ignoreParentScaling=!0,v._babylonCamera=t,t.rotation.set(0,Math.PI,0),v.type){case"perspective":{const p=v.perspective;if(!p)throw new Error(`${a}: Camera perspective properties are missing`);t.fov=p.yfov,t.fj=p.znear,t.maxZ=p.zfar||0;break}case"orthographic":if(!v.orthographic)throw new Error(`${a}: Camera orthographic properties are missing`);t.mode=V.e.ORTHOGRAPHIC_CAMERA,t.orthoLeft=-v.orthographic.xmag,t.orthoRight=v.orthographic.xmag,t.orthoBottom=-v.orthographic.ymag,t.orthoTop=v.orthographic.ymag,t.fj=v.orthographic.znear,t.maxZ=v.orthographic.zfar;break;default:throw new Error(`${a}: Invalid camera type (${v.type})`)}return N.AddPointerMetadata(t,a),this._parent.onCameraLoadedObservable.notifyObservers(t),p(t),this.logClose(),Promise.all(L).then((()=>t))}_loadAnimationsAsync(){const a=this._gltf.animations;if(!a)return Promise.resolve();const v=new Array;for(let p=0;p<a.length;p++){const P=a[p];v.push(this.loadAnimationAsync(`/animations/${P.index}`,P).then((a=>{0===a.targetedAnimations.length&&a.dispose()})))}return Promise.all(v).then((()=>{}))}loadAnimationAsync(a,v){const P=this._extensionsLoadAnimationAsync(a,v);return P||p.e(38).then(p.bind(p,13656)).then((p=>{let{AnimationGroup:P}=p;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new P(v.name||`animation${v.index}`,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v._babylonAnimationGroup=b;const L=new Array;U.Assign(v.channels),U.Assign(v.samplers);for(const t of v.channels)L.push(this._loadAnimationChannelAsync(`${a}/channels/${t.index}`,a,v,t,((a,v)=>{a.animations=a.animations||[],a.animations.push(v),b.addTargetedAnimation(v,a)})));return Promise.all(L).then((()=>(b.normalize(0),b)))}))}_loadAnimationChannelAsync(a,v,p,P,b){const L=this._extensionsLoadAnimationChannelAsync(a,v,p,P,b);if(L)return L;if(void 0==P.target.node)return Promise.resolve();const t=U.Get(`${a}/target/node`,this._gltf.nodes,P.target.node),V=P.target.path,K="weights"===V;if(K&&!t._numMorphTargets||!K&&!t._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!K&&!t._isJoint)return Promise.resolve();let C;switch(V){case"translation":C=G.translation;break;case"rotation":C=G.rotation;break;case"scale":C=G.scale;break;case"weights":C=G.weights;break;default:throw new Error(`${a}/target/path: Invalid value (${P.target.path})`)}const F={object:t,info:C};return this._loadAnimationChannelFromTargetInfoAsync(a,v,p,P,F,b)}_loadAnimationChannelFromTargetInfoAsync(a,v,p,P,b,L){const t=this.parent.targetFps,V=1/t,K=U.Get(`${a}/sampler`,p.samplers,P.sampler);return this._loadAnimationSamplerAsync(`${v}/samplers/${P.sampler}`,K).then((a=>{let v=0;const K=b.object,C=b.info;for(const b of C){const C=b.getStride(K),F=a.input,u=a.output,c=new Array(F.length);let f=0;switch(a.interpolation){case"STEP":for(let a=0;a<F.length;a++){const v=b.getValue(K,u,f,1);f+=C,c[a]={frame:F[a]*t,value:v,interpolation:1}}break;case"CUBICSPLINE":for(let a=0;a<F.length;a++){const v=b.getValue(K,u,f,V);f+=C;const p=b.getValue(K,u,f,1);f+=C;const P=b.getValue(K,u,f,V);f+=C,c[a]={frame:F[a]*t,inTangent:v,value:p,outTangent:P}}break;case"LINEAR":for(let a=0;a<F.length;a++){const v=b.getValue(K,u,f,1);f+=C,c[a]={frame:F[a]*t,value:v}}}if(f>0){const a=`${p.name||`animation${p.index}`}_channel${P.index}_${v}`;b.buildAnimations(K,a,t,c,((a,p)=>{++v,L(a,p)}))}}}))}_loadAnimationSamplerAsync(a,v){if(v._data)return v._data;const p=v.interpolation||"LINEAR";switch(p){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${a}/interpolation: Invalid value (${v.interpolation})`)}const P=U.Get(`${a}/input`,this._gltf.accessors,v.input),b=U.Get(`${a}/output`,this._gltf.accessors,v.output);return v._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${P.index}`,P),this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)]).then((a=>{let[v,P]=a;return{input:v,interpolation:p,output:P}})),v._data}loadBufferAsync(a,v,p,P){const b=this._extensionsLoadBufferAsync(a,v,p,P);if(b)return b;if(!v._data)if(v.uri)v._data=this.loadUriAsync(`${a}/uri`,v,v.uri);else{if(!this._bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);v._data=this._bin.readAsync(0,v.byteLength)}return v._data.then((v=>{try{return new Uint8Array(v.buffer,v.byteOffset+p,P)}catch(b){throw new Error(`${a}: ${b.message}`)}}))}loadBufferViewAsync(a,v){const p=this._extensionsLoadBufferViewAsync(a,v);if(p)return p;if(v._data)return v._data;const P=U.Get(`${a}/buffer`,this._gltf.buffers,v.buffer);return v._data=this.loadBufferAsync(`/buffers/${P.index}`,P,v.byteOffset||0,v.byteLength),v._data}_loadAccessorAsync(a,v,p){if(v._data)return v._data;const P=N._GetNumComponents(a,v.type),b=P*T.f.GetTypeByteLength(v.componentType),L=P*v.count;if(void 0==v.bufferView)v._data=Promise.resolve(new p(L));else{const t=U.Get(`${a}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((V=>{if(5126!==v.componentType||v.normalized||t.byteStride&&t.byteStride!==b){const a=new p(L);return T.f.ForEach(V,v.byteOffset||0,t.byteStride||b,P,v.componentType,a.length,v.normalized||!1,((v,p)=>{a[p]=v})),a}return N._GetTypedArray(a,v.componentType,V,v.byteOffset,L)}))}if(v.sparse){const L=v.sparse;v._data=v._data.then((t=>{const V=t,K=U.Get(`${a}/sparse/indices/bufferView`,this._gltf.bufferViews,L.indices.bufferView),C=U.Get(`${a}/sparse/values/bufferView`,this._gltf.bufferViews,L.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${K.index}`,K),this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)]).then((t=>{let[K,C]=t;const F=N._GetTypedArray(`${a}/sparse/indices`,L.indices.componentType,K,L.indices.byteOffset,L.count),u=P*L.count;let c;if(5126!==v.componentType||v.normalized){const t=N._GetTypedArray(`${a}/sparse/values`,v.componentType,C,L.values.byteOffset,u);c=new p(u),T.f.ForEach(t,0,b,P,v.componentType,c.length,v.normalized||!1,((a,v)=>{c[v]=a}))}else c=N._GetTypedArray(`${a}/sparse/values`,v.componentType,C,L.values.byteOffset,u);let f=0;for(let a=0;a<F.length;a++){let v=F[a]*P;for(let a=0;a<P;a++)V[v++]=c[f++]}return V}))}))}return v._data}_loadFloatAccessorAsync(a,v){return this._loadAccessorAsync(a,v,Float32Array)}_loadIndicesAccessorAsync(a,v){if("SCALAR"!==v.type)throw new Error(`${a}/type: Invalid value ${v.type}`);if(5121!==v.componentType&&5123!==v.componentType&&5125!==v.componentType)throw new Error(`${a}/componentType: Invalid value ${v.componentType}`);if(v._data)return v._data;if(v.sparse){const p=N._GetTypedArrayConstructor(`${a}/componentType`,v.componentType);v._data=this._loadAccessorAsync(a,v,p)}else{const p=U.Get(`${a}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((p=>N._GetTypedArray(a,v.componentType,p,v.byteOffset,v.count)))}return v._data}_loadVertexBufferViewAsync(a){if(a._babylonBuffer)return a._babylonBuffer;const v=this._babylonScene.getEngine();return a._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((a=>new T.b(v,a,!1))),a._babylonBuffer}_loadVertexAccessorAsync(a,v,p){var P;if(null!==(P=v._babylonVertexBuffer)&&void 0!==P&&P[p])return v._babylonVertexBuffer[p];v._babylonVertexBuffer||(v._babylonVertexBuffer={});const b=this._babylonScene.getEngine();if(v.sparse||void 0==v.bufferView)v._babylonVertexBuffer[p]=this._loadFloatAccessorAsync(a,v).then((a=>new T.f(b,a,p,!1)));else{const P=U.Get(`${a}/bufferView`,this._gltf.bufferViews,v.bufferView);v._babylonVertexBuffer[p]=this._loadVertexBufferViewAsync(P).then((L=>{const t=N._GetNumComponents(a,v.type);return new T.f(b,L,p,!1,void 0,P.byteStride,void 0,v.byteOffset,t,v.componentType,v.normalized,!0,void 0,!0)}))}return v._babylonVertexBuffer[p]}_loadMaterialMetallicRoughnessPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return v&&(v.baseColorFactor?(p.albedoColor=L.d.bh(v.baseColorFactor),p.alpha=v.baseColorFactor[3]):p.albedoColor=L.d.White(),p.metallic=void 0==v.metallicFactor?1:v.metallicFactor,p.roughness=void 0==v.roughnessFactor?1:v.roughnessFactor,v.baseColorTexture&&P.push(this.loadTextureInfoAsync(`${a}/baseColorTexture`,v.baseColorTexture,(a=>{a.name=`${p.name} (Base Color)`,p.albedoTexture=a}))),v.metallicRoughnessTexture&&(v.metallicRoughnessTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${a}/metallicRoughnessTexture`,v.metallicRoughnessTexture,(a=>{a.name=`${p.name} (Metallic Roughness)`,p.metallicTexture=a}))),p.useMetallnessFromMetallicTextureBlue=!0,p.useRoughnessFromMetallicTextureGreen=!0,p.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(P).then((()=>{}))}_loadMaterialAsync(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const L=this._extensionsLoadMaterialAsync(a,v,p,P,b);if(L)return L;v._data=v._data||{};let t=v._data[P];if(!t){this.logOpen(`${a} ${v.name||""}`);const p=this.createMaterial(a,v,P);t={babylonMaterial:p,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(a,v,p)},v._data[P]=t,N.AddPointerMetadata(p,a),this._parent.onMaterialLoadedObservable.notifyObservers(p),this.logClose()}return p&&(t.babylonMeshes.push(p),p.uj.addOnce((()=>{const a=t.babylonMeshes.indexOf(p);-1!==a&&t.babylonMeshes.splice(a,1)}))),b(t.babylonMaterial),t.promise.then((()=>t.babylonMaterial))}_createDefaultMaterial(a,v){this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new S(a,this._babylonScene);return p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.fillMode=v,p.enableSpecularAntiAliasing=!0,p.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,p.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,p.transparencyMode=S.PBRMATERIAL_OPAQUE,p.metallic=1,p.roughness=1,p}createMaterial(a,v,p){const P=this._extensionsCreateMaterial(a,v,p);if(P)return P;const b=v.name||`material${v.index}`;return this._createDefaultMaterial(b,p)}loadMaterialPropertiesAsync(a,v,p){const P=this._extensionsLoadMaterialPropertiesAsync(a,v,p);if(P)return P;const b=new Array;return b.push(this.loadMaterialBasePropertiesAsync(a,v,p)),v.pbrMetallicRoughness&&b.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${a}/pbrMetallicRoughness`,v.pbrMetallicRoughness,p)),this.loadMaterialAlphaProperties(a,v,p),Promise.all(b).then((()=>{}))}loadMaterialBasePropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.emissiveColor=v.emissiveFactor?L.d.bh(v.emissiveFactor):new L.d(0,0,0),v.doubleSided&&(p.oh=!1,p.twoSidedLighting=!0),v.normalTexture&&(v.normalTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${a}/normalTexture`,v.normalTexture,(a=>{a.name=`${p.name} (Normal)`,p.bumpTexture=a}))),p.invertNormalMapX=!this._babylonScene.useRightHandedSystem,p.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=v.normalTexture.scale&&p.bumpTexture&&(p.bumpTexture.level=v.normalTexture.scale),p.forceIrradianceInFragment=!0),v.occlusionTexture&&(v.occlusionTexture.nonColorData=!0,P.push(this.loadTextureInfoAsync(`${a}/occlusionTexture`,v.occlusionTexture,(a=>{a.name=`${p.name} (Occlusion)`,p.ambientTexture=a}))),p.useAmbientInGrayScale=!0,void 0!=v.occlusionTexture.strength&&(p.ambientTextureStrength=v.occlusionTexture.strength)),v.emissiveTexture&&P.push(this.loadTextureInfoAsync(`${a}/emissiveTexture`,v.emissiveTexture,(a=>{a.name=`${p.name} (Emissive)`,p.emissiveTexture=a}))),Promise.all(P).then((()=>{}))}loadMaterialAlphaProperties(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);switch(v.alphaMode||"OPAQUE"){case"OPAQUE":p.transparencyMode=S.PBRMATERIAL_OPAQUE,p.alpha=1;break;case"MASK":p.transparencyMode=S.PBRMATERIAL_ALPHATEST,p.alphaCutOff=void 0==v.alphaCutoff?.5:v.alphaCutoff,p.albedoTexture&&(p.albedoTexture.Ge=!0);break;case"BLEND":p.transparencyMode=S.PBRMATERIAL_ALPHABLEND,p.albedoTexture&&(p.albedoTexture.Ge=!0,p.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${a}/alphaMode: Invalid value (${v.alphaMode})`)}}loadTextureInfoAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureInfoAsync(a,v,p);if(P)return P;if(this.logOpen(`${a}`),v.texCoord>=6)throw new Error(`${a}/texCoord: Invalid value (${v.texCoord})`);const b=U.Get(`${a}/index`,this._gltf.textures,v.index);b._textureInfo=v;const L=this._loadTextureAsync(`/textures/${v.index}`,b,(P=>{P.coordinatesIndex=v.texCoord||0,N.AddPointerMetadata(P,a),this._parent.onTextureLoadedObservable.notifyObservers(P),p(P)}));return this.logClose(),L}_loadTextureAsync(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const P=this._extensionsLoadTextureAsync(a,v,p);if(P)return P;this.logOpen(`${a} ${v.name||""}`);const b=void 0==v.sampler?N.DefaultSampler:U.Get(`${a}/sampler`,this._gltf.samplers,v.sampler),L=U.Get(`${a}/source`,this._gltf.images,v.source),t=this._createTextureAsync(a,b,L,p,void 0,!v._textureInfo.nonColorData);return this.logClose(),t}_createTextureAsync(a,v,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},L=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;const V=this._loadSampler(`/samplers/${v.index}`,v),K=new Array,C=new P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F={noMipmap:V.noMipMaps,invertY:!1,samplingMode:V.samplingMode,X:()=>{this._disposed||C.resolve()},onError:(v,p)=>{this._disposed||C.reject(new Error(`${a}: ${p&&p.message?p.message:v||"Failed to load texture"}`))},mimeType:p.mimeType,loaderOptions:L,useSRGBBuffer:!!t&&this._parent.useSRGBBuffers},u=new n.c(null,this._babylonScene,F);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.push(C.promise),K.push(this.loadImageAsync(`/images/${p.index}`,p).then((a=>{const v=p.uri||`${this._fileName}#image${p.index}`,P=`data:${this._uniqueRootUrl}${v}`;u.updateURL(P,a);const b=u.getInternalTexture();b&&(b.label=p.name)}))),u.wrapU=V.wrapU,u.wrapV=V.wrapV,b(u),this._parent.useGltfTextureNames&&(u.name=p.name||p.uri||`image${p.index}`),Promise.all(K).then((()=>u))}_loadSampler(a,v){return v._data||(v._data={noMipMaps:9728===v.minFilter||9729===v.minFilter,samplingMode:N._GetTextureSamplingMode(a,v),wrapU:N._GetTextureWrapMode(`${a}/wrapS`,v.wrapS),wrapV:N._GetTextureWrapMode(`${a}/wrapT`,v.wrapT)}),v._data}loadImageAsync(a,v){if(!v._data){if(this.logOpen(`${a} ${v.name||""}`),v.uri)v._data=this.loadUriAsync(`${a}/uri`,v,v.uri);else{const p=U.Get(`${a}/bufferView`,this._gltf.bufferViews,v.bufferView);v._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}this.logClose()}return v._data}loadUriAsync(a,v,p){const P=this._extensionsLoadUriAsync(a,v,p);if(P)return P;if(!N._ValidateUri(p))throw new Error(`${a}: '${p}' is invalid`);if((0,O.k)(p)){const v=new Uint8Array((0,O.e)(p));return this.log(`${a}: Decoded ${p.substring(0,64)}... (${v.length} bytes)`),Promise.resolve(v)}return this.log(`${a}: Loading ${p}`),this._parent.preprocessUrlAsync(this._rootUrl+p).then((v=>new Promise(((P,b)=>{this._parent._loadFile(this._babylonScene,v,(v=>{this._disposed||(this.log(`${a}: Loaded ${p} (${v.byteLength} bytes)`),P(new Uint8Array(v)))}),!0,(v=>{b(new O.l(`${a}: Failed to load '${p}'${v?": "+v.status+" "+v.statusText:""}`,v))}))}))))}static AddPointerMetadata(a,v){a.metadata=a.metadata||{};const p=a._internalMetadata=a._internalMetadata||{},P=p.Zi=p.Zi||{};(P.pointers=P.pointers||[]).push(v)}static _GetTextureWrapMode(a,v){switch(v=void 0==v?10497:v){case 33071:return n.c.CLAMP_ADDRESSMODE;case 33648:return n.c.MIRROR_ADDRESSMODE;case 10497:return n.c.WRAP_ADDRESSMODE;default:return A.d.Warn(`${a}: Invalid value (${v})`),n.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(a,v){const p=void 0==v.magFilter?9729:v.magFilter,P=void 0==v.minFilter?9987:v.minFilter;if(9729===p)switch(P){case 9728:return n.c.LINEAR_NEAREST;case 9729:return n.c.LINEAR_LINEAR;case 9984:return n.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return n.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return n.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return n.c.LINEAR_LINEAR_MIPLINEAR;default:return A.d.Warn(`${a}/minFilter: Invalid value (${P})`),n.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==p&&A.d.Warn(`${a}/magFilter: Invalid value (${p})`),P){case 9728:return n.c.NEAREST_NEAREST;case 9729:return n.c.NEAREST_LINEAR;case 9984:return n.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return n.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return n.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return n.c.NEAREST_LINEAR_MIPLINEAR;default:return A.d.Warn(`${a}/minFilter: Invalid value (${P})`),n.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(a,v){switch(v){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${a}: Invalid component type ${v}`)}}static _GetTypedArray(a,v,p,P,b){const L=p.buffer;P=p.byteOffset+(P||0);const t=N._GetTypedArrayConstructor(`${a}/componentType`,v),V=T.f.GetTypeByteLength(v);return P%V!==0?(A.d.Warn(`${a}: Copying buffer as byte offset (${P}) is not a multiple of component type byte length (${V})`),new t(L.slice(P,P+b*V),0)):new t(L,P,b)}static _GetNumComponents(a,v){switch(v){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${a}: Invalid type (${v})`)}static _ValidateUri(a){return t.e.IsBase64(a)||-1===a.indexOf("..")}static _GetDrawMode(a,v){switch(void 0==v&&(v=4),v){case 0:return X.c.PointListDrawMode;case 1:return X.c.LineListDrawMode;case 2:return X.c.LineLoopDrawMode;case 3:return X.c.LineStripDrawMode;case 4:return X.c.TriangleFillMode;case 5:return X.c.TriangleStripDrawMode;case 6:return X.c.TriangleFanDrawMode}throw new Error(`${a}: Invalid mesh primitive mode (${v})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const a=new Array;if(this._gltf.materials)for(const v of this._gltf.materials)if(v._data)for(const p in v._data){const P=v._data[p];for(const v of P.babylonMeshes){v.Zj(!0);const p=P.babylonMaterial;a.push(p.forceCompilationAsync(v)),a.push(p.forceCompilationAsync(v,{useInstances:!0})),this._parent.useClipPlane&&(a.push(p.forceCompilationAsync(v,{clipPlane:!0})),a.push(p.forceCompilationAsync(v,{clipPlane:!0,useInstances:!0})))}}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const a=new Array,v=this._babylonScene.lights;for(const p of v){const v=p.getShadowGenerator();v&&a.push(v.forceCompilationAsync())}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(a){for(const v of this._extensions)v.enabled&&a(v)}_applyExtensions(a,v,p){for(const P of this._extensions)if(P.enabled){const b=`${P.name}.${v}`,L=a;L._activeLoaderExtensionFunctions=L._activeLoaderExtensionFunctions||{};const t=L._activeLoaderExtensionFunctions;if(!t[b]){t[b]=!0;try{const a=p(P);if(a)return a}finally{delete t[b]}}}return null}_extensionsOnLoading(){this._forEachExtensions((a=>a.onLoading&&a.onLoading()))}_extensionsOnReady(){this._forEachExtensions((a=>a.onReady&&a.onReady()))}_extensionsLoadSceneAsync(a,v){return this._applyExtensions(v,"loadScene",(p=>p.loadSceneAsync&&p.loadSceneAsync(a,v)))}_extensionsLoadNodeAsync(a,v,p){return this._applyExtensions(v,"loadNode",(P=>P.loadNodeAsync&&P.loadNodeAsync(a,v,p)))}_extensionsLoadCameraAsync(a,v,p){return this._applyExtensions(v,"loadCamera",(P=>P.loadCameraAsync&&P.loadCameraAsync(a,v,p)))}_extensionsLoadVertexDataAsync(a,v,p){return this._applyExtensions(v,"loadVertexData",(P=>P._loadVertexDataAsync&&P._loadVertexDataAsync(a,v,p)))}_extensionsLoadMeshPrimitiveAsync(a,v,p,P,b,L){return this._applyExtensions(b,"loadMeshPrimitive",(t=>t._loadMeshPrimitiveAsync&&t._loadMeshPrimitiveAsync(a,v,p,P,b,L)))}_extensionsLoadMaterialAsync(a,v,p,P,b){return this._applyExtensions(v,"loadMaterial",(L=>L._loadMaterialAsync&&L._loadMaterialAsync(a,v,p,P,b)))}_extensionsCreateMaterial(a,v,p){return this._applyExtensions(v,"createMaterial",(P=>P.createMaterial&&P.createMaterial(a,v,p)))}_extensionsLoadMaterialPropertiesAsync(a,v,p){return this._applyExtensions(v,"loadMaterialProperties",(P=>P.loadMaterialPropertiesAsync&&P.loadMaterialPropertiesAsync(a,v,p)))}_extensionsLoadTextureInfoAsync(a,v,p){return this._applyExtensions(v,"loadTextureInfo",(P=>P.loadTextureInfoAsync&&P.loadTextureInfoAsync(a,v,p)))}_extensionsLoadTextureAsync(a,v,p){return this._applyExtensions(v,"loadTexture",(P=>P._loadTextureAsync&&P._loadTextureAsync(a,v,p)))}_extensionsLoadAnimationAsync(a,v){return this._applyExtensions(v,"loadAnimation",(p=>p.loadAnimationAsync&&p.loadAnimationAsync(a,v)))}_extensionsLoadAnimationChannelAsync(a,v,p,P,b){return this._applyExtensions(p,"loadAnimationChannel",(L=>L._loadAnimationChannelAsync&&L._loadAnimationChannelAsync(a,v,p,P,b)))}_extensionsLoadSkinAsync(a,v,p){return this._applyExtensions(p,"loadSkin",(P=>P._loadSkinAsync&&P._loadSkinAsync(a,v,p)))}_extensionsLoadUriAsync(a,v,p){return this._applyExtensions(v,"loadUri",(P=>P._loadUriAsync&&P._loadUriAsync(a,v,p)))}_extensionsLoadBufferViewAsync(a,v){return this._applyExtensions(v,"loadBufferView",(p=>p.loadBufferViewAsync&&p.loadBufferViewAsync(a,v)))}_extensionsLoadBufferAsync(a,v,p,P){return this._applyExtensions(v,"loadBuffer",(b=>b.loadBufferAsync&&b.loadBufferAsync(a,v,p,P)))}static LoadExtensionAsync(a,v,p,P){if(!v.extensions)return null;const b=v.extensions[p];return b?P(`${a}/extensions/${p}`,b):null}static LoadExtraAsync(a,v,p,P){if(!v.extras)return null;const b=v.extras[p];return b?P(`${a}/extras/${p}`,b):null}isExtensionUsed(a){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(a)}logOpen(a){this._parent._logOpen(a)}logClose(){this._parent._logClose()}log(a){this._parent._log(a)}startPerformanceCounter(a){this._parent._startPerformanceCounter(a)}endPerformanceCounter(a){this._parent._endPerformanceCounter(a)}}N.DefaultSampler={index:-1},m.e._CreateGLTF2Loader=a=>new N(a);var i=p(11714),I=p(12464),aa=p(12476);class va extends aa.e{constructor(a,v,p){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",a),this._texture=a.getEngine().createRawCubeTexture(v,p,P,b,L,t,V,K)}update(a,v,p,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,a,v,p,P,b)}updateRGBDAsync(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,I.k)(this._texture,a,v,p,P).then((()=>{}))}clone(){return M.b.Clone((()=>{const a=this.va(),v=this._texture,p=new va(a,v._bufferViewArray,v.width,v.format,v.type,v.generateMipMaps,v.invertY,v.samplingMode,v._compression);return 13===v.source&&p.updateRGBDAsync(v._bufferViewArrayArray,v._sphericalPolynomial,v._lodGenerationScale,v._lodGenerationOffset),p}),this)}}const pa="EXT_lights_image_based";class Pa{constructor(a){this.name=pa,this._loader=a,this.enabled=this._loader.isExtensionUsed(pa)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.Zi.extensions;if(a&&a[this.name]){const v=a[this.name];this._lights=v.lights}}loadSceneAsync(a,v){return N.LoadExtensionAsync(a,v,this.name,((p,P)=>{this._loader._allMaterialsDirtyRequired=!0;const b=new Array;b.push(this._loader.loadSceneAsync(a,v)),this._loader.logOpen(`${p}`);const L=U.Get(`${p}/light`,this._lights,P.eb);return b.push(this._loadLightAsync(`/extensions/${this.name}/lights/${P.eb}`,L).then((a=>{this._loader.babylonScene.environmentTexture=a}))),this._loader.logClose(),Promise.all(b).then((()=>{}))}))}_loadLightAsync(a,v){if(!v._loaded){const p=new Array;this._loader.logOpen(`${a}`);const P=new Array(v.specularImages.length);for(let b=0;b<v.specularImages.length;b++){const L=v.specularImages[b];P[b]=new Array(L.length);for(let v=0;v<L.length;v++){const t=`${a}/specularImages/${b}/${v}`;this._loader.logOpen(`${t}`);const V=L[v],K=U.Get(t,this._loader.Zi.images,V);p.push(this._loader.loadImageAsync(`/images/${V}`,K).then((a=>{P[b][v]=a}))),this._loader.logClose()}}this._loader.logClose(),v._loaded=Promise.all(p).then((()=>{const p=new va(this._loader.babylonScene,null,v.specularImageSize);if(p.name=v.name||"environment",v._babylonTexture=p,void 0!=v.jj&&(p.level=v.jj),v.rotation){let a=b.i.bh(v.rotation);this._loader.babylonScene.useRightHandedSystem||(a=b.i.Inverse(a)),b.e.FromQuaternionToRef(a,p.getReflectionTextureMatrix())}if(!v.irradianceCoefficients)throw new Error(`${a}: Irradiance coefficients are missing`);const L=i.d.bh(v.irradianceCoefficients);L.scaleInPlace(v.jj),L.convertIrradianceToLambertianRadiance();const t=i.f.FromHarmonics(L),V=(P.length-1)/Math.log2(v.specularImageSize);return p.updateRGBDAsync(P,t,V)}))}return v._loaded.then((()=>v._babylonTexture))}}E(pa),d(pa,!0,(a=>new Pa(a)));p(12482);const ba="EXT_mesh_gpu_instancing";class La{constructor(a){this.name=ba,this._loader=a,this.enabled=this._loader.isExtensionUsed(ba)}dispose(){this._loader=null}loadNodeAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((a,P)=>{this._loader._disableInstancedMesh++;const L=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,p);if(this._loader._disableInstancedMesh--,!v._primitiveBabylonMeshes)return L;const t=new Array;let V=0;const K=v=>{if(void 0==P.attributes[v])return void t.push(Promise.resolve(null));const p=U.Get(`${a}/attributes/${v}`,this._loader.Zi.accessors,P.attributes[v]);if(t.push(this._loader._loadFloatAccessorAsync(`/accessors/${p.bufferView}`,p)),0===V)V=p.count;else if(V!==p.count)throw new Error(`${a}/attributes: Instance buffer accessors do not have the same count.`)};return K("TRANSLATION"),K("ROTATION"),K("SCALE"),L.then((a=>Promise.all(t).then((p=>{let[P,L,t]=p;const K=new Float32Array(16*V);b.k.fb[0].qe(0,0,0),b.k.Quaternion[0].qe(0,0,0,1),b.k.fb[1].qe(1,1,1);for(let a=0;a<V;++a)P&&b.s.FromArrayToRef(P,3*a,b.k.fb[0]),L&&b.i.FromArrayToRef(L,4*a,b.k.Quaternion[0]),t&&b.s.FromArrayToRef(t,3*a,b.k.fb[1]),b.e.ComposeToRef(b.k.fb[1],b.k.Quaternion[0],b.k.fb[0],b.k.Matrix[0]),b.k.Matrix[0].copyToArray(K,16*a);for(const a of v._primitiveBabylonMeshes)a.Rb("matrix",K,16,!0);return a}))))}))}}E(ba),d(ba,!0,(a=>new La(a)));class ta{static get Default(){return ta._Default||(ta._Default=new ta),ta._Default}constructor(){const a=ta.Configuration.decoder;this._decoderModulePromise=t.e.LoadBabylonScriptAsync(a.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(a,v,p,P,b){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const L=await MeshoptDecoder.decodeGltfBufferAsync(v,p,a,P,b);return MeshoptDecoder.useWorkers(0),L}))}}ta.Configuration={decoder:{url:`${t.e._DefaultCdnUrl}/meshopt_decoder.js`}},ta._Default=null;const Va="EXT_meshopt_compression";class Ka{constructor(a){this.name=Va,this.enabled=a.isExtensionUsed(Va),this._loader=a}dispose(){this._loader=null}loadBufferViewAsync(a,v){return N.LoadExtensionAsync(a,v,this.name,((p,P)=>{const b=v;if(b._meshOptData)return b._meshOptData;const L=U.Get(`${a}/buffer`,this._loader.Zi.buffers,P.buffer);return b._meshOptData=this._loader.loadBufferAsync(`/buffers/${L.index}`,L,P.byteOffset||0,P.byteLength).then((a=>ta.Default.decodeGltfBufferAsync(a,P.count,P.byteStride,P.mode,P.filter))),b._meshOptData}))}}E(Va),d(Va,!0,(a=>new Ka(a)));const Ca="EXT_texture_webp";class Fa{constructor(a){this.name=Ca,this._loader=a,this.enabled=a.isExtensionUsed(Ca)}dispose(){this._loader=null}_loadTextureAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=void 0==v.sampler?N.DefaultSampler:U.Get(`${a}/sampler`,this._loader.Zi.samplers,v.sampler),t=U.Get(`${P}/source`,this._loader.Zi.images,b.source);return this._loader._createTextureAsync(a,L,t,(a=>{p(a)}),void 0,!v._textureInfo.nonColorData)}))}}E(Ca),d(Ca,!0,(a=>new Fa(a)));const ua="EXT_texture_avif";class ca{constructor(a){this.name=ua,this._loader=a,this.enabled=a.isExtensionUsed(ua)}dispose(){this._loader=null}_loadTextureAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=void 0==v.sampler?N.DefaultSampler:U.Get(`${a}/sampler`,this._loader.Zi.samplers,v.sampler),t=U.Get(`${P}/source`,this._loader.Zi.images,b.source);return this._loader._createTextureAsync(a,L,t,(a=>{p(a)}),void 0,!v._textureInfo.nonColorData)}))}}E(ua),d(ua,!0,(a=>new ca(a)));var fa=p(12486);const Ha="KHR_draco_mesh_compression";class Aa{constructor(a){this.name=Ha,this.useNormalizedFlagFromAccessor=!0,this._loader=a,this.enabled=fa.b.DecoderAvailable&&this._loader.isExtensionUsed(Ha)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{if(void 0!=v.mode&&4!==v.mode&&5!==v.mode)throw new Error(`${a}: Unsupported mode ${v.mode}`);const L={},t={},V=(a,P)=>{const V=b.attributes[a];if(void 0!=V&&(p._delayInfo=p._delayInfo||[],-1===p._delayInfo.indexOf(P)&&p._delayInfo.push(P),L[P]=V,this.useNormalizedFlagFromAccessor)){const p=U.TryGet(this._loader.Zi.accessors,v.attributes[a]);p&&(t[P]=p.normalized||!1)}};V("POSITION",T.f.PositionKind),V("NORMAL",T.f.NormalKind),V("TANGENT",T.f.TangentKind),V("TEXCOORD_0",T.f.UVKind),V("TEXCOORD_1",T.f.UV2Kind),V("TEXCOORD_2",T.f.UV3Kind),V("TEXCOORD_3",T.f.UV4Kind),V("TEXCOORD_4",T.f.UV5Kind),V("TEXCOORD_5",T.f.UV6Kind),V("JOINTS_0",T.f.MatricesIndicesKind),V("WEIGHTS_0",T.f.MatricesWeightsKind),V("COLOR_0",T.f.ColorKind);const K=U.Get(P,this._loader.Zi.bufferViews,b.bufferView);return K._dracoBabylonGeometry||(K._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((v=>(this.dracoCompression||fa.b.Default)._decodeMeshToGeometryForGltfAsync(p.name,this._loader.babylonScene,v,L,t).catch((v=>{throw new Error(`${a}: ${v.message}`)}))))),K._dracoBabylonGeometry}))}}E(Ha),d(Ha,!0,(a=>new Aa(a)));var ha=p(12498),Ra=p(11515),Xa=p(12456),Qa=p(12504);Ra.b.AddNodeConstructor("Light_Type_0",((a,v)=>()=>new sa(a,b.s.Zero(),v)));class sa extends Qa.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(a){this._shadowAngle=a,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(a){const v=this.needCube();if(this._direction=a,this.needCube()!==v&&this._shadowGenerators){const a=this._shadowGenerators.values();for(let v=a.next();!0!==v.done;v=a.next()){v.value.recreateShadowMap()}}}constructor(a,v,p){super(a,p),this._shadowAngle=Math.PI/2,this.position=v}getClassName(){return"PointLight"}getTypeID(){return Xa.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(a){if(this.direction)return super.getShadowDirection(a);switch(a){case 0:return new b.s(1,0,0);case 1:return new b.s(-1,0,0);case 2:return new b.s(0,-1,0);case 3:return new b.s(0,1,0);case 4:return new b.s(0,0,1);case 5:return new b.s(0,0,-1)}return b.s.Zero()}_setDefaultShadowProjectionMatrix(a,v,p){const P=this.va().activeCamera;if(!P)return;const L=void 0!==this.shadowMinZ?this.shadowMinZ:P.fj,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,V=this.va().getEngine().useReverseDepthBuffer;b.e.PerspectiveFovLHToRef(this.shadowAngle,1,V?t:L,V?L:t,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,V)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,v){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,v):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,v),this}transferToNodeMaterialEffect(a,v){return this.computeTransformedInformation()?a.setFloat3(v,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):a.setFloat3(v,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(a,v){a["POINTLIGHT"+v]=!0}}(0,Q.e)([(0,s.O)()],sa.prototype,"shadowAngle",null),(0,Z.f)("BABYLON.PointLight",sa),Ra.b.AddNodeConstructor("Light_Type_2",((a,v)=>()=>new Da(a,b.s.Zero(),b.s.Zero(),0,0,v)));class Da extends Qa.e{get angle(){return this._angle}set angle(a){this._angle=a,this._cosHalfAngle=Math.cos(.5*a),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(a){this._innerAngle=a,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(a){this._shadowAngleScale=a,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(a){this._projectionTextureLightNear=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(a){this._projectionTextureLightFar=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(a){this._projectionTextureUpDirection=a,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(a){this._projectionTexture!==a&&(this._projectionTexture=a,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Da._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Da._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(a){return void 0!==a.onGeneratedObservable}static _IsTexture(a){return void 0!==a.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(a){this._projectionTextureProjectionLightMatrix=a,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(a,v,p,P,L,t){super(a,t),this._innerAngle=0,this._projectionTextureMatrix=b.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=b.s.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=b.s.Zero(),this._projectionTextureViewLightMatrix=b.e.Zero(),this._projectionTextureProjectionLightMatrix=b.e.Zero(),this._projectionTextureScalingMatrix=b.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=v,this.direction=p,this.angle=P,this.exponent=L}getClassName(){return"SpotLight"}getTypeID(){return Xa.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(a){super._setDirection(a),this._projectionTextureViewLightDirty=!0}_setPosition(a){super._setPosition(a),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(a,v,p){const P=this.va().activeCamera;if(!P)return;this._shadowAngleScale=this._shadowAngleScale||1;const L=this._shadowAngleScale*this._angle,t=void 0!==this.shadowMinZ?this.shadowMinZ:P.fj,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:P.maxZ,K=this.va().getEngine().useReverseDepthBuffer;b.e.PerspectiveFovLHToRef(L,1,K?V:t,K?t:V,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,K)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),b.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const a=this.projectionTextureLightFar,v=this.projectionTextureLightNear,p=a/(a-v),P=-p*v,L=1/Math.tan(this._angle/2);b.e.FromValuesToRef(L/1,0,0,0,0,L,0,0,0,0,p,1,0,0,P,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof n.c){const a=this._projectionTexture.uScale/2,v=this._projectionTexture.vScale/2;b.e.FromValuesToRef(a,0,0,0,0,v,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(a,v){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),a.setMatrix("textureProjectionMatrix"+v,this._projectionTextureMatrix),a.setTexture("projectionLightTexture"+v,this.projectionTexture)),this}transferToEffect(a,v){let p;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,v),p=b.s.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,v),p=b.s.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",p.x,p.y,p.z,this._cosHalfAngle,v),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,v),this}transferToNodeMaterialEffect(a,v){let p;return p=this.computeTransformedInformation()?b.s.Normalize(this.transformedDirection):b.s.Normalize(this.direction),this.va().useRightHandedSystem?a.setFloat3(v,-p.x,-p.y,-p.z):a.setFloat3(v,p.x,p.y,p.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(a){const v=this._scene.getEngine(),p=void 0!==this.shadowMinZ?this.shadowMinZ:a.fj;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?p:this._scene.getEngine().isNDCHalfZRange?0:p}getDepthMaxZ(a){const v=this._scene.getEngine(),p=void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ;return v.useReverseDepthBuffer&&v.isNDCHalfZRange?0:p}prepareLightSpecificDefines(a,v){a["SPOTLIGHT"+v]=!0,a["PROJECTEDLIGHTTEXTURE"+v]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,Q.e)([(0,s.O)()],Da.prototype,"angle",null),(0,Q.e)([(0,s.O)()],Da.prototype,"innerAngle",null),(0,Q.e)([(0,s.O)()],Da.prototype,"shadowAngleScale",null),(0,Q.e)([(0,s.O)()],Da.prototype,"exponent",void 0),(0,Q.e)([(0,s.O)()],Da.prototype,"projectionTextureLightNear",null),(0,Q.e)([(0,s.O)()],Da.prototype,"projectionTextureLightFar",null),(0,Q.e)([(0,s.O)()],Da.prototype,"projectionTextureUpDirection",null),(0,Q.e)([(0,s.H)("projectedLightTexture")],Da.prototype,"_projectionTexture",void 0),(0,Z.f)("BABYLON.SpotLight",Da);const ya="KHR_lights_punctual";class Za{constructor(a){this.name=ya,this._loader=a,this.enabled=this._loader.isExtensionUsed(ya)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.Zi.extensions;if(a&&a[this.name]){const v=a[this.name];this._lights=v.lights,U.Assign(this._lights)}}loadNodeAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,t)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(a,v,(a=>{let v;const V=U.Get(P,this._lights,t.eb),K=V.name||a.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,V.type){case"directional":{const a=new ha.d(K,b.s.Backward(),this._loader.babylonScene);a.position.pe(0),v=a;break}case"point":v=new sa(K,b.s.Zero(),this._loader.babylonScene);break;case"spot":{const a=new Da(K,b.s.Zero(),b.s.Backward(),0,1,this._loader.babylonScene);a.angle=2*(V.spot&&V.spot.outerConeAngle||Math.PI/4),a.innerAngle=2*(V.spot&&V.spot.innerConeAngle||0),v=a;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${P}: Invalid light type (${V.type})`)}v._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,V._babylonLight=v,v.falloffType=Xa.b.FALLOFF_GLTF,v.Fh=V.color?L.d.bh(V.color):L.d.White(),v.jj=void 0==V.jj?1:V.jj,v.range=void 0==V.range?Number.MAX_VALUE:V.range,v.parent=a,this._loader._babylonLights.push(v),N.AddPointerMetadata(v,P),p(a)})))))}}E(ya),d(ya,!0,(a=>new Za(a)));const Ma="KHR_materials_pbrSpecularGlossiness";class Sa{constructor(a){this.name=Ma,this.order=200,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ma)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialBasePropertiesAsync(a,v,p)),L.push(this._loadSpecularGlossinessPropertiesAsync(P,b,p)),this._loader.loadMaterialAlphaProperties(a,v,p),Promise.all(L).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.metallic=null,p.roughness=null,v.diffuseFactor?(p.albedoColor=L.d.bh(v.diffuseFactor),p.alpha=v.diffuseFactor[3]):p.albedoColor=L.d.White(),p.reflectivityColor=v.specularFactor?L.d.bh(v.specularFactor):L.d.White(),p.microSurface=void 0==v.glossinessFactor?1:v.glossinessFactor,v.diffuseTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTexture`,v.diffuseTexture,(a=>{a.name=`${p.name} (Diffuse)`,p.albedoTexture=a}))),v.specularGlossinessTexture&&(P.push(this._loader.loadTextureInfoAsync(`${a}/specularGlossinessTexture`,v.specularGlossinessTexture,(a=>{a.name=`${p.name} (Specular Glossiness)`,p.reflectivityTexture=a,p.reflectivityTexture.Ge=!0}))),p.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(P).then((()=>{}))}}E(Ma),d(Ma,!0,(a=>new Sa(a)));const na="KHR_materials_unlit";class qa{constructor(a){this.name=na,this.order=210,this._loader=a,this.enabled=this._loader.isExtensionUsed(na)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,(()=>this._loadUnlitPropertiesAsync(a,v,p)))}_loadUnlitPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;p.unlit=!0;const b=v.pbrMetallicRoughness;return b&&(b.baseColorFactor?(p.albedoColor=L.d.bh(b.baseColorFactor),p.alpha=b.baseColorFactor[3]):p.albedoColor=L.d.White(),b.baseColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/baseColorTexture`,b.baseColorTexture,(a=>{a.name=`${p.name} (Base Color)`,p.albedoTexture=a})))),v.doubleSided&&(p.oh=!1,p.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(a,v,p),Promise.all(P).then((()=>{}))}}E(na),d(na,!0,(a=>new qa(a)));const Ta="KHR_materials_clearcoat";class ja{constructor(a){this.name=Ta,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ta)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadClearCoatPropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadClearCoatPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.clearCoat.isEnabled=!0,p.clearCoat.useRoughnessFromMainTexture=!1,p.clearCoat.remapF0OnInterfaceChange=!1,void 0!=v.clearcoatFactor?p.clearCoat.jj=v.clearcoatFactor:p.clearCoat.jj=0,v.clearcoatTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatTexture`,v.clearcoatTexture,(a=>{a.name=`${p.name} (ClearCoat)`,p.clearCoat.texture=a}))),void 0!=v.clearcoatRoughnessFactor?p.clearCoat.roughness=v.clearcoatRoughnessFactor:p.clearCoat.roughness=0,v.clearcoatRoughnessTexture&&(v.clearcoatRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatRoughnessTexture`,v.clearcoatRoughnessTexture,(a=>{a.name=`${p.name} (ClearCoat Roughness)`,p.clearCoat.textureRoughness=a})))),v.clearcoatNormalTexture&&(v.clearcoatNormalTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatNormalTexture`,v.clearcoatNormalTexture,(a=>{a.name=`${p.name} (ClearCoat Normal)`,p.clearCoat.bumpTexture=a}))),p.invertNormalMapX=!p.va().useRightHandedSystem,p.invertNormalMapY=p.va().useRightHandedSystem,void 0!=v.clearcoatNormalTexture.scale&&(p.clearCoat.bumpTexture.level=v.clearcoatNormalTexture.scale)),Promise.all(P).then((()=>{}))}}E(Ta),d(Ta,!0,(a=>new ja(a)));const wa="KHR_materials_iridescence";class Ja{constructor(a){this.name=wa,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(wa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadIridescencePropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.iridescence.isEnabled=!0,p.iridescence.jj=v.iridescenceFactor??0,p.iridescence.indexOfRefraction=v.iridescenceIor??v.iridescenceIOR??1.3,p.iridescence.minimumThickness=v.iridescenceThicknessMinimum??100,p.iridescence.maximumThickness=v.iridescenceThicknessMaximum??400,v.iridescenceTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceTexture`,v.iridescenceTexture,(a=>{a.name=`${p.name} (Iridescence)`,p.iridescence.texture=a}))),v.iridescenceThicknessTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceThicknessTexture`,v.iridescenceThicknessTexture,(a=>{a.name=`${p.name} (Iridescence Thickness)`,p.iridescence.thicknessTexture=a}))),Promise.all(P).then((()=>{}))}}E(wa),d(wa,!0,(a=>new Ja(a)));const Ba="KHR_materials_anisotropy";class xa{constructor(a){this.name=Ba,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ba)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadIridescencePropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadIridescencePropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.anisotropy.isEnabled=!0,p.anisotropy.jj=v.anisotropyStrength??0,p.anisotropy.angle=v.anisotropyRotation??0,v.anisotropyTexture&&(v.anisotropyTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${a}/anisotropyTexture`,v.anisotropyTexture,(a=>{a.name=`${p.name} (Anisotropy Intensity)`,p.anisotropy.texture=a})))),Promise.all(P).then((()=>{}))}}E(Ba),d(Ba,!0,(a=>new xa(a)));const ra="KHR_materials_emissive_strength";class oa{constructor(a){this.name=ra,this.order=170,this._loader=a,this.enabled=this._loader.isExtensionUsed(ra)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>this._loader.loadMaterialPropertiesAsync(a,v,p).then((()=>{this._loadEmissiveProperties(P,b,p)}))))}_loadEmissiveProperties(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);void 0!==v.emissiveStrength&&(p.emissiveIntensity=v.emissiveStrength)}}E(ra),d(ra,!0,(a=>new oa(a)));const ma="KHR_materials_sheen";class Oa{constructor(a){this.name=ma,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(ma)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadSheenPropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadSheenPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return p.sheen.isEnabled=!0,p.sheen.jj=1,void 0!=v.sheenColorFactor?p.sheen.color=L.d.bh(v.sheenColorFactor):p.sheen.color=L.d.Black(),v.sheenColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/sheenColorTexture`,v.sheenColorTexture,(a=>{a.name=`${p.name} (Sheen Color)`,p.sheen.texture=a}))),void 0!==v.sheenRoughnessFactor?p.sheen.roughness=v.sheenRoughnessFactor:p.sheen.roughness=0,v.sheenRoughnessTexture&&(v.sheenRoughnessTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${a}/sheenRoughnessTexture`,v.sheenRoughnessTexture,(a=>{a.name=`${p.name} (Sheen Roughness)`,p.sheen.textureRoughness=a})))),p.sheen.albedoScaling=!0,p.sheen.useRoughnessFromMainTexture=!1,Promise.all(P).then((()=>{}))}}E(ma),d(ma,!0,(a=>new Oa(a)));const Ya="KHR_materials_specular";class la{constructor(a){this.name=Ya,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ya)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadSpecularPropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadSpecularPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const P=new Array;return void 0!==v.specularFactor&&(p.metallicF0Factor=v.specularFactor),void 0!==v.specularColorFactor&&(p.metallicReflectanceColor=L.d.bh(v.specularColorFactor)),v.specularTexture&&(v.specularTexture.nonColorData=!0,P.push(this._loader.loadTextureInfoAsync(`${a}/specularTexture`,v.specularTexture,(a=>{a.name=`${p.name} (Specular)`,p.metallicReflectanceTexture=a,p.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),v.specularColorTexture&&P.push(this._loader.loadTextureInfoAsync(`${a}/specularColorTexture`,v.specularColorTexture,(a=>{a.name=`${p.name} (Specular Color)`,p.reflectanceTexture=a}))),Promise.all(P).then((()=>{}))}}E(Ya),d(Ya,!0,(a=>new la(a)));const za="KHR_materials_ior";class ga{constructor(a){this.name=za,this.order=180,this._loader=a,this.enabled=this._loader.isExtensionUsed(za)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadIorPropertiesAsync(P,b,p)),Promise.all(L).then((()=>{}))}))}_loadIorPropertiesAsync(a,v,p){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);return void 0!==v.ior?p.indexOfRefraction=v.ior:p.indexOfRefraction=ga._DEFAULT_IOR,Promise.resolve()}}ga._DEFAULT_IOR=1.5,E(za),d(za,!0,(a=>new ga(a)));const Ga="KHR_materials_variants";class ea{constructor(a){this.name=Ga,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ga)}dispose(){this._loader=null}static GetAvailableVariants(a){const v=this._GetExtensionMetadata(a);return v?Object.keys(v.variants):[]}getAvailableVariants(a){return ea.GetAvailableVariants(a)}static SelectVariant(a,v){const p=this._GetExtensionMetadata(a);if(!p)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Ga} extension`);const P=a=>{const v=p.variants[a];if(v)for(const p of v)p.mesh.material=p.material};if(v instanceof Array)for(const b of v)P(b);else P(v);p.lastSelected=v}selectVariant(a,v){ea.SelectVariant(a,v)}static Reset(a){const v=this._GetExtensionMetadata(a);if(!v)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Ga} extension`);for(const p of v.original)p.mesh.material=p.material;v.lastSelected=null}reset(a){ea.Reset(a)}static GetLastSelectedVariant(a){const v=this._GetExtensionMetadata(a);if(!v)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Ga} extension`);return v.lastSelected}getLastSelectedVariant(a){return ea.GetLastSelectedVariant(a)}static _GetExtensionMetadata(a){var v,p;return(null===a||void 0===a||null===(v=a._internalMetadata)||void 0===v||null===(p=v.Zi)||void 0===p?void 0:p[Ga])||null}onLoading(){const a=this._loader.Zi.extensions;if(a&&a[this.name]){const v=a[this.name];this._variants=v.variants}}_loadMeshPrimitiveAsync(a,v,p,P,b,L){return N.LoadExtensionAsync(a,b,this.name,((t,V)=>{const K=new Array;return K.push(this._loader._loadMeshPrimitiveAsync(a,v,p,P,b,(v=>{if(L(v),v instanceof J.b){const p=N._GetDrawMode(a,b.mode),P=this._loader.rootBabylonMesh,L=P?P._internalMetadata=P._internalMetadata||{}:{},C=L.Zi=L.Zi||{},F=C[Ga]=C[Ga]||{lastSelected:null,original:[],variants:{}};F.original.push({mesh:v,material:v.material});for(let a=0;a<V.mappings.length;++a){const b=V.mappings[a],L=U.Get(`${t}/mappings/${a}/material`,this._loader.Zi.materials,b.material);K.push(this._loader._loadMaterialAsync(`#/materials/${b.material}`,L,v,p,(a=>{for(let p=0;p<b.variants.length;++p){const L=b.variants[p],t=U.Get(`/extensions/${Ga}/variants/${L}`,this._variants,L);F.variants[t.name]=F.variants[t.name]||[],F.variants[t.name].push({mesh:v,material:a}),v.onClonedObservable.add((a=>{const p=a;let b=null,L=p;do{if(L=L.parent,!L)return;b=ea._GetExtensionMetadata(L)}while(null===b);if(P&&b===ea._GetExtensionMetadata(P)){L._internalMetadata={};for(const a in P._internalMetadata)L._internalMetadata[a]=P._internalMetadata[a];L._internalMetadata.Zi=[];for(const a in P._internalMetadata.Zi)L._internalMetadata.Zi[a]=P._internalMetadata.Zi[a];L._internalMetadata.Zi[Ga]={lastSelected:null,original:[],variants:{}};for(const a of b.original)L._internalMetadata.Zi[Ga].original.push({mesh:a.mesh,material:a.material});for(const a in b.variants)if(Object.prototype.hasOwnProperty.call(b.variants,a)){L._internalMetadata.Zi[Ga].variants[a]=[];for(const v of b.variants[a])L._internalMetadata.Zi[Ga].variants[a].push({mesh:v.mesh,material:v.material})}b=L._internalMetadata.Zi[Ga]}for(const P of b.original)P.mesh===v&&(P.mesh=p);for(const P of b.variants[t.name])P.mesh===v&&(P.mesh=p)}))}})))}}}))),Promise.all(K).then((a=>{let[v]=a;return v}))}))}}E(Ga),d(Ga,!0,(a=>new ea(a)));var ka=p(11751);class da{}da.AUTOSAMPLERSUFFIX="Sampler",da.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",da.ALPHA_DISABLE=0,da.ALPHA_ADD=1,da.ALPHA_COMBINE=2,da.ALPHA_SUBTRACT=3,da.ALPHA_MULTIPLY=4,da.ALPHA_MAXIMIZED=5,da.ALPHA_ONEONE=6,da.ALPHA_PREMULTIPLIED=7,da.ALPHA_PREMULTIPLIED_PORTERDUFF=8,da.ALPHA_INTERPOLATE=9,da.ALPHA_SCREENMODE=10,da.ALPHA_ONEONE_ONEONE=11,da.ALPHA_ALPHATOCOLOR=12,da.ALPHA_REVERSEONEMINUS=13,da.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,da.ALPHA_ONEONE_ONEZERO=15,da.ALPHA_EXCLUSION=16,da.ALPHA_LAYER_ACCUMULATE=17,da.ALPHA_EQUATION_ADD=0,da.ALPHA_EQUATION_SUBSTRACT=1,da.ALPHA_EQUATION_REVERSE_SUBTRACT=2,da.ALPHA_EQUATION_MAX=3,da.ALPHA_EQUATION_MIN=4,da.ALPHA_EQUATION_DARKEN=5,da.DELAYLOADSTATE_NONE=0,da.DELAYLOADSTATE_LOADED=1,da.DELAYLOADSTATE_LOADING=2,da.DELAYLOADSTATE_NOTLOADED=4,da.NEVER=512,da.ALWAYS=519,da.LESS=513,da.EQUAL=514,da.LEQUAL=515,da.GREATER=516,da.GEQUAL=518,da.NOTEQUAL=517,da.KEEP=7680,da.ZERO=0,da.REPLACE=7681,da.INCR=7682,da.DECR=7683,da.INVERT=5386,da.INCR_WRAP=34055,da.DECR_WRAP=34056,da.TEXTURE_CLAMP_ADDRESSMODE=0,da.TEXTURE_WRAP_ADDRESSMODE=1,da.TEXTURE_MIRROR_ADDRESSMODE=2,da.TEXTURE_CREATIONFLAG_STORAGE=1,da.TEXTUREFORMAT_ALPHA=0,da.TEXTUREFORMAT_LUMINANCE=1,da.TEXTUREFORMAT_LUMINANCE_ALPHA=2,da.TEXTUREFORMAT_RGB=4,da.TEXTUREFORMAT_RGBA=5,da.TEXTUREFORMAT_RED=6,da.TEXTUREFORMAT_R=6,da.TEXTUREFORMAT_RG=7,da.TEXTUREFORMAT_RED_INTEGER=8,da.TEXTUREFORMAT_R_INTEGER=8,da.TEXTUREFORMAT_RG_INTEGER=9,da.TEXTUREFORMAT_RGB_INTEGER=10,da.TEXTUREFORMAT_RGBA_INTEGER=11,da.TEXTUREFORMAT_BGRA=12,da.TEXTUREFORMAT_DEPTH24_STENCIL8=13,da.TEXTUREFORMAT_DEPTH32_FLOAT=14,da.TEXTUREFORMAT_DEPTH16=15,da.TEXTUREFORMAT_DEPTH24=16,da.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,da.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,da.TEXTUREFORMAT_STENCIL8=19,da.TEXTUREFORMAT_UNDEFINED=4294967295,da.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,da.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,da.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,da.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,da.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,da.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,da.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,da.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,da.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,da.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,da.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,da.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,da.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,da.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,da.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,da.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,da.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,da.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,da.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,da.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,da.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,da.TEXTURETYPE_UNSIGNED_BYTE=0,da.TEXTURETYPE_UNSIGNED_INT=0,da.TEXTURETYPE_FLOAT=1,da.TEXTURETYPE_HALF_FLOAT=2,da.TEXTURETYPE_BYTE=3,da.TEXTURETYPE_SHORT=4,da.TEXTURETYPE_UNSIGNED_SHORT=5,da.TEXTURETYPE_INT=6,da.TEXTURETYPE_UNSIGNED_INTEGER=7,da.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,da.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,da.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,da.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,da.TEXTURETYPE_UNSIGNED_INT_24_8=12,da.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,da.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,da.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,da.TEXTURETYPE_UNDEFINED=16,da.TEXTURE_2D=3553,da.TEXTURE_2D_ARRAY=35866,da.TEXTURE_CUBE_MAP=34067,da.TEXTURE_CUBE_MAP_ARRAY=3735928559,da.TEXTURE_3D=32879,da.TEXTURE_NEAREST_SAMPLINGMODE=1,da.TEXTURE_NEAREST_NEAREST=1,da.TEXTURE_BILINEAR_SAMPLINGMODE=2,da.TEXTURE_LINEAR_LINEAR=2,da.TEXTURE_TRILINEAR_SAMPLINGMODE=3,da.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,da.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,da.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,da.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,da.TEXTURE_NEAREST_LINEAR=7,da.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,da.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,da.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,da.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,da.TEXTURE_LINEAR_NEAREST=12,da.TEXTURE_EXPLICIT_MODE=0,da.TEXTURE_SPHERICAL_MODE=1,da.TEXTURE_PLANAR_MODE=2,da.TEXTURE_CUBIC_MODE=3,da.TEXTURE_PROJECTION_MODE=4,da.TEXTURE_SKYBOX_MODE=5,da.TEXTURE_INVCUBIC_MODE=6,da.TEXTURE_EQUIRECTANGULAR_MODE=7,da.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,da.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,da.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,da.TEXTURE_FILTERING_QUALITY_HIGH=64,da.TEXTURE_FILTERING_QUALITY_MEDIUM=16,da.TEXTURE_FILTERING_QUALITY_LOW=8,da.SCALEMODE_FLOOR=1,da.SCALEMODE_NEAREST=2,da.SCALEMODE_CEILING=3,da.MATERIAL_TextureDirtyFlag=1,da.MATERIAL_LightDirtyFlag=2,da.MATERIAL_FresnelDirtyFlag=4,da.MATERIAL_AttributesDirtyFlag=8,da.MATERIAL_MiscDirtyFlag=16,da.MATERIAL_PrePassDirtyFlag=32,da.MATERIAL_AllDirtyFlag=63,da.MATERIAL_TriangleFillMode=0,da.MATERIAL_WireFrameFillMode=1,da.MATERIAL_PointFillMode=2,da.MATERIAL_PointListDrawMode=3,da.MATERIAL_LineListDrawMode=4,da.MATERIAL_LineLoopDrawMode=5,da.MATERIAL_LineStripDrawMode=6,da.MATERIAL_TriangleStripDrawMode=7,da.MATERIAL_TriangleFanDrawMode=8,da.MATERIAL_ClockWiseSideOrientation=0,da.MATERIAL_CounterClockWiseSideOrientation=1,da.ACTION_NothingTrigger=0,da.ACTION_OnPickTrigger=1,da.ACTION_OnLeftPickTrigger=2,da.ACTION_OnRightPickTrigger=3,da.ACTION_OnCenterPickTrigger=4,da.ACTION_OnPickDownTrigger=5,da.ACTION_OnDoublePickTrigger=6,da.ACTION_OnPickUpTrigger=7,da.ACTION_OnPickOutTrigger=16,da.ACTION_OnLongPressTrigger=8,da.ACTION_OnPointerOverTrigger=9,da.ACTION_OnPointerOutTrigger=10,da.ACTION_OnEveryFrameTrigger=11,da.ACTION_OnIntersectionEnterTrigger=12,da.ACTION_OnIntersectionExitTrigger=13,da.ACTION_OnKeyDownTrigger=14,da.ACTION_OnKeyUpTrigger=15,da.PARTICLES_BILLBOARDMODE_Y=2,da.PARTICLES_BILLBOARDMODE_ALL=7,da.PARTICLES_BILLBOARDMODE_STRETCHED=8,da.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,da.MESHES_CULLINGSTRATEGY_STANDARD=0,da.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,da.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,da.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,da.SCENELOADER_NO_LOGGING=0,da.SCENELOADER_MINIMAL_LOGGING=1,da.SCENELOADER_SUMMARY_LOGGING=2,da.SCENELOADER_DETAILED_LOGGING=3,da.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,da.PREPASS_POSITION_TEXTURE_TYPE=1,da.PREPASS_VELOCITY_TEXTURE_TYPE=2,da.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,da.PREPASS_COLOR_TEXTURE_TYPE=4,da.PREPASS_DEPTH_TEXTURE_TYPE=5,da.PREPASS_NORMAL_TEXTURE_TYPE=6,da.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,da.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,da.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,da.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,da.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,da.PREPASS_ALBEDO_TEXTURE_TYPE=12,da.BUFFER_CREATIONFLAG_READ=1,da.BUFFER_CREATIONFLAG_WRITE=2,da.BUFFER_CREATIONFLAG_READWRITE=3,da.BUFFER_CREATIONFLAG_UNIFORM=4,da.BUFFER_CREATIONFLAG_VERTEX=8,da.BUFFER_CREATIONFLAG_INDEX=16,da.BUFFER_CREATIONFLAG_STORAGE=32,da.BUFFER_CREATIONFLAG_INDIRECT=64,da.RENDERPASS_MAIN=0,da.INPUT_ALT_KEY=18,da.INPUT_CTRL_KEY=17,da.INPUT_META_KEY1=91,da.INPUT_META_KEY2=92,da.INPUT_META_KEY3=93,da.INPUT_SHIFT_KEY=16,da.SNAPSHOTRENDERING_STANDARD=0,da.SNAPSHOTRENDERING_FAST=1,da.PERSPECTIVE_CAMERA=0,da.ORTHOGRAPHIC_CAMERA=1,da.FOVMODE_VERTICAL_FIXED=0,da.FOVMODE_HORIZONTAL_FIXED=1,da.RIG_MODE_NONE=0,da.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,da.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,da.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,da.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,da.RIG_MODE_STEREOSCOPIC_INTERLACED=14,da.RIG_MODE_VR=20,da.RIG_MODE_CUSTOM=22,da.MAX_SUPPORTED_UV_SETS=6,da.GL_ALPHA_EQUATION_ADD=32774,da.GL_ALPHA_EQUATION_MIN=32775,da.GL_ALPHA_EQUATION_MAX=32776,da.GL_ALPHA_EQUATION_SUBTRACT=32778,da.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,da.GL_ALPHA_FUNCTION_SRC=768,da.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,da.GL_ALPHA_FUNCTION_SRC_ALPHA=770,da.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,da.GL_ALPHA_FUNCTION_DST_ALPHA=772,da.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,da.GL_ALPHA_FUNCTION_DST_COLOR=774,da.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,da.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,da.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,da.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,da.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,da.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,da.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,da.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,da.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,da.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,da.SnippetUrl="https://snippet.babylonjs.com",da.FOGMODE_NONE=0,da.FOGMODE_EXP=1,da.FOGMODE_EXP2=2,da.FOGMODE_LINEAR=3,da.BYTE=5120,da.UNSIGNED_BYTE=5121,da.SHORT=5122,da.UNSIGNED_SHORT=5123,da.INT=5124,da.UNSIGNED_INT=5125,da.FLOAT=5126,da.PositionKind="position",da.NormalKind="k",da.TangentKind="tangent",da.UVKind="uv",da.UV2Kind="uv2",da.UV3Kind="uv3",da.UV4Kind="uv4",da.UV5Kind="uv5",da.UV6Kind="uv6",da.ColorKind="color",da.ColorInstanceKind="instanceColor",da.MatricesIndicesKind="matricesIndices",da.MatricesWeightsKind="matricesWeights",da.MatricesIndicesExtraKind="matricesIndicesExtra",da.MatricesWeightsExtraKind="matricesWeightsExtra";class Ea{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:da.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(a,v){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ea._GetDefaultOptions(),...a},this._scene=v,this._scene._transmissionHelper=this,this.onErrorObservable=new F.c,this._scene.uj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(a){if(!Object.keys(a).filter((v=>this._options[v]!==a[v])).length)return;const v={...this._options,...a},p=this._options;this._options=v,v.renderSize===p.renderSize&&v.renderTargetTextureType===p.renderTargetTextureType&&v.generateMipmaps===p.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=v.samples,this._opaqueRenderTarget.lodGenerationScale=v.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=v.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(a){return!!a&&!!(a instanceof S&&a.subSurface.isRefractionEnabled)}_addMesh(a){this._materialObservers[a.uniqueId]=a.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),t.e.SetImmediate((()=>{this._shouldRenderAsTransmission(a.material)?(a.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(a)&&this._transparentMeshesCache.push(a)):-1===this._opaqueMeshesCache.indexOf(a)&&this._opaqueMeshesCache.push(a)}))}_removeMesh(a){a.onMaterialChangedObservable.remove(this._materialObservers[a.uniqueId]),delete this._materialObservers[a.uniqueId];let v=this._transparentMeshesCache.indexOf(a);-1!==v&&this._transparentMeshesCache.splice(v,1),v=this._opaqueMeshesCache.indexOf(a),-1!==v&&this._opaqueMeshesCache.splice(v,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(a){const v=this._transparentMeshesCache.indexOf(a),p=this._opaqueMeshesCache.indexOf(a);this._shouldRenderAsTransmission(a.material)?(a.material instanceof S&&(a.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==p?(this._opaqueMeshesCache.splice(p,1),this._transparentMeshesCache.push(a)):-1===v&&this._transparentMeshesCache.push(a)):-1!==v?(this._transparentMeshesCache.splice(v,1),this._opaqueMeshesCache.push(a)):-1===p&&this._opaqueMeshesCache.push(a)}_isRenderTargetValid(){var a;return null!==(null===(a=this._opaqueRenderTarget)||void 0===a?void 0:a.getInternalTexture())}_setupRenderTargets(){var a;let v,p;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ka.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(a=this._options.clearColor)||void 0===a?void 0:a.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((a=>{p=this._scene.environmentIntensity,this._scene.environmentIntensity=1,v=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?a.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(a.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=p,this._scene.imageProcessingConfiguration._applyByPostProcess=v})),this._transparentMeshesCache.forEach((a=>{this._shouldRenderAsTransmission(a.material)&&(a.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Wa="KHR_materials_transmission";class Ua{constructor(a){this.name=Wa,this.order=175,this._loader=a,this.enabled=this._loader.isExtensionUsed(Wa),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadTransparentPropertiesAsync(P,v,p,b)),Promise.all(L).then((()=>{}))}))}_loadTransparentPropertiesAsync(a,v,p,P){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const b=p;if(b.subSurface.isRefractionEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.useAlbedoToTintRefraction=!0,void 0===P.transmissionFactor)return b.subSurface.refractionIntensity=0,b.subSurface.isRefractionEnabled=!1,Promise.resolve();{var L;b.subSurface.refractionIntensity=P.transmissionFactor;const a=b.va();if(b.subSurface.refractionIntensity&&!a._transmissionHelper)new Ea({},b.va());else if(b.subSurface.refractionIntensity&&(null===(L=a._transmissionHelper)||void 0===L||!L._isRenderTargetValid())){var t;null===(t=a._transmissionHelper)||void 0===t||t._setupRenderTargets()}}return b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,P.transmissionTexture?(P.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/transmissionTexture`,P.transmissionTexture,void 0).then((a=>{a.name=`${p.name} (Transmission)`,b.subSurface.refractionIntensityTexture=a,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(Wa),d(Wa,!0,(a=>new Ua(a)));const Na="KHR_materials_diffuse_transmission";class ia{constructor(a){this.name=Na,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(Na),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadTranslucentPropertiesAsync(P,v,p,b)),Promise.all(L).then((()=>{}))}))}_loadTranslucentPropertiesAsync(a,v,p,P){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);const b=p;if(b.subSurface.isTranslucencyEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,b.subSurface.useAlbedoToTintTranslucency=!1,void 0===P.diffuseTransmissionFactor)return b.subSurface.translucencyIntensity=0,b.subSurface.isTranslucencyEnabled=!1,Promise.resolve();b.subSurface.translucencyIntensity=P.diffuseTransmissionFactor;const t=new Array;return b.subSurface.useGltfStyleTextures=!0,P.diffuseTransmissionTexture&&(P.diffuseTransmissionTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionTexture`,P.diffuseTransmissionTexture).then((a=>{a.name=`${p.name} (Diffuse Transmission)`,b.subSurface.translucencyIntensityTexture=a})))),void 0!==P.diffuseTransmissionColorFactor?b.subSurface.translucencyColor=L.d.bh(P.diffuseTransmissionColorFactor):b.subSurface.translucencyColor=L.d.White(),P.diffuseTransmissionColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionColorTexture`,P.diffuseTransmissionColorTexture).then((a=>{a.name=`${p.name} (Diffuse Transmission Color)`,b.subSurface.translucencyColorTexture=a}))),Promise.all(t).then((()=>{}))}}E(Na),d(Na,!0,(a=>new ia(a)));const Ia="KHR_materials_volume";class av{constructor(a){this.name=Ia,this.order=173,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ia),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadVolumePropertiesAsync(P,v,p,b)),Promise.all(L).then((()=>{}))}))}_loadVolumePropertiesAsync(a,v,p,P){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);if(!p.subSurface.isRefractionEnabled&&!p.subSurface.isTranslucencyEnabled||!P.thicknessFactor)return Promise.resolve();p.subSurface.volumeIndexOfRefraction=p.indexOfRefraction;const b=void 0!==P.attenuationDistance?P.attenuationDistance:Number.MAX_VALUE;return p.subSurface.tintColorAtDistance=b,void 0!==P.attenuationColor&&3==P.attenuationColor.length&&p.subSurface.tintColor.qe(P.attenuationColor[0],P.attenuationColor[1],P.attenuationColor[2]),p.subSurface.minimumThickness=0,p.subSurface.maximumThickness=P.thicknessFactor,p.subSurface.useThicknessAsDepth=!0,P.thicknessTexture?(P.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/thicknessTexture`,P.thicknessTexture).then((a=>{a.name=`${p.name} (Thickness)`,p.subSurface.thicknessTexture=a,p.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(Ia),d(Ia,!0,(a=>new av(a)));const vv="KHR_materials_dispersion";class pv{constructor(a){this.name=vv,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(vv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=new Array;return L.push(this._loader.loadMaterialPropertiesAsync(a,v,p)),L.push(this._loadDispersionPropertiesAsync(P,v,p,b)),Promise.all(L).then((()=>{}))}))}_loadDispersionPropertiesAsync(a,v,p,P){if(!(p instanceof S))throw new Error(`${a}: Material type not supported`);return p.subSurface.isRefractionEnabled&&P.dispersion?(p.subSurface.isDispersionEnabled=!0,p.subSurface.dispersion=P.dispersion,Promise.resolve()):Promise.resolve()}}E(vv),d(vv,!0,(a=>new pv(a)));const Pv="KHR_mesh_quantization";class bv{constructor(a){this.name=Pv,this.enabled=a.isExtensionUsed(Pv)}dispose(){}}E(Pv),d(Pv,!0,(a=>new bv(a)));const Lv="KHR_texture_basisu";class tv{constructor(a){this.name=Lv,this._loader=a,this.enabled=a.isExtensionUsed(Lv)}dispose(){this._loader=null}_loadTextureAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>{const L=void 0==v.sampler?N.DefaultSampler:U.Get(`${a}/sampler`,this._loader.Zi.samplers,v.sampler),t=U.Get(`${P}/source`,this._loader.Zi.images,b.source);return this._loader._createTextureAsync(a,L,t,(a=>{p(a)}),v._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!v._textureInfo.nonColorData)}))}}E(Lv),d(Lv,!0,(a=>new tv(a)));const Vv="KHR_texture_transform";class Kv{constructor(a){this.name=Vv,this._loader=a,this.enabled=this._loader.isExtensionUsed(Vv)}dispose(){this._loader=null}loadTextureInfoAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((P,b)=>this._loader.loadTextureInfoAsync(a,v,(a=>{if(!(a instanceof n.c))throw new Error(`${P}: Texture type not supported`);b.offset&&(a.uOffset=b.offset[0],a.vOffset=b.offset[1]),a.uRotationCenter=0,a.vRotationCenter=0,b.rotation&&(a.wAng=-b.rotation),b.scale&&(a.uScale=b.scale[0],a.vScale=b.scale[1]),void 0!=b.texCoord&&(a.coordinatesIndex=b.texCoord),p(a)}))))}}E(Vv),d(Vv,!0,(a=>new Kv(a)));const Cv="KHR_xmp_json_ld";class Fv{constructor(a){this.name=Cv,this.order=100,this._loader=a,this.enabled=this._loader.isExtensionUsed(Cv)}dispose(){this._loader=null}onLoading(){var a,v,p;if(null===this._loader.rootBabylonMesh)return;const P=null===(a=this._loader.Zi.extensions)||void 0===a?void 0:a.KHR_xmp_json_ld,b=null===(v=this._loader.Zi.asset)||void 0===v||null===(p=v.extensions)||void 0===p?void 0:p.KHR_xmp_json_ld;if(P&&b){const a=+b.packet;P.packets&&a<P.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=P.packets[a])}}}function uv(a,v,p,P){return L.d.bh(v,p).scale(P)}function cv(a,v,p,P){return v[p]*P}function fv(a,v,p,P){return-v[p]*P}function Hv(a,v,p,P){return v[p+1]*P}function Av(a,v,p,P){return v[p]*P*2}function hv(a){return{scale:[new Xv(c.d.ANIMATIONTYPE_FLOAT,`${a}.uScale`,cv,(()=>2)),new Xv(c.d.ANIMATIONTYPE_FLOAT,`${a}.vScale`,Hv,(()=>2))],offset:[new Xv(c.d.ANIMATIONTYPE_FLOAT,`${a}.uOffset`,cv,(()=>2)),new Xv(c.d.ANIMATIONTYPE_FLOAT,`${a}.vOffset`,Hv,(()=>2))],rotation:[new Xv(c.d.ANIMATIONTYPE_FLOAT,`${a}.wAng`,fv,(()=>1))]}}E(Cv),d(Cv,!0,(a=>new Fv(a)));class Rv extends z{buildAnimations(a,v,p,P,b){b(a._babylonCamera,this._buildAnimation(v,p,P))}}class Xv extends z{buildAnimations(a,v,p,P,b){for(const L in a._data)b(a._data[L].babylonMaterial,this._buildAnimation(v,p,P))}}class Qv extends z{buildAnimations(a,v,p,P,b){b(a._babylonLight,this._buildAnimation(v,p,P))}}const sv={__array__:{__target__:!0,...G}},Dv={__array__:{__target__:!0,orthographic:{xmag:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"orthoLeft",fv,(()=>1)),new Rv(c.d.ANIMATIONTYPE_FLOAT,"orthoRight",Hv,(()=>1))],ymag:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"orthoBottom",fv,(()=>1)),new Rv(c.d.ANIMATIONTYPE_FLOAT,"orthoTop",Hv,(()=>1))],zfar:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"maxZ",cv,(()=>1))],znear:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"fj",cv,(()=>1))]},perspective:{yfov:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"fov",cv,(()=>1))],zfar:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"maxZ",cv,(()=>1))],znear:[new Rv(c.d.ANIMATIONTYPE_FLOAT,"fj",cv,(()=>1))]}}},yv={nodes:sv,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"albedoColor",uv,(()=>4)),new Xv(c.d.ANIMATIONTYPE_FLOAT,"alpha",(function(a,v,p,P){return v[p+3]*P}),(()=>4))],metallicFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"metallic",cv,(()=>1))],roughnessFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"roughness",cv,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:hv("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:hv("metallicTexture")}}},emissiveFactor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"emissiveColor",uv,(()=>3))],normalTexture:{scale:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cv,(()=>1))],extensions:{KHR_texture_transform:hv("bumpTexture")}},occlusionTexture:{strength:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cv,(()=>1))],extensions:{KHR_texture_transform:hv("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:hv("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cv,(()=>1))],anisotropyRotation:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cv,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:hv("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cv,(()=>1))],clearcoatRoughnessFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cv,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:hv("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cv,(()=>1))],extensions:{KHR_texture_transform:hv("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:hv("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cv,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cv,(()=>1))]},KHR_materials_ior:{ior:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cv,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cv,(()=>1))],iridescenceIor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cv,(()=>1))],iridescenceThicknessMinimum:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cv,(()=>1))],iridescenceThicknessMaximum:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cv,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:hv("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:hv("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"sheen.color",uv,(()=>3))],sheenRoughnessFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",cv,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:hv("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:hv("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cv,(()=>1))],specularColorFactor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",uv,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:hv("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:hv("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cv,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:hv("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",uv,(()=>3))],attenuationDistance:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cv,(()=>1))],thicknessFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cv,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:hv("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Xv(c.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cv,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:hv("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Xv(c.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",uv,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:hv("subSurface.translucencyColorTexture")}}}}}},cameras:Dv,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Qv(c.d.ANIMATIONTYPE_COLOR3,"diffuse",uv,(()=>3))],jj:[new Qv(c.d.ANIMATIONTYPE_FLOAT,"intensity",cv,(()=>1))],range:[new Qv(c.d.ANIMATIONTYPE_FLOAT,"range",cv,(()=>1))],spot:{innerConeAngle:[new Qv(c.d.ANIMATIONTYPE_FLOAT,"innerAngle",Av,(()=>1))],outerConeAngle:[new Qv(c.d.ANIMATIONTYPE_FLOAT,"angle",Av,(()=>1))]}}}}}};class Zv{constructor(a,v){this._gltf=a,this._infoTree=v}convert(a){let v,p=this._gltf,P=this._infoTree;if(!a.startsWith("/"))throw new Error("Path must start with a /");const b=a.split("/");b.shift();for(const L of b){if(P.__array__)P=P.__array__;else if(P=P[L],!P)throw new Error(`Path ${a} is invalid`);if(void 0===p)throw new Error(`Path ${a} is invalid`);p=p[L],P.__target__&&(v=p)}return{object:v,info:P}}}const Mv="KHR_animation_pointer";class Sv extends Zv{constructor(a){super(a,yv)}}class nv{constructor(a){this.name=Mv,this._loader=a,this._pathToObjectConverter=new Sv(this._loader.Zi)}get enabled(){return this._loader.isExtensionUsed(Mv)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(a,v,p,P,b){var L;const t=null===(L=P.target.extensions)||void 0===L?void 0:L.KHR_animation_pointer;if(!t||!this._pathToObjectConverter)return null;"pointer"!==P.target.path&&A.d.Warn(`${a}/target/path: Value (${P.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=P.target.node&&A.d.Warn(`${a}/target/node: Value (${P.target.node}) must not be present when using the ${this.name} extension`);const V=`${a}/extensions/${this.name}`,K=t.pointer;if(!K)throw new Error(`${V}: Pointer is missing`);try{const L=this._pathToObjectConverter.convert(K);return this._loader._loadAnimationChannelFromTargetInfoAsync(a,v,p,P,L,b)}catch(C){return A.d.Warn(`${V}/pointer: Invalid pointer (${K}) skipped`),null}}}E(Mv),d(Mv,!0,(a=>new nv(a)));class qv{constructor(a,v,p){this.frame=a,this.action=v,this.onlyOnce=p,this.isDone=!1}_clone(){return new qv(this.frame,this.action,this.onlyOnce)}}var Tv=p(10926),jv=p(10974);class wv{get loop(){return this._loop}set loop(a){a!==this._loop&&(this._loop=a,this.updateOptions({loop:a}))}get currentTime(){var a;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(a=jv.e.audioEngine)&&void 0!==a&&a.audioContext&&(this.isPlaying||this.isPaused)){const a=this.isPaused?0:jv.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+a}return 0}get spatialSound(){return this._spatialSound}set spatialSound(a){if(a==this._spatialSound)return;const v=this.isPlaying;this.pause(),a?(this._spatialSound=a,this._updateSpatialParameters()):this._disableSpatialSound(),v&&this.play()}constructor(a,v,p){var P;let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new F.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=b.s.Zero(),this._localDirection=new b.s(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=a,p=p||H.b.LastCreatedScene)if(this._scene=p,wv._SceneComponentInitialization(p),this._readyToPlayCallback=L,this._customAttenuationFunction=(a,v,p,P,b)=>v<p?a*(1-v/p):0,V&&(this.autoplay=V.autoplay||!1,this._loop=V.loop||!1,void 0!==V.volume&&(this._volume=V.volume),this._spatialSound=V.spatialSound??!1,this.maxDistance=V.maxDistance??100,this.useCustomAttenuation=V.useCustomAttenuation??!1,this.rolloffFactor=V.rolloffFactor||1,this.refDistance=V.refDistance||1,this.distanceModel=V.distanceModel||"linear",this._playbackRate=V.playbackRate||1,this._streaming=V.streaming??!1,this._length=V.length,this._offset=V.offset),null!==(P=jv.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&jv.e.audioEngine.audioContext){this._soundGain=jv.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let a=!0;if(v)try{"string"===typeof v?(this._urlType="String",this._url=v):v instanceof ArrayBuffer?this._urlType="ArrayBuffer":v instanceof HTMLMediaElement?this._urlType="MediaElement":v instanceof MediaStream?this._urlType="MediaStream":v instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(v)&&(this._urlType="Array");let p=[],P=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=jv.e.audioEngine.audioContext.createMediaElementSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=jv.e.audioEngine.audioContext.createMediaStreamSource(v),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":v.byteLength>0&&(P=!0,this._soundLoaded(v));break;case"AudioBuffer":this._audioBufferLoaded(v);break;case"String":p.push(v);case"Array":0===p.length&&(p=v);for(let a=0;a<p.length;a++){const v=p[a];if(P=V&&V.skipCodecCheck||-1!==v.indexOf(".mp3",v.length-4)&&jv.e.audioEngine.isMP3supported||-1!==v.indexOf(".ogg",v.length-4)&&jv.e.audioEngine.isOGGsupported||-1!==v.indexOf(".wav",v.length-4)||-1!==v.indexOf(".m4a",v.length-4)||-1!==v.indexOf(".mp4",v.length-4)||-1!==v.indexOf("blob:"),P){this._streaming?(this._htmlAudioElement=new Audio(v),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,t.e.SetCorsBehavior(v,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(v,(a=>{this._soundLoaded(a)}),void 0,!0,!0,(a=>{a&&A.d.Error("XHR "+a.status+" error on: "+v+"."),A.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:a=!1}a?P||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):A.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(K){A.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),jv.e.audioEngine&&!jv.e.audioEngine.WarnedWebAudioUnsupported&&(A.d.Error("Web Audio is not supported by your browser."),jv.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var a;null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(a){var v;null!==(v=jv.e.audioEngine)&&void 0!==v&&v.audioContext&&(this._audioBuffer=a,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(a){var v;null!==(v=jv.e.audioEngine)&&void 0!==v&&v.audioContext&&jv.e.audioEngine.audioContext.decodeAudioData(a,(a=>{this._audioBufferLoaded(a)}),(a=>{A.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+a)}))}setAudioBuffer(a){var v;null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this._audioBuffer=a,this._isReadyToPlay=!0)}updateOptions(a){a&&(this.loop=a.loop??this.loop,this.maxDistance=a.maxDistance??this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor??this.rolloffFactor,this.refDistance=a.refDistance??this.refDistance,this.distanceModel=a.distanceModel??this.distanceModel,this._playbackRate=a.playbackRate??this._playbackRate,this._length=a.length??void 0,this.spatialSound=a.spatialSound??this._spatialSound,this._setOffset(a.offset??void 0),this.setVolume(a.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var a;null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&jv.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??jv.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var a;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(a=this._soundPanner)||void 0===a||a.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var a;null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(a){var v;null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(a),this._isOutputConnected=!0)}setDirectionalCone(a,v,p){v<a?A.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=a,this._coneOuterAngle=v,this._coneOuterGain=p,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!=this._coneInnerAngle){var v;if(this._coneOuterAngle<a)return void A.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a,null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!=this._coneOuterAngle){var v;if(a<this._coneInnerAngle)return void A.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a,null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(a){var v;a.equals(this._position)||(this._position.p(a),null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(a){var v;this._localDirection=a,null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const a=this._connectedTransformNode.getWorldMatrix(),v=b.s.TransformNormal(this._localDirection,a);v.normalize(),this._soundPanner.orientationX.value=v.x,this._soundPanner.orientationY.value=v.y,this._soundPanner.orientationZ.value=v.z}updateDistanceFromListener(){var a;if(null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const a=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.od(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,a,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(a){this._customAttenuationFunction=a}play(a,v,p){var P;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(P=jv.e.audioEngine)&&void 0!==P&&P.audioContext)try{var b,L;this._clearTimeoutsAndObservers();let P=a?(null===(b=jv.e.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+a:null===(L=jv.e.audioEngine)||void 0===L?void 0:L.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=jv.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const a=()=>{var p;if(null!==(p=jv.e.audioEngine)&&void 0!==p&&p.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=v??0;const p=this._htmlAudioElement.play();void 0!==p&&p.catch((()=>{var v,p;(null===(v=jv.e.audioEngine)||void 0===v||v.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(p=jv.e.audioEngine)||void 0===p?void 0:p.onAudioUnlockedObservable.addOnce((()=>{a()})))}))}else{var P;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(P=jv.e.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{a()}))}};a()}}else{var t;const b=()=>{var b;if(null!==(b=jv.e.audioEngine)&&void 0!==b&&b.audioContext){var L;if(p=p||this._length,void 0!==v&&this._setOffset(v),this._soundSource){const a=this._soundSource;a.onended=()=>{a.disconnect()}}if(this._soundSource=null===(L=jv.e.audioEngine)||void 0===L?void 0:L.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var t;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==v&&(this._soundSource.loopStart=v),void 0!==p&&(this._soundSource.loopEnd=(0|v)+p),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},P=a?(null===(t=jv.e.audioEngine)||void 0===t?void 0:t.audioContext.currentTime)+a:jv.e.audioEngine.audioContext.currentTime;const b=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(P,b,this.loop?void 0:p)}}};"suspended"===(null===(t=jv.e.audioEngine)||void 0===t?void 0:t.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var a;"suspended"===(null===(a=jv.e.audioEngine)||void 0===a?void 0:a.audioContext.state)?(jv.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=jv.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{b()})))):b()}),500):b()}this._startTime=P,this.isPlaying=!0,this.isPaused=!1}catch(V){A.d.Error("Error while trying to play audio: "+this.name+", "+V.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(a){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1}else if(null!==(v=jv.e.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource){const v=a?jv.e.audioEngine.audioContext.currentTime+a:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(v)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var v;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(v=this._streamingSource)||void 0===v||v.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(a=jv.e.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=jv.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(a,v){var p;null!==(p=jv.e.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._soundGain&&(v&&jv.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(jv.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,jv.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(a,jv.e.audioEngine.audioContext.currentTime+v)):this._soundGain.gain.value=a),this._volume=a}setPlaybackRate(a){this._playbackRate=a,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(a){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=a,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=a=>this._onRegisterAfterWorldMatrixUpdate(a),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(a){var v;if(a.getBoundingInfo){const v=a.getBoundingInfo();this.setPosition(v.boundingSphere.centerWorld)}else this.setPosition(a.absolutePosition);null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const a=()=>{this._isReadyToPlay?(p._audioBuffer=this.getAudioBuffer(),p._isReadyToPlay=!0,p.autoplay&&p.play(0,this._offset,this._length)):setTimeout(a,300)},v={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},p=new wv(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,v);return this.useCustomAttenuation&&p.setAttenuationFunction(this._customAttenuationFunction),p.setPosition(this._position),p.setPlaybackRate(this._playbackRate),a(),p}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const a={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(a.connectedMeshId=this._connectedTransformNode.id),a.position=this._position.tj(),a.refDistance=this.refDistance,a.distanceModel=this.distanceModel,a.isDirectional=this._isDirectional,a.localDirectionToMesh=this._localDirection.tj(),a.coneInnerAngle=this._coneInnerAngle,a.coneOuterAngle=this._coneOuterAngle,a.coneOuterGain=this._coneOuterGain),a}static Parse(a,v,p,P){const L=a.name;let t;t=a.url?p+a.url:p+L;const V={autoplay:a.autoplay,loop:a.loop,volume:a.volume,spatialSound:a.spatialSound,maxDistance:a.maxDistance,rolloffFactor:a.rolloffFactor,refDistance:a.refDistance,distanceModel:a.distanceModel,playbackRate:a.playbackRate};let K;if(P){const a=()=>{P._isReadyToPlay?(K._audioBuffer=P.getAudioBuffer(),K._isReadyToPlay=!0,K.autoplay&&K.play(0,K._offset,K._length)):setTimeout(a,300)};K=new wv(L,new ArrayBuffer(0),v,null,V),a()}else K=new wv(L,t,v,(()=>{v.removePendingData(K)}),V),v.addPendingData(K);if(a.position){const v=b.s.bh(a.position);K.setPosition(v)}if(a.isDirectional&&(K.setDirectionalCone(a.coneInnerAngle||360,a.coneOuterAngle||360,a.coneOuterGain||0),a.localDirectionToMesh)){const v=b.s.bh(a.localDirectionToMesh);K.setLocalDirectionToMesh(v)}if(a.connectedMeshId){const p=v.getMeshById(a.connectedMeshId);p&&K.attachToMesh(p)}return a.metadata&&(K.metadata=a.metadata),K}_setOffset(a){this._offset!==a&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=a)}_clearTimeoutsAndObservers(){var a;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(a=jv.e.audioEngine)||void 0===a||a.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}wv._SceneComponentInitialization=a=>{throw(0,Tv.c)("AudioSceneComponent")},(0,Z.f)("BABYLON.Sound",wv);class Jv{constructor(a,v,p){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],v.length!==p.length)throw new Error("Sounds length does not equal weights length");this.loop=a,this._weights=p;let P=0;for(const L of p)P+=L;const b=P>0?1/P:0;for(let L=0;L<this._weights.length;L++)this._weights[L]*=b;this._sounds=v;for(const L of this._sounds)L.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!==this._coneInnerAngle){if(this._coneOuterAngle<a)return void A.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a;for(const v of this._sounds)v.directionalConeInnerAngle=a}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!==this._coneOuterAngle){if(a<this._coneInnerAngle)return void A.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a;for(const v of this._sounds)v.directionalConeOuterAngle=a}}get volume(){return this._volume}set volume(a){if(a!==this._volume)for(const v of this._sounds)v.setVolume(a)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(a){if(!this.isPaused){this.stop();const a=Math.random();let v=0;for(let p=0;p<this._weights.length;p++)if(v+=this._weights[p],a<=v){this._currentIndex=p;break}}const v=this._sounds[this._currentIndex??0];v.isReady()?v.play(0,this.isPaused?void 0:a):v.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Bv{constructor(a){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(a=a||H.b.LastCreatedScene)&&(this._scene=a,this.soundCollection=[],this._options=v,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var a;null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio&&jv.e.audioEngine.audioContext&&(this._outputAudioNode=jv.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(jv.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(jv.e.audioEngine&&jv.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(a){var v;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&a.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==a.soundTrackId&&(-1===a.soundTrackId?this._scene.mainSoundTrack.removeSound(a):this._scene.soundTracks&&this._scene.soundTracks[a.soundTrackId].removeSound(a)),this.soundCollection.push(a),a.soundTrackId=this.id}removeSound(a){const v=this.soundCollection.indexOf(a);-1!==v&&this.soundCollection.splice(v,1)}setVolume(a){var v;null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=a)}switchPanningModelToHRTF(){var a;if(null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var a;if(null!==(a=jv.e.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let v=0;v<this.soundCollection.length;v++)this.soundCollection[v].switchPanningModelToEqualPower()}connectToAnalyser(a){var v;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=a,null!==(v=jv.e.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,jv.e.audioEngine.masterGain))}}var xv=p(11332),rv=p(11229),ov=(p(11778),p(10920));(0,p(11837).d)(xv.c.NAME_AUDIO,((a,v,p,P)=>{let b,L=[];if(p.kk=p.kk||[],void 0!==a.kk&&null!==a.kk)for(let V=0,K=a.kk.length;V<K;V++){var t;const K=a.kk[V];null!==(t=jv.e.audioEngine)&&void 0!==t&&t.canUseWebAudio?(K.url||(K.url=K.name),L[K.url]?p.kk.push(wv.Parse(K,v,P,L[K.url])):(b=wv.Parse(K,v,P),L[K.url]=b,p.kk.push(b))):p.kk.push(new wv(K.name,null,v))}L=[]})),Object.defineProperty(rv.c.prototype,"mainSoundTrack",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),this._mainSoundTrack||(this._mainSoundTrack=new Bv(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),rv.c.prototype.getSoundByName=function(a){let v;for(v=0;v<this.mainSoundTrack.soundCollection.length;v++)if(this.mainSoundTrack.soundCollection[v].name===a)return this.mainSoundTrack.soundCollection[v];if(this.soundTracks)for(let p=0;p<this.soundTracks.length;p++)for(v=0;v<this.soundTracks[p].soundCollection.length;v++)if(this.soundTracks[p].soundCollection[v].name===a)return this.soundTracks[p].soundCollection[v];return null},Object.defineProperty(rv.c.prototype,"audioEnabled",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),a.audioEnabled},set:function(a){let v=this._getComponent(xv.c.NAME_AUDIO);v||(v=new mv(this),this.o(v)),a?v.enableAudio():v.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(rv.c.prototype,"headphone",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),a.headphone},set:function(a){let v=this._getComponent(xv.c.NAME_AUDIO);v||(v=new mv(this),this.o(v)),a?v.switchAudioModeForHeadphones():v.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(rv.c.prototype,"audioListenerPositionProvider",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),a.audioListenerPositionProvider},set:function(a){let v=this._getComponent(xv.c.NAME_AUDIO);if(v||(v=new mv(this),this.o(v)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");v.audioListenerPositionProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(rv.c.prototype,"audioListenerRotationProvider",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),a.audioListenerRotationProvider},set:function(a){let v=this._getComponent(xv.c.NAME_AUDIO);if(v||(v=new mv(this),this.o(v)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");v.audioListenerRotationProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(rv.c.prototype,"audioPositioningRefreshRate",{get:function(){let a=this._getComponent(xv.c.NAME_AUDIO);return a||(a=new mv(this),this.o(a)),a.audioPositioningRefreshRate},set:function(a){let v=this._getComponent(xv.c.NAME_AUDIO);v||(v=new mv(this),this.o(v)),v.audioPositioningRefreshRate=a},enumerable:!0,configurable:!0});class mv{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(a){this.name=xv.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new b.s,this._cachedCameraPosition=new b.s,this._lastCheck=0,this._invertMatrixTemp=new b.e,this._cameraDirectionTemp=new b.s,(a=a||H.b.LastCreatedScene)&&(this.sd=a,a.soundTracks=[],a.kk=[])}register(){this.sd._afterRenderStage.registerStep(xv.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(a){if(a.kk=[],this.sd.soundTracks)for(let v=0;v<this.sd.soundTracks.length;v++){const p=this.sd.soundTracks[v];for(let v=0;v<p.soundCollection.length;v++)a.kk.push(p.soundCollection[v].serialize())}}addFromContainer(a){a.kk&&a.kk.forEach((a=>{a.play(),a.autoplay=!0,this.sd.mainSoundTrack.addSound(a)}))}removeFromContainer(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.kk&&a.kk.forEach((a=>{a.stop(),a.autoplay=!1,this.sd.mainSoundTrack.removeSound(a),v&&a.dispose()}))}dispose(){const a=this.sd;if(a._mainSoundTrack&&a.mainSoundTrack.dispose(),a.soundTracks)for(let v=0;v<a.soundTracks.length;v++)a.soundTracks[v].dispose()}disableAudio(){const a=this.sd;let v;for(this._audioEnabled=!1,jv.e.audioEngine&&jv.e.audioEngine.audioContext&&jv.e.audioEngine.audioContext.suspend(),v=0;v<a.mainSoundTrack.soundCollection.length;v++)a.mainSoundTrack.soundCollection[v].pause();if(a.soundTracks)for(v=0;v<a.soundTracks.length;v++)for(let p=0;p<a.soundTracks[v].soundCollection.length;p++)a.soundTracks[v].soundCollection[p].pause()}enableAudio(){const a=this.sd;let v;for(this._audioEnabled=!0,jv.e.audioEngine&&jv.e.audioEngine.audioContext&&jv.e.audioEngine.audioContext.resume(),v=0;v<a.mainSoundTrack.soundCollection.length;v++)a.mainSoundTrack.soundCollection[v].isPaused&&a.mainSoundTrack.soundCollection[v].play();if(a.soundTracks)for(v=0;v<a.soundTracks.length;v++)for(let p=0;p<a.soundTracks[v].soundCollection.length;p++)a.soundTracks[v].soundCollection[p].isPaused&&a.soundTracks[v].soundCollection[p].play()}switchAudioModeForHeadphones(){const a=this.sd;if(this._headphone=!0,a.mainSoundTrack.switchPanningModelToHRTF(),a.soundTracks)for(let v=0;v<a.soundTracks.length;v++)a.soundTracks[v].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const a=this.sd;if(this._headphone=!1,a.mainSoundTrack.switchPanningModelToEqualPower(),a.soundTracks)for(let v=0;v<a.soundTracks.length;v++)a.soundTracks[v].switchPanningModelToEqualPower()}_afterRender(){const a=ov.b.Now;if(this._lastCheck&&a-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=a;const v=this.sd;if(!this._audioEnabled||!v._mainSoundTrack||!v.soundTracks||0===v._mainSoundTrack.soundCollection.length&&1===v.soundTracks.length)return;const p=jv.e.audioEngine;if(p&&p.audioContext){let a,P=v.activeCamera;if(v.activeCameras&&v.activeCameras.length>0&&(P=v.activeCameras[0]),this.audioListenerPositionProvider){const a=this.audioListenerPositionProvider();p.audioContext.listener.setPosition(a.x||0,a.y||0,a.z||0)}else P?this._cachedCameraPosition.equals(P.globalPosition)||(this._cachedCameraPosition.p(P.globalPosition),p.audioContext.listener.setPosition(P.globalPosition.x,P.globalPosition.y,P.globalPosition.z)):p.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const a=this.audioListenerRotationProvider();p.audioContext.listener.setOrientation(a.x||0,a.y||0,a.z||0,0,1,0)}else P?(P.rigCameras&&P.rigCameras.length>0&&(P=P.rigCameras[0]),P.getViewMatrix().invertToRef(this._invertMatrixTemp),b.s.TransformNormalToRef(mv._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),p.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):p.audioContext.listener.setOrientation(0,0,0,0,1,0);for(a=0;a<v.mainSoundTrack.soundCollection.length;a++){const p=v.mainSoundTrack.soundCollection[a];p.useCustomAttenuation&&p.updateDistanceFromListener()}if(v.soundTracks)for(a=0;a<v.soundTracks.length;a++)for(let p=0;p<v.soundTracks[a].soundCollection.length;p++){const P=v.soundTracks[a].soundCollection[p];P.useCustomAttenuation&&P.updateDistanceFromListener()}}}}mv._CameraDirection=new b.s(0,0,-1),wv._SceneComponentInitialization=a=>{let v=a._getComponent(xv.c.NAME_AUDIO);v||(v=new mv(a),a.o(v))};const Ov="MSFT_audio_emitter";class Yv{constructor(a){this.name=Ov,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ov)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const a=this._loader.Zi.extensions;if(a&&a[this.name]){const v=a[this.name];this._clips=v.clips,this._emitters=v.emitters,U.Assign(this._clips),U.Assign(this._emitters)}}loadSceneAsync(a,v){return N.LoadExtensionAsync(a,v,this.name,((p,P)=>{const b=new Array;b.push(this._loader.loadSceneAsync(a,v));for(const a of P.emitters){const v=U.Get(`${p}/emitters`,this._emitters,a);if(void 0!=v.refDistance||void 0!=v.maxDistance||void 0!=v.rolloffFactor||void 0!=v.distanceModel||void 0!=v.innerAngle||void 0!=v.outerAngle)throw new Error(`${p}: Direction or Distance properties are not allowed on emitters attached to a scene`);b.push(this._loadEmitterAsync(`${p}/emitters/${v.index}`,v))}return Promise.all(b).then((()=>{}))}))}loadNodeAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((a,P)=>{const L=new Array;return this._loader.loadNodeAsync(a,v,(v=>{for(const p of P.emitters){const P=U.Get(`${a}/emitters`,this._emitters,p);L.push(this._loadEmitterAsync(`${a}/emitters/${P.index}`,P).then((()=>{for(const a of P._babylonSounds)a.attachToMesh(v),void 0==P.innerAngle&&void 0==P.outerAngle||(a.setLocalDirectionToMesh(b.s.Forward()),a.setDirectionalCone(2*t.e.ToDegrees(void 0==P.innerAngle?Math.PI:P.innerAngle),2*t.e.ToDegrees(void 0==P.outerAngle?Math.PI:P.outerAngle),0))})))}p(v)})).then((a=>Promise.all(L).then((()=>a))))}))}loadAnimationAsync(a,v){return N.LoadExtensionAsync(a,v,this.name,((p,P)=>this._loader.loadAnimationAsync(a,v).then((b=>{const L=new Array;U.Assign(P.events);for(const t of P.events)L.push(this._loadAnimationEventAsync(`${p}/events/${t.index}`,a,v,t,b));return Promise.all(L).then((()=>b))}))))}_loadClipAsync(a,v){if(v._objectURL)return v._objectURL;let p;if(v.uri)p=this._loader.loadUriAsync(a,v,v.uri);else{const P=U.Get(`${a}/bufferView`,this._loader.Zi.bufferViews,v.bufferView);p=this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}return v._objectURL=p.then((a=>URL.createObjectURL(new Blob([a],{type:v.mimeType})))),v._objectURL}_loadEmitterAsync(a,v){if(v._babylonSounds=v._babylonSounds||[],!v._babylonData){const a=new Array,p=v.name||`emitter${v.index}`,P={loop:!1,autoplay:!1,volume:void 0==v.volume?1:v.volume};for(let L=0;L<v.clips.length;L++){const b=`/extensions/${this.name}/clips`,t=U.Get(b,this._clips,v.clips[L].clip);a.push(this._loadClipAsync(`${b}/${v.clips[L].clip}`,t).then((a=>{const b=v._babylonSounds[L]=new wv(p,a,this._loader.babylonScene,null,P);b.refDistance=v.refDistance||1,b.maxDistance=v.maxDistance||256,b.rolloffFactor=v.rolloffFactor||1,b.distanceModel=v.distanceModel||"exponential"})))}const b=Promise.all(a).then((()=>{const a=v.clips.map((a=>a.weight||1)),p=new Jv(v.loop||!1,v._babylonSounds,a);v.innerAngle&&(p.directionalConeInnerAngle=2*t.e.ToDegrees(v.innerAngle)),v.outerAngle&&(p.directionalConeOuterAngle=2*t.e.ToDegrees(v.outerAngle)),v.volume&&(p.volume=v.volume),v._babylonData.sound=p}));v._babylonData={loaded:b}}return v._babylonData.loaded}_getEventAction(a,v,p,P,b){switch(p){case"play":return a=>{const p=(b||0)+(a-P);v.play(p)};case"stop":return()=>{v.stop()};case"pause":return()=>{v.pause()};default:throw new Error(`${a}: Unsupported action ${p}`)}}_loadAnimationEventAsync(a,v,p,P,b){if(0==b.targetedAnimations.length)return Promise.resolve();const L=b.targetedAnimations[0],t=P.j,V=U.Get(`/extensions/${this.name}/emitters`,this._emitters,t);return this._loadEmitterAsync(a,V).then((()=>{const v=V._babylonData.sound;if(v){const p=new qv(P.time,this._getEventAction(a,v,P.action,P.time,P.startOffset));L.animation.addEvent(p),b.onAnimationGroupEndObservable.add((()=>{v.stop()})),b.onAnimationGroupPauseObservable.add((()=>{v.pause()}))}}))}}E(Ov),d(Ov,!0,(a=>new Yv(a)));const lv="MSFT_lod";class zv{constructor(a){var v;this.name=lv,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new F.c,this.onMaterialLODsLoadedObservable=new F.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=a,this.maxLODsToLoad=(null===(v=this._loader.parent.extensionOptions[lv])||void 0===v?void 0:v.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(lv)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let a=0;a<this._nodePromiseLODs.length;a++){const v=Promise.all(this._nodePromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Node LOD ${a}`),this._loader.log(`Loaded node LOD ${a}`)),this.onNodeLODsLoadedObservable.notifyObservers(a),a!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${a+1}`),this._loadBufferLOD(this._nodeBufferLODs,a+1),this._nodeSignalLODs[a]&&this._nodeSignalLODs[a].resolve())}));this._loader._completePromises.push(v)}for(let a=0;a<this._materialPromiseLODs.length;a++){const v=Promise.all(this._materialPromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Material LOD ${a}`),this._loader.log(`Loaded material LOD ${a}`)),this.onMaterialLODsLoadedObservable.notifyObservers(a),a!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${a+1}`),this._loadBufferLOD(this._materialBufferLODs,a+1),this._materialSignalLODs[a]&&this._materialSignalLODs[a].resolve())}));this._loader._completePromises.push(v)}}loadSceneAsync(a,v){const p=this._loader.loadSceneAsync(a,v);return this._loadBufferLOD(this._bufferLODs,0),p}loadNodeAsync(a,v,p){return N.LoadExtensionAsync(a,v,this.name,((a,b)=>{let L;const t=this._getLODs(a,v,this._loader.Zi.nodes,b.ids);this._loader.logOpen(`${a}`);for(let v=0;v<t.length;v++){const a=t[v];0!==v&&(this._nodeIndexLOD=v,this._nodeSignalLODs[v]=this._nodeSignalLODs[v]||new P);const b=a=>{p(a),a.Mb(!1)},V=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,b).then((a=>{if(0!==v){const a=t[v-1];a._babylonTransformNode&&(this._disposeTransformNode(a._babylonTransformNode),delete a._babylonTransformNode)}return a.Mb(!0),a}));this._nodePromiseLODs[v]=this._nodePromiseLODs[v]||[],0===v?L=V:(this._nodeIndexLOD=null,this._nodePromiseLODs[v].push(V))}return this._loader.logClose(),L}))}_loadMaterialAsync(a,v,p,P,b){return this._nodeIndexLOD?null:N.LoadExtensionAsync(a,v,this.name,((a,L)=>{let t;const V=this._getLODs(a,v,this._loader.Zi.materials,L.ids);this._loader.logOpen(`${a}`);for(let v=0;v<V.length;v++){const a=V[v];0!==v&&(this._materialIndexLOD=v);const L=this._loader._loadMaterialAsync(`/materials/${a.index}`,a,p,P,(a=>{0===v&&b(a)})).then((a=>{if(0!==v){b(a);const p=V[v-1]._data;p[P]&&(this._disposeMaterials([p[P].babylonMaterial]),delete p[P])}return a}));this._materialPromiseLODs[v]=this._materialPromiseLODs[v]||[],0===v?t=L:(this._materialIndexLOD=null,this._materialPromiseLODs[v].push(L))}return this._loader.logClose(),t}))}_loadUriAsync(a,v,p){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const b=this._nodeIndexLOD-1;return this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new P,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(a,v,p)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const b=this._materialIndexLOD-1;return this._materialSignalLODs[b]=this._materialSignalLODs[b]||new P,this._materialSignalLODs[b].promise.then((()=>this._loader.loadUriAsync(a,v,p)))}return null}loadBufferAsync(a,v,p,b){if(this._loader.parent.useRangeRequests&&!v.uri){if(!this._loader.bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);const v=(a,v)=>{const L=p,t=L+b-1;let V=a[v];return V?(V.start=Math.min(V.start,L),V.end=Math.max(V.end,t)):(V={start:L,end:t,loaded:new P},a[v]=V),V.loaded.promise.then((a=>new Uint8Array(a.buffer,a.byteOffset+p-V.start,b)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?v(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?v(this._materialBufferLODs,this._materialIndexLOD):v(this._bufferLODs,0)}return null}_loadBufferLOD(a,v){const p=a[v];p&&(this._loader.log(`Loading buffer range [${p.start}-${p.end}]`),this._loader.bin.readAsync(p.start,p.end-p.start+1).then((a=>{p.loaded.resolve(a)}),(a=>{p.loaded.reject(a)})))}_getLODs(a,v,p,P){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const b=[];for(let L=P.length-1;L>=0;L--)if(b.push(U.Get(`${a}/ids/${P[L]}`,p,P[L])),b.length===this.maxLODsToLoad)return b;return b.push(v),b}_disposeTransformNode(a){const v=[],p=a.material;p&&v.push(p);for(const b of a.getChildMeshes())b.material&&v.push(b.material);a.dispose();const P=v.filter((a=>this._loader.babylonScene.meshes.every((v=>v.material!=a))));this._disposeMaterials(P)}_disposeMaterials(a){const v={};for(const p of a){for(const a of p.getActiveTextures())v[a.uniqueId]=a;p.dispose()}for(const p in v)for(const a of this._loader.babylonScene.materials)a.hasTexture(v[p])&&delete v[p];for(const p in v)v[p].dispose()}}E(lv),d(lv,!0,(a=>new zv(a)));const gv="MSFT_minecraftMesh";class Gv{constructor(a){this.name=gv,this._loader=a,this.enabled=this._loader.isExtensionUsed(gv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtraAsync(a,v,this.name,((P,b)=>{if(b){if(!(p instanceof S))throw new Error(`${P}: Material type not supported`);const b=this._loader.loadMaterialPropertiesAsync(a,v,p);return p.needAlphaBlending()&&(p.forceDepthWrite=!0,p.separateCullingPass=!0),p.oh=p.forceDepthWrite,p.twoSidedLighting=!0,b}return null}))}}E(gv),d(gv,!0,(a=>new Gv(a)));const ev="MSFT_sRGBFactors";class kv{constructor(a){this.name=ev,this._loader=a,this.enabled=this._loader.isExtensionUsed(ev)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,v,p){return N.LoadExtraAsync(a,v,this.name,((P,b)=>{if(b){if(!(p instanceof S))throw new Error(`${P}: Material type not supported`);const b=this._loader.loadMaterialPropertiesAsync(a,v,p),L=p.va().getEngine().useExactSrgbConversions;return p.albedoTexture||p.albedoColor.toLinearSpaceToRef(p.albedoColor,L),p.reflectivityTexture||p.reflectivityColor.toLinearSpaceToRef(p.reflectivityColor,L),b}return null}))}}E(ev),d(ev,!0,(a=>new kv(a)));var dv,Ev=p(11032);!function(a){a[a.Input=0]="Input",a[a.Output=1]="Output"}(dv||(dv={}));class Wv{constructor(a,v,p){this._ownerBlock=p,this._connectedPoint=[],this.uniqueId=(0,Ev.b)(),this.connectedPointIds=[],this.name=a,this._connectionType=v}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(a){if(this._connectionType===a._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||a._isSingularConnection()&&a._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(a),a._connectedPoint.push(this)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.uniqueId=this.uniqueId,a.name=this.name,a._connectionType=this._connectionType,a.connectedPointIds=[],a.className=this.getClassName();for(const v of this._connectedPoint)a.connectedPointIds.push(v.uniqueId)}getClassName(){return"FGConnection"}deserialize(a){this.uniqueId=a.uniqueId,this.name=a.name,this._connectionType=a._connectionType,this.connectedPointIds=a.connectedPointIds}static Parse(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0;const p=new(t.e.Instantiate(a.className))(a.name,a._connectionType,v);return p.deserialize(a),p}}class Uv{constructor(a){this.value=this._toInt(a)}_toInt(a){return 0|a}add(a){return new Uv(this.value+a.value)}od(a){return new Uv(this.value-a.value)}multiply(a){return new Uv(Math.imul(this.value,a.value))}divide(a){return new Uv(this.value/a.value)}getClassName(){return Uv.ClassName}equals(a){return this.value===a.value}static Parse(a){return new Uv(a.value)}}Uv.ClassName="FlowGraphInteger",(0,Z.f)("FlowGraphInteger",Uv);class Nv{constructor(a,v){this.typeName=a,this.defaultValue=v}serialize(a){a.typeName=this.typeName,a.defaultValue=this.defaultValue}static Parse(a){return new Nv(a.typeName,a.defaultValue)}}const iv=new Nv("any",void 0),Iv=(new Nv("string",""),new Nv("number",0)),ap=new Nv("boolean",!1),vp=new Nv("Vector2",b.o.Zero()),pp=new Nv("fb",b.s.Zero()),Pp=(new Nv("Vector4",b.t.Zero()),new Nv("Matrix",b.e.Identity())),bp=(new Nv("gb",L.d.Black()),new Nv("pb",new L.e(0,0,0,0)),new Nv("Quaternion",b.i.Identity()),new Nv("FlowGraphInteger",new Uv(0)));class Lp extends Wv{constructor(a,v,p,P){super(a,v,p),this.richType=P}_isSingularConnection(){return 0===this.connectionType}setValue(a,v){v._setConnectionValue(this,a)}connectTo(a){super.connectTo(a)}_getValueOrDefault(a){return a._hasConnectionValue(this)?a._getConnectionValue(this):this.richType.defaultValue}getValue(a){return 1===this.connectionType?(a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(a),this._getValueOrDefault(a)):this.isConnected()?this._connectedPoint[0].getValue(a):this._getValueOrDefault(a)}getClassName(){return"FGDataConnection"}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.richType={},this.richType.serialize(a.richType)}static Parse(a,v){const p=Wv.Parse(a,v);return p.richType=Nv.Parse(a.richType),p}}function tp(a){return"Mesh"===a||"AbstractMesh"===a||"GroundMesh"===a||"InstanceMesh"===a||"LinesMesh"===a||"GoldbergMesh"===a||"GreasedLineMesh"===a||"TrailMesh"===a}function Vp(a){return"Vector2"===a||"fb"===a||"Vector4"===a||"Quaternion"===a||"gb"===a||"pb"===a}function Kp(a,v,p){var P;const b=(null===v||void 0===v||null===(P=v.getClassName)||void 0===P?void 0:P.call(v))??"";tp(b)?p[a]={name:v.name,className:b}:Vp(b)?p[a]={value:v.tj(),className:b}:p[a]=v}function Cp(a,v,p){const P=v[a];let t;const V=null===P||void 0===P?void 0:P.className;return t=tp(V)?p.getMeshByName(P.name):Vp(V)?function(a,v){if("Vector2"===a)return b.o.bh(v);if("fb"===a)return b.s.bh(v);if("Vector4"===a)return b.t.bh(v);if("Quaternion"===a)return b.i.bh(v);if("gb"===a)return new L.d(v[0],v[1],v[2]);if("pb"===a)return new L.e(v[0],v[1],v[2],v[3]);throw new Error(`Unknown vector class name ${a}`)}(V,P.value):"Matrix"===V?b.e.bh(P.value):V===Uv.ClassName?Uv.Parse(P):P&&void 0!==P.value?P.value:P,t}(0,Z.f)("FGDataConnection",Lp);class Fp{constructor(a){var v;this.config=a,this.uniqueId=(0,Ev.b)(),this.name=(null===(v=this.config)||void 0===v?void 0:v.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(a){}registerDataInput(a,v){const p=new Lp(a,0,this,v);return this.dataInputs.push(p),p}registerDataOutput(a,v){const p=new Lp(a,1,this,v);return this.dataOutputs.push(p),p}getDataInput(a){return this.dataInputs.find((v=>v.name===a))}getDataOutput(a){return this.dataOutputs.find((v=>v.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.uniqueId=this.uniqueId,a.config={},this.config&&(a.config.name=this.config.name),a.dataInputs=[],a.dataOutputs=[],a.className=this.getClassName();for(const v of this.dataInputs){const p={};v.serialize(p),a.dataInputs.push(p)}for(const v of this.dataOutputs){const p={};v.serialize(p),a.dataOutputs.push(p)}}getClassName(){return"FGBlock"}static Parse(a,v){const p=t.e.Instantiate(a.className),P={},b=v.valueParseFunction??Cp;if(a.config)for(const t in a.config)P[t]=b(t,a.config,v.sd);var L;("FGSetPropertyBlock"===(L=a.className)||"FGGetPropertyBlock"===L||"FGPlayAnimationBlock"===L||"FGMeshPickEventBlock"===L)&&(P.pathConverter=v.pathConverter);const V=new p(P);V.uniqueId=a.uniqueId;for(let t=0;t<a.dataInputs.length;t++){const v=V.getDataInput(a.dataInputs[t].name);if(!v)throw new Error("Could not find data input with name "+a.dataInputs[t].name+" in block "+a.className);v.deserialize(a.dataInputs[t])}for(let t=0;t<a.dataOutputs.length;t++){const v=V.getDataOutput(a.dataOutputs[t].name);if(!v)throw new Error("Could not find data output with name "+a.dataOutputs[t].name+" in block "+a.className);v.deserialize(a.dataOutputs[t])}return V.metadata=a.metadata,V.deserialize&&V.deserialize(a),V}}class up extends Wv{_isSingularConnection(){return 1===this.connectionType}_activateSignal(a){var v;0===this.connectionType?(a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(a,this),a._increaseExecutionId()):null===(v=this._connectedPoint[0])||void 0===v||v._activateSignal(a)}}(0,Z.f)("FlowGraphSignalConnection",up);class cp extends Fp{constructor(a){super(a),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(a){const v=new up(a,0,this);return this.signalInputs.push(v),v}_registerSignalOutput(a){const v=new up(a,1,this);return this.signalOutputs.push(v),v}getSignalInput(a){return this.signalInputs.find((v=>v.name===a))}getSignalOutput(a){return this.signalOutputs.find((v=>v.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.signalInputs=[],a.signalOutputs=[];for(const v of this.signalInputs){const p={};v.serialize(p),a.signalInputs.push(p)}for(const v of this.signalOutputs){const p={};v.serialize(p),a.signalOutputs.push(p)}}deserialize(a){for(let v=0;v<a.signalInputs.length;v++){const p=this.getSignalInput(a.signalInputs[v].name);if(!p)throw new Error("Could not find signal input with name "+a.signalInputs[v].name+" in block "+a.className);p.deserialize(a.signalInputs[v])}for(let v=0;v<a.signalOutputs.length;v++){const p=this.getSignalOutput(a.signalOutputs[v].name);if(!p)throw new Error("Could not find signal output with name "+a.signalOutputs[v].name+" in block "+a.className);p.deserialize(a.signalOutputs[v])}}getClassName(){return"FGExecutionBlock"}}class fp extends cp{constructor(a){super(a),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(a){this._preparePendingTasks(a),a._addPendingBlock(this)}}class Hp extends fp{_execute(a){a._notifyExecuteNode(this),this.out._activateSignal(a)}}class Ap{constructor(a){this.uniqueId=(0,Ev.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new F.c,this._configuration=a}hasVariable(a){return a in this._userVariables}setVariable(a,v){this._userVariables[a]=v}getVariable(a){return this._userVariables[a]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(a,v){return`${a.uniqueId}_${v}`}_setExecutionVariable(a,v,p){this._executionVariables[this._getUniqueIdPrefixedName(a,v)]=p}_getExecutionVariable(a,v,p){return this._hasExecutionVariable(a,v)?this._executionVariables[this._getUniqueIdPrefixedName(a,v)]:p}_deleteExecutionVariable(a,v){delete this._executionVariables[this._getUniqueIdPrefixedName(a,v)]}_hasExecutionVariable(a,v){return this._getUniqueIdPrefixedName(a,v)in this._executionVariables}_hasConnectionValue(a){return a.uniqueId in this._connectionValues}_setConnectionValue(a,v){this._connectionValues[a.uniqueId]=v}_getConnectionValue(a){return this._connectionValues[a.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(a){this._pendingBlocks.push(a)}_removePendingBlock(a){const v=this._pendingBlocks.indexOf(a);-1!==v&&this._pendingBlocks.splice(v,1)}_clearPendingBlocks(){for(const a of this._pendingBlocks)a._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(a){this.onNodeExecutedObservable.notifyObservers(a)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kp;a.uniqueId=this.uniqueId,a._userVariables={};for(const p in this._userVariables)v(p,this._userVariables[p],a._userVariables);a._connectionValues={};for(const p in this._connectionValues)v(p,this._connectionValues[p],a._connectionValues)}getClassName(){return"FGContext"}static Parse(a,v){const p=v.graph.createContext(),P=v.valueParseFunction??Cp;p.uniqueId=a.uniqueId;for(const b in a._userVariables){const v=P(b,a._userVariables,p._configuration.sd);p._userVariables[b]=v}for(const b in a._connectionValues){const v=P(b,a._connectionValues,p._configuration.sd);p._connectionValues[b]=v}return p}}(0,Q.e)([(0,s.O)()],Ap.prototype,"uniqueId",void 0);var hp,Rp,Xp=p(11340);function Qp(a,v){return!(!a.parent||a.parent!==v&&!Qp(a.parent,v))}class sp extends Hp{constructor(a){super(a),this.config=a}_getReferencedMesh(){const a=this.config.pathConverter.convert(this.config.path),v=a.info.getObject(a.object);if(!v||!(v instanceof w.e))throw new Error("Mesh pick event block requires a valid mesh");return v}_preparePendingTasks(a){let v=a._getExecutionVariable(this,"meshPickObserver");if(!v){const p=this._getReferencedMesh();a._setExecutionVariable(this,"mesh",p),v=p.va().onPointerObservable.add((v=>{var P,b,L;v.type===Xp.e.POINTERPICK&&null!==(P=v.pickInfo)&&void 0!==P&&P.pickedMesh&&((null===(b=v.pickInfo)||void 0===b?void 0:b.pickedMesh)===p||Qp(null===(L=v.pickInfo)||void 0===L?void 0:L.pickedMesh,p))&&this._execute(a)}));const P=p.uj.add((()=>this._onDispose));a._setExecutionVariable(this,"meshPickObserver",v),a._setExecutionVariable(this,"meshDisposeObserver",P)}}_onDispose(a){this._cancelPendingTasks(a),a._removePendingBlock(this)}_cancelPendingTasks(a){const v=a._getExecutionVariable(this,"mesh"),p=a._getExecutionVariable(this,"meshPickObserver"),P=a._getExecutionVariable(this,"meshDisposeObserver");v.va().onPointerObservable.remove(p),v.uj.remove(P),a._deleteExecutionVariable(this,"mesh"),a._deleteExecutionVariable(this,"meshPickObserver"),a._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return sp.ClassName}serialize(a){super.serialize(a),a.config.path=this.config.path}}sp.ClassName="FGMeshPickEventBlock",(0,Z.f)(sp.ClassName,sp),function(a){a[a.Stopped=0]="Stopped",a[a.Started=1]="Started"}(hp||(hp={}));class Dp{constructor(a){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=a.sd,this._coordinator=a.coordinator,this._sceneDisposeObserver=this._scene.uj.add((()=>this.dispose()))}createContext(){const a=new Ap({sd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(a),a}getContext(a){return this._executionContexts[a]}addEventBlock(a){this._eventBlocks.push(a)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const a of this._executionContexts){const v=this._getContextualOrder();for(const p of v)p._startPendingTasks(a)}}}_getContextualOrder(){const a=[];for(const v of this._eventBlocks)if(v.getClassName()===sp.ClassName){const p=v._getReferencedMesh();let P=0;for(;P<a.length;P++){const v=a[P]._getReferencedMesh();if(p&&v&&Qp(p,v))break}a.splice(P,0,v)}else a.push(v);return a}dispose(){if(0!==this.state){this.state=0;for(const a of this._executionContexts)a._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.uj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(a){const v=[],p=new Set;for(const P of this._eventBlocks)v.push(P),p.add(P.uniqueId);for(;v.length>0;){const P=v.pop();a(P);for(const a of P.dataInputs)for(const P of a._connectedPoint)p.has(P._ownerBlock.uniqueId)||(v.push(P._ownerBlock),p.add(P._ownerBlock.uniqueId));if(P instanceof cp)for(const a of P.signalOutputs)for(const P of a._connectedPoint)p.has(P._ownerBlock.uniqueId)||(v.push(P._ownerBlock),p.add(P._ownerBlock.uniqueId))}}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0;a.allBlocks=[],this.visitAllBlocks((v=>{const p={};v.serialize(p),a.allBlocks.push(p)})),a.executionContexts=[];for(const p of this._executionContexts){const P={};p.serialize(P,v),a.executionContexts.push(P)}}static GetDataOutConnectionByUniqueId(a,v){for(const p of a)for(const a of p.dataOutputs)if(a.uniqueId===v)return a;throw new Error("Could not find data out connection with unique id "+v)}static GetSignalInConnectionByUniqueId(a,v){for(const p of a)if(p instanceof cp)for(const a of p.signalInputs)if(a.uniqueId===v)return a;throw new Error("Could not find signal in connection with unique id "+v)}static Parse(a,v){const p=v.coordinator.createGraph(),P=[],b=v.valueParseFunction??Cp;for(const L of a.allBlocks){const a=Fp.Parse(L,{sd:v.coordinator.config.sd,pathConverter:v.pathConverter,valueParseFunction:b});P.push(a),a instanceof Hp&&p.addEventBlock(a)}for(const L of P){for(const a of L.dataInputs)for(const v of a.connectedPointIds){const p=Dp.GetDataOutConnectionByUniqueId(P,v);a.connectTo(p)}if(L instanceof cp)for(const a of L.signalOutputs)for(const v of a.connectedPointIds){const p=Dp.GetSignalInConnectionByUniqueId(P,v);a.connectTo(p)}}for(const L of a.executionContexts)Ap.Parse(L,{graph:p,valueParseFunction:b});return p}}class yp{constructor(a){this.config=a,this._flowGraphs=[],this._customEventsMap=new Map,this.config.sd.uj.add((()=>{this.dispose()}));(yp.SceneCoordinators.get(this.config.sd)??[]).push(this)}createGraph(){const a=new Dp({sd:this.config.sd,coordinator:this});return this._flowGraphs.push(a),a}removeGraph(a){const v=this._flowGraphs.indexOf(a);-1!==v&&(a.dispose(),this._flowGraphs.splice(v,1))}start(){this._flowGraphs.forEach((a=>a.start()))}dispose(){this._flowGraphs.forEach((a=>a.dispose())),this._flowGraphs.length=0;const a=yp.SceneCoordinators.get(this.config.sd)??[],v=a.indexOf(this);-1!==v&&a.splice(v,1)}serialize(a,v){a._flowGraphs=[],this._flowGraphs.forEach((p=>{const P={};p.serialize(P,v),a._flowGraphs.push(P)}))}static Parse(a,v){var p;const P=v.valueParseFunction??Cp,b=new yp({sd:v.sd});return null===(p=a._flowGraphs)||void 0===p||p.forEach((a=>{Dp.Parse(a,{coordinator:b,valueParseFunction:P,pathConverter:v.pathConverter})})),b}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(a){let v=this._customEventsMap.get(a);return v||(v=new F.c,this._customEventsMap.set(a,v)),v}notifyCustomEvent(a,v){const p=this._customEventsMap.get(a);p&&p.notifyObservers(v)}}yp.SceneCoordinators=new Map;class Zp extends Hp{_preparePendingTasks(a){if(!a._getExecutionVariable(this,"sceneReadyObserver")){const v=a.configuration.sd.onReadyObservable.add((()=>{this._execute(a)}));a._setExecutionVariable(this,"sceneReadyObserver",v)}}_cancelPendingTasks(a){const v=a._getExecutionVariable(this,"sceneReadyObserver");a.configuration.sd.onReadyObservable.remove(v),a._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Zp.ClassName}}Zp.ClassName="FGSceneReadyEventBlock",(0,Z.f)("FGSceneReadyEventBlock",Zp);class Mp extends Hp{_preparePendingTasks(a){if(!a._getExecutionVariable(this,"sceneBeforeRender")){const v=a.configuration.sd.onBeforeRenderObservable.add((()=>{this._execute(a)}));a._setExecutionVariable(this,"sceneBeforeRender",v)}}_cancelPendingTasks(a){const v=a._getExecutionVariable(this,"sceneBeforeRender");a.configuration.sd.onBeforeRenderObservable.remove(v),a._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return Mp.ClassName}}Mp.ClassName="FGSceneTickEventBlock",(0,Z.f)(Mp.ClassName,Mp);class Sp extends cp{constructor(a){super(a),this.out=this._registerSignalOutput("out")}}class np extends Sp{constructor(a){super(a),this.message=this.registerDataInput("message",iv)}_execute(a){const v=this.message.getValue(a);A.d.Log(v),this.out._activateSignal(a)}getClassName(){return np.ClassName}}np.ClassName="FGConsoleLogBlock",(0,Z.f)(np.ClassName,np),function(a){a[a.INIT=0]="INIT",a[a.STARTED=1]="STARTED",a[a.ENDED=2]="ENDED"}(Rp||(Rp={}));class qp{constructor(a){this.onEachCountObservable=new F.c,this.onTimerAbortedObservable=new F.c,this.onTimerEndedObservable=new F.c,this.onStateChangedObservable=new F.c,this._observer=null,this._breakOnNextTick=!1,this._tick=a=>{const v=Date.now();this._timer=v-this._startTime;const p={startTime:this._startTime,currentTime:v,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:a},P=this._breakOnNextTick||this._breakCondition(p);P||this._timer>=this._timeToEnd?this._stop(p,P):this.onEachCountObservable.notifyObservers(p)},this._setState(0),this._contextObservable=a.contextObservable,this._observableParameters=a.observableParameters??{},this._breakCondition=a.breakCondition??(()=>!1),this._timeToEnd=a.timeout,a.onEnded&&this.onTimerEndedObservable.add(a.onEnded),a.ni&&this.onEachCountObservable.add(a.ni),a.onAborted&&this.onTimerAbortedObservable.add(a.onAborted)}set breakCondition(a){this._breakCondition=a}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=a,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(a){this._state=a,this.onStateChangedObservable.notifyObservers(this._state)}_stop(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),v?this.onTimerAbortedObservable.notifyObservers(a):this.onTimerEndedObservable.notifyObservers(a)}}class Tp extends fp{constructor(a){super(a),this.timeout=this.registerDataInput("timeout",Iv)}_preparePendingTasks(a){const v=this.timeout.getValue(a);if(void 0!==v&&v>=0){const p=a._getExecutionVariable(this,"runningTimers")||[],P=a.configuration.sd,b=new qp({timeout:v,contextObservable:P.onBeforeRenderObservable,onEnded:()=>this._onEnded(b,a)});b.start(),p.push(b),a._setExecutionVariable(this,"runningTimers",p)}}_execute(a){this._startPendingTasks(a),this.out._activateSignal(a)}_onEnded(a,v){const p=v._getExecutionVariable(this,"runningTimers")||[],P=p.indexOf(a);-1!==P?p.splice(P,1):t.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),v._removePendingBlock(this),this.done._activateSignal(v)}_cancelPendingTasks(a){const v=a._getExecutionVariable(this,"runningTimers")||[];for(const p of v)p.dispose();a._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Tp.ClassName}}Tp.ClassName="FGTimerBlock",(0,Z.f)("FGTimerBlock",Tp);class jp extends Sp{constructor(a){super(a),this.config=a;for(let v=0;v<this.config.eventData.length;v++){const a=this.config.eventData[v];this.registerDataInput(a,iv)}}_execute(a){const v=this.config.eventId,p=this.dataInputs.map((v=>v.getValue(a)));a.configuration.coordinator.notifyCustomEvent(v,p),this.out._activateSignal(a)}getClassName(){return jp.ClassName}}jp.ClassName="FGSendCustomEventBlock",(0,Z.f)("FGSendCustomEventBlock",jp);class wp extends Hp{constructor(a){super(a),this.config=a;for(let v=0;v<this.config.eventData.length;v++){const a=this.config.eventData[v];this.registerDataOutput(a,iv)}}_preparePendingTasks(a){const v=a.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=v.add((v=>{for(let p=0;p<v.length;p++)this.dataOutputs[p].setValue(v[p],a);this._execute(a)}))}_cancelPendingTasks(a){const v=a.configuration.coordinator.getCustomEventObservable(this.config.eventId);v?v.remove(this._eventObserver):t.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return wp.ClassName}serialize(a){super.serialize(a),a.eventId=this.config.eventId,a.eventData=this.config.eventData}}wp.ClassName="FGReceiveCustomEventBlock",(0,Z.f)(wp.ClassName,wp);class Jp extends cp{constructor(a){super(a),this.config=a,this.outFlows=[];for(let v=0;v<this.config.numberOutputFlows;v++)this.outFlows.push(this._registerSignalOutput(`${v}`))}_execute(a){for(let v=0;v<this.config.numberOutputFlows;v++)this.outFlows[v]._activateSignal(a)}getClassName(){return Jp.ClassName}}Jp.ClassName="FGSequenceBlock",(0,Z.f)(Jp.ClassName,Jp);const Bp=new RegExp(/\{(\w+)\}/g);class xp{constructor(a,v){this.path=a,this.ownerBlock=v,this.templatedInputs=[];let p=Bp.exec(a);for(;p;){const[,P]=p;this.templatedInputs.push(v.registerDataInput(P,bp)),p=Bp.exec(a)}}getAccessor(a,v){let p=this.path;for(const P of this.templatedInputs){const a=P.getValue(v).value;p=p.replace(`{${P.name}}`,a.toString())}return a.convert(p)}}class rp extends Fp{constructor(a){super(a),this.config=a,this.value=this.registerDataOutput("value",iv),this.templateComponent=new xp(a.path,this)}_updateOutputs(a){const v=this.templateComponent.getAccessor(this.config.pathConverter,a),p=v.info.get(v.object);this.value.setValue(p,a)}getClassName(){return rp.ClassName}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.config.path=this.config.path}}rp.ClassName="FGGetPropertyBlock",(0,Z.f)(rp.ClassName,rp);class op extends Sp{constructor(a){super(a),this.config=a,this.a=this.registerDataInput("a",iv),this.templateComponent=new xp(a.path,this)}_execute(a){const v=this.a.getValue(a),p=this.templateComponent.getAccessor(this.config.pathConverter,a);p.info.set(v,p.object),this.out._activateSignal(a)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.config.path=this.config.path}getClassName(){return op.ClassName}}op.ClassName="FGSetPropertyBlock",(0,Z.f)("FGSetPropertyBlock",op);const mp="cachedOperationValue",Op="cachedExecutionId";class Yp extends Fp{constructor(a,v){super(v),this.value=this.registerDataOutput("value",a)}_updateOutputs(a){const v=a._getExecutionVariable(this,Op),p=a._getExecutionVariable(this,mp);if(void 0!==p&&v===a.executionId)this.value.setValue(p,a);else{const v=this._doOperation(a);a._setExecutionVariable(this,mp,v),a._setExecutionVariable(this,Op,a.executionId),this.value.setValue(v,a)}}}class lp extends Yp{constructor(a,v,p,P,b,L){super(p,L),this._operation=P,this._className=b,this.a=this.registerDataInput("a",a),this.b=this.registerDataInput("b",v)}_doOperation(a){return this._operation(this.a.getValue(a),this.b.getValue(a))}getClassName(){return this._className}}class zp extends Yp{constructor(a,v,p,P){super(a,P),this._operation=v,this._className=p}_doOperation(a){return this._operation()}getClassName(){return this._className}}class gp extends Yp{constructor(a,v,p,P,b){super(v,b),this._operation=p,this._className=P,this.a=this.registerDataInput("a",a)}_doOperation(a){return this._operation(this.a.getValue(a))}getClassName(){return this._className}}class Gp extends Yp{constructor(a,v,p,P,b,L,t){super(P,t),this._operation=b,this._className=L,this.a=this.registerDataInput("a",a),this.b=this.registerDataInput("b",v),this.c=this.registerDataInput("c",p)}_doOperation(a){return this._operation(this.a.getValue(a),this.b.getValue(a),this.c.getValue(a))}getClassName(){return this._className}}function ep(a){return a.getClassName?a.getClassName():""}function kp(a,v){return"Vector2"===a&&"Vector2"===v||"fb"===a&&"fb"===v||"Vector4"===a&&"Vector4"===v}function dp(a,v){return"Matrix"===a&&"Matrix"===v}function Ep(a,v){return"FlowGraphInteger"===a&&"FlowGraphInteger"===v}class Wp extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicAdd(a,v)),Wp.ClassName,a)}_polymorphicAdd(a,v){const p=ep(a),P=ep(v);return kp(p,P)||dp(p,P)||Ep(p,P)?a.add(v):a+v}}Wp.ClassName="FGAddBlock",(0,Z.f)(Wp.ClassName,Wp);class Up extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicAdd(a,v)),Up.ClassName,a)}_polymorphicAdd(a,v){const p=ep(a),P=ep(v);return kp(p,P)||Ep(p,P)?a.od(v):dp(p,P)?a.add(v.scale(-1)):a-v}}Up.ClassName="FGSubBlock",(0,Z.f)(Up.ClassName,Up);class Np extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicMultiply(a,v)),Np.ClassName,a)}_polymorphicMultiply(a,v){const p=ep(a),P=ep(v);return kp(p,P)||Ep(p,P)?a.multiply(v):dp(p,P)?b.e.FromValues(a.m[0]*v.m[0],a.m[4]*v.m[4],a.m[8]*v.m[8],a.m[12]*v.m[12],a.m[1]*v.m[1],a.m[5]*v.m[5],a.m[9]*v.m[9],a.m[13]*v.m[13],a.m[2]*v.m[2],a.m[6]*v.m[6],a.m[10]*v.m[10],a.m[14]*v.m[14],a.m[3]*v.m[3],a.m[7]*v.m[7],a.m[11]*v.m[11],a.m[15]*v.m[15]):a*v}}Np.ClassName="FGMultiplyBlock",(0,Z.f)(Np.ClassName,Np);class ip extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicDivide(a,v)),ip.ClassName,a)}_polymorphicDivide(a,v){const p=ep(a),P=ep(v);return kp(p,P)||Ep(p,P)?a.divide(v):dp(p,P)?b.e.FromValues(a.m[0]/v.m[0],a.m[4]/v.m[4],a.m[8]/v.m[8],a.m[12]/v.m[12],a.m[1]/v.m[1],a.m[5]/v.m[5],a.m[9]/v.m[9],a.m[13]/v.m[13],a.m[2]/v.m[2],a.m[6]/v.m[6],a.m[10]/v.m[10],a.m[14]/v.m[14],a.m[3]/v.m[3],a.m[7]/v.m[7],a.m[11]/v.m[11],a.m[15]/v.m[15]):a/v}}ip.ClassName="FGDivideBlock",(0,Z.f)(ip.ClassName,ip);class Ip extends zp{constructor(a){super(Iv,(()=>Math.random()),Ip.ClassName,a)}}Ip.ClassName="FGRandomBlock",(0,Z.f)(Ip.ClassName,Ip);class aP extends lp{constructor(a){super(iv,iv,Iv,((a,v)=>this._polymorphicDot(a,v)),aP.ClassName,a)}_polymorphicDot(a,v){switch(ep(a)){case"Vector2":return b.o.Dot(a,v);case"fb":return b.s.Dot(a,v);case"Vector4":return b.t.Dot(a,v);default:throw new Error(`Cannot get dot product of ${a} and ${v}`)}}}aP.ClassName="FGDotBlock",(0,Z.f)(aP.ClassName,aP);class vP extends zp{constructor(a){super(Iv,(()=>Math.E),vP.ClassName,a)}}vP.ClassName="FGEBlock",(0,Z.f)(vP.ClassName,vP);class pP extends zp{constructor(a){super(Iv,(()=>Math.PI),pP.ClassName,a)}}pP.ClassName="FGPIBlock",(0,Z.f)(pP.ClassName,pP);class PP extends zp{constructor(a){super(Iv,(()=>Number.POSITIVE_INFINITY),PP.ClassName,a)}}PP.ClassName="FGInfBlock",(0,Z.f)(PP.ClassName,PP);class bP extends zp{constructor(a){super(Iv,(()=>Number.NaN),bP.ClassName,a)}}function LP(a,v){switch(ep(a)){case"FlowGraphInteger":return new Uv(v(a.value));case"Vector2":return new b.o(v(a.x),v(a.y));case"fb":return new b.s(v(a.x),v(a.y),v(a.z));case"Vector4":return new b.t(v(a.x),v(a.y),v(a.z),v(a.w));case"Matrix":return b.e.FromValues(v(a.m[0]),v(a.m[4]),v(a.m[8]),v(a.m[12]),v(a.m[1]),v(a.m[5]),v(a.m[9]),v(a.m[13]),v(a.m[2]),v(a.m[6]),v(a.m[10]),v(a.m[14]),v(a.m[3]),v(a.m[7]),v(a.m[11]),v(a.m[15]));default:return v(a)}}bP.ClassName="FGNaNBlock",(0,Z.f)(bP.ClassName,bP);class tP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicAbs(a)),tP.ClassName,a)}_polymorphicAbs(a){return LP(a,Math.abs)}}tP.ClassName="FGAbsBlock",(0,Z.f)(tP.ClassName,tP);class VP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicSign(a)),VP.ClassName,a)}_polymorphicSign(a){return LP(a,Math.sign)}}VP.ClassName="FGSignBlock",(0,Z.f)(VP.ClassName,VP);class KP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicTrunc(a)),KP.ClassName,a)}_polymorphicTrunc(a){return LP(a,Math.trunc)}}KP.ClassName="FGTruncBlock",(0,Z.f)(KP.ClassName,KP);class CP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicFloor(a)),CP.ClassName,a)}_polymorphicFloor(a){return LP(a,Math.floor)}}CP.ClassName="FGFloorBlock",(0,Z.f)(CP.ClassName,CP);class FP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicCeiling(a)),FP.ClassName,a)}_polymorphicCeiling(a){return LP(a,Math.ceil)}}FP.ClassName="FGCeilBlock",(0,Z.f)(FP.ClassName,FP);class uP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicFract(a)),uP.ClassName,a)}_polymorphicFract(a){return LP(a,(a=>a-Math.floor(a)))}}uP.ClassName="FGFractBlock",(0,Z.f)(uP.ClassName,uP);class cP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicNeg(a)),cP.ClassName,a)}_polymorphicNeg(a){return LP(a,(a=>-a))}}function fP(a,v,p){switch(ep(a)){case"FlowGraphInteger":return new Uv(p(a.value,v.value));case"Vector2":return new b.o(p(a.x,v.x),p(a.y,v.y));case"fb":return new b.s(p(a.x,v.x),p(a.y,v.y),p(a.z,v.z));case"Vector4":return new b.t(p(a.x,v.x),p(a.y,v.y),p(a.z,v.z),p(a.w,v.w));case"Matrix":return b.e.FromValues(p(a.m[0],v.m[0]),p(a.m[4],v.m[4]),p(a.m[8],v.m[8]),p(a.m[12],v.m[12]),p(a.m[1],v.m[1]),p(a.m[5],v.m[5]),p(a.m[9],v.m[9]),p(a.m[13],v.m[13]),p(a.m[2],v.m[2]),p(a.m[6],v.m[6]),p(a.m[10],v.m[10]),p(a.m[14],v.m[14]),p(a.m[3],v.m[3]),p(a.m[7],v.m[7]),p(a.m[11],v.m[11]),p(a.m[15],v.m[15]));default:return p(a,v)}}cP.ClassName="FGNegBlock",(0,Z.f)(cP.ClassName,cP);class HP extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicRemainder(a,v)),HP.ClassName,a)}_polymorphicRemainder(a,v){return fP(a,v,((a,v)=>a%v))}}HP.ClassName="FGRemainderBlock",(0,Z.f)(HP.ClassName,HP);class AP extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicMin(a,v)),AP.ClassName,a)}_polymorphicMin(a,v){return fP(a,v,Math.min)}}AP.ClassName="FGMinBlock",(0,Z.f)(AP.ClassName,AP);class hP extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicMax(a,v)),hP.ClassName,a)}_polymorphicMax(a,v){return fP(a,v,Math.max)}}function RP(a,v,p){return Math.min(Math.max(a,Math.min(v,p)),Math.max(v,p))}function XP(a,v,p,P){switch(ep(a)){case"FlowGraphInteger":return new Uv(P(a.value,v.value,p.value));case"Vector2":return new b.o(P(a.x,v.x,p.x),P(a.y,v.y,p.y));case"fb":return new b.s(P(a.x,v.x,p.x),P(a.y,v.y,p.y),P(a.z,v.z,p.z));case"Vector4":return new b.t(P(a.x,v.x,p.x),P(a.y,v.y,p.y),P(a.z,v.z,p.z),P(a.w,v.w,p.w));case"Matrix":return b.e.FromValues(P(a.m[0],v.m[0],p.m[0]),P(a.m[4],v.m[4],p.m[4]),P(a.m[8],v.m[8],p.m[8]),P(a.m[12],v.m[12],p.m[12]),P(a.m[1],v.m[1],p.m[1]),P(a.m[5],v.m[5],p.m[5]),P(a.m[9],v.m[9],p.m[9]),P(a.m[13],v.m[13],p.m[13]),P(a.m[2],v.m[2],p.m[2]),P(a.m[6],v.m[6],p.m[6]),P(a.m[10],v.m[10],p.m[10]),P(a.m[14],v.m[14],p.m[14]),P(a.m[3],v.m[3],p.m[3]),P(a.m[7],v.m[7],p.m[7]),P(a.m[11],v.m[11],p.m[11]),P(a.m[15],v.m[15],p.m[15]));default:return P(a,v,p)}}hP.ClassName="FGMaxBlock",(0,Z.f)(hP.ClassName,hP);class QP extends Gp{constructor(a){super(iv,iv,iv,iv,((a,v,p)=>this._polymorphicClamp(a,v,p)),QP.ClassName,a)}_polymorphicClamp(a,v,p){return XP(a,v,p,RP)}}function sP(a){return Math.min(Math.max(a,0),1)}QP.ClassName="FGClampBlock",(0,Z.f)(QP.ClassName,QP);class DP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicSaturate(a)),DP.ClassName,a)}_polymorphicSaturate(a){return LP(a,sP)}}DP.ClassName="FGSaturateBlock",(0,Z.f)(DP.ClassName,DP);class yP extends Gp{constructor(a){super(iv,iv,iv,iv,((a,v,p)=>this._polymorphicInterpolate(a,v,p)),yP.ClassName,a)}_interpolate(a,v,p){return(1-p)*a+p*v}_polymorphicInterpolate(a,v,p){return XP(a,v,p,this._interpolate)}}yP.ClassName="FGInterpolateBlock",(0,Z.f)(yP.ClassName,yP);class ZP extends lp{constructor(a){super(iv,iv,ap,((a,v)=>this._polymorphicEq(a,v)),ZP.ClassName,a)}_polymorphicEq(a,v){const p=ep(a),P=ep(v);return kp(p,P)||dp(p,P)||Ep(p,P)?a.equals(v):a===v}}function MP(a,v,p){const P=ep(a);if(P===ep(v)){if(""===P)return p(a,v);if("FlowGraphInteger"===P)return p(a.value,v.value);throw new Error(`Cannot compare ${a} and ${v}`)}throw new Error(`${a} and ${v} are of different types.`)}ZP.ClassName="FGEqBlock",(0,Z.f)(ZP.ClassName,ZP);class SP extends lp{constructor(a){super(iv,iv,ap,((a,v)=>this._polymorphicLessThan(a,v)),SP.ClassName,a)}_polymorphicLessThan(a,v){return MP(a,v,((a,v)=>a<v))}}SP.ClassName="FGLessThanBlock",(0,Z.f)(SP.ClassName,SP);class nP extends lp{constructor(a){super(iv,iv,ap,((a,v)=>this._polymorphicLessThanOrEqual(a,v)),nP.ClassName,a)}_polymorphicLessThanOrEqual(a,v){return MP(a,v,((a,v)=>a<=v))}}nP.ClassName="FGLessThanOrEqualBlock";class qP extends lp{constructor(a){super(iv,iv,ap,((a,v)=>this._polymorphicGreaterThan(a,v)),qP.ClassName,a)}_polymorphicGreaterThan(a,v){return MP(a,v,((a,v)=>a>v))}}qP.ClassName="FGGreaterThanBlock",(0,Z.f)(qP.ClassName,qP);class TP extends lp{constructor(a){super(iv,iv,ap,((a,v)=>this._polymorphicGreaterThanOrEqual(a,v)),TP.ClassName,a)}_polymorphicGreaterThanOrEqual(a,v){return MP(a,v,((a,v)=>a>=v))}}TP.ClassName="FGGreaterThanOrEqualBlock",(0,Z.f)(TP.ClassName,TP);class jP extends gp{constructor(a){super(iv,ap,(a=>this._polymorphicIsNan(a)),jP.ClassName,a)}_polymorphicIsNan(a){const v=ep(a);if(""===v)return isNaN(a);if("FlowGraphInteger"===v)return isNaN(a.value);throw new Error(`Cannot get NaN of ${a}`)}}jP.ClassName="FGIsNanBlock",(0,Z.f)(jP.ClassName,jP);class wP extends gp{constructor(a){super(iv,ap,(a=>this._polymorphicIsInf(a)),wP.ClassName,a)}_polymorphicIsInf(a){const v=ep(a);if(""===v)return!isFinite(a);if("FlowGraphInteger"===v)return!isFinite(a.value);throw new Error(`Cannot get isInf of ${a}`)}}wP.ClassName="FGIsInfBlock";class JP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicDegToRad(a)),JP.ClassName,a)}_degToRad(a){return a*Math.PI/180}_polymorphicDegToRad(a){return LP(a,this._degToRad)}}JP.ClassName="FGDegToRadBlock",(0,Z.f)(JP.ClassName,JP);class BP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicRadToDeg(a)),BP.ClassName,a)}_radToDeg(a){return 180*a/Math.PI}_polymorphicRadToDeg(a){return LP(a,this._radToDeg)}}BP.ClassName="FGRadToDegBlock",(0,Z.f)(BP.ClassName,BP);class xP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicSin(a)),xP.ClassName,a)}_polymorphicSin(a){return LP(a,Math.sin)}}xP.ClassName="FGSinBlock",(0,Z.f)(xP.ClassName,xP);class rP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicCos(a)),rP.ClassName,a)}_polymorphicCos(a){return LP(a,Math.cos)}}rP.ClassName="FGCosBlock",(0,Z.f)(rP.ClassName,rP);class oP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicTan(a)),oP.ClassName,a)}_polymorphicTan(a){return LP(a,Math.tan)}}oP.ClassName="FGTanBlock",(0,Z.f)(oP.ClassName,oP);class mP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicAsin(a)),mP.ClassName,a)}_polymorphicAsin(a){return LP(a,Math.asin)}}mP.ClassName="FGAsinBlock",(0,Z.f)(mP.ClassName,mP);class OP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicAcos(a)),OP.ClassName,a)}_polymorphicAcos(a){return LP(a,Math.acos)}}OP.ClassName="FGAcosBlock",(0,Z.f)(OP.ClassName,OP);class YP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicAtan(a)),YP.ClassName,a)}_polymorphicAtan(a){return LP(a,Math.atan)}}YP.ClassName="FGAtanBlock",(0,Z.f)(YP.ClassName,YP);class lP extends lp{constructor(a){super(iv,iv,iv,((a,v)=>this._polymorphicAtan2(a,v)),lP.ClassName,a)}_polymorphicAtan2(a,v){return fP(a,v,Math.atan2)}}lP.ClassName="FGAtan2Block",(0,Z.f)(lP.ClassName,lP);class zP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicSinh(a)),zP.ClassName,a)}_polymorphicSinh(a){return LP(a,Math.sinh)}}zP.ClassName="FGSinhBlock",(0,Z.f)(zP.ClassName,zP);class gP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicCosh(a)),gP.ClassName,a)}_polymorphicCosh(a){return LP(a,Math.cosh)}}gP.ClassName="FGCoshBlock",(0,Z.f)(gP.ClassName,gP);class GP extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicTanh(a)),GP.ClassName,a)}_polymorphicTanh(a){return LP(a,Math.tanh)}}GP.ClassName="FGTanhBlock",(0,Z.f)(GP.ClassName,GP);class eP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicAsinh(a)),eP.ClassName,a)}_polymorphicAsinh(a){return LP(a,Math.asinh)}}eP.ClassName="FGAsinhBlock",(0,Z.f)(eP.ClassName,eP);class kP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicAcosh(a)),kP.ClassName,a)}_polymorphicAcosh(a){return LP(a,Math.acosh)}}kP.ClassName="FGAcoshBlock",(0,Z.f)(kP.ClassName,kP);class dP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicAtanh(a)),dP.ClassName,a)}_polymorphicAtanh(a){return LP(a,Math.atanh)}}dP.ClassName="FGAtanhBlock",(0,Z.f)(dP.ClassName,dP);class EP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicExp(a)),EP.ClassName,a)}_polymorphicExp(a){return LP(a,Math.exp)}}EP.ClassName="FGExpBlock",(0,Z.f)(EP.ClassName,EP);class WP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicLog(a)),WP.ClassName,a)}_polymorphicLog(a){return LP(a,Math.log)}}WP.ClassName="FGLogBlock",(0,Z.f)(WP.ClassName,WP);class UP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicLog2(a)),UP.ClassName,a)}_polymorphicLog2(a){return LP(a,Math.log2)}}UP.ClassName="FGLog2Block",(0,Z.f)(UP.ClassName,UP);class NP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicLog10(a)),NP.ClassName,a)}_polymorphicLog10(a){return LP(a,Math.log10)}}NP.ClassName="FGLog10Block",(0,Z.f)(NP.ClassName,NP);class iP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicSqrt(a)),iP.ClassName,a)}_polymorphicSqrt(a){return LP(a,Math.sqrt)}}iP.ClassName="FGSqrtBlock",(0,Z.f)(iP.ClassName,iP);class IP extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicCubeRoot(a)),IP.ClassName,a)}_polymorphicCubeRoot(a){return LP(a,Math.cbrt)}}IP.ClassName="FGCubeRootBlock",(0,Z.f)(IP.ClassName,IP);class ab extends lp{constructor(a){super(iv,Iv,Iv,((a,v)=>this._polymorphicPow(a,v)),ab.ClassName,a)}_polymorphicPow(a,v){return fP(a,v,Math.pow)}}ab.ClassName="FGPowBlock",(0,Z.f)(ab.ClassName,ab);class vb extends gp{constructor(a){super(iv,Iv,(a=>this._polymorphicLength(a)),vb.ClassName,a)}_polymorphicLength(a){switch(ep(a)){case"Vector2":case"fb":case"Vector4":return a.length();default:throw new Error(`Cannot compute length of value ${a}`)}}}vb.ClassName="FGLengthBlock",(0,Z.f)(vb.ClassName,vb);class pb extends gp{constructor(a){super(iv,iv,(a=>this._polymorphicNormalize(a)),pb.ClassName,a)}_polymorphicNormalize(a){switch(ep(a)){case"Vector2":case"fb":case"Vector4":return a.normalize();default:throw new Error(`Cannot normalize value ${a}`)}}}pb.ClassName="FGNormalizeBlock",(0,Z.f)(pb.ClassName,pb);class Pb extends lp{constructor(a){super(pp,pp,pp,((a,v)=>b.s.Cross(a,v)),Pb.ClassName,a)}}Pb.ClassName="FGCrossBlock",(0,Z.f)(Pb.ClassName,Pb);class bb extends lp{constructor(a){super(vp,Iv,vp,((a,v)=>b.o.Transform(a,b.e.RotationZ(v))),bb.ClassName,a)}}bb.ClassName="FGRotate2DBlock",(0,Z.f)(bb.ClassName,bb);class Lb extends Gp{constructor(a){super(pp,pp,Iv,pp,((a,v,p)=>b.s.TransformCoordinates(a,b.e.RotationAxis(v,p))),Lb.ClassName,a)}}Lb.ClassName="FGRotate3DBlock",(0,Z.f)(Lb.ClassName,Lb);class tb extends gp{constructor(a){super(Pp,Pp,(a=>b.e.Transpose(a)),tb.ClassName,a)}}tb.ClassName="FGTransposeBlock",(0,Z.f)(tb.ClassName,tb);class Vb extends gp{constructor(a){super(Pp,Iv,(a=>a.determinant()),Vb.ClassName,a)}}Vb.ClassName="FGDeterminantBlock",(0,Z.f)(Vb.ClassName,Vb);class Kb extends gp{constructor(a){super(Pp,Pp,(a=>b.e.Invert(a)),Kb.ClassName,a)}}Kb.ClassName="FGInvertMatrixBlock",(0,Z.f)(Kb.ClassName,Kb);class Cb extends lp{constructor(a){super(Pp,Pp,Pp,((a,v)=>v.multiply(a)),Cb.ClassName,a)}}Cb.ClassName="FGMatMulBlock",(0,Z.f)(Cb.ClassName,Cb);class Fb extends gp{constructor(a){super(bp,bp,(a=>new Uv(~a.value)),Fb.ClassName,a)}}Fb.ClassName="FGBitwiseNotBlock",(0,Z.f)(Fb.ClassName,Fb);class ub extends lp{constructor(a){super(bp,bp,bp,((a,v)=>new Uv(a.value&v.value)),ub.ClassName,a)}}ub.ClassName="FGBitwiseAndBlock",(0,Z.f)(ub.ClassName,ub);class cb extends lp{constructor(a){super(bp,bp,bp,((a,v)=>new Uv(a.value|v.value)),cb.ClassName,a)}}cb.ClassName="FGBitwiseOrBlock",(0,Z.f)(cb.ClassName,cb);class fb extends lp{constructor(a){super(bp,bp,bp,((a,v)=>new Uv(a.value^v.value)),fb.ClassName,a)}}fb.ClassName="FGBitwiseXorBlock",(0,Z.f)(fb.ClassName,fb);class Hb extends lp{constructor(a){super(bp,bp,bp,((a,v)=>new Uv(a.value<<v.value)),Hb.ClassName,a)}}Hb.ClassName="FGBitwiseLeftShiftBlock",(0,Z.f)(Hb.ClassName,Hb);class Ab extends lp{constructor(a){super(bp,bp,bp,((a,v)=>new Uv(a.value>>v.value)),Ab.ClassName,a)}}Ab.ClassName="FGBitwiseRightShiftBlock",(0,Z.f)(Ab.ClassName,Ab);class hb extends gp{constructor(a){super(bp,bp,(a=>new Uv(Math.clz32(a.value))),hb.ClassName,a)}}hb.ClassName="FGCountLeadingZerosBlock",(0,Z.f)(hb.ClassName,hb);class Rb extends gp{constructor(a){super(bp,bp,(a=>new Uv(a.value?31-Math.clz32(a.value&-a.value):32)),Rb.ClassName,a)}}Rb.ClassName="FGCountTrailingZerosBlock",(0,Z.f)(Rb.ClassName,Rb);class Xb extends gp{constructor(a){super(bp,bp,(a=>new Uv(function(a){let v=0;for(;a;)v+=1&a,a>>=1;return v}(a.value))),Xb.ClassName,a)}}Xb.ClassName="FGCountOneBitsBlock",(0,Z.f)(Xb.ClassName,Xb);class Qb extends Sp{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Uv(0)};super(a),this.config=a,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",bp),this.value=this.registerDataOutput("value",bp)}_execute(a,v){if(v===this.reset)this.value.setValue(this.config.startIndex,a);else{const v=this.value.getValue(a);v.value<this.n.getValue(a).value&&(this.value.setValue(new Uv(v.value+1),a),this.out._activateSignal(a))}}getClassName(){return Qb.ClassName}}Qb.ClassName="FGDoNBlock",(0,Z.f)(Qb.ClassName,Qb);class sb extends Fp{constructor(a){super(a),this.config=a,this.output=this.registerDataOutput(a.variableName,iv)}_updateOutputs(a){const v=this.config.variableName;a.hasVariable(v)&&this.output.setValue(a.getVariable(v),a)}getClassName(){return sb.ClassName}serialize(a){super.serialize(a),a.config.variableName=this.config.variableName}}sb.ClassName="FGGetVariableBlock",(0,Z.f)(sb.ClassName,sb);class Db extends Sp{constructor(a){super(a),this.config=a,this.input=this.registerDataInput(a.variableName,iv)}_execute(a){const v=this.config.variableName,p=this.input.getValue(a);a.setVariable(v,p),this.out._activateSignal(a)}getClassName(){return Db.ClassName}}Db.ClassName="FGSetVariableBlock",(0,Z.f)(Db.ClassName,Db);class yb extends Sp{constructor(a){super(a),this.config=a,this.condition=this.registerDataInput("condition",ap),this.loopBody=this._registerSignalOutput("loopBody")}_execute(a,v){var p;let P=this.condition.getValue(a);for(null!==(p=this.config)&&void 0!==p&&p.isDo&&!P&&this.loopBody._activateSignal(a);P;)this.loopBody._activateSignal(a),P=this.condition.getValue(a);this.out._activateSignal(a)}getClassName(){return yb.ClassName}serialize(a){var v;super.serialize(a),a.isDo=null===(v=this.config)||void 0===v?void 0:v.isDo}}yb.ClassName="FGWhileLoopBlock",(0,Z.f)(yb.ClassName,yb);const Zb={"lifecycle/onStart":Zp.ClassName,"lifecycle/onTick":Mp.ClassName,log:np.ClassName,"flow/delay":Tp.ClassName,"customEvent/send":jp.ClassName,"customEvent/receive":wp.ClassName,"flow/sequence":Jp.ClassName,"world/get":rp.ClassName,"world/set":op.ClassName,"flow/doN":Qb.ClassName,"variable/get":sb.ClassName,"variable/set":Db.ClassName,"flow/whileLoop":yb.ClassName,"math/random":Ip.ClassName,"math/e":vP.ClassName,"math/pi":pP.ClassName,"math/inf":PP.ClassName,"math/nan":bP.ClassName,"math/abs":tP.ClassName,"math/sign":VP.ClassName,"math/trunc":KP.ClassName,"math/floor":CP.ClassName,"math/ceil":FP.ClassName,"math/fract":uP.ClassName,"math/neg":cP.ClassName,"math/add":Wp.ClassName,"math/sub":Up.ClassName,"math/mul":Np.ClassName,"math/div":ip.ClassName,"math/rem":HP.ClassName,"math/min":AP.ClassName,"math/max":hP.ClassName,"math/clamp":QP.ClassName,"math/saturate":DP.ClassName,"math/mix":yP.ClassName,"math/eq":ZP.ClassName,"math/lt":SP.ClassName,"math/le":nP.ClassName,"math/gt":qP.ClassName,"math/ge":TP.ClassName,"math/isnan":jP.ClassName,"math/isinf":wP.ClassName,"math/rad":JP.ClassName,"math/deg":BP.ClassName,"math/sin":xP.ClassName,"math/cos":rP.ClassName,"math/tan":oP.ClassName,"math/asin":mP.ClassName,"math/acos":OP.ClassName,"math/atan":YP.ClassName,"math/atan2":lP.ClassName,"math/sinh":zP.ClassName,"math/cosh":gP.ClassName,"math/tanh":GP.ClassName,"math/asinh":eP.ClassName,"math/acosh":kP.ClassName,"math/atanh":dP.ClassName,"math/exp":EP.ClassName,"math/log":WP.ClassName,"math/log2":UP.ClassName,"math/log10":NP.ClassName,"math/sqrt":iP.ClassName,"math/cbrt":IP.ClassName,"math/pow":ab.ClassName,"math/length":vb.ClassName,"math/normalize":pb.ClassName,"math/dot":aP.ClassName,"math/cross":Pb.ClassName,"math/rotate2d":bb.ClassName,"math/rotate3d":Lb.ClassName,"math/transpose":tb.ClassName,"math/determinant":Vb.ClassName,"math/inverse":Kb.ClassName,"math/matmul":Cb.ClassName,"math/not":Fb.ClassName,"math/and":ub.ClassName,"math/or":cb.ClassName,"math/xor":fb.ClassName,"math/asr":Ab.ClassName,"math/lsl":Hb.ClassName,"math/clz":hb.ClassName,"math/ctz":Rb.ClassName,"math/popcnt":Xb.ClassName},Mb={float2:"Vector2",float3:"fb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Sb(a,v,p){if(void 0!==a.type){const P=v.types&&v.types[a.type];if(!P)throw new Error(`${p}: Unknown type: ${a.type}`);const b=P.signature;if(!b)throw new Error(`${p}: Type ${a.type} has no signature`);const L=Mb[b];return{value:a.value,className:L}}return a.value}function nb(a,v,p){const P=Zb[v.type];if(!P)throw new Error(`/extensions/KHR_interactivity/nodes/${a}: Unknown block type: ${v.type}`);const b=a.toString(),L=function(a,v,p){const P={},b=a.configuration??[];for(const L of b)if("customEvent"===L.id){const a=v.customEvents&&v.customEvents[L.value];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${p}: Unknown custom event: ${L.value}`);P.eventId=a.id,P.eventData=a.values.map((a=>a.id))}else if("variable"===L.id){const a=v.variables&&v.variables[L.value];if(!a)throw new Error(`/extensions/KHR_interactivity/nodes/${p}: Unknown variable: ${L.value}`);P.variableName=a.id}else if("path"===L.id){const a=L.value;P.path=a}else P[L.id]=Sb(L,v,`/extensions/KHR_interactivity/nodes/${p}`);return P}(v,p,b);return{className:P,config:L,uniqueId:b,metadata:v.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class qb extends Zv{constructor(a){super(a,jb)}}const Tb={__array__:{__target__:!0,translation:{type:"fb",get:a=>a._babylonTransformNode.position,set:(a,v)=>{v._babylonTransformNode.position=a},getObject:a=>a._babylonTransformNode}}},jb={nodes:Tb},wb="KHR_interactivity";class Jb{constructor(a){this._loader=a,this.name=wb,this.enabled=this._loader.isExtensionUsed(wb),this._pathConverter=new qb(this._loader.Zi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var a;if(!this._loader.babylonScene||!this._pathConverter)return;const v=this._loader.babylonScene,p=function(a){const v={uniqueId:(0,Ev.b)(),_userVariables:{},_connectionValues:{}},p=[v],P=[];for(let L=0;L<a.nodes.length;L++){const v=nb(L,a.nodes[L],a);P.push(v)}for(let L=0;L<a.nodes.length;L++){const p=a.nodes[L],b=P[L],t=p.flows??[];for(const a of t){const v=a.id,p={uniqueId:(0,Ev.b)(),name:v,_connectionType:1,connectedPointIds:[]};b.signalOutputs.push(p);const t=a.node,V=a.socket,K=P[t];if(!K)throw new Error(`/extensions/KHR_interactivity/nodes/${L}: Could not find node with id ${t} that connects its input with with node ${L}'s output ${v}`);let C=K.signalInputs.find((a=>a.name===V));C||(C={uniqueId:(0,Ev.b)(),name:V,_connectionType:0,connectedPointIds:[]},K.signalInputs.push(C)),C.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(C.uniqueId)}const V=p.values??[];for(const K of V){const p=K.id,t={uniqueId:(0,Ev.b)(),name:p,_connectionType:0,connectedPointIds:[]};if(b.dataInputs.push(t),void 0!==K.value){const p=Sb(K,a,`/extensions/KHR_interactivity/nodes/${L}`);v._connectionValues[t.uniqueId]=p}else{if(void 0===K.node||void 0===K.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${L}: Invalid socket ${p} in node ${L}`);{const a=K.node,v=K.socket,b=P[a];if(!b)throw new Error(`/extensions/KHR_interactivity/nodes/${L}: Could not find node with id ${a} that connects its output with node${L}'s input ${p}`);let V=b.dataOutputs.find((a=>a.name===v));V||(V={uniqueId:(0,Ev.b)(),name:v,_connectionType:1,connectedPointIds:[]},b.dataOutputs.push(V)),t.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(t.uniqueId)}}}}const b=a.variables??[];for(let L=0;L<b.length;L++){const p=b[L],P=p.id;v._userVariables[P]=Sb(p,a,`/extensions/KHR_interactivity/variables/${L}`)}return{allBlocks:P,executionContexts:p}}(null===(a=this._loader.Zi.extensions)||void 0===a?void 0:a.KHR_interactivity),P=new yp({sd:v});Dp.Parse(p,{coordinator:P,pathConverter:this._pathConverter}),P.start()}}E(wb),d(wb,!0,(a=>new Jb(a)));const Bb="KHR_node_visibility";class xb{constructor(a){this.name=Bb,this._loader=a,this.enabled=a.isExtensionUsed(Bb)}async onReady(){var a;null===(a=this._loader.Zi.nodes)||void 0===a||a.forEach((a=>{var v,p,P,b;(null===(v=a._primitiveBabylonMeshes)||void 0===v||v.forEach((a=>{a.inheritVisibility=!0})),null!==(p=a.extensions)&&void 0!==p&&p.KHR_node_visibility)&&(!1===(null===(P=a.extensions)||void 0===P?void 0:P.KHR_node_visibility.visible)&&(a._babylonTransformNode&&(a._babylonTransformNode.isVisible=!1),null===(b=a._primitiveBabylonMeshes)||void 0===b||b.forEach((a=>{a.isVisible=!1}))))}))}dispose(){this._loader=null}}E(Bb),d(Bb,!0,(a=>new xb(a)));const rb="ExtrasAsMetadata";class ob{_assignExtras(a,v){if(v.extras&&Object.keys(v.extras).length>0){const p=a.metadata=a.metadata||{};(p.Zi=p.Zi||{}).extras=v.extras}}constructor(a){this.name=rb,this.enabled=!0,this._loader=a}dispose(){this._loader=null}loadNodeAsync(a,v,p){return this._loader.loadNodeAsync(a,v,(a=>{this._assignExtras(a,v),p(a)}))}loadCameraAsync(a,v,p){return this._loader.loadCameraAsync(a,v,(a=>{this._assignExtras(a,v),p(a)}))}createMaterial(a,v,p){const P=this._loader.createMaterial(a,v,p);return this._assignExtras(P,v),P}}E(rb),d(rb,!1,(a=>new ob(a)))},12445:(a,v,p)=>{"use strict";p.d(v,{e:()=>w,f:()=>M,h:()=>Z,i:()=>S});var P=p(10893),b=p(10889),L=p(11607),t=p(11504),V=p(11544),K=p(11539),C=p(10905),F=p(10939),u=p(12450),c=p(12456),f=p(11512);class H{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Bj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.kk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(a){this._environmentTexture=a}getNodes(){let a=[];return a=a.concat(this.meshes),a=a.concat(this.lights),a=a.concat(this.cameras),a=a.concat(this.transformNodes),this.skeletons.forEach((v=>a=a.concat(v.bones))),a}}class A extends H{}class h{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((a=>{a.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((a=>{a.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((a=>{a.dispose()})),this.animationGroups.length=0}}class R extends H{constructor(a){super(),this._wasAddedToScene=!1,(a=a||F.b.LastCreatedScene)&&(this.sd=a,this.proceduralTextures=[],a.uj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=a.getEngine().onContextRestoredObservable.add((()=>{for(const a of this.geometries)a._rebuild();for(const a of this.meshes)a._rebuild();for(const a of this.Bj)a.rebuild();for(const a of this.textures)a._rebuild()})))}_topologicalSort(a){const v=new Map;for(const t of a)v.set(t.uniqueId,t);const p={dependsOn:new Map,dependedBy:new Map};for(const t of a){const a=t.uniqueId;p.dependsOn.set(a,new Set),p.dependedBy.set(a,new Set)}for(const t of a){const a=t.uniqueId,P=p.dependsOn.get(a);if(t instanceof u.b){const b=t.sourceMesh;v.has(b.uniqueId)&&(P.add(b.uniqueId),p.dependedBy.get(b.uniqueId).add(a))}const b=p.dependedBy.get(a);for(const L of t.getDescendants()){const P=L.uniqueId;if(v.has(P)){b.add(P);p.dependsOn.get(P).add(a)}}}const P=[],b=[];for(const t of a){const a=t.uniqueId;0===p.dependsOn.get(a).size&&(b.push(t),v.delete(a))}const L=b;for(;L.length>0;){const a=L.shift();P.push(a);const b=p.dependedBy.get(a.uniqueId);for(const P of Array.from(b.values())){const b=p.dependsOn.get(P);b.delete(a.uniqueId),0===b.size&&v.get(P)&&(L.push(v.get(P)),v.delete(P))}}return v.size>0&&(C.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),v.forEach((a=>C.d.Error(a.name)))),P}_addNodeAndDescendantsToList(a,v,p,P){if(p&&(!P||P(p))&&!v.has(p.uniqueId)){a.push(p),v.add(p.uniqueId);for(const b of p.getDescendants(!0))this._addNodeAndDescendantsToList(a,v,b,P)}}_isNodeInContainer(a){return a instanceof K.e&&-1!==this.meshes.indexOf(a)||(a instanceof V.c&&-1!==this.transformNodes.indexOf(a)||(a instanceof c.b&&-1!==this.lights.indexOf(a)||a instanceof f.e&&-1!==this.cameras.indexOf(a)))}_isValidHierarchy(){for(const a of this.meshes)if(a.parent&&!this._isNodeInContainer(a.parent))return C.d.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.transformNodes)if(a.parent&&!this._isNodeInContainer(a.parent))return C.d.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.lights)if(a.parent&&!this._isNodeInContainer(a.parent))return C.d.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.cameras)if(a.parent&&!this._isNodeInContainer(a.parent))return C.d.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(a){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||b.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const P={},L={},V=new h,K=[],C=[],F={doNotInstantiate:!0,...p},u=[],c=new Set;for(const b of this.transformNodes)null===b.parent&&this._addNodeAndDescendantsToList(u,c,b,F.predicate);for(const b of this.meshes)null===b.parent&&this._addNodeAndDescendantsToList(u,c,b,F.predicate);const f=this._topologicalSort(u),H=(p,b)=>{if(((v,p)=>{if(P[v.uniqueId]=p.uniqueId,L[p.uniqueId]=p,a&&(p.name=a(v.name)),p instanceof t.b){const a=p;if(a.morphTargetManager){const p=v.morphTargetManager;a.morphTargetManager=p.clone();for(let v=0;v<p.numTargets;v++){const b=p.getTarget(v),t=a.morphTargetManager.getTarget(v);P[b.uniqueId]=t.uniqueId,L[t.uniqueId]=t}}}})(p,b),p.parent){const a=P[p.parent.uniqueId],v=L[a];b.parent=v||p.parent}if(b.position&&p.position&&b.position.p(p.position),b.rotationQuaternion&&p.rotationQuaternion&&b.rotationQuaternion.p(p.rotationQuaternion),b.rotation&&p.rotation&&b.rotation.p(p.rotation),b.te&&p.te&&b.te.p(p.te),b.material){const t=b;if(t.material)if(v){const v=p.material;if(-1===C.indexOf(v)){let p=v.clone(a?a(v.name):"Clone of "+v.name);if(C.push(v),P[v.uniqueId]=p.uniqueId,L[p.uniqueId]=p,"MultiMaterial"===v.getClassName()){const b=v;for(const v of b.sg)v&&(p=v.clone(a?a(v.name):"Clone of "+v.name),C.push(v),P[v.uniqueId]=p.uniqueId,L[p.uniqueId]=p);b.sg=b.sg.map((a=>a&&L[P[a.uniqueId]]))}}"InstancedMesh"!==t.getClassName()&&(t.material=L[P[v.uniqueId]])}else"MultiMaterial"===t.material.getClassName()?-1===this.sd.multiMaterials.indexOf(t.material)&&this.sd.addMultiMaterial(t.material):-1===this.sd.materials.indexOf(t.material)&&this.sd.addMaterial(t.material)}null===b.parent&&V.rootNodes.push(b)};return f.forEach((a=>{if("InstancedMesh"===a.getClassName()){const v=a,p=v.sourceMesh,b=P[p.uniqueId],t=("number"===typeof b?L[b]:p).createInstance(v.name);H(v,t)}else{let v=!0;"rb"===a.getClassName()||"Node"===a.getClassName()||a.skeleton||!a.getTotalVertices||0===a.getTotalVertices()?v=!1:F.doNotInstantiate&&(v="function"===typeof F.doNotInstantiate?!F.doNotInstantiate(a):!F.doNotInstantiate);const p=v?a.createInstance(`instance of ${a.name}`):a.clone(`Clone of ${a.name}`,null,!0);if(!p)throw new Error(`Could not clone or instantiate node on Asset Container ${a.name}`);H(a,p)}})),this.skeletons.forEach((v=>{if(F.predicate&&!F.predicate(v))return;const p=v.clone(a?a(v.name):"Clone of "+v.name);for(const a of this.meshes)if(a.skeleton===v&&!a.isAnInstance){const v=L[P[a.uniqueId]];if(!v||v.isAnInstance)continue;if(v.skeleton=p,-1!==K.indexOf(p))continue;K.push(p);for(const a of p.bones)a._linkedTransformNode&&(a._linkedTransformNode=L[P[a._linkedTransformNode.uniqueId]])}V.skeletons.push(p)})),this.animationGroups.forEach((v=>{if(F.predicate&&!F.predicate(v))return;const p=v.clone(a?a(v.name):"Clone of "+v.name,(a=>L[P[a.uniqueId]]||a));V.animationGroups.push(p)})),V}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||b.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.sd.environmentTexture=this.environmentTexture);for(const a of this.sd._serializableComponents)a.addFromContainer(this);this.sd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const v=[];this.cameras.forEach((p=>{a&&!a(p)||(this.sd.addCamera(p),v.push(p))})),this.lights.forEach((p=>{a&&!a(p)||(this.sd.addLight(p),v.push(p))})),this.meshes.forEach((p=>{a&&!a(p)||(this.sd.xi(p),v.push(p))})),this.skeletons.forEach((v=>{a&&!a(v)||this.sd.addSkeleton(v)})),this.animations.forEach((v=>{a&&!a(v)||this.sd.addAnimation(v)})),this.animationGroups.forEach((v=>{a&&!a(v)||this.sd.addAnimationGroup(v)})),this.multiMaterials.forEach((v=>{a&&!a(v)||this.sd.addMultiMaterial(v)})),this.materials.forEach((v=>{a&&!a(v)||this.sd.addMaterial(v)})),this.morphTargetManagers.forEach((v=>{a&&!a(v)||this.sd.addMorphTargetManager(v)})),this.geometries.forEach((v=>{a&&!a(v)||this.sd.addGeometry(v)})),this.transformNodes.forEach((p=>{a&&!a(p)||(this.sd.addTransformNode(p),v.push(p))})),this.actionManagers.forEach((v=>{a&&!a(v)||this.sd.addActionManager(v)})),this.textures.forEach((v=>{a&&!a(v)||this.sd.addTexture(v)})),this.reflectionProbes.forEach((v=>{a&&!a(v)||this.sd.addReflectionProbe(v)}));for(const p of v)p.parent&&-1===this.sd.getNodes().indexOf(p.parent)&&(p.setParent?p.setParent(null):p.parent=null)}removeAllFromScene(){this._isValidHierarchy()||b.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.sd.environmentTexture&&(this.sd.environmentTexture=null);for(const a of this.sd._serializableComponents)a.removeFromContainer(this)}removeFromScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((v=>{a&&!a(v)||this.sd.removeCamera(v)})),this.lights.forEach((v=>{a&&!a(v)||this.sd.removeLight(v)})),this.meshes.forEach((v=>{a&&!a(v)||this.sd.Qc(v,!0)})),this.skeletons.forEach((v=>{a&&!a(v)||this.sd.removeSkeleton(v)})),this.animations.forEach((v=>{a&&!a(v)||this.sd.removeAnimation(v)})),this.animationGroups.forEach((v=>{a&&!a(v)||this.sd.removeAnimationGroup(v)})),this.multiMaterials.forEach((v=>{a&&!a(v)||this.sd.removeMultiMaterial(v)})),this.materials.forEach((v=>{a&&!a(v)||this.sd.removeMaterial(v)})),this.morphTargetManagers.forEach((v=>{a&&!a(v)||this.sd.removeMorphTargetManager(v)})),this.geometries.forEach((v=>{a&&!a(v)||this.sd.removeGeometry(v)})),this.transformNodes.forEach((v=>{a&&!a(v)||this.sd.removeTransformNode(v)})),this.actionManagers.forEach((v=>{a&&!a(v)||this.sd.removeActionManager(v)})),this.textures.forEach((v=>{a&&!a(v)||this.sd.removeTexture(v)})),this.reflectionProbes.forEach((v=>{a&&!a(v)||this.sd.removeReflectionProbe(v)}))}dispose(){this.cameras.slice(0).forEach((a=>{a.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((a=>{a.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((a=>{a.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((a=>{a.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((a=>{a.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((a=>{a.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((a=>{a.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((a=>{a.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((a=>{a.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((a=>{a.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((a=>{a.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((a=>{a.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((a=>{a.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const a of this.sd._serializableComponents)a.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.sd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(a,v,p){if(a&&v)for(const P of a){let a=!0;if(p)for(const v of p)if(P===v){a=!1;break}a&&(v.push(P),P._parentContainer=this)}}moveAllFromScene(a){this._wasAddedToScene=!1,void 0===a&&(a=new A);for(const v in this)Object.prototype.hasOwnProperty.call(this,v)&&(this[v]=this[v]||("_environmentTexture"===v?null:[]),this._moveAssets(this.sd[v],this[v],a[v]));this.environmentTexture=this.sd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const a=new t.b("assetContainerRootMesh",this.sd);return this.meshes.forEach((v=>{v.parent||a.addChild(v)})),this.meshes.unshift(a),a}mergeAnimationsTo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.b.LastCreatedScene,v=arguments.length>1?arguments[1]:void 0,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!a)return C.d.Error("No scene available to merge animations to"),[];const P=p||(v=>{let p=null;const P=v.animations.length?v.animations[0].targetProperty:"",b=v.name.split(".").join("").split("_primitive")[0];switch(P){case"position":case"rotationQuaternion":p=a.getTransformNodeByName(v.name)||a.getTransformNodeByName(b);break;case"influence":p=a.getMorphTargetByName(v.name)||a.getMorphTargetByName(b);break;default:p=a.getNodeByName(v.name)||a.getNodeByName(b)}return p});this.getNodes().forEach((a=>{const v=P(a);if(null!==v){for(const p of a.animations){const a=v.animations.filter((a=>a.targetProperty===p.targetProperty));for(const p of a){const a=v.animations.indexOf(p,0);a>-1&&v.animations.splice(a,1)}}v.animations=v.animations.concat(a.animations)}}));const b=[];return this.animationGroups.slice().forEach((a=>{b.push(a.clone(a.name,P)),a.animatables.forEach((a=>{a.stop()}))})),v.forEach((v=>{const p=P(v.target);p&&(a.beginAnimation(p,v.fromFrame,v.toFrame,v.loopAnimation,v.speedRatio,v.onAnimationEnd?v.onAnimationEnd:void 0,void 0,!0,void 0,v.onAnimationLoop?v.onAnimationLoop:void 0),a.stopAnimation(v.target))})),b}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((a=>{a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)})),this.transformNodes.forEach((a=>{a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)})),this.lights.forEach((a=>{a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)})),this.cameras.forEach((a=>{a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)}))}addAllAssetsToContainer(a){if(!a)return;const v=[],p=new Set;for(v.push(a);v.length>0;){const a=v.pop();if(a instanceof t.b?(a.Oj&&-1===this.geometries.indexOf(a.Oj)&&this.geometries.push(a.Oj),this.meshes.push(a)):a instanceof V.c?this.transformNodes.push(a):a instanceof c.b?this.lights.push(a):a instanceof f.e&&this.cameras.push(a),a instanceof K.e){if(a.material&&-1===this.materials.indexOf(a.material)){this.materials.push(a.material);for(const v of a.material.getActiveTextures())-1===this.textures.indexOf(v)&&this.textures.push(v)}a.skeleton&&-1===this.skeletons.indexOf(a.skeleton)&&this.skeletons.push(a.skeleton),a.morphTargetManager&&-1===this.morphTargetManagers.indexOf(a.morphTargetManager)&&this.morphTargetManagers.push(a.morphTargetManager)}for(const P of a.getChildren())p.has(P)||v.push(P);p.add(a)}this.populateRootNodes()}}var X=p(10959);class Q{constructor(a){this.byteOffset=0,this.buffer=a}loadAsync(a){return this.buffer.readAsync(this.byteOffset,a).then((a=>{this._dataView=new DataView(a.buffer,a.byteOffset,a.byteLength),this._dataByteOffset=0}))}readUint32(){const a=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,a}readUint8Array(a){const v=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,a);return this._dataByteOffset+=a,this.byteOffset+=a,v}readString(a){return(0,X.j)(this.readUint8Array(a))}skipBytes(a){this._dataByteOffset+=a,this.byteOffset+=a}}var s=p(12462);const D="Z2xURg",y={name:"Zi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:a=>-1!==a.indexOf("asset")&&-1!==a.indexOf("version")||a.startsWith("data:base64,"+D)||a.startsWith("data:;base64,"+D)||a.startsWith("data:application/octet-stream;base64,"+D)||a.startsWith("data:model/gltf-binary;base64,"+D)};var Z,M,S,n=p(10947),q=p(10955);function T(a,v,p){try{return Promise.resolve(new Uint8Array(a,v,p))}catch(P){return Promise.reject(P)}}!function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Z||(Z={})),function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"}(M||(M={})),function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"}(S||(S={}));class j{constructor(){this.coordinateSystemMode=Z.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=a=>Promise.resolve(a),this.extensionOptions={}}p(a){a&&(this.onParsed=a.onParsed,this.coordinateSystemMode=a.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=a.animationStartMode??this.animationStartMode,this.loadNodeAnimations=a.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=a.loadSkins??this.loadSkins,this.loadMorphTargets=a.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=a.compileMaterials??this.compileMaterials,this.useClipPlane=a.useClipPlane??this.useClipPlane,this.compileShadowGenerators=a.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=a.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=a.useRangeRequests??this.useRangeRequests,this.createInstances=a.createInstances??this.createInstances,this.alwaysComputeBoundingBox=a.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=a.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=a.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=a.skipMaterials??this.skipMaterials,this.useSRGBBuffers=a.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=a.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=a.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=a.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=a.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=a.customRootNode,this.onMeshLoaded=a.onMeshLoaded,this.onSkinLoaded=a.onSkinLoaded,this.onTextureLoaded=a.onTextureLoaded,this.onMaterialLoaded=a.onMaterialLoaded,this.onCameraLoaded=a.onCameraLoaded,this.extensionOptions=a.extensionOptions??this.extensionOptions)}}class w extends j{constructor(a){super(),this.onParsedObservable=new P.c,this.onMeshLoadedObservable=new P.c,this.onSkinLoadedObservable=new P.c,this.onTextureLoadedObservable=new P.c,this.onMaterialLoadedObservable=new P.c,this.onCameraLoadedObservable=new P.c,this.onCompleteObservable=new P.c,this.onErrorObservable=new P.c,this.uj=new P.c,this.onExtensionLoadedObservable=new P.c,this.validate=!1,this.onValidatedObservable=new P.c,this._loader=null,this._state=null,this._requests=new Array,this.name=y.name,this.extensions=y.extensions,this.onLoaderStateChangedObservable=new P.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(a)}set onParsed(a){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),a&&(this._onParsedObserver=this.onParsedObservable.add(a))}set onMeshLoaded(a){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),a&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(a))}set onSkinLoaded(a){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),a&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((v=>a(v.node,v.skinnedNode))))}set onTextureLoaded(a){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),a&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(a))}set onMaterialLoaded(a){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),a&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(a))}set onCameraLoaded(a){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),a&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(a))}set onComplete(a){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(a)}set onError(a){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(a)}set onDispose(a){this._onDisposeObserver&&this.uj.remove(this._onDisposeObserver),this._onDisposeObserver=this.uj.add(a)}set onExtensionLoaded(a){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(a)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(a){this._loggingEnabled!==a&&(this._loggingEnabled=a,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(a){this._capturePerformanceCounters!==a&&(this._capturePerformanceCounters=a,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(a){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(a)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const a of this._requests)a.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=a=>Promise.resolve(a),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.uj.notifyObservers(void 0),this.uj.clear()}loadFile(a,v,p,L,t,V,K,F){if(ArrayBuffer.isView(v))return this._loadBinary(a,v,p,L,K,F),null;this._progressCallback=t;const u=v.name||b.e.GetFilename(v);if(V){if(this.useRangeRequests){this.validate&&C.d.Warn("glTF validation is not supported when range requests are enabled");const p={abort:()=>{},onCompleteObservable:new P.c},b={readAsync:(p,P)=>new Promise(((b,L)=>{this._loadFile(a,v,(a=>{b(new Uint8Array(a))}),!0,(a=>{L(a)}),(a=>{a.setRequestHeader("Range",`bytes=${p}-${p+P-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Q(b)).then((a=>{p.onCompleteObservable.notifyObservers(p),L(a)}),K?a=>K(void 0,a):void 0),p}return this._loadFile(a,v,(v=>{this._validate(a,new Uint8Array(v,0,v.byteLength),p,u),this._unpackBinaryAsync(new Q({readAsync:(a,p)=>T(v,a,p),byteLength:v.byteLength})).then((a=>{L(a)}),K?a=>K(void 0,a):void 0)}),!0,K)}return this._loadFile(a,v,(v=>{try{this._validate(a,v,p,u),L({json:this._parseJson(v)})}catch{K&&K()}}),!1,K)}_loadBinary(a,v,p,P,b,L){this._validate(a,new Uint8Array(v.buffer,v.byteOffset,v.byteLength),p,L),this._unpackBinaryAsync(new Q({readAsync:(a,p)=>function(a,v,p){try{if(v<0||v>=a.byteLength)throw new RangeError("Offset is out of range.");if(v+p>a.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(a.buffer,a.byteOffset+v,p))}catch(P){return Promise.reject(P)}}(v,a,p),byteLength:v.byteLength})).then((a=>{P(a)}),b?a=>b(void 0,a):void 0)}importMeshAsync(a,v,p,P,b,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(p),this._loader.importMeshAsync(a,v,null,p,P,b,L))))}loadAsync(a,v,p,P,b){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(v),this._loader.loadAsync(a,v,p,P,b))))}loadAssetContainerAsync(a,v,p,P,b){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(v),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(v);const L=new R(a),t=[];this.onMaterialLoadedObservable.add((a=>{t.push(a)}));const V=[];this.onTextureLoadedObservable.add((a=>{V.push(a)}));const K=[];this.onCameraLoadedObservable.add((a=>{K.push(a)}));const C=[];return this.onMeshLoadedObservable.add((a=>{a.morphTargetManager&&C.push(a.morphTargetManager)})),this._loader.importMeshAsync(null,a,L,v,p,P,b).then((a=>(Array.prototype.push.apply(L.geometries,a.geometries),Array.prototype.push.apply(L.meshes,a.meshes),Array.prototype.push.apply(L.Bj,a.Bj),Array.prototype.push.apply(L.skeletons,a.skeletons),Array.prototype.push.apply(L.animationGroups,a.animationGroups),Array.prototype.push.apply(L.materials,t),Array.prototype.push.apply(L.textures,V),Array.prototype.push.apply(L.lights,a.lights),Array.prototype.push.apply(L.transformNodes,a.transformNodes),Array.prototype.push.apply(L.cameras,K),Array.prototype.push.apply(L.morphTargetManagers,C),L)))}))}canDirectLoad(a){return y.canDirectLoad(a)}directLoad(a,v){if(v.startsWith("base64,"+D)||v.startsWith(";base64,"+D)||v.startsWith("application/octet-stream;base64,"+D)||v.startsWith("model/gltf-binary;base64,"+D)){const p=(0,n.e)(v);return this._validate(a,new Uint8Array(p,0,p.byteLength)),this._unpackBinaryAsync(new Q({readAsync:(a,v)=>T(p,a,v),byteLength:p.byteLength}))}return this._validate(a,v),Promise.resolve({json:this._parseJson(v)})}createPlugin(a){return new w(a[y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((a,v)=>{this.onCompleteObservable.addOnce((()=>{a()})),this.onErrorObservable.addOnce((a=>{v(a)}))}))}_setState(a){this._state!==a&&(this._state=a,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(S[this._state]))}_loadFile(a,v,p,P,b,L){const t=a._loadFile(v,p,(a=>{this._onProgress(a,t)}),!0,P,b,L);return t.onCompleteObservable.add((()=>{t._lengthComputable=!0,t._total=t._loaded})),this._requests.push(t),t}_onProgress(a,v){if(!this._progressCallback)return;v._lengthComputable=a.lengthComputable,v._loaded=a.loaded,v._total=a.total;let p=!0,P=0,b=0;for(const L of this._requests){if(void 0===L._lengthComputable||void 0===L._loaded||void 0===L._total)return;p=p&&L._lengthComputable,P+=L._loaded,b+=L._total}this._progressCallback({lengthComputable:p,loaded:P,total:p?b:0})}_validate(a,v){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.d.ValidateAsync(v,p,P,(v=>this.preprocessUrlAsync(p+v).then((v=>a._loadFileAsync(v,void 0,!0,!0).then((a=>new Uint8Array(a,0,a.byteLength))))))).then((a=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(a),this.onValidatedObservable.clear()}),(a=>{this._endPerformanceCounter("Validate JSON"),b.e.Warn(`Failed to validate: ${a.message}`),this.onValidatedObservable.clear()})))}_getLoader(a){const v=a.json.asset||{};this._log(`Asset version: ${v.version}`),v.minVersion&&this._log(`Asset minimum version: ${v.minVersion}`),v.generator&&this._log(`Asset generator: ${v.generator}`);const p=w._parseVersion(v.version);if(!p)throw new Error("Invalid version: "+v.version);if(void 0!==v.minVersion){const a=w._parseVersion(v.minVersion);if(!a)throw new Error("Invalid minimum version: "+v.minVersion);if(w._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+v.minVersion)}const P={1:w._CreateGLTF1Loader,2:w._CreateGLTF2Loader}[p.major];if(!P)throw new Error("Unsupported version: "+v.version);return P(this)}_parseJson(a){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${a.length}`);const v=JSON.parse(a);return this._endPerformanceCounter("Parse JSON"),v}_unpackBinaryAsync(a){return this._startPerformanceCounter("Unpack Binary"),a.loadAsync(20).then((()=>{const v=a.readUint32();if(1179937895!==v)throw new q.g("Unexpected magic: "+v,q.e.GLTFLoaderUnexpectedMagicError);const p=a.readUint32();this.loggingEnabled&&this._log(`Binary version: ${p}`);const P=a.readUint32();let b;switch(this.useRangeRequests||P===a.buffer.byteLength||C.d.Warn(`Length in header does not match actual data length: ${P} != ${a.buffer.byteLength}`),p){case 1:b=this._unpackBinaryV1Async(a,P);break;case 2:b=this._unpackBinaryV2Async(a,P);break;default:throw new Error("Unsupported version: "+p)}return this._endPerformanceCounter("Unpack Binary"),b}))}_unpackBinaryV1Async(a,v){const p=a.readUint32(),P=a.readUint32();if(0!==P)throw new Error(`Unexpected content format: ${P}`);const b=v-a.byteOffset,L={json:this._parseJson(a.readString(p)),bin:null};if(0!==b){const v=a.byteOffset;L.bin={readAsync:(p,P)=>a.buffer.readAsync(v+p,P),byteLength:b}}return Promise.resolve(L)}_unpackBinaryV2Async(a,v){const p=1313821514,P=5130562,b=a.readUint32();if(a.readUint32()!==p)throw new Error("First chunk format is not JSON");return a.byteOffset+b===v?a.loadAsync(b).then((()=>({json:this._parseJson(a.readString(b)),bin:null}))):a.loadAsync(b+8).then((()=>{const L={json:this._parseJson(a.readString(b)),bin:null},t=()=>{const b=a.readUint32();switch(a.readUint32()){case p:throw new Error("Unexpected JSON chunk");case P:{const v=a.byteOffset;L.bin={readAsync:(p,P)=>a.buffer.readAsync(v+p,P),byteLength:b},a.skipBytes(b);break}default:a.skipBytes(b)}return a.byteOffset!==v?a.loadAsync(8).then(t):Promise.resolve(L)};return t()}))}static _parseVersion(a){if("1.0"===a||"1.0.1"===a)return{major:1,minor:0};const v=(a+"").match(/^(\d+)\.(\d+)/);return v?{major:parseInt(v[1]),minor:parseInt(v[2])}:null}static _compareVersion(a,v){return a.major>v.major?1:a.major<v.major?-1:a.minor>v.minor?1:a.minor<v.minor?-1:0}_logOpen(a){this._log(a),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(a){const v=w._logSpaces.substring(0,2*this._logIndentLevel);C.d.Log(`${v}${a}`)}_logDisabled(a){}_startPerformanceCounterEnabled(a){b.e.StartPerformanceCounter(a)}_startPerformanceCounterDisabled(a){}_endPerformanceCounterEnabled(a){b.e.EndPerformanceCounter(a)}_endPerformanceCounterDisabled(a){}}w.IncrementalLoading=!0,w.HomogeneousCoordinates=!1,w._logSpaces="                                ",(0,L.h)(new w)},12462:(a,v,p)=>{"use strict";p.d(v,{d:()=>t});var P=p(10889);function b(a,v,p,P){const b={externalResourceFunction:P};return p&&(b.uri="file:"===v?p:v+p),ArrayBuffer.isView(a)?GLTFValidator.validateBytes(a,b):GLTFValidator.validateString(a,b)}function L(){const a=[];onmessage=v=>{const p=v.data;switch(p.id){case"init":importScripts(p.url);break;case"validate":b(p.data,p.rootUrl,p.fileName,(v=>new Promise(((p,P)=>{const b=a.length;a.push({resolve:p,reject:P}),postMessage({id:"getExternalResource",index:b,uri:v})})))).then((a=>{postMessage({id:"validate.resolve",value:a})}),(a=>{postMessage({id:"validate.reject",reason:a})}));break;case"getExternalResource.resolve":a[p.index].resolve(p.value);break;case"getExternalResource.reject":a[p.index].reject(p.reason)}}}class t{static ValidateAsync(a,v,p,t){return"function"===typeof Worker?new Promise(((V,K)=>{const C=`${b}(${L})()`,F=URL.createObjectURL(new Blob([C],{type:"application/javascript"})),u=new Worker(F),c=a=>{u.removeEventListener("error",c),u.removeEventListener("message",f),K(a)},f=a=>{const v=a.data;switch(v.id){case"getExternalResource":t(v.uri).then((a=>{u.postMessage({id:"getExternalResource.resolve",index:v.index,value:a},[a.buffer])}),(a=>{u.postMessage({id:"getExternalResource.reject",index:v.index,reason:a})}));break;case"validate.resolve":u.removeEventListener("error",c),u.removeEventListener("message",f),V(v.value),u.terminate();break;case"validate.reject":u.removeEventListener("error",c),u.removeEventListener("message",f),K(v.reason),u.terminate()}};if(u.addEventListener("error",c),u.addEventListener("message",f),u.postMessage({id:"init",url:P.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(a)){const P=a.slice();u.postMessage({id:"validate",data:P,rootUrl:v,fileName:p},[P.buffer])}else u.postMessage({id:"validate",data:a,rootUrl:v,fileName:p})})):(this._LoadScriptPromise||(this._LoadScriptPromise=P.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>b(a,v,p,t))))}}t.Configuration={url:`${P.e._DefaultCdnUrl}/gltf_validator.js`}},12881:(a,v,p)=>{"use strict";p.d(v,{e:()=>Z});var P=p(11207),b=p(11210),L=p(11287),t=p(11240),V=p(11454),K=p(11456),C=p(11306),F=p(11229),u=p(11027),c=p(10982);p(11858),p(11786),p(11802),p(11791),p(11805),p(11809),p(11811);const f="imageProcessingCompatibility",H="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";c.e.IncludesShadersStore[f]=H;const A="skyPixelShader",h="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";c.e.ShadersStore[A]=h;p(11872),p(11815),p(11821),p(11826),p(11823);const R="skyVertexShader",X="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";c.e.ShadersStore[R]=X;var Q=p(11481),s=p(11448),D=p(11440);class y extends V.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends K.c{constructor(a,v){super(a,v),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new t.s(0,100,0),this.useSunPosition=!1,this.cameraOffset=t.s.Zero(),this.up=t.s.Up(),this.dithering=!1,this._cameraPosition=t.s.Zero(),this._skyOrientation=new t.i}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(a,v){const p=v._drawWrapper;if(this.isFrozen&&p.effect&&p._wasPreviouslyReady)return!0;v.materialDefines||(v.materialDefines=new y);const P=v.materialDefines,b=this.va();if(this._isReadyForSubMesh(v))return!0;if((0,D.U)(a,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,P),(0,D.J)(a,P,!0,!1),P.IMAGEPROCESSINGPOSTPROCESS!==b.imageProcessingConfiguration.applyByPostProcess&&P.markAsMiscDirty(),P.DITHER!==this.dithering&&P.markAsMiscDirty(),P.isDirty){P.markAsProcessed(),b.resetCachedMaterial();const a=new Q.b;P.FOG&&a.addFallback(1,"FOG"),P.IMAGEPROCESSINGPOSTPROCESS=b.imageProcessingConfiguration.applyByPostProcess,P.DITHER=this.dithering;const p=[C.f.PositionKind];P.VERTEXCOLOR&&p.push(C.f.ColorKind);const L="sky",t=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.e)(t);const V=P.toString();v.setEffect(b.getEngine().createEffect(L,p,t,[],V,a,this.onCompiled,this.onError),P,this._materialContext)}return!(!v.effect||!v.effect.isReady())&&(P._renderId=b.getRenderId(),p._wasPreviouslyReady=!0,!0)}bindForSubMesh(a,v,p){const P=this.va(),b=p.materialDefines;if(!b)return;const L=p.effect;if(!L)return;this._activeEffect=L,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",P.getTransformMatrix()),this._mustRebind(P,L,p)&&((0,s.g)(L,this,P),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,D.j)(b,L,P)),P.fogEnabled&&v.applyFog&&P.fogMode!==F.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",P.getViewMatrix()),(0,D.c)(P,v,this._activeEffect);const V=P.activeCamera;if(V){const a=V.getWorldMatrix();this._cameraPosition.x=a.m[12],this._cameraPosition.y=a.m[13],this._cameraPosition.z=a.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const a=Math.PI*(this.inclination-.5),v=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(v)*Math.cos(a),this.sunPosition.y=this.distance*Math.sin(-a),this.sunPosition.z=this.distance*Math.sin(v)*Math.cos(a),t.i.FromUnitVectorsToRef(t.s.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(v,this._activeEffect,p)}getAnimatables(){return[]}dispose(a){super.dispose(a)}clone(a){return L.b.Clone((()=>new Z(a,this.va())),this)}serialize(){const a=super.serialize();return a.customType="BABYLON.SkyMaterial",a}getClassName(){return"SkyMaterial"}static Parse(a,v,p){return L.b.Parse((()=>new Z(a.name,v)),a,v,p)}}(0,P.e)([(0,b.O)()],Z.prototype,"luminance",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"turbidity",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"rayleigh",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"mieCoefficient",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"mieDirectionalG",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"distance",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"inclination",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"azimuth",void 0),(0,P.e)([(0,b.M)()],Z.prototype,"sunPosition",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"useSunPosition",void 0),(0,P.e)([(0,b.M)()],Z.prototype,"cameraOffset",void 0),(0,P.e)([(0,b.M)()],Z.prototype,"up",void 0),(0,P.e)([(0,b.O)()],Z.prototype,"dithering",void 0),(0,u.f)("BABYLON.SkyMaterial",Z)},10726:(a,v,p)=>{"use strict";function P(a,v){v.headers=a.headers||{},v.statusMessage=a.statusText,v.statusCode=a.status,v.data=a.response}function b(a,v,p){return new Promise((function(b,L){p=p||{};var t,V,K,C=new XMLHttpRequest,F=p.body,u=p.headers||{};for(t in p.timeout&&(C.timeout=p.timeout),C.ontimeout=C.onerror=function(a){a.timeout="timeout"==a.type,L(a)},C.open(a,v.href||v),C.onload=function(){for(K=C.getAllResponseHeaders().trim().split(/[\r\n]+/),P(C,C);V=K.shift();)V=V.split(": "),C.headers[V.shift().toLowerCase()]=V.join(": ");if((V=C.headers["content-type"])&&~V.indexOf("application/json"))try{C.data=JSON.parse(C.data,p.reviver)}catch(a){return P(C,a),L(a)}(C.status>=400?L:b)(C)},typeof FormData<"u"&&F instanceof FormData||F&&"object"==typeof F&&(u["content-type"]="application/json",F=JSON.stringify(F)),C.withCredentials=!!p.withCredentials,u)C.setRequestHeader(t,u[t]);C.send(F)}))}p.r(v),p.d(v,{del:()=>K,get:()=>L,patch:()=>V,post:()=>t,put:()=>C,send:()=>b});var L=b.bind(b,"GET"),t=b.bind(b,"POST"),V=b.bind(b,"PATCH"),K=b.bind(b,"DELETE"),C=b.bind(b,"PUT")},12971:(a,v,p)=>{"use strict";p.d(v,{b:()=>u});const P=.5*(Math.sqrt(3)-1),b=(3-Math.sqrt(3))/6,L=1/3,t=1/6,V=(Math.sqrt(5)-1)/4,K=(5-Math.sqrt(5))/20,C=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),F=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const u=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const v="function"==typeof a?a:function(a){let v=0,p=0,P=0,b=1;const L=function(){let a=4022871197;return function(v){v=v.toString();for(let p=0;p<v.length;p++){a+=v.charCodeAt(p);let P=.02519603282416938*a;a=P>>>0,P-=a,P*=a,a=P>>>0,P-=a,a+=4294967296*P}return 2.3283064365386963e-10*(a>>>0)}}();v=L(" "),p=L(" "),P=L(" "),v-=L(a),v<0&&(v+=1);p-=L(a),p<0&&(p+=1);P-=L(a),P<0&&(P+=1);return function(){const a=2091639*v+2.3283064365386963e-10*b;return v=p,p=P,P=a-(b=0|a)}}(a);this.p=function(a){const v=new Uint8Array(256);for(let p=0;p<256;p++)v[p]=p;for(let p=0;p<255;p++){const P=p+~~(a()*(256-p)),b=v[p];v[p]=v[P],v[P]=b}return v}(v),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let p=0;p<512;p++)this.perm[p]=this.p[255&p],this.permMod12[p]=this.perm[p]%12}noise2D(a,v){const p=this.permMod12,L=this.perm;let t=0,V=0,K=0;const F=(a+v)*P,u=Math.floor(a+F),c=Math.floor(v+F),f=(u+c)*b,H=a-(u-f),A=v-(c-f);let h,R;H>A?(h=1,R=0):(h=0,R=1);const X=H-h+b,Q=A-R+b,s=H-1+2*b,D=A-1+2*b,y=255&u,Z=255&c;let M=.5-H*H-A*A;if(M>=0){const a=3*p[y+L[Z]];M*=M,t=M*M*(C[a]*H+C[a+1]*A)}let S=.5-X*X-Q*Q;if(S>=0){const a=3*p[y+h+L[Z+R]];S*=S,V=S*S*(C[a]*X+C[a+1]*Q)}let n=.5-s*s-D*D;if(n>=0){const a=3*p[y+1+L[Z+1]];n*=n,K=n*n*(C[a]*s+C[a+1]*D)}return 70*(t+V+K)}noise3D(a,v,p){const P=this.permMod12,b=this.perm;let V,K,F,u;const c=(a+v+p)*L,f=Math.floor(a+c),H=Math.floor(v+c),A=Math.floor(p+c),h=(f+H+A)*t,R=a-(f-h),X=v-(H-h),Q=p-(A-h);let s,D,y,Z,M,S;R>=X?X>=Q?(s=1,D=0,y=0,Z=1,M=1,S=0):R>=Q?(s=1,D=0,y=0,Z=1,M=0,S=1):(s=0,D=0,y=1,Z=1,M=0,S=1):X<Q?(s=0,D=0,y=1,Z=0,M=1,S=1):R<Q?(s=0,D=1,y=0,Z=0,M=1,S=1):(s=0,D=1,y=0,Z=1,M=1,S=0);const n=R-s+t,q=X-D+t,T=Q-y+t,j=R-Z+2*t,w=X-M+2*t,J=Q-S+2*t,B=R-1+.5,x=X-1+.5,r=Q-1+.5,o=255&f,m=255&H,O=255&A;let Y=.6-R*R-X*X-Q*Q;if(Y<0)V=0;else{const a=3*P[o+b[m+b[O]]];Y*=Y,V=Y*Y*(C[a]*R+C[a+1]*X+C[a+2]*Q)}let l=.6-n*n-q*q-T*T;if(l<0)K=0;else{const a=3*P[o+s+b[m+D+b[O+y]]];l*=l,K=l*l*(C[a]*n+C[a+1]*q+C[a+2]*T)}let z=.6-j*j-w*w-J*J;if(z<0)F=0;else{const a=3*P[o+Z+b[m+M+b[O+S]]];z*=z,F=z*z*(C[a]*j+C[a+1]*w+C[a+2]*J)}let g=.6-B*B-x*x-r*r;if(g<0)u=0;else{const a=3*P[o+1+b[m+1+b[O+1]]];g*=g,u=g*g*(C[a]*B+C[a+1]*x+C[a+2]*r)}return 32*(V+K+F+u)}noise4D(a,v,p,P){const b=this.perm;let L,t,C,u,c;const f=(a+v+p+P)*V,H=Math.floor(a+f),A=Math.floor(v+f),h=Math.floor(p+f),R=Math.floor(P+f),X=(H+A+h+R)*K,Q=a-(H-X),s=v-(A-X),D=p-(h-X),y=P-(R-X);let Z=0,M=0,S=0,n=0;Q>s?Z++:M++,Q>D?Z++:S++,Q>y?Z++:n++,s>D?M++:S++,s>y?M++:n++,D>y?S++:n++;const q=Z>=3?1:0,T=M>=3?1:0,j=S>=3?1:0,w=n>=3?1:0,J=Z>=2?1:0,B=M>=2?1:0,x=S>=2?1:0,r=n>=2?1:0,o=Z>=1?1:0,m=M>=1?1:0,O=S>=1?1:0,Y=n>=1?1:0,l=Q-q+K,z=s-T+K,g=D-j+K,G=y-w+K,e=Q-J+2*K,k=s-B+2*K,d=D-x+2*K,E=y-r+2*K,W=Q-o+3*K,U=s-m+3*K,N=D-O+3*K,i=y-Y+3*K,I=Q-1+4*K,aa=s-1+4*K,va=D-1+4*K,pa=y-1+4*K,Pa=255&H,ba=255&A,La=255&h,ta=255&R;let Va=.6-Q*Q-s*s-D*D-y*y;if(Va<0)L=0;else{const a=b[Pa+b[ba+b[La+b[ta]]]]%32*4;Va*=Va,L=Va*Va*(F[a]*Q+F[a+1]*s+F[a+2]*D+F[a+3]*y)}let Ka=.6-l*l-z*z-g*g-G*G;if(Ka<0)t=0;else{const a=b[Pa+q+b[ba+T+b[La+j+b[ta+w]]]]%32*4;Ka*=Ka,t=Ka*Ka*(F[a]*l+F[a+1]*z+F[a+2]*g+F[a+3]*G)}let Ca=.6-e*e-k*k-d*d-E*E;if(Ca<0)C=0;else{const a=b[Pa+J+b[ba+B+b[La+x+b[ta+r]]]]%32*4;Ca*=Ca,C=Ca*Ca*(F[a]*e+F[a+1]*k+F[a+2]*d+F[a+3]*E)}let Fa=.6-W*W-U*U-N*N-i*i;if(Fa<0)u=0;else{const a=b[Pa+o+b[ba+m+b[La+O+b[ta+Y]]]]%32*4;Fa*=Fa,u=Fa*Fa*(F[a]*W+F[a+1]*U+F[a+2]*N+F[a+3]*i)}let ua=.6-I*I-aa*aa-va*va-pa*pa;if(ua<0)c=0;else{const a=b[Pa+1+b[ba+1+b[La+1+b[ta+1]]]]%32*4;ua*=ua,c=ua*ua*(F[a]*I+F[a+1]*aa+F[a+2]*va+F[a+3]*pa)}return 27*(L+t+C+u+c)}}}}]);