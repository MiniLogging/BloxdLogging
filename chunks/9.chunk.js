"use strict";(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[9],{12614:(t,b,Z)=>{Z.d(b,{d:()=>O,e:()=>H,l:()=>o,h:()=>y,o:()=>d});class J{constructor(){this.children=[]}isValid(t){return!0}process(t,b,Z){let J="";if(this.line){let Z=this.line;const g=b.processor;if(g){var S,P,v,h,C,Y;g.lineProcessor&&(Z=g.lineProcessor(Z,b.isFragment,b.processingContext));const J=(null===(S=b.processor)||void 0===S?void 0:S.attributeKeywordName)??"attribute",I=b.isFragment&&null!==(P=b.processor)&&void 0!==P&&P.varyingFragmentKeywordName?null===(v=b.processor)||void 0===v?void 0:v.varyingFragmentKeywordName:!b.isFragment&&null!==(h=b.processor)&&void 0!==h&&h.varyingVertexKeywordName?null===(C=b.processor)||void 0===C?void 0:C.varyingVertexKeywordName:"varying";if(!b.isFragment&&g.attributeProcessor&&this.line.startsWith(J))Z=g.attributeProcessor(this.line,t,b.processingContext);else if(g.varyingProcessor&&(null!==(Y=g.varyingCheck)&&void 0!==Y&&Y.call(g,this.line,b.isFragment)||!g.varyingCheck&&this.line.startsWith(I)))Z=g.varyingProcessor(this.line,b.isFragment,t,b.processingContext);else if(g.uniformProcessor&&g.uniformRegexp&&g.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Z=g.uniformProcessor(this.line,b.isFragment,t,b.processingContext));else if(g.uniformBufferProcessor&&g.uniformBufferRegexp&&g.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Z=g.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(g.textureProcessor&&g.textureRegexp&&g.textureRegexp.test(this.line))Z=g.textureProcessor(this.line,b.isFragment,t,b.processingContext);else if((g.uniformProcessor||g.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?g.uniformProcessor&&(Z=g.uniformProcessor(this.line,b.isFragment,t,b.processingContext)):g.uniformBufferProcessor&&(Z=g.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,g.endOfUniformBufferProcessor&&(Z=g.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}J+=Z+"\n"}for(const g of this.children)J+=g.process(t,b,Z);return this.additionalDefineKey&&(t[this.additionalDefineKey]=this.additionalDefineValue||"true",Z[this.additionalDefineKey]=t[this.additionalDefineKey]),J}}class S{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(t){this._lines.length=0;for(const b of t){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const t=b.trim();if(!t)continue;if(t.startsWith("//")){this._lines.push(b);continue}const Z=t.indexOf(";");if(-1===Z)this._lines.push(t);else if(Z===t.length-1)t.length>1&&this._lines.push(t);else{const t=b.split(";");for(let b=0;b<t.length;b++){let Z=t[b];Z&&(Z=Z.trim(),Z&&this._lines.push(Z+(b!==t.length-1?";":"")))}}}}}class P extends J{process(t,b,Z){for(let J=0;J<this.children.length;J++){const S=this.children[J];if(S.isValid(t))return S.process(t,b,Z)}return""}}class v extends J{isValid(t){return this.testExpression.isTrue(t)}}class h{isTrue(t){return!0}static postfixToInfix(t){const b=[];for(const Z of t)if(void 0===h._OperatorPriority[Z])b.push(Z);else{const t=b[b.length-1],J=b[b.length-2];b.length-=2,b.push(`(${J}${Z}${t})`)}return b[b.length-1]}static infixToPostfix(t){const b=h._InfixToPostfixCache.get(t);if(b)return b.accessTime=Date.now(),b.result;if(!t.includes("&&")&&!t.includes("||")&&!t.includes(")")&&!t.includes("("))return[t];const Z=[];let J=-1;const S=()=>{g=g.trim(),""!==g&&(Z.push(g),g="")},P=t=>{J<h._Stack.length-1&&(h._Stack[++J]=t)},v=()=>h._Stack[J],C=()=>-1===J?"!!INVALID EXPRESSION!!":h._Stack[J--];let Y=0,g="";for(;Y<t.length;){const b=t.charAt(Y),I=Y<t.length-1?t.substring(Y,2+Y):"";if("("===b)g="",P(b);else if(")"===b){for(S();-1!==J&&"("!==v();)Z.push(C());C()}else if(h._OperatorPriority[I]>1){for(S();-1!==J&&h._OperatorPriority[v()]>=h._OperatorPriority[I];)Z.push(C());P(I),Y++}else g+=b;Y++}for(S();-1!==J;)"("===v()?C():Z.push(C());return h._InfixToPostfixCache.size>=h.InfixToPostfixCacheLimitSize&&h.ClearCache(),h._InfixToPostfixCache.set(t,{result:Z,accessTime:Date.now()}),Z}static ClearCache(){const t=Array.from(h._InfixToPostfixCache.entries()).sort(((t,b)=>t[1].accessTime-b[1].accessTime));for(let b=0;b<h.InfixToPostfixCacheCleanupSize;b++)h._InfixToPostfixCache.delete(t[b][0])}}h.InfixToPostfixCacheLimitSize=5e4,h.InfixToPostfixCacheCleanupSize=25e3,h._InfixToPostfixCache=new Map,h._OperatorPriority={")":0,"(":1,"||":2,"&&":3},h._Stack=["","","","","","","","","","","","","","","","","","","",""];class C extends h{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=t,this.not=b}isTrue(t){let b=void 0!==t[this.define];return this.not&&(b=!b),b}}class Y extends h{isTrue(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)}}class g extends h{isTrue(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)}}class I extends h{constructor(t,b,Z){super(),this.define=t,this.operand=b,this.testValue=Z}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(t){let b=!1;const Z=parseInt(void 0!=t[this.define]?t[this.define]:this.define),J=parseInt(void 0!=t[this.testValue]?t[this.testValue]:this.testValue);if(isNaN(Z)||isNaN(J))return!1;switch(this.operand){case">":b=Z>J;break;case"<":b=Z<J;break;case"<=":b=Z<=J;break;case">=":b=Z>=J;break;case"==":b=Z===J;break;case"!=":b=Z!==J}return b}}var r=Z(12573),M=Z(12618);const T=/defined\s*?\((.+?)\)/g,a=/defined\s*?\[(.+?)\]/g,k=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,u=/__decl__/,l=/light\{X\}.(\w*)/g,U=/\{X\}/g,E=[],c=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function H(t){t.processor&&t.processor.initializeShaders&&t.processor.initializeShaders(t.processingContext)}function o(t,b,Z,J){var S;null!==(S=b.processor)&&void 0!==S&&S.preProcessShaderCode&&(t=b.processor.preProcessShaderCode(t,b.isFragment)),y(t,b,(t=>{b.processCodeAfterIncludes&&(t=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",t,b.defines));const S=function(t,b,Z){let J=function(t,b){var Z;if(null!==(Z=b.processor)&&void 0!==Z&&Z.noPrecision)return t;const J=b.shouldUseHighPrecisionShader;-1===t.indexOf("precision highp float")?t=J?"precision highp float;\n"+t:"precision mediump float;\n"+t:J||(t=t.replace("precision highp float","precision mediump float"));return t}(t,b);if(!b.processor)return J;if(0===b.processor.shaderLanguage&&-1!==J.indexOf("#version 3")&&(J=J.replace("#version 300 es",""),!b.processor.parseGLES3))return J;const S=b.defines,P=n(b,Z);b.processor.preProcessor&&(J=b.processor.preProcessor(J,S,P,b.isFragment,b.processingContext));const v={};J=V(J,P,b,v),b.processor.postProcessor&&(J=b.processor.postProcessor(J,S,b.isFragment,b.processingContext,Z?{drawBuffersExtensionDisabled:!Z.getCaps().drawBuffersExtension}:{},P,v));null!==Z&&void 0!==Z&&Z._features.needShaderCodeInlining&&(J=Z.inlineShaderCode(J));return J}(t,b,J);Z(S,t)}))}function O(t,b,Z){return Z.processor&&Z.processor.finalizeShaders?Z.processor.finalizeShaders(t,b,Z.processingContext):{vertexCode:t,fragmentCode:b}}function p(t){const b=/defined\((.+)\)/.exec(t);if(b&&b.length)return new C(b[1].trim(),"!"===t[0]);const Z=["==","!=",">=","<=","<",">"];let J="",S=0;for(J of Z)if(S=t.indexOf(J),S>-1)break;if(-1===S)return new C(t);const P=t.substring(0,S).trim(),v=t.substring(S+J.length).trim();return new I(P,J,v)}function e(t,b){const Z=new v,J=t.substring(0,b);let S=t.substring(b);return S=S.substring(0,(S.indexOf("//")+1||S.length+1)-1).trim(),Z.testExpression="#ifdef"===J?new C(S):"#ifndef"===J?new C(S,!0):function(t){t=t.replace(T,"defined[$1]");const b=h.infixToPostfix(t),Z=[];for(const S of b)if("||"!==S&&"&&"!==S)Z.push(S);else if(Z.length>=2){let t=Z[Z.length-1],b=Z[Z.length-2];Z.length-=2;const J="&&"==S?new g:new Y;"string"===typeof t&&(t=t.replace(a,"defined($1)")),"string"===typeof b&&(b=b.replace(a,"defined($1)")),J.leftOperand="string"===typeof b?p(b):b,J.rightOperand="string"===typeof t?p(t):t,Z.push(J)}let J=Z[Z.length-1];return"string"===typeof J&&(J=J.replace(a,"defined($1)")),"string"===typeof J?p(J):J}(S),Z}function W(t,b,Z,S){let P=t.currentLine;for(;j(t,Z,S);){P=t.currentLine;const v=P.substring(0,5).toLowerCase();if("#else"===v){const Z=new J;return b.children.push(Z),void j(t,Z,S)}if("#elif"===v){const t=e(P,5);b.children.push(t),Z=t}}}function j(t,b,Z){for(;t.canRead;){t.lineIndex++;const S=t.currentLine;if(S.indexOf("#")>=0){const J=c.exec(S);if(J&&J.length){switch(J[0]){case"#ifdef":{const J=new P;b.children.push(J);const v=e(S,6);J.children.push(v),W(t,J,v,Z);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const J=new P;b.children.push(J);const v=e(S,7);J.children.push(v),W(t,J,v,Z);break}case"#if":{const J=new P,v=e(S,3);b.children.push(J),J.children.push(v),W(t,J,v,Z);break}}continue}}const v=new J;if(v.line=S,b.children.push(v),"#"===S[0]&&"d"===S[1]){const t=S.replace(";","").split(" ");v.additionalDefineKey=t[1],3===t.length&&(v.additionalDefineValue=t[2])}}return!1}function V(t,b,Z,P){const v=new J,h=new S;return h.lineIndex=-1,h.lines=t.split("\n"),j(h,v,P),v.process(b,Z,P)}function n(t,b){var Z;const J=t.defines,S={};for(const P of J){const t=P.replace("#define","").replace(";","").trim().split(" ");S[t[0]]=t.length>1?t[1]:""}return 0===(null===(Z=t.processor)||void 0===Z?void 0:Z.shaderLanguage)&&(S.GL_ES="true"),S.__VERSION__=t.version,S[t.platformName]="true",(0,M.k)(S,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.Tb,null===b||void 0===b?void 0:b.useExactSrgbConversions),S}function y(t,b,Z){let J;for(E.length=0;null!==(J=k.exec(t));)E.push(J);let S=String(t),P=[t],v=!1;for(const h of E){let t=h[1];if(-1!==t.indexOf("__decl__")&&(t=t.replace(u,""),b.supportsUniformBuffers&&(t=t.replace("Vertex","Ubo").replace("Fragment","Ubo")),t+="Declaration"),!b.includesShadersStore[t]){const J=b.shadersRepository+"ShadersInclude/"+t+".fx";return void d.loadFile(J,(J=>{b.includesShadersStore[t]=J,y(P.join(""),b,Z)}))}{let Z=b.includesShadersStore[t];if(h[2]){const t=h[3].split(",");for(let b=0;b<t.length;b+=2){const J=new RegExp(t[b],"g"),S=t[b+1];Z=Z.replace(J,S)}}if(h[4]){const t=h[5];if(-1!==t.indexOf("..")){const J=t.split(".."),S=parseInt(J[0]);let P=parseInt(J[1]),v=Z.slice(0);Z="",isNaN(P)&&(P=b.indexParameters[J[1]]);for(let t=S;t<P;t++)b.supportsUniformBuffers||(v=v.replace(l,((t,b)=>b+"{X}"))),Z+=v.replace(U,t.toString())+"\n"}else b.supportsUniformBuffers||(Z=Z.replace(l,((t,b)=>b+"{X}"))),Z=Z.replace(U,t)}const J=[];for(const t of P){const b=t.split(h[0]);for(let t=0;t<b.length-1;t++)J.push(b[t]),J.push(Z);J.push(b[b.length-1])}P=J,v=v||Z.indexOf("#include<")>=0||Z.indexOf("#include <")>=0}}E.length=0,S=P.join(""),v?y(S.toString(),b,Z):Z(S)}const d={loadFile:(t,b,Z,J,S,P)=>{throw(0,r.b)("FileTools")}}},12618:(t,b,Z)=>{Z.d(b,{e:()=>S,h:()=>P,k:()=>h,o:()=>v,p:()=>C});var J=Z(12573);Z(12555);const S={};function P(t,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+t}function v(t,b,Z,P,v,h,C){const Y=C||S.loadFile;if(Y){return Y(t,b,Z,P,v,h)}throw(0,J.b)("FileTools")}function h(t,b,Z,J){if(t)return b?t.IS_NDC_HALF_ZRANGE="":delete t.IS_NDC_HALF_ZRANGE,Z?t.USE_REVERSE_DEPTHBUFFER="":delete t.USE_REVERSE_DEPTHBUFFER,void(J?t.USE_EXACT_SRGB_CONVERSIONS="":delete t.USE_EXACT_SRGB_CONVERSIONS);{let t="";return b&&(t+="#define IS_NDC_HALF_ZRANGE"),Z&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),J&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}}function C(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;switch(t){case 3:{const t=(ArrayBuffer,new Int8Array(b));return J&&t.set(new Int8Array(J)),t}case 0:{const t=(ArrayBuffer,new Uint8Array(b));return J&&t.set(new Uint8Array(J)),t}case 4:{const t=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(Z?b/2:b);return J&&t.set(new Int16Array(J)),t}case 5:case 8:case 9:case 10:case 2:{const t=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(Z?b/2:b);return J&&t.set(new Uint16Array(J)),t}case 6:{const t=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(Z?b/4:b);return J&&t.set(new Int32Array(J)),t}case 7:case 11:case 12:case 13:case 14:case 15:{const t=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(Z?b/4:b);return J&&t.set(new Uint32Array(J)),t}case 1:{const t=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(Z?b/4:b);return J&&t.set(new Float32Array(J)),t}}const S=(ArrayBuffer,new Uint8Array(b));return J&&S.set(new Uint8Array(J)),S}},12636:(t,b,Z)=>{Z.d(b,{e:()=>J});class J{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersRepository:J.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersStore:J.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.IncludesShadersStore:J.IncludesShadersStoreWGSL}}J.ShadersRepository="src/Shaders/",J.ShadersStore={},J.IncludesShadersStore={},J.ShadersRepositoryWGSL="src/ShadersWGSL/",J.ShadersStoreWGSL={},J.IncludesShadersStoreWGSL={}},12654:(t,b,Z)=>{Z.d(b,{b:()=>r,e:()=>U,g:()=>T,k:()=>M,o:()=>a,q:()=>l,s:()=>I,u:()=>Y,v:()=>g,x:()=>C,A:()=>h});class J{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.ZZ._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(t){t&&this.program&&t(this.program)}setEngine(t){this.ZZ=t}_fillEffectInformation(t,b,Z,J,S,P,v,h){const C=this.ZZ;if(C.supportsUniformBuffers)for(const g in b)t.bindUniformBlock(g,b[g]);let Y;for(this.ZZ.getUniforms(this,Z).forEach(((t,b)=>{J[Z[b]]=t})),this._uniforms=J,Y=0;Y<S.length;Y++){null==t.getUniform(S[Y])&&(S.splice(Y,1),Y--)}S.forEach(((t,b)=>{P[t]=b}));for(const g of C.getAttributes(this,v))h.push(g)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(t,b){const Z=this._valueCache[t],J=b.updateFlag;return(void 0===Z||Z!==J)&&(this._valueCache[t]=J,!0)}_cacheFloat2(t,b,Z){let J=this._valueCache[t];if(!J||2!==J.length)return J=[b,Z],this._valueCache[t]=J,!0;let S=!1;return J[0]!==b&&(J[0]=b,S=!0),J[1]!==Z&&(J[1]=Z,S=!0),S}_cacheFloat3(t,b,Z,J){let S=this._valueCache[t];if(!S||3!==S.length)return S=[b,Z,J],this._valueCache[t]=S,!0;let P=!1;return S[0]!==b&&(S[0]=b,P=!0),S[1]!==Z&&(S[1]=Z,P=!0),S[2]!==J&&(S[2]=J,P=!0),P}_cacheFloat4(t,b,Z,J,S){let P=this._valueCache[t];if(!P||4!==P.length)return P=[b,Z,J,S],this._valueCache[t]=P,!0;let v=!1;return P[0]!==b&&(P[0]=b,v=!0),P[1]!==Z&&(P[1]=Z,v=!0),P[2]!==J&&(P[2]=J,v=!0),P[3]!==S&&(P[3]=S,v=!0),v}setInt(t,b){const Z=this._valueCache[t];void 0!==Z&&Z===b||this.ZZ.setInt(this._uniforms[t],b)&&(this._valueCache[t]=b)}setInt2(t,b,Z){this._cacheFloat2(t,b,Z)&&(this.ZZ.setInt2(this._uniforms[t],b,Z)||(this._valueCache[t]=null))}setInt3(t,b,Z,J){this._cacheFloat3(t,b,Z,J)&&(this.ZZ.setInt3(this._uniforms[t],b,Z,J)||(this._valueCache[t]=null))}setInt4(t,b,Z,J,S){this._cacheFloat4(t,b,Z,J,S)&&(this.ZZ.setInt4(this._uniforms[t],b,Z,J,S)||(this._valueCache[t]=null))}setIntArray(t,b){this._valueCache[t]=null,this.ZZ.setIntArray(this._uniforms[t],b)}setIntArray2(t,b){this._valueCache[t]=null,this.ZZ.setIntArray2(this._uniforms[t],b)}setIntArray3(t,b){this._valueCache[t]=null,this.ZZ.setIntArray3(this._uniforms[t],b)}setIntArray4(t,b){this._valueCache[t]=null,this.ZZ.setIntArray4(this._uniforms[t],b)}setUInt(t,b){const Z=this._valueCache[t];void 0!==Z&&Z===b||this.ZZ.setUInt(this._uniforms[t],b)&&(this._valueCache[t]=b)}setUInt2(t,b,Z){this._cacheFloat2(t,b,Z)&&(this.ZZ.setUInt2(this._uniforms[t],b,Z)||(this._valueCache[t]=null))}setUInt3(t,b,Z,J){this._cacheFloat3(t,b,Z,J)&&(this.ZZ.setUInt3(this._uniforms[t],b,Z,J)||(this._valueCache[t]=null))}setUInt4(t,b,Z,J,S){this._cacheFloat4(t,b,Z,J,S)&&(this.ZZ.setUInt4(this._uniforms[t],b,Z,J,S)||(this._valueCache[t]=null))}setUIntArray(t,b){this._valueCache[t]=null,this.ZZ.setUIntArray(this._uniforms[t],b)}setUIntArray2(t,b){this._valueCache[t]=null,this.ZZ.setUIntArray2(this._uniforms[t],b)}setUIntArray3(t,b){this._valueCache[t]=null,this.ZZ.setUIntArray3(this._uniforms[t],b)}setUIntArray4(t,b){this._valueCache[t]=null,this.ZZ.setUIntArray4(this._uniforms[t],b)}setArray(t,b){this._valueCache[t]=null,this.ZZ.setArray(this._uniforms[t],b)}setArray2(t,b){this._valueCache[t]=null,this.ZZ.setArray2(this._uniforms[t],b)}setArray3(t,b){this._valueCache[t]=null,this.ZZ.setArray3(this._uniforms[t],b)}setArray4(t,b){this._valueCache[t]=null,this.ZZ.setArray4(this._uniforms[t],b)}setMatrices(t,b){b&&(this._valueCache[t]=null,this.ZZ.setMatrices(this._uniforms[t],b))}setMatrix(t,b){this._cacheMatrix(t,b)&&(this.ZZ.setMatrices(this._uniforms[t],b.jb())||(this._valueCache[t]=null))}setMatrix3x3(t,b){this._valueCache[t]=null,this.ZZ.setMatrix3x3(this._uniforms[t],b)}setMatrix2x2(t,b){this._valueCache[t]=null,this.ZZ.setMatrix2x2(this._uniforms[t],b)}setFloat(t,b){const Z=this._valueCache[t];void 0!==Z&&Z===b||this.ZZ.setFloat(this._uniforms[t],b)&&(this._valueCache[t]=b)}setVector2(t,b){this._cacheFloat2(t,b.x,b.y)&&(this.ZZ.setFloat2(this._uniforms[t],b.x,b.y)||(this._valueCache[t]=null))}setFloat2(t,b,Z){this._cacheFloat2(t,b,Z)&&(this.ZZ.setFloat2(this._uniforms[t],b,Z)||(this._valueCache[t]=null))}setVector3(t,b){this._cacheFloat3(t,b.x,b.y,b.z)&&(this.ZZ.setFloat3(this._uniforms[t],b.x,b.y,b.z)||(this._valueCache[t]=null))}setFloat3(t,b,Z,J){this._cacheFloat3(t,b,Z,J)&&(this.ZZ.setFloat3(this._uniforms[t],b,Z,J)||(this._valueCache[t]=null))}setVector4(t,b){this._cacheFloat4(t,b.x,b.y,b.z,b.w)&&(this.ZZ.setFloat4(this._uniforms[t],b.x,b.y,b.z,b.w)||(this._valueCache[t]=null))}setQuaternion(t,b){this._cacheFloat4(t,b.x,b.y,b.z,b.w)&&(this.ZZ.setFloat4(this._uniforms[t],b.x,b.y,b.z,b.w)||(this._valueCache[t]=null))}setFloat4(t,b,Z,J,S){this._cacheFloat4(t,b,Z,J,S)&&(this.ZZ.setFloat4(this._uniforms[t],b,Z,J,S)||(this._valueCache[t]=null))}setColor3(t,b){this._cacheFloat3(t,b.r,b.g,b.b)&&(this.ZZ.setFloat3(this._uniforms[t],b.r,b.g,b.b)||(this._valueCache[t]=null))}setColor4(t,b,Z){this._cacheFloat4(t,b.r,b.g,b.b,Z)&&(this.ZZ.setFloat4(this._uniforms[t],b.r,b.g,b.b,Z)||(this._valueCache[t]=null))}setDirectColor4(t,b){this._cacheFloat4(t,b.r,b.g,b.b,b.a)&&(this.ZZ.setFloat4(this._uniforms[t],b.r,b.g,b.b,b.a)||(this._valueCache[t]=null))}_getVertexShaderCode(){return this.vertexShader?this.ZZ._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.ZZ._getShaderSource(this.fragmentShader):null}}var S=Z(12618);const P=new WeakMap,v={_webGLVersion:2,cachedPipelines:{}};function h(t){let b=P.get(t);if(!b){if(!t)return v;b={_webGLVersion:t.TEXTURE_BINDING_3D?2:1,_context:t,parallelShaderCompile:t.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},P.set(t,b)}return b}function C(t){P.delete(t)}function Y(t,b,Z,J,S,P){const v=h(J);P||(P=v._createShaderProgramInjection??r);return P(t,u(b,"vertex",J,v._contextWasLost),u(Z,"fragment",J,v._contextWasLost),J,S,v.validateShaderPrograms)}function g(t,b,Z,J,S){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6?arguments[6]:void 0;const C=h(S);v||(v=C._createShaderProgramInjection??r);const Y=C._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return v(t,k(b,"vertex",J,Y,S,C._contextWasLost),k(Z,"fragment",J,Y,S,C._contextWasLost),S,P,C.validateShaderPrograms)}function I(t,b){const Z=new J,S=h(t);return S.parallelShaderCompile&&!S.disableParallelShaderCompile&&(Z.isParallelCompiled=!0),Z.context=S._context,Z}function r(t,b,Z,J){let S=arguments.length>5?arguments[5]:void 0;const P=J.createProgram();if(t.program=P,!P)throw new Error("Unable to create program");return J.attachShader(P,b),J.attachShader(P,Z),J.linkProgram(P),t.context=J,t.vertexShader=b,t.fragmentShader=Z,t.isParallelCompiled||T(t,J,S),P}function M(t,b,Z){const J=t;if(J._isDisposed)return!1;const S=h(b);return!!(S&&S.parallelShaderCompile&&S.parallelShaderCompile.COMPLETION_STATUS_KHR&&J.program&&b.getProgramParameter(J.program,S.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(T(J,b,Z),!0)}function T(t,b,Z){const J=t.context,S=t.vertexShader,P=t.fragmentShader,v=t.program;if(!J.getProgramParameter(v,J.LINK_STATUS)){if(!b.getShaderParameter(S,b.COMPILE_STATUS)){const Z=b.getShaderInfoLog(S);if(Z)throw t.vertexCompilationError=Z,new Error("VERTEX SHADER "+Z)}if(!b.getShaderParameter(P,b.COMPILE_STATUS)){const Z=b.getShaderInfoLog(P);if(Z)throw t.fragmentCompilationError=Z,new Error("FRAGMENT SHADER "+Z)}const Z=J.getProgramInfoLog(v);if(Z)throw t.programLinkError=Z,new Error(Z)}if(Z){J.validateProgram(v);if(!J.getProgramParameter(v,J.VALIDATE_STATUS)){const b=J.getProgramInfoLog(v);if(b)throw t.programValidationError=b,new Error(b)}}J.deleteShader(S),J.deleteShader(P),t.vertexShader=void 0,t.fragmentShader=void 0,t.onCompiled&&(t.onCompiled(),t.onCompiled=void 0)}function a(t,b,Z,J,S,P,v,C,I){let r=arguments.length>10?arguments[10]:void 0,M=arguments.length>11?arguments[11]:void 0,T=arguments.length>12?arguments[12]:void 0;const a=h(t.context);M||(M=a.createRawShaderProgramInjection??Y),T||(T=a.createShaderProgramInjection??g);const k=t;k.program=J?M(k,b,Z,k.context,I):T(k,b,Z,C,k.context,I),k.program.__SPECTOR_rebuildProgram=v,r()}function k(t,b,Z,J,P,v){return u((0,S.h)(t,Z,J),b,P,v)}function u(t,b,Z,J){const S=Z.createShader("vertex"===b?Z.VERTEX_SHADER:Z.FRAGMENT_SHADER);if(!S){let t=Z.NO_ERROR,S=Z.NO_ERROR;for(;(S=Z.getError())!==Z.NO_ERROR;)t=S;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${t}, gl isContextLost=${Z.isContextLost()}, _contextWasLost=${J}`)}return Z.shaderSource(S,t),Z.compileShader(S),S}function l(t,b){b.useProgram(t)}function U(t,b){const Z=t;if(!Z.isParallelCompiled)return void b(t);const J=Z.onCompiled;Z.onCompiled=()=>{null===J||void 0===J||J(),b(t)}}},12645:(t,b,Z)=>{Z.d(b,{d:()=>I,g:()=>M,i:()=>Y,k:()=>g});var J=Z(12555),S=Z(12654),P=Z(12636),v=Z(12557),h=Z(12614),C=Z(12618);function Y(t,b){return(0,S.A)(b).cachedPipelines[t]}function g(t){const b=t._name,Z=t.context;if(b&&Z){const t=(0,S.A)(Z),J=t.cachedPipelines[b];null===J||void 0===J||J.dispose(),delete t.cachedPipelines[b]}}function I(t,b,Z,S,P,v,C){let Y,g;const I=(0,J.f)()?null===v||void 0===v?void 0:v.getHostDocument():null;Y="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===I||void 0===I?void 0:I.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,g="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===I||void 0===I?void 0:I.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const M=[void 0,void 0],T=()=>{if(M[0]&&M[1]){t.isFragment=!0;const[J,Y]=M;(0,h.l)(Y,t,((v,Y)=>{C&&(C._fragmentSourceCodeBeforeMigration=Y),Z&&(v=Z("fragment",v));const g=(0,h.d)(J,v,t);t=null;const I=function(t,b,Z,J){if(Z){return{vertexSourceCode:(1===J?"//":"")+"#define SHADER_NAME vertex:"+(Z.vertexElement||Z.vertex||Z.spectorName||Z)+"\n"+t,fragmentSourceCode:(1===J?"//":"")+"#define SHADER_NAME fragment:"+(Z.fragmentElement||Z.fragment||Z.spectorName||Z)+"\n"+b}}return{vertexSourceCode:t,fragmentSourceCode:b}}(g.vertexCode,g.fragmentCode,b,P);null===S||void 0===S||S(I.vertexSourceCode,I.fragmentSourceCode)}),v)}};r(Y,"Vertex","",(b=>{(0,h.e)(t),(0,h.l)(b,t,((t,J)=>{C&&(C._rawVertexSourceCode=b,C._vertexSourceCodeBeforeMigration=J),Z&&(t=Z("vertex",t)),M[0]=t,T()}),v)}),P),r(g,"Fragment","Pixel",(t=>{C&&(C._rawFragmentSourceCode=t),M[1]=t,T()}),P)}function r(t,b,Z,S,v,h){if("undefined"!==typeof HTMLElement&&t instanceof HTMLElement){return void S((0,J.c)(t))}if("source:"===t.substring(0,7))return void S(t.substring(7));if("base64:"===t.substring(0,7)){return void S(window.atob(t.substring(7)))}const Y=P.e.GetShadersStore(v);if(Y[t+b+"Shader"])return void S(Y[t+b+"Shader"]);if(Z&&Y[t+Z+"Shader"])return void S(Y[t+Z+"Shader"]);let g;if(g="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:P.e.GetShadersRepository(v)+t,!(h=h||C.o))throw new Error("loadFileInjection is not defined");h(g+"."+b.toLowerCase()+".fx",S)}const M=(t,b,Z,J)=>{try{const P=t.context?(0,S.A)(t.context):null;P&&(P.disableParallelShaderCompile=t.disableParallelCompilation);const v=t.existingPipelineContext||b(t.shaderProcessingContext);return v._name=t.name,t.name&&P&&(P.cachedPipelines[t.name]=v),Z(v,t.vertex,t.fragment,!!t.createAsRaw,"","",t.rebuildRebind,t.defines,t.transformFeedbackVaryings,"",(()=>{J(v,(()=>{var b;null===(b=t.onRenderingStateCompiled)||void 0===b||b.call(t,v)}))})),v}catch(P){throw v.c.Error("Error compiling effect"),P}}},12632:(t,b,Z)=>{Z.r(b),Z.d(b,{Effect:()=>C});var J=Z(12551),S=Z(12557),P=Z(12636),v=Z(12645),h=Z(12621);class C{static get ShadersRepository(){return P.e.ShadersRepository}static set ShadersRepository(t){P.e.ShadersRepository=t}get h(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new J.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9?arguments[9]:void 0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,a=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new J.d,this.onErrorObservable=new J.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=t,this._key=M;const k=this._key.replace(/\r/g,"").replace(/\n/g,"|");let u;if(b.attributes){const t=b;if(this._engine=Z,this._attributesNames=t.attributes,this._uniformsNames=t.uniformsNames.concat(t.samplers),this._samplerList=t.samplers.slice(),this.defines=t.defines,this.onError=t.onError,this.onCompiled=t.onCompiled,this._fallbacks=t.fallbacks,this._indexParameters=t.indexParameters,this._transformFeedbackVaryings=t.transformFeedbackVaryings||null,this._multiTarget=!!t.multiTarget,this._shaderLanguage=t.shaderLanguage??0,this._disableParallelShaderCompilation=!!t.disableParallelShaderCompilation,t.uniformBuffersNames){this._uniformBuffersNamesList=t.uniformBuffersNames.slice();for(let b=0;b<t.uniformBuffersNames.length;b++)this._uniformBuffersNames[t.uniformBuffersNames[b]]=b}this._processFinalCode=t.processFinalCode??null,this._processCodeAfterIncludes=t.processCodeAfterIncludes??void 0,a=t.extraInitializationsAsync,u=t.existingPipelineContext}else this._engine=P,this.defines=null==h?"":h,this._uniformsNames=Z.concat(S),this._samplerList=S?S.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=T,this.onError=I,this.onCompiled=g,this._indexParameters=r,this._fallbacks=Y;"WEBGL2"===this._engine.shaderPlatformName&&(u=(0,v.i)(k,this._engine._gl)??u),this._attributeLocationByName={},this.uniqueId=C._UniqueIdSeed++,u?(this._pipelineContext=u,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,a),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.h||this.dispose(!0)}))}async _processShaderCodeAsync(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0;J&&await J(),this._processingContext=Z||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const S={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:t??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:P.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:P.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Tb:this._engine.Tb,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,v.d)(S,this.name,this._processFinalCode,((t,Z)=>{this._vertexSourceCode=t,this._fragmentSourceCode=Z,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.h||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(t){return this._attributes[t]}getAttributeLocationByName(t){return this._attributeLocationByName[t]}getAttributesCount(){return this._attributes.length}getUniformIndex(t){return this._uniformsNames.indexOf(t)}getUniform(t){return this._uniforms[t]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((t=>{this.executeWhenCompiled(t)}))}executeWhenCompiled(t){this.isReady()?t(this):(this.onCompileObservable.add((b=>{t(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(t){(0,h.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(b=>{this._processCompilationErrors(b,t)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(t=this._pipelineContext)||void 0===t?void 0:t._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(t=this._pipelineContext)||void 0===t?void 0:t._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Tb:this._engine.Tb,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(t,b,Z,J){this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=b,this.onError=(t,b)=>{J&&J(b)},this.onCompiled=()=>{var t,b;const J=this.getEngine().scenes;if(J)for(let Z=0;Z<J.length;Z++)J[Z].markAllMaterialsAsDirty(127);null===(t=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===t||t.call(b,Z)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(t){if(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const t=this._attributesNames[b];this._attributeLocationByName[t]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),C.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const Z=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),J=Z?null:this.defines,S=Z?this._vertexSourceCodeOverride:this._vertexSourceCode,P=Z?this._fragmentSourceCodeOverride:this._fragmentSourceCode,h=this._engine;this._pipelineContext=(0,v.g)({existingPipelineContext:t?b:null,vertex:S,fragment:P,context:"WEBGL2"===h.shaderPlatformName||"WEBGL1"===h.shaderPlatformName?h._gl:void 0,rebuildRebind:(t,b,Z,J)=>this._rebuildProgram(t,b,Z,J),defines:J,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Z,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Z=>{b&&!t&&this._engine._deletePipelineContext(b),Z&&this._onRenderingStateCompiled(Z)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(Z){this._processCompilationErrors(Z,b)}}_getShaderCodeAndErrorLine(t,b,Z){const J=Z?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let S=null;if(b&&t){const P=b.match(J);if(P&&2===P.length){const b=parseInt(P[1]),J=t.split("\n",-1);J.length>=b&&(S=`Offending line [${b}] in ${Z?"fragment":"vertex"} code: ${J[b-1]}`)}}return[t,S]}_processCompilationErrors(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=t.message;const Z=this._attributesNames,J=this._fallbacks;if(S.c.Error("Unable to compile effect:"),S.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),S.c.Error(`Attributes: ${Z.join(" ")}`),S.c.Error("Defines:\n"+this.defines),C.LogShaderCodeOnCompilationError){var P,v;let t=null,b=null,Z=null;var h;if(null!==(P=this._pipelineContext)&&void 0!==P&&P._getVertexShaderCode()&&([Z,t]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Z&&(S.c.Error("Vertex code:"),S.c.Error(Z))),null!==(v=this._pipelineContext)&&void 0!==v&&v._getFragmentShaderCode())[Z,b]=this._getShaderCodeAndErrorLine(null===(h=this._pipelineContext)||void 0===h?void 0:h._getFragmentShaderCode(),this._compilationError,!0),Z&&(S.c.Error("Fragment code:"),S.c.Error(Z));t&&S.c.Error(t),b&&S.c.Error(b)}S.c.Error("Error: "+this._compilationError);const Y=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};b&&(this._pipelineContext=b,this._isReady=!0,Y()),J?(this._pipelineContext=null,J.hasMoreFallbacks?(this._allFallbacksProcessed=!1,S.c.Error("Trying next fallback."),this.defines=J.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,Y(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||Y())}get isSupported(){return""===this._compilationError}_bindTexture(t,b){this._engine._bindTexture(this._samplers[t],b,t)}setTexture(t,b){this._engine.setTexture(this._samplers[t],this._uniforms[t],b,t)}setTextureArray(t,b){const Z=t+"Ex";if(-1===this._samplerList.indexOf(Z+"0")){const J=this._samplerList.indexOf(t);for(let t=1;t<b.length;t++){const b=Z+(t-1).toString();this._samplerList.splice(J+t,0,b)}let S=0;for(const t of this._samplerList)this._samplers[t]=S,S+=1}this._engine.setTextureArray(this._samplers[t],this._uniforms[t],b,t)}bindUniformBuffer(t,b){const Z=this._uniformBuffersNames[b];void 0===Z||C._BaseCache[Z]===t&&this._engine._features.useUBOBindingCache||(C._BaseCache[Z]=t,this._engine.bindUniformBufferBase(t,Z,b))}bindUniformBlock(t,b){this._engine.bindUniformBlock(this._pipelineContext,t,b)}setInt(t,b){return this._pipelineContext.setInt(t,b),this}setInt2(t,b,Z){return this._pipelineContext.setInt2(t,b,Z),this}setInt3(t,b,Z,J){return this._pipelineContext.setInt3(t,b,Z,J),this}setInt4(t,b,Z,J,S){return this._pipelineContext.setInt4(t,b,Z,J,S),this}setIntArray(t,b){return this._pipelineContext.setIntArray(t,b),this}setIntArray2(t,b){return this._pipelineContext.setIntArray2(t,b),this}setIntArray3(t,b){return this._pipelineContext.setIntArray3(t,b),this}setIntArray4(t,b){return this._pipelineContext.setIntArray4(t,b),this}setUInt(t,b){return this._pipelineContext.setUInt(t,b),this}setUInt2(t,b,Z){return this._pipelineContext.setUInt2(t,b,Z),this}setUInt3(t,b,Z,J){return this._pipelineContext.setUInt3(t,b,Z,J),this}setUInt4(t,b,Z,J,S){return this._pipelineContext.setUInt4(t,b,Z,J,S),this}setUIntArray(t,b){return this._pipelineContext.setUIntArray(t,b),this}setUIntArray2(t,b){return this._pipelineContext.setUIntArray2(t,b),this}setUIntArray3(t,b){return this._pipelineContext.setUIntArray3(t,b),this}setUIntArray4(t,b){return this._pipelineContext.setUIntArray4(t,b),this}setFloatArray(t,b){return this._pipelineContext.setArray(t,b),this}setFloatArray2(t,b){return this._pipelineContext.setArray2(t,b),this}setFloatArray3(t,b){return this._pipelineContext.setArray3(t,b),this}setFloatArray4(t,b){return this._pipelineContext.setArray4(t,b),this}setArray(t,b){return this._pipelineContext.setArray(t,b),this}setArray2(t,b){return this._pipelineContext.setArray2(t,b),this}setArray3(t,b){return this._pipelineContext.setArray3(t,b),this}setArray4(t,b){return this._pipelineContext.setArray4(t,b),this}setMatrices(t,b){return this._pipelineContext.setMatrices(t,b),this}setMatrix(t,b){return this._pipelineContext.setMatrix(t,b),this}setMatrix3x3(t,b){return this._pipelineContext.setMatrix3x3(t,b),this}setMatrix2x2(t,b){return this._pipelineContext.setMatrix2x2(t,b),this}setFloat(t,b){return this._pipelineContext.setFloat(t,b),this}setBool(t,b){return this._pipelineContext.setInt(t,b?1:0),this}setVector2(t,b){return this._pipelineContext.setVector2(t,b),this}setFloat2(t,b,Z){return this._pipelineContext.setFloat2(t,b,Z),this}setVector3(t,b){return this._pipelineContext.setVector3(t,b),this}setFloat3(t,b,Z,J){return this._pipelineContext.setFloat3(t,b,Z,J),this}setVector4(t,b){return this._pipelineContext.setVector4(t,b),this}setQuaternion(t,b){return this._pipelineContext.setQuaternion(t,b),this}setFloat4(t,b,Z,J,S){return this._pipelineContext.setFloat4(t,b,Z,J,S),this}setColor3(t,b){return this._pipelineContext.setColor3(t,b),this}setColor4(t,b,Z){return this._pipelineContext.setColor4(t,b,Z),this}setDirectColor4(t,b){return this._pipelineContext.setDirectColor4(t,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(C.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,v.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(P.e.GetShadersStore(J)[`${t}PixelShader`]=b),Z&&(P.e.GetShadersStore(J)[`${t}VertexShader`]=Z)}static ResetCache(){C._BaseCache={}}}C.LogShaderCodeOnCompilationError=!0,C.PersistentMode=!1,C.AutomaticallyClearCodeCache=!1,C._UniqueIdSeed=0,C._BaseCache={},C.ShadersStore=P.e.ShadersStore,C.IncludesShadersStore=P.e.IncludesShadersStore},12573:(t,b,Z)=>{Z.d(b,{b:()=>S});const J={};function S(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!J[t])return J[t]=!0,`${t} needs to be imported before as it contains a side-effect required by your code.`}},12555:(t,b,Z)=>{function J(){return"undefined"!==typeof window}function S(){return"undefined"!==typeof navigator}function P(){return"undefined"!==typeof document}function v(t){let b="",Z=t.firstChild;for(;Z;)3===Z.nodeType&&(b+=Z.textContent),Z=Z.nextSibling;return b}Z.d(b,{c:()=>v,d:()=>P,e:()=>S,f:()=>J})},12557:(t,b,Z)=>{Z.d(b,{c:()=>J});class J{static _CheckLimit(t,b){let Z=J._LogLimitOutputs[t];return Z?Z.current++:(Z={limit:b,current:1},J._LogLimitOutputs[t]=Z),Z.current<=Z.limit}static _GenerateLimitMessage(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Z=J._LogLimitOutputs[t];if(!Z||!J.MessageLimitReached)return;const S=this._Levels[b];Z.current===Z.limit&&J[S.name](J.MessageLimitReached.replace(/%LIMIT%/g,""+Z.limit).replace(/%TYPE%/g,S.name??""))}static _AddLogEntry(t){J._LogCache=t+J._LogCache,J.OnNewCacheEntry&&J.OnNewCacheEntry(t)}static _FormatMessage(t){const b=t=>t<10?"0"+t:""+t,Z=new Date;return"["+b(Z.getHours())+":"+b(Z.getMinutes())+":"+b(Z.getSeconds())+"]: "+t}static _LogDisabled(t,b){}static _LogEnabled(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;const S=Array.isArray(b)?b[0]:b;if(void 0!==Z&&!J._CheckLimit(S,Z))return;const P=J._FormatMessage(S),v=this._Levels[t],h=Array.isArray(b)?b.slice(1):[];v.logFunc&&v.logFunc("BJS - "+P,...h);const C=`<div style='color:${v.color}'>${P}</div><br>`;J._AddLogEntry(C),J._GenerateLimitMessage(S,t)}static get LogCache(){return J._LogCache}static ClearLogCache(){J._LogCache="",J._LogLimitOutputs={},J.errorsCount=0}static set LogLevels(t){J.Log=J._LogDisabled,J.Warn=J._LogDisabled,J.Error=J._LogDisabled;const b=[J.MessageLogLevel,J.WarningLogLevel,J.ErrorLogLevel];for(const Z of b)if((t&Z)===Z){const t=this._Levels[Z];J[t.name]=J._LogEnabled.bind(J,Z)}}}J.NoneLogLevel=0,J.MessageLogLevel=1,J.WarningLogLevel=2,J.ErrorLogLevel=4,J.AllLogLevel=7,J.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",J._LogCache="",J._LogLimitOutputs={},J._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],J.errorsCount=0,J.Log=J._LogEnabled.bind(J,J.MessageLogLevel),J.Warn=J._LogEnabled.bind(J,J.WarningLogLevel),J.Error=J._LogEnabled.bind(J,J.ErrorLogLevel)},12551:(t,b,Z)=>{Z.d(b,{d:()=>v});const J="undefined"!==typeof WeakRef;class S{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.initialize(t,b,Z,J)}initialize(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;return this.mask=t,this.skipNextObservers=b,this.target=Z,this.currentTarget=J,this}}class P{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=t,this.mask=b,this.scope=Z,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(t)}}class v{static FromPromise(t,b){const Z=new v;return t.then((t=>{Z.notifyObservers(t)})).catch((t=>{if(!b)throw t;b.notifyObservers(t)})),Z}get observers(){return this._observers}constructor(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new S(0),t&&(this._onObserverAdded=t)}add(t){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)return null;const S=new P(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);S.unregisterOnNextCall=Z,b?this._observers.unshift(S):this._observers.push(S),this._onObserverAdded&&this._onObserverAdded(S),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(S,this._lastNotifiedValue);const v=J?new WeakRef(this):{deref:()=>this};return S._remove=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=v.deref();b&&(t?b.remove(S):b._remove(S))},S}addOnce(t){return this.add(t,void 0,void 0,void 0,!0)}remove(t){if(!t)return!1;t._remove=null;return-1!==this._observers.indexOf(t)&&(this._deferUnregister(t),!0)}removeCallback(t,b){for(let Z=0;Z<this._observers.length;Z++){const J=this._observers[Z];if(!J._willBeUnregistered&&(J.callback===t&&(!b||b===J.scope)))return this._deferUnregister(J),!0}return!1}_deferUnregister(t){t._willBeUnregistered||(this._numObserversMarkedAsDeleted++,t.unregisterOnNextCall=!1,t._willBeUnregistered=!0,setTimeout((()=>{this._remove(t)}),0))}_remove(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return!1;const Z=this._observers.indexOf(t);return-1!==Z&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(Z,1),!0)}makeObserverTopPriority(t){this._remove(t,!1),this._observers.unshift(t)}makeObserverBottomPriority(t){this._remove(t,!1),this._observers.push(t)}notifyObservers(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Z=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),!this._observers.length)return!0;const P=this._eventState;P.mask=b,P.target=Z,P.currentTarget=J,P.skipNextObservers=!1,P.lastReturnValue=t,P.userInfo=S;for(const v of this._observers)if(!v._willBeUnregistered&&(v.mask&b&&(v.unregisterOnNextCall&&this._deferUnregister(v),v.scope?P.lastReturnValue=v.callback.apply(v.scope,[t,P]):P.lastReturnValue=v.callback(t,P)),P.skipNextObservers))return!1;return!0}notifyObserver(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),t._willBeUnregistered)return;const J=this._eventState;J.mask=Z,J.skipNextObservers=!1,t.unregisterOnNextCall&&this._deferUnregister(t),t.callback(b,J)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const t=this._observers.pop();t&&(t._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const t=new v;return t._observers=this._observers.slice(0),t}hasSpecificMask(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&t||b.mask===t)return!0;return!1}}},12621:(t,b,Z)=>{Z.d(b,{c:()=>S,f:()=>v});let J=[];class S{static SetImmediate(t){0===J.length&&setTimeout((()=>{const t=J;J=[];for(const b of t)b()}),1),J.push(t)}}function P(t,b,Z){try{if(t())return b(),!0}catch(J){return null===Z||void 0===Z||Z(J),!0}return!1}const v=function(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,v=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&P(t,b,Z))return null;const h=setInterval((()=>{P(t,b,Z)?clearInterval(h):(S-=J,S<0&&(clearInterval(h),null===Z||void 0===Z||Z(new Error("Operation timed out after maximum retries. "+(v||"")),!0)))}),J);return()=>clearInterval(h)}}}]);