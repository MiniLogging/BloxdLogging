"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11716:(Z,c,L)=>{L.d(c,{c:()=>P,f:()=>O,h:()=>w,k:()=>t,n:()=>q,r:()=>x,t:()=>E});var k=L(10993),N=L(11255),R=L(11032),G=L(11012),V=L(11718),p=L(11277),J=L(11480),z=L(11079),i=L(11242);const t=Object.freeze(new k.c(0,0,0,0)),E=Object.freeze(k.h.Zero()),x=Object.freeze(k.f.Zero()),q=Object.freeze(J.e.Zero()),O=Object.freeze(N.d.Black()),w=Object.freeze(new N.h(0,0,0,0)),M={key:0,repeatCount:0,loopMode:2};class P{static _PrepareAnimation(Z,c,L,R,G,V,p,z){let i;if(!isNaN(parseFloat(G))&&isFinite(G)?i=P.ANIMATIONTYPE_FLOAT:G instanceof k.c?i=P.ANIMATIONTYPE_QUATERNION:G instanceof k.h?i=P.ANIMATIONTYPE_VECTOR3:G instanceof k.f?i=P.ANIMATIONTYPE_VECTOR2:G instanceof N.d?i=P.ANIMATIONTYPE_COLOR3:G instanceof N.h?i=P.ANIMATIONTYPE_COLOR4:G instanceof J.e&&(i=P.ANIMATIONTYPE_SIZE),void 0==i)return null;const t=new P(Z,c,L,i,p),E=[{frame:0,value:G},{frame:R,value:V}];return t.setKeys(E),void 0!==z&&t.setEasingFunction(z),t}static CreateAnimation(Z,c,L,k){const N=new P(Z+"Animation",Z,L,c,P.ANIMATIONLOOPMODE_CONSTANT);return N.setEasingFunction(k),N}static CreateAndStartAnimation(Z,c,L,k,N,R,G,V,p,J,z){const i=P._PrepareAnimation(Z,L,k,N,R,G,V,p);return i?(c.XZ&&(z=c.XZ()),z?z.beginDirectAnimation(c,[i],0,N,i.loopMode!==P.ANIMATIONLOOPMODE_CONSTANT,1,J):null):null}static CreateAndStartHierarchyAnimation(Z,c,L,k,N,R,G,V,p,J,z){const i=P._PrepareAnimation(Z,k,N,R,G,V,p,J);if(!i)return null;return c.XZ().beginDirectHierarchyAnimation(c,L,[i],0,R,1===i.loopMode,1,z)}static CreateMergeAndStartAnimation(Z,c,L,k,N,R,G,V,p,J){const z=P._PrepareAnimation(Z,L,k,N,R,G,V,p);return z?(c.animations.push(z),c.XZ().beginAnimation(c,0,N,1===z.loopMode,1,J)):null}static MakeAnimationAdditive(Z,c,L){let N;N="object"===typeof c?c:{referenceFrame:c??0,range:L,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let R=Z;if(N.cloneOriginalAnimation&&(R=Z.clone(),R.name=N.clonedAnimationName||R.name),!R._keys.length)return R;const G=N.referenceFrame&&N.referenceFrame>=0?N.referenceFrame:0;let V=0;const p=R._keys[0];let J=R._keys.length-1;const z=R._keys[J],i={referenceValue:p.value,referencePosition:k.d.Mc[0],referenceQuaternion:k.d.Quaternion[0],referenceScaling:k.d.Mc[1],keyPosition:k.d.Mc[2],keyQuaternion:k.d.Quaternion[1],keyScaling:k.d.Mc[3]};let t=p.frame,E=z.frame;if(N.range){const Z=R.getRange(N.range);Z&&(t=Z.from,E=Z.to)}else t=N.fromFrame??t,E=N.toFrame??E;if(t!==p.frame&&(V=R.createKeyForFrame(t)),E!==z.frame&&(J=R.createKeyForFrame(E)),1===R._keys.length){const Z=R._getKeyValue(R._keys[0]);i.referenceValue=Z.clone?Z.clone():Z}else if(G<=p.frame){const Z=R._getKeyValue(p.value);i.referenceValue=Z.clone?Z.clone():Z}else if(G>=z.frame){const Z=R._getKeyValue(z.value);i.referenceValue=Z.clone?Z.clone():Z}else{M.key=0;const Z=R._interpolate(G,M);i.referenceValue=Z.clone?Z.clone():Z}R.dataType===P.ANIMATIONTYPE_QUATERNION?i.referenceValue.normalize().conjugateInPlace():R.dataType===P.ANIMATIONTYPE_MATRIX&&(i.referenceValue.decompose(i.referenceScaling,i.referenceQuaternion,i.referencePosition),i.referenceQuaternion.normalize().conjugateInPlace());let x=Number.MAX_VALUE;const q=N.clipKeys?[]:null;for(let O=V;O<=J;O++){let Z=R._keys[O];if((q||N.cloneOriginalAnimation)&&(Z={frame:Z.frame,value:Z.value.clone?Z.value.clone():Z.value,inTangent:Z.inTangent,outTangent:Z.outTangent,interpolation:Z.interpolation,lockedTangent:Z.lockedTangent},q&&(x===Number.MAX_VALUE&&(x=Z.frame),Z.frame-=x,q.push(Z))),!O||R.dataType===P.ANIMATIONTYPE_FLOAT||Z.value!==p.value)switch(R.dataType){case P.ANIMATIONTYPE_MATRIX:Z.value.decompose(i.keyScaling,i.keyQuaternion,i.keyPosition),i.keyPosition.sz(i.referencePosition),i.keyScaling.divideInPlace(i.referenceScaling),i.referenceQuaternion.multiplyToRef(i.keyQuaternion,i.keyQuaternion),k.b.ComposeToRef(i.keyScaling,i.keyQuaternion,i.keyPosition,Z.value);break;case P.ANIMATIONTYPE_QUATERNION:i.referenceValue.multiplyToRef(Z.value,Z.value);break;case P.ANIMATIONTYPE_VECTOR2:case P.ANIMATIONTYPE_VECTOR3:case P.ANIMATIONTYPE_COLOR3:case P.ANIMATIONTYPE_COLOR4:Z.value.subtractToRef(i.referenceValue,Z.value);break;case P.ANIMATIONTYPE_SIZE:Z.value.width-=i.referenceValue.width,Z.value.height-=i.referenceValue.height;break;default:Z.value-=i.referenceValue}}return q&&R.setKeys(q,!0),R}static TransitionTo(Z,c,L,k,N,R,G){let V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(G<=0)return L[Z]=c,V&&V(),null;const p=N*(G/1e3);R.setKeys([{frame:0,value:L[Z].clone?L[Z].clone():L[Z]},{frame:p,value:c}]),L.animations||(L.animations=[]),L.animations.push(R);const J=k.beginAnimation(L,0,p,!1);return J.onAnimationEnd=V,J}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const Z of this._runtimeAnimations)if(!Z.isStopped())return!0;return!1}constructor(Z,c,L,k,N,R){this.name=Z,this.targetProperty=c,this.framePerSecond=L,this.dataType=k,this.loopMode=N,this.enableBlending=R,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=c.split("."),this.dataType=k,this.loopMode=void 0===N?P.ANIMATIONLOOPMODE_CYCLE:N,this.uniqueId=P._UniqueIdGenerator++}toString(Z){let c="Name: "+this.name+", property: "+this.targetProperty;if(c+=", datatype: "+["Float","Mc","Quaternion","Matrix","sc","Vector2"][this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),Z){c+=", Ranges: {";let Z=!0;for(const L in this._ranges)Z&&(c+=", ",Z=!1),c+=L;c+="}"}return c}addEvent(Z){this._events.push(Z),this._events.sort(((Z,c)=>Z.frame-c.frame))}removeEvents(Z){for(let c=0;c<this._events.length;c++)this._events[c].frame===Z&&(this._events.splice(c,1),c--)}getEvents(){return this._events}createRange(Z,c,L){this._ranges[Z]||(this._ranges[Z]=new V.d(Z,c,L))}deleteRange(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this._ranges[Z];if(L){if(c){const Z=L.from,c=L.to;for(let L=this._keys.length-1;L>=0;L--)this._keys[L].frame>=Z&&this._keys[L].frame<=c&&this._keys.splice(L,1)}this._ranges[Z]=null}}getRange(Z){return this._ranges[Z]}getKeys(){return this._keys}getHighestFrame(){let Z=0;for(let c=0,L=this._keys.length;c<L;c++)Z<this._keys[c].frame&&(Z=this._keys[c].frame);return Z}getEasingFunction(){return this._easingFunction}setEasingFunction(Z){this._easingFunction=Z}floatInterpolateFunction(Z,c,L){return(0,R.Lerp)(Z,c,L)}floatInterpolateFunctionWithTangents(Z,c,L,k,N){return(0,R.Hermite)(Z,c,L,k,N)}quaternionInterpolateFunction(Z,c,L){return k.c.Slerp(Z,c,L)}quaternionInterpolateFunctionWithTangents(Z,c,L,N,R){return k.c.Hermite(Z,c,L,N,R).normalize()}vector3InterpolateFunction(Z,c,L){return k.h.Lerp(Z,c,L)}vector3InterpolateFunctionWithTangents(Z,c,L,N,R){return k.h.Hermite(Z,c,L,N,R)}vector2InterpolateFunction(Z,c,L){return k.f.Lerp(Z,c,L)}vector2InterpolateFunctionWithTangents(Z,c,L,N,R){return k.f.Hermite(Z,c,L,N,R)}sizeInterpolateFunction(Z,c,L){return J.e.Lerp(Z,c,L)}color3InterpolateFunction(Z,c,L){return N.d.Lerp(Z,c,L)}color3InterpolateFunctionWithTangents(Z,c,L,k,R){return N.d.Hermite(Z,c,L,k,R)}color4InterpolateFunction(Z,c,L){return N.h.Lerp(Z,c,L)}color4InterpolateFunctionWithTangents(Z,c,L,k,R){return N.h.Hermite(Z,c,L,k,R)}_getKeyValue(Z){return"function"===typeof Z?Z():Z}evaluate(Z){return M.key=0,this._interpolate(Z,M)}_interpolate(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(c.loopMode===P.ANIMATIONLOOPMODE_CONSTANT&&c.repeatCount>0)return c.highLimitValue.clone?c.highLimitValue.clone():c.highLimitValue;const k=this._keys;let N;if(this._coreAnimation)N=this._coreAnimation._key;else{const R=k.length;for(N=c.key;N>=0&&Z<k[N].frame;)--N;for(;N+1<=R-1&&Z>=k[N+1].frame;)++N;if(c.key=N,N<0)return L?void 0:this._getKeyValue(k[0].value);if(N+1>R-1)return L?void 0:this._getKeyValue(k[R-1].value);this._key=N}const R=k[N],G=k[N+1];if(L&&(Z===R.frame||Z===G.frame))return;const V=this._getKeyValue(R.value),p=this._getKeyValue(G.value);if(1===R.interpolation)return G.frame>Z?V:p;const J=void 0!==R.outTangent&&void 0!==G.inTangent,z=G.frame-R.frame;let i=(Z-R.frame)/z;const M=R.easingFunction||this.getEasingFunction();switch(M&&(i=M.ease(i)),this.dataType){case P.ANIMATIONTYPE_FLOAT:{const Z=J?this.floatInterpolateFunctionWithTangents(V,R.outTangent*z,p,G.inTangent*z,i):this.floatInterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(c.offsetValue??0)*c.repeatCount+Z}break}case P.ANIMATIONTYPE_QUATERNION:{const Z=J?this.quaternionInterpolateFunctionWithTangents(V,R.outTangent.scale(z),p,G.inTangent.scale(z),i):this.quaternionInterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z.addInPlace((c.offsetValue||t).scale(c.repeatCount))}return Z}case P.ANIMATIONTYPE_VECTOR3:{const Z=J?this.vector3InterpolateFunctionWithTangents(V,R.outTangent.scale(z),p,G.inTangent.scale(z),i):this.vector3InterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z.add((c.offsetValue||E).scale(c.repeatCount))}break}case P.ANIMATIONTYPE_VECTOR2:{const Z=J?this.vector2InterpolateFunctionWithTangents(V,R.outTangent.scale(z),p,G.inTangent.scale(z),i):this.vector2InterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z.add((c.offsetValue||x).scale(c.repeatCount))}break}case P.ANIMATIONTYPE_SIZE:switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(V,p,i);case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(V,p,i).add((c.offsetValue||q).scale(c.repeatCount))}break;case P.ANIMATIONTYPE_COLOR3:{const Z=J?this.color3InterpolateFunctionWithTangents(V,R.outTangent.scale(z),p,G.inTangent.scale(z),i):this.color3InterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z.add((c.offsetValue||O).scale(c.repeatCount))}break}case P.ANIMATIONTYPE_COLOR4:{const Z=J?this.color4InterpolateFunctionWithTangents(V,R.outTangent.scale(z),p,G.inTangent.scale(z),i):this.color4InterpolateFunction(V,p,i);switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return Z;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z.add((c.offsetValue||w).scale(c.repeatCount))}break}case P.ANIMATIONTYPE_MATRIX:switch(c.loopMode){case P.ANIMATIONLOOPMODE_CYCLE:case P.ANIMATIONLOOPMODE_CONSTANT:case P.ANIMATIONLOOPMODE_YOYO:return P.AllowMatricesInterpolation?this.matrixInterpolateFunction(V,p,i,c.workValue):V;case P.ANIMATIONLOOPMODE_RELATIVE:case P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V}}return 0}matrixInterpolateFunction(Z,c,L,N){return P.AllowMatrixDecomposeForInterpolation?N?(k.b.DecomposeLerpToRef(Z,c,L,N),N):k.b.DecomposeLerp(Z,c,L):N?(k.b.LerpToRef(Z,c,L,N),N):k.b.Lerp(Z,c,L)}clone(){const Z=new P(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(Z.enableBlending=this.enableBlending,Z.blendingSpeed=this.blendingSpeed,this._keys&&Z.setKeys(this._keys),this._ranges){Z._ranges={};for(const c in this._ranges){const L=this._ranges[c];L&&(Z._ranges[c]=L.clone())}}return Z}setKeys(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=c?Z:Z.slice(0)}createKeyForFrame(Z){M.key=0;const c=this._interpolate(Z,M,!0);if(!c)return this._keys[M.key].frame===Z?M.key:M.key+1;const L={frame:Z,value:c.clone?c.clone():c};return this._keys.splice(M.key+1,0,L),M.key+1}serialize(){const Z={};Z.name=this.name,Z.property=this.targetProperty,Z.framePerSecond=this.framePerSecond,Z.dataType=this.dataType,Z.loopBehavior=this.loopMode,Z.enableBlending=this.enableBlending,Z.blendingSpeed=this.blendingSpeed;const c=this.dataType;Z.keys=[];const L=this.getKeys();for(let k=0;k<L.length;k++){const N=L[k],R={};switch(R.frame=N.frame,c){case P.ANIMATIONTYPE_FLOAT:R.values=[N.value],void 0!==N.inTangent&&R.values.push(N.inTangent),void 0!==N.outTangent&&(void 0===N.inTangent&&R.values.push(void 0),R.values.push(N.outTangent)),void 0!==N.interpolation&&(void 0===N.inTangent&&R.values.push(void 0),void 0===N.outTangent&&R.values.push(void 0),R.values.push(N.interpolation));break;case P.ANIMATIONTYPE_QUATERNION:case P.ANIMATIONTYPE_MATRIX:case P.ANIMATIONTYPE_VECTOR3:case P.ANIMATIONTYPE_COLOR3:case P.ANIMATIONTYPE_COLOR4:R.values=N.value.xc(),void 0!=N.inTangent&&R.values.push(N.inTangent.xc()),void 0!=N.outTangent&&(void 0===N.inTangent&&R.values.push(void 0),R.values.push(N.outTangent.xc())),void 0!==N.interpolation&&(void 0===N.inTangent&&R.values.push(void 0),void 0===N.outTangent&&R.values.push(void 0),R.values.push(N.interpolation))}Z.keys.push(R)}Z.ranges=[];for(const k in this._ranges){const c=this._ranges[k];if(!c)continue;const L={};L.name=k,L.from=c.from,L.to=c.to,Z.ranges.push(L)}return Z}static _UniversalLerp(Z,c,L){const k=Z.constructor;return k.Lerp?k.Lerp(Z,c,L):k.Slerp?k.Slerp(Z,c,L):Z.toFixed?Z*(1-L)+L*c:c}static Parse(Z){const c=new P(Z.name,Z.property,Z.framePerSecond,Z.dataType,Z.loopBehavior),L=Z.dataType,R=[];let G,V;for(Z.enableBlending&&(c.enableBlending=Z.enableBlending),Z.blendingSpeed&&(c.blendingSpeed=Z.blendingSpeed),V=0;V<Z.keys.length;V++){const c=Z.keys[V];let p,J,z;switch(L){case P.ANIMATIONTYPE_FLOAT:G=c.values[0],c.values.length>=2&&(p=c.values[1]),c.values.length>=3&&(J=c.values[2]),c.values.length>=4&&(z=c.values[3]);break;case P.ANIMATIONTYPE_QUATERNION:if(G=k.c.oc(c.values),c.values.length>=8){const Z=k.c.oc(c.values.slice(4,8));Z.equals(k.c.Zero())||(p=Z)}if(c.values.length>=12){const Z=k.c.oc(c.values.slice(8,12));Z.equals(k.c.Zero())||(J=Z)}c.values.length>=13&&(z=c.values[12]);break;case P.ANIMATIONTYPE_MATRIX:G=k.b.oc(c.values),c.values.length>=17&&(z=c.values[16]);break;case P.ANIMATIONTYPE_COLOR3:G=N.d.oc(c.values),c.values[3]&&(p=N.d.oc(c.values[3])),c.values[4]&&(J=N.d.oc(c.values[4])),c.values[5]&&(z=c.values[5]);break;case P.ANIMATIONTYPE_COLOR4:G=N.h.oc(c.values),c.values[4]&&(p=N.h.oc(c.values[4])),c.values[5]&&(J=N.h.oc(c.values[5])),c.values[6]&&(z=N.h.oc(c.values[6]));break;case P.ANIMATIONTYPE_VECTOR3:default:G=k.h.oc(c.values),c.values[3]&&(p=k.h.oc(c.values[3])),c.values[4]&&(J=k.h.oc(c.values[4])),c.values[5]&&(z=c.values[5])}const i={};i.frame=c.frame,i.value=G,void 0!=p&&(i.inTangent=p),void 0!=J&&(i.outTangent=J),void 0!=z&&(i.interpolation=z),R.push(i)}if(c.setKeys(R),Z.ranges)for(V=0;V<Z.ranges.length;V++)G=Z.ranges[V],c.createRange(G.name,G.from,G.to);return c}static AppendSerializedAnimations(Z,c){i.e.AppendSerializedAnimations(Z,c)}static async ParseFromFileAsync(Z,c){return await new Promise(((L,k)=>{const N=new z.b;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){let c=JSON.parse(N.responseText);if(c.animations&&(c=c.animations),c.length){const Z=[];for(const L of c)Z.push(this.Parse(L));L(Z)}else{const k=this.Parse(c);Z&&(k.name=Z),L(k)}}else k("Unable to load the animation")})),N.open("GET",c),N.send()}))}static async ParseFromSnippetAsync(Z){return await new Promise(((c,L)=>{const k=new z.b;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const L=JSON.parse(JSON.parse(k.responseText).jsonPayload);if(L.animations){const k=JSON.parse(L.animations),N=[];for(const c of k.animations){const L=this.Parse(c);L.snippetId=Z,N.push(L)}c(N)}else{const k=JSON.parse(L.animation),N=this.Parse(k);N.snippetId=Z,c(N)}}else L("Unable to load the snippet "+Z)})),k.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),k.send()}))}}P._UniqueIdGenerator=0,P.AllowMatricesInterpolation=!1,P.AllowMatrixDecomposeForInterpolation=!0,P.SnippetUrl="https://snippet.babylonjs.com",P.ANIMATIONTYPE_FLOAT=0,P.ANIMATIONTYPE_VECTOR3=1,P.ANIMATIONTYPE_QUATERNION=2,P.ANIMATIONTYPE_MATRIX=3,P.ANIMATIONTYPE_COLOR3=4,P.ANIMATIONTYPE_COLOR4=7,P.ANIMATIONTYPE_VECTOR2=5,P.ANIMATIONTYPE_SIZE=6,P.ANIMATIONLOOPMODE_RELATIVE=0,P.ANIMATIONLOOPMODE_CYCLE=1,P.ANIMATIONLOOPMODE_CONSTANT=2,P.ANIMATIONLOOPMODE_YOYO=4,P.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,P.CreateFromSnippetAsync=P.ParseFromSnippetAsync,(0,G.g)("BABYLON.Animation",P),p.b._AnimationRangeFactory=(Z,c,L)=>new V.d(Z,c,L)},11718:(Z,c,L)=>{L.d(c,{d:()=>k});class k{constructor(Z,c,L){this.name=Z,this.from=c,this.to=L}clone(){return new k(this.name,this.from,this.to)}}},11190:(Z,c,L)=>{L.d(c,{e:()=>G,g:()=>V});var k=L(11194),N=L(11052),R=L(11197);class G{get p(){return this._isDisposed}constructor(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,Z&&Z.XZ?this._engine=Z.XZ().getEngine():this._engine=Z,this._updatable=L,this._instanced=G,this._divisor=p||1,this._label=J,c instanceof k.e?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=V?N:N*Float32Array.BYTES_PER_ELEMENT,R||this.create()}createVertexBuffer(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6?arguments[6]:void 0;const p=R?c:c*Float32Array.BYTES_PER_ELEMENT,J=k?R?k:k*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new V(this._engine,this,Z,this._updatable,!0,J,void 0===N?this._instanced:N,p,L,void 0,void 0,!0,this._divisor||G)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!Z&&this._buffer||(Z=Z||this._data,Z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z),this._data=Z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Z,this._label),this._data=Z):this._buffer=this._engine.createVertexBuffer(Z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.kL>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.kL,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.kL,void 0,this._label));N.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(Z){this.create(Z)}updateDirectly(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z,k?c:c*Float32Array.BYTES_PER_ELEMENT,L?L*this.byteStride:void 0),this._data=0===c&&void 0===L?Z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class V{get p(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(Z){const c=0!=Z;this._instanceDivisor=Z,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const Z=this.getData();return Z?Array.isArray(Z)?Z.length/(this.byteStride/4)-this.byteOffset/4:(Z.byteLength-this.byteOffset)/this.byteStride:0}constructor(Z,c,L,k,N,p,J,z,i,t){let E=arguments.length>10&&void 0!==arguments[10]&&arguments[10],x=arguments.length>11&&void 0!==arguments[11]&&arguments[11],q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,O=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let w=!1;if(this.xV=Z,"object"===typeof k&&null!==k?(w=k.updatable??!1,N=k.postponeInternalCreation,p=k.stride,J=k.instanced,z=k.offset,i=k.size,t=k.type,E=k.normalized??!1,x=k.useBytes??!1,q=k.divisor??1,O=k.takeBufferOwnership??!1,this._label=k.label):w=!!k,c instanceof G?(this._buffer=c,this._ownsBuffer=O):(this._buffer=new G(Z,c,w,p,N,J,x,q,this._label),this._ownsBuffer=!0),this.uniqueId=V._Counter++,this._kind=L,void 0===t){const Z=this.getData();this.type=Z?V.GetDataType(Z):V.FLOAT}else this.type=t;const M=(0,R.n)(this.type);x?(this._size=i||(p?p/M:V.DeduceStride(L)),this.byteStride=p||this._buffer.byteStride||this._size*M,this.byteOffset=z||0):(this._size=i||p||V.DeduceStride(L),this.byteStride=p?p*M:this._buffer.byteStride||this._size*M,this.byteOffset=(z||0)*M),this.normalized=E,this._instanced=void 0!==J&&J,this._instanceDivisor=J?q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var Z;null===(Z=this._buffer)||void 0===Z||Z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(Z,c){const L=this.getData();return L?(0,R.l)(L,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,Z,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,R.n)(this.type)}getOffset(){return this.byteOffset/(0,R.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,R.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(Z){this._buffer.create(Z),this._alignBuffer()}update(Z){this._buffer.update(Z),this._alignBuffer()}updateDirectly(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(Z,c,void 0,L),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(Z,c){(0,R.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,Z,this.normalized,((Z,L)=>{for(let k=0;k<this._size;k++)c(Z[k],L+k)}))}_alignBuffer(){}static DeduceStride(Z){switch(Z){case V.UVKind:case V.UV2Kind:case V.UV3Kind:case V.UV4Kind:case V.UV5Kind:case V.UV6Kind:return 2;case V.NormalKind:case V.PositionKind:return 3;case V.ColorKind:case V.ColorInstanceKind:case V.MatricesIndicesKind:case V.MatricesIndicesExtraKind:case V.MatricesWeightsKind:case V.MatricesWeightsExtraKind:case V.TangentKind:return 4;default:throw new Error("Invalid kind '"+Z+"'")}}static GetDataType(Z){return Z instanceof Int8Array?V.BYTE:Z instanceof Uint8Array?V.UNSIGNED_BYTE:Z instanceof Int16Array?V.SHORT:Z instanceof Uint16Array?V.UNSIGNED_SHORT:Z instanceof Int32Array?V.INT:Z instanceof Uint32Array?V.UNSIGNED_INT:V.FLOAT}static GetTypeByteLength(Z){return(0,R.n)(Z)}static ForEach(Z,c,L,k,N,G,V,p){(0,R.i)(Z,c,L,k,N,G,V,((Z,c)=>{for(let L=0;L<k;L++)p(Z[L],c+L)}))}static GetFloatData(Z,c,L,k,N,G,V,p){return(0,R.l)(Z,c,L,k,N,G,V,p)}}V._Counter=0,V.BYTE=5120,V.UNSIGNED_BYTE=5121,V.SHORT=5122,V.UNSIGNED_SHORT=5123,V.INT=5124,V.UNSIGNED_INT=5125,V.FLOAT=5126,V.PositionKind="position",V.NormalKind="normal",V.TangentKind="tangent",V.UVKind="uv",V.UV2Kind="uv2",V.UV3Kind="uv3",V.UV4Kind="uv4",V.UV5Kind="uv5",V.UV6Kind="uv6",V.ColorKind="color",V.ColorInstanceKind="instanceColor",V.MatricesIndicesKind="matricesIndices",V.MatricesWeightsKind="matricesWeights",V.MatricesIndicesExtraKind="matricesIndicesExtra",V.MatricesWeightsExtraKind="matricesWeightsExtra"},11197:(Z,c,L)=>{L.d(c,{d:()=>t,f:()=>i,i:()=>p,l:()=>J,n:()=>G,r:()=>V,t:()=>z});var k=L(11052);function N(Z,c,L,k){switch(c){case 5120:{let c=Z.getInt8(L);return k&&(c=Math.max(c/127,-1)),c}case 5121:{let c=Z.getUint8(L);return k&&(c/=255),c}case 5122:{let c=Z.getInt16(L,!0);return k&&(c=Math.max(c/32767,-1)),c}case 5123:{let c=Z.getUint16(L,!0);return k&&(c/=65535),c}case 5124:return Z.getInt32(L,!0);case 5125:return Z.getUint32(L,!0);case 5126:return Z.getFloat32(L,!0);default:throw new Error(`Invalid component type ${c}`)}}function R(Z,c,L,k,N){switch(c){case 5120:k&&(N=Math.round(127*N)),Z.setInt8(L,N);break;case 5121:k&&(N=Math.round(255*N)),Z.setUint8(L,N);break;case 5122:k&&(N=Math.round(32767*N)),Z.setInt16(L,N,!0);break;case 5123:k&&(N=Math.round(65535*N)),Z.setUint16(L,N,!0);break;case 5124:Z.setInt32(L,N,!0);break;case 5125:Z.setUint32(L,N,!0);break;case 5126:Z.setFloat32(L,N,!0);break;default:throw new Error(`Invalid component type ${c}`)}}function G(Z){switch(Z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${Z}'`)}}function V(Z){switch(Z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${Z}'`)}}function p(Z,c,L,k,V,p,J,z){const i=new Array(k),t=new Array(k);if(Z instanceof Array){let N=c/4;const R=L/4;for(let c=0;c<p;c+=k){for(let c=0;c<k;c++)i[c]=t[c]=Z[N+c];z(t,c);for(let c=0;c<k;c++)i[c]!==t[c]&&(Z[N+c]=t[c]);N+=R}}else{const E=ArrayBuffer.isView(Z)?new DataView(Z.buffer,Z.byteOffset,Z.byteLength):new DataView(Z),x=G(V);for(let Z=0;Z<p;Z+=k){for(let Z=0,L=c;Z<k;Z++,L+=x)i[Z]=t[Z]=N(E,V,L,J);z(t,Z);for(let Z=0,L=c;Z<k;Z++,L+=x)i[Z]!==t[Z]&&R(E,V,L,J,t[Z]);c+=L}}}function J(Z,c,L,N,R,V,J,z){const i=c*G(L),t=J*c;if(5126!==L||R!==i){const k=new Float32Array(t);return p(Z,N,R,c,L,t,V,((Z,L)=>{for(let N=0;N<c;N++)k[L+N]=Z[N]})),k}if(!(Z instanceof Array||Z instanceof Float32Array)||0!==N||Z.length!==t){if(Z instanceof Array){const c=N/4;return Z.slice(c,c+t)}if(Z instanceof ArrayBuffer)return new Float32Array(Z,N,t);{const c=Z.byteOffset+N;return 0!==(3&c)&&(k.e.Warn("Float array must be aligned to 4-bytes border"),z=!0),z?new Float32Array(Z.buffer.slice(c,c+t*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(Z.buffer,c,t)}}return z?Z.slice():Z}function z(Z,c,L,N,R,J,z,i){const t=G(L),E=V(L),x=z*c;if(Array.isArray(Z)){if(0!==(3&N)||0!==(3&R))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const k=N/4,G=R/4;if(k+(z-1)*G+c>Z.length)throw new Error("Last accessed index is out of bounds.");if(G<c)throw new Error("Data stride cannot be smaller than the component size.");if(G!==c){const k=new E(x);return p(Z,N,R,c,L,x,J,((Z,L)=>{for(let N=0;N<c;N++)k[L+N]=Z[N]})),k}return new E(Z.slice(k,k+x))}let q,O=N;Z instanceof ArrayBuffer?q=Z:(q=Z.buffer,O+=Z.byteOffset);if(O+(z-1)*R+c*t>q.byteLength)throw new Error("Last accessed byte is out of bounds.");const w=c*t;if(R<w)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(R!==w){const Z=new E(x);return p(q,O,R,c,L,x,J,((L,k)=>{for(let N=0;N<c;N++)Z[k+N]=L[N]})),Z}return 1!==t&&0!==(O&t-1)&&(k.e.Warn("Array must be aligned to border of element size. Data will be copied."),i=!0),i?new E(q.slice(O,O+x*t)):new E(q,O,x)}function i(Z,c,L,N,R,V,J,z){const i=c*G(L),t=J*c;if(z.length!==t)throw new Error("Output length is not valid");if(5126===L&&R===i)if(Z instanceof Array){const c=N/4;z.set(Z,c)}else if(Z instanceof ArrayBuffer){const c=new Float32Array(Z,N,t);z.set(c)}else{const c=Z.byteOffset+N;if(0!==(3&c))return k.e.Warn("Float array must be aligned to 4-bytes border"),void z.set(new Float32Array(Z.buffer.slice(c,c+t*Float32Array.BYTES_PER_ELEMENT)));const L=new Float32Array(Z.buffer,c,t);z.set(L)}else p(Z,N,R,c,L,t,V,((Z,L)=>{for(let k=0;k<c;k++)z[L+k]=Z[k]}))}function t(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(Z)){for(let N=0;N<c;N++)if(Z[L+N]-k>65535)return!0;return!1}return 4===Z.BYTES_PER_ELEMENT}},11194:(Z,c,L)=>{L.d(c,{e:()=>k});class k{get underlyingResource(){return null}constructor(){this.references=0,this.kL=0,this.is32Bits=!1,this.uniqueId=k._Counter++}}k._Counter=0},11329:(Z,c,L)=>{L.d(c,{d:()=>O});var k=L(11170),N=L(11173),R=L(11336),G=L(11038),V=L(11027),p=L(10993),J=L(11277),z=L(11052),i=L(11012),t=L(11070),E=L(11343),x=L(11351),q=L(11242);class O extends J.b{get position(){return this._position}set position(Z){this._position=Z}set upVector(Z){this._upVector=Z}get upVector(){return this._upVector}get screenArea(){let Z=0,c=0;if(this.mode===O.PERSPECTIVE_CAMERA)this.fovMode===O.FOVMODE_VERTICAL_FIXED?(c=2*this.Dc*Math.tan(this.fov/2),Z=this.getEngine().getAspectRatio(this)*c):(Z=2*this.Dc*Math.tan(this.fov/2),c=Z/this.getEngine().getAspectRatio(this));else{const L=this.getEngine().getRenderWidth()/2,k=this.getEngine().getRenderHeight()/2;Z=(this.orthoRight??L)-(this.orthoLeft??-L),c=(this.orthoTop??k)-(this.orthoBottom??-k)}return Z*c}set orthoLeft(Z){this._orthoLeft=Z;for(const c of this._rigCameras)c.orthoLeft=Z}get orthoLeft(){return this._orthoLeft}set orthoRight(Z){this._orthoRight=Z;for(const c of this._rigCameras)c.orthoRight=Z}get orthoRight(){return this._orthoRight}set orthoBottom(Z){this._orthoBottom=Z;for(const c of this._rigCameras)c.orthoBottom=Z}get orthoBottom(){return this._orthoBottom}set orthoTop(Z){this._orthoTop=Z;for(const c of this._rigCameras)c.orthoTop=Z}get orthoTop(){return this._orthoTop}setFocalLength(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(c/(2*Z))}set mode(Z){this._mode=Z;for(const c of this._rigCameras)c.mode=Z}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(Z,c,L){let k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(Z,L,!1),this._position=p.h.Zero(),this._upVector=p.h.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Dc=1,this.maxZ=1e4,this.inertia=.9,this._mode=O.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new E.d(0,0,1,1),this.layerMask=268435455,this.fovMode=O.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=O.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new V.b,this.onProjectionMatrixChangedObservable=new V.b,this.onAfterCheckInputsObservable=new V.b,this.onRestoreStateObservable=new V.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new p.b,this._postProcesses=new Array,this._activeMeshes=new R.f(256),this._globalPosition=p.h.Zero(),this._computedViewMatrix=p.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=p.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=p.c.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.XZ().addCamera(this),k&&!this.XZ().activeCamera&&(this.XZ().activeCamera=this),this.position=c,this.renderPassId=this.XZ().getEngine().createRenderPassId(`Camera ${Z}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"vJ"}toString(Z){let c="Name: "+this.name;if(c+=", type: "+this.getClassName(),this.animations)for(let L=0;L<this.animations.length;L++)c+=", animation[0]: "+this.animations[L].toString(Z);return c}applyVerticalCorrection(){const Z=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-Z.x:Z.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(Z){return-1!==this._activeMeshes.indexOf(Z)}isReady(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Z)for(const c of this._postProcesses)if(c&&!c.isReady())return!1;return super.isReady(Z)}_initCache(){super._initCache(),this._cache.position=new p.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new p.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Dc=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(Z){Z||super._updateCache(),this._cache.position.R(this.position),this._cache.upVector.R(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let Z=this._cache.mode===this.mode&&this._cache.Dc===this.Dc&&this._cache.maxZ===this.maxZ;if(!Z)return!1;const c=this.getEngine();return this.mode===O.PERSPECTIVE_CAMERA?Z=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===c.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(Z=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===c.getRenderWidth()&&this._cache.renderHeight===c.getRenderHeight(),this.oblique&&(Z=Z&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),Z}attachControl(Z,c){}Oi(Z){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==O.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let Z=0;Z<this._postProcesses.length;Z++)if(null!==this._postProcesses[Z])return this._postProcesses[Z];return null}_cascadePostProcessesToRigCams(){const Z=this._getFirstPostProcess();Z&&Z.markTextureDirty();for(let c=0,L=this._rigCameras.length;c<L;c++){const Z=this._rigCameras[c],L=Z._rigPostProcess;if(L){"pass"===L.getEffectName()&&(Z.isIntermediate=0===this._postProcesses.length),Z._postProcesses=this._postProcesses.slice(0).concat(L),L.markTextureDirty()}else Z._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!Z.isReusable()&&this._postProcesses.indexOf(Z)>-1?(z.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==c||c<0?this._postProcesses.push(Z):null===this._postProcesses[c]?this._postProcesses[c]=Z:this._postProcesses.splice(c,0,Z),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.DJ(),this._postProcesses.indexOf(Z))}detachPostProcess(Z){const c=this._postProcesses.indexOf(Z);-1!==c&&(this._postProcesses[c]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.DJ(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return p.b.Identity()}getViewMatrix(Z){return!Z&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.XZ().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(Z){this._doNotComputeProjectionMatrix=!0,void 0!==Z&&(this._projectionMatrix=Z)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(Z){if(this._doNotComputeProjectionMatrix||!Z&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Dc=this.Dc,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),L=this.XZ(),k=c.useReverseDepthBuffer;if(this.mode===O.PERSPECTIVE_CAMERA){let Z;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Dc<=0&&(this.Dc=.1),Z=L.useRightHandedSystem?p.b.PerspectiveFovRHToRef:p.b.PerspectiveFovLHToRef,Z(this.fov,c.getAspectRatio(this),k?this.maxZ:this.Dc,k?this.Dc:this.maxZ,this._projectionMatrix,this.fovMode===O.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,k)}else{var N,R,G;const Z=c.getRenderWidth()/2,V=c.getRenderHeight()/2;L.useRightHandedSystem?this.oblique?p.b.ObliqueOffCenterRHToRef(this.orthoLeft??-Z,this.orthoRight??Z,this.orthoBottom??-V,this.orthoTop??V,k?this.maxZ:this.Dc,k?this.Dc:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):p.b.OrthoOffCenterRHToRef(this.orthoLeft??-Z,this.orthoRight??Z,this.orthoBottom??-V,this.orthoTop??V,k?this.maxZ:this.Dc,k?this.Dc:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):this.oblique?p.b.ObliqueOffCenterLHToRef(this.orthoLeft??-Z,this.orthoRight??Z,this.orthoBottom??-V,this.orthoTop??V,k?this.maxZ:this.Dc,k?this.Dc:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):p.b.OrthoOffCenterLHToRef(this.orthoLeft??-Z,this.orthoRight??Z,this.orthoBottom??-V,this.orthoTop??V,k?this.maxZ:this.Dc,k?this.Dc:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(N=this.oblique)||void 0===N?void 0:N.angle,this._cache.obliqueLength=null===(R=this.oblique)||void 0===R?void 0:R.length,this._cache.obliqueOffset=null===(G=this.oblique)||void 0===G?void 0:G.offset,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(Z){return(this.radius||(this.target?p.h.Distance(this.position,this.target):this.position.length()))+Z}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?x.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=x.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),c&&this.rigCameras.length>0){let c=!1;for(const L of this.rigCameras)L._updateFrustumPlanes(),c=c||Z.isInFrustum(L._frustumPlanes);return c}return Z.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(Z){return this._updateFrustumPlanes(),Z.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,t.e)("Ray")}getForwardRayToRef(Z){throw(0,t.e)("Ray")}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.XZ().stopAnimation(this),this.XZ().removeCamera(this);this._rigCameras.length>0;){const Z=this._rigCameras.pop();Z&&Z.dispose()}if(this._parentContainer){const Z=this._parentContainer.cameras.indexOf(this);Z>-1&&this._parentContainer.cameras.splice(Z,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==O.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let Z=this._postProcesses.length;for(;--Z>=0;){const c=this._postProcesses[Z];c&&c.dispose(this)}}let L=this.customRenderTargets.length;for(;--L>=0;)this.customRenderTargets[L].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.XZ().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(Z,c)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(Z,c){if(this.cameraRigMode!==Z){for(;this._rigCameras.length>0;){const Z=this._rigCameras.pop();Z&&Z.dispose()}if(this.cameraRigMode=Z,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=c.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=G.c.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==O.RIG_MODE_NONE){const Z=this.createRigCamera(this.name+"_L",0);Z&&(Z._isLeftCamera=!0);const c=this.createRigCamera(this.name+"_R",1);c&&(c._isRightCamera=!0),Z&&c&&(this._rigCameras.push(Z),this._rigCameras.push(c))}this._setRigMode(c),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(Z){}_getVRProjectionMatrix(){return p.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Dc,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(Z,c){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[Z]=c,"interaxialDistance"===Z&&(this._cameraRigParams.stereoHalfAngle=G.c.ToRadians(c/.0637))}createRigCamera(Z,c){return null}_updateRigCameras(){for(let Z=0;Z<this._rigCameras.length;Z++)this._rigCameras[Z].Dc=this.Dc,this._rigCameras[Z].maxZ=this.maxZ,this._rigCameras[Z].fov=this.fov,this._rigCameras[Z].upVector.R(this.upVector);this.cameraRigMode===O.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const Z=q.e.Serialize(this);return Z.uniqueId=this.uniqueId,Z.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(Z),this.inputs&&this.inputs.serialize(Z),q.e.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.isEnabled=this.isEnabled(),Z}clone(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=q.e.Clone(O.GetConstructorFromName(this.getClassName(),Z,this.XZ(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return L.name=Z,L.parent=c,this.onClonedObservable.notifyObservers(L),L}wp(Z){const c=p.h.Zero();return this.getDirectionToRef(Z,c),c}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(Z,c){p.h.TransformNormalToRef(Z,this.getWorldMatrix(),c)}static GetConstructorFromName(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const R=J.b.Construct(Z,c,L,{interaxial_distance:k,isStereoscopicSideBySide:N});return R||(()=>O._CreateDefaultParsedCamera(c,L))}Jc(){return this.getWorldMatrix()}static Parse(Z,c){const L=Z.type,k=O.GetConstructorFromName(L,Z.name,c,Z.interaxial_distance,Z.isStereoscopicSideBySide),N=q.e.Parse(k,Z,c);if(void 0!==Z.parentId&&(N._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(N._waitingParentInstanceIndex=Z.parentInstanceIndex),N.inputs&&(N.inputs.parse(Z),N._setupInputs()),Z.upVector&&(N.upVector=p.h.oc(Z.upVector)),N.setPosition&&(N.position.wc(0,0,0),N.setPosition(p.h.oc(Z.position))),Z.target&&N.setTarget&&N.setTarget(p.h.oc(Z.target)),Z.cameraRigMode){const c=Z.interaxial_distance?{interaxialDistance:Z.interaxial_distance}:{};N.setCameraRigMode(Z.cameraRigMode,c)}if(Z.animations){for(let c=0;c<Z.animations.length;c++){const L=Z.animations[c],k=(0,i.d)("BABYLON.Animation");k&&N.animations.push(k.Parse(L))}J.b.ParseAnimationRanges(N,Z,c)}return Z.autoAnimate&&c.beginAnimation(N,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),void 0!==Z.isEnabled&&N.lV(Z.isEnabled),N}_calculateHandednessMultiplier(){let Z=this.XZ().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(Z*=-1),Z}}O._CreateDefaultParsedCamera=(Z,c)=>{throw(0,t.e)("UniversalCamera")},O.PERSPECTIVE_CAMERA=0,O.ORTHOGRAPHIC_CAMERA=1,O.FOVMODE_VERTICAL_FIXED=0,O.FOVMODE_HORIZONTAL_FIXED=1,O.RIG_MODE_NONE=0,O.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,O.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,O.RIG_MODE_STEREOSCOPIC_INTERLACED=14,O.RIG_MODE_VR=20,O.RIG_MODE_CUSTOM=22,O.ForceAttachControlToAlwaysPreventDefault=!1,(0,k.d)([(0,N.F)("position")],O.prototype,"_position",void 0),(0,k.d)([(0,N.F)("upVector")],O.prototype,"_upVector",void 0),(0,k.d)([(0,N.H)()],O.prototype,"orthoLeft",null),(0,k.d)([(0,N.H)()],O.prototype,"orthoRight",null),(0,k.d)([(0,N.H)()],O.prototype,"orthoBottom",null),(0,k.d)([(0,N.H)()],O.prototype,"orthoTop",null),(0,k.d)([(0,N.H)()],O.prototype,"fov",void 0),(0,k.d)([(0,N.H)()],O.prototype,"projectionPlaneTilt",void 0),(0,k.d)([(0,N.H)()],O.prototype,"Dc",void 0),(0,k.d)([(0,N.H)()],O.prototype,"maxZ",void 0),(0,k.d)([(0,N.H)()],O.prototype,"inertia",void 0),(0,k.d)([(0,N.H)()],O.prototype,"mode",null),(0,k.d)([(0,N.H)()],O.prototype,"layerMask",void 0),(0,k.d)([(0,N.H)()],O.prototype,"fovMode",void 0),(0,k.d)([(0,N.H)()],O.prototype,"cameraRigMode",void 0),(0,k.d)([(0,N.H)()],O.prototype,"interaxialDistance",void 0),(0,k.d)([(0,N.H)()],O.prototype,"isStereoscopicSideBySide",void 0)},11558:(Z,c,L)=>{L.d(c,{e:()=>i});var k=L(11170),N=L(11173),R=L(11329),G=L(10993),V=L(10999),p=L(11312);L(11277).b.AddNodeConstructor("TargetCamera",((Z,c)=>()=>new i(Z,G.h.Zero(),c)));const J=G.b.Zero(),z=G.c.Identity();class i extends R.d{constructor(Z,c,L){super(Z,c,L,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new G.h(0,0,0),this.cameraRotation=new G.f(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=G.h.Zero(),this._initialFocalDistance=1,this._viewMatrix=G.b.Zero(),this._cameraTransformMatrix=G.b.Zero(),this._cameraRotationMatrix=G.b.Zero(),this._transformedReferencePoint=G.h.Zero(),this._deferredPositionUpdate=new G.h,this._deferredRotationQuaternionUpdate=new G.c,this._deferredRotationUpdate=new G.h,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=G.h.Forward(this.XZ().useRightHandedSystem),this.rotation=new G.h(0,this.XZ().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(Z){this.getWorldMatrix();const c=G.d.Mc[0],L=G.d.Mc[1];return L.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(L,c),c.scaleInPlace(Z),this.globalPosition.add(c)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const Z=this.lockedTarget;Z.Jc().getTranslationToRef(Z.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.wc(0,0,0),this.cameraRotation.wc(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new G.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new G.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new G.c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(Z){Z||super._updateCache();const c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.R(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.R(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.R(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const Z=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(Z):!Z)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const Z=this.getEngine();return this.speed*Math.sqrt(Z.getDeltaTime()/(100*Z.getFps()))}setTarget(Z){this.upVector.normalize(),this._initialFocalDistance=Z.yL(this.position).length(),this.position.z===Z.z&&(this.position.z+=V.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.XZ().useRightHandedSystem?G.b.LookAtRHToRef(this.position,Z,G.h.UpReadOnly,J):G.b.LookAtLHToRef(this.position,Z,G.h.UpReadOnly,J),J.invert();const c=this.rotationQuaternion||z;G.c.FromRotationMatrixToRef(J,c),c.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(Z){this.setTarget(Z)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(G.d.Matrix[0]),G.h.TransformNormalToRef(this.cameraDirection,G.d.Matrix[0],G.d.Mc[0]),this._deferredPositionUpdate.addInPlace(G.d.Mc[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.R(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.R(this._deferredPositionUpdate)}_checkInputs(){const Z=this.invertRotation?-this.inverseRotationSpeed:1,c=this._decideIfNeedsToMove(),L=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.R(this.rotation),this._deferredPositionUpdate.R(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.R(this.rotationQuaternion),c&&this._updatePosition(),L){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*Z,this._deferredRotationUpdate.y+=this.cameraRotation.y*Z,!this.noRotationConstraint){const Z=1.570796;this._deferredRotationUpdate.x>Z&&(this._deferredRotationUpdate.x=Z),this._deferredRotationUpdate.x<-Z&&(this._deferredRotationUpdate.x=-Z)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.R(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(G.c.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.R(this._deferredRotationQuaternionUpdate))}}c&&(Math.abs(this.cameraDirection.x)<this.speed*V.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*V.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*V.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),L&&(Math.abs(this.cameraRotation.x)<this.speed*V.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*V.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):G.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return G.h.TransformNormalToRef(G.h.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),G.h.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?p.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(G.c.FromEulerVectorToRef(this.rotation,z),p.b.Y.rotateByQuaternionToRef(z,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(Z,c,L){if(this.XZ().useRightHandedSystem?G.b.LookAtRHToRef(Z,c,L,this._viewMatrix):G.b.LookAtLHToRef(Z,c,L,this._viewMatrix),this.parent){const Z=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(Z,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.R(Z)}createRigCamera(Z,c){if(this.cameraRigMode!==R.d.RIG_MODE_NONE){const c=new i(Z,this.position.clone(),this.XZ());return c.isRigCamera=!0,c.rigParent=this,this.cameraRigMode===R.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new G.c),c._cameraRigParams={},c.rotationQuaternion=new G.c),c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoTop=this.orthoTop,c.orthoBottom=this.orthoBottom,c}return null}_updateRigCameras(){const Z=this._rigCameras[0],c=this._rigCameras[1];switch(this.Jc(),this.cameraRigMode){case R.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case R.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case R.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const L=this.cameraRigMode===R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,k=this.cameraRigMode===R.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*L,Z),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*k,c);break}case R.d.RIG_MODE_VR:Z.rotationQuaternion?(Z.rotationQuaternion.R(this.rotationQuaternion),c.rotationQuaternion.R(this.rotationQuaternion)):(Z.rotation.R(this.rotation),c.rotation.R(this.rotation)),Z.position.R(this.position),c.position.R(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(Z,c){this.getTarget().subtractToRef(this.position,i._TargetFocalPoint),i._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const L=i._TargetFocalPoint.addInPlace(this.position);G.b.TranslationToRef(-L.x,-L.y,-L.z,i._TargetTransformMatrix),i._TargetTransformMatrix.multiplyToRef(G.b.RotationAxis(c.upVector,Z),i._RigCamTransformMatrix),G.b.TranslationToRef(L.x,L.y,L.z,i._TargetTransformMatrix),i._RigCamTransformMatrix.multiplyToRef(i._TargetTransformMatrix,i._RigCamTransformMatrix),G.h.TransformCoordinatesToRef(this.position,i._RigCamTransformMatrix,c.position),c.setTarget(L)}getClassName(){return"TargetCamera"}}i._RigCamTransformMatrix=new G.b,i._TargetTransformMatrix=new G.b,i._TargetFocalPoint=new G.h,(0,k.d)([(0,N.H)()],i.prototype,"updateUpVectorFromRotation",void 0),(0,k.d)([(0,N.F)()],i.prototype,"rotation",void 0),(0,k.d)([(0,N.H)()],i.prototype,"speed",void 0),(0,k.d)([(0,N.x)("lockedTargetId")],i.prototype,"lockedTarget",void 0)},11199:(Z,c,L)=>{L.d(c,{d:()=>k});class k{constructor(Z,c,L){this.bu=Z,this.bv=c,this.distance=L,this.faceId=0,this.subMeshId=0}}},11304:(Z,c,L)=>{L.d(c,{e:()=>R});var k=L(10993),N=L(11190);class R{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var Z;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||L&&!this.pickedMesh.isVerticesDataPresent(N.g.NormalKind))return null;let R,G=this.pickedMesh.tc();0===(null===(Z=G)||void 0===Z?void 0:Z.length)&&(G=null);const V=k.d.Mc[0],p=k.d.Mc[1],J=k.d.Mc[2];if(L){const Z=this.pickedMesh.getVerticesData(N.g.NormalKind);let c=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId],V):V.wc(Z[3*this.faceId*3],Z[3*this.faceId*3+1],Z[3*this.faceId*3+2]),L=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId+1],p):p.wc(Z[3*(3*this.faceId+1)],Z[3*(3*this.faceId+1)+1],Z[3*(3*this.faceId+1)+2]),z=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId+2],J):J.wc(Z[3*(3*this.faceId+2)],Z[3*(3*this.faceId+2)+1],Z[3*(3*this.faceId+2)+2]);c=c.scale(this.bu),L=L.scale(this.bv),z=z.scale(1-this.bu-this.bv),R=new k.h(c.x+L.x+z.x,c.y+L.y+z.y,c.z+L.z+z.z)}else{const Z=this.pickedMesh.getVerticesData(N.g.PositionKind),c=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId],V):V.wc(Z[3*this.faceId*3],Z[3*this.faceId*3+1],Z[3*this.faceId*3+2]),L=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId+1],p):p.wc(Z[3*(3*this.faceId+1)],Z[3*(3*this.faceId+1)+1],Z[3*(3*this.faceId+1)+2]),z=G?k.h.FromArrayToRef(Z,3*G[3*this.faceId+2],J):J.wc(Z[3*(3*this.faceId+2)],Z[3*(3*this.faceId+2)+1],Z[3*(3*this.faceId+2)+2]),i=c.yL(L),t=z.yL(L);R=k.h.Cross(i,t)}const z=(Z,c)=>{if(-1!==this.thinInstanceIndex){const L=Z.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];L&&k.h.TransformNormalToRef(c,L,c)}let L=Z.getWorldMatrix();Z.nonUniformScaling&&(k.d.Matrix[0].R(L),L=k.d.Matrix[0],L.setTranslationFromFloats(0,0,0),L.invert(),L.transposeToRef(k.d.Matrix[1]),L=k.d.Matrix[1]),k.h.TransformNormalToRef(c,L,c)};if(c&&z(this.pickedMesh,R),this.ray){const Z=k.d.Mc[0].R(R);c||z(this.pickedMesh,Z),k.h.Dot(Z,this.ray.direction)>0&&R.negateInPlace()}return R.normalize(),R}getTextureCoordinates(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.g.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Z))return null;const c=this.pickedMesh.tc();if(!c)return null;const L=this.pickedMesh.getVerticesData(Z);if(!L)return null;let R=k.f.oc(L,2*c[3*this.faceId]),G=k.f.oc(L,2*c[3*this.faceId+1]),V=k.f.oc(L,2*c[3*this.faceId+2]);return R=R.scale(this.bu),G=G.scale(this.bv),V=V.scale(1-this.bu-this.bv),new k.f(R.x+G.x+V.x,R.y+G.y+V.y)}}},11371:(Z,c,L)=>{L.d(c,{b:()=>k});let k=!1},11210:(Z,c,L)=>{L.d(c,{e:()=>G});var k=L(11008),N=L(10993),R=L(10999);class G{constructor(Z,c,L){this.vectors=(0,k.b)(8,N.h.Zero),this.center=N.h.Zero(),this.centerWorld=N.h.Zero(),this.extendSize=N.h.Zero(),this.extendSizeWorld=N.h.Zero(),this.directions=(0,k.b)(3,N.h.Zero),this.vectorsWorld=(0,k.b)(8,N.h.Zero),this.minimumWorld=N.h.Zero(),this.maximumWorld=N.h.Zero(),this.minimum=N.h.Zero(),this.maximum=N.h.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(Z,c,L)}reConstruct(Z,c,L){const k=Z.x,R=Z.y,G=Z.z,V=c.x,p=c.y,J=c.z,z=this.vectors;this.minimum.wc(k,R,G),this.maximum.wc(V,p,J),z[0].wc(k,R,G),z[1].wc(V,p,J),z[2].wc(V,R,G),z[3].wc(k,p,G),z[4].wc(k,R,J),z[5].wc(V,p,G),z[6].wc(k,p,J),z[7].wc(V,R,J),c.addToRef(Z,this.center).scaleInPlace(.5),c.subtractToRef(Z,this.extendSize).scaleInPlace(.5),this._worldMatrix=L||N.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(Z){const c=G._TmpVector3,L=this.maximum.subtractToRef(this.minimum,c[0]),k=L.length();L.normalizeFromLength(k);const N=k*Z,R=L.scaleInPlace(.5*N),V=this.center.subtractToRef(R,c[1]),p=this.center.addToRef(R,c[2]);return this.reConstruct(V,p,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(Z){const c=this.minimumWorld,L=this.maximumWorld,k=this.directions,R=this.vectorsWorld,G=this.vectors;if(Z.isIdentity()){c.R(this.minimum),L.R(this.maximum);for(let Z=0;Z<8;++Z)R[Z].R(G[Z]);this.extendSizeWorld.R(this.extendSize),this.centerWorld.R(this.center)}else{c.uc(Number.MAX_VALUE),L.uc(-Number.MAX_VALUE);for(let k=0;k<8;++k){const V=R[k];N.h.TransformCoordinatesToRef(G[k],Z,V),c.minimizeInPlace(V),L.maximizeInPlace(V)}L.subtractToRef(c,this.extendSizeWorld).scaleInPlace(.5),L.addToRef(c,this.centerWorld).scaleInPlace(.5)}N.h.FromArrayToRef(Z.m,0,k[0]),N.h.FromArrayToRef(Z.m,4,k[1]),N.h.FromArrayToRef(Z.m,8,k[2]),this._worldMatrix=Z}isInFrustum(Z){return G.IsInFrustum(this.vectorsWorld,Z)}isCompletelyInFrustum(Z){return G.IsCompletelyInFrustum(this.vectorsWorld,Z)}intersectsPoint(Z){const c=this.minimumWorld,L=this.maximumWorld,k=c.x,N=c.y,G=c.z,V=L.x,p=L.y,J=L.z,z=Z.x,i=Z.y,t=Z.z,E=-R.e;return!(V-z<E||E>z-k)&&(!(p-i<E||E>i-N)&&!(J-t<E||E>t-G))}intersectsSphere(Z){return G.IntersectsSphere(this.minimumWorld,this.maximumWorld,Z.centerWorld,Z.radiusWorld)}intersectsMinMax(Z,c){const L=this.minimumWorld,k=this.maximumWorld,N=L.x,R=L.y,G=L.z,V=k.x,p=k.y,J=k.z,z=Z.x,i=Z.y,t=Z.z,E=c.x,x=c.y,q=c.z;return!(V<z||N>E)&&(!(p<i||R>x)&&!(J<t||G>q))}dispose(){var Z,c;null===(Z=this._drawWrapperFront)||void 0===Z||Z.dispose(),null===(c=this._drawWrapperBack)||void 0===c||c.dispose()}static Intersects(Z,c){return Z.intersectsMinMax(c.minimumWorld,c.maximumWorld)}static IntersectsSphere(Z,c,L,k){const R=G._TmpVector3[0];N.h.ClampToRef(L,Z,c,R);return N.h.DistanceSquared(L,R)<=k*k}static IsCompletelyInFrustum(Z,c){for(let L=0;L<6;++L){const k=c[L];for(let c=0;c<8;++c)if(k.dotCoordinate(Z[c])<0)return!1}return!0}static IsInFrustum(Z,c){for(let L=0;L<6;++L){let k=!0;const N=c[L];for(let c=0;c<8;++c)if(N.dotCoordinate(Z[c])>=0){k=!1;break}if(k)return!1}return!0}}G._TmpVector3=(0,k.b)(3,N.h.Zero)},11205:(Z,c,L)=>{L.d(c,{e:()=>i});var k=L(11008),N=L(10993),R=L(11210),G=L(11219);const V={min:0,max:0},p={min:0,max:0},J=(Z,c,L)=>{const k=N.h.Dot(c.centerWorld,Z),R=Math.abs(N.h.Dot(c.directions[0],Z))*c.extendSize.x+Math.abs(N.h.Dot(c.directions[1],Z))*c.extendSize.y+Math.abs(N.h.Dot(c.directions[2],Z))*c.extendSize.z;L.min=k-R,L.max=k+R},z=(Z,c,L)=>(J(Z,c,V),J(Z,L,p),!(V.min>p.max||p.min>V.max));class i{constructor(Z,c,L){this._isLocked=!1,this.boundingBox=new R.e(Z,c,L),this.boundingSphere=new G.c(Z,c,L)}reConstruct(Z,c,L){this.boundingBox.reConstruct(Z,c,L),this.boundingSphere.reConstruct(Z,c,L)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(Z){this._isLocked=Z}update(Z){this._isLocked||(this.boundingBox._update(Z),this.boundingSphere._update(Z))}centerOn(Z,c){const L=i._TmpVector3[0].R(Z).sz(c),k=i._TmpVector3[1].R(Z).addInPlace(c);return this.boundingBox.reConstruct(L,k,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(L,k,this.boundingBox.getWorldMatrix()),this}encapsulate(Z){const c=N.h.Minimize(this.minimum,Z),L=N.h.Maximize(this.maximum,Z);return this.reConstruct(c,L,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(Z){const c=N.d.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(c);const L=N.d.Mc[0];return N.h.TransformCoordinatesToRef(Z.boundingBox.minimumWorld,c,L),this.encapsulate(L),N.h.TransformCoordinatesToRef(Z.boundingBox.maximumWorld,c,L),this.encapsulate(L),this}scale(Z){return this.boundingBox.scale(Z),this.boundingSphere.scale(Z),this}isInFrustum(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===c||3===c)&&this.boundingSphere.isCenterInFrustum(Z))return!0;if(!this.boundingSphere.isInFrustum(Z))return!1;return!(1!==c&&3!==c)||this.boundingBox.isInFrustum(Z)}get diagonalLength(){const Z=this.boundingBox;return Z.maximumWorld.subtractToRef(Z.minimumWorld,i._TmpVector3[0]).length()}isCompletelyInFrustum(Z){return this.boundingBox.isCompletelyInFrustum(Z)}_checkCollision(Z){return Z._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(Z){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(Z)&&!!this.boundingBox.intersectsPoint(Z))}intersects(Z,c){if(!G.c.Intersects(this.boundingSphere,Z.boundingSphere))return!1;if(!R.e.Intersects(this.boundingBox,Z.boundingBox))return!1;if(!c)return!0;const L=this.boundingBox,k=Z.boundingBox;return!!z(L.directions[0],L,k)&&(!!z(L.directions[1],L,k)&&(!!z(L.directions[2],L,k)&&(!!z(k.directions[0],L,k)&&(!!z(k.directions[1],L,k)&&(!!z(k.directions[2],L,k)&&(!!z(N.h.Cross(L.directions[0],k.directions[0]),L,k)&&(!!z(N.h.Cross(L.directions[0],k.directions[1]),L,k)&&(!!z(N.h.Cross(L.directions[0],k.directions[2]),L,k)&&(!!z(N.h.Cross(L.directions[1],k.directions[0]),L,k)&&(!!z(N.h.Cross(L.directions[1],k.directions[1]),L,k)&&(!!z(N.h.Cross(L.directions[1],k.directions[2]),L,k)&&(!!z(N.h.Cross(L.directions[2],k.directions[0]),L,k)&&(!!z(N.h.Cross(L.directions[2],k.directions[1]),L,k)&&!!z(N.h.Cross(L.directions[2],k.directions[2]),L,k))))))))))))))}}i._TmpVector3=(0,k.b)(2,N.h.Zero)},11219:(Z,c,L)=>{L.d(c,{c:()=>R});var k=L(11008),N=L(10993);class R{constructor(Z,c,L){this.center=N.h.Zero(),this.centerWorld=N.h.Zero(),this.minimum=N.h.Zero(),this.maximum=N.h.Zero(),this.reConstruct(Z,c,L)}reConstruct(Z,c,L){this.minimum.R(Z),this.maximum.R(c);const k=N.h.Distance(Z,c);c.addToRef(Z,this.center).scaleInPlace(.5),this.radius=.5*k,this._update(L||N.b.IdentityReadOnly)}scale(Z){const c=this.radius*Z,L=R._TmpVector3,k=L[0].uc(c),N=this.center.subtractToRef(k,L[1]),G=this.center.addToRef(k,L[2]);return this.reConstruct(N,G,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(Z){if(Z.isIdentity())this.centerWorld.R(this.center),this.radiusWorld=this.radius;else{N.h.TransformCoordinatesToRef(this.center,Z,this.centerWorld);const c=R._TmpVector3[0];N.h.TransformNormalFromFloatsToRef(1,1,1,Z,c),this.radiusWorld=Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))*this.radius}}isInFrustum(Z){const c=this.centerWorld,L=this.radiusWorld;for(let k=0;k<6;k++)if(Z[k].dotCoordinate(c)<=-L)return!1;return!0}isCenterInFrustum(Z){const c=this.centerWorld;for(let L=0;L<6;L++)if(Z[L].dotCoordinate(c)<0)return!1;return!0}intersectsPoint(Z){const c=N.h.DistanceSquared(this.centerWorld,Z);return!(this.radiusWorld*this.radiusWorld<c)}static Intersects(Z,c){const L=N.h.DistanceSquared(Z.centerWorld,c.centerWorld),k=Z.radiusWorld+c.radiusWorld;return!(k*k<L)}static CreateFromCenterAndRadius(Z,c,L){this._TmpVector3[0].R(Z),this._TmpVector3[1].wc(0,0,c),this._TmpVector3[2].R(Z),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].sz(this._TmpVector3[1]);const k=new R(this._TmpVector3[0],this._TmpVector3[2]);return k._worldMatrix=L||N.b.Identity(),k}}R._TmpVector3=(0,k.b)(3,N.h.Zero)},11452:(Z,c,L)=>{L(11110).c.prototype.createDepthStencilTexture=function(Z,c,L){if(c.isCube){const L=Z.width||Z;return this._createDepthStencilCubeTexture(L,c)}return this._createDepthStencilTexture(Z,c,L)}},11429:(Z,c,L)=>{L(11397).ThinEngine.prototype.setAlphaMode=function(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==Z){switch(Z){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}c||(this.depthCullingState.depthMask=0===Z),this._alphaMode=Z}else if(!c){const c=0===Z;this.depthCullingState.depthMask!==c&&(this.depthCullingState.depthMask=c)}}},11431:(Z,c,L)=>{var k=L(11397);k.ThinEngine.prototype.updateDynamicIndexBuffer=function(Z,c){let L;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(Z),L=Z.is32Bits?c instanceof Uint32Array?c:new Uint32Array(c):c instanceof Uint16Array?c:new Uint16Array(c),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,L,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},k.ThinEngine.prototype.updateDynamicVertexBuffer=function(Z,c,L,k){this.bindArrayBuffer(Z),void 0===L&&(L=0);const N=c.byteLength||c.length;void 0===k||k>=N&&0===L?c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,new Float32Array(c)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,c):c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,new Float32Array(c).subarray(0,k/4)):(c=c instanceof ArrayBuffer?new Uint8Array(c,0,k):new Uint8Array(c.buffer,c.byteOffset,k),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,L,c)),this._resetVertexBufferBinding()}},11435:(Z,c,L)=>{var k=L(11139),N=L(11052),R=L(11397),G=L(11444),V=L(11423);class p extends G.c{setDepthStencilTexture(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(Z,c),!Z)return;const L=this._engine,k=this._context,N=Z._hardwareTexture;if(N&&Z._autoMSAAManagement&&this._MSAAFramebuffer){const c=L._currentFramebuffer;L._bindUnboundFramebuffer(this._MSAAFramebuffer),k.framebufferRenderbuffer(k.FRAMEBUFFER,(0,V.d)(Z.format)?k.DEPTH_STENCIL_ATTACHMENT:k.DEPTH_ATTACHMENT,k.RENDERBUFFER,N.getMSAARenderBuffer()),L._bindUnboundFramebuffer(c)}}constructor(Z,c,L,k,N){super(Z,c,L,k),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=N}_cloneRenderTargetWrapper(){let Z=null;return this._colorTextureArray&&this._depthStencilTextureArray?(Z=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),Z.texture.isReady=!0):Z=super._cloneRenderTargetWrapper(),Z}_swapRenderTargetWrapper(Z){super._swapRenderTargetWrapper(Z),Z._framebuffer=this._framebuffer,Z._depthStencilBuffer=this._depthStencilBuffer,Z._MSAAFramebuffer=this._MSAAFramebuffer,Z._colorTextureArray=this._colorTextureArray,Z._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,R=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const Z=this._engine,c=Z._currentFramebuffer,L=this._context;Z._bindUnboundFramebuffer(this._framebuffer),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_STENCIL_ATTACHMENT,L.RENDERBUFFER,null),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.DEPTH_ATTACHMENT,L.RENDERBUFFER,null),L.framebufferRenderbuffer(L.FRAMEBUFFER,L.STENCIL_ATTACHMENT,L.RENDERBUFFER,null),Z._bindUnboundFramebuffer(c),L.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(Z,c,L,k,N,R)}shareDepth(Z){super.shareDepth(Z);const c=this._context,L=this._depthStencilBuffer,k=Z._MSAAFramebuffer||Z._framebuffer,N=this._engine;Z._depthStencilBuffer&&Z._depthStencilBuffer!==L&&c.deleteRenderbuffer(Z._depthStencilBuffer),Z._depthStencilBuffer=L;const R=Z._generateStencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT;N._bindUnboundFramebuffer(k),c.framebufferRenderbuffer(c.FRAMEBUFFER,R,c.RENDERBUFFER,L),N._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=Z._hardwareTexture;if(!N)return;const R=this._framebuffer,G=this._engine,V=G._currentFramebuffer;let p;if(G._bindUnboundFramebuffer(R),G.webGLVersion>1){const R=this._context;var J;if(p=R["COLOR_ATTACHMENT"+c],Z.is2DArray||Z.is3D)L=L??(null===(J=this.layerIndices)||void 0===J?void 0:J[c])??0,R.framebufferTextureLayer(R.FRAMEBUFFER,p,N.underlyingResource,k,L);else if(Z.isCube){var z;L=L??(null===(z=this.faceIndices)||void 0===z?void 0:z[c])??0,R.framebufferTexture2D(R.FRAMEBUFFER,p,R.TEXTURE_CUBE_MAP_POSITIVE_X+L,N.underlyingResource,k)}else R.framebufferTexture2D(R.FRAMEBUFFER,p,R.TEXTURE_2D,N.underlyingResource,k)}else{const Z=this._context;p=Z["COLOR_ATTACHMENT"+c+"_WEBGL"];const R=void 0!==L?Z.TEXTURE_CUBE_MAP_POSITIVE_X+L:Z.TEXTURE_2D;Z.framebufferTexture2D(Z.FRAMEBUFFER,p,R,N.underlyingResource,k)}if(Z._autoMSAAManagement&&this._MSAAFramebuffer){const Z=this._context;G._bindUnboundFramebuffer(this._MSAAFramebuffer),Z.framebufferRenderbuffer(Z.FRAMEBUFFER,p,Z.RENDERBUFFER,N.getMSAARenderBuffer())}G._bindUnboundFramebuffer(V)}setTexture(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(Z,c,L),this._bindTextureRenderTarget(Z,c)}setLayerAndFaceIndices(Z,c){var L;if(super.setLayerAndFaceIndices(Z,c),!this.textures||!this.layerIndices||!this.faceIndices)return;const k=(null===(L=this._attachments)||void 0===L?void 0:L.length)??this.textures.length;for(let N=0;N<k;N++){const Z=this.textures[N];Z&&(Z.is2DArray||Z.is3D?this._bindTextureRenderTarget(Z,N,this.layerIndices[N]):Z.isCube?this._bindTextureRenderTarget(Z,N,this.faceIndices[N]):this._bindTextureRenderTarget(Z,N))}}setLayerAndFaceIndex(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(Z,c,L),!this.textures||!this.layerIndices||!this.faceIndices)return;const k=this.textures[Z];k.is2DArray||k.is3D?this._bindTextureRenderTarget(this.textures[Z],Z,this.layerIndices[Z]):k.isCube&&this._bindTextureRenderTarget(this.textures[Z],Z,this.faceIndices[Z])}resolveMSAATextures(){const Z=this._engine,c=Z._currentFramebuffer;Z._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),Z._bindUnboundFramebuffer(c)}dispose(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const c=this._context;Z||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(c.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(c.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(c.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(Z)}}L(11452);R.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(Z,c,L){const k=new p(Z,c,L,this,this._gl);return this._renderTargetWrapperCache.push(k),k},R.ThinEngine.prototype.createRenderTargetTexture=function(Z,c){const L=this._createHardwareRenderTargetWrapper(!1,!1,Z);let k,N,R=!0,G=!1,V=!1,p=1;void 0!==c&&"object"===typeof c&&(R=c.generateDepthBuffer??!0,G=!!c.generateStencilBuffer,V=!!c.noColorAttachment,k=c.colorAttachment,p=c.samples??1,N=c.label);const J=k||(V?null:this._createInternalTexture(Z,c,!0,5)),z=Z.width||Z,i=Z.height||Z,t=this._currentFramebuffer,E=this._gl,x=E.createFramebuffer();if(this._bindUnboundFramebuffer(x),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(G,R,z,i),!J||J.is2DArray||J.is3D||E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,J._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(t),L.label=N??"RenderTargetWrapper",L._framebuffer=x,L._generateDepthBuffer=R,L._generateStencilBuffer=G,L.setTextures(J),k){if(L._samples=k.samples,k.samples>1){const Z=k._hardwareTexture.getMSAARenderBuffer(0);L._MSAAFramebuffer=E.createFramebuffer(),this._bindUnboundFramebuffer(L._MSAAFramebuffer),E.framebufferRenderbuffer(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.RENDERBUFFER,Z),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(L,p);return L},R.ThinEngine.prototype._createDepthStencilTexture=function(Z,c,L){const R=this._gl,G=Z.layers||0,p=Z.depth||0;let J=R.TEXTURE_2D;0!==G?J=R.TEXTURE_2D_ARRAY:0!==p&&(J=R.TEXTURE_3D);const z=new k.e(this,12);if(z.label=c.label,!this._caps.depthTextureExtension)return N.e.Error("Depth texture is not supported by your browser or hardware."),z;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c};if(this._bindTextureDirectly(J,z,!0),this._setupDepthStencilTexture(z,Z,0!==i.comparisonFunction&&i.bilinearFiltering,i.comparisonFunction,i.samples),void 0!==i.depthTextureFormat){if(15!==i.depthTextureFormat&&16!==i.depthTextureFormat&&17!==i.depthTextureFormat&&13!==i.depthTextureFormat&&14!==i.depthTextureFormat&&18!==i.depthTextureFormat)return N.e.Error(`Depth texture ${i.depthTextureFormat} format is not supported.`),z;z.format=i.depthTextureFormat}else z.format=i.generateStencil?13:16;const t=(0,V.d)(z.format),E=this._getWebGLTextureTypeFromDepthTextureFormat(z.format),x=t?R.DEPTH_STENCIL:R.DEPTH_COMPONENT,q=this._getInternalFormatFromDepthTextureFormat(z.format,!0,t);return z.is2DArray?R.texImage3D(J,0,q,z.width,z.height,G,0,x,E,null):z.is3D?R.texImage3D(J,0,q,z.width,z.height,p,0,x,E,null):R.texImage2D(J,0,q,z.width,z.height,0,x,E,null),this._bindTextureDirectly(J,null),this._internalTexturesCache.push(z),L._depthStencilBuffer&&(R.deleteRenderbuffer(L._depthStencilBuffer),L._depthStencilBuffer=null),this._bindUnboundFramebuffer(L._MSAAFramebuffer??L._framebuffer),L._generateStencilBuffer=t,L._depthStencilTextureWithStencil=t,L._depthStencilBuffer=this._setupFramebufferDepthAttachments(L._generateStencilBuffer,L._generateDepthBuffer,L.width,L.height,L.samples,z.format),this._bindUnboundFramebuffer(null),z},R.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(Z,c){var L;if(this.webGLVersion<2||!Z)return 1;if(Z.samples===c)return c;const k=this._gl;c=Math.min(c,this.getCaps().maxMSAASamples),Z._depthStencilBuffer&&(k.deleteRenderbuffer(Z._depthStencilBuffer),Z._depthStencilBuffer=null),Z._MSAAFramebuffer&&(k.deleteFramebuffer(Z._MSAAFramebuffer),Z._MSAAFramebuffer=null);const N=null===(L=Z.texture)||void 0===L?void 0:L._hardwareTexture;if(null===N||void 0===N||N.releaseMSAARenderBuffers(),Z.texture&&c>1&&"function"===typeof k.renderbufferStorageMultisample){const L=k.createFramebuffer();if(!L)throw new Error("Unable to create multi sampled framebuffer");Z._MSAAFramebuffer=L,this._bindUnboundFramebuffer(Z._MSAAFramebuffer);const R=this._createRenderBuffer(Z.texture.width,Z.texture.height,c,-1,this._getRGBABufferInternalSizedFormat(Z.texture.type,Z.texture.format,Z.texture._useSRGBBuffer),k.COLOR_ATTACHMENT0,!1);if(!R)throw new Error("Unable to create multi sampled framebuffer");null===N||void 0===N||N.addMSAARenderBuffer(R)}this._bindUnboundFramebuffer(Z._MSAAFramebuffer??Z._framebuffer),Z.texture&&(Z.texture.samples=c),Z._samples=c;const R=Z._depthStencilTexture?Z._depthStencilTexture.format:void 0;return Z._depthStencilBuffer=this._setupFramebufferDepthAttachments(Z._generateStencilBuffer,Z._generateDepthBuffer,Z.width,Z.height,c,R),this._bindUnboundFramebuffer(null),c},R.ThinEngine.prototype._setupDepthStencilTexture=function(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const R=c.width??c,G=c.height??c,V=c.layers||0,p=c.depth||0;Z.baseWidth=R,Z.baseHeight=G,Z.width=R,Z.height=G,Z.is2DArray=V>0,Z.depth=V||p,Z.isReady=!0,Z.samples=N,Z.generateMipMaps=!1,Z.samplingMode=L?2:1,Z.type=0,Z._comparisonFunction=k;const J=this._gl,z=this._getTextureTarget(Z),i=this._getSamplingParameters(Z.samplingMode,!1);J.texParameteri(z,J.TEXTURE_MAG_FILTER,i.mag),J.texParameteri(z,J.TEXTURE_MIN_FILTER,i.min),J.texParameteri(z,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(z,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===k?(J.texParameteri(z,J.TEXTURE_COMPARE_FUNC,515),J.texParameteri(z,J.TEXTURE_COMPARE_MODE,J.NONE)):(J.texParameteri(z,J.TEXTURE_COMPARE_FUNC,k),J.texParameteri(z,J.TEXTURE_COMPARE_MODE,J.COMPARE_REF_TO_TEXTURE)))}},11095:(Z,c,L)=>{L.d(c,{b:()=>h,d:()=>u,j:()=>X,h:()=>T,l:()=>I});class k{constructor(){this.children=[]}isValid(Z){return!0}process(Z,c,L){let k="";if(this.line){let L=this.line;const z=c.processor;if(z){var N,R,G,V,p,J;z.lineProcessor&&(L=z.lineProcessor(L,c.isFragment,c.processingContext));const k=(null===(N=c.processor)||void 0===N?void 0:N.attributeKeywordName)??"attribute",i=c.isFragment&&null!==(R=c.processor)&&void 0!==R&&R.varyingFragmentKeywordName?null===(G=c.processor)||void 0===G?void 0:G.varyingFragmentKeywordName:!c.isFragment&&null!==(V=c.processor)&&void 0!==V&&V.varyingVertexKeywordName?null===(p=c.processor)||void 0===p?void 0:p.varyingVertexKeywordName:"varying";if(!c.isFragment&&z.attributeProcessor&&this.line.startsWith(k))L=z.attributeProcessor(this.line,Z,c.processingContext);else if(z.varyingProcessor&&(null!==(J=z.varyingCheck)&&void 0!==J&&J.call(z,this.line,c.isFragment)||!z.varyingCheck&&this.line.startsWith(i)))L=z.varyingProcessor(this.line,c.isFragment,Z,c.processingContext);else if(z.uniformProcessor&&z.uniformRegexp&&z.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(L=z.uniformProcessor(this.line,c.isFragment,Z,c.processingContext));else if(z.uniformBufferProcessor&&z.uniformBufferRegexp&&z.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(L=z.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(z.textureProcessor&&z.textureRegexp&&z.textureRegexp.test(this.line))L=z.textureProcessor(this.line,c.isFragment,Z,c.processingContext);else if((z.uniformProcessor||z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?z.uniformProcessor&&(L=z.uniformProcessor(this.line,c.isFragment,Z,c.processingContext)):z.uniformBufferProcessor&&(L=z.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,z.endOfUniformBufferProcessor&&(L=z.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}k+=L+"\n"}for(const z of this.children)k+=z.process(Z,c,L);return this.additionalDefineKey&&(Z[this.additionalDefineKey]=this.additionalDefineValue||"true",L[this.additionalDefineKey]=Z[this.additionalDefineKey]),k}}class N{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(Z){this._lines.length=0;for(const c of Z){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const Z=c.trim();if(!Z)continue;if(Z.startsWith("//")){this._lines.push(c);continue}const L=Z.indexOf(";");if(-1===L)this._lines.push(Z);else if(L===Z.length-1)Z.length>1&&this._lines.push(Z);else{const Z=c.split(";");for(let c=0;c<Z.length;c++){let L=Z[c];L&&(L=L.trim(),L&&this._lines.push(L+(c!==Z.length-1?";":"")))}}}}}class R extends k{process(Z,c,L){for(let k=0;k<this.children.length;k++){const N=this.children[k];if(N.isValid(Z))return N.process(Z,c,L)}return""}}class G extends k{isValid(Z){return this.testExpression.isTrue(Z)}}class V{isTrue(Z){return!0}static postfixToInfix(Z){const c=[];for(const L of Z)if(void 0===V._OperatorPriority[L])c.push(L);else{const Z=c[c.length-1],k=c[c.length-2];c.length-=2,c.push(`(${k}${L}${Z})`)}return c[c.length-1]}static infixToPostfix(Z){const c=V._InfixToPostfixCache.get(Z);if(c)return c.accessTime=Date.now(),c.result;if(!Z.includes("&&")&&!Z.includes("||")&&!Z.includes(")")&&!Z.includes("("))return[Z];const L=[];let k=-1;const N=()=>{z=z.trim(),""!==z&&(L.push(z),z="")},R=Z=>{k<V._Stack.length-1&&(V._Stack[++k]=Z)},G=()=>V._Stack[k],p=()=>-1===k?"!!INVALID EXPRESSION!!":V._Stack[k--];let J=0,z="";for(;J<Z.length;){const c=Z.charAt(J),i=J<Z.length-1?Z.substring(J,2+J):"";if("("===c)z="",R(c);else if(")"===c){for(N();-1!==k&&"("!==G();)L.push(p());p()}else if(V._OperatorPriority[i]>1){for(N();-1!==k&&V._OperatorPriority[G()]>=V._OperatorPriority[i];)L.push(p());R(i),J++}else z+=c;J++}for(N();-1!==k;)"("===G()?p():L.push(p());return V._InfixToPostfixCache.size>=V.InfixToPostfixCacheLimitSize&&V.ClearCache(),V._InfixToPostfixCache.set(Z,{result:L,accessTime:Date.now()}),L}static ClearCache(){const Z=Array.from(V._InfixToPostfixCache.entries()).sort(((Z,c)=>Z[1].accessTime-c[1].accessTime));for(let c=0;c<V.InfixToPostfixCacheCleanupSize;c++)V._InfixToPostfixCache.delete(Z[c][0])}}V.InfixToPostfixCacheLimitSize=5e4,V.InfixToPostfixCacheCleanupSize=25e3,V._InfixToPostfixCache=new Map,V._OperatorPriority={")":0,"(":1,"||":2,"&&":3},V._Stack=["","","","","","","","","","","","","","","","","","","",""];class p extends V{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=Z,this.not=c}isTrue(Z){let c=void 0!==Z[this.define];return this.not&&(c=!c),c}}class J extends V{isTrue(Z){return this.leftOperand.isTrue(Z)||this.rightOperand.isTrue(Z)}}class z extends V{isTrue(Z){return this.leftOperand.isTrue(Z)&&this.rightOperand.isTrue(Z)}}class i extends V{constructor(Z,c,L){super(),this.define=Z,this.operand=c,this.testValue=L}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(Z){let c=!1;const L=parseInt(void 0!=Z[this.define]?Z[this.define]:this.define),k=parseInt(void 0!=Z[this.testValue]?Z[this.testValue]:this.testValue);if(isNaN(L)||isNaN(k))return!1;switch(this.operand){case">":c=L>k;break;case"<":c=L<k;break;case"<=":c=L<=k;break;case">=":c=L>=k;break;case"==":c=L===k;break;case"!=":c=L!==k}return c}}var t=L(11070),E=L(11102);const x=/defined\s*?\((.+?)\)/g,q=/defined\s*?\[(.+?)\]/g,O=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,w=/__decl__/,M=/light\{X\}.(\w*)/g,P=/\{X\}/g,j=[],o=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function u(Z){Z.processor&&Z.processor.initializeShaders&&Z.processor.initializeShaders(Z.processingContext)}function X(Z,c,L,k){var N;null!==(N=c.processor)&&void 0!==N&&N.preProcessShaderCode&&(Z=c.processor.preProcessShaderCode(Z,c.isFragment)),T(Z,c,(Z=>{c.processCodeAfterIncludes&&(Z=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",Z,c.defines));const N=function(Z,c,L){let k=function(Z,c){var L;if(null!==(L=c.processor)&&void 0!==L&&L.noPrecision)return Z;const k=c.shouldUseHighPrecisionShader;-1===Z.indexOf("precision highp float")?Z=k?"precision highp float;\n"+Z:"precision mediump float;\n"+Z:k||(Z=Z.replace("precision highp float","precision mediump float"));return Z}(Z,c);if(!c.processor)return k;if(0===c.processor.shaderLanguage&&-1!==k.indexOf("#version 3")&&(k=k.replace("#version 300 es",""),!c.processor.parseGLES3))return k;const N=c.defines,R=W(c,L);c.processor.preProcessor&&(k=c.processor.preProcessor(k,N,R,c.isFragment,c.processingContext));const G={};k=l(k,R,c,G),c.processor.postProcessor&&(k=c.processor.postProcessor(k,N,c.isFragment,c.processingContext,L?{drawBuffersExtensionDisabled:!L.getCaps().drawBuffersExtension}:{},R,G));null!==L&&void 0!==L&&L._features.needShaderCodeInlining&&(k=L.inlineShaderCode(k));return k}(Z,c,k);L(N,Z)}))}function h(Z,c,L){return L.processor&&L.processor.finalizeShaders?L.processor.finalizeShaders(Z,c,L.processingContext):{vertexCode:Z,fragmentCode:c}}function B(Z){const c=/defined\((.+)\)/.exec(Z);if(c&&c.length)return new p(c[1].trim(),"!"===Z[0]);const L=["==","!=",">=","<=","<",">"];let k="",N=0;for(k of L)if(N=Z.indexOf(k),N>-1)break;if(-1===N)return new p(Z);const R=Z.substring(0,N).trim(),G=Z.substring(N+k.length).trim();return new i(R,k,G)}function D(Z,c){const L=new G,k=Z.substring(0,c);let N=Z.substring(c);return N=N.substring(0,(N.indexOf("//")+1||N.length+1)-1).trim(),L.testExpression="#ifdef"===k?new p(N):"#ifndef"===k?new p(N,!0):function(Z){Z=Z.replace(x,"defined[$1]");const c=V.infixToPostfix(Z),L=[];for(const N of c)if("||"!==N&&"&&"!==N)L.push(N);else if(L.length>=2){let Z=L[L.length-1],c=L[L.length-2];L.length-=2;const k="&&"==N?new z:new J;"string"===typeof Z&&(Z=Z.replace(q,"defined($1)")),"string"===typeof c&&(c=c.replace(q,"defined($1)")),k.leftOperand="string"===typeof c?B(c):c,k.rightOperand="string"===typeof Z?B(Z):Z,L.push(k)}let k=L[L.length-1];return"string"===typeof k&&(k=k.replace(q,"defined($1)")),"string"===typeof k?B(k):k}(N),L}function e(Z,c,L,N){let R=Z.currentLine;for(;H(Z,L,N);){R=Z.currentLine;const G=R.substring(0,5).toLowerCase();if("#else"===G){const L=new k;return c.children.push(L),void H(Z,L,N)}if("#elif"===G){const Z=D(R,5);c.children.push(Z),L=Z}}}function H(Z,c,L){for(;Z.canRead;){Z.lineIndex++;const N=Z.currentLine;if(N.indexOf("#")>=0){const k=o.exec(N);if(k&&k.length){switch(k[0]){case"#ifdef":{const k=new R;c.children.push(k);const G=D(N,6);k.children.push(G),e(Z,k,G,L);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const k=new R;c.children.push(k);const G=D(N,7);k.children.push(G),e(Z,k,G,L);break}case"#if":{const k=new R,G=D(N,3);c.children.push(k),k.children.push(G),e(Z,k,G,L);break}}continue}}const G=new k;if(G.line=N,c.children.push(G),"#"===N[0]&&"d"===N[1]){const Z=N.replace(";","").split(" ");G.additionalDefineKey=Z[1],3===Z.length&&(G.additionalDefineValue=Z[2])}}return!1}function l(Z,c,L,R){const G=new k,V=new N;return V.lineIndex=-1,V.lines=Z.split("\n"),H(V,G,R),G.process(c,L,R)}function W(Z,c){var L;const k=Z.defines,N={};for(const R of k){const Z=R.replace("#define","").replace(";","").trim().split(" ");N[Z[0]]=Z.length>1?Z[1]:""}return 0===(null===(L=Z.processor)||void 0===L?void 0:L.shaderLanguage)&&(N.GL_ES="true"),N.__VERSION__=Z.version,N[Z.platformName]="true",(0,E.j)(N,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.useReverseDepthBuffer,null===c||void 0===c?void 0:c.useExactSrgbConversions),N}function T(Z,c,L){let k;for(j.length=0;null!==(k=O.exec(Z));)j.push(k);let N=String(Z),R=[Z],G=!1;for(const V of j){let Z=V[1];if(-1!==Z.indexOf("__decl__")&&(Z=Z.replace(w,""),c.supportsUniformBuffers&&(Z=Z.replace("Vertex","Ubo").replace("Fragment","Ubo")),Z+="Declaration"),!c.includesShadersStore[Z]){const k=c.shadersRepository+"ShadersInclude/"+Z+".fx";return void I.loadFile(k,(k=>{c.includesShadersStore[Z]=k,T(R.join(""),c,L)}))}{let L=c.includesShadersStore[Z];if(V[2]){const Z=V[3].split(",");for(let c=0;c<Z.length;c+=2){const k=new RegExp(Z[c],"g"),N=Z[c+1];L=L.replace(k,N)}}if(V[4]){const Z=V[5];if(-1!==Z.indexOf("..")){const k=Z.split(".."),N=parseInt(k[0]);let R=parseInt(k[1]),G=L.slice(0);L="",isNaN(R)&&(R=c.indexParameters[k[1]]);for(let Z=N;Z<R;Z++)c.supportsUniformBuffers||(G=G.replace(M,((Z,c)=>c+"{X}"))),L+=G.replace(P,Z.toString())+"\n"}else c.supportsUniformBuffers||(L=L.replace(M,((Z,c)=>c+"{X}"))),L=L.replace(P,Z)}const k=[];for(const Z of R){const c=Z.split(V[0]);for(let Z=0;Z<c.length-1;Z++)k.push(c[Z]),k.push(L);k.push(c[c.length-1])}R=k,G=G||L.indexOf("#include<")>=0||L.indexOf("#include <")>=0}}j.length=0,N=R.join(""),G?T(N.toString(),c,L):L(N)}const I={loadFile:(Z,c,L,k,N,R)=>{throw(0,t.e)("FileTools")}}},11415:(Z,c,L)=>{L.d(c,{c:()=>k});class k{get underlyingResource(){return this._webGLTexture}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=c,!Z&&(Z=c.createTexture(),!Z))throw new Error("Unable to create webGL texture");this.set(Z)}setUsage(){}set(Z){this._webGLTexture=Z}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(Z){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(Z)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const Z of this._MSAARenderBuffers)this._context.deleteRenderbuffer(Z);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._MSAARenderBuffers)||void 0===Z?void 0:Z[c])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11102:(Z,c,L)=>{L.d(c,{e:()=>N,f:()=>R,j:()=>V,l:()=>G,o:()=>p});var k=L(11070);L(11047);const N={};function R(Z,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+Z}function G(Z,c,L,R,G,V,p){const J=p||N.loadFile;if(J){return J(Z,c,L,R,G,V)}throw(0,k.e)("FileTools")}function V(Z,c,L,k){if(Z)return c?Z.IS_NDC_HALF_ZRANGE="":delete Z.IS_NDC_HALF_ZRANGE,L?Z.USE_REVERSE_DEPTHBUFFER="":delete Z.USE_REVERSE_DEPTHBUFFER,void(k?Z.USE_EXACT_SRGB_CONVERSIONS="":delete Z.USE_EXACT_SRGB_CONVERSIONS);{let Z="";return c&&(Z+="#define IS_NDC_HALF_ZRANGE"),L&&(Z&&(Z+="\n"),Z+="#define USE_REVERSE_DEPTHBUFFER"),k&&(Z&&(Z+="\n"),Z+="#define USE_EXACT_SRGB_CONVERSIONS"),Z}}function p(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;switch(Z){case 3:{const Z=(ArrayBuffer,new Int8Array(c));return k&&Z.set(new Int8Array(k)),Z}case 0:{const Z=(ArrayBuffer,new Uint8Array(c));return k&&Z.set(new Uint8Array(k)),Z}case 4:{const Z=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(L?c/2:c);return k&&Z.set(new Int16Array(k)),Z}case 5:case 8:case 9:case 10:case 2:{const Z=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(L?c/2:c);return k&&Z.set(new Uint16Array(k)),Z}case 6:{const Z=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(L?c/4:c);return k&&Z.set(new Int32Array(k)),Z}case 7:case 11:case 12:case 13:case 14:case 15:{const Z=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(L?c/4:c);return k&&Z.set(new Uint32Array(k)),Z}case 1:{const Z=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(L?c/4:c);return k&&Z.set(new Float32Array(k)),Z}}const N=(ArrayBuffer,new Uint8Array(c));return k&&N.set(new Uint8Array(k)),N}},11110:(Z,c,L)=>{L.d(c,{c:()=>P});var k=L(11023),N=L(11052),R=L(11116),G=L(11019),V=L(11065);class p{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,Z&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(Z){this._zOffset!==Z&&(this._zOffset=Z,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(Z){this._zOffsetUnits!==Z&&(this._zOffsetUnits=Z,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(Z){this._cullFace!==Z&&(this._cullFace=Z,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(Z){this._cull!==Z&&(this._cull=Z,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(Z){this._depthFunc!==Z&&(this._depthFunc=Z,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(Z){this._depthMask!==Z&&(this._depthMask=Z,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(Z){this._depthTest!==Z&&(this._depthTest=Z,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(Z){this._frontFace!==Z&&(this._frontFace=Z,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(Z){this.isDirty&&(this._isCullDirty&&(this.cull?Z.enable(Z.CULL_FACE):Z.disable(Z.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(Z.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(Z.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?Z.enable(Z.DEPTH_TEST):Z.disable(Z.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(Z.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(Z.enable(Z.POLYGON_OFFSET_FILL),Z.polygonOffset(this.zOffset,this.zOffsetUnits)):Z.disable(Z.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(Z.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class J{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(Z){this._func!==Z&&(this._func=Z,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(Z){this._funcRef!==Z&&(this._funcRef=Z,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(Z){this._funcMask!==Z&&(this._funcMask=Z,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(Z){this._opStencilFail!==Z&&(this._opStencilFail=Z,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(Z){this._opDepthFail!==Z&&(this._opDepthFail=Z,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(Z){this._opStencilDepthPass!==Z&&(this._opStencilDepthPass=Z,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(Z){this._mask!==Z&&(this._mask=Z,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(Z){this._enabled!==Z&&(this._enabled=Z,this._isStencilTestDirty=!0)}constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,Z&&this.reset()}reset(){var Z;this.stencilMaterial=void 0,null===(Z=this.stencilGlobal)||void 0===Z||Z.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(Z){var c;if(!Z)return;const L=!this.useStencilGlobalOnly&&!(null===(c=this.stencilMaterial)||void 0===c||!c.enabled);this.enabled=L?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=L?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=L?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=L?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=L?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=L?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=L?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=L?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?Z.enable(Z.STENCIL_TEST):Z.disable(Z.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(Z.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(Z.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(Z.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class z{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=z.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=z.KEEP,this.opDepthFail=z.KEEP,this.opStencilDepthPass=z.REPLACE}get stencilFunc(){return this.func}set stencilFunc(Z){this.func=Z}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(Z){this.funcRef=Z}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(Z){this.funcMask=Z}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(Z){this.opStencilFail=Z}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(Z){this.opDepthFail=Z}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(Z){this.opStencilDepthPass=Z}get stencilMask(){return this.mask}set stencilMask(Z){this.mask=Z}get stencilTest(){return this.enabled}set stencilTest(Z){this.enabled=Z}}z.ALWAYS=519,z.KEEP=7680,z.REPLACE=7681;class i{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(Z){this._alphaBlend!==Z&&(this._alphaBlend=Z,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(Z,c,L,k){this._blendConstants[0]===Z&&this._blendConstants[1]===c&&this._blendConstants[2]===L&&this._blendConstants[3]===k||(this._blendConstants[0]=Z,this._blendConstants[1]=c,this._blendConstants[2]=L,this._blendConstants[3]=k,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(Z,c,L,k){this._blendFunctionParameters[0]===Z&&this._blendFunctionParameters[1]===c&&this._blendFunctionParameters[2]===L&&this._blendFunctionParameters[3]===k||(this._blendFunctionParameters[0]=Z,this._blendFunctionParameters[1]=c,this._blendFunctionParameters[2]=L,this._blendFunctionParameters[3]=k,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(Z,c){this._blendEquationParameters[0]===Z&&this._blendEquationParameters[1]===c||(this._blendEquationParameters[0]=Z,this._blendEquationParameters[1]=c,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(Z){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?Z.enable(Z.BLEND):Z.disable(Z.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(Z.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(Z.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(Z.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var t=L(11070),E=L(11139),x=L(11047),q=L(11027),O=L(11102),w=L(11144);function M(Z,c){if((0,x.k)()){const{requestAnimationFrame:L}=c||window;if("function"===typeof L)return L(Z)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(Z);return setTimeout(Z,16)}class P{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(Z){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(Z){Z!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=Z,this._depthCullingState.depthFunc=Z?518:515)}setColorWrite(Z){Z!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=Z)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(Z){if(Z)return this.isNDCHalfZRange?Z.IS_NDC_HALF_ZRANGE="":delete Z.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?Z.USE_REVERSE_DEPTHBUFFER="":delete Z.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?Z.USE_EXACT_SRGB_CONVERSIONS="":delete Z.USE_EXACT_SRGB_CONVERSIONS);{let Z="";return this.isNDCHalfZRange&&(Z+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(Z&&(Z+="\n"),Z+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(Z&&(Z+="\n"),Z+="#define USE_EXACT_SRGB_CONVERSIONS"),Z}}_rebuildInternalTextures(){const Z=this._internalTexturesCache.slice();for(const c of Z)c._rebuild()}_rebuildRenderTargetWrappers(){const Z=this._renderTargetWrapperCache.slice();for(const c of Z)c._rebuild()}_rebuildEffects(){for(const Z in this._compiledEffects){const c=this._compiledEffects[Z];c._pipelineContext=null,c._prepareEffect()}R.d.ResetCache()}_rebuildGraphicsResources(){var Z;this.wipeCaches(!0),this._rebuildEffects(),null===(Z=this._rebuildComputeEffects)||void 0===Z||Z.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){N.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(Z){setTimeout((()=>{this._clearEmptyResources();const c=this._depthCullingState.depthTest,L=this._depthCullingState.depthFunc,k=this._depthCullingState.depthMask,N=this._stencilState.stencilTest;Z(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=c,this._depthCullingState.depthFunc=L,this._depthCullingState.depthMask=k,this._stencilState.stencilTest=N,this._flagContextRestored()}),0)}get p(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(Z){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(Z){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const Z=new Uint8Array(4),c=[Z,Z,Z,Z,Z,Z];this._emptyCubeTexture=this.createRawCubeTexture(c,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(Z){if(!Z)return this._activeRenderLoops.length=0,void this._cancelFrame();const c=this._activeRenderLoops.indexOf(Z);c>=0&&(this._activeRenderLoops.splice(c,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const Z=this._frameHandler;if(this._frameHandler=0,(0,x.k)()){const{cancelAnimationFrame:c}=this.getHostWindow()||window;if("function"===typeof c)return c(Z)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(Z);return clearTimeout(Z)}}Hi(){this.onBeginFrameObservable.notifyObservers(this)}li(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(Z){this._maxFPS=Z,void 0!==Z&&(this._minFrameTime=Z<=0?Number.MAX_VALUE:1e3/Z)}_isOverFrameTime(Z){if(!Z||void 0===this._maxFPS)return!1;const c=Z-this._lastFrameTime;return this._lastFrameTime=Z,this._renderAccumulator+=c,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(Z){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(Z)){let Z=!0;(this.p||!this.renderEvenInBackground&&this._windowIsBackground)&&(Z=!1),Z&&(this.Hi(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.li())}}_renderLoop(Z){this._processFrame(Z),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let Z=0;Z<this._activeRenderLoops.length;Z++){(0,this._activeRenderLoops[Z])()}}_renderViews(){return!1}_queueNewFrame(Z,c){return M(Z,c)}runRenderLoop(Z){-1===this._activeRenderLoops.indexOf(Z)&&(this._activeRenderLoops.push(Z),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(Z){this._depthCullingState.depthTest=Z}setZOffset(Z){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-Z:Z}getZOffset(){const Z=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-Z:Z}setZOffsetUnits(Z){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-Z:Z}getZOffsetUnits(){const Z=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-Z:Z}getHostWindow(){return(0,x.k)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(Z){this._compatibilityMode=!0}_rebuildTextures(){for(const Z of this.scenes)Z._rebuildTextures();for(const Z of this._virtualScenes)Z._rebuildTextures()}_releaseRenderTargetWrapper(Z){const c=this._renderTargetWrapperCache.indexOf(Z);-1!==c&&this._renderTargetWrapperCache.splice(c,1)}get currentViewport(){return this._cachedViewport}setViewport(Z,c,L){const k=c||this.getRenderWidth(),N=L||this.getRenderHeight(),R=Z.x||0,G=Z.y||0;this._cachedViewport=Z,this._viewport(R*k,G*N,k*Z.width,N*Z.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(Z){return new Path2D(Z)}get description(){let Z=this.name+this.version;return this._caps.parallelShaderCompile&&(Z+=" - Parallel shader compilation"),Z}_createTextureBase(Z,c,L,R){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,O=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0,j=arguments.length>15?arguments[15]:void 0;const o="data:"===(Z=Z||"").substring(0,5),u="blob:"===Z.substring(0,5),X=o&&-1!==Z.indexOf(";base64,"),h=t||new E.e(this,1);h!==t&&(h.label=Z.substring(0,60));const B=Z;!this._transformTextureUrl||X||t||i||(Z=this._transformTextureUrl(Z)),B!==Z&&(h._originalUrl=B);const D=Z.lastIndexOf(".");let e=q||(D>-1?Z.substring(D).toLowerCase():"");e.indexOf("?")>-1&&(e=e.split("?")[0]);const H=(0,w.e)(e,O);R&&R.addPendingData(h),h.url=Z,h.generateMipMaps=!c,h.samplingMode=G,h.invertY=L,h._useSRGBBuffer=this._getUseSRGBBuffer(!!j,c),this._doNotHandleContextLost||(h._buffer=i);let l=null;V&&!t&&(l=h.onLoadedObservable.add(V)),t||this._internalTexturesCache.push(h);const W=(L,t)=>{R&&R.removePendingData(h),Z===B?(l&&h.onLoadedObservable.remove(l),k.d.UseFallbackTexture&&Z!==k.d.FallbackTexture&&this._createTextureBase(k.d.FallbackTexture,c,h.invertY,R,G,null,p,J,z,i,h),L=(L||"Unknown error")+(k.d.UseFallbackTexture?" - Fallback texture was used":""),h.onErrorObservable.notifyObservers({message:L,exception:t}),p&&p(L,t)):(N.e.Warn(`Failed to load ${Z}, falling back to ${B}`),this._createTextureBase(B,c,h.invertY,R,G,V,p,J,z,i,h,x,q,O,M,j))};if(H){const c=async Z=>{(await H).loadData(Z,h,((Z,c,L,k,N,V)=>{V?W("TextureLoader failed to load data"):J(h,e,R,{width:Z,height:c},h.invertY,!L,k,(()=>(N(),!1)),G)}),M)};i?i instanceof ArrayBuffer?c(new Uint8Array(i)):ArrayBuffer.isView(i)?c(i):p&&p("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(Z,(Z=>{c(new Uint8Array(Z))}),void 0,R?R.offlineProvider:void 0,!0,((Z,c)=>{W("Unable to load "+(Z&&Z.responseURL,c))}))}else{const L=Z=>{u&&!this._doNotHandleContextLost&&(h._buffer=Z),J(h,e,R,Z,h.invertY,c,!1,z,G)};!o||X?i&&("string"===typeof i.decoding||i.close)?L(i):P._FileToolsLoadImage(Z||"",L,W,R?R.offlineProvider:null,O,h.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof i||i instanceof ArrayBuffer||ArrayBuffer.isView(i)||i instanceof Blob?P._FileToolsLoadImage(i,L,W,R?R.offlineProvider:null,O,h.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):i&&L(i)}return h}_rebuildBuffers(){for(const Z of this._uniformBuffers)Z._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,x.e)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const Z in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,Z)&&(this._boundTexturesCache[Z]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(Z){this._name=Z}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(Z){this._hardwareScalingLevel=Z,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(Z){this._doNotHandleContextLost=Z}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(Z,c,L){var N,R;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new p,this._stencilStateComposer=new J,this._stencilState=new z,this._alphaState=new i,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new q.b,this.onCanvasFocusObservable=new q.b,this.onNewSceneAddedObservable=new q.b,this.onResizeObservable=new q.b,this.onCanvasPointerOutObservable=new q.b,this.onEffectErrorObservable=new q.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new q.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=Z=>this._renderLoop(Z),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new q.b,this.onAfterShaderCompilationObservable=new q.b,this.onBeginFrameObservable=new q.b,this.onEndFrameObservable=new q.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new q.b,this.onContextRestoredObservable=new q.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Xc=new q.b,this.onReleaseEffectsObservable=new q.b,k.d.Instances.push(this),this.startTime=V.c.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,G.c.SetMatrixPrecision(!!c.useHighPrecisionMatrix),(0,x.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=L??!1,c.antialias=Z??c.antialias,c.deterministicLockstep=c.deterministicLockstep??!1,c.lockstepMaxSteps=c.lockstepMaxSteps??4,c.timeStep=c.timeStep??1/60,c.stencil=c.stencil??!0,this._audioContext=(null===(N=c.audioEngineOptions)||void 0===N?void 0:N.audioContext)??null,this._audioDestination=(null===(R=c.audioEngineOptions)||void 0===R?void 0:R.audioDestination)??null,this.premultipliedAlpha=c.premultipliedAlpha??!0,this._doNotHandleContextLost=!!c.doNotHandleContextLost,this._isStencilEnable=!!c.stencil,this.useExactSrgbConversions=c.useExactSrgbConversions??!1;const t=(0,x.k)()&&window.devicePixelRatio||1,E=c.limitDeviceRatio||t;L=L||c.adaptToDeviceRatio||!1,this._hardwareScalingLevel=L?1/Math.min(E,t):1,this._lastDevicePixelRatio=t,this._creationOptions=c}resize(){let Z,c,L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const Z=(0,x.k)()&&window.devicePixelRatio||1,c=this._lastDevicePixelRatio/Z;this._lastDevicePixelRatio=Z,this._hardwareScalingLevel*=c}if((0,x.k)()&&(0,x.e)())if(this._renderingCanvas){var k,N;const L=null===(k=(N=this._renderingCanvas).getBoundingClientRect)||void 0===k?void 0:k.call(N);Z=this._renderingCanvas.clientWidth||(null===L||void 0===L?void 0:L.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,c=this._renderingCanvas.clientHeight||(null===L||void 0===L?void 0:L.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else Z=window.innerWidth,c=window.innerHeight;else Z=this._renderingCanvas?this._renderingCanvas.width:100,c=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(Z/this._hardwareScalingLevel,c/this._hardwareScalingLevel,L)}setSize(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(Z|=0,c|=0,!L&&this._renderingCanvas.width===Z&&this._renderingCanvas.height===c)return!1;if(this._renderingCanvas.width=Z,this._renderingCanvas.height=c,this.scenes){for(let Z=0;Z<this.scenes.length;Z++){const c=this.scenes[Z];for(let Z=0;Z<c.cameras.length;Z++){c.cameras[Z]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(Z,c,L,k,N,R,G,V,p,J,z){throw(0,t.e)("engine.rawTexture")}createRawCubeTexture(Z,c,L,k,N,R,G,V){throw(0,t.e)("engine.rawTexture")}createRawTexture3D(Z,c,L,k,N,R,G,V,p,J,z){throw(0,t.e)("engine.rawTexture")}createRawTexture2DArray(Z,c,L,k,N,R,G,V,p,J,z){throw(0,t.e)("engine.rawTexture")}_sharedInit(Z){this._renderingCanvas=Z}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const Z=navigator.userAgent;this.hostInformation.isMobile=-1!==Z.indexOf("Mobile")||-1!==Z.indexOf("Mac")&&(0,x.e)()&&"ontouchend"in document},this._checkForMobile(),(0,x.k)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(Z){return document.createElement("video")}_reportDrawCall(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(Z=this._drawCalls)||void 0===Z||Z.addCount(c,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(Z,c){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(Z,c){return createImageBitmap(Z,c)}resizeImageBitmap(Z,c,L){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(Z){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(Z,c){if("undefined"===typeof document)return new OffscreenCanvas(Z,c);const L=document.createElement("canvas");return L.width=Z,L.height=c,L}createCanvas(Z,c){return P._CreateCanvas(Z,c)}static _FileToolsLoadImage(Z,c,L,k,N,R,G){throw(0,t.e)("FileTools")}_loadFile(Z,c,L,k,N,R){const G=(0,O.l)(Z,c,L,k,N,R);return this._activeRequests.push(G),G.onCompleteObservable.add((()=>{const Z=this._activeRequests.indexOf(G);-1!==Z&&this._activeRequests.splice(Z,1)})),G}static _FileToolsLoadFile(Z,c,L,k,N,R){if(O.e.loadFile)return O.e.loadFile(Z,c,L,k,N,R);throw(0,t.e)("FileTools")}dispose(){var Z;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(Z=this.releaseComputeEffects)||void 0===Z||Z.call(this),R.d.ResetCache();for(const L of this._activeRequests)L.abort();this._boundRenderFunction=null,this.Xc.notifyObservers(this),this.Xc.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,x.k)()&&window.removeEventListener("resize",this._checkForMobile);const c=k.d.Instances.indexOf(this);c>=0&&k.d.Instances.splice(c,1),k.d.Instances.length||(k.d.OnEnginesDisposedObservable.notifyObservers(this),k.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(Z){throw(0,t.e)("LoadingScreen")}static MarkAllMaterialsAsDirty(Z,c){for(let L=0;L<k.d.Instances.length;L++){const N=k.d.Instances[L];for(let L=0;L<N.scenes.length;L++)N.scenes[L].markAllMaterialsAsDirty(Z,c)}}}P._RenderPassIdCounter=0,P._RescalePostProcessFactory=null,P.CollisionsEpsilon=.001,P.QueueNewFrame=M},11549:(Z,c,L)=>{L.d(c,{b:()=>k});class k{}k.AUTOSAMPLERSUFFIX="Sampler",k.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",k.ALPHA_DISABLE=0,k.ALPHA_ADD=1,k.ALPHA_COMBINE=2,k.ALPHA_SUBTRACT=3,k.ALPHA_MULTIPLY=4,k.ALPHA_MAXIMIZED=5,k.ALPHA_ONEONE=6,k.ALPHA_PREMULTIPLIED=7,k.ALPHA_PREMULTIPLIED_PORTERDUFF=8,k.ALPHA_INTERPOLATE=9,k.ALPHA_SCREENMODE=10,k.ALPHA_ONEONE_ONEONE=11,k.ALPHA_ALPHATOCOLOR=12,k.ALPHA_REVERSEONEMINUS=13,k.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,k.ALPHA_ONEONE_ONEZERO=15,k.ALPHA_EXCLUSION=16,k.ALPHA_LAYER_ACCUMULATE=17,k.ALPHA_EQUATION_ADD=0,k.ALPHA_EQUATION_SUBSTRACT=1,k.ALPHA_EQUATION_REVERSE_SUBTRACT=2,k.ALPHA_EQUATION_MAX=3,k.ALPHA_EQUATION_MIN=4,k.ALPHA_EQUATION_DARKEN=5,k.DELAYLOADSTATE_NONE=0,k.DELAYLOADSTATE_LOADED=1,k.DELAYLOADSTATE_LOADING=2,k.DELAYLOADSTATE_NOTLOADED=4,k.NEVER=512,k.ALWAYS=519,k.LESS=513,k.EQUAL=514,k.LEQUAL=515,k.GREATER=516,k.GEQUAL=518,k.NOTEQUAL=517,k.KEEP=7680,k.ZERO=0,k.REPLACE=7681,k.INCR=7682,k.DECR=7683,k.INVERT=5386,k.INCR_WRAP=34055,k.DECR_WRAP=34056,k.TEXTURE_CLAMP_ADDRESSMODE=0,k.TEXTURE_WRAP_ADDRESSMODE=1,k.TEXTURE_MIRROR_ADDRESSMODE=2,k.TEXTURE_CREATIONFLAG_STORAGE=1,k.TEXTUREFORMAT_ALPHA=0,k.TEXTUREFORMAT_LUMINANCE=1,k.TEXTUREFORMAT_LUMINANCE_ALPHA=2,k.TEXTUREFORMAT_RGB=4,k.TEXTUREFORMAT_RGBA=5,k.TEXTUREFORMAT_RED=6,k.TEXTUREFORMAT_R=6,k.TEXTUREFORMAT_R16_UNORM=33322,k.TEXTUREFORMAT_RG16_UNORM=33324,k.TEXTUREFORMAT_RGB16_UNORM=32852,k.TEXTUREFORMAT_RGBA16_UNORM=32859,k.TEXTUREFORMAT_R16_SNORM=36760,k.TEXTUREFORMAT_RG16_SNORM=36761,k.TEXTUREFORMAT_RGB16_SNORM=36762,k.TEXTUREFORMAT_RGBA16_SNORM=36763,k.TEXTUREFORMAT_RG=7,k.TEXTUREFORMAT_RED_INTEGER=8,k.TEXTUREFORMAT_R_INTEGER=8,k.TEXTUREFORMAT_RG_INTEGER=9,k.TEXTUREFORMAT_RGB_INTEGER=10,k.TEXTUREFORMAT_RGBA_INTEGER=11,k.TEXTUREFORMAT_BGRA=12,k.TEXTUREFORMAT_DEPTH24_STENCIL8=13,k.TEXTUREFORMAT_DEPTH32_FLOAT=14,k.TEXTUREFORMAT_DEPTH16=15,k.TEXTUREFORMAT_DEPTH24=16,k.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,k.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,k.TEXTUREFORMAT_STENCIL8=19,k.TEXTUREFORMAT_UNDEFINED=4294967295,k.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,k.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,k.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,k.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,k.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,k.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,k.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,k.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,k.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,k.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,k.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,k.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,k.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,k.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,k.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,k.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,k.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,k.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,k.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,k.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,k.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,k.TEXTURETYPE_UNSIGNED_BYTE=0,k.TEXTURETYPE_UNSIGNED_INT=0,k.TEXTURETYPE_FLOAT=1,k.TEXTURETYPE_HALF_FLOAT=2,k.TEXTURETYPE_BYTE=3,k.TEXTURETYPE_SHORT=4,k.TEXTURETYPE_UNSIGNED_SHORT=5,k.TEXTURETYPE_INT=6,k.TEXTURETYPE_UNSIGNED_INTEGER=7,k.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,k.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,k.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,k.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,k.TEXTURETYPE_UNSIGNED_INT_24_8=12,k.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,k.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,k.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,k.TEXTURETYPE_UNDEFINED=16,k.TEXTURE_2D=3553,k.TEXTURE_2D_ARRAY=35866,k.TEXTURE_CUBE_MAP=34067,k.TEXTURE_CUBE_MAP_ARRAY=3735928559,k.TEXTURE_3D=32879,k.TEXTURE_NEAREST_SAMPLINGMODE=1,k.TEXTURE_NEAREST_NEAREST=1,k.TEXTURE_BILINEAR_SAMPLINGMODE=2,k.TEXTURE_LINEAR_LINEAR=2,k.TEXTURE_TRILINEAR_SAMPLINGMODE=3,k.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,k.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,k.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,k.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,k.TEXTURE_NEAREST_LINEAR=7,k.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,k.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,k.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,k.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,k.TEXTURE_LINEAR_NEAREST=12,k.TEXTURE_EXPLICIT_MODE=0,k.TEXTURE_SPHERICAL_MODE=1,k.TEXTURE_PLANAR_MODE=2,k.TEXTURE_CUBIC_MODE=3,k.TEXTURE_PROJECTION_MODE=4,k.TEXTURE_SKYBOX_MODE=5,k.TEXTURE_INVCUBIC_MODE=6,k.TEXTURE_EQUIRECTANGULAR_MODE=7,k.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,k.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,k.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,k.TEXTURE_FILTERING_QUALITY_HIGH=64,k.TEXTURE_FILTERING_QUALITY_MEDIUM=16,k.TEXTURE_FILTERING_QUALITY_LOW=8,k.SCALEMODE_FLOOR=1,k.SCALEMODE_NEAREST=2,k.SCALEMODE_CEILING=3,k.MATERIAL_TextureDirtyFlag=1,k.MATERIAL_LightDirtyFlag=2,k.MATERIAL_FresnelDirtyFlag=4,k.MATERIAL_AttributesDirtyFlag=8,k.MATERIAL_MiscDirtyFlag=16,k.MATERIAL_PrePassDirtyFlag=32,k.MATERIAL_ImageProcessingDirtyFlag=64,k.MATERIAL_AllDirtyFlag=127,k.MATERIAL_TriangleFillMode=0,k.MATERIAL_WireFrameFillMode=1,k.MATERIAL_PointFillMode=2,k.MATERIAL_PointListDrawMode=3,k.MATERIAL_LineListDrawMode=4,k.MATERIAL_LineLoopDrawMode=5,k.MATERIAL_LineStripDrawMode=6,k.MATERIAL_TriangleStripDrawMode=7,k.MATERIAL_TriangleFanDrawMode=8,k.MATERIAL_ClockWiseSideOrientation=0,k.MATERIAL_CounterClockWiseSideOrientation=1,k.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,k.MATERIAL_DIFFUSE_MODEL_BURLEY=1,k.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,k.MATERIAL_DIFFUSE_MODEL_LEGACY=3,k.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,k.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,k.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,k.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,k.ACTION_NothingTrigger=0,k.ACTION_OnPickTrigger=1,k.ACTION_OnLeftPickTrigger=2,k.ACTION_OnRightPickTrigger=3,k.ACTION_OnCenterPickTrigger=4,k.ACTION_OnPickDownTrigger=5,k.ACTION_OnDoublePickTrigger=6,k.ACTION_OnPickUpTrigger=7,k.ACTION_OnPickOutTrigger=16,k.ACTION_OnLongPressTrigger=8,k.ACTION_OnPointerOverTrigger=9,k.ACTION_OnPointerOutTrigger=10,k.ACTION_OnEveryFrameTrigger=11,k.ACTION_OnIntersectionEnterTrigger=12,k.ACTION_OnIntersectionExitTrigger=13,k.ACTION_OnKeyDownTrigger=14,k.ACTION_OnKeyUpTrigger=15,k.PARTICLES_BILLBOARDMODE_Y=2,k.PARTICLES_BILLBOARDMODE_ALL=7,k.PARTICLES_BILLBOARDMODE_STRETCHED=8,k.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,k.MESHES_CULLINGSTRATEGY_STANDARD=0,k.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,k.SCENELOADER_NO_LOGGING=0,k.SCENELOADER_MINIMAL_LOGGING=1,k.SCENELOADER_SUMMARY_LOGGING=2,k.SCENELOADER_DETAILED_LOGGING=3,k.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,k.PREPASS_POSITION_TEXTURE_TYPE=1,k.PREPASS_VELOCITY_TEXTURE_TYPE=2,k.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,k.PREPASS_COLOR_TEXTURE_TYPE=4,k.PREPASS_DEPTH_TEXTURE_TYPE=5,k.PREPASS_NORMAL_TEXTURE_TYPE=6,k.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,k.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,k.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,k.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,k.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,k.PREPASS_ALBEDO_TEXTURE_TYPE=12,k.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,k.BUFFER_CREATIONFLAG_READ=1,k.BUFFER_CREATIONFLAG_WRITE=2,k.BUFFER_CREATIONFLAG_READWRITE=3,k.BUFFER_CREATIONFLAG_UNIFORM=4,k.BUFFER_CREATIONFLAG_VERTEX=8,k.BUFFER_CREATIONFLAG_INDEX=16,k.BUFFER_CREATIONFLAG_STORAGE=32,k.BUFFER_CREATIONFLAG_INDIRECT=64,k.RENDERPASS_MAIN=0,k.INPUT_ALT_KEY=18,k.INPUT_CTRL_KEY=17,k.INPUT_META_KEY1=91,k.INPUT_META_KEY2=92,k.INPUT_META_KEY3=93,k.INPUT_SHIFT_KEY=16,k.SNAPSHOTRENDERING_STANDARD=0,k.SNAPSHOTRENDERING_FAST=1,k.PERSPECTIVE_CAMERA=0,k.ORTHOGRAPHIC_CAMERA=1,k.FOVMODE_VERTICAL_FIXED=0,k.FOVMODE_HORIZONTAL_FIXED=1,k.RIG_MODE_NONE=0,k.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,k.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,k.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,k.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,k.RIG_MODE_STEREOSCOPIC_INTERLACED=14,k.RIG_MODE_VR=20,k.RIG_MODE_CUSTOM=22,k.MAX_SUPPORTED_UV_SETS=6,k.GL_ALPHA_EQUATION_ADD=32774,k.GL_ALPHA_EQUATION_MIN=32775,k.GL_ALPHA_EQUATION_MAX=32776,k.GL_ALPHA_EQUATION_SUBTRACT=32778,k.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,k.GL_ALPHA_FUNCTION_SRC=768,k.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,k.GL_ALPHA_FUNCTION_SRC_ALPHA=770,k.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,k.GL_ALPHA_FUNCTION_DST_ALPHA=772,k.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,k.GL_ALPHA_FUNCTION_DST_COLOR=774,k.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,k.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,k.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,k.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,k.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,k.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,k.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,k.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,k.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,k.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,k.SnippetUrl="https://snippet.babylonjs.com",k.FOGMODE_NONE=0,k.FOGMODE_EXP=1,k.FOGMODE_EXP2=2,k.FOGMODE_LINEAR=3,k.BYTE=5120,k.UNSIGNED_BYTE=5121,k.SHORT=5122,k.UNSIGNED_SHORT=5123,k.INT=5124,k.UNSIGNED_INT=5125,k.FLOAT=5126,k.PositionKind="position",k.NormalKind="kc",k.TangentKind="tangent",k.UVKind="uv",k.UV2Kind="uv2",k.UV3Kind="uv3",k.UV4Kind="uv4",k.UV5Kind="uv5",k.UV6Kind="uv6",k.ColorKind="color",k.ColorInstanceKind="instanceColor",k.MatricesIndicesKind="matricesIndices",k.MatricesWeightsKind="matricesWeights",k.MatricesIndicesExtraKind="matricesIndicesExtra",k.MatricesWeightsExtraKind="matricesWeightsExtra",k.ANIMATIONTYPE_FLOAT=0,k.ANIMATIONTYPE_VECTOR3=1,k.ANIMATIONTYPE_QUATERNION=2,k.ANIMATIONTYPE_MATRIX=3,k.ANIMATIONTYPE_COLOR3=4,k.ANIMATIONTYPE_COLOR4=7,k.ANIMATIONTYPE_VECTOR2=5,k.ANIMATIONTYPE_SIZE=6,k.ShadowMinZ=0,k.ShadowMaxZ=1e4},11395:(Z,c,L)=>{L.d(c,{c:()=>h});var k=L(11139),N=L(11023),R=L(11397),G=L(11065);class V{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new p(Z)}sampleFrame(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.c.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const c=Z-this._lastFrameTimeMs;this._rollingFrameTime.add(c)}this._lastFrameTimeMs=Z}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const Z=this._rollingFrameTime.history(0);return 0===Z?0:1e3/Z}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class p{constructor(Z){this._samples=new Array(Z),this.reset()}add(Z){let c;if(this.isSaturated()){const Z=this._samples[this._pos];c=Z-this.average,this.average-=c/(this._sampleCount-1),this._m2-=c*(Z-this.average)}else this._sampleCount++;c=Z-this.average,this.average+=c/this._sampleCount,this._m2+=c*(Z-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=Z,this._pos++,this._pos%=this._samples.length}history(Z){if(Z>=this._sampleCount||Z>=this._samples.length)return 0;const c=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(c-Z)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(Z){const c=this._samples.length;return(Z%c+c)%c}}var J=L(11408),z=L(11052),i=L(11415),t=(L(11429),L(11159));function E(Z,c,L,k){let N,R=1;1===k?N=new Float32Array(c*L*4):2===k?(N=new Uint16Array(c*L*4),R=15360):N=7===k?new Uint32Array(c*L*4):new Uint8Array(c*L*4);for(let G=0;G<c;G++)for(let k=0;k<L;k++){const L=3*(k*c+G),V=4*(k*c+G);N[V+0]=Z[L+0],N[V+1]=Z[L+1],N[V+2]=Z[L+2],N[V+3]=R}return N}function x(Z){return function(c,L,N,R,G,V,p,J){let z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const t=Z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,E=Z?10:11,x=new k.e(this,E);x.baseWidth=L,x.baseHeight=N,x.baseDepth=R,x.width=L,x.height=N,x.depth=R,x.format=G,x.type=i,x.generateMipMaps=V,x.samplingMode=J,Z?x.is3D=!0:x.is2DArray=!0,this._doNotHandleContextLost||(x._bufferView=c),Z?this.updateRawTexture3D(x,c,G,p,z,i):this.updateRawTexture2DArray(x,c,G,p,z,i),this._bindTextureDirectly(t,x,!0);const q=this._getSamplingParameters(J,V);return this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,q.mag),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,q.min),V&&this._gl.generateMipmap(t),this._bindTextureDirectly(t,null),this._internalTexturesCache.push(x),x}}function q(Z){return function(c,L,k,N){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const V=Z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,p=this._getWebGLTextureType(G),J=this._getInternalFormat(k),z=this._getRGBABufferInternalSizedFormat(G,k);this._bindTextureDirectly(V,c,!0),this._unpackFlipY(void 0===N||!!N),this._doNotHandleContextLost||(c._bufferView=L,c.format=k,c.invertY=N,c._compression=R),c.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),R&&L?this._gl.compressedTexImage3D(V,0,this.getCaps().s3tc[R],c.width,c.height,c.depth,0,L):this._gl.texImage3D(V,0,z,c.width,c.height,c.depth,0,J,p,L),c.generateMipMaps&&this._gl.generateMipmap(V),this._bindTextureDirectly(V,null),c.isReady=!0}}R.ThinEngine.prototype.updateRawTexture=function(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!Z)return;const V=this._getRGBABufferInternalSizedFormat(R,L,G),p=this._getInternalFormat(L),J=this._getWebGLTextureType(R);this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),this._unpackFlipY(void 0===k||!!k),this._doNotHandleContextLost||(Z._bufferView=c,Z.format=L,Z.type=R,Z.invertY=k,Z._compression=N),Z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),N&&c?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[N],Z.width,Z.height,0,c):this._gl.texImage2D(this._gl.TEXTURE_2D,0,V,Z.width,Z.height,0,p,J,c),Z.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),Z.isReady=!0},R.ThinEngine.prototype.createRawTexture=function(Z,c,L,N,R,G,V){let p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,z=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const i=new k.e(this,3);i.baseWidth=c,i.baseHeight=L,i.width=c,i.height=L,i.format=N,i.generateMipMaps=R,i.samplingMode=V,i.invertY=G,i._compression=p,i.type=J,i._useSRGBBuffer=this._getUseSRGBBuffer(z,!R),this._doNotHandleContextLost||(i._bufferView=Z),this.updateRawTexture(i,Z,N,G,p,J,i._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);const t=this._getSamplingParameters(V,R);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,t.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,t.min),R&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(i),i},R.ThinEngine.prototype.createRawCubeTexture=function(Z,c,L,N,R,G,V){let p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const J=this._gl,i=new k.e(this,8);i.isCube=!0,i.format=L,i.type=N,this._doNotHandleContextLost||(i._bufferViewArray=Z);const E=this._getWebGLTextureType(N);let x=this._getInternalFormat(L);x===J.RGB&&(x=J.RGBA),E!==J.FLOAT||this._caps.textureFloatLinearFiltering?E!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?E!==J.FLOAT||this._caps.textureFloatRender?E!==J.HALF_FLOAT||this._caps.colorBufferFloat||(R=!1,z.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(R=!1,z.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(R=!1,V=1,z.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(R=!1,V=1,z.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const q=c,O=q;i.width=q,i.height=O,i.invertY=G,i._compression=p;if(!this.needPOTTextures||(0,t.i)(i.width)&&(0,t.i)(i.height)||(R=!1),Z)this.updateRawCubeTexture(i,Z,L,N,G,p);else{const Z=this._getRGBABufferInternalSizedFormat(N),c=0;this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,i,!0);for(let L=0;L<6;L++)p?J.compressedTexImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+L,c,this.getCaps().s3tc[p],i.width,i.height,0,void 0):J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+L,c,Z,i.width,i.height,0,x,E,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,i,!0),Z&&R&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const w=this._getSamplingParameters(V,R);return J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,w.mag),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,w.min),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null),i.generateMipMaps=R,i.samplingMode=V,i.isReady=!0,i},R.ThinEngine.prototype.updateRawCubeTexture=function(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;Z._bufferViewArray=c,Z.format=L,Z.type=k,Z.invertY=N,Z._compression=R;const V=this._gl,p=this._getWebGLTextureType(k);let J=this._getInternalFormat(L);const z=this._getRGBABufferInternalSizedFormat(k);let i=!1;J===V.RGB&&(J=V.RGBA,i=!0),this._bindTextureDirectly(V.TEXTURE_CUBE_MAP,Z,!0),this._unpackFlipY(void 0===N||!!N),Z.width%4!==0&&V.pixelStorei(V.UNPACK_ALIGNMENT,1);for(let t=0;t<6;t++){let L=c[t];R?V.compressedTexImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+t,G,this.getCaps().s3tc[R],Z.width,Z.height,0,L):(i&&(L=E(L,Z.width,Z.height,k)),V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+t,G,z,Z.width,Z.height,0,J,p,L))}(!this.needPOTTextures||(0,t.i)(Z.width)&&(0,t.i)(Z.height))&&Z.generateMipMaps&&0===G&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),Z.isReady=!0},R.ThinEngine.prototype.createRawCubeTextureFromUrl=function(Z,c,L,k,N,R,G,V){let p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,i=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const t=this._gl,x=this.createRawCubeTexture(null,L,k,N,!R,i,z,null);null===c||void 0===c||c.addPendingData(x),x.url=Z,x.isReady=!1,this._internalTexturesCache.push(x);const q=Z=>{if(!x._hardwareTexture)return;const L=x.width,R=G(Z);if(R){if(V){const Z=this._getWebGLTextureType(N);let c=this._getInternalFormat(k);const G=this._getRGBABufferInternalSizedFormat(N);let p=!1;c===t.RGB&&(c=t.RGBA,p=!0),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,x,!0),this._unpackFlipY(!1);const J=V(R);for(let k=0;k<J.length;k++){const R=L>>k;for(let L=0;L<6;L++){let V=J[k][L];p&&(V=E(V,R,R,N)),t.texImage2D(L,k,G,R,R,0,c,Z,V)}}this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(x,R,k,N,i);x.isReady=!0,null===c||void 0===c||c.removePendingData(x),x.onLoadedObservable.notifyObservers(x),x.onLoadedObservable.clear(),p&&p()}};return this._loadFile(Z,(Z=>{q(Z)}),void 0,null===c||void 0===c?void 0:c.offlineProvider,!0,((Z,L)=>{null===c||void 0===c||c.removePendingData(x),J&&Z&&J(Z.status+" "+Z.statusText,L)})),x},R.ThinEngine.prototype.createRawTexture2DArray=x(!1),R.ThinEngine.prototype.createRawTexture3D=x(!0),R.ThinEngine.prototype.updateRawTexture2DArray=q(!1),R.ThinEngine.prototype.updateRawTexture3D=q(!0);var O=L(11102);R.ThinEngine.prototype._readTexturePixelsSync=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const z=this._gl;if(!z)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const Z=z.createFramebuffer();if(!Z)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=Z}var i,t;(z.bindFramebuffer(z.FRAMEBUFFER,this._dummyFramebuffer),k>-1)?z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+k,null===(i=Z._hardwareTexture)||void 0===i?void 0:i.underlyingResource,N):z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,null===(t=Z._hardwareTexture)||void 0===t?void 0:t.underlyingResource,N);let E=void 0!==Z.type?this._getWebGLTextureType(Z.type):z.UNSIGNED_BYTE;if(V)R||(R=(0,O.o)(Z.type,4*c*L));else if(E===z.UNSIGNED_BYTE)R||(R=new Uint8Array(4*c*L)),E=z.UNSIGNED_BYTE;else R||(R=new Float32Array(4*c*L)),E=z.FLOAT;return G&&this.flushFramebuffer(),z.readPixels(p,J,c,L,z.RGBA,E,R),z.bindFramebuffer(z.FRAMEBUFFER,this._currentFramebuffer),R},R.ThinEngine.prototype._readTexturePixels=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(Z,c,L,k,N,R,G,V,p,J))};L(11431);R.ThinEngine.prototype._createDepthStencilCubeTexture=function(Z,c){const L=new k.e(this,12);if(L.isCube=!0,1===this.webGLVersion)return z.e.Error("Depth cube texture is not supported by WebGL 1."),L;const N={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c},R=this._gl;this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,L,!0),this._setupDepthStencilTexture(L,Z,N.bilinearFiltering,N.comparisonFunction);for(let k=0;k<6;k++)N.generateStencil?R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,R.DEPTH24_STENCIL8,Z,Z,0,R.DEPTH_STENCIL,R.UNSIGNED_INT_24_8,null):R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,R.DEPTH_COMPONENT24,Z,Z,0,R.DEPTH_COMPONENT,R.UNSIGNED_INT,null);return this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(L),L},R.ThinEngine.prototype._setCubeMapTextureParams=function(Z,c,L){const k=this._gl;k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAG_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MIN_FILTER,c?k.LINEAR_MIPMAP_LINEAR:k.LINEAR),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),Z.samplingMode=c?3:2,c&&this.getCaps().textureMaxLevel&&void 0!==L&&L>0&&(k.texParameteri(k.TEXTURE_CUBE_MAP,k.TEXTURE_MAX_LEVEL,L),Z._maxLodLevel=L),this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null)},R.ThinEngine.prototype.createCubeTexture=function(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,x=arguments.length>13&&void 0!==arguments[13]&&arguments[13],q=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const O=this._gl;return this.createCubeTextureBase(Z,c,L,!!k,N,R,G,V,p,J,i,E,(Z=>this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,Z,!0)),((Z,c)=>{const L=this.needPOTTextures?(0,t.h)(c[0].width,this._caps.maxCubemapTextureSize):c[0].width,R=L,V=[O.TEXTURE_CUBE_MAP_POSITIVE_X,O.TEXTURE_CUBE_MAP_POSITIVE_Y,O.TEXTURE_CUBE_MAP_POSITIVE_Z,O.TEXTURE_CUBE_MAP_NEGATIVE_X,O.TEXTURE_CUBE_MAP_NEGATIVE_Y,O.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,Z,!0),this._unpackFlipY(!1);const p=G?this._getInternalFormat(G,Z._useSRGBBuffer):Z._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:O.RGBA;let J=G?this._getInternalFormat(G):O.RGBA;Z._useSRGBBuffer&&1===this.webGLVersion&&(J=p);for(let k=0;k<V.length;k++)if(c[k].width!==L||c[k].height!==R){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void z.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=L,this._workingCanvas.height=R,this._workingContext.drawImage(c[k],0,0,c[k].width,c[k].height,0,0,L,R),O.texImage2D(V[k],0,p,J,O.UNSIGNED_BYTE,this._workingCanvas)}else O.texImage2D(V[k],0,p,J,O.UNSIGNED_BYTE,c[k]);k||O.generateMipmap(O.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(Z,!k),Z.width=L,Z.height=R,Z.isReady=!0,G&&(Z.format=G),Z.onLoadedObservable.notifyObservers(Z),Z.onLoadedObservable.clear(),N&&N()}),!!x,q)},R.ThinEngine.prototype.generateMipMapsForCubemap=function(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z.generateMipMaps){const L=this._gl;this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,Z,!0),L.generateMipmap(L.TEXTURE_CUBE_MAP),c&&this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,null)}};L(11435);R.ThinEngine.prototype.setDepthStencilTexture=function(Z,c,L,k){void 0!==Z&&(c&&(this._boundUniforms[Z]=c),L&&L.depthStencilTexture?this._setTexture(Z,L,!1,!0,k):this._setTexture(Z,null,void 0,void 0,k))},R.ThinEngine.prototype.createRenderTargetCubeTexture=function(Z,c){const L=this._createHardwareRenderTargetWrapper(!1,!0,Z),N={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...c};N.generateStencilBuffer=N.generateDepthBuffer&&N.generateStencilBuffer,(1!==N.type||this._caps.textureFloatLinearFiltering)&&(2!==N.type||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=1);const R=this._gl,G=new k.e(this,5);this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,G,!0);const V=this._getSamplingParameters(N.samplingMode,N.generateMipMaps);1!==N.type||this._caps.textureFloat||(N.type=0,z.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_MAG_FILTER,V.mag),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_MIN_FILTER,V.min),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE);for(let k=0;k<6;k++)R.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,this._getRGBABufferInternalSizedFormat(N.type,N.format),Z,Z,0,this._getInternalFormat(N.format),this._getWebGLTextureType(N.type),null);const p=R.createFramebuffer();return this._bindUnboundFramebuffer(p),L._depthStencilBuffer=this._setupFramebufferDepthAttachments(N.generateStencilBuffer,N.generateDepthBuffer,Z,Z),N.generateMipMaps&&R.generateMipmap(R.TEXTURE_CUBE_MAP),this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),L._framebuffer=p,L._generateDepthBuffer=N.generateDepthBuffer,L._generateStencilBuffer=N.generateStencilBuffer,G.width=Z,G.height=Z,G.isReady=!0,G.isCube=!0,G.samples=1,G.generateMipMaps=N.generateMipMaps,G.samplingMode=N.samplingMode,G.type=N.type,G.format=N.format,this._internalTexturesCache.push(G),L.setTextures(G),L};var w=L(11461),M=L(11487);R.ThinEngine.prototype.createPrefilteredCubeTexture=function(Z,c,N,R){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(Z,c,null,!1,(async Z=>{if(!Z)return void(G&&G(null));const V=Z.texture;if(i?Z.info.sphericalPolynomial&&(V._sphericalPolynomial=Z.info.sphericalPolynomial):V._sphericalPolynomial=new w.d,V._source=9,this.getCaps().textureLOD)return void(G&&G(V));const p=this._gl,J=Z.width;if(!J)return;const{DDSTools:t}=await L.e(26).then(L.bind(L,13578)),E=[];for(let L=0;L<3;L++){const G=1-L/2,i=R,x=Math.log2(J)*N+R,q=i+(x-i)*G,O=Math.round(Math.min(Math.max(q,0),x)),w=new k.e(this,2);if(w.type=V.type,w.format=V.format,w.width=Math.pow(2,Math.max(Math.log2(J)-O,0)),w.height=w.width,w.isCube=!0,w._cachedWrapU=0,w._cachedWrapV=0,this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,w,!0),w.samplingMode=2,p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),Z.isDDS){const c=Z.info,L=Z.data;this._unpackFlipY(c.isCompressed),t.UploadDDSLevels(this,w,L,c,!0,6,O)}else z.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null);const P=new M.d(c);P._isCube=!0,P._texture=w,w.isReady=!0,E.push(P)}V._lodTextureHigh=E[2],V._lodTextureMid=E[1],V._lodTextureLow=E[0],G&&G(V)}),V,p,J,i,N,R)},R.ThinEngine.prototype.createUniformBuffer=function(Z,c){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create uniform buffer");const k=new J.d(L);return this.bindUniformBuffer(k),Z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,Z,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(Z),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),k.references=1,k},R.ThinEngine.prototype.createDynamicUniformBuffer=function(Z,c){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create dynamic uniform buffer");const k=new J.d(L);return this.bindUniformBuffer(k),Z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,Z,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(Z),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),k.references=1,k},R.ThinEngine.prototype.updateUniformBuffer=function(Z,c,L,k){this.bindUniformBuffer(Z),void 0===L&&(L=0),void 0===k?c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,L,c):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,L,new Float32Array(c)):c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,c.subarray(L,L+k)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(c).subarray(L,L+k)),this.bindUniformBuffer(null)},R.ThinEngine.prototype.bindUniformBuffer=function(Z){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,Z?Z.underlyingResource:null)},R.ThinEngine.prototype.bindUniformBufferBase=function(Z,c,L){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,c,Z?Z.underlyingResource:null)},R.ThinEngine.prototype.bindUniformBlock=function(Z,c,L){const k=Z.program,N=this._gl.getUniformBlockIndex(k,c);4294967295!==N&&this._gl.uniformBlockBinding(k,N,L)};var P=L(11047),j=L(11110);j.c.prototype.displayLoadingUI=function(){if(!(0,P.k)())return;const Z=this.loadingScreen;Z&&Z.displayLoadingUI()},j.c.prototype.hideLoadingUI=function(){if(!(0,P.k)())return;const Z=this._loadingScreen;Z&&Z.hideLoadingUI()},Object.defineProperty(j.c.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=j.c.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(Z){this._loadingScreen=Z},enumerable:!0,configurable:!0}),Object.defineProperty(j.c.prototype,"loadingUIText",{set:function(Z){this.loadingScreen.loadingUIText=Z},enumerable:!0,configurable:!0}),Object.defineProperty(j.c.prototype,"loadingUIBackgroundColor",{set:function(Z){this.loadingScreen.loadingUIBackgroundColor=Z},enumerable:!0,configurable:!0}),j.c.prototype.getInputElement=function(){return this._renderingCanvas},j.c.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},j.c.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},j.c.prototype.getAspectRatio=function(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=Z.viewport;return this.getRenderWidth(c)*L.width/(this.getRenderHeight(c)*L.height)},j.c.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},j.c.prototype._verifyPointerLock=function(){var Z;null===(Z=this._onPointerLockChange)||void 0===Z||Z.call(this)},j.c.prototype.setAlphaEquation=function(Z){if(this._alphaEquation!==Z){switch(Z){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=Z}},j.c.prototype.getInputElement=function(){return this._renderingCanvas},j.c.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},j.c.prototype.setDepthFunction=function(Z){this._depthCullingState.depthFunc=Z},j.c.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},j.c.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},j.c.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},j.c.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},j.c.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},j.c.prototype.setDepthWrite=function(Z){this._depthCullingState.depthMask=Z},j.c.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},j.c.prototype.setStencilBuffer=function(Z){this._stencilState.stencilTest=Z},j.c.prototype.getStencilMask=function(){return this._stencilState.stencilMask},j.c.prototype.setStencilMask=function(Z){this._stencilState.stencilMask=Z},j.c.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},j.c.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},j.c.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},j.c.prototype.setStencilFunction=function(Z){this._stencilState.stencilFunc=Z},j.c.prototype.setStencilFunctionReference=function(Z){this._stencilState.stencilFuncRef=Z},j.c.prototype.setStencilFunctionMask=function(Z){this._stencilState.stencilFuncMask=Z},j.c.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},j.c.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},j.c.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},j.c.prototype.setStencilOperationFail=function(Z){this._stencilState.stencilOpStencilFail=Z},j.c.prototype.setStencilOperationDepthFail=function(Z){this._stencilState.stencilOpDepthFail=Z},j.c.prototype.setStencilOperationPass=function(Z){this._stencilState.stencilOpStencilDepthPass=Z},j.c.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},j.c.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},j.c.prototype.setAlphaConstants=function(Z,c,L,k){this._alphaState.setAlphaBlendConstants(Z,c,L,k)},j.c.prototype.getAlphaMode=function(){return this._alphaMode},j.c.prototype.getAlphaEquation=function(){return this._alphaEquation},j.c.prototype.getRenderPassNames=function(){return this._renderPassNames},j.c.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},j.c.prototype.createRenderPassId=function(Z){const c=++j.c._RenderPassIdCounter;return this._renderPassNames[c]=Z??"NONAME",c},j.c.prototype.releaseRenderPassId=function(Z){this._renderPassNames[Z]=void 0;for(let c=0;c<this.scenes.length;++c){const L=this.scenes[c];for(let c=0;c<L.meshes.length;++c){const k=L.meshes[c];if(k.ec)for(let c=0;c<k.ec.length;++c){k.ec[c]._removeDrawWrapper(Z)}}}};L(11452);function o(Z){if(Z.requestPointerLock){const c=Z.requestPointerLock();c instanceof Promise?c.then((()=>{Z.focus()})).catch((()=>{})):Z.focus()}}var u=L(11496),X=L(11108);class h extends R.ThinEngine{static get NpmPackage(){return j.c.NpmPackage}static get Version(){return j.c.Version}static get Instances(){return N.d.Instances}static get LastCreatedEngine(){return N.d.LastCreatedEngine}static get LastCreatedScene(){return N.d.LastCreatedScene}static DefaultLoadingScreenFactory(Z){return j.c.DefaultLoadingScreenFactory(Z)}get _supportsHardwareTextureRescaling(){return!!h._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(Z,c,L){super(Z,c,L,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new V,this._drawCalls=new u.d,Z&&(this._features.supportRenderPasses=!0,L=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(Z){super._sharedInit(Z),function(Z,c,L){Z._onCanvasFocus=()=>{Z.onCanvasFocusObservable.notifyObservers(Z)},Z._onCanvasBlur=()=>{Z.onCanvasBlurObservable.notifyObservers(Z)},Z._onCanvasContextMenu=c=>{Z.disableContextMenu&&c.preventDefault()},c.addEventListener("focus",Z._onCanvasFocus),c.addEventListener("blur",Z._onCanvasBlur),c.addEventListener("contextmenu",Z._onCanvasContextMenu),Z._onBlur=()=>{Z.disablePerformanceMonitorInBackground&&Z.performanceMonitor.disable(),Z._windowIsBackground=!0},Z._onFocus=()=>{Z.disablePerformanceMonitorInBackground&&Z.performanceMonitor.enable(),Z._windowIsBackground=!1},Z._onCanvasPointerOut=L=>{document.elementFromPoint(L.clientX,L.clientY)!==c&&Z.onCanvasPointerOutObservable.notifyObservers(L)};const k=Z.getHostWindow();k&&"function"===typeof k.addEventListener&&(k.addEventListener("blur",Z._onBlur),k.addEventListener("focus",Z._onFocus)),c.addEventListener("pointerout",Z._onCanvasPointerOut),L.doNotHandleTouchAction||function(Z){Z&&Z.setAttribute&&(Z.setAttribute("touch-action","none"),Z.style.touchAction="none",Z.style.webkitTapHighlightColor="transparent")}(c),!j.c.audioEngine&&L.audioEngine&&j.c.AudioEngineFactory&&(j.c.audioEngine=j.c.AudioEngineFactory(Z.getRenderingCanvas(),Z.getAudioContext(),Z.getAudioDestination())),(0,P.e)()&&(Z._onFullscreenChange=()=>{Z.isFullscreen=!!document.fullscreenElement,Z.isFullscreen&&Z._pointerLockRequested&&c&&o(c)},document.addEventListener("fullscreenchange",Z._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",Z._onFullscreenChange,!1),Z._onPointerLockChange=()=>{Z.isPointerLock=document.pointerLockElement===c},document.addEventListener("pointerlockchange",Z._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",Z._onPointerLockChange,!1)),Z.enableOfflineSupport=void 0!==j.c.OfflineProviderFactory,Z._deterministicLockstep=!!L.deterministicLockstep,Z._lockstepMaxSteps=L.lockstepMaxSteps||0,Z._timeStep=L.timeStep||1/60}(this,Z,this._creationOptions)}resizeImageBitmap(Z,c,L){return function(Z,c,L,k){const N=Z.createCanvas(L,k).getContext("2d");if(!N)throw new Error("Unable to get 2d context for resizeImageBitmap");return N.drawImage(c,0,0),N.getImageData(0,0,L,k).data}(this,Z,c,L)}async _createImageBitmapFromSource(Z,c){return await async function(Z,c,L){return await new Promise(((k,N)=>{const R=new Image;R.onload=()=>{R.decode().then((()=>{Z.createImageBitmap(R,L).then((Z=>{k(Z)}))}))},R.onerror=()=>{N(`Error loading image ${R.src}`)},R.src=c}))}(this,Z,c)}switchFullscreen(Z){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(Z)}enterFullscreen(Z){this.isFullscreen||(this._pointerLockRequested=Z,this._renderingCanvas&&function(Z){const c=Z.requestFullscreen||Z.webkitRequestFullscreen;c&&c.call(Z)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const Z=document;document.exitFullscreen?document.exitFullscreen():Z.webkitCancelFullScreen&&Z.webkitCancelFullScreen()}()}setDitheringState(Z){Z?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(Z){Z?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(Z,c,L,k){const N=this._cachedViewport;return this._cachedViewport=null,this._viewport(Z,c,L,k),N}scissorClear(Z,c,L,k,N){this.enableScissor(Z,c,L,k),this.clear(N,!0,!0,!0),this.disableScissor()}enableScissor(Z,c,L,k){const N=this._gl;N.enable(N.SCISSOR_TEST),N.scissor(Z,c,L,k)}disableScissor(){const Z=this._gl;Z.disable(Z.SCISSOR_TEST)}async _loadFileAsync(Z,c,L){return await new Promise(((k,N)=>{this._loadFile(Z,(Z=>{k(Z)}),void 0,c,L,((Z,c)=>{N(c)}))}))}getVertexShaderSource(Z){const c=this._gl.getAttachedShaders(Z);return c?this._gl.getShaderSource(c[0]):null}getFragmentShaderSource(Z){const c=this._gl.getAttachedShaders(Z);return c?this._gl.getShaderSource(c[1]):null}set framebufferDimensionsObject(Z){this._framebufferDimensionsObject=Z,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const Z of this.scenes)Z.resetCachedMaterial(),Z._rebuildGeometries();for(const Z of this._virtualScenes)Z.resetCachedMaterial(),Z._rebuildGeometries();super._rebuildBuffers()}getFontOffset(Z){return function(Z){const c=document.createElement("span");c.textContent="Hg",c.style.font=Z;const L=document.createElement("div");L.style.display="inline-block",L.style.width="1px",L.style.height="0px",L.style.verticalAlign="bottom";const k=document.createElement("div");k.style.whiteSpace="nowrap",k.appendChild(c),k.appendChild(L),document.body.appendChild(k);let N=0,R=0;try{R=L.getBoundingClientRect().top-c.getBoundingClientRect().top,L.style.verticalAlign="baseline",N=L.getBoundingClientRect().top-c.getBoundingClientRect().top}finally{document.body.removeChild(k)}return{ascent:N,height:R,descent:R-N}}(Z)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:Z}=this.customAnimationFrameRequester;Z&&Z(this.customAnimationFrameRequester.J)}}else super._cancelFrame()}_renderLoop(Z){this._processFrame(Z),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.J=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.J):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&o(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Hi(){this._measureFps(),super.Hi()}_deletePipelineContext(Z){const c=Z;c&&c.program&&c.transformFeedback&&(this.deleteTransformFeedback(c.transformFeedback),c.transformFeedback=null),super._deletePipelineContext(Z)}createShaderProgram(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;N=N||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const G=super.createShaderProgram(Z,c,L,k,N,R);return this.onAfterShaderCompilationObservable.notifyObservers(this),G}_createShaderProgram(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const R=k.createProgram();if(Z.program=R,!R)throw new Error("Unable to create program");if(k.attachShader(R,c),k.attachShader(R,L),this.webGLVersion>1&&N){const c=this.createTransformFeedback();this.bindTransformFeedback(c),this.setTranformFeedbackVaryings(R,N),Z.transformFeedback=c}return k.linkProgram(R),this.webGLVersion>1&&N&&this.bindTransformFeedback(null),Z.context=k,Z.vertexShader=c,Z.fragmentShader=L,Z.isParallelCompiled||this._finalizePipelineContext(Z),R}_releaseTexture(Z){super._releaseTexture(Z)}_releaseRenderTargetWrapper(Z){super._releaseRenderTargetWrapper(Z);for(const c of this.scenes){for(const L of c.postProcesses)L._outputTexture===Z&&(L._outputTexture=null);for(const L of c.cameras)for(const c of L._postProcesses)c&&c._outputTexture===Z&&(c._outputTexture=null)}}_rescaleTexture(Z,c,L,k,N){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const R=this.createRenderTargetTexture({width:c.width,height:c.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&h._RescalePostProcessFactory&&(this._rescalePostProcess=h._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const G=()=>{this._rescalePostProcess.onApply=function(c){c._bindTexture("textureSampler",Z)};let G=L;G||(G=this.scenes[this.scenes.length-1]),G.postProcessManager.directRender([this._rescalePostProcess],R,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,k,0,0,c.width,c.height,0),this.unBindFramebuffer(R),R.dispose(),N&&N()},V=this._rescalePostProcess.getEffect();V?V.executeWhenCompiled(G):this._rescalePostProcess.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled(G)}))}}wrapWebGLTexture(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const G=new i.c(Z,this._gl),V=new k.e(this,0,!0);return V._hardwareTexture=G,V.baseWidth=N,V.baseHeight=R,V.width=N,V.height=R,V.isReady=!0,V.useMipMaps=c,this.updateTextureSamplingMode(L,V),V}_uploadImageToTexture(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,R=this._getWebGLTextureType(Z.type),G=this._getInternalFormat(Z.format),V=this._getRGBABufferInternalSizedFormat(Z.type,G),p=Z.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(p,Z,!0),this._unpackFlipY(Z.invertY);let J=N.TEXTURE_2D;Z.isCube&&(J=N.TEXTURE_CUBE_MAP_POSITIVE_X+L),N.texImage2D(J,k,V,G,R,c),this._bindTextureDirectly(p,null,!0)}updateTextureComparisonFunction(Z,c){if(1===this.webGLVersion)return void z.e.Error("WebGL 1 does not support texture comparison.");const L=this._gl;Z.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,Z,!0),0===c?(L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_FUNC,515),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_MODE,L.NONE)):(L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_FUNC,c),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_COMPARE_MODE,L.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,Z,!0),0===c?(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_FUNC,515),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_MODE,L.NONE)):(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_FUNC,c),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_COMPARE_MODE,L.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),Z._comparisonFunction=c}createInstancesBuffer(Z){const c=this._gl.createBuffer();if(!c)throw new Error("Unable to create instance buffer");const L=new J.d(c);return L.kL=Z,this.bindArrayBuffer(L),this._gl.bufferData(this._gl.ARRAY_BUFFER,Z,this._gl.DYNAMIC_DRAW),L.references=1,L}deleteInstancesBuffer(Z){this._gl.deleteBuffer(Z)}async _clientWaitAsync(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const k=this._gl;return await new Promise(((N,R)=>{(0,X.d)((()=>{const L=k.clientWaitSync(Z,c,0);if(L==k.WAIT_FAILED)throw new Error("clientWaitSync failed");return L!=k.TIMEOUT_EXPIRED}),N,R,L)}))}_readPixelsAsync(Z,c,L,k,N,R,G){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const V=this._gl,p=V.createBuffer();V.bindBuffer(V.PIXEL_PACK_BUFFER,p),V.bufferData(V.PIXEL_PACK_BUFFER,G.byteLength,V.STREAM_READ),V.readPixels(Z,c,L,k,N,R,0),V.bindBuffer(V.PIXEL_PACK_BUFFER,null);const J=V.fenceSync(V.SYNC_GPU_COMMANDS_COMPLETE,0);return J?(V.flush(),this._clientWaitAsync(J,0,10).then((()=>(V.deleteSync(J),V.bindBuffer(V.PIXEL_PACK_BUFFER,p),V.getBufferSubData(V.PIXEL_PACK_BUFFER,0,G),V.bindBuffer(V.PIXEL_PACK_BUFFER,null),V.deleteBuffer(p),G)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(Z,c){1===N.d.Instances.length&&j.c.audioEngine&&(j.c.audioEngine.dispose(),j.c.audioEngine=null);const L=Z.getHostWindow();L&&"function"===typeof L.removeEventListener&&(L.removeEventListener("blur",Z._onBlur),L.removeEventListener("focus",Z._onFocus)),c&&(c.removeEventListener("focus",Z._onCanvasFocus),c.removeEventListener("blur",Z._onCanvasBlur),c.removeEventListener("pointerout",Z._onCanvasPointerOut),c.removeEventListener("contextmenu",Z._onCanvasContextMenu)),(0,P.e)()&&(document.removeEventListener("fullscreenchange",Z._onFullscreenChange),document.removeEventListener("mozfullscreenchange",Z._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",Z._onFullscreenChange),document.removeEventListener("msfullscreenchange",Z._onFullscreenChange),document.removeEventListener("pointerlockchange",Z._onPointerLockChange),document.removeEventListener("mspointerlockchange",Z._onPointerLockChange),document.removeEventListener("mozpointerlockchange",Z._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",Z._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}h.ALPHA_DISABLE=0,h.ALPHA_ADD=1,h.ALPHA_COMBINE=2,h.ALPHA_SUBTRACT=3,h.ALPHA_MULTIPLY=4,h.ALPHA_MAXIMIZED=5,h.ALPHA_ONEONE=6,h.ALPHA_PREMULTIPLIED=7,h.ALPHA_PREMULTIPLIED_PORTERDUFF=8,h.ALPHA_INTERPOLATE=9,h.ALPHA_SCREENMODE=10,h.DELAYLOADSTATE_NONE=0,h.DELAYLOADSTATE_LOADED=1,h.DELAYLOADSTATE_LOADING=2,h.DELAYLOADSTATE_NOTLOADED=4,h.NEVER=512,h.ALWAYS=519,h.LESS=513,h.EQUAL=514,h.LEQUAL=515,h.GREATER=516,h.GEQUAL=518,h.NOTEQUAL=517,h.KEEP=7680,h.REPLACE=7681,h.INCR=7682,h.DECR=7683,h.INVERT=5386,h.INCR_WRAP=34055,h.DECR_WRAP=34056,h.TEXTURE_CLAMP_ADDRESSMODE=0,h.TEXTURE_WRAP_ADDRESSMODE=1,h.TEXTURE_MIRROR_ADDRESSMODE=2,h.TEXTUREFORMAT_ALPHA=0,h.TEXTUREFORMAT_LUMINANCE=1,h.TEXTUREFORMAT_LUMINANCE_ALPHA=2,h.TEXTUREFORMAT_RGB=4,h.TEXTUREFORMAT_RGBA=5,h.TEXTUREFORMAT_RED=6,h.TEXTUREFORMAT_R=6,h.TEXTUREFORMAT_R16_UNORM=33322,h.TEXTUREFORMAT_RG16_UNORM=33324,h.TEXTUREFORMAT_RGB16_UNORM=32852,h.TEXTUREFORMAT_RGBA16_UNORM=32859,h.TEXTUREFORMAT_R16_SNORM=36760,h.TEXTUREFORMAT_RG16_SNORM=36761,h.TEXTUREFORMAT_RGB16_SNORM=36762,h.TEXTUREFORMAT_RGBA16_SNORM=36763,h.TEXTUREFORMAT_RG=7,h.TEXTUREFORMAT_RED_INTEGER=8,h.TEXTUREFORMAT_R_INTEGER=8,h.TEXTUREFORMAT_RG_INTEGER=9,h.TEXTUREFORMAT_RGB_INTEGER=10,h.TEXTUREFORMAT_RGBA_INTEGER=11,h.TEXTURETYPE_UNSIGNED_BYTE=0,h.TEXTURETYPE_UNSIGNED_INT=0,h.TEXTURETYPE_FLOAT=1,h.TEXTURETYPE_HALF_FLOAT=2,h.TEXTURETYPE_BYTE=3,h.TEXTURETYPE_SHORT=4,h.TEXTURETYPE_UNSIGNED_SHORT=5,h.TEXTURETYPE_INT=6,h.TEXTURETYPE_UNSIGNED_INTEGER=7,h.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,h.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,h.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,h.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,h.TEXTURETYPE_UNSIGNED_INT_24_8=12,h.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,h.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,h.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,h.TEXTURE_NEAREST_SAMPLINGMODE=1,h.TEXTURE_BILINEAR_SAMPLINGMODE=2,h.TEXTURE_TRILINEAR_SAMPLINGMODE=3,h.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,h.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,h.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,h.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,h.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,h.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,h.TEXTURE_NEAREST_LINEAR=7,h.TEXTURE_NEAREST_NEAREST=1,h.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,h.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,h.TEXTURE_LINEAR_LINEAR=2,h.TEXTURE_LINEAR_NEAREST=12,h.TEXTURE_EXPLICIT_MODE=0,h.TEXTURE_SPHERICAL_MODE=1,h.TEXTURE_PLANAR_MODE=2,h.TEXTURE_CUBIC_MODE=3,h.TEXTURE_PROJECTION_MODE=4,h.TEXTURE_SKYBOX_MODE=5,h.TEXTURE_INVCUBIC_MODE=6,h.TEXTURE_EQUIRECTANGULAR_MODE=7,h.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,h.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,h.SCALEMODE_FLOOR=1,h.SCALEMODE_NEAREST=2,h.SCALEMODE_CEILING=3},11023:(Z,c,L)=>{L.d(c,{d:()=>N});var k=L(11027);class N{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}N.Instances=[],N.OnEnginesDisposedObservable=new k.b,N._LastCreatedScene=null,N.UseFallbackTexture=!0,N.FallbackTexture=""},11019:(Z,c,L)=>{L.d(c,{c:()=>k});class k{static SetMatrixPrecision(Z){if(k.MatrixTrackPrecisionChange=!1,Z&&!k.MatrixUse64Bits&&k.MatrixTrackedMatrices)for(let c=0;c<k.MatrixTrackedMatrices.length;++c){const Z=k.MatrixTrackedMatrices[c],L=Z.zt;Z.zt=new Array(16);for(let c=0;c<16;++c)Z.zt[c]=L[c]}k.MatrixUse64Bits=Z,k.MatrixCurrentType=k.MatrixUse64Bits?Array:Float32Array,k.MatrixTrackedMatrices=null}}k.MatrixUse64Bits=!1,k.MatrixTrackPrecisionChange=!0,k.MatrixCurrentType=Float32Array,k.MatrixTrackedMatrices=[]},11444:(Z,c,L)=>{L.d(c,{c:()=>N});var k=L(11423);class N{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(Z){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=Z,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,Z&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,k.d)(Z.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var Z;return(null===(Z=this._textures)||void 0===Z?void 0:Z[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(Z){var c,L;if(!this._textures)return-1;const k=this._textures[Z],N=(null===(c=this._layerIndices)||void 0===c?void 0:c[Z])??0,R=(null===(L=this._faceIndices)||void 0===L?void 0:L[Z])??0;return k.isCube?6*N+R:k.is3D?0:N}get samples(){return this._samples}setSamples(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===Z&&!L)return Z;const k=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,Z,c):this._engine.updateRenderTargetTextureSampleCount(this,Z);return this._samples=Z,k}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(Z,c,L,k,N){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=Z,this._isCube=c,this._size=L,this._engine=k,this._depthStencilTexture=null,this.label=N}setTextures(Z){Array.isArray(Z)?this._textures=Z:this._textures=Z?[Z]:null}setTexture(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[c]!==Z&&(this._textures[c]&&L&&this._textures[c].dispose(),this._textures[c]=Z)}setLayerAndFaceIndices(Z,c){this._layerIndices=Z,this._faceIndices=c}setLayerAndFaceIndex(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==c&&c>=0&&(this._layerIndices[Z]=c),void 0!==L&&L>=0&&(this._faceIndices[Z]=L)}createDepthStencilTexture(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,G=arguments.length>5?arguments[5]:void 0;return null===(Z=this._depthStencilTexture)||void 0===Z||Z.dispose(),this._depthStencilTextureWithStencil=k,this._depthStencilTextureLabel=G,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:L,comparisonFunction:c,generateStencil:k,isCube:this._isCube,samples:N,depthTextureFormat:R,label:G},this),this._depthStencilTexture}_shareDepth(Z){this.shareDepth(Z)}shareDepth(Z){this._depthStencilTexture&&(Z._depthStencilTexture&&Z._depthStencilTexture.dispose(),Z._depthStencilTexture=this._depthStencilTexture,Z._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(Z){this.texture&&this.texture._swapAndDie(Z),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let Z=null;if(this._isMulti){const c=this.textures;if(c&&c.length>0){let L=!1,k=c.length,N=-1;const R=c[c.length-1]._source;14!==R&&12!==R||(L=!0,N=c[c.length-1].format,k--);const G=[],V=[],p=[],J=[],z=[],i=[],t=[],E={};for(let Z=0;Z<k;++Z){const L=c[Z];G.push(L.samplingMode),V.push(L.type),p.push(L.format);void 0!==E[L.uniqueId]?(J.push(-1),t.push(0)):(E[L.uniqueId]=Z,L.is2DArray?(J.push(35866),t.push(L.depth)):L.isCube?(J.push(34067),t.push(0)):L.is3D?(J.push(32879),t.push(L.depth)):(J.push(3553),t.push(0))),this._faceIndices&&z.push(this._faceIndices[Z]??0),this._layerIndices&&i.push(this._layerIndices[Z]??0)}const x={samplingModes:G,generateMipMaps:c[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:L,depthTextureFormat:N,types:V,formats:p,textureCount:k,targetTypes:J,faceIndex:z,layerIndex:i,layerCounts:t,label:this.label},q={width:this.width,height:this.height,depth:this.depth};Z=this._engine.createMultipleRenderTarget(q,x);for(let O=0;O<k;++O){if(-1!==J[O])continue;const L=E[c[O].uniqueId];Z.setTexture(Z.textures[L],O)}}}else{var c,L,k,N;const G={};if(G.generateDepthBuffer=this._generateDepthBuffer,G.generateMipMaps=(null===(c=this.texture)||void 0===c?void 0:c.generateMipMaps)??!1,G.generateStencilBuffer=this._generateStencilBuffer,G.samplingMode=null===(L=this.texture)||void 0===L?void 0:L.samplingMode,G.type=null===(k=this.texture)||void 0===k?void 0:k.type,G.format=null===(N=this.texture)||void 0===N?void 0:N.format,G.noColorAttachment=!this._textures,G.label=this.label,this.isCube)Z=this._engine.createRenderTargetCubeTexture(this.width,G);else{var R;const c={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(R=this.texture)||void 0===R?void 0:R.depth:void 0};Z=this._engine.createRenderTargetTexture(c,G)}Z.texture&&(Z.texture.isReady=!0)}return Z}_swapRenderTargetWrapper(Z){if(this._textures&&Z._textures)for(let c=0;c<this._textures.length;++c)this._textures[c]._swapAndDie(Z._textures[c],!1),Z._textures[c].isReady=!0;this._depthStencilTexture&&Z._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(Z._depthStencilTexture),Z._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const Z=this._cloneRenderTargetWrapper();if(Z){if(this._depthStencilTexture){const c=this._depthStencilTexture.samplingMode,L=this._depthStencilTexture.format,k=2===c||3===c||11===c;Z.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,k,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,L,this._depthStencilTextureLabel)}this.samples>1&&Z.setSamples(this.samples),Z._swapRenderTargetWrapper(this),Z.dispose()}}releaseTextures(){if(this._textures)for(let Z=0;Z<this._textures.length;++Z)this._textures[Z].dispose();this._textures=null}dispose(){var Z;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(Z=this._depthStencilTexture)||void 0===Z||Z.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11124:(Z,c,L)=>{L.d(c,{e:()=>k});class k{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?k.ShadersRepository:k.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?k.ShadersStore:k.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?k.IncludesShadersStore:k.IncludesShadersStoreWGSL}}k.ShadersRepository="src/Shaders/",k.ShadersStore={},k.IncludesShadersStore={},k.ShadersRepositoryWGSL="src/ShadersWGSL/",k.ShadersStoreWGSL={},k.IncludesShadersStoreWGSL={}},11134:(Z,c,L)=>{L.d(c,{e:()=>t,i:()=>P,l:()=>x,o:()=>E,r:()=>q,u:()=>M,w:()=>i,y:()=>J,C:()=>z,F:()=>p,H:()=>V});class k{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.xV._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(Z){Z&&this.program&&Z(this.program)}setEngine(Z){this.xV=Z}_fillEffectInformation(Z,c,L,k,N,R,G,V){const p=this.xV;if(p.supportsUniformBuffers)for(const z in c)Z.bindUniformBlock(z,c[z]);let J;for(this.xV.getUniforms(this,L).forEach(((Z,c)=>{k[L[c]]=Z})),this._uniforms=k,J=0;J<N.length;J++){null==Z.getUniform(N[J])&&(N.splice(J,1),J--)}N.forEach(((Z,c)=>{R[Z]=c}));for(const z of p.getAttributes(this,G))V.push(z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(Z,c){const L=this._valueCache[Z],k=c.updateFlag;return(void 0===L||L!==k)&&(this._valueCache[Z]=k,!0)}_cacheFloat2(Z,c,L){let k=this._valueCache[Z];if(!k||2!==k.length)return k=[c,L],this._valueCache[Z]=k,!0;let N=!1;return k[0]!==c&&(k[0]=c,N=!0),k[1]!==L&&(k[1]=L,N=!0),N}_cacheFloat3(Z,c,L,k){let N=this._valueCache[Z];if(!N||3!==N.length)return N=[c,L,k],this._valueCache[Z]=N,!0;let R=!1;return N[0]!==c&&(N[0]=c,R=!0),N[1]!==L&&(N[1]=L,R=!0),N[2]!==k&&(N[2]=k,R=!0),R}_cacheFloat4(Z,c,L,k,N){let R=this._valueCache[Z];if(!R||4!==R.length)return R=[c,L,k,N],this._valueCache[Z]=R,!0;let G=!1;return R[0]!==c&&(R[0]=c,G=!0),R[1]!==L&&(R[1]=L,G=!0),R[2]!==k&&(R[2]=k,G=!0),R[3]!==N&&(R[3]=N,G=!0),G}setInt(Z,c){const L=this._valueCache[Z];void 0!==L&&L===c||this.xV.setInt(this._uniforms[Z],c)&&(this._valueCache[Z]=c)}setInt2(Z,c,L){this._cacheFloat2(Z,c,L)&&(this.xV.setInt2(this._uniforms[Z],c,L)||(this._valueCache[Z]=null))}setInt3(Z,c,L,k){this._cacheFloat3(Z,c,L,k)&&(this.xV.setInt3(this._uniforms[Z],c,L,k)||(this._valueCache[Z]=null))}setInt4(Z,c,L,k,N){this._cacheFloat4(Z,c,L,k,N)&&(this.xV.setInt4(this._uniforms[Z],c,L,k,N)||(this._valueCache[Z]=null))}setIntArray(Z,c){this._valueCache[Z]=null,this.xV.setIntArray(this._uniforms[Z],c)}setIntArray2(Z,c){this._valueCache[Z]=null,this.xV.setIntArray2(this._uniforms[Z],c)}setIntArray3(Z,c){this._valueCache[Z]=null,this.xV.setIntArray3(this._uniforms[Z],c)}setIntArray4(Z,c){this._valueCache[Z]=null,this.xV.setIntArray4(this._uniforms[Z],c)}setUInt(Z,c){const L=this._valueCache[Z];void 0!==L&&L===c||this.xV.setUInt(this._uniforms[Z],c)&&(this._valueCache[Z]=c)}setUInt2(Z,c,L){this._cacheFloat2(Z,c,L)&&(this.xV.setUInt2(this._uniforms[Z],c,L)||(this._valueCache[Z]=null))}setUInt3(Z,c,L,k){this._cacheFloat3(Z,c,L,k)&&(this.xV.setUInt3(this._uniforms[Z],c,L,k)||(this._valueCache[Z]=null))}setUInt4(Z,c,L,k,N){this._cacheFloat4(Z,c,L,k,N)&&(this.xV.setUInt4(this._uniforms[Z],c,L,k,N)||(this._valueCache[Z]=null))}setUIntArray(Z,c){this._valueCache[Z]=null,this.xV.setUIntArray(this._uniforms[Z],c)}setUIntArray2(Z,c){this._valueCache[Z]=null,this.xV.setUIntArray2(this._uniforms[Z],c)}setUIntArray3(Z,c){this._valueCache[Z]=null,this.xV.setUIntArray3(this._uniforms[Z],c)}setUIntArray4(Z,c){this._valueCache[Z]=null,this.xV.setUIntArray4(this._uniforms[Z],c)}setArray(Z,c){this._valueCache[Z]=null,this.xV.setArray(this._uniforms[Z],c)}setArray2(Z,c){this._valueCache[Z]=null,this.xV.setArray2(this._uniforms[Z],c)}setArray3(Z,c){this._valueCache[Z]=null,this.xV.setArray3(this._uniforms[Z],c)}setArray4(Z,c){this._valueCache[Z]=null,this.xV.setArray4(this._uniforms[Z],c)}setMatrices(Z,c){c&&(this._valueCache[Z]=null,this.xV.setMatrices(this._uniforms[Z],c))}setMatrix(Z,c){this._cacheMatrix(Z,c)&&(this.xV.setMatrices(this._uniforms[Z],c.xc())||(this._valueCache[Z]=null))}setMatrix3x3(Z,c){this._valueCache[Z]=null,this.xV.setMatrix3x3(this._uniforms[Z],c)}setMatrix2x2(Z,c){this._valueCache[Z]=null,this.xV.setMatrix2x2(this._uniforms[Z],c)}setFloat(Z,c){const L=this._valueCache[Z];void 0!==L&&L===c||this.xV.setFloat(this._uniforms[Z],c)&&(this._valueCache[Z]=c)}setVector2(Z,c){this._cacheFloat2(Z,c.x,c.y)&&(this.xV.setFloat2(this._uniforms[Z],c.x,c.y)||(this._valueCache[Z]=null))}setFloat2(Z,c,L){this._cacheFloat2(Z,c,L)&&(this.xV.setFloat2(this._uniforms[Z],c,L)||(this._valueCache[Z]=null))}setVector3(Z,c){this._cacheFloat3(Z,c.x,c.y,c.z)&&(this.xV.setFloat3(this._uniforms[Z],c.x,c.y,c.z)||(this._valueCache[Z]=null))}setFloat3(Z,c,L,k){this._cacheFloat3(Z,c,L,k)&&(this.xV.setFloat3(this._uniforms[Z],c,L,k)||(this._valueCache[Z]=null))}setVector4(Z,c){this._cacheFloat4(Z,c.x,c.y,c.z,c.w)&&(this.xV.setFloat4(this._uniforms[Z],c.x,c.y,c.z,c.w)||(this._valueCache[Z]=null))}setQuaternion(Z,c){this._cacheFloat4(Z,c.x,c.y,c.z,c.w)&&(this.xV.setFloat4(this._uniforms[Z],c.x,c.y,c.z,c.w)||(this._valueCache[Z]=null))}setFloat4(Z,c,L,k,N){this._cacheFloat4(Z,c,L,k,N)&&(this.xV.setFloat4(this._uniforms[Z],c,L,k,N)||(this._valueCache[Z]=null))}setColor3(Z,c){this._cacheFloat3(Z,c.r,c.g,c.b)&&(this.xV.setFloat3(this._uniforms[Z],c.r,c.g,c.b)||(this._valueCache[Z]=null))}setColor4(Z,c,L){this._cacheFloat4(Z,c.r,c.g,c.b,L)&&(this.xV.setFloat4(this._uniforms[Z],c.r,c.g,c.b,L)||(this._valueCache[Z]=null))}setDirectColor4(Z,c){this._cacheFloat4(Z,c.r,c.g,c.b,c.a)&&(this.xV.setFloat4(this._uniforms[Z],c.r,c.g,c.b,c.a)||(this._valueCache[Z]=null))}_getVertexShaderCode(){return this.vertexShader?this.xV._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.xV._getShaderSource(this.fragmentShader):null}}var N=L(11102);const R=new WeakMap,G={_webGLVersion:2,cachedPipelines:{}};function V(Z){let c=R.get(Z);if(!c){if(!Z)return G;c={_webGLVersion:Z.TEXTURE_BINDING_3D?2:1,_context:Z,parallelShaderCompile:Z.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},R.set(Z,c)}return c}function p(Z){R.delete(Z)}function J(Z,c,L,k,N,R){const G=V(k);R||(R=G._createShaderProgramInjection??t);return R(Z,w(c,"vertex",k,G._contextWasLost),w(L,"fragment",k,G._contextWasLost),k,N,G.validateShaderPrograms)}function z(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0;const p=V(N);G||(G=p._createShaderProgramInjection??t);const J=p._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return G(Z,O(c,"vertex",k,J,N,p._contextWasLost),O(L,"fragment",k,J,N,p._contextWasLost),N,R,p.validateShaderPrograms)}function i(Z,c){const L=new k,N=V(Z);return N.parallelShaderCompile&&!N.disableParallelShaderCompile&&(L.isParallelCompiled=!0),L.context=N._context,L}function t(Z,c,L,k){let N=arguments.length>5?arguments[5]:void 0;const R=k.createProgram();if(Z.program=R,!R)throw new Error("Unable to create program");return k.attachShader(R,c),k.attachShader(R,L),k.linkProgram(R),Z.context=k,Z.vertexShader=c,Z.fragmentShader=L,Z.isParallelCompiled||x(Z,k,N),R}function E(Z,c,L){const k=Z;if(k._isDisposed)return!1;const N=V(c);return!!(N&&N.parallelShaderCompile&&N.parallelShaderCompile.COMPLETION_STATUS_KHR&&k.program&&c.getProgramParameter(k.program,N.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(x(k,c,L),!0)}function x(Z,c,L){const k=Z.context,N=Z.vertexShader,R=Z.fragmentShader,G=Z.program;if(!k.getProgramParameter(G,k.LINK_STATUS)){if(!c.getShaderParameter(N,c.COMPILE_STATUS)){const L=c.getShaderInfoLog(N);if(L)throw Z.vertexCompilationError=L,new Error("VERTEX SHADER "+L)}if(!c.getShaderParameter(R,c.COMPILE_STATUS)){const L=c.getShaderInfoLog(R);if(L)throw Z.fragmentCompilationError=L,new Error("FRAGMENT SHADER "+L)}const L=k.getProgramInfoLog(G);if(L)throw Z.programLinkError=L,new Error(L)}if(L){k.validateProgram(G);if(!k.getProgramParameter(G,k.VALIDATE_STATUS)){const c=k.getProgramInfoLog(G);if(c)throw Z.programValidationError=c,new Error(c)}}k.deleteShader(N),k.deleteShader(R),Z.vertexShader=void 0,Z.fragmentShader=void 0,Z.onCompiled&&(Z.onCompiled(),Z.onCompiled=void 0)}function q(Z,c,L,k,N,R,G,p,i){let t=arguments.length>10?arguments[10]:void 0,E=arguments.length>11?arguments[11]:void 0,x=arguments.length>12?arguments[12]:void 0;const q=V(Z.context);E||(E=q.createRawShaderProgramInjection??J),x||(x=q.createShaderProgramInjection??z);const O=Z;O.program=k?E(O,c,L,O.context,i):x(O,c,L,p,O.context,i),O.program.__SPECTOR_rebuildProgram=G,t()}function O(Z,c,L,k,R,G){return w((0,N.f)(Z,L,k),c,R,G)}function w(Z,c,L,k){const N=L.createShader("vertex"===c?L.VERTEX_SHADER:L.FRAGMENT_SHADER);if(!N){let Z=L.NO_ERROR,N=L.NO_ERROR;for(;(N=L.getError())!==L.NO_ERROR;)Z=N;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${Z}, gl isContextLost=${L.isContextLost()}, _contextWasLost=${k}`)}return L.shaderSource(N,Z),L.compileShader(N),N}function M(Z,c){c.useProgram(Z)}function P(Z,c){const L=Z;if(!L.isParallelCompiled)return void c(Z);const k=L.onCompiled;L.onCompiled=()=>{null===k||void 0===k||k(),c(Z)}}},11397:(Z,c,L)=>{L.r(c),L.d(c,{ThinEngine:()=>j});var k=L(11134),N=L(11401),R=L(11052),G=L(11047);class V{constructor(){this.shaderLanguage=0}postProcessor(Z,c,L,k,N){if(N.drawBuffersExtensionDisabled){const c=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;Z=Z.replace(c,"")}return Z}}const p=/(flat\s)?\s*varying\s*.*/;class J{constructor(){this.shaderLanguage=0}attributeProcessor(Z){return Z.replace("attribute","in")}varyingCheck(Z,c){return p.test(Z)}varyingProcessor(Z,c){return Z.replace("varying",c?"in":"out")}postProcessor(Z,c,L){const k=-1!==Z.search(/#extension.+GL_EXT_draw_buffers.+require/);if(Z=(Z=Z.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),L){const c=-1!==Z.search(/layout *\(location *= *0\) *out/g);Z=(Z=(Z=(Z=(Z=(Z=(Z=Z.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(k||c?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==c.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+Z}return Z}}var z=L(11408),i=L(11159),t=L(11110),E=L(11415),x=L(11139),q=L(11116),O=L(11102),w=L(11126),M=L(11423);class P{}class j extends t.c{get name(){return this._name}set name(Z){this._name=Z}get version(){return this._webGLVersion}static get ShadersRepository(){return q.d.ShadersRepository}static set ShadersRepository(Z){q.d.ShadersRepository=Z}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(Z){this._framebufferDimensionsObject=Z}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(Z,c,L,N){if(L=L||{},super(c??L.antialias,L,N),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!Z)return;let G=null;if(Z.getContext){if(G=Z,void 0===L.yJ&&(L.yJ=!1),void 0===L.xrCompatible&&(L.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const Z=navigator.userAgent;for(const c of j.ExceptionList){const k=c.key,N=c.targets;if(new RegExp(k).test(Z)){if(c.capture&&c.captureConstraint){const L=c.capture,k=c.captureConstraint,N=new RegExp(L).exec(Z);if(N&&N.length>0){if(parseInt(N[N.length-1])>=k)continue}}for(const Z of N)switch(Z){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":L.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,k.F)(this._gl)}:(this._onContextLost=Z=>{Z.preventDefault(),this._contextWasLost=!0,(0,k.F)(this._gl),R.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},G.addEventListener("webglcontextrestored",this._onContextRestored,!1),L.powerPreference=L.powerPreference||"high-performance"),G.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(L.xrCompatible=!1),!L.disableWebGL2Support)try{this._gl=G.getContext("webgl2",L)||G.getContext("experimental-webgl2",L),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(i){}if(!this._gl){if(!G)throw new Error("The provided canvas is null or undefined.");try{this._gl=G.getContext("webgl",L)||G.getContext("experimental-webgl",L)}catch(i){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=Z,G=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const c=this._gl.getContextAttributes();c&&(L.stencil=c.stencil)}this._sharedInit(G),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==L.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=L.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let k=0;k<this._caps.maxVertexAttribs;k++)this._currentBufferPointers[k]=new P;this._shaderProcessor=this.webGLVersion>1?new J:new V;const p=`Babylon.js v${j.Version}`;R.e.Log(p+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",p);const z=(0,k.H)(this._gl);z.validateShaderPrograms=this.validateShaderPrograms,z.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(Z){return null}areAllEffectsReady(){for(const Z in this._compiledEffects){if(!this._compiledEffects[Z].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const Z=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=Z&&(this._glRenderer=this._gl.getParameter(Z.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(Z.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const Z=this._gl.getExtension("WEBGL_draw_buffers");if(null!==Z){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=Z.drawBuffersWEBGL.bind(Z),this._caps.maxDrawBuffers=this._gl.getParameter(Z.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let c=0;c<16;c++)this._gl["COLOR_ATTACHMENT"+c+"_WEBGL"]=Z["COLOR_ATTACHMENT"+c+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const Z=this._gl.getExtension("WEBGL_depth_texture");null!=Z&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=Z.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const Z=this._gl.getExtension("OES_vertex_array_object");null!=Z&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=Z.createVertexArrayOES.bind(Z),this._gl.bindVertexArray=Z.bindVertexArrayOES.bind(Z),this._gl.deleteVertexArray=Z.deleteVertexArrayOES.bind(Z))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const Z=this._gl.getExtension("ANGLE_instanced_arrays");null!=Z?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=Z.drawArraysInstancedANGLE.bind(Z),this._gl.drawElementsInstanced=Z.drawElementsInstancedANGLE.bind(Z),this._gl.vertexAttribDivisor=Z.vertexAttribDivisorANGLE.bind(Z)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const Z=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),c=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);Z&&c&&(this._caps.highPrecisionShaderSupported=0!==Z.precision&&0!==c.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const Z=this._gl.getExtension("EXT_blend_minmax");null!=Z&&(this._caps.blendMinMax=!0,this._gl.MAX=Z.MAX_EXT,this._gl.MIN=Z.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const Z=this._gl.getExtension("EXT_sRGB");null!=Z&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:Z.SRGB_EXT,SRGB8:Z.SRGB_ALPHA_EXT,SRGB8_ALPHA8:Z.SRGB_ALPHA_EXT})}if(this._creationOptions){const Z=this._creationOptions.forceSRGBBufferSupportState;void 0!==Z&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&Z)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const Z=this._workingCanvas.getContext("2d");Z&&(this._workingContext=Z)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const Z=this.getGlInfo();return Z&&Z.renderer?Z.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=N;let R=0;if(c&&Z){let c=!0;if(this._currentRenderTarget){var G;const L=null===(G=this._currentRenderTarget.texture)||void 0===G?void 0:G.format;if(8===L||9===L||10===L||11===L){var V;const L=null===(V=this._currentRenderTarget.texture)||void 0===V?void 0:V.type;7===L||5===L?(j._TempClearColorUint32[0]=255*Z.r,j._TempClearColorUint32[1]=255*Z.g,j._TempClearColorUint32[2]=255*Z.b,j._TempClearColorUint32[3]=255*Z.a,this._gl.clearBufferuiv(this._gl.COLOR,0,j._TempClearColorUint32),c=!1):(j._TempClearColorInt32[0]=255*Z.r,j._TempClearColorInt32[1]=255*Z.g,j._TempClearColorInt32[2]=255*Z.b,j._TempClearColorInt32[3]=255*Z.a,this._gl.clearBufferiv(this._gl.COLOR,0,j._TempClearColorInt32),c=!1)}}c&&(this._gl.clearColor(Z.r,Z.g,Z.b,void 0!==Z.a?Z.a:1),R|=this._gl.COLOR_BUFFER_BIT)}L&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),R|=this._gl.DEPTH_BUFFER_BIT),k&&(this._gl.clearStencil(0),R|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(R)}_viewport(Z,c,L,k){Z===this._viewportCached.x&&c===this._viewportCached.y&&L===this._viewportCached.z&&k===this._viewportCached.w||(this._viewportCached.x=Z,this._viewportCached.y=c,this._viewportCached.z=L,this._viewportCached.w=k,this._gl.viewport(Z,c,L,k))}li(){super.li(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const p=Z;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=Z,this._bindUnboundFramebuffer(p._framebuffer);const J=this._gl;var z;if(!Z.isMulti)if(Z.is2DArray||Z.is3D)J.framebufferTextureLayer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,null===(z=Z.texture._hardwareTexture)||void 0===z?void 0:z.underlyingResource,G,V),p._currentLOD=G;else if(Z.isCube){var i;J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(i=Z.texture._hardwareTexture)||void 0===i?void 0:i.underlyingResource,G)}else if(p._currentLOD!==G){var t;J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,null===(t=Z.texture._hardwareTexture)||void 0===t?void 0:t.underlyingResource,G),p._currentLOD=G}const E=Z._depthStencilTexture;if(E){Z.is3D&&(Z.texture.width===E.width&&Z.texture.height===E.height&&Z.texture.depth===E.depth||R.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const L=Z._depthStencilTextureWithStencil?J.DEPTH_STENCIL_ATTACHMENT:J.DEPTH_ATTACHMENT;var x;if(Z.is2DArray||Z.is3D)J.framebufferTextureLayer(J.FRAMEBUFFER,L,null===(x=E._hardwareTexture)||void 0===x?void 0:x.underlyingResource,G,V);else if(Z.isCube){var q;J.framebufferTexture2D(J.FRAMEBUFFER,L,J.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(q=E._hardwareTexture)||void 0===q?void 0:q.underlyingResource,G)}else{var O;J.framebufferTexture2D(J.FRAMEBUFFER,L,J.TEXTURE_2D,null===(O=E._hardwareTexture)||void 0===O?void 0:O.underlyingResource,G)}}p._MSAAFramebuffer&&this._bindUnboundFramebuffer(p._MSAAFramebuffer),this._cachedViewport&&!N?this.setViewport(this._cachedViewport,L,k):(L||(L=Z.width,G&&(L/=Math.pow(2,G))),k||(k=Z.height,G&&(k/=Math.pow(2,G))),this._viewport(0,0,L,k)),this.wipeCaches()}setStateCullFaceType(Z,c){const L=this.cullBackFaces??Z??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==L||c)&&(this._depthCullingState.cullFace=L)}setState(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==Z||L)&&(this._depthCullingState.cull=Z),this.setStateCullFaceType(N,L),this.setZOffset(c),this.setZOffsetUnits(G);const V=k?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==V||L)&&(this._depthCullingState.frontFace=V),this._stencilStateComposer.stencilMaterial=R}_resolveAndGenerateMipMapsFramebuffer(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z.disableAutomaticMSAAResolve||(Z.isMulti?this.resolveMultiFramebuffer(Z):this.resolveFramebuffer(Z)),c||(Z.isMulti?this.generateMipMapsMultiFramebuffer(Z):this.generateMipMapsFramebuffer(Z))}_bindUnboundFramebuffer(Z){this._currentFramebuffer!==Z&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,Z),this._currentFramebuffer=Z)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(Z){const c=this._getTextureTarget(Z);this._bindTextureDirectly(c,Z,!0),this._gl.generateMipmap(c),this._bindTextureDirectly(c,null)}unBindFramebuffer(Z,c,L){const k=Z;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(Z,c),L&&(k._MSAAFramebuffer&&this._bindUnboundFramebuffer(k._framebuffer),L()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(Z){var c;Z.isMulti||null===(c=Z.texture)||void 0===c||!c.generateMipMaps||Z.isCube||this.generateMipmaps(Z.texture)}resolveFramebuffer(Z){const c=Z,L=this._gl;if(!c._MSAAFramebuffer||c.isMulti)return;let k=c.resolveMSAAColors?L.COLOR_BUFFER_BIT:0;k|=c._generateDepthBuffer&&c.resolveMSAADepth?L.DEPTH_BUFFER_BIT:0,k|=c._generateStencilBuffer&&c.resolveMSAAStencil?L.STENCIL_BUFFER_BIT:0,L.bindFramebuffer(L.READ_FRAMEBUFFER,c._MSAAFramebuffer),L.bindFramebuffer(L.DRAW_FRAMEBUFFER,c._framebuffer),L.blitFramebuffer(0,0,Z.width,Z.height,0,0,Z.width,Z.height,k,L.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(Z,c,L){return this._createVertexBuffer(Z,this._gl.STATIC_DRAW)}_createVertexBuffer(Z,c){const L=this._gl.createBuffer();if(!L)throw new Error("Unable to create vertex buffer");const k=new z.d(L);return this.bindArrayBuffer(k),"number"!==typeof Z?Z instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(Z),c),k.kL=4*Z.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,Z,c),k.kL=Z.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(Z),c),k.kL=Z),this._resetVertexBufferBinding(),k.references=1,k}createDynamicVertexBuffer(Z,c){return this._createVertexBuffer(Z,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(Z,c,L){const k=this._gl.createBuffer(),N=new z.d(k);if(!k)throw new Error("Unable to create index buffer");this.bindIndexBuffer(N);const R=this._normalizeIndexData(Z);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,R,c?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),N.references=1,N.is32Bits=4===R.BYTES_PER_ELEMENT,N}_normalizeIndexData(Z){if(2===Z.BYTES_PER_ELEMENT)return Z;if(this._caps.uintIndices){if(Z instanceof Uint32Array)return Z;for(let c=0;c<Z.length;c++)if(Z[c]>=65535)return new Uint32Array(Z);return new Uint16Array(Z)}return new Uint16Array(Z)}bindArrayBuffer(Z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Z,this._gl.ARRAY_BUFFER)}bindUniformBlock(Z,c,L){const k=Z.program,N=this._gl.getUniformBlockIndex(k,c);this._gl.uniformBlockBinding(k,N,L)}bindIndexBuffer(Z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Z,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(Z,c){(this._vaoRecordInProgress||this._currentBoundBuffer[c]!==Z)&&(this._gl.bindBuffer(c,Z?Z.underlyingResource:null),this._currentBoundBuffer[c]=Z)}updateArrayBuffer(Z){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Z)}_vertexAttribPointer(Z,c,L,k,N,R,G){const V=this._currentBufferPointers[c];if(!V)return;let p=!1;V.active?(V.buffer!==Z&&(V.buffer=Z,p=!0),V.size!==L&&(V.size=L,p=!0),V.type!==k&&(V.type=k,p=!0),V.normalized!==N&&(V.normalized=N,p=!0),V.stride!==R&&(V.stride=R,p=!0),V.offset!==G&&(V.offset=G,p=!0)):(p=!0,V.active=!0,V.index=c,V.size=L,V.type=k,V.normalized=N,V.stride=R,V.offset=G,V.buffer=Z),(p||this._vaoRecordInProgress)&&(this.bindArrayBuffer(Z),k===this._gl.UNSIGNED_INT||k===this._gl.INT?this._gl.vertexAttribIPointer(c,L,k,R,G):this._gl.vertexAttribPointer(c,L,k,N,R,G))}_bindIndexBufferWithCache(Z){null!=Z&&this._cachedIndexBuffer!==Z&&(this._cachedIndexBuffer=Z,this.bindIndexBuffer(Z),this._uintIndicesCurrentlySet=Z.is32Bits)}_bindVertexBuffersAttributes(Z,c,L){const k=c.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let N=0;N<k.length;N++){const R=c.getAttributeLocation(N);if(R>=0){const c=k[N];let G=null;if(L&&(G=L[c]),G||(G=Z[c]),!G)continue;this._gl.enableVertexAttribArray(R),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[R]=!0);const V=G.getBuffer();V&&(this._vertexAttribPointer(V,R,G.getSize(),G.type,G.normalized,G.byteStride,G.byteOffset),G.getIsInstanced()&&(this._gl.vertexAttribDivisor(R,G.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(R),this._currentInstanceBuffers.push(V))))}}}recordVertexArrayObject(Z,c,L,k){const N=this._gl.createVertexArray();if(!N)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(N),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(Z,L,k),this.bindIndexBuffer(c),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),N}bindVertexArrayObject(Z,c){this._cachedVertexArrayObject!==Z&&(this._cachedVertexArrayObject=Z,this._gl.bindVertexArray(Z),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=c&&c.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(Z,c,L,k,N){if(this._cachedVertexBuffers!==Z||this._cachedEffectForVertexBuffers!==N){this._cachedVertexBuffers=Z,this._cachedEffectForVertexBuffers=N;const c=N.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let R=0;for(let G=0;G<c;G++)if(G<L.length){const c=N.getAttributeLocation(G);c>=0&&(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0,this._vertexAttribPointer(Z,c,L[G],this._gl.FLOAT,!1,k,R)),R+=4*L[G]}}this._bindIndexBufferWithCache(c)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(Z,c,L,k){this._cachedVertexBuffers===Z&&this._cachedEffectForVertexBuffers===L||(this._cachedVertexBuffers=Z,this._cachedEffectForVertexBuffers=L,this._bindVertexBuffersAttributes(Z,L,k)),this._bindIndexBufferWithCache(c)}unbindInstanceAttributes(){let Z;for(let c=0,L=this._currentInstanceLocations.length;c<L;c++){const L=this._currentInstanceBuffers[c];Z!=L&&L.references&&(Z=L,this.bindArrayBuffer(L));const k=this._currentInstanceLocations[c];this._gl.vertexAttribDivisor(k,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(Z){this._gl.deleteVertexArray(Z)}_releaseBuffer(Z){return Z.references--,0===Z.references&&(this._deleteBuffer(Z),!0)}_deleteBuffer(Z){this._gl.deleteBuffer(Z.underlyingResource)}updateAndBindInstancesBuffer(Z,c,L){if(this.bindArrayBuffer(Z),c&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c),void 0!==L[0].index)this.bindInstancesBuffer(Z,L,!0);else for(let k=0;k<4;k++){const c=L[k];this._vertexAttribArraysEnabled[c]||(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0),this._vertexAttribPointer(Z,c,4,this._gl.FLOAT,!1,64,16*k),this._gl.vertexAttribDivisor(c,1),this._currentInstanceLocations.push(c),this._currentInstanceBuffers.push(Z)}}bindInstancesBuffer(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(Z);let k=0;if(L)for(let N=0;N<c.length;N++){k+=4*c[N].attributeSize}for(let N=0;N<c.length;N++){const L=c[N];void 0===L.index&&(L.index=this._currentEffect.getAttributeLocationByName(L.attributeName)),L.index<0||(this._vertexAttribArraysEnabled[L.index]||(this._gl.enableVertexAttribArray(L.index),this._vertexAttribArraysEnabled[L.index]=!0),this._vertexAttribPointer(Z,L.index,L.attributeSize,L.attributeType||this._gl.FLOAT,L.normalized||!1,k,L.offset),this._gl.vertexAttribDivisor(L.index,void 0===L.divisor?1:L.divisor),this._currentInstanceLocations.push(L.index),this._currentInstanceBuffers.push(Z))}}disableInstanceAttributeByName(Z){if(!this._currentEffect)return;const c=this._currentEffect.getAttributeLocationByName(Z);this.disableInstanceAttribute(c)}disableInstanceAttribute(Z){let c,L=!1;for(;-1!==(c=this._currentInstanceLocations.indexOf(Z));)this._currentInstanceLocations.splice(c,1),this._currentInstanceBuffers.splice(c,1),L=!0,c=this._currentInstanceLocations.indexOf(Z);L&&(this._gl.vertexAttribDivisor(Z,0),this.disableAttributeByIndex(Z))}disableAttributeByIndex(Z){this._gl.disableVertexAttribArray(Z),this._vertexAttribArraysEnabled[Z]=!1,this._currentBufferPointers[Z].active=!1}draw(Z,c,L,k){this.drawElementsType(Z?0:1,c,L,k)}drawPointClouds(Z,c,L){this.drawArraysType(2,Z,c,L)}drawUnIndexed(Z,c,L,k){this.drawArraysType(Z?0:1,c,L,k)}drawElementsType(Z,c,L,k){this.applyStates(),this._reportDrawCall();const N=this._drawMode(Z),R=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,G=this._uintIndicesCurrentlySet?4:2;k?this._gl.drawElementsInstanced(N,L,R,c*G,k):this._gl.drawElements(N,L,R,c*G)}drawArraysType(Z,c,L,k){this.applyStates(),this._reportDrawCall();const N=this._drawMode(Z);k?this._gl.drawArraysInstanced(N,c,L,k):this._gl.drawArrays(N,c,L)}_drawMode(Z){switch(Z){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(Z){this._compiledEffects[Z._key]&&delete this._compiledEffects[Z._key];const c=Z.getPipelineContext();c&&this._deletePipelineContext(c)}_deletePipelineContext(Z){const c=Z;c&&c.program&&(c.program.__SPECTOR_rebuildProgram=null,(0,w.k)(c),this._gl&&(this._currentProgram===c.program&&this._setProgram(null),this._gl.deleteProgram(c.program)))}_getGlobalDefines(Z){return(0,O.j)(Z,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(Z,c,L,N,R,G,V,p,J){let z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10?arguments[10]:void 0;const t="string"===typeof Z?Z:Z.vertexToken||Z.vertexSource||Z.vertexElement||Z.vertex,E="string"===typeof Z?Z:Z.fragmentToken||Z.fragmentSource||Z.fragmentElement||Z.fragment,x=this._getGlobalDefines(),O=void 0!==c.attributes;let w=R??c.defines??"";x&&(w+=x);const M=t+"+"+E+"@"+w;if(this._compiledEffects[M]){const Z=this._compiledEffects[M];return V&&Z.isReady()&&V(Z),Z._refCount++,Z}this._gl&&(0,k.H)(this._gl);const P=new q.d(Z,c,O?this:L,N,this,R,G,V,p,J,M,c.shaderLanguage??z,c.extraInitializationsAsync??i);return this._compiledEffects[M]=P,P}_getShaderSource(Z){return this._gl.getShaderSource(Z)}createRawShaderProgram(Z,c,L,N){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const G=(0,k.H)(this._gl);return G._contextWasLost=this._contextWasLost,G.validateShaderPrograms=this.validateShaderPrograms,(0,k.y)(Z,c,L,N||this._gl,R)}createShaderProgram(Z,c,L,N,R){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const V=(0,k.H)(this._gl);return V._contextWasLost=this._contextWasLost,V.validateShaderPrograms=this.validateShaderPrograms,(0,k.C)(Z,c,L,N,R||this._gl,G)}inlineShaderCode(Z){return Z}createPipelineContext(Z){if(this._gl){(0,k.H)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const c=(0,k.w)(this._gl,Z);return c.xV=this,c}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(Z){return(0,k.l)(Z,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(Z,c,L,N,R,G,V,p,J,z,i){const t=(0,k.H)(this._gl);return t._contextWasLost=this._contextWasLost,t.validateShaderPrograms=this.validateShaderPrograms,t._createShaderProgramInjection=this._createShaderProgram.bind(this),t.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),t.createShaderProgramInjection=this.createShaderProgram.bind(this),t.loadFileInjection=this._loadFile.bind(this),(0,k.r)(Z,c,L,N,R,G,V,p,J,z,i)}_createShaderProgram(Z,c,L,N){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,k.e)(Z,c,L,N,R)}_isRenderingStateCompiled(Z){return!this._isDisposed&&(0,k.o)(Z,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(Z,c){(0,k.i)(Z,c)}getUniforms(Z,c){const L=new Array,k=Z;for(let N=0;N<c.length;N++)L.push(this._gl.getUniformLocation(k.program,c[N]));return L}getAttributes(Z,c){const L=[],k=Z;for(let R=0;R<c.length;R++)try{L.push(this._gl.getAttribLocation(k.program,c[R]))}catch(N){L.push(-1)}return L}enableEffect(Z){(Z=null!==Z&&(0,N.b)(Z)?Z.effect:Z)&&Z!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(Z),this._currentEffect=Z,Z.onBind&&Z.onBind(Z),Z._onBindObservable&&Z._onBindObservable.notifyObservers(Z))}setInt(Z,c){return!!Z&&(this._gl.uniform1i(Z,c),!0)}setInt2(Z,c,L){return!!Z&&(this._gl.uniform2i(Z,c,L),!0)}setInt3(Z,c,L,k){return!!Z&&(this._gl.uniform3i(Z,c,L,k),!0)}setInt4(Z,c,L,k,N){return!!Z&&(this._gl.uniform4i(Z,c,L,k,N),!0)}setIntArray(Z,c){return!!Z&&(this._gl.uniform1iv(Z,c),!0)}setIntArray2(Z,c){return!(!Z||c.length%2!==0)&&(this._gl.uniform2iv(Z,c),!0)}setIntArray3(Z,c){return!(!Z||c.length%3!==0)&&(this._gl.uniform3iv(Z,c),!0)}setIntArray4(Z,c){return!(!Z||c.length%4!==0)&&(this._gl.uniform4iv(Z,c),!0)}setUInt(Z,c){return!!Z&&(this._gl.uniform1ui(Z,c),!0)}setUInt2(Z,c,L){return!!Z&&(this._gl.uniform2ui(Z,c,L),!0)}setUInt3(Z,c,L,k){return!!Z&&(this._gl.uniform3ui(Z,c,L,k),!0)}setUInt4(Z,c,L,k,N){return!!Z&&(this._gl.uniform4ui(Z,c,L,k,N),!0)}setUIntArray(Z,c){return!!Z&&(this._gl.uniform1uiv(Z,c),!0)}setUIntArray2(Z,c){return!(!Z||c.length%2!==0)&&(this._gl.uniform2uiv(Z,c),!0)}setUIntArray3(Z,c){return!(!Z||c.length%3!==0)&&(this._gl.uniform3uiv(Z,c),!0)}setUIntArray4(Z,c){return!(!Z||c.length%4!==0)&&(this._gl.uniform4uiv(Z,c),!0)}setArray(Z,c){return!!Z&&(!(c.length<1)&&(this._gl.uniform1fv(Z,c),!0))}setArray2(Z,c){return!(!Z||c.length%2!==0)&&(this._gl.uniform2fv(Z,c),!0)}setArray3(Z,c){return!(!Z||c.length%3!==0)&&(this._gl.uniform3fv(Z,c),!0)}setArray4(Z,c){return!(!Z||c.length%4!==0)&&(this._gl.uniform4fv(Z,c),!0)}setMatrices(Z,c){return!!Z&&(this._gl.uniformMatrix4fv(Z,!1,c),!0)}setMatrix3x3(Z,c){return!!Z&&(this._gl.uniformMatrix3fv(Z,!1,c),!0)}setMatrix2x2(Z,c){return!!Z&&(this._gl.uniformMatrix2fv(Z,!1,c),!0)}setFloat(Z,c){return!!Z&&(this._gl.uniform1f(Z,c),!0)}setFloat2(Z,c,L){return!!Z&&(this._gl.uniform2f(Z,c,L),!0)}setFloat3(Z,c,L,k){return!!Z&&(this._gl.uniform3f(Z,c,L,k),!0)}setFloat4(Z,c,L,k,N){return!!Z&&(this._gl.uniform4f(Z,c,L,k,N),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const Z=this._colorWrite;this._gl.colorMask(Z,Z,Z,Z)}}wipeCaches(Z){this.preventCacheWipeBetweenFrames&&!Z||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),Z&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(Z,c){const L=this._gl;let k=L.NEAREST,N=L.NEAREST,R=!1;switch(Z){case 11:k=L.LINEAR,N=c?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case 3:k=L.LINEAR,R=!0,N=c?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case 8:R=!0,k=L.NEAREST,N=c?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case 4:k=L.NEAREST,N=c?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case 5:k=L.NEAREST,N=c?L.LINEAR_MIPMAP_NEAREST:L.LINEAR;break;case 6:R=!0,k=L.NEAREST,N=c?L.LINEAR_MIPMAP_LINEAR:L.LINEAR;break;case 7:k=L.NEAREST,N=L.LINEAR;break;case 1:k=L.NEAREST,N=L.NEAREST;break;case 9:k=L.LINEAR,N=c?L.NEAREST_MIPMAP_NEAREST:L.NEAREST;break;case 10:R=!0,k=L.LINEAR,N=c?L.NEAREST_MIPMAP_LINEAR:L.NEAREST;break;case 2:k=L.LINEAR,N=L.LINEAR;break;case 12:k=L.LINEAR,N=L.NEAREST}return{min:N,mag:k,hasMipMaps:R}}_createTexture(){const Z=this._gl.createTexture();if(!Z)throw new Error("Unable to create texture");return Z}_createHardwareTexture(){return new E.c(this._createTexture(),this._gl)}_createInternalTexture(Z,c){let L,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!1,G=!1,V=0,p=3,J=5,z=!1,i=1,t=!1,E=0;void 0!==c&&"object"===typeof c?(N=!!c.generateMipMaps,G=!!c.createMipMaps,V=void 0===c.type?0:c.type,p=void 0===c.samplingMode?3:c.samplingMode,J=void 0===c.format?5:c.format,z=void 0!==c.useSRGBBuffer&&c.useSRGBBuffer,i=c.samples??1,L=c.label,t=!!c.createMSAATexture,E=c.comparisonFunction||0):N=!!c,z&&(z=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==V||this._caps.textureFloatLinearFiltering)&&(2!==V||this._caps.textureHalfFloatLinearFiltering)||(p=1),1!==V||this._caps.textureFloat||(V=0,R.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const q=(0,M.h)(J),O=(0,M.d)(J),w=this._gl,P=new x.e(this,k),j=Z.width||Z,o=Z.height||Z,u=Z.depth||0,X=Z.layers||0,h=this._getSamplingParameters(p,(N||G)&&!q),B=0!==X?w.TEXTURE_2D_ARRAY:0!==u?w.TEXTURE_3D:w.TEXTURE_2D,D=q?this._getInternalFormatFromDepthTextureFormat(J,!0,O):this._getRGBABufferInternalSizedFormat(V,J,z),e=q?O?w.DEPTH_STENCIL:w.DEPTH_COMPONENT:this._getInternalFormat(J),H=q?this._getWebGLTextureTypeFromDepthTextureFormat(J):this._getWebGLTextureType(V);if(this._bindTextureDirectly(B,P),0!==X?(P.is2DArray=!0,w.texImage3D(B,0,D,j,o,X,0,e,H,null)):0!==u?(P.is3D=!0,w.texImage3D(B,0,D,j,o,u,0,e,H,null)):w.texImage2D(B,0,D,j,o,0,e,H,null),w.texParameteri(B,w.TEXTURE_MAG_FILTER,h.mag),w.texParameteri(B,w.TEXTURE_MIN_FILTER,h.min),w.texParameteri(B,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(B,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),q&&this.webGLVersion>1&&(0===E?(w.texParameteri(B,w.TEXTURE_COMPARE_FUNC,515),w.texParameteri(B,w.TEXTURE_COMPARE_MODE,w.NONE)):(w.texParameteri(B,w.TEXTURE_COMPARE_FUNC,E),w.texParameteri(B,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE))),(N||G)&&this._gl.generateMipmap(B),this._bindTextureDirectly(B,null),P._useSRGBBuffer=z,P.baseWidth=j,P.baseHeight=o,P.width=j,P.height=o,P.depth=X||u,P.isReady=!0,P.samples=i,P.generateMipMaps=N,P.samplingMode=p,P.type=V,P.format=J,P.label=L,P.comparisonFunction=E,this._internalTexturesCache.push(P),t){let Z=null;if(Z=(0,M.h)(P.format)?this._setupFramebufferDepthAttachments((0,M.d)(P.format),19!==P.format,P.width,P.height,i,P.format,!0):this._createRenderBuffer(P.width,P.height,i,-1,this._getRGBABufferInternalSizedFormat(P.type,P.format,P._useSRGBBuffer),-1),!Z)throw new Error("Unable to create render buffer");P._autoMSAAManagement=!0;let c=P._hardwareTexture;c||(c=P._hardwareTexture=this._createHardwareTexture()),c.addMSAARenderBuffer(Z)}return P}_getUseSRGBBuffer(Z,c){return Z&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||c)}createTexture(Z,c,L,k){var N=this;let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,t=arguments.length>11?arguments[11]:void 0,E=arguments.length>12?arguments[12]:void 0,q=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(Z,c,L,k,R,G,V,(function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];return N._prepareWebGLTexture(...c,z)}),((Z,c,L,N,R,G)=>{const V=this._gl,p=L.width===Z&&L.height===c;R._creationFlags=q??0;const J=this._getTexImageParametersForCreateTexture(R.format,R._useSRGBBuffer);if(p)return V.texImage2D(V.TEXTURE_2D,0,J.internalFormat,J.format,J.type,L),!1;const z=this._caps.maxTextureSize;if(L.width>z||L.height>z||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=Z,this._workingCanvas.height=c,this._workingContext.drawImage(L,0,0,L.width,L.height,0,0,Z,c),V.texImage2D(V.TEXTURE_2D,0,J.internalFormat,J.format,J.type,this._workingCanvas),R.width=Z,R.height=c,!1);{const Z=new x.e(this,2);this._bindTextureDirectly(V.TEXTURE_2D,Z,!0),V.texImage2D(V.TEXTURE_2D,0,J.internalFormat,J.format,J.type,L),this._rescaleTexture(Z,R,k,J.format,(()=>{this._releaseTexture(Z),this._bindTextureDirectly(V.TEXTURE_2D,R,!0),G()}))}return!0}),p,J,z,i,t,E,O)}_getTexImageParametersForCreateTexture(Z,c){let L,k;return 1===this.webGLVersion?(L=this._getInternalFormat(Z,c),k=L):(L=this._getInternalFormat(Z,!1),k=this._getRGBABufferInternalSizedFormat(0,Z,c)),{internalFormat:k,format:L,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(Z,c,L,k,N){}_unpackFlipY(Z){this._unpackFlipYCached!==Z&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,Z?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=Z))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(Z){return Z.isCube?this._gl.TEXTURE_CUBE_MAP:Z.is3D?this._gl.TEXTURE_3D:Z.is2DArray||Z.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=this._getTextureTarget(c),N=this._getSamplingParameters(Z,c.useMipMaps||L);this._setTextureParameterInteger(k,this._gl.TEXTURE_MAG_FILTER,N.mag,c),this._setTextureParameterInteger(k,this._gl.TEXTURE_MIN_FILTER,N.min),L&&N.hasMipMaps&&(c.generateMipMaps=!0,this._gl.generateMipmap(k)),this._bindTextureDirectly(k,null),c.samplingMode=Z}updateTextureDimensions(Z,c,L){}updateTextureWrappingMode(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._getTextureTarget(Z);null!==c&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c),Z),Z._cachedWrapU=c),null!==L&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(L),Z),Z._cachedWrapV=L),(Z.is2DArray||Z.is3D)&&null!==k&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(k),Z),Z._cachedWrapR=k),this._bindTextureDirectly(N,null)}_uploadCompressedDataToTextureDirectly(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const V=this._gl;let p=V.TEXTURE_2D;if(Z.isCube&&(p=V.TEXTURE_CUBE_MAP_POSITIVE_X+R),Z._useSRGBBuffer)switch(c){case 37492:case 36196:this._caps.etc2?c=V.COMPRESSED_SRGB8_ETC2:Z._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?c=V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Z._useSRGBBuffer=!1;break;case 36492:c=V.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:c=V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?c=V.COMPRESSED_SRGB_S3TC_DXT1_EXT:Z._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?c=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:Z._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?c=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:Z._useSRGBBuffer=!1;break;default:Z._useSRGBBuffer=!1}this._gl.compressedTexImage2D(p,G,c,L,k,0,N)}_uploadDataToTextureDirectly(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=this._gl,V=this._getWebGLTextureType(Z.type),p=this._getInternalFormat(Z.format),J=void 0===N?this._getRGBABufferInternalSizedFormat(Z.type,Z.format,Z._useSRGBBuffer):this._getInternalFormat(N,Z._useSRGBBuffer);this._unpackFlipY(Z.invertY);let z=G.TEXTURE_2D;Z.isCube&&(z=G.TEXTURE_CUBE_MAP_POSITIVE_X+L);const i=Math.round(Math.log(Z.width)*Math.LOG2E),t=Math.round(Math.log(Z.height)*Math.LOG2E),E=R?Z.width:Math.pow(2,Math.max(i-k,0)),x=R?Z.height:Math.pow(2,Math.max(t-k,0));G.texImage2D(z,k,J,E,x,0,p,V,c)}updateTextureData(Z,c,L,k,N,R){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=this._gl,z=this._getWebGLTextureType(Z.type),i=this._getInternalFormat(Z.format);this._unpackFlipY(Z.invertY);let t=J.TEXTURE_2D,E=J.TEXTURE_2D;Z.isCube&&(E=J.TEXTURE_CUBE_MAP_POSITIVE_X+G,t=J.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t,Z,!0),J.texSubImage2D(E,V,L,k,N,R,i,z,c),p&&this._gl.generateMipmap(E),this._bindTextureDirectly(t,null)}_uploadArrayBufferViewToTexture(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,R=Z.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(R,Z,!0),this._uploadDataToTextureDirectly(Z,c,L,k),this._bindTextureDirectly(R,null,!0)}_prepareWebGLTextureContinuation(Z,c,L,k,N){const R=this._gl;if(!R)return;const G=this._getSamplingParameters(N,!L);R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,G.mag),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,G.min),L||k||R.generateMipmap(R.TEXTURE_2D),this._bindTextureDirectly(R.TEXTURE_2D,null),c&&c.removePendingData(Z),Z.onLoadedObservable.notifyObservers(Z),Z.onLoadedObservable.clear()}_prepareWebGLTexture(Z,c,L,k,N,R,G,V,p,J){const z=this.getCaps().maxTextureSize,t=Math.min(z,this.needPOTTextures?(0,i.h)(k.width,z):k.width),E=Math.min(z,this.needPOTTextures?(0,i.h)(k.height,z):k.height),x=this._gl;x&&(Z._hardwareTexture?(this._bindTextureDirectly(x.TEXTURE_2D,Z,!0),this._unpackFlipY(void 0===N||!!N),Z.baseWidth=k.width,Z.baseHeight=k.height,Z.width=t,Z.height=E,Z.isReady=!0,Z.type=-1!==Z.type?Z.type:0,Z.format=-1!==Z.format?Z.format:J??(".jpg"!==c||Z._useSRGBBuffer?5:4),V(t,E,k,c,Z,(()=>{this._prepareWebGLTextureContinuation(Z,L,R,G,p)}))||this._prepareWebGLTextureContinuation(Z,L,R,G,p)):L&&L.removePendingData(Z))}_getInternalFormatFromDepthTextureFormat(Z,c,L){const k=this._gl;if(!c)return k.STENCIL_INDEX8;let N=L?k.DEPTH_STENCIL:k.DEPTH_COMPONENT;return this.webGLVersion>1?15===Z?N=k.DEPTH_COMPONENT16:16===Z?N=k.DEPTH_COMPONENT24:17===Z||13===Z?N=L?k.DEPTH24_STENCIL8:k.DEPTH_COMPONENT24:14===Z?N=k.DEPTH_COMPONENT32F:18===Z&&(N=L?k.DEPTH32F_STENCIL8:k.DEPTH_COMPONENT32F):N=k.DEPTH_COMPONENT16,N}_getWebGLTextureTypeFromDepthTextureFormat(Z){const c=this._gl;let L=c.UNSIGNED_INT;return 15===Z?L=c.UNSIGNED_SHORT:17===Z||13===Z?L=c.UNSIGNED_INT_24_8:14===Z?L=c.FLOAT:18===Z?L=c.FLOAT_32_UNSIGNED_INT_24_8_REV:19===Z&&(L=c.UNSIGNED_BYTE),L}_setupFramebufferDepthAttachments(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const V=this._gl;R=R??(Z?13:14);const p=this._getInternalFormatFromDepthTextureFormat(R,c,Z);return Z&&c?this._createRenderBuffer(L,k,N,V.DEPTH_STENCIL,p,G?-1:V.DEPTH_STENCIL_ATTACHMENT):c?this._createRenderBuffer(L,k,N,p,p,G?-1:V.DEPTH_ATTACHMENT):Z?this._createRenderBuffer(L,k,N,p,p,G?-1:V.STENCIL_ATTACHMENT):null}_createRenderBuffer(Z,c,L,k,N,R){let G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const V=this._gl.createRenderbuffer();return this._updateRenderBuffer(V,Z,c,L,k,N,R,G)}_updateRenderBuffer(Z,c,L,k,N,R,G){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const p=this._gl;return p.bindRenderbuffer(p.RENDERBUFFER,Z),k>1&&p.renderbufferStorageMultisample?p.renderbufferStorageMultisample(p.RENDERBUFFER,k,R,c,L):p.renderbufferStorage(p.RENDERBUFFER,N,c,L),-1!==G&&p.framebufferRenderbuffer(p.FRAMEBUFFER,G,p.RENDERBUFFER,Z),V&&p.bindRenderbuffer(p.RENDERBUFFER,null),Z}_releaseTexture(Z){this._deleteTexture(Z._hardwareTexture),this.unbindAllTextures();const c=this._internalTexturesCache.indexOf(Z);-1!==c&&this._internalTexturesCache.splice(c,1),Z._lodTextureHigh&&Z._lodTextureHigh.dispose(),Z._lodTextureMid&&Z._lodTextureMid.dispose(),Z._lodTextureLow&&Z._lodTextureLow.dispose(),Z._irradianceTexture&&Z._irradianceTexture.dispose()}_deleteTexture(Z){null===Z||void 0===Z||Z.release()}_setProgram(Z){this._currentProgram!==Z&&((0,k.u)(Z,this._gl),this._currentProgram=Z)}bindSamplers(Z){const c=Z.getPipelineContext();this._setProgram(c.program);const L=Z.getSamplers();for(let k=0;k<L.length;k++){const c=Z.getUniform(L[k]);c&&(this._boundUniforms[k]=c)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=!1;const G=c&&c._associatedChannel>-1;L&&G&&(this._activeChannel=c._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==c||k){if(this._activateCurrentTexture(),c&&c.isMultiview)throw R.e.Error(["_bindTextureDirectly called with a multiview texture!",Z,c]),"_bindTextureDirectly called with a multiview texture!";var V;this._gl.bindTexture(Z,(null===c||void 0===c||null===(V=c._hardwareTexture)||void 0===V?void 0:V.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=c,c&&(c._associatedChannel=this._activeChannel)}else L&&(N=!0,this._activateCurrentTexture());return G&&!L&&this._bindSamplerUniformToChannel(c._associatedChannel,this._activeChannel),N}_bindTexture(Z,c,L){if(void 0===Z)return;c&&(c._associatedChannel=Z),this._activeChannel=Z;const k=c?this._getTextureTarget(c):this._gl.TEXTURE_2D;this._bindTextureDirectly(k,c)}unbindAllTextures(){for(let Z=0;Z<this._maxSimultaneousTextures;Z++)this._activeChannel=Z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(Z,c,L,k){void 0!==Z&&(c&&(this._boundUniforms[Z]=c),this._setTexture(Z,L))}_bindSamplerUniformToChannel(Z,c){const L=this._boundUniforms[Z];L&&L._currentState!==c&&(this._gl.uniform1i(L,c),L._currentState=c)}_getTextureWrapMode(Z){switch(Z){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(Z,c){let L,k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!c)return null!=this._boundTexturesCache[Z]&&(this._activeChannel=Z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(c.video){this._activeChannel=Z;const L=c.getInternalTexture();L&&(L._associatedChannel=Z),c.update()}else if(4===c.delayLoadState)return c.delayLoad(),!1;L=N?c.depthStencilTexture:c.isReady()?c.getInternalTexture():c.isCube?this.emptyCubeTexture:c.is3D?this.emptyTexture3D:c.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!k&&L&&(L._associatedChannel=Z);let R=!0;this._boundTexturesCache[Z]===L&&(k||this._bindSamplerUniformToChannel(L._associatedChannel,Z),R=!1),this._activeChannel=Z;const G=this._getTextureTarget(L);if(R&&this._bindTextureDirectly(G,L,k),L&&!L.isMultiview){if(L.isCube&&L._cachedCoordinatesMode!==c.coordinatesMode){L._cachedCoordinatesMode=c.coordinatesMode;const Z=3!==c.coordinatesMode&&5!==c.coordinatesMode?1:0;c.wrapU=Z,c.wrapV=Z}L._cachedWrapU!==c.wrapU&&(L._cachedWrapU=c.wrapU,this._setTextureParameterInteger(G,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c.wrapU),L)),L._cachedWrapV!==c.wrapV&&(L._cachedWrapV=c.wrapV,this._setTextureParameterInteger(G,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(c.wrapV),L)),L.is3D&&L._cachedWrapR!==c.wrapR&&(L._cachedWrapR=c.wrapR,this._setTextureParameterInteger(G,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(c.wrapR),L)),this._setAnisotropicLevel(G,L,c.anisotropicFilteringLevel)}return!0}setTextureArray(Z,c,L,k){if(void 0!==Z&&c){this._textureUnits&&this._textureUnits.length===L.length||(this._textureUnits=new Int32Array(L.length));for(let c=0;c<L.length;c++){const k=L[c].getInternalTexture();k?(this._textureUnits[c]=Z+c,k._associatedChannel=Z+c):this._textureUnits[c]=-1}this._gl.uniform1iv(c,this._textureUnits);for(let Z=0;Z<L.length;Z++)this._setTexture(this._textureUnits[Z],L[Z],!0)}}_setAnisotropicLevel(Z,c,L){const k=this._caps.textureAnisotropicFilterExtension;11!==c.samplingMode&&3!==c.samplingMode&&2!==c.samplingMode&&(L=1),k&&c._cachedAnisotropicFilteringLevel!==L&&(this._setTextureParameterFloat(Z,k.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L,this._caps.maxAnisotropy),c),c._cachedAnisotropicFilteringLevel=L)}_setTextureParameterFloat(Z,c,L,k){this._bindTextureDirectly(Z,k,!0,!0),this._gl.texParameterf(Z,c,L)}_setTextureParameterInteger(Z,c,L,k){k&&this._bindTextureDirectly(Z,k,!0,!0),this._gl.texParameteri(Z,c,L)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let Z=0;Z<this._caps.maxVertexAttribs;Z++)this.disableAttributeByIndex(Z)}else for(let Z=0,c=this._vertexAttribArraysEnabled.length;Z<c;Z++)Z>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[Z]||this.disableAttributeByIndex(Z)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var Z;((0,G.k)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(Z=this._gl.getExtension("WEBGL_lose_context"))||void 0===Z||Z.loseContext());(0,k.F)(this._gl)}attachContextLostEvent(Z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",Z,!1)}attachContextRestoredEvent(Z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",Z,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(Z){const c=this._gl;for(;c.getError()!==c.NO_ERROR;);let L=!0;const k=c.createTexture();c.bindTexture(c.TEXTURE_2D,k),c.texImage2D(c.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(Z),1,1,0,c.RGBA,this._getWebGLTextureType(Z),null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);const N=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,N),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,k,0);const R=c.checkFramebufferStatus(c.FRAMEBUFFER);if(L=L&&R===c.FRAMEBUFFER_COMPLETE,L=L&&c.getError()===c.NO_ERROR,L&&(c.clear(c.COLOR_BUFFER_BIT),L=L&&c.getError()===c.NO_ERROR),L){c.bindFramebuffer(c.FRAMEBUFFER,null);const Z=c.RGBA,k=c.UNSIGNED_BYTE,N=new Uint8Array(4);c.readPixels(0,0,1,1,Z,k,N),L=L&&c.getError()===c.NO_ERROR}for(c.deleteTexture(k),c.deleteFramebuffer(N),c.bindFramebuffer(c.FRAMEBUFFER,null);!L&&c.getError()!==c.NO_ERROR;);return L}_getWebGLTextureType(Z){if(1===this._webGLVersion){switch(Z){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(Z){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(Z){case 0:L=this._gl.ALPHA;break;case 1:L=this._gl.LUMINANCE;break;case 2:L=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:L=this._gl.RED;break;case 7:case 33324:case 36761:L=this._gl.RG;break;case 4:case 32852:case 36762:L=c?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:L=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(Z){case 8:L=this._gl.RED_INTEGER;break;case 9:L=this._gl.RG_INTEGER;break;case 10:L=this._gl.RGB_INTEGER;break;case 11:L=this._gl.RGBA_INTEGER}return L}_getRGBABufferInternalSizedFormat(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==c)switch(c){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return L?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(Z){case 3:switch(c){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(c){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return L?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return L?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(c){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(c){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(c){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(c){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(c){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(c){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(c){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return L?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(Z,c,L,k){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const p=N?4:3,J=N?this._gl.RGBA:this._gl.RGB,z=L*k*p;if(V){if(V.length<z)return R.e.Error(`Data buffer is too small to store the read pixels (${V.length} should be more than ${z})`),Promise.resolve(V)}else V=new Uint8Array(z);return G&&this.flushFramebuffer(),this._gl.readPixels(Z,c,L,k,J,this._gl.UNSIGNED_BYTE,V),Promise.resolve(V)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const Z=t.c._CreateCanvas(1,1),c=Z.getContext("webgl")||Z.getContext("experimental-webgl");this._IsSupported=null!=c&&!!window.WebGLRenderingContext}catch(Z){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const Z=t.c._CreateCanvas(1,1),c=Z.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||Z.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!c}catch(Z){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}j._TempClearColorUint32=new Uint32Array(4),j._TempClearColorInt32=new Int32Array(4),j.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],j._ConcatenateShader=O.f,j._IsSupported=null,j._HasMajorPerformanceCaveat=null},11630:(Z,c,L)=>{var k;L.d(c,{d:()=>N}),function(Z){Z[Z.PointerMove=0]="PointerMove",Z[Z.PointerDown=1]="PointerDown",Z[Z.PointerUp=2]="PointerUp"}(k||(k={}));class N{}N.DOM_DELTA_PIXEL=0,N.DOM_DELTA_LINE=1,N.DOM_DELTA_PAGE=2},11621:(Z,c,L)=>{L.d(c,{d:()=>k,e:()=>R,h:()=>N});class k{}k.KEYDOWN=1,k.KEYUP=2;class N{constructor(Z,c){this.type=Z,this.event=c}}class R extends N{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(Z){this.skipOnKeyboardObservable=Z}constructor(Z,c){super(Z,c),this.type=Z,this.event=c,this.skipOnKeyboardObservable=!1}}},11614:(Z,c,L)=>{L.d(c,{e:()=>N,i:()=>G,m:()=>V});var k=L(10993);class N{}N.POINTERDOWN=1,N.POINTERUP=2,N.POINTERMOVE=4,N.POINTERWHEEL=8,N.POINTERPICK=16,N.POINTERTAP=32,N.POINTERDOUBLETAP=64;class R{constructor(Z,c){this.type=Z,this.event=c}}class G extends R{constructor(Z,c,L,N){super(Z,c),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new k.f(L,N)}}class V extends R{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(Z,c),this._pickInfo=L,this._inputManager=k}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11732:(Z,c,L)=>{L.d(c,{e:()=>t});var k=L(11170),N=L(11173),R=L(10993),G=L(11255),V=L(11277),p=L(11236),J=L(11012),z=L(11266),i=L(11242);class t extends V.b{get range(){return this._range}set range(Z){this._range=Z,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(Z){this._intensityMode=Z,this._computePhotometricScale()}get radius(){return this._radius}set radius(Z){this._radius=Z,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(Z){this._shadowEnabled!==Z&&(this._shadowEnabled=Z,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(Z){this._includedOnlyMeshes=Z,this._hookArrayForIncludedOnly(Z)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(Z){this._excludedMeshes=Z,this._hookArrayForExcluded(Z)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(Z){this._excludeWithLayerMask=Z,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(Z){this._includeOnlyWithLayerMask=Z,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(Z){this._lightmapMode!==Z&&(this._lightmapMode=Z,this._markMeshesAsLightDirty())}getViewMatrix(Z){return null}getProjectionMatrix(Z,c){return null}constructor(Z,c){super(Z,c,!1),this.rc=new G.d(1,1,1),this.YJ=new G.d(1,1,1),this.falloffType=t.FALLOFF_DEFAULT,this.Qc=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=t.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.XZ().addLight(this),this._uniformBuffer=new p.c(this.XZ().getEngine(),void 0,void 0,Z),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(Z,c){return this}_bindLight(Z,c,L,k){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const R=Z.toString();let V=!1;if(this._uniformBuffer.bindToEffect(L,"Light"+R),this._renderId!==c.getRenderId()||this._lastUseSpecular!==k||!this._uniformBuffer.useUbo){this._renderId=c.getRenderId(),this._lastUseSpecular=k;const Z=this.getScaledIntensity();this.transferToEffect(L,R),this.rc.scaleToRef(Z,G.i.sc[0]),this._uniformBuffer.updateColor4("vLightDiffuse",G.i.sc[0],this.range,R),k&&(this.YJ.scaleToRef(Z,G.i.sc[1]),this._uniformBuffer.updateColor4("vLightSpecular",G.i.sc[1],this.radius,R)),V=!0}if(this.transferTexturesToEffect(L,R),c.shadowsEnabled&&this.shadowEnabled&&N){const Z=this.getShadowGenerator(c.activeCamera)??this.getShadowGenerator();Z&&(Z.bindShadowLight(R,L),V=!0)}V?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(Z){let c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let L=0;L<this.animations.length;L++)c+=", animation[0]: "+this.animations[L].toString(Z);return c}_syncParentEnabledState(){super._syncParentEnabledState(),this.p()||this._resyncMeshes()}lV(Z){super.lV(Z),this._resyncMeshes()}getShadowGenerator(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(Z)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return R.h.Zero()}canAffectMesh(Z){return!Z||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(Z))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(Z))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&Z.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&Z.layerMask)))}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const Z=this._shadowGenerators.values();for(let c=Z.next();!0!==c.done;c=Z.next()){c.value.dispose()}this._shadowGenerators=null}if(this.XZ().stopAnimation(this),this._parentContainer){const Z=this._parentContainer.lights.indexOf(this);Z>-1&&this._parentContainer.lights.splice(Z,1),this._parentContainer=null}for(const L of this.XZ().meshes)L._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.XZ().removeLight(this),super.dispose(Z,c)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Qc}clone(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=t.GetConstructorFromName(this.getTypeID(),Z,this.XZ());if(!L)return null;const k=i.e.Clone(L,this);return Z&&(k.name=Z),c&&(k.parent=c),k.lV(this.isEnabled()),this.onClonedObservable.notifyObservers(k),k}serialize(){const Z=i.e.Serialize(this);if(Z.uniqueId=this.uniqueId,Z.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(Z),this.excludedMeshes.length>0){Z.excludedMeshesIds=[];for(const c of this.excludedMeshes)Z.excludedMeshesIds.push(c.id)}if(this.includedOnlyMeshes.length>0){Z.includedOnlyMeshesIds=[];for(const c of this.includedOnlyMeshes)Z.includedOnlyMeshesIds.push(c.id)}return i.e.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.isEnabled=this.isEnabled(),Z}static GetConstructorFromName(Z,c,L){const k=V.b.Construct("Light_Type_"+Z,c,L);return k||null}static Parse(Z,c){const L=t.GetConstructorFromName(Z.type,Z.name,c);if(!L)return null;const k=i.e.Parse(L,Z,c);if(Z.excludedMeshesIds&&(k._excludedMeshesIds=Z.excludedMeshesIds),Z.includedOnlyMeshesIds&&(k._includedOnlyMeshesIds=Z.includedOnlyMeshesIds),void 0!==Z.parentId&&(k._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(k._waitingParentInstanceIndex=Z.parentInstanceIndex),void 0!==Z.falloffType&&(k.falloffType=Z.falloffType),void 0!==Z.lightmapMode&&(k.lightmapMode=Z.lightmapMode),Z.animations){for(let c=0;c<Z.animations.length;c++){const L=Z.animations[c],N=(0,J.d)("BABYLON.Animation");N&&k.animations.push(N.Parse(L))}V.b.ParseAnimationRanges(k,Z,c)}return Z.autoAnimate&&c.beginAnimation(k,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),void 0!==Z.isEnabled&&k.lV(Z.isEnabled),k}_hookArrayForExcluded(Z){var c=this;const L=Z.push;Z.push=function(){for(var k=arguments.length,N=new Array(k),R=0;R<k;R++)N[R]=arguments[R];const G=L.apply(Z,N);for(const Z of N)Z._resyncLightSource(c);return G};const k=Z.splice;Z.splice=(c,L)=>{const N=k.apply(Z,[c,L]);for(const Z of N)Z._resyncLightSource(this);return N};for(const N of Z)N._resyncLightSource(this)}_hookArrayForIncludedOnly(Z){var c=this;const L=Z.push;Z.push=function(){for(var k=arguments.length,N=new Array(k),R=0;R<k;R++)N[R]=arguments[R];const G=L.apply(Z,N);return c._resyncMeshes(),G};const k=Z.splice;Z.splice=(c,L)=>{const N=k.apply(Z,[c,L]);return this._resyncMeshes(),N},this._resyncMeshes()}_resyncMeshes(){for(const Z of this.XZ().meshes)Z._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const Z of this.XZ().meshes)-1!==Z.lightSources.indexOf(this)&&Z._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.XZ().resetCachedMaterial()}_getPhotometricScale(){let Z=0;const c=this.getTypeID();let L=this.intensityMode;switch(L===t.INTENSITYMODE_AUTOMATIC&&(L=c===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),c){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(L){case t.INTENSITYMODE_LUMINOUSPOWER:Z=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:Z=1;break;case t.INTENSITYMODE_LUMINANCE:Z=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(L){case t.INTENSITYMODE_ILLUMINANCE:Z=1;break;case t.INTENSITYMODE_LUMINANCE:{let c=this.radius;c=Math.max(c,.001);Z=2*Math.PI*(1-Math.cos(c));break}}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:Z=1}return Z}_reorderLightsInScene(){const Z=this.XZ();0!=this._renderPriority&&(Z.requireLightSorting=!0),this.XZ().sortLightsByPriority()}_isReady(){return!0}}t.FALLOFF_DEFAULT=z.c.FALLOFF_DEFAULT,t.FALLOFF_PHYSICAL=z.c.FALLOFF_PHYSICAL,t.FALLOFF_GLTF=z.c.FALLOFF_GLTF,t.FALLOFF_STANDARD=z.c.FALLOFF_STANDARD,t.LIGHTMAP_DEFAULT=z.c.LIGHTMAP_DEFAULT,t.LIGHTMAP_SPECULAR=z.c.LIGHTMAP_SPECULAR,t.LIGHTMAP_SHADOWSONLY=z.c.LIGHTMAP_SHADOWSONLY,t.INTENSITYMODE_AUTOMATIC=z.c.INTENSITYMODE_AUTOMATIC,t.INTENSITYMODE_LUMINOUSPOWER=z.c.INTENSITYMODE_LUMINOUSPOWER,t.INTENSITYMODE_LUMINOUSINTENSITY=z.c.INTENSITYMODE_LUMINOUSINTENSITY,t.INTENSITYMODE_ILLUMINANCE=z.c.INTENSITYMODE_ILLUMINANCE,t.INTENSITYMODE_LUMINANCE=z.c.INTENSITYMODE_LUMINANCE,t.LIGHTTYPEID_POINTLIGHT=z.c.LIGHTTYPEID_POINTLIGHT,t.LIGHTTYPEID_DIRECTIONALLIGHT=z.c.LIGHTTYPEID_DIRECTIONALLIGHT,t.LIGHTTYPEID_SPOTLIGHT=z.c.LIGHTTYPEID_SPOTLIGHT,t.LIGHTTYPEID_HEMISPHERICLIGHT=z.c.LIGHTTYPEID_HEMISPHERICLIGHT,t.LIGHTTYPEID_RECT_AREALIGHT=z.c.LIGHTTYPEID_RECT_AREALIGHT,(0,k.d)([(0,N.m)()],t.prototype,"diffuse",void 0),(0,k.d)([(0,N.m)()],t.prototype,"specular",void 0),(0,k.d)([(0,N.H)()],t.prototype,"falloffType",void 0),(0,k.d)([(0,N.H)()],t.prototype,"intensity",void 0),(0,k.d)([(0,N.H)()],t.prototype,"range",null),(0,k.d)([(0,N.H)()],t.prototype,"intensityMode",null),(0,k.d)([(0,N.H)()],t.prototype,"radius",null),(0,k.d)([(0,N.H)()],t.prototype,"_renderPriority",void 0),(0,k.d)([(0,N.e)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),(0,k.d)([(0,N.H)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),(0,k.d)([(0,N.H)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),(0,k.d)([(0,N.H)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),(0,k.d)([(0,N.H)("lightmapMode")],t.prototype,"_lightmapMode",void 0)},11266:(Z,c,L)=>{L.d(c,{c:()=>k});class k{static CompareLightsPriority(Z,c){return Z.shadowEnabled!==c.shadowEnabled?(c.shadowEnabled?1:0)-(Z.shadowEnabled?1:0):c.renderPriority-Z.renderPriority}}k.FALLOFF_DEFAULT=0,k.FALLOFF_PHYSICAL=1,k.FALLOFF_GLTF=2,k.FALLOFF_STANDARD=3,k.LIGHTMAP_DEFAULT=0,k.LIGHTMAP_SPECULAR=1,k.LIGHTMAP_SHADOWSONLY=2,k.INTENSITYMODE_AUTOMATIC=0,k.INTENSITYMODE_LUMINOUSPOWER=1,k.INTENSITYMODE_LUMINOUSINTENSITY=2,k.INTENSITYMODE_ILLUMINANCE=3,k.INTENSITYMODE_LUMINANCE=4,k.LIGHTTYPEID_POINTLIGHT=0,k.LIGHTTYPEID_DIRECTIONALLIGHT=1,k.LIGHTTYPEID_SPOTLIGHT=2,k.LIGHTTYPEID_HEMISPHERICLIGHT=3,k.LIGHTTYPEID_RECT_AREALIGHT=4},11792:(Z,c,L)=>{L.d(c,{b:()=>p});var k=L(11170),N=L(11173),R=L(10993),G=L(11732),V=L(11312);class p extends G.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=R.b.Identity(),this._projectionMatrix=R.b.Identity()}_setPosition(Z){this._position=Z}get position(){return this._position}set position(Z){this._setPosition(Z)}_setDirection(Z){this._direction=Z}get direction(){return this._direction}set direction(Z){this._setDirection(Z)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(Z){this._shadowMinZ=Z,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(Z){this._shadowMaxZ=Z,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=R.h.Zero()),R.h.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=R.h.Zero()),R.h.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(Z){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(Z){return this.direction=R.h.Normalize(Z.yL(this.position)),this.direction}getRotation(){this.direction.normalize();const Z=R.h.Cross(this.direction,V.b.Y),c=R.h.Cross(Z,this.direction);return R.h.RotationFromAxis(Z,c,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=R.h.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Jc(Z){return!Z&&this.isSynchronized()?(this._currentRenderId=this.XZ().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.R(this.position),this._worldMatrix||(this._worldMatrix=R.b.Identity()),R.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(Z){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.Dc)||0}getDepthMaxZ(Z){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)||1e4}setShadowProjectionMatrix(Z,c,L){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,L,Z):this._setDefaultShadowProjectionMatrix(Z,c,L),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(Z){const c=R.d.Mc[0];let L=this.position;this.computeTransformedInformation()&&(L=this.transformedPosition),R.h.NormalizeToRef(this.getShadowDirection(Z),c),1===Math.abs(R.h.Dot(c,R.h.Up()))&&(c.z=1e-13);const k=R.d.Mc[1];return L.addToRef(c,k),R.b.LookAtLHToRef(L,k,R.h.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(Z,c){return this.setShadowProjectionMatrix(this._projectionMatrix,Z??this._viewMatrix,c??[]),this._projectionMatrix}}(0,k.d)([(0,N.F)()],p.prototype,"position",null),(0,k.d)([(0,N.F)()],p.prototype,"direction",null),(0,k.d)([(0,N.H)()],p.prototype,"shadowMinZ",null),(0,k.d)([(0,N.H)()],p.prototype,"shadowMaxZ",null)},11362:(Z,c,L)=>{L.d(c,{e:()=>k});class k{static get ForceFullSceneLoadingForIncremental(){return k._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){k._ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return k._ShowLoadingScreen}static set ShowLoadingScreen(Z){k._ShowLoadingScreen=Z}static get loggingLevel(){return k._LoggingLevel}static set loggingLevel(Z){k._LoggingLevel=Z}static get CleanBoneMatrixWeights(){return k._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){k._CleanBoneMatrixWeights=Z}}k._ForceFullSceneLoadingForIncremental=!1,k._ShowLoadingScreen=!0,k._CleanBoneMatrixWeights=!1,k._LoggingLevel=0},11580:(Z,c,L)=>{L.d(c,{c:()=>m});var k=L(11170),N=L(11173),R=L(11052),G=L(11336),V=L(11569),p=L(11588),J=L(10993),z=L(11190),i=L(11650),t=L(11652);class E extends i.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class x extends t.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"PBRBRDF",90,new E,c),this._useEnergyConservation=x.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=x.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=x.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=x.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=x.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=x.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=x.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=x.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=x.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=x.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=x.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=x.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=x.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=x.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=Z._dirtyCallbacks[16],this._enable(!0)}prepareDefines(Z){Z.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,Z.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,Z.SPHERICAL_HARMONICS=this._useSphericalHarmonics,Z.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,Z.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,Z.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,Z.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,Z.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,Z.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}x.DEFAULT_USE_ENERGY_CONSERVATION=!0,x.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,x.DEFAULT_USE_SPHERICAL_HARMONICS=!0,x.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,x.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,x.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,x.DEFAULT_DIFFUSE_MODEL=0,x.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,x.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useEnergyConservation",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSphericalHarmonics",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"mixIblRadianceWithIrradiance",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"useLegacySpecularEnergyConservation",void 0),(0,k.d)([(0,N.H)("baseDiffuseModel"),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"baseDiffuseModel",void 0),(0,k.d)([(0,N.H)("dielectricSpecularModel"),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"dielectricSpecularModel",void 0),(0,k.d)([(0,N.H)("conductorSpecularModel"),(0,N.e)("_markAllSubMeshesAsMiscDirty")],x.prototype,"conductorSpecularModel",void 0);var q=L(11661),O=L(11255),w=L(11592),M=L(11163),P=L(11663),j=L(11508),o=L(11669),u=(L(11674),L(11688)),X=L(11258);class h extends i.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class B extends t.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"PBRClearCoat",100,new h,c),this._isEnabled=!1,this.isEnabled=!1,this.Qc=1,this.roughness=0,this._indexOfRefraction=B._DefaultIndexOfRefraction,this.indexOfRefraction=B._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=O.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1]}isReadyForSubMesh(Z,c,L){if(!this._isEnabled)return!0;const k=this._material._disableBumpMap;if(Z._areTexturesDirty&&c.texturesEnabled){if(this._texture&&o.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(L.getCaps().standardDerivatives&&this._bumpTexture&&o.c.ClearCoatBumpTextureEnabled&&!k&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(Z,c){this._isEnabled?(Z.CLEARCOAT=!0,Z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,Z.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,Z._areTexturesDirty&&c.texturesEnabled&&(this._texture&&o.c.ClearCoatTextureEnabled?(0,X.P)(this._texture,Z,"CLEARCOAT_TEXTURE"):Z.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&o.c.ClearCoatTextureEnabled?(0,X.P)(this._textureRoughness,Z,"CLEARCOAT_TEXTURE_ROUGHNESS"):Z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&o.c.ClearCoatBumpTextureEnabled?(0,X.P)(this._bumpTexture,Z,"CLEARCOAT_BUMP"):Z.CLEARCOAT_BUMP=!1,Z.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===B._DefaultIndexOfRefraction,this._isTintEnabled?(Z.CLEARCOAT_TINT=!0,this._tintTexture&&o.c.ClearCoatTintTextureEnabled?((0,X.P)(this._tintTexture,Z,"CLEARCOAT_TINT_TEXTURE"),Z.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):Z.CLEARCOAT_TINT_TEXTURE=!1):(Z.CLEARCOAT_TINT=!1,Z.CLEARCOAT_TINT_TEXTURE=!1))):(Z.CLEARCOAT=!1,Z.CLEARCOAT_TEXTURE=!1,Z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,Z.CLEARCOAT_BUMP=!1,Z.CLEARCOAT_TINT=!1,Z.CLEARCOAT_TINT_TEXTURE=!1,Z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,Z.CLEARCOAT_DEFAULTIOR=!1,Z.CLEARCOAT_TEXTUREDIRECTUV=0,Z.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,Z.CLEARCOAT_BUMPDIRECTUV=0,Z.CLEARCOAT_REMAP_F0=!1,Z.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,Z.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(Z,c,L,k){if(!this._isEnabled)return;const N=k.materialDefines,R=this._material.isFrozen,G=this._material._disableBumpMap,V=this._material._invertNormalMapX,p=this._material._invertNormalMapY;if(!Z.useUbo||!R||!Z.isSync){var J,z,i,t;if((this._texture||this._textureRoughness)&&o.c.ClearCoatTextureEnabled)Z.updateFloat4("vClearCoatInfos",(null===(J=this._texture)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(z=this._texture)||void 0===z?void 0:z.level)??0,(null===(i=this._textureRoughness)||void 0===i?void 0:i.coordinatesIndex)??0,(null===(t=this._textureRoughness)||void 0===t?void 0:t.level)??0),this._texture&&(0,X.u)(this._texture,Z,"clearCoat"),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,X.u)(this._textureRoughness,Z,"clearCoatRoughness");this._bumpTexture&&L.getCaps().standardDerivatives&&o.c.ClearCoatTextureEnabled&&!G&&(Z.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,X.u)(this._bumpTexture,Z,"clearCoatBump"),c._mirroredCameraPosition?Z.updateFloat2("vClearCoatTangentSpaceParams",V?1:-1,p?1:-1):Z.updateFloat2("vClearCoatTangentSpaceParams",V?-1:1,p?-1:1)),this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&(Z.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,X.u)(this._tintTexture,Z,"clearCoatTint")),Z.updateFloat2("vClearCoatParams",this.Qc,this.roughness);const k=1-this._indexOfRefraction,R=1+this._indexOfRefraction,E=Math.pow(-k/R,2),x=1/this._indexOfRefraction;Z.updateFloat4("vClearCoatRefractionParams",E,x,k,R),this._isTintEnabled&&(Z.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),Z.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}c.texturesEnabled&&(this._texture&&o.c.ClearCoatTextureEnabled&&Z.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.c.ClearCoatTextureEnabled&&Z.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&L.getCaps().standardDerivatives&&o.c.ClearCoatBumpTextureEnabled&&!G&&Z.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&o.c.ClearCoatTintTextureEnabled&&Z.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(Z){return this._texture===Z||(this._textureRoughness===Z||(this._bumpTexture===Z||this._tintTexture===Z))}getActiveTextures(Z){this._texture&&Z.push(this._texture),this._textureRoughness&&Z.push(this._textureRoughness),this._bumpTexture&&Z.push(this._bumpTexture),this._tintTexture&&Z.push(this._tintTexture)}getAnimatables(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&Z.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&Z.push(this._tintTexture)}dispose(Z){var c,L,k,N;Z&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose(),null===(k=this._bumpTexture)||void 0===k||k.dispose(),null===(N=this._tintTexture)||void 0===N||N.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(Z,c,L){return Z.CLEARCOAT_BUMP&&c.addFallback(L++,"CLEARCOAT_BUMP"),Z.CLEARCOAT_TINT&&c.addFallback(L++,"CLEARCOAT_TINT"),Z.CLEARCOAT&&c.addFallback(L++,"CLEARCOAT"),L}getSamplers(Z){Z.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}B._DefaultIndexOfRefraction=1.5,(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isEnabled",void 0),(0,k.d)([(0,N.H)()],B.prototype,"intensity",void 0),(0,k.d)([(0,N.H)()],B.prototype,"roughness",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"indexOfRefraction",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"texture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useRoughnessFromMainTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"textureRoughness",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"remapF0OnInterfaceChange",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"bumpTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isTintEnabled",void 0),(0,k.d)([(0,N.m)()],B.prototype,"tintColor",void 0),(0,k.d)([(0,N.H)()],B.prototype,"tintColorAtDistance",void 0),(0,k.d)([(0,N.H)()],B.prototype,"tintThickness",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"tintTexture",void 0);class D extends i.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class e extends t.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"PBRIridescence",110,new D,c),this._isEnabled=!1,this.isEnabled=!1,this.Qc=1,this.minimumThickness=e._DefaultMinimumThickness,this.maximumThickness=e._DefaultMaximumThickness,this.indexOfRefraction=e._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1]}isReadyForSubMesh(Z,c){if(!this._isEnabled)return!0;if(Z._areTexturesDirty&&c.texturesEnabled){if(this._texture&&o.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&o.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(Z,c){this._isEnabled?(Z.IRIDESCENCE=!0,Z._areTexturesDirty&&c.texturesEnabled&&(this._texture&&o.c.IridescenceTextureEnabled?(0,X.P)(this._texture,Z,"IRIDESCENCE_TEXTURE"):Z.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&o.c.IridescenceTextureEnabled?(0,X.P)(this._thicknessTexture,Z,"IRIDESCENCE_THICKNESS_TEXTURE"):Z.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(Z.IRIDESCENCE=!1,Z.IRIDESCENCE_TEXTURE=!1,Z.IRIDESCENCE_THICKNESS_TEXTURE=!1,Z.IRIDESCENCE_TEXTUREDIRECTUV=0,Z.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(Z,c){if(!this._isEnabled)return;const L=this._material.isFrozen;if(!Z.useUbo||!L||!Z.isSync){var k,N,R,G;if((this._texture||this._thicknessTexture)&&o.c.IridescenceTextureEnabled)Z.updateFloat4("vIridescenceInfos",(null===(k=this._texture)||void 0===k?void 0:k.coordinatesIndex)??0,(null===(N=this._texture)||void 0===N?void 0:N.level)??0,(null===(R=this._thicknessTexture)||void 0===R?void 0:R.coordinatesIndex)??0,(null===(G=this._thicknessTexture)||void 0===G?void 0:G.level)??0),this._texture&&(0,X.u)(this._texture,Z,"iridescence"),this._thicknessTexture&&(0,X.u)(this._thicknessTexture,Z,"iridescenceThickness");Z.updateFloat4("vIridescenceParams",this.Qc,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}c.texturesEnabled&&(this._texture&&o.c.IridescenceTextureEnabled&&Z.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&o.c.IridescenceTextureEnabled&&Z.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(Z){return this._texture===Z||this._thicknessTexture===Z}getActiveTextures(Z){this._texture&&Z.push(this._texture),this._thicknessTexture&&Z.push(this._thicknessTexture)}getAnimatables(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&Z.push(this._thicknessTexture)}dispose(Z){var c,L;Z&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(L=this._thicknessTexture)||void 0===L||L.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(Z,c,L){return Z.IRIDESCENCE&&c.addFallback(L++,"IRIDESCENCE"),L}getSamplers(Z){Z.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}e._DefaultMinimumThickness=100,e._DefaultMaximumThickness=400,e._DefaultIndexOfRefraction=1.3,(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),(0,k.d)([(0,N.H)()],e.prototype,"intensity",void 0),(0,k.d)([(0,N.H)()],e.prototype,"minimumThickness",void 0),(0,k.d)([(0,N.H)()],e.prototype,"maximumThickness",void 0),(0,k.d)([(0,N.H)()],e.prototype,"indexOfRefraction",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0);class H extends i.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class l extends t.c{set angle(Z){this.direction.x=Math.cos(Z),this.direction.y=Math.sin(Z)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"PBRAnisotropic",110,new H,c),this._isEnabled=!1,this.isEnabled=!1,this.Qc=1,this.direction=new J.f(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=Z._dirtyCallbacks[16]}isReadyForSubMesh(Z,c){return!this._isEnabled||!(Z._areTexturesDirty&&c.texturesEnabled&&this._texture&&o.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(Z,c,L){this._isEnabled?(Z.ANISOTROPIC=this._isEnabled,this._isEnabled&&!L.isVerticesDataPresent(z.g.TangentKind)&&(Z._needUVs=!0,Z.MAINUV1=!0),Z._areTexturesDirty&&c.texturesEnabled&&(this._texture&&o.c.AnisotropicTextureEnabled?(0,X.P)(this._texture,Z,"ANISOTROPIC_TEXTURE"):Z.ANISOTROPIC_TEXTURE=!1),Z._areMiscDirty&&(Z.ANISOTROPIC_LEGACY=this._legacy)):(Z.ANISOTROPIC=!1,Z.ANISOTROPIC_TEXTURE=!1,Z.ANISOTROPIC_TEXTUREDIRECTUV=0,Z.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(Z,c){if(!this._isEnabled)return;const L=this._material.isFrozen;Z.useUbo&&L&&Z.isSync||(this._texture&&o.c.AnisotropicTextureEnabled&&(Z.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,X.u)(this._texture,Z,"anisotropy")),Z.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Qc)),c.texturesEnabled&&this._texture&&o.c.AnisotropicTextureEnabled&&Z.setTexture("anisotropySampler",this._texture)}hasTexture(Z){return this._texture===Z}getActiveTextures(Z){this._texture&&Z.push(this._texture)}getAnimatables(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture)}dispose(Z){Z&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(Z,c,L){return Z.ANISOTROPIC&&c.addFallback(L++,"ANISOTROPIC"),L}getSamplers(Z){Z.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(Z,c,L){super.parse(Z,c,L),void 0===Z.legacy&&(this.legacy=!0)}}(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,k.d)([(0,N.H)()],l.prototype,"intensity",void 0),(0,k.d)([(0,N.B)()],l.prototype,"direction",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],l.prototype,"legacy",void 0);class W extends i.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class T extends t.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"Sheen",120,new W,c),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Qc=1,this.color=O.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1]}isReadyForSubMesh(Z,c){if(!this._isEnabled)return!0;if(Z._areTexturesDirty&&c.texturesEnabled){if(this._texture&&o.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&o.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(Z,c){this._isEnabled?(Z.SHEEN=!0,Z.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,Z.SHEEN_ROUGHNESS=null!==this._roughness,Z.SHEEN_ALBEDOSCALING=this._albedoScaling,Z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,Z._areTexturesDirty&&c.texturesEnabled&&(this._texture&&o.c.SheenTextureEnabled?((0,X.P)(this._texture,Z,"SHEEN_TEXTURE"),Z.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):Z.SHEEN_TEXTURE=!1,this._textureRoughness&&o.c.SheenTextureEnabled?(0,X.P)(this._textureRoughness,Z,"SHEEN_TEXTURE_ROUGHNESS"):Z.SHEEN_TEXTURE_ROUGHNESS=!1)):(Z.SHEEN=!1,Z.SHEEN_TEXTURE=!1,Z.SHEEN_TEXTURE_ROUGHNESS=!1,Z.SHEEN_LINKWITHALBEDO=!1,Z.SHEEN_ROUGHNESS=!1,Z.SHEEN_ALBEDOSCALING=!1,Z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,Z.SHEEN_GAMMATEXTURE=!1,Z.SHEEN_TEXTUREDIRECTUV=0,Z.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(Z,c,L,k){if(!this._isEnabled)return;const N=k.materialDefines,R=this._material.isFrozen;if(!Z.useUbo||!R||!Z.isSync){var G,V,p,J;if((this._texture||this._textureRoughness)&&o.c.SheenTextureEnabled)Z.updateFloat4("vSheenInfos",(null===(G=this._texture)||void 0===G?void 0:G.coordinatesIndex)??0,(null===(V=this._texture)||void 0===V?void 0:V.level)??0,(null===(p=this._textureRoughness)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(J=this._textureRoughness)||void 0===J?void 0:J.level)??0),this._texture&&(0,X.u)(this._texture,Z,"sheen"),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,X.u)(this._textureRoughness,Z,"sheenRoughness");Z.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Qc),null!==this._roughness&&Z.updateFloat("vSheenRoughness",this._roughness)}c.texturesEnabled&&(this._texture&&o.c.SheenTextureEnabled&&Z.setTexture("sheenSampler",this._texture),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&o.c.SheenTextureEnabled&&Z.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(Z){return this._texture===Z||this._textureRoughness===Z}getActiveTextures(Z){this._texture&&Z.push(this._texture),this._textureRoughness&&Z.push(this._textureRoughness)}getAnimatables(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&Z.push(this._textureRoughness)}dispose(Z){var c,L;Z&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(L=this._textureRoughness)||void 0===L||L.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(Z,c,L){return Z.SHEEN&&c.addFallback(L++,"SHEEN"),L}getSamplers(Z){Z.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isEnabled",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"linkSheenWithAlbedo",void 0),(0,k.d)([(0,N.H)()],T.prototype,"intensity",void 0),(0,k.d)([(0,N.m)()],T.prototype,"color",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"texture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMainTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"roughness",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"textureRoughness",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"albedoScaling",void 0);class I extends i.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class d extends t.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(Z){this._scene.enableSubSurfaceForPrePass()&&Z&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(Z))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(Z){this._volumeIndexOfRefraction=Z>=1?Z:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"PBRSubSurface",130,new I,c),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=O.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=O.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=d.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=d.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=Z.XZ(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=Z._dirtyCallbacks[32]}isReadyForSubMesh(Z,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(Z._areTexturesDirty&&c.texturesEnabled){if(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const Z=this._getRefractionTexture(c);if(Z&&o.c.RefractionTextureEnabled&&!Z.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(Z,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return Z.SUBSURFACE=!1,Z.SS_DISPERSION=!1,Z.SS_TRANSLUCENCY=!1,Z.SS_SCATTERING=!1,Z.SS_REFRACTION=!1,Z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,Z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,Z.SS_THICKNESSANDMASK_TEXTURE=!1,Z.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,Z.SS_HAS_THICKNESS=!1,Z.SS_REFRACTIONINTENSITY_TEXTURE=!1,Z.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,Z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,Z.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,Z.SS_REFRACTIONMAP_3D=!1,Z.SS_REFRACTIONMAP_OPPOSITEZ=!1,Z.SS_LODINREFRACTIONALPHA=!1,Z.SS_GAMMAREFRACTION=!1,Z.SS_RGBDREFRACTION=!1,Z.SS_LINEARSPECULARREFRACTION=!1,Z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,Z.SS_ALBEDOFORREFRACTIONTINT=!1,Z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,Z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,Z.SS_USE_THICKNESS_AS_DEPTH=!1,Z.SS_USE_GLTF_TEXTURES=!1,Z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,Z.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,Z.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(Z.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(Z._areTexturesDirty){if(Z.SUBSURFACE=!0,Z.SS_DISPERSION=this._isDispersionEnabled,Z.SS_TRANSLUCENCY=this._isTranslucencyEnabled,Z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,Z.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,Z.SS_SCATTERING=this._isScatteringEnabled,Z.SS_THICKNESSANDMASK_TEXTURE=!1,Z.SS_REFRACTIONINTENSITY_TEXTURE=!1,Z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,Z.SS_HAS_THICKNESS=!1,Z.SS_USE_GLTF_TEXTURES=!1,Z.SS_REFRACTION=!1,Z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,Z.SS_REFRACTIONMAP_3D=!1,Z.SS_GAMMAREFRACTION=!1,Z.SS_RGBDREFRACTION=!1,Z.SS_LINEARSPECULARREFRACTION=!1,Z.SS_REFRACTIONMAP_OPPOSITEZ=!1,Z.SS_LODINREFRACTIONALPHA=!1,Z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,Z.SS_ALBEDOFORREFRACTIONTINT=!1,Z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,Z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,Z.SS_USE_THICKNESS_AS_DEPTH=!1,Z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,Z.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,Z._areTexturesDirty&&c.texturesEnabled&&(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&(0,X.P)(this._thicknessTexture,Z,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&(0,X.P)(this._refractionIntensityTexture,Z,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&(0,X.P)(this._translucencyIntensityTexture,Z,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&((0,X.P)(this._translucencyColorTexture,Z,"SS_TRANSLUCENCYCOLOR_TEXTURE"),Z.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),Z.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,Z.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,Z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,Z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&c.texturesEnabled){const L=this._getRefractionTexture(c);L&&o.c.RefractionTextureEnabled&&(Z.SS_REFRACTION=!0,Z.SS_REFRACTIONMAP_3D=L.isCube,Z.SS_GAMMAREFRACTION=L.gammaSpace,Z.SS_RGBDREFRACTION=L.isRGBD,Z.SS_LINEARSPECULARREFRACTION=L.linearSpecularLOD,Z.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&L.isCube?!L.invertZ:L.invertZ,Z.SS_LODINREFRACTIONALPHA=L.lodLevelInAlpha,Z.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,Z.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,Z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=L.isCube&&L.boundingBoxSize,Z.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(Z.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(Z,c,L,k){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)Z.updateFloat2("vThicknessParam",0,0);else{k.getRenderingMesh().getWorldMatrix().decompose(J.d.Mc[0]);const c=Math.max(Math.abs(J.d.Mc[0].x),Math.abs(J.d.Mc[0].y),Math.abs(J.d.Mc[0].z));Z.updateFloat2("vThicknessParam",this.minimumThickness*c,(this.maximumThickness-this.minimumThickness)*c)}}bindForSubMesh(Z,c,L,k){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const N=k.materialDefines,R=this._material.isFrozen,G=this._material.realTimeFiltering,V=N.LODBASEDMICROSFURACE,p=this._getRefractionTexture(c);if(!Z.useUbo||!R||!Z.isSync){if(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&(Z.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,X.u)(this._thicknessTexture,Z,"thickness")),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&(Z.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,X.u)(this._refractionIntensityTexture,Z,"refractionIntensity")),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&(Z.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,X.u)(this._translucencyColorTexture,Z,"translucencyColor")),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(Z.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,X.u)(this._translucencyIntensityTexture,Z,"translucencyIntensity")),p&&o.c.RefractionTextureEnabled){Z.hc("refractionMatrix",p.getRefractionTextureMatrix());let c=1;p.isCube||p.depth&&(c=p.depth);const L=p.getSize().width,k=this.volumeIndexOfRefraction;if(Z.updateFloat4("vRefractionInfos",p.level,1/k,c,this._invertRefractionY?-1:1),Z.updateFloat4("vRefractionMicrosurfaceInfos",L,p.lodGenerationScale,p.lodGenerationOffset,1/this.indexOfRefraction),G&&Z.updateFloat2("vRefractionFilteringInfo",L,Math.log2(L)),p.boundingBoxSize){const c=p;Z.updateVector3("vRefractionPosition",c.boundingBoxPosition),Z.updateVector3("vRefractionSize",c.boundingBoxSize)}}this._isScatteringEnabled&&Z.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),Z.updateColor3("vDiffusionDistance",this.diffusionDistance),Z.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),Z.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),Z.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),Z.updateFloat("dispersion",this.dispersion)}c.texturesEnabled&&(this._thicknessTexture&&o.c.ThicknessTextureEnabled&&Z.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&o.c.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&Z.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&o.c.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&Z.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&o.c.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&Z.setTexture("translucencyColorSampler",this._translucencyColorTexture),p&&o.c.RefractionTextureEnabled&&(V?Z.setTexture("refractionSampler",p):(Z.setTexture("refractionSampler",p._lodTextureMid||p),Z.setTexture("refractionSamplerLow",p._lodTextureLow||p),Z.setTexture("refractionSamplerHigh",p._lodTextureHigh||p))))}_getRefractionTexture(Z){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?Z.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(Z){o.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&Z.push(this._refractionTexture)}hasTexture(Z){return this._thicknessTexture===Z||(this._refractionTexture===Z||(this._refractionIntensityTexture===Z||(this._translucencyIntensityTexture===Z||this._translucencyColorTexture===Z)))}hasRenderTargetTextures(){return!!(o.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(Z){this._thicknessTexture&&Z.push(this._thicknessTexture),this._refractionTexture&&Z.push(this._refractionTexture),this._translucencyColorTexture&&Z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&Z.push(this._translucencyIntensityTexture)}getAnimatables(Z){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&Z.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&Z.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&Z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&Z.push(this._translucencyIntensityTexture)}dispose(Z){Z&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(Z,c,L){return Z.SS_SCATTERING&&c.addFallback(L++,"SS_SCATTERING"),Z.SS_TRANSLUCENCY&&c.addFallback(L++,"SS_TRANSLUCENCY"),L}getSamplers(Z){Z.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}d.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,d.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isRefractionEnabled",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isTranslucencyEnabled",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isDispersionEnabled",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markScenePrePassDirty")],d.prototype,"isScatteringEnabled",void 0),(0,k.d)([(0,N.H)()],d.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,k.d)([(0,N.H)()],d.prototype,"refractionIntensity",void 0),(0,k.d)([(0,N.H)()],d.prototype,"translucencyIntensity",void 0),(0,k.d)([(0,N.H)()],d.prototype,"useAlbedoToTintRefraction",void 0),(0,k.d)([(0,N.H)()],d.prototype,"useAlbedoToTintTranslucency",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"thicknessTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"refractionTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"indexOfRefraction",void 0),(0,k.d)([(0,N.H)()],d.prototype,"_volumeIndexOfRefraction",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"volumeIndexOfRefraction",null),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertRefractionY",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"linkRefractionWithTransparency",void 0),(0,k.d)([(0,N.H)()],d.prototype,"minimumThickness",void 0),(0,k.d)([(0,N.H)()],d.prototype,"maximumThickness",void 0),(0,k.d)([(0,N.H)()],d.prototype,"useThicknessAsDepth",void 0),(0,k.d)([(0,N.m)()],d.prototype,"tintColor",void 0),(0,k.d)([(0,N.H)()],d.prototype,"tintColorAtDistance",void 0),(0,k.d)([(0,N.H)()],d.prototype,"dispersion",void 0),(0,k.d)([(0,N.m)()],d.prototype,"diffusionDistance",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useMaskFromThicknessTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"refractionIntensityTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"translucencyIntensityTexture",void 0),(0,k.d)([(0,N.m)()],d.prototype,"translucencyColor",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"translucencyColorTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useGltfStyleTextures",void 0),(0,k.d)([(0,N.H)()],d.prototype,"applyAlbedoAfterSubSurface",void 0),(0,k.d)([(0,N.H)()],d.prototype,"legacyTransluceny",void 0);var Q=L(11697),r=L(11268),f=L(11701);const S={effect:null,subMesh:null};class s extends i.d{constructor(Z){super(Z),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class m extends P.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(Z){this._realTimeFiltering=Z,this.DJ(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(Z){this._realTimeFilteringQuality=Z,this.DJ(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.XZ().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(Z,c){super(Z,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||m.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new J.j(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=O.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new O.d(0,0,0),this._albedoColor=new O.d(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new O.d(1,1,1),this._reflectionColor=new O.d(1,1,1),this._emissiveColor=new O.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=m.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new G.f(16),this._globalAmbientColor=new O.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new x(this),this.clearCoat=new B(this),this.iridescence=new e(this),this.anisotropy=new l(this),this.sheen=new T(this),this.subSurface=new d(this),this.detailMap=new Q.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),o.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,V.d)(this.XZ()),this.prePassConfiguration=new q.b}get hasRenderTargetTextures(){return!!(o.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var Z;return this._transparencyMode===m.PBRMATERIAL_OPAQUE||this._transparencyMode===m.PBRMATERIAL_ALPHATEST||(null===(Z=this.subSurface)||void 0===Z?void 0:Z.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var Z;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(Z=this.subSurface)||void 0===Z||!Z.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===m.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Oc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==m.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Oc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(Z,c,L){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const k=c._drawWrapper;if(k.effect&&this.isFrozen&&k._wasPreviouslyReady&&k._wasPreviouslyUsingInstances===L)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new s(this._eventInfo.defineNames));const N=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const G=this.XZ(),V=G.getEngine();if(N._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,G.texturesEnabled)){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&o.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&o.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const Z=this._getReflectionTexture();if(Z&&o.c.ReflectionTextureEnabled){if(!Z.isReadyOrNotBlocking())return!1;var p;if(Z.irradianceTexture){if(!Z.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!Z.sphericalPolynomial&&null!==(p=Z.getInternalTexture())&&void 0!==p&&p._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&o.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&o.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(o.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(V.getCaps().standardDerivatives&&this._bumpTexture&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&o.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(N._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(N.AREALIGHTUSED)for(let R=0;R<Z.lightSources.length;R++)if(!Z.lightSources[R]._isReady())return!1;V.getCaps().standardDerivatives||Z.isVerticesDataPresent(z.g.NormalKind)||(Z.createNormals(!0),R.e.Warn("PBRMaterial: Normals have been created for the mesh: "+Z.name));const J=c.effect,i=N._areLightsDisposed;let t=this._prepareEffect(Z,N,this.onCompiled,this.onError,L,null,c.getRenderingMesh().hasThinInstances),E=!1;if(t)if(this._onEffectCreatedObservable&&(S.effect=t,S.subMesh=c,this._onEffectCreatedObservable.notifyObservers(S)),this.allowShaderHotSwapping&&J&&!t.isReady()){if(t=J,N.markAsUnprocessed(),E=this.isFrozen,i)return N._areLightsDisposed=!0,!1}else G.resetCachedMaterial(),c.setEffect(t,N,this._materialContext);return!(!c.effect||!c.effect.isReady())&&(N._renderId=G.getRenderId(),k._wasPreviouslyReady=!E,k._wasPreviouslyUsingInstances=!!L,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(Z,c){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(Z,c,R,G,V),!c.isDirty)return null;c.markAsProcessed();const p=this.XZ().getEngine(),J=new u.c;let i=0;c.USESPHERICALINVERTEX&&J.addFallback(i++,"USESPHERICALINVERTEX"),c.FOG&&J.addFallback(i,"FOG"),c.SPECULARAA&&J.addFallback(i,"SPECULARAA"),c.POINTSIZE&&J.addFallback(i,"POINTSIZE"),c.LOGARITHMICDEPTH&&J.addFallback(i,"LOGARITHMICDEPTH"),c.PARALLAX&&J.addFallback(i,"PARALLAX"),c.PARALLAX_RHS&&J.addFallback(i,"PARALLAX_RHS"),c.PARALLAXOCCLUSION&&J.addFallback(i++,"PARALLAXOCCLUSION"),c.ENVIRONMENTBRDF&&J.addFallback(i++,"ENVIRONMENTBRDF"),c.TANGENT&&J.addFallback(i++,"TANGENT"),c.BUMP&&J.addFallback(i++,"BUMP"),i=(0,X.y)(c,J,this._maxSimultaneousLights,i++),c.SPECULARTERM&&J.addFallback(i++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&J.addFallback(i++,"USESPHERICALFROMREFLECTIONMAP"),c.USEIRRADIANCEMAP&&J.addFallback(i++,"USEIRRADIANCEMAP"),c.LIGHTMAP&&J.addFallback(i++,"LIGHTMAP"),c.NORMAL&&J.addFallback(i++,"NORMAL"),c.AMBIENT&&J.addFallback(i++,"AMBIENT"),c.EMISSIVE&&J.addFallback(i++,"EMISSIVE"),c.VERTEXCOLOR&&J.addFallback(i++,"VERTEXCOLOR"),c.MORPHTARGETS&&J.addFallback(i++,"MORPHTARGETS"),c.MULTIVIEW&&J.addFallback(0,"MULTIVIEW");const t=[z.g.PositionKind];c.NORMAL&&t.push(z.g.NormalKind),c.TANGENT&&t.push(z.g.TangentKind);for(let L=1;L<=6;++L)c["UV"+L]&&t.push(`uv${1===L?"":L}`);c.VERTEXCOLOR&&t.push(z.g.ColorKind),(0,X.C)(t,Z,c,J),(0,X.E)(t,c),(0,X.G)(t,Z,c),(0,X.B)(t,Z,c);let E="pbr";const x=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],O=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],M=["Material","Scene","Mesh"],P={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=J,this._eventInfo.fallbackRank=i,this._eventInfo.defines=c,this._eventInfo.uniforms=x,this._eventInfo.attributes=t,this._eventInfo.samplers=O,this._eventInfo.uniformBuffersNames=M,this._eventInfo.customCode=void 0,this._eventInfo.mesh=Z,this._eventInfo.indexParameters=P,this._callbackPluginEventGeneric(128,this._eventInfo),f.d.AddUniformsAndSamplers(x,O),q.b.AddUniforms(x),q.b.AddSamplers(O),(0,r.b)(x),w.b&&(w.b.PrepareUniforms(x,c),w.b.PrepareSamplers(O,c)),(0,X._)({uniformsNames:x,uniformBuffersNames:M,samplers:O,defines:c,maxSimultaneousLights:this._maxSimultaneousLights});const j={};this.customShaderNameResolve&&(E=this.customShaderNameResolve(E,x,M,O,c,t,j));const o=c.toString(),h=p.createEffect(E,{attributes:t,uniformsNames:x,uniformBuffersNames:M,samplers:O,defines:o,fallbacks:J,onCompiled:k,onError:N,indexParameters:P,processFinalCode:j.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:c.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([L.e(20),L.e(45)]).then(L.bind(L,13705)),Promise.all([L.e(18),L.e(46)]).then(L.bind(L,13858))]):await Promise.all([Promise.all([L.e(13),L.e(48)]).then(L.bind(L,13956)),Promise.all([L.e(12),L.e(49)]).then(L.bind(L,14129))]),this._shadersLoaded=!0}},p);return this._eventInfo.customCode=void 0,h}_prepareDefines(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const R=this.XZ(),G=R.getEngine();(0,X.O)(R,Z,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,(0,X.U)(R,c);const V=this.needAlphaBlendingForMesh(Z)&&this.XZ().useOrderIndependentTransparency;if((0,X.Y)(R,c,this.canRenderToMRT&&!V),(0,X.X)(R,c,V),f.d.PrepareDefines(G.currentRenderPassId,Z,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){c._needUVs=!1;for(let Z=1;Z<=6;++Z)c["MAINUV"+Z]=!1;if(R.texturesEnabled){c.ALBEDODIRECTUV=0,c.BASE_WEIGHTDIRECTUV=0,c.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,c.AMBIENTDIRECTUV=0,c.OPACITYDIRECTUV=0,c.EMISSIVEDIRECTUV=0,c.REFLECTIVITYDIRECTUV=0,c.MICROSURFACEMAPDIRECTUV=0,c.METALLIC_REFLECTANCEDIRECTUV=0,c.REFLECTANCEDIRECTUV=0,c.BUMPDIRECTUV=0,c.LIGHTMAPDIRECTUV=0,G.getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&o.c.DiffuseTextureEnabled?((0,X.P)(this._albedoTexture,c,"ALBEDO"),c.GAMMAALBEDO=this._albedoTexture.gammaSpace):c.ALBEDO=!1,this._baseWeightTexture&&o.c.BaseWeightTextureEnabled?(0,X.P)(this._baseWeightTexture,c,"BASE_WEIGHT"):c.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled?(0,X.P)(this._baseDiffuseRoughnessTexture,c,"BASE_DIFFUSE_ROUGHNESS"):c.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&o.c.AmbientTextureEnabled?((0,X.P)(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&o.c.OpacityTextureEnabled?((0,X.P)(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;const Z=this._getReflectionTexture();if(Z&&o.c.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=Z.gammaSpace,c.RGBDREFLECTION=Z.isRGBD,c.LODINREFLECTIONALPHA=Z.lodLevelInAlpha,c.LINEARSPECULARREFLECTION=Z.linearSpecularLOD,c.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(c.NUM_SAMPLES=""+this.realTimeFilteringQuality,G._features.needTypeSuffixInShaderConstants&&(c.NUM_SAMPLES=c.NUM_SAMPLES+"u"),c.REALTIME_FILTERING=!0,this.XZ().iblCdfGenerator&&(c.IBL_CDF_FILTERING=!0)):c.REALTIME_FILTERING=!1,c.INVERTCUBICMAP=Z.coordinatesMode===j.c.INVCUBIC_MODE,c.REFLECTIONMAP_3D=Z.isCube,c.REFLECTIONMAP_OPPOSITEZ=c.REFLECTIONMAP_3D&&this.XZ().useRightHandedSystem?!Z.invertZ:Z.invertZ,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Z.coordinatesMode){case j.c.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case j.c.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case j.c.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case j.c.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case j.c.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case j.c.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case j.c.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case j.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case j.c.CUBIC_MODE:case j.c.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!Z.boundingBoxSize}Z.coordinatesMode!==j.c.SKYBOX_MODE&&(Z.irradianceTexture?(c.USEIRRADIANCEMAP=!0,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USESPHERICALINVERTEX=!1,Z.irradianceTexture._dominantDirection&&(c.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):Z.isCube&&(c.USESPHERICALFROMREFLECTIONMAP=!0,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||G.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0))}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1,c.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&o.c.LightmapTextureEnabled?((0,X.P)(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):c.LIGHTMAP=!1,this._emissiveTexture&&o.c.EmissiveTextureEnabled?((0,X.P)(this._emissiveTexture,c,"EMISSIVE"),c.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):c.EMISSIVE=!1,o.c.SpecularTextureEnabled?(this._metallicTexture?((0,X.P)(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,c.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,X.P)(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,c.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):c.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(c.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,X.P)(this._metallicReflectanceTexture,c,"METALLIC_REFLECTANCE"),c.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):c.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,X.P)(this._reflectanceTexture,c,"REFLECTANCE"),c.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):c.REFLECTANCE=!1):(c.METALLIC_REFLECTANCE=!1,c.REFLECTANCE=!1),this._microSurfaceTexture?(0,X.P)(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),G.getCaps().standardDerivatives&&this._bumpTexture&&o.c.BumpTextureEnabled&&!this._disableBumpMap?((0,X.P)(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&o.c.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAX_RHS=R.useRightHandedSystem,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(c.BUMP=!1,c.PARALLAX=!1,c.PARALLAX_RHS=!1,c.PARALLAXOCCLUSION=!1,c.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&o.c.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===m.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===m.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ec&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.MIRRORED=!!R._mirroredCameraPosition,c.SPECULARAA=G.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(c._areTexturesDirty||c._areMiscDirty)&&(c.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,c.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,c.ALPHABLEND=this.needAlphaBlendingForMesh(Z),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&((0,X.T)(Z,R,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(Z),c,this._applyDecalMapAfterDetailMap),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!Z.isVerticesDataPresent(z.g.NormalKind),c.DEBUGMODE=this._debugMode),(0,X.M)(R,G,this,c,!!L,k,N),this._eventInfo.defines=c,this._eventInfo.mesh=Z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,X.K)(Z,c,!0,!0,!0,this._transparencyMode!==m.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(Z,c,L){const k={clipPlane:!1,useInstances:!1,...L};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const L=new s(this._eventInfo.defineNames),N=this._prepareEffect(Z,L,void 0,void 0,k.useInstances,k.clipPlane,Z.hasThinInstances);this._onEffectCreatedObservable&&(S.effect=N,S.subMesh=null,this._onEffectCreatedObservable.notifyObservers(S)),N.isReady()?c&&c(this):N.onCompileObservable.add((()=>{c&&c(this)}))})()}buildUniformLayout(){const Z=this._uniformBuffer;Z.addUniform("vAlbedoInfos",2),Z.addUniform("vBaseWeightInfos",2),Z.addUniform("vBaseDiffuseRoughnessInfos",2),Z.addUniform("vAmbientInfos",4),Z.addUniform("vOpacityInfos",2),Z.addUniform("vEmissiveInfos",2),Z.addUniform("vLightmapInfos",2),Z.addUniform("vReflectivityInfos",3),Z.addUniform("vMicroSurfaceSamplerInfos",2),Z.addUniform("vReflectionInfos",2),Z.addUniform("vReflectionFilteringInfo",2),Z.addUniform("vReflectionPosition",3),Z.addUniform("vReflectionSize",3),Z.addUniform("vBumpInfos",3),Z.addUniform("albedoMatrix",16),Z.addUniform("baseWeightMatrix",16),Z.addUniform("baseDiffuseRoughnessMatrix",16),Z.addUniform("ambientMatrix",16),Z.addUniform("opacityMatrix",16),Z.addUniform("emissiveMatrix",16),Z.addUniform("lightmapMatrix",16),Z.addUniform("reflectivityMatrix",16),Z.addUniform("microSurfaceSamplerMatrix",16),Z.addUniform("bumpMatrix",16),Z.addUniform("vTangentSpaceParams",2),Z.addUniform("reflectionMatrix",16),Z.addUniform("vReflectionColor",3),Z.addUniform("vAlbedoColor",4),Z.addUniform("baseWeight",1),Z.addUniform("baseDiffuseRoughness",1),Z.addUniform("vLightingIntensity",4),Z.addUniform("vReflectionMicrosurfaceInfos",3),Z.addUniform("vReflectionDominantDirection",3),Z.addUniform("pointSize",1),Z.addUniform("vReflectivityColor",4),Z.addUniform("vEmissiveColor",3),Z.addUniform("vAmbientColor",3),Z.addUniform("vDebugMode",2),Z.addUniform("vMetallicReflectanceFactors",4),Z.addUniform("vMetallicReflectanceInfos",2),Z.addUniform("metallicReflectanceMatrix",16),Z.addUniform("vReflectanceInfos",2),Z.addUniform("reflectanceMatrix",16),Z.addUniform("vSphericalL00",3),Z.addUniform("vSphericalL1_1",3),Z.addUniform("vSphericalL10",3),Z.addUniform("vSphericalL11",3),Z.addUniform("vSphericalL2_2",3),Z.addUniform("vSphericalL2_1",3),Z.addUniform("vSphericalL20",3),Z.addUniform("vSphericalL21",3),Z.addUniform("vSphericalL22",3),Z.addUniform("vSphericalX",3),Z.addUniform("vSphericalY",3),Z.addUniform("vSphericalZ",3),Z.addUniform("vSphericalXX_ZZ",3),Z.addUniform("vSphericalYY_ZZ",3),Z.addUniform("vSphericalZZ",3),Z.addUniform("vSphericalXY",3),Z.addUniform("vSphericalYZ",3),Z.addUniform("vSphericalZX",3),Z.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(Z,c,L){const k=this.XZ(),N=L.materialDefines;if(!N)return;const R=L.effect;if(!R)return;this._activeEffect=R,c.getMeshUniformBuffer().bindToEffect(R,"Mesh"),c.transferToEffect(Z);const G=k.getEngine();this._uniformBuffer.bindToEffect(R,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,k,c,Z,this.isFrozen),f.d.Bind(G.currentRenderPassId,this._activeEffect,c,Z,this);const V=k.activeCamera;V?this._uniformBuffer.updateFloat4("cameraInfo",V.Dc,V.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=L,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const J=this._mustRebind(k,R,L,c.visibility);(0,X.b)(c,this._activeEffect,this.prePassConfiguration);let z=null;const i=this._uniformBuffer;if(J){if(this.bindViewProjection(R),z=this._getReflectionTexture(),!i.useUbo||!this.isFrozen||!i.isSync||L._drawWrapper._forceRebindOnNextCall){var t;if(k.texturesEnabled){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&(i.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,X.u)(this._albedoTexture,i,"albedo")),this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&(i.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,X.u)(this._baseWeightTexture,i,"baseWeight")),this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&(i.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,X.u)(this._baseDiffuseRoughnessTexture,i,"baseDiffuseRoughness")),this._ambientTexture&&o.c.AmbientTextureEnabled&&(i.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,X.u)(this._ambientTexture,i,"ambient")),this._opacityTexture&&o.c.OpacityTextureEnabled&&(i.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,X.u)(this._opacityTexture,i,"opacity")),z&&o.c.ReflectionTextureEnabled){if(i.hc("reflectionMatrix",z.getReflectionTextureMatrix()),i.updateFloat2("vReflectionInfos",z.level*k.iblIntensity,0),z.boundingBoxSize){const Z=z;i.updateVector3("vReflectionPosition",Z.boundingBoxPosition),i.updateVector3("vReflectionSize",Z.boundingBoxSize)}if(this.realTimeFiltering){const Z=z.getSize().width;i.updateFloat2("vReflectionFilteringInfo",Z,Math.log2(Z))}if(N.USEIRRADIANCEMAP)N.USEIRRADIANCEMAP&&N.USE_IRRADIANCE_DOMINANT_DIRECTION&&i.updateVector3("vReflectionDominantDirection",z.irradianceTexture._dominantDirection);else{const Z=z.sphericalPolynomial;if(N.USESPHERICALFROMREFLECTIONMAP&&Z)if(N.SPHERICAL_HARMONICS){const c=Z.preScaledHarmonics;i.updateVector3("vSphericalL00",c.l00),i.updateVector3("vSphericalL1_1",c.l1_1),i.updateVector3("vSphericalL10",c.l10),i.updateVector3("vSphericalL11",c.l11),i.updateVector3("vSphericalL2_2",c.l2_2),i.updateVector3("vSphericalL2_1",c.l2_1),i.updateVector3("vSphericalL20",c.l20),i.updateVector3("vSphericalL21",c.l21),i.updateVector3("vSphericalL22",c.l22)}else i.updateFloat3("vSphericalX",Z.x.x,Z.x.y,Z.x.z),i.updateFloat3("vSphericalY",Z.y.x,Z.y.y,Z.y.z),i.updateFloat3("vSphericalZ",Z.z.x,Z.z.y,Z.z.z),i.updateFloat3("vSphericalXX_ZZ",Z.xx.x-Z.zz.x,Z.xx.y-Z.zz.y,Z.xx.z-Z.zz.z),i.updateFloat3("vSphericalYY_ZZ",Z.yy.x-Z.zz.x,Z.yy.y-Z.zz.y,Z.yy.z-Z.zz.z),i.updateFloat3("vSphericalZZ",Z.zz.x,Z.zz.y,Z.zz.z),i.updateFloat3("vSphericalXY",Z.xy.x,Z.xy.y,Z.xy.z),i.updateFloat3("vSphericalYZ",Z.yz.x,Z.yz.y,Z.yz.z),i.updateFloat3("vSphericalZX",Z.zx.x,Z.zx.y,Z.zx.z)}i.updateFloat3("vReflectionMicrosurfaceInfos",z.getSize().width,z.lodGenerationScale,z.lodGenerationOffset)}this._emissiveTexture&&o.c.EmissiveTextureEnabled&&(i.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,X.u)(this._emissiveTexture,i,"emissive")),this._lightmapTexture&&o.c.LightmapTextureEnabled&&(i.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,X.u)(this._lightmapTexture,i,"lightmap")),o.c.SpecularTextureEnabled&&(this._metallicTexture?(i.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,X.u)(this._metallicTexture,i,"reflectivity")):this._reflectivityTexture&&(i.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,X.u)(this._reflectivityTexture,i,"reflectivity")),this._metallicReflectanceTexture&&(i.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,X.u)(this._metallicReflectanceTexture,i,"metallicReflectance")),this._reflectanceTexture&&N.REFLECTANCE&&(i.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,X.u)(this._reflectanceTexture,i,"reflectance")),this._microSurfaceTexture&&(i.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,X.u)(this._microSurfaceTexture,i,"microSurfaceSampler"))),this._bumpTexture&&G.getCaps().standardDerivatives&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&(i.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,X.u)(this._bumpTexture,i,"bump"),k._mirroredCameraPosition?i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&i.updateFloat("pointSize",this.pointSize),N.METALLICWORKFLOW){var E;O.i.mc[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,O.i.mc[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const Z=(null===(E=this.subSurface)||void 0===E?void 0:E._indexOfRefraction)??1.5,c=1;O.i.mc[0].b=Z;const L=Math.pow((Z-c)/(Z+c),2);O.i.mc[0].a=L,i.updateDirectColor4("vReflectivityColor",O.i.mc[0]),i.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else i.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);i.updateColor3("vEmissiveColor",o.c.EmissiveTextureEnabled?this._emissiveColor:O.d.BlackReadOnly),i.updateColor3("vReflectionColor",this._reflectionColor),!N.SS_REFRACTION&&null!==(t=this.subSurface)&&void 0!==t&&t._linkRefractionWithTransparency?i.updateColor4("vAlbedoColor",this._albedoColor,1):i.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),i.updateFloat("baseWeight",this._baseWeight),i.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*k.environmentIntensity,this._lightingInfos.w=this._specularIntensity,i.updateVector4("vLightingIntensity",this._lightingInfos),k.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),i.updateColor3("vAmbientColor",this._globalAmbientColor),i.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(k.texturesEnabled){if(this._albedoTexture&&o.c.DiffuseTextureEnabled&&i.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&o.c.BaseWeightTextureEnabled&&i.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&o.c.BaseDiffuseRoughnessTextureEnabled&&i.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&o.c.AmbientTextureEnabled&&i.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&o.c.OpacityTextureEnabled&&i.setTexture("opacitySampler",this._opacityTexture),z&&o.c.ReflectionTextureEnabled){N.LODBASEDMICROSFURACE?i.setTexture("reflectionSampler",z):(i.setTexture("reflectionSampler",z._lodTextureMid||z),i.setTexture("reflectionSamplerLow",z._lodTextureLow||z),i.setTexture("reflectionSamplerHigh",z._lodTextureHigh||z)),N.USEIRRADIANCEMAP&&i.setTexture("irradianceSampler",z.irradianceTexture);const Z=this.XZ().iblCdfGenerator;this.realTimeFiltering&&Z&&i.setTexture("icdfSampler",Z.getIcdfTexture())}N.ENVIRONMENTBRDF&&i.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&o.c.EmissiveTextureEnabled&&i.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&o.c.LightmapTextureEnabled&&i.setTexture("lightmapSampler",this._lightmapTexture),o.c.SpecularTextureEnabled&&(this._metallicTexture?i.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&i.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&i.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&N.REFLECTANCE&&i.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&i.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&G.getCaps().standardDerivatives&&o.c.BumpTextureEnabled&&!this._disableBumpMap&&i.setTexture("bumpSampler",this._bumpTexture)}this.XZ().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.XZ().depthPeelingRenderer.bind(R),this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,r.e)(this._activeEffect,this,k),this.bindEyePosition(R)}else k.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(J||!this.isFrozen){var x;if(k.lightsEnabled&&!this._disableLighting&&(0,X.g)(k,c,this._activeEffect,N,this._maxSimultaneousLights),(k.fogEnabled&&c.applyFog&&k.fogMode!==p.d.FOGMODE_NONE||z||this.subSurface.refractionTexture||c.receiveShadows||N.PREPASS)&&this.bindView(R),(0,X.d)(k,c,this._activeEffect,!0),N.NUM_MORPH_INFLUENCERS&&(0,X.n)(c,this._activeEffect),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(x=c.bakedVertexAnimationManager)||void 0===x||x.bind(R,N.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,X.k)(N,this._activeEffect,k)}this._afterBind(c,this._activeEffect,L),i.update()}getAnimatables(){const Z=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&Z.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&Z.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&Z.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&Z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&Z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&Z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&Z.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?Z.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&Z.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&Z.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&Z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&Z.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&Z.push(this._microSurfaceTexture),Z}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.XZ().environmentTexture}getActiveTextures(){const Z=super.getActiveTextures();return this._albedoTexture&&Z.push(this._albedoTexture),this._baseWeightTexture&&Z.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&Z.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&Z.push(this._ambientTexture),this._opacityTexture&&Z.push(this._opacityTexture),this._reflectionTexture&&Z.push(this._reflectionTexture),this._emissiveTexture&&Z.push(this._emissiveTexture),this._reflectivityTexture&&Z.push(this._reflectivityTexture),this._metallicTexture&&Z.push(this._metallicTexture),this._metallicReflectanceTexture&&Z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&Z.push(this._reflectanceTexture),this._microSurfaceTexture&&Z.push(this._microSurfaceTexture),this._bumpTexture&&Z.push(this._bumpTexture),this._lightmapTexture&&Z.push(this._lightmapTexture),Z}hasTexture(Z){return!!super.hasTexture(Z)||(this._albedoTexture===Z||(this._baseWeightTexture===Z||(this._baseDiffuseRoughnessTexture===Z||(this._ambientTexture===Z||(this._opacityTexture===Z||(this._reflectionTexture===Z||(this._emissiveTexture===Z||(this._reflectivityTexture===Z||(this._metallicTexture===Z||(this._metallicReflectanceTexture===Z||(this._reflectanceTexture===Z||(this._microSurfaceTexture===Z||(this._bumpTexture===Z||this._lightmapTexture===Z)))))))))))))}setPrePassRenderer(){var Z;if(null===(Z=this.subSurface)||void 0===Z||!Z.isScatteringEnabled)return!1;const c=this.XZ().enableSubSurfaceForPrePass();return c&&(c.enabled=!0),!0}dispose(Z,c){var L,k,N,R,G,V,p,J,z,i,t,E,x,q;(this._breakShaderLoadedCheck=!0,c)&&(this._environmentBRDFTexture&&this.XZ().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(L=this._albedoTexture)||void 0===L||L.dispose(),null===(k=this._baseWeightTexture)||void 0===k||k.dispose(),null===(N=this._baseDiffuseRoughnessTexture)||void 0===N||N.dispose(),null===(R=this._ambientTexture)||void 0===R||R.dispose(),null===(G=this._opacityTexture)||void 0===G||G.dispose(),null===(V=this._reflectionTexture)||void 0===V||V.dispose(),null===(p=this._emissiveTexture)||void 0===p||p.dispose(),null===(J=this._metallicTexture)||void 0===J||J.dispose(),null===(z=this._reflectivityTexture)||void 0===z||z.dispose(),null===(i=this._bumpTexture)||void 0===i||i.dispose(),null===(t=this._lightmapTexture)||void 0===t||t.dispose(),null===(E=this._metallicReflectanceTexture)||void 0===E||E.dispose(),null===(x=this._reflectanceTexture)||void 0===x||x.dispose(),null===(q=this._microSurfaceTexture)||void 0===q||q.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(Z,c)}}m.PBRMATERIAL_OPAQUE=M.e.MATERIAL_OPAQUE,m.PBRMATERIAL_ALPHATEST=M.e.MATERIAL_ALPHATEST,m.PBRMATERIAL_ALPHABLEND=M.e.MATERIAL_ALPHABLEND,m.PBRMATERIAL_ALPHATESTANDBLEND=M.e.MATERIAL_ALPHATESTANDBLEND,m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,m.LIGHTFALLOFF_PHYSICAL=0,m.LIGHTFALLOFF_GLTF=1,m.LIGHTFALLOFF_STANDARD=2,m.ForceGLSL=!1,(0,k.d)([(0,N.u)()],m.prototype,"_imageProcessingConfiguration",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsMiscDirty")],m.prototype,"debugMode",void 0)},11563:(Z,c,L)=>{L.d(c,{e:()=>i});var k=L(11170),N=L(11173),R=L(11569),G=L(11255),V=L(11580),p=L(11012),J=L(11163),z=L(11242);class i extends V.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(Z){this.subSurface.refractionTexture=Z,Z?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(Z){this.subSurface.indexOfRefraction=Z}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(Z){this.subSurface.invertRefractionY=Z}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(Z){this.subSurface.linkRefractionWithTransparency=Z,Z&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===V.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(Z){Z!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=Z?V.c.LIGHTFALLOFF_PHYSICAL:V.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===V.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(Z){Z!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=Z?V.c.LIGHTFALLOFF_GLTF:V.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(Z){this._imageProcessingConfiguration.exposure=Z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(Z){this._imageProcessingConfiguration.contrast=Z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(Z){this._imageProcessingConfiguration.colorGradingTexture=Z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(Z){this._imageProcessingConfiguration.colorCurves=Z}constructor(Z,c){super(Z,c,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=G.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new G.d(0,0,0),this.albedoColor=new G.d(1,1,1),this.baseWeight=1,this.reflectivityColor=new G.d(1,1,1),this.reflectionColor=new G.d(1,1,1),this.emissiveColor=new G.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,R.d)(this.XZ())}getClassName(){return"PBRMaterial"}clone(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const k=z.e.Clone((()=>new i(Z,this.XZ())),this,{cloneTexturesOnlyOnce:c});return k.id=Z,k.name=Z,this.stencil.copyTo(k.stencil),this._clonePlugins(k,L),k}serialize(){const Z=super.serialize();return Z.customType="BABYLON.PBRMaterial",Z}static Parse(Z,c,L){const k=z.e.Parse((()=>new i(Z.name,c)),Z,c,L);return Z.stencil&&k.stencil.parse(Z.stencil,c,L),J.e._ParsePlugins(Z,k,c,L),Z.clearCoat&&k.clearCoat.parse(Z.clearCoat,c,L),Z.anisotropy&&k.anisotropy.parse(Z.anisotropy,c,L),Z.brdf&&k.brdf.parse(Z.brdf,c,L),Z.sheen&&k.sheen.parse(Z.sheen,c,L),Z.subSurface&&k.subSurface.parse(Z.subSurface,c,L),Z.iridescence&&k.iridescence.parse(Z.iridescence,c,L),k}}i.PBRMATERIAL_OPAQUE=V.c.PBRMATERIAL_OPAQUE,i.PBRMATERIAL_ALPHATEST=V.c.PBRMATERIAL_ALPHATEST,i.PBRMATERIAL_ALPHABLEND=V.c.PBRMATERIAL_ALPHABLEND,i.PBRMATERIAL_ALPHATESTANDBLEND=V.c.PBRMATERIAL_ALPHATESTANDBLEND,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=V.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"directIntensity",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveIntensity",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentIntensity",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularIntensity",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"disableBumpMap",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"baseWeightTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"baseDiffuseRoughnessTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureStrength",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallic",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicF0Factor",void 0),(0,k.d)([(0,N.m)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceColor",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicReflectanceTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectanceTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurfaceTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),(0,k.d)([(0,N.A)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),(0,k.d)([(0,N.m)("ambient"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientColor",void 0),(0,k.d)([(0,N.m)("albedo"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoColor",void 0),(0,k.d)([(0,N.H)("baseWeight"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"baseWeight",void 0),(0,k.d)([(0,N.H)("baseDiffuseRoughness"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"baseDiffuseRoughness",void 0),(0,k.d)([(0,N.m)("reflectivity"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityColor",void 0),(0,k.d)([(0,N.m)("reflection"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionColor",void 0),(0,k.d)([(0,N.m)("emissive"),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurface",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"useAlphaFromAlbedoTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"forceAlphaTest",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"alphaCutOff",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientInGrayScale",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,k.d)([(0,N.H)()],i.prototype,"usePhysicalLightFalloff",null),(0,k.d)([(0,N.H)()],i.prototype,"useGLTFLightFalloff",null),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOverAlpha",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"parallaxScaleBias",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceIrradianceInFragment",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFresnel",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLinearAlphaFresnel",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentBRDFTexture",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceNormalForward",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableSpecularAntiAliasing",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useHorizonOcclusion",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOcclusion",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],i.prototype,"unlit",void 0),(0,k.d)([(0,N.H)(),(0,N.e)("_markAllSubMeshesAsMiscDirty")],i.prototype,"applyDecalMapAfterDetailMap",void 0),(0,p.g)("BABYLON.PBRMaterial",i)},11144:(Z,c,L)=>{L.d(c,{e:()=>G});var k=L(11052);const N=new Map;function R(Z,c){(function(Z){return N.delete(Z)})(Z)&&k.e.Warn(`Extension with the name '${Z}' already exists`),N.set(Z,c)}function G(Z,c){"image/ktx"!==c&&"image/ktx2"!==c||(Z=".ktx"),N.has(Z)||(Z.endsWith(".ies")&&R(".ies",(async()=>await L.e(28).then(L.bind(L,13566)).then((Z=>new Z._IESTextureLoader)))),Z.endsWith(".dds")&&R(".dds",(async()=>await L.e(25).then(L.bind(L,13574)).then((Z=>new Z._DDSTextureLoader)))),Z.endsWith(".basis")&&R(".basis",(async()=>await L.e(29).then(L.bind(L,13580)).then((Z=>new Z._BasisTextureLoader)))),Z.endsWith(".env")&&R(".env",(async()=>await Promise.all([L.e(24),L.e(30)]).then(L.bind(L,13586)).then((Z=>new Z._ENVTextureLoader)))),Z.endsWith(".hdr")&&R(".hdr",(async()=>await L.e(31).then(L.bind(L,13588)).then((Z=>new Z._HDRTextureLoader)))),(Z.endsWith(".ktx")||Z.endsWith(".ktx2"))&&(R(".ktx",(async()=>await L.e(32).then(L.bind(L,13597)).then((Z=>new Z._KTXTextureLoader)))),R(".ktx2",(async()=>await L.e(32).then(L.bind(L,13597)).then((Z=>new Z._KTXTextureLoader))))),Z.endsWith(".tga")&&R(".tga",(async()=>await L.e(33).then(L.bind(L,13600)).then((Z=>new Z._TGATextureLoader)))),Z.endsWith(".exr")&&R(".exr",(async()=>await L.e(34).then(L.bind(L,13607)).then((Z=>new Z._ExrTextureLoader)))));const k=N.get(Z);return k?Promise.resolve(k(c)):null}},11487:(Z,c,L)=>{L.d(c,{d:()=>t});var k=L(11170),N=L(11173),R=L(11027),G=L(10993),V=L(11023),p=L(11155),J=(L(11081),L(11480));class z{get wrapU(){return this._wrapU}set wrapU(Z){this._wrapU=Z}get wrapV(){return this._wrapV}set wrapV(Z){this._wrapV=Z}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(Z){this._texture&&(this._texture.isCube=Z)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(Z){this._texture&&(this._texture.is3D=Z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(Z){this._texture&&(this._texture.is2DArray=Z)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(Z){return void 0!==(null===Z||void 0===Z?void 0:Z.shareDepth)}constructor(Z){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=J.e.Zero(),this._cachedBaseSize=J.e.Zero(),this._initialSamplingMode=2,this._texture=z._IsRenderTargetWrapper(Z)?Z.texture:Z,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(Z){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(Z,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var i=L(11242);class t extends z{set Oc(Z){this._hasAlpha!==Z&&(this._hasAlpha=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))))}get Oc(){return this._hasAlpha}set getAlphaFromRGB(Z){this._getAlphaFromRGB!==Z&&(this._getAlphaFromRGB=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(Z){this._coordinatesIndex!==Z&&(this._coordinatesIndex=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(Z){this._coordinatesMode!==Z&&(this._coordinatesMode=Z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(Z){this._wrapU=Z}get wrapV(){return this._wrapV}set wrapV(Z){this._wrapV=Z}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(Z){this._texture?this._texture.isCube=Z:this._isCube=Z}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(Z){this._texture&&(this._texture.is3D=Z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(Z){this._texture&&(this._texture.is2DArray=Z)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(Z){var c;if(this._texture){if(this._texture._gammaSpace===Z)return;this._texture._gammaSpace=Z}else{if(this._gammaSpace===Z)return;this._gammaSpace=Z}null===(c=this.XZ())||void 0===c||c.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(Z){var c;Z!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=Z),null===(c=this.XZ())||void 0===c||c.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(Z){this._texture&&(this._texture._lodGenerationOffset=Z)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(Z){this._texture&&(this._texture._lodGenerationScale=Z)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(Z){this._texture&&(this._texture._linearSpecularLOD=Z)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(Z){this._texture&&(this._texture._irradianceTexture=Z)}get uid(){return this._uid||(this._uid=(0,p.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Xc=new R.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,Z?t._IsScene(Z)?this._scene=Z:this._engine=Z:this._scene=V.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=c,this._uid=null}XZ(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return G.b.IdentityReadOnly}getReflectionTextureMatrix(){return G.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(Z){}get canRescale(){return!1}_getFromCache(Z,c,L,k,N,R){const G=this._getEngine();if(!G)return null;const V=G._getUseSRGBBuffer(!!N,c),p=G.getLoadedTexturesCache();for(let J=0;J<p.length;J++){const G=p[J];if((void 0===N||V===G._useSRGBBuffer)&&(void 0===k||k===G.invertY)&&G.url===Z&&G.generateMipMaps===!c&&(!L||L===G.samplingMode)&&(void 0===R||R===G.isCube))return G.incrementReferences(),G}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const Z=this.XZ();Z&&Z.markAllMaterialsAsDirty(1)}readPixels(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const J=this._getEngine();if(!J)return null;const z=this.getSize();let i=z.width,t=z.height;0!==c&&(i/=Math.pow(2,c),t/=Math.pow(2,c),i=Math.round(i),t=Math.round(t)),V=Math.min(i,V),p=Math.min(t,p);try{return this._texture.isCube?J._readTexturePixels(this._texture,V,p,Z,c,L,k,N,R,G):J._readTexturePixels(this._texture,V,p,-1,c,L,k,N,R,G)}catch(E){return null}}_readPixelsSync(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const R=this.getSize();let G=R.width,V=R.height;const p=this._getEngine();if(!p)return null;0!=c&&(G/=Math.pow(2,c),V/=Math.pow(2,c),G=Math.round(G),V=Math.round(V));try{return this._texture.isCube?p._readTexturePixelsSync(this._texture,G,V,Z,c,L,k,N):p._readTexturePixelsSync(this._texture,G,V,-1,c,L,k,N)}catch(J){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const Z=this._scene.textures.indexOf(this);if(Z>=0&&this._scene.textures.splice(Z,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const Z=this._parentContainer.textures.indexOf(this);Z>-1&&this._parentContainer.textures.splice(Z,1),this._parentContainer=null}}this.Xc.notifyObservers(this),this.Xc.clear(),this.metadata=null,super.dispose()}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!Z)return null;const c=i.e.Serialize(this);return i.e.AppendSerializedAnimations(this,c),c}static WhenAllReady(Z,c){let L=Z.length;if(0!==L)for(let k=0;k<Z.length;k++){const N=Z[k];if(N.isReady())0===--L&&c();else{const Z=N.onLoadObservable;Z?Z.addOnce((()=>{0===--L&&c()})):0===--L&&c()}}else c()}static _IsScene(Z){return"Scene"===Z.getClassName()}}t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,k.d)([(0,N.H)()],t.prototype,"uniqueId",void 0),(0,k.d)([(0,N.H)()],t.prototype,"name",void 0),(0,k.d)([(0,N.H)()],t.prototype,"displayName",void 0),(0,k.d)([(0,N.H)()],t.prototype,"metadata",void 0),(0,k.d)([(0,N.H)("Oc")],t.prototype,"_hasAlpha",void 0),(0,k.d)([(0,N.H)("getAlphaFromRGB")],t.prototype,"_getAlphaFromRGB",void 0),(0,k.d)([(0,N.H)()],t.prototype,"level",void 0),(0,k.d)([(0,N.H)("coordinatesIndex")],t.prototype,"_coordinatesIndex",void 0),(0,k.d)([(0,N.H)()],t.prototype,"optimizeUVAllocation",void 0),(0,k.d)([(0,N.H)("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),(0,k.d)([(0,N.H)()],t.prototype,"wrapU",null),(0,k.d)([(0,N.H)()],t.prototype,"wrapV",null),(0,k.d)([(0,N.H)()],t.prototype,"wrapR",void 0),(0,k.d)([(0,N.H)()],t.prototype,"anisotropicFilteringLevel",void 0),(0,k.d)([(0,N.H)()],t.prototype,"isCube",null),(0,k.d)([(0,N.H)()],t.prototype,"is3D",null),(0,k.d)([(0,N.H)()],t.prototype,"is2DArray",null),(0,k.d)([(0,N.H)()],t.prototype,"gammaSpace",null),(0,k.d)([(0,N.H)()],t.prototype,"invertZ",void 0),(0,k.d)([(0,N.H)()],t.prototype,"lodLevelInAlpha",void 0),(0,k.d)([(0,N.H)()],t.prototype,"lodGenerationOffset",null),(0,k.d)([(0,N.H)()],t.prototype,"lodGenerationScale",null),(0,k.d)([(0,N.H)()],t.prototype,"linearSpecularLOD",null),(0,k.d)([(0,N.A)()],t.prototype,"irradianceTexture",null),(0,k.d)([(0,N.H)()],t.prototype,"isRenderTarget",void 0)},11674:(Z,c,L)=>{var k=L(11683),N=L(11487);N.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(N.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=k.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Z=>{this._texture._sphericalPolynomial=Z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Z){this._texture&&(this._texture._sphericalPolynomial=Z)},enumerable:!0,configurable:!0})},11139:(Z,c,L)=>{L.d(c,{e:()=>G});var k,N=L(11027),R=L(11142);!function(Z){Z[Z.Unknown=0]="Unknown",Z[Z.Url=1]="Url",Z[Z.Temp=2]="Temp",Z[Z.Raw=3]="Raw",Z[Z.Dynamic=4]="Dynamic",Z[Z.RenderTarget=5]="RenderTarget",Z[Z.MultiRenderTarget=6]="MultiRenderTarget",Z[Z.Cube=7]="Cube",Z[Z.CubeRaw=8]="CubeRaw",Z[Z.CubePrefiltered=9]="CubePrefiltered",Z[Z.Raw3D=10]="Raw3D",Z[Z.Raw2DArray=11]="Raw2DArray",Z[Z.DepthStencil=12]="DepthStencil",Z[Z.CubeRawRGBD=13]="CubeRawRGBD",Z[Z.Depth=14]="Depth"}(k||(k={}));class G extends R.d{get useMipMaps(){return this.generateMipMaps}set useMipMaps(Z){this.generateMipMaps=Z}get uniqueId(){return this._uniqueId}_setUniqueId(Z){this._uniqueId=Z}getEngine(){return this._engine}get source(){return this._source}constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new N.b,this.onErrorObservable=new N.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=Z,this._source=c,this._uniqueId=G._Counter++,L||(this._hardwareTexture=Z._createHardwareTexture())}incrementReferences(){this._references++}updateSize(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,Z,c,L),this.width=Z,this.height=c,this.depth=L,this.baseWidth=Z,this.baseHeight=c,this.baseDepth=L,this._size=Z*c*L}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const Z=this.onRebuildCallback(this),c=c=>{c._swapAndDie(this,!1),this.isReady=Z.isReady};return void(Z.isAsync?Z.proxy.then(c):c(Z.proxy))}let Z;switch(this.source){case 2:case 12:case 14:break;case 1:return void(Z=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(Z=>{Z._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:Z=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),Z._swapAndDie(this,!1),this.isReady=!0;break;case 10:Z=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),Z._swapAndDie(this,!1),this.isReady=!0;break;case 11:Z=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),Z._swapAndDie(this,!1),this.isReady=!0;break;case 4:Z=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),Z._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(Z=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{Z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:Z=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),Z._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return Z=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(Z=>{Z&&Z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(Z._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(Z){var c;let L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(c=this._hardwareTexture)||void 0===c||c.setUsage(Z._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),Z._hardwareTexture=this._hardwareTexture,L&&(Z._isRGBD=this._isRGBD),this._lodTextureHigh&&(Z._lodTextureHigh&&Z._lodTextureHigh.dispose(),Z._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(Z._lodTextureMid&&Z._lodTextureMid.dispose(),Z._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(Z._lodTextureLow&&Z._lodTextureLow.dispose(),Z._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(Z._irradianceTexture&&Z._irradianceTexture.dispose(),Z._irradianceTexture=this._irradianceTexture);const k=this._engine.getLoadedTexturesCache();let N=k.indexOf(this);-1!==N&&k.splice(N,1),N=k.indexOf(Z),-1===N&&k.push(Z)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}G._Counter=0},11544:(Z,c,L)=>{L.d(c,{e:()=>N});var k=L(11508);class N extends k.c{constructor(Z,c,L,N,R){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,z=arguments.length>9?arguments[9]:void 0,i=arguments.length>10?arguments[10]:void 0,t=arguments.length>11?arguments[11]:void 0;super(null,R,!G,V,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,z),this.format=N,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==J||(p=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==J||(p=1),this._texture=this._engine.createRawTexture(Z,c,L,N,G,V,p,null,J,z??0,i??!1),this.wrapU=k.c.CLAMP_ADDRESSMODE,this.wrapV=k.c.CLAMP_ADDRESSMODE,this._waitingForData=!!t&&!Z)}update(Z){this._getEngine().updateRawTexture(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const Z=new N(null,this.getSize().width,this.getSize().height,this.format,this.XZ(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return Z._texture=this._texture,this._texture.incrementReferences(),Z}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(Z,c,L,k){return new N(Z,c,L,1,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(Z,c,L,k){return new N(Z,c,L,2,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(Z,c,L,k){return new N(Z,c,L,0,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(Z,c,L,k){return new N(Z,c,L,4,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(Z,c,L,k){return new N(Z,c,L,5,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(Z,c,L,k){return new N(Z,c,L,5,k,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(Z,c,L,R){let G=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.c.TRILINEAR_SAMPLINGMODE;return new N(Z,c,L,6,R,G,V,p,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(Z,c,L,R){let G=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.c.TRILINEAR_SAMPLINGMODE;return new N(Z,c,L,6,R,G,V,p,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11517:(Z,c,L)=>{L.d(c,{b:()=>E});var k=L(11027),N=L(10993),R=L(11508),G=L(11524),V=L(11159),p=L(11116),J=L(11052),z=L(11526),i=L(11008);class t{get renderList(){return this._renderList}set renderList(Z){this._renderList!==Z&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),Z&&(this._unObserveRenderList=(0,i.h)(Z,this._renderListHasChanged)),this._renderList=Z)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(Z){Z!==this._disableImageProcessing&&(this._disableImageProcessing=Z,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(Z){if(this._name===Z)return;if(this._name=Z,!this._scene)return;const c=this._scene.getEngine();for(let L=0;L<this._renderPassIds.length;++L){const Z=this._renderPassIds[L];c._renderPassNames[Z]=`${this._name}#${L}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(Z,c){let L;L=Array.isArray(Z)?Z:[Z];for(let k=0;k<L.length;++k)for(let Z=0;Z<this.options.numPasses;++Z){let N=L[k];L[k].isAnInstance&&(N=L[k].sourceMesh),N.setMaterialForRenderPass(this._renderPassIds[Z],void 0!==c?Array.isArray(c)?c[Z]:c:void 0)}}constructor(Z,c,L){this._unObserveRenderList=null,this._renderListHasChanged=(Z,c)=>{const L=this._renderList?this._renderList.length:0;if(0===c&&L>0||0===L)for(const k of this._scene.meshes)k._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new k.b,this.onAfterRenderObservable=new k.b,this.onBeforeRenderingManagerRenderObservable=new k.b,this.onAfterRenderingManagerRenderObservable=new k.b,this.onFastPathRenderObservable=new k.b,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=Z,this._scene=c,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...L},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new z.c(c),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const Z=this._scene.getEngine();for(let c=0;c<this.options.numPasses;++c)Z.releaseRenderPassId(this._renderPassIds[c]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const Z=this._scene.getEngine();for(let c=0;c<this.options.numPasses;++c)this._renderPassIds[c]=Z.createRenderPassId(`${this.name}#${c}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(Z){this._refreshRate=Z,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(Z,c){this.prepareRenderList(),this.initRender(Z,c);const L=this._checkReadiness();return this.finishRender(),L}prepareRenderList(){const Z=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let c=0;c<this._waitingRenderList.length;c++){const L=this._waitingRenderList[c],k=Z.getMeshById(L);k&&this.renderList.push(k)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const Z=this._scene.meshes;for(let c=0;c<Z.length;c++){const L=Z[c];this.renderListPredicate(L)&&this.renderList.push(L)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(Z,c){const L=this._scene.getEngine(),k=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,k&&(k!==this._scene.activeCamera&&(this._scene.setTransformMatrix(k.getViewMatrix(),k.getProjectionMatrix(!0)),this._scene.activeCamera=k),L.setViewport(k.rigParent?k.rigParent.viewport:k.viewport,Z,c)),this._defaultRenderListPrepared=!1}finishRender(){const Z=this._scene;this._disableImageProcessing&&(Z.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),Z.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==Z.activeCamera&&Z.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),Z.getEngine().setViewport(this._currentSceneCamera.viewport)),Z.resetCachedMaterial()}render(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this._scene,k=L.getEngine(),N=k.currentRenderPassId;k.currentRenderPassId=this._renderPassIds[Z],this.onBeforeRenderObservable.notifyObservers(Z);if(k.snapshotRendering&&1===k.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(Z);else{let c=null;const k=this.renderList?this.renderList:L.getActiveMeshes().data,N=this.renderList?this.renderList.length:L.getActiveMeshes().length;this.getCustomRenderList&&(c=this.getCustomRenderList(Z,k,N)),c?this._prepareRenderingManager(c,c.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(k,N,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),c=k),this.onBeforeRenderingManagerRenderObservable.notifyObservers(Z),this._renderingManager.render(this.customRenderFunction,c,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(Z)}c||this.onAfterRenderObservable.notifyObservers(Z),k.currentRenderPassId=N}_checkReadiness(){const Z=this._scene,c=Z.getEngine(),L=c.currentRenderPassId;let k=!0;Z.getViewMatrix()||Z.updateTransformMatrix();const N=this.options.numPasses;for(let G=0;G<N&&k;G++){let L=null;const R=this.renderList?this.renderList:Z.getActiveMeshes().data,V=this.renderList?this.renderList.length:Z.getActiveMeshes().length;c.currentRenderPassId=this._renderPassIds[G],this.onBeforeRenderObservable.notifyObservers(G),this.getCustomRenderList&&(L=this.getCustomRenderList(G,R,V)),L||(L=R),this.options.doNotChangeAspectRatio||Z.updateTransformMatrix(!0);for(let Z=0;Z<L.length&&k;++Z){const c=L[Z];if(c.isEnabled()&&!c.isBlocked&&c.isVisible&&c.ec)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!0)){k=!1;continue}}else if(!c.isReady(!0)){k=!1;continue}}this.onAfterRenderObservable.notifyObservers(G),N>1&&(Z.incrementRenderId(),Z.resetCachedMaterial())}const R=this.particleSystemList||Z.si;for(const G of R)G.isReady()||(k=!1);return c.currentRenderPassId=L,k}_prepareRenderingManager(Z,c,L){const k=this._scene,N=k.activeCamera,R=this.cameraForLOD??N;this._renderingManager.reset();const G=k.getRenderId(),V=k.getFrameId();for(let J=0;J<c;J++){const c=Z[J];if(c&&!c.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!c.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let Z,p=null;if(R){const Z=c._internalAbstractMeshDataInfo._currentLOD.get(R);Z&&Z[1]===V?p=Z[0]:(p=k.customLODSelector?k.customLODSelector(c,R):c.getLOD(R),Z?(Z[0]=p,Z[1]=V):c._internalAbstractMeshDataInfo._currentLOD.set(R,[p,V]))}else p=c;if(!p)continue;if(p!==c&&0!==p.billboardMode&&p.Jc(),p._preActivateForIntermediateRendering(G),Z=!(!L||!N)&&0===(c.layerMask&N.layerMask),c.isEnabled()&&c.isVisible&&c.ec&&!Z){if(p!==c&&p._activate(G,!0),c._activate(G,!0)&&c.ec.length){c.isAnInstance?c._internalAbstractMeshDataInfo._actAsRegularMesh&&(p=c):p._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,p._internalAbstractMeshDataInfo._isActiveIntermediate=!0,k._prepareSkeleton(p);for(let Z=0;Z<p.ec.length;Z++){const c=p.ec[Z];this._renderingManager.dispatch(c,p)}}c._postActivate()}}}const p=this.particleSystemList||k.si;for(let J=0;J<p.length;J++){const Z=p[J],c=Z.j;Z.isStarted()&&c&&(!c.position||c.isEnabled())&&this._renderingManager.dispatchParticles(Z)}}setRenderingOrder(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(Z,c,L,k)}setRenderingAutoClearDepthStencil(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(Z,c,L,k),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const Z=new t(this.name,this._scene,this.options);return this.renderList&&(Z.renderList=this.renderList.slice(0)),Z}dispose(){const Z=this.renderList?this.renderList:this._scene.getActiveMeshes().data,c=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let L=0;L<c;L++){const c=Z[L];c&&void 0!==c.getMaterialForRenderPass(this.renderPassId)&&c.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,p.d.prototype.setDepthStencilTexture=function(Z,c){this._engine.setDepthStencilTexture(this._samplers[Z],this._uniforms[Z],c,Z)};class E extends R.c{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(Z){this._objectRenderer.renderListPredicate=Z}get renderList(){return this._objectRenderer.renderList}set renderList(Z){this._objectRenderer.renderList=Z}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(Z){this._objectRenderer.particleSystemList=Z}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(Z){this._objectRenderer.getCustomRenderList=Z}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(Z){this._objectRenderer.renderParticles=Z}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(Z){this._objectRenderer.renderSprites=Z}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(Z){this._objectRenderer.forceLayerMaskCheck=Z}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(Z){this._objectRenderer.activeCamera=Z}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(Z){this._objectRenderer.cameraForLOD=Z}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(Z){this._objectRenderer.disableImageProcessing=Z}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(Z){this._objectRenderer.customIsReadyFunction=Z}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(Z){this._objectRenderer.customRenderFunction=Z}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(Z){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(Z)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z)}set onClear(Z){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(Z)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(Z){this._objectRenderer._waitingRenderList=Z}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(Z,c){this._objectRenderer.setMaterialForRendering(Z,c)}get isMulti(){var Z;return(null===(Z=this._renderTarget)||void 0===Z?void 0:Z.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const c=this.XZ();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var Z;return(null===(Z=this._renderTarget)||void 0===Z?void 0:Z._depthStencilTexture)??null}constructor(Z,c,L){let G,V,p=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:R.c.TRILINEAR_SAMPLINGMODE,q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],O=arguments.length>9&&void 0!==arguments[9]&&arguments[9],w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,P=arguments.length>12&&void 0!==arguments[12]&&arguments[12],j=arguments.length>13?arguments[13]:void 0,o=arguments.length>14?arguments[14]:void 0,u=arguments.length>15&&void 0!==arguments[15]&&arguments[15],X=arguments.length>16&&void 0!==arguments[16]&&arguments[16],h=!0;if("object"===typeof p){const Z=p;p=!!Z.generateMipMaps,z=Z.doNotChangeAspectRatio??!0,i=Z.type??0,E=!!Z.isCube,x=Z.samplingMode??R.c.TRILINEAR_SAMPLINGMODE,q=Z.generateDepthBuffer??!0,O=!!Z.generateStencilBuffer,w=!!Z.isMulti,M=Z.format??5,P=!!Z.delayAllocation,j=Z.samples,o=Z.creationFlags,u=!!Z.noColorAttachment,X=!!Z.useSRGBBuffer,G=Z.colorAttachment,h=Z.gammaSpace??h,V=Z.existingObjectRenderer}if(super(null,L,!p,void 0,x,void 0,void 0,void 0,void 0,M),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new k.b,this.onAfterUnbindObservable=new k.b,this.onClearObservable=new k.b,this.onResizeObservable=new k.b,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=N.h.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(L=this.XZ()))return;const B=this.XZ().getEngine();this._gammaSpace=h,this._coordinatesMode=R.c.PROJECTION_MODE,this.name=Z,this.isRenderTarget=!0,this._initialSizeParameter=c,this._dontDisposeObjectRenderer=!!V,this._processSizeParameter(c),this._objectRenderer=V??new t(Z,L,{numPasses:E?6:this.getRenderLayers()||1,doNotChangeAspectRatio:z}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const Z of this._scene._beforeRenderTargetClearStage)Z.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(B):this.skipInitialClear||B.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const Z of this._scene._beforeRenderTargetDrawStage)Z.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var Z;if(!this._disableEngineStages)for(const L of this._scene._afterRenderTargetDrawStage)L.action(this,this._currentFaceIndex,this._currentLayer);const c=(null===(Z=this._texture)||void 0===Z?void 0:Z.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const L of this._scene._afterRenderTargetPostProcessStage)L.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=c),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),B):J.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(B):this.skipInitialClear||B.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=B.onResizeObservable.add((()=>{})),this._generateMipMaps=!!p,this._doNotChangeAspectRatio=z,w||(this._renderTargetOptions={generateMipMaps:p,type:i,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:q,generateStencilBuffer:O,samples:j,creationFlags:o,noColorAttachment:u,useSRGBBuffer:X,colorAttachment:G,label:this.name},this.samplingMode===R.c.NEAREST_SAMPLINGMODE&&(this.wrapU=R.c.CLAMP_ADDRESSMODE,this.wrapV=R.c.CLAMP_ADDRESSMODE),P||(E?(this._renderTarget=L.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=R.c.INVCUBIC_MODE,this._textureMatrix=N.b.Identity()):this._renderTarget=L.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==j&&(this.samples=j)))}createDepthStencilTexture(){var Z;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,G=arguments.length>5?arguments[5]:void 0;null===(Z=this._renderTarget)||void 0===Z||Z.createDepthStencilTexture(c,L,k,N,R,G)}_processSizeParameter(Z){if(Z.ratio){this._sizeRatio=Z.ratio;const c=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(c.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(c.getRenderHeight(),this._sizeRatio)}}else this._size=Z}get samples(){var Z;return(null===(Z=this._renderTarget)||void 0===Z?void 0:Z.samples)??this._samples}set samples(Z){this._renderTarget&&(this._samples=this._renderTarget.setSamples(Z))}addPostProcess(Z){if(!this._postProcessManager){const Z=this.XZ();if(!Z)return;this._postProcessManager=new G.c(Z),this._postProcesses=new Array}this._postProcesses.push(Z),this._postProcesses[0].wi=!1}clearPostProcesses(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(Z)for(const Z of this._postProcesses)Z.dispose();this._postProcesses=[]}}removePostProcess(Z){if(!this._postProcesses)return;const c=this._postProcesses.indexOf(Z);-1!==c&&(this._postProcesses.splice(c,1),this._postProcesses.length>0&&(this._postProcesses[0].wi=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(Z){this._objectRenderer.refreshRate=Z}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const Z=this._size.layers;if(Z)return Z;const c=this._size.depth;return c||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(Z){const c=Math.max(1,this.getRenderSize()*Z);this.resize(c)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(Z){var c;const L=this.isCube;null===(c=this._renderTarget)||void 0===c||c.dispose(),this._renderTarget=null;const k=this.XZ();k&&(this._processSizeParameter(Z),this._renderTarget=L?k.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):k.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(Z,c)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(L.bind(L,11556)).then((Z=>this._dumpTools=Z))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const Z=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),Z}_render(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this.XZ();if(L){if(void 0!==this.useCameraPostProcesses&&(Z=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let k=0;k<6;k++)this._renderToTarget(k,Z,c),L.incrementRenderId(),L.resetCachedMaterial();else this._renderToTarget(0,Z,c);else for(let k=0;k<this.getRenderLayers();k++)this._renderToTarget(0,Z,c,k),L.incrementRenderId(),L.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(Z,c){const L=Z*c,k=(0,V.n)(L+16384/(128+L));return Math.min((0,V.e)(Z),k)}_bindFrameBuffer(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.XZ();if(!L)return;const k=L.getEngine();this._renderTarget&&k.bindFramebuffer(this._renderTarget,this.isCube?Z:void 0,void 0,void 0,this.ignoreCameraViewport,0,c)}_unbindFrameBuffer(Z,c){this._renderTarget&&Z.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(c)}))}_prepareFrame(Z,c,L,k){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(c,L):k&&Z.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(c,L)}_renderToTarget(Z,c,L){var k,N;let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const G=this.XZ();if(!G)return;const V=G.getEngine();this._currentFaceIndex=Z,this._currentLayer=R,this._currentUseCameraPostProcess=c,this._currentDumpForDebug=L,this._prepareFrame(G,Z,R,c),null===(k=V._debugPushGroup)||void 0===k||k.call(V,`render to face #${Z} layer #${R}`,2),this._objectRenderer.render(Z+R,!0),null===(N=V._debugPopGroup)||void 0===N||N.call(V,2),this._unbindFrameBuffer(V,Z),this._texture&&this.isCube&&5===Z&&V.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(Z,c,L,k)}setRenderingAutoClearDepthStencil(Z,c){this._objectRenderer.setRenderingAutoClearDepthStencil(Z,c)}clone(){const Z=this.getSize(),c=new E(this.name,Z,this.XZ(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return c.Oc=this.Oc,c.level=this.level,c.coordinatesMode=this.coordinatesMode,this.renderList&&(c.renderList=this.renderList.slice(0)),c}serialize(){if(!this.name)return null;const Z=super.serialize();if(Z.renderTargetSize=this.getRenderSize(),Z.renderList=[],this.renderList)for(let c=0;c<this.renderList.length;c++)Z.renderList.push(this.renderList[c].id);return Z}disposeFramebufferObjects(){var Z;null===(Z=this._renderTarget)||void 0===Z||Z.dispose(!0)}releaseInternalTexture(){var Z;null===(Z=this._renderTarget)||void 0===Z||Z.releaseTextures(),this._texture=null}dispose(){var Z;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.XZ().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const c=this.XZ();if(!c)return;let L=c.customRenderTargets.indexOf(this);L>=0&&c.customRenderTargets.splice(L,1);for(const k of c.cameras)L=k.customRenderTargets.indexOf(this),L>=0&&k.customRenderTargets.splice(L,1);null===(Z=this._renderTarget)||void 0===Z||Z.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}E.REFRESHRATE_RENDER_ONCE=t.REFRESHRATE_RENDER_ONCE,E.REFRESHRATE_RENDER_ONEVERYFRAME=t.REFRESHRATE_RENDER_ONEVERYFRAME,E.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,R.c._CreateRenderTargetTexture=(Z,c,L,k,N)=>new E(Z,c,L,k)},11508:(Z,c,L)=>{L.d(c,{c:()=>P});var k=L(11170),N=L(11173),R=L(11027),G=L(10993),V=L(11487),p=L(11012),J=L(11070),z=L(11108),i=L(11153),t=L(11239),E=L(11090);function x(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=c.width,N=c.height;if(Z instanceof Float32Array){let c=Z.byteLength/Z.BYTES_PER_ELEMENT;const L=new Uint8Array(c);for(;--c>=0;){let k=Z[c];k<0?k=0:k>1&&(k=1),L[c]=255*k}Z=L}const R=document.createElement("canvas");R.width=k,R.height=N;const G=R.getContext("2d");if(!G)return null;const V=G.createImageData(k,N);if(V.data.set(Z),G.putImageData(V,0,0),L){const Z=document.createElement("canvas");Z.width=k,Z.height=N;const c=Z.getContext("2d");return c?(c.translate(0,N),c.scale(1,-1),c.drawImage(R,0,0),Z.toDataURL("image/png")):null}return R.toDataURL("image/png")}function q(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const k=Z.getInternalTexture();if(!k)return null;const N=Z._readPixelsSync(c,L);return N?x(N,Z.getSize(),k.invertY):null}async function O(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const k=Z.getInternalTexture();if(!k)return null;const N=await Z.readPixels(c,L);return N?x(N,Z.getSize(),k.invertY):null}var w=L(11371),M=L(11242);class P extends V.d{static _CreateVideoTexture(Z,c,L){arguments.length>5&&void 0!==arguments[5]||P.TRILINEAR_SAMPLINGMODE;throw(0,J.e)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(Z){this._isBlocking=Z}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(Z,c,L,k){let N,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P.TRILINEAR_SAMPLINGMODE,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9?arguments[9]:void 0,E=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0,O=arguments.length>13?arguments[13]:void 0;super(c),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new R.b,this._isBlocking=!0,this.name=Z||"",this.url=Z;let M=!1,j=null,o=!0;"object"===typeof L&&null!==L?(N=L.noMipmap??!1,k=L.invertY??!w.b,G=L.samplingMode??P.TRILINEAR_SAMPLINGMODE,V=L.v??null,p=L.onError??null,J=L.buffer??null,i=L.deleteBuffer??!1,t=L.format,E=L.mimeType,x=L.loaderOptions,q=L.creationFlags,M=L.useSRGBBuffer??!1,j=L.internalTexture??null,o=L.gammaSpace??o,O=L.forcedExtension??O):N=!!L,this._gammaSpace=o,this._noMipmap=N,this._invertY=void 0===k?!w.b:k,this._initialSamplingMode=G,this._buffer=J,this._deleteBuffer=i,this._mimeType=E,this._loaderOptions=x,this._creationFlags=q,this._useSRGBBuffer=M,this._forcedExtension=O,void 0!==t&&(this._format=t);const u=this.XZ(),X=this._getEngine();if(!X)return;X.onBeforeTextureInitObservable.notifyObservers(this);const h=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),V&&V(),!this.isBlocking&&u&&u.resetCachedMaterial()},B=(Z,c)=>{this._loadingError=!0,this._errorObject={message:Z,exception:c},p&&p(Z,c),P.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!j)return this._delayedOnLoad=h,void(this._delayedOnError=B);if(this._texture=j??this._getFromCache(this.url,N,G,this._invertY,M,this.isCube),this._texture)if(this._texture.isReady)z.b.SetImmediate((()=>h()));else{const Z=this._texture.onLoadedObservable.add(h);this._texture.onErrorObservable.add((c=>{var L;B(c.message,c.exception),null===(L=this._texture)||void 0===L||L.onLoadedObservable.remove(Z)}))}else if(u&&u.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=B;else{try{this._texture=X.createTexture(this.url,N,this._invertY,u,G,h,B,this._buffer,void 0,this._format,this._forcedExtension,E,x,q,M)}catch(D){throw B("error loading",D),D}i&&(this._buffer=null)}}updateURL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.XZ().markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,this._buffer=c,this._forcedExtension=k,this.delayLoadState=4,L&&(this._delayedOnLoad=L),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const Z=this.XZ();Z&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?z.b.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=Z.getEngine().createTexture(this.url,this._noMipmap,this._invertY,Z,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(Z,c,L,k){Z*=this._cachedUScale,c*=this._cachedVScale,Z-=this.uRotationCenter*this._cachedUScale,c-=this.vRotationCenter*this._cachedVScale,L-=this.wRotationCenter,G.h.TransformCoordinatesFromFloatsToRef(Z,c,L,this._rowGenerationMatrix,k),k.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,k.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,k.z+=this.wRotationCenter}getTextureMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*Z===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*Z,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=G.b.Zero(),this._rowGenerationMatrix=new G.b,this._t0=G.h.Zero(),this._t1=G.h.Zero(),this._t2=G.h.Zero()),G.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(G.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,G.d.Matrix[0]),G.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,G.d.Matrix[1]),G.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,G.d.Matrix[2]),G.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,G.d.Matrix[3]),G.d.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(G.d.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(G.d.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(G.d.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.sz(this._t0),this._t2.sz(this._t0),G.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const c=this.XZ();if(!c)return this._cachedTextureMatrix;const L=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&L!==this._cachedIdentity3x2&&c.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const Z=this.XZ();if(!Z)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==P.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===Z.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=G.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=G.b.Zero());const c=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case P.PLANAR_MODE:G.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case P.PROJECTION_MODE:{G.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const c=Z.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=c.updateFlag,c.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:G.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return c&&Z.markAllMaterialsAsDirty(1,(Z=>Z.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const Z={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,v:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return M.e.Clone((()=>new P(this._texture?this._texture.url:null,this.XZ(),Z)),this)}serialize(){var Z;const c=this.name;P.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const L=super.serialize(P._SerializeInternalTextureUniqueId);if(!L)return null;if(P.SerializeBuffers||P.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))L.base64String=this._buffer,L.name=L.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const Z=this.mimeType||"image/png";L.base64String=`data:${Z};base64,${(0,E.h)(this._buffer)}`}else(P.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(L.base64String=!this._engine||this._engine._features.supportSyncTextureRead?q(this):O(this));var k;(L.invertY=this._invertY,L.samplingMode=this.samplingMode,L._creationFlags=this._creationFlags,L._useSRGBBuffer=this._useSRGBBuffer,P._SerializeInternalTextureUniqueId)&&(L.internalTextureUniqueId=null===(k=this._texture)||void 0===k?void 0:k.uniqueId);return L.internalTextureLabel=null===(Z=this._texture)||void 0===Z?void 0:Z.label,L.noMipmap=this._noMipmap,this.name=c,L}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(Z,c,L){if(Z.customType){const k=i.d.Instantiate(Z.customType).Parse(Z,c,L);return Z.samplingMode&&k.updateSamplingMode&&k._samplingMode&&k._samplingMode!==Z.samplingMode&&k.updateSamplingMode(Z.samplingMode),k}if(Z.isCube&&!Z.isRenderTarget)return P._CubeTextureParser(Z,c,L);const k=void 0!==Z.internalTextureUniqueId;if(!Z.name&&!Z.isRenderTarget&&!k)return null;let N;if(k){const L=c.getEngine().getLoadedTexturesCache();for(const c of L)if(c.uniqueId===Z.internalTextureUniqueId){N=c;break}}const R=c=>{if(c&&c._texture&&(c._texture._cachedWrapU=null,c._texture._cachedWrapV=null,c._texture._cachedWrapR=null),Z.samplingMode){const L=Z.samplingMode;c&&c.samplingMode!==L&&c.updateSamplingMode(L)}if(c&&Z.animations)for(let L=0;L<Z.animations.length;L++){const k=Z.animations[L],N=(0,p.d)("BABYLON.Animation");N&&c.animations.push(N.Parse(k))}c&&c._texture&&(k&&!N&&c._texture._setUniqueId(Z.internalTextureUniqueId),c._texture.label=Z.internalTextureLabel)};return M.e.Parse((()=>{let k=!0;if(Z.noMipmap&&(k=!1),Z.mirrorPlane){const L=P._CreateMirror(Z.name,Z.renderTargetSize,c,k);return L._waitingRenderList=Z.renderList,L.mirrorPlane=t.b.oc(Z.mirrorPlane),R(L),L}if(Z.isRenderTarget){let L=null;if(Z.isCube){if(c.reflectionProbes)for(let k=0;k<c.reflectionProbes.length;k++){const L=c.reflectionProbes[k];if(L.name===Z.name)return L.cubeTexture}}else L=P._CreateRenderTargetTexture(Z.name,Z.renderTargetSize,c,k,Z._creationFlags??0),L._waitingRenderList=Z.renderList;return R(L),L}if(Z.isVideo){const N=P._CreateVideoTexture(L+(Z.url||Z.name),L+(Z.src||Z.url),c,k,Z.invertY,Z.samplingMode,Z.settings||{});return R(N),N}{let G;if(Z.base64String&&!N)G=P.CreateFromBase64String(Z.base64String,Z.base64String,c,!k,Z.invertY,Z.samplingMode,(()=>{R(G)}),Z._creationFlags??0,Z._useSRGBBuffer??!1),G.name=Z.name;else{let V;V=Z.name&&(Z.name.indexOf("://")>0||Z.name.startsWith("data:"))?Z.name:L+Z.name,Z.url&&(Z.url.startsWith("data:")||P.UseSerializedUrlIfAny)&&(V=Z.url);const p={noMipmap:!k,invertY:Z.invertY,samplingMode:Z.samplingMode,v:()=>{R(G)},internalTexture:N};G=new P(V,c,p)}return G}}),Z,c)}static CreateFromBase64String(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:P.TRILINEAR_SAMPLINGMODE;return new P("data:"+c,L,k,N,R,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.TRILINEAR_SAMPLINGMODE,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,z=arguments.length>10?arguments[10]:void 0,i=arguments.length>11?arguments[11]:void 0;return"data:"!==Z.substring(0,5)&&(Z="data:"+Z),new P(Z,L,N,R,G,V,p,c,k,J,void 0,void 0,z,i)}}P.SerializeBuffers=!0,P.ForceSerializeBuffers=!1,P.OnTextureLoadErrorObservable=new R.b,P._SerializeInternalTextureUniqueId=!1,P._CubeTextureParser=(Z,c,L)=>{throw(0,J.e)("CubeTexture")},P._CreateMirror=(Z,c,L,k)=>{throw(0,J.e)("MirrorTexture")},P._CreateRenderTargetTexture=(Z,c,L,k,N)=>{throw(0,J.e)("RenderTargetTexture")},P.NEAREST_SAMPLINGMODE=1,P.NEAREST_NEAREST_MIPLINEAR=8,P.BILINEAR_SAMPLINGMODE=2,P.LINEAR_LINEAR_MIPNEAREST=11,P.TRILINEAR_SAMPLINGMODE=3,P.LINEAR_LINEAR_MIPLINEAR=3,P.NEAREST_NEAREST_MIPNEAREST=4,P.NEAREST_LINEAR_MIPNEAREST=5,P.NEAREST_LINEAR_MIPLINEAR=6,P.NEAREST_LINEAR=7,P.NEAREST_NEAREST=1,P.LINEAR_NEAREST_MIPNEAREST=9,P.LINEAR_NEAREST_MIPLINEAR=10,P.LINEAR_LINEAR=2,P.LINEAR_NEAREST=12,P.EXPLICIT_MODE=0,P.SPHERICAL_MODE=1,P.PLANAR_MODE=2,P.CUBIC_MODE=3,P.PROJECTION_MODE=4,P.SKYBOX_MODE=5,P.INVCUBIC_MODE=6,P.EQUIRECTANGULAR_MODE=7,P.FIXED_EQUIRECTANGULAR_MODE=8,P.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,P.CLAMP_ADDRESSMODE=0,P.WRAP_ADDRESSMODE=1,P.MIRROR_ADDRESSMODE=2,P.UseSerializedUrlIfAny=!1,(0,k.d)([(0,N.H)()],P.prototype,"url",void 0),(0,k.d)([(0,N.H)()],P.prototype,"uOffset",void 0),(0,k.d)([(0,N.H)()],P.prototype,"vOffset",void 0),(0,k.d)([(0,N.H)()],P.prototype,"uScale",void 0),(0,k.d)([(0,N.H)()],P.prototype,"vScale",void 0),(0,k.d)([(0,N.H)()],P.prototype,"uAng",void 0),(0,k.d)([(0,N.H)()],P.prototype,"vAng",void 0),(0,k.d)([(0,N.H)()],P.prototype,"wAng",void 0),(0,k.d)([(0,N.H)()],P.prototype,"uRotationCenter",void 0),(0,k.d)([(0,N.H)()],P.prototype,"vRotationCenter",void 0),(0,k.d)([(0,N.H)()],P.prototype,"wRotationCenter",void 0),(0,k.d)([(0,N.H)()],P.prototype,"homogeneousRotationInUVTransform",void 0),(0,k.d)([(0,N.H)()],P.prototype,"isBlocking",null),(0,p.g)("BABYLON.Texture",P),M.e._TextureParser=P.Parse},11423:(Z,c,L)=>{function k(Z){return 13===Z||14===Z||15===Z||16===Z||17===Z||18===Z||19===Z}function N(Z){return 13===Z||17===Z||18===Z||19===Z}L.d(c,{d:()=>N,h:()=>k})},11142:(Z,c,L)=>{L.d(c,{d:()=>k});class k{get wrapU(){return this._cachedWrapU}set wrapU(Z){this._cachedWrapU=Z}get wrapV(){return this._cachedWrapV}set wrapV(Z){this._cachedWrapV=Z}get wrapR(){return this._cachedWrapR}set wrapR(Z){this._cachedWrapR=Z}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(Z){this._cachedAnisotropicFilteringLevel=Z}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(Z){this._comparisonFunction=Z}get useMipMaps(){return this._useMipMaps}set useMipMaps(Z){this._useMipMaps=Z}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=Z,this._cachedWrapV=c,this._cachedWrapR=L,this._cachedAnisotropicFilteringLevel=k,this.samplingMode=N,this._comparisonFunction=R,this}compareSampler(Z){return this._cachedWrapU===Z._cachedWrapU&&this._cachedWrapV===Z._cachedWrapV&&this._cachedWrapR===Z._cachedWrapR&&this._cachedAnisotropicFilteringLevel===Z._cachedAnisotropicFilteringLevel&&this.samplingMode===Z.samplingMode&&this._comparisonFunction===Z._comparisonFunction&&this._useMipMaps===Z._useMipMaps}}},11268:(Z,c,L)=>{function k(Z){-1===Z.indexOf("vClipPlane")&&Z.push("vClipPlane"),-1===Z.indexOf("vClipPlane2")&&Z.push("vClipPlane2"),-1===Z.indexOf("vClipPlane3")&&Z.push("vClipPlane3"),-1===Z.indexOf("vClipPlane4")&&Z.push("vClipPlane4"),-1===Z.indexOf("vClipPlane5")&&Z.push("vClipPlane5"),-1===Z.indexOf("vClipPlane6")&&Z.push("vClipPlane6")}function N(Z,c,L){const k=!!(Z.clipPlane??c.clipPlane),N=!!(Z.clipPlane2??c.clipPlane2),R=!!(Z.clipPlane3??c.clipPlane3),G=!!(Z.clipPlane4??c.clipPlane4),V=!!(Z.clipPlane5??c.clipPlane5),p=!!(Z.clipPlane6??c.clipPlane6);k&&L.push("#define CLIPPLANE"),N&&L.push("#define CLIPPLANE2"),R&&L.push("#define CLIPPLANE3"),G&&L.push("#define CLIPPLANE4"),V&&L.push("#define CLIPPLANE5"),p&&L.push("#define CLIPPLANE6")}function R(Z,c,L){let k=!1;const N=!!(Z.clipPlane??c.clipPlane),R=!!(Z.clipPlane2??c.clipPlane2),G=!!(Z.clipPlane3??c.clipPlane3),V=!!(Z.clipPlane4??c.clipPlane4),p=!!(Z.clipPlane5??c.clipPlane5),J=!!(Z.clipPlane6??c.clipPlane6);return L.CLIPPLANE!==N&&(L.CLIPPLANE=N,k=!0),L.CLIPPLANE2!==R&&(L.CLIPPLANE2=R,k=!0),L.CLIPPLANE3!==G&&(L.CLIPPLANE3=G,k=!0),L.CLIPPLANE4!==V&&(L.CLIPPLANE4=V,k=!0),L.CLIPPLANE5!==p&&(L.CLIPPLANE5=p,k=!0),L.CLIPPLANE6!==J&&(L.CLIPPLANE6=J,k=!0),k}function G(Z,c,L){let k=c.clipPlane??L.clipPlane;V(Z,"vClipPlane",k),k=c.clipPlane2??L.clipPlane2,V(Z,"vClipPlane2",k),k=c.clipPlane3??L.clipPlane3,V(Z,"vClipPlane3",k),k=c.clipPlane4??L.clipPlane4,V(Z,"vClipPlane4",k),k=c.clipPlane5??L.clipPlane5,V(Z,"vClipPlane5",k),k=c.clipPlane6??L.clipPlane6,V(Z,"vClipPlane6",k)}function V(Z,c,L){L&&Z.setFloat4(c,L.kc.x,L.kc.y,L.kc.z,L.d)}L.d(c,{b:()=>k,e:()=>G,g:()=>R,h:()=>N})},11600:(Z,c,L)=>{function k(Z){Z.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}L.d(c,{c:()=>k})},11401:(Z,c,L)=>{function k(Z){return void 0===Z.getPipelineContext}L.d(c,{b:()=>k})},11230:(Z,c,L)=>{L.d(c,{d:()=>N});var k=L(11108);class N{static GetEffect(Z){return void 0===Z.getPipelineContext?Z.effect:Z}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=Z.createDrawContext(),c&&(this.materialContext=Z.createMaterialContext())}setEffect(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var k;(this.effect=Z,void 0!==c&&(this.defines=c),L)&&(null===(k=this.drawContext)||void 0===k||k.reset())}dispose(){var Z;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const Z=this.effect;c?Z.dispose():k.b.SetImmediate((()=>{Z.getEngine().onEndFrameObservable.addOnce((()=>{Z.dispose()}))})),this.effect=null}null===(Z=this.drawContext)||void 0===Z||Z.dispose()}}},11126:(Z,c,L)=>{L.d(c,{b:()=>i,e:()=>E,i:()=>J,k:()=>z});var k=L(11047),N=L(11134),R=L(11124),G=L(11052),V=L(11095),p=L(11102);function J(Z,c){return(0,N.H)(c).cachedPipelines[Z]}function z(Z){const c=Z._name,L=Z.context;if(c&&L){const Z=(0,N.H)(L),k=Z.cachedPipelines[c];null===k||void 0===k||k.dispose(),delete Z.cachedPipelines[c]}}function i(Z,c,L,N,R,G,p){let J,z;const i=(0,k.k)()?null===G||void 0===G?void 0:G.getHostDocument():null;J="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===i||void 0===i?void 0:i.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,z="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===i||void 0===i?void 0:i.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const E=[void 0,void 0],x=()=>{if(E[0]&&E[1]){Z.isFragment=!0;const[k,J]=E;(0,V.j)(J,Z,((G,J)=>{p&&(p._fragmentSourceCodeBeforeMigration=J),L&&(G=L("fragment",G));const z=(0,V.b)(k,G,Z);Z=null;const i=function(Z,c,L,k){if(L){return{vertexSourceCode:(1===k?"//":"")+"#define SHADER_NAME vertex:"+(L.vertexElement||L.vertex||L.spectorName||L)+"\n"+Z,fragmentSourceCode:(1===k?"//":"")+"#define SHADER_NAME fragment:"+(L.fragmentElement||L.fragment||L.spectorName||L)+"\n"+c}}return{vertexSourceCode:Z,fragmentSourceCode:c}}(z.vertexCode,z.fragmentCode,c,R);null===N||void 0===N||N(i.vertexSourceCode,i.fragmentSourceCode)}),G)}};t(J,"Vertex","",(c=>{(0,V.d)(Z),(0,V.j)(c,Z,((Z,k)=>{p&&(p._rawVertexSourceCode=c,p._vertexSourceCodeBeforeMigration=k),L&&(Z=L("vertex",Z)),E[0]=Z,x()}),G)}),R),t(z,"Fragment","Pixel",(Z=>{p&&(p._rawFragmentSourceCode=Z),E[1]=Z,x()}),R)}function t(Z,c,L,N,G,V){if("undefined"!==typeof HTMLElement&&Z instanceof HTMLElement){return void N((0,k.c)(Z))}if("source:"===Z.substring(0,7))return void N(Z.substring(7));if("base64:"===Z.substring(0,7)){return void N(window.atob(Z.substring(7)))}const J=R.e.GetShadersStore(G);if(J[Z+c+"Shader"])return void N(J[Z+c+"Shader"]);if(L&&J[Z+L+"Shader"])return void N(J[Z+L+"Shader"]);let z;if(z="."===Z[0]||"/"===Z[0]||Z.indexOf("http")>-1?Z:R.e.GetShadersRepository(G)+Z,!(V=V||p.l))throw new Error("loadFileInjection is not defined");V(z+"."+c.toLowerCase()+".fx",N)}const E=(Z,c,L,k)=>{try{const R=Z.context?(0,N.H)(Z.context):null;R&&(R.disableParallelShaderCompile=Z.disableParallelCompilation);const G=Z.existingPipelineContext||c(Z.shaderProcessingContext);return G._name=Z.name,Z.name&&R&&(R.cachedPipelines[Z.name]=G),L(G,Z.vertex,Z.fragment,!!Z.createAsRaw,"","",Z.rebuildRebind,Z.defines,Z.transformFeedbackVaryings,"",(()=>{k(G,(()=>{var c;null===(c=Z.onRenderingStateCompiled)||void 0===c||c.call(Z,G)}))})),G}catch(R){throw G.e.Error("Error compiling effect"),R}}},11116:(Z,c,L)=>{L.d(c,{d:()=>p});var k=L(11027),N=L(11052),R=L(11124),G=L(11126),V=L(11108);class p{static get ShadersRepository(){return R.e.ShadersRepository}static set ShadersRepository(Z){R.e.ShadersRepository=Z}get p(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new k.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9?arguments[9]:void 0,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,q=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new k.b,this.onErrorObservable=new k.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=Z,this._key=E;const O=this._key.replace(/\r/g,"").replace(/\n/g,"|");let w;if(c.attributes){const Z=c;if(this._engine=L,this._attributesNames=Z.attributes,this._uniformsNames=Z.uniformsNames.concat(Z.samplers),this._samplerList=Z.samplers.slice(),this.defines=Z.defines,this.onError=Z.onError,this.onCompiled=Z.onCompiled,this._fallbacks=Z.fallbacks,this._indexParameters=Z.indexParameters,this._transformFeedbackVaryings=Z.transformFeedbackVaryings||null,this._multiTarget=!!Z.multiTarget,this._shaderLanguage=Z.shaderLanguage??0,this._disableParallelShaderCompilation=!!Z.disableParallelShaderCompilation,Z.uniformBuffersNames){this._uniformBuffersNamesList=Z.uniformBuffersNames.slice();for(let c=0;c<Z.uniformBuffersNames.length;c++)this._uniformBuffersNames[Z.uniformBuffersNames[c]]=c}this._processFinalCode=Z.processFinalCode??null,this._processCodeAfterIncludes=Z.processCodeAfterIncludes??void 0,q=Z.extraInitializationsAsync,w=Z.existingPipelineContext}else this._engine=R,this.defines=null==V?"":V,this._uniformsNames=L.concat(N),this._samplerList=N?N.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=x,this.onError=i,this.onCompiled=z,this._indexParameters=t,this._fallbacks=J;"WEBGL2"===this._engine.shaderPlatformName&&(w=(0,G.i)(O,this._engine._gl)??w),this._attributeLocationByName={},this.uniqueId=p._UniqueIdSeed++,w?(this._pipelineContext=w,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,q),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.p||this.dispose(!0)}))}async _processShaderCodeAsync(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3?arguments[3]:void 0;k&&await k(),this._processingContext=L||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const N={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:Z??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:R.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:R.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,G.b)(N,this.name,this._processFinalCode,((Z,L)=>{this._vertexSourceCode=Z,this._fragmentSourceCode=L,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.p||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(Z){return this._attributes[Z]}getAttributeLocationByName(Z){return this._attributeLocationByName[Z]}getAttributesCount(){return this._attributes.length}getUniformIndex(Z){return this._uniformsNames.indexOf(Z)}getUniform(Z){return this._uniforms[Z]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((Z=>{this.executeWhenCompiled(Z)}))}executeWhenCompiled(Z){this.isReady()?Z(this):(this.onCompileObservable.add((c=>{Z(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(Z){(0,V.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(c=>{this._processCompilationErrors(c,Z)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var Z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var Z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(Z,c,L,k){this._isReady=!1,this._vertexSourceCodeOverride=Z,this._fragmentSourceCodeOverride=c,this.onError=(Z,c)=>{k&&k(c)},this.onCompiled=()=>{var Z,c;const k=this.getEngine().scenes;if(k)for(let L=0;L<k.length;L++)k[L].markAllMaterialsAsDirty(127);null===(Z=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===Z||Z.call(c,L)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(Z){if(this._pipelineContext=Z,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const Z=this._attributesNames[c];this._attributeLocationByName[Z]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),p.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const L=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),k=L?null:this.defines,N=L?this._vertexSourceCodeOverride:this._vertexSourceCode,R=L?this._fragmentSourceCodeOverride:this._fragmentSourceCode,V=this._engine;this._pipelineContext=(0,G.e)({existingPipelineContext:Z?c:null,vertex:N,fragment:R,context:"WEBGL2"===V.shaderPlatformName||"WEBGL1"===V.shaderPlatformName?V._gl:void 0,rebuildRebind:(Z,c,L,k)=>this._rebuildProgram(Z,c,L,k),defines:k,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:L,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:L=>{c&&!Z&&this._engine._deletePipelineContext(c),L&&this._onRenderingStateCompiled(L)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(L){this._processCompilationErrors(L,c)}}_getShaderCodeAndErrorLine(Z,c,L){const k=L?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let N=null;if(c&&Z){const R=c.match(k);if(R&&2===R.length){const c=parseInt(R[1]),k=Z.split("\n",-1);k.length>=c&&(N=`Offending line [${c}] in ${L?"fragment":"vertex"} code: ${k[c-1]}`)}}return[Z,N]}_processCompilationErrors(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=Z.message;const L=this._attributesNames,k=this._fallbacks;if(N.e.Error("Unable to compile effect:"),N.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),N.e.Error(`Attributes: ${L.join(" ")}`),N.e.Error("Defines:\n"+this.defines),p.LogShaderCodeOnCompilationError){var R,G;let Z=null,c=null,L=null;var V;if(null!==(R=this._pipelineContext)&&void 0!==R&&R._getVertexShaderCode()&&([L,Z]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),L&&(N.e.Error("Vertex code:"),N.e.Error(L))),null!==(G=this._pipelineContext)&&void 0!==G&&G._getFragmentShaderCode())[L,c]=this._getShaderCodeAndErrorLine(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode(),this._compilationError,!0),L&&(N.e.Error("Fragment code:"),N.e.Error(L));Z&&N.e.Error(Z),c&&N.e.Error(c)}N.e.Error("Error: "+this._compilationError);const J=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};c&&(this._pipelineContext=c,this._isReady=!0,J()),k?(this._pipelineContext=null,k.hasMoreFallbacks?(this._allFallbacksProcessed=!1,N.e.Error("Trying next fallback."),this.defines=k.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,J(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||J())}get isSupported(){return""===this._compilationError}_bindTexture(Z,c){this._engine._bindTexture(this._samplers[Z],c,Z)}setTexture(Z,c){this._engine.setTexture(this._samplers[Z],this._uniforms[Z],c,Z)}setTextureArray(Z,c){const L=Z+"Ex";if(-1===this._samplerList.indexOf(L+"0")){const k=this._samplerList.indexOf(Z);for(let Z=1;Z<c.length;Z++){const c=L+(Z-1).toString();this._samplerList.splice(k+Z,0,c)}let N=0;for(const Z of this._samplerList)this._samplers[Z]=N,N+=1}this._engine.setTextureArray(this._samplers[Z],this._uniforms[Z],c,Z)}bindUniformBuffer(Z,c){const L=this._uniformBuffersNames[c];void 0===L||p._BaseCache[L]===Z&&this._engine._features.useUBOBindingCache||(p._BaseCache[L]=Z,this._engine.bindUniformBufferBase(Z,L,c))}bindUniformBlock(Z,c){this._engine.bindUniformBlock(this._pipelineContext,Z,c)}setInt(Z,c){return this._pipelineContext.setInt(Z,c),this}setInt2(Z,c,L){return this._pipelineContext.setInt2(Z,c,L),this}setInt3(Z,c,L,k){return this._pipelineContext.setInt3(Z,c,L,k),this}setInt4(Z,c,L,k,N){return this._pipelineContext.setInt4(Z,c,L,k,N),this}setIntArray(Z,c){return this._pipelineContext.setIntArray(Z,c),this}setIntArray2(Z,c){return this._pipelineContext.setIntArray2(Z,c),this}setIntArray3(Z,c){return this._pipelineContext.setIntArray3(Z,c),this}setIntArray4(Z,c){return this._pipelineContext.setIntArray4(Z,c),this}setUInt(Z,c){return this._pipelineContext.setUInt(Z,c),this}setUInt2(Z,c,L){return this._pipelineContext.setUInt2(Z,c,L),this}setUInt3(Z,c,L,k){return this._pipelineContext.setUInt3(Z,c,L,k),this}setUInt4(Z,c,L,k,N){return this._pipelineContext.setUInt4(Z,c,L,k,N),this}setUIntArray(Z,c){return this._pipelineContext.setUIntArray(Z,c),this}setUIntArray2(Z,c){return this._pipelineContext.setUIntArray2(Z,c),this}setUIntArray3(Z,c){return this._pipelineContext.setUIntArray3(Z,c),this}setUIntArray4(Z,c){return this._pipelineContext.setUIntArray4(Z,c),this}setFloatArray(Z,c){return this._pipelineContext.setArray(Z,c),this}setFloatArray2(Z,c){return this._pipelineContext.setArray2(Z,c),this}setFloatArray3(Z,c){return this._pipelineContext.setArray3(Z,c),this}setFloatArray4(Z,c){return this._pipelineContext.setArray4(Z,c),this}setArray(Z,c){return this._pipelineContext.setArray(Z,c),this}setArray2(Z,c){return this._pipelineContext.setArray2(Z,c),this}setArray3(Z,c){return this._pipelineContext.setArray3(Z,c),this}setArray4(Z,c){return this._pipelineContext.setArray4(Z,c),this}setMatrices(Z,c){return this._pipelineContext.setMatrices(Z,c),this}setMatrix(Z,c){return this._pipelineContext.setMatrix(Z,c),this}setMatrix3x3(Z,c){return this._pipelineContext.setMatrix3x3(Z,c),this}setMatrix2x2(Z,c){return this._pipelineContext.setMatrix2x2(Z,c),this}setFloat(Z,c){return this._pipelineContext.setFloat(Z,c),this}setBool(Z,c){return this._pipelineContext.setInt(Z,c?1:0),this}setVector2(Z,c){return this._pipelineContext.setVector2(Z,c),this}setFloat2(Z,c,L){return this._pipelineContext.setFloat2(Z,c,L),this}setVector3(Z,c){return this._pipelineContext.setVector3(Z,c),this}setFloat3(Z,c,L,k){return this._pipelineContext.setFloat3(Z,c,L,k),this}setVector4(Z,c){return this._pipelineContext.setVector4(Z,c),this}setQuaternion(Z,c){return this._pipelineContext.setQuaternion(Z,c),this}setFloat4(Z,c,L,k,N){return this._pipelineContext.setFloat4(Z,c,L,k,N),this}setColor3(Z,c){return this._pipelineContext.setColor3(Z,c),this}setColor4(Z,c,L){return this._pipelineContext.setColor4(Z,c,L),this}setDirectColor4(Z,c){return this._pipelineContext.setDirectColor4(Z,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(p.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,G.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(R.e.GetShadersStore(k)[`${Z}PixelShader`]=c),L&&(R.e.GetShadersStore(k)[`${Z}VertexShader`]=L)}static ResetCache(){p._BaseCache={}}}p.LogShaderCodeOnCompilationError=!0,p.PersistentMode=!1,p.AutomaticallyClearCodeCache=!1,p._UniqueIdSeed=0,p._BaseCache={},p.ShadersStore=R.e.ShadersStore,p.IncludesShadersStore=R.e.IncludesShadersStore},11688:(Z,c,L)=>{L.d(c,{c:()=>k});class k{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(Z,c){this._defines[Z]||(Z<this._currentRank&&(this._currentRank=Z),Z>this._maxRank&&(this._maxRank=Z),this._defines[Z]=new Array),this._defines[Z].push(c)}addCPUSkinningFallback(Z,c){this._mesh=c,Z<this._currentRank&&(this._currentRank=Z),Z>this._maxRank&&(this._maxRank=Z)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(Z,c){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,Z=Z.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c._bonesComputationForcedToCPU=!0;const L=this._mesh.XZ();for(let Z=0;Z<L.meshes.length;Z++){const k=L.meshes[Z];if(k.material){if(k.computeBonesUsingShaders&&0!==k.numBoneInfluencers)if(k.material.getEffect()===c)k.computeBonesUsingShaders=!1;else if(k.ec)for(const Z of k.ec){if(Z.effect===c){k.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&k.computeBonesUsingShaders&&k.numBoneInfluencers>0&&(k.computeBonesUsingShaders=!1)}}else{const c=this._defines[this._currentRank];if(c)for(let L=0;L<c.length;L++)Z=Z.replace("#define "+c[L],"");this._currentRank++}return Z}}},11532:(Z,c,L)=>{L.d(c,{c:()=>J,f:()=>z});var k=L(11190),N=L(11343),R=L(11027),G=L(11116),V=L(11230);L(11535);const p={BZ:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class J{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;this._fullscreenViewport=new N.d(0,0,1,1);const L=c.BZ??p.BZ,R=c.indices??p.indices;this.xV=Z,this._vertexBuffers={[k.g.PositionKind]:new k.g(Z,L,k.g.PositionKind,!1,!1,2)},this._indexBuffer=Z.createIndexBuffer(R),this._indexBufferLength=R.length,this._onContextRestoredObserver=Z.onContextRestoredObservable.add((()=>{this._indexBuffer=Z.createIndexBuffer(R);for(const Z in this._vertexBuffers){this._vertexBuffers[Z]._rebuild()}}))}setViewport(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.xV.setViewport(Z)}bindBuffers(Z){this.xV.bindBuffers(this._vertexBuffers,this._indexBuffer,Z)}applyEffectWrapper(Z){this.xV.setState(!0),this.xV.depthCullingState.depthTest=!1,this.xV.stencilState.stencilTest=!1,this.xV.enableEffect(Z.drawWrapper),this.bindBuffers(Z.effect),Z.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.xV.depthCullingState.depthTest,this._savedStateStencilTest=this.xV.stencilState.stencilTest}restoreStates(){this.xV.depthCullingState.depthTest=this._savedStateDepthTest,this.xV.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.xV.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(Z){return void 0!==Z.renderTarget}render(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Z.effect.isReady())return;this.saveStates(),this.setViewport();const L=null===c?null:this._isRenderTargetTexture(c)?c.renderTarget:c;L&&this.xV.bindFramebuffer(L),this.applyEffectWrapper(Z),this.draw(),L&&this.xV.unBindFramebuffer(L),this.restoreStates()}dispose(){const Z=this._vertexBuffers[k.g.PositionKind];Z&&(Z.dispose(),delete this._vertexBuffers[k.g.PositionKind]),this._indexBuffer&&this.xV._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.xV.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class z{static RegisterShaderCodeProcessing(Z,c){c?z._CustomShaderCodeProcessing[Z??""]=c:delete z._CustomShaderCodeProcessing[Z??""]}static _GetShaderCodeProcessing(Z){return z._CustomShaderCodeProcessing[Z]??z._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(Z){this.options.name=Z}isReady(){var Z;return(null===(Z=this._drawWrapper.effect)||void 0===Z?void 0:Z.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(Z){this._drawWrapper.effect=Z}constructor(Z){this.alphaMode=0,this.onEffectCreatedObservable=new R.b(void 0,!0),this.onApplyObservable=new R.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...Z,name:Z.name||"effectWrapper",xV:Z.xV,uniforms:Z.uniforms||Z.uniformNames||[],uniformNames:void 0,samplers:Z.samplers||Z.samplerNames||[],samplerNames:void 0,attributeNames:Z.attributeNames||["position"],uniformBuffers:Z.uniformBuffers||[],defines:Z.defines||"",useShaderStore:Z.useShaderStore||!1,vertexUrl:Z.vertexUrl||Z.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:Z.fragmentShader||"pass",indexParameters:Z.indexParameters,blockCompilation:Z.blockCompilation||!1,shaderLanguage:Z.shaderLanguage||0,onCompiled:Z.onCompiled||void 0,extraInitializations:Z.extraInitializations||void 0,extraInitializationsAsync:Z.extraInitializationsAsync||void 0,useAsPostProcess:Z.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),Z.vertexUrl||Z.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.xV.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new V.d(this.options.xV),this._webGPUReady=1===this.options.shaderLanguage;const c=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,c,this.options.extraInitializations)}_gatherImports(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(Z&&this._webGPUReady?c.push(Promise.all([L.e(42).then(L.bind(L,13652))])):c.push(Promise.all([Promise.resolve().then(L.bind(L,11535))])))}_postConstructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,k&&this._importPromises.push(...k);const N=this.options.xV.isWebGPU&&!z.ForceGLSL;this._gatherImports(N,this._importPromises),void 0!==L&&L(N,this._importPromises),N&&this._webGPUReady&&(this.options.shaderLanguage=1),Z||this.updateEffect(c)}updateEffect(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0;const J=z._GetShaderCodeProcessing(this.name);if(null!==J&&void 0!==J&&J.defineCustomBindings){var i,t;const k=(null===(i=c)||void 0===i?void 0:i.slice())??[];k.push(...this.options.uniforms);const N=(null===(t=L)||void 0===t?void 0:t.slice())??[];N.push(...this.options.samplers),Z=J.defineCustomBindings(this.name,Z,k,N),c=k,L=N}this.options.defines=Z||"";const E=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let x;x=this.options.extraInitializationsAsync?async()=>{null===E||void 0===E||E(),await this.options.extraInitializationsAsync()}:E,this.options.useShaderStore?this._drawWrapper.effect=this.options.xV.createEffect({vertex:V??this._shaderPath.vertex,fragment:p??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:c||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:L||this.options.samplers,defines:null!==Z?Z:"",fallbacks:null,onCompiled:N??this.options.onCompiled,onError:R??null,indexParameters:k||this.options.indexParameters,processCodeAfterIncludes:null!==J&&void 0!==J&&J.processCodeAfterIncludes?(Z,c)=>J.processCodeAfterIncludes(this.name,Z,c):null,processFinalCode:null!==J&&void 0!==J&&J.processFinalCode?(Z,c)=>J.processFinalCode(this.name,Z,c):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:x},this.options.xV):this._drawWrapper.effect=new G.d(this._shaderPath,this.options.attributeNames,c||this.options.uniforms,L||this.options.samplerNames,this.options.xV,Z,void 0,N||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,x),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var Z,c;let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!L&&(this.options.xV.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(Z=z._GetShaderCodeProcessing(this.name))||void 0===Z||null===(c=Z.bindCustomBindings)||void 0===c||c.call(Z,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}z.ForceGLSL=!1,z._CustomShaderCodeProcessing={}},11607:(Z,c,L)=>{L.d(c,{d:()=>R,e:()=>N});var k=L(11600);function N(Z,c){c.EXPOSURE&&Z.push("exposureLinear"),c.CONTRAST&&Z.push("contrast"),c.COLORGRADING&&Z.push("colorTransformSettings"),(c.VIGNETTE||c.DITHER)&&Z.push("vInverseScreenSize"),c.VIGNETTE&&(Z.push("vignetteSettings1"),Z.push("vignetteSettings2")),c.COLORCURVES&&(0,k.c)(Z),c.DITHER&&Z.push("ditherIntensity")}function R(Z,c){c.COLORGRADING&&Z.push("txColorTransform")}},11592:(Z,c,L)=>{L.d(c,{b:()=>E});var k=L(11170),N=L(11173),R=L(11027),G=L(11255),V=L(11242),p=L(11600);class J{constructor(){this._dirty=!0,this._tempColor=new G.h(0,0,0,0),this._globalCurve=new G.h(0,0,0,0),this._highlightsCurve=new G.h(0,0,0,0),this._midtonesCurve=new G.h(0,0,0,0),this._shadowsCurve=new G.h(0,0,0,0),this._positiveCurve=new G.h(0,0,0,0),this._negativeCurve=new G.h(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(Z){this._globalHue=Z,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(Z){this._globalDensity=Z,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(Z){this._globalSaturation=Z,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(Z){this._globalExposure=Z,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(Z){this._highlightsHue=Z,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(Z){this._highlightsDensity=Z,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(Z){this._highlightsSaturation=Z,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(Z){this._highlightsExposure=Z,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(Z){this._midtonesHue=Z,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(Z){this._midtonesDensity=Z,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(Z){this._midtonesSaturation=Z,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(Z){this._midtonesExposure=Z,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(Z){this._shadowsHue=Z,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(Z){this._shadowsDensity=Z,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(Z){this._shadowsSaturation=Z,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(Z){this._shadowsExposure=Z,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";Z._dirty&&(Z._dirty=!1,Z._getColorGradingDataToRef(Z._globalHue,Z._globalDensity,Z._globalSaturation,Z._globalExposure,Z._globalCurve),Z._getColorGradingDataToRef(Z._highlightsHue,Z._highlightsDensity,Z._highlightsSaturation,Z._highlightsExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._highlightsCurve),Z._getColorGradingDataToRef(Z._midtonesHue,Z._midtonesDensity,Z._midtonesSaturation,Z._midtonesExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._midtonesCurve),Z._getColorGradingDataToRef(Z._shadowsHue,Z._shadowsDensity,Z._shadowsSaturation,Z._shadowsExposure,Z._tempColor),Z._tempColor.multiplyToRef(Z._globalCurve,Z._shadowsCurve),Z._highlightsCurve.subtractToRef(Z._midtonesCurve,Z._positiveCurve),Z._midtonesCurve.subtractToRef(Z._shadowsCurve,Z._negativeCurve)),c&&(c.setFloat4(L,Z._positiveCurve.r,Z._positiveCurve.g,Z._positiveCurve.b,Z._positiveCurve.a),c.setFloat4(k,Z._midtonesCurve.r,Z._midtonesCurve.g,Z._midtonesCurve.b,Z._midtonesCurve.a),c.setFloat4(N,Z._negativeCurve.r,Z._negativeCurve.g,Z._negativeCurve.b,Z._negativeCurve.a))}_getColorGradingDataToRef(Z,c,L,k,N){null!=Z&&(Z=J._Clamp(Z,0,360),c=J._Clamp(c,-100,100),L=J._Clamp(L,-100,100),k=J._Clamp(k,-100,100),c=J._ApplyColorGradingSliderNonlinear(c),c*=.5,k=J._ApplyColorGradingSliderNonlinear(k),c<0&&(c*=-1,Z=(Z+180)%360),J._FromHSBToRef(Z,c,50+.25*k,N),N.scaleToRef(2,N),N.a=1+.01*L)}static _ApplyColorGradingSliderNonlinear(Z){Z/=100;let c=Math.abs(Z);return c=Math.pow(c,2),Z<0&&(c*=-1),c*=100,c}static _FromHSBToRef(Z,c,L,k){let N=J._Clamp(Z,0,360);const R=J._Clamp(c/100,0,1),G=J._Clamp(L/100,0,1);if(0===R)k.r=G,k.g=G,k.b=G;else{N/=60;const Z=Math.floor(N),c=N-Z,L=G*(1-R),V=G*(1-R*c),p=G*(1-R*(1-c));switch(Z){case 0:k.r=G,k.g=p,k.b=L;break;case 1:k.r=V,k.g=G,k.b=L;break;case 2:k.r=L,k.g=G,k.b=p;break;case 3:k.r=L,k.g=V,k.b=G;break;case 4:k.r=p,k.g=L,k.b=G;break;default:k.r=G,k.g=L,k.b=V}}k.a=1}static _Clamp(Z,c,L){return Math.min(Math.max(Z,c),L)}clone(){return V.e.Clone((()=>new J),this)}serialize(){return V.e.Serialize(this)}static Parse(Z){return V.e.Parse((()=>new J),Z,null,null)}}J.PrepareUniforms=p.c,(0,k.d)([(0,N.H)()],J.prototype,"_globalHue",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_globalDensity",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_globalSaturation",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_globalExposure",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_highlightsHue",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_highlightsDensity",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_highlightsSaturation",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_highlightsExposure",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_midtonesHue",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_midtonesDensity",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_midtonesSaturation",void 0),(0,k.d)([(0,N.H)()],J.prototype,"_midtonesExposure",void 0),V.e._ColorCurvesParser=J.Parse;var z=L(11159),i=L(11607),t=L(11012);class E{constructor(){this.colorCurves=new J,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=E.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new G.h(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=E.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new R.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(Z){this._colorCurvesEnabled!==Z&&(this._colorCurvesEnabled=Z,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(Z){this._colorGradingTexture!==Z&&(this._colorGradingTexture=Z,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(Z){this._colorGradingEnabled!==Z&&(this._colorGradingEnabled=Z,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(Z){this._colorGradingWithGreenDepth!==Z&&(this._colorGradingWithGreenDepth=Z,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(Z){this._colorGradingBGR!==Z&&(this._colorGradingBGR=Z,this._updateParameters())}get exposure(){return this._exposure}set exposure(Z){this._exposure!==Z&&(this._exposure=Z,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(Z){this._toneMappingEnabled!==Z&&(this._toneMappingEnabled=Z,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(Z){this._toneMappingType!==Z&&(this._toneMappingType=Z,this._updateParameters())}get contrast(){return this._contrast}set contrast(Z){this._contrast!==Z&&(this._contrast=Z,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(Z){this.vignetteCenterY=Z}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(Z){this.vignetteCenterX=Z}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(Z){this._vignetteBlendMode!==Z&&(this._vignetteBlendMode=Z,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(Z){this._vignetteEnabled!==Z&&(this._vignetteEnabled=Z,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(Z){this._ditheringEnabled!==Z&&(this._ditheringEnabled=Z,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(Z){this._ditheringIntensity!==Z&&(this._ditheringIntensity=Z,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(Z){this._skipFinalColorClamp!==Z&&(this._skipFinalColorClamp=Z,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(Z){this._applyByPostProcess!==Z&&(this._applyByPostProcess=Z,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(Z){this._isEnabled!==Z&&(this._isEnabled=Z,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(Z){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return Z.VIGNETTE=!1,Z.TONEMAPPING=0,Z.CONTRAST=!1,Z.EXPOSURE=!1,Z.COLORCURVES=!1,Z.COLORGRADING=!1,Z.COLORGRADING3D=!1,Z.DITHER=!1,Z.IMAGEPROCESSING=!1,Z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(Z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(Z.VIGNETTE=this.vignetteEnabled,Z.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===E._VIGNETTEMODE_MULTIPLY,Z.VIGNETTEBLENDMODEOPAQUE=!Z.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case E.TONEMAPPING_KHR_PBR_NEUTRAL:Z.TONEMAPPING=3;break;case E.TONEMAPPING_ACES:Z.TONEMAPPING=2;break;default:Z.TONEMAPPING=1}else Z.TONEMAPPING=0;Z.CONTRAST=1!==this.contrast,Z.EXPOSURE=1!==this.exposure,Z.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,Z.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,Z.COLORGRADING?Z.COLORGRADING3D=this.colorGradingTexture.is3D:Z.COLORGRADING3D=!1,Z.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,Z.SAMPLER3DBGRMAP=this.colorGradingBGR,Z.DITHER=this._ditheringEnabled,Z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,Z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,Z.IMAGEPROCESSING=Z.VIGNETTE||!!Z.TONEMAPPING||Z.CONTRAST||Z.EXPOSURE||Z.COLORCURVES||Z.COLORGRADING||Z.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(Z,c){if(this._colorCurvesEnabled&&this.colorCurves&&J.Bind(this.colorCurves,Z),this._vignetteEnabled||this._ditheringEnabled){const L=1/(this.outputTextureWidth||Z.getEngine().getRenderWidth()),k=1/(this.outputTextureHeight||Z.getEngine().getRenderHeight());if(Z.setFloat2("vInverseScreenSize",L,k),this._ditheringEnabled&&Z.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const N=null!=c?c:k/L;let R=Math.tan(.5*this.vignetteCameraFov),G=R*N;const V=Math.sqrt(G*R);G=(0,z.j)(G,V,this.vignetteStretch),R=(0,z.j)(R,V,this.vignetteStretch),Z.setFloat4("vignetteSettings1",G,R,-G*this.vignetteCenterX,-R*this.vignetteCenterY);const p=-2*this.vignetteWeight;Z.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,p)}}if(Z.setFloat("exposureLinear",this.exposure),Z.setFloat("contrast",this.contrast),this.colorGradingTexture){Z.setTexture("txColorTransform",this.colorGradingTexture);const c=this.colorGradingTexture.getSize().height;Z.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}}clone(){return V.e.Clone((()=>new E),this)}serialize(){return V.e.Serialize(this)}static Parse(Z){const c=V.e.Parse((()=>new E),Z,null,null);return void 0!==Z.vignetteCentreX&&(c.vignetteCenterX=Z.vignetteCentreX),void 0!==Z.vignetteCentreY&&(c.vignetteCenterY=Z.vignetteCentreY),c}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}E.TONEMAPPING_STANDARD=0,E.TONEMAPPING_ACES=1,E.TONEMAPPING_KHR_PBR_NEUTRAL=2,E.PrepareUniforms=i.e,E.PrepareSamplers=i.d,E._VIGNETTEMODE_MULTIPLY=0,E._VIGNETTEMODE_OPAQUE=1,(0,k.d)([(0,N.l)()],E.prototype,"colorCurves",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_colorCurvesEnabled",void 0),(0,k.d)([(0,N.A)("colorGradingTexture")],E.prototype,"_colorGradingTexture",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_colorGradingEnabled",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_colorGradingWithGreenDepth",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_colorGradingBGR",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_exposure",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_toneMappingEnabled",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_toneMappingType",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_contrast",void 0),(0,k.d)([(0,N.H)()],E.prototype,"vignetteStretch",void 0),(0,k.d)([(0,N.H)()],E.prototype,"vignetteCenterX",void 0),(0,k.d)([(0,N.H)()],E.prototype,"vignetteCenterY",void 0),(0,k.d)([(0,N.H)()],E.prototype,"vignetteWeight",void 0),(0,k.d)([(0,N.p)()],E.prototype,"vignetteColor",void 0),(0,k.d)([(0,N.H)()],E.prototype,"vignetteCameraFov",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_vignetteBlendMode",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_vignetteEnabled",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_ditheringEnabled",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_ditheringIntensity",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_skipFinalColorClamp",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_applyByPostProcess",void 0),(0,k.d)([(0,N.H)()],E.prototype,"_isEnabled",void 0),(0,k.d)([(0,N.H)()],E.prototype,"outputTextureWidth",void 0),(0,k.d)([(0,N.H)()],E.prototype,"outputTextureHeight",void 0),V.e._ImageProcessingConfigurationParser=E.Parse,(0,t.g)("BABYLON.ImageProcessingConfiguration",E)},11697:(Z,c,L)=>{L.d(c,{d:()=>i});var k=L(11170),N=L(11163),R=L(11173),G=L(11669),V=L(11650),p=L(11652),J=L(11258);class z extends V.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class i extends p.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(Z,"DetailMap",140,new z,c),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=N.e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=Z._dirtyCallbacks[1]}isReadyForSubMesh(Z,c,L){return!this._isEnabled||!(Z._areTexturesDirty&&c.texturesEnabled&&L.getCaps().standardDerivatives&&this._texture&&G.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(Z,c){if(this._isEnabled){Z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const L=c.getEngine();Z._areTexturesDirty&&(L.getCaps().standardDerivatives&&this._texture&&G.c.DetailTextureEnabled&&this._isEnabled?((0,J.P)(this._texture,Z,"DETAIL"),Z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):Z.DETAIL=!1)}else Z.DETAIL=!1}bindForSubMesh(Z,c){if(!this._isEnabled)return;const L=this._material.isFrozen;Z.useUbo&&L&&Z.isSync||this._texture&&G.c.DetailTextureEnabled&&(Z.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,J.u)(this._texture,Z,"detail")),c.texturesEnabled&&this._texture&&G.c.DetailTextureEnabled&&Z.setTexture("detailSampler",this._texture)}hasTexture(Z){return this._texture===Z}getActiveTextures(Z){this._texture&&Z.push(this._texture)}getAnimatables(Z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&Z.push(this._texture)}dispose(Z){var c;Z&&(null===(c=this._texture)||void 0===c||c.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(Z){Z.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,k.d)([(0,R.A)("detailTexture"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,k.d)([(0,R.H)()],i.prototype,"diffuseBlendLevel",void 0),(0,k.d)([(0,R.H)()],i.prototype,"roughnessBlendLevel",void 0),(0,k.d)([(0,R.H)()],i.prototype,"bumpLevel",void 0),(0,k.d)([(0,R.H)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"normalBlendMethod",void 0),(0,k.d)([(0,R.H)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0)},11163:(Z,c,L)=>{L.d(c,{e:()=>O});var k=L(11170),N=L(11173),R=L(11038),G=L(11027),V=L(11023),p=L(11185),J=L(11236),z=L(11052),i=L(11239),t=L(11230),E=L(11242);class x{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(Z){this._func=Z}get funcRef(){return this._funcRef}set funcRef(Z){this._funcRef=Z}get funcMask(){return this._funcMask}set funcMask(Z){this._funcMask=Z}get opStencilFail(){return this._opStencilFail}set opStencilFail(Z){this._opStencilFail=Z}get opDepthFail(){return this._opDepthFail}set opDepthFail(Z){this._opDepthFail=Z}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(Z){this._opStencilDepthPass=Z}get mask(){return this._mask}set mask(Z){this._mask=Z}get enabled(){return this._enabled}set enabled(Z){this._enabled=Z}getClassName(){return"MaterialStencilState"}copyTo(Z){E.e.Clone((()=>Z),this)}serialize(){return E.e.Serialize(this)}parse(Z,c,L){E.e.Parse((()=>this),Z,c,L)}}(0,k.d)([(0,N.H)()],x.prototype,"func",null),(0,k.d)([(0,N.H)()],x.prototype,"funcRef",null),(0,k.d)([(0,N.H)()],x.prototype,"funcMask",null),(0,k.d)([(0,N.H)()],x.prototype,"opStencilFail",null),(0,k.d)([(0,N.H)()],x.prototype,"opDepthFail",null),(0,k.d)([(0,N.H)()],x.prototype,"opStencilDepthPass",null),(0,k.d)([(0,N.H)()],x.prototype,"mask",null),(0,k.d)([(0,N.H)()],x.prototype,"enabled",null);var q=L(11258);class O{get _supportGlowLayer(){return!1}set _glowModeEnabled(Z){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(Z){if(this._alpha===Z)return;const c=this._alpha;this._alpha=Z,1!==c&&1!==Z||this.DJ(O.MiscDirtyFlag+O.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ec(Z){this._backFaceCulling!==Z&&(this._backFaceCulling=Z,this.DJ(O.TextureDirtyFlag))}get Ec(){return this._backFaceCulling}set cullBackFaces(Z){this._cullBackFaces!==Z&&(this._cullBackFaces=Z,this.DJ(O.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(Z){this._blockDirtyMechanism!==Z&&(this._blockDirtyMechanism=Z,Z||this.ei())}atomicMaterialsUpdate(Z){this.blockDirtyMechanism=!0;try{Z(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new G.b),this._onBindObservable}set onBind(Z){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(Z)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new G.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new G.b),this._onEffectCreatedObservable}set alphaMode(Z){this._alphaMode!==Z&&(this._alphaMode=Z,this.DJ(O.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(Z){this._needDepthPrePass!==Z&&(this._needDepthPrePass=Z,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(Z){this._fogEnabled!==Z&&(this._fogEnabled=Z,this.DJ(O.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case O.WireFrameFillMode:case O.LineListDrawMode:case O.LineLoopDrawMode:case O.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(Z){this.fillMode=Z?O.WireFrameFillMode:O.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case O.PointFillMode:case O.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(Z){this.fillMode=Z?O.PointFillMode:O.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(Z){this._fillMode!==Z&&(this._fillMode=Z,this.DJ(O.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){const c=this.XZ().getEngine().getCaps().fragmentDepthSupported;Z&&!c&&z.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=Z&&c,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(Z){this._drawWrapper=Z}constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Xc=new G.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new x,this._useUBO=!1,this._fillMode=O.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=Z;const N=c||V.d.LastCreatedScene;N&&(this._scene=N,this._dirtyCallbacks={},this._forceGLSL=k,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=Z||R.c.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new t.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,Z),this._useUBO=this.XZ().getEngine().supportsUniformBuffers,this._createUniformBuffer(),L||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),O.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var Z;const c=this.XZ().getEngine();null===(Z=this._uniformBuffer)||void 0===Z||Z.dispose(),c.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new J.c(c,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(Z){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.ei(),this.checkReadyOnlyOnce=!0}unfreeze(){this.ei(),this.checkReadyOnlyOnce=!1}isReady(Z,c){return!0}isReadyForSubMesh(Z,c,L){const k=c.materialDefines;return!!k&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=k,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}XZ(){return this._scene}_getEffectiveOrientation(Z){return null!==this.sideOrientation?this.sideOrientation:Z.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(Z){this._transparencyMode!==Z&&(this._transparencyMode=Z,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===O.MATERIAL_ALPHABLEND||this._transparencyMode===O.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===O.MATERIAL_ALPHATEST||this._transparencyMode===O.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===O.MATERIAL_OPAQUE||this._transparencyMode===O.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(Z){return this._hasTransparencyMode?this._transparencyModeIsBlend:Z.visibility<1||!this._disableAlphaBlending&&(Z.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(Z){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(Z)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}ei(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.XZ().meshes;for(const L of c)if(L.ec)for(const c of L.ec)if(c.rZ()===this)for(const L of c._drawWrappers)L&&this._materialContext===L.materialContext&&(L._wasPreviouslyReady=!1,L._wasPreviouslyUsingInstances=null,L._forceRebindOnNextCall=Z);Z&&this.DJ(O.AllDirtyFlag)}_preBind(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this._scene.getEngine(),k=(null==c?this.sideOrientation:c)===O.ClockWiseSideOrientation;return L.enableEffect(Z||this._getDrawWrapper()),L.setState(this.Ec,this.zOffset,!1,k,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),k}bind(Z,c){}buildUniformLayout(){const Z=this._uniformBuffer;this._eventInfo.ubo=Z,this._callbackPluginEventGeneric(8,this._eventInfo),Z.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(Z,c,L){const k=L._drawWrapper;this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),k._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(Z){}bindView(Z){this._useUBO?this._needToBindSceneUbo=!0:Z.setMatrix("view",this.XZ().getViewMatrix())}bindViewProjection(Z){this._useUBO?this._needToBindSceneUbo=!0:(Z.setMatrix("viewProjection",this.XZ().getTransformMatrix()),Z.setMatrix("projection",this.XZ().getProjectionMatrix()))}bindEyePosition(Z,c){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(Z,c)}_afterBind(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&c&&(this._needToBindSceneUbo=!1,(0,q.r)(c,this.XZ().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=Z?Z.visibility:1,this._onBindObservable&&Z&&this._onBindObservable.notifyObservers(Z),this.disableDepthWrite){const Z=this._scene.getEngine();this._cachedDepthWriteState=Z.getDepthWrite(),Z.setDepthWrite(!1)}if(this.disableColorWrite){const Z=this._scene.getEngine();this._cachedColorWriteState=Z.getColorWrite(),Z.setColorWrite(!1)}if(0!==this.depthFunction){const Z=this._scene.getEngine();this._cachedDepthFunctionState=Z.getDepthFunction()||0,Z.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(Z){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=Z,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(Z){return null}_clonePlugins(Z,c){const L={};if(this._serializePlugins(L),O._ParsePlugins(L,Z,this._scene,c),this.pluginManager)for(const k of this.pluginManager._plugins){const c=Z.pluginManager.getPlugin(k.name);c&&k.copyTo(c)}}getBindedMeshes(){if(this.meshMap){const Z=[];for(const c in this.meshMap){const L=this.meshMap[c];L&&Z.push(L)}return Z}return this._scene.meshes.filter((Z=>Z.material===this))}forceCompilation(Z,c,L,k){const N={clipPlane:!1,useInstances:!1,...L},R=this.XZ(),G=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const V=()=>{if(!this._scene||!this._scene.getEngine())return;const L=R.clipPlane;if(N.clipPlane&&(R.clipPlane=new i.b(0,0,0,1)),this._storeEffectOnSubMeshes){let L=!0,R=null;if(Z.ec){const c=new p.b(0,0,0,0,0,Z,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),this.isReadyForSubMesh(Z,c,N.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?R=c.effect.getCompilationError():(L=!1,setTimeout(V,16)))}L&&(this.allowShaderHotSwapping=G,R&&k&&k(R),c&&c(this))}else this.isReady()?(this.allowShaderHotSwapping=G,c&&c(this)):setTimeout(V,16);N.clipPlane&&(R.clipPlane=L)};V()}async forceCompilationAsync(Z,c){return await new Promise(((L,k)=>{this.forceCompilation(Z,(()=>{L()}),c,(Z=>{k(Z)}))}))}DJ(Z){this.XZ().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(O._DirtyCallbackArray.length=0,Z&O.ImageProcessingDirtyFlag&&O._DirtyCallbackArray.push(O._ImageProcessingDirtyCallBack),Z&O.TextureDirtyFlag&&O._DirtyCallbackArray.push(O._TextureDirtyCallBack),Z&O.LightDirtyFlag&&O._DirtyCallbackArray.push(O._LightsDirtyCallBack),Z&O.FresnelDirtyFlag&&O._DirtyCallbackArray.push(O._FresnelDirtyCallBack),Z&O.AttributesDirtyFlag&&O._DirtyCallbackArray.push(O._AttributeDirtyCallBack),Z&O.MiscDirtyFlag&&O._DirtyCallbackArray.push(O._MiscDirtyCallBack),Z&O.PrePassDirtyFlag&&O._DirtyCallbackArray.push(O._PrePassDirtyCallBack),O._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(O._RunDirtyCallBacks),this.XZ().resetCachedMaterial())}resetDrawCache(){const Z=this.XZ().meshes;for(const c of Z)if(c.ec)for(const Z of c.ec)Z.rZ()===this&&Z.resetDrawCache()}_markAllSubMeshesAsDirty(Z){const c=this.XZ();if(c.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const L=c.meshes;for(const k of L)if(k.ec)for(const L of k.ec){if((L.rZ()||(c._hasDefaultMaterial?c.defaultMaterial:null))===this)for(const c of L._drawWrappers)c&&c.defines&&c.defines.markAllAsDirty&&this._materialContext===c.materialContext&&Z(c.defines)}}_markScenePrePassDirty(){if(this.XZ().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const Z=this.XZ().enablePrePassRenderer();Z&&Z.DJ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(O._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(O._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(O._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(O._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(O._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(O._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(O._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(O._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(O._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(O._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const Z=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Xc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(Z)}))}}setPrePassRenderer(Z){return!1}dispose(Z,c,L){const k=this.XZ();if(k.stopAnimation(this),k.freeProcessedMaterials(),k.removeMaterial(this),this._eventInfo.forceDisposeTextures=c,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const Z=this._parentContainer.materials.indexOf(this);Z>-1&&this._parentContainer.materials.splice(Z,1),this._parentContainer=null}if(!0!==L)if(this.meshMap)for(const N in this.meshMap){const Z=this.meshMap[N];this._disposeMeshResources(Z)}else{const Z=k.meshes;for(const c of Z)this._disposeMeshResources(c)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Xc.notifyObservers(this),this.Xc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(Z){if(!Z)return;const c=Z.zc,L=Z._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(Z.ec&&L)for(const N of Z.ec){const Z=N._drawWrappers;for(let R=0;R<Z.length;R++){var k;const G=null===(k=Z[R])||void 0===k?void 0:k.effect;if(!G)continue;L[R]===this&&(null===c||void 0===c||c._releaseVertexArrayObject(G),N._removeDrawWrapper(R,!0,!0))}}}else null===c||void 0===c||c._releaseVertexArrayObject(this._drawWrapper.effect);Z.material!==this||Z.sourceMesh||(Z.material=null)}serialize(){const Z=E.e.Serialize(this);return Z.stencil=this.stencil.serialize(),Z.uniqueId=this.uniqueId,this._serializePlugins(Z),Z}_serializePlugins(Z){if(Z.plugins={},this.pluginManager)for(const c of this.pluginManager._plugins)c.doNotSerialize||(Z.plugins[c.getClassName()]=c.serialize())}static Parse(Z,c,L){if(Z.customType){if("BABYLON.PBRMaterial"===Z.customType&&Z.overloadedAlbedo&&(Z.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return z.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else Z.customType="BABYLON.StandardMaterial";const k=R.c.Instantiate(Z.customType).Parse(Z,c,L);return k._loadedUniqueId=Z.uniqueId,k}static _ParsePlugins(Z,c,L,k){if(Z.plugins)for(const V in Z.plugins){var N,G;const p=Z.plugins[V];let J=null===(N=c.pluginManager)||void 0===N?void 0:N.getPlugin(p.name);if(!J){const Z=R.c.Instantiate("BABYLON."+V);Z&&(J=new Z(c))}null===(G=J)||void 0===G||G.parse(p,L,k)}}}O.TriangleFillMode=0,O.WireFrameFillMode=1,O.PointFillMode=2,O.PointListDrawMode=3,O.LineListDrawMode=4,O.LineLoopDrawMode=5,O.LineStripDrawMode=6,O.TriangleStripDrawMode=7,O.TriangleFanDrawMode=8,O.ClockWiseSideOrientation=0,O.CounterClockWiseSideOrientation=1,O.ImageProcessingDirtyFlag=64,O.TextureDirtyFlag=1,O.LightDirtyFlag=2,O.FresnelDirtyFlag=4,O.AttributesDirtyFlag=8,O.MiscDirtyFlag=16,O.PrePassDirtyFlag=32,O.AllDirtyFlag=127,O.MATERIAL_OPAQUE=0,O.MATERIAL_ALPHATEST=1,O.MATERIAL_ALPHABLEND=2,O.MATERIAL_ALPHATESTANDBLEND=3,O.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,O.MATERIAL_NORMALBLENDMETHOD_RNM=1,O.OnEventObservable=new G.b,O._AllDirtyCallBack=Z=>Z.markAllAsDirty(),O._ImageProcessingDirtyCallBack=Z=>Z.markAsImageProcessingDirty(),O._TextureDirtyCallBack=Z=>Z.markAsTexturesDirty(),O._FresnelDirtyCallBack=Z=>Z.markAsFresnelDirty(),O._MiscDirtyCallBack=Z=>Z.markAsMiscDirty(),O._PrePassDirtyCallBack=Z=>Z.markAsPrePassDirty(),O._LightsDirtyCallBack=Z=>Z.markAsLightDirty(),O._AttributeDirtyCallBack=Z=>Z.markAsAttributesDirty(),O._FresnelAndMiscDirtyCallBack=Z=>{O._FresnelDirtyCallBack(Z),O._MiscDirtyCallBack(Z)},O._TextureAndMiscDirtyCallBack=Z=>{O._TextureDirtyCallBack(Z),O._MiscDirtyCallBack(Z)},O._DirtyCallbackArray=[],O._RunDirtyCallBacks=Z=>{for(const c of O._DirtyCallbackArray)c(Z)},(0,k.d)([(0,N.H)()],O.prototype,"id",void 0),(0,k.d)([(0,N.H)()],O.prototype,"uniqueId",void 0),(0,k.d)([(0,N.H)()],O.prototype,"name",void 0),(0,k.d)([(0,N.H)()],O.prototype,"metadata",void 0),(0,k.d)([(0,N.H)()],O.prototype,"checkReadyOnEveryCall",void 0),(0,k.d)([(0,N.H)()],O.prototype,"checkReadyOnlyOnce",void 0),(0,k.d)([(0,N.H)()],O.prototype,"state",void 0),(0,k.d)([(0,N.H)("alpha")],O.prototype,"_alpha",void 0),(0,k.d)([(0,N.H)("Ec")],O.prototype,"_backFaceCulling",void 0),(0,k.d)([(0,N.H)("cullBackFaces")],O.prototype,"_cullBackFaces",void 0),(0,k.d)([(0,N.H)()],O.prototype,"sideOrientation",void 0),(0,k.d)([(0,N.H)("alphaMode")],O.prototype,"_alphaMode",void 0),(0,k.d)([(0,N.H)()],O.prototype,"_needDepthPrePass",void 0),(0,k.d)([(0,N.H)()],O.prototype,"disableDepthWrite",void 0),(0,k.d)([(0,N.H)()],O.prototype,"disableColorWrite",void 0),(0,k.d)([(0,N.H)()],O.prototype,"forceDepthWrite",void 0),(0,k.d)([(0,N.H)()],O.prototype,"depthFunction",void 0),(0,k.d)([(0,N.H)()],O.prototype,"separateCullingPass",void 0),(0,k.d)([(0,N.H)("fogEnabled")],O.prototype,"_fogEnabled",void 0),(0,k.d)([(0,N.H)()],O.prototype,"pointSize",void 0),(0,k.d)([(0,N.H)()],O.prototype,"zOffset",void 0),(0,k.d)([(0,N.H)()],O.prototype,"zOffsetUnits",void 0),(0,k.d)([(0,N.H)()],O.prototype,"pointsCloud",null),(0,k.d)([(0,N.H)()],O.prototype,"fillMode",null),(0,k.d)([(0,N.H)()],O.prototype,"useLogarithmicDepth",null),(0,k.d)([(0,N.H)()],O.prototype,"transparencyMode",null)},11650:(Z,c,L)=>{L.d(c,{d:()=>k});class k{constructor(Z){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=Z,Z)for(const c in Z)Object.prototype.hasOwnProperty.call(Z,c)&&this._setDefaultValue(c)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||Z,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const Z of Object.keys(this))"_"!==Z[0]&&this._keys.push(Z);if(this._externalProperties)for(const Z in this._externalProperties)-1===this._keys.indexOf(Z)&&this._keys.push(Z)}isEqual(Z){if(this._keys.length!==Z._keys.length)return!1;for(let c=0;c<this._keys.length;c++){const L=this._keys[c];if(this[L]!==Z[L])return!1}return!0}cloneTo(Z){this._keys.length!==Z._keys.length&&(Z._keys=this._keys.slice(0));for(let c=0;c<this._keys.length;c++){const L=this._keys[c];Z[L]=this[L]}}reset(){for(const Z of this._keys)this._setDefaultValue(Z)}_setDefaultValue(Z){var c,L,k,N;const R=(null===(c=this._externalProperties)||void 0===c||null===(L=c[Z])||void 0===L?void 0:L.type)??typeof this[Z],G=null===(k=this._externalProperties)||void 0===k||null===(N=k[Z])||void 0===N?void 0:N.default;switch(R){case"number":this[Z]=G??0;break;case"string":this[Z]=G??"";break;default:this[Z]=G??!1}}toString(){let Z="";for(let c=0;c<this._keys.length;c++){const L=this._keys[c],k=this[L];switch(typeof k){case"number":case"string":Z+="#define "+L+" "+k+"\n";break;default:k&&(Z+="#define "+L+"\n")}}return Z}}},11669:(Z,c,L)=>{L.d(c,{c:()=>N});var k=L(11110);class N{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(Z){this._DiffuseTextureEnabled!==Z&&(this._DiffuseTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(Z){this._BaseWeightTextureEnabled!==Z&&(this._BaseWeightTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(Z){this._BaseDiffuseRoughnessTextureEnabled!==Z&&(this._BaseDiffuseRoughnessTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(Z){this._DetailTextureEnabled!==Z&&(this._DetailTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(Z){this._DecalMapEnabled!==Z&&(this._DecalMapEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(Z){this._AmbientTextureEnabled!==Z&&(this._AmbientTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(Z){this._OpacityTextureEnabled!==Z&&(this._OpacityTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(Z){this._ReflectionTextureEnabled!==Z&&(this._ReflectionTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(Z){this._EmissiveTextureEnabled!==Z&&(this._EmissiveTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(Z){this._SpecularTextureEnabled!==Z&&(this._SpecularTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(Z){this._BumpTextureEnabled!==Z&&(this._BumpTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(Z){this._LightmapTextureEnabled!==Z&&(this._LightmapTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(Z){this._RefractionTextureEnabled!==Z&&(this._RefractionTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(Z){this._ColorGradingTextureEnabled!==Z&&(this._ColorGradingTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(Z){this._FresnelEnabled!==Z&&(this._FresnelEnabled=Z,k.c.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(Z){this._ClearCoatTextureEnabled!==Z&&(this._ClearCoatTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(Z){this._ClearCoatBumpTextureEnabled!==Z&&(this._ClearCoatBumpTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(Z){this._ClearCoatTintTextureEnabled!==Z&&(this._ClearCoatTintTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(Z){this._SheenTextureEnabled!==Z&&(this._SheenTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(Z){this._AnisotropicTextureEnabled!==Z&&(this._AnisotropicTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(Z){this._ThicknessTextureEnabled!==Z&&(this._ThicknessTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(Z){this._RefractionIntensityTextureEnabled!==Z&&(this._RefractionIntensityTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(Z){this._TranslucencyIntensityTextureEnabled!==Z&&(this._TranslucencyIntensityTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(Z){this._TranslucencyColorTextureEnabled!==Z&&(this._TranslucencyColorTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(Z){this._IridescenceTextureEnabled!==Z&&(this._IridescenceTextureEnabled=Z,k.c.MarkAllMaterialsAsDirty(1))}}N._DiffuseTextureEnabled=!0,N._BaseWeightTextureEnabled=!0,N._BaseDiffuseRoughnessTextureEnabled=!0,N._DetailTextureEnabled=!0,N._DecalMapEnabled=!0,N._AmbientTextureEnabled=!0,N._OpacityTextureEnabled=!0,N._ReflectionTextureEnabled=!0,N._EmissiveTextureEnabled=!0,N._SpecularTextureEnabled=!0,N._BumpTextureEnabled=!0,N._LightmapTextureEnabled=!0,N._RefractionTextureEnabled=!0,N._ColorGradingTextureEnabled=!0,N._FresnelEnabled=!0,N._ClearCoatTextureEnabled=!0,N._ClearCoatBumpTextureEnabled=!0,N._ClearCoatTintTextureEnabled=!0,N._SheenTextureEnabled=!0,N._AnisotropicTextureEnabled=!0,N._ThicknessTextureEnabled=!0,N._RefractionIntensityTextureEnabled=!0,N._TranslucencyIntensityTextureEnabled=!0,N._TranslucencyColorTextureEnabled=!0,N._IridescenceTextureEnabled=!0},11258:(Z,c,L)=>{L.d(c,{B:()=>P,C:()=>X,E:()=>h,G:()=>E,I:()=>t,K:()=>W,M:()=>l,O:()=>e,P:()=>w,T:()=>D,U:()=>T,X:()=>I,Y:()=>d,_:()=>r,ab:()=>x,b:()=>j,d:()=>i,g:()=>u,k:()=>z,n:()=>q,r:()=>O,u:()=>M,y:()=>B});var k=L(11052),N=L(11255),R=L(11023),G=L(11266),V=L(11268);const p=N.d.Black(),J={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function z(Z,c,L){if(!Z||Z.LOGARITHMICDEPTH||Z.indexOf&&Z.indexOf("LOGARITHMICDEPTH")>=0){const Z=L.activeCamera;1===Z.mode&&k.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),c.setFloat("logarithmicDepthConstant",2/(Math.log(Z.maxZ+1)/Math.LN2))}}function i(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];L&&Z.fogEnabled&&(!c||c.applyFog)&&0!==Z.fogMode&&(L.setFloat4("vFogInfos",Z.fogMode,Z.fogStart,Z.fogEnd,Z.fogDensity),k?(Z.fogColor.toLinearSpaceToRef(p,Z.getEngine().useExactSrgbConversions),L.setColor3("vFogColor",p)):L.setColor3("vFogColor",Z.fogColor))}function t(Z,c,L,k,N,R,G,V,p,z){const i=Z.numMaxInfluencers||Z.numInfluencers;return i<=0?0:(c.push("#define MORPHTARGETS"),Z.hasPositions&&c.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),Z.hasNormals&&c.push("#define MORPHTARGETTEXTURE_HASNORMALS"),Z.hasTangents&&c.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),Z.hasUVs&&c.push("#define MORPHTARGETTEXTURE_HASUVS"),Z.hasUV2s&&c.push("#define MORPHTARGETTEXTURE_HASUV2S"),Z.hasColors&&c.push("#define MORPHTARGETTEXTURE_HASCOLORS"),Z.supportsPositions&&N&&c.push("#define MORPHTARGETS_POSITION"),Z.supportsNormals&&R&&c.push("#define MORPHTARGETS_NORMAL"),Z.supportsTangents&&G&&c.push("#define MORPHTARGETS_TANGENT"),Z.supportsUVs&&V&&c.push("#define MORPHTARGETS_UV"),Z.supportsUV2s&&p&&c.push("#define MORPHTARGETS_UV2"),Z.supportsColors&&z&&c.push("#define MORPHTARGETS_COLOR"),c.push("#define NUM_MORPH_INFLUENCERS "+i),Z.isUsingTextureForTargets&&c.push("#define MORPHTARGETS_TEXTURE"),J.NUM_MORPH_INFLUENCERS=i,J.NORMAL=R,J.TANGENT=G,J.UV=V,J.UV2=p,J.COLOR=z,E(L,k,J,N),i)}function E(Z,c,L){let N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=L.NUM_MORPH_INFLUENCERS;if(G>0&&R.d.LastCreatedEngine){const V=R.d.LastCreatedEngine.getCaps().maxVertexAttribs,p=c.morphTargetManager;if(null!==p&&void 0!==p&&p.isUsingTextureForTargets)return;const J=p&&p.supportsPositions&&N,z=p&&p.supportsNormals&&L.NORMAL,i=p&&p.supportsTangents&&L.TANGENT,t=p&&p.supportsUVs&&L.UV1,E=p&&p.supportsUV2s&&L.UV2,x=p&&p.supportsColors&&L.VERTEXCOLOR;for(let L=0;L<G;L++)J&&Z.push("position"+L),z&&Z.push("normal"+L),i&&Z.push("tangent"+L),t&&Z.push("uv_"+L),E&&Z.push("uv2_"+L),x&&Z.push("color"+L),Z.length>V&&k.e.Error("Cannot add more vertex attributes for mesh "+c.name)}}function x(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z.push("world0"),Z.push("world1"),Z.push("world2"),Z.push("world3"),c&&(Z.push("previousWorld0"),Z.push("previousWorld1"),Z.push("previousWorld2"),Z.push("previousWorld3"))}function q(Z,c){const L=Z.morphTargetManager;Z&&L&&c.setFloatArray("morphTargetInfluences",L.influences)}function O(Z,c){c.bindToEffect(Z,"Scene")}function w(Z,c,L){c._needUVs=!0,c[L]=!0,Z.optimizeUVAllocation&&Z.getTextureMatrix().isIdentityAs3x2()?(c[L+"DIRECTUV"]=Z.coordinatesIndex+1,c["MAINUV"+(Z.coordinatesIndex+1)]=!0):c[L+"DIRECTUV"]=0}function M(Z,c,L){const k=Z.getTextureMatrix();c.hc(L+"Matrix",k)}function P(Z,c,L){L.BAKED_VERTEX_ANIMATION_TEXTURE&&L.INSTANCES&&Z.push("bakedVertexAnimationSettingsInstanced")}function j(Z,c,L){var k;if(c&&Z&&(Z.computeBonesUsingShaders&&c._bonesComputationForcedToCPU&&(Z.computeBonesUsingShaders=!1),Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton)){const N=Z.skeleton;if(N.isUsingTextureForMatrices&&c.getUniformIndex("boneTextureWidth")>-1){const L=N.getTransformMatrixTexture(Z);c.setTexture("boneSampler",L),c.setFloat("boneTextureWidth",4*(N.bones.length+1))}else{const R=N.getTransformMatrices(Z);R&&(c.setMatrices("mBones",R),L&&Z.XZ().prePassRenderer&&Z.XZ().prePassRenderer.getIndex(2)&&(L.previousBones[Z.uniqueId]||(L.previousBones[Z.uniqueId]=R.slice()),c.setMatrices("mPreviousBones",L.previousBones[Z.uniqueId]),k=R,L.previousBones[Z.uniqueId].set(k)))}}}function o(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];Z._bindLight(c,L,k,N,R)}function u(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const R=Math.min(c.lightSources.length,N);for(let G=0;G<R;G++){o(c.lightSources[G],G,Z,L,"boolean"===typeof k?k:k.SPECULARTERM,c.receiveShadows)}}function X(Z,c,L,k){L.NUM_BONE_INFLUENCERS>0&&(k.addCPUSkinningFallback(0,c),Z.push("matricesIndices"),Z.push("matricesWeights"),L.NUM_BONE_INFLUENCERS>4&&(Z.push("matricesIndicesExtra"),Z.push("matricesWeightsExtra")))}function h(Z,c){(c.INSTANCES||c.THIN_INSTANCES)&&x(Z,!!c.PREPASS_VELOCITY),c.INSTANCESCOLOR&&Z.push("instanceColor")}function B(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=0;for(let R=0;R<L&&Z["LIGHT"+R];R++)R>0&&(N=k+R,c.addFallback(N,"LIGHT"+R)),Z.SHADOWS||(Z["SHADOW"+R]&&c.addFallback(k,"SHADOW"+R),Z["SHADOWPCF"+R]&&c.addFallback(k,"SHADOWPCF"+R),Z["SHADOWPCSS"+R]&&c.addFallback(k,"SHADOWPCSS"+R),Z["SHADOWPOISSON"+R]&&c.addFallback(k,"SHADOWPOISSON"+R),Z["SHADOWESM"+R]&&c.addFallback(k,"SHADOWESM"+R),Z["SHADOWCLOSEESM"+R]&&c.addFallback(k,"SHADOWCLOSEESM"+R));return N++}function D(Z,c,L,k,N,R,G){let V=arguments.length>7&&void 0!==arguments[7]&&arguments[7];G._areMiscDirty&&(G.LOGARITHMICDEPTH=L,G.POINTSIZE=k,G.FOG=N&&function(Z,c){return c.fogEnabled&&Z.applyFog&&0!==c.fogMode}(Z,c),G.NONUNIFORMSCALING=Z.nonUniformScaling,G.ALPHATEST=R,G.DECAL_AFTER_DETAIL=V)}function e(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!L._areLightsDirty)return L._needNormals;let G=0;const V={needNormals:L._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(Z.lightsEnabled&&!R)for(const J of c.lightSources)if(H(Z,c,J,G,L,k,V),G++,G===N)break;L.SPECULARTERM=V.specularEnabled,L.SHADOWS=V.shadowEnabled;for(let J=G;J<N;J++)void 0!==L["LIGHT"+J]&&(L["LIGHT"+J]=!1,L["HEMILIGHT"+J]=!1,L["POINTLIGHT"+J]=!1,L["DIRLIGHT"+J]=!1,L["SPOTLIGHT"+J]=!1,L["AREALIGHT"+J]=!1,L["SHADOW"+J]=!1,L["SHADOWCSM"+J]=!1,L["SHADOWCSMDEBUG"+J]=!1,L["SHADOWCSMNUM_CASCADES"+J]=!1,L["SHADOWCSMUSESHADOWMAXZ"+J]=!1,L["SHADOWCSMNOBLEND"+J]=!1,L["SHADOWCSM_RIGHTHANDED"+J]=!1,L["SHADOWPCF"+J]=!1,L["SHADOWPCSS"+J]=!1,L["SHADOWPOISSON"+J]=!1,L["SHADOWESM"+J]=!1,L["SHADOWCLOSEESM"+J]=!1,L["SHADOWCUBE"+J]=!1,L["SHADOWLOWQUALITY"+J]=!1,L["SHADOWMEDIUMQUALITY"+J]=!1);const p=Z.getEngine().getCaps();return void 0===L.SHADOWFLOAT&&(V.needRebuild=!0),L.SHADOWFLOAT=V.shadowEnabled&&(p.textureFloatRender&&p.textureFloatLinearFiltering||p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering),L.LIGHTMAPEXCLUDED=V.lightmapMode,V.needRebuild&&L.rebuild(),V.needNormals}function H(Z,c,L,k,N,R,V){switch(V.needNormals=!0,void 0===N["LIGHT"+k]&&(V.needRebuild=!0),N["LIGHT"+k]=!0,N["SPOTLIGHT"+k]=!1,N["HEMILIGHT"+k]=!1,N["POINTLIGHT"+k]=!1,N["DIRLIGHT"+k]=!1,N["AREALIGHT"+k]=!1,L.prepareLightSpecificDefines(N,k),N["LIGHT_FALLOFF_PHYSICAL"+k]=!1,N["LIGHT_FALLOFF_GLTF"+k]=!1,N["LIGHT_FALLOFF_STANDARD"+k]=!1,L.falloffType){case G.c.FALLOFF_GLTF:N["LIGHT_FALLOFF_GLTF"+k]=!0;break;case G.c.FALLOFF_PHYSICAL:N["LIGHT_FALLOFF_PHYSICAL"+k]=!0;break;case G.c.FALLOFF_STANDARD:N["LIGHT_FALLOFF_STANDARD"+k]=!0}if(R&&!L.YJ.equalsFloats(0,0,0)&&(V.specularEnabled=!0),N["SHADOW"+k]=!1,N["SHADOWCSM"+k]=!1,N["SHADOWCSMDEBUG"+k]=!1,N["SHADOWCSMNUM_CASCADES"+k]=!1,N["SHADOWCSMUSESHADOWMAXZ"+k]=!1,N["SHADOWCSMNOBLEND"+k]=!1,N["SHADOWCSM_RIGHTHANDED"+k]=!1,N["SHADOWPCF"+k]=!1,N["SHADOWPCSS"+k]=!1,N["SHADOWPOISSON"+k]=!1,N["SHADOWESM"+k]=!1,N["SHADOWCLOSEESM"+k]=!1,N["SHADOWCUBE"+k]=!1,N["SHADOWLOWQUALITY"+k]=!1,N["SHADOWMEDIUMQUALITY"+k]=!1,c&&c.receiveShadows&&Z.shadowsEnabled&&L.shadowEnabled){const c=L.getShadowGenerator(Z.activeCamera)??L.getShadowGenerator();if(c){const Z=c.getShadowMap();Z&&Z.renderList&&Z.renderList.length>0&&(V.shadowEnabled=!0,c.prepareDefines(N,k))}}L.lightmapMode!=G.c.LIGHTMAP_DEFAULT?(V.lightmapMode=!0,N["LIGHTMAPEXCLUDED"+k]=!0,N["LIGHTMAPNOSPECULAR"+k]=L.lightmapMode==G.c.LIGHTMAP_SHADOWSONLY):(N["LIGHTMAPEXCLUDED"+k]=!1,N["LIGHTMAPNOSPECULAR"+k]=!1)}function l(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=function(Z,c){let L=!1;if(Z.activeCamera){const k=c.CAMERA_ORTHOGRAPHIC?1:0,N=c.CAMERA_PERSPECTIVE?1:0,R=1===Z.activeCamera.mode?1:0,G=0===Z.activeCamera.mode?1:0;(k^R||N^G)&&(c.CAMERA_ORTHOGRAPHIC=1===R,c.CAMERA_PERSPECTIVE=1===G,L=!0)}return L}(Z,k);!1!==R&&(p=(0,V.g)(L,Z,k)),k.DEPTHPREPASS!==!c.getColorWrite()&&(k.DEPTHPREPASS=!k.DEPTHPREPASS,p=!0),k.INSTANCES!==N&&(k.INSTANCES=N,p=!0),k.THIN_INSTANCES!==G&&(k.THIN_INSTANCES=G,p=!0),p&&k.markAsUnprocessed()}function W(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!c._areAttributesDirty&&c._needNormals===c._normals&&c._needUVs===c._uvs)return!1;c._normals=c._needNormals,c._uvs=c._needUVs,c.NORMAL=c._needNormals&&Z.isVerticesDataPresent("normal"),c._needNormals&&Z.isVerticesDataPresent("tangent")&&(c.TANGENT=!0);for(let V=1;V<=6;++V)c["UV"+V]=!!c._needUVs&&Z.isVerticesDataPresent(`uv${1===V?"":V}`);if(L){const L=Z.useVertexColors&&Z.isVerticesDataPresent("color");c.VERTEXCOLOR=L,c.VERTEXALPHA=Z.hasVertexAlpha&&L&&R}return Z.isVerticesDataPresent("instanceColor")&&(Z.hasInstances||Z.hasThinInstances)&&(c.INSTANCESCOLOR=!0),k&&function(Z,c){if(Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton){c.NUM_BONE_INFLUENCERS=Z.numBoneInfluencers;const L=void 0!==c.BONETEXTURE;if(Z.skeleton.isUsingTextureForMatrices&&L)c.BONETEXTURE=!0;else{c.BonesPerMesh=Z.skeleton.bones.length+1,c.BONETEXTURE=!L&&void 0;const k=Z.XZ().prePassRenderer;if(k&&k.enabled){const L=-1===k.excludedSkinnedMesh.indexOf(Z);c.BONES_VELOCITY_ENABLED=L}}}else c.NUM_BONE_INFLUENCERS=0,c.BonesPerMesh=0,void 0!==c.BONETEXTURE&&(c.BONETEXTURE=!1)}(Z,c),N&&function(Z,c){const L=Z.morphTargetManager;L?(c.MORPHTARGETS_UV=L.supportsUVs&&c.UV1,c.MORPHTARGETS_UV2=L.supportsUV2s&&c.UV2,c.MORPHTARGETS_TANGENT=L.supportsTangents&&c.TANGENT,c.MORPHTARGETS_NORMAL=L.supportsNormals&&c.NORMAL,c.MORPHTARGETS_POSITION=L.supportsPositions,c.MORPHTARGETS_COLOR=L.supportsColors,c.MORPHTARGETTEXTURE_HASUVS=L.hasUVs,c.MORPHTARGETTEXTURE_HASUV2S=L.hasUV2s,c.MORPHTARGETTEXTURE_HASTANGENTS=L.hasTangents,c.MORPHTARGETTEXTURE_HASNORMALS=L.hasNormals,c.MORPHTARGETTEXTURE_HASPOSITIONS=L.hasPositions,c.MORPHTARGETTEXTURE_HASCOLORS=L.hasColors,c.NUM_MORPH_INFLUENCERS=L.numMaxInfluencers||L.numInfluencers,c.MORPHTARGETS=c.NUM_MORPH_INFLUENCERS>0,c.MORPHTARGETS_TEXTURE=L.isUsingTextureForTargets):(c.MORPHTARGETS_UV=!1,c.MORPHTARGETS_UV2=!1,c.MORPHTARGETS_TANGENT=!1,c.MORPHTARGETS_NORMAL=!1,c.MORPHTARGETS_POSITION=!1,c.MORPHTARGETS_COLOR=!1,c.MORPHTARGETTEXTURE_HASUVS=!1,c.MORPHTARGETTEXTURE_HASUV2S=!1,c.MORPHTARGETTEXTURE_HASTANGENTS=!1,c.MORPHTARGETTEXTURE_HASNORMALS=!1,c.MORPHTARGETTEXTURE_HASPOSITIONS=!1,c.MORPHTARGETTEXTURE_HAS_COLORS=!1,c.MORPHTARGETS=!1,c.NUM_MORPH_INFLUENCERS=0)}(Z,c),G&&function(Z,c){const L=Z.bakedVertexAnimationManager;c.BAKED_VERTEX_ANIMATION_TEXTURE=!(!L||!L.isEnabled)}(Z,c),!0}function T(Z,c){if(Z.activeCamera){const L=c.MULTIVIEW;c.MULTIVIEW=null!==Z.activeCamera.outputRenderTarget&&Z.activeCamera.outputRenderTarget.getViewCount()>1,c.MULTIVIEW!=L&&c.markAsUnprocessed()}}function I(Z,c,L){const k=c.ORDER_INDEPENDENT_TRANSPARENCY,N=c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;c.ORDER_INDEPENDENT_TRANSPARENCY=Z.useOrderIndependentTransparency&&L,c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!Z.getEngine().getCaps().textureFloatLinearFiltering,k===c.ORDER_INDEPENDENT_TRANSPARENCY&&N===c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||c.markAsUnprocessed()}function d(Z,c,L){const k=c.PREPASS;if(!c._arePrePassDirty)return;const N=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(Z.prePassRenderer&&Z.prePassRenderer.enabled&&L){c.PREPASS=!0,c.SCENE_MRT_COUNT=Z.prePassRenderer.mrtCount,c.PREPASS_NORMAL_WORLDSPACE=Z.prePassRenderer.generateNormalsInWorldSpace,c.PREPASS_COLOR=!0,c.PREPASS_COLOR_INDEX=0;for(let L=0;L<N.length;L++){const k=Z.prePassRenderer.getIndex(N[L].type);-1!==k?(c[N[L].define]=!0,c[N[L].index]=k):c[N[L].define]=!1}}else{c.PREPASS=!1;for(let Z=0;Z<N.length;Z++)c[N[Z].define]=!1}c.PREPASS!=k&&(c.markAsUnprocessed(),c.markAsImageProcessingDirty())}function Q(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];N&&N.push("Light"+Z),R||(c.push("vLightData"+Z,"vLightDiffuse"+Z,"vLightSpecular"+Z,"vLightDirection"+Z,"vLightWidth"+Z,"vLightHeight"+Z,"vLightFalloff"+Z,"vLightGround"+Z,"lightMatrix"+Z,"shadowsInfo"+Z,"depthValues"+Z),L.push("shadowTexture"+Z),L.push("depthTexture"+Z),c.push("viewFrustumZ"+Z,"cascadeBlendFactor"+Z,"lightSizeUVCorrection"+Z,"depthCorrection"+Z,"penumbraDarkness"+Z,"frustumLengths"+Z),k&&(L.push("projectionLightTexture"+Z),c.push("textureProjectionMatrix"+Z)),G&&L.push("iesLightTexture"+Z))}function r(Z,c,L){let k,N,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(Z.uniformsNames){const G=Z;k=G.uniformsNames,N=G.uniformBuffersNames,c=G.samplers,L=G.defines,R=G.maxSimultaneousLights||0}else k=Z,c||(c=[]);for(let G=0;G<R&&L["LIGHT"+G];G++)Q(G,k,c,L["PROJECTEDLIGHTTEXTURE"+G],N,!1,L["IESLIGHTTEXTURE"+G]);L.NUM_MORPH_INFLUENCERS&&(k.push("morphTargetInfluences"),k.push("morphTargetCount")),L.BAKED_VERTEX_ANIMATION_TEXTURE&&(k.push("bakedVertexAnimationSettings"),k.push("bakedVertexAnimationTextureSizeInverted"),k.push("bakedVertexAnimationTime"),c.push("bakedVertexAnimationTexture"))}},11701:(Z,c,L)=>{L.d(c,{d:()=>R});var k,N=L(10993);!function(Z){Z[Z.Zero=0]="Zero",Z[Z.One=1]="One",Z[Z.MaxViewZ=2]="MaxViewZ"}(k||(k={}));class R{static CreateConfiguration(Z){return R._Configurations[Z]={defines:{},previousWorldMatrices:{},previousViewProjection:N.b.Zero(),currentViewProjection:N.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},R._Configurations[Z]}static DeleteConfiguration(Z){delete R._Configurations[Z]}static GetConfiguration(Z){return R._Configurations[Z]}static AddUniformsAndSamplers(Z,c){Z.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(Z,c){for(const L of c)if(L.ec)for(const c of L.ec)c._removeDrawWrapper(Z)}static PrepareDefines(Z,c,L){if(!L._arePrePassDirty)return;const k=R._Configurations[Z];if(!k)return;L.PREPASS=!0,L.PREPASS_COLOR=!1,L.PREPASS_COLOR_INDEX=-1;let N=0;for(let G=0;G<R.GeometryTextureDescriptions.length;G++){const Z=R.GeometryTextureDescriptions[G],c=Z.define,V=Z.defineIndex,p=k.defines[V];void 0!==p?(L[c]=!0,L[V]=p,N++):(L[c]=!1,delete L[V])}L.SCENE_MRT_COUNT=N,L.BONES_VELOCITY_ENABLED=c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&!c.skeleton.isUsingTextureForMatrices&&-1===k.excludedSkinnedMesh.indexOf(c)}static Bind(Z,c,L,k,N){const G=R._Configurations[Z];if(!G)return;const V=L.XZ(),p=V.getEngine();if(G.reverseCulling&&p.setStateCullFaceType(V._mirroredCameraPosition?N.cullBackFaces:!N.cullBackFaces),(void 0!==G.defines.PREPASS_VELOCITY_INDEX||void 0!==G.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(G.previousWorldMatrices[L.uniqueId]||(G.previousWorldMatrices[L.uniqueId]=k.clone()),G.previousViewProjection||(G.previousViewProjection=V.getTransformMatrix().clone(),G.currentViewProjection=V.getTransformMatrix().clone()),G.currentViewProjection.updateFlag!==V.getTransformMatrix().updateFlag?(G.lastUpdateFrameId=p.frameId,G.previousViewProjection.R(G.currentViewProjection),G.currentViewProjection.R(V.getTransformMatrix())):G.lastUpdateFrameId!==p.frameId&&(G.lastUpdateFrameId=p.frameId,G.previousViewProjection.R(G.currentViewProjection)),c.setMatrix("previousWorld",G.previousWorldMatrices[L.uniqueId]),c.setMatrix("previousViewProjection",G.previousViewProjection),G.previousWorldMatrices[L.uniqueId]=k.clone(),L.useBones&&L.computeBonesUsingShaders&&L.skeleton)){const Z=L.skeleton;if(!Z.isUsingTextureForMatrices||-1===c.getUniformIndex("boneTextureWidth")){const k=Z.getTransformMatrices(L);k&&(G.previousBones[L.uniqueId]||(G.previousBones[L.uniqueId]=k.slice()),c.setMatrices("mPreviousBones",G.previousBones[L.uniqueId]),G.previousBones[L.uniqueId].set(k))}}}}R.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],R._Configurations={}},11652:(Z,c,L)=>{L.d(c,{c:()=>w});var k=L(11170),N=L(11173),R=L(11163),G=L(11023),V=L(11095),p=L(11124);const J=new RegExp("^([gimus]+)!");class z{constructor(Z){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=Z,this._scene=Z.XZ(),this._engine=this._scene.getEngine()}_addPlugin(Z){for(let k=0;k<this._plugins.length;++k)if(this._plugins[k].name===Z.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!Z.isCompatible(this._material.shaderLanguage))throw`The plugin "${Z.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const c=Z.getClassName();z._MaterialPluginClassToMainDefine[c]||(z._MaterialPluginClassToMainDefine[c]="MATERIALPLUGIN_"+ ++z._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(Z,c)=>this._handlePluginEvent(Z,c),this._plugins.push(Z),this._plugins.sort(((Z,c)=>Z.priority-c.priority)),this._codeInjectionPoints={};const L={};L[z._MaterialPluginClassToMainDefine[c]]={type:"boolean",default:!0};for(const k of this._plugins)k.collectDefines(L),this._collectPointNames("vertex",k.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",k.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=L,!0}_activatePlugin(Z){-1===this._activePlugins.indexOf(Z)&&(this._activePlugins.push(Z),this._activePlugins.sort(((Z,c)=>Z.priority-c.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),Z.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(Z),this._activePluginsForExtraEvents.sort(((Z,c)=>Z.priority-c.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(Z){for(let c=0;c<this._plugins.length;++c)if(this._plugins[c].name===Z)return this._plugins[c];return null}_handlePluginEventIsReadyForSubMesh(Z){let c=!0;for(const L of this._activePlugins)c=c&&L.isReadyForSubMesh(Z.defines,this._scene,this._engine,Z.subMesh);Z.isReadyForSubMesh=c}_handlePluginEventPrepareDefinesBeforeAttributes(Z){for(const c of this._activePlugins)c.prepareDefinesBeforeAttributes(Z.defines,this._scene,Z.mesh)}_handlePluginEventPrepareDefines(Z){for(const c of this._activePlugins)c.prepareDefines(Z.defines,this._scene,Z.mesh)}_handlePluginEventHardBindForSubMesh(Z){for(const c of this._activePluginsForExtraEvents)c.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,Z.subMesh)}_handlePluginEventBindForSubMesh(Z){for(const c of this._activePlugins)c.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,Z.subMesh)}_handlePluginEventHasRenderTargetTextures(Z){let c=!1;for(const L of this._activePluginsForExtraEvents)if(c=L.hasRenderTargetTextures(),c)break;Z.hasRenderTargetTextures=c}_handlePluginEventFillRenderTargetTextures(Z){for(const c of this._activePluginsForExtraEvents)c.fillRenderTargetTextures(Z.renderTargets)}_handlePluginEvent(Z,c){switch(Z){case 512:{const Z=c;for(const c of this._activePlugins)c.getActiveTextures(Z.activeTextures);break}case 256:{const Z=c;for(const c of this._activePlugins)c.getAnimatables(Z.animatables);break}case 1024:{const Z=c;let L=!1;for(const c of this._activePlugins)if(L=c.hasTexture(Z.texture),L)break;Z.hasTexture=L;break}case 2:{const Z=c;for(const c of this._plugins)c.dispose(Z.forceDisposeTextures);break}case 4:c.defineNames=this._defineNamesFromPlugins;break;case 128:{const Z=c;for(const c of this._activePlugins)Z.fallbackRank=c.addFallbacks(Z.defines,Z.fallbacks,Z.fallbackRank),c.getAttributes(Z.attributes,this._scene,Z.mesh);this._uniformList.length>0&&Z.uniforms.push(...this._uniformList),this._samplerList.length>0&&Z.samplers.push(...this._samplerList),this._uboList.length>0&&Z.uniformBuffersNames.push(...this._uboList),Z.customCode=this._injectCustomCode(Z,Z.customCode);break}case 8:{const Z=c;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const L=1===this._material.shaderLanguage;for(const c of this._plugins){const k=c.getUniforms(this._material.shaderLanguage);if(k){if(k.ubo)for(const c of k.ubo){if(c.size&&c.type){const k=c.arraySize??0;if(Z.ubo.addUniform(c.name,c.size,k),L){let Z;switch(c.type){case"mat4":Z="mat4x4f";break;case"float":Z="f32";break;default:Z=`${c.type}f`}this._uboDeclaration+=k>0?`uniform ${c.name}: array<${Z}, ${k}>;\n`:`uniform ${c.name}: ${Z};\n`}else this._uboDeclaration+=`${c.type} ${c.name}${k>0?`[${k}]`:""};\n`}this._uniformList.push(c.name)}k.vertex&&(this._vertexDeclaration+=k.vertex+"\n"),k.fragment&&(this._fragmentDeclaration+=k.fragment+"\n")}c.getSamplers(this._samplerList),c.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(Z,c){if(c)for(const L in c)this._codeInjectionPoints[Z]||(this._codeInjectionPoints[Z]={}),this._codeInjectionPoints[Z][L]=!0}_injectCustomCode(Z,c){return(L,k)=>{var N;c&&(k=c(L,k)),this._uboDeclaration&&(k=k.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(k=k.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(k=k.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const R=null===(N=this._codeInjectionPoints)||void 0===N?void 0:N[L];if(!R)return k;let G=null;for(let c in R){let N="";for(const k of this._activePlugins){var z;let R=null===(z=k.getCustomCode(L,this._material.shaderLanguage))||void 0===z?void 0:z[c];if(R){if(k.resolveIncludes){if(null===G){const c=0;G={defines:[],indexParameters:Z.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:p.e.GetShadersRepository(c),includesShadersStore:p.e.GetIncludesShadersStore(c),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}G.isFragment="fragment"===L,(0,V.h)(R,G,(Z=>R=Z))}N+=R+"\n"}}if(N.length>0)if("!"===c.charAt(0)){c=c.substring(1);let Z="g";if("!"===c.charAt(0))Z="",c=c.substring(1);else{const L=J.exec(c);L&&L.length>=2&&(Z=L[1],c=c.substring(Z.length+1))}Z.indexOf("g")<0&&(Z+="g");const L=k,R=new RegExp(c,Z);let G=R.exec(L);for(;null!==G;){let Z=N;for(let c=0;c<G.length;++c)Z=Z.replace("$"+c,G[c]);k=k.replace(G[0],Z),G=R.exec(L)}}else{const Z="#define "+c;k=k.replace(Z,"\n"+N+"\n"+Z)}}return k}}}z._MaterialPluginClassToMainDefine={},z._MaterialPluginCounter=0,G.d.OnEnginesDisposedObservable.add((()=>{x()}));const i=[];let t=!1,E=null;function x(){i.length=0,t=!1,R.e.OnEventObservable.remove(E),E=null}var q=L(11242),O=L(11012);class w{isCompatible(Z){return 0===Z}_enable(Z){Z&&this._pluginManager._activatePlugin(this)}constructor(Z,c,L,k){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=Z,this.name=c,this.priority=L,this.resolveIncludes=G,Z.pluginManager||(Z.pluginManager=new z(Z),Z.Xc.add((()=>{Z.pluginManager=void 0}))),this._pluginDefineNames=k,this._pluginManager=Z.pluginManager,N&&this._pluginManager._addPlugin(this),R&&this._enable(!0),this.markAllDefinesAsDirty=Z._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(Z,c,L,k){return!0}hardBindForSubMesh(Z,c,L,k){}bindForSubMesh(Z,c,L,k){}dispose(Z){}getCustomCode(Z){return null}collectDefines(Z){if(this._pluginDefineNames)for(const c of Object.keys(this._pluginDefineNames)){if("_"===c[0])continue;const L=typeof this._pluginDefineNames[c];Z[c]={type:"number"===L?"number":"string"===L?"string":"boolean"===L?"boolean":"object",default:this._pluginDefineNames[c]}}}prepareDefinesBeforeAttributes(Z,c,L){}prepareDefines(Z,c,L){}hasTexture(Z){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(Z){}getActiveTextures(Z){}getAnimatables(Z){}addFallbacks(Z,c,L){return L}getSamplers(Z){}getAttributes(Z,c,L){}getUniformBuffersNames(Z){}getUniforms(){return{}}copyTo(Z){q.e.Clone((()=>Z),this)}serialize(){return q.e.Serialize(this)}parse(Z,c,L){q.e.Parse((()=>this),Z,c,L)}}(0,k.d)([(0,N.H)()],w.prototype,"name",void 0),(0,k.d)([(0,N.H)()],w.prototype,"priority",void 0),(0,k.d)([(0,N.H)()],w.prototype,"resolveIncludes",void 0),(0,k.d)([(0,N.H)()],w.prototype,"registerForExtraEvents",void 0),(0,O.g)("BABYLON.MaterialPluginBase",w)},11380:(Z,c,L)=>{L.d(c,{e:()=>G});var k=L(11163),N=L(11251),R=L(11012);class G extends k.e{get Ic(){return this._subMaterials}set Ic(Z){this._subMaterials=Z,this._hookArray(Z)}getChildren(){return this.Ic}constructor(Z,c){super(Z,c,!0),this._waitingSubMaterialsUniqueIds=[],this.XZ().addMultiMaterial(this),this.Ic=[],this._storeEffectOnSubMeshes=!0}_hookArray(Z){var c=this;const L=Z.push;Z.push=function(){for(var k=arguments.length,N=new Array(k),R=0;R<k;R++)N[R]=arguments[R];const G=L.apply(Z,N);return c._markAllSubMeshesAsTexturesDirty(),G};const k=Z.splice;Z.splice=(c,L)=>{const N=k.apply(Z,[c,L]);return this._markAllSubMeshesAsTexturesDirty(),N}}getSubMaterial(Z){return Z<0||Z>=this.Ic.length?this.XZ().defaultMaterial:this.Ic[Z]}getActiveTextures(){return super.getActiveTextures().concat(...this.Ic.map((Z=>Z?Z.getActiveTextures():[])))}hasTexture(Z){if(super.hasTexture(Z))return!0;for(let L=0;L<this.Ic.length;L++){var c;if(null!==(c=this.Ic[L])&&void 0!==c&&c.hasTexture(Z))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(Z,c,L){for(let k=0;k<this.Ic.length;k++){const N=this.Ic[k];if(N){if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(Z,c,L))return!1;continue}if(!N.isReady(Z))return!1}}return!0}clone(Z,c){const L=new G(Z,this.XZ());for(let k=0;k<this.Ic.length;k++){let N=null;const R=this.Ic[k];N=c&&R?R.clone(Z+"-"+R.name):this.Ic[k],L.Ic.push(N)}return L}serialize(){const Z={};Z.name=this.name,Z.id=this.id,Z.uniqueId=this.uniqueId,N.b&&(Z.tags=N.b.GetTags(this)),Z.materialsUniqueIds=[],Z.materials=[];for(let c=0;c<this.Ic.length;c++){const L=this.Ic[c];L?(Z.materialsUniqueIds.push(L.uniqueId),Z.materials.push(L.id)):(Z.materialsUniqueIds.push(null),Z.materials.push(null))}return Z}dispose(Z,c,L){const k=this.XZ();if(!k)return;if(L)for(let R=0;R<this.Ic.length;R++){const L=this.Ic[R];L&&L.dispose(Z,c)}const N=k.multiMaterials.indexOf(this);N>=0&&k.multiMaterials.splice(N,1),super.dispose(Z,c)}static ParseMultiMaterial(Z,c){const L=new G(Z.name,c);if(L.id=Z.id,L._loadedUniqueId=Z.uniqueId,N.b&&N.b.AddTagsTo(L,Z.tags),Z.materialsUniqueIds)L._waitingSubMaterialsUniqueIds=Z.materialsUniqueIds;else for(const k of Z.materials)L.Ic.push(c.getLastMaterialById(k));return L}}(0,R.g)("BABYLON.MultiMaterial",G)},11661:(Z,c,L)=>{L.d(c,{b:()=>k});class k{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(Z){Z.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(Z){}bindForSubMesh(Z,c,L,k,N){if(c.prePassRenderer&&c.prePassRenderer.enabled&&c.prePassRenderer.currentRTisSceneRT&&(-1!==c.prePassRenderer.getIndex(2)||-1!==c.prePassRenderer.getIndex(11))){this.previousWorldMatrices[L.uniqueId]||(this.previousWorldMatrices[L.uniqueId]=k.clone()),this.previousViewProjection||(this.previousViewProjection=c.getTransformMatrix().clone(),this.currentViewProjection=c.getTransformMatrix().clone());const N=c.getEngine();this.currentViewProjection.updateFlag!==c.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.R(this.currentViewProjection),this.currentViewProjection.R(c.getTransformMatrix())):this._lastUpdateFrameId!==N.frameId&&(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.R(this.currentViewProjection)),Z.setMatrix("previousWorld",this.previousWorldMatrices[L.uniqueId]),Z.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[L.uniqueId]=k.clone()}}}},11663:(Z,c,L)=>{L.d(c,{b:()=>R});var k=L(10993),N=L(11163);class R extends N.e{constructor(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(Z,c,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new k.b,this._storeEffectOnSubMeshes=L}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(Z,c){return!!Z&&(!this._storeEffectOnSubMeshes||(!Z.ec||0===Z.ec.length||this.isReadyForSubMesh(Z,Z.ec[0],c)))}_isReadyForSubMesh(Z){const c=Z.materialDefines;return!(this.checkReadyOnEveryCall||!Z.effect||!c||c._renderId!==this.XZ().getRenderId())}bindOnlyWorldMatrix(Z){this._activeEffect.setMatrix("world",Z)}bindOnlyNormalMatrix(Z){this._activeEffect.setMatrix("normalMatrix",Z)}bind(Z,c){c&&this.bindForSubMesh(Z,c,c.ec[0])}_afterBind(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;super._afterBind(Z,c,L),this.XZ()._cachedEffect=c,L?L._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return L._drawWrapper._forceRebindOnNextCall||Z.isCachedMaterialInvalid(this,c,k)}dispose(Z,c,L){this._activeEffect=void 0,super.dispose(Z,c,L)}}},11741:(Z,c,L)=>{L.d(c,{b:()=>O});var k=L(11242),N=L(11588),R=L(10993),G=L(11190),V=L(11508),p=L(11012),J=L(11688),z=L(11079),i=L(11663),t=L(11023),E=L(11268),x=L(11258);const q={effect:null,subMesh:null};class O extends i.b{constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(Z,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new R.b,this._cachedWorldViewProjectionMatrix=new R.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=L,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","kc","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...k}}get shaderPath(){return this._shaderPath}set shaderPath(Z){this._shaderPath=Z}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(Z){-1===this._options.uniforms.indexOf(Z)&&this._options.uniforms.push(Z)}setTexture(Z,c){return-1===this._options.samplers.indexOf(Z)&&this._options.samplers.push(Z),this._textures[Z]=c,this}removeTexture(Z){delete this._textures[Z]}setTextureArray(Z,c){return-1===this._options.samplers.indexOf(Z)&&this._options.samplers.push(Z),this._checkUniform(Z),this._textureArrays[Z]=c,this}setExternalTexture(Z,c){return-1===this._options.externalTextures.indexOf(Z)&&this._options.externalTextures.push(Z),this._externalTextures[Z]=c,this}setFloat(Z,c){return this._checkUniform(Z),this._floats[Z]=c,this}setInt(Z,c){return this._checkUniform(Z),this._ints[Z]=c,this}setUInt(Z,c){return this._checkUniform(Z),this._uints[Z]=c,this}setFloats(Z,c){return this._checkUniform(Z),this._floatsArrays[Z]=c,this}setColor3(Z,c){return this._checkUniform(Z),this._colors3[Z]=c,this}setColor3Array(Z,c){return this._checkUniform(Z),this._colors3Arrays[Z]=c.reduce(((Z,c)=>(Z.push(c.r,c.g,c.b),Z)),[]),this}setColor4(Z,c){return this._checkUniform(Z),this._colors4[Z]=c,this}setColor4Array(Z,c){return this._checkUniform(Z),this._colors4Arrays[Z]=c.reduce(((Z,c)=>(Z.push(c.r,c.g,c.b,c.a),Z)),[]),this}setVector2(Z,c){return this._checkUniform(Z),this._vectors2[Z]=c,this}setVector3(Z,c){return this._checkUniform(Z),this._vectors3[Z]=c,this}setVector4(Z,c){return this._checkUniform(Z),this._vectors4[Z]=c,this}setQuaternion(Z,c){return this._checkUniform(Z),this._quaternions[Z]=c,this}setQuaternionArray(Z,c){return this._checkUniform(Z),this._quaternionsArrays[Z]=c.reduce(((Z,c)=>(c.toArray(Z,Z.length),Z)),[]),this}setMatrix(Z,c){return this._checkUniform(Z),this._matrices[Z]=c,this}setMatrices(Z,c){this._checkUniform(Z);const L=new Float32Array(16*c.length);for(let k=0;k<c.length;k++){c[k].copyToArray(L,16*k)}return this._matrixArrays[Z]=L,this}setMatrix3x3(Z,c){return this._checkUniform(Z),this._matrices3x3[Z]=c,this}setMatrix2x2(Z,c){return this._checkUniform(Z),this._matrices2x2[Z]=c,this}setArray2(Z,c){return this._checkUniform(Z),this._vectors2Arrays[Z]=c,this}setArray3(Z,c){return this._checkUniform(Z),this._vectors3Arrays[Z]=c,this}setArray4(Z,c){return this._checkUniform(Z),this._vectors4Arrays[Z]=c,this}setUniformBuffer(Z,c){return-1===this._options.uniformBuffers.indexOf(Z)&&this._options.uniformBuffers.push(Z),this._uniformBuffers[Z]=c,this}setTextureSampler(Z,c){return-1===this._options.samplerObjects.indexOf(Z)&&this._options.samplerObjects.push(Z),this._textureSamplers[Z]=c,this}setStorageBuffer(Z,c){return-1===this._options.storageBuffers.indexOf(Z)&&this._options.storageBuffers.push(Z),this._storageBuffers[Z]=c,this}setDefine(Z,c){const L=Z.trimEnd()+" ",k=this.options.defines.findIndex((c=>c===Z||c.startsWith(L)));return k>=0&&this.options.defines.splice(k,1),("boolean"!==typeof c||c)&&this.options.defines.push(L+c),this}isReadyForSubMesh(Z,c,L){return this.isReady(Z,L,c)}isReady(Z,c,L){var k;const R=L&&this._storeEffectOnSubMeshes;if(this.isFrozen){const Z=R?L._drawWrapper:this._drawWrapper;if(Z.effect&&Z._wasPreviouslyReady&&Z._wasPreviouslyUsingInstances===c)return!0}const V=this.XZ(),p=V.getEngine(),z=[],i=[];let t=null,O=this._shaderPath,w=this._options.uniforms,M=this._options.uniformBuffers,P=this._options.samplers;p.getCaps().multiview&&V.activeCamera&&V.activeCamera.outputRenderTarget&&V.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,z.push("#define MULTIVIEW"),-1!==w.indexOf("viewProjection")&&-1===w.indexOf("viewProjectionR")&&w.push("viewProjectionR"));for(let N=0;N<this._options.defines.length;N++){const Z=0===this._options.defines[N].indexOf("#define")?this._options.defines[N]:`#define ${this._options.defines[N]}`;z.push(Z)}for(let N=0;N<this._options.attributes.length;N++)i.push(this._options.attributes[N]);if(Z&&Z.isVerticesDataPresent(G.g.ColorKind)&&(-1===i.indexOf(G.g.ColorKind)&&i.push(G.g.ColorKind),z.push("#define VERTEXCOLOR")),c&&(z.push("#define INSTANCES"),(0,x.ab)(i,this._materialHelperNeedsPreviousMatrices),null!==Z&&void 0!==Z&&Z.hasThinInstances&&(z.push("#define THIN_INSTANCES"),Z&&Z.isVerticesDataPresent(G.g.ColorInstanceKind)&&(i.push(G.g.ColorInstanceKind),z.push("#define INSTANCESCOLOR")))),Z&&Z.useBones&&Z.computeBonesUsingShaders&&Z.skeleton){i.push(G.g.MatricesIndicesKind),i.push(G.g.MatricesWeightsKind),Z.numBoneInfluencers>4&&(i.push(G.g.MatricesIndicesExtraKind),i.push(G.g.MatricesWeightsExtraKind));const c=Z.skeleton;z.push("#define NUM_BONE_INFLUENCERS "+Z.numBoneInfluencers),t=new J.c,t.addCPUSkinningFallback(0,Z),c.isUsingTextureForMatrices?(z.push("#define BONETEXTURE"),-1===w.indexOf("boneTextureWidth")&&w.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(z.push("#define BonesPerMesh "+(c.bones.length+1)),-1===w.indexOf("mBones")&&w.push("mBones"))}else z.push("#define NUM_BONE_INFLUENCERS 0");let j=0;const o=Z?Z.morphTargetManager:null;if(o){const c=-1!==z.indexOf("#define UV1"),L=-1!==z.indexOf("#define UV2"),k=-1!==z.indexOf("#define TANGENT"),N=-1!==z.indexOf("#define NORMAL"),R=-1!==z.indexOf("#define VERTEXCOLOR");j=(0,x.I)(o,z,i,Z,!0,N,k,c,L,R),o.isUsingTextureForTargets&&(-1===w.indexOf("morphTargetTextureIndices")&&w.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),j>0&&(w=w.slice(),w.push("morphTargetInfluences"),w.push("morphTargetCount"),w.push("morphTargetTextureInfo"),w.push("morphTargetTextureIndices"))}else z.push("#define NUM_MORPH_INFLUENCERS 0");if(Z){const c=Z.bakedVertexAnimationManager;c&&c.isEnabled&&(z.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===w.indexOf("bakedVertexAnimationSettings")&&w.push("bakedVertexAnimationSettings"),-1===w.indexOf("bakedVertexAnimationTextureSizeInverted")&&w.push("bakedVertexAnimationTextureSizeInverted"),-1===w.indexOf("bakedVertexAnimationTime")&&w.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,x.B)(i,Z,z)}for(const N in this._textures)if(!this._textures[N].isReady())return!1;Z&&this.needAlphaTestingForMesh(Z)&&z.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,E.b)(w),(0,E.h)(this,V,z)),V.fogEnabled&&null!==Z&&void 0!==Z&&Z.applyFog&&V.fogMode!==N.d.FOGMODE_NONE&&(z.push("#define FOG"),-1===w.indexOf("view")&&w.push("view"),-1===w.indexOf("vFogInfos")&&w.push("vFogInfos"),-1===w.indexOf("vFogColor")&&w.push("vFogColor")),this._useLogarithmicDepth&&(z.push("#define LOGARITHMICDEPTH"),-1===w.indexOf("logarithmicDepthConstant")&&w.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(w=w.slice(),M=M.slice(),P=P.slice(),O=this.customShaderNameResolve(this.name,w,M,P,z,i));const u=R?L._getDrawWrapper(void 0,!0):this._drawWrapper,X=(null===u||void 0===u?void 0:u.effect)??null,h=(null===u||void 0===u?void 0:u.defines)??null,B=z.join("\n");let D=X;return h!==B&&(D=p.createEffect(O,{attributes:i,uniformsNames:w,uniformBuffersNames:M,samplers:P,defines:B,fallbacks:t,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:j},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},p),R?L.setEffect(D,B,this._materialContext):u&&u.setEffect(D,B),this._onEffectCreatedObservable&&(q.effect=D,q.subMesh=L??(null===Z||void 0===Z?void 0:Z.ec[0])??null,this._onEffectCreatedObservable.notifyObservers(q))),u._wasPreviouslyUsingInstances=!!c,!(null===(k=D)||void 0===k||!k.isReady())&&(X!==D&&V.resetCachedMaterial(),u._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(Z,c){const L=c??this.getEffect();if(!L)return;const k=this._options.uniforms;-1!==k.indexOf("world")&&L.setMatrix("world",Z);const N=this.XZ();-1!==k.indexOf("worldView")&&(Z.multiplyToRef(N.getViewMatrix(),this._cachedWorldViewMatrix),L.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==k.indexOf("worldViewProjection")&&(Z.multiplyToRef(N.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),L.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==k.indexOf("view")&&L.setMatrix("view",N.getViewMatrix())}bindForSubMesh(Z,c,L){var k;this.bind(Z,c,null===(k=L._drawWrapperOverride)||void 0===k?void 0:k.effect,L)}bind(Z,c,L,k){const N=k&&this._storeEffectOnSubMeshes,R=L??(N?k.effect:this.getEffect());if(!R)return;const G=this.XZ();this._activeEffect=R,this.bindOnlyWorldMatrix(Z,L);const V=this._options.uniformBuffers;let p=!1;if(R&&V&&V.length>0&&G.getEngine().supportsUniformBuffers)for(let i=0;i<V.length;++i){switch(V[i]){case"Mesh":c&&(c.getMeshUniformBuffer().bindToEffect(R,"Mesh"),c.transferToEffect(Z));break;case"Scene":(0,x.r)(R,G.getSceneUniformBuffer()),G.finalizeSceneUbo(),p=!0}}const J=c&&N?this._mustRebind(G,R,k,c.visibility):G.getCachedMaterial()!==this;if(R&&J){let Z;for(Z in p||-1===this._options.uniforms.indexOf("view")||R.setMatrix("view",G.getViewMatrix()),p||-1===this._options.uniforms.indexOf("projection")||R.setMatrix("projection",G.getProjectionMatrix()),p||-1===this._options.uniforms.indexOf("viewProjection")||(R.setMatrix("viewProjection",G.getTransformMatrix()),this._multiview&&R.setMatrix("viewProjectionR",G._transformMatrixR)),G.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&R.setVector3("cameraPosition",G.activeCamera.globalPosition),(0,x.b)(c,R),(0,E.e)(R,this,G),this._useLogarithmicDepth&&(0,x.k)(N?k.materialDefines:R.defines,R,G),c&&(0,x.d)(G,c,R),this._textures)R.setTexture(Z,this._textures[Z]);for(Z in this._textureArrays)R.setTextureArray(Z,this._textureArrays[Z]);for(Z in this._ints)R.setInt(Z,this._ints[Z]);for(Z in this._uints)R.setUInt(Z,this._uints[Z]);for(Z in this._floats)R.setFloat(Z,this._floats[Z]);for(Z in this._floatsArrays)R.setArray(Z,this._floatsArrays[Z]);for(Z in this._colors3)R.setColor3(Z,this._colors3[Z]);for(Z in this._colors3Arrays)R.setArray3(Z,this._colors3Arrays[Z]);for(Z in this._colors4){const c=this._colors4[Z];R.setFloat4(Z,c.r,c.g,c.b,c.a)}for(Z in this._colors4Arrays)R.setArray4(Z,this._colors4Arrays[Z]);for(Z in this._vectors2)R.setVector2(Z,this._vectors2[Z]);for(Z in this._vectors3)R.setVector3(Z,this._vectors3[Z]);for(Z in this._vectors4)R.setVector4(Z,this._vectors4[Z]);for(Z in this._quaternions)R.setQuaternion(Z,this._quaternions[Z]);for(Z in this._matrices)R.setMatrix(Z,this._matrices[Z]);for(Z in this._matrixArrays)R.setMatrices(Z,this._matrixArrays[Z]);for(Z in this._matrices3x3)R.setMatrix3x3(Z,this._matrices3x3[Z]);for(Z in this._matrices2x2)R.setMatrix2x2(Z,this._matrices2x2[Z]);for(Z in this._vectors2Arrays)R.setArray2(Z,this._vectors2Arrays[Z]);for(Z in this._vectors3Arrays)R.setArray3(Z,this._vectors3Arrays[Z]);for(Z in this._vectors4Arrays)R.setArray4(Z,this._vectors4Arrays[Z]);for(Z in this._quaternionsArrays)R.setArray4(Z,this._quaternionsArrays[Z]);for(Z in this._uniformBuffers){const c=this._uniformBuffers[Z].getBuffer();c&&R.bindUniformBuffer(c,Z)}const L=G.getEngine(),V=L.setExternalTexture;if(V)for(Z in this._externalTextures)V.call(L,Z,this._externalTextures[Z]);const J=L.setTextureSampler;if(J)for(Z in this._textureSamplers)J.call(L,Z,this._textureSamplers[Z]);const z=L.setStorageBuffer;if(z)for(Z in this._storageBuffers)z.call(L,Z,this._storageBuffers[Z])}if(R&&c&&(J||!this.isFrozen)){(0,x.n)(c,R),c.morphTargetManager&&c.morphTargetManager.isUsingTextureForTargets&&c.morphTargetManager._bind(R);const Z=c.bakedVertexAnimationManager;if(Z&&Z.isEnabled){var z;const Z=N?k._drawWrapper:this._drawWrapper;null===(z=c.bakedVertexAnimationManager)||void 0===z||z.bind(R,!!Z._wasPreviouslyUsingInstances)}}this._afterBind(c,R,k)}getActiveTextures(){const Z=super.getActiveTextures();for(const c in this._textures)Z.push(this._textures[c]);for(const c in this._textureArrays){const L=this._textureArrays[c];for(let c=0;c<L.length;c++)Z.push(L[c])}return Z}hasTexture(Z){if(super.hasTexture(Z))return!0;for(const c in this._textures)if(this._textures[c]===Z)return!0;for(const c in this._textureArrays){const L=this._textureArrays[c];for(let c=0;c<L.length;c++)if(L[c]===Z)return!0}return!1}clone(Z){const c=k.e.Clone((()=>new O(Z,this.XZ(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);c.name=Z,c.id=Z,"object"===typeof c._shaderPath&&(c._shaderPath={...c._shaderPath}),this._options={...this._options};const L=Object.keys(this._options);for(const k of L){const Z=this._options[k];Array.isArray(Z)&&(this._options[k]=Z.slice(0))}this.stencil.copyTo(c.stencil);for(const k in this._textures)c.setTexture(k,this._textures[k]);for(const k in this._textureArrays)c.setTextureArray(k,this._textureArrays[k]);for(const k in this._externalTextures)c.setExternalTexture(k,this._externalTextures[k]);for(const k in this._ints)c.setInt(k,this._ints[k]);for(const k in this._uints)c.setUInt(k,this._uints[k]);for(const k in this._floats)c.setFloat(k,this._floats[k]);for(const k in this._floatsArrays)c.setFloats(k,this._floatsArrays[k]);for(const k in this._colors3)c.setColor3(k,this._colors3[k]);for(const k in this._colors3Arrays)c._colors3Arrays[k]=this._colors3Arrays[k];for(const k in this._colors4)c.setColor4(k,this._colors4[k]);for(const k in this._colors4Arrays)c._colors4Arrays[k]=this._colors4Arrays[k];for(const k in this._vectors2)c.setVector2(k,this._vectors2[k]);for(const k in this._vectors3)c.setVector3(k,this._vectors3[k]);for(const k in this._vectors4)c.setVector4(k,this._vectors4[k]);for(const k in this._quaternions)c.setQuaternion(k,this._quaternions[k]);for(const k in this._quaternionsArrays)c._quaternionsArrays[k]=this._quaternionsArrays[k];for(const k in this._matrices)c.setMatrix(k,this._matrices[k]);for(const k in this._matrixArrays)c._matrixArrays[k]=this._matrixArrays[k].slice();for(const k in this._matrices3x3)c.setMatrix3x3(k,this._matrices3x3[k]);for(const k in this._matrices2x2)c.setMatrix2x2(k,this._matrices2x2[k]);for(const k in this._vectors2Arrays)c.setArray2(k,this._vectors2Arrays[k]);for(const k in this._vectors3Arrays)c.setArray3(k,this._vectors3Arrays[k]);for(const k in this._vectors4Arrays)c.setArray4(k,this._vectors4Arrays[k]);for(const k in this._uniformBuffers)c.setUniformBuffer(k,this._uniformBuffers[k]);for(const k in this._textureSamplers)c.setTextureSampler(k,this._textureSamplers[k]);for(const k in this._storageBuffers)c.setStorageBuffer(k,this._storageBuffers[k]);return c}dispose(Z,c,L){if(c){let Z;for(Z in this._textures)this._textures[Z].dispose();for(Z in this._textureArrays){const c=this._textureArrays[Z];for(let Z=0;Z<c.length;Z++)c[Z].dispose()}}this._textures={},super.dispose(Z,c,L)}serialize(){const Z=k.e.Serialize(this);let c;for(c in Z.customType="BABYLON.ShaderMaterial",Z.uniqueId=this.uniqueId,Z.options=this._options,Z.shaderPath=this._shaderPath,Z.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,Z.stencil=this.stencil.serialize(),Z.textures={},this._textures)Z.textures[c]=this._textures[c].serialize();for(c in Z.textureArrays={},this._textureArrays){Z.textureArrays[c]=[];const L=this._textureArrays[c];for(let k=0;k<L.length;k++)Z.textureArrays[c].push(L[k].serialize())}for(c in Z.ints={},this._ints)Z.ints[c]=this._ints[c];for(c in Z.uints={},this._uints)Z.uints[c]=this._uints[c];for(c in Z.floats={},this._floats)Z.floats[c]=this._floats[c];for(c in Z.floatsArrays={},this._floatsArrays)Z.floatsArrays[c]=this._floatsArrays[c];for(c in Z.colors3={},this._colors3){const L=this._colors3[c];Z.colors3[c]=[L.r,L.g,L.b]}for(c in Z.colors3Arrays={},this._colors3Arrays)Z.colors3Arrays[c]=this._colors3Arrays[c];for(c in Z.colors4={},this._colors4){const L=this._colors4[c];Z.colors4[c]=[L.r,L.g,L.b,L.a]}for(c in Z.colors4Arrays={},this._colors4Arrays)Z.colors4Arrays[c]=this._colors4Arrays[c];for(c in Z.vectors2={},this._vectors2){const L=this._vectors2[c];Z.vectors2[c]=[L.x,L.y]}for(c in Z.vectors3={},this._vectors3){const L=this._vectors3[c];Z.vectors3[c]=[L.x,L.y,L.z]}for(c in Z.vectors4={},this._vectors4){const L=this._vectors4[c];Z.vectors4[c]=[L.x,L.y,L.z,L.w]}for(c in Z.quaternions={},this._quaternions)Z.quaternions[c]=this._quaternions[c].xc();for(c in Z.matrices={},this._matrices)Z.matrices[c]=this._matrices[c].xc();for(c in Z.matrixArray={},this._matrixArrays)Z.matrixArray[c]=this._matrixArrays[c];for(c in Z.matrices3x3={},this._matrices3x3)Z.matrices3x3[c]=this._matrices3x3[c];for(c in Z.matrices2x2={},this._matrices2x2)Z.matrices2x2[c]=this._matrices2x2[c];for(c in Z.vectors2Arrays={},this._vectors2Arrays)Z.vectors2Arrays[c]=this._vectors2Arrays[c];for(c in Z.vectors3Arrays={},this._vectors3Arrays)Z.vectors3Arrays[c]=this._vectors3Arrays[c];for(c in Z.vectors4Arrays={},this._vectors4Arrays)Z.vectors4Arrays[c]=this._vectors4Arrays[c];for(c in Z.quaternionsArrays={},this._quaternionsArrays)Z.quaternionsArrays[c]=this._quaternionsArrays[c];return Z}static Parse(Z,c,L){const N=k.e.Parse((()=>new O(Z.name,c,Z.shaderPath,Z.options,Z.storeEffectOnSubMeshes)),Z,c,L);let G;for(G in Z.stencil&&N.stencil.parse(Z.stencil,c,L),Z.textures)N.setTexture(G,V.c.Parse(Z.textures[G],c,L));for(G in Z.textureArrays){const k=Z.textureArrays[G],R=[];for(let Z=0;Z<k.length;Z++)R.push(V.c.Parse(k[Z],c,L));N.setTextureArray(G,R)}for(G in Z.ints)N.setInt(G,Z.ints[G]);for(G in Z.uints)N.setUInt(G,Z.uints[G]);for(G in Z.floats)N.setFloat(G,Z.floats[G]);for(G in Z.floatsArrays)N.setFloats(G,Z.floatsArrays[G]);for(G in Z.colors3){const c=Z.colors3[G];N.setColor3(G,{r:c[0],g:c[1],b:c[2]})}for(G in Z.colors3Arrays){const c=Z.colors3Arrays[G].reduce(((Z,c,L)=>(L%3===0?Z.push([c]):Z[Z.length-1].push(c),Z)),[]).map((Z=>({r:Z[0],g:Z[1],b:Z[2]})));N.setColor3Array(G,c)}for(G in Z.colors4){const c=Z.colors4[G];N.setColor4(G,{r:c[0],g:c[1],b:c[2],a:c[3]})}for(G in Z.colors4Arrays){const c=Z.colors4Arrays[G].reduce(((Z,c,L)=>(L%4===0?Z.push([c]):Z[Z.length-1].push(c),Z)),[]).map((Z=>({r:Z[0],g:Z[1],b:Z[2],a:Z[3]})));N.setColor4Array(G,c)}for(G in Z.vectors2){const c=Z.vectors2[G];N.setVector2(G,{x:c[0],y:c[1]})}for(G in Z.vectors3){const c=Z.vectors3[G];N.setVector3(G,{x:c[0],y:c[1],z:c[2]})}for(G in Z.vectors4){const c=Z.vectors4[G];N.setVector4(G,{x:c[0],y:c[1],z:c[2],w:c[3]})}for(G in Z.quaternions)N.setQuaternion(G,R.c.oc(Z.quaternions[G]));for(G in Z.matrices)N.setMatrix(G,R.b.oc(Z.matrices[G]));for(G in Z.matrixArray)N._matrixArrays[G]=new Float32Array(Z.matrixArray[G]);for(G in Z.matrices3x3)N.setMatrix3x3(G,Z.matrices3x3[G]);for(G in Z.matrices2x2)N.setMatrix2x2(G,Z.matrices2x2[G]);for(G in Z.vectors2Arrays)N.setArray2(G,Z.vectors2Arrays[G]);for(G in Z.vectors3Arrays)N.setArray3(G,Z.vectors3Arrays[G]);for(G in Z.vectors4Arrays)N.setArray4(G,Z.vectors4Arrays[G]);for(G in Z.quaternionsArrays)N.setArray4(G,Z.quaternionsArrays[G]);return N}static async ParseFromFileAsync(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((N,R)=>{const G=new z.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const c=JSON.parse(G.responseText),R=this.Parse(c,L||t.d.LastCreatedScene,k);Z&&(R.name=Z),N(R)}else R("Unable to load the ShaderMaterial")})),G.open("GET",c),G.send()}))}static async ParseFromSnippetAsync(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((k,N)=>{const R=new z.b;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const N=JSON.parse(JSON.parse(R.responseText).jsonPayload),G=JSON.parse(N.shaderMaterial),V=this.Parse(G,c||t.d.LastCreatedScene,L);V.snippetId=Z,k(V)}else N("Unable to load the snippet "+Z)})),R.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),R.send()}))}}O.SnippetUrl="https://snippet.babylonjs.com",O.CreateFromSnippetAsync=O.ParseFromSnippetAsync,(0,p.g)("BABYLON.ShaderMaterial",O)},11708:(Z,c,L)=>{L.d(c,{c:()=>B});var k=L(11170),N=L(11173),R=L(11336),G=L(11588),V=L(11255),p=L(11190),J=L(11661),z=L(11592),i=L(11163),t=L(11650),E=L(11663),x=L(11508),q=L(11012),O=L(11669),w=L(11688),M=L(11697),P=L(11268),j=L(11258),o=L(11242),u=L(11701);const X={effect:null,subMesh:null};class h extends t.d{constructor(Z){super(Z),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(Z){const c=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const L of c)this[L]=L===Z}}class B extends E.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.XZ().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(Z){this._imageProcessingConfiguration.exposure=Z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(Z){this._imageProcessingConfiguration.contrast=Z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(Z){this._imageProcessingConfiguration.colorGradingTexture=Z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(Z){this._imageProcessingConfiguration.colorCurves=Z}get canRenderToMRT(){return!0}constructor(Z,c){super(Z,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||B.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new V.d(0,0,0),this.diffuseColor=new V.d(1,1,1),this.specularColor=new V.d(1,1,1),this.emissiveColor=new V.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new R.f(16),this._globalAmbientColor=new V.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new M.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new J.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),B.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),B.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(B.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(B.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"Sc"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===i.e.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Oc&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==i.e.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Oc||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(Z,c){let k=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const N=c._drawWrapper;if(N.effect&&this.isFrozen&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===k)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new h(this._eventInfo.defineNames));const R=this.XZ(),G=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const V=R.getEngine();G._needNormals=(0,j.O)(R,Z,G,!0,this._maxSimultaneousLights,this._disableLighting),(0,j.U)(R,G);const i=this.needAlphaBlendingForMesh(Z)&&this.XZ().useOrderIndependentTransparency;if((0,j.Y)(R,G,this.canRenderToMRT&&!i),(0,j.X)(R,G,i),u.d.PrepareDefines(V.currentRenderPassId,Z,G),G._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,G._needUVs=!1;for(let Z=1;Z<=6;++Z)G["MAINUV"+Z]=!1;if(R.texturesEnabled){if(G.DIFFUSEDIRECTUV=0,G.BUMPDIRECTUV=0,G.AMBIENTDIRECTUV=0,G.OPACITYDIRECTUV=0,G.EMISSIVEDIRECTUV=0,G.SPECULARDIRECTUV=0,G.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&B.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._diffuseTexture,G,"DIFFUSE")}else G.DIFFUSE=!1;if(this._ambientTexture&&B.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._ambientTexture,G,"AMBIENT")}else G.AMBIENT=!1;if(this._opacityTexture&&B.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._opacityTexture,G,"OPACITY"),G.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else G.OPACITY=!1;if(this._reflectionTexture&&B.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(G._needNormals=!0,G.REFLECTION=!0,G.ROUGHNESS=this._roughness>0,G.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,G.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===x.c.INVCUBIC_MODE,G.REFLECTIONMAP_3D=this._reflectionTexture.isCube,G.REFLECTIONMAP_OPPOSITEZ=G.REFLECTIONMAP_3D&&this.XZ().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,G.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case x.c.EXPLICIT_MODE:G.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case x.c.PLANAR_MODE:G.setReflectionMode("REFLECTIONMAP_PLANAR");break;case x.c.PROJECTION_MODE:G.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case x.c.SKYBOX_MODE:G.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case x.c.SPHERICAL_MODE:G.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case x.c.EQUIRECTANGULAR_MODE:G.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case x.c.FIXED_EQUIRECTANGULAR_MODE:G.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case x.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:G.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case x.c.CUBIC_MODE:case x.c.INVCUBIC_MODE:default:G.setReflectionMode("REFLECTIONMAP_CUBIC")}G.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else G.REFLECTION=!1,G.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&B.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._emissiveTexture,G,"EMISSIVE")}else G.EMISSIVE=!1;if(this._lightmapTexture&&B.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._lightmapTexture,G,"LIGHTMAP"),G.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,G.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else G.LIGHTMAP=!1;if(this._specularTexture&&B.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,j.P)(this._specularTexture,G,"SPECULAR"),G.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else G.SPECULAR=!1;if(R.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&B.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,j.P)(this._bumpTexture,G,"BUMP"),G.PARALLAX=this._useParallax,G.PARALLAX_RHS=R.useRightHandedSystem,G.PARALLAXOCCLUSION=this._useParallaxOcclusion,G.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else G.BUMP=!1,G.PARALLAX=!1,G.PARALLAX_RHS=!1,G.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&B.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;G._needUVs=!0,G.REFRACTION=!0,G.REFRACTIONMAP_3D=this._refractionTexture.isCube,G.RGBDREFRACTION=this._refractionTexture.isRGBD,G.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else G.REFRACTION=!1;G.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else G.DIFFUSE=!1,G.AMBIENT=!1,G.OPACITY=!1,G.REFLECTION=!1,G.EMISSIVE=!1,G.LIGHTMAP=!1,G.BUMP=!1,G.REFRACTION=!1;G.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),G.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,G.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,G.SPECULAROVERALPHA=this._useSpecularOverAlpha,G.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,G.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,G.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(Z)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=G,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(G._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(G),G.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,G.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(G._areFresnelDirty&&(B.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(G.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,G.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,G.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,G.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,G.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,G.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,G._needNormals=!0,G.FRESNEL=!0):G.FRESNEL=!1),G.AREALIGHTUSED)for(let L=0;L<Z.lightSources.length;L++)if(!Z.lightSources[L]._isReady())return!1;(0,j.T)(Z,R,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(Z),G,this._applyDecalMapAfterDetailMap),(0,j.M)(R,V,this,G,k,null,c.getRenderingMesh().hasThinInstances),this._eventInfo.defines=G,this._eventInfo.mesh=Z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,j.K)(Z,G,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let t=!1;if(G.isDirty){const k=G._areLightsDisposed;G.markAsProcessed();const N=new w.c;G.REFLECTION&&N.addFallback(0,"REFLECTION"),G.SPECULAR&&N.addFallback(0,"SPECULAR"),G.BUMP&&N.addFallback(0,"BUMP"),G.PARALLAX&&N.addFallback(1,"PARALLAX"),G.PARALLAX_RHS&&N.addFallback(1,"PARALLAX_RHS"),G.PARALLAXOCCLUSION&&N.addFallback(0,"PARALLAXOCCLUSION"),G.SPECULAROVERALPHA&&N.addFallback(0,"SPECULAROVERALPHA"),G.FOG&&N.addFallback(1,"FOG"),G.POINTSIZE&&N.addFallback(0,"POINTSIZE"),G.LOGARITHMICDEPTH&&N.addFallback(0,"LOGARITHMICDEPTH"),(0,j.y)(G,N,this._maxSimultaneousLights),G.SPECULARTERM&&N.addFallback(0,"SPECULARTERM"),G.DIFFUSEFRESNEL&&N.addFallback(1,"DIFFUSEFRESNEL"),G.OPACITYFRESNEL&&N.addFallback(2,"OPACITYFRESNEL"),G.REFLECTIONFRESNEL&&N.addFallback(3,"REFLECTIONFRESNEL"),G.EMISSIVEFRESNEL&&N.addFallback(4,"EMISSIVEFRESNEL"),G.FRESNEL&&N.addFallback(4,"FRESNEL"),G.MULTIVIEW&&N.addFallback(0,"MULTIVIEW");const i=[p.g.PositionKind];G.NORMAL&&i.push(p.g.NormalKind),G.TANGENT&&i.push(p.g.TangentKind);for(let Z=1;Z<=6;++Z)G["UV"+Z]&&i.push(`uv${1===Z?"":Z}`);G.VERTEXCOLOR&&i.push(p.g.ColorKind),(0,j.C)(i,Z,G,N),(0,j.E)(i,G),(0,j.G)(i,Z,G),(0,j.B)(i,Z,G);let E="default";const x=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],O=["Material","Scene","Mesh"],M={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:G.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=N,this._eventInfo.fallbackRank=0,this._eventInfo.defines=G,this._eventInfo.uniforms=x,this._eventInfo.attributes=i,this._eventInfo.samplers=q,this._eventInfo.uniformBuffersNames=O,this._eventInfo.customCode=void 0,this._eventInfo.mesh=Z,this._eventInfo.indexParameters=M,this._callbackPluginEventGeneric(128,this._eventInfo),u.d.AddUniformsAndSamplers(x,q),J.b.AddUniforms(x),J.b.AddSamplers(q),z.b&&(z.b.PrepareUniforms(x,G),z.b.PrepareSamplers(q,G)),(0,j._)({uniformsNames:x,uniformBuffersNames:O,samplers:q,defines:G,maxSimultaneousLights:this._maxSimultaneousLights}),(0,P.b)(x);const o={};this.customShaderNameResolve&&(E=this.customShaderNameResolve(E,x,O,q,G,i,o));const h=G.toString(),B=c.effect;let D=R.getEngine().createEffect(E,{attributes:i,uniformsNames:x,uniformBuffersNames:O,samplers:q,defines:h,fallbacks:N,onCompiled:this.onCompiled,onError:this.onError,indexParameters:M,processFinalCode:o.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:G.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([L.e(20),L.e(51)]).then(L.bind(L,14224)),Promise.all([L.e(18),L.e(52)]).then(L.bind(L,14235))]):await Promise.all([Promise.all([L.e(13),L.e(53)]).then(L.bind(L,14237)),Promise.all([L.e(12),L.e(54)]).then(L.bind(L,14249))]),this._shadersLoaded=!0}},V);if(this._eventInfo.customCode=void 0,D)if(this._onEffectCreatedObservable&&(X.effect=D,X.subMesh=c,this._onEffectCreatedObservable.notifyObservers(X)),this.allowShaderHotSwapping&&B&&!D.isReady()){if(D=B,G.markAsUnprocessed(),t=this.isFrozen,k)return G._areLightsDisposed=!0,!1}else R.resetCachedMaterial(),c.setEffect(D,G,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(G._renderId=R.getRenderId(),N._wasPreviouslyReady=!t,N._wasPreviouslyUsingInstances=k,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const Z=this._uniformBuffer;Z.addUniform("diffuseLeftColor",4),Z.addUniform("diffuseRightColor",4),Z.addUniform("opacityParts",4),Z.addUniform("reflectionLeftColor",4),Z.addUniform("reflectionRightColor",4),Z.addUniform("refractionLeftColor",4),Z.addUniform("refractionRightColor",4),Z.addUniform("emissiveLeftColor",4),Z.addUniform("emissiveRightColor",4),Z.addUniform("vDiffuseInfos",2),Z.addUniform("vAmbientInfos",2),Z.addUniform("vOpacityInfos",2),Z.addUniform("vReflectionInfos",2),Z.addUniform("vReflectionPosition",3),Z.addUniform("vReflectionSize",3),Z.addUniform("vEmissiveInfos",2),Z.addUniform("vLightmapInfos",2),Z.addUniform("vSpecularInfos",2),Z.addUniform("vBumpInfos",3),Z.addUniform("diffuseMatrix",16),Z.addUniform("ambientMatrix",16),Z.addUniform("opacityMatrix",16),Z.addUniform("reflectionMatrix",16),Z.addUniform("emissiveMatrix",16),Z.addUniform("lightmapMatrix",16),Z.addUniform("specularMatrix",16),Z.addUniform("bumpMatrix",16),Z.addUniform("vTangentSpaceParams",2),Z.addUniform("pointSize",1),Z.addUniform("alphaCutOff",1),Z.addUniform("refractionMatrix",16),Z.addUniform("vRefractionInfos",4),Z.addUniform("vRefractionPosition",3),Z.addUniform("vRefractionSize",3),Z.addUniform("vSpecularColor",4),Z.addUniform("vEmissiveColor",3),Z.addUniform("vDiffuseColor",4),Z.addUniform("vAmbientColor",3),Z.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(Z,c,L){const k=this.XZ(),N=L.materialDefines;if(!N)return;const R=L.effect;if(!R)return;this._activeEffect=R,c.getMeshUniformBuffer().bindToEffect(R,"Mesh"),c.transferToEffect(Z),this._uniformBuffer.bindToEffect(R,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,k,c,Z,this.isFrozen),u.d.Bind(k.getEngine().currentRenderPassId,this._activeEffect,c,Z,this);const p=k.activeCamera;p?this._uniformBuffer.updateFloat4("cameraInfo",p.Dc,p.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=L,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const J=this._mustRebind(k,R,L,c.visibility);(0,j.b)(c,R);const z=this._uniformBuffer;if(J){if(this.bindViewProjection(R),!z.useUbo||!this.isFrozen||!z.isSync||L._drawWrapper._forceRebindOnNextCall){if(B.FresnelEnabled&&N.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(z.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),z.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&z.updateColor4("opacityParts",new V.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(z.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),z.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(z.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),z.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(z.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),z.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),k.texturesEnabled){if(this._diffuseTexture&&B.DiffuseTextureEnabled&&(z.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,j.u)(this._diffuseTexture,z,"diffuse")),this._ambientTexture&&B.AmbientTextureEnabled&&(z.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,j.u)(this._ambientTexture,z,"ambient")),this._opacityTexture&&B.OpacityTextureEnabled&&(z.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,j.u)(this._opacityTexture,z,"opacity")),this._hasAlphaChannel()&&z.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&B.ReflectionTextureEnabled){if(z.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),z.hc("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const Z=this._reflectionTexture;z.updateVector3("vReflectionPosition",Z.boundingBoxPosition),z.updateVector3("vReflectionSize",Z.boundingBoxSize)}}else z.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&B.EmissiveTextureEnabled&&(z.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,j.u)(this._emissiveTexture,z,"emissive")),this._lightmapTexture&&B.LightmapTextureEnabled&&(z.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,j.u)(this._lightmapTexture,z,"lightmap")),this._specularTexture&&B.SpecularTextureEnabled&&(z.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,j.u)(this._specularTexture,z,"specular")),this._bumpTexture&&k.getEngine().getCaps().standardDerivatives&&B.BumpTextureEnabled&&(z.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,j.u)(this._bumpTexture,z,"bump"),k._mirroredCameraPosition?z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&B.RefractionTextureEnabled){let Z=1;if(this._refractionTexture.isCube||(z.hc("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(Z=this._refractionTexture.depth)),z.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,Z,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const Z=this._refractionTexture;z.updateVector3("vRefractionPosition",Z.boundingBoxPosition),z.updateVector3("vRefractionSize",Z.boundingBoxSize)}}}this.pointsCloud&&z.updateFloat("pointSize",this.pointSize),z.updateColor4("vSpecularColor",this.specularColor,this.specularPower),z.updateColor3("vEmissiveColor",B.EmissiveTextureEnabled?this.emissiveColor:V.d.BlackReadOnly),z.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),k.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),z.updateColor3("vAmbientColor",this._globalAmbientColor)}k.texturesEnabled&&(this._diffuseTexture&&B.DiffuseTextureEnabled&&R.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&B.AmbientTextureEnabled&&R.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&B.OpacityTextureEnabled&&R.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&B.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?R.setTexture("reflectionCubeSampler",this._reflectionTexture):R.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&B.EmissiveTextureEnabled&&R.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&B.LightmapTextureEnabled&&R.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&B.SpecularTextureEnabled&&R.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&k.getEngine().getCaps().standardDerivatives&&B.BumpTextureEnabled&&R.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&B.RefractionTextureEnabled&&(this._refractionTexture.isCube?R.setTexture("refractionCubeSampler",this._refractionTexture):R.setTexture("refraction2DSampler",this._refractionTexture))),this.XZ().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.XZ().depthPeelingRenderer.bind(R),this._eventInfo.subMesh=L,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,P.e)(R,this,k),this.bindEyePosition(R)}else k.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(J||!this.isFrozen){var i;if(k.lightsEnabled&&!this._disableLighting&&(0,j.g)(k,c,R,N,this._maxSimultaneousLights),(k.fogEnabled&&c.applyFog&&k.fogMode!==G.d.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||c.receiveShadows||N.PREPASS)&&this.bindView(R),(0,j.d)(k,c,R),N.NUM_MORPH_INFLUENCERS&&(0,j.n)(c,R),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(i=c.bakedVertexAnimationManager)||void 0===i||i.bind(R,N.INSTANCES);this.useLogarithmicDepth&&(0,j.k)(N,R,k),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(c,this._activeEffect,L),z.update()}getAnimatables(){const Z=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&Z.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&Z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&Z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&Z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&Z.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&Z.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&Z.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&Z.push(this._refractionTexture),Z}getActiveTextures(){const Z=super.getActiveTextures();return this._diffuseTexture&&Z.push(this._diffuseTexture),this._ambientTexture&&Z.push(this._ambientTexture),this._opacityTexture&&Z.push(this._opacityTexture),this._reflectionTexture&&Z.push(this._reflectionTexture),this._emissiveTexture&&Z.push(this._emissiveTexture),this._specularTexture&&Z.push(this._specularTexture),this._bumpTexture&&Z.push(this._bumpTexture),this._lightmapTexture&&Z.push(this._lightmapTexture),this._refractionTexture&&Z.push(this._refractionTexture),Z}hasTexture(Z){return!!super.hasTexture(Z)||(this._diffuseTexture===Z||(this._ambientTexture===Z||(this._opacityTexture===Z||(this._reflectionTexture===Z||(this._emissiveTexture===Z||(this._specularTexture===Z||(this._bumpTexture===Z||(this._lightmapTexture===Z||this._refractionTexture===Z))))))))}dispose(Z,c){var L,k,N,R,G,V,p,J,z;c&&(null===(L=this._diffuseTexture)||void 0===L||L.dispose(),null===(k=this._ambientTexture)||void 0===k||k.dispose(),null===(N=this._opacityTexture)||void 0===N||N.dispose(),null===(R=this._reflectionTexture)||void 0===R||R.dispose(),null===(G=this._emissiveTexture)||void 0===G||G.dispose(),null===(V=this._specularTexture)||void 0===V||V.dispose(),null===(p=this._bumpTexture)||void 0===p||p.dispose(),null===(J=this._lightmapTexture)||void 0===J||J.dispose(),null===(z=this._refractionTexture)||void 0===z||z.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(Z,c)}clone(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const k=o.e.Clone((()=>new B(Z,this.XZ())),this,{cloneTexturesOnlyOnce:c});return k.name=Z,k.id=Z,this.stencil.copyTo(k.stencil),this._clonePlugins(k,L),k}static Parse(Z,c,L){const k=o.e.Parse((()=>new B(Z.name,c)),Z,c,L);return Z.stencil&&k.stencil.parse(Z.stencil,c,L),i.e._ParsePlugins(Z,k,c,L),k}static get DiffuseTextureEnabled(){return O.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(Z){O.c.DiffuseTextureEnabled=Z}static get DetailTextureEnabled(){return O.c.DetailTextureEnabled}static set DetailTextureEnabled(Z){O.c.DetailTextureEnabled=Z}static get AmbientTextureEnabled(){return O.c.AmbientTextureEnabled}static set AmbientTextureEnabled(Z){O.c.AmbientTextureEnabled=Z}static get OpacityTextureEnabled(){return O.c.OpacityTextureEnabled}static set OpacityTextureEnabled(Z){O.c.OpacityTextureEnabled=Z}static get ReflectionTextureEnabled(){return O.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(Z){O.c.ReflectionTextureEnabled=Z}static get EmissiveTextureEnabled(){return O.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(Z){O.c.EmissiveTextureEnabled=Z}static get SpecularTextureEnabled(){return O.c.SpecularTextureEnabled}static set SpecularTextureEnabled(Z){O.c.SpecularTextureEnabled=Z}static get BumpTextureEnabled(){return O.c.BumpTextureEnabled}static set BumpTextureEnabled(Z){O.c.BumpTextureEnabled=Z}static get LightmapTextureEnabled(){return O.c.LightmapTextureEnabled}static set LightmapTextureEnabled(Z){O.c.LightmapTextureEnabled=Z}static get RefractionTextureEnabled(){return O.c.RefractionTextureEnabled}static set RefractionTextureEnabled(Z){O.c.RefractionTextureEnabled=Z}static get ColorGradingTextureEnabled(){return O.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(Z){O.c.ColorGradingTextureEnabled=Z}static get FresnelEnabled(){return O.c.FresnelEnabled}static set FresnelEnabled(Z){O.c.FresnelEnabled=Z}}B.ForceGLSL=!1,(0,k.d)([(0,N.A)("diffuseTexture")],B.prototype,"_diffuseTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],B.prototype,"diffuseTexture",void 0),(0,k.d)([(0,N.A)("ambientTexture")],B.prototype,"_ambientTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"ambientTexture",void 0),(0,k.d)([(0,N.A)("opacityTexture")],B.prototype,"_opacityTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],B.prototype,"opacityTexture",void 0),(0,k.d)([(0,N.A)("reflectionTexture")],B.prototype,"_reflectionTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"reflectionTexture",void 0),(0,k.d)([(0,N.A)("emissiveTexture")],B.prototype,"_emissiveTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"emissiveTexture",void 0),(0,k.d)([(0,N.A)("specularTexture")],B.prototype,"_specularTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"specularTexture",void 0),(0,k.d)([(0,N.A)("bumpTexture")],B.prototype,"_bumpTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"bumpTexture",void 0),(0,k.d)([(0,N.A)("lightmapTexture")],B.prototype,"_lightmapTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"lightmapTexture",void 0),(0,k.d)([(0,N.A)("refractionTexture")],B.prototype,"_refractionTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"refractionTexture",void 0),(0,k.d)([(0,N.m)("ambient")],B.prototype,"ambientColor",void 0),(0,k.d)([(0,N.m)("diffuse")],B.prototype,"diffuseColor",void 0),(0,k.d)([(0,N.m)("specular")],B.prototype,"specularColor",void 0),(0,k.d)([(0,N.m)("emissive")],B.prototype,"emissiveColor",void 0),(0,k.d)([(0,N.H)()],B.prototype,"specularPower",void 0),(0,k.d)([(0,N.H)("useAlphaFromDiffuseTexture")],B.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],B.prototype,"useAlphaFromDiffuseTexture",void 0),(0,k.d)([(0,N.H)("useEmissiveAsIllumination")],B.prototype,"_useEmissiveAsIllumination",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useEmissiveAsIllumination",void 0),(0,k.d)([(0,N.H)("linkEmissiveWithDiffuse")],B.prototype,"_linkEmissiveWithDiffuse",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"linkEmissiveWithDiffuse",void 0),(0,k.d)([(0,N.H)("useSpecularOverAlpha")],B.prototype,"_useSpecularOverAlpha",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useSpecularOverAlpha",void 0),(0,k.d)([(0,N.H)("useReflectionOverAlpha")],B.prototype,"_useReflectionOverAlpha",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useReflectionOverAlpha",void 0),(0,k.d)([(0,N.H)("disableLighting")],B.prototype,"_disableLighting",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsLightsDirty")],B.prototype,"disableLighting",void 0),(0,k.d)([(0,N.H)("useObjectSpaceNormalMap")],B.prototype,"_useObjectSpaceNormalMap",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useObjectSpaceNormalMap",void 0),(0,k.d)([(0,N.H)("useParallax")],B.prototype,"_useParallax",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useParallax",void 0),(0,k.d)([(0,N.H)("useParallaxOcclusion")],B.prototype,"_useParallaxOcclusion",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useParallaxOcclusion",void 0),(0,k.d)([(0,N.H)()],B.prototype,"parallaxScaleBias",void 0),(0,k.d)([(0,N.H)("roughness")],B.prototype,"_roughness",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"roughness",void 0),(0,k.d)([(0,N.H)()],B.prototype,"indexOfRefraction",void 0),(0,k.d)([(0,N.H)()],B.prototype,"invertRefractionY",void 0),(0,k.d)([(0,N.H)()],B.prototype,"alphaCutOff",void 0),(0,k.d)([(0,N.H)("useLightmapAsShadowmap")],B.prototype,"_useLightmapAsShadowmap",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useLightmapAsShadowmap",void 0),(0,k.d)([(0,N.q)("diffuseFresnelParameters")],B.prototype,"_diffuseFresnelParameters",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelDirty")],B.prototype,"diffuseFresnelParameters",void 0),(0,k.d)([(0,N.q)("opacityFresnelParameters")],B.prototype,"_opacityFresnelParameters",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],B.prototype,"opacityFresnelParameters",void 0),(0,k.d)([(0,N.q)("reflectionFresnelParameters")],B.prototype,"_reflectionFresnelParameters",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelDirty")],B.prototype,"reflectionFresnelParameters",void 0),(0,k.d)([(0,N.q)("refractionFresnelParameters")],B.prototype,"_refractionFresnelParameters",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelDirty")],B.prototype,"refractionFresnelParameters",void 0),(0,k.d)([(0,N.q)("emissiveFresnelParameters")],B.prototype,"_emissiveFresnelParameters",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelDirty")],B.prototype,"emissiveFresnelParameters",void 0),(0,k.d)([(0,N.H)("useReflectionFresnelFromSpecular")],B.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsFresnelDirty")],B.prototype,"useReflectionFresnelFromSpecular",void 0),(0,k.d)([(0,N.H)("useGlossinessFromSpecularMapAlpha")],B.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,k.d)([(0,N.H)("maxSimultaneousLights")],B.prototype,"_maxSimultaneousLights",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsLightsDirty")],B.prototype,"maxSimultaneousLights",void 0),(0,k.d)([(0,N.H)("invertNormalMapX")],B.prototype,"_invertNormalMapX",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"invertNormalMapX",void 0),(0,k.d)([(0,N.H)("invertNormalMapY")],B.prototype,"_invertNormalMapY",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"invertNormalMapY",void 0),(0,k.d)([(0,N.H)("twoSidedLighting")],B.prototype,"_twoSidedLighting",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"twoSidedLighting",void 0),(0,k.d)([(0,N.H)("applyDecalMapAfterDetailMap")],B.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,k.d)([(0,N.e)("_markAllSubMeshesAsMiscDirty")],B.prototype,"applyDecalMapAfterDetailMap",void 0),(0,q.g)("BABYLON.StandardMaterial",B),G.d.DefaultMaterialFactory=Z=>new B("default material",Z)},11236:(Z,c,L)=>{L.d(c,{c:()=>R});var k=L(11052),N=L(11038);class R{constructor(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=Z,this._noUBO=!Z.supportsUniformBuffers||N,this._dynamic=L,this._name=k??"no-name",this._data=c||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.hc=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.hc=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(Z){let c;if(c=Z<=2?Z:4,this._uniformLocationPointer%c!==0){const Z=this._uniformLocationPointer;this._uniformLocationPointer+=c-this._uniformLocationPointer%c;const L=this._uniformLocationPointer-Z;for(let c=0;c<L;c++)this._data.push(0)}}addUniform(Z,c){let L,k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[Z]){if(k>0){if(c instanceof Array)throw"addUniform should not be use with Array in UBO: "+Z;if(this._fillAlignment(4),this._uniformArraySizes[Z]={strideSize:c,arraySize:k},16==c)c*=k;else{c=c*k+(4-c)*k}L=[];for(let Z=0;Z<c;Z++)L.push(0)}else{if(c instanceof Array)L=c,c=L.length;else{L=[];for(let Z=0;Z<c;Z++)L.push(0)}this._fillAlignment(c)}this._uniformSizes[Z]=c,this._uniformLocations[Z]=this._uniformLocationPointer,this._uniformLocationPointer+=c;for(let Z=0;Z<c;Z++)this._data.push(L[Z]);this._needSync=!0}}addMatrix(Z,c){this.addUniform(Z,Array.prototype.slice.call(c.xc()))}addFloat2(Z,c,L){const k=[c,L];this.addUniform(Z,k)}addFloat3(Z,c,L,k){const N=[c,L,k];this.addUniform(Z,N)}addColor3(Z,c){const L=[c.r,c.g,c.b];this.addUniform(Z,L)}addColor4(Z,c,L){const k=[c.r,c.g,c.b,L];this.addUniform(Z,k)}addVector3(Z,c){const L=[c.x,c.y,c.z];this.addUniform(Z,L)}addMatrix3x3(Z){this.addUniform(Z,12)}addMatrix2x2(Z){this.addUniform(Z,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const Z=[];let c=0;for(const L in this._uniformLocations)if(Z.push(L),10===++c)break;return Z.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(Z,c){for(let L=0;L<Z.length;++L)if(Z[L]!==c[L])return!1;return!0}_copyBuffer(Z,c){for(let L=0;L<Z.length;++L)c[L]=Z[L]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(R._UpdatedUbosInFrame[this._name]||(R._UpdatedUbosInFrame[this._name]=0),R._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(Z,c,L){this._checkNewFrame();let N=this._uniformLocations[Z];if(void 0===N){if(this._buffer)return void k.e.Error("Cannot add an uniform after UBO has been created. uniformName="+Z);this.addUniform(Z,L),N=this._uniformLocations[Z]}if(this._buffer||this.create(),this._dynamic)for(let k=0;k<L;k++)this._bufferData[N+k]=c[k];else{let Z=!1;for(let k=0;k<L;k++)(16===L&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[N+k]!==Math.fround(c[k]))&&(Z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[N+k]=c[k]);this._needSync=this._needSync||Z}}updateUniformArray(Z,c,L){this._checkNewFrame();const R=this._uniformLocations[Z];if(void 0===R)return void k.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const G=this._uniformArraySizes[Z];if(this._dynamic)for(let k=0;k<L;k++)this._bufferData[R+k]=c[k];else{let Z=!1,k=0,V=0;for(let p=0;p<L;p++)if(this._bufferData[R+4*V+k]!==N.c.FloatRound(c[p])&&(Z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[R+4*V+k]=c[p]),k++,k===G.strideSize){for(;k<4;k++)this._bufferData[R+4*V+k]=0;k=0,V++}this._needSync=this._needSync||Z}}_cacheMatrix(Z,c){this._checkNewFrame();const L=this._valueCache[Z],k=c.updateFlag;return(void 0===L||L!==k)&&(this._valueCache[Z]=k,!0)}_updateMatrix3x3ForUniform(Z,c){for(let L=0;L<3;L++)R._TempBuffer[4*L]=c[3*L],R._TempBuffer[4*L+1]=c[3*L+1],R._TempBuffer[4*L+2]=c[3*L+2],R._TempBuffer[4*L+3]=0;this.updateUniform(Z,R._TempBuffer,12)}_updateMatrix3x3ForEffect(Z,c){this._currentEffect.setMatrix3x3(Z,c)}_updateMatrix2x2ForEffect(Z,c){this._currentEffect.setMatrix2x2(Z,c)}_updateMatrix2x2ForUniform(Z,c){for(let L=0;L<2;L++)R._TempBuffer[4*L]=c[2*L],R._TempBuffer[4*L+1]=c[2*L+1],R._TempBuffer[4*L+2]=0,R._TempBuffer[4*L+3]=0;this.updateUniform(Z,R._TempBuffer,8)}_updateFloatForEffect(Z,c){this._currentEffect.setFloat(Z,c)}_updateFloatForUniform(Z,c){R._TempBuffer[0]=c,this.updateUniform(Z,R._TempBuffer,1)}_updateFloat2ForEffect(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(Z+k,c,L)}_updateFloat2ForUniform(Z,c,L){R._TempBuffer[0]=c,R._TempBuffer[1]=L,this.updateUniform(Z,R._TempBuffer,2)}_updateFloat3ForEffect(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(Z+N,c,L,k)}_updateFloat3ForUniform(Z,c,L,k){R._TempBuffer[0]=c,R._TempBuffer[1]=L,R._TempBuffer[2]=k,this.updateUniform(Z,R._TempBuffer,3)}_updateFloat4ForEffect(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(Z+R,c,L,k,N)}_updateFloat4ForUniform(Z,c,L,k,N){R._TempBuffer[0]=c,R._TempBuffer[1]=L,R._TempBuffer[2]=k,R._TempBuffer[3]=N,this.updateUniform(Z,R._TempBuffer,4)}_updateFloatArrayForEffect(Z,c){this._currentEffect.setFloatArray(Z,c)}_updateFloatArrayForUniform(Z,c){this.updateUniformArray(Z,c,c.length)}_updateArrayForEffect(Z,c){this._currentEffect.setArray(Z,c)}_updateArrayForUniform(Z,c){this.updateUniformArray(Z,c,c.length)}_updateIntArrayForEffect(Z,c){this._currentEffect.setIntArray(Z,c)}_updateIntArrayForUniform(Z,c){R._TempBufferInt32View.set(c),this.updateUniformArray(Z,R._TempBuffer,c.length)}_updateUIntArrayForEffect(Z,c){this._currentEffect.setUIntArray(Z,c)}_updateUIntArrayForUniform(Z,c){R._TempBufferUInt32View.set(c),this.updateUniformArray(Z,R._TempBuffer,c.length)}_updateMatrixForEffect(Z,c){this._currentEffect.setMatrix(Z,c)}_updateMatrixForUniform(Z,c){this._cacheMatrix(Z,c)&&this.updateUniform(Z,c.xc(),16)}_updateMatricesForEffect(Z,c){this._currentEffect.setMatrices(Z,c)}_updateMatricesForUniform(Z,c){this.updateUniform(Z,c,c.length)}_updateVector3ForEffect(Z,c){this._currentEffect.setVector3(Z,c)}_updateVector3ForUniform(Z,c){R._TempBuffer[0]=c.x,R._TempBuffer[1]=c.y,R._TempBuffer[2]=c.z,this.updateUniform(Z,R._TempBuffer,3)}_updateVector4ForEffect(Z,c){this._currentEffect.setVector4(Z,c)}_updateVector4ForUniform(Z,c){R._TempBuffer[0]=c.x,R._TempBuffer[1]=c.y,R._TempBuffer[2]=c.z,R._TempBuffer[3]=c.w,this.updateUniform(Z,R._TempBuffer,4)}_updateColor3ForEffect(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(Z+L,c)}_updateColor3ForUniform(Z,c){R._TempBuffer[0]=c.r,R._TempBuffer[1]=c.g,R._TempBuffer[2]=c.b,this.updateUniform(Z,R._TempBuffer,3)}_updateColor4ForEffect(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(Z+k,c,L)}_updateDirectColor4ForEffect(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(Z+L,c)}_updateColor4ForUniform(Z,c,L){R._TempBuffer[0]=c.r,R._TempBuffer[1]=c.g,R._TempBuffer[2]=c.b,R._TempBuffer[3]=L,this.updateUniform(Z,R._TempBuffer,4)}_updateDirectColor4ForUniform(Z,c){R._TempBuffer[0]=c.r,R._TempBuffer[1]=c.g,R._TempBuffer[2]=c.b,R._TempBuffer[3]=c.a,this.updateUniform(Z,R._TempBuffer,4)}_updateIntForEffect(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(Z+L,c)}_updateIntForUniform(Z,c){R._TempBufferInt32View[0]=c,this.updateUniform(Z,R._TempBuffer,1)}_updateInt2ForEffect(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(Z+k,c,L)}_updateInt2ForUniform(Z,c,L){R._TempBufferInt32View[0]=c,R._TempBufferInt32View[1]=L,this.updateUniform(Z,R._TempBuffer,2)}_updateInt3ForEffect(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(Z+N,c,L,k)}_updateInt3ForUniform(Z,c,L,k){R._TempBufferInt32View[0]=c,R._TempBufferInt32View[1]=L,R._TempBufferInt32View[2]=k,this.updateUniform(Z,R._TempBuffer,3)}_updateInt4ForEffect(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(Z+R,c,L,k,N)}_updateInt4ForUniform(Z,c,L,k,N){R._TempBufferInt32View[0]=c,R._TempBufferInt32View[1]=L,R._TempBufferInt32View[2]=k,R._TempBufferInt32View[3]=N,this.updateUniform(Z,R._TempBuffer,4)}_updateUIntForEffect(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(Z+L,c)}_updateUIntForUniform(Z,c){R._TempBufferUInt32View[0]=c,this.updateUniform(Z,R._TempBuffer,1)}_updateUInt2ForEffect(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(Z+k,c,L)}_updateUInt2ForUniform(Z,c,L){R._TempBufferUInt32View[0]=c,R._TempBufferUInt32View[1]=L,this.updateUniform(Z,R._TempBuffer,2)}_updateUInt3ForEffect(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(Z+N,c,L,k)}_updateUInt3ForUniform(Z,c,L,k){R._TempBufferUInt32View[0]=c,R._TempBufferUInt32View[1]=L,R._TempBufferUInt32View[2]=k,this.updateUniform(Z,R._TempBuffer,3)}_updateUInt4ForEffect(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(Z+R,c,L,k,N)}_updateUInt4ForUniform(Z,c,L,k,N){R._TempBufferUInt32View[0]=c,R._TempBufferUInt32View[1]=L,R._TempBufferUInt32View[2]=k,R._TempBufferUInt32View[3]=N,this.updateUniform(Z,R._TempBuffer,4)}setTexture(Z,c){this._currentEffect.setTexture(Z,c)}setTextureArray(Z,c){this._currentEffect.setTextureArray(Z,c)}bindTexture(Z,c){this._currentEffect._bindTexture(Z,c)}updateUniformDirectly(Z,c){this.updateUniform(Z,c,c.length),this.update()}bindToEffect(Z,c){this._currentEffect=Z,this._currentEffectName=c}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(Z){if(!this._buffers)return this._buffer===Z;for(let c=0;c<this._buffers.length;++c){if(this._buffers[c][0]===Z)return this._bufferIndex=c,this._buffer=Z,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[c][1]&&this._bufferData.set(this._buffers[c][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const Z=this._engine._uniformBuffers,c=Z.indexOf(this);if(-1!==c&&(Z[c]=Z[Z.length-1],Z.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let L=0;L<this._buffers.length;++L){const Z=this._buffers[L][0];this._engine._releaseBuffer(Z)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}R._UpdatedUbosInFrame={},R._MAX_UNIFORM_SIZE=256,R._TempBuffer=new Float32Array(R._MAX_UNIFORM_SIZE),R._TempBufferInt32View=new Int32Array(R._TempBuffer.buffer),R._TempBufferUInt32View=new Uint32Array(R._TempBuffer.buffer)},11312:(Z,c,L)=>{L.d(c,{b:()=>G,e:()=>k});var k,N,R=L(10993);!function(Z){Z[Z.LOCAL=0]="LOCAL",Z[Z.WORLD=1]="WORLD",Z[Z.BONE=2]="BONE"}(k||(k={}));class G{}G.X=new R.h(1,0,0),G.Y=new R.h(0,1,0),G.Z=new R.h(0,0,1),function(Z){Z[Z.X=0]="X",Z[Z.Y=1]="Y",Z[Z.Z=2]="Z"}(N||(N={}))},11255:(Z,c,L)=>{L.d(c,{d:()=>i,h:()=>t,i:()=>E});var k=L(11008),N=L(11012),R=L(10999),G=L(11032);function V(Z){return Math.pow(Z,R.m)}function p(Z){return Z<=.04045?.0773993808*Z:Math.pow(.947867299*(Z+.055),2.4)}function J(Z){return Math.pow(Z,R.j)}function z(Z){return Z<=.0031308?12.92*Z:1.055*Math.pow(Z,.41666)-.055}class i{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=Z,this.g=c,this.b=L}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"sc"}getHashCode(){let Z=255*this.r|0;return Z=397*Z^255*this.g,Z=397*Z^255*this.b,Z}toArray(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z[c]=this.r,Z[c+1]=this.g,Z[c+2]=this.b,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(Z,c,this),this}toColor4(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new t(this.r,this.g,this.b,Z)}xc(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(Z){return new i(this.r*Z.r,this.g*Z.g,this.b*Z.b)}multiplyToRef(Z,c){return c.r=this.r*Z.r,c.g=this.g*Z.g,c.b=this.b*Z.b,c}multiplyInPlace(Z){return this.r*=Z.r,this.g*=Z.g,this.b*=Z.b,this}multiplyByFloats(Z,c,L){return new i(this.r*Z,this.g*c,this.b*L)}divide(Z){throw new ReferenceError("Can not divide a color")}divideToRef(Z,c){throw new ReferenceError("Can not divide a color")}divideInPlace(Z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(Z){return this.minimizeInPlaceFromFloats(Z.r,Z.g,Z.b)}maximizeInPlace(Z){return this.maximizeInPlaceFromFloats(Z.r,Z.g,Z.b)}minimizeInPlaceFromFloats(Z,c,L){return this.r=Math.min(Z,this.r),this.g=Math.min(c,this.g),this.b=Math.min(L,this.b),this}maximizeInPlaceFromFloats(Z,c,L){return this.r=Math.max(Z,this.r),this.g=Math.max(c,this.g),this.b=Math.max(L,this.b),this}floorToRef(Z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(Z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(Z){return Z&&this.r===Z.r&&this.g===Z.g&&this.b===Z.b}equalsFloats(Z,c,L){return this.equalsToFloats(Z,c,L)}equalsToFloats(Z,c,L){return this.r===Z&&this.g===c&&this.b===L}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.e;return(0,G.WithinEpsilon)(this.r,Z.r,c)&&(0,G.WithinEpsilon)(this.g,Z.g,c)&&(0,G.WithinEpsilon)(this.b,Z.b,c)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(Z){throw new ReferenceError("Can not negate a color")}scale(Z){return new i(this.r*Z,this.g*Z,this.b*Z)}scaleInPlace(Z){return this.r*=Z,this.g*=Z,this.b*=Z,this}scaleToRef(Z,c){return c.r=this.r*Z,c.g=this.g*Z,c.b=this.b*Z,c}scaleAndAddToRef(Z,c){return c.r+=this.r*Z,c.g+=this.g*Z,c.b+=this.b*Z,c}clampToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.r=(0,G.Clamp)(this.r,Z,c),L.g=(0,G.Clamp)(this.g,Z,c),L.b=(0,G.Clamp)(this.b,Z,c),L}add(Z){return new i(this.r+Z.r,this.g+Z.g,this.b+Z.b)}addInPlace(Z){return this.r+=Z.r,this.g+=Z.g,this.b+=Z.b,this}addInPlaceFromFloats(Z,c,L){return this.r+=Z,this.g+=c,this.b+=L,this}addToRef(Z,c){return c.r=this.r+Z.r,c.g=this.g+Z.g,c.b=this.b+Z.b,c}yL(Z){return new i(this.r-Z.r,this.g-Z.g,this.b-Z.b)}subtractToRef(Z,c){return c.r=this.r-Z.r,c.g=this.g-Z.g,c.b=this.b-Z.b,c}sz(Z){return this.r-=Z.r,this.g-=Z.g,this.b-=Z.b,this}subtractFromFloats(Z,c,L){return new i(this.r-Z,this.g-c,this.b-L)}subtractFromFloatsToRef(Z,c,L,k){return k.r=this.r-Z,k.g=this.g-c,k.b=this.b-L,k}clone(){return new i(this.r,this.g,this.b)}R(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this}wc(Z,c,L){return this.r=Z,this.g=c,this.b=L,this}set(Z,c,L){return this.wc(Z,c,L)}uc(Z){return this.r=this.g=this.b=Z,this}toHexString(){const Z=Math.round(255*this.r),c=Math.round(255*this.g),L=Math.round(255*this.b);return"#"+(0,G.ToHex)(Z)+(0,G.ToHex)(c)+(0,G.ToHex)(L)}fromHexString(Z){return"#"!==Z.substring(0,1)||7!==Z.length||(this.r=parseInt(Z.substring(1,3),16)/255,this.g=parseInt(Z.substring(3,5),16)/255,this.b=parseInt(Z.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new i)}toHSVToRef(Z){const c=this.r,L=this.g,k=this.b,N=Math.max(c,L,k),R=Math.min(c,L,k);let G=0,V=0;const p=N,J=N-R;return 0!==N&&(V=J/N),N!=R&&(N==c?(G=(L-k)/J,L<k&&(G+=6)):N==L?G=(k-c)/J+2:N==k&&(G=(c-L)/J+4),G*=60),Z.r=G,Z.g=V,Z.b=p,Z}toLinearSpace(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new i;return this.toLinearSpaceToRef(c,Z),c}toLinearSpaceToRef(Z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(Z.r=p(this.r),Z.g=p(this.g),Z.b=p(this.b)):(Z.r=V(this.r),Z.g=V(this.g),Z.b=V(this.b)),this}toGammaSpace(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new i;return this.toGammaSpaceToRef(c,Z),c}toGammaSpaceToRef(Z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(Z.r=z(this.r),Z.g=z(this.g),Z.b=z(this.b)):(Z.r=J(this.r),Z.g=J(this.g),Z.b=J(this.b)),this}static HSVtoRGBToRef(Z,c,L,k){const N=L*c,R=Z/60,G=N*(1-Math.abs(R%2-1));let V=0,p=0,J=0;R>=0&&R<=1?(V=N,p=G):R>=1&&R<=2?(V=G,p=N):R>=2&&R<=3?(p=N,J=G):R>=3&&R<=4?(p=G,J=N):R>=4&&R<=5?(V=G,J=N):R>=5&&R<=6&&(V=N,J=G);const z=L-N;return k.r=V+z,k.g=p+z,k.b=J+z,k}static FromHSV(Z,c,L){const k=new i(0,0,0);return i.HSVtoRGBToRef(Z,c,L,k),k}static FromHexString(Z){return new i(0,0,0).fromHexString(Z)}static oc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(Z[c],Z[c+1],Z[c+2])}static FromArrayToRef(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;L.r=Z[c],L.g=Z[c+1],L.b=Z[c+2]}static FromInts(Z,c,L){return new i(Z/255,c/255,L/255)}static Lerp(Z,c,L){const k=new i(0,0,0);return i.LerpToRef(Z,c,L,k),k}static LerpToRef(Z,c,L,k){k.r=Z.r+(c.r-Z.r)*L,k.g=Z.g+(c.g-Z.g)*L,k.b=Z.b+(c.b-Z.b)*L}static Hermite(Z,c,L,k,N){const R=N*N,G=N*R,V=2*G-3*R+1,p=-2*G+3*R,J=G-2*R+N,z=G-R,t=Z.r*V+L.r*p+c.r*J+k.r*z,E=Z.g*V+L.g*p+c.g*J+k.g*z,x=Z.b*V+L.b*p+c.b*J+k.b*z;return new i(t,E,x)}static Hermite1stDerivative(Z,c,L,k,N){const R=i.Black();return this.Hermite1stDerivativeToRef(Z,c,L,k,N,R),R}static Hermite1stDerivativeToRef(Z,c,L,k,N,R){const G=N*N;R.r=6*(G-N)*Z.r+(3*G-4*N+1)*c.r+6*(-G+N)*L.r+(3*G-2*N)*k.r,R.g=6*(G-N)*Z.g+(3*G-4*N+1)*c.g+6*(-G+N)*L.g+(3*G-2*N)*k.g,R.b=6*(G-N)*Z.b+(3*G-4*N+1)*c.b+6*(-G+N)*L.b+(3*G-2*N)*k.b}static Red(){return new i(1,0,0)}static Green(){return new i(0,1,0)}static Blue(){return new i(0,0,1)}static Black(){return new i(0,0,0)}static get BlackReadOnly(){return i._BlackReadOnly}static White(){return new i(1,1,1)}static Purple(){return new i(.5,0,.5)}static Magenta(){return new i(1,0,1)}static Yellow(){return new i(1,1,0)}static Gray(){return new i(.5,.5,.5)}static Teal(){return new i(0,1,1)}static Random(){return new i(Math.random(),Math.random(),Math.random())}}i._V8PerformanceHack=new i(.5,.5,.5),i._BlackReadOnly=i.Black(),Object.defineProperties(i.prototype,{dimension:{value:[3]},rank:{value:1}});class t{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=Z,this.g=c,this.b=L,this.a=k}xc(){return[this.r,this.g,this.b,this.a]}toArray(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z[c]=this.r,Z[c+1]=this.g,Z[c+2]=this.b,Z[c+3]=this.a,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=Z[c],this.g=Z[c+1],this.b=Z[c+2],this.a=Z[c+3],this}equals(Z){return Z&&this.r===Z.r&&this.g===Z.g&&this.b===Z.b&&this.a===Z.a}add(Z){return new t(this.r+Z.r,this.g+Z.g,this.b+Z.b,this.a+Z.a)}addToRef(Z,c){return c.r=this.r+Z.r,c.g=this.g+Z.g,c.b=this.b+Z.b,c.a=this.a+Z.a,c}addInPlace(Z){return this.r+=Z.r,this.g+=Z.g,this.b+=Z.b,this.a+=Z.a,this}addInPlaceFromFloats(Z,c,L,k){return this.r+=Z,this.g+=c,this.b+=L,this.a+=k,this}yL(Z){return new t(this.r-Z.r,this.g-Z.g,this.b-Z.b,this.a-Z.a)}subtractToRef(Z,c){return c.r=this.r-Z.r,c.g=this.g-Z.g,c.b=this.b-Z.b,c.a=this.a-Z.a,c}sz(Z){return this.r-=Z.r,this.g-=Z.g,this.b-=Z.b,this.a-=Z.a,this}subtractFromFloats(Z,c,L,k){return new t(this.r-Z,this.g-c,this.b-L,this.a-k)}subtractFromFloatsToRef(Z,c,L,k,N){return N.r=this.r-Z,N.g=this.g-c,N.b=this.b-L,N.a=this.a-k,N}scale(Z){return new t(this.r*Z,this.g*Z,this.b*Z,this.a*Z)}scaleInPlace(Z){return this.r*=Z,this.g*=Z,this.b*=Z,this.a*=Z,this}scaleToRef(Z,c){return c.r=this.r*Z,c.g=this.g*Z,c.b=this.b*Z,c.a=this.a*Z,c}scaleAndAddToRef(Z,c){return c.r+=this.r*Z,c.g+=this.g*Z,c.b+=this.b*Z,c.a+=this.a*Z,c}clampToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.r=(0,G.Clamp)(this.r,Z,c),L.g=(0,G.Clamp)(this.g,Z,c),L.b=(0,G.Clamp)(this.b,Z,c),L.a=(0,G.Clamp)(this.a,Z,c),L}multiply(Z){return new t(this.r*Z.r,this.g*Z.g,this.b*Z.b,this.a*Z.a)}multiplyToRef(Z,c){return c.r=this.r*Z.r,c.g=this.g*Z.g,c.b=this.b*Z.b,c.a=this.a*Z.a,c}multiplyInPlace(Z){return this.r*=Z.r,this.g*=Z.g,this.b*=Z.b,this.a*=Z.a,this}multiplyByFloats(Z,c,L,k){return new t(this.r*Z,this.g*c,this.b*L,this.a*k)}divide(Z){throw new ReferenceError("Can not divide a color")}divideToRef(Z,c){throw new ReferenceError("Can not divide a color")}divideInPlace(Z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(Z){return this.r=Math.min(this.r,Z.r),this.g=Math.min(this.g,Z.g),this.b=Math.min(this.b,Z.b),this.a=Math.min(this.a,Z.a),this}maximizeInPlace(Z){return this.r=Math.max(this.r,Z.r),this.g=Math.max(this.g,Z.g),this.b=Math.max(this.b,Z.b),this.a=Math.max(this.a,Z.a),this}minimizeInPlaceFromFloats(Z,c,L,k){return this.r=Math.min(Z,this.r),this.g=Math.min(c,this.g),this.b=Math.min(L,this.b),this.a=Math.min(k,this.a),this}maximizeInPlaceFromFloats(Z,c,L,k){return this.r=Math.max(Z,this.r),this.g=Math.max(c,this.g),this.b=Math.max(L,this.b),this.a=Math.max(k,this.a),this}floorToRef(Z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(Z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(Z){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.e;return(0,G.WithinEpsilon)(this.r,Z.r,c)&&(0,G.WithinEpsilon)(this.g,Z.g,c)&&(0,G.WithinEpsilon)(this.b,Z.b,c)&&(0,G.WithinEpsilon)(this.a,Z.a,c)}equalsToFloats(Z,c,L,k){return this.r===Z&&this.g===c&&this.b===L&&this.a===k}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"mc"}getHashCode(){let Z=255*this.r|0;return Z=397*Z^255*this.g,Z=397*Z^255*this.b,Z=397*Z^255*this.a,Z}clone(){return(new t).R(this)}R(Z){return this.r=Z.r,this.g=Z.g,this.b=Z.b,this.a=Z.a,this}wc(Z,c,L,k){return this.r=Z,this.g=c,this.b=L,this.a=k,this}set(Z,c,L,k){return this.wc(Z,c,L,k)}uc(Z){return this.r=this.g=this.b=this.a=Z,this}toHexString(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=Math.round(255*this.r),L=Math.round(255*this.g),k=Math.round(255*this.b);if(Z)return"#"+(0,G.ToHex)(c)+(0,G.ToHex)(L)+(0,G.ToHex)(k);const N=Math.round(255*this.a);return"#"+(0,G.ToHex)(c)+(0,G.ToHex)(L)+(0,G.ToHex)(k)+(0,G.ToHex)(N)}fromHexString(Z){return"#"!==Z.substring(0,1)||9!==Z.length&&7!==Z.length||(this.r=parseInt(Z.substring(1,3),16)/255,this.g=parseInt(Z.substring(3,5),16)/255,this.b=parseInt(Z.substring(5,7),16)/255,9===Z.length&&(this.a=parseInt(Z.substring(7,9),16)/255)),this}toLinearSpace(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new t;return this.toLinearSpaceToRef(c,Z),c}toLinearSpaceToRef(Z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(Z.r=p(this.r),Z.g=p(this.g),Z.b=p(this.b)):(Z.r=V(this.r),Z.g=V(this.g),Z.b=V(this.b)),Z.a=this.a,this}toGammaSpace(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new t;return this.toGammaSpaceToRef(c,Z),c}toGammaSpaceToRef(Z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(Z.r=z(this.r),Z.g=z(this.g),Z.b=z(this.b)):(Z.r=J(this.r),Z.g=J(this.g),Z.b=J(this.b)),Z.a=this.a,this}static FromHexString(Z){return"#"!==Z.substring(0,1)||9!==Z.length&&7!==Z.length?new t(0,0,0,0):new t(0,0,0,1).fromHexString(Z)}static Lerp(Z,c,L){return t.LerpToRef(Z,c,L,new t)}static LerpToRef(Z,c,L,k){return k.r=Z.r+(c.r-Z.r)*L,k.g=Z.g+(c.g-Z.g)*L,k.b=Z.b+(c.b-Z.b)*L,k.a=Z.a+(c.a-Z.a)*L,k}static Hermite(Z,c,L,k,N){const R=N*N,G=N*R,V=2*G-3*R+1,p=-2*G+3*R,J=G-2*R+N,z=G-R,i=Z.r*V+L.r*p+c.r*J+k.r*z,E=Z.g*V+L.g*p+c.g*J+k.g*z,x=Z.b*V+L.b*p+c.b*J+k.b*z,q=Z.a*V+L.a*p+c.a*J+k.a*z;return new t(i,E,x,q)}static Hermite1stDerivative(Z,c,L,k,N){const R=new t;return this.Hermite1stDerivativeToRef(Z,c,L,k,N,R),R}static Hermite1stDerivativeToRef(Z,c,L,k,N,R){const G=N*N;R.r=6*(G-N)*Z.r+(3*G-4*N+1)*c.r+6*(-G+N)*L.r+(3*G-2*N)*k.r,R.g=6*(G-N)*Z.g+(3*G-4*N+1)*c.g+6*(-G+N)*L.g+(3*G-2*N)*k.g,R.b=6*(G-N)*Z.b+(3*G-4*N+1)*c.b+6*(-G+N)*L.b+(3*G-2*N)*k.b,R.a=6*(G-N)*Z.a+(3*G-4*N+1)*c.a+6*(-G+N)*L.a+(3*G-2*N)*k.a}static FromColor3(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t(Z.r,Z.g,Z.b,c)}static oc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(Z[c],Z[c+1],Z[c+2],Z[c+3])}static FromArrayToRef(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0;L.r=Z[c],L.g=Z[c+1],L.b=Z[c+2],L.a=Z[c+3]}static FromInts(Z,c,L,k){return new t(Z/255,c/255,L/255,k/255)}static CheckColors4(Z,c){if(Z.length===3*c){const c=[];for(let L=0;L<Z.length;L+=3){const k=L/3*4;c[k]=Z[L],c[k+1]=Z[L+1],c[k+2]=Z[L+2],c[k+3]=1}return c}return Z}}t._V8PerformanceHack=new t(.5,.5,.5,.5),Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class E{}E.sc=(0,k.b)(3,i.Black),E.mc=(0,k.b)(3,(()=>new t(0,0,0,0))),(0,N.g)("BABYLON.Color3",i),(0,N.g)("BABYLON.Color4",t)},10999:(Z,c,L)=>{L.d(c,{e:()=>G,f:()=>R,j:()=>k,m:()=>N});const k=1/2.2,N=2.2,R=(1+Math.sqrt(5))/2,G=.001},11351:(Z,c,L)=>{L.d(c,{d:()=>N});var k=L(11239);class N{static GetPlanes(Z){const c=[];for(let L=0;L<6;L++)c.push(new k.b(0,0,0,0));return N.GetPlanesToRef(Z,c),c}static GetNearPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]+L[2],c.kc.y=L[7]+L[6],c.kc.z=L[11]+L[10],c.d=L[15]+L[14],c.normalize()}static GetFarPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]-L[2],c.kc.y=L[7]-L[6],c.kc.z=L[11]-L[10],c.d=L[15]-L[14],c.normalize()}static GetLeftPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]+L[0],c.kc.y=L[7]+L[4],c.kc.z=L[11]+L[8],c.d=L[15]+L[12],c.normalize()}static GetRightPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]-L[0],c.kc.y=L[7]-L[4],c.kc.z=L[11]-L[8],c.d=L[15]-L[12],c.normalize()}static GetTopPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]-L[1],c.kc.y=L[7]-L[5],c.kc.z=L[11]-L[9],c.d=L[15]-L[13],c.normalize()}static GetBottomPlaneToRef(Z,c){const L=Z.m;c.kc.x=L[3]+L[1],c.kc.y=L[7]+L[5],c.kc.z=L[11]+L[9],c.d=L[15]+L[13],c.normalize()}static GetPlanesToRef(Z,c){N.GetNearPlaneToRef(Z,c[0]),N.GetFarPlaneToRef(Z,c[1]),N.GetLeftPlaneToRef(Z,c[2]),N.GetRightPlaneToRef(Z,c[3]),N.GetTopPlaneToRef(Z,c[4]),N.GetBottomPlaneToRef(Z,c[5])}static IsPointInFrustum(Z,c){for(let L=0;L<6;L++)if(c[L].dotCoordinate(Z)<0)return!1;return!0}}},11221:(Z,c,L)=>{L.d(c,{b:()=>V,d:()=>p});var k=L(11170),N=L(10993),R=L(11173);class G{static extractMinAndMaxIndexed(Z,c,L,k,N,R){for(let G=L;G<L+k;G++){const L=3*c[G],k=Z[L],V=Z[L+1],p=Z[L+2];N.minimizeInPlaceFromFloats(k,V,p),R.maximizeInPlaceFromFloats(k,V,p)}}static extractMinAndMax(Z,c,L,k,N,R){for(let G=c,V=c*k;G<c+L;G++,V+=k){const c=Z[V],L=Z[V+1],k=Z[V+2];N.minimizeInPlaceFromFloats(c,L,k),R.maximizeInPlaceFromFloats(c,L,k)}}}function V(Z,c,L,k){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const V=new N.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new N.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return G.extractMinAndMaxIndexed(Z,c,L,k,V,p),R&&(V.x-=V.x*R.x+R.y,V.y-=V.y*R.x+R.y,V.z-=V.z*R.x+R.y,p.x+=p.x*R.x+R.y,p.y+=p.y*R.x+R.y,p.z+=p.z*R.x+R.y),{minimum:V,maximum:p}}function p(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;const V=new N.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new N.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return R||(R=3),G.extractMinAndMax(Z,c,L,R,V,p),k&&(V.x-=V.x*k.x+k.y,V.y-=V.y*k.x+k.y,V.z-=V.z*k.x+k.y,p.x+=p.x*k.x+k.y,p.y+=p.y*k.x+k.y,p.z+=p.z*k.x+k.y),{minimum:V,maximum:p}}(0,k.d)([R.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k,N]=c;return!Array.isArray(k)&&!Array.isArray(N)}))],G,"extractMinAndMaxIndexed",null),(0,k.d)([R.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k]=c;return!Array.isArray(k)}))],G,"extractMinAndMax",null)},11464:(Z,c,L)=>{L.d(c,{c:()=>k.b,f:()=>k.c,g:()=>k.d,h:()=>k.h});L(11312),L(11255),L(10999),L(11351),L(11471),L(11239),L(11480);var k=L(10993);L(11343)},11471:(Z,c,L)=>{L.d(c,{d:()=>V,h:()=>t,j:()=>z,l:()=>i});var k,N=L(11032),R=L(10993),G=L(10999);!function(Z){Z[Z.CW=0]="CW",Z[Z.CCW=1]="CCW"}(k||(k={}));class V{static Interpolate(Z,c,L,k,N){if(0===Z)return 0;const R=1-3*k+3*c,G=3*k-6*c,V=3*c;let p=Z;for(let J=0;J<5;J++){const c=p*p;p-=(R*(c*p)+G*c+V*p-Z)*(1/(3*R*c+2*G*p+V)),p=Math.min(1,Math.max(0,p))}return 3*Math.pow(1-p,2)*p*L+3*(1-p)*Math.pow(p,2)*N+Math.pow(p,3)}}class p{constructor(Z){this._radians=Z,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(Z,c){const L=c.yL(Z),k=Math.atan2(L.y,L.x);return new p(k)}static BetweenTwoVectors(Z,c){let L=Z.lengthSquared()*c.lengthSquared();if(0===L)return new p(Math.PI/2);L=Math.sqrt(L);let k=Z.dot(c)/L;k=(0,N.Clamp)(k,-1,1);const R=Math.acos(k);return new p(R)}static FromRadians(Z){return new p(Z)}static FromDegrees(Z){return new p(Z*Math.PI/180)}}class J{constructor(Z,c,L){this.startPoint=Z,this.midPoint=c,this.endPoint=L;const k=Math.pow(c.x,2)+Math.pow(c.y,2),N=(Math.pow(Z.x,2)+Math.pow(Z.y,2)-k)/2,G=(k-Math.pow(L.x,2)-Math.pow(L.y,2))/2,V=(Z.x-c.x)*(c.y-L.y)-(c.x-L.x)*(Z.y-c.y);this.centerPoint=new R.f((N*(c.y-L.y)-G*(Z.y-c.y))/V,((Z.x-c.x)*G-(c.x-L.x)*N)/V),this.radius=this.centerPoint.yL(this.startPoint).length(),this.startAngle=p.BetweenTwoPoints(this.centerPoint,this.startPoint);const J=this.startAngle.degrees();let z=p.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),i=p.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();z-J>180&&(z-=360),z-J<-180&&(z+=360),i-z>180&&(i-=360),i-z<-180&&(i+=360),this.orientation=z-J<0?0:1,this.angle=p.FromDegrees(0===this.orientation?J-i:i-J)}}class z{constructor(Z,c){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new R.f(Z,c))}addLineTo(Z,c){if(this.closed)return this;const L=new R.f(Z,c),k=this._points[this._points.length-1];return this._points.push(L),this._length+=L.yL(k).length(),this}addArcTo(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const G=this._points[this._points.length-1],V=new R.f(Z,c),p=new R.f(L,k),z=new J(G,V,p);let i=z.angle.radians()/N;0===z.orientation&&(i*=-1);let t=z.startAngle.radians()+i;for(let R=0;R<N;R++){const Z=Math.cos(t)*z.radius+z.centerPoint.x,c=Math.sin(t)*z.radius+z.centerPoint.y;this.addLineTo(Z,c),t+=i}return this}addQuadraticCurveTo(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const R=(Z,c,L,k)=>(1-Z)*(1-Z)*c+2*Z*(1-Z)*L+Z*Z*k,G=this._points[this._points.length-1];for(let V=0;V<=N;V++){const p=V/N,J=R(p,G.x,Z,L),z=R(p,G.y,c,k);this.addLineTo(J,z)}return this}addBezierCurveTo(Z,c,L,k,N,R){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const V=(Z,c,L,k,N)=>(1-Z)*(1-Z)*(1-Z)*c+3*Z*(1-Z)*(1-Z)*L+3*Z*Z*(1-Z)*k+Z*Z*Z*N,p=this._points[this._points.length-1];for(let J=0;J<=G;J++){const z=J/G,i=V(z,p.x,Z,L,N),t=V(z,p.y,c,k,R);this.addLineTo(i,t)}return this}isPointInside(Z){let c=!1;const L=this._points.length;for(let k=L-1,N=0;N<L;k=N++){let L=this._points[k],R=this._points[N],G=R.x-L.x,V=R.y-L.y;if(Math.abs(V)>Number.EPSILON){if(V<0&&(L=this._points[N],G=-G,R=this._points[k],V=-V),Z.y<L.y||Z.y>R.y)continue;if(Z.y===L.y&&Z.x===L.x)return!0;{const k=V*(Z.x-L.x)-G*(Z.y-L.y);if(0===k)return!0;if(k<0)continue;c=!c}}else{if(Z.y!==L.y)continue;if(R.x<=Z.x&&Z.x<=L.x||L.x<=Z.x&&Z.x<=R.x)return!0}}return c}close(){return this.closed=!0,this}length(){let Z=this._length;if(this.closed){const c=this._points[this._points.length-1];Z+=this._points[0].yL(c).length()}return Z}area(){const Z=this._points.length;let c=0;for(let L=Z-1,k=0;k<Z;L=k++)c+=this._points[L].x*this._points[k].y-this._points[k].x*this._points[L].y;return.5*c}getPoints(){return this._points}getPointAtLengthPosition(Z){if(Z<0||Z>1)return R.f.Zero();const c=Z*this.length();let L=0;for(let k=0;k<this._points.length;k++){const Z=(k+1)%this._points.length,N=this._points[k],G=this._points[Z].yL(N),V=G.length()+L;if(c>=L&&c<=V){const Z=G.normalize(),k=c-L;return new R.f(N.x+Z.x*k,N.y+Z.y*k)}L=V}return R.f.Zero()}static StartingAt(Z,c){return new z(Z,c)}}class i{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=Z,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:R.h.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:R.b.Identity()};for(let N=0;N<Z.length;N++)this._curve[N]=Z[N].clone();this._raw=L||!1,this._alignTangentsWithPath=k,this._compute(c,k)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(Z){return this._updatePointAtData(Z).point}getTangentAt(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(Z,c),c?R.h.TransformCoordinates(R.h.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(Z,c),c?R.h.TransformCoordinates(R.h.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(Z,c),c?R.h.TransformCoordinates(R.h.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(Z){return this.length()*Z}getPreviousPointIndexAt(Z){return this._updatePointAtData(Z),this._pointAtData.previousPointArrayIndex}getSubPositionAt(Z){return this._updatePointAtData(Z),this._pointAtData.subPosition}getClosestPositionTo(Z){let c=Number.MAX_VALUE,L=0;for(let k=0;k<this._curve.length-1;k++){const N=this._curve[k+0],G=this._curve[k+1].yL(N).normalize(),V=this._distances[k+1]-this._distances[k+0],p=Math.min(Math.max(R.h.Dot(G,Z.yL(N).normalize()),0)*R.h.Distance(N,Z)/V,1),J=R.h.Distance(N.add(G.scale(p*V)),Z);J<c&&(c=J,L=(this._distances[k+0]+V*p)/this.length())}return L}slice(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Z<0&&(Z=1- -1*Z%1),c<0&&(c=1- -1*c%1),Z>c){const L=Z;Z=c,c=L}const L=this.getCurve(),k=this.getPointAt(Z);let N=this.getPreviousPointIndexAt(Z);const R=this.getPointAt(c),G=this.getPreviousPointIndexAt(c)+1,V=[];return 0!==Z&&(N++,V.push(k)),V.push(...L.slice(N,G)),1===c&&1!==Z||V.push(R),new i(V,this.getNormalAt(Z),this._raw,this._alignTangentsWithPath)}update(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let k=0;k<Z.length;k++)this._curve[k].x=Z[k].x,this._curve[k].y=Z[k].y,this._curve[k].z=Z[k].z;return this._compute(c,L),this}_compute(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this._curve.length;if(L<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[L-1]=this._curve[L-1].yL(this._curve[L-2]),this._raw||this._tangents[L-1].normalize();const k=this._tangents[0],N=this._normalVector(k,Z);let G,V,p,J,z;this._normals[0]=N,this._raw||this._normals[0].normalize(),this._binormals[0]=R.h.Cross(k,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let i=1;i<L;i++)G=this._getLastNonNullVector(i),i<L-1&&(V=this._getFirstNonNullVector(i),this._tangents[i]=c?V:G.add(V),this._tangents[i].normalize()),this._distances[i]=this._distances[i-1]+this._curve[i].yL(this._curve[i-1]).length(),p=this._tangents[i],z=this._binormals[i-1],this._normals[i]=R.h.Cross(z,p),this._raw||(0===this._normals[i].length()?(J=this._normals[i-1],this._normals[i]=J.clone()):this._normals[i].normalize()),this._binormals[i]=R.h.Cross(p,this._normals[i]),this._raw||this._binormals[i].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(Z){let c=1,L=this._curve[Z+c].yL(this._curve[Z]);for(;0===L.length()&&Z+c+1<this._curve.length;)c++,L=this._curve[Z+c].yL(this._curve[Z]);return L}_getLastNonNullVector(Z){let c=1,L=this._curve[Z].yL(this._curve[Z-c]);for(;0===L.length()&&Z>c+1;)c++,L=this._curve[Z].yL(this._curve[Z-c]);return L}_normalVector(Z,c){let L,k=Z.length();if(0===k&&(k=1),void 0===c||null===c){let c;c=(0,N.WithinEpsilon)(Math.abs(Z.y)/k,1,G.e)?(0,N.WithinEpsilon)(Math.abs(Z.x)/k,1,G.e)?(0,N.WithinEpsilon)(Math.abs(Z.z)/k,1,G.e)?R.h.Zero():new R.h(0,0,1):new R.h(1,0,0):new R.h(0,-1,0),L=R.h.Cross(Z,c)}else L=R.h.Cross(Z,c),R.h.CrossToRef(L,Z,L);return L.normalize(),L}_updatePointAtData(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===Z)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=Z;const L=this.getPoints();if(Z<=0)return this._setPointAtData(0,0,L[0],0,c);if(Z>=1)return this._setPointAtData(1,1,L[L.length-1],L.length-1,c);let k,N=L[0],G=0;const V=Z*this.length();for(let p=1;p<L.length;p++){k=L[p];const J=R.h.Distance(N,k);if(G+=J,G===V)return this._setPointAtData(Z,1,k,p,c);if(G>V){const L=(G-V)/J,R=N.yL(k),z=k.add(R.scaleInPlace(L));return this._setPointAtData(Z,1-L,z,p-1,c)}N=k}return this._pointAtData}_setPointAtData(Z,c,L,k,N){return this._pointAtData.point=L,this._pointAtData.position=Z,this._pointAtData.subPosition=c,this._pointAtData.previousPointArrayIndex=k,this._pointAtData.interpolateReady=N,N&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=R.b.Identity();const Z=this._pointAtData.previousPointArrayIndex;if(Z!==this._tangents.length-1){const c=Z+1,L=this._tangents[Z].clone(),k=this._normals[Z].clone(),N=this._binormals[Z].clone(),G=this._tangents[c].clone(),V=this._normals[c].clone(),p=this._binormals[c].clone(),J=R.c.RotationQuaternionFromAxis(k,N,L),z=R.c.RotationQuaternionFromAxis(V,p,G);R.c.Slerp(J,z,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class t{static CreateQuadraticBezier(Z,c,L,k){k=k>2?k:3;const N=[],G=(Z,c,L,k)=>(1-Z)*(1-Z)*c+2*Z*(1-Z)*L+Z*Z*k;for(let V=0;V<=k;V++)N.push(new R.h(G(V/k,Z.x,c.x,L.x),G(V/k,Z.y,c.y,L.y),G(V/k,Z.z,c.z,L.z)));return new t(N)}static CreateCubicBezier(Z,c,L,k,N){N=N>3?N:4;const G=[],V=(Z,c,L,k,N)=>(1-Z)*(1-Z)*(1-Z)*c+3*Z*(1-Z)*(1-Z)*L+3*Z*Z*(1-Z)*k+Z*Z*Z*N;for(let p=0;p<=N;p++)G.push(new R.h(V(p/N,Z.x,c.x,L.x,k.x),V(p/N,Z.y,c.y,L.y,k.y),V(p/N,Z.z,c.z,L.z,k.z)));return new t(G)}static CreateHermiteSpline(Z,c,L,k,N){const G=[],V=1/N;for(let p=0;p<=N;p++)G.push(R.h.Hermite(Z,c,L,k,p*V));return new t(G)}static CreateCatmullRomSpline(Z,c,L){const k=[],N=1/c;let G=0;if(L){const L=Z.length;for(let V=0;V<L;V++){G=0;for(let p=0;p<c;p++)k.push(R.h.CatmullRom(Z[V%L],Z[(V+1)%L],Z[(V+2)%L],Z[(V+3)%L],G)),G+=N}k.push(k[0])}else{const L=[];L.push(Z[0].clone()),Array.prototype.push.apply(L,Z),L.push(Z[Z.length-1].clone());let V=0;for(;V<L.length-3;V++){G=0;for(let Z=0;Z<c;Z++)k.push(R.h.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],G)),G+=N}V--,k.push(R.h.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],G))}return new t(k)}static ArcThru3Points(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=[],p=c.yL(Z),J=L.yL(c),z=Z.yL(L),i=R.h.Cross(p,J),E=i.length();if(E<Math.pow(10,-8))return new t(V);const x=p.lengthSquared(),q=J.lengthSquared(),O=z.lengthSquared(),w=i.lengthSquared(),M=.5*p.length()*J.length()*z.length()/E,P=-.5*q*R.h.Dot(p,z)/w,j=-.5*O*R.h.Dot(p,J)/w,o=-.5*x*R.h.Dot(J,z)/w,u=Z.scale(P).add(c.scale(j)).add(L.scale(o)),X=Z.yL(u).normalize(),h=R.h.Cross(i,X).normalize();if(G){const c=2*Math.PI/k;for(let Z=0;Z<=2*Math.PI;Z+=c)V.push(u.add(X.scale(M*Math.cos(Z)).add(h.scale(M*Math.sin(Z)))));V.push(Z)}else{const c=1/k;let G=0,p=R.h.Zero();do{p=u.add(X.scale(M*Math.cos(G)).add(h.scale(M*Math.sin(G)))),V.push(p),G+=c}while(!p.equalsWithEpsilon(L,M*c*1.1));V.push(L),N&&V.push(Z)}return new t(V)}constructor(Z){this._length=0,this._points=Z,this._length=this._computeLength(Z)}getPoints(){return this._points}length(){return this._length}continue(Z){const c=this._points[this._points.length-1],L=this._points.slice(),k=Z.getPoints();for(let N=1;N<k.length;N++)L.push(k[N].yL(k[0]).add(c));return new t(L)}_computeLength(Z){let c=0;for(let L=1;L<Z.length;L++)c+=Z[L].yL(Z[L-1]).length();return c}}},11239:(Z,c,L)=>{L.d(c,{b:()=>N});var k=L(10993);class N{constructor(Z,c,L,N){this.kc=new k.h(Z,c,L),this.d=N}xc(){return[this.kc.x,this.kc.y,this.kc.z,this.d]}clone(){return new N(this.kc.x,this.kc.y,this.kc.z,this.d)}getClassName(){return"Plane"}getHashCode(){let Z=this.kc.getHashCode();return Z=397*Z^this.d,Z}normalize(){const Z=Math.sqrt(this.kc.x*this.kc.x+this.kc.y*this.kc.y+this.kc.z*this.kc.z);let c=0;return 0!==Z&&(c=1/Z),this.kc.x*=c,this.kc.y*=c,this.kc.z*=c,this.d*=c,this}transform(Z){const c=N._TmpMatrix;Z.invertToRef(c);const L=c.m,k=this.kc.x,R=this.kc.y,G=this.kc.z,V=this.d,p=k*L[0]+R*L[1]+G*L[2]+V*L[3],J=k*L[4]+R*L[5]+G*L[6]+V*L[7],z=k*L[8]+R*L[9]+G*L[10]+V*L[11],i=k*L[12]+R*L[13]+G*L[14]+V*L[15];return new N(p,J,z,i)}dotCoordinate(Z){return this.kc.x*Z.x+this.kc.y*Z.y+this.kc.z*Z.z+this.d}copyFromPoints(Z,c,L){const k=c.x-Z.x,N=c.y-Z.y,R=c.z-Z.z,G=L.x-Z.x,V=L.y-Z.y,p=L.z-Z.z,J=N*p-R*V,z=R*G-k*p,i=k*V-N*G,t=Math.sqrt(J*J+z*z+i*i);let E;return E=0!==t?1/t:0,this.kc.x=J*E,this.kc.y=z*E,this.kc.z=i*E,this.d=-(this.kc.x*Z.x+this.kc.y*Z.y+this.kc.z*Z.z),this}isFrontFacingTo(Z,c){return k.h.Dot(this.kc,Z)<=c}signedDistanceTo(Z){return k.h.Dot(Z,this.kc)+this.d}static oc(Z){return new N(Z[0],Z[1],Z[2],Z[3])}static FromPoints(Z,c,L){const k=new N(0,0,0,0);return k.copyFromPoints(Z,c,L),k}static FromPositionAndNormal(Z,c){const L=new N(0,0,0,0);return this.FromPositionAndNormalToRef(Z,c,L)}static FromPositionAndNormalToRef(Z,c,L){return L.kc.R(c),L.kc.normalize(),L.d=-Z.dot(L.kc),L}static SignedDistanceToPlaneFromPositionAndNormal(Z,c,L){const N=-(c.x*Z.x+c.y*Z.y+c.z*Z.z);return k.h.Dot(L,c)+N}}N._TmpMatrix=k.b.Identity()},11032:(Z,c,L)=>{function k(Z){return parseInt(Z.toString().replace(/\W/g,""))}function N(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(Z-c)<=L}function R(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return Z<c-k||Z>L+k}function G(Z,c){return Z===c?Z:Math.random()*(c-Z)+Z}function V(Z,c,L){return Z+(c-Z)*L}function p(Z,c,L){let k=O(c-Z,360);return k>180&&(k-=360),Z+k*t(L)}function J(Z,c,L){let k=0;return k=Z!=c?t((L-Z)/(c-Z)):0,k}function z(Z,c,L,k,N){const R=N*N,G=N*R;return Z*(2*G-3*R+1)+L*(-2*G+3*R)+c*(G-2*R+N)+k*(G-R)}function i(Z,c,L,k,N){const R=N*N;return 6*(R-N)*Z+(3*R-4*N+1)*c+6*(-R+N)*L+(3*R-2*N)*k}function t(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(L,Math.max(c,Z))}function E(Z){return Z-=2*Math.PI*Math.floor((Z+Math.PI)/(2*Math.PI))}function x(Z){const c=Z.toString(16);return Z<=15?("0"+c).toUpperCase():c.toUpperCase()}function q(Z){if(Math.log2)return Math.floor(Math.log2(Z));if(Z<0)return NaN;if(0===Z)return-1/0;let c=0;if(Z<1){for(;Z<1;)c++,Z*=2;c=-c}else if(Z>1)for(;Z>1;)c++,Z=Math.floor(Z/2);return c}function O(Z,c){return Z-Math.floor(Z/c)*c}function w(Z,c,L){return(Z-c)/(L-c)}function M(Z,c,L){return Z*(L-c)+c}function P(Z,c){let L=O(c-Z,360);return L>180&&(L-=360),L}function j(Z,c){const L=O(Z,2*c);return c-Math.abs(L-c)}function o(Z,c,L){let k=t(L);return k=-2*k*k*k+3*k*k,c*k+Z*(1-k)}function u(Z,c,L){let k=0;return k=Math.abs(c-Z)<=L?c:Z+Math.sign(c-Z)*L,k}function X(Z,c,L){const k=P(Z,c);let N=0;return N=-L<k&&k<L?c:u(Z,c=Z+k,L),N}function h(Z,c,L){return(Z-c)/(L-c)}function B(Z,c,L){return(L-c)*Z+c}function D(Z,c){const L=Z%c;return 0===L?c:D(c,L)}L.r(c),L.d(c,{Clamp:()=>t,DeltaAngle:()=>P,Denormalize:()=>M,ExtractAsInt:()=>k,Hermite:()=>z,Hermite1stDerivative:()=>i,HighestCommonFactor:()=>D,ILog2:()=>q,InverseLerp:()=>J,Lerp:()=>V,LerpAngle:()=>p,MoveTowards:()=>u,MoveTowardsAngle:()=>X,Normalize:()=>w,NormalizeRadians:()=>E,OutsideRange:()=>R,PercentToRange:()=>B,PingPong:()=>j,RandomRange:()=>G,RangeToPercent:()=>h,Repeat:()=>O,SmoothStep:()=>o,ToHex:()=>x,WithinEpsilon:()=>N})},11480:(Z,c,L)=>{L.d(c,{e:()=>k});class k{constructor(Z,c){this.width=Z,this.height=c}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let Z=0|this.width;return Z=397*Z^this.height,Z}R(Z){this.width=Z.width,this.height=Z.height}wc(Z,c){return this.width=Z,this.height=c,this}set(Z,c){return this.wc(Z,c)}multiplyByFloats(Z,c){return new k(this.width*Z,this.height*c)}clone(){return new k(this.width,this.height)}equals(Z){return!!Z&&(this.width===Z.width&&this.height===Z.height)}get surface(){return this.width*this.height}static Zero(){return new k(0,0)}add(Z){return new k(this.width+Z.width,this.height+Z.height)}yL(Z){return new k(this.width-Z.width,this.height-Z.height)}scale(Z){return new k(this.width*Z,this.height*Z)}static Lerp(Z,c,L){const N=Z.width+(c.width-Z.width)*L,R=Z.height+(c.height-Z.height)*L;return new k(N,R)}}},10993:(Z,c,L)=>{L.d(c,{b:()=>M,c:()=>w,d:()=>j,f:()=>x,h:()=>q,j:()=>O});var k=L(10999),N=L(11008),R=L(11012),G=L(11019),V=L(11023),p=L(11032);class J{}function z(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=Z.xc(),R=c.xc(),G=N[0],V=N[1],p=N[2],J=N[3],z=N[4],i=N[5],t=N[6],E=N[7],x=N[8],q=N[9],O=N[10],w=N[11],M=N[12],P=N[13],j=N[14],o=N[15],u=R[0],X=R[1],h=R[2],B=R[3],D=R[4],e=R[5],H=R[6],l=R[7],W=R[8],T=R[9],I=R[10],d=R[11],Q=R[12],r=R[13],f=R[14],S=R[15];L[k]=G*u+V*D+p*W+J*Q,L[k+1]=G*X+V*e+p*T+J*r,L[k+2]=G*h+V*H+p*I+J*f,L[k+3]=G*B+V*l+p*d+J*S,L[k+4]=z*u+i*D+t*W+E*Q,L[k+5]=z*X+i*e+t*T+E*r,L[k+6]=z*h+i*H+t*I+E*f,L[k+7]=z*B+i*l+t*d+E*S,L[k+8]=x*u+q*D+O*W+w*Q,L[k+9]=x*X+q*e+O*T+w*r,L[k+10]=x*h+q*H+O*I+w*f,L[k+11]=x*B+q*l+O*d+w*S,L[k+12]=M*u+P*D+j*W+o*Q,L[k+13]=M*X+P*e+j*T+o*r,L[k+14]=M*h+P*H+j*I+o*f,L[k+15]=M*B+P*l+j*d+o*S}function i(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const k=Z.xc();c[L]=k[0],c[L+1]=k[1],c[L+2]=k[2],c[L+3]=k[3],c[L+4]=k[4],c[L+5]=k[5],c[L+6]=k[6],c[L+7]=k[7],c[L+8]=k[8],c[L+9]=k[9],c[L+10]=k[10],c[L+11]=k[11],c[L+12]=k[12],c[L+13]=k[13],c[L+14]=k[14],c[L+15]=k[15]}function t(Z,c){const L=Z.xc(),k=L[0],N=L[1],R=L[2],G=L[3],V=L[4],p=L[5],J=L[6],z=L[7],i=L[8],t=L[9],E=L[10],x=L[11],q=L[12],O=L[13],w=L[14],M=L[15],P=E*M-w*x,j=t*M-O*x,o=t*w-O*E,u=i*M-q*x,X=i*w-E*q,h=i*O-q*t,B=+(p*P-J*j+z*o),D=-(V*P-J*u+z*X),e=+(V*j-p*u+z*h),H=-(V*o-p*X+J*h),l=k*B+N*D+R*e+G*H;if(0===l)return!1;const W=1/l,T=J*M-w*z,I=p*M-O*z,d=p*w-O*J,Q=V*M-q*z,r=V*w-q*J,f=V*O-q*p,S=J*x-E*z,s=p*x-t*z,m=p*E-t*J,A=V*x-i*z,b=V*E-i*J,F=V*t-i*p,U=-(N*P-R*j+G*o),K=+(k*P-R*u+G*X),n=-(k*j-N*u+G*h),g=+(k*o-N*X+R*h),y=+(N*T-R*I+G*d),v=-(k*T-R*Q+G*r),Y=+(k*I-N*Q+G*f),a=-(k*d-N*r+R*f),C=-(N*S-R*s+G*m),ZZ=+(k*S-R*A+G*b),cZ=-(k*s-N*A+G*F),LZ=+(k*m-N*b+R*F);return c[0]=B*W,c[1]=U*W,c[2]=y*W,c[3]=C*W,c[4]=D*W,c[5]=K*W,c[6]=v*W,c[7]=ZZ*W,c[8]=e*W,c[9]=n*W,c[10]=Y*W,c[11]=cZ*W,c[12]=H*W,c[13]=g*W,c[14]=a*W,c[15]=LZ*W,!0}J._UpdateFlagSeed=0;const E=Z=>parseInt(Z.toString().replace(/\W/g,""));class x{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=c}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let Z=E(this.x);return Z=397*Z^E(this.y),Z}toArray(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z[c]=this.x,Z[c+1]=this.y,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x.FromArrayToRef(Z,c,this),this}xc(){return[this.x,this.y]}R(Z){return this.x=Z.x,this.y=Z.y,this}wc(Z,c){return this.x=Z,this.y=c,this}set(Z,c){return this.wc(Z,c)}uc(Z){return this.wc(Z,Z)}add(Z){return new x(this.x+Z.x,this.y+Z.y)}addToRef(Z,c){return c.x=this.x+Z.x,c.y=this.y+Z.y,c}addInPlace(Z){return this.x+=Z.x,this.y+=Z.y,this}addInPlaceFromFloats(Z,c){return this.x+=Z,this.y+=c,this}addVector3(Z){return new x(this.x+Z.x,this.y+Z.y)}yL(Z){return new x(this.x-Z.x,this.y-Z.y)}subtractToRef(Z,c){return c.x=this.x-Z.x,c.y=this.y-Z.y,c}sz(Z){return this.x-=Z.x,this.y-=Z.y,this}multiplyInPlace(Z){return this.x*=Z.x,this.y*=Z.y,this}multiply(Z){return new x(this.x*Z.x,this.y*Z.y)}multiplyToRef(Z,c){return c.x=this.x*Z.x,c.y=this.y*Z.y,c}multiplyByFloats(Z,c){return new x(this.x*Z,this.y*c)}divide(Z){return new x(this.x/Z.x,this.y/Z.y)}divideToRef(Z,c){return c.x=this.x/Z.x,c.y=this.y/Z.y,c}divideInPlace(Z){return this.x=this.x/Z.x,this.y=this.y/Z.y,this}minimizeInPlace(Z){return this.minimizeInPlaceFromFloats(Z.x,Z.y)}maximizeInPlace(Z){return this.maximizeInPlaceFromFloats(Z.x,Z.y)}minimizeInPlaceFromFloats(Z,c){return this.x=Math.min(Z,this.x),this.y=Math.min(c,this.y),this}maximizeInPlaceFromFloats(Z,c){return this.x=Math.max(Z,this.x),this.y=Math.max(c,this.y),this}subtractFromFloats(Z,c){return new x(this.x-Z,this.y-c)}subtractFromFloatsToRef(Z,c,L){return L.x=this.x-Z,L.y=this.y-c,L}negate(){return new x(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(Z){return Z.x=-this.x,Z.y=-this.y,Z}scaleInPlace(Z){return this.x*=Z,this.y*=Z,this}scale(Z){return new x(this.x*Z,this.y*Z)}scaleToRef(Z,c){return c.x=this.x*Z,c.y=this.y*Z,c}scaleAndAddToRef(Z,c){return c.x+=this.x*Z,c.y+=this.y*Z,c}equals(Z){return Z&&this.x===Z.x&&this.y===Z.y}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return Z&&(0,p.WithinEpsilon)(this.x,Z.x,c)&&(0,p.WithinEpsilon)(this.y,Z.y,c)}equalsToFloats(Z,c){return this.x===Z&&this.y===c}floor(){return new x(Math.floor(this.x),Math.floor(this.y))}floorToRef(Z){return Z.x=Math.floor(this.x),Z.y=Math.floor(this.y),Z}fract(){return new x(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(Z){return Z.x=this.x-Math.floor(this.x),Z.y=this.y-Math.floor(this.y),Z}rotate(Z){return this.rotateToRef(Z,new x)}rotateToRef(Z,c){const L=Math.cos(Z),k=Math.sin(Z);return c.x=L*this.x-k*this.y,c.y=k*this.x+L*this.y,c}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(Z){return 0===Z||1===Z?this:this.scaleInPlace(1/Z)}normalizeToNew(){const Z=new x;return this.normalizeToRef(Z),Z}normalizeToRef(Z){const c=this.length();return 0===c&&(Z.x=this.x,Z.y=this.y),this.scaleToRef(1/c,Z)}clone(){return new x(this.x,this.y)}dot(Z){return this.x*Z.x+this.y*Z.y}static Zero(){return new x(0,0)}static One(){return new x(1,1)}static Random(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new x((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static RandomToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wc((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static get ZeroReadOnly(){return x._ZeroReadOnly}static oc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(Z[c],Z[c+1])}static FromArrayToRef(Z,c,L){return L.x=Z[c],L.y=Z[c+1],L}static FromFloatsToRef(Z,c,L){return L.wc(Z,c),L}static CatmullRom(Z,c,L,k,N){const R=N*N,G=N*R,V=.5*(2*c.x+(-Z.x+L.x)*N+(2*Z.x-5*c.x+4*L.x-k.x)*R+(-Z.x+3*c.x-3*L.x+k.x)*G),p=.5*(2*c.y+(-Z.y+L.y)*N+(2*Z.y-5*c.y+4*L.y-k.y)*R+(-Z.y+3*c.y-3*L.y+k.y)*G);return new x(V,p)}static ClampToRef(Z,c,L,k){return k.x=(0,p.Clamp)(Z.x,c.x,L.x),k.y=(0,p.Clamp)(Z.y,c.y,L.y),k}static Clamp(Z,c,L){const k=(0,p.Clamp)(Z.x,c.x,L.x),N=(0,p.Clamp)(Z.y,c.y,L.y);return new x(k,N)}static Hermite(Z,c,L,k,N){const R=N*N,G=N*R,V=2*G-3*R+1,p=-2*G+3*R,J=G-2*R+N,z=G-R,i=Z.x*V+L.x*p+c.x*J+k.x*z,t=Z.y*V+L.y*p+c.y*J+k.y*z;return new x(i,t)}static Hermite1stDerivative(Z,c,L,k,N){return this.Hermite1stDerivativeToRef(Z,c,L,k,N,new x)}static Hermite1stDerivativeToRef(Z,c,L,k,N,R){const G=N*N;return R.x=6*(G-N)*Z.x+(3*G-4*N+1)*c.x+6*(-G+N)*L.x+(3*G-2*N)*k.x,R.y=6*(G-N)*Z.y+(3*G-4*N+1)*c.y+6*(-G+N)*L.y+(3*G-2*N)*k.y,R}static Lerp(Z,c,L){return x.LerpToRef(Z,c,L,new x)}static LerpToRef(Z,c,L,k){return k.x=Z.x+(c.x-Z.x)*L,k.y=Z.y+(c.y-Z.y)*L,k}static Dot(Z,c){return Z.x*c.x+Z.y*c.y}static Normalize(Z){return x.NormalizeToRef(Z,new x)}static NormalizeToRef(Z,c){return Z.normalizeToRef(c),c}static Minimize(Z,c){const L=Z.x<c.x?Z.x:c.x,k=Z.y<c.y?Z.y:c.y;return new x(L,k)}static Maximize(Z,c){const L=Z.x>c.x?Z.x:c.x,k=Z.y>c.y?Z.y:c.y;return new x(L,k)}static Transform(Z,c){return x.TransformToRef(Z,c,new x)}static TransformToRef(Z,c,L){const k=c.m,N=Z.x*k[0]+Z.y*k[4]+k[12],R=Z.x*k[1]+Z.y*k[5]+k[13];return L.x=N,L.y=R,L}static PointInTriangle(Z,c,L,k){const N=.5*(-L.y*k.x+c.y*(-L.x+k.x)+c.x*(L.y-k.y)+L.x*k.y),R=N<0?-1:1,G=(c.y*k.x-c.x*k.y+(k.y-c.y)*Z.x+(c.x-k.x)*Z.y)*R,V=(c.x*L.y-c.y*L.x+(c.y-L.y)*Z.x+(L.x-c.x)*Z.y)*R;return G>0&&V>0&&G+V<2*N*R}static Distance(Z,c){return Math.sqrt(x.DistanceSquared(Z,c))}static DistanceSquared(Z,c){const L=Z.x-c.x,k=Z.y-c.y;return L*L+k*k}static Center(Z,c){return x.CenterToRef(Z,c,new x)}static CenterToRef(Z,c,L){return L.wc((Z.x+c.x)/2,(Z.y+c.y)/2)}static DistanceOfPointFromSegment(Z,c,L){const k=x.DistanceSquared(c,L);if(0===k)return x.Distance(Z,c);const N=L.yL(c),R=Math.max(0,Math.min(1,x.Dot(Z.yL(c),N)/k)),G=c.add(N.multiplyByFloats(R,R));return x.Distance(Z,G)}}x._V8PerformanceHack=new x(.5,.5),x._ZeroReadOnly=x.Zero(),Object.defineProperties(x.prototype,{dimension:{value:[2]},rank:{value:1}});class q{get x(){return this._x}set x(Z){this._x=Z,this._isDirty=!0}get y(){return this._y}set y(Z){this._y=Z,this._isDirty=!0}get z(){return this._z}set z(Z){this._z=Z,this._isDirty=!0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=Z,this._y=c,this._z=L}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Mc"}getHashCode(){let Z=E(this._x);return Z=397*Z^E(this._y),Z=397*Z^E(this._z),Z}xc(){return[this._x,this._y,this._z]}toArray(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z[c]=this._x,Z[c+1]=this._y,Z[c+2]=this._z,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(Z,c,this),this}toQuaternion(){return w.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(Z){return this._x+=Z._x,this._y+=Z._y,this._z+=Z._z,this._isDirty=!0,this}addInPlaceFromFloats(Z,c,L){return this._x+=Z,this._y+=c,this._z+=L,this._isDirty=!0,this}add(Z){return new q(this._x+Z._x,this._y+Z._y,this._z+Z._z)}addToRef(Z,c){return c._x=this._x+Z._x,c._y=this._y+Z._y,c._z=this._z+Z._z,c._isDirty=!0,c}sz(Z){return this._x-=Z._x,this._y-=Z._y,this._z-=Z._z,this._isDirty=!0,this}yL(Z){return new q(this._x-Z._x,this._y-Z._y,this._z-Z._z)}subtractToRef(Z,c){return this.subtractFromFloatsToRef(Z._x,Z._y,Z._z,c)}subtractFromFloats(Z,c,L){return new q(this._x-Z,this._y-c,this._z-L)}subtractFromFloatsToRef(Z,c,L,k){return k._x=this._x-Z,k._y=this._y-c,k._z=this._z-L,k._isDirty=!0,k}negate(){return new q(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(Z){return Z._x=-1*this._x,Z._y=-1*this._y,Z._z=-1*this._z,Z._isDirty=!0,Z}scaleInPlace(Z){return this._x*=Z,this._y*=Z,this._z*=Z,this._isDirty=!0,this}scale(Z){return new q(this._x*Z,this._y*Z,this._z*Z)}scaleToRef(Z,c){return c._x=this._x*Z,c._y=this._y*Z,c._z=this._z*Z,c._isDirty=!0,c}getNormalToRef(Z){const c=this.length();let L=Math.acos(this._y/c);const k=Math.atan2(this._z,this._x);L>Math.PI/2?L-=Math.PI/2:L+=Math.PI/2;const N=c*Math.sin(L)*Math.cos(k),R=c*Math.cos(L),G=c*Math.sin(L)*Math.sin(k);return Z.set(N,R,G),Z}applyRotationQuaternionToRef(Z,c){const L=this._x,k=this._y,N=this._z,R=Z._x,G=Z._y,V=Z._z,p=Z._w,J=2*(G*N-V*k),z=2*(V*L-R*N),i=2*(R*k-G*L);return c._x=L+p*J+G*i-V*z,c._y=k+p*z+V*J-R*i,c._z=N+p*i+R*z-G*J,c._isDirty=!0,c}applyRotationQuaternionInPlace(Z){return this.applyRotationQuaternionToRef(Z,this)}applyRotationQuaternion(Z){return this.applyRotationQuaternionToRef(Z,new q)}scaleAndAddToRef(Z,c){return c._x+=this._x*Z,c._y+=this._y*Z,c._z+=this._z*Z,c._isDirty=!0,c}projectOnPlane(Z,c){return this.projectOnPlaneToRef(Z,c,new q)}projectOnPlaneToRef(Z,c,L){const k=Z.kc,N=Z.d,R=P.Mc[0];this.subtractToRef(c,R),R.normalize();const G=q.Dot(R,k);if(Math.abs(G)<1e-10)L.uc(1/0);else{const Z=-(q.Dot(c,k)+N)/G,V=R.scaleInPlace(Z);c.addToRef(V,L)}return L}equals(Z){return Z&&this._x===Z._x&&this._y===Z._y&&this._z===Z._z}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return Z&&(0,p.WithinEpsilon)(this._x,Z._x,c)&&(0,p.WithinEpsilon)(this._y,Z._y,c)&&(0,p.WithinEpsilon)(this._z,Z._z,c)}equalsToFloats(Z,c,L){return this._x===Z&&this._y===c&&this._z===L}multiplyInPlace(Z){return this._x*=Z._x,this._y*=Z._y,this._z*=Z._z,this._isDirty=!0,this}multiply(Z){return this.multiplyByFloats(Z._x,Z._y,Z._z)}multiplyToRef(Z,c){return c._x=this._x*Z._x,c._y=this._y*Z._y,c._z=this._z*Z._z,c._isDirty=!0,c}multiplyByFloats(Z,c,L){return new q(this._x*Z,this._y*c,this._z*L)}divide(Z){return new q(this._x/Z._x,this._y/Z._y,this._z/Z._z)}divideToRef(Z,c){return c._x=this._x/Z._x,c._y=this._y/Z._y,c._z=this._z/Z._z,c._isDirty=!0,c}divideInPlace(Z){return this._x=this._x/Z._x,this._y=this._y/Z._y,this._z=this._z/Z._z,this._isDirty=!0,this}minimizeInPlace(Z){return this.minimizeInPlaceFromFloats(Z._x,Z._y,Z._z)}maximizeInPlace(Z){return this.maximizeInPlaceFromFloats(Z._x,Z._y,Z._z)}minimizeInPlaceFromFloats(Z,c,L){return Z<this._x&&(this.x=Z),c<this._y&&(this.y=c),L<this._z&&(this.z=L),this}maximizeInPlaceFromFloats(Z,c,L){return Z>this._x&&(this.x=Z),c>this._y&&(this.y=c),L>this._z&&(this.z=L),this}isNonUniformWithinEpsilon(Z){const c=Math.abs(this._x),L=Math.abs(this._y);if(!(0,p.WithinEpsilon)(c,L,Z))return!0;const k=Math.abs(this._z);return!(0,p.WithinEpsilon)(c,k,Z)||!(0,p.WithinEpsilon)(L,k,Z)}get isNonUniform(){const Z=Math.abs(this._x);if(Z!==Math.abs(this._y))return!0;return Z!==Math.abs(this._z)}floorToRef(Z){return Z._x=Math.floor(this._x),Z._y=Math.floor(this._y),Z._z=Math.floor(this._z),Z._isDirty=!0,Z}floor(){return new q(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(Z){return Z._x=this._x-Math.floor(this._x),Z._y=this._y-Math.floor(this._y),Z._z=this._z-Math.floor(this._z),Z._isDirty=!0,Z}fract(){return new q(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(Z){if("xyz"===(Z=Z.toLowerCase()))return this;const c=P.Mc[0].R(this);return this.x=c[Z[0]],this.y=c[Z[1]],this.z=c[Z[2]],this}rotateByQuaternionToRef(Z,c){return Z.toRotationMatrix(P.Matrix[0]),q.TransformCoordinatesToRef(this,P.Matrix[0],c),c}rotateByQuaternionAroundPointToRef(Z,c,L){return this.subtractToRef(c,P.Mc[0]),P.Mc[0].rotateByQuaternionToRef(Z,P.Mc[0]),c.addToRef(P.Mc[0],L),L}cross(Z){return q.CrossToRef(this,Z,new q)}normalizeFromLength(Z){return 0===Z||1===Z?this:this.scaleInPlace(1/Z)}normalizeToNew(){return this.normalizeToRef(new q)}normalizeToRef(Z){const c=this.length();return 0===c||1===c?(Z._x=this._x,Z._y=this._y,Z._z=this._z,Z._isDirty=!0,Z):this.scaleToRef(1/c,Z)}clone(){return new q(this._x,this._y,this._z)}R(Z){return this.wc(Z._x,Z._y,Z._z)}wc(Z,c,L){return this._x=Z,this._y=c,this._z=L,this._isDirty=!0,this}set(Z,c,L){return this.wc(Z,c,L)}uc(Z){return this._x=this._y=this._z=Z,this._isDirty=!0,this}static GetClipFactor(Z,c,L,k){const N=q.Dot(Z,L);return(N-k)/(N-q.Dot(c,L))}static GetAngleBetweenVectors(Z,c,L){const k=Z.normalizeToRef(P.Mc[1]),N=c.normalizeToRef(P.Mc[2]);let R=q.Dot(k,N);R=(0,p.Clamp)(R,-1,1);const G=Math.acos(R),V=P.Mc[3];return q.CrossToRef(k,N,V),q.Dot(V,L)>0?isNaN(G)?0:G:isNaN(G)?-Math.PI:-Math.acos(R)}static GetAngleBetweenVectorsOnPlane(Z,c,L){P.Mc[0].R(Z);const k=P.Mc[0];P.Mc[1].R(c);const N=P.Mc[1];P.Mc[2].R(L);const R=P.Mc[2],G=P.Mc[3],V=P.Mc[4];k.normalize(),N.normalize(),R.normalize(),q.CrossToRef(R,k,G),q.CrossToRef(G,R,V);const J=Math.atan2(q.Dot(N,G),q.Dot(N,V));return(0,p.NormalizeRadians)(J)}static PitchYawRollToMoveBetweenPointsToRef(Z,c,L){const k=j.Mc[0];return c.subtractToRef(Z,k),L._y=Math.atan2(k.x,k.z)||0,L._x=Math.atan2(Math.sqrt(k.x**2+k.z**2),k.y)||0,L._z=0,L._isDirty=!0,L}static PitchYawRollToMoveBetweenPoints(Z,c){const L=q.Zero();return q.PitchYawRollToMoveBetweenPointsToRef(Z,c,L)}static SlerpToRef(Z,c,L,N){L=(0,p.Clamp)(L,0,1);const R=P.Mc[0],G=P.Mc[1];R.R(Z);const V=R.length();R.normalizeFromLength(V),G.R(c);const J=G.length();G.normalizeFromLength(J);const z=q.Dot(R,G);let i,t;if(z<1-k.e){const Z=Math.acos(z),c=1/Math.sin(Z);i=Math.sin((1-L)*Z)*c,t=Math.sin(L*Z)*c}else i=1-L,t=L;return R.scaleInPlace(i),G.scaleInPlace(t),N.R(R).addInPlace(G),N.scaleInPlace((0,p.Lerp)(V,J,L)),N}static SmoothToRef(Z,c,L,k,N){return q.SlerpToRef(Z,c,0===k?1:L/k,N),N}static oc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(Z[c],Z[c+1],Z[c+2])}static FromFloatArray(Z,c){return q.oc(Z,c)}static FromArrayToRef(Z,c,L){return L._x=Z[c],L._y=Z[c+1],L._z=Z[c+2],L._isDirty=!0,L}static FromFloatArrayToRef(Z,c,L){return q.FromArrayToRef(Z,c,L)}static FromFloatsToRef(Z,c,L,k){return k.wc(Z,c,L),k}static Zero(){return new q(0,0,0)}static One(){return new q(1,1,1)}static Up(){return new q(0,1,0)}static get UpReadOnly(){return q._UpReadOnly}static get DownReadOnly(){return q._DownReadOnly}static get RightReadOnly(){return q._RightReadOnly}static get LeftReadOnly(){return q._LeftReadOnly}static get LeftHandedForwardReadOnly(){return q._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return q._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return q._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return q._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return q._ZeroReadOnly}static get OneReadOnly(){return q._OneReadOnly}static Down(){return new q(0,-1,0)}static Forward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new q(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new q(1,0,0)}static Left(){return new q(-1,0,0)}static Random(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new q((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static RandomToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wc((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static TransformCoordinates(Z,c){const L=q.Zero();return q.TransformCoordinatesToRef(Z,c,L),L}static TransformCoordinatesToRef(Z,c,L){return q.TransformCoordinatesFromFloatsToRef(Z._x,Z._y,Z._z,c,L),L}static TransformCoordinatesFromFloatsToRef(Z,c,L,k,N){const R=k.m,G=Z*R[0]+c*R[4]+L*R[8]+R[12],V=Z*R[1]+c*R[5]+L*R[9]+R[13],p=Z*R[2]+c*R[6]+L*R[10]+R[14],J=1/(Z*R[3]+c*R[7]+L*R[11]+R[15]);return N._x=G*J,N._y=V*J,N._z=p*J,N._isDirty=!0,N}static TransformNormal(Z,c){const L=q.Zero();return q.TransformNormalToRef(Z,c,L),L}static TransformNormalToRef(Z,c,L){return this.TransformNormalFromFloatsToRef(Z._x,Z._y,Z._z,c,L),L}static TransformNormalFromFloatsToRef(Z,c,L,k,N){const R=k.m;return N._x=Z*R[0]+c*R[4]+L*R[8],N._y=Z*R[1]+c*R[5]+L*R[9],N._z=Z*R[2]+c*R[6]+L*R[10],N._isDirty=!0,N}static CatmullRom(Z,c,L,k,N){const R=N*N,G=N*R,V=.5*(2*c._x+(-Z._x+L._x)*N+(2*Z._x-5*c._x+4*L._x-k._x)*R+(-Z._x+3*c._x-3*L._x+k._x)*G),p=.5*(2*c._y+(-Z._y+L._y)*N+(2*Z._y-5*c._y+4*L._y-k._y)*R+(-Z._y+3*c._y-3*L._y+k._y)*G),J=.5*(2*c._z+(-Z._z+L._z)*N+(2*Z._z-5*c._z+4*L._z-k._z)*R+(-Z._z+3*c._z-3*L._z+k._z)*G);return new q(V,p,J)}static Clamp(Z,c,L){const k=new q;return q.ClampToRef(Z,c,L,k),k}static ClampToRef(Z,c,L,k){let N=Z._x;N=N>L._x?L._x:N,N=N<c._x?c._x:N;let R=Z._y;R=R>L._y?L._y:R,R=R<c._y?c._y:R;let G=Z._z;return G=G>L._z?L._z:G,G=G<c._z?c._z:G,k.wc(N,R,G),k}static CheckExtends(Z,c,L){c.minimizeInPlace(Z),L.maximizeInPlace(Z)}static Hermite(Z,c,L,k,N){const R=N*N,G=N*R,V=2*G-3*R+1,p=-2*G+3*R,J=G-2*R+N,z=G-R,i=Z._x*V+L._x*p+c._x*J+k._x*z,t=Z._y*V+L._y*p+c._y*J+k._y*z,E=Z._z*V+L._z*p+c._z*J+k._z*z;return new q(i,t,E)}static Hermite1stDerivative(Z,c,L,k,N){const R=new q;return this.Hermite1stDerivativeToRef(Z,c,L,k,N,R),R}static Hermite1stDerivativeToRef(Z,c,L,k,N,R){const G=N*N;return R._x=6*(G-N)*Z._x+(3*G-4*N+1)*c._x+6*(-G+N)*L._x+(3*G-2*N)*k._x,R._y=6*(G-N)*Z._y+(3*G-4*N+1)*c._y+6*(-G+N)*L._y+(3*G-2*N)*k._y,R._z=6*(G-N)*Z._z+(3*G-4*N+1)*c._z+6*(-G+N)*L._z+(3*G-2*N)*k._z,R._isDirty=!0,R}static Lerp(Z,c,L){const k=new q(0,0,0);return q.LerpToRef(Z,c,L,k),k}static LerpToRef(Z,c,L,k){return k._x=Z._x+(c._x-Z._x)*L,k._y=Z._y+(c._y-Z._y)*L,k._z=Z._z+(c._z-Z._z)*L,k._isDirty=!0,k}static Dot(Z,c){return Z._x*c._x+Z._y*c._y+Z._z*c._z}dot(Z){return this._x*Z._x+this._y*Z._y+this._z*Z._z}static Cross(Z,c){const L=new q;return q.CrossToRef(Z,c,L),L}static CrossToRef(Z,c,L){const k=Z._y*c._z-Z._z*c._y,N=Z._z*c._x-Z._x*c._z,R=Z._x*c._y-Z._y*c._x;return L.wc(k,N,R),L}static Normalize(Z){const c=q.Zero();return q.NormalizeToRef(Z,c),c}static NormalizeToRef(Z,c){return Z.normalizeToRef(c),c}static Project(Z,c,L,k){const N=new q;return q.ProjectToRef(Z,c,L,k,N),N}static ProjectToRef(Z,c,L,k,N){var R;const G=k.width,p=k.height,J=k.x,z=k.y,i=P.Matrix[1],t=null===(R=V.d.LastCreatedEngine)||void 0===R?void 0:R.isNDCHalfZRange,E=t?1:.5,x=t?0:.5;M.FromValuesToRef(G/2,0,0,0,0,-p/2,0,0,0,0,E,0,J+G/2,p/2+z,x,1,i);const O=P.Matrix[0];return c.multiplyToRef(L,O),O.multiplyToRef(i,O),q.TransformCoordinatesToRef(Z,O,N),N}static Reflect(Z,c){return this.ReflectToRef(Z,c,new q)}static ReflectToRef(Z,c,L){const k=j.Mc[0];return k.R(c).scaleInPlace(2*q.Dot(Z,c)),L.R(Z).sz(k)}static _UnprojectFromInvertedMatrixToRef(Z,c,L){q.TransformCoordinatesToRef(Z,c,L);const k=c.m,N=Z._x*k[3]+Z._y*k[7]+Z._z*k[11]+k[15];return(0,p.WithinEpsilon)(N,1)&&L.scaleInPlace(1/N),L}static UnprojectFromTransform(Z,c,L,k,N){return this.Unproject(Z,c,L,k,N,M.IdentityReadOnly)}static Unproject(Z,c,L,k,N,R){const G=new q;return q.UnprojectToRef(Z,c,L,k,N,R,G),G}static UnprojectToRef(Z,c,L,k,N,R,G){return q.UnprojectFloatsToRef(Z._x,Z._y,Z._z,c,L,k,N,R,G),G}static UnprojectFloatsToRef(Z,c,L,k,N,R,G,p,J){var z;const i=P.Matrix[0];R.multiplyToRef(G,i),i.multiplyToRef(p,i),i.invert();const t=P.Mc[0];return t.x=Z/k*2-1,t.y=-(c/N*2-1),null!==(z=V.d.LastCreatedEngine)&&void 0!==z&&z.isNDCHalfZRange?t.z=L:t.z=2*L-1,q._UnprojectFromInvertedMatrixToRef(t,i,J),J}static Minimize(Z,c){const L=new q;return L.R(Z),L.minimizeInPlace(c),L}static Maximize(Z,c){const L=new q;return L.R(Z),L.maximizeInPlace(c),L}static Distance(Z,c){return Math.sqrt(q.DistanceSquared(Z,c))}static DistanceSquared(Z,c){const L=Z._x-c._x,k=Z._y-c._y,N=Z._z-c._z;return L*L+k*k+N*N}static ProjectOnTriangleToRef(Z,c,L,N,R){const G=P.Mc[0],V=P.Mc[1],J=P.Mc[2],z=P.Mc[3],i=P.Mc[4];L.subtractToRef(c,G),N.subtractToRef(c,V),N.subtractToRef(L,J);const t=G.length(),E=V.length(),x=J.length();if(t<k.e||E<k.e||x<k.e)return R.R(c),q.Distance(Z,c);Z.subtractToRef(c,i),q.CrossToRef(G,V,z);const O=z.length();if(O<k.e)return R.R(c),q.Distance(Z,c);z.normalizeFromLength(O);let w=i.length();if(w<k.e)return R.R(c),0;i.normalizeFromLength(w);const M=q.Dot(z,i),j=P.Mc[5],o=P.Mc[6];j.R(z).scaleInPlace(-w*M),o.R(Z).addInPlace(j);const u=P.Mc[4],X=P.Mc[5],h=P.Mc[7],B=P.Mc[8];u.R(G).scaleInPlace(1/t),B.R(V).scaleInPlace(1/E),u.addInPlace(B).scaleInPlace(-1),X.R(G).scaleInPlace(-1/t),B.R(J).scaleInPlace(1/x),X.addInPlace(B).scaleInPlace(-1),h.R(J).scaleInPlace(-1/x),B.R(V).scaleInPlace(-1/E),h.addInPlace(B).scaleInPlace(-1);const D=P.Mc[9];let e;D.R(o).sz(c),q.CrossToRef(u,D,B),e=q.Dot(B,z);const H=e;D.R(o).sz(L),q.CrossToRef(X,D,B),e=q.Dot(B,z);const l=e;D.R(o).sz(N),q.CrossToRef(h,D,B),e=q.Dot(B,z);const W=e,T=P.Mc[10];let I,d;H>0&&l<0?(T.R(G),I=c,d=L):l>0&&W<0?(T.R(J),I=L,d=N):(T.R(V).scaleInPlace(-1),I=N,d=c);const Q=P.Mc[9],r=P.Mc[4];I.subtractToRef(o,B),d.subtractToRef(o,Q),q.CrossToRef(B,Q,r);if(!(q.Dot(r,z)<0))return R.R(o),Math.abs(w*M);const f=P.Mc[5];q.CrossToRef(T,r,f),f.normalize();const S=P.Mc[9];S.R(I).sz(o);const s=S.length();if(s<k.e)return R.R(I),q.Distance(Z,I);S.normalizeFromLength(s);const m=q.Dot(f,S),A=P.Mc[7];A.R(o).addInPlace(f.scaleInPlace(s*m)),B.R(A).sz(I),w=T.length(),T.normalizeFromLength(w);let b=q.Dot(B,T)/Math.max(w,k.e);return b=(0,p.Clamp)(b,0,1),A.R(I).addInPlace(T.scaleInPlace(b*w)),R.R(A),q.Distance(Z,A)}static Center(Z,c){return q.CenterToRef(Z,c,q.Zero())}static CenterToRef(Z,c,L){return L.wc((Z._x+c._x)/2,(Z._y+c._y)/2,(Z._z+c._z)/2)}static RotationFromAxis(Z,c,L){const k=new q;return q.RotationFromAxisToRef(Z,c,L,k),k}static RotationFromAxisToRef(Z,c,L,k){const N=P.Quaternion[0];return w.RotationQuaternionFromAxisToRef(Z,c,L,N),N.toEulerAnglesToRef(k),k}}q._V8PerformanceHack=new q(.5,.5,.5),q._UpReadOnly=q.Up(),q._DownReadOnly=q.Down(),q._LeftHandedForwardReadOnly=q.Forward(!1),q._RightHandedForwardReadOnly=q.Forward(!0),q._LeftHandedBackwardReadOnly=q.Backward(!1),q._RightHandedBackwardReadOnly=q.Backward(!0),q._RightReadOnly=q.Right(),q._LeftReadOnly=q.Left(),q._ZeroReadOnly=q.Zero(),q._OneReadOnly=q.One(),Object.defineProperties(q.prototype,{dimension:{value:[3]},rank:{value:1}});class O{get x(){return this._x}set x(Z){this._x=Z,this._isDirty=!0}get y(){return this._y}set y(Z){this._y=Z,this._isDirty=!0}get z(){return this._z}set z(Z){this._z=Z,this._isDirty=!0}get w(){return this._w}set w(Z){this._w=Z,this._isDirty=!0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=Z,this._y=c,this._z=L,this._w=k}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let Z=E(this._x);return Z=397*Z^E(this._y),Z=397*Z^E(this._z),Z=397*Z^E(this._w),Z}xc(){return[this._x,this._y,this._z,this._w]}toArray(Z,c){return void 0===c&&(c=0),Z[c]=this._x,Z[c+1]=this._y,Z[c+2]=this._z,Z[c+3]=this._w,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return O.FromArrayToRef(Z,c,this),this}addInPlace(Z){return this.x+=Z._x,this.y+=Z._y,this.z+=Z._z,this.w+=Z._w,this}addInPlaceFromFloats(Z,c,L,k){return this.x+=Z,this.y+=c,this.z+=L,this.w+=k,this}add(Z){return new O(this._x+Z.x,this._y+Z.y,this._z+Z.z,this._w+Z.w)}addToRef(Z,c){return c.x=this._x+Z.x,c.y=this._y+Z.y,c.z=this._z+Z.z,c.w=this._w+Z.w,c}sz(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this.w-=Z.w,this}yL(Z){return new O(this._x-Z.x,this._y-Z.y,this._z-Z.z,this._w-Z.w)}subtractToRef(Z,c){return c.x=this._x-Z.x,c.y=this._y-Z.y,c.z=this._z-Z.z,c.w=this._w-Z.w,c}subtractFromFloats(Z,c,L,k){return new O(this._x-Z,this._y-c,this._z-L,this._w-k)}subtractFromFloatsToRef(Z,c,L,k,N){return N.x=this._x-Z,N.y=this._y-c,N.z=this._z-L,N.w=this._w-k,N}negate(){return new O(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(Z){return Z.x=-this._x,Z.y=-this._y,Z.z=-this._z,Z.w=-this._w,Z}scaleInPlace(Z){return this.x*=Z,this.y*=Z,this.z*=Z,this.w*=Z,this}scale(Z){return new O(this._x*Z,this._y*Z,this._z*Z,this._w*Z)}scaleToRef(Z,c){return c.x=this._x*Z,c.y=this._y*Z,c.z=this._z*Z,c.w=this._w*Z,c}scaleAndAddToRef(Z,c){return c.x+=this._x*Z,c.y+=this._y*Z,c.z+=this._z*Z,c.w+=this._w*Z,c}equals(Z){return Z&&this._x===Z.x&&this._y===Z.y&&this._z===Z.z&&this._w===Z.w}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return Z&&(0,p.WithinEpsilon)(this._x,Z.x,c)&&(0,p.WithinEpsilon)(this._y,Z.y,c)&&(0,p.WithinEpsilon)(this._z,Z.z,c)&&(0,p.WithinEpsilon)(this._w,Z.w,c)}equalsToFloats(Z,c,L,k){return this._x===Z&&this._y===c&&this._z===L&&this._w===k}multiplyInPlace(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this.w*=Z.w,this}multiply(Z){return new O(this._x*Z.x,this._y*Z.y,this._z*Z.z,this._w*Z.w)}multiplyToRef(Z,c){return c.x=this._x*Z.x,c.y=this._y*Z.y,c.z=this._z*Z.z,c.w=this._w*Z.w,c}multiplyByFloats(Z,c,L,k){return new O(this._x*Z,this._y*c,this._z*L,this._w*k)}divide(Z){return new O(this._x/Z.x,this._y/Z.y,this._z/Z.z,this._w/Z.w)}divideToRef(Z,c){return c.x=this._x/Z.x,c.y=this._y/Z.y,c.z=this._z/Z.z,c.w=this._w/Z.w,c}divideInPlace(Z){return this.divideToRef(Z,this)}minimizeInPlace(Z){return Z.x<this._x&&(this.x=Z.x),Z.y<this._y&&(this.y=Z.y),Z.z<this._z&&(this.z=Z.z),Z.w<this._w&&(this.w=Z.w),this}maximizeInPlace(Z){return Z.x>this._x&&(this.x=Z.x),Z.y>this._y&&(this.y=Z.y),Z.z>this._z&&(this.z=Z.z),Z.w>this._w&&(this.w=Z.w),this}minimizeInPlaceFromFloats(Z,c,L,k){return this.x=Math.min(Z,this._x),this.y=Math.min(c,this._y),this.z=Math.min(L,this._z),this.w=Math.min(k,this._w),this}maximizeInPlaceFromFloats(Z,c,L,k){return this.x=Math.max(Z,this._x),this.y=Math.max(c,this._y),this.z=Math.max(L,this._z),this.w=Math.max(k,this._w),this}floorToRef(Z){return Z.x=Math.floor(this._x),Z.y=Math.floor(this._y),Z.z=Math.floor(this._z),Z.w=Math.floor(this._w),Z}floor(){return new O(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(Z){return Z.x=this._x-Math.floor(this._x),Z.y=this._y-Math.floor(this._y),Z.z=this._z-Math.floor(this._z),Z.w=this._w-Math.floor(this._w),Z}fract(){return new O(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(Z){return 0===Z||1===Z?this:this.scaleInPlace(1/Z)}normalizeToNew(){return this.normalizeToRef(new O)}normalizeToRef(Z){const c=this.length();return 0===c||1===c?(Z.x=this._x,Z.y=this._y,Z.z=this._z,Z.w=this._w,Z):this.scaleToRef(1/c,Z)}toVector3(){return new q(this._x,this._y,this._z)}clone(){return new O(this._x,this._y,this._z,this._w)}R(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w,this}wc(Z,c,L,k){return this.x=Z,this.y=c,this.z=L,this.w=k,this}set(Z,c,L,k){return this.wc(Z,c,L,k)}uc(Z){return this.x=this.y=this.z=this.w=Z,this}dot(Z){return this._x*Z.x+this._y*Z.y+this._z*Z.z+this._w*Z.w}static oc(Z,c){return c||(c=0),new O(Z[c],Z[c+1],Z[c+2],Z[c+3])}static FromArrayToRef(Z,c,L){return L.x=Z[c],L.y=Z[c+1],L.z=Z[c+2],L.w=Z[c+3],L}static FromFloatArrayToRef(Z,c,L){return O.FromArrayToRef(Z,c,L),L}static FromFloatsToRef(Z,c,L,k,N){return N.x=Z,N.y=c,N.z=L,N.w=k,N}static Zero(){return new O(0,0,0,0)}static One(){return new O(1,1,1,1)}static Random(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new O((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static RandomToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,L=arguments.length>2?arguments[2]:void 0;return L.x=(0,p.RandomRange)(Z,c),L.y=(0,p.RandomRange)(Z,c),L.z=(0,p.RandomRange)(Z,c),L.w=(0,p.RandomRange)(Z,c),L}static Clamp(Z,c,L){return O.ClampToRef(Z,c,L,new O)}static ClampToRef(Z,c,L,k){return k.x=(0,p.Clamp)(Z.x,c.x,L.x),k.y=(0,p.Clamp)(Z.y,c.y,L.y),k.z=(0,p.Clamp)(Z.z,c.z,L.z),k.w=(0,p.Clamp)(Z.w,c.w,L.w),k}static CheckExtends(Z,c,L){c.minimizeInPlace(Z),L.maximizeInPlace(Z)}static get ZeroReadOnly(){return O._ZeroReadOnly}static Normalize(Z){return O.NormalizeToRef(Z,new O)}static NormalizeToRef(Z,c){return Z.normalizeToRef(c),c}static Minimize(Z,c){const L=new O;return L.R(Z),L.minimizeInPlace(c),L}static Maximize(Z,c){const L=new O;return L.R(Z),L.maximizeInPlace(c),L}static Distance(Z,c){return Math.sqrt(O.DistanceSquared(Z,c))}static DistanceSquared(Z,c){const L=Z.x-c.x,k=Z.y-c.y,N=Z.z-c.z,R=Z.w-c.w;return L*L+k*k+N*N+R*R}static Center(Z,c){return O.CenterToRef(Z,c,new O)}static CenterToRef(Z,c,L){return L.x=(Z.x+c.x)/2,L.y=(Z.y+c.y)/2,L.z=(Z.z+c.z)/2,L.w=(Z.w+c.w)/2,L}static TransformCoordinates(Z,c){return O.TransformCoordinatesToRef(Z,c,new O)}static TransformCoordinatesToRef(Z,c,L){return O.TransformCoordinatesFromFloatsToRef(Z._x,Z._y,Z._z,c,L),L}static TransformCoordinatesFromFloatsToRef(Z,c,L,k,N){const R=k.m,G=Z*R[0]+c*R[4]+L*R[8]+R[12],V=Z*R[1]+c*R[5]+L*R[9]+R[13],p=Z*R[2]+c*R[6]+L*R[10]+R[14],J=Z*R[3]+c*R[7]+L*R[11]+R[15];return N.x=G,N.y=V,N.z=p,N.w=J,N}static TransformNormal(Z,c){return O.TransformNormalToRef(Z,c,new O)}static TransformNormalToRef(Z,c,L){const k=c.m,N=Z.x*k[0]+Z.y*k[4]+Z.z*k[8],R=Z.x*k[1]+Z.y*k[5]+Z.z*k[9],G=Z.x*k[2]+Z.y*k[6]+Z.z*k[10];return L.x=N,L.y=R,L.z=G,L.w=Z.w,L}static TransformNormalFromFloatsToRef(Z,c,L,k,N,R){const G=N.m;return R.x=Z*G[0]+c*G[4]+L*G[8],R.y=Z*G[1]+c*G[5]+L*G[9],R.z=Z*G[2]+c*G[6]+L*G[10],R.w=k,R}static FromVector3(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new O(Z._x,Z._y,Z._z,c)}static Dot(Z,c){return Z.x*c.x+Z.y*c.y+Z.z*c.z+Z.w*c.w}}O._V8PerformanceHack=new O(.5,.5,.5,.5),O._ZeroReadOnly=O.Zero(),Object.defineProperties(O.prototype,{dimension:{value:[4]},rank:{value:1}});class w{get x(){return this._x}set x(Z){this._x=Z,this._isDirty=!0}get y(){return this._y}set y(Z){this._y=Z,this._isDirty=!0}get z(){return this._z}set z(Z){this._z=Z,this._isDirty=!0}get w(){return this._w}set w(Z){this._w=Z,this._isDirty=!0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=Z,this._y=c,this._z=L,this._w=k}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let Z=E(this._x);return Z=397*Z^E(this._y),Z=397*Z^E(this._z),Z=397*Z^E(this._w),Z}xc(){return[this._x,this._y,this._z,this._w]}toArray(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z[c]=this._x,Z[c+1]=this._y,Z[c+2]=this._z,Z[c+3]=this._w,this}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return w.FromArrayToRef(Z,c,this)}equals(Z){return Z&&this._x===Z._x&&this._y===Z._y&&this._z===Z._z&&this._w===Z._w}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return Z&&(0,p.WithinEpsilon)(this._x,Z._x,c)&&(0,p.WithinEpsilon)(this._y,Z._y,c)&&(0,p.WithinEpsilon)(this._z,Z._z,c)&&(0,p.WithinEpsilon)(this._w,Z._w,c)}isApprox(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.e;return Z&&((0,p.WithinEpsilon)(this._x,Z._x,c)&&(0,p.WithinEpsilon)(this._y,Z._y,c)&&(0,p.WithinEpsilon)(this._z,Z._z,c)&&(0,p.WithinEpsilon)(this._w,Z._w,c)||(0,p.WithinEpsilon)(this._x,-Z._x,c)&&(0,p.WithinEpsilon)(this._y,-Z._y,c)&&(0,p.WithinEpsilon)(this._z,-Z._z,c)&&(0,p.WithinEpsilon)(this._w,-Z._w,c))}clone(){return new w(this._x,this._y,this._z,this._w)}R(Z){return this._x=Z._x,this._y=Z._y,this._z=Z._z,this._w=Z._w,this._isDirty=!0,this}wc(Z,c,L,k){return this._x=Z,this._y=c,this._z=L,this._w=k,this._isDirty=!0,this}set(Z,c,L,k){return this.wc(Z,c,L,k)}uc(Z){return this.wc(Z,Z,Z,Z)}add(Z){return new w(this._x+Z._x,this._y+Z._y,this._z+Z._z,this._w+Z._w)}addInPlace(Z){return this._x+=Z._x,this._y+=Z._y,this._z+=Z._z,this._w+=Z._w,this._isDirty=!0,this}addToRef(Z,c){return c._x=this._x+Z._x,c._y=this._y+Z._y,c._z=this._z+Z._z,c._w=this._w+Z._w,c._isDirty=!0,c}addInPlaceFromFloats(Z,c,L,k){return this._x+=Z,this._y+=c,this._z+=L,this._w+=k,this._isDirty=!0,this}subtractToRef(Z,c){return c._x=this._x-Z._x,c._y=this._y-Z._y,c._z=this._z-Z._z,c._w=this._w-Z._w,c._isDirty=!0,c}subtractFromFloats(Z,c,L,k){return this.subtractFromFloatsToRef(Z,c,L,k,new w)}subtractFromFloatsToRef(Z,c,L,k,N){return N._x=this._x-Z,N._y=this._y-c,N._z=this._z-L,N._w=this._w-k,N._isDirty=!0,N}yL(Z){return new w(this._x-Z._x,this._y-Z._y,this._z-Z._z,this._w-Z._w)}sz(Z){return this._x-=Z._x,this._y-=Z._y,this._z-=Z._z,this._w-=Z._w,this._isDirty=!0,this}scale(Z){return new w(this._x*Z,this._y*Z,this._z*Z,this._w*Z)}scaleToRef(Z,c){return c._x=this._x*Z,c._y=this._y*Z,c._z=this._z*Z,c._w=this._w*Z,c._isDirty=!0,c}scaleInPlace(Z){return this._x*=Z,this._y*=Z,this._z*=Z,this._w*=Z,this._isDirty=!0,this}scaleAndAddToRef(Z,c){return c._x+=this._x*Z,c._y+=this._y*Z,c._z+=this._z*Z,c._w+=this._w*Z,c._isDirty=!0,c}multiply(Z){const c=new w(0,0,0,1);return this.multiplyToRef(Z,c),c}multiplyToRef(Z,c){const L=this._x*Z._w+this._y*Z._z-this._z*Z._y+this._w*Z._x,k=-this._x*Z._z+this._y*Z._w+this._z*Z._x+this._w*Z._y,N=this._x*Z._y-this._y*Z._x+this._z*Z._w+this._w*Z._z,R=-this._x*Z._x-this._y*Z._y-this._z*Z._z+this._w*Z._w;return c.wc(L,k,N,R),c}multiplyInPlace(Z){return this.multiplyToRef(Z,this)}multiplyByFloats(Z,c,L,k){return this._x*=Z,this._y*=c,this._z*=L,this._w*=k,this._isDirty=!0,this}divide(Z){throw new ReferenceError("Can not divide a quaternion")}divideToRef(Z,c){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(Z){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new w)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(Z){return Z._x=-this._x,Z._y=-this._y,Z._z=-this._z,Z._w=-this._w,Z._isDirty=!0,Z}equalsToFloats(Z,c,L,k){return this._x===Z&&this._y===c&&this._z===L&&this._w===k}floorToRef(Z){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(Z){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(Z){return Z.wc(-this._x,-this._y,-this._z,this._w),Z}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new w(-this._x,-this._y,-this._z,this._w)}invert(){const Z=this.conjugate(),c=this.lengthSquared();return 0==c||1==c||Z.scaleInPlace(1/c),Z}invertInPlace(){this.conjugateInPlace();const Z=this.lengthSquared();return 0==Z||1==Z||this.scaleInPlace(1/Z),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(Z){return 0===Z||1===Z?this:this.scaleInPlace(1/Z)}normalizeToNew(){const Z=new w(0,0,0,1);return this.normalizeToRef(Z),Z}normalizeToRef(Z){const c=this.length();return 0===c||1===c?Z.wc(this._x,this._y,this._z,this._w):this.scaleToRef(1/c,Z)}toEulerAngles(){const Z=q.Zero();return this.toEulerAnglesToRef(Z),Z}toEulerAnglesToRef(Z){const c=this._z,L=this._x,k=this._y,N=this._w,R=k*c-L*N,G=.4999999;if(R<-G)Z._y=2*Math.atan2(k,N),Z._x=Math.PI/2,Z._z=0,Z._isDirty=!0;else if(R>G)Z._y=2*Math.atan2(k,N),Z._x=-Math.PI/2,Z._z=0,Z._isDirty=!0;else{const G=N*N,V=c*c,p=L*L,J=k*k;Z._z=Math.atan2(2*(L*k+c*N),-V-p+J+G),Z._x=Math.asin(-2*R),Z._y=Math.atan2(2*(c*L+k*N),V-p-J+G),Z._isDirty=!0}return Z}toAlphaBetaGammaToRef(Z){const c=this._z,L=this._x,k=this._y,N=this._w,R=Math.sqrt(L*L+k*k),G=Math.sqrt(c*c+N*N),V=2*Math.atan2(R,G),p=2*Math.atan2(c,N),J=2*Math.atan2(k,L),z=(p+J)/2,i=(p-J)/2;return Z.set(i,V,z),Z}toRotationMatrix(Z){return M.FromQuaternionToRef(this,Z),Z}fromRotationMatrix(Z){return w.FromRotationMatrixToRef(Z,this),this}dot(Z){return this._x*Z._x+this._y*Z._y+this._z*Z._z+this._w*Z._w}toAxisAngle(){const Z=q.Zero();return{axis:Z,angle:this.toAxisAngleToRef(Z)}}toAxisAngleToRef(Z){let c=0;const L=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),k=this._w;return L>0?(c=2*Math.atan2(L,k),Z.set(this._x/L,this._y/L,this._z/L)):(c=0,Z.set(1,0,0)),c}static FromRotationMatrix(Z){const c=new w;return w.FromRotationMatrixToRef(Z,c),c}static FromRotationMatrixToRef(Z,c){const L=Z.m,k=L[0],N=L[4],R=L[8],G=L[1],V=L[5],p=L[9],J=L[2],z=L[6],i=L[10],t=k+V+i;let E;return t>0?(E=.5/Math.sqrt(t+1),c._w=.25/E,c._x=(z-p)*E,c._y=(R-J)*E,c._z=(G-N)*E,c._isDirty=!0):k>V&&k>i?(E=2*Math.sqrt(1+k-V-i),c._w=(z-p)/E,c._x=.25*E,c._y=(N+G)/E,c._z=(R+J)/E,c._isDirty=!0):V>i?(E=2*Math.sqrt(1+V-k-i),c._w=(R-J)/E,c._x=(N+G)/E,c._y=.25*E,c._z=(p+z)/E,c._isDirty=!0):(E=2*Math.sqrt(1+i-k-V),c._w=(G-N)/E,c._x=(R+J)/E,c._y=(p+z)/E,c._z=.25*E,c._isDirty=!0),c}static Dot(Z,c){return Z._x*c._x+Z._y*c._y+Z._z*c._z+Z._w*c._w}static AreClose(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const k=w.Dot(Z,c);return 1-k*k<=L}static SmoothToRef(Z,c,L,k,N){let R=0===k?1:L/k;return R=(0,p.Clamp)(R,0,1),w.SlerpToRef(Z,c,R,N),N}static Zero(){return new w(0,0,0,0)}static Inverse(Z){return new w(-Z._x,-Z._y,-Z._z,Z._w)}static InverseToRef(Z,c){return c.set(-Z._x,-Z._y,-Z._z,Z._w),c}static Identity(){return new w(0,0,0,1)}static IsIdentity(Z){return Z&&0===Z._x&&0===Z._y&&0===Z._z&&1===Z._w}static RotationAxis(Z,c){return w.RotationAxisToRef(Z,c,new w)}static RotationAxisToRef(Z,c,L){L._w=Math.cos(c/2);const k=Math.sin(c/2)/Z.length();return L._x=Z._x*k,L._y=Z._y*k,L._z=Z._z*k,L._isDirty=!0,L}static oc(Z,c){return c||(c=0),new w(Z[c],Z[c+1],Z[c+2],Z[c+3])}static FromArrayToRef(Z,c,L){return L._x=Z[c],L._y=Z[c+1],L._z=Z[c+2],L._w=Z[c+3],L._isDirty=!0,L}static FromFloatsToRef(Z,c,L,k,N){return N.wc(Z,c,L,k),N}static FromEulerAngles(Z,c,L){const k=new w;return w.RotationYawPitchRollToRef(c,Z,L,k),k}static FromEulerAnglesToRef(Z,c,L,k){return w.RotationYawPitchRollToRef(c,Z,L,k),k}static FromEulerVector(Z){const c=new w;return w.RotationYawPitchRollToRef(Z._y,Z._x,Z._z,c),c}static FromEulerVectorToRef(Z,c){return w.RotationYawPitchRollToRef(Z._y,Z._x,Z._z,c),c}static FromUnitVectorsToRef(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.e;const R=q.Dot(Z,c)+1;return R<N?Math.abs(Z.x)>Math.abs(Z.z)?L.set(-Z.y,Z.x,0,0):L.set(0,-Z.z,Z.y,0):(q.CrossToRef(Z,c,j.Mc[0]),L.set(j.Mc[0].x,j.Mc[0].y,j.Mc[0].z,R)),L.normalize()}static RotationYawPitchRoll(Z,c,L){const k=new w;return w.RotationYawPitchRollToRef(Z,c,L,k),k}static RotationYawPitchRollToRef(Z,c,L,k){const N=.5*L,R=.5*c,G=.5*Z,V=Math.sin(N),p=Math.cos(N),J=Math.sin(R),z=Math.cos(R),i=Math.sin(G),t=Math.cos(G);return k._x=t*J*p+i*z*V,k._y=i*z*p-t*J*V,k._z=t*z*V-i*J*p,k._w=t*z*p+i*J*V,k._isDirty=!0,k}static RotationAlphaBetaGamma(Z,c,L){const k=new w;return w.RotationAlphaBetaGammaToRef(Z,c,L,k),k}static RotationAlphaBetaGammaToRef(Z,c,L,k){const N=.5*(L+Z),R=.5*(L-Z),G=.5*c;return k._x=Math.cos(R)*Math.sin(G),k._y=Math.sin(R)*Math.sin(G),k._z=Math.sin(N)*Math.cos(G),k._w=Math.cos(N)*Math.cos(G),k._isDirty=!0,k}static RotationQuaternionFromAxis(Z,c,L){const k=new w(0,0,0,0);return w.RotationQuaternionFromAxisToRef(Z,c,L,k),k}static RotationQuaternionFromAxisToRef(Z,c,L,k){const N=P.Matrix[0];return Z=Z.normalizeToRef(P.Mc[0]),c=c.normalizeToRef(P.Mc[1]),L=L.normalizeToRef(P.Mc[2]),M.FromXYZAxesToRef(Z,c,L,N),w.FromRotationMatrixToRef(N,k),k}static FromLookDirectionLH(Z,c){const L=new w;return w.FromLookDirectionLHToRef(Z,c,L),L}static FromLookDirectionLHToRef(Z,c,L){const k=P.Matrix[0];return M.LookDirectionLHToRef(Z,c,k),w.FromRotationMatrixToRef(k,L),L}static FromLookDirectionRH(Z,c){const L=new w;return w.FromLookDirectionRHToRef(Z,c,L),L}static FromLookDirectionRHToRef(Z,c,L){const k=P.Matrix[0];return M.LookDirectionRHToRef(Z,c,k),w.FromRotationMatrixToRef(k,L)}static Slerp(Z,c,L){const k=w.Identity();return w.SlerpToRef(Z,c,L,k),k}static SlerpToRef(Z,c,L,k){let N,R,G=Z._x*c._x+Z._y*c._y+Z._z*c._z+Z._w*c._w,V=!1;if(G<0&&(V=!0,G=-G),G>.999999)R=1-L,N=V?-L:L;else{const Z=Math.acos(G),c=1/Math.sin(Z);R=Math.sin((1-L)*Z)*c,N=V?-Math.sin(L*Z)*c:Math.sin(L*Z)*c}return k._x=R*Z._x+N*c._x,k._y=R*Z._y+N*c._y,k._z=R*Z._z+N*c._z,k._w=R*Z._w+N*c._w,k._isDirty=!0,k}static Hermite(Z,c,L,k,N){const R=N*N,G=N*R,V=2*G-3*R+1,p=-2*G+3*R,J=G-2*R+N,z=G-R,i=Z._x*V+L._x*p+c._x*J+k._x*z,t=Z._y*V+L._y*p+c._y*J+k._y*z,E=Z._z*V+L._z*p+c._z*J+k._z*z,x=Z._w*V+L._w*p+c._w*J+k._w*z;return new w(i,t,E,x)}static Hermite1stDerivative(Z,c,L,k,N){const R=new w;return this.Hermite1stDerivativeToRef(Z,c,L,k,N,R),R}static Hermite1stDerivativeToRef(Z,c,L,k,N,R){const G=N*N;return R._x=6*(G-N)*Z._x+(3*G-4*N+1)*c._x+6*(-G+N)*L._x+(3*G-2*N)*k._x,R._y=6*(G-N)*Z._y+(3*G-4*N+1)*c._y+6*(-G+N)*L._y+(3*G-2*N)*k._y,R._z=6*(G-N)*Z._z+(3*G-4*N+1)*c._z+6*(-G+N)*L._z+(3*G-2*N)*k._z,R._w=6*(G-N)*Z._w+(3*G-4*N+1)*c._w+6*(-G+N)*L._w+(3*G-2*N)*k._w,R._isDirty=!0,R}static Normalize(Z){const c=w.Zero();return w.NormalizeToRef(Z,c),c}static NormalizeToRef(Z,c){return Z.normalizeToRef(c),c}static Clamp(Z,c,L){const k=new w;return w.ClampToRef(Z,c,L,k),k}static ClampToRef(Z,c,L,k){return k.wc((0,p.Clamp)(Z.x,c.x,L.x),(0,p.Clamp)(Z.y,c.y,L.y),(0,p.Clamp)(Z.z,c.z,L.z),(0,p.Clamp)(Z.w,c.w,L.w))}static Random(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new w((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static RandomToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wc((0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c),(0,p.RandomRange)(Z,c))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(Z,c){return Math.sqrt(w.DistanceSquared(Z,c))}static DistanceSquared(Z,c){const L=Z.x-c.x,k=Z.y-c.y,N=Z.z-c.z,R=Z.w-c.w;return L*L+k*k+N*N+R*R}static Center(Z,c){return w.CenterToRef(Z,c,w.Zero())}static CenterToRef(Z,c,L){return L.wc((Z.x+c.x)/2,(Z.y+c.y)/2,(Z.z+c.z)/2,(Z.w+c.w)/2)}}w._V8PerformanceHack=new w(.5,.5,.5,.5),Object.defineProperties(w.prototype,{dimension:{value:[4]},rank:{value:1}});class M{static get Use64Bits(){return G.c.MatrixUse64Bits}get m(){return this.zt}markAsUpdated(){this.updateFlag=J._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=Z,this._isIdentity3x2=Z||L,this._isIdentityDirty=!this._isIdentity&&c,this._isIdentity3x2Dirty=!this._isIdentity3x2&&k}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,G.c.MatrixTrackPrecisionChange&&G.c.MatrixTrackedMatrices.push(this),this.zt=new G.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const Z=this.zt;this._isIdentity=1===Z[0]&&0===Z[1]&&0===Z[2]&&0===Z[3]&&0===Z[4]&&1===Z[5]&&0===Z[6]&&0===Z[7]&&0===Z[8]&&0===Z[9]&&1===Z[10]&&0===Z[11]&&0===Z[12]&&0===Z[13]&&0===Z[14]&&1===Z[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.zt[0]||1!==this.zt[5]||1!==this.zt[15]||0!==this.zt[1]||0!==this.zt[2]||0!==this.zt[3]||0!==this.zt[4]||0!==this.zt[6]||0!==this.zt[7]||0!==this.zt[8]||0!==this.zt[9]||0!==this.zt[10]||0!==this.zt[11]||0!==this.zt[12]||0!==this.zt[13]||0!==this.zt[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const Z=this.zt,c=Z[0],L=Z[1],k=Z[2],N=Z[3],R=Z[4],G=Z[5],V=Z[6],p=Z[7],J=Z[8],z=Z[9],i=Z[10],t=Z[11],E=Z[12],x=Z[13],q=Z[14],O=Z[15],w=i*O-q*t,M=z*O-x*t,P=z*q-x*i,j=J*O-E*t,o=J*q-i*E,u=J*x-E*z;return c*+(G*w-V*M+p*P)+L*-(R*w-V*j+p*o)+k*+(R*M-G*j+p*u)+N*-(R*P-G*o+V*u)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Z)return this.zt;const L=this.zt;for(let k=0;k<16;k++)Z[c+k]=L[k];return this}xc(){return this.zt}vL(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return M.FromArrayToRef(Z,c,this)}wc(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];return M.FromArrayToRef(c,0,this)}set(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}uc(Z){const c=this.zt;for(let L=0;L<16;L++)c[L]=Z;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return M.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(Z){const c=new M;return this.addToRef(Z,c),c}addToRef(Z,c){const L=this.zt,k=c.zt,N=Z.m;for(let R=0;R<16;R++)k[R]=L[R]+N[R];return c.markAsUpdated(),c}addToSelf(Z){const c=this.zt,L=Z.m;return c[0]+=L[0],c[1]+=L[1],c[2]+=L[2],c[3]+=L[3],c[4]+=L[4],c[5]+=L[5],c[6]+=L[6],c[7]+=L[7],c[8]+=L[8],c[9]+=L[9],c[10]+=L[10],c[11]+=L[11],c[12]+=L[12],c[13]+=L[13],c[14]+=L[14],c[15]+=L[15],this.markAsUpdated(),this}addInPlace(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]+=L[k];return this.markAsUpdated(),this}addInPlaceFromFloats(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]+=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}yL(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]-=L[k];return this.markAsUpdated(),this}subtractToRef(Z,c){const L=this.zt,k=Z.m,N=c.zt;for(let R=0;R<16;R++)N[R]=L[R]-k[R];return c.markAsUpdated(),c}sz(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]-=L[k];return this.markAsUpdated(),this}subtractFromFloats(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];return this.subtractFromFloatsToRef(...c,new M)}subtractFromFloatsToRef(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];const k=c.pop(),N=this.zt,R=k.zt,G=c;for(let V=0;V<16;V++)R[V]=N[V]-G[V];return k.markAsUpdated(),k}invertToRef(Z){return!0===this._isIdentity?(M.IdentityToRef(Z),Z):(t(this,Z.xc())?Z.markAsUpdated():Z.R(this),Z)}addAtIndex(Z,c){return this.zt[Z]+=c,this.markAsUpdated(),this}multiplyAtIndex(Z,c){return this.zt[Z]*=c,this.markAsUpdated(),this}setTranslationFromFloats(Z,c,L){return this.zt[12]=Z,this.zt[13]=c,this.zt[14]=L,this.markAsUpdated(),this}addTranslationFromFloats(Z,c,L){return this.zt[12]+=Z,this.zt[13]+=c,this.zt[14]+=L,this.markAsUpdated(),this}setTranslation(Z){return this.setTranslationFromFloats(Z._x,Z._y,Z._z)}getTranslation(){return new q(this.zt[12],this.zt[13],this.zt[14])}getTranslationToRef(Z){return Z.x=this.zt[12],Z.y=this.zt[13],Z.z=this.zt[14],Z}removeRotationAndScaling(){const Z=this.m;return M.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,Z[12],Z[13],Z[14],Z[15],this),this._updateIdentityStatus(0===Z[12]&&0===Z[13]&&0===Z[14]&&1===Z[15]),this}R(Z){Z.copyToArray(this.zt);const c=Z;return this.updateFlag=c.updateFlag,this._updateIdentityStatus(c._isIdentity,c._isIdentityDirty,c._isIdentity3x2,c._isIdentity3x2Dirty),this}copyToArray(Z){return i(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(Z){const c=new M;return this.multiplyToRef(Z,c),c}multiplyInPlace(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]*=L[k];return this.markAsUpdated(),this}multiplyByFloats(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]*=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];const k=c.pop(),N=this.zt,R=k.zt,G=c;for(let V=0;V<16;V++)R[V]=N[V]*G[V];return k.markAsUpdated(),k}multiplyToRef(Z,c){return this._isIdentity?(c.R(Z),c):Z._isIdentity?(c.R(this),c):(this.multiplyToArray(Z,c.zt,0),c.markAsUpdated(),c)}multiplyToArray(Z,c,L){return z(this,Z,c,L),this}divide(Z){return this.divideToRef(Z,new M)}divideToRef(Z,c){const L=this.zt,k=Z.m,N=c.zt;for(let R=0;R<16;R++)N[R]=L[R]/k[R];return c.markAsUpdated(),c}divideInPlace(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]/=L[k];return this.markAsUpdated(),this}minimizeInPlace(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]=Math.min(c[k],L[k]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]=Math.min(Z[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}maximizeInPlace(Z){const c=this.zt,L=Z.m;for(let k=0;k<16;k++)c[k]=Math.min(c[k],L[k]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]=Math.min(Z[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new M)}negateInPlace(){const Z=this.zt;for(let c=0;c<16;c++)Z[c]=-Z[c];return this.markAsUpdated(),this}negateToRef(Z){const c=this.zt,L=Z.zt;for(let k=0;k<16;k++)L[k]=-c[k];return Z.markAsUpdated(),Z}equals(Z){const c=Z;if(!c)return!1;if((this._isIdentity||c._isIdentity)&&!this._isIdentityDirty&&!c._isIdentityDirty)return this._isIdentity&&c._isIdentity;const L=this.m,k=c.m;return L[0]===k[0]&&L[1]===k[1]&&L[2]===k[2]&&L[3]===k[3]&&L[4]===k[4]&&L[5]===k[5]&&L[6]===k[6]&&L[7]===k[7]&&L[8]===k[8]&&L[9]===k[9]&&L[10]===k[10]&&L[11]===k[11]&&L[12]===k[12]&&L[13]===k[13]&&L[14]===k[14]&&L[15]===k[15]}equalsWithEpsilon(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=this.zt,k=Z.m;for(let N=0;N<16;N++)if(!(0,p.WithinEpsilon)(L[N],k[N],c))return!1;return!0}equalsToFloats(){const Z=this.zt;for(let c=0;c<16;c++)if(Z[c]!=(c<0||arguments.length<=c?void 0:arguments[c]))return!1;return!0}floor(){return this.floorToRef(new M)}floorToRef(Z){const c=this.zt,L=Z.zt;for(let k=0;k<16;k++)L[k]=Math.floor(c[k]);return Z.markAsUpdated(),Z}fract(){return this.fractToRef(new M)}fractToRef(Z){const c=this.zt,L=Z.zt;for(let k=0;k<16;k++)L[k]=c[k]-Math.floor(c[k]);return Z.markAsUpdated(),Z}clone(){const Z=new M;return Z.R(this),Z}getClassName(){return"Matrix"}getHashCode(){let Z=E(this.zt[0]);for(let c=1;c<16;c++)Z=397*Z^E(this.zt[c]);return Z}decomposeToTransformNode(Z){return Z.rotationQuaternion=Z.rotationQuaternion||new w,this.decompose(Z.Pc,Z.rotationQuaternion,Z.position)}decompose(Z,c,L,k){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return L&&L.uc(0),Z&&Z.uc(1),c&&c.wc(0,0,0,1),!0;const R=this.zt;if(L&&L.wc(R[12],R[13],R[14]),(Z=Z||P.Mc[0]).x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),Z.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),Z.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),k){const c=(N?k.absoluteScaling.x:k.Pc.x)<0?-1:1,L=(N?k.absoluteScaling.y:k.Pc.y)<0?-1:1,R=(N?k.absoluteScaling.z:k.Pc.z)<0?-1:1;Z.x*=c,Z.y*=L,Z.z*=R}else this.determinant()<=0&&(Z.y*=-1);if(0===Z._x||0===Z._y||0===Z._z)return c&&c.wc(0,0,0,1),!1;if(c){const L=1/Z._x,k=1/Z._y,N=1/Z._z;M.FromValuesToRef(R[0]*L,R[1]*L,R[2]*L,0,R[4]*k,R[5]*k,R[6]*k,0,R[8]*N,R[9]*N,R[10]*N,0,0,0,0,1,P.Matrix[0]),w.FromRotationMatrixToRef(P.Matrix[0],c)}return!0}getRow(Z){if(Z<0||Z>3)return null;const c=4*Z;return new O(this.zt[c+0],this.zt[c+1],this.zt[c+2],this.zt[c+3])}getRowToRef(Z,c){if(Z>=0&&Z<=3){const L=4*Z;c.x=this.zt[L+0],c.y=this.zt[L+1],c.z=this.zt[L+2],c.w=this.zt[L+3]}return c}setRow(Z,c){return this.setRowFromFloats(Z,c.x,c.y,c.z,c.w)}transpose(){const Z=new M;return M.TransposeToRef(this,Z),Z}transposeToRef(Z){return M.TransposeToRef(this,Z),Z}setRowFromFloats(Z,c,L,k,N){if(Z<0||Z>3)return this;const R=4*Z;return this.zt[R+0]=c,this.zt[R+1]=L,this.zt[R+2]=k,this.zt[R+3]=N,this.markAsUpdated(),this}scale(Z){const c=new M;return this.scaleToRef(Z,c),c}scaleToRef(Z,c){for(let L=0;L<16;L++)c.zt[L]=this.zt[L]*Z;return c.markAsUpdated(),c}scaleAndAddToRef(Z,c){for(let L=0;L<16;L++)c.zt[L]+=this.zt[L]*Z;return c.markAsUpdated(),c}scaleInPlace(Z){const c=this.zt;for(let L=0;L<16;L++)c[L]*=Z;return this.markAsUpdated(),this}toNormalMatrix(Z){const c=P.Matrix[0];this.invertToRef(c),c.transposeToRef(Z);const L=Z.zt;return M.FromValuesToRef(L[0],L[1],L[2],0,L[4],L[5],L[6],0,L[8],L[9],L[10],0,0,0,0,1,Z),Z}getRotationMatrix(){const Z=new M;return this.getRotationMatrixToRef(Z),Z}getRotationMatrixToRef(Z){const c=P.Mc[0];if(!this.decompose(c))return M.IdentityToRef(Z),Z;const L=this.zt,k=1/c._x,N=1/c._y,R=1/c._z;return M.FromValuesToRef(L[0]*k,L[1]*k,L[2]*k,0,L[4]*N,L[5]*N,L[6]*N,0,L[8]*R,L[9]*R,L[10]*R,0,0,0,0,1,Z),Z}toggleModelMatrixHandInPlace(){const Z=this.zt;return Z[2]*=-1,Z[6]*=-1,Z[8]*=-1,Z[9]*=-1,Z[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const Z=this.zt;return Z[8]*=-1,Z[9]*=-1,Z[10]*=-1,Z[11]*=-1,this.markAsUpdated(),this}static oc(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const L=new M;return M.FromArrayToRef(Z,c,L),L}static FromArrayToRef(Z,c,L){for(let k=0;k<16;k++)L.zt[k]=Z[k+c];return L.markAsUpdated(),L}static FromFloat32ArrayToRefScaled(Z,c,L,k){return k.zt[0]=Z[0+c]*L,k.zt[1]=Z[1+c]*L,k.zt[2]=Z[2+c]*L,k.zt[3]=Z[3+c]*L,k.zt[4]=Z[4+c]*L,k.zt[5]=Z[5+c]*L,k.zt[6]=Z[6+c]*L,k.zt[7]=Z[7+c]*L,k.zt[8]=Z[8+c]*L,k.zt[9]=Z[9+c]*L,k.zt[10]=Z[10+c]*L,k.zt[11]=Z[11+c]*L,k.zt[12]=Z[12+c]*L,k.zt[13]=Z[13+c]*L,k.zt[14]=Z[14+c]*L,k.zt[15]=Z[15+c]*L,k.markAsUpdated(),k}static get IdentityReadOnly(){return M._IdentityReadOnly}static FromValuesToRef(Z,c,L,k,N,R,G,V,p,J,z,i,t,E,x,q,O){const w=O.zt;w[0]=Z,w[1]=c,w[2]=L,w[3]=k,w[4]=N,w[5]=R,w[6]=G,w[7]=V,w[8]=p,w[9]=J,w[10]=z,w[11]=i,w[12]=t,w[13]=E,w[14]=x,w[15]=q,O.markAsUpdated()}static FromValues(Z,c,L,k,N,R,G,V,p,J,z,i,t,E,x,q){const O=new M,w=O.zt;return w[0]=Z,w[1]=c,w[2]=L,w[3]=k,w[4]=N,w[5]=R,w[6]=G,w[7]=V,w[8]=p,w[9]=J,w[10]=z,w[11]=i,w[12]=t,w[13]=E,w[14]=x,w[15]=q,O.markAsUpdated(),O}static Compose(Z,c,L){const k=new M;return M.ComposeToRef(Z,c,L,k),k}static ComposeToRef(Z,c,L,k){const N=k.zt,R=c._x,G=c._y,V=c._z,p=c._w,J=R+R,z=G+G,i=V+V,t=R*J,E=R*z,x=R*i,q=G*z,O=G*i,w=V*i,M=p*J,P=p*z,j=p*i,o=Z._x,u=Z._y,X=Z._z;return N[0]=(1-(q+w))*o,N[1]=(E+j)*o,N[2]=(x-P)*o,N[3]=0,N[4]=(E-j)*u,N[5]=(1-(t+w))*u,N[6]=(O+M)*u,N[7]=0,N[8]=(x+P)*X,N[9]=(O-M)*X,N[10]=(1-(t+q))*X,N[11]=0,N[12]=L._x,N[13]=L._y,N[14]=L._z,N[15]=1,k.markAsUpdated(),k}static Identity(){const Z=M.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return Z._updateIdentityStatus(!0),Z}static IdentityToRef(Z){return M.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,Z),Z._updateIdentityStatus(!0),Z}static Zero(){const Z=M.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return Z._updateIdentityStatus(!1),Z}static RotationX(Z){const c=new M;return M.RotationXToRef(Z,c),c}static Invert(Z){const c=new M;return Z.invertToRef(c),c}static RotationXToRef(Z,c){const L=Math.sin(Z),k=Math.cos(Z);return M.FromValuesToRef(1,0,0,0,0,k,L,0,0,-L,k,0,0,0,0,1,c),c._updateIdentityStatus(1===k&&0===L),c}static RotationY(Z){const c=new M;return M.RotationYToRef(Z,c),c}static RotationYToRef(Z,c){const L=Math.sin(Z),k=Math.cos(Z);return M.FromValuesToRef(k,0,-L,0,0,1,0,0,L,0,k,0,0,0,0,1,c),c._updateIdentityStatus(1===k&&0===L),c}static RotationZ(Z){const c=new M;return M.RotationZToRef(Z,c),c}static RotationZToRef(Z,c){const L=Math.sin(Z),k=Math.cos(Z);return M.FromValuesToRef(k,L,0,0,-L,k,0,0,0,0,1,0,0,0,0,1,c),c._updateIdentityStatus(1===k&&0===L),c}static RotationAxis(Z,c){const L=new M;return M.RotationAxisToRef(Z,c,L),L}static RotationAxisToRef(Z,c,L){const k=Math.sin(-c),N=Math.cos(-c),R=1-N;Z=Z.normalizeToRef(P.Mc[0]);const G=L.zt;return G[0]=Z._x*Z._x*R+N,G[1]=Z._x*Z._y*R-Z._z*k,G[2]=Z._x*Z._z*R+Z._y*k,G[3]=0,G[4]=Z._y*Z._x*R+Z._z*k,G[5]=Z._y*Z._y*R+N,G[6]=Z._y*Z._z*R-Z._x*k,G[7]=0,G[8]=Z._z*Z._x*R-Z._y*k,G[9]=Z._z*Z._y*R+Z._x*k,G[10]=Z._z*Z._z*R+N,G[11]=0,G[12]=0,G[13]=0,G[14]=0,G[15]=1,L.markAsUpdated(),L}static RotationAlignToRef(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const R=q.Dot(c,Z),G=L.zt;if(R<-1+k.e)G[0]=-1,G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=N?1:-1,G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=N?-1:1,G[11]=0;else{const L=q.Cross(c,Z),k=1/(1+R);G[0]=L._x*L._x*k+R,G[1]=L._y*L._x*k-L._z,G[2]=L._z*L._x*k+L._y,G[3]=0,G[4]=L._x*L._y*k+L._z,G[5]=L._y*L._y*k+R,G[6]=L._z*L._y*k-L._x,G[7]=0,G[8]=L._x*L._z*k-L._y,G[9]=L._y*L._z*k+L._x,G[10]=L._z*L._z*k+R,G[11]=0}return G[12]=0,G[13]=0,G[14]=0,G[15]=1,L.markAsUpdated(),L}static RotationYawPitchRoll(Z,c,L){const k=new M;return M.RotationYawPitchRollToRef(Z,c,L,k),k}static RotationYawPitchRollToRef(Z,c,L,k){return w.RotationYawPitchRollToRef(Z,c,L,P.Quaternion[0]),P.Quaternion[0].toRotationMatrix(k),k}static Scaling(Z,c,L){const k=new M;return M.ScalingToRef(Z,c,L,k),k}static ScalingToRef(Z,c,L,k){return M.FromValuesToRef(Z,0,0,0,0,c,0,0,0,0,L,0,0,0,0,1,k),k._updateIdentityStatus(1===Z&&1===c&&1===L),k}static Translation(Z,c,L){const k=new M;return M.TranslationToRef(Z,c,L,k),k}static TranslationToRef(Z,c,L,k){return M.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,Z,c,L,1,k),k._updateIdentityStatus(0===Z&&0===c&&0===L),k}static Lerp(Z,c,L){const k=new M;return M.LerpToRef(Z,c,L,k),k}static LerpToRef(Z,c,L,k){const N=k.zt,R=Z.m,G=c.m;for(let V=0;V<16;V++)N[V]=R[V]*(1-L)+G[V]*L;return k.markAsUpdated(),k}static DecomposeLerp(Z,c,L){const k=new M;return M.DecomposeLerpToRef(Z,c,L,k),k}static DecomposeLerpToRef(Z,c,L,k){const N=P.Mc[0],R=P.Quaternion[0],G=P.Mc[1];Z.decompose(N,R,G);const V=P.Mc[2],p=P.Quaternion[1],J=P.Mc[3];c.decompose(V,p,J);const z=P.Mc[4];q.LerpToRef(N,V,L,z);const i=P.Quaternion[2];w.SlerpToRef(R,p,L,i);const t=P.Mc[5];return q.LerpToRef(G,J,L,t),M.ComposeToRef(z,i,t,k),k}static LookAtLH(Z,c,L){const k=new M;return M.LookAtLHToRef(Z,c,L,k),k}static LookAtLHToRef(Z,c,L,k){const N=P.Mc[0],R=P.Mc[1],G=P.Mc[2];c.subtractToRef(Z,G),G.normalize(),q.CrossToRef(L,G,N);const V=N.lengthSquared();0===V?N.x=1:N.normalizeFromLength(Math.sqrt(V)),q.CrossToRef(G,N,R),R.normalize();const p=-q.Dot(N,Z),J=-q.Dot(R,Z),z=-q.Dot(G,Z);return M.FromValuesToRef(N._x,R._x,G._x,0,N._y,R._y,G._y,0,N._z,R._z,G._z,0,p,J,z,1,k),k}static LookAtRH(Z,c,L){const k=new M;return M.LookAtRHToRef(Z,c,L,k),k}static LookAtRHToRef(Z,c,L,k){const N=P.Mc[0],R=P.Mc[1],G=P.Mc[2];Z.subtractToRef(c,G),G.normalize(),q.CrossToRef(L,G,N);const V=N.lengthSquared();0===V?N.x=1:N.normalizeFromLength(Math.sqrt(V)),q.CrossToRef(G,N,R),R.normalize();const p=-q.Dot(N,Z),J=-q.Dot(R,Z),z=-q.Dot(G,Z);return M.FromValuesToRef(N._x,R._x,G._x,0,N._y,R._y,G._y,0,N._z,R._z,G._z,0,p,J,z,1,k),k}static LookDirectionLH(Z,c){const L=new M;return M.LookDirectionLHToRef(Z,c,L),L}static LookDirectionLHToRef(Z,c,L){const k=P.Mc[0];k.R(Z),k.scaleInPlace(-1);const N=P.Mc[1];return q.CrossToRef(c,k,N),M.FromValuesToRef(N._x,N._y,N._z,0,c._x,c._y,c._z,0,k._x,k._y,k._z,0,0,0,0,1,L),L}static LookDirectionRH(Z,c){const L=new M;return M.LookDirectionRHToRef(Z,c,L),L}static LookDirectionRHToRef(Z,c,L){const k=P.Mc[2];return q.CrossToRef(c,Z,k),M.FromValuesToRef(k._x,k._y,k._z,0,c._x,c._y,c._z,0,Z._x,Z._y,Z._z,0,0,0,0,1,L),L}static OrthoLH(Z,c,L,k,N){const R=new M;return M.OrthoLHToRef(Z,c,L,k,R,N),R}static OrthoLHToRef(Z,c,L,k,N,R){const G=2/Z,V=2/c,p=2/(k-L),J=-(k+L)/(k-L);return M.FromValuesToRef(G,0,0,0,0,V,0,0,0,0,p,0,0,0,J,1,N),R&&N.multiplyToRef(o,N),N._updateIdentityStatus(1===G&&1===V&&1===p&&0===J),N}static OrthoOffCenterLH(Z,c,L,k,N,R,G){const V=new M;return M.OrthoOffCenterLHToRef(Z,c,L,k,N,R,V,G),V}static OrthoOffCenterLHToRef(Z,c,L,k,N,R,G,V){const p=2/(c-Z),J=2/(k-L),z=2/(R-N),i=-(R+N)/(R-N),t=(Z+c)/(Z-c),E=(k+L)/(L-k);return M.FromValuesToRef(p,0,0,0,0,J,0,0,0,0,z,0,t,E,i,1,G),V&&G.multiplyToRef(o,G),G.markAsUpdated(),G}static ObliqueOffCenterLHToRef(Z,c,L,k,N,R,G,V,p,J,z){const i=-G*Math.cos(V),t=-G*Math.sin(V);return M.TranslationToRef(0,0,-p,P.Matrix[1]),M.FromValuesToRef(1,0,0,0,0,1,0,0,i,t,1,0,0,0,0,1,P.Matrix[0]),P.Matrix[1].multiplyToRef(P.Matrix[0],P.Matrix[0]),M.TranslationToRef(0,0,p,P.Matrix[1]),P.Matrix[0].multiplyToRef(P.Matrix[1],P.Matrix[0]),M.OrthoOffCenterLHToRef(Z,c,L,k,N,R,J,z),P.Matrix[0].multiplyToRef(J,J),J}static OrthoOffCenterRH(Z,c,L,k,N,R,G){const V=new M;return M.OrthoOffCenterRHToRef(Z,c,L,k,N,R,V,G),V}static OrthoOffCenterRHToRef(Z,c,L,k,N,R,G,V){return M.OrthoOffCenterLHToRef(Z,c,L,k,N,R,G,V),G.zt[10]*=-1,G}static ObliqueOffCenterRHToRef(Z,c,L,k,N,R,G,V,p,J,z){const i=G*Math.cos(V),t=G*Math.sin(V);return M.TranslationToRef(0,0,p,P.Matrix[1]),M.FromValuesToRef(1,0,0,0,0,1,0,0,i,t,1,0,0,0,0,1,P.Matrix[0]),P.Matrix[1].multiplyToRef(P.Matrix[0],P.Matrix[0]),M.TranslationToRef(0,0,-p,P.Matrix[1]),P.Matrix[0].multiplyToRef(P.Matrix[1],P.Matrix[0]),M.OrthoOffCenterRHToRef(Z,c,L,k,N,R,J,z),P.Matrix[0].multiplyToRef(J,J),J}static PerspectiveLH(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const G=new M,V=2*L/Z,p=2*L/c,J=(k+L)/(k-L),z=-2*k*L/(k-L),i=Math.tan(R);return M.FromValuesToRef(V,0,0,0,0,p,0,i,0,0,J,1,0,0,z,0,G),N&&G.multiplyToRef(o,G),G._updateIdentityStatus(!1),G}static PerspectiveFovLH(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const V=new M;return M.PerspectiveFovLHToRef(Z,c,L,k,V,!0,N,R,G),V}static PerspectiveFovLHToRef(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=L,z=k,i=1/Math.tan(.5*Z),t=R?i/c:i,E=R?i:i*c,x=p&&0===J?-1:0!==z?(z+J)/(z-J):1,q=p&&0===J?2*z:0!==z?-2*z*J/(z-J):-2*J,O=Math.tan(V);return M.FromValuesToRef(t,0,0,0,0,E,0,O,0,0,x,1,0,0,q,0,N),G&&N.multiplyToRef(o,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseLHToRef(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const p=1/Math.tan(.5*Z),J=R?p/c:p,z=R?p:p*c,i=Math.tan(V);return M.FromValuesToRef(J,0,0,0,0,z,0,i,0,0,-L,1,0,0,1,0,N),G&&N.multiplyToRef(o,N),N._updateIdentityStatus(!1),N}static PerspectiveFovRH(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const V=new M;return M.PerspectiveFovRHToRef(Z,c,L,k,V,!0,N,R,G),V}static PerspectiveFovRHToRef(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=L,z=k,i=1/Math.tan(.5*Z),t=R?i/c:i,E=R?i:i*c,x=p&&0===J?1:0!==z?-(z+J)/(z-J):-1,q=p&&0===J?2*z:0!==z?-2*z*J/(z-J):-2*J,O=Math.tan(V);return M.FromValuesToRef(t,0,0,0,0,E,0,O,0,0,x,-1,0,0,q,0,N),G&&N.multiplyToRef(o,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseRHToRef(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const p=1/Math.tan(.5*Z),J=R?p/c:p,z=R?p:p*c,i=Math.tan(V);return M.FromValuesToRef(J,0,0,0,0,z,0,i,0,0,-L,-1,0,0,-1,0,N),G&&N.multiplyToRef(o,N),N._updateIdentityStatus(!1),N}static GetFinalMatrix(Z,c,L,k,N,R){const G=Z.width,V=Z.height,p=Z.x,J=Z.y,z=M.FromValues(G/2,0,0,0,0,-V/2,0,0,0,0,R-N,0,p+G/2,V/2+J,N,1),i=new M;return c.multiplyToRef(L,i),i.multiplyToRef(k,i),i.multiplyToRef(z,i)}static GetAsMatrix2x2(Z){const c=Z.m,L=[c[0],c[1],c[4],c[5]];return G.c.MatrixUse64Bits?L:new Float32Array(L)}static GetAsMatrix3x3(Z){const c=Z.m,L=[c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]];return G.c.MatrixUse64Bits?L:new Float32Array(L)}static Transpose(Z){const c=new M;return M.TransposeToRef(Z,c),c}static TransposeToRef(Z,c){const L=Z.m,k=L[0],N=L[4],R=L[8],G=L[12],V=L[1],p=L[5],J=L[9],z=L[13],i=L[2],t=L[6],E=L[10],x=L[14],q=L[3],O=L[7],w=L[11],M=L[15],P=c.zt;return P[0]=k,P[1]=N,P[2]=R,P[3]=G,P[4]=V,P[5]=p,P[6]=J,P[7]=z,P[8]=i,P[9]=t,P[10]=E,P[11]=x,P[12]=q,P[13]=O,P[14]=w,P[15]=M,c.markAsUpdated(),c._updateIdentityStatus(Z._isIdentity,Z._isIdentityDirty),c}static Reflection(Z){const c=new M;return M.ReflectionToRef(Z,c),c}static ReflectionToRef(Z,c){Z.normalize();const L=Z.kc.x,k=Z.kc.y,N=Z.kc.z,R=-2*L,G=-2*k,V=-2*N;return M.FromValuesToRef(R*L+1,G*L,V*L,0,R*k,G*k+1,V*k,0,R*N,G*N,V*N+1,0,R*Z.d,G*Z.d,V*Z.d,1,c),c}static FromXYZAxesToRef(Z,c,L,k){return M.FromValuesToRef(Z._x,Z._y,Z._z,0,c._x,c._y,c._z,0,L._x,L._y,L._z,0,0,0,0,1,k),k}static FromQuaternionToRef(Z,c){const L=Z._x*Z._x,k=Z._y*Z._y,N=Z._z*Z._z,R=Z._x*Z._y,G=Z._z*Z._w,V=Z._z*Z._x,p=Z._y*Z._w,J=Z._y*Z._z,z=Z._x*Z._w;return c.zt[0]=1-2*(k+N),c.zt[1]=2*(R+G),c.zt[2]=2*(V-p),c.zt[3]=0,c.zt[4]=2*(R-G),c.zt[5]=1-2*(N+L),c.zt[6]=2*(J+z),c.zt[7]=0,c.zt[8]=2*(V+p),c.zt[9]=2*(J-z),c.zt[10]=1-2*(k+L),c.zt[11]=0,c.zt[12]=0,c.zt[13]=0,c.zt[14]=0,c.zt[15]=1,c.markAsUpdated(),c}}M._IdentityReadOnly=M.Identity(),Object.defineProperties(M.prototype,{dimension:{value:[4,4]},rank:{value:2}});class P{}P.Mc=(0,N.f)(11,q.Zero),P.Matrix=(0,N.f)(2,M.Identity),P.Quaternion=(0,N.f)(3,w.Zero);class j{}j.Vector2=(0,N.f)(3,x.Zero),j.Mc=(0,N.f)(13,q.Zero),j.Vector4=(0,N.f)(3,O.Zero),j.Quaternion=(0,N.f)(3,w.Zero),j.Matrix=(0,N.f)(8,M.Identity),(0,R.g)("BABYLON.Vector2",x),(0,R.g)("BABYLON.Vector3",q),(0,R.g)("BABYLON.Vector4",O),(0,R.g)("BABYLON.Matrix",M);const o=M.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11343:(Z,c,L)=>{L.d(c,{d:()=>k});class k{constructor(Z,c,L,k){this.x=Z,this.y=c,this.width=L,this.height=k}toGlobal(Z,c){return new k(this.x*Z,this.y*c,this.width*Z,this.height*c)}toGlobalToRef(Z,c,L){return L.x=this.x*Z,L.y=this.y*c,L.width=this.width*Z,L.height=this.height*c,this}clone(){return new k(this.x,this.y,this.width,this.height)}}},11461:(Z,c,L)=>{L.d(c,{c:()=>J,d:()=>z});var k=L(10993),N=L(11464);const R=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],G=[()=>1,Z=>Z.y,Z=>Z.z,Z=>Z.x,Z=>Z.x*Z.y,Z=>Z.y*Z.z,Z=>3*Z.z*Z.z-1,Z=>Z.x*Z.z,Z=>Z.x*Z.x-Z.y*Z.y],V=(Z,c)=>R[Z]*G[Z](c),p=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class J{constructor(){this.preScaled=!1,this.l00=k.h.Zero(),this.l1_1=k.h.Zero(),this.l10=k.h.Zero(),this.l11=k.h.Zero(),this.l2_2=k.h.Zero(),this.l2_1=k.h.Zero(),this.l20=k.h.Zero(),this.l21=k.h.Zero(),this.l22=k.h.Zero()}addLight(Z,c,L){N.g.Mc[0].set(c.r,c.g,c.b);const k=N.g.Mc[0],R=N.g.Mc[1];k.scaleToRef(L,R),R.scaleToRef(V(0,Z),N.g.Mc[2]),this.l00.addInPlace(N.g.Mc[2]),R.scaleToRef(V(1,Z),N.g.Mc[2]),this.l1_1.addInPlace(N.g.Mc[2]),R.scaleToRef(V(2,Z),N.g.Mc[2]),this.l10.addInPlace(N.g.Mc[2]),R.scaleToRef(V(3,Z),N.g.Mc[2]),this.l11.addInPlace(N.g.Mc[2]),R.scaleToRef(V(4,Z),N.g.Mc[2]),this.l2_2.addInPlace(N.g.Mc[2]),R.scaleToRef(V(5,Z),N.g.Mc[2]),this.l2_1.addInPlace(N.g.Mc[2]),R.scaleToRef(V(6,Z),N.g.Mc[2]),this.l20.addInPlace(N.g.Mc[2]),R.scaleToRef(V(7,Z),N.g.Mc[2]),this.l21.addInPlace(N.g.Mc[2]),R.scaleToRef(V(8,Z),N.g.Mc[2]),this.l22.addInPlace(N.g.Mc[2])}scaleInPlace(Z){this.l00.scaleInPlace(Z),this.l1_1.scaleInPlace(Z),this.l10.scaleInPlace(Z),this.l11.scaleInPlace(Z),this.l2_2.scaleInPlace(Z),this.l2_1.scaleInPlace(Z),this.l20.scaleInPlace(Z),this.l21.scaleInPlace(Z),this.l22.scaleInPlace(Z)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(p[0]),this.l1_1.scaleInPlace(p[1]),this.l10.scaleInPlace(p[2]),this.l11.scaleInPlace(p[3]),this.l2_2.scaleInPlace(p[4]),this.l2_1.scaleInPlace(p[5]),this.l20.scaleInPlace(p[6]),this.l21.scaleInPlace(p[7]),this.l22.scaleInPlace(p[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(R[0]),this.l1_1.scaleInPlace(R[1]),this.l10.scaleInPlace(R[2]),this.l11.scaleInPlace(R[3]),this.l2_2.scaleInPlace(R[4]),this.l2_1.scaleInPlace(R[5]),this.l20.scaleInPlace(R[6]),this.l21.scaleInPlace(R[7]),this.l22.scaleInPlace(R[8])}updateFromArray(Z){return k.h.FromArrayToRef(Z[0],0,this.l00),k.h.FromArrayToRef(Z[1],0,this.l1_1),k.h.FromArrayToRef(Z[2],0,this.l10),k.h.FromArrayToRef(Z[3],0,this.l11),k.h.FromArrayToRef(Z[4],0,this.l2_2),k.h.FromArrayToRef(Z[5],0,this.l2_1),k.h.FromArrayToRef(Z[6],0,this.l20),k.h.FromArrayToRef(Z[7],0,this.l21),k.h.FromArrayToRef(Z[8],0,this.l22),this}updateFromFloatsArray(Z){return k.h.FromFloatsToRef(Z[0],Z[1],Z[2],this.l00),k.h.FromFloatsToRef(Z[3],Z[4],Z[5],this.l1_1),k.h.FromFloatsToRef(Z[6],Z[7],Z[8],this.l10),k.h.FromFloatsToRef(Z[9],Z[10],Z[11],this.l11),k.h.FromFloatsToRef(Z[12],Z[13],Z[14],this.l2_2),k.h.FromFloatsToRef(Z[15],Z[16],Z[17],this.l2_1),k.h.FromFloatsToRef(Z[18],Z[19],Z[20],this.l20),k.h.FromFloatsToRef(Z[21],Z[22],Z[23],this.l21),k.h.FromFloatsToRef(Z[24],Z[25],Z[26],this.l22),this}static oc(Z){return(new J).updateFromArray(Z)}static FromPolynomial(Z){const c=new J;return c.l00=Z.xx.scale(.376127).add(Z.yy.scale(.376127)).add(Z.zz.scale(.376126)),c.l1_1=Z.y.scale(.977204),c.l10=Z.z.scale(.977204),c.l11=Z.x.scale(.977204),c.l2_2=Z.xy.scale(1.16538),c.l2_1=Z.yz.scale(1.16538),c.l20=Z.zz.scale(1.34567).yL(Z.xx.scale(.672834)).yL(Z.yy.scale(.672834)),c.l21=Z.zx.scale(1.16538),c.l22=Z.xx.scale(1.16538).yL(Z.yy.scale(1.16538)),c.l1_1.scaleInPlace(-1),c.l11.scaleInPlace(-1),c.l2_1.scaleInPlace(-1),c.l21.scaleInPlace(-1),c.scaleInPlace(Math.PI),c}}class z{constructor(){this.x=k.h.Zero(),this.y=k.h.Zero(),this.z=k.h.Zero(),this.xx=k.h.Zero(),this.yy=k.h.Zero(),this.zz=k.h.Zero(),this.xy=k.h.Zero(),this.yz=k.h.Zero(),this.zx=k.h.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=J.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(Z){N.g.Mc[0].wc(Z.r,Z.g,Z.b);const c=N.g.Mc[0];this.xx.addInPlace(c),this.yy.addInPlace(c),this.zz.addInPlace(c)}scaleInPlace(Z){this.x.scaleInPlace(Z),this.y.scaleInPlace(Z),this.z.scaleInPlace(Z),this.xx.scaleInPlace(Z),this.yy.scaleInPlace(Z),this.zz.scaleInPlace(Z),this.yz.scaleInPlace(Z),this.zx.scaleInPlace(Z),this.xy.scaleInPlace(Z)}updateFromHarmonics(Z){return this._harmonics=Z,this.x.R(Z.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.R(Z.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.R(Z.l10),this.z.scaleInPlace(1.02333),this.xx.R(Z.l00),N.g.Mc[0].R(Z.l20).scaleInPlace(.247708),N.g.Mc[1].R(Z.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).sz(N.g.Mc[0]).addInPlace(N.g.Mc[1]),this.yy.R(Z.l00),this.yy.scaleInPlace(.886277).sz(N.g.Mc[0]).sz(N.g.Mc[1]),this.zz.R(Z.l00),N.g.Mc[0].R(Z.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(N.g.Mc[0]),this.yz.R(Z.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.R(Z.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.R(Z.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(Z){return(new z).updateFromHarmonics(Z)}static oc(Z){const c=new z;return k.h.FromArrayToRef(Z[0],0,c.x),k.h.FromArrayToRef(Z[1],0,c.y),k.h.FromArrayToRef(Z[2],0,c.z),k.h.FromArrayToRef(Z[3],0,c.xx),k.h.FromArrayToRef(Z[4],0,c.yy),k.h.FromArrayToRef(Z[5],0,c.zz),k.h.FromArrayToRef(Z[6],0,c.yz),k.h.FromArrayToRef(Z[7],0,c.zx),k.h.FromArrayToRef(Z[8],0,c.xy),c}}},11754:(Z,c,L)=>{L.d(c,{c:()=>w,g:()=>M});var k=L(10993),N=L(11255),R=L(11325),G=L(11289),V=L(11052),p=L(11190),J=L(11471),z=L(10999),i=L(11023);class t extends k.f{constructor(Z,c){super(Z.x,Z.y),this.index=c}}class E{constructor(){this.elements=[]}add(Z){const c=[];for(const L of Z){const Z=new t(L,this.elements.length);c.push(Z),this.elements.push(Z)}return c}computeBounds(){const Z=new k.f(this.elements[0].x,this.elements[0].y),c=new k.f(this.elements[0].x,this.elements[0].y);for(const L of this.elements)L.x<Z.x?Z.x=L.x:L.x>c.x&&(c.x=L.x),L.y<Z.y?Z.y=L.y:L.y>c.y&&(c.y=L.y);return{min:Z,max:c,width:c.x-Z.x,height:c.y-Z.y}}}class x{_addToepoint(Z){for(const c of Z)this._epoints.push(c.x,c.y)}constructor(Z,c,L){let k,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new E,this._outlinepoints=new E,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=N,this._name=Z,this._scene=L||i.d.LastCreatedScene,k=c instanceof J.j?c.getPoints():c,this._addToepoint(k),this._points.add(k),this._outlinepoints.add(k),"undefined"===typeof this.bjsEarcut&&V.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(Z){this._points.add(Z);const c=new E;return c.add(Z),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(Z),this}build(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const k=new R.c(this._name,this._scene),N=this.buildVertexData(c,L);return k.QZ(p.g.PositionKind,N.BZ,Z),k.QZ(p.g.NormalKind,N.DZ,Z),k.QZ(p.g.UVKind,N.HZ,Z),k.setIndices(N.indices),k}buildVertexData(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const L=new G.e,k=[],N=[],R=[],V=this._points.computeBounds();for(const G of this._points.elements)k.push(0,1,0),N.push(G.x,0,G.y),R.push((G.x-V.min.x)/V.width,(G.y-V.min.y)/V.height);const p=[],J=this.bjsEarcut(this._epoints,this._eholes,2);for(let G=0;G<J.length;G++)p.push(J[G]);if(Z>0){const L=N.length/3;for(const c of this._points.elements)k.push(0,-1,0),N.push(c.x,-Z,c.y),R.push(1-(c.x-V.min.x)/V.width,1-(c.y-V.min.y)/V.height);const G=p.length;for(let Z=0;Z<G;Z+=3){const c=p[Z+0],k=p[Z+1],N=p[Z+2];p.push(N+L),p.push(k+L),p.push(c+L)}this._addSide(N,k,R,p,V,this._outlinepoints,Z,!1,c);for(const J of this._holes)this._addSide(N,k,R,p,V,J,Z,!0,c)}return L.indices=p,L.BZ=N,L.DZ=k,L.HZ=R,L}_addSide(Z,c,L,N,R,G,V,p,J){let i=Z.length/3,t=0;for(let E=0;E<G.elements.length;E++){const x=G.elements[E],q=G.elements[(E+1)%G.elements.length];Z.push(x.x,0,x.y),Z.push(x.x,-V,x.y),Z.push(q.x,0,q.y),Z.push(q.x,-V,q.y);const O=G.elements[(E+G.elements.length-1)%G.elements.length],w=G.elements[(E+2)%G.elements.length];let M=new k.h(-(q.y-x.y),0,q.x-x.x),P=new k.h(-(x.y-O.y),0,x.x-O.x),j=new k.h(-(w.y-q.y),0,w.x-q.x);p||(M=M.scale(-1),P=P.scale(-1),j=j.scale(-1));const o=M.normalizeToNew();let u=P.normalizeToNew(),X=j.normalizeToNew();const h=k.h.Dot(u,o);u=h>J?h<z.e-1?new k.h(x.x,0,x.y).yL(new k.h(q.x,0,q.y)).normalize():P.add(M).normalize():o;const B=k.h.Dot(j,M);X=B>J?B<z.e-1?new k.h(q.x,0,q.y).yL(new k.h(x.x,0,x.y)).normalize():j.add(M).normalize():o,L.push(t/R.width,0),L.push(t/R.width,1),t+=M.length(),L.push(t/R.width,0),L.push(t/R.width,1),c.push(u.x,u.y,u.z),c.push(u.x,u.y,u.z),c.push(X.x,X.y,X.z),c.push(X.x,X.y,X.z),p?(N.push(i),N.push(i+2),N.push(i+1),N.push(i+1),N.push(i+2),N.push(i+3)):(N.push(i),N.push(i+1),N.push(i+2),N.push(i+1),N.push(i+3),N.push(i+2)),i+=4}}}var q=L(11371);function O(Z,c,L,R,V,J,z){const i=L||new Array(3),t=R,E=[],x=z||!1;for(let G=0;G<3;G++)void 0===i[G]&&(i[G]=new k.j(0,0,1,1)),t&&void 0===t[G]&&(t[G]=new N.h(1,1,1,1));const O=Z.getVerticesData(p.g.PositionKind),w=Z.getVerticesData(p.g.NormalKind),M=Z.getVerticesData(p.g.UVKind),P=Z.tc(),j=O.length/9;let o=0,u=0,X=0,h=0,B=0;const D=[0];if(x)for(let k=j;k<O.length/3;k+=4)u=O[3*(k+2)]-O[3*k],X=O[3*(k+2)+2]-O[3*k+2],h=Math.sqrt(u*u+X*X),B+=h,D.push(B);let e=0,H=0;for(let k=0;k<w.length;k+=3)Math.abs(w[k+1])<.001&&(H=1),Math.abs(w[k+1]-1)<.001&&(H=0),Math.abs(w[k+1]+1)<.001&&(H=2),e=k/3,1===H?(o=e-j,M[2*e]=o%4<1.5?x?i[H].x+(i[H].z-i[H].x)*D[Math.floor(o/4)]/B:i[H].x:x?i[H].x+(i[H].z-i[H].x)*D[Math.floor(o/4)+1]/B:i[H].z,M[2*e+1]=o%2===0?q.b?1-i[H].w:i[H].w:q.b?1-i[H].y:i[H].y):(M[2*e]=(1-M[2*e])*i[H].x+M[2*e]*i[H].z,M[2*e+1]=(1-M[2*e+1])*i[H].y+M[2*e+1]*i[H].w,q.b&&(M[2*e+1]=1-M[2*e+1])),t&&E.push(t[H].r,t[H].g,t[H].b,t[H].a);G.e._ComputeSides(c,O,P,w,M,V,J);const l=new G.e;if(l.indices=P,l.BZ=O,l.DZ=w,l.HZ=M,t){const Z=c===G.e.DOUBLESIDE?E.concat(E):E;l.eZ=Z}return l}function w(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;c.sideOrientation=R.c._GetDefaultSideOrientation(c.sideOrientation);const G=c.shape,V=c.holes||[],p=c.depth||0,J=c.smoothingThreshold||2,z=[];let t=[];for(let R=0;R<G.length;R++)z[R]=new k.f(G[R].x,G[R].z);z[0].equalsWithEpsilon(z[z.length-1],1e-8)&&z.pop();const E=new x(Z,z,L||i.d.LastCreatedScene,N);for(let R=0;R<V.length;R++){t=[];for(let Z=0;Z<V[R].length;Z++)t.push(new k.f(V[R][Z].x,V[R][Z].z));E.addHole(t)}const q=E.build(!1,p,J);q._originalBuilderSideOrientation=c.sideOrientation;return O(q,c.sideOrientation,c.faceUV,c.faceColors,c.frontUVs,c.backUVs,c.wrap).WZ(q,c.updatable),q}function M(Z,c){return w(Z,c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}G.e.CreatePolygon=O,R.c.CreatePolygon=function(Z,c,L,k,N,R){return w(Z,{shape:c,holes:k,updatable:N,sideOrientation:R},L,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},R.c.ExtrudePolygon=function(Z,c,L,k,N,R,G){return M(Z,{shape:c,holes:N,depth:L,updatable:R,sideOrientation:G},k,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11748:(Z,c,L)=>{L.d(c,{d:()=>z,f:()=>i});var k=L(11471),N=L(10993),R=L(11325),G=L(11274),V=L(11754);class p{constructor(Z){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=Z}moveTo(Z,c){this._currentPath=new k.j(Z,c),this._tempPaths.push(this._currentPath)}lineTo(Z,c){this._currentPath.addLineTo(Z,c)}quadraticCurveTo(Z,c,L,k){this._currentPath.addQuadraticCurveTo(Z,c,L,k,this._resolution)}bezierCurveTo(Z,c,L,k,N,R){this._currentPath.addBezierCurveTo(Z,c,L,k,N,R,this._resolution)}extractHoles(){for(const Z of this._tempPaths)Z.area()>0?this._holes.push(Z):this._paths.push(Z);if(!this._paths.length&&this._holes.length){const Z=this._holes;this._holes=this._paths,this._paths=Z}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function J(Z,c,L,k,N,R){const G=R.glyphs[Z]||R.glyphs["?"];if(!G)return null;const V=new p(N);if(G.o){const Z=G.o.split(" ");for(let N=0,R=Z.length;N<R;){switch(Z[N++]){case"m":{const R=parseInt(Z[N++])*c+L,G=parseInt(Z[N++])*c+k;V.moveTo(R,G);break}case"l":{const R=parseInt(Z[N++])*c+L,G=parseInt(Z[N++])*c+k;V.lineTo(R,G);break}case"q":{const R=parseInt(Z[N++])*c+L,G=parseInt(Z[N++])*c+k,p=parseInt(Z[N++])*c+L,J=parseInt(Z[N++])*c+k;V.quadraticCurveTo(p,J,R,G);break}case"b":{const R=parseInt(Z[N++])*c+L,G=parseInt(Z[N++])*c+k,p=parseInt(Z[N++])*c+L,J=parseInt(Z[N++])*c+k,z=parseInt(Z[N++])*c+L,i=parseInt(Z[N++])*c+k;V.bezierCurveTo(p,J,z,i,R,G);break}}}}return V.extractHoles(),{offsetX:G.ha*c,shapePath:V}}function z(Z,c,L,k){const N=Array.from(Z),R=c/k.resolution,G=(k.boundingBox.yMax-k.boundingBox.yMin+k.underlineThickness)*R,V=[];let p=0,z=0;for(let i=0;i<N.length;i++){const Z=N[i];if("\n"===Z)p=0,z-=G;else{const c=J(Z,R,p,z,L,k);c&&(p+=c.offsetX,V.push(c.shapePath))}}return V}function i(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const i=z(c,k.size||50,k.resolution||8,L),t=[];let E=0;for(const G of i){if(!G.paths.length)continue;const c=G.holes.slice();for(const L of G.paths){var x,q;const G=[],z=[],i=L.getPoints();for(const Z of i)z.push(new N.h(Z.x,0,Z.y));const O=c.slice();for(const Z of O){const k=Z.getPoints();let R=!1;for(const Z of k)if(L.isPointInside(Z)){R=!0;break}if(!R)continue;const V=[];for(const Z of k)V.push(new N.h(Z.x,0,Z.y));G.push(V),c.splice(c.indexOf(Z),1)}if(!G.length&&c.length)for(const Z of c){const c=Z.getPoints(),L=[];for(const Z of c)L.push(new N.h(Z.x,0,Z.y));G.push(L)}const w=(0,V.g)(Z,{shape:z,holes:G.length?G:void 0,depth:k.depth||1,faceUV:k.faceUV||(null===(x=k.perLetterFaceUV)||void 0===x?void 0:x.call(k,E)),faceColors:k.faceColors||(null===(q=k.perLetterFaceColors)||void 0===q?void 0:q.call(k,E)),sideOrientation:R.c._GetDefaultSideOrientation(k.sideOrientation||R.c.DOUBLESIDE)},p,J);t.push(w),E++}}const O=R.c.MergeMeshes(t,!0,!0);if(O){const c=O.getBoundingInfo().boundingBox;O.position.x+=-(c.minimumWorld.x+c.maximumWorld.x)/2,O.position.y+=-(c.minimumWorld.y+c.maximumWorld.y)/2,O.position.z+=-(c.minimumWorld.z+c.maximumWorld.z)/2+c.extendSize.z,O.name=Z;const L=new G.e("pivot",p);L.rotation.x=-Math.PI/2,O.parent=L,O.bakeCurrentTransformIntoVertices(),O.parent=null,L.dispose()}return O}},11765:(Z,c,L)=>{L.d(c,{c:()=>p,e:()=>G,h:()=>V});var k=L(11038),N=L(11770),R=L(11777);function G(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function V(Z){return!!(Z.wasmUrl&&(Z.wasmBinary||Z.wasmBinaryUrl)&&"object"===typeof WebAssembly||Z.fallbackUrl)}class p{constructor(Z){if(Z.workerPool)return void(this._workerPoolPromise=Promise.resolve(Z.workerPool));const c=Z.wasmBinary,L=Z.numWorkers??G(),V=L&&"function"===typeof Worker&&"function"===typeof URL,p=V||!Z.jsModule,J=Z.wasmUrl&&Z.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:p?k.c.GetBabylonScriptURL(Z.wasmUrl,!0):"",wasmBinaryPromise:c?Promise.resolve(c):k.c.LoadFileAsync(k.c.GetBabylonScriptURL(Z.wasmBinaryUrl,!0))}:{url:p?k.c.GetBabylonScriptURL(Z.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};V?this._workerPoolPromise=J.wasmBinaryPromise.then((Z=>{const c=this._getWorkerContent(),k=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));return new N.d(L,(()=>{const c=new Worker(k);return(0,R.k)(c,Z,J.url)}))})):this._modulePromise=J.wasmBinaryPromise.then((async c=>{if(!this._isModuleAvailable()&&!Z.jsModule){if(!J.url)throw new Error("Draco codec module is not available");await k.c.LoadBabylonScriptAsync(J.url)}return await this._createModuleAsync(c,Z.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((Z=>{Z.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11777:(Z,c,L)=>{function k(Z,c,L,k){const N=Z;let R=null,G=null,V=null,p=null;const J={},z=c.find((Z=>"POSITION"===Z.dracoName));if(!z)throw new Error("Position attribute is required for Draco encoding");if(!L){const Z=z.data.length/z.size;L=new(Z>65535?Uint32Array:Uint16Array)(Z);for(let c=0;c<Z;c++)L[c]=c}try{R=new N.Encoder,G=new N.MeshBuilder,V=new N.Mesh,G.AddFacesToMesh(V,L.length/3,L);const Z=new Map([[Float32Array,(Z,c,L,k,N,R)=>Z.AddFloatAttribute(c,L,k,N,R)],[Uint32Array,(Z,c,L,k,N,R)=>Z.AddUInt32Attribute(c,L,k,N,R)],[Uint16Array,(Z,c,L,k,N,R)=>Z.AddUInt16Attribute(c,L,k,N,R)],[Uint8Array,(Z,c,L,k,N,R)=>Z.AddUInt8Attribute(c,L,k,N,R)],[Int32Array,(Z,c,L,k,N,R)=>Z.AddInt32Attribute(c,L,k,N,R)],[Int16Array,(Z,c,L,k,N,R)=>Z.AddInt16Attribute(c,L,k,N,R)],[Int8Array,(Z,c,L,k,N,R)=>Z.AddInt8Attribute(c,L,k,N,R)]]);for(const L of c){L.data instanceof Uint8ClampedArray&&(L.data=new Uint8Array(L.data));const c=Z.get(L.data.constructor),p=L.data.length/L.size;J[L.kind]=c(G,V,N[L.dracoName],p,L.size,L.data),k.quantizationBits&&k.quantizationBits[L.dracoName]&&R.SetAttributeQuantization(N[L.dracoName],k.quantizationBits[L.dracoName])}k.method&&R.SetEncodingMethod(N[k.method]),void 0!==k.encodeSpeed&&void 0!==k.decodeSpeed&&R.SetSpeedOptions(k.encodeSpeed,k.decodeSpeed),p=new N.DracoInt8Array;const z=R.EncodeMeshToDracoBuffer(V,p);if(z<=0)throw new Error("Draco encoding failed.");const i=new Int8Array(z);for(let c=0;c<z;c++)i[c]=p.GetValue(c);return{data:i,attributeIds:J}}finally{V&&N.destroy(V),G&&N.destroy(G),R&&N.destroy(R),p&&N.destroy(p)}}function N(){let Z;onmessage=c=>{const L=c.data;switch(L.id){case"init":{L.url&&importScripts(L.url);const c=L.wasmBinary?{wasmBinary:L.wasmBinary}:{};Z=DracoEncoderModule(c),postMessage({id:"initDone"});break}case"encodeMesh":if(!Z)throw new Error("Draco encoder module is not available");Z.then((Z=>{const c=k(Z,L.attributes,L.indices,L.options);postMessage({id:"encodeMeshDone",encodedMeshData:c},c?[c.data.buffer]:void 0)}))}}}function R(Z,c,L,k,N){const R=Z;let G=null,V=null,p=null;try{let Z;G=new R.Decoder,V=new R.DecoderBuffer,V.Init(c,c.byteLength);const J=G.GetEncodedGeometryType(V);switch(J){case R.TRIANGULAR_MESH:{const c=new R.Mesh;if(Z=G.DecodeBufferToMesh(V,c),!Z.ok()||0===c.ptr)throw new Error(Z.error_msg());const L=3*c.num_faces(),N=4*L,J=R._malloc(N);try{G.GetTrianglesUInt32Array(c,N,J);const Z=new Uint32Array(L);Z.set(new Uint32Array(R.HEAPF32.buffer,J,L)),k(Z)}finally{R._free(J)}p=c;break}case R.POINT_CLOUD:{const c=new R.PointCloud;if(Z=G.DecodeBufferToPointCloud(V,c),!Z.ok()||!c.ptr)throw new Error(Z.error_msg());p=c;break}default:throw new Error(`Invalid geometry type ${J}`)}const z=p.num_points(),i=(Z,c,L,k)=>{const G=k.data_type(),V=k.num_components(),p=k.normalized(),J=k.byte_stride(),i=k.byte_offset(),t={[R.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:R.HEAPF32},[R.DT_INT8]:{typedArrayConstructor:Int8Array,heap:R.HEAP8},[R.DT_INT16]:{typedArrayConstructor:Int16Array,heap:R.HEAP16},[R.DT_INT32]:{typedArrayConstructor:Int32Array,heap:R.HEAP32},[R.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:R.HEAPU8},[R.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:R.HEAPU16},[R.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:R.HEAPU32}}[G];if(!t)throw new Error(`Invalid data type ${G}`);const E=z*V,x=E*t.typedArrayConstructor.BYTES_PER_ELEMENT,q=R._malloc(x);try{Z.GetAttributeDataArrayForAllPoints(c,k,G,x,q);const R=new t.typedArrayConstructor(t.heap.buffer,q,E);N(L,R.slice(),V,i,J,p)}finally{R._free(q)}};if(L)for(const c in L){const Z=L[c],k=G.GetAttributeByUniqueId(p,Z);i(G,p,c,k)}else{const Z={position:R.POSITION,kc:R.NORMAL,color:R.COLOR,uv:R.TEX_COORD};for(const c in Z){const L=G.GetAttributeId(p,Z[c]);if(-1!==L){const Z=G.GetAttribute(p,L);i(G,p,c,Z)}}}return z}finally{p&&R.destroy(p),V&&R.destroy(V),G&&R.destroy(G)}}function G(){let Z;onmessage=c=>{const L=c.data;switch(L.id){case"init":{L.url&&importScripts(L.url);const c=L.wasmBinary?{wasmBinary:L.wasmBinary}:{};Z=DracoDecoderModule(c),postMessage({id:"initDone"});break}case"decodeMesh":if(!Z)throw new Error("Draco decoder module is not available");Z.then((Z=>{const c=R(Z,L.dataView,L.attributes,(Z=>{postMessage({id:"indices",data:Z},[Z.buffer])}),((Z,c,L,k,N,R)=>{postMessage({id:"attribute",kind:Z,data:c,size:L,byteOffset:k,byteStride:N,normalized:R},[c.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:c})}))}}}async function V(Z,c,L){return await new Promise(((k,N)=>{const R=c=>{Z.removeEventListener("error",R),Z.removeEventListener("message",G),N(c)},G=c=>{"initDone"===c.data.id&&(Z.removeEventListener("error",R),Z.removeEventListener("message",G),k(Z))};if(Z.addEventListener("error",R),Z.addEventListener("message",G),c){const k=c.slice(0);Z.postMessage({id:"init",url:L,wasmBinary:k},[k])}else Z.postMessage({id:"init",url:L})}))}L.d(c,{c:()=>R,d:()=>G,g:()=>k,j:()=>N,k:()=>V})},11408:(Z,c,L)=>{L.d(c,{d:()=>N});var k=L(11194);class N extends k.e{constructor(Z){super(),this._buffer=Z}get underlyingResource(){return this._buffer}}},11282:(Z,c,L)=>{L.d(c,{d:()=>X});var k=L(11170),N=L(11027),R=L(10993),G=L(11190),V=L(11289),p=L(11274),J=L(11304),z=L(11205),i=L(11236);class t{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new R.h(0,0,0),this._diffPositionForCollisions=new R.h(0,0,0),this._collisionResponse=!0}}var E=L(11070),x=L(11221),q=L(11255),O=L(10999),w=L(11312),M=L(11012),P=L(11173),j=L(11110);class o{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=R.h.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class u{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new o,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new t,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class X extends p.e{static get BILLBOARDMODE_NONE(){return p.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return p.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return p.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return p.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return p.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return p.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(Z){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=Z}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(Z){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=Z}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(Z){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=Z}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(Z){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=Z}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(Z){this._internalAbstractMeshDataInfo._collisionRetryCount=Z}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(Z){this._internalAbstractMeshDataInfo._morphTargetManager!==Z&&(this._internalAbstractMeshDataInfo._morphTargetManager=Z,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(Z){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==Z&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=Z,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(Z){return!!super._updateNonUniformScalingState(Z)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(Z){this._internalAbstractMeshDataInfo._rawBoundingInfo=Z}set VE(Z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(Z)}set onCollisionPositionChange(Z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(Z)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(Z){if(this._internalAbstractMeshDataInfo._visibility===Z)return;const c=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=Z,(1===c&&1!==Z||1!==c&&1===Z)&&this._markSubMeshesAsDirty((Z=>{Z.markAsMiscDirty(),Z.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(Z){this._internalAbstractMeshDataInfo._inheritVisibility=Z}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let Z=this._parentNode;for(;Z;){const c=Z.isVisible;if("undefined"!==typeof c)return c;Z=Z.parent}}return this._isVisible}set isVisible(Z){this._isVisible=Z}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(Z){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=Z}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(Z){this._internalAbstractMeshDataInfo._renderingGroupId=Z}get material(){return this._internalAbstractMeshDataInfo._material}set material(Z){this._setMaterial(Z)}_setMaterial(Z){this._internalAbstractMeshDataInfo._material!==Z&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=Z,Z&&Z.meshMap&&(Z.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.ec&&(this.resetDrawCache(void 0,null==Z),this._unBindEffect()))}getMaterialForRenderPass(Z){var c;return null===(c=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===c?void 0:c[Z]}setMaterialForRenderPass(Z,c){var L;this.resetDrawCache(Z),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const k=this._internalAbstractMeshDataInfo._materialForRenderPass[Z];null!==k&&void 0!==k&&null!==(L=k.meshMap)&&void 0!==L&&L[this.uniqueId]&&(k.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[Z]=c,c&&c.meshMap&&(c.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(Z){this._internalAbstractMeshDataInfo._receiveShadows!==Z&&(this._internalAbstractMeshDataInfo._receiveShadows=Z,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(Z){this._internalAbstractMeshDataInfo._hasVertexAlpha!==Z&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=Z,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(Z){this._internalAbstractMeshDataInfo._useVertexColors!==Z&&(this._internalAbstractMeshDataInfo._useVertexColors=Z,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(Z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==Z&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=Z,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(Z){this._internalAbstractMeshDataInfo._numBoneInfluencers!==Z&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=Z,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(Z){this._internalAbstractMeshDataInfo._applyFog!==Z&&(this._internalAbstractMeshDataInfo._applyFog=Z,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(Z){this._internalAbstractMeshDataInfo._enableDistantPicking=Z}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(Z){Z!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=Z,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(Z)?-1:Z}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=Z}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(Z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(Z)?-1:Z}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(Z){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=Z}get lightSources(){return this._lightSources}set skeleton(Z){const c=this._internalAbstractMeshDataInfo._skeleton;c&&c.needInitialSkinMatrix&&c._unregisterMeshWithPoseMatrix(this),Z&&Z.needInitialSkinMatrix&&Z._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=Z,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(Z){var c;let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(Z,L,!1),c=this,this._internalAbstractMeshDataInfo=new u,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Zi=X.ci,this.onCollideObservable=new N.b,this.onCollisionPositionChangeObservable=new N.b,this.onMaterialChangedObservable=new N.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.ep=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=q.d.Red(),this.outlineWidth=.02,this.overlayColor=q.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.BV=!1,this.TZ=!1,this.actionManager=null,this.ellipsoid=new R.h(.5,1,.5),this.ellipsoidOffset=new R.h(0,0,0),this.edgesWidth=1,this.edgesColor=new q.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,hV:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new N.b,this._onCollisionPositionChange=function(Z,L){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;L.subtractToRef(c._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>j.c.CollisionsEpsilon&&c.position.addInPlace(c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),k&&c.onCollideObservable.notifyObservers(k),c.onCollisionPositionChangeObservable.notifyObservers(c.position)},L=this.XZ(),L.mJ(this),this._resyncLightSources(),this._uniformBuffer=new i.c(this.XZ().getEngine(),void 0,void 0,Z,!this.XZ().getEngine().isWebGPU),this._buildUniformLayout(),L.performancePriority){case 2:this.TZ=!0;case 1:this.BV=!0,this.ep=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(Z){const c=this._uniformBuffer;c.hc("world",Z),c.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),c.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(Z){let c="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");c+=", # of submeshes: "+(this.ec?this.ec.length:0);const L=this._internalAbstractMeshDataInfo._skeleton;return L&&(c+=", skeleton: "+L.name),Z&&(c+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],c+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.hV?"YES":"NO")),c}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==p.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(c||this.actionManager.isRecursive)){if(!Z)return this.actionManager;if(this.actionManager.hasSpecificTrigger(Z))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(Z,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.ec){for(const Z of this.ec)Z._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const Z of this.XZ().lights)Z.isEnabled()&&Z.canAffectMesh(this)&&this._lightSources.push(Z);this._markSubMeshesAsLightDirty()}_resyncLightSource(Z){const c=Z.isEnabled()&&Z.canAffectMesh(this),L=this._lightSources.indexOf(Z);let k=!1;if(-1===L){if(!c)return;this._lightSources.push(Z)}else{if(c)return;k=!0,this._lightSources.splice(L,1)}this._markSubMeshesAsLightDirty(k)}_unBindEffect(){for(const Z of this.ec)Z.setEffect(null)}_removeLightSource(Z,c){const L=this._lightSources.indexOf(Z);-1!==L&&(this._lightSources.splice(L,1),this._markSubMeshesAsLightDirty(c))}_markSubMeshesAsDirty(Z){if(this.ec)for(const c of this.ec)for(let L=0;L<c._drawWrappers.length;++L){const k=c._drawWrappers[L];k&&k.defines&&k.defines.markAllAsDirty&&Z(k.defines)}}_markSubMeshesAsLightDirty(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((c=>c.markAsLightDirty(Z)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((Z=>Z.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((Z=>Z.markAsMiscDirty()))}DJ(Z){return this._currentRenderId=Number.MAX_VALUE,super.DJ(Z),this._isDirty=!0,this}resetDrawCache(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ec)for(const L of this.ec)L.resetDrawCache(Z,c)}get isBlocked(){return!1}getLOD(Z){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}tc(){return null}getVerticesData(Z){return null}QZ(Z,c,L,k){return this}updateVerticesData(Z,c,L,k){return this}setIndices(Z,c){return this}isVerticesDataPresent(Z){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.IZ()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(Z){return this._boundingInfo=Z,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(Z,c,L){return this._boundingInfo=new z.e(Z,c,L),this._boundingInfo}normalizeToUnitCube(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(Z,c,L)}get useBones(){return this.skeleton&&this.XZ().skeletonsEnabled&&this.isVerticesDataPresent(G.g.MatricesIndicesKind)&&this.isVerticesDataPresent(G.g.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(Z){}_activate(Z,c){return this._renderId=Z,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===p.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(Z,c,L){return this.position.addInPlace(this.calcMovePOV(Z,c,L)),this}calcMovePOV(Z,c,L){const k=new R.b;(this.rotationQuaternion?this.rotationQuaternion:R.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(k);const N=R.h.Zero(),G=this.definedFacingForward?-1:1;return R.h.TransformCoordinatesFromFloatsToRef(Z*G,c,L*G,k,N),N}rotatePOV(Z,c,L){return this.rotation.addInPlace(this.calcRotatePOV(Z,c,L)),this}calcRotatePOV(Z,c,L){const k=this.definedFacingForward?1:-1;return new R.h(Z*k,c,L*k)}dZ(Z,c){if(Z){const L=(0,x.d)(Z,0,this.getTotalVertices(),c);this._boundingInfo?this._boundingInfo.reConstruct(L.minimum,L.maximum):this._boundingInfo=new z.e(L.minimum,L.maximum)}if(this.ec)for(let L=0;L<this.ec.length;L++)this.ec[L].refreshBoundingInfo(Z);this.IZ()}_refreshBoundingInfoDirect(Z){if(this._boundingInfo?this._boundingInfo.reConstruct(Z.minimum,Z.maximum):this._boundingInfo=new z.e(Z.minimum,Z.maximum),this.ec)for(let c=0;c<this.ec.length;c++)this.ec[c].refreshBoundingInfo(null);this.IZ()}static _ApplySkeleton(Z,c,L,k,N,V,p){!function(Z,c,L,k,N,V,p){const J=R.d.Mc[0],z=R.d.Matrix[0],i=R.d.Matrix[1],t=c===G.g.NormalKind?R.h.TransformNormalFromFloatsToRef:R.h.TransformCoordinatesFromFloatsToRef;for(let G=0,E=0;G<Z.length;G+=3,E+=4){let c,x;for(z.reset(),c=0;c<4;c++)x=N[E+c],x>0&&(R.b.FromFloat32ArrayToRefScaled(L,Math.floor(16*k[E+c]),x,i),z.addToSelf(i));if(V&&p)for(c=0;c<4;c++)x=p[E+c],x>0&&(R.b.FromFloat32ArrayToRefScaled(L,Math.floor(16*V[E+c]),x,i),z.addToSelf(i));t(Z[G],Z[G+1],Z[G+2],z,J),J.toArray(Z,G)}}(Z,c,L,k,N,V,p)}_getData(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.g.PositionKind;const k=Z.cache,N=Z=>{if(k){const c=k._vertexData||(k._vertexData={});return c[Z]||this.copyVerticesData(Z,c),c[Z]}return this.getVerticesData(Z)};if(c||(c=N(L)),!c)return null;if(k?(k._outputData?k._outputData.set(c):k._outputData=new Float32Array(c),c=k._outputData):(Z.applyMorph&&this.morphTargetManager||Z.applySkeleton&&this.skeleton)&&(c=c.slice()),Z.applyMorph&&this.morphTargetManager&&function(Z,c,L){let k=null;switch(c){case G.g.PositionKind:k=Z=>Z.getPositions();break;case G.g.NormalKind:k=Z=>Z.getNormals();break;case G.g.TangentKind:k=Z=>Z.getTangents();break;case G.g.UVKind:k=Z=>Z.getUVs();break;case G.g.UV2Kind:k=Z=>Z.getUV2s();break;case G.g.ColorKind:k=Z=>Z.getColors();break;default:return}for(let N=0;N<Z.length;N++){let c=Z[N];for(let R=0;R<L.numTargets;R++){const G=L.getTarget(R),V=G.influence;if(0!==V){const L=k(G);L&&(c+=(L[N]-Z[N])*V)}}Z[N]=c}}(c,L,this.morphTargetManager),Z.applySkeleton&&this.skeleton){const Z=N(G.g.MatricesIndicesKind),k=N(G.g.MatricesWeightsKind);if(k&&Z){const R=this.numBoneInfluencers>4,V=R?N(G.g.MatricesIndicesExtraKind):null,p=R?N(G.g.MatricesWeightsExtraKind):null,J=this.skeleton.getTransformMatrices(this);X._ApplySkeleton(c,L,J,Z,k,V,p)}}if(!1!==Z.updatePositionsArray&&L===G.g.PositionKind){const Z=this._internalAbstractMeshDataInfo._positions||[],L=Z.length;if(Z.length=c.length/3,L<Z.length)for(let c=L;c<Z.length;c++)Z[c]=new R.h;for(let k=0,N=0;k<Z.length;k++,N+=3)Z[k].wc(c[N],c[N+1],c[N+2]);this._internalAbstractMeshDataInfo._positions=Z}return c}getNormalsData(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:Z,applyMorph:c,updatePositionsArray:!1},null,G.g.NormalKind)}TV(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:Z,applyMorph:c,updatePositionsArray:!1},L,G.g.PositionKind)}IZ(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new z.e(R.h.Zero(),R.h.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(Z){if(!this.ec)return this;const c=this.ec.length;for(let L=0;L<c;L++){const k=this.ec[L];(c>1||!k.IsGlobal)&&k.updateBoundingInfo(Z)}return this}_afterComputeWorldMatrix(){this.TZ||(this._boundingInfoIsDirty=!0)}isInFrustum(Z){return this.getBoundingInfo().isInFrustum(Z,this.Zi)}isCompletelyInFrustum(Z){return this.getBoundingInfo().isCompletelyInFrustum(Z)}intersectsMesh(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;const k=this.getBoundingInfo(),N=Z.getBoundingInfo();if(k.intersects(N,c))return!0;if(L)for(const R of this.getChildMeshes())if(R.intersectsMesh(Z,c,!0))return!0;return!1}intersectsPoint(Z){return this.getBoundingInfo().intersectsPoint(Z)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(Z){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=Z}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const L=this.XZ().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=L.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,L.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Z,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,c),this}_collideForSubMesh(Z,c,L){var k;if(this._generatePointsArray(),!this._positions)return this;if(!Z._lastColliderWorldVertices||!Z._lastColliderTransformMatrix.equals(c)){Z._lastColliderTransformMatrix=c.clone(),Z._lastColliderWorldVertices=[],Z._trianglePlanes=[];const L=Z.verticesStart,k=Z.verticesStart+Z.verticesCount;for(let N=L;N<k;N++)Z._lastColliderWorldVertices.push(R.h.TransformCoordinates(this._positions[N],c))}return L._collide(Z._trianglePlanes,Z._lastColliderWorldVertices,this.tc(),Z.indexStart,Z.indexStart+Z.indexCount,Z.verticesStart,!!Z.rZ(),this,this._shouldConvertRHS(),7===(null===(k=Z.rZ())||void 0===k?void 0:k.fillMode)),this}_processCollisionsForSubMeshes(Z,c){const L=this._scene.getCollidingSubMeshCandidates(this,Z),k=L.length;for(let N=0;N<k;N++){const R=L.data[N];k>1&&!R._checkCollision(Z)||this._collideForSubMesh(R,c,Z)}return this}_shouldConvertRHS(){return!1}_checkCollision(Z){if(!this.getBoundingInfo()._checkCollision(Z))return this;const c=R.d.Matrix[0],L=R.d.Matrix[1];return R.b.ScalingToRef(1/Z._radius.x,1/Z._radius.y,1/Z._radius.z,c),this.worldMatrixFromCache.multiplyToRef(c,L),this._processCollisionsForSubMeshes(Z,L),this}_generatePointsArray(){return!1}intersects(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const V=new J.e,p=this.getClassName(),z="InstancedLinesMesh"===p||"LinesMesh"===p||"GreasedLineMesh"===p?this.intersectionThreshold:0,i=this.getBoundingInfo();if(!this.ec)return V;if(!G&&(!Z.intersectsSphere(i.boundingSphere,z)||!Z.intersectsBox(i.boundingBox,z)))return V;if(k)return V.hit=!G,V.pickedMesh=G?null:this,V.distance=G?0:R.h.Distance(Z.origin,i.boundingSphere.center),V.subMeshId=0,V;if(!this._generatePointsArray())return V;let t=null;const E=this._scene.getIntersectingSubMeshCandidates(this,Z),x=E.length;let q=!1;for(let R=0;R<x;R++){const Z=E.data[R].rZ();if(Z&&(7==Z.fillMode||0==Z.fillMode||1==Z.fillMode||2==Z.fillMode||4==Z.fillMode)){q=!0;break}}if(!q)return V.hit=!0,V.pickedMesh=this,V.distance=R.h.Distance(Z.origin,i.boundingSphere.center),V.subMeshId=-1,V;for(let R=0;R<x;R++){const k=E.data[R];if(x>1&&!G&&!k.canIntersects(Z))continue;const N=k.intersects(Z,this._positions,this.tc(),c,L);if(N&&(c||!t||N.distance<t.distance)&&(t=N,t.subMeshId=R,c))break}if(t){const c=N??this.getWorldMatrix(),L=R.d.Mc[0],k=R.d.Mc[1];R.h.TransformCoordinatesToRef(Z.origin,c,L),Z.direction.scaleToRef(t.distance,k);const G=R.h.TransformNormal(k,c).addInPlace(L);return V.hit=!0,V.distance=R.h.Distance(L,G),V.pickedPoint=G,V.pickedMesh=this,V.bu=t.bu||0,V.bv=t.bv||0,V.subMeshFaceId=t.faceId,V.faceId=t.faceId+E.data[t.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),V.subMeshId=t.subMeshId,V}return V}clone(Z,c,L){return null}releaseSubMeshes(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.ec)for(;this.ec.length;)this.ec[0].dispose(Z);else this.ec=[];return this}dispose(Z){let c,L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const k=this.XZ();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),k.freeActiveMeshes(),k.freeRenderingGroups(),k.renderingManager.maintainStateBetweenFrames&&k.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((Z=>Z!==this&&Z.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),c=0;c<this._intersectionsInProgress.length;c++){const Z=this._intersectionsInProgress[c],L=Z._intersectionsInProgress.indexOf(this);Z._intersectionsInProgress.splice(L,1)}this._intersectionsInProgress.length=0;const N=k.lights;for(const G of N){let Z=G.includedOnlyMeshes.indexOf(this);-1!==Z&&G.includedOnlyMeshes.splice(Z,1),Z=G.excludedMeshes.indexOf(this),-1!==Z&&G.excludedMeshes.splice(Z,1);const c=G.getShadowGenerators();if(c){const L=c.values();for(let c=L.next();!0!==c.done;c=L.next()){const L=c.value.getShadowMap();L&&L.renderList&&(Z=L.renderList.indexOf(this),-1!==Z&&L.renderList.splice(Z,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const R=k.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,R.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),R.wipeCaches(),k.sJ(this),this._parentContainer){const Z=this._parentContainer.meshes.indexOf(this);Z>-1&&this._parentContainer.meshes.splice(Z,1),this._parentContainer=null}if(L&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!Z)for(c=0;c<k.si.length;c++)k.si[c].j===this&&(k.si[c].dispose(),c--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(Z,L)}_initFacetData(){const Z=this._internalAbstractMeshDataInfo._facetData;Z.facetNormals||(Z.facetNormals=[]),Z.facetPositions||(Z.facetPositions=[]),Z.facetPartitioning||(Z.facetPartitioning=new Array),Z.facetNb=this.tc().length/3|0,Z.partitioningSubdivisions=Z.partitioningSubdivisions?Z.partitioningSubdivisions:10,Z.partitioningBBoxRatio=Z.partitioningBBoxRatio?Z.partitioningBBoxRatio:1.01;for(let c=0;c<Z.facetNb;c++)Z.facetNormals[c]=R.h.Zero(),Z.facetPositions[c]=R.h.Zero();return Z.facetDataEnabled=!0,this}updateFacetData(){const Z=this._internalAbstractMeshDataInfo._facetData;Z.facetDataEnabled||this._initFacetData();const c=this.getVerticesData(G.g.PositionKind),L=this.tc(),k=this.getVerticesData(G.g.NormalKind),N=this.getBoundingInfo();if(Z.facetDepthSort&&!Z.facetDepthSortEnabled){if(Z.facetDepthSortEnabled=!0,L instanceof Uint16Array)Z.depthSortedIndices=new Uint16Array(L);else if(L instanceof Uint32Array)Z.depthSortedIndices=new Uint32Array(L);else{let c=!1;for(let Z=0;Z<L.length;Z++)if(L[Z]>65535){c=!0;break}Z.depthSortedIndices=c?new Uint32Array(L):new Uint16Array(L)}if(Z.facetDepthSortFunction=function(Z,c){return c.sqDistance-Z.sqDistance},!Z.facetDepthSortFrom){const c=this.XZ().activeCamera;Z.facetDepthSortFrom=c?c.position:R.h.Zero()}Z.depthSortedFacets=[];for(let c=0;c<Z.facetNb;c++){const L={ind:3*c,sqDistance:0};Z.depthSortedFacets.push(L)}Z.invertedMatrix=R.b.Identity(),Z.facetDepthSortOrigin=R.h.Zero()}Z.bbSize.x=N.maximum.x-N.minimum.x>O.e?N.maximum.x-N.minimum.x:O.e,Z.bbSize.y=N.maximum.y-N.minimum.y>O.e?N.maximum.y-N.minimum.y:O.e,Z.bbSize.z=N.maximum.z-N.minimum.z>O.e?N.maximum.z-N.minimum.z:O.e;let p=Z.bbSize.x>Z.bbSize.y?Z.bbSize.x:Z.bbSize.y;if(p=p>Z.bbSize.z?p:Z.bbSize.z,Z.subDiv.max=Z.partitioningSubdivisions,Z.subDiv.X=Math.floor(Z.subDiv.max*Z.bbSize.x/p),Z.subDiv.Y=Math.floor(Z.subDiv.max*Z.bbSize.y/p),Z.subDiv.Z=Math.floor(Z.subDiv.max*Z.bbSize.z/p),Z.subDiv.X=Z.subDiv.X<1?1:Z.subDiv.X,Z.subDiv.Y=Z.subDiv.Y<1?1:Z.subDiv.Y,Z.subDiv.Z=Z.subDiv.Z<1?1:Z.subDiv.Z,Z.facetParameters.facetNormals=this.getFacetLocalNormals(),Z.facetParameters.facetPositions=this.getFacetLocalPositions(),Z.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),Z.facetParameters.bInfo=N,Z.facetParameters.bbSize=Z.bbSize,Z.facetParameters.subDiv=Z.subDiv,Z.facetParameters.ratio=this.partitioningBBoxRatio,Z.facetParameters.depthSort=Z.facetDepthSort,Z.facetDepthSort&&Z.facetDepthSortEnabled&&(this.Jc(!0),this._worldMatrix.invertToRef(Z.invertedMatrix),R.h.TransformCoordinatesToRef(Z.facetDepthSortFrom,Z.invertedMatrix,Z.facetDepthSortOrigin),Z.facetParameters.distanceTo=Z.facetDepthSortOrigin),Z.facetParameters.depthSortedFacets=Z.depthSortedFacets,k&&V.e.ComputeNormals(c,L,k,Z.facetParameters),Z.facetDepthSort&&Z.facetDepthSortEnabled){Z.depthSortedFacets.sort(Z.facetDepthSortFunction);const c=Z.depthSortedIndices.length/3|0;for(let k=0;k<c;k++){const c=Z.depthSortedFacets[k].ind;Z.depthSortedIndices[3*k]=L[c],Z.depthSortedIndices[3*k+1]=L[c+1],Z.depthSortedIndices[3*k+2]=L[c+2]}this.updateIndices(Z.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetNormals||this.updateFacetData(),Z.facetNormals}getFacetLocalPositions(){const Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetPositions||this.updateFacetData(),Z.facetPositions}getFacetLocalPartitioning(){const Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetPartitioning||this.updateFacetData(),Z.facetPartitioning}getFacetPosition(Z){const c=R.h.Zero();return this.getFacetPositionToRef(Z,c),c}getFacetPositionToRef(Z,c){const L=this.getFacetLocalPositions()[Z],k=this.getWorldMatrix();return R.h.TransformCoordinatesToRef(L,k,c),this}getFacetNormal(Z){const c=R.h.Zero();return this.getFacetNormalToRef(Z,c),c}getFacetNormalToRef(Z,c){const L=this.getFacetLocalNormals()[Z];return R.h.TransformNormalToRef(L,this.getWorldMatrix(),c),this}getFacetsAtLocalCoordinates(Z,c,L){const k=this.getBoundingInfo(),N=this._internalAbstractMeshDataInfo._facetData,R=Math.floor((Z-k.minimum.x*N.partitioningBBoxRatio)*N.subDiv.X*N.partitioningBBoxRatio/N.bbSize.x),G=Math.floor((c-k.minimum.y*N.partitioningBBoxRatio)*N.subDiv.Y*N.partitioningBBoxRatio/N.bbSize.y),V=Math.floor((L-k.minimum.z*N.partitioningBBoxRatio)*N.subDiv.Z*N.partitioningBBoxRatio/N.bbSize.z);return R<0||R>N.subDiv.max||G<0||G>N.subDiv.max||V<0||V>N.subDiv.max?null:N.facetPartitioning[R+N.subDiv.max*G+N.subDiv.max*N.subDiv.max*V]}getClosestFacetAtCoordinates(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const V=this.getWorldMatrix(),p=R.d.Matrix[5];V.invertToRef(p);const J=R.d.Mc[8];R.h.TransformCoordinatesFromFloatsToRef(Z,c,L,p,J);const z=this.getClosestFacetAtLocalCoordinates(J.x,J.y,J.z,k,N,G);return k&&R.h.TransformCoordinatesFromFloatsToRef(k.x,k.y,k.z,V,k),z}getClosestFacetAtLocalCoordinates(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=null,V=0,p=0,J=0,z=0,i=0,t=0,E=0,x=0;const q=this.getFacetLocalPositions(),O=this.getFacetLocalNormals(),w=this.getFacetsAtLocalCoordinates(Z,c,L);if(!w)return null;let M,P,j,o=Number.MAX_VALUE,u=o;for(let X=0;X<w.length;X++)M=w[X],P=O[M],j=q[M],z=(Z-j.x)*P.x+(c-j.y)*P.y+(L-j.z)*P.z,(!N||N&&R&&z>=0||N&&!R&&z<=0)&&(z=P.x*j.x+P.y*j.y+P.z*j.z,i=-(P.x*Z+P.y*c+P.z*L-z)/(P.x*P.x+P.y*P.y+P.z*P.z),t=Z+P.x*i,E=c+P.y*i,x=L+P.z*i,V=t-Z,p=E-c,J=x-L,u=V*V+p*p+J*J,u<o&&(o=u,G=M,k&&(k.x=t,k.y=E,k.z=x)));return G}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const Z=this._internalAbstractMeshDataInfo._facetData;return Z.facetDataEnabled&&(Z.facetDataEnabled=!1,Z.facetPositions=[],Z.facetNormals=[],Z.facetPartitioning=new Array,Z.facetParameters={},Z.depthSortedIndices=new Uint32Array(0)),this}updateIndices(Z,c){return this}createNormals(Z){const c=this.getVerticesData(G.g.PositionKind),L=this.tc();let k;return k=this.isVerticesDataPresent(G.g.NormalKind)?this.getVerticesData(G.g.NormalKind):[],V.e.ComputeNormals(c,L,k,{useRightHandedSystem:this.XZ().useRightHandedSystem}),this.QZ(G.g.NormalKind,k,Z),this}async optimizeIndicesAsync(){const Z=this.tc();if(!Z)return this;const{OptimizeIndices:c}=await L.e(35).then(L.bind(L,13616));return c(Z),this.setIndices(Z,this.getTotalVertices()),this}alignWithNormal(Z,c){c||(c=w.b.Y);const L=R.d.Mc[0],k=R.d.Mc[1];return R.h.CrossToRef(c,Z,k),R.h.CrossToRef(Z,k,L),this.rotationQuaternion?R.c.RotationQuaternionFromAxisToRef(L,Z,k,this.rotationQuaternion):R.h.RotationFromAxisToRef(L,Z,k,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,E.e)("EdgesRenderer")}enableEdgesRendering(Z,c,L){throw(0,E.e)("EdgesRenderer")}mi(){return this._scene.si.filter((Z=>Z.j===this))}}X.OCCLUSION_TYPE_NONE=0,X.OCCLUSION_TYPE_OPTIMISTIC=1,X.OCCLUSION_TYPE_STRICT=2,X.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,X.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,X.CULLINGSTRATEGY_STANDARD=0,X.ci=1,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,k.d)([P.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k,N,R,G,V]=c;return!Array.isArray(k)&&!Array.isArray(N)&&!Array.isArray(R)&&!Array.isArray(G)&&!Array.isArray(V)}))],X,"_ApplySkeleton",null),(0,M.g)("BABYLON.AbstractMesh",X)},11781:(Z,c,L)=>{L.d(c,{c:()=>k.g});var k=L(11190)},11358:(Z,c,L)=>{L.d(c,{e:()=>O});var k=L(10993),N=L(11255),R=L(11289),G=L(11190),V=L(11185),p=L(11362),J=L(11205),z=L(11038),i=L(11251),t=L(11221),E=L(11023),x=L(11371),q=L(11197);class O{get boundingBias(){return this._boundingBias}set boundingBias(Z){this._boundingBias?this._boundingBias.R(Z):this._boundingBias=Z.clone(),this.IZ(!0,null)}static CreateGeometryForMesh(Z){const c=new O(O.RandomId(),Z.XZ());return c.WZ(Z),c}get meshes(){return this._meshes}constructor(Z,c,L){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new k.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new k.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=c||E.d.LastCreatedScene,this._scene&&(this.id=Z,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=N,L?this.setAllVerticesData(L,N):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),R&&(this.WZ(R),R.Jc(!0)))}get extend(){return this._extend}XZ(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let Z=0;Z<this._meshes.length;Z++)if(!this._meshes[Z].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const Z=new Set;for(const c in this._vertexBuffers)Z.add(this._vertexBuffers[c].getWrapperBuffer());Z.forEach((Z=>{Z._rebuild()}))}setAllVerticesData(Z,c){Z.applyToGeometry(this,c),this._notifyUpdate()}QZ(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;L&&Array.isArray(c)&&(c=new Float32Array(c));const N=new G.g(this._engine,c,Z,{updatable:L,postponeInternalCreation:0===this._meshes.length,stride:k,label:"Geometry_"+this.id+"_"+Z});this.setVerticesBuffer(N)}removeVerticesData(Z){this._vertexBuffers[Z]&&(this._vertexBuffers[Z].dispose(),delete this._vertexBuffers[Z]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=Z.getKind();this._vertexBuffers[N]&&L&&this._vertexBuffers[N].dispose(),Z._buffer&&Z._buffer._increaseReferences(),this._vertexBuffers[N]=Z;const R=this._meshes,V=R.length;if(N===G.g.PositionKind){this._totalVertices=c??Z._maxVerticesCount,this._updateExtend(Z.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const L=this._extend&&this._extend.minimum||new k.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),N=this._extend&&this._extend.maximum||new k.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let Z=0;Z<V;Z++){const c=R[Z];c.buildBoundingInfo(L,N),c._createGlobalSubMesh(c.isUnIndexed),c.Jc(!0),c.synchronizeInstances()}}this._notifyUpdate(N)}updateVerticesDataDirectly(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getVertexBuffer(Z);N&&(N.updateDirectly(c,L,k),this._notifyUpdate(Z))}updateVerticesData(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=this.getVertexBuffer(Z);k&&(k.update(c),Z===G.g.PositionKind&&this.IZ(L,c),this._notifyUpdate(Z))}IZ(Z,c){if(Z&&this._updateExtend(c),this._resetPointsArrayCache(),Z){const Z=this._meshes;for(const c of Z){c.hasBoundingInfo?c.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):c.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const Z=c.ec;for(const c of Z)c.refreshBoundingInfo()}}}_bind(Z,c,L,k){if(!Z)return;void 0===c&&(c=this._indexBuffer);const N=this.getVertexBuffers();if(!N)return;if(c!=this._indexBuffer||!this._vertexArrayObjects&&!k)return void this._engine.bindBuffers(N,c,Z,L);const R=k||this._vertexArrayObjects,G=this._engine;R[Z.key]||(R[Z.key]=G.recordVertexArrayObject(N,c,Z,L)),G.bindVertexArrayObject(R[Z.key],c)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(Z,c,L){const k=this.getVertexBuffer(Z);return k?k.getFloatData(this._totalVertices,L||c&&1!==this._meshes.length):null}copyVerticesData(Z,c){const L=this.getVertexBuffer(Z);if(!L)return;c[Z]||(c[Z]=new Float32Array(this._totalVertices*L.getSize()));const k=L.getData();k&&(0,q.f)(k,L.getSize(),L.type,L.byteOffset,L.byteStride,L.normalized,this._totalVertices,c[Z])}isVertexBufferUpdatable(Z){const c=this._vertexBuffers[Z];return!!c&&c.isUpdatable()}getVertexBuffer(Z){return this.isReady()?this._vertexBuffers[Z]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(Z){return this._vertexBuffers?void 0!==this._vertexBuffers[Z]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z)}getVerticesDataKinds(){const Z=[];let c;if(!this._vertexBuffers&&this._delayInfo)for(c in this._delayInfo)Z.push(c);else for(c in this._vertexBuffers)Z.push(c);return Z}updateIndices(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const k=Z.length!==this._indices.length;if(L||(this._indices=Z.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,Z,c),k)for(const Z of this._meshes)Z._createGlobalSubMesh(!0)}else this.setIndices(Z,null,!0)}setIndexBuffer(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=Z,this._totalVertices=c,this._totalIndices=L,Z.is32Bits=null===k?c>65535:k;for(const N of this._meshes)N._createGlobalSubMesh(!0),N.synchronizeInstances();this._notifyUpdate()}setIndices(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=Z,this._indexBufferIsUpdatable=L,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,L,"Geometry_"+this.id+"_IndexBuffer")),void 0!=c&&(this._totalVertices=c);for(const N of this._meshes)N._createGlobalSubMesh(!k),N.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}tc(Z,c){if(!this.isReady())return null;const L=this._indices;return c||Z&&1!==this._meshes.length?L.slice():L}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Z&&this._vertexArrayObjects&&this._vertexArrayObjects[Z.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[Z.key]),delete this._vertexArrayObjects[Z.key])}releaseForMesh(Z,c){const L=this._meshes,k=L.indexOf(Z);-1!==k&&(L.splice(k,1),this._vertexArrayObjects&&Z._invalidateInstanceVertexArrayObject(),Z._geometry=null,0===L.length&&c&&this.dispose())}WZ(Z){if(Z._geometry===this)return;const c=Z._geometry;c&&c.releaseForMesh(Z),this._vertexArrayObjects&&Z._invalidateInstanceVertexArrayObject();const L=this._meshes;Z._geometry=this,Z._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),L.push(Z),this.isReady()?this._applyToMesh(Z):this._boundingInfo&&Z.setBoundingInfo(this._boundingInfo)}_updateExtend(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!Z&&(Z=this.getVerticesData(G.g.PositionKind),!Z))return;this._extend=(0,t.d)(Z,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(Z){const c=this._meshes.length;for(const L in this._vertexBuffers)1===c&&this._vertexBuffers[L].create(),L===G.g.PositionKind&&(this._extend||this._updateExtend(),Z.buildBoundingInfo(this._extend.minimum,this._extend.maximum),Z._createGlobalSubMesh(Z.isUnIndexed),Z.IZ());1===c&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),Z._syncGeometryWithMorphTargetManager(),Z.synchronizeInstances()}_notifyUpdate(Z){this.onGeometryUpdated&&this.onGeometryUpdated(this,Z),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const c of this._meshes)c._markSubMeshesAsAttributesDirty()}load(Z,c){2!==this.delayLoadState&&(this.isReady()?c&&c():(this.delayLoadState=2,this._queueLoad(Z,c)))}_queueLoad(Z,c){this.delayLoadingFile&&(Z.addPendingData(this),Z._loadFile(this.delayLoadingFile,(L=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(L),this),this.delayLoadState=1,this._delayInfo=[],Z.removePendingData(this);const k=this._meshes,N=k.length;for(let Z=0;Z<N;Z++)this._applyToMesh(k[Z]);c&&c()}),void 0,!0))}toLeftHanded(){const Z=this.tc(!1);if(null!=Z&&Z.length>0){for(let c=0;c<Z.length;c+=3){const L=Z[c+0];Z[c+0]=Z[c+2],Z[c+2]=L}this.setIndices(Z)}const c=this.getVerticesData(G.g.PositionKind,!1);if(null!=c&&c.length>0){for(let Z=0;Z<c.length;Z+=3)c[Z+2]=-c[Z+2];this.QZ(G.g.PositionKind,c,!1)}const L=this.getVerticesData(G.g.NormalKind,!1);if(null!=L&&L.length>0){for(let Z=0;Z<L.length;Z+=3)L[Z+2]=-L[Z+2];this.QZ(G.g.NormalKind,L,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const Z=this.getVerticesData(G.g.PositionKind);if(!Z||0===Z.length)return!1;for(let c=3*this._positionsCache.length,L=this._positionsCache.length;c<Z.length;c+=3,++L)this._positionsCache[L]=k.h.oc(Z,c);for(let c=0,L=0;c<Z.length;c+=3,++L)this._positionsCache[L].set(Z[0+c],Z[1+c],Z[2+c]);return this._positionsCache.length=Z.length/3,this._positions=this._positionsCache,!0}p(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const L in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[L]);this._vertexArrayObjects={};const Z=this._meshes,c=Z.length;for(let L=0;L<c;L++)Z[L]._invalidateInstanceVertexArrayObject()}}dispose(){const Z=this._meshes,c=Z.length;let L;for(L=0;L<c;L++)this.releaseForMesh(Z[L]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const k in this._vertexBuffers)this._vertexBuffers[k].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const Z=this._parentContainer.geometries.indexOf(this);Z>-1&&this._parentContainer.geometries.splice(Z,1),this._parentContainer=null}this._isDisposed=!0}i(Z){const c=new R.e;c.indices=[];const L=this.tc();if(L)for(let R=0;R<L.length;R++)c.indices.push(L[R]);let k,N=!1,G=!1;for(k in this._vertexBuffers){const Z=this.getVerticesData(k);if(Z&&(Z instanceof Float32Array?c.set(new Float32Array(Z),k):c.set(Z.slice(0),k),!G)){const Z=this.getVertexBuffer(k);Z&&(N=Z.isUpdatable(),G=!N)}}const V=new O(Z,this._scene,c,N);for(k in V.delayLoadState=this.delayLoadState,V.delayLoadingFile=this.delayLoadingFile,V._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)V._delayInfo=V._delayInfo||[],V._delayInfo.push(k);return V._boundingInfo=new J.e(this._extend.minimum,this._extend.maximum),V}serialize(){const Z={};return Z.id=this.id,Z.uniqueId=this.uniqueId,Z.updatable=this._updatable,i.b&&i.b.HasTags(this)&&(Z.tags=i.b.GetTags(this)),Z}_toNumberArray(Z){return Array.isArray(Z)?Z:Array.prototype.slice.call(Z)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const Z in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,Z)&&(this._vertexBuffers[Z]._buffer._data=null)}serializeVerticeData(){const Z=this.serialize();return this.isVerticesDataPresent(G.g.PositionKind)&&(Z.BZ=this._toNumberArray(this.getVerticesData(G.g.PositionKind)),this.isVertexBufferUpdatable(G.g.PositionKind)&&(Z.positionsUpdatable=!0)),this.isVerticesDataPresent(G.g.NormalKind)&&(Z.DZ=this._toNumberArray(this.getVerticesData(G.g.NormalKind)),this.isVertexBufferUpdatable(G.g.NormalKind)&&(Z.normalsUpdatable=!0)),this.isVerticesDataPresent(G.g.TangentKind)&&(Z.tangents=this._toNumberArray(this.getVerticesData(G.g.TangentKind)),this.isVertexBufferUpdatable(G.g.TangentKind)&&(Z.tangentsUpdatable=!0)),this.isVerticesDataPresent(G.g.UVKind)&&(Z.HZ=this._toNumberArray(this.getVerticesData(G.g.UVKind)),this.isVertexBufferUpdatable(G.g.UVKind)&&(Z.uvsUpdatable=!0)),this.isVerticesDataPresent(G.g.UV2Kind)&&(Z.uvs2=this._toNumberArray(this.getVerticesData(G.g.UV2Kind)),this.isVertexBufferUpdatable(G.g.UV2Kind)&&(Z.uvs2Updatable=!0)),this.isVerticesDataPresent(G.g.UV3Kind)&&(Z.uvs3=this._toNumberArray(this.getVerticesData(G.g.UV3Kind)),this.isVertexBufferUpdatable(G.g.UV3Kind)&&(Z.uvs3Updatable=!0)),this.isVerticesDataPresent(G.g.UV4Kind)&&(Z.uvs4=this._toNumberArray(this.getVerticesData(G.g.UV4Kind)),this.isVertexBufferUpdatable(G.g.UV4Kind)&&(Z.uvs4Updatable=!0)),this.isVerticesDataPresent(G.g.UV5Kind)&&(Z.uvs5=this._toNumberArray(this.getVerticesData(G.g.UV5Kind)),this.isVertexBufferUpdatable(G.g.UV5Kind)&&(Z.uvs5Updatable=!0)),this.isVerticesDataPresent(G.g.UV6Kind)&&(Z.uvs6=this._toNumberArray(this.getVerticesData(G.g.UV6Kind)),this.isVertexBufferUpdatable(G.g.UV6Kind)&&(Z.uvs6Updatable=!0)),this.isVerticesDataPresent(G.g.ColorKind)&&(Z.eZ=this._toNumberArray(this.getVerticesData(G.g.ColorKind)),this.isVertexBufferUpdatable(G.g.ColorKind)&&(Z.colorsUpdatable=!0)),this.isVerticesDataPresent(G.g.MatricesIndicesKind)&&(Z.matricesIndices=this._toNumberArray(this.getVerticesData(G.g.MatricesIndicesKind)),Z.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(G.g.MatricesIndicesKind)&&(Z.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(G.g.MatricesWeightsKind)&&(Z.matricesWeights=this._toNumberArray(this.getVerticesData(G.g.MatricesWeightsKind)),this.isVertexBufferUpdatable(G.g.MatricesWeightsKind)&&(Z.matricesWeightsUpdatable=!0)),Z.indices=this._toNumberArray(this.tc()),Z}static ExtractFromMesh(Z,c){const L=Z._geometry;return L?L.i(c):null}static RandomId(){return z.c.RandomId()}static _GetGeometryByLoadedUniqueId(Z,c){for(let L=0;L<c.geometries.length;L++)if(c.geometries[L]._loadedUniqueId===Z)return c.geometries[L];return null}static _ImportGeometry(Z,c){const L=c.XZ(),k=Z.geometryUniqueId,R=Z.geometryId;if(k||R){const Z=k?this._GetGeometryByLoadedUniqueId(k,L):L.getGeometryById(R);Z&&Z.WZ(c)}else if(Z instanceof ArrayBuffer){const L=c._binaryInfo;if(L.positionsAttrDesc&&L.positionsAttrDesc.count>0){const k=new Float32Array(Z,L.positionsAttrDesc.offset,L.positionsAttrDesc.count);c.QZ(G.g.PositionKind,k,!1)}if(L.normalsAttrDesc&&L.normalsAttrDesc.count>0){const k=new Float32Array(Z,L.normalsAttrDesc.offset,L.normalsAttrDesc.count);c.QZ(G.g.NormalKind,k,!1)}if(L.tangetsAttrDesc&&L.tangetsAttrDesc.count>0){const k=new Float32Array(Z,L.tangetsAttrDesc.offset,L.tangetsAttrDesc.count);c.QZ(G.g.TangentKind,k,!1)}if(L.uvsAttrDesc&&L.uvsAttrDesc.count>0){const k=new Float32Array(Z,L.uvsAttrDesc.offset,L.uvsAttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UVKind,k,!1)}if(L.uvs2AttrDesc&&L.uvs2AttrDesc.count>0){const k=new Float32Array(Z,L.uvs2AttrDesc.offset,L.uvs2AttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UV2Kind,k,!1)}if(L.uvs3AttrDesc&&L.uvs3AttrDesc.count>0){const k=new Float32Array(Z,L.uvs3AttrDesc.offset,L.uvs3AttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UV3Kind,k,!1)}if(L.uvs4AttrDesc&&L.uvs4AttrDesc.count>0){const k=new Float32Array(Z,L.uvs4AttrDesc.offset,L.uvs4AttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UV4Kind,k,!1)}if(L.uvs5AttrDesc&&L.uvs5AttrDesc.count>0){const k=new Float32Array(Z,L.uvs5AttrDesc.offset,L.uvs5AttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UV5Kind,k,!1)}if(L.uvs6AttrDesc&&L.uvs6AttrDesc.count>0){const k=new Float32Array(Z,L.uvs6AttrDesc.offset,L.uvs6AttrDesc.count);if(x.b)for(let Z=1;Z<k.length;Z+=2)k[Z]=1-k[Z];c.QZ(G.g.UV6Kind,k,!1)}if(L.colorsAttrDesc&&L.colorsAttrDesc.count>0){const k=new Float32Array(Z,L.colorsAttrDesc.offset,L.colorsAttrDesc.count);c.QZ(G.g.ColorKind,k,!1,L.colorsAttrDesc.stride)}if(L.matricesIndicesAttrDesc&&L.matricesIndicesAttrDesc.count>0){const k=new Int32Array(Z,L.matricesIndicesAttrDesc.offset,L.matricesIndicesAttrDesc.count),N=[];for(let Z=0;Z<k.length;Z++){const c=k[Z];N.push(255&c),N.push((65280&c)>>8),N.push((16711680&c)>>16),N.push(c>>24&255)}c.QZ(G.g.MatricesIndicesKind,N,!1)}if(L.matricesIndicesExtraAttrDesc&&L.matricesIndicesExtraAttrDesc.count>0){const k=new Int32Array(Z,L.matricesIndicesExtraAttrDesc.offset,L.matricesIndicesExtraAttrDesc.count),N=[];for(let Z=0;Z<k.length;Z++){const c=k[Z];N.push(255&c),N.push((65280&c)>>8),N.push((16711680&c)>>16),N.push(c>>24&255)}c.QZ(G.g.MatricesIndicesExtraKind,N,!1)}if(L.matricesWeightsAttrDesc&&L.matricesWeightsAttrDesc.count>0){const k=new Float32Array(Z,L.matricesWeightsAttrDesc.offset,L.matricesWeightsAttrDesc.count);c.QZ(G.g.MatricesWeightsKind,k,!1)}if(L.indicesAttrDesc&&L.indicesAttrDesc.count>0){const k=new Int32Array(Z,L.indicesAttrDesc.offset,L.indicesAttrDesc.count);c.setIndices(k,null)}if(L.subMeshesAttrDesc&&L.subMeshesAttrDesc.count>0){const k=new Int32Array(Z,L.subMeshesAttrDesc.offset,5*L.subMeshesAttrDesc.count);c.ec=[];for(let Z=0;Z<L.subMeshesAttrDesc.count;Z++){const L=k[5*Z+0],N=k[5*Z+1],R=k[5*Z+2],G=k[5*Z+3],p=k[5*Z+4];V.b.AddToMesh(L,N,R,G,p,c)}}}else if(Z.BZ&&Z.DZ&&Z.indices){if(c.QZ(G.g.PositionKind,Z.BZ,Z.BZ._updatable||Z.positionsUpdatable),c.QZ(G.g.NormalKind,Z.DZ,Z.DZ._updatable||Z.normalsUpdatable),Z.tangents&&c.QZ(G.g.TangentKind,Z.tangents,Z.tangents._updatable||Z.tangentsUpdatable),Z.HZ&&c.QZ(G.g.UVKind,Z.HZ,Z.HZ._updatable||Z.uvsUpdatable),Z.uvs2&&c.QZ(G.g.UV2Kind,Z.uvs2,Z.uvs2._updatable||Z.uvs2Updatable),Z.uvs3&&c.QZ(G.g.UV3Kind,Z.uvs3,Z.uvs3._updatable||Z.uvs3Updatable),Z.uvs4&&c.QZ(G.g.UV4Kind,Z.uvs4,Z.uvs4._updatable||Z.uvs4Updatable),Z.uvs5&&c.QZ(G.g.UV5Kind,Z.uvs5,Z.uvs5._updatable||Z.uvs5Updatable),Z.uvs6&&c.QZ(G.g.UV6Kind,Z.uvs6,Z.uvs6._updatable||Z.uvs6Updatable),Z.eZ&&c.QZ(G.g.ColorKind,N.h.CheckColors4(Z.eZ,Z.BZ.length/3),Z.eZ._updatable),Z.matricesIndices)if(Z.matricesIndices._isExpanded||Z.matricesIndicesExpanded)delete Z.matricesIndices._isExpanded,delete Z.matricesIndicesExpanded,c.QZ(G.g.MatricesIndicesKind,Z.matricesIndices,Z.matricesIndices._updatable||Z.matricesIndicesUpdatable);else{const L=[];for(let c=0;c<Z.matricesIndices.length;c++){const k=Z.matricesIndices[c];L.push(255&k),L.push((65280&k)>>8),L.push((16711680&k)>>16),L.push(k>>24&255)}c.QZ(G.g.MatricesIndicesKind,L,Z.matricesIndices._updatable||Z.matricesIndicesUpdatable)}if(Z.matricesIndicesExtra)if(Z.matricesIndicesExtraExpanded||Z.matricesIndicesExtra._isExpanded)delete Z.matricesIndices._isExpanded,delete Z.matricesIndicesExtraExpanded,c.QZ(G.g.MatricesIndicesExtraKind,Z.matricesIndicesExtra,Z.matricesIndicesExtra._updatable||Z.matricesIndicesExtraUpdatable);else{const L=[];for(let c=0;c<Z.matricesIndicesExtra.length;c++){const k=Z.matricesIndicesExtra[c];L.push(255&k),L.push((65280&k)>>8),L.push((16711680&k)>>16),L.push(k>>24&255)}c.QZ(G.g.MatricesIndicesExtraKind,L,Z.matricesIndicesExtra._updatable||Z.matricesIndicesExtraUpdatable)}Z.matricesWeights&&(O._CleanMatricesWeights(Z,c),c.QZ(G.g.MatricesWeightsKind,Z.matricesWeights,Z.matricesWeights._updatable)),Z.matricesWeightsExtra&&c.QZ(G.g.MatricesWeightsExtraKind,Z.matricesWeightsExtra,Z.matricesWeights._updatable),c.setIndices(Z.indices,null)}if(Z.ec){c.ec=[];for(let L=0;L<Z.ec.length;L++){const k=Z.ec[L];V.b.AddToMesh(k.materialIndex,k.verticesStart,k.verticesCount,k.indexStart,k.indexCount,c)}}c._shouldGenerateFlatShading&&(c.convertToFlatShadedMesh(),c._shouldGenerateFlatShading=!1),c.Jc(!0),L.onMeshImportedObservable.notifyObservers(c)}static _CleanMatricesWeights(Z,c){const L=.001;if(!p.e.CleanBoneMatrixWeights)return;let k=0;if(!(Z.skeletonId>-1))return;{const L=c.XZ().getLastSkeletonById(Z.skeletonId);if(!L)return;k=L.bones.length}const N=c.getVerticesData(G.g.MatricesIndicesKind),R=c.getVerticesData(G.g.MatricesIndicesExtraKind),V=Z.matricesWeights,J=Z.matricesWeightsExtra,z=Z.numBoneInfluencer,i=V.length;for(let G=0;G<i;G+=4){let Z=0,c=-1;for(let k=0;k<4;k++){const N=V[G+k];Z+=N,N<L&&c<0&&(c=k)}if(J)for(let k=0;k<4;k++){const N=J[G+k];Z+=N,N<L&&c<0&&(c=k+4)}if((c<0||c>z-1)&&(c=z-1),Z>L){const c=1/Z;for(let Z=0;Z<4;Z++)V[G+Z]*=c;if(J)for(let Z=0;Z<4;Z++)J[G+Z]*=c}else c>=4?(J[G+c-4]=1-Z,R[G+c-4]=k):(V[G+c]=1-Z,N[G+c]=k)}c.QZ(G.g.MatricesIndicesKind,N),Z.matricesWeightsExtra&&c.QZ(G.g.MatricesIndicesExtraKind,R)}static Parse(Z,c,L){const N=new O(Z.id,c,void 0,Z.updatable);return N._loadedUniqueId=Z.uniqueId,i.b&&i.b.AddTagsTo(N,Z.tags),Z.delayLoadingFile?(N.delayLoadState=4,N.delayLoadingFile=L+Z.delayLoadingFile,N._boundingInfo=new J.e(k.h.oc(Z.boundingBoxMinimum),k.h.oc(Z.boundingBoxMaximum)),N._delayInfo=[],Z.hasUVs&&N._delayInfo.push(G.g.UVKind),Z.hasUVs2&&N._delayInfo.push(G.g.UV2Kind),Z.hasUVs3&&N._delayInfo.push(G.g.UV3Kind),Z.hasUVs4&&N._delayInfo.push(G.g.UV4Kind),Z.hasUVs5&&N._delayInfo.push(G.g.UV5Kind),Z.hasUVs6&&N._delayInfo.push(G.g.UV6Kind),Z.hasColors&&N._delayInfo.push(G.g.ColorKind),Z.hasMatricesIndices&&N._delayInfo.push(G.g.MatricesIndicesKind),Z.hasMatricesWeights&&N._delayInfo.push(G.g.MatricesWeightsKind),N._delayLoadingFunction=R.e.ImportVertexData):R.e.ImportVertexData(Z,N),c.pushGeometry(N,!0),N}}},11321:(Z,c,L)=>{L.d(c,{e:()=>t});var k=L(10993),N=L(11052),R=L(11282),G=L(11325),V=L(11058),p=L(11274),J=L(11190),z=L(11038),i=L(11012);G.c._instancedMeshFactory=(Z,c)=>{const L=new t(Z,c);if(c.instancedBuffers){L.instancedBuffers={};for(const Z in c.instancedBuffers)L.instancedBuffers[Z]=c.instancedBuffers[Z]}return L};class t extends R.d{constructor(Z,c){super(Z,c.XZ()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,c.Lt(this),this._sourceMesh=c,this._unIndexed=c._unIndexed,this.position.R(c.position),this.rotation.R(c.rotation),this.Pc.R(c.Pc),c.rotationQuaternion&&(this.rotationQuaternion=c.rotationQuaternion.clone()),this.animations=c.animations.slice();for(const L of c.getAnimationRanges())null!=L&&this.createAnimationRange(L.name,L.from,L.to);if(this.infiniteDistance=c.infiniteDistance,this.setPivotMatrix(c.getPivotMatrix()),c.skeleton||c.morphTargetManager||!c.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const Z=c.getBoundingInfo();this.buildBoundingInfo(Z.minimum,Z.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(Z){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.receiveShadows)!==Z&&z.c.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(Z){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.material)!==Z&&z.c.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(Z){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.visibility)!==Z&&z.c.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(Z){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.skeleton)!==Z&&z.c.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(Z){this._sourceMesh&&Z!==this._sourceMesh.renderingGroupId&&N.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get zc(){return this._sourceMesh._geometry}createInstance(Z){return this._sourceMesh.createInstance(Z)}isReady(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(Z,!0)}getVerticesData(Z,c,L){return this._sourceMesh.getVerticesData(Z,c,L)}copyVerticesData(Z,c){this._sourceMesh.copyVerticesData(Z,c)}QZ(Z,c,L,k){return this.sourceMesh&&this.sourceMesh.QZ(Z,c,L,k),this.sourceMesh}updateVerticesData(Z,c,L,k){return this.sourceMesh&&this.sourceMesh.updateVerticesData(Z,c,L,k),this.sourceMesh}setIndices(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(Z,c),this.sourceMesh}isVerticesDataPresent(Z){return this._sourceMesh.isVerticesDataPresent(Z)}tc(){return this._sourceMesh.tc()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let Z,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;Z="object"===typeof c?c:{applySkeleton:c,applyMorph:L};const k=this._sourceMesh.zc?this._sourceMesh.zc.boundingBias:null;return this.dZ(this._sourceMesh._getData(Z,null,J.g.PositionKind),k),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(Z,c){if(super._activate(Z,c),this._sourceMesh.ec||N.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,Z),c){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==p.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new k.b);const Z=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,k.d.Mc[7].R(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.R(this._currentLOD.Jc(!0)),this._currentLOD.position.R(k.d.Mc[7]),this._currentLOD._masterMesh=Z,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(Z){if(!Z)return this;const c=this.sourceMesh.getLODLevels();if(c&&0!==c.length){const c=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(Z,c.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(Z){return this.sourceMesh._preActivateForIntermediateRendering(Z)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ec)for(let Z=0;Z<this._sourceMesh.ec.length;Z++)this._sourceMesh.ec[Z].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}IZ(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;const k=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(Z);if(V.d.DeepCopy(this,k,["name","ec","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Si","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","zc"],[]),this.refreshBoundingInfo(),c&&(k.parent=c),!L)for(let N=0;N<this.XZ().meshes.length;N++){const Z=this.XZ().meshes[N];Z.parent===this&&Z.clone(Z.name,k)}return k.Jc(!0),this.onClonedObservable.notifyObservers(k),k}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.ct(this),super.dispose(Z,c)}_serializeAsParent(Z){super._serializeAsParent(Z),Z.parentId=this._sourceMesh.uniqueId,Z.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const k=this.clone("Clone of "+(this.name||this.id),Z||this.parent,!0,c&&c.newSourcedMesh);k&&L&&L(this,k);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(k,c,L);return k}}G.c.prototype.registerInstancedBuffer=function(Z,c){var L,k;if(null===(L=this._userInstancedBuffersStorage)||void 0===L||null===(k=L.vertexBuffers[Z])||void 0===k||k.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const Z of this.instances)Z.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[Z]=null,this._userInstancedBuffersStorage.strides[Z]=c,this._userInstancedBuffersStorage.sizes[Z]=32*c,this._userInstancedBuffersStorage.data[Z]=new Float32Array(this._userInstancedBuffersStorage.sizes[Z]),this._userInstancedBuffersStorage.vertexBuffers[Z]=new J.g(this.getEngine(),this._userInstancedBuffersStorage.data[Z],Z,!0,!1,c,!0);for(const N of this.instances)N.instancedBuffers[Z]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},G.c.prototype._processInstancedBuffers=function(Z,c){const L=Z?Z.length:0;for(const k in this.instancedBuffers){let N=this._userInstancedBuffersStorage.sizes[k];const R=this._userInstancedBuffersStorage.strides[k],G=(L+1)*R;for(;N<G;)N*=2;this._userInstancedBuffersStorage.data[k].length!=N&&(this._userInstancedBuffersStorage.data[k]=new Float32Array(N),this._userInstancedBuffersStorage.sizes[k]=N,this._userInstancedBuffersStorage.vertexBuffers[k]&&(this._userInstancedBuffersStorage.vertexBuffers[k].dispose(),this._userInstancedBuffersStorage.vertexBuffers[k]=null));const V=this._userInstancedBuffersStorage.data[k];let p=0;if(c){const Z=this.instancedBuffers[k];Z.toArray?Z.toArray(V,p):Z.copyToArray?Z.copyToArray(V,p):V[p]=Z,p+=R}for(let c=0;c<L;c++){const L=Z[c].instancedBuffers[k];L.toArray?L.toArray(V,p):L.copyToArray?L.copyToArray(V,p):V[p]=L,p+=R}this._userInstancedBuffersStorage.vertexBuffers[k]?this._userInstancedBuffersStorage.vertexBuffers[k].updateDirectly(V,0):(this._userInstancedBuffersStorage.vertexBuffers[k]=new J.g(this.getEngine(),this._userInstancedBuffersStorage.data[k],k,!0,!1,R,!0),this._invalidateInstanceVertexArrayObject())}},G.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const Z in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[Z]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},G.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const Z in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[Z]&&this._userInstancedBuffersStorage.vertexBuffers[Z].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,i.g)("BABYLON.InstancedMesh",t)},11736:(Z,c,L)=>{L.d(c,{b:()=>J});var k=L(11255),N=L(11190),R=L(11325),G=L(11321),V=L(11163),p=L(11741);R.c._LinesMeshParser=(Z,c)=>J.Parse(Z,c);class J extends R.c{_isShaderMaterial(Z){return"ShaderMaterial"===Z.getClassName()}constructor(Z){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7?arguments[7]:void 0;super(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c,arguments.length>4?arguments[4]:void 0),this.useVertexColor=R,this.useVertexAlpha=G,this.color=new k.d(1,1,1),this.alpha=1,this._shaderLanguage=0,c&&(this.color=c.color.clone(),this.alpha=c.alpha,this.useVertexColor=c.useVertexColor,this.useVertexAlpha=c.useVertexAlpha),this.intersectionThreshold=.1;const z={attributes:[N.g.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?z.defines.push("#define VERTEXALPHA"):z.needAlphaBlending=!1,this.useVertexColor?(z.defines.push("#define VERTEXCOLOR"),z.attributes.push(N.g.ColorKind)):(z.uniforms.push("color"),this._color4=new k.h),V)this.material=V;else{this.XZ().getEngine().isWebGPU&&!J.ForceGLSL&&(this._shaderLanguage=1),z.shaderLanguage=this._shaderLanguage,z.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([L.e(23).then(L.bind(L,14255)),L.e(19).then(L.bind(L,14259))]):await Promise.all([L.e(17).then(L.bind(L,14263)),L.e(16).then(L.bind(L,14271))])},this.material=new p.b("colorShader",this.XZ(),"color",z,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(Z){this._lineMaterial=Z,this._lineMaterial.fillMode=V.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(Z){}_bind(Z,c){if(!this._geometry)return this;const L=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(c,L):this._geometry._bind(c,L,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:Z,g:c,b:L}=this.color;this._color4.set(Z,c,L,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(Z,c,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const k=this.XZ().getEngine();return this._unIndexed?k.drawArraysType(V.e.LineListDrawMode,Z.verticesStart,Z.verticesCount,L):k.drawElementsType(V.e.LineListDrawMode,Z.indexStart,Z.indexCount,L),this}dispose(Z){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(Z)}clone(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0;if(c&&void 0===c._addToSceneRootNodes){const L=c;return L.source=this,new J(Z,this.XZ(),L.parent,L.source,L.doNotCloneChildren)}return new J(Z,this.XZ(),c,this,L)}createInstance(Z){const c=new z(Z,this);if(this.instancedBuffers){c.instancedBuffers={};for(const Z in this.instancedBuffers)c.instancedBuffers[Z]=this.instancedBuffers[Z]}return c}serialize(Z){super.serialize(Z),Z.color=this.color.xc(),Z.alpha=this.alpha}static Parse(Z,c){const L=new J(Z.name,c);return L.color=k.d.oc(Z.color),L.alpha=Z.alpha,L}}J.ForceGLSL=!1;class z extends G.e{constructor(Z,c){super(Z,c),this.intersectionThreshold=c.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11325:(Z,c,L)=>{L.d(c,{c:()=>I,d:()=>D});var k=L(11027),N=L(11038),R=L(11058),G=L(11251),V=L(11298),p=L(11329),J=L(10993),z=L(11255),i=L(11277),t=L(11190),E=L(11289),x=L(11358),q=L(11282),O=L(11185),w=L(11163),M=L(11380),P=L(11362),j=L(11242),o=L(11052),u=L(11012),X=L(11070),h=L(11386);class B{constructor(Z,c){this.distanceOrScreenCoverage=Z,this.mesh=c}}class D{}class e{constructor(){this.visibleInstances={},this.batchCache=new H,this.batchCacheReplacementModeInFrozenMode=new H,this.instancesBufferSize=2048}}class H{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class l{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class W{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const T={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class I extends q.d{static _GetDefaultSideOrientation(Z){return Z||I.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(Z){this._internalMeshDataInfo._useLODScreenCoverage=Z,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(Z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==Z&&(Z&&this._internalMeshDataInfo._sourcePositions&&(this.QZ(t.g.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.QZ(t.g.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=Z,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new k.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new k.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new k.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new k.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new k.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(Z){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(Z)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(Z){this._internalMeshDataInfo._forcedInstanceCount=Z}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(Z){this._internalMeshDataInfo._sideOrientation=Z,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===Z||!this._scene.useRightHandedSystem&&0===Z}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(Z){this.sideOrientation=Z,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(Z){this._internalMeshDataInfo._overrideRenderingFillMode=Z}get material(){return this._internalAbstractMeshDataInfo._material}set material(Z){Z&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(Z.sideOrientation=null),this._setMaterial(Z)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(Z){this._unIndexed!==Z&&(this._unIndexed=Z,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(Z){this._instanceDataStorage.manualUpdate=Z}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(Z){this._instanceDataStorage.previousManualUpdate=Z}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(Z){this._instanceDataStorage.forceMatrixUpdates=Z}_copySource(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.XZ();if(Z._geometry&&Z._geometry.WZ(this),R.d.DeepCopy(Z,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","zc","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Si","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=Z,N.useClonedMeshMap&&(Z._internalMeshDataInfo.meshMap||(Z._internalMeshDataInfo.meshMap={}),Z._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=Z._originalBuilderSideOrientation,this._creationDataStorage=Z._creationDataStorage,Z._ranges){const c=Z._ranges;for(const Z in c)Object.prototype.hasOwnProperty.call(c,Z)&&c[Z]&&this.createAnimationRange(Z,c[Z].from,c[Z].to)}if(Z.metadata&&Z.metadata.clone?this.metadata=Z.metadata.clone():this.metadata=Z.metadata,this._internalMetadata=Z._internalMetadata,G.b&&G.b.HasTags(Z)&&G.b.AddTagsTo(this,G.b.GetTags(Z,!0)),this.lV(Z.isEnabled(!1)),this.parent=Z.parent,this.setPivotMatrix(Z.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+Z.id,this.material=Z.material,!c){const N=Z.getDescendants(!0);for(let Z=0;Z<N.length;Z++){const R=N[Z];R._isMesh?(T.parent=this,T.doNotCloneChildren=c,T.clonePhysicsImpostor=L,T.cloneThinInstances=k,R.clone(this.name+"."+R.name,T)):R.clone&&R.clone(this.name+"."+R.name,this)}}if(Z.morphTargetManager&&(this.morphTargetManager=Z.morphTargetManager),N.getPhysicsEngine){const c=N.getPhysicsEngine();if(L&&c)if(1===c.getPluginVersion()){const L=c.getImpostorForPhysicsObject(Z);L&&(this.physicsImpostor=L.clone(this))}else 2===c.getPluginVersion()&&Z.physicsBody&&Z.physicsBody.clone(this)}for(let R=0;R<N.si.length;R++){const c=N.si[R];c.j===Z&&c.clone(c.name,this)}if(this.skeleton=Z.skeleton,k&&(Z._thinInstanceDataStorage.matrixData?(this.ki("matrix",new Float32Array(Z._thinInstanceDataStorage.matrixData),16,!Z._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=Z._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=Z._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=Z._thinInstanceDataStorage.matrixBufferSize,Z._userThinInstanceBuffersStorage)){const c=Z._userThinInstanceBuffersStorage;for(const Z in c.data){var V,p;this.ki(Z,new Float32Array(c.data[Z]),c.strides[Z],!(null!==(V=c.vertexBuffers)&&void 0!==V&&null!==(p=V[Z])&&void 0!==p&&p.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[Z]=c.sizes[Z]}}this.refreshBoundingInfo(!0,!0),this.Jc(!0)}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0,G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(Z,c),this._internalMeshDataInfo=new W,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new e,this._thinInstanceDataStorage=new l,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=I.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,c=this.XZ(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(Z,c,L)=>{Z&&L&&(this._uniformBuffer?this.transferToEffect(c):L.bindOnlyWorldMatrix(c))};let V=null,p=!1;if(L&&void 0===L._addToSceneRootNodes){const Z=L;V=Z.parent??null,N=Z.source??null,R=Z.doNotCloneChildren??!1,G=Z.clonePhysicsImpostor??!0,p=Z.cloneThinInstances??!1}else V=L;N&&this._copySource(N,R,G,p),null!==V&&(this.parent=V),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=Z=>{Z.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new k.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),N&&N.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const k=0===this.getTotalVertices()||c&&c.doNotInstantiate&&(!0===c.doNotInstantiate||c.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),Z||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));k.parent=Z||this.parent,k.position=this.position.clone(),k.Pc=this.Pc.clone(),this.rotationQuaternion?k.rotationQuaternion=this.rotationQuaternion.clone():k.rotation=this.rotation.clone(),L&&L(this,k);for(const N of this.getChildTransformNodes(!0))"InstancedMesh"===N.getClassName()&&"Mesh"===k.getClassName()&&N.sourceMesh===this?N.instantiateHierarchy(k,{doNotInstantiate:c&&c.doNotInstantiate||!1,newSourcedMesh:k},L):N.instantiateHierarchy(k,c,L);return k}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(Z){let c=super.toString(Z);if(c+=", n vertices: "+this.getTotalVertices(),c+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let L=0;L<this.animations.length;L++)c+=", animation[0]: "+this.animations[L].toString(Z);if(Z)if(this._geometry){const Z=this.tc(),L=this.getVerticesData(t.g.PositionKind);L&&Z&&(c+=", flat shading: "+(L.length/3===Z.length?"YES":"NO"))}else c+=", flat shading: UNKNOWN";return c}_unBindEffect(){super._unBindEffect();for(const Z of this.instances)Z._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const Z=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((c,L)=>c.distanceOrScreenCoverage<L.distanceOrScreenCoverage?Z:c.distanceOrScreenCoverage>L.distanceOrScreenCoverage?-Z:0))}addLODLevel(Z,c){if(c&&c._masterMesh)return o.e.Warn("You cannot use a mesh as LOD level twice"),this;const L=new B(Z,c);return this._internalMeshDataInfo._LODLevels.push(L),c&&(c._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(Z){const c=this._internalMeshDataInfo;for(let L=0;L<c._LODLevels.length;L++){const k=c._LODLevels[L];if(k.distanceOrScreenCoverage===Z)return k.mesh}return null}removeLODLevel(Z){const c=this._internalMeshDataInfo;for(let L=0;L<c._LODLevels.length;L++)c._LODLevels[L].mesh===Z&&(c._LODLevels.splice(L,1),Z&&(Z._masterMesh=null));return this._sortLODLevels(),this}getLOD(Z,c){const L=this._internalMeshDataInfo;if(!L._LODLevels||0===L._LODLevels.length)return this;const k=c||this.getBoundingInfo().boundingSphere,N=Z.mode===p.d.ORTHOGRAPHIC_CAMERA?Z.Dc:k.centerWorld.yL(Z.globalPosition).length();let R=N,G=1;if(L._useLODScreenCoverage){const c=Z.screenArea;let L=k.radiusWorld*Z.Dc/N;L=L*L*Math.PI,R=L/c,G=-1}if(G*L._LODLevels[L._LODLevels.length-1].distanceOrScreenCoverage>G*R)return this.onLODLevelSelection&&this.onLODLevelSelection(R,this,this),this;for(let V=0;V<L._LODLevels.length;V++){const Z=L._LODLevels[V];if(G*Z.distanceOrScreenCoverage<G*R){if(Z.mesh){if(4===Z.mesh.delayLoadState)return Z.mesh._checkDelayState(),this;if(2===Z.mesh.delayLoadState)return this;Z.mesh._preActivate(),Z.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(R,this,Z.mesh),Z.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(R,this,this),this}get zc(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(Z,c,L,k){var N,R;if(!this._geometry)return null;let G=k||null===(N=this._userInstancedBuffersStorage)||void 0===N||null===(R=N.vertexBuffers[Z])||void 0===R?void 0:R.getFloatData(this.instances.length+1,L||c&&1!==this._geometry.meshes.length);return G||(G=this._geometry.getVerticesData(Z,c,L)),G}copyVerticesData(Z,c){this._geometry&&this._geometry.copyVerticesData(Z,c)}getVertexBuffer(Z,c){var L;return this._geometry?(c||null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[Z])??this._geometry.getVertexBuffer(Z):null}isVerticesDataPresent(Z,c){var L;return this._geometry?!c&&void 0!==(null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[Z])||this._geometry.isVerticesDataPresent(Z):!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z)}isVertexBufferUpdatable(Z,c){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(Z);if(!c){var L;const c=null===(L=this._userInstancedBuffersStorage)||void 0===L?void 0:L.vertexBuffers[Z];if(c)return c.isUpdatable()}return this._geometry.isVertexBufferUpdatable(Z)}getVerticesDataKinds(Z){if(!this._geometry){const Z=[];if(this._delayInfo)for(const c of this._delayInfo)Z.push(c);return Z}const c=this._geometry.getVerticesDataKinds();if(!Z&&this._userInstancedBuffersStorage)for(const L in this._userInstancedBuffersStorage.vertexBuffers)-1===c.indexOf(L)&&c.push(L);return c}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}tc(Z,c){return this._geometry?this._geometry.tc(Z,c):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(Z))return!1;if(!this.ec||0===this.ec.length)return!0;if(!Z)return!0;const L=this.getEngine(),k=this.XZ(),N=c||L.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Jc();const R=this.material||k.defaultMaterial;if(R)if(R._storeEffectOnSubMeshes)for(const t of this.ec){const Z=t.rZ();if(Z)if(Z._storeEffectOnSubMeshes){if(!Z.isReadyForSubMesh(this,t,N))return!1}else if(!Z.isReady(this,N))return!1}else if(!R.isReady(this,N))return!1;const G=L.currentRenderPassId;for(const t of this.lightSources){const Z=t.getShadowGenerators();if(!Z)continue;const c=Z.values();for(let k=c.next();!0!==k.done;k=c.next()){var V,p,J,z;const Z=k.value;if(Z&&(null===(V=Z.getShadowMap())||void 0===V||!V.renderList||null!==(p=Z.getShadowMap())&&void 0!==p&&p.renderList&&-1!==(null===(J=Z.getShadowMap())||void 0===J||null===(z=J.renderList)||void 0===z?void 0:z.indexOf(this)))){const c=Z.getShadowMap().renderPassIds??[L.currentRenderPassId];for(let k=0;k<c.length;++k){L.currentRenderPassId=c[k];for(const c of this.ec){var i;if(!Z.isReady(c,N,(null===(i=c.rZ())||void 0===i?void 0:i.needAlphaBlendingForMesh(this))??!1))return L.currentRenderPassId=G,!1}}L.currentRenderPassId=G}}}for(const t of this._internalMeshDataInfo._LODLevels)if(t.mesh&&!t.mesh.isReady(N))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Jz(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(Z){this._instanceDataStorage.overridenInstanceCount=Z}_preActivate(){const Z=this._internalMeshDataInfo,c=this.XZ().getRenderId();return Z._preActivateId===c||(Z._preActivateId=c,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(Z){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=Z),this}_registerInstanceForRenderId(Z,c){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:c,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[c]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=c,this._instanceDataStorage.visibleInstances[c]=new Array),this._instanceDataStorage.visibleInstances[c].push(Z),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.TZ||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let Z,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;Z="object"===typeof c?c:{applySkeleton:c,applyMorph:L};const k=this.zc?this.zc.boundingBias:null;return this.dZ(this._getData(Z,null,t.g.PositionKind),k),this}_createGlobalSubMesh(Z){const c=this.getTotalVertices();if(!c||!this.tc())return null;if(this.ec&&this.ec.length>0){const L=this.tc();if(!L)return null;const k=L.length;let N=!1;if(Z)N=!0;else for(const Z of this.ec){if(Z.indexStart+Z.indexCount>k){N=!0;break}if(Z.verticesStart+Z.verticesCount>c){N=!0;break}}if(!N)return this.ec[0]}return this.releaseSubMeshes(),new O.b(0,0,c,0,this.getTotalIndices()||c,this)}subdivide(Z){if(Z<1)return;const c=this.getTotalIndices();let L=c/Z|0,k=0;for(;L%3!==0;)L++;this.releaseSubMeshes();for(let N=0;N<Z&&!(k>=c);N++)O.b.CreateFromIndices(0,k,N===Z-1?c-k:L,this,void 0,!1),k+=L;this.refreshBoundingInfo(),this.synchronizeInstances()}QZ(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.QZ(Z,c,L,k);else{const k=new E.e;k.set(c,Z);const N=this.XZ();new x.e(x.e.RandomId(),N,k,L,this)}return this}removeVerticesData(Z){this._geometry&&this._geometry.removeVerticesData(Z)}markVerticesDataAsUpdatable(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this.getVertexBuffer(Z);L&&L.isUpdatable()!==c&&this.QZ(Z,this.getVerticesData(Z),c)}setVerticesBuffer(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=x.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(Z,null,c),this}updateVerticesData(Z,c,L,k){return this._geometry?(k?(this.makeGeometryUnique(),this.updateVerticesData(Z,c,L,!1)):this._geometry.updateVerticesData(Z,c,L),this):this}updateMeshPositions(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const L=this.getVerticesData(t.g.PositionKind);if(!L)return this;if(Z(L),this.updateVerticesData(t.g.PositionKind,L,!1,!1),c){const Z=this.tc(),c=this.getVerticesData(t.g.NormalKind);if(!c)return this;E.e.ComputeNormals(L,Z,c),this.updateVerticesData(t.g.NormalKind,c,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const Z=this._geometry,c=this._geometry.i(x.e.RandomId());return Z.releaseForMesh(this,!0),c.WZ(this),this}setIndexBuffer(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=this._geometry;N||(N=new x.e(x.e.RandomId(),this.XZ(),void 0,void 0,this)),N.setIndexBuffer(Z,c,L,k)}setIndices(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(Z,c,L,k);else{const c=new E.e;c.indices=Z;const k=this.XZ();new x.e(x.e.RandomId(),k,c,L,this)}return this}updateIndices(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(Z,c,L),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(Z,c,L){let k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const N=this.XZ().getEngine();let R;if(this._unIndexed)if(this._getRenderingFillMode(L)===w.e.WireFrameFillMode)R=Z._getLinesIndexBuffer(this.tc(),N);else R=null;else switch(this._getRenderingFillMode(L)){case w.e.PointFillMode:R=null;break;case w.e.WireFrameFillMode:R=Z._getLinesIndexBuffer(this.tc(),N);break;default:case w.e.TriangleFillMode:R=this._geometry.getIndexBuffer()}return this._bindDirect(c,R,k)}_bindDirect(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(Z),L&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(Z,c,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(Z,c),this):this}_draw(Z,c,L){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const k=this.XZ().getEngine();return this._unIndexed&&c!==w.e.WireFrameFillMode||c==w.e.PointFillMode?k.drawArraysType(c,Z.verticesStart,Z.verticesCount,this.forcedInstanceCount||L):c==w.e.WireFrameFillMode?k.drawElementsType(c,0,Z._linesIndexCount,this.forcedInstanceCount||L):k.drawElementsType(c,Z.indexStart,Z.indexCount,this.forcedInstanceCount||L),this}registerBeforeRender(Z){return this.onBeforeRenderObservable.add(Z),this}unregisterBeforeRender(Z){return this.onBeforeRenderObservable.removeCallback(Z),this}registerAfterRender(Z){return this.onAfterRenderObservable.add(Z),this}unregisterAfterRender(Z){return this.onAfterRenderObservable.removeCallback(Z),this}_getInstancesRenderList(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(c)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[Z]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[Z]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const L=this.XZ(),k=L._isInIntermediateRendering(),N=k?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,R=this._instanceDataStorage.batchCache;if(R.mustReturn=!1,R.renderSelf[Z]=c||!N&&this.isEnabled()&&this.isVisible,R.visibleInstances[Z]=null,this._instanceDataStorage.visibleInstances&&!c){const c=this._instanceDataStorage.visibleInstances,N=L.getRenderId(),G=k?c.intermediateDefaultRenderId:c.defaultRenderId;R.visibleInstances[Z]=c[N],!R.visibleInstances[Z]&&G&&(R.visibleInstances[Z]=c[G])}return R.hardwareInstancedRendering[Z]=!c&&this._instanceDataStorage.hardwareInstancedRendering&&null!==R.visibleInstances[Z]&&void 0!==R.visibleInstances[Z],this._instanceDataStorage.previousBatch=R,R}_updateInstancedBuffers(Z,c,L,k,N,R){const G=c.visibleInstances[Z._id],V=G?G.length:0,p=this._instanceDataStorage;let z=p.instancesBuffer,i=p.instancesPreviousBuffer,E=0,x=0;const q=c.renderSelf[Z._id],O=!z||L!==p.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!p.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||p.isFrozen&&!O)x=(q?1:0)+V;else{const c=this.getWorldMatrix();if(q&&(this._scene.needsPreviousWorldMatrices&&(p.masterMeshPreviousWorldMatrix?(p.masterMeshPreviousWorldMatrix.copyToArray(p.instancesPreviousData,E),p.masterMeshPreviousWorldMatrix.R(c)):(p.masterMeshPreviousWorldMatrix=c.clone(),p.masterMeshPreviousWorldMatrix.copyToArray(p.instancesPreviousData,E))),c.copyToArray(p.instancesData,E),E+=16,x++),G){var w;if(I.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(w=Z.rZ())&&void 0!==w&&w.needAlphaBlendingForMesh(Z.getRenderingMesh())){const Z=this._scene.activeCamera.globalPosition;for(let c=0;c<G.length;c++){const L=G[c];L._distanceToCamera=J.h.Distance(L.getBoundingInfo().boundingSphere.centerWorld,Z)}G.sort(((Z,c)=>Z._distanceToCamera>c._distanceToCamera?-1:Z._distanceToCamera<c._distanceToCamera?1:0))}for(let Z=0;Z<G.length;Z++){const c=G[Z],L=c.getWorldMatrix();L.copyToArray(p.instancesData,E),this._scene.needsPreviousWorldMatrices&&(c._previousWorldMatrix?(c._previousWorldMatrix.copyToArray(p.instancesPreviousData,E),c._previousWorldMatrix.R(L)):(c._previousWorldMatrix=L.clone(),c._previousWorldMatrix.copyToArray(p.instancesPreviousData,E))),E+=16,x++}}}O?(z&&z.dispose(),i&&i.dispose(),z=new t.e(k,p.instancesData,!0,16,!1,!0),p.instancesBuffer=z,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=z.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=z.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=z.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=z.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(i=new t.e(k,p.instancesPreviousData,!0,16,!1,!0),p.instancesPreviousBuffer=i,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=i.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=i.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=i.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=i.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(z.updateDirectly(p.instancesData,0,x),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||i.updateDirectly(p.instancesPreviousData,0,x)),this._processInstancedBuffers(G,q),R&&void 0!==N&&(this.XZ()._activeIndices.addCount(Z.indexCount*x,!1),k._currentDrawContext&&(k._currentDrawContext.useInstancing=!0),this._bind(Z,R,N),this._draw(Z,N,x)),!this._scene.needsPreviousWorldMatrices||O||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||i.updateDirectly(p.instancesData,0,x)}_renderWithInstances(Z,c,L,k,N){const R=L.visibleInstances[Z._id],G=R?R.length:0,V=this._instanceDataStorage,p=V.instancesBufferSize,J=16*(G+1)*4;for(;V.instancesBufferSize<J;)V.instancesBufferSize*=2;return V.instancesData&&p==V.instancesBufferSize||(V.instancesData=new Float32Array(V.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!V.instancesPreviousData||p!=V.instancesBufferSize)&&(V.instancesPreviousData=new Float32Array(V.instancesBufferSize/4)),this._updateInstancedBuffers(Z,L,p,N,c,k),N.unbindInstanceAttributes(),this}_renderWithThinInstances(Z,c,L,k){var N;const R=(null===(N=this._thinInstanceDataStorage)||void 0===N?void 0:N.instancesCount)??0;this.XZ()._activeIndices.addCount(Z.indexCount*R,!1),k._currentDrawContext&&(k._currentDrawContext.useInstancing=!0),this._bind(Z,L,c),this._draw(Z,c,R),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,R):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),k.unbindInstanceAttributes()}_processInstancedBuffers(Z,c){}_processRendering(Z,c,L,k,N,R,G,V){const p=this.XZ(),J=p.getEngine();if(k=this._getRenderingFillMode(k),R&&c.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(c,k,L,J),this;if(R)this._renderWithInstances(c,k,N,L,J);else{J._currentDrawContext&&(J._currentDrawContext.useInstancing=!1);let L=0;N.renderSelf[c._id]&&(G&&G(!1,Z.getWorldMatrix(),V),L++,this._draw(c,k,this._instanceDataStorage.overridenInstanceCount));const R=N.visibleInstances[c._id];if(R){const Z=R.length;L+=Z;for(let L=0;L<Z;L++){const Z=R[L].getWorldMatrix();G&&G(!0,Z,V),this._draw(c,k)}}p._activeIndices.addCount(c.indexCount*L,!1)}return this}_rebuild(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(Z&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const c in this._userInstancedBuffersStorage.vertexBuffers){const L=this._userInstancedBuffersStorage.vertexBuffers[c];L&&(Z&&L.dispose(),this._userInstancedBuffersStorage.vertexBuffers[c]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(Z)}_freeze(){if(this.ec){for(let Z=0;Z<this.ec.length;Z++)this._getInstancesRenderList(Z);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(Z,c,L,k){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const R=this._scene.getEngine(),G=R.currentRenderPassId;if(void 0!==Z&&(R.currentRenderPassId=Z),k)(!N||N&&k.isInFrustum(this._scene._frustumPlanes))&&this.render(k,!!c,L);else for(let V=0;V<this.ec.length;V++){const Z=this.ec[V];(!N||N&&Z.isInFrustum(this._scene._frustumPlanes))&&this.render(Z,!!c,L)}return void 0!==Z&&(R.currentRenderPassId=G),this}directRender(){if(!this.ec)return this;for(const Z of this.ec)this.render(Z,!1);return this}render(Z,c,L){var k,N,R;const G=this.XZ();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const V=(null===(k=G.activeCameras)||void 0===k?void 0:k.length)??0;if((V>1&&G.activeCamera===G.activeCameras[0]||V<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const p=this._getInstancesRenderList(Z._id,!!L);if(p.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const J=G.getEngine();let z=0,i=null;this.ignoreCameraMaxZ&&G.activeCamera&&!G._isInIntermediateRendering()&&(z=G.activeCamera.maxZ,i=G.activeCamera,G.activeCamera.maxZ=0,G.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const t=Z.getRenderingMesh(),E=p.hardwareInstancedRendering[Z._id]||t.hasThinInstances||!!this._userInstancedBuffersStorage&&!Z.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,x=this._instanceDataStorage,q=Z.rZ();if(!q)return i&&(i.maxZ=z,G.updateTransformMatrix(!0)),this;if(x.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===q){if(q._storeEffectOnSubMeshes&&(null===(N=Z._drawWrapper)||void 0===N||!N._wasPreviouslyReady)||!q._storeEffectOnSubMeshes&&!q._getDrawWrapper()._wasPreviouslyReady)return i&&(i.maxZ=z,G.updateTransformMatrix(!0)),this}else{if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,Z,E))return i&&(i.maxZ=z,G.updateTransformMatrix(!0)),this}else if(!q.isReady(this,E))return i&&(i.maxZ=z,G.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=q}let O;c&&J.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),O=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?Z._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const M=(null===(R=O)||void 0===R?void 0:R.effect)??null;for(const w of G._beforeRenderingMeshStage)w.action(this,Z,p,M);if(!O||!M)return i&&(i.maxZ=z,G.updateTransformMatrix(!0)),this;const P=L||this;let j;if(x.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ec&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)j=x.sideOrientation;else{const Z=P._getWorldMatrixDeterminant();j=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),Z<0&&(j=j===w.e.ClockWiseSideOrientation?w.e.CounterClockWiseSideOrientation:w.e.ClockWiseSideOrientation),x.sideOrientation=j}const o=this._internalMeshDataInfo._effectiveMaterial._preBind(O,j);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&J.setDepthWrite(!0);const u=this._internalMeshDataInfo._effectiveMaterial,X=u.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),E||this._bind(Z,M,X,!1);const h=P.getWorldMatrix();u._storeEffectOnSubMeshes?u.bindForSubMesh(h,this,Z):u.bind(h,this),!u.Ec&&u.separateCullingPass&&(J.setState(!0,u.zOffset,!1,!o,u.cullBackFaces,u.stencil,u.zOffsetUnits),this._processRendering(this,Z,M,X,p,E,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),J.setState(!0,u.zOffset,!1,o,u.cullBackFaces,u.stencil,u.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(Z)),this._processRendering(this,Z,M,X,p,E,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const w of G._afterRenderingMeshStage)w.action(this,Z,p,M);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),i&&(i.maxZ=z,G.updateTransformMatrix(!0)),2!==G.performancePriority||x.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(t.g.MatricesWeightsKind)&&(this.isVerticesDataPresent(t.g.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const Z=this.getVerticesData(t.g.MatricesWeightsKind),c=Z.length;for(let L=0;L<c;L+=4){const c=Z[L]+Z[L+1]+Z[L+2]+Z[L+3];if(0===c)Z[L]=1;else{const k=1/c;Z[L]*=k,Z[L+1]*=k,Z[L+2]*=k,Z[L+3]*=k}}this.QZ(t.g.MatricesWeightsKind,Z)}_normalizeSkinWeightsAndExtra(){const Z=this.getVerticesData(t.g.MatricesWeightsExtraKind),c=this.getVerticesData(t.g.MatricesWeightsKind),L=c.length;for(let k=0;k<L;k+=4){let L=c[k]+c[k+1]+c[k+2]+c[k+3];if(L+=Z[k]+Z[k+1]+Z[k+2]+Z[k+3],0===L)c[k]=1;else{const N=1/L;c[k]*=N,c[k+1]*=N,c[k+2]*=N,c[k+3]*=N,Z[k]*=N,Z[k+1]*=N,Z[k+2]*=N,Z[k+3]*=N}}this.QZ(t.g.MatricesWeightsKind,c),this.QZ(t.g.MatricesWeightsKind,Z)}validateSkinning(){const Z=this.getVerticesData(t.g.MatricesWeightsExtraKind),c=this.getVerticesData(t.g.MatricesWeightsKind);if(null===c||null==this.skeleton)return{skinned:!1,valid:!0,bx:"not skinned"};const L=c.length;let k=0,N=0,R=0,G=0;const V=null===Z?4:8,p=[];for(let t=0;t<=V;t++)p[t]=0;for(let t=0;t<L;t+=4){let L=c[t],J=L,z=0===J?0:1;for(let N=1;N<V;N++){const R=N<4?c[t+N]:Z[t+N-4];R>L&&k++,0!==R&&z++,J+=R,L=R}if(p[z]++,z>R&&(R=z),0===J)N++;else{const L=1/J;let k=0;for(let N=0;N<V;N++)k+=N<4?Math.abs(c[t+N]-c[t+N]*L):Math.abs(Z[t+N-4]-Z[t+N-4]*L);k>.001&&G++}}const J=this.skeleton.bones.length,z=this.getVerticesData(t.g.MatricesIndicesKind),i=this.getVerticesData(t.g.MatricesIndicesExtraKind);let E=0;for(let t=0;t<L;t+=4)for(let Z=0;Z<V;Z++){const c=Z<4?z[t+Z]:i[t+Z-4];(c>=J||c<0)&&E++}return{skinned:!0,valid:0===N&&0===G&&0===E,bx:"Number of Weights = "+L/4+"\nMaximum influences = "+R+"\nMissing Weights = "+N+"\nNot Sorted = "+k+"\nNot Normalized = "+G+"\nWeightCounts = ["+p+"]\nNumber of bones = "+J+"\nBad Bone Indices = "+E}}_checkDelayState(){const Z=this.XZ();return this._geometry?this._geometry.load(Z):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(Z)),this}_queueLoad(Z){Z.addPendingData(this);const c=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return N.c.LoadFile(this.delayLoadingFile,(c=>{c instanceof ArrayBuffer?this._delayLoadingFunction(c,this):this._delayLoadingFunction(JSON.parse(c),this);for(const Z of this.instances)Z.refreshBoundingInfo(),Z._syncSubMeshes();this.delayLoadState=1,Z.removePendingData(this)}),(()=>{}),Z.offlineProvider,c),this}isInFrustum(Z){return 2!==this.delayLoadState&&(!!super.isInFrustum(Z)&&(this._checkDelayState(),!0))}setMaterialById(Z){const c=this.XZ().materials;let L;for(L=c.length-1;L>-1;L--)if(c[L].id===Z)return this.material=c[L],this;const k=this.XZ().multiMaterials;for(L=k.length-1;L>-1;L--)if(k[L].id===Z)return this.material=k[L],this;return this}getAnimatables(){const Z=[];return this.material&&Z.push(this.material),this.skeleton&&Z.push(this.skeleton),Z}bakeTransformIntoVertices(Z){if(!this.isVerticesDataPresent(t.g.PositionKind))return this;const c=this.ec.splice(0);this._resetPointsArrayCache();let L=this.getVerticesData(t.g.PositionKind);const k=J.h.Zero();let N;for(N=0;N<L.length;N+=3)J.h.TransformCoordinatesFromFloatsToRef(L[N],L[N+1],L[N+2],Z,k).toArray(L,N);if(this.QZ(t.g.PositionKind,L,this.getVertexBuffer(t.g.PositionKind).isUpdatable()),this.isVerticesDataPresent(t.g.NormalKind)){for(L=this.getVerticesData(t.g.NormalKind),N=0;N<L.length;N+=3)J.h.TransformNormalFromFloatsToRef(L[N],L[N+1],L[N+2],Z,k).normalize().toArray(L,N);this.QZ(t.g.NormalKind,L,this.getVertexBuffer(t.g.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(t.g.TangentKind)){for(L=this.getVerticesData(t.g.TangentKind),N=0;N<L.length;N+=4)J.h.TransformNormalFromFloatsToRef(L[N],L[N+1],L[N+2],Z,k).normalize().toArray(L,N);this.QZ(t.g.TangentKind,L,this.getVertexBuffer(t.g.TangentKind).isUpdatable())}return Z.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.ec=c,this}bakeCurrentTransformIntoVertices(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Jc(!0)),this.resetLocalMatrix(Z),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(c&&void 0===c._addToSceneRootNodes){const L=c;return T.source=this,T.doNotCloneChildren=L.doNotCloneChildren,T.clonePhysicsImpostor=L.clonePhysicsImpostor,T.cloneThinInstances=L.cloneThinInstances,new I(Z,this.XZ(),T)}return new I(Z,this.XZ(),c,this,L,k)}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const L=this._internalMeshDataInfo;if(L._onBeforeDrawObservable&&L._onBeforeDrawObservable.clear(),L._onBeforeBindObservable&&L._onBeforeBindObservable.clear(),L._onBeforeRenderObservable&&L._onBeforeRenderObservable.clear(),L._onAfterRenderObservable&&L._onAfterRenderObservable.clear(),L._onBetweenPassObservable&&L._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(L.meshMap)for(const Z in L.meshMap){const c=L.meshMap[Z];c&&(c._internalMeshDataInfo._source=null,L.meshMap[Z]=void 0)}L._source&&L._source._internalMeshDataInfo.meshMap&&(L._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const Z=this.XZ().meshes;for(const c of Z){const Z=c;Z._internalMeshDataInfo&&Z._internalMeshDataInfo._source&&Z._internalMeshDataInfo._source===this&&(Z._internalMeshDataInfo._source=null)}}L._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(Z,c)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(Z,c,L,k,R,G){let V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;const J=this.XZ();return N.c.LoadImage(Z,(Z=>{const N=Z.width,p=Z.height,J=this.getEngine().createCanvas(N,p).getContext("2d");J.drawImage(Z,0,0);const z=J.getImageData(0,0,N,p).data;this.applyDisplacementMapFromBuffer(z,N,p,c,L,R,G,V),k&&k(this)}),p||(()=>{}),J.offlineProvider),this}applyDisplacementMapFromBuffer(Z,c,L,k,N,R,G){let V=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(t.g.PositionKind)||!this.isVerticesDataPresent(t.g.NormalKind)||!this.isVerticesDataPresent(t.g.UVKind))return o.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const p=this.getVerticesData(t.g.PositionKind,!0,!0),z=this.getVerticesData(t.g.NormalKind),i=this.getVerticesData(t.g.UVKind);let x=J.h.Zero();const q=J.h.Zero(),O=J.f.Zero();R=R||J.f.Zero(),G=G||new J.f(1,1);for(let t=0;t<p.length;t+=3){J.h.FromArrayToRef(p,t,x),J.h.FromArrayToRef(z,t,q),J.f.FromArrayToRef(i,t/3*2,O);const V=4*((Math.abs(O.x*G.x+R.x%1)*(c-1)%c|0)+(Math.abs(O.y*G.y+R.y%1)*(L-1)%L|0)*c),E=.3*(Z[V]/255)+.59*(Z[V+1]/255)+.11*(Z[V+2]/255);q.normalize(),q.scaleInPlace(k+(N-k)*E),x=x.add(q),x.toArray(p,t)}return E.e.ComputeNormals(p,this.tc(),z),V?(this.QZ(t.g.PositionKind,p),this.QZ(t.g.NormalKind,z),this.QZ(t.g.UVKind,i)):(this.updateVerticesData(t.g.PositionKind,p),this.updateVerticesData(t.g.NormalKind,z)),this}_getFlattenedNormals(Z,c){const L=new Float32Array(3*Z.length);let k=0;const N=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let R=0;R<Z.length;R+=3){const G=J.h.oc(c,3*Z[R]),V=J.h.oc(c,3*Z[R+1]),p=J.h.oc(c,3*Z[R+2]),z=G.yL(V),i=p.yL(V),t=J.h.Normalize(J.h.Cross(z,i));N&&t.scaleInPlace(-1);for(let Z=0;Z<3;Z++)L[k++]=t.x,L[k++]=t.y,L[k++]=t.z}return L}_convertToUnIndexedMesh(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.getVerticesDataKinds().filter((Z=>{var c;return!(null!==(c=this.getVertexBuffer(Z))&&void 0!==c&&c.getIsInstanced())})),L=this.tc(),k={},N=(Z,c)=>{const k=new Float32Array(L.length*c);let N=0;for(let R=0;R<L.length;R++)for(let G=0;G<c;G++)k[N++]=Z[L[R]*c+G];return k},R=this.getBoundingInfo(),G=this.zc?this.ec.slice(0):[];for(const V of c)k[V]=this.getVerticesData(V);for(const V of c){const c=this.getVertexBuffer(V),R=c.getSize();if(Z&&V===t.g.NormalKind){const Z=this._getFlattenedNormals(L,k[t.g.PositionKind]);this.QZ(t.g.NormalKind,Z,c.isUpdatable(),R)}else this.QZ(V,N(k[V],R),c.isUpdatable(),R)}if(this.morphTargetManager){for(let c=0;c<this.morphTargetManager.numTargets;c++){const k=this.morphTargetManager.getTarget(c),R=k.getPositions();k.setPositions(N(R,3));const G=k.getNormals();G&&k.setNormals(Z?this._getFlattenedNormals(L,R):N(G,3));const V=k.getTangents();V&&k.setTangents(N(V,3));const p=k.getUVs();p&&k.setUVs(N(p,2));const J=k.getColors();J&&k.setColors(N(J,4))}this.morphTargetManager.synchronize()}for(let V=0;V<L.length;V++)L[V]=V;this.setIndices(L),this._unIndexed=!0,this.releaseSubMeshes();for(const V of G){const Z=V.getBoundingInfo();O.b.AddToMesh(V.materialIndex,V.indexStart,V.indexCount,V.indexStart,V.indexCount,this).setBoundingInfo(Z)}return this.setBoundingInfo(R),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=E.e.ExtractFromMesh(this);let L;if(Z&&this.isVerticesDataPresent(t.g.NormalKind)&&c.DZ){for(L=0;L<c.DZ.length;L++)c.DZ[L]*=-1;this.QZ(t.g.NormalKind,c.DZ,this.isVertexBufferUpdatable(t.g.NormalKind))}if(c.indices){let Z;for(L=0;L<c.indices.length;L+=3)Z=c.indices[L+1],c.indices[L+1]=c.indices[L+2],c.indices[L+2]=Z;this.setIndices(c.indices,null,this.isVertexBufferUpdatable(t.g.PositionKind),!0)}return this}increaseVertices(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const c=E.e.ExtractFromMesh(this),L=c.indices&&!Array.isArray(c.indices)&&Array.from?Array.from(c.indices):c.indices,k=c.BZ&&!Array.isArray(c.BZ)&&Array.from?Array.from(c.BZ):c.BZ,N=c.HZ&&!Array.isArray(c.HZ)&&Array.from?Array.from(c.HZ):c.HZ,R=c.DZ&&!Array.isArray(c.DZ)&&Array.from?Array.from(c.DZ):c.DZ;if(L&&k){c.indices=L,c.BZ=k,N&&(c.HZ=N),R&&(c.DZ=R);const G=Z+1,V=[];for(let Z=0;Z<G+1;Z++)V[Z]=[];let p,z;const i=new J.h(0,0,0),E=new J.h(0,0,0),x=new J.f(0,0),q=[],O=[],w=[];let M,P,j,o=k.length;N&&(P=N.length),R&&(j=R.length);for(let Z=0;Z<L.length;Z+=3){O[0]=L[Z],O[1]=L[Z+1],O[2]=L[Z+2];for(let Z=0;Z<3;Z++)if(p=O[Z],z=O[(Z+1)%3],void 0===w[p]&&void 0===w[z]?(w[p]=[],w[z]=[]):(void 0===w[p]&&(w[p]=[]),void 0===w[z]&&(w[z]=[])),void 0===w[p][z]&&void 0===w[z][p]){w[p][z]=[],i.x=(k[3*z]-k[3*p])/G,i.y=(k[3*z+1]-k[3*p+1])/G,i.z=(k[3*z+2]-k[3*p+2])/G,R&&(E.x=(R[3*z]-R[3*p])/G,E.y=(R[3*z+1]-R[3*p+1])/G,E.z=(R[3*z+2]-R[3*p+2])/G),N&&(x.x=(N[2*z]-N[2*p])/G,x.y=(N[2*z+1]-N[2*p+1])/G),w[p][z].push(p);for(let Z=1;Z<G;Z++)w[p][z].push(k.length/3),k[o++]=k[3*p]+Z*i.x,k[o++]=k[3*p+1]+Z*i.y,k[o++]=k[3*p+2]+Z*i.z,R&&(R[j++]=R[3*p]+Z*E.x,R[j++]=R[3*p+1]+Z*E.y,R[j++]=R[3*p+2]+Z*E.z),N&&(N[P++]=N[2*p]+Z*x.x,N[P++]=N[2*p+1]+Z*x.y);w[p][z].push(z),w[z][p]=[],M=w[p][z].length;for(let Z=0;Z<M;Z++)w[z][p][Z]=w[p][z][M-1-Z]}V[0][0]=L[Z],V[1][0]=w[L[Z]][L[Z+1]][1],V[1][1]=w[L[Z]][L[Z+2]][1];for(let c=2;c<G;c++){V[c][0]=w[L[Z]][L[Z+1]][c],V[c][c]=w[L[Z]][L[Z+2]][c],i.x=(k[3*V[c][c]]-k[3*V[c][0]])/c,i.y=(k[3*V[c][c]+1]-k[3*V[c][0]+1])/c,i.z=(k[3*V[c][c]+2]-k[3*V[c][0]+2])/c,R&&(E.x=(R[3*V[c][c]]-R[3*V[c][0]])/c,E.y=(R[3*V[c][c]+1]-R[3*V[c][0]+1])/c,E.z=(R[3*V[c][c]+2]-R[3*V[c][0]+2])/c),N&&(x.x=(N[2*V[c][c]]-N[2*V[c][0]])/c,x.y=(N[2*V[c][c]+1]-N[2*V[c][0]+1])/c);for(let Z=1;Z<c;Z++)V[c][Z]=k.length/3,k[o++]=k[3*V[c][0]]+Z*i.x,k[o++]=k[3*V[c][0]+1]+Z*i.y,k[o++]=k[3*V[c][0]+2]+Z*i.z,R&&(R[j++]=R[3*V[c][0]]+Z*E.x,R[j++]=R[3*V[c][0]+1]+Z*E.y,R[j++]=R[3*V[c][0]+2]+Z*E.z),N&&(N[P++]=N[2*V[c][0]]+Z*x.x,N[P++]=N[2*V[c][0]+1]+Z*x.y)}V[G]=w[L[Z+1]][L[Z+2]],q.push(V[0][0],V[1][0],V[1][1]);for(let Z=1;Z<G;Z++){let c;for(c=0;c<Z;c++)q.push(V[Z][c],V[Z+1][c],V[Z+1][c+1]),q.push(V[Z][c],V[Z+1][c+1],V[Z][c+1]);q.push(V[Z][c],V[Z+1][c],V[Z+1][c+1])}}c.indices=q,c.WZ(this,this.isVertexBufferUpdatable(t.g.PositionKind))}else o.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const Z=E.e.ExtractFromMesh(this),c=Z.HZ,L=Z.indices,k=Z.BZ,N=Z.eZ,R=Z.matricesIndices,G=Z.matricesWeights,V=Z.matricesIndicesExtra,p=Z.matricesWeightsExtra;if(void 0===L||void 0===k||null===L||null===k)o.e.Warn("VertexData contains empty entries");else{const J=[],z=[],i=[],x=[],q=[],O=[],w=[],M=[];let P=[],j=0;const o={};let u,X;for(let Z=0;Z<L.length;Z+=3){X=[L[Z],L[Z+1],L[Z+2]],P=[];for(let Z=0;Z<3;Z++){P[Z]="";for(let c=0;c<3;c++)Math.abs(k[3*X[Z]+c])<1e-8&&(k[3*X[Z]+c]=0),P[Z]+=k[3*X[Z]+c]+"|"}if(P[0]!=P[1]&&P[0]!=P[2]&&P[1]!=P[2])for(let Z=0;Z<3;Z++){if(u=o[P[Z]],void 0===u){o[P[Z]]=j,u=j++;for(let c=0;c<3;c++)J.push(k[3*X[Z]+c]);if(null!==N&&void 0!==N)for(let c=0;c<4;c++)x.push(N[4*X[Z]+c]);if(null!==c&&void 0!==c)for(let L=0;L<2;L++)i.push(c[2*X[Z]+L]);if(null!==R&&void 0!==R)for(let c=0;c<4;c++)q.push(R[4*X[Z]+c]);if(null!==G&&void 0!==G)for(let c=0;c<4;c++)O.push(G[4*X[Z]+c]);if(null!==V&&void 0!==V)for(let c=0;c<4;c++)w.push(V[4*X[Z]+c]);if(null!==p&&void 0!==p)for(let c=0;c<4;c++)M.push(p[4*X[Z]+c])}z.push(u)}}const h=[];E.e.ComputeNormals(J,z,h),Z.BZ=J,Z.indices=z,Z.DZ=h,null!==c&&void 0!==c&&(Z.HZ=i),null!==N&&void 0!==N&&(Z.eZ=x),null!==R&&void 0!==R&&(Z.matricesIndices=q),null!==G&&void 0!==G&&(Z.matricesWeights=O),null!==V&&void 0!==V&&(Z.matricesIndicesExtra=w),null!==G&&void 0!==G&&(Z.matricesWeightsExtra=M),Z.WZ(this,this.isVertexBufferUpdatable(t.g.PositionKind))}}static _instancedMeshFactory(Z,c){throw(0,X.e)("InstancedMesh")}static _PhysicsImpostorParser(Z,c,L){throw(0,X.e)("PhysicsImpostor")}createInstance(Z){const c=I._instancedMeshFactory(Z,this);return c.parent=this.parent,c}synchronizeInstances(){for(let Z=0;Z<this.instances.length;Z++){this.instances[Z]._syncSubMeshes()}return this}optimizeIndices(Z){const c=this.tc(),L=this.getVerticesData(t.g.PositionKind);if(!L||!c)return this;const k=[];for(let N=0;N<L.length;N+=3)k.push(J.h.oc(L,N));const R=[];return N.b.SyncAsyncForLoop(k.length,40,(Z=>{const c=k.length-1-Z,L=k[c];for(let N=0;N<c;++N){const Z=k[N];if(L.equals(Z)){R[c]=N;break}}}),(()=>{for(let Z=0;Z<c.length;++Z)c[Z]=R[c[Z]]||c[Z];const L=this.ec.slice(0);this.setIndices(c),this.ec=L,Z&&Z(this)})),this}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.name=this.name,Z.id=this.id,Z.uniqueId=this.uniqueId,Z.type=this.getClassName(),G.b&&G.b.HasTags(this)&&(Z.tags=G.b.GetTags(this)),Z.position=this.position.xc(),this.rotationQuaternion?Z.rotationQuaternion=this.rotationQuaternion.xc():this.rotation&&(Z.rotation=this.rotation.xc()),Z.Pc=this.Pc.xc(),this._postMultiplyPivotMatrix?Z.pivotMatrix=this.getPivotMatrix().xc():Z.localMatrix=this.getPivotMatrix().xc(),Z.isEnabled=this.isEnabled(!1),Z.isVisible=this.isVisible,Z.infiniteDistance=this.infiniteDistance,Z.pickable=this.ep,Z.receiveShadows=this.receiveShadows,Z.billboardMode=this.billboardMode,Z.visibility=this.visibility,Z.BV=this.BV,Z.checkCollisions=this.checkCollisions,Z.ellipsoid=this.ellipsoid.xc(),Z.ellipsoidOffset=this.ellipsoidOffset.xc(),Z.TZ=this.TZ,Z.isBlocker=this.isBlocker,Z.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(Z),Z.isUnIndexed=this.isUnIndexed;const c=this._geometry;if(c&&this.ec){Z.geometryUniqueId=c.uniqueId,Z.geometryId=c.id,Z.ec=[];for(let c=0;c<this.ec.length;c++){const L=this.ec[c];Z.ec.push({materialIndex:L.materialIndex,verticesStart:L.verticesStart,verticesCount:L.verticesCount,indexStart:L.indexStart,indexCount:L.indexCount})}}if(this.material?this.material.doNotSerialize||(Z.materialUniqueId=this.material.uniqueId,Z.materialId=this.material.id):(this.material=null,Z.materialUniqueId=this._scene.defaultMaterial.uniqueId,Z.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(Z.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(Z.skeletonId=this.skeleton.id,Z.numBoneInfluencers=this.numBoneInfluencers),this.XZ()._getComponent(h.c.NAME_PHYSICSENGINE)){const c=this.getPhysicsImpostor();c&&(Z.physicsMass=c.getParam("IN"),Z.physicsFriction=c.getParam("friction"),Z.physicsRestitution=c.getParam("IN"),Z.physicsImpostor=c.type)}this.metadata&&(Z.metadata=this.metadata),Z.instances=[];for(let L=0;L<this.instances.length;L++){const c=this.instances[L];if(c.doNotSerialize)continue;const k={name:c.name,id:c.id,isEnabled:c.isEnabled(!1),isVisible:c.isVisible,ep:c.ep,checkCollisions:c.checkCollisions,position:c.position.xc(),Pc:c.Pc.xc()};if(c.parent&&c.parent._serializeAsParent(k),c.rotationQuaternion?k.rotationQuaternion=c.rotationQuaternion.xc():c.rotation&&(k.rotation=c.rotation.xc()),this.XZ()._getComponent(h.c.NAME_PHYSICSENGINE)){const Z=c.getPhysicsImpostor();Z&&(k.physicsMass=Z.getParam("IN"),k.physicsFriction=Z.getParam("friction"),k.physicsRestitution=Z.getParam("IN"),k.physicsImpostor=Z.type)}c.metadata&&(k.metadata=c.metadata),c.actionManager&&(k.actions=c.actionManager.serialize(c.name)),Z.instances.push(k),j.e.AppendSerializedAnimations(c,k),k.ranges=c.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(Z.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const c={data:{},sizes:{},strides:{}};for(const Z in this._userThinInstanceBuffersStorage.data)c.data[Z]=Array.from(this._userThinInstanceBuffersStorage.data[Z]),c.sizes[Z]=this._userThinInstanceBuffersStorage.sizes[Z],c.strides[Z]=this._userThinInstanceBuffersStorage.strides[Z];Z.thinInstances.userThinInstance=c}return j.e.AppendSerializedAnimations(this,Z),Z.ranges=this.serializeAnimationRanges(),Z.layerMask=this.layerMask,Z.alphaIndex=this.alphaIndex,Z.hasVertexAlpha=this.hasVertexAlpha,Z.overlayAlpha=this.overlayAlpha,Z.overlayColor=this.overlayColor.xc(),Z.renderOverlay=this.renderOverlay,Z.applyFog=this.applyFog,this.actionManager&&(Z.actions=this.actionManager.serialize(this.name)),Z}_syncGeometryWithMorphTargetManager(){if(!this.zc)return;this._markSubMeshesAsAttributesDirty();const Z=this._internalAbstractMeshDataInfo._morphTargetManager;if(Z&&Z.vertexCount){if(Z.vertexCount!==this.getTotalVertices())return o.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(Z.isUsingTextureForTargets)return;for(let c=0;c<Z.numInfluencers;c++){const L=Z.getActiveTarget(c),k=L.getPositions();if(!k)return void o.e.Error("Invalid morph target. Target must have positions.");this.zc.QZ(t.g.PositionKind+c,k,!1,3);const N=L.getNormals();N&&this.zc.QZ(t.g.NormalKind+c,N,!1,3);const R=L.getTangents();R&&this.zc.QZ(t.g.TangentKind+c,R,!1,3);const G=L.getUVs();G&&this.zc.QZ(t.g.UVKind+"_"+c,G,!1,2);const V=L.getUV2s();V&&this.zc.QZ(t.g.UV2Kind+"_"+c,V,!1,2);const p=L.getColors();p&&this.zc.QZ(t.g.ColorKind+c,p,!1,4)}}else{let Z=0;for(;this.zc.isVerticesDataPresent(t.g.PositionKind+Z);)this.zc.removeVerticesData(t.g.PositionKind+Z),this.zc.isVerticesDataPresent(t.g.NormalKind+Z)&&this.zc.removeVerticesData(t.g.NormalKind+Z),this.zc.isVerticesDataPresent(t.g.TangentKind+Z)&&this.zc.removeVerticesData(t.g.TangentKind+Z),this.zc.isVerticesDataPresent(t.g.UVKind+Z)&&this.zc.removeVerticesData(t.g.UVKind+"_"+Z),this.zc.isVerticesDataPresent(t.g.UV2Kind+Z)&&this.zc.removeVerticesData(t.g.UV2Kind+"_"+Z),this.zc.isVerticesDataPresent(t.g.ColorKind+Z)&&this.zc.removeVerticesData(t.g.ColorKind+Z),Z++}}static Parse(Z,c,L){let k;if(k=Z.type&&"LinesMesh"===Z.type?I._LinesMeshParser(Z,c):Z.type&&"GroundMesh"===Z.type?I._GroundMeshParser(Z,c):Z.type&&"GoldbergMesh"===Z.type?I._GoldbergMeshParser(Z,c):Z.type&&"GreasedLineMesh"===Z.type?I._GreasedLineMeshParser(Z,c):Z.type&&"TrailMesh"===Z.type?I._TrailMeshParser(Z,c):new I(Z.name,c),k.id=Z.id,k._waitingParsedUniqueId=Z.uniqueId,G.b&&G.b.AddTagsTo(k,Z.tags),k.position=J.h.oc(Z.position),void 0!==Z.metadata&&(k.metadata=Z.metadata),Z.rotationQuaternion?k.rotationQuaternion=J.c.oc(Z.rotationQuaternion):Z.rotation&&(k.rotation=J.h.oc(Z.rotation)),k.Pc=J.h.oc(Z.Pc),Z.localMatrix?k.setPreTransformMatrix(J.b.oc(Z.localMatrix)):Z.pivotMatrix&&k.setPivotMatrix(J.b.oc(Z.pivotMatrix)),k.lV(Z.isEnabled),k.isVisible=Z.isVisible,k.infiniteDistance=Z.infiniteDistance,k.BV=!!Z.BV,k.showBoundingBox=Z.showBoundingBox,k.showSubMeshesBoundingBox=Z.showSubMeshesBoundingBox,void 0!==Z.applyFog&&(k.applyFog=Z.applyFog),void 0!==Z.pickable&&(k.ep=Z.pickable),void 0!==Z.alphaIndex&&(k.alphaIndex=Z.alphaIndex),k.receiveShadows=Z.receiveShadows,void 0!==Z.billboardMode&&(k.billboardMode=Z.billboardMode),void 0!==Z.visibility&&(k.visibility=Z.visibility),k.checkCollisions=Z.checkCollisions,k.TZ=!!Z.TZ,Z.ellipsoid&&(k.ellipsoid=J.h.oc(Z.ellipsoid)),Z.ellipsoidOffset&&(k.ellipsoidOffset=J.h.oc(Z.ellipsoidOffset)),null!=Z.overrideMaterialSideOrientation&&(k.sideOrientation=Z.overrideMaterialSideOrientation),void 0!==Z.sideOrientation&&(k.sideOrientation=Z.sideOrientation),void 0!==Z.isBlocker&&(k.isBlocker=Z.isBlocker),k._shouldGenerateFlatShading=Z.useFlatShading,Z.hV&&(k._waitingData.hV=Z.hV),void 0!==Z.parentId&&(k._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(k._waitingParentInstanceIndex=Z.parentInstanceIndex),void 0!==Z.actions&&(k._waitingData.actions=Z.actions),void 0!==Z.overlayAlpha&&(k.overlayAlpha=Z.overlayAlpha),void 0!==Z.overlayColor&&(k.overlayColor=z.d.oc(Z.overlayColor)),void 0!==Z.renderOverlay&&(k.renderOverlay=Z.renderOverlay),k.isUnIndexed=!!Z.isUnIndexed,k.hasVertexAlpha=Z.hasVertexAlpha,Z.delayLoadingFile?(k.delayLoadState=4,k.delayLoadingFile=L+Z.delayLoadingFile,k.buildBoundingInfo(J.h.oc(Z.boundingBoxMinimum),J.h.oc(Z.boundingBoxMaximum)),Z._binaryInfo&&(k._binaryInfo=Z._binaryInfo),k._delayInfo=[],Z.hasUVs&&k._delayInfo.push(t.g.UVKind),Z.hasUVs2&&k._delayInfo.push(t.g.UV2Kind),Z.hasUVs3&&k._delayInfo.push(t.g.UV3Kind),Z.hasUVs4&&k._delayInfo.push(t.g.UV4Kind),Z.hasUVs5&&k._delayInfo.push(t.g.UV5Kind),Z.hasUVs6&&k._delayInfo.push(t.g.UV6Kind),Z.hasColors&&k._delayInfo.push(t.g.ColorKind),Z.hasMatricesIndices&&k._delayInfo.push(t.g.MatricesIndicesKind),Z.hasMatricesWeights&&k._delayInfo.push(t.g.MatricesWeightsKind),k._delayLoadingFunction=x.e._ImportGeometry,P.e.ForceFullSceneLoadingForIncremental&&k._checkDelayState()):x.e._ImportGeometry(Z,k),Z.materialUniqueId?k._waitingMaterialId=Z.materialUniqueId:Z.materialId&&(k._waitingMaterialId=Z.materialId),Z.morphTargetManagerId>-1&&(k._waitingMorphTargetManagerId=Z.morphTargetManagerId),void 0!==Z.skeletonId&&null!==Z.skeletonId&&(k.skeleton=c.getLastSkeletonById(Z.skeletonId),Z.numBoneInfluencers&&(k.numBoneInfluencers=Z.numBoneInfluencers)),Z.animations){for(let c=0;c<Z.animations.length;c++){const L=Z.animations[c],N=(0,u.d)("BABYLON.Animation");N&&k.animations.push(N.Parse(L))}i.b.ParseAnimationRanges(k,Z,c)}if(Z.autoAnimate&&c.beginAnimation(k,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),Z.layerMask&&!isNaN(Z.layerMask)?k.layerMask=Math.abs(parseInt(Z.layerMask)):k.layerMask=268435455,Z.physicsImpostor&&(k.physicsImpostor=I._PhysicsImpostorParser(c,k,Z)),Z.lodMeshIds&&(k._waitingData.lods={ids:Z.lodMeshIds,distances:Z.lodDistances?Z.lodDistances:null,coverages:Z.lodCoverages?Z.lodCoverages:null}),Z.instances)for(let N=0;N<Z.instances.length;N++){const L=Z.instances[N],R=k.createInstance(L.name);if(L.id&&(R.id=L.id),G.b&&(L.tags?G.b.AddTagsTo(R,L.tags):G.b.AddTagsTo(R,Z.tags)),R.position=J.h.oc(L.position),void 0!==L.metadata&&(R.metadata=L.metadata),void 0!==L.parentId&&(R._waitingParentId=L.parentId),void 0!==L.parentInstanceIndex&&(R._waitingParentInstanceIndex=L.parentInstanceIndex),void 0!==L.isEnabled&&null!==L.isEnabled&&R.lV(L.isEnabled),void 0!==L.isVisible&&null!==L.isVisible&&(R.isVisible=L.isVisible),void 0!==L.ep&&null!==L.ep&&(R.ep=L.ep),L.rotationQuaternion?R.rotationQuaternion=J.c.oc(L.rotationQuaternion):L.rotation&&(R.rotation=J.h.oc(L.rotation)),R.Pc=J.h.oc(L.Pc),void 0!=L.checkCollisions&&null!=L.checkCollisions&&(R.checkCollisions=L.checkCollisions),void 0!=L.pickable&&null!=L.pickable&&(R.ep=L.pickable),void 0!=L.showBoundingBox&&null!=L.showBoundingBox&&(R.showBoundingBox=L.showBoundingBox),void 0!=L.showSubMeshesBoundingBox&&null!=L.showSubMeshesBoundingBox&&(R.showSubMeshesBoundingBox=L.showSubMeshesBoundingBox),void 0!=L.alphaIndex&&null!=L.showSubMeshesBoundingBox&&(R.alphaIndex=L.alphaIndex),L.physicsImpostor&&(R.physicsImpostor=I._PhysicsImpostorParser(c,R,L)),void 0!==L.actions&&(R._waitingData.actions=L.actions),L.animations){for(let Z=0;Z<L.animations.length;Z++){const c=L.animations[Z],k=(0,u.d)("BABYLON.Animation");k&&R.animations.push(k.Parse(c))}i.b.ParseAnimationRanges(R,L,c),L.autoAnimate&&c.beginAnimation(R,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1)}}if(Z.thinInstances){const c=Z.thinInstances;if(k.thinInstanceEnablePicking=!!c.enablePicking,c.matrixData?(k.ki("matrix",new Float32Array(c.matrixData),16,!1),k._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,k._thinInstanceDataStorage.instancesCount=c.instancesCount):k._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,Z.thinInstances.userThinInstance){const c=Z.thinInstances.userThinInstance;for(const Z in c.data)k.ki(Z,new Float32Array(c.data[Z]),c.strides[Z],!1),k._userThinInstanceBuffersStorage.sizes[Z]=c.sizes[Z]}}return k}setPositionsForCPUSkinning(){const Z=this._internalMeshDataInfo;if(!Z._sourcePositions){const c=this.getVerticesData(t.g.PositionKind);if(!c)return Z._sourcePositions;Z._sourcePositions=new Float32Array(c),this.isVertexBufferUpdatable(t.g.PositionKind)||this.QZ(t.g.PositionKind,c,!0)}return Z._sourcePositions}setNormalsForCPUSkinning(){const Z=this._internalMeshDataInfo;if(!Z._sourceNormals){const c=this.getVerticesData(t.g.NormalKind);if(!c)return Z._sourceNormals;Z._sourceNormals=new Float32Array(c),this.isVertexBufferUpdatable(t.g.NormalKind)||this.QZ(t.g.NormalKind,c,!0)}return Z._sourceNormals}applySkeleton(Z){if(!this.zc)return this;if(this.zc._softwareSkinningFrameId==this.XZ().getFrameId())return this;if(this.zc._softwareSkinningFrameId=this.XZ().getFrameId(),!this.isVerticesDataPresent(t.g.PositionKind))return this;if(!this.isVerticesDataPresent(t.g.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(t.g.MatricesWeightsKind))return this;const c=this.isVerticesDataPresent(t.g.NormalKind),L=this._internalMeshDataInfo;if(!L._sourcePositions){const Z=this.ec.slice();this.setPositionsForCPUSkinning(),this.ec=Z}c&&!L._sourceNormals&&this.setNormalsForCPUSkinning();let k=this.getVerticesData(t.g.PositionKind);if(!k)return this;k instanceof Float32Array||(k=new Float32Array(k));let N=this.getVerticesData(t.g.NormalKind);if(c){if(!N)return this;N instanceof Float32Array||(N=new Float32Array(N))}const R=this.getVerticesData(t.g.MatricesIndicesKind),G=this.getVerticesData(t.g.MatricesWeightsKind);if(!G||!R)return this;const V=this.numBoneInfluencers>4,p=V?this.getVerticesData(t.g.MatricesIndicesExtraKind):null,z=V?this.getVerticesData(t.g.MatricesWeightsExtraKind):null,i=Z.getTransformMatrices(this),E=J.h.Zero(),x=new J.b,q=new J.b;let O,w=0;for(let t=0;t<k.length;t+=3,w+=4){let Z;for(O=0;O<4;O++)Z=G[w+O],Z>0&&(J.b.FromFloat32ArrayToRefScaled(i,Math.floor(16*R[w+O]),Z,q),x.addToSelf(q));if(V)for(O=0;O<4;O++)Z=z[w+O],Z>0&&(J.b.FromFloat32ArrayToRefScaled(i,Math.floor(16*p[w+O]),Z,q),x.addToSelf(q));J.h.TransformCoordinatesFromFloatsToRef(L._sourcePositions[t],L._sourcePositions[t+1],L._sourcePositions[t+2],x,E),E.toArray(k,t),c&&(J.h.TransformNormalFromFloatsToRef(L._sourceNormals[t],L._sourceNormals[t+1],L._sourceNormals[t+2],x,E),E.toArray(N,t)),x.reset()}return this.updateVerticesData(t.g.PositionKind,k),c&&this.updateVerticesData(t.g.NormalKind,N),this}static MinMax(Z){let c=null,L=null;for(const k of Z){const Z=k.getBoundingInfo().boundingBox;c&&L?(c.minimizeInPlace(Z.minimumWorld),L.maximizeInPlace(Z.maximumWorld)):(c=Z.minimumWorld,L=Z.maximumWorld)}return c&&L?{min:c,max:L}:{min:J.h.Zero(),max:J.h.Zero()}}static Center(Z){const c=Z instanceof Array?I.MinMax(Z):Z;return J.h.Center(c.min,c.max)}static MergeMeshes(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0;return(0,V.k)(I._MergeMeshesCoroutine(Z,c,L,k,N,R,!1))}static async MergeMeshesAsync(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0;return await(0,V.g)(I._MergeMeshesCoroutine(Z,c,L,k,N,R,!0),(0,V.c)())}static*_MergeMeshesCoroutine(Z){let c,L=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],k=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0;if(0===(Z=Z.filter(Boolean)).length)return null;if(!k){let L=0;for(c=0;c<Z.length;c++)if(L+=Z[c].getTotalVertices(),L>=65536)return o.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}G&&(R=!1);const p=new Array,J=new Array,z=new Array,i=Z[0].sideOrientation;for(c=0;c<Z.length;c++){const L=Z[c];if(L.isAnInstance)return o.e.Warn("Cannot merge instance meshes."),null;if(i!==L.sideOrientation)return o.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(R&&z.push(L.getTotalIndices()),G)if(L.material){const Z=L.material;if(Z instanceof M.e){for(let c=0;c<Z.Ic.length;c++)p.indexOf(Z.Ic[c])<0&&p.push(Z.Ic[c]);for(let c=0;c<L.ec.length;c++)J.push(p.indexOf(Z.Ic[L.ec[c].materialIndex])),z.push(L.ec[c].indexCount)}else{p.indexOf(Z)<0&&p.push(Z);for(let c=0;c<L.ec.length;c++)J.push(p.indexOf(Z)),z.push(L.ec[c].indexCount)}}else for(let Z=0;Z<L.ec.length;Z++)J.push(0),z.push(L.ec[Z].indexCount)}const t=Z[0],x=Z=>{const c=Z.Jc(!0);return{vertexData:E.e.ExtractFromMesh(Z,!1,!1),transform:c}},{vertexData:q,transform:w}=x(t);V&&(yield);const P=new Array(Z.length-1);for(let E=1;E<Z.length;E++)P[E-1]=x(Z[E]),V&&(yield);const j=q._mergeCoroutine(w,P,k,V,!L);let u=j.next();for(;!u.done;)V&&(yield),u=j.next();const X=u.value;N||(N=new I(t.name+"_merged",t.XZ()));const h=X._applyToCoroutine(N,void 0,V);let B=h.next();for(;!B.done;)V&&(yield),B=h.next();if(N.checkCollisions=t.checkCollisions,N.sideOrientation=t.sideOrientation,L)for(c=0;c<Z.length;c++)Z[c].dispose();if(R||G){N.releaseSubMeshes(),c=0;let Z=0;for(;c<z.length;)O.b.CreateFromIndices(0,Z,z[c],N,void 0,!1),Z+=z[c],c++;for(const c of N.ec)c.refreshBoundingInfo();N.Jc(!0)}if(G){const Z=new M.e(t.name+"_merged",t.XZ());Z.Ic=p;for(let c=0;c<N.ec.length;c++)N.ec[c].materialIndex=J[c];N.material=Z}else N.material=t.material;return N}Lt(Z){Z._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(Z)}ct(Z){const c=Z._indexInSourceMeshInstanceArray;if(-1!=c){if(c!==this.instances.length-1){const Z=this.instances[this.instances.length-1];this.instances[c]=Z,Z._indexInSourceMeshInstanceArray=c}Z._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===w.e.CounterClockWiseSideOrientation}_getRenderingFillMode(Z){const c=this.XZ();return c.forcePointsCloud?w.e.PointFillMode:c.forceWireframe?w.e.WireFrameFillMode:this.overrideRenderingFillMode??Z}setMaterialByID(Z){return this.setMaterialById(Z)}static CreateRibbon(Z,c,L,k,N,R,G,V,p){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(Z,c,L,k,N,R){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(Z,c,L,k,N){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(Z,c,L,k,N,R){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(Z,c,L,k){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(Z,c,L,k,N,R,G,V,p){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(Z,c,L,k,N,R,G){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(Z,c,L,k,N,R,G,V,p,J){throw new Error("Import MeshBuilder to populate this function")}static RJ(Z,c,L,k,N){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(Z,c,L,k,N,R,G,V){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(Z,c,L,k,N,R,G){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(Z,c,L,k,N,R,G,V){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(Z,c,L,k,N,R,G,V,p,J){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(Z,c,L,k,N,R,G,V,p,J,z,i){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(Z,c,L,k,N,R,G){throw new Error("Import MeshBuilder to populate this function")}static VJ(Z,c,L,k,N){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(Z,c,L,k,N,R){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(Z,c,L,k,N,R,G,V,p){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(Z,c,L,k,N,R,G,V,p,J,z){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(Z,c,L,k,N,R,G,V,p,J){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(Z,c,L){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(Z,c,L){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(Z,c,L,k,N,R){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(Z,c,L){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(Z){throw new Error("Import MeshBuilder to populate this function")}}I.FRONTSIDE=E.e.FRONTSIDE,I.BACKSIDE=E.e.BACKSIDE,I.DOUBLESIDE=E.e.DOUBLESIDE,I.DEFAULTSIDE=E.e.DEFAULTSIDE,I.NO_CAP=0,I.CAP_START=1,I.CAP_END=2,I.CAP_ALL=3,I.NO_FLIP=0,I.FLIP_TILE=1,I.ROTATE_TILE=2,I.FLIP_ROW=3,I.ROTATE_ROW=4,I.FLIP_N_ROTATE_TILE=5,I.FLIP_N_ROTATE_ROW=6,I.CENTER=0,I.LEFT=1,I.RIGHT=2,I.TOP=3,I.BOTTOM=4,I.INSTANCEDMESH_SORT_TRANSPARENT=!1,I._GroundMeshParser=(Z,c)=>{throw(0,X.e)("GroundMesh")},I._GoldbergMeshParser=(Z,c)=>{throw(0,X.e)("GoldbergMesh")},I._LinesMeshParser=(Z,c)=>{throw(0,X.e)("LinesMesh")},I._GreasedLineMeshParser=(Z,c)=>{throw(0,X.e)("GreasedLineMesh")},I._GreasedLineRibbonMeshParser=(Z,c)=>{throw(0,X.e)("GreasedLineRibbonMesh")},I._TrailMeshParser=(Z,c)=>{throw(0,X.e)("TrailMesh")},(0,u.g)("BABYLON.Mesh",I)},11289:(Z,c,L)=>{L.d(c,{e:()=>x});var k=L(11170),N=L(10993),R=L(11190),G=L(11070),V=L(11255),p=L(11052),J=L(11173),z=L(11298),i=L(11085),t=L(11185);class E{}class x{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,z.d)(this._applyToCoroutine.bind(this)),this.uniqueId=x._UniqueIdGenerator,x._UniqueIdGenerator++}set(Z,c){switch(Z.length||p.e.Warn(`Setting vertex data kind '${c}' with an empty array`),c){case R.g.PositionKind:this.BZ=Z;break;case R.g.NormalKind:this.DZ=Z;break;case R.g.TangentKind:this.tangents=Z;break;case R.g.UVKind:this.HZ=Z;break;case R.g.UV2Kind:this.uvs2=Z;break;case R.g.UV3Kind:this.uvs3=Z;break;case R.g.UV4Kind:this.uvs4=Z;break;case R.g.UV5Kind:this.uvs5=Z;break;case R.g.UV6Kind:this.uvs6=Z;break;case R.g.ColorKind:this.eZ=Z;break;case R.g.MatricesIndicesKind:this.matricesIndices=Z;break;case R.g.MatricesWeightsKind:this.matricesWeights=Z;break;case R.g.MatricesIndicesExtraKind:this.matricesIndicesExtra=Z;break;case R.g.MatricesWeightsExtraKind:this.matricesWeightsExtra=Z}}WZ(Z,c){return this._applyTo(Z,c,!1),this}applyToGeometry(Z,c){return this._applyTo(Z,c,!1),this}updateMesh(Z){return this._update(Z),this}updateGeometry(Z){return this._update(Z),this}*_applyToCoroutine(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;if(this.BZ&&(Z.QZ(R.g.PositionKind,this.BZ,c),L&&(yield)),this.DZ&&(Z.QZ(R.g.NormalKind,this.DZ,c),L&&(yield)),this.tangents&&(Z.QZ(R.g.TangentKind,this.tangents,c),L&&(yield)),this.HZ&&(Z.QZ(R.g.UVKind,this.HZ,c),L&&(yield)),this.uvs2&&(Z.QZ(R.g.UV2Kind,this.uvs2,c),L&&(yield)),this.uvs3&&(Z.QZ(R.g.UV3Kind,this.uvs3,c),L&&(yield)),this.uvs4&&(Z.QZ(R.g.UV4Kind,this.uvs4,c),L&&(yield)),this.uvs5&&(Z.QZ(R.g.UV5Kind,this.uvs5,c),L&&(yield)),this.uvs6&&(Z.QZ(R.g.UV6Kind,this.uvs6,c),L&&(yield)),this.eZ){const k=this.BZ&&this.eZ.length===this.BZ.length?3:4;Z.QZ(R.g.ColorKind,this.eZ,c,k),this.hasVertexAlpha&&void 0!==Z.hasVertexAlpha&&(Z.hasVertexAlpha=!0),L&&(yield)}if(this.matricesIndices&&(Z.QZ(R.g.MatricesIndicesKind,this.matricesIndices,c),L&&(yield)),this.matricesWeights&&(Z.QZ(R.g.MatricesWeightsKind,this.matricesWeights,c),L&&(yield)),this.matricesIndicesExtra&&(Z.QZ(R.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,c),L&&(yield)),this.matricesWeightsExtra&&(Z.QZ(R.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,c),L&&(yield)),this.indices?(Z.setIndices(this.indices,null,c),L&&(yield)):Z.setIndices([],null),Z.ec&&this.materialInfos&&this.materialInfos.length>1){const c=Z;c.ec=[];for(const Z of this.materialInfos)new t.b(Z.materialIndex,Z.verticesStart,Z.verticesCount,Z.indexStart,Z.indexCount,c)}return this}_update(Z,c,L){return this.BZ&&Z.updateVerticesData(R.g.PositionKind,this.BZ,c,L),this.DZ&&Z.updateVerticesData(R.g.NormalKind,this.DZ,c,L),this.tangents&&Z.updateVerticesData(R.g.TangentKind,this.tangents,c,L),this.HZ&&Z.updateVerticesData(R.g.UVKind,this.HZ,c,L),this.uvs2&&Z.updateVerticesData(R.g.UV2Kind,this.uvs2,c,L),this.uvs3&&Z.updateVerticesData(R.g.UV3Kind,this.uvs3,c,L),this.uvs4&&Z.updateVerticesData(R.g.UV4Kind,this.uvs4,c,L),this.uvs5&&Z.updateVerticesData(R.g.UV5Kind,this.uvs5,c,L),this.uvs6&&Z.updateVerticesData(R.g.UV6Kind,this.uvs6,c,L),this.eZ&&Z.updateVerticesData(R.g.ColorKind,this.eZ,c,L),this.matricesIndices&&Z.updateVerticesData(R.g.MatricesIndicesKind,this.matricesIndices,c,L),this.matricesWeights&&Z.updateVerticesData(R.g.MatricesWeightsKind,this.matricesWeights,c,L),this.matricesIndicesExtra&&Z.updateVerticesData(R.g.MatricesIndicesExtraKind,this.matricesIndicesExtra,c,L),this.matricesWeightsExtra&&Z.updateVerticesData(R.g.MatricesWeightsExtraKind,this.matricesWeightsExtra,c,L),this.indices&&Z.setIndices(this.indices,null),this}static _TransformVector3Coordinates(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.length;const R=N.d.Mc[0],G=N.d.Mc[1];for(let V=L;V<L+k;V+=3)N.h.FromArrayToRef(Z,V,R),N.h.TransformCoordinatesToRef(R,c,G),Z[V]=G.x,Z[V+1]=G.y,Z[V+2]=G.z}static _TransformVector3Normals(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.length;const R=N.d.Mc[0],G=N.d.Mc[1];for(let V=L;V<L+k;V+=3)N.h.FromArrayToRef(Z,V,R),N.h.TransformNormalToRef(R,c,G),Z[V]=G.x,Z[V+1]=G.y,Z[V+2]=G.z}static _TransformVector4Normals(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.length;const R=N.d.Vector4[0],G=N.d.Vector4[1];for(let V=L;V<L+k;V+=4)N.j.FromArrayToRef(Z,V,R),N.j.TransformNormalToRef(R,c,G),Z[V]=G.x,Z[V+1]=G.y,Z[V+2]=G.z,Z[V+3]=G.w}static _FlipFaces(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.length;for(let k=c;k<c+L;k+=3){const c=Z[k+1];Z[k+1]=Z[k+2],Z[k+2]=c}}transform(Z){const c=Z.determinant()<0;return this.BZ&&x._TransformVector3Coordinates(this.BZ,Z),this.DZ&&x._TransformVector3Normals(this.DZ,Z),this.tangents&&x._TransformVector4Normals(this.tangents,Z),c&&this.indices&&x._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const Z=[];for(const c of this.materialInfos){const L=new x;if(this.BZ&&(L.BZ=this.BZ.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.DZ&&(L.DZ=this.DZ.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.tangents&&(L.tangents=this.tangents.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.eZ&&(L.eZ=this.eZ.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.HZ&&(L.HZ=this.HZ.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs2&&(L.uvs2=this.uvs2.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs3&&(L.uvs3=this.uvs3.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs4&&(L.uvs4=this.uvs4.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs5&&(L.uvs5=this.uvs5.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs6&&(L.uvs6=this.uvs6.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.matricesIndices&&(L.matricesIndices=this.matricesIndices.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesIndicesExtra&&(L.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeights&&(L.matricesWeights=this.matricesWeights.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeightsExtra&&(L.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.indices){L.indices=[];for(let Z=c.indexStart;Z<c.indexStart+c.indexCount;Z++)L.indices.push(this.indices[Z]-c.verticesStart)}const k=new E;k.indexStart=0,k.indexCount=L.indices?L.indices.length:0,k.materialIndex=c.materialIndex,k.verticesStart=0,k.verticesCount=(L.BZ?L.BZ.length:0)/3,L.materialInfos=[k],Z.push(L)}return Z}merge(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const R=Array.isArray(Z)?Z.map((Z=>({vertexData:Z}))):[{vertexData:Z}];return(0,z.k)(this._mergeCoroutine(void 0,R,c,!1,L,k,N))}*_mergeCoroutine(Z,c){var L,k;let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let z=c.map((Z=>Z.vertexData)),i=this;if(J)for(const R of z)R&&(R._validate(),!this.DZ&&R.DZ&&(this.DZ=new Float32Array(this.BZ.length)),!this.tangents&&R.tangents&&(this.tangents=new Float32Array(this.BZ.length/3*4)),!this.HZ&&R.HZ&&(this.HZ=new Float32Array(this.BZ.length/3*2)),!this.uvs2&&R.uvs2&&(this.uvs2=new Float32Array(this.BZ.length/3*2)),!this.uvs3&&R.uvs3&&(this.uvs3=new Float32Array(this.BZ.length/3*2)),!this.uvs4&&R.uvs4&&(this.uvs4=new Float32Array(this.BZ.length/3*2)),!this.uvs5&&R.uvs5&&(this.uvs5=new Float32Array(this.BZ.length/3*2)),!this.uvs6&&R.uvs6&&(this.uvs6=new Float32Array(this.BZ.length/3*2)),!this.eZ&&R.eZ&&(this.eZ=new Float32Array(this.BZ.length/3*4),this.eZ.fill(1)),!this.matricesIndices&&R.matricesIndices&&(this.matricesIndices=new Float32Array(this.BZ.length/3*4)),!this.matricesWeights&&R.matricesWeights&&(this.matricesWeights=new Float32Array(this.BZ.length/3*4)),!this.matricesIndicesExtra&&R.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.BZ.length/3*4)),!this.matricesWeightsExtra&&R.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.BZ.length/3*4)));for(const R of z)if(R)if(J)this.DZ&&!R.DZ&&(R.DZ=new Float32Array(R.BZ.length)),this.tangents&&!R.tangents&&(R.tangents=new Float32Array(R.BZ.length/3*4)),this.HZ&&!R.HZ&&(R.HZ=new Float32Array(R.BZ.length/3*2)),this.uvs2&&!R.uvs2&&(R.uvs2=new Float32Array(R.BZ.length/3*2)),this.uvs3&&!R.uvs3&&(R.uvs3=new Float32Array(R.BZ.length/3*2)),this.uvs4&&!R.uvs4&&(R.uvs4=new Float32Array(R.BZ.length/3*2)),this.uvs5&&!R.uvs5&&(R.uvs5=new Float32Array(R.BZ.length/3*2)),this.uvs6&&!R.uvs6&&(R.uvs6=new Float32Array(R.BZ.length/3*2)),this.eZ&&!R.eZ&&(R.eZ=new Float32Array(R.BZ.length/3*4),R.eZ.fill(1)),this.matricesIndices&&!R.matricesIndices&&(R.matricesIndices=new Float32Array(R.BZ.length/3*4)),this.matricesWeights&&!R.matricesWeights&&(R.matricesWeights=new Float32Array(R.BZ.length/3*4)),this.matricesIndicesExtra&&!R.matricesIndicesExtra&&(R.matricesIndicesExtra=new Float32Array(R.BZ.length/3*4)),this.matricesWeightsExtra&&!R.matricesWeightsExtra&&(R.matricesWeightsExtra=new Float32Array(R.BZ.length/3*4));else if(R._validate(),!this.DZ!==!R.DZ||!this.tangents!==!R.tangents||!this.HZ!==!R.HZ||!this.uvs2!==!R.uvs2||!this.uvs3!==!R.uvs3||!this.uvs4!==!R.uvs4||!this.uvs5!==!R.uvs5||!this.uvs6!==!R.uvs6||!this.eZ!==!R.eZ||!this.matricesIndices!==!R.matricesIndices||!this.matricesWeights!==!R.matricesWeights||!this.matricesIndicesExtra!==!R.matricesIndicesExtra||!this.matricesWeightsExtra!==!R.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(p){let L=0,k=0,N=0;const R=[];let G=null;const V=[];for(const c of this.splitBasedOnMaterialID())V.push({vertexData:c,transform:Z});for(const Z of c)if(Z.vertexData)for(const c of Z.vertexData.splitBasedOnMaterialID())V.push({vertexData:c,transform:Z.transform});V.sort(((Z,c)=>{const L=Z.vertexData.materialInfos?Z.vertexData.materialInfos[0].materialIndex:0,k=c.vertexData.materialInfos?c.vertexData.materialInfos[0].materialIndex:0;return L>k?1:L===k?0:-1}));for(const Z of V){const c=Z.vertexData;if(L=c.materialInfos?c.materialInfos[0].materialIndex:0,G&&G.materialIndex===L)G.indexCount+=c.indices.length,G.verticesCount+=c.BZ.length/3;else{const Z=new E;Z.materialIndex=L,Z.indexStart=k,Z.indexCount=c.indices.length,Z.verticesStart=N,Z.verticesCount=c.BZ.length/3,R.push(Z),G=Z}k+=c.indices.length,N+=c.BZ.length/3}const p=V.splice(0,1)[0];i=p.vertexData,Z=p.transform,z=V.map((Z=>Z.vertexData)),c=V,this.materialInfos=R}const t=z.reduce(((Z,c)=>{var L;return Z+((null===(L=c.indices)||void 0===L?void 0:L.length)??0)}),(null===(L=i.indices)||void 0===L?void 0:L.length)??0);let q=V||z.some((Z=>Z.indices===i.indices))?null===(k=i.indices)||void 0===k?void 0:k.slice():i.indices;if(t>0){var O;let L=(null===(O=q)||void 0===O?void 0:O.length)??0;if(q||(q=new Array(t)),q.length!==t){if(Array.isArray(q))q.length=t;else{const Z=N||q instanceof Uint32Array?new Uint32Array(t):new Uint16Array(t);Z.set(q),q=Z}Z&&Z.determinant()<0&&x._FlipFaces(q,0,L)}let k=i.BZ?i.BZ.length/3:0;for(const{vertexData:Z,transform:N}of c)if(Z.indices){for(let c=0;c<Z.indices.length;c++)q[L+c]=Z.indices[c]+k;N&&N.determinant()<0&&x._FlipFaces(q,L,Z.indices.length),k+=Z.BZ.length/3,L+=Z.indices.length,G&&(yield)}}return this.indices=q,this.BZ=x._MergeElement(R.g.PositionKind,i.BZ,Z,c.map((Z=>[Z.vertexData.BZ,Z.transform]))),G&&(yield),i.DZ&&(this.DZ=x._MergeElement(R.g.NormalKind,i.DZ,Z,c.map((Z=>[Z.vertexData.DZ,Z.transform]))),G&&(yield)),i.tangents&&(this.tangents=x._MergeElement(R.g.TangentKind,i.tangents,Z,c.map((Z=>[Z.vertexData.tangents,Z.transform]))),G&&(yield)),i.HZ&&(this.HZ=x._MergeElement(R.g.UVKind,i.HZ,Z,c.map((Z=>[Z.vertexData.HZ,Z.transform]))),G&&(yield)),i.uvs2&&(this.uvs2=x._MergeElement(R.g.UV2Kind,i.uvs2,Z,c.map((Z=>[Z.vertexData.uvs2,Z.transform]))),G&&(yield)),i.uvs3&&(this.uvs3=x._MergeElement(R.g.UV3Kind,i.uvs3,Z,c.map((Z=>[Z.vertexData.uvs3,Z.transform]))),G&&(yield)),i.uvs4&&(this.uvs4=x._MergeElement(R.g.UV4Kind,i.uvs4,Z,c.map((Z=>[Z.vertexData.uvs4,Z.transform]))),G&&(yield)),i.uvs5&&(this.uvs5=x._MergeElement(R.g.UV5Kind,i.uvs5,Z,c.map((Z=>[Z.vertexData.uvs5,Z.transform]))),G&&(yield)),i.uvs6&&(this.uvs6=x._MergeElement(R.g.UV6Kind,i.uvs6,Z,c.map((Z=>[Z.vertexData.uvs6,Z.transform]))),G&&(yield)),i.eZ&&(this.eZ=x._MergeElement(R.g.ColorKind,i.eZ,Z,c.map((Z=>[Z.vertexData.eZ,Z.transform]))),(void 0!==i.hasVertexAlpha||c.some((Z=>void 0!==Z.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=i.hasVertexAlpha||c.some((Z=>Z.vertexData.hasVertexAlpha))),G&&(yield)),i.matricesIndices&&(this.matricesIndices=x._MergeElement(R.g.MatricesIndicesKind,i.matricesIndices,Z,c.map((Z=>[Z.vertexData.matricesIndices,Z.transform]))),G&&(yield)),i.matricesWeights&&(this.matricesWeights=x._MergeElement(R.g.MatricesWeightsKind,i.matricesWeights,Z,c.map((Z=>[Z.vertexData.matricesWeights,Z.transform]))),G&&(yield)),i.matricesIndicesExtra&&(this.matricesIndicesExtra=x._MergeElement(R.g.MatricesIndicesExtraKind,i.matricesIndicesExtra,Z,c.map((Z=>[Z.vertexData.matricesIndicesExtra,Z.transform]))),G&&(yield)),i.matricesWeightsExtra&&(this.matricesWeightsExtra=x._MergeElement(R.g.MatricesWeightsExtraKind,i.matricesWeightsExtra,Z,c.map((Z=>[Z.vertexData.matricesWeightsExtra,Z.transform])))),this}static _MergeElement(Z,c,L,k){const N=k.filter((Z=>null!==Z[0]&&void 0!==Z[0]));if(!c&&0==N.length)return c;if(!c)return this._MergeElement(Z,N[0][0],N[0][1],N.slice(1));const G=N.reduce(((Z,c)=>Z+c[0].length),c.length),V=Z===R.g.PositionKind?x._TransformVector3Coordinates:Z===R.g.NormalKind?x._TransformVector3Normals:Z===R.g.TangentKind?x._TransformVector4Normals:()=>{};if(c instanceof Float32Array){const Z=new Float32Array(G);Z.set(c),L&&V(Z,L,0,c.length);let k=c.length;for(const[c,L]of N)Z.set(c,k),L&&V(Z,L,k,c.length),k+=c.length;return Z}{const Z=new Array(G);for(let L=0;L<c.length;L++)Z[L]=c[L];L&&V(Z,L,0,c.length);let k=c.length;for(const[c,L]of N){for(let L=0;L<c.length;L++)Z[k+L]=c[L];L&&V(Z,L,k,c.length),k+=c.length}return Z}}_validate(){if(!this.BZ)throw new i.h("Positions are required",i.e.MeshInvalidPositionsError);const Z=(Z,c)=>{const L=R.g.DeduceStride(Z);if(c.length%L!==0)throw new Error("The "+Z+"s array count must be a multiple of "+L);return c.length/L},c=Z(R.g.PositionKind,this.BZ),L=(L,k)=>{const N=Z(L,k);if(N!==c)throw new Error("The "+L+"s element count ("+N+") does not match the positions count ("+c+")")};this.DZ&&L(R.g.NormalKind,this.DZ),this.tangents&&L(R.g.TangentKind,this.tangents),this.HZ&&L(R.g.UVKind,this.HZ),this.uvs2&&L(R.g.UV2Kind,this.uvs2),this.uvs3&&L(R.g.UV3Kind,this.uvs3),this.uvs4&&L(R.g.UV4Kind,this.uvs4),this.uvs5&&L(R.g.UV5Kind,this.uvs5),this.uvs6&&L(R.g.UV6Kind,this.uvs6),this.eZ&&L(R.g.ColorKind,this.eZ),this.matricesIndices&&L(R.g.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&L(R.g.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&L(R.g.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&L(R.g.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const Z=this.serialize();return x.Parse(Z)}serialize(){const Z={};if(this.BZ&&(Z.BZ=Array.from(this.BZ)),this.DZ&&(Z.DZ=Array.from(this.DZ)),this.tangents&&(Z.tangents=Array.from(this.tangents)),this.HZ&&(Z.HZ=Array.from(this.HZ)),this.uvs2&&(Z.uvs2=Array.from(this.uvs2)),this.uvs3&&(Z.uvs3=Array.from(this.uvs3)),this.uvs4&&(Z.uvs4=Array.from(this.uvs4)),this.uvs5&&(Z.uvs5=Array.from(this.uvs5)),this.uvs6&&(Z.uvs6=Array.from(this.uvs6)),this.eZ&&(Z.eZ=Array.from(this.eZ),Z.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(Z.matricesIndices=Array.from(this.matricesIndices),Z.matricesIndicesExpanded=!0),this.matricesWeights&&(Z.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(Z.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),Z.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(Z.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),Z.indices=this.indices?Array.from(this.indices):[],this.materialInfos){Z.materialInfos=[];for(const c of this.materialInfos){const L={indexStart:c.indexStart,indexCount:c.indexCount,materialIndex:c.materialIndex,verticesStart:c.verticesStart,verticesCount:c.verticesCount};Z.materialInfos.push(L)}}return Z}static ExtractFromMesh(Z,c,L){return x._ExtractFrom(Z,c,L)}static ExtractFromGeometry(Z,c,L){return x._ExtractFrom(Z,c,L)}static _ExtractFrom(Z,c,L){const k=new x;if(Z.isVerticesDataPresent(R.g.PositionKind)&&(k.BZ=Z.getVerticesData(R.g.PositionKind,c,L)),Z.isVerticesDataPresent(R.g.NormalKind)&&(k.DZ=Z.getVerticesData(R.g.NormalKind,c,L)),Z.isVerticesDataPresent(R.g.TangentKind)&&(k.tangents=Z.getVerticesData(R.g.TangentKind,c,L)),Z.isVerticesDataPresent(R.g.UVKind)&&(k.HZ=Z.getVerticesData(R.g.UVKind,c,L)),Z.isVerticesDataPresent(R.g.UV2Kind)&&(k.uvs2=Z.getVerticesData(R.g.UV2Kind,c,L)),Z.isVerticesDataPresent(R.g.UV3Kind)&&(k.uvs3=Z.getVerticesData(R.g.UV3Kind,c,L)),Z.isVerticesDataPresent(R.g.UV4Kind)&&(k.uvs4=Z.getVerticesData(R.g.UV4Kind,c,L)),Z.isVerticesDataPresent(R.g.UV5Kind)&&(k.uvs5=Z.getVerticesData(R.g.UV5Kind,c,L)),Z.isVerticesDataPresent(R.g.UV6Kind)&&(k.uvs6=Z.getVerticesData(R.g.UV6Kind,c,L)),Z.isVerticesDataPresent(R.g.ColorKind)){const N=Z.zc||Z,G=N.getVertexBuffer(R.g.ColorKind),V=N.getVerticesData(R.g.ColorKind,c,L);if(3===G.getSize()){const Z=new Float32Array(4*V.length/3);for(let c=0,L=0;c<V.length;c+=3,L+=4)Z[L]=V[c],Z[L+1]=V[c+1],Z[L+2]=V[c+2],Z[L+3]=1;k.eZ=Z}else{if(4!==G.getSize())throw new Error(`Unexpected number of color components: ${G.getSize()}`);k.eZ=V}}return Z.isVerticesDataPresent(R.g.MatricesIndicesKind)&&(k.matricesIndices=Z.getVerticesData(R.g.MatricesIndicesKind,c,L)),Z.isVerticesDataPresent(R.g.MatricesWeightsKind)&&(k.matricesWeights=Z.getVerticesData(R.g.MatricesWeightsKind,c,L)),Z.isVerticesDataPresent(R.g.MatricesIndicesExtraKind)&&(k.matricesIndicesExtra=Z.getVerticesData(R.g.MatricesIndicesExtraKind,c,L)),Z.isVerticesDataPresent(R.g.MatricesWeightsExtraKind)&&(k.matricesWeightsExtra=Z.getVerticesData(R.g.MatricesWeightsExtraKind,c,L)),k.indices=Z.tc(c,L),k}static CreateRibbon(Z){throw(0,G.e)("ribbonBuilder")}static CreateBox(Z){throw(0,G.e)("boxBuilder")}static CreateTiledBox(Z){throw(0,G.e)("tiledBoxBuilder")}static CreateTiledPlane(Z){throw(0,G.e)("tiledPlaneBuilder")}static CreateSphere(Z){throw(0,G.e)("sphereBuilder")}static CreateCylinder(Z){throw(0,G.e)("cylinderBuilder")}static CreateTorus(Z){throw(0,G.e)("torusBuilder")}static CreateLineSystem(Z){throw(0,G.e)("linesBuilder")}static CreateDashedLines(Z){throw(0,G.e)("linesBuilder")}static CreateGround(Z){throw(0,G.e)("groundBuilder")}static CreateTiledGround(Z){throw(0,G.e)("groundBuilder")}static CreateGroundFromHeightMap(Z){throw(0,G.e)("groundBuilder")}static VJ(Z){throw(0,G.e)("planeBuilder")}static CreateDisc(Z){throw(0,G.e)("discBuilder")}static CreatePolygon(Z,c,L,k,N,R,V){throw(0,G.e)("polygonBuilder")}static CreateIcoSphere(Z){throw(0,G.e)("icoSphereBuilder")}static CreatePolyhedron(Z){throw(0,G.e)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||N.h.Up();throw(0,G.e)("capsuleBuilder")}static CreateTorusKnot(Z){throw(0,G.e)("torusKnotBuilder")}static ComputeNormals(Z,c,L,k){let R=0,G=0,V=0,p=0,J=0,z=0,i=0,t=0,E=0,x=0,q=0,O=0,w=0,M=0,P=0,j=0,o=0,u=0,X=0,h=0,B=!1,D=!1,e=!1,H=!1,l=1,W=0,T=null;k&&(B=!!k.facetNormals,D=!!k.facetPositions,e=!!k.facetPartitioning,l=!0===k.useRightHandedSystem?-1:1,W=k.ratio||0,H=!!k.depthSort,T=k.distanceTo,H&&void 0===T&&(T=N.h.Zero()));let I=0,d=0,Q=0,r=0;for(e&&k&&k.bbSize&&(I=k.subDiv.X*W/k.bbSize.x,d=k.subDiv.Y*W/k.bbSize.y,Q=k.subDiv.Z*W/k.bbSize.z,r=k.subDiv.max*k.subDiv.max,k.facetPartitioning.length=0),R=0;R<Z.length;R++)L[R]=0;const f=c.length/3|0;for(R=0;R<f;R++){if(O=3*c[3*R],w=O+1,M=O+2,P=3*c[3*R+1],j=P+1,o=P+2,u=3*c[3*R+2],X=u+1,h=u+2,G=Z[O]-Z[P],V=Z[w]-Z[j],p=Z[M]-Z[o],J=Z[u]-Z[P],z=Z[X]-Z[j],i=Z[h]-Z[o],t=l*(V*i-p*z),E=l*(p*J-G*i),x=l*(G*z-V*J),q=Math.sqrt(t*t+E*E+x*x),q=0===q?1:q,t/=q,E/=q,x/=q,B&&k&&(k.facetNormals[R].x=t,k.facetNormals[R].y=E,k.facetNormals[R].z=x),D&&k&&(k.facetPositions[R].x=(Z[O]+Z[P]+Z[u])/3,k.facetPositions[R].y=(Z[w]+Z[j]+Z[X])/3,k.facetPositions[R].z=(Z[M]+Z[o]+Z[h])/3),e&&k){const c=Math.floor((k.facetPositions[R].x-k.bInfo.minimum.x*W)*I),L=Math.floor((k.facetPositions[R].y-k.bInfo.minimum.y*W)*d),N=Math.floor((k.facetPositions[R].z-k.bInfo.minimum.z*W)*Q),G=Math.floor((Z[O]-k.bInfo.minimum.x*W)*I),V=Math.floor((Z[w]-k.bInfo.minimum.y*W)*d),p=Math.floor((Z[M]-k.bInfo.minimum.z*W)*Q),J=Math.floor((Z[P]-k.bInfo.minimum.x*W)*I),z=Math.floor((Z[j]-k.bInfo.minimum.y*W)*d),i=Math.floor((Z[o]-k.bInfo.minimum.z*W)*Q),t=Math.floor((Z[u]-k.bInfo.minimum.x*W)*I),E=Math.floor((Z[X]-k.bInfo.minimum.y*W)*d),x=Math.floor((Z[h]-k.bInfo.minimum.z*W)*Q),q=G+k.subDiv.max*V+r*p,B=J+k.subDiv.max*z+r*i,D=t+k.subDiv.max*E+r*x,e=c+k.subDiv.max*L+r*N;k.facetPartitioning[e]=k.facetPartitioning[e]?k.facetPartitioning[e]:[],k.facetPartitioning[q]=k.facetPartitioning[q]?k.facetPartitioning[q]:[],k.facetPartitioning[B]=k.facetPartitioning[B]?k.facetPartitioning[B]:[],k.facetPartitioning[D]=k.facetPartitioning[D]?k.facetPartitioning[D]:[],k.facetPartitioning[q].push(R),B!=q&&k.facetPartitioning[B].push(R),D!=B&&D!=q&&k.facetPartitioning[D].push(R),e!=q&&e!=B&&e!=D&&k.facetPartitioning[e].push(R)}if(H&&k&&k.facetPositions){const Z=k.depthSortedFacets[R];Z.ind=3*R,Z.sqDistance=N.h.DistanceSquared(k.facetPositions[R],T)}L[O]+=t,L[w]+=E,L[M]+=x,L[P]+=t,L[j]+=E,L[o]+=x,L[u]+=t,L[X]+=E,L[h]+=x}for(R=0;R<L.length/3;R++)t=L[3*R],E=L[3*R+1],x=L[3*R+2],q=Math.sqrt(t*t+E*E+x*x),q=0===q?1:q,t/=q,E/=q,x/=q,L[3*R]=t,L[3*R+1]=E,L[3*R+2]=x}static _ComputeSides(Z,c,L,k,R,G,V){const p=L.length,J=k.length;let z,i;switch(Z=Z||x.DEFAULTSIDE){case x.FRONTSIDE:break;case x.BACKSIDE:for(z=0;z<p;z+=3){const Z=L[z];L[z]=L[z+2],L[z+2]=Z}for(i=0;i<J;i++)k[i]=-k[i];break;case x.DOUBLESIDE:{const Z=c.length,t=Z/3;for(let L=0;L<Z;L++)c[Z+L]=c[L];for(z=0;z<p;z+=3)L[z+p]=L[z+2]+t,L[z+1+p]=L[z+1]+t,L[z+2+p]=L[z]+t;for(i=0;i<J;i++)k[J+i]=-k[i];const E=R.length;let x=0;for(x=0;x<E;x++)R[x+E]=R[x];for(G=G||new N.j(0,0,1,1),V=V||new N.j(0,0,1,1),x=0,z=0;z<E/2;z++)R[x]=G.x+(G.z-G.x)*R[x],R[x+1]=G.y+(G.w-G.y)*R[x+1],R[x+E]=V.x+(V.z-V.x)*R[x+E],R[x+E+1]=V.y+(V.w-V.y)*R[x+E+1],x+=2;break}}}static Parse(Z){const c=new x,L=Z.BZ;L&&c.set(L,R.g.PositionKind);const k=Z.DZ;k&&c.set(k,R.g.NormalKind);const N=Z.tangents;N&&c.set(N,R.g.TangentKind);const G=Z.HZ;G&&c.set(G,R.g.UVKind);const p=Z.uvs2;p&&c.set(p,R.g.UV2Kind);const J=Z.uvs3;J&&c.set(J,R.g.UV3Kind);const z=Z.uvs4;z&&c.set(z,R.g.UV4Kind);const i=Z.uvs5;i&&c.set(i,R.g.UV5Kind);const t=Z.uvs6;t&&c.set(t,R.g.UV6Kind);const q=Z.eZ;q&&(c.set(V.h.CheckColors4(q,L.length/3),R.g.ColorKind),void 0!==Z.hasVertexAlpha&&(c.hasVertexAlpha=Z.hasVertexAlpha));const O=Z.matricesIndices;O&&c.set(O,R.g.MatricesIndicesKind);const w=Z.matricesWeights;w&&c.set(w,R.g.MatricesWeightsKind);const M=Z.indices;M&&(c.indices=M);const P=Z.materialInfos;if(P){c.materialInfos=[];for(const Z of P){const L=new E;L.indexCount=Z.indexCount,L.indexStart=Z.indexStart,L.verticesCount=Z.verticesCount,L.verticesStart=Z.verticesStart,L.materialIndex=Z.materialIndex,c.materialInfos.push(L)}}return c}static ImportVertexData(Z,c){const L=x.Parse(Z);c.setAllVerticesData(L,Z.updatable)}}x.FRONTSIDE=0,x.BACKSIDE=1,x.DOUBLESIDE=2,x.DEFAULTSIDE=0,x._UniqueIdGenerator=0,(0,k.d)([J.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k]=c;return!Array.isArray(k)}))],x,"_TransformVector3Coordinates",null),(0,k.d)([J.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k]=c;return!Array.isArray(k)}))],x,"_TransformVector3Normals",null),(0,k.d)([J.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k]=c;return!Array.isArray(k)}))],x,"_TransformVector4Normals",null),(0,k.d)([J.h.filter((function(){for(var Z=arguments.length,c=new Array(Z),L=0;L<Z;L++)c[L]=arguments[L];let[k]=c;return!Array.isArray(k)}))],x,"_FlipFaces",null)},11185:(Z,c,L)=>{L.d(c,{b:()=>p});var k=L(11190),N=L(11199),R=L(11205),G=L(11221),V=L(11230);class p{get materialDefines(){var Z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(Z=this._getDrawWrapper())||void 0===Z?void 0:Z.defines}set materialDefines(Z){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=Z}_getDrawWrapper(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z??this._engine.currentRenderPassId;let L=this._drawWrappers[Z];return!L&&c&&(this._drawWrappers[Z]=L=new V.d(this._mesh.XZ().getEngine())),L}_removeDrawWrapper(Z){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var L;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(L=this._drawWrappers[Z])||void 0===L||L.dispose(c));this._drawWrappers[Z]=void 0}get effect(){var Z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(Z=this._getDrawWrapper())||void 0===Z?void 0:Z.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(Z){this._mainDrawWrapperOverride=Z}setEffect(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this._drawWrapper;N.setEffect(Z,c,k),void 0!==L&&(N.materialContext=L),Z||(N.defines=null,N.materialContext=void 0)}resetDrawCache(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==Z)return void this._removeDrawWrapper(Z,!0,c);for(const Z of this._drawWrappers)null===Z||void 0===Z||Z.dispose(c)}this._drawWrappers=[]}static AddToMesh(Z,c,L,k,N,R,G){return new p(Z,c,L,k,N,R,G,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(Z,c,L,k,N,R,G){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],p=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=Z,this.verticesStart=c,this.verticesCount=L,this.indexStart=k,this.indexCount=N,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=R,this._renderingMesh=G||R,p&&R.ec.push(this),this._engine=this._mesh.XZ().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=R.ec.length-1,V&&(this.refreshBoundingInfo(),R.Jc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(Z){return this._boundingInfo=Z,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const Z=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return Z||this._renderingMesh}rZ(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!c)return Z&&this._mesh.XZ()._hasDefaultMaterial?this._mesh.XZ().defaultMaterial:null;if(this._isMultiMaterial(c)){const Z=c.getSubMaterial(this.materialIndex);return this._currentMaterial!==Z&&(this._currentMaterial=Z,this.resetDrawCache()),Z}return c}_isMultiMaterial(Z){return void 0!==Z.getSubMaterial}refreshBoundingInfo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.zc)return this;if(Z||(Z=this._renderingMesh.getVerticesData(k.g.PositionKind)),!Z)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const c=this._renderingMesh.tc();let L;if(0===this.indexStart&&this.indexCount===c.length){const Z=this._renderingMesh.getBoundingInfo();L={minimum:Z.minimum.clone(),maximum:Z.maximum.clone()}}else L=(0,G.b)(Z,c,this.indexStart,this.indexCount,this._renderingMesh.zc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(L.minimum,L.maximum):this._boundingInfo=new R.e(L.minimum,L.maximum),this}_checkCollision(Z){return this.getBoundingInfo()._checkCollision(Z)}updateBoundingInfo(Z){let c=this.getBoundingInfo();return c||(this.refreshBoundingInfo(),c=this.getBoundingInfo()),c&&c.update(Z),this}isInFrustum(Z){const c=this.getBoundingInfo();return!!c&&c.isInFrustum(Z,this._mesh.Zi)}isCompletelyInFrustum(Z){const c=this.getBoundingInfo();return!!c&&c.isCompletelyInFrustum(Z)}render(Z){return this._renderingMesh.render(this,Z,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(Z,c){if(!this._linesIndexBuffer){const L=6*Math.floor(this.indexCount/3),k=this.verticesStart+this.verticesCount>65535?new Uint32Array(L):new Uint16Array(L);let N=0;if(0===Z.length)for(let Z=this.indexStart;Z<this.indexStart+this.indexCount;Z+=3)k[N++]=Z,k[N++]=Z+1,k[N++]=Z+1,k[N++]=Z+2,k[N++]=Z+2,k[N++]=Z;else for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)k[N++]=Z[c],k[N++]=Z[c+1],k[N++]=Z[c+1],k[N++]=Z[c+2],k[N++]=Z[c+2],k[N++]=Z[c];this._linesIndexBuffer=c.createIndexBuffer(k),this._linesIndexCount=k.length}return this._linesIndexBuffer}canIntersects(Z){const c=this.getBoundingInfo();return!!c&&Z.intersectsBox(c.boundingBox)}intersects(Z,c,L,k,N){const R=this.rZ();if(!R)return null;let G=3,V=!1;switch(R.fillMode){case 3:case 5:case 6:case 8:return null;case 7:G=1,V=!0}return 4===R.fillMode?L.length?this._intersectLines(Z,c,L,this._mesh.intersectionThreshold,k):this._intersectUnIndexedLines(Z,c,L,this._mesh.intersectionThreshold,k):!L.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(Z,c,L,k,N):this._intersectTriangles(Z,c,L,G,V,k,N)}_intersectLines(Z,c,L,k,R){let G=null;for(let V=this.indexStart;V<this.indexStart+this.indexCount;V+=2){const p=c[L[V]],J=c[L[V+1]],z=Z.intersectionSegment(p,J,k);if(!(z<0)&&((R||!G||z<G.distance)&&(G=new N.d(null,null,z),G.faceId=V/2,R)))break}return G}_intersectUnIndexedLines(Z,c,L,k,R){let G=null;for(let V=this.verticesStart;V<this.verticesStart+this.verticesCount;V+=2){const L=c[V],p=c[V+1],J=Z.intersectionSegment(L,p,k);if(!(J<0)&&((R||!G||J<G.distance)&&(G=new N.d(null,null,J),G.faceId=V/2,R)))break}return G}_intersectTriangles(Z,c,L,k,N,R,G){let V=null,p=-1;for(let J=this.indexStart;J<this.indexStart+this.indexCount-(3-k);J+=k){p++;const k=L[J],z=L[J+1],i=L[J+2];if(N&&4294967295===i){J+=2;continue}const t=c[k],E=c[z],x=c[i];if(!t||!E||!x)continue;if(G&&!G(t,E,x,Z,k,z,i))continue;const q=Z.intersectsTriangle(t,E,x);if(q){if(q.distance<0)continue;if((R||!V||q.distance<V.distance)&&(V=q,V.faceId=p,R))break}}return V}_intersectUnIndexedTriangles(Z,c,L,k,N){let R=null;for(let G=this.verticesStart;G<this.verticesStart+this.verticesCount;G+=3){const L=c[G],V=c[G+1],p=c[G+2];if(N&&!N(L,V,p,Z,-1,-1,-1))continue;const J=Z.intersectsTriangle(L,V,p);if(J){if(J.distance<0)continue;if((k||!R||J.distance<R.distance)&&(R=J,R.faceId=G/3,k))break}}return R}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(Z,c){const L=new p(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,Z,c,!1);if(!this.IsGlobal){const Z=this.getBoundingInfo();if(!Z)return L;L._boundingInfo=new R.e(Z.minimum,Z.maximum)}return L}dispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.XZ().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const c=this._mesh.ec.indexOf(this);this._mesh.ec.splice(c,1),this.resetDrawCache(void 0,Z)}getClassName(){return"SubMesh"}static CreateFromIndices(Z,c,L,k,N){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=Number.MAX_VALUE,V=-Number.MAX_VALUE;const J=(N||k).tc();for(let p=c;p<c+L;p++){const Z=J[p];Z<G&&(G=Z),Z>V&&(V=Z)}return new p(Z,G,V-G+1,c,L,k,N,R)}}},11760:(Z,c,L)=>{var k=L(11325),N=L(11190),R=L(10993),G=L(11052),V=L(11205);k.c.prototype.thinInstanceAdd=function(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.XZ().getEngine().getCaps().instancedArrays)return G.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(Z)?Z.length:1);const L=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(Z))for(let k=0;k<Z.length;++k)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,Z[k],k===Z.length-1&&c);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,Z,c);return L},k.c.prototype.thinInstanceAddSelf=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(R.b.IdentityReadOnly,Z)},k.c.prototype.thinInstanceRegisterAttribute=function(Z,c){Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),this.removeVerticesData(Z),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[Z]=c,this._userThinInstanceBuffersStorage.sizes[Z]=c*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[Z]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[Z]),this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new N.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[Z],Z,!0,!1,c,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])},k.c.prototype.thinInstanceSetMatrixAt=function(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||Z>=this._thinInstanceDataStorage.instancesCount)return!1;const k=this._thinInstanceDataStorage.matrixData;return c.copyToArray(k,16*Z),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[Z]=c),L&&(this.Ni("matrix"),this.TZ||this.thinInstanceRefreshBoundingInfo(!1)),!0},k.c.prototype.thinInstanceSetAttributeAt=function(Z,c,L){let k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[Z]||c>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(Z,0),this._userThinInstanceBuffersStorage.data[Z].set(L,c*this._userThinInstanceBuffersStorage.strides[Z]),k&&this.Ni(Z),!0)},Object.defineProperty(k.c.prototype,"dc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(Z){var c;const L=this._thinInstanceDataStorage.matrixData??(null===(c=this.source)||void 0===c?void 0:c._thinInstanceDataStorage.matrixData);Z<=(L?L.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=Z)},enumerable:!0,configurable:!0}),k.c.prototype._thinInstanceCreateMatrixBuffer=function(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=new N.e(this.getEngine(),c,!L,16,!1,!0);for(let N=0;N<4;N++)this.setVerticesBuffer(k.createVertexBuffer(Z+N,4*N,4));return k},k.c.prototype.ki=function(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var R;if(L=L||16,"matrix"===Z)null===(R=this._thinInstanceDataStorage.matrixBuffer)||void 0===R||R.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=c?c.length:32*L,this._thinInstanceDataStorage.matrixData=c,this._thinInstanceDataStorage.worldMatrices=null,null!==c?(this._thinInstanceDataStorage.instancesCount=c.length/L,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",c,k),this.TZ||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.TZ||this.refreshBoundingInfo());else if("previousMatrix"===Z){var G;null===(G=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===G||G.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=c,null!==c&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",c,k))}else{var V;if(Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),null===c)null!==(V=this._userThinInstanceBuffersStorage)&&void 0!==V&&V.data[Z]&&(this.removeVerticesData(Z),delete this._userThinInstanceBuffersStorage.data[Z],delete this._userThinInstanceBuffersStorage.strides[Z],delete this._userThinInstanceBuffersStorage.sizes[Z],delete this._userThinInstanceBuffersStorage.vertexBuffers[Z]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[Z]=c,this._userThinInstanceBuffersStorage.strides[Z]=L,this._userThinInstanceBuffersStorage.sizes[Z]=c.length,this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new N.g(this.getEngine(),c,Z,!k,!1,L,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])}},k.c.prototype.Ni=function(Z){var c;if("matrix"===Z)this.Vt&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(Z),null===(c=this._thinInstanceDataStorage.matrixBuffer)||void 0===c||c.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===Z){var L;this.Vt&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(Z),null===(L=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===L||L.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var k;Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),null!==(k=this._userThinInstanceBuffersStorage)&&void 0!==k&&k.vertexBuffers[Z]&&(this.Vt&&!this._userThinInstanceBuffersStorage.vertexBuffers[Z].isUpdatable()&&this._thinInstanceRecreateBuffer(Z),this._userThinInstanceBuffersStorage.vertexBuffers[Z].updateDirectly(this._userThinInstanceBuffersStorage.data[Z],0))}},k.c.prototype.thinInstancePartialBufferUpdate=function(Z,c,L){var k;"matrix"===Z?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(c,L):(Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),null!==(k=this._userThinInstanceBuffersStorage)&&void 0!==k&&k.vertexBuffers[Z]&&this._userThinInstanceBuffersStorage.vertexBuffers[Z].updateDirectly(c,L))},k.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const Z=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let c=0;c<this._thinInstanceDataStorage.instancesCount;++c)this._thinInstanceDataStorage.worldMatrices[c]=R.b.oc(Z,16*c)}return this._thinInstanceDataStorage.worldMatrices},k.c.prototype.thinInstanceRefreshBoundingInfo=function(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const k=this._thinInstanceDataStorage.boundingVectors;if(Z||!this.rawBoundingInfo){k.length=0,this.refreshBoundingInfo(c,L);const Z=this.getBoundingInfo();this.rawBoundingInfo=new V.e(Z.minimum,Z.maximum)}const N=this.getBoundingInfo(),G=this._thinInstanceDataStorage.matrixData;if(0===k.length)for(let R=0;R<N.boundingBox.vectors.length;++R)k.push(N.boundingBox.vectors[R].clone());R.d.Mc[0].uc(Number.POSITIVE_INFINITY),R.d.Mc[1].uc(Number.NEGATIVE_INFINITY);for(let V=0;V<this._thinInstanceDataStorage.instancesCount;++V){R.b.FromArrayToRef(G,16*V,R.d.Matrix[0]);for(let Z=0;Z<k.length;++Z)R.h.TransformCoordinatesToRef(k[Z],R.d.Matrix[0],R.d.Mc[2]),R.d.Mc[0].minimizeInPlace(R.d.Mc[2]),R.d.Mc[1].maximizeInPlace(R.d.Mc[2])}N.reConstruct(R.d.Mc[0],R.d.Mc[1]),this.IZ()},k.c.prototype._thinInstanceRecreateBuffer=function(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var L;if("matrix"===Z)null===(L=this._thinInstanceDataStorage.matrixBuffer)||void 0===L||L.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,c);else if("previousMatrix"===Z){var k;if(this._scene.needsPreviousWorldMatrices)null===(k=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===k||k.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,c)}else{var R;Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind),null===(R=this._userThinInstanceBuffersStorage.vertexBuffers[Z])||void 0===R||R.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new N.g(this.getEngine(),this._userThinInstanceBuffersStorage.data[Z],Z,!c,!1,this._userThinInstanceBuffersStorage.strides[Z],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])}},k.c.prototype._thinInstanceUpdateBufferSize=function(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Z===N.g.ColorKind&&(Z=N.g.ColorInstanceKind);const L="matrix"===Z;if(!L&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[Z]))return;const k=L?16:this._userThinInstanceBuffersStorage.strides[Z],R=L?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[Z];let G=L?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[Z];const V=(this._thinInstanceDataStorage.instancesCount+c)*k;let p=R;for(;p<V;)p*=2;if(!G||R!=p){if(G){const Z=new Float32Array(p);Z.set(G,0),G=Z}else G=new Float32Array(p);var J,z,i;if(L){if(null===(J=this._thinInstanceDataStorage.matrixBuffer)||void 0===J||J.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",G,!1),this._thinInstanceDataStorage.matrixData=G,this._thinInstanceDataStorage.matrixBufferSize=p,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",G,!1)}else null===(i=this._userThinInstanceBuffersStorage.vertexBuffers[Z])||void 0===i||i.dispose(),this._userThinInstanceBuffersStorage.data[Z]=G,this._userThinInstanceBuffersStorage.sizes[Z]=p,this._userThinInstanceBuffersStorage.vertexBuffers[Z]=new N.g(this.getEngine(),G,Z,!0,!1,k,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[Z])}},k.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},k.c.prototype._disposeThinInstanceSpecificData=function(){var Z;null!==(Z=this._thinInstanceDataStorage)&&void 0!==Z&&Z.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11274:(Z,c,L)=>{L.d(c,{e:()=>z});var k=L(11170),N=L(11173),R=L(11242),G=L(11027),V=L(10993),p=L(11277),J=L(11012);class z extends p.b{get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._cache.useBillboardPosition=0!==(this._billboardMode&z.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(Z){this._infiniteDistance!==Z&&(this._infiniteDistance=Z)}constructor(Z){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new V.h(0,0,1),this._up=new V.h(0,1,0),this._right=new V.h(1,0,0),this._position=V.h.Zero(),this._rotation=V.h.Zero(),this._rotationQuaternion=null,this._scaling=V.h.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=z.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.it=V.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=V.h.Zero(),this._absoluteScaling=V.h.Zero(),this._absoluteRotationQuaternion=V.c.Identity(),this._pivotMatrix=V.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new G.b,this._nonUniformScaling=!1,c&&this.XZ().addTransformNode(this)}getClassName(){return"Ac"}get position(){return this._position}set position(Z){this._position=Z,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(Z){this._rotation=Z,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Pc(){return this._scaling}set Pc(Z){this._scaling=Z,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(Z){this._rotationQuaternion=Z,Z&&this._rotation.uc(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return V.h.TransformNormalFromFloatsToRef(0,0,this.XZ().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return V.h.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return V.h.TransformNormalFromFloatsToRef(this.XZ().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(Z){return this._poseMatrix?(this._poseMatrix.R(Z),this):(this._poseMatrix=Z.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=V.b.Identity()),this._poseMatrix}_isSynchronized(){const Z=this._cache;return this._billboardMode===Z.billboardMode&&this._billboardMode===z.BILLBOARDMODE_NONE&&(!Z.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const Z=this._cache;Z.localMatrixUpdated=!1,Z.billboardMode=-1,Z.infiniteDistance=!1,Z.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(Z){return this.setPivotMatrix(Z,!1)}setPivotMatrix(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.R(Z),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=c,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=V.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const k=this.clone("Clone of "+(this.name||this.id),Z||this.parent,!0);k&&L&&L(this,k);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(k,c,L);return k}hV(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Z?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.uc(0),this._rotationQuaternion=this._rotationQuaternion||V.c.Identity(),Z.decompose(this._scaling,this._rotationQuaternion,this._position),this.Jc(!0)):(this._worldMatrix=Z,this._absolutePosition.wc(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Jc(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Jc(!0),this}get Si(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Jc(),this._absolutePosition}setAbsolutePosition(Z){if(!Z)return this;let c,L,k;if(void 0===Z.x){if(arguments.length<3)return this;c=arguments[0],L=arguments[1],k=arguments[2]}else c=Z.x,L=Z.y,k=Z.z;if(this.parent){const Z=V.d.Matrix[0];this.parent.getWorldMatrix().invertToRef(Z),V.h.TransformCoordinatesFromFloatsToRef(c,L,k,Z,this.position)}else this.position.x=c,this.position.y=L,this.position.z=k;return this._absolutePosition.R(Z),this}setPositionWithLocalVector(Z){return this.Jc(),this.position=V.h.TransformNormal(Z,this.it),this}getPositionExpressedInLocalSpace(){this.Jc();const Z=V.d.Matrix[0];return this.it.invertToRef(Z),V.h.TransformNormal(this.position,Z)}locallyTranslate(Z){return this.Jc(!0),this.position=V.h.TransformCoordinates(Z,this.it),this}lookAt(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const R=z._LookAtVectorCache,G=0===N?this.position:this.getAbsolutePosition();if(Z.subtractToRef(G,R),this.setDirection(R,c,L,k),1===N&&this.parent)if(this.rotationQuaternion){const Z=V.d.Matrix[0];this.rotationQuaternion.toRotationMatrix(Z);const c=V.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),Z.multiplyToRef(c,Z),this.rotationQuaternion.fromRotationMatrix(Z)}else{const Z=V.d.Quaternion[0];V.c.FromEulerVectorToRef(this.rotation,Z);const c=V.d.Matrix[0];Z.toRotationMatrix(c);const L=V.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(L),L.invert(),c.multiplyToRef(L,c),Z.fromRotationMatrix(c),Z.toEulerAnglesToRef(this.rotation)}return this}wp(Z){const c=V.h.Zero();return this.getDirectionToRef(Z,c),c}getDirectionToRef(Z,c){return V.h.TransformNormalToRef(Z,this.getWorldMatrix(),c),this}setDirection(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=-Math.atan2(Z.z,Z.x)+Math.PI/2,R=Math.sqrt(Z.x*Z.x+Z.z*Z.z),G=-Math.atan2(Z.y,R);return this.rotationQuaternion?V.c.RotationYawPitchRollToRef(N+c,G+L,k,this.rotationQuaternion):(this.rotation.x=G+L,this.rotation.y=N+c,this.rotation.z=k),this}setPivotPoint(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.XZ().getRenderId()&&this.Jc(!0);const L=this.getWorldMatrix();if(1==c){const c=V.d.Matrix[0];L.invertToRef(c),Z=V.h.TransformCoordinates(Z,c)}return this.setPivotMatrix(V.b.Translation(-Z.x,-Z.y,-Z.z),!0)}getPivotPoint(){const Z=V.h.Zero();return this.getPivotPointToRef(Z),Z}getPivotPointToRef(Z){return Z.x=-this._pivotMatrix.m[12],Z.y=-this._pivotMatrix.m[13],Z.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const Z=V.h.Zero();return this.getAbsolutePivotPointToRef(Z),Z}getAbsolutePivotPointToRef(Z){return this.getPivotPointToRef(Z),V.h.TransformCoordinatesToRef(Z,this.getWorldMatrix(),Z),this}DJ(Z){if(this._isDirty)return this;if(this._children)for(const c of this._children)c.DJ(Z);return super.DJ(Z)}setParent(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Z&&!this.parent)return this;const k=V.d.Quaternion[0],N=V.d.Mc[0],R=V.d.Mc[1],G=V.d.Matrix[1];V.b.IdentityToRef(G);const p=V.d.Matrix[0];this.Jc(!0);let J=this.rotationQuaternion;return J||(J=z._TmpRotation,V.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,J)),V.b.ComposeToRef(this.Pc,J,this.position,p),this.parent&&p.multiplyToRef(this.parent.Jc(!0),p),Z&&(Z.Jc(!0).invertToRef(G),p.multiplyToRef(G,p)),p.decompose(R,k,N,c?this:void 0),this.rotationQuaternion?this.rotationQuaternion.R(k):k.toEulerAnglesToRef(this.rotation),this.Pc.R(R),this.position.R(N),this.parent=Z,L&&this.setPivotMatrix(V.b.Identity()),this}addChild(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Z.setParent(this,c),this}removeChild(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Z.parent!==this||Z.setParent(null,c),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(Z){return this._nonUniformScaling!==Z&&(this._nonUniformScaling=Z,!0)}attachToBone(Z,c){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=c,this.parent=Z,Z.getSkeleton().prepare(!0),Z.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=Z?this._currentParentWhenAttachingToBone:null,this):(Z&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(Z,c,L){let k;if(Z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.uc(0)),L&&0!==L){if(this.parent){const L=this.parent.getWorldMatrix(),k=V.d.Matrix[0];L.invertToRef(k),Z=V.h.TransformNormal(Z,k),L.determinant()<0&&(c*=-1)}k=V.c.RotationAxisToRef(Z,c,z._RotationAxisCache),k.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else k=V.c.RotationAxisToRef(Z,c,z._RotationAxisCache),this.rotationQuaternion.multiplyToRef(k,this.rotationQuaternion);return this}rotateAround(Z,c,L){c.normalize(),this.rotationQuaternion||(this.rotationQuaternion=V.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.uc(0));const k=V.d.Mc[0],N=V.d.Mc[1],R=V.d.Mc[2],G=V.d.Quaternion[0],p=V.d.Matrix[0],J=V.d.Matrix[1],z=V.d.Matrix[2],i=V.d.Matrix[3];return Z.subtractToRef(this.position,k),V.b.TranslationToRef(k.x,k.y,k.z,p),V.b.TranslationToRef(-k.x,-k.y,-k.z,J),V.b.RotationAxisToRef(c,L,z),J.multiplyToRef(z,i),i.multiplyToRef(p,i),i.decompose(N,G,R),this.position.addInPlace(R),G.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(Z,c,L){const k=Z.scale(c);if(L&&0!==L)this.setAbsolutePosition(this.getAbsolutePosition().add(k));else{const Z=this.getPositionExpressedInLocalSpace().add(k);this.setPositionWithLocalVector(Z)}return this}addRotation(Z,c,L){let k;this.rotationQuaternion?k=this.rotationQuaternion:(k=V.d.Quaternion[1],V.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,k));const N=V.d.Quaternion[0];return V.c.RotationYawPitchRollToRef(c,Z,L,N),k.multiplyInPlace(N),this.rotationQuaternion||k.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==z.BILLBOARDMODE_NONE}Jc(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const L=this.XZ().getRenderId();if(!this._isDirty&&!Z&&(this._currentRenderId===L||this.isSynchronized()))return this._currentRenderId=L,this._worldMatrix;c=c||this.XZ().activeCamera,this._updateCache();const k=this._cache;k.pivotMatrixUpdated=!1,k.billboardMode=this.billboardMode,k.infiniteDistance=this.infiniteDistance,k.parent=this._parentNode,this._currentRenderId=L,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const N=this._getEffectiveParent(),R=z._TmpScaling;let G,p=this._position;if(this._infiniteDistance&&!this.parent&&c){const Z=c.getWorldMatrix(),L=new V.h(Z.m[12],Z.m[13],Z.m[14]);p=z._TmpTranslation,p.wc(this._position.x+L.x,this._position.y+L.y,this._position.z+L.z)}if(R.wc(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,G=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(V.c.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.wc(0,0,0))}}else G=z._TmpRotation,V.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,G);if(this._usePivotMatrix){const Z=V.d.Matrix[1];V.b.ScalingToRef(R.x,R.y,R.z,Z);const c=V.d.Matrix[0];G.toRotationMatrix(c),this._pivotMatrix.multiplyToRef(Z,V.d.Matrix[4]),V.d.Matrix[4].multiplyToRef(c,this.it),this._postMultiplyPivotMatrix&&this.it.multiplyToRef(this._pivotMatrixInverse,this.it),this.it.addTranslationFromFloats(p.x,p.y,p.z)}else V.b.ComposeToRef(R,G,p,this.it);if(N&&N.getWorldMatrix){if(Z&&N.Jc(Z),this.billboardMode){if(this._transformToBoneReferal){const Z=this.parent;Z.getSkeleton().prepare(),Z.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),V.d.Matrix[7])}else V.d.Matrix[7].R(N.getWorldMatrix());const Z=V.d.Mc[5],c=V.d.Mc[6],L=V.d.Quaternion[0];V.d.Matrix[7].decompose(c,L,Z),V.b.ScalingToRef(c.x,c.y,c.z,V.d.Matrix[7]),V.d.Matrix[7].setTranslation(Z),z.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(L,Z),this.it.setTranslation(Z)),this.it.multiplyToRef(V.d.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const Z=this.parent;Z.getSkeleton().prepare(),this.it.multiplyToRef(Z.getFinalMatrix(),V.d.Matrix[6]),V.d.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.it.multiplyToRef(N.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.R(this.it);if(c&&this.billboardMode)if(k.useBillboardPosition){if(k.useBillboardPosition){const Z=V.d.Mc[0];this._worldMatrix.getTranslationToRef(Z);const L=c.globalPosition;this._worldMatrix.invertToRef(V.d.Matrix[1]);const k=V.d.Mc[1];V.h.TransformCoordinatesToRef(L,V.d.Matrix[1],k),k.normalize();const N=-Math.atan2(k.z,k.x)+Math.PI/2,R=Math.sqrt(k.x*k.x+k.z*k.z),G=-Math.atan2(k.y,R);if(V.c.RotationYawPitchRollToRef(N,G,0,V.d.Quaternion[0]),(this.billboardMode&z.BILLBOARDMODE_ALL)!==z.BILLBOARDMODE_ALL){const Z=V.d.Mc[1];V.d.Quaternion[0].toEulerAnglesToRef(Z),(this.billboardMode&z.BILLBOARDMODE_X)!==z.BILLBOARDMODE_X&&(Z.x=0),(this.billboardMode&z.BILLBOARDMODE_Y)!==z.BILLBOARDMODE_Y&&(Z.y=0),(this.billboardMode&z.BILLBOARDMODE_Z)!==z.BILLBOARDMODE_Z&&(Z.z=0),V.b.RotationYawPitchRollToRef(Z.y,Z.x,Z.z,V.d.Matrix[0])}else V.b.FromQuaternionToRef(V.d.Quaternion[0],V.d.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(V.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(V.d.Mc[0])}}else{const Z=V.d.Mc[0];if(this._worldMatrix.getTranslationToRef(Z),V.d.Matrix[1].R(c.getViewMatrix()),V.d.Matrix[1].setTranslationFromFloats(0,0,0),V.d.Matrix[1].invertToRef(V.d.Matrix[0]),(this.billboardMode&z.BILLBOARDMODE_ALL)!==z.BILLBOARDMODE_ALL){V.d.Matrix[0].decompose(void 0,V.d.Quaternion[0],void 0);const Z=V.d.Mc[1];V.d.Quaternion[0].toEulerAnglesToRef(Z),(this.billboardMode&z.BILLBOARDMODE_X)!==z.BILLBOARDMODE_X&&(Z.x=0),(this.billboardMode&z.BILLBOARDMODE_Y)!==z.BILLBOARDMODE_Y&&(Z.y=0),(this.billboardMode&z.BILLBOARDMODE_Z)!==z.BILLBOARDMODE_Z&&(Z.z=0),V.b.RotationYawPitchRollToRef(Z.y,Z.x,Z.z,V.d.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(V.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(V.d.Mc[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):N&&N._nonUniformScaling?this._updateNonUniformScalingState(N._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.wc(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=V.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Jc(),Z){const Z=this.getChildren();for(let c=0;c<Z.length;++c){const L=Z[c];if(L){L.Jc();const Z=V.d.Matrix[0];L.it.multiplyToRef(this.it,Z);const c=V.d.Quaternion[0];Z.decompose(L.Pc,c,L.position),L.rotationQuaternion?L.rotationQuaternion.R(c):c.toEulerAnglesToRef(L.rotation)}}}this.Pc.wc(1,1,1),this.position.wc(0,0,0),this.rotation.wc(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=V.c.Identity()),this._worldMatrix=V.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(Z){return this.onAfterWorldMatrixUpdateObservable.add(Z),this}unregisterAfterWorldMatrixUpdate(Z){return this.onAfterWorldMatrixUpdateObservable.removeCallback(Z),this}getPositionInCameraSpace(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Z||(Z=this.XZ().activeCamera),V.h.TransformCoordinates(this.getAbsolutePosition(),Z.getViewMatrix())}getDistanceToCamera(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Z||(Z=this.XZ().activeCamera),this.getAbsolutePosition().yL(Z.globalPosition).length()}clone(Z,c,L){const k=R.e.Clone((()=>new z(Z,this.XZ())),this);if(k.name=Z,k.id=Z,c&&(k.parent=c),!L){const c=this.getDescendants(!0);for(let L=0;L<c.length;L++){const N=c[L];N.clone&&N.clone(Z+"."+N.name,k)}}return k}serialize(Z){const c=R.e.Serialize(this,Z);return c.type=this.getClassName(),c.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(c),c.localMatrix=this.getPivotMatrix().xc(),c.isEnabled=this.isEnabled(),R.e.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c}static Parse(Z,c,L){const k=R.e.Parse((()=>new z(Z.name,c)),Z,c,L);if(Z.localMatrix?k.setPreTransformMatrix(V.b.oc(Z.localMatrix)):Z.pivotMatrix&&k.setPivotMatrix(V.b.oc(Z.pivotMatrix)),k.lV(Z.isEnabled),k._waitingParsedUniqueId=Z.uniqueId,void 0!==Z.parentId&&(k._waitingParentId=Z.parentId),void 0!==Z.parentInstanceIndex&&(k._waitingParentInstanceIndex=Z.parentInstanceIndex),Z.animations){for(let c=0;c<Z.animations.length;c++){const L=Z.animations[c],N=(0,J.d)("BABYLON.Animation");N&&k.animations.push(N.Parse(L))}p.b.ParseAnimationRanges(k,Z,c)}return Z.autoAnimate&&c.beginAnimation(k,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),k}getChildTransformNodes(Z,c){const L=[];return this._getDescendants(L,Z,(Z=>(!c||c(Z))&&Z instanceof z)),L}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.XZ().stopAnimation(this),this.XZ().removeTransformNode(this),this._parentContainer){const Z=this._parentContainer.transformNodes.indexOf(this);Z>-1&&this._parentContainer.transformNodes.splice(Z,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),Z){const Z=this.getChildTransformNodes(!0);for(const c of Z)c.parent=null,c.Jc(!0)}super.dispose(Z,c)}normalizeToUnitCube(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,k=null,N=null;c&&(this.rotationQuaternion?(N=this.rotationQuaternion.clone(),this.rotationQuaternion.wc(0,0,0,1)):this.rotation&&(k=this.rotation.clone(),this.rotation.wc(0,0,0)));const R=this.getHierarchyBoundingVectors(Z,L),G=R.max.yL(R.min),V=Math.max(G.x,G.y,G.z);if(0===V)return this;const p=1/V;return this.Pc.scaleInPlace(p),c&&(this.rotationQuaternion&&N?this.rotationQuaternion.R(N):this.rotation&&k&&this.rotation.R(k)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}z.BILLBOARDMODE_NONE=0,z.BILLBOARDMODE_X=1,z.BILLBOARDMODE_Y=2,z.BILLBOARDMODE_Z=4,z.BILLBOARDMODE_ALL=7,z.BILLBOARDMODE_USE_POSITION=128,z.BillboardUseParentOrientation=!1,z._TmpRotation=V.c.Zero(),z._TmpScaling=V.h.Zero(),z._TmpTranslation=V.h.Zero(),z._LookAtVectorCache=new V.h(0,0,0),z._RotationAxisCache=new V.c,(0,k.d)([(0,N.F)("position")],z.prototype,"_position",void 0),(0,k.d)([(0,N.F)("rotation")],z.prototype,"_rotation",void 0),(0,k.d)([(0,N.z)("rotationQuaternion")],z.prototype,"_rotationQuaternion",void 0),(0,k.d)([(0,N.F)("Pc")],z.prototype,"_scaling",void 0),(0,k.d)([(0,N.H)("billboardMode")],z.prototype,"_billboardMode",void 0),(0,k.d)([(0,N.H)()],z.prototype,"scalingDeterminant",void 0),(0,k.d)([(0,N.H)("infiniteDistance")],z.prototype,"_infiniteDistance",void 0),(0,k.d)([(0,N.H)()],z.prototype,"ignoreNonUniformScaling",void 0),(0,k.d)([(0,N.H)()],z.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11683:(Z,c,L)=>{L.d(c,{d:()=>J});var k=L(10993),N=L(11032),R=L(11461),G=L(10999),V=L(11255);class p{constructor(Z,c,L,k){this.name=Z,this.worldAxisForNormal=c,this.worldAxisForFileX=L,this.worldAxisForFileY=k}}class J{static ConvertCubeMapTextureToSphericalPolynomial(Z){var c;if(!Z.isCube)return null;null===(c=Z.XZ())||void 0===c||c.getEngine().flushFramebuffer();const L=Z.getSize().width,k=Z.readPixels(0,void 0,void 0,!1),N=Z.readPixels(1,void 0,void 0,!1);let R,G;Z.isRenderTarget?(R=Z.readPixels(3,void 0,void 0,!1),G=Z.readPixels(2,void 0,void 0,!1)):(R=Z.readPixels(2,void 0,void 0,!1),G=Z.readPixels(3,void 0,void 0,!1));const V=Z.readPixels(4,void 0,void 0,!1),p=Z.readPixels(5,void 0,void 0,!1),J=Z.gammaSpace;let z=0;return 1!=Z.textureType&&2!=Z.textureType||(z=1),new Promise((Z=>{Promise.all([N,k,R,G,V,p]).then((c=>{let[k,N,R,G,V,p]=c;const i={size:L,right:N,left:k,up:R,down:G,front:V,back:p,format:5,type:z,gammaSpace:J};Z(this.ConvertCubeMapToSphericalPolynomial(i))}))}))}static _AreaElement(Z,c){return Math.atan2(Z*c,Math.sqrt(Z*Z+c*c+1))}static ConvertCubeMapToSphericalPolynomial(Z){const c=new R.c;let L=0;const k=2/Z.size,p=k,J=.5*k,z=J-1;for(let R=0;R<6;R++){const i=this._FileFaces[R],t=Z[i.name];let E=z;const x=5===Z.format?4:3;for(let R=0;R<Z.size;R++){let q=z;for(let p=0;p<Z.size;p++){const z=i.worldAxisForFileX.scale(q).add(i.worldAxisForFileY.scale(E)).add(i.worldAxisForNormal);z.normalize();const O=this._AreaElement(q-J,E-J)-this._AreaElement(q-J,E+J)-this._AreaElement(q+J,E-J)+this._AreaElement(q+J,E+J);let w=t[R*Z.size*x+p*x+0],M=t[R*Z.size*x+p*x+1],P=t[R*Z.size*x+p*x+2];isNaN(w)&&(w=0),isNaN(M)&&(M=0),isNaN(P)&&(P=0),0===Z.type&&(w/=255,M/=255,P/=255),Z.gammaSpace&&(w=Math.pow((0,N.Clamp)(w),G.m),M=Math.pow((0,N.Clamp)(M),G.m),P=Math.pow((0,N.Clamp)(P),G.m));const j=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Z=Math.max(w,M,P);if(Z>j){const c=j/Z;w*=c,M*=c,P*=c}}else w=(0,N.Clamp)(w,0,j),M=(0,N.Clamp)(M,0,j),P=(0,N.Clamp)(P,0,j);const o=new V.d(w,M,P);c.addLight(z,o,O),L+=O,q+=k}E+=p}}const i=6*(4*Math.PI)/6/L;return c.scaleInPlace(i),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),R.d.FromHarmonics(c)}}J._FileFaces=[new p("right",new k.h(1,0,0),new k.h(0,0,-1),new k.h(0,-1,0)),new p("left",new k.h(-1,0,0),new k.h(0,0,1),new k.h(0,-1,0)),new p("up",new k.h(0,1,0),new k.h(1,0,0),new k.h(0,0,1)),new p("down",new k.h(0,-1,0),new k.h(1,0,0),new k.h(0,0,-1)),new p("front",new k.h(0,0,1),new k.h(1,0,0),new k.h(0,-1,0)),new p("back",new k.h(0,0,-1),new k.h(-1,0,0),new k.h(0,-1,0))],J.MAX_HDRI_VALUE=4096,J.PRESERVE_CLAMPED_COLORS=!1},11008:(Z,c,L)=>{function k(Z,c){const L=[];for(let k=0;k<Z;++k)L.push(c());return L}function N(Z,c){return k(Z,c)}L.d(c,{b:()=>k,f:()=>N,h:()=>G});const R=["push","splice","pop","shift","unshift"];function G(Z,c){const L=R.map((L=>function(Z,c,L){const k=Z[c];if("function"!==typeof k)return null;const N=function(){const k=Z.length,R=N.previous.apply(Z,arguments);return L(c,k),R};return k.next=N,N.previous=k,Z[c]=N,()=>{const L=N.previous;if(!L)return;const k=N.next;k?(L.next=k,k.previous=L):(L.next=void 0,Z[c]=L),N.next=void 0,N.previous=void 0}}(Z,L,c)));return()=>{for(const Z of L)null===Z||void 0===Z||Z()}}},11569:(Z,c,L)=>{L.d(c,{d:()=>G});var k=L(11508),N=L(11574);let R=0;const G=Z=>{if(!Z.environmentBRDFTexture){const c=Z.useDelayedTextureLoading;Z.useDelayedTextureLoading=!1;const L=Z._blockEntityCollection;Z._blockEntityCollection=!1;const G=k.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+R++,Z,!0,!1,k.c.BILINEAR_SAMPLINGMODE);Z._blockEntityCollection=L;const V=Z.getEngine().getLoadedTexturesCache(),p=V.indexOf(G.getInternalTexture());-1!==p&&V.splice(p,1),G.isRGBD=!0,G.wrapU=k.c.CLAMP_ADDRESSMODE,G.wrapV=k.c.CLAMP_ADDRESSMODE,Z.environmentBRDFTexture=G,Z.useDelayedTextureLoading=c,N.d.ExpandRGBDTexture(G);const J=Z.getEngine().onContextRestoredObservable.add((()=>{G.isRGBD=!0;const c=Z.onBeforeRenderObservable.add((()=>{G.isReady()&&(Z.onBeforeRenderObservable.remove(c),N.d.ExpandRGBDTexture(G))}))}));Z.Xc.add((()=>{Z.getEngine().onContextRestoredObservable.remove(J)}))}return Z.environmentBRDFTexture}},11298:(Z,c,L)=>{function k(Z,c,L){try{const k=Z.next();k.done?c(k):k.value?k.value.then((()=>{k.value=void 0,c(k)}),L):c(k)}catch(k){L(k)}}function N(){let Z,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(L,N,R)=>{const G=performance.now();void 0===Z||G-Z>c?(Z=G,setTimeout((()=>{k(L,N,R)}),0)):k(L,N,R)}}function R(Z,c,L,k,N){const R=()=>{let G;const V=Z=>{Z.done?L(Z.value):void 0===G?G=!0:R()};do{G=void 0,N&&N.aborted?k(new Error("Aborted")):c(Z,V,k),void 0===G&&(G=!1)}while(G)};R()}function G(Z,c){let L;return R(Z,k,(Z=>L=Z),(Z=>{throw Z}),c),L}async function V(Z,c,L){return await new Promise(((k,N)=>{R(Z,c,k,N,L)}))}function p(Z,c){return function(){return G(Z(...arguments),c)}}L.d(c,{c:()=>N,d:()=>p,g:()=>V,k:()=>G})},11180:(Z,c,L)=>{L.d(c,{b:()=>R,e:()=>G});const k={},N={};function R(Z){const c=Z.getClassName();return N[c]||(N[c]={}),N[c]}function G(Z){const c=Z.getClassName();if(k[c])return k[c];k[c]={};const L=k[c];let R=Z,G=c;for(;G;){const Z=N[G];for(const N in Z)L[N]=Z[N];let c,k=!1;do{if(c=Object.getPrototypeOf(R),!c.getClassName){k=!0;break}if(c.getClassName()!==G)break;R=c}while(c);if(k)break;G=c.getClassName(),R=c}return L}},11173:(Z,c,L)=>{L.d(c,{A:()=>V,B:()=>z,F:()=>i,H:()=>G,e:()=>R,h:()=>M,l:()=>E,m:()=>p,p:()=>x,q:()=>J,u:()=>q,v:()=>w,x:()=>t,z:()=>O});var k=L(11180);function N(Z,c){return(L,N)=>{const R=(0,k.b)(L);R[N]||(R[N]={type:Z,sourceName:c})}}function R(Z){return function(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(L,k)=>{const N=c||"_"+k;Object.defineProperty(L,k,{get:function(){return this[N]},set:function(c){var k;"function"===typeof(null===(k=this[N])||void 0===k?void 0:k.equals)&&this[N].equals(c)||this[N]!==c&&(this[N]=c,L[Z].apply(this))},enumerable:!0,configurable:!0})}}(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function G(Z){return N(0,Z)}function V(Z){return N(1,Z)}function p(Z){return N(2,Z)}function J(Z){return N(3,Z)}function z(Z){return N(4,Z)}function i(Z){return N(5,Z)}function t(Z){return N(6,Z)}function E(Z){return N(7,Z)}function x(Z){return N(8,Z)}function q(Z){return N(9,Z)}function O(Z){return N(10,Z)}function w(Z){return N(12,Z)}function M(Z,c,L,k){const N=L.value;L.value=function(){let L=N;if("undefined"!==typeof _native&&_native[c]){const Z=_native[c];L=k?function(){return k(...arguments)?Z(...arguments):N(...arguments)}:Z}return Z[c]=L,L(...arguments)}}M.filter=function(Z){return(c,L,k)=>M(c,L,k,Z)}},11242:(Z,c,L)=>{L.d(c,{e:()=>J});var k=L(11070),N=L(11251),R=L(11255),G=L(10993),V=L(11180);const p=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const R=Z();N.b&&N.b.HasTags(c)&&N.b.AddTagsTo(R,N.b.GetTags(c,!0));const G=(0,V.e)(R),p={};for(const N in G){const Z=G[N],V=c[N],z=Z.type;if(void 0!==V&&null!==V&&("uniqueId"!==N||J.AllowLoadingUniqueId))switch(z){case 0:case 6:case 9:case 11:R[N]=V;break;case 1:k.cloneTexturesOnlyOnce&&p[V.uniqueId]?R[N]=p[V.uniqueId]:(R[N]=L||V.isRenderTarget?V:V.clone(),p[V.uniqueId]=R[N]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:R[N]=L?V:V.clone()}}return R};class J{static AppendSerializedAnimations(Z,c){if(Z.animations){c.animations=[];for(let L=0;L<Z.animations.length;L++){const k=Z.animations[L];c.animations.push(k.serialize())}}}static Serialize(Z,c){c||(c={}),N.b&&(c.tags=N.b.GetTags(Z));const L=(0,V.e)(Z);for(const k in L){const N=L[k],R=N.sourceName||k,G=N.type,V=Z[k];if(void 0!==V&&null!==V&&("uniqueId"!==k||J.AllowLoadingUniqueId))switch(G){case 0:c[R]=V;break;case 1:case 3:case 7:case 9:c[R]=V.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:c[R]=V.xc();break;case 6:case 11:c[R]=V.id}}return c}static ParseProperties(Z,c,L,k){k||(k="");const N=(0,V.e)(c);for(const V in N){const p=N[V],z=Z[p.sourceName||V],i=p.type;if(void 0!==z&&null!==z&&("uniqueId"!==V||J.AllowLoadingUniqueId)){const Z=c;switch(i){case 0:Z[V]=z;break;case 1:L&&(Z[V]=J._TextureParser(z,L,k));break;case 2:Z[V]=R.d.oc(z);break;case 3:Z[V]=J._FresnelParametersParser(z);break;case 4:Z[V]=G.f.oc(z);break;case 5:Z[V]=G.h.oc(z);break;case 6:L&&(Z[V]=L.getLastMeshById(z));break;case 7:Z[V]=J._ColorCurvesParser(z);break;case 8:Z[V]=R.h.oc(z);break;case 9:Z[V]=J._ImageProcessingConfigurationParser(z);break;case 10:Z[V]=G.c.oc(z);break;case 11:L&&(Z[V]=L.getCameraById(z));break;case 12:Z[V]=G.b.oc(z)}}}}static Parse(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const R=Z();return N.b&&N.b.AddTagsTo(R,c.tags),J.ParseProperties(c,R,L,k),R}static Clone(Z,c){return p(Z,c,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(Z,c){return p(Z,c,!0)}}J.AllowLoadingUniqueId=!1,J._ImageProcessingConfigurationParser=Z=>{throw(0,k.e)("ImageProcessingConfiguration")},J._FresnelParametersParser=Z=>{throw(0,k.e)("FresnelParameters")},J._ColorCurvesParser=Z=>{throw(0,k.e)("ColorCurves")},J._TextureParser=(Z,c,L)=>{throw(0,k.e)("Texture")}},11058:(Z,c,L)=>{L.d(c,{d:()=>R});var k=L(11052);const N=(Z,c,L)=>Z?Z.getClassName&&"Mesh"===Z.getClassName()?null:!Z.getClassName||"SubMesh"!==Z.getClassName()&&"PhysicsBody"!==Z.getClassName()?Z.clone?Z.clone():Array.isArray(Z)?Z.slice():L&&"object"===typeof Z?{...Z}:null:Z.clone(c):null;class R{static DeepCopy(Z,c,L,R){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const V=function(Z){const c=[];do{const L=Object.getOwnPropertyNames(Z);for(const Z of L)-1===c.indexOf(Z)&&c.push(Z)}while(Z=Object.getPrototypeOf(Z));return c}(Z);for(const J of V){if("_"===J[0]&&(!R||-1===R.indexOf(J)))continue;if(J.endsWith("Observable"))continue;if(L&&-1!==L.indexOf(J))continue;const V=Z[J],z=typeof V;if("function"!==z)try{if("object"===z)if(V instanceof Uint8Array)c[J]=Uint8Array.from(V);else if(V instanceof Array){if(c[J]=[],V.length>0)if("object"==typeof V[0])for(let Z=0;Z<V.length;Z++){const L=N(V[Z],c,G);-1===c[J].indexOf(L)&&c[J].push(L)}else c[J]=V.slice(0)}else c[J]=N(V,c,G);else c[J]=V}catch(p){k.e.Warn(p.message)}}}}},11787:(Z,c,L)=>{function k(){const Z=Z=>!!Z&&"object"===typeof Z;for(var c=arguments.length,L=new Array(c),N=0;N<c;N++)L[N]=arguments[N];return L.reduce(((c,L)=>{const N=Object.keys(L);for(const R of N){const N=c[R],G=L[R];Array.isArray(N)&&Array.isArray(G)?c[R]=N.concat(...G):Z(N)&&Z(G)?c[R]=k(N,G):c[R]=G}return c}),{})}L.d(c,{e:()=>k})},11070:(Z,c,L)=>{L.d(c,{e:()=>N});const k={};function N(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!k[Z])return k[Z]=!0,`${Z} needs to be imported before as it contains a side-effect required by your code.`}},11047:(Z,c,L)=>{function k(){return"undefined"!==typeof window}function N(){return"undefined"!==typeof navigator}function R(){return"undefined"!==typeof document}function G(Z){let c="",L=Z.firstChild;for(;L;)3===L.nodeType&&(c+=L.textContent),L=L.nextSibling;return c}L.d(c,{c:()=>G,e:()=>R,g:()=>N,k:()=>k})},11556:(Z,c,L)=>{L.r(c),L.d(c,{Dispose:()=>t,DumpData:()=>i,DumpDataAsync:()=>z,DumpFramebuffer:()=>J,DumpTools:()=>E});var k=L(11532),N=L(11038),R=L(11032),G=L(11023);let V,p=null;async function J(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0;const V=await L.readPixels(0,0,Z,c);i(Z,c,new Uint8Array(V.buffer),k,N,R,!0,void 0,G)}async function z(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0;return await new Promise((p=>{i(Z,c,L,(Z=>p(Z)),k,N,R,G,V)}))}function i(Z,c,J,z){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",E=arguments.length>5?arguments[5]:void 0,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8?arguments[8]:void 0;(async function(){return p||(p=new Promise(((Z,c)=>{let N,R=null;const p={yJ:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(L.bind(L,11397)).then((J=>{let{ThinEngine:z}=J;const i=G.d.Instances.length;try{N=new OffscreenCanvas(100,100),R=new z(N,!1,p)}catch(q){var E;i<G.d.Instances.length&&(null===(E=G.d.Instances.pop())||void 0===E||E.dispose()),N=document.createElement("canvas"),R=new z(N,!1,p)}G.d.Instances.pop(),G.d.OnEnginesDisposedObservable.add((Z=>{R&&Z!==R&&!R.p&&0===G.d.Instances.length&&t()})),R.getCaps().parallelShaderCompile=void 0;const x=new k.c(R);L.e(37).then(L.bind(L,13627)).then((L=>{let{passPixelShader:G}=L;if(!R)return void c("Engine is not defined");const p=new k.f({xV:R,name:G.name,fragmentShader:G.shader,samplerNames:["textureSampler"]});V={canvas:N,xV:R,renderer:x,wrapper:p},Z(V)}))})).catch(c)}))),await p})().then((L=>{if(L.xV.setSize(Z,c,!0),J instanceof Float32Array){const Z=new Uint8Array(J.length);let c=J.length;for(;c--;){const L=J[c];Z[c]=Math.round(255*(0,R.Clamp)(L))}J=Z}const k=L.xV.createRawTexture(J,Z,c,5,!1,!x,1);L.renderer.setViewport(),L.renderer.applyEffectWrapper(L.wrapper),L.wrapper.effect._bindTexture("textureSampler",k),L.renderer.draw(),q?N.c.ToBlob(L.canvas,(Z=>{const c=new FileReader;c.onload=Z=>{const c=Z.target.result;z&&z(c)},c.readAsArrayBuffer(Z)}),i,O):N.c.EncodeScreenshotCanvasData(L.canvas,z,i,E,O),k.dispose()}))}function t(){var Z;V?(V.wrapper.dispose(),V.renderer.dispose(),V.xV.dispose()):null===(Z=p)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.xV.dispose()}));p=null,V=null}const E={DumpData:i,DumpDataAsync:z,DumpFramebuffer:J,Dispose:t};N.c.DumpData=i,N.c.DumpDataAsync=z,N.c.DumpFramebuffer=J},11085:(Z,c,L)=>{L.d(c,{c:()=>k,e:()=>N,h:()=>R});class k extends Error{}k._setPrototypeOf=Object.setPrototypeOf||((Z,c)=>(Z.__proto__=c,Z));const N={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class R extends k{constructor(Z,c,L){super(Z),this.errorCode=c,this.innerError=L,this.name="RuntimeError",k._setPrototypeOf(this,R.prototype)}}},11081:(Z,c,L)=>{L.d(c,{c:()=>W,f:()=>P,g:()=>D,h:()=>H,o:()=>h,l:()=>O,s:()=>u,v:()=>X,w:()=>B,A:()=>j});var k=L(11079),N=L(11047),R=L(11027);class G{}G.FilesToLoad={};var V=L(11085),p=L(11090),J=L(11095),z=L(11023),i=L(11052),t=L(11108),E=L(11102),x=L(11110);const q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class O extends V.h{constructor(Z,c){super(Z,V.e.LoadFileError),this.name="LoadFileError",V.c._setPrototypeOf(this,O.prototype),c instanceof k.b?this.request=c:this.file=c}}class w extends V.h{constructor(Z,c){super(Z,V.e.RequestFileError),this.request=c,this.name="RequestFileError",V.c._setPrototypeOf(this,w.prototype)}}class M extends V.h{constructor(Z,c){super(Z,V.e.ReadFileError),this.file=c,this.name="ReadFileError",V.c._setPrototypeOf(this,M.prototype)}}const P={DefaultRetryStrategy:class{static ExponentialBackoff(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(L,k,N)=>0!==k.status||N>=Z||-1!==L.indexOf("file:")?-1:Math.pow(2,N)*c}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:Z=>Z,ScriptBaseUrl:"",ScriptPreprocessUrl:Z=>Z,CleanUrl:Z=>Z=Z.replace(/#/gm,"%23")},j=(Z,c)=>{if((!Z||0!==Z.indexOf("data:"))&&P.CorsBehavior)if("string"===typeof P.CorsBehavior||P.CorsBehavior instanceof String)c.crossOrigin=P.CorsBehavior;else{const L=P.CorsBehavior(Z);L&&(c.crossOrigin=L)}},o={getRequiredSize:null},u=function(Z,c,L,N){let R,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",J=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===i||void 0===i||!i._features.forceBitmapOverHTMLImageElement))return L("LoadImage is only supported in web or BabylonNative environments."),null;let t=!1;Z instanceof ArrayBuffer||ArrayBuffer.isView(Z)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(R=URL.createObjectURL(new Blob([Z],{type:V})),t=!0):R=`data:${V};base64,`+(0,p.h)(Z):Z instanceof Blob?(R=URL.createObjectURL(Z),t=!0):(R=P.CleanUrl(Z),R=P.PreprocessUrl(R));const E=c=>{if(L){const k=R||Z.toString();L(`Error while trying to load image: ${0===k.indexOf("http")||k.length<=128?k:k.slice(0,128)+"..."}`,c)}};if(null!==i&&void 0!==i&&i._features.forceBitmapOverHTMLImageElement)return h(R,(k=>{i.createImageBitmap(new Blob([k],{type:V}),{premultiplyAlpha:"none",...J}).then((Z=>{c(Z),t&&URL.revokeObjectURL(R)})).catch((c=>{L&&L("Error while trying to load image: "+Z,c)}))}),void 0,N||void 0,!0,((Z,c)=>{E(c)})),null;const x=new Image;if(o.getRequiredSize){const c=o.getRequiredSize(Z);c.width&&(x.width=c.width),c.height&&(x.height=c.height)}j(R,x);const q=[],O=()=>{for(const Z of q)Z.target.removeEventListener(Z.name,Z.handler);q.length=0};q.push({target:x,name:"load",handler:()=>{O(),c(x),t&&x.src&&URL.revokeObjectURL(x.src)}}),q.push({target:x,name:"error",handler:Z=>{O(),E(Z),t&&x.src&&URL.revokeObjectURL(x.src)}}),q.push({target:document,name:"securitypolicyviolation",handler:Z=>{if(Z.blockedURI!==x.src||"bx"===Z.disposition)return;O();const c=new Error(`CSP violation of policy ${Z.effectiveDirective} ${Z.blockedURI}. Current policy is ${Z.originalPolicy}`);z.d.UseFallbackTexture=!1,E(c),t&&x.src&&URL.revokeObjectURL(x.src),x.src=""}}),(()=>{for(const Z of q)Z.target.addEventListener(Z.name,Z.handler)})();const w="blob:"===R.substring(0,5),M="data:"===R.substring(0,5),u=()=>{w||M||!k.b.IsCustomRequestAvailable?x.src=R:h(R,((Z,c,L)=>{const k=new Blob([Z],{type:!V&&L?L:V}),N=URL.createObjectURL(k);t=!0,x.src=N}),void 0,N||void 0,!0,((Z,c)=>{E(c)}))},X=()=>{N&&N.loadImage(R,x)};if(!w&&!M&&N&&N.enableTexturesOffline)N.open(X,u);else{if(-1!==R.indexOf("file:")){const Z=decodeURIComponent(R.substring(5).toLowerCase());if(G.FilesToLoad[Z]&&"undefined"!==typeof URL){try{let c;try{c=URL.createObjectURL(G.FilesToLoad[Z])}catch(B){c=URL.createObjectURL(G.FilesToLoad[Z])}x.src=c,t=!0}catch(D){x.src=""}return x}}u()}return x},X=(Z,c,L,k,N)=>{const G=new FileReader,V={onCompleteObservable:new R.b,abort:()=>G.abort()};return G.onloadend=()=>V.onCompleteObservable.notifyObservers(V),N&&(G.onerror=()=>{N(new M(`Unable to read ${Z.name}`,Z))}),G.onload=Z=>{c(Z.target.result)},L&&(G.onprogress=L),k?G.readAsArrayBuffer(Z):G.readAsText(Z),V},h=(Z,c,L,k,N,p,J)=>{if(Z.name)return X(Z,c,L,N,p?Z=>{p(void 0,Z)}:void 0);const z=Z;if(-1!==z.indexOf("file:")){let Z=decodeURIComponent(z.substring(5).toLowerCase());0===Z.indexOf("./")&&(Z=Z.substring(2));const k=G.FilesToLoad[Z];if(k)return X(k,c,L,N,p?Z=>p(void 0,new O(Z.message,Z.file)):void 0)}const{match:E,type:x}=l(z);if(E){const Z={onCompleteObservable:new R.b,abort:()=>()=>{}};try{const Z=N?W(z):T(z);c(Z,void 0,x)}catch(V){p?p(void 0,V):i.e.Error(V.message||"Failed to parse the Data URL")}return t.b.SetImmediate((()=>{Z.onCompleteObservable.notifyObservers(Z)})),Z}return B(z,((Z,L)=>{c(Z,null===L||void 0===L?void 0:L.responseURL,null===L||void 0===L?void 0:L.getResponseHeader("content-type"))}),L,k,N,p?Z=>{p(Z.request,new O(Z.message,Z.request))}:void 0,J)},B=(Z,c,L,G,V,p,J)=>{Z=P.CleanUrl(Z),Z=P.PreprocessUrl(Z);const z=P.BaseUrl+Z;let t=!1;const E={onCompleteObservable:new R.b,abort:()=>t=!0},x=()=>{let Z,R=new k.b,G=null;const x=()=>{R&&(L&&R.removeEventListener("progress",L),Z&&R.removeEventListener("readystatechange",Z),R.removeEventListener("loadend",q))};let q=()=>{x(),E.onCompleteObservable.notifyObservers(E),E.onCompleteObservable.clear(),L=void 0,Z=null,q=null,p=void 0,J=void 0,c=void 0};E.abort=()=>{t=!0,q&&q(),R&&R.readyState!==(XMLHttpRequest.DONE||4)&&R.abort(),null!==G&&(clearTimeout(G),G=null),R=null};const O=Z=>{const c=Z.message||"Unknown error";p&&R?p(new w(c,R)):i.e.Error(c)},M=i=>{if(R){if(R.open("GET",z),J)try{J(R)}catch(E){return void O(E)}V&&(R.responseType="arraybuffer"),L&&R.addEventListener("progress",L),q&&R.addEventListener("loadend",q),Z=()=>{if(!t&&R&&R.readyState===(XMLHttpRequest.DONE||4)){if(Z&&R.removeEventListener("readystatechange",Z),R.status>=200&&R.status<300||0===R.status&&(!(0,N.k)()||e())){const Z=V?R.response:R.responseText;if(null!==Z){try{c&&c(Z,R)}catch(E){O(E)}return}}const L=P.DefaultRetryStrategy;if(L){const Z=L(z,R,i);if(-1!==Z)return x(),R=new k.b,void(G=setTimeout((()=>M(i+1)),Z))}const J=new w("Error status: "+R.status+" "+R.statusText+" - Unable to load "+z,R);p&&p(J)}},R.addEventListener("readystatechange",Z),R.send()}};M(0)};if(G&&G.enableSceneOffline){const k=Z=>{Z&&Z.status>400?p&&p(Z):x()},N=()=>{G&&G.loadFile(P.BaseUrl+Z,(Z=>{!t&&c&&c(Z),E.onCompleteObservable.notifyObservers(E)}),L?Z=>{!t&&L&&L(Z)}:void 0,k,V)};G.open(N,k)}else x();return E},D=Z=>{const{match:c,type:L}=l(Z);if(c)return L||void 0;const k=Z.lastIndexOf(".");switch(Z.substring(k+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"Bc":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},e=()=>"undefined"!==typeof location&&"file:"===location.protocol,H=Z=>q.test(Z),l=Z=>{const c=q.exec(Z);if(null===c||0===c.length)return{match:!1,type:""};return{match:!0,type:c[0].replace("data:","").replace("base64,","")}};function W(Z){return(0,p.d)(Z.split(",")[1])}const T=Z=>(0,p.e)(Z.split(",")[1]);let I;x.c._FileToolsLoadImage=u,E.e.loadFile=h,J.l.loadFile=h;((Z,c,L,k,N,R,G,V,p,J)=>{I={DecodeBase64UrlToBinary:Z,DecodeBase64UrlToString:c,DefaultRetryStrategy:L.DefaultRetryStrategy,BaseUrl:L.BaseUrl,CorsBehavior:L.CorsBehavior,PreprocessUrl:L.PreprocessUrl,IsBase64DataUrl:k,IsFileURL:N,LoadFile:R,LoadImage:G,ReadFile:V,RequestFile:p,SetCorsBehavior:J},Object.defineProperty(I,"DefaultRetryStrategy",{get:function(){return L.DefaultRetryStrategy},set:function(Z){L.DefaultRetryStrategy=Z}}),Object.defineProperty(I,"BaseUrl",{get:function(){return L.BaseUrl},set:function(Z){L.BaseUrl=Z}}),Object.defineProperty(I,"PreprocessUrl",{get:function(){return L.PreprocessUrl},set:function(Z){L.PreprocessUrl=Z}}),Object.defineProperty(I,"CorsBehavior",{get:function(){return L.CorsBehavior},set:function(Z){L.CorsBehavior=Z}})})(W,T,P,H,e,h,u,X,B,j)},11155:(Z,c,L)=>{function k(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(Z=>{const c=16*Math.random()|0;return("x"===Z?c:3&c|8).toString(16)}))}L.d(c,{d:()=>k})},11153:(Z,c,L)=>{L.d(c,{d:()=>R});var k=L(11052),N=L(11012);class R{static Instantiate(Z){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[Z])return this.RegisteredExternalClasses[Z];const c=(0,N.d)(Z);if(c)return c;k.e.Warn(Z+" not found, you may have missed an import.");const L=Z.split(".");let R=window||this;for(let k=0,N=L.length;k<N;k++)R=R[L[k]];return"function"!==typeof R?null:R}}R.RegisteredExternalClasses={}},11052:(Z,c,L)=>{L.d(c,{e:()=>k});class k{static _CheckLimit(Z,c){let L=k._LogLimitOutputs[Z];return L?L.current++:(L={limit:c,current:1},k._LogLimitOutputs[Z]=L),L.current<=L.limit}static _GenerateLimitMessage(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const L=k._LogLimitOutputs[Z];if(!L||!k.MessageLimitReached)return;const N=this._Levels[c];L.current===L.limit&&k[N.name](k.MessageLimitReached.replace(/%LIMIT%/g,""+L.limit).replace(/%TYPE%/g,N.name??""))}static _AddLogEntry(Z){k._LogCache=Z+k._LogCache,k.OnNewCacheEntry&&k.OnNewCacheEntry(Z)}static _FormatMessage(Z){const c=Z=>Z<10?"0"+Z:""+Z,L=new Date;return"["+c(L.getHours())+":"+c(L.getMinutes())+":"+c(L.getSeconds())+"]: "+Z}static _LogDisabled(Z,c){}static _LogEnabled(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0;const N=Array.isArray(c)?c[0]:c;if(void 0!==L&&!k._CheckLimit(N,L))return;const R=k._FormatMessage(N),G=this._Levels[Z],V=Array.isArray(c)?c.slice(1):[];G.logFunc&&G.logFunc("BJS - "+R,...V);const p=`<div style='color:${G.color}'>${R}</div><br>`;k._AddLogEntry(p),k._GenerateLimitMessage(N,Z)}static get LogCache(){return k._LogCache}static ClearLogCache(){k._LogCache="",k._LogLimitOutputs={},k.errorsCount=0}static set LogLevels(Z){k.Log=k._LogDisabled,k.Warn=k._LogDisabled,k.Error=k._LogDisabled;const c=[k.MessageLogLevel,k.WarningLogLevel,k.ErrorLogLevel];for(const L of c)if((Z&L)===L){const Z=this._Levels[L];k[Z.name]=k._LogEnabled.bind(k,L)}}}k.NoneLogLevel=0,k.MessageLogLevel=1,k.WarningLogLevel=2,k.ErrorLogLevel=4,k.AllLogLevel=7,k.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",k._LogCache="",k._LogLimitOutputs={},k._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],k.errorsCount=0,k.Log=k._LogEnabled.bind(k,k.MessageLogLevel),k.Warn=k._LogEnabled.bind(k,k.WarningLogLevel),k.Error=k._LogEnabled.bind(k,k.ErrorLogLevel)},11027:(Z,c,L)=>{L.d(c,{b:()=>G});const k="undefined"!==typeof WeakRef;class N{constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;this.initialize(Z,c,L,k)}initialize(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;return this.mask=Z,this.skipNextObservers=c,this.target=L,this.currentTarget=k,this}}class R{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=Z,this.mask=c,this.scope=L,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(Z)}}class G{static FromPromise(Z,c){const L=new G;return Z.then((Z=>{L.notifyObservers(Z)})).catch((Z=>{if(!c)throw Z;c.notifyObservers(Z)})),L}get observers(){return this._observers}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new N(0),Z&&(this._onObserverAdded=Z)}add(Z){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Z)return null;const N=new R(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);N.unregisterOnNextCall=L,c?this._observers.unshift(N):this._observers.push(N),this._onObserverAdded&&this._onObserverAdded(N),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(N,this._lastNotifiedValue);const G=k?new WeakRef(this):{deref:()=>this};return N._remove=function(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=G.deref();c&&(Z?c.remove(N):c._remove(N))},N}addOnce(Z){return this.add(Z,void 0,void 0,void 0,!0)}remove(Z){if(!Z)return!1;Z._remove=null;return-1!==this._observers.indexOf(Z)&&(this._deferUnregister(Z),!0)}removeCallback(Z,c){for(let L=0;L<this._observers.length;L++){const k=this._observers[L];if(!k._willBeUnregistered&&(k.callback===Z&&(!c||c===k.scope)))return this._deferUnregister(k),!0}return!1}_deferUnregister(Z){Z._willBeUnregistered||(this._numObserversMarkedAsDeleted++,Z.unregisterOnNextCall=!1,Z._willBeUnregistered=!0,setTimeout((()=>{this._remove(Z)}),0))}_remove(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Z)return!1;const L=this._observers.indexOf(Z);return-1!==L&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(L,1),!0)}makeObserverTopPriority(Z){this._remove(Z,!1),this._observers.unshift(Z)}makeObserverBottomPriority(Z){this._remove(Z,!1),this._observers.push(Z)}notifyObservers(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Z),!this._observers.length)return!0;const R=this._eventState;R.mask=c,R.target=L,R.currentTarget=k,R.skipNextObservers=!1,R.lastReturnValue=Z,R.userInfo=N;for(const G of this._observers)if(!G._willBeUnregistered&&(G.mask&c&&(G.unregisterOnNextCall&&this._deferUnregister(G),G.scope?R.lastReturnValue=G.callback.apply(G.scope,[Z,R]):R.lastReturnValue=G.callback(Z,R)),R.skipNextObservers))return!1;return!0}notifyObserver(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),Z._willBeUnregistered)return;const k=this._eventState;k.mask=L,k.skipNextObservers=!1,Z.unregisterOnNextCall&&this._deferUnregister(Z),Z.callback(c,k)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const Z=this._observers.pop();Z&&(Z._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const Z=new G;return Z._observers=this._observers.slice(0),Z}hasSpecificMask(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&Z||c.mask===Z)return!0;return!1}}},11496:(Z,c,L)=>{L.d(c,{d:()=>N});var k=L(11065);class N{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(Z,c){N.Enabled&&(this._current+=Z,c&&this._fetchResult())}beginMonitoring(){N.Enabled&&(this._startMonitoringTime=k.c.Now)}endMonitoring(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!N.Enabled)return;Z&&this.fetchNewFrame();const c=k.c.Now;this._current=c-this._startMonitoringTime,Z&&this._fetchResult()}li(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const Z=k.c.Now;Z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}N.Enabled=!0},11065:(Z,c,L)=>{L.d(c,{c:()=>N});var k=L(11047);class N{static get Now(){return(0,k.k)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11574:(Z,c,L)=>{L.d(c,{d:()=>R});var k=L(11528),N=L(11503);class R{static ExpandRGBDTexture(Z){const c=Z._texture;if(!c||!Z.isRGBD)return;const N=c.getEngine(),R=N.getCaps(),G=c.isReady;let V=!1;R.textureHalfFloatRender&&R.textureHalfFloatLinearFiltering?(V=!0,c.type=2):R.textureFloatRender&&R.textureFloatLinearFiltering&&(V=!0,c.type=1),V&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const p=async()=>{const R=N.isWebGPU,G=R?1:0;c.isReady=!1,R?await L.e(21).then(L.bind(L,13673)):await L.e(14).then(L.bind(L,13681));const V=new k.d("rgbdDecode","rgbdDecode",null,null,1,null,3,N,!1,void 0,c.type,void 0,null,!1,void 0,G);V.externalTextureSamplerBinding=!0;const p=N.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});V.onEffectCreatedObservable.addOnce((L=>{L.executeWhenCompiled((()=>{V.onApply=Z=>{Z._bindTexture("textureSampler",c),Z.setFloat2("scale",1,1)},Z.XZ().postProcessManager.directRender([V],p,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(c),V&&V.dispose(),p._swapAndDie(c),c.isReady=!0}))}))};V&&(G?p():Z.onLoadObservable.addOnce(p))}static async EncodeTextureToRGBD(Z,c){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.getEngine().isWebGPU?await L.e(22).then(L.bind(L,13699)):await L.e(15).then(L.bind(L,13690)),await(0,N.e)("rgbdEncode",Z,c,k,1,5)}}},11336:(Z,c,L)=>{L.d(c,{c:()=>N,f:()=>k});class k{constructor(Z){this.length=0,this.data=new Array(Z),this._id=k._GlobalId++}push(Z){this.data[this.length++]=Z,this.length>this.data.length&&(this.data.length*=2)}forEach(Z){for(let c=0;c<this.length;c++)Z(this.data[c])}sort(Z){this.data.sort(Z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let c=0;c<Z.length;c++)this.data[this.length++]=(Z.data||Z)[c]}}indexOf(Z){const c=this.data.indexOf(Z);return c>=this.length?-1:c}contains(Z){return-1!==this.indexOf(Z)}}k._GlobalId=0;class N extends k{constructor(){super(...arguments),this._duplicateId=0}push(Z){super.push(Z),Z.__smartArrayFlags||(Z.__smartArrayFlags={}),Z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(Z){return(!Z.__smartArrayFlags||Z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let c=0;c<Z.length;c++){const L=(Z.data||Z)[c];this.pushNoDuplicate(L)}}}}},11090:(Z,c,L)=>{L.d(c,{d:()=>G,e:()=>R,g:()=>k,h:()=>N});const k=Z=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(Z);let c="";for(let L=0;L<Z.byteLength;L++)c+=String.fromCharCode(Z[L]);return c},N=Z=>{const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let L,k,N,R,G,V,p,J="",z=0;const i=ArrayBuffer.isView(Z)?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):new Uint8Array(Z);for(;z<i.length;)L=i[z++],k=z<i.length?i[z++]:Number.NaN,N=z<i.length?i[z++]:Number.NaN,R=L>>2,G=(3&L)<<4|k>>4,V=(15&k)<<2|N>>6,p=63&N,isNaN(k)?V=p=64:isNaN(N)&&(p=64),J+=c.charAt(R)+c.charAt(G)+c.charAt(V)+c.charAt(p);return J},R=Z=>atob(Z),G=Z=>{const c=R(Z),L=c.length,k=new Uint8Array(new ArrayBuffer(L));for(let N=0;N<L;N++)k[N]=c.charCodeAt(N);return k.buffer}},11251:(Z,c,L)=>{L.d(c,{b:()=>N});class k{static Eval(Z,c){return"true"===(Z=Z.match(/\([^()]*\)/g)?Z.replace(/\([^()]*\)/g,(Z=>(Z=Z.slice(1,Z.length-1),k._HandleParenthesisContent(Z,c)))):k._HandleParenthesisContent(Z,c))||"false"!==Z&&k.Eval(Z,c)}static _HandleParenthesisContent(Z,c){let L;c=c||(Z=>"true"===Z);const N=Z.split("||");for(const R in N)if(Object.prototype.hasOwnProperty.call(N,R)){let Z=k._SimplifyNegation(N[R].trim());const G=Z.split("&&");if(G.length>1)for(let N=0;N<G.length;++N){const R=k._SimplifyNegation(G[N].trim());if(L="true"!==R&&"false"!==R?"!"===R[0]?!c(R.substring(1)):c(R):"true"===R,!L){Z="false";break}}if(L||"true"===Z){L=!0;break}L="true"!==Z&&"false"!==Z?"!"===Z[0]?!c(Z.substring(1)):c(Z):"true"===Z}return L?"true":"false"}static _SimplifyNegation(Z){return"!true"===(Z=(Z=Z.replace(/^[\s!]+/,(Z=>(Z=Z.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?Z="false":"!false"===Z&&(Z="true"),Z}}class N{static EnableFor(Z){Z._tags=Z._tags||{},Z.hasTags=()=>N.HasTags(Z),Z.addTags=c=>N.AddTagsTo(Z,c),Z.removeTags=c=>N.RemoveTagsFrom(Z,c),Z.matchesTagsQuery=c=>N.MatchesQuery(Z,c)}static DisableFor(Z){delete Z._tags,delete Z.hasTags,delete Z.addTags,delete Z.removeTags,delete Z.matchesTagsQuery}static HasTags(Z){if(!Z._tags)return!1;const c=Z._tags;for(const L in c)if(Object.prototype.hasOwnProperty.call(c,L))return!0;return!1}static GetTags(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Z._tags)return null;if(c){const c=[];for(const L in Z._tags)Object.prototype.hasOwnProperty.call(Z._tags,L)&&!0===Z._tags[L]&&c.push(L);return c.join(" ")}return Z._tags}static AddTagsTo(Z,c){if(!c)return;if("string"!==typeof c)return;const L=c.split(" ");for(const k of L)N._AddTagTo(Z,k)}static _AddTagTo(Z,c){""!==(c=c.trim())&&"true"!==c&&"false"!==c&&(c.match(/[\s]/)||c.match(/^([!]|([|]|[&]){2})/)||(N.EnableFor(Z),Z._tags[c]=!0))}static RemoveTagsFrom(Z,c){if(!N.HasTags(Z))return;const L=c.split(" ");for(const k in L)N._RemoveTagFrom(Z,L[k])}static _RemoveTagFrom(Z,c){delete Z._tags[c]}static MatchesQuery(Z,c){return void 0===c||(""===c?N.HasTags(Z):k.Eval(c,(c=>N.HasTags(Z)&&Z._tags[c])))}}},11503:(Z,c,L)=>{L.d(c,{e:()=>w,g:()=>o,j:()=>X,n:()=>h,q:()=>j});var k=L(11508),N=L(11517),R=L(11170),G=L(11528),V=L(11110),p=L(11012),J=L(11242),z=L(11532),i=L(11395);class t extends z.f{_gatherImports(Z,c){Z?(this._webGPUReady=!0,c.push(Promise.all([L.e(36).then(L.bind(L,13623))]))):c.push(Promise.all([L.e(37).then(L.bind(L,13627))])),super._gatherImports(Z,c)}constructor(Z){super({...arguments.length>2?arguments[2]:void 0,name:Z,xV:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||i.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:t.FragmentUrl})}}t.FragmentUrl="pass";class E extends z.f{_gatherImports(Z,c){Z?(this._webGPUReady=!0,c.push(Promise.all([L.e(43).then(L.bind(L,13657))]))):c.push(Promise.all([L.e(44).then(L.bind(L,13664))])),super._gatherImports(Z,c)}constructor(Z){super({...arguments.length>2?arguments[2]:void 0,name:Z,xV:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||i.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:E.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(Z){if(!(Z<0||Z>5))switch(this._face=Z,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}E.FragmentUrl="passCube";var x=L(11173);class q extends G.d{getClassName(){return"PassPostProcess"}constructor(Z,c){let L=arguments.length>4?arguments[4]:void 0;const k={size:"number"===typeof c?c:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,xV:L,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...c};super(Z,t.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new t(Z,L,k),...k})}static _Parse(Z,c,L,k){return J.e.Parse((()=>new q(Z.name,Z.options,c,Z.renderTargetSamplingMode,Z._engine,Z.reusable)),Z,L,k)}}(0,p.g)("BABYLON.PassPostProcess",q);class O extends G.d{get face(){return this._effectWrapper.face}set face(Z){this._effectWrapper.face=Z}getClassName(){return"PassCubePostProcess"}constructor(Z,c){let L=arguments.length>4?arguments[4]:void 0;const k={size:"number"===typeof c?c:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,xV:L,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...c};super(Z,t.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new E(Z,L,k),...k})}static _Parse(Z,c,L,k){return J.e.Parse((()=>new O(Z.name,Z.options,c,Z.renderTargetSamplingMode,Z._engine,Z.reusable)),Z,L,k)}}function w(Z,c,L,k,N,R,V,p){const J=c.getEngine();return c.isReady=!1,N=N??c.samplingMode,k=k??c.type,R=R??c.format,V=V??c.width,p=p??c.height,-1===k&&(k=0),new Promise((z=>{const i=new G.d("postprocess",Z,null,null,1,null,N,J,!1,void 0,k,void 0,null,!1,R);i.externalTextureSamplerBinding=!0;const t=J.createRenderTargetTexture({width:V,height:p},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:N,type:k,format:R});i.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{i.onApply=Z=>{Z._bindTexture("textureSampler",c),Z.setFloat2("scale",1,1)},L.postProcessManager.directRender([i],t,!0),J.restoreDefaultFramebuffer(),J._releaseTexture(c),i&&i.dispose(),t._swapAndDie(c),c.type=k,c.format=5,c.isReady=!0,z(c)}))}))}))}let M,P;function j(Z){M||(M=new Float32Array(1),P=new Int32Array(M.buffer)),M[0]=Z;const c=P[0];let L=c>>16&32768,k=c>>12&2047;const N=c>>23&255;return N<103?L:N>142?(L|=31744,L|=(255==N?0:1)&&8388607&c,L):N<113?(k|=2048,L|=(k>>114-N)+(k>>113-N&1),L):(L|=N-112<<10|k>>1,L+=1&k,L)}function o(Z){const c=(32768&Z)>>15,L=(31744&Z)>>10,k=1023&Z;return 0===L?(c?-1:1)*Math.pow(2,-14)*(k/Math.pow(2,10)):31==L?k?NaN:1/0*(c?-1:1):(c?-1:1)*Math.pow(2,L-15)*(1+k/Math.pow(2,10))}(0,R.d)([(0,x.H)()],O.prototype,"face",null),V.c._RescalePostProcessFactory=Z=>new q("rescale",1,null,2,Z,!1,0);const u=async(Z,c,R,V,p)=>{const J=Z.XZ(),z=J.getEngine();let i;if(z.isWebGPU?Z.isCube?await L.e(40).then(L.bind(L,13641)):await L.e(41).then(L.bind(L,13647)):Z.isCube?await L.e(38).then(L.bind(L,13629)):await L.e(39).then(L.bind(L,13634)),Z.isCube){const Z=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];i=new G.d("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:k.c.NEAREST_NEAREST_MIPNEAREST,xV:z,defines:Z[V],shaderLanguage:z.isWebGPU?1:0})}else i=new G.d("lod","lod",{uniforms:["lod","gamma"],samplingMode:k.c.NEAREST_NEAREST_MIPNEAREST,xV:z,shaderLanguage:z.isWebGPU?1:0});await new Promise((Z=>{i.onEffectCreatedObservable.addOnce((c=>{c.executeWhenCompiled((()=>{Z(0)}))}))}));const t=new N.b("temp",{width:c,height:R},J,!1);i.onApply=function(c){c.setTexture("textureSampler",Z),c.setFloat("lod",p),c.setInt("gamma",Z.gammaSpace?1:0)};const E=Z.getInternalTexture();try{if(t.renderTarget&&E){const L=E.samplingMode;0!==p?Z.updateSamplingMode(k.c.NEAREST_NEAREST_MIPNEAREST):Z.updateSamplingMode(k.c.NEAREST_NEAREST),J.postProcessManager.directRender([i],t.renderTarget,!0),Z.updateSamplingMode(L);const N=await z.readPixels(0,0,c,R),G=new Uint8Array(N.buffer,0,N.byteLength);return z.unBindFramebuffer(t.renderTarget),G}throw Error("Render to texture failed.")}finally{t.dispose(),i.dispose()}};async function X(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!Z.isReady()&&Z._texture&&await new Promise(((c,L)=>{null!==Z._texture?Z._texture.onLoadedObservable.addOnce((()=>{c(0)})):L(0)})),await u(Z,c,L,k,N)}const h={CreateResizedCopy:function(Z,c,L){let R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=Z.XZ(),V=G.getEngine(),p=new N.b("resized"+Z.name,{width:c,height:L},G,!Z.noMipmap,!0,Z._texture.type,!1,Z.samplingMode,!1);p.wrapU=Z.wrapU,p.wrapV=Z.wrapV,p.uOffset=Z.uOffset,p.vOffset=Z.vOffset,p.uScale=Z.uScale,p.vScale=Z.vScale,p.uAng=Z.uAng,p.vAng=Z.vAng,p.wAng=Z.wAng,p.coordinatesIndex=Z.coordinatesIndex,p.level=Z.level,p.anisotropicFilteringLevel=Z.anisotropicFilteringLevel,p._texture.isReady=!1,Z.wrapU=k.c.CLAMP_ADDRESSMODE,Z.wrapV=k.c.CLAMP_ADDRESSMODE;const J=new q("pass",1,null,R?k.c.BILINEAR_SAMPLINGMODE:k.c.NEAREST_SAMPLINGMODE,V,!1,0);return J.externalTextureSamplerBinding=!0,J.onEffectCreatedObservable.addOnce((c=>{c.executeWhenCompiled((()=>{J.onApply=function(c){c.setTexture("textureSampler",Z)};const c=p.renderTarget;c&&(G.postProcessManager.directRender([J],c),V.unBindFramebuffer(c),p.disposeFramebufferObjects(),J.dispose(),p.getInternalTexture().isReady=!0)}))})),p},ApplyPostProcess:w,ToHalfFloat:j,FromHalfFloat:o,GetTextureDataAsync:X}},11108:(Z,c,L)=>{L.d(c,{b:()=>N,d:()=>G});let k=[];class N{static SetImmediate(Z){0===k.length&&setTimeout((()=>{const Z=k;k=[];for(const c of Z)c()}),1),k.push(Z)}}function R(Z,c,L){try{if(Z())return c(),!0}catch(k){return null===L||void 0===L||L(k),!0}return!1}const G=function(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,G=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&R(Z,c,L))return null;const V=setInterval((()=>{R(Z,c,L)?clearInterval(V):(N-=k,N<0&&(clearInterval(V),null===L||void 0===L||L(new Error("Operation timed out after maximum retries. "+(G||"")),!0)))}),k);return()=>clearInterval(V)}},11159:(Z,c,L)=>{function k(Z){let c=1;do{c*=2}while(c<Z);return c===Z}function N(Z,c,L){return Z*(1-L)+c*L}function R(Z){const c=G(Z),L=V(Z);return c-Z>Z-L?L:c}function G(Z){return Z--,Z|=Z>>1,Z|=Z>>2,Z|=Z>>4,Z|=Z>>8,Z|=Z>>16,++Z}function V(Z){return Z|=Z>>1,Z|=Z>>2,Z|=Z>>4,Z|=Z>>8,(Z|=Z>>16)-(Z>>1)}function p(Z,c){let L;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:L=V(Z);break;case 2:L=R(Z);break;default:L=G(Z)}return Math.min(L,c)}L.d(c,{e:()=>V,h:()=>p,i:()=>k,j:()=>N,n:()=>R})},11038:(Z,c,L)=>{L.d(c,{b:()=>w,c:()=>O});var k=L(11027),N=L(11047),R=L(11052),G=L(11058),V=L(11065),p=L(11070),J=L(11079),z=L(11023),i=L(11081),t=L(11108),E=L(11153),x=L(11155),q=L(11159);class O{static get BaseUrl(){return i.f.BaseUrl}static set BaseUrl(Z){i.f.BaseUrl=Z}static get CleanUrl(){return i.f.CleanUrl}static set CleanUrl(Z){i.f.CleanUrl=Z}static IsAbsoluteUrl(Z){return 0===Z.indexOf("//")||-1!==Z.indexOf("://")&&(-1!==Z.indexOf(".")&&(-1!==Z.indexOf("/")&&(!(Z.indexOf(":")>Z.indexOf("/"))&&(Z.indexOf("://")<Z.indexOf(".")||(0===Z.indexOf("data:")||0===Z.indexOf("blob:"))))))}static set ScriptBaseUrl(Z){i.f.ScriptBaseUrl=Z}static get ScriptBaseUrl(){return i.f.ScriptBaseUrl}static set CDNBaseUrl(Z){O.ScriptBaseUrl=Z,O.AssetBaseUrl=Z}static set ScriptPreprocessUrl(Z){i.f.ScriptPreprocessUrl=Z}static get ScriptPreprocessUrl(){return i.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return i.f.DefaultRetryStrategy}static set DefaultRetryStrategy(Z){i.f.DefaultRetryStrategy=Z}static get CorsBehavior(){return i.f.CorsBehavior}static set CorsBehavior(Z){i.f.CorsBehavior=Z}static get UseFallbackTexture(){return z.d.UseFallbackTexture}static set UseFallbackTexture(Z){z.d.UseFallbackTexture=Z}static get RegisteredExternalClasses(){return E.d.RegisteredExternalClasses}static set RegisteredExternalClasses(Z){E.d.RegisteredExternalClasses=Z}static get fallbackTexture(){return z.d.FallbackTexture}static set fallbackTexture(Z){z.d.FallbackTexture=Z}static FetchToRef(Z,c,L,k,N,R){const G=4*((Math.abs(Z)*L%L|0)+(Math.abs(c)*k%k|0)*L);R.r=N[G]/255,R.g=N[G+1]/255,R.b=N[G+2]/255,R.a=N[G+3]/255}static Mix(Z,c,L){return 0}static Instantiate(Z){return E.d.Instantiate(Z)}static SetImmediate(Z){t.b.SetImmediate(Z)}static IsExponentOfTwo(Z){return!0}static FloatRound(Z){return Math.fround(Z)}static GetFilename(Z){const c=Z.lastIndexOf("/");return c<0?Z:Z.substring(c+1)}static GetFolderPath(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=Z.lastIndexOf("/");return L<0?c?Z:"":Z.substring(0,L+1)}static ToDegrees(Z){return 180*Z/Math.PI}static ToRadians(Z){return Z*Math.PI/180}static SmoothAngleChange(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const k=this.ToRadians(Z),N=this.ToRadians(c);return this.ToDegrees(Math.atan2((1-L)*Math.sin(N)+L*Math.sin(k),(1-L)*Math.cos(N)+L*Math.cos(k)))}static MakeArray(Z,c){return!0===c||void 0!==Z&&null!=Z?Array.isArray(Z)?Z:[Z]:null}static GetPointerPrefix(Z){return(0,N.k)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(Z,c){(0,i.A)(Z,c)}static SetReferrerPolicyBehavior(Z,c){c.referrerPolicy=Z}static get PreprocessUrl(){return i.f.PreprocessUrl}static set PreprocessUrl(Z){i.f.PreprocessUrl=Z}static LoadImage(Z,c,L,k,N,R){return(0,i.s)(Z,c,L,k,N,R)}static LoadFile(Z,c,L,k,N,R){return(0,i.o)(Z,c,L,k,N,R)}static async LoadFileAsync(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((L,k)=>{(0,i.o)(Z,(Z=>{L(Z)}),void 0,void 0,c,((Z,c)=>{k(c)}))}))}static GetAssetUrl(Z){if(!Z)return"";if(O.AssetBaseUrl&&Z.startsWith(O._DefaultAssetsUrl)){const c="/"===O.AssetBaseUrl[O.AssetBaseUrl.length-1]?O.AssetBaseUrl.substring(0,O.AssetBaseUrl.length-1):O.AssetBaseUrl;return Z.replace(O._DefaultAssetsUrl,c)}return Z}static GetBabylonScriptURL(Z,c){if(!Z)return"";if(O.ScriptBaseUrl&&Z.startsWith(O._DefaultCdnUrl)){const c="/"===O.ScriptBaseUrl[O.ScriptBaseUrl.length-1]?O.ScriptBaseUrl.substring(0,O.ScriptBaseUrl.length-1):O.ScriptBaseUrl;Z=Z.replace(O._DefaultCdnUrl,c)}return Z=O.ScriptPreprocessUrl(Z),c&&(Z=O.GetAbsoluteUrl(Z)),Z}static LoadBabylonScript(Z,c,L,k){Z=O.GetBabylonScriptURL(Z),O.LoadScript(Z,c,L)}static async LoadBabylonScriptAsync(Z){return Z=O.GetBabylonScriptURL(Z),await O.LoadScriptAsync(Z)}static LoadScript(Z,c,L,k){let R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(Z),c&&c()}catch(p){null===L||void 0===L||L(`Unable to load script '${Z}' in worker`,p)}return}if(!(0,N.k)())return void(null===L||void 0===L||L(`Cannot load script '${Z}' outside of a window or a worker`));const G=document.getElementsByTagName("head")[0],V=document.createElement("script");R?(V.setAttribute("type","module"),V.innerText=Z):(V.setAttribute("type","text/javascript"),V.setAttribute("src",Z)),k&&(V.id=k),V.onload=()=>{c&&c()},V.onerror=c=>{L&&L(`Unable to load script '${Z}'`,c)},G.appendChild(V)}static async LoadScriptAsync(Z,c){return await new Promise(((L,k)=>{this.LoadScript(Z,(()=>{L()}),((Z,c)=>{k(c||new Error(Z))}),c)}))}static ReadFileAsDataURL(Z,c,L){const N=new FileReader,R={onCompleteObservable:new k.b,abort:()=>N.abort()};return N.onloadend=()=>{R.onCompleteObservable.notifyObservers(R)},N.onload=Z=>{c(Z.target.result)},N.onprogress=L,N.readAsDataURL(Z),R}static ReadFile(Z,c,L,k,N){return(0,i.v)(Z,c,L,k,N)}static FileAsURL(Z){const c=new Blob([Z]);return window.URL.createObjectURL(c)}static Format(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Z.toFixed(c)}static DeepCopy(Z,c,L,k){G.d.DeepCopy(Z,c,L,k)}static IsEmpty(Z){for(const c in Z)if(Object.prototype.hasOwnProperty.call(Z,c))return!1;return!0}static RegisterTopRootEvents(Z,c){for(let k=0;k<c.length;k++){const N=c[k];Z.addEventListener(N.name,N.handler,!1);try{window.parent&&window.parent.addEventListener(N.name,N.handler,!1)}catch(L){}}}static UnregisterTopRootEvents(Z,c){for(let k=0;k<c.length;k++){const N=c[k];Z.removeEventListener(N.name,N.handler);try{Z.parent&&Z.parent.removeEventListener(N.name,N.handler)}catch(L){}}}static async DumpFramebuffer(Z,c,L,k){throw(0,p.e)("DumpTools")}static DumpData(Z,c,L,k){throw(0,p.e)("DumpTools")}static async DumpDataAsync(Z,c,L){throw(0,p.e)("DumpTools")}static _IsOffScreenCanvas(Z){return void 0!==Z.convertToBlob}static ToBlob(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",k=arguments.length>3?arguments[3]:void 0;O._IsOffScreenCanvas(Z)||Z.toBlob||(Z.toBlob=function(Z,c,L){setTimeout((()=>{const k=atob(this.toDataURL(c,L).split(",")[1]),N=k.length,R=new Uint8Array(N);for(let Z=0;Z<N;Z++)R[Z]=k.charCodeAt(Z);Z(new Blob([R]))}))}),O._IsOffScreenCanvas(Z)?Z.convertToBlob({type:L,quality:k}).then((Z=>c(Z))):Z.toBlob((function(Z){c(Z)}),L,k)}static DownloadBlob(Z,c){if("download"in document.createElement("a")){if(!c){const Z=new Date;c="screenshot_"+((Z.getFullYear()+"-"+(Z.getMonth()+1)).slice(2)+"-"+Z.getDate()+"_"+Z.getHours()+"-"+("0"+Z.getMinutes()).slice(-2))+".png"}O.Download(Z,c)}else if(Z&&"undefined"!==typeof URL){const c=URL.createObjectURL(Z),L=window.open("");if(!L)return;const k=L.document.createElement("img");k.onload=function(){URL.revokeObjectURL(c)},k.src=c,L.document.body.appendChild(k)}}static EncodeScreenshotCanvasData(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if("string"!==typeof k&&c){if(c){if(O._IsOffScreenCanvas(Z))return void Z.convertToBlob({type:L,quality:N}).then((Z=>{const L=new FileReader;L.readAsDataURL(Z),L.onloadend=()=>{const Z=L.result;c(Z)}}));const k=Z.toDataURL(L,N);c(k)}}else this.ToBlob(Z,(function(Z){Z&&O.DownloadBlob(Z,k),c&&c("")}),L,N)}static Download(Z,c){if("undefined"===typeof URL)return;const L=window.URL.createObjectURL(Z),k=document.createElement("a");document.body.appendChild(k),k.style.display="none",k.href=L,k.download=c,k.addEventListener("click",(()=>{k.parentElement&&k.parentElement.removeChild(k)})),k.click(),window.URL.revokeObjectURL(L)}static BackCompatCameraNoPreventDefault(Z){return"boolean"===typeof Z[0]?Z[0]:"boolean"===typeof Z[1]&&Z[1]}static CreateScreenshot(Z,c,L,k){throw(0,p.e)("ScreenshotTools")}static async CreateScreenshotAsync(Z,c,L){throw(0,p.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(Z,c,L,k){throw(0,p.e)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(Z,c,L){throw(0,p.e)("ScreenshotTools")}static RandomId(){return(0,x.d)()}static IsBase64(Z){return(0,i.h)(Z)}static DecodeBase64(Z){return(0,i.c)(Z)}static get errorsCount(){return R.e.errorsCount}static Log(Z){R.e.Log(Z)}static Warn(Z){R.e.Warn(Z)}static Error(Z){R.e.Error(Z)}static get LogCache(){return R.e.LogCache}static ClearLogCache(){R.e.ClearLogCache()}static set LogLevels(Z){R.e.LogLevels=Z}static set PerformanceLogLevel(Z){return(Z&O.PerformanceUserMarkLogLevel)===O.PerformanceUserMarkLogLevel?(O.StartPerformanceCounter=O._StartUserMark,void(O.EndPerformanceCounter=O._EndUserMark)):(Z&O.PerformanceConsoleLogLevel)===O.PerformanceConsoleLogLevel?(O.StartPerformanceCounter=O._StartPerformanceConsole,void(O.EndPerformanceCounter=O._EndPerformanceConsole)):(O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,void(O.EndPerformanceCounter=O._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(Z,c){}static _EndPerformanceCounterDisabled(Z,c){}static _StartUserMark(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!O._Performance){if(!(0,N.k)())return;O._Performance=window.performance}c&&O._Performance.mark&&O._Performance.mark(Z+"-Begin")}static _EndUserMark(Z){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&O._Performance.mark&&(O._Performance.mark(Z+"-End"),O._Performance.measure(Z,Z+"-Begin",Z+"-End"))}static _StartPerformanceConsole(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(O._StartUserMark(Z,c),console.time&&console.time(Z))}static _EndPerformanceConsole(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(O._EndUserMark(Z,c),console.timeEnd(Z))}static get Now(){return V.c.Now}static GetClassName(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=null;if(!c&&Z.getClassName)L=Z.getClassName();else{if(Z instanceof Object){L=(c?Z:Object.getPrototypeOf(Z)).constructor.__bjsclassName__}L||(L=typeof Z)}return L}static First(Z,c){for(const L of Z)if(c(L))return L;return null}static getFullClassName(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=null,k=null;if(!c&&Z.getClassName)L=Z.getClassName();else{if(Z instanceof Object){const N=c?Z:Object.getPrototypeOf(Z);L=N.constructor.__bjsclassName__,k=N.constructor.__bjsmoduleName__}L||(L=typeof Z)}return L?(null!=k?k+".":"")+L:null}static async DelayAsync(Z){await new Promise((c=>{setTimeout((()=>{c()}),Z)}))}static IsSafari(){return!!(0,N.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}O.AssetBaseUrl="",O.UseCustomRequestHeaders=!1,O.CustomRequestHeaders=J.b.CustomRequestHeaders,O.GetDOMTextContent=N.c,O._DefaultCdnUrl="https://cdn.babylonjs.com",O._DefaultAssetsUrl="https://assets.babylonjs.com/core",O.GetAbsoluteUrl="object"===typeof document?Z=>{const c=document.createElement("a");return c.href=Z,c.href}:"function"===typeof URL&&"object"===typeof location?Z=>new URL(Z,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},O.NoneLogLevel=R.e.NoneLogLevel,O.MessageLogLevel=R.e.MessageLogLevel,O.WarningLogLevel=R.e.WarningLogLevel,O.ErrorLogLevel=R.e.ErrorLogLevel,O.AllLogLevel=R.e.AllLogLevel,O.IsWindowObjectExist=N.k,O.PerformanceNoneLogLevel=0,O.PerformanceUserMarkLogLevel=1,O.PerformanceConsoleLogLevel=2,O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,O.EndPerformanceCounter=O._EndPerformanceCounterDisabled;class w{constructor(Z,c,L){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=Z,this.index=k-1,this._done=!1,this._fn=c,this._successCallback=L}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(Z,c,L){const k=new w(Z,c,L,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return k.executeNext(),k}static SyncAsyncForLoop(Z,c,L,k,N){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return w.Run(Math.ceil(Z/c),(k=>{N&&N()?k.breakLoop():setTimeout((()=>{for(let R=0;R<c;++R){const G=k.index*c+R;if(G>=Z)break;if(L(G),N&&N()){k.breakLoop();break}}k.executeNext()}),R)}),k)}}O.Mix=q.j,O.IsExponentOfTwo=q.i,z.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11012:(Z,c,L)=>{L.d(c,{d:()=>R,g:()=>N});const k={};function N(Z,c){k[Z]=c}function R(Z){return k[Z]}},11645:(Z,c,L)=>{L.d(c,{b:()=>k});class k{static get UniqueId(){const Z=this._UniqueIdCounter;return this._UniqueIdCounter++,Z}}k._UniqueIdCounter=1},11079:(Z,c,L)=>{L.d(c,{b:()=>k});class k{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(k.CustomRequestHeaders).length>0||k.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const Z in k.CustomRequestHeaders){const c=k.CustomRequestHeaders[Z];c&&this._xhr.setRequestHeader(Z,c)}}_shouldSkipRequestModifications(Z){return k.SkipRequestModificationForBabylonCDN&&(Z.includes("preview.babylonjs.com")||Z.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(Z){this._xhr.onprogress=Z}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(Z){this._xhr.responseType=Z}get timeout(){return this._xhr.timeout}set timeout(Z){this._xhr.timeout=Z}addEventListener(Z,c,L){this._xhr.addEventListener(Z,c,L)}removeEventListener(Z,c,L){this._xhr.removeEventListener(Z,c,L)}abort(){this._xhr.abort()}send(Z){k.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(Z)}open(Z,c){for(const L of k.CustomRequestModifiers){if(this._shouldSkipRequestModifications(c))return;c=L(this._xhr,c)||c}c=(c=c.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=c,this._xhr.open(Z,c,!0)}setRequestHeader(Z,c){this._xhr.setRequestHeader(Z,c)}getResponseHeader(Z){return this._xhr.getResponseHeader(Z)}}k.CustomRequestHeaders={},k.CustomRequestModifiers=new Array,k.SkipRequestModificationForBabylonCDN=!0},11770:(Z,c,L)=>{L.d(c,{d:()=>N});class k{constructor(Z){this._pendingActions=new Array,this._workerInfos=Z.map((Z=>({workerPromise:Promise.resolve(Z),idle:!0})))}dispose(){for(const Z of this._workerInfos)Z.workerPromise.then((Z=>{Z.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(Z){this._executeOnIdleWorker(Z)||this._pendingActions.push(Z)}_executeOnIdleWorker(Z){for(const c of this._workerInfos)if(c.idle)return this._execute(c,Z),!0;return!1}_execute(Z,c){Z.idle=!1,Z.workerPromise.then((L=>{c(L,(()=>{const c=this._pendingActions.shift();c?this._execute(Z,c):Z.idle=!0}))}))}}class N extends k{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.DefaultOptions;super([]),this._maxWorkers=Z,this._createWorkerAsync=c,this._options=L}push(Z){if(!this._executeOnIdleWorker(Z))if(this._workerInfos.length<this._maxWorkers){const c={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(c),this._execute(c,Z)}else this._pendingActions.push(Z)}_execute(Z,c){Z.timeoutId&&(clearTimeout(Z.timeoutId),delete Z.timeoutId),super._execute(Z,((L,k)=>{c(L,(()=>{k(),Z.idle&&(Z.timeoutId=setTimeout((()=>{Z.workerPromise.then((Z=>{Z.terminate()}));const c=this._workerInfos.indexOf(Z);-1!==c&&this._workerInfos.splice(c,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}N.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11725:(Z,c,L)=>{L.d(c,{e:()=>z});var k=L(11170),N=L(11027),R=L(11023),G=L(11190),V=L(11173),p=L(11242),J=L(11012);class z{get influence(){return this._influence}set influence(Z){if(this._influence===Z)return;const c=this._influence;this._influence=Z,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===c||0===Z)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=Z,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new N.b,this._onDataLayoutChanged=new N.b,this._animationPropertiesOverride=null,this.id=Z,this._scene=L||R.d.LastCreatedScene,this.influence=c,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(Z){const c=this.hasPositions;this._positions=Z,c!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(Z){const c=this.hasNormals;this._normals=Z,c!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(Z){const c=this.hasTangents;this._tangents=Z,c!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(Z){const c=this.hasUVs;this._uvs=Z,c!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(Z){const c=this.hasUV2s;this._uv2s=Z,c!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(Z){const c=this.hasColors;this._colors=Z,c!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const Z=p.e.Clone((()=>new z(this.name,this.influence,this._scene)),this);return Z._positions=this._positions,Z._normals=this._normals,Z._tangents=this._tangents,Z._uvs=this._uvs,Z._uv2s=this._uv2s,Z._colors=this._colors,Z}serialize(){const Z={};return Z.name=this.name,Z.influence=this.influence,Z.BZ=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(Z.id=this.id),this.hasNormals&&(Z.DZ=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(Z.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(Z.HZ=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(Z.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(Z.eZ=Array.prototype.slice.call(this.getColors())),p.e.AppendSerializedAnimations(this,Z),Z}getClassName(){return"MorphTarget"}static Parse(Z,c){const L=new z(Z.name,Z.influence);if(L.setPositions(Z.BZ),null!=Z.id&&(L.id=Z.id),Z.DZ&&L.setNormals(Z.DZ),Z.tangents&&L.setTangents(Z.tangents),Z.HZ&&L.setUVs(Z.HZ),Z.uv2s&&L.setUV2s(Z.uv2s),Z.eZ&&L.setColors(Z.eZ),Z.animations){for(let c=0;c<Z.animations.length;c++){const k=Z.animations[c],N=(0,J.d)("BABYLON.Animation");N&&L.animations.push(N.Parse(k))}Z.autoAnimate&&c&&c.beginAnimation(L,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1)}return L}static FromMesh(Z,c,L){c||(c=Z.name);const k=new z(c,L,Z.XZ());return k.setPositions(Z.getVerticesData(G.g.PositionKind)),Z.isVerticesDataPresent(G.g.NormalKind)&&k.setNormals(Z.getVerticesData(G.g.NormalKind)),Z.isVerticesDataPresent(G.g.TangentKind)&&k.setTangents(Z.getVerticesData(G.g.TangentKind)),Z.isVerticesDataPresent(G.g.UVKind)&&k.setUVs(Z.getVerticesData(G.g.UVKind)),Z.isVerticesDataPresent(G.g.UV2Kind)&&k.setUV2s(Z.getVerticesData(G.g.UV2Kind)),Z.isVerticesDataPresent(G.g.ColorKind)&&k.setColors(Z.getVerticesData(G.g.ColorKind)),k}}(0,k.d)([(0,V.H)()],z.prototype,"id",void 0)},11528:(Z,c,L)=>{L.d(c,{d:()=>x});var k=L(11170),N=L(11336),R=L(11027),G=L(10993),V=L(11116),p=L(11173),J=L(11242),z=L(11012),i=L(11110),t=L(11159),E=L(11532);i.c.prototype.setTextureFromPostProcess=function(Z,c,L){var k;let N=null;c&&(c._forcedOutputTexture?N=c._forcedOutputTexture:c._textures.data[c._currentRenderTextureInd]&&(N=c._textures.data[c._currentRenderTextureInd])),this._bindTexture(Z,(null===(k=N)||void 0===k?void 0:k.texture)??null,L)},i.c.prototype.setTextureFromPostProcessOutput=function(Z,c,L){var k;this._bindTexture(Z,(null===c||void 0===c||null===(k=c._outputTexture)||void 0===k?void 0:k.texture)??null,L)},V.d.prototype.setTextureFromPostProcess=function(Z,c){this._engine.setTextureFromPostProcess(this._samplers[Z],c,Z)},V.d.prototype.setTextureFromPostProcessOutput=function(Z,c){this._engine.setTextureFromPostProcessOutput(this._samplers[Z],c,Z)};class x{static get ForceGLSL(){return E.f.ForceGLSL}static set ForceGLSL(Z){E.f.ForceGLSL=Z}static RegisterShaderCodeProcessing(Z,c){E.f.RegisterShaderCodeProcessing(Z,c)}get name(){return this._effectWrapper.name}set name(Z){this._effectWrapper.name=Z}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(Z){this._effectWrapper.alphaMode=Z}get samples(){return this._samples}set samples(Z){this._samples=Math.min(Z,this._engine.getCaps().maxMSAASamples),this._textures.forEach((Z=>{Z.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(Z){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),Z&&(this._onActivateObserver=this.onActivateObservable.add(Z))}set onSizeChanged(Z){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(Z)}set onApply(Z){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(Z)}set onBeforeRender(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z)}set onAfterRender(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(Z){this._forcedOutputTexture=Z}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.wc(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(Z,c,L,k,V,p){var J;let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,i=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",M=arguments.length>12?arguments[12]:void 0,P=arguments.length>13&&void 0!==arguments[13]&&arguments[13],j=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,o=arguments.length>15?arguments[15]:void 0,u=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.wi=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new N.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new G.f(1,1),this._texelSize=G.f.Zero(),this.onActivateObservable=new R.b,this.onSizeChangedObservable=new R.b,this.onApplyObservable=new R.b,this.onBeforeRenderObservable=new R.b,this.onAfterRenderObservable=new R.b,this.Xc=new R.b;let X,h=1,B=null;if(L&&!Array.isArray(L)){const Z=L;L=Z.uniforms??null,k=Z.samplers??null,h=Z.size??1,p=Z.camera??null,z=Z.samplingMode??1,i=Z.xV,t=Z.reusable,q=Array.isArray(Z.defines)?Z.defines.join("\n"):Z.defines??null,O=Z.textureType??0,w=Z.vertexUrl??"postprocess",M=Z.indexParameters,P=Z.blockCompilation??!1,j=Z.textureFormat??5,o=Z.shaderLanguage??0,B=Z.uniformBuffers??null,u=Z.extraInitializations,X=Z.effectWrapper}else V&&(h="number"===typeof V?V:{width:V.width,height:V.height});if(this._useExistingThinPostProcess=!!X,this._effectWrapper=X??new E.f({name:Z,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:c,xV:i||(null===(J=p)||void 0===J?void 0:J.XZ().getEngine()),uniforms:L,samplers:k,uniformBuffers:B,defines:q,vertexUrl:w,indexParameters:M,blockCompilation:!0,shaderLanguage:o,extraInitializations:void 0}),this.name=Z,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=p?(this._camera=p,this._scene=p.XZ(),p.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):i&&(this._engine=i,this._engine.postProcesses.push(this)),this._options=h,this.renderTargetSamplingMode=z||1,this._reusable=t||!1,this._textureType=O,this._textureFormat=j,this._shaderLanguage=o||0,this._samplers=k||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=c,this._vertexUrl=w,this._parameters=L||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=B||[],this._indexParameters=M,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const Z=[];this._gatherImports(this._engine.isWebGPU&&!x.ForceGLSL,Z),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(P,q,u,Z)}}_gatherImports(){let Z=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?Z.push(Promise.all([L.e(42).then(L.bind(L,13652))])):Z.push(Promise.all([Promise.resolve().then(L.bind(L,11535))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(Z){return this._disposeTextures(),this._shareOutputWithPostProcess=Z,this}useOwnOutput(){0==this._textures.length&&(this._textures=new N.f(2)),this._shareOutputWithPostProcess=null}updateEffect(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0,V=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(Z,c,L,k,N,R,G,V),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let N=0;N<this._textureCache.length;N++)if(this._textureCache[N].texture.width===Z.width&&this._textureCache[N].texture.height===Z.height&&this._textureCache[N].postProcessChannel===L&&this._textureCache[N].texture._generateDepthBuffer===c.generateDepthBuffer&&this._textureCache[N].texture.samples===c.samples)return this._textureCache[N].texture;const k=this._engine.createRenderTargetTexture(Z,c);return this._textureCache.push({texture:k,postProcessChannel:L,lastUsedRenderId:-1}),k}_flushTextureCache(){const Z=this._renderId;for(let c=this._textureCache.length-1;c>=0;c--)if(Z-this._textureCache[c].lastUsedRenderId>100){let Z=!1;for(let L=0;L<this._textures.length;L++)if(this._textures.data[L]===this._textureCache[c].texture){Z=!0;break}Z||(this._textureCache[c].texture.dispose(),this._textureCache.splice(c,1))}}resize(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=Z,this.height=c;let R=null;if(L)for(let p=0;p<L._postProcesses.length;p++)if(null!==L._postProcesses[p]){R=L._postProcesses[p];break}const G={width:this.width,height:this.height},V={generateMipMaps:k,generateDepthBuffer:N||R===this,generateStencilBuffer:(N||R===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(G,V,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(G,V,1)),this._texelSize.wc(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let Z;if(this._shareOutputWithPostProcess)Z=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)Z=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let c;Z=this.inputTexture;for(let L=0;L<this._textureCache.length;L++)if(this._textureCache[L].texture===Z){c=this._textureCache[L];break}c&&(c.lastUsedRenderId=this._renderId)}return Z}activate(Z){var c,L;let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const R=null===Z||void 0!==Z.cameraRigMode?Z||this._camera:null,G=(null===R||void 0===R?void 0:R.XZ())??Z,V=G.getEngine(),p=V.getCaps().maxTextureSize,J=(k?k.width:this._engine.getRenderWidth(!0))*this._options|0,z=(k?k.height:this._engine.getRenderHeight(!0))*this._options|0;let i=this._options.width||J,E=this._options.height||z;const x=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let q=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const Z=V.currentViewport;Z&&(i*=Z.width,E*=Z.height)}(x||this.alwaysForcePOT)&&(this._options.width||(i=V.needPOTTextures?(0,t.h)(i,p,this.scaleMode):i),this._options.height||(E=V.needPOTTextures?(0,t.h)(E,p,this.scaleMode):E)),this.width===i&&this.height===E&&(q=this._getTarget())||this.resize(i,E,R,x,N),this._textures.forEach((Z=>{Z.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(Z,this.samples)})),this._flushTextureCache(),this._renderId++}return q||(q=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.wc(J/i,z/E),this._engine.bindFramebuffer(q,0,J,z,this.forceFullscreenViewport)):(this._scaleRatio.wc(1,1),this._engine.bindFramebuffer(q,0,void 0,void 0,this.forceFullscreenViewport)),null===(c=(L=this._engine)._debugInsertMarker)||void 0===c||c.call(L,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(R),this.wi&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:G.clearColor,G._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),q}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let Z;var c;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),Z=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(c=Z)||void 0===c?void 0:c.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let Z=this._textureCache.length-1;Z>=0;Z--)this._textureCache[Z].texture.dispose();this._textureCache.length=0}setPrePassRenderer(Z){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=Z.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(Z){let c;if(Z=Z||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(c=this._scene.postProcesses.indexOf(this),-1!==c&&this._scene.postProcesses.splice(c,1)),this._parentContainer){const Z=this._parentContainer.postProcesses.indexOf(this);Z>-1&&this._parentContainer.postProcesses.splice(Z,1),this._parentContainer=null}if(c=this._engine.postProcesses.indexOf(this),-1!==c&&this._engine.postProcesses.splice(c,1),this.Xc.notifyObservers(),Z){if(Z.detachPostProcess(this),c=Z._postProcesses.indexOf(this),0===c&&Z._postProcesses.length>0){const Z=this._camera._getFirstPostProcess();Z&&Z.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const Z=J.e.Serialize(this),c=this.getCamera()||this._scene&&this._scene.activeCamera;return Z.customType="BABYLON."+this.getClassName(),Z.cameraId=c?c.id:null,Z.reusable=this._reusable,Z.textureType=this._textureType,Z.fragmentUrl=this._fragmentUrl,Z.parameters=this._parameters,Z.samplers=this._samplers,Z.uniformBuffers=this._uniformBuffers,Z.options=this._options,Z.defines=this._postProcessDefines,Z.textureFormat=this._textureFormat,Z.vertexUrl=this._vertexUrl,Z.indexParameters=this._indexParameters,Z}clone(){const Z=this.serialize();Z._engine=this._engine,Z.cameraId=null;const c=x.Parse(Z,this._scene,"");return c?(c.onActivateObservable=this.onActivateObservable.clone(),c.onSizeChangedObservable=this.onSizeChangedObservable.clone(),c.onApplyObservable=this.onApplyObservable.clone(),c.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),c.onAfterRenderObservable=this.onAfterRenderObservable.clone(),c._prePassEffectConfiguration=this._prePassEffectConfiguration,c):null}static Parse(Z,c,L){const k=(0,z.d)(Z.customType);if(!k||!k._Parse)return null;const N=c?c.getCameraById(Z.cameraId):null;return k._Parse(Z,N,c,L)}static _Parse(Z,c,L,k){return J.e.Parse((()=>new x(Z.name,Z.fragmentUrl,Z.parameters,Z.samplers,Z.options,c,Z.renderTargetSamplingMode,Z._engine,Z.reusable,Z.defines,Z.textureType,Z.vertexUrl,Z.indexParameters,!1,Z.textureFormat)),Z,L,k)}}(0,k.d)([(0,p.H)()],x.prototype,"uniqueId",void 0),(0,k.d)([(0,p.H)()],x.prototype,"name",null),(0,k.d)([(0,p.H)()],x.prototype,"width",void 0),(0,k.d)([(0,p.H)()],x.prototype,"height",void 0),(0,k.d)([(0,p.H)()],x.prototype,"renderTargetSamplingMode",void 0),(0,k.d)([(0,p.p)()],x.prototype,"clearColor",void 0),(0,k.d)([(0,p.H)()],x.prototype,"wi",void 0),(0,k.d)([(0,p.H)()],x.prototype,"forceAutoClearInAlphaMode",void 0),(0,k.d)([(0,p.H)()],x.prototype,"alphaMode",null),(0,k.d)([(0,p.H)()],x.prototype,"alphaConstants",void 0),(0,k.d)([(0,p.H)()],x.prototype,"enablePixelPerfectMode",void 0),(0,k.d)([(0,p.H)()],x.prototype,"forceFullscreenViewport",void 0),(0,k.d)([(0,p.H)()],x.prototype,"scaleMode",void 0),(0,k.d)([(0,p.H)()],x.prototype,"alwaysForcePOT",void 0),(0,k.d)([(0,p.H)("samples")],x.prototype,"_samples",void 0),(0,k.d)([(0,p.H)()],x.prototype,"adaptScaleToCurrentViewport",void 0),(0,z.g)("BABYLON.PostProcess",x)},11524:(Z,c,L)=>{L.d(c,{c:()=>R});var k=L(11190),N=L(11027);class R{constructor(Z){this._vertexBuffers={},this.onBeforeRenderObservable=new N.b,this._scene=Z}_prepareBuffers(){if(this._vertexBuffers[k.g.PositionKind])return;const Z=[];Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),this._vertexBuffers[k.g.PositionKind]=new k.g(this._scene.getEngine(),Z,k.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const Z=[];Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Z)}_rebuild(){const Z=this._vertexBuffers[k.g.PositionKind];Z&&(Z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const L=this._scene.activeCamera;return!!L&&(c=c||L._postProcesses.filter((Z=>null!=Z)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(L,Z,null!==c&&void 0!==c),!0))}directRender(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.length;const V=this._scene.getEngine();for(let J=0;J<G;J++){var p;if(J<Z.length-1)Z[J+1].activate(this._scene.activeCamera||this._scene,null===c||void 0===c?void 0:c.texture);else c?V.bindFramebuffer(c,k,void 0,void 0,L,N):R||V.restoreDefaultFramebuffer(),null===(p=V._debugInsertMarker)||void 0===p||p.call(V,`post process ${Z[J].name} output`);const G=Z[J],z=G.apply();z&&(G.onBeforeRenderObservable.notifyObservers(z),this._prepareBuffers(),V.bindBuffers(this._vertexBuffers,this._indexBuffer,z),V.drawElementsType(0,0,6),G.onAfterRenderObservable.notifyObservers(z))}V.setDepthBuffer(!0),V.setDepthWrite(!0)}_finalizeFrame(Z,c,L,k){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const R=this._scene.activeCamera;if(!R)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(k=k||R._postProcesses.filter((Z=>null!=Z))).length||!this._scene.postProcessesEnabled)return;const G=this._scene.getEngine();for(let p=0,J=k.length;p<J;p++){const z=k[p];var V;if(p<J-1)z._outputTexture=k[p+1].activate(R,null===c||void 0===c?void 0:c.texture);else c?(G.bindFramebuffer(c,L,void 0,void 0,N),z._outputTexture=c):(G.restoreDefaultFramebuffer(),z._outputTexture=null),null===(V=G._debugInsertMarker)||void 0===V||V.call(G,`post process ${k[p].name} output`);if(Z)break;const i=z.apply();i&&(z.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),G.bindBuffers(this._vertexBuffers,this._indexBuffer,i),G.drawElementsType(0,0,6),z.onAfterRenderObservable.notifyObservers(i))}G.setDepthBuffer(!0),G.setDepthWrite(!0),G.setAlphaMode(0)}dispose(){const Z=this._vertexBuffers[k.g.PositionKind];Z&&(Z.dispose(),this._vertexBuffers[k.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11526:(Z,c,L)=>{L.d(c,{c:()=>V});var k=L(11336),N=L(10993);class R{set opaqueSortCompareFn(Z){this._opaqueSortCompareFn=Z||R.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(Z){this._alphaTestSortCompareFn=Z||R.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(Z){this._transparentSortCompareFn=Z||R.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=Z,this._opaqueSubMeshes=new k.f(256),this._transparentSubMeshes=new k.f(256),this._alphaTestSubMeshes=new k.f(256),this._depthOnlySubMeshes=new k.f(256),this._particleSystems=new k.f(256),this._spriteManagers=new k.f(256),this._empty=!0,this._edgesRenderers=new k.c(16),this._scene=c,this.opaqueSortCompareFn=L,this.alphaTestSortCompareFn=N,this.transparentSortCompareFn=R}render(Z,c,L,k){if(Z)return void Z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const N=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(N.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),N.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const R=N.getStencilBuffer();if(N.setStencilBuffer(!1),c&&this._renderSprites(),L&&this._renderParticles(k),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(N.setStencilBuffer(R),this._scene.useOrderIndependentTransparency){const Z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);Z.length&&this._renderTransparent(Z)}else this._renderTransparent(this._transparentSubMeshes);N.setAlphaMode(0)}if(N.setStencilBuffer(!1),this._edgesRenderers.length){for(let Z=0;Z<this._edgesRenderers.length;Z++)this._edgesRenderers.data[Z].render();N.setAlphaMode(0)}N.setStencilBuffer(R)}_renderOpaqueSorted(Z){R._RenderSorted(Z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(Z){R._RenderSorted(Z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(Z){R._RenderSorted(Z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(Z,c,L,k){let G,V=0;const p=L?L.globalPosition:R._ZeroVector;if(k)for(;V<Z.length;V++)G=Z.data[V],G._alphaIndex=G.getMesh().alphaIndex,G._distanceToCamera=N.h.Distance(G.getBoundingInfo().boundingSphere.centerWorld,p);const J=Z.length===Z.data.length?Z.data:Z.data.slice(0,Z.length);c&&J.sort(c);const z=J[0].getMesh().XZ();for(V=0;V<J.length;V++)if(G=J[V],!z._activeMeshesFrozenButKeepClipping||G.isInFrustum(z._frustumPlanes)){if(k){const Z=G.rZ();if(Z&&Z.needDepthPrePass){const c=Z.XZ().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),G.render(!1),c.setColorWrite(!0)}}G.render(k)}}static defaultTransparentSortCompare(Z,c){return Z._alphaIndex>c._alphaIndex?1:Z._alphaIndex<c._alphaIndex?-1:R.backToFrontSortCompare(Z,c)}static backToFrontSortCompare(Z,c){return Z._distanceToCamera<c._distanceToCamera?1:Z._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(Z,c){return Z._distanceToCamera<c._distanceToCamera?-1:Z._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(Z,c){const L=Z.getMesh(),k=c.getMesh();return L.material&&k.material?L.material.uniqueId-k.material.uniqueId:L.uniqueId-k.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(Z,c,L){void 0===c&&(c=Z.getMesh()),void 0===L&&(L=Z.rZ()),null!==L&&void 0!==L&&(L.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(Z):L.needAlphaTestingForMesh(c)?(L.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._alphaTestSubMeshes.push(Z)):(L.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._opaqueSubMeshes.push(Z)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(Z){this._spriteManagers.push(Z),this._empty=!1}dispatchParticles(Z){this._particleSystems.push(Z),this._empty=!1}_renderParticles(Z){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let L=0;L<this._particleSystems.length;L++){const k=this._particleSystems.data[L];if(0===(c&&c.layerMask&k.layerMask))continue;const N=k.j;N.position&&Z&&-1===Z.indexOf(N)||this._scene._activeParticles.addCount(k.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const Z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const L=this._spriteManagers.data[c];0!==(Z&&Z.layerMask&L.layerMask)&&L.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}R._ZeroVector=N.h.Zero();class G{}class V{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(Z){Z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=Z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const Z of this._scene.meshes)if(Z.ec)for(const c of Z.ec)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const Z of this._scene.spriteManagers)Z._wasDispatched=!1;for(const Z of this._scene.si)Z._wasDispatched=!1}constructor(Z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new G,this._maintainStateBetweenFrames=!1,this._scene=Z;for(let c=V.MIN_RENDERINGGROUPS;c<V.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={wi:!0,depth:!0,stencil:!0}}getRenderingGroup(Z){const c=Z||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Z,c),this._depthStencilBufferAlreadyCleaned=!0)}render(Z,c,L,k){const N=this._renderingGroupInfo;if(N.LL=this._scene,N.camera=this._scene.activeCamera,N.renderingManager=this,this._scene.spriteManagers&&k)for(let R=0;R<this._scene.spriteManagers.length;R++){const Z=this._scene.spriteManagers[R];this.dispatchSprites(Z)}for(let R=V.MIN_RENDERINGGROUPS;R<V.MAX_RENDERINGGROUPS;R++){this._depthStencilBufferAlreadyCleaned=R===V.MIN_RENDERINGGROUPS;const G=this._renderingGroups[R];if(!G||G._empty)continue;const p=1<<R;if(N.renderingGroupId=R,this._scene.onBeforeRenderingGroupObservable.notifyObservers(N,p),V.AUTOCLEAR){const Z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(R):this._autoClearDepthStencil[R];Z&&Z.wi&&this._clearDepthStencilBuffer(Z.depth,Z.stencil)}for(const Z of this._scene._beforeRenderingGroupDrawStage)Z.action(R);G.render(Z,k,L,c);for(const Z of this._scene._afterRenderingGroupDrawStage)Z.action(R);this._scene.onAfterRenderingGroupObservable.notifyObservers(N,p)}}reset(){if(!this.maintainStateBetweenFrames)for(let Z=V.MIN_RENDERINGGROUPS;Z<V.MAX_RENDERINGGROUPS;Z++){const c=this._renderingGroups[Z];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let Z=V.MIN_RENDERINGGROUPS;Z<V.MAX_RENDERINGGROUPS;Z++){const c=this._renderingGroups[Z];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let Z=V.MIN_RENDERINGGROUPS;Z<V.MAX_RENDERINGGROUPS;Z++){const c=this._renderingGroups[Z];c&&c.dispose()}}_prepareRenderingGroup(Z){void 0===this._renderingGroups[Z]&&(this._renderingGroups[Z]=new R(Z,this._scene,this._customOpaqueSortCompareFn[Z],this._customAlphaTestSortCompareFn[Z],this._customTransparentSortCompareFn[Z]))}dispatchSprites(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchSprites(Z))}dispatchParticles(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchParticles(Z))}dispatch(Z,c,L){void 0===c&&(c=Z.getMesh()),this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(Z,c,L))}setRenderingOrder(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[Z]=c,this._customAlphaTestSortCompareFn[Z]=L,this._customTransparentSortCompareFn[Z]=k,this._renderingGroups[Z]){const c=this._renderingGroups[Z];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Z],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Z],c.transparentSortCompareFn=this._customTransparentSortCompareFn[Z]}}setRenderingAutoClearDepthStencil(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[Z]={wi:c,depth:L,stencil:k}}getAutoClearDepthStencilSetup(Z){return this._autoClearDepthStencil[Z]}}V.MAX_RENDERINGGROUPS=4,V.MIN_RENDERINGGROUPS=0,V.AUTOCLEAR=!0},11535:(Z,c,L)=>{L.r(c),L.d(c,{postprocessVertexShader:()=>G});var k=L(11124);const N="postprocessVertexShader",R="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";k.e.ShadersStore[N]||(k.e.ShadersStore[N]=R);const G={name:N,shader:R}},11637:(Z,c,L)=>{L.d(c,{d:()=>k});class k{}k._IsPickingAvailable=!1},11277:(Z,c,L)=>{L.d(c,{b:()=>i});var k=L(11170),N=L(10993),R=L(11173),G=L(11027),V=L(11023),p=L(11070),J=L(11242);class z{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new G.b,this._onClonedObservable=new G.b}}class i{static AddNodeConstructor(Z,c){this._NodeConstructors[Z]=c}static Construct(Z,c,L,k){const N=this._NodeConstructors[Z];return N?N(c,L,k):null}set accessibilityTag(Z){this._accessibilityTag=Z,this.onAccessibilityTagChangedObservable.notifyObservers(Z)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(Z){this._nodeDataStorage._doNotSerialize=Z}p(){return this._nodeDataStorage._isDisposed}set parent(Z){if(this._parentNode===Z)return;const c=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1),Z||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=Z,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),c||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(Z){Z.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const Z=this._scene.rootNodes,c=Z.length-1;Z[this._nodeDataStorage._sceneRootNodesIndex]=Z[c],Z[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}getClassName(){return"Node"}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new z,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new G.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=N.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Xc=new G.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=Z,this.id=Z,this._scene=c||V.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),L&&this._addToSceneRootNodes()}XZ(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(Z)||(Z.init(),this._scene.isLoading&&!c?this._scene.onDataLoadedObservable.addOnce((()=>{Z.attach(this)})):Z.attach(this),this._behaviors.push(Z)),this}removeBehavior(Z){const c=this._behaviors.indexOf(Z);return-1===c||(this._behaviors[c].detach(),this._behaviors.splice(c,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(Z){for(const c of this._behaviors)if(c.name===Z)return c;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Jc(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(Z){!Z&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(Z){return this.parent?this.parent._getActionManagerForTrigger(Z,!1):null}_updateCache(Z){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}DJ(Z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const Z of this._children)Z._syncParentEnabledState()}lV(Z){this._nodeDataStorage._isEnabled!==Z&&(this._nodeDataStorage._isEnabled=Z,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(Z))}isDescendantOf(Z){return!!this.parent&&(this.parent===Z||this.parent.isDescendantOf(Z))}_getDescendants(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2?arguments[2]:void 0;if(this._children)for(let k=0;k<this._children.length;k++){const N=this._children[k];L&&!L(N)||Z.push(N),c||N._getDescendants(Z,!1,L)}}getDescendants(Z,c){const L=[];return this._getDescendants(L,Z,c),L}getChildMeshes(Z,c){const L=[];return this._getDescendants(L,Z,(Z=>(!c||c(Z))&&void 0!==Z.Zi)),L}getChildren(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(c,Z)}_setReady(Z){Z!==this._nodeDataStorage._isReady&&(Z?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(Z){for(let c=0;c<this.animations.length;c++){const L=this.animations[c];if(L.name===Z)return L}return null}createAnimationRange(Z,c,L){if(!this._ranges[Z]){this._ranges[Z]=i._AnimationRangeFactory(Z,c,L);for(let k=0,N=this.animations.length;k<N;k++)this.animations[k]&&this.animations[k].createRange(Z,c,L)}}deleteAnimationRange(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let L=0,k=this.animations.length;L<k;L++)this.animations[L]&&this.animations[L].deleteRange(Z,c);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}clone(Z,c,L){const k=J.e.Clone((()=>new i(Z,this.XZ())),this);if(c&&(k.parent=c),!L){const c=this.getDescendants(!0);for(let L=0;L<c.length;L++){const N=c[L];N.clone(Z+"."+N.name,k)}}return k}getAnimationRanges(){const Z=[];let c;for(c in this._ranges)Z.push(this._ranges[c]);return Z}beginAnimation(Z,c,L,k){const N=this.getAnimationRange(Z);return N?this._scene.beginAnimation(this,N.from,N.to,c,L,k):null}serializeAnimationRanges(){const Z=[];for(const c in this._ranges){const L=this._ranges[c];if(!L)continue;const k={};k.name=c,k.from=L.from,k.to=L.to,Z.push(k)}return Z}Jc(Z){return this._worldMatrix||(this._worldMatrix=N.b.Identity()),this._worldMatrix}dispose(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!Z){const L=this.getDescendants(!0);for(const k of L)k.dispose(Z,c)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Xc.notifyObservers(this),this.Xc.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const L of this._behaviors)L.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(Z,c,L){if(c.ranges)for(let k=0;k<c.ranges.length;k++){const L=c.ranges[k];Z.createAnimationRange(L.name,L.from,L.to)}}getHierarchyBoundingVectors(){let Z,c,L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.XZ().incrementRenderId(),this.Jc(!0);const R=this;if(R.getBoundingInfo&&R.ec){const L=R.getBoundingInfo();Z=L.boundingBox.minimumWorld.clone(),c=L.boundingBox.maximumWorld.clone()}else Z=new N.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new N.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(L){const L=this.getDescendants(!1);for(const R of L){const L=R;if(L.Jc(!0),k&&!k(L))continue;if(!L.getBoundingInfo||0===L.getTotalVertices())continue;const G=L.getBoundingInfo().boundingBox,V=G.minimumWorld,p=G.maximumWorld;N.h.CheckExtends(V,Z,c),N.h.CheckExtends(p,Z,c)}}return{min:Z,max:c}}}i._AnimationRangeFactory=(Z,c,L)=>{throw(0,p.e)("AnimationRange")},i._NodeConstructors={},(0,k.d)([(0,R.H)()],i.prototype,"name",void 0),(0,k.d)([(0,R.H)()],i.prototype,"id",void 0),(0,k.d)([(0,R.H)()],i.prototype,"uniqueId",void 0),(0,k.d)([(0,R.H)()],i.prototype,"state",void 0),(0,k.d)([(0,R.H)()],i.prototype,"metadata",void 0)},11588:(Z,c,L)=>{L.d(c,{d:()=>ZZ});var k=L(11038),N=L(11065),R=L(11027),G=L(11336);class V{constructor(){this._count=0,this._data={}}R(Z){this.clear(),Z.forEach(((Z,c)=>this.add(Z,c)))}get(Z){const c=this._data[Z];if(void 0!==c)return c}getOrAddWithFactory(Z,c){let L=this.get(Z);return void 0!==L||(L=c(Z),L&&this.add(Z,L)),L}getOrAdd(Z,c){const L=this.get(Z);return void 0!==L?L:(this.add(Z,c),c)}contains(Z){return void 0!==this._data[Z]}add(Z,c){return void 0===this._data[Z]&&(this._data[Z]=c,++this._count,!0)}set(Z,c){return void 0!==this._data[Z]&&(this._data[Z]=c,!0)}getAndRemove(Z){const c=this.get(Z);return void 0!==c?(delete this._data[Z],--this._count,c):null}remove(Z){return!!this.contains(Z)&&(delete this._data[Z],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(Z){for(const c in this._data){Z(c,this._data[c])}}first(Z){for(const c in this._data){const L=Z(c,this._data[c]);if(L)return L}return null}}var p=L(11251),J=L(10993),z=L(11592),i=L(11236),t=L(11304);class E{constructor(Z,c,L,k,N,R){this.source=Z,this.pointerX=c,this.pointerY=L,this.meshUnderPointer=k,this.sourceEvent=N,this.additionalData=R}static CreateNew(Z,c,L){const k=Z.XZ();return new E(Z,k.pointerX,k.pointerY,k.meshUnderPointer||Z,c,L)}static CreateNewFromSprite(Z,c,L,k){return new E(Z,c.pointerX,c.pointerY,c.meshUnderPointer,L,k)}static CreateNewFromScene(Z,c){return new E(null,Z.pointerX,Z.pointerY,Z.meshUnderPointer,c)}static CreateNewFromPrimitive(Z,c,L,k){return new E(Z,c.x,c.y,null,L,k)}}var x=L(11524),q=L(11526),O=L(11386),w=L(11047),M=L(11023),P=L(11070),j=L(11614);class o{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const Z in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,Z))return!0;return!1}static get HasPickTriggers(){for(const Z in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,Z)){const c=parseInt(Z);if(c>=1&&c<=7)return!0}return!1}static HasSpecificTrigger(Z){for(const c in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,c)){if(parseInt(c)===Z)return!0}return!1}}o.Triggers={};var u,X,h,B,D,e,H,l=L(11621);!function(Z){Z[Z.Generic=0]="Generic",Z[Z.Keyboard=1]="Keyboard",Z[Z.Mouse=2]="Mouse",Z[Z.Touch=3]="Touch",Z[Z.DualShock=4]="DualShock",Z[Z.Xbox=5]="Xbox",Z[Z.Switch=6]="Switch",Z[Z.DualSense=7]="DualSense"}(u||(u={})),function(Z){Z[Z.Horizontal=0]="Horizontal",Z[Z.Vertical=1]="Vertical",Z[Z.LeftClick=2]="LeftClick",Z[Z.MiddleClick=3]="MiddleClick",Z[Z.RightClick=4]="RightClick",Z[Z.BrowserBack=5]="BrowserBack",Z[Z.BrowserForward=6]="BrowserForward",Z[Z.MouseWheelX=7]="MouseWheelX",Z[Z.MouseWheelY=8]="MouseWheelY",Z[Z.MouseWheelZ=9]="MouseWheelZ",Z[Z.Move=12]="Move"}(X||(X={})),function(Z){Z[Z.Horizontal=0]="Horizontal",Z[Z.Vertical=1]="Vertical",Z[Z.LeftClick=2]="LeftClick",Z[Z.MiddleClick=3]="MiddleClick",Z[Z.RightClick=4]="RightClick",Z[Z.BrowserBack=5]="BrowserBack",Z[Z.BrowserForward=6]="BrowserForward",Z[Z.MouseWheelX=7]="MouseWheelX",Z[Z.MouseWheelY=8]="MouseWheelY",Z[Z.MouseWheelZ=9]="MouseWheelZ",Z[Z.DeltaHorizontal=10]="DeltaHorizontal",Z[Z.DeltaVertical=11]="DeltaVertical"}(h||(h={})),function(Z){Z[Z.Cross=0]="Cross",Z[Z.Circle=1]="Circle",Z[Z.Square=2]="Square",Z[Z.Triangle=3]="Triangle",Z[Z.L1=4]="L1",Z[Z.R1=5]="R1",Z[Z.L2=6]="L2",Z[Z.R2=7]="R2",Z[Z.Share=8]="Share",Z[Z.Options=9]="Options",Z[Z.L3=10]="L3",Z[Z.R3=11]="R3",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.TouchPad=17]="TouchPad",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(B||(B={})),function(Z){Z[Z.Cross=0]="Cross",Z[Z.Circle=1]="Circle",Z[Z.Square=2]="Square",Z[Z.Triangle=3]="Triangle",Z[Z.L1=4]="L1",Z[Z.R1=5]="R1",Z[Z.L2=6]="L2",Z[Z.R2=7]="R2",Z[Z.Create=8]="Create",Z[Z.Options=9]="Options",Z[Z.L3=10]="L3",Z[Z.R3=11]="R3",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.TouchPad=17]="TouchPad",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(D||(D={})),function(Z){Z[Z.A=0]="A",Z[Z.B=1]="B",Z[Z.X=2]="X",Z[Z.Y=3]="Y",Z[Z.LB=4]="LB",Z[Z.RB=5]="RB",Z[Z.LT=6]="LT",Z[Z.RT=7]="RT",Z[Z.Back=8]="Back",Z[Z.Start=9]="Start",Z[Z.LS=10]="LS",Z[Z.RS=11]="RS",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.LStickXAxis=17]="LStickXAxis",Z[Z.LStickYAxis=18]="LStickYAxis",Z[Z.RStickXAxis=19]="RStickXAxis",Z[Z.RStickYAxis=20]="RStickYAxis"}(e||(e={})),function(Z){Z[Z.B=0]="B",Z[Z.A=1]="A",Z[Z.Y=2]="Y",Z[Z.X=3]="X",Z[Z.L=4]="L",Z[Z.R=5]="R",Z[Z.ZL=6]="ZL",Z[Z.ZR=7]="ZR",Z[Z.Minus=8]="Minus",Z[Z.Plus=9]="Plus",Z[Z.LS=10]="LS",Z[Z.RS=11]="RS",Z[Z.DPadUp=12]="DPadUp",Z[Z.DPadDown=13]="DPadDown",Z[Z.DPadLeft=14]="DPadLeft",Z[Z.DPadRight=15]="DPadRight",Z[Z.Home=16]="Home",Z[Z.Capture=17]="Capture",Z[Z.LStickXAxis=18]="LStickXAxis",Z[Z.LStickYAxis=19]="LStickYAxis",Z[Z.RStickXAxis=20]="RStickXAxis",Z[Z.RStickYAxis=21]="RStickYAxis"}(H||(H={}));var W=L(11630);class T{static CreateDeviceEvent(Z,c,L,k,N,R,G){switch(Z){case u.Keyboard:return this._CreateKeyboardEvent(L,k,N,R);case u.Mouse:if(L===X.MouseWheelX||L===X.MouseWheelY||L===X.MouseWheelZ)return this._CreateWheelEvent(Z,c,L,k,N,R);case u.Touch:return this._CreatePointerEvent(Z,c,L,k,N,R,G);default:throw`Unable to generate event for device ${u[Z]}`}}static _CreatePointerEvent(Z,c,L,k,N,R,G){const V=this._CreateMouseEvent(Z,c,L,k,N,R);Z===u.Mouse?(V.deviceType=u.Mouse,V.pointerId=1,V.pointerType="mouse"):(V.deviceType=u.Touch,V.pointerId=G??c,V.pointerType="touch");let p=0;return p+=N.pollInput(Z,c,X.LeftClick),p+=2*N.pollInput(Z,c,X.RightClick),p+=4*N.pollInput(Z,c,X.MiddleClick),V.buttons=p,L===X.Move?V.type="pointermove":L>=X.LeftClick&&L<=X.RightClick&&(V.type=1===k?"pointerdown":"pointerup",V.button=L-2),V}static _CreateWheelEvent(Z,c,L,k,N,R){const G=this._CreateMouseEvent(Z,c,L,k,N,R);switch(G.pointerId=1,G.type="wheel",G.deltaMode=W.d.DOM_DELTA_PIXEL,G.deltaX=0,G.deltaY=0,G.deltaZ=0,L){case X.MouseWheelX:G.deltaX=k;break;case X.MouseWheelY:G.deltaY=k;break;case X.MouseWheelZ:G.deltaZ=k}return G}static _CreateMouseEvent(Z,c,L,k,N,R){const G=this._CreateEvent(R),V=N.pollInput(Z,c,X.Horizontal),p=N.pollInput(Z,c,X.Vertical);return R?(G.movementX=0,G.movementY=0,G.offsetX=G.movementX-R.getBoundingClientRect().x,G.offsetY=G.movementY-R.getBoundingClientRect().y):(G.movementX=N.pollInput(Z,c,10),G.movementY=N.pollInput(Z,c,11),G.offsetX=0,G.offsetY=0),this._CheckNonCharacterKeys(G,N),G.clientX=V,G.clientY=p,G.x=V,G.y=p,G.deviceType=Z,G.deviceSlot=c,G.inputIndex=L,G}static _CreateKeyboardEvent(Z,c,L,k){const N=this._CreateEvent(k);return this._CheckNonCharacterKeys(N,L),N.deviceType=u.Keyboard,N.deviceSlot=0,N.inputIndex=Z,N.type=1===c?"keydown":"keyup",N.key=String.fromCharCode(Z),N.keyCode=Z,N}static _CheckNonCharacterKeys(Z,c){const L=c.isDeviceAvailable(u.Keyboard),k=L&&1===c.pollInput(u.Keyboard,0,18),N=L&&1===c.pollInput(u.Keyboard,0,17),R=L&&(1===c.pollInput(u.Keyboard,0,91)||1===c.pollInput(u.Keyboard,0,92)||1===c.pollInput(u.Keyboard,0,93)),G=L&&1===c.pollInput(u.Keyboard,0,16);Z.altKey=k,Z.ctrlKey=N,Z.metaKey=R,Z.shiftKey=G}static _CreateEvent(Z){const c={preventDefault:()=>{}};return c.target=Z,c}}class I{constructor(Z,c,L){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(Z,c,((Z,c,k,N)=>{const R=T.CreateDeviceEvent(Z,c,k,N,this);L(Z,c,R)})):this._createDummyNativeInput()}pollInput(Z,c,L){return this._nativeInput.pollInput(Z,c,L)}isDeviceAvailable(Z){return Z===u.Mouse||Z===u.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const d=Object.keys(X).length/2;class Q{constructor(Z,c,L,N){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=k.c.IsSafari(),this._usingMacOs=(0,w.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=Z=>{},this._keyboardUpEvent=Z=>{},this._keyboardBlurEvent=Z=>{},this._pointerMoveEvent=Z=>{},this._pointerDownEvent=Z=>{},this._pointerUpEvent=Z=>{},this._pointerCancelEvent=Z=>{},this._pointerCancelTouch=Z=>{},this._pointerLeaveEvent=Z=>{},this._pointerWheelEvent=Z=>{},this._pointerBlurEvent=Z=>{},this._pointerMacOsChromeOutEvent=Z=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,w.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,w.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=Z=>{},this._gamepadDisconnectedEvent=Z=>{},this._eventPrefix=k.c.GetPointerPrefix(Z),this._engine=Z,this._onDeviceConnected=c,this._onDeviceDisconnected=L,this._onInputChanged=N,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(Z,c,L){const N=this._inputs[Z][c];if(!N)throw`Unable to find device ${u[Z]}`;Z>=u.DualShock&&Z<=u.DualSense&&this._updateDevice(Z,c,L);const R=N[L];if(void 0===R)throw`Unable to find input ${L} for device ${u[Z]} in slot ${c}`;return L===X.Move&&k.c.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),R}isDeviceAvailable(Z){return void 0!==this._inputs[Z]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const Z=null===this||void 0===this?void 0:this._engine.getInputElement();if(Z&&(!this._eventsAttached||this._elementToAttachTo!==Z)){if(this._disableEvents(),this._inputs)for(const Z of this._inputs)if(Z)for(const c in Z){const L=Z[+c];if(L)for(let Z=0;Z<L.length;Z++)L[Z]=0}this._elementToAttachTo=Z,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const Z=navigator.getGamepads();for(const c of Z)c&&this._addGamePad(c)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(u.Mouse,0,0,0)}_addGamePad(Z){const c=this._getGamepadDeviceType(Z.id),L=Z.index;this._gamepads=this._gamepads||new Array(Z.index+1),this._registerDevice(c,L,Z.buttons.length+Z.axes.length),this._gamepads[L]=c}_addPointerDevice(Z,c,L,k){this._pointerActive||(this._pointerActive=!0),this._registerDevice(Z,c,d);const N=this._inputs[Z][c];N[0]=L,N[1]=k}_registerDevice(Z,c,L){if(void 0===c)throw`Unable to register device ${u[Z]} to undefined slot.`;if(this._inputs[Z]||(this._inputs[Z]={}),!this._inputs[Z][c]){const k=new Array(L);k.fill(0),this._inputs[Z][c]=k,this._onDeviceConnected(Z,c)}}_unregisterDevice(Z,c){this._inputs[Z][c]&&(delete this._inputs[Z][c],this._onDeviceDisconnected(Z,c))}_handleKeyActions(){this._keyboardDownEvent=Z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(u.Keyboard,0,255));const c=this._inputs[u.Keyboard][0];if(c){c[Z.keyCode]=1;const L=Z;L.inputIndex=Z.keyCode,this._usingMacOs&&Z.metaKey&&"Meta"!==Z.key&&(this._metaKeys.includes(Z.keyCode)||this._metaKeys.push(Z.keyCode)),this._onInputChanged(u.Keyboard,0,L)}},this._keyboardUpEvent=Z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(u.Keyboard,0,255));const c=this._inputs[u.Keyboard][0];if(c){c[Z.keyCode]=0;const L=Z;if(L.inputIndex=Z.keyCode,this._usingMacOs&&"Meta"===Z.key&&this._metaKeys.length>0){for(const Z of this._metaKeys){const L=T.CreateDeviceEvent(u.Keyboard,0,Z,0,this,this._elementToAttachTo);c[Z]=0,this._onInputChanged(u.Keyboard,0,L)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(u.Keyboard,0,L)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const Z=this._inputs[u.Keyboard][0];for(let c=0;c<Z.length;c++)if(0!==Z[c]){Z[c]=0;const L=T.CreateDeviceEvent(u.Keyboard,0,c,0,this,this._elementToAttachTo);this._onInputChanged(u.Keyboard,0,L)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,w.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let k=0;k<this._maxTouchPoints;k++)this._activeTouchIds[k]=-1;this._pointerMoveEvent=Z=>{const c=this._getPointerType(Z);let L=c===u.Mouse?0:this._activeTouchIds.indexOf(Z.pointerId);if(c===u.Touch&&-1===L){const N=this._activeTouchIds.indexOf(-1);if(!(N>=0))return void k.c.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);L=N,this._activeTouchIds[N]=Z.pointerId,this._onDeviceConnected(c,L)}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][L]||this._addPointerDevice(c,L,Z.clientX,Z.clientY);const N=this._inputs[c][L];if(N){const k=Z;k.inputIndex=X.Move,N[X.Horizontal]=Z.clientX,N[X.Vertical]=Z.clientY,c===u.Touch&&0===N[X.LeftClick]&&(N[X.LeftClick]=1),void 0===Z.pointerId&&(Z.pointerId=this._mouseId),this._onInputChanged(c,L,k),this._usingSafari||-1===Z.button||(k.inputIndex=Z.button+2,N[Z.button+2]=N[Z.button+2]?0:1,this._onInputChanged(c,L,k))}},this._pointerDownEvent=Z=>{const c=this._getPointerType(Z);let L=c===u.Mouse?0:Z.pointerId;if(c===u.Touch){let c=this._activeTouchIds.indexOf(Z.pointerId);if(-1===c&&(c=this._activeTouchIds.indexOf(-1)),!(c>=0))return void k.c.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);L=c,this._activeTouchIds[c]=Z.pointerId}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][L]?c===u.Touch&&this._onDeviceConnected(c,L):this._addPointerDevice(c,L,Z.clientX,Z.clientY);const N=this._inputs[c][L];if(N){const k=N[X.Horizontal],G=N[X.Vertical];if(c===u.Mouse){if(void 0===Z.pointerId&&(Z.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(R){}}else if(Z.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(Z.pointerId)}catch(R){}N[X.Horizontal]=Z.clientX,N[X.Vertical]=Z.clientY,N[Z.button+2]=1;const V=Z;V.inputIndex=Z.button+2,this._onInputChanged(c,L,V),k===Z.clientX&&G===Z.clientY||(V.inputIndex=X.Move,this._onInputChanged(c,L,V))}},this._pointerUpEvent=Z=>{var c;const L=this._getPointerType(Z),k=L===u.Mouse?0:this._activeTouchIds.indexOf(Z.pointerId);if(L===u.Touch){if(-1===k)return;this._activeTouchIds[k]=-1}const N=null===(c=this._inputs[L])||void 0===c?void 0:c[k];let R=Z.button,G=N&&0!==N[R+2];if(!G&&this._isUsingFirefox&&this._usingMacOs&&N&&(R=2===R?0:2,G=0!==N[R+2]),G){var V,p,J,z;const c=N[X.Horizontal],G=N[X.Vertical];N[X.Horizontal]=Z.clientX,N[X.Vertical]=Z.clientY,N[R+2]=0;const i=Z;void 0===Z.pointerId&&(Z.pointerId=this._mouseId),c===Z.clientX&&G===Z.clientY||(i.inputIndex=X.Move,this._onInputChanged(L,k,i)),i.inputIndex=R+2,L===u.Mouse&&this._mouseId>=0&&null!==(V=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(p,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):Z.pointerId&&null!==(J=(z=this._elementToAttachTo).hasPointerCapture)&&void 0!==J&&J.call(z,Z.pointerId)&&this._elementToAttachTo.releasePointerCapture(Z.pointerId),this._onInputChanged(L,k,i),L===u.Touch&&this._onDeviceDisconnected(L,k)}},this._pointerCancelTouch=Z=>{var c,L;const k=this._activeTouchIds.indexOf(Z);if(-1===k)return;null!==(c=(L=this._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(L,Z)&&this._elementToAttachTo.releasePointerCapture(Z),this._inputs[u.Touch][k][X.LeftClick]=0;const N=T.CreateDeviceEvent(u.Touch,k,X.LeftClick,0,this,this._elementToAttachTo,Z);this._onInputChanged(u.Touch,k,N),this._activeTouchIds[k]=-1,this._onDeviceDisconnected(u.Touch,k)},this._pointerCancelEvent=Z=>{if("mouse"===Z.pointerType){var c,L;const Z=this._inputs[u.Mouse][0];this._mouseId>=0&&null!==(c=(L=this._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(L,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let c=X.LeftClick;c<=X.BrowserForward;c++)if(1===Z[c]){Z[c]=0;const L=T.CreateDeviceEvent(u.Mouse,0,c,0,this,this._elementToAttachTo);this._onInputChanged(u.Mouse,0,L)}}else this._pointerCancelTouch(Z.pointerId)},this._pointerLeaveEvent=Z=>{"pen"===Z.pointerType&&this._pointerCancelTouch(Z.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let Z=!1;const c=function(){};try{const L=Object.defineProperty({},"passive",{get:function(){Z=!0}});this._elementToAttachTo.addEventListener("test",c,L),this._elementToAttachTo.removeEventListener("test",c,L)}catch(L){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(u.Mouse)){var Z,c;const L=this._inputs[u.Mouse][0];this._mouseId>=0&&null!==(Z=(c=this._elementToAttachTo).hasPointerCapture)&&void 0!==Z&&Z.call(c,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let Z=X.LeftClick;Z<=X.BrowserForward;Z++)if(1===L[Z]){L[Z]=0;const c=T.CreateDeviceEvent(u.Mouse,0,Z,0,this,this._elementToAttachTo);this._onInputChanged(u.Mouse,0,c)}}if(this.isDeviceAvailable(u.Touch)){const Z=this._inputs[u.Touch];for(let c=0;c<this._activeTouchIds.length;c++){var L,k,N;const R=this._activeTouchIds[c];if(null!==(L=(k=this._elementToAttachTo).hasPointerCapture)&&void 0!==L&&L.call(k,R)&&this._elementToAttachTo.releasePointerCapture(R),-1!==R&&1===(null===(N=Z[c])||void 0===N?void 0:N[X.LeftClick])){Z[c][X.LeftClick]=0;const L=T.CreateDeviceEvent(u.Touch,c,X.LeftClick,0,this,this._elementToAttachTo,R);this._onInputChanged(u.Touch,c,L),this._activeTouchIds[c]=-1,this._onDeviceDisconnected(u.Touch,c)}}}},this._pointerWheelEvent=Z=>{const c=u.Mouse;this._inputs[c]||(this._inputs[c]=[]),this._inputs[c][0]||(this._pointerActive=!0,this._registerDevice(c,0,d));const L=this._inputs[c][0];if(L){L[X.MouseWheelX]=Z.deltaX||0,L[X.MouseWheelY]=Z.deltaY||Z.wheelDelta||0,L[X.MouseWheelZ]=Z.deltaZ||0;const k=Z;void 0===Z.pointerId&&(Z.pointerId=this._mouseId),0!==L[X.MouseWheelX]&&(k.inputIndex=X.MouseWheelX,this._onInputChanged(c,0,k)),0!==L[X.MouseWheelY]&&(k.inputIndex=X.MouseWheelY,this._onInputChanged(c,0,k)),0!==L[X.MouseWheelZ]&&(k.inputIndex=X.MouseWheelZ,this._onInputChanged(c,0,k))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=Z=>{Z.buttons>1&&this._pointerCancelEvent(Z)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!Z&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(u.Mouse)){const Z=this._inputs[u.Mouse][0];Z[X.MouseWheelX]=0,Z[X.MouseWheelY]=0,Z[X.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=Z=>{this._addGamePad(Z.gamepad)},this._gamepadDisconnectedEvent=Z=>{if(this._gamepads){const c=this._getGamepadDeviceType(Z.gamepad.id),L=Z.gamepad.index;this._unregisterDevice(c,L),delete this._gamepads[L]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(Z,c,L){const k=navigator.getGamepads()[c];if(k&&Z===this._gamepads[c]){const N=this._inputs[Z][c];L>=k.buttons.length?N[L]=k.axes[L-k.buttons.length].valueOf():N[L]=k.buttons[L].value}}_getGamepadDeviceType(Z){return-1!==Z.indexOf("054c")?-1!==Z.indexOf("0ce6")?u.DualSense:u.DualShock:-1!==Z.indexOf("Xbox One")||-1!==Z.search("Xbox 360")||-1!==Z.search("xinput")?u.Xbox:-1!==Z.indexOf("057e")?u.Switch:u.Generic}_getPointerType(Z){let c=u.Mouse;return("touch"===Z.pointerType||"pen"===Z.pointerType||Z.touches)&&(c=u.Touch),c}}class r{constructor(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=c,this.deviceSlot=L,this.onInputChangedObservable=new R.b,this._deviceInputSystem=Z}getInput(Z){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,Z)}}class f{constructor(Z){this._registeredManagers=new Array,this._refCount=0,this.registerManager=Z=>{for(let c=0;c<this._devices.length;c++){const L=this._devices[c];for(const k in L){const L=+k;Z._addDevice(new r(this._deviceInputSystem,c,L))}}this._registeredManagers.push(Z)},this.unregisterManager=Z=>{const c=this._registeredManagers.indexOf(Z);c>-1&&this._registeredManagers.splice(c,1)};const c=Object.keys(u).length/2;this._devices=new Array(c);const L=(Z,c)=>{this._devices[Z]||(this._devices[Z]=new Array),this._devices[Z][c]||(this._devices[Z][c]=c);for(const L of this._registeredManagers){const k=new r(this._deviceInputSystem,Z,c);L._addDevice(k)}},k=(Z,c)=>{var L;null!==(L=this._devices[Z])&&void 0!==L&&L[c]&&delete this._devices[Z][c];for(const k of this._registeredManagers)k._removeDevice(Z,c)},N=(Z,c,L)=>{if(L)for(const k of this._registeredManagers)k._onInputChanged(Z,c,L)};"undefined"!==typeof _native?this._deviceInputSystem=new I(L,k,N):this._deviceInputSystem=new Q(Z,L,k,N)}dispose(){this._deviceInputSystem.dispose()}}class S{getDeviceSource(Z,c){if(void 0===c){if(void 0===this._firstDevice[Z])return null;c=this._firstDevice[Z]}return this._devices[Z]&&void 0!==this._devices[Z][c]?this._devices[Z][c]:null}getDeviceSources(Z){return this._devices[Z]?this._devices[Z].filter((Z=>!!Z)):[]}constructor(Z){const c=Object.keys(u).length/2;this._devices=new Array(c),this._firstDevice=new Array(c),this._engine=Z,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new f(Z)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new R.b((Z=>{for(const c of this._devices)if(c)for(const L of c)L&&this.onDeviceConnectedObservable.notifyObserver(Z,L)})),this.onDeviceDisconnectedObservable=new R.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=Z.Xc.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Xc.remove(this._onDisposeObserver)}_addDevice(Z){this._devices[Z.deviceType]||(this._devices[Z.deviceType]=[]),this._devices[Z.deviceType][Z.deviceSlot]||(this._devices[Z.deviceType][Z.deviceSlot]=Z,this._updateFirstDevices(Z.deviceType)),this.onDeviceConnectedObservable.notifyObservers(Z)}_removeDevice(Z,c){var L,k;const N=null===(L=this._devices[Z])||void 0===L?void 0:L[c];this.onDeviceDisconnectedObservable.notifyObservers(N),null!==(k=this._devices[Z])&&void 0!==k&&k[c]&&delete this._devices[Z][c],this._updateFirstDevices(Z)}_onInputChanged(Z,c,L){var k,N;null===(k=this._devices[Z])||void 0===k||null===(N=k[c])||void 0===N||N.onInputChangedObservable.notifyObservers(L)}_updateFirstDevices(Z){switch(Z){case u.Keyboard:case u.Mouse:this._firstDevice[Z]=0;break;case u.Touch:case u.DualSense:case u.DualShock:case u.Xbox:case u.Switch:case u.Generic:{delete this._firstDevice[Z];const c=this._devices[Z];if(c)for(let L=0;L<c.length;L++)if(c[L]){this._firstDevice[Z]=L;break}break}}}}var s=L(11637);class m{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get yk(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(Z){this._singleClick=Z}set yk(Z){this._doubleClick=Z}set hasSwiped(Z){this._hasSwiped=Z}set ignore(Z){this._ignore=Z}}class A{constructor(Z){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new J.f(0,0),this._previousStartingPointerPosition=new J.f(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=Z||M.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(Z){return this._meshUnderPointerId[Z]||null}get unTranslatedPointer(){return new J.f(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(Z){this._pointerX=Z}get pointerY(){return this._pointerY}set pointerY(Z){this._pointerY=Z}_updatePointerPosition(Z){const c=this._scene.getEngine().getInputElementClientRect();c&&(this._pointerX=Z.clientX-c.left,this._pointerY=Z.clientY-c.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(Z,c){const L=this._scene,k=L.getEngine(),N=k.getInputElement();N&&(N.tabIndex=k.canvasTabIndex,L.doNotHandleCursors||(N.style.cursor=L.defaultCursor)),this._setCursorAndPointerOverMesh(Z,c,L);for(const p of L._pointerMoveStage){var R;const L=!(null===(R=Z=Z||this._pickMove(c))||void 0===R||!R.pickedMesh);Z=p.action(this._unTranslatedPointerX,this._unTranslatedPointerY,Z,L,N)}const G=c.inputIndex>=X.MouseWheelX&&c.inputIndex<=X.MouseWheelZ?j.e.POINTERWHEEL:j.e.POINTERMOVE;let V;L.onPointerMove&&(Z=Z||this._pickMove(c),L.onPointerMove(c,Z,G)),Z?(V=new j.m(G,c,Z),this._setRayOnPointerInfo(Z,c)):(V=new j.m(G,c,null,this),this._movePointerInfo=V),L.onPointerObservable.hasObservers()&&L.onPointerObservable.notifyObservers(V,G)}_setRayOnPointerInfo(Z,c){const L=this._scene;Z&&s.d._IsPickingAvailable&&(Z.ray||(Z.ray=L.createPickingRay(c.offsetX,c.offsetY,J.b.Identity(),L.activeCamera)))}_addCameraPointerObserver(Z,c){return this._cameraObserverCount++,this._scene.onPointerObservable.add(Z,c)}_removeCameraPointerObserver(Z){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(Z)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(Z,c,L){const k=this._scene,N=new j.i(L,c,this._unTranslatedPointerX,this._unTranslatedPointerY);return Z&&(N.originalPickingInfo=Z,N.ray=Z.ray,"xr-near"===c.pointerType&&Z.originMesh&&(N.nearInteractionPickingInfo=Z)),k.onPrePointerObservable.notifyObservers(N,L),!!N.skipOnPointerObservable}_pickMove(Z){const c=this._scene,L=c.gL(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerMovePredicate,c.pointerMoveFastCheck,c.cameraToUseForPointers,c.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(L,Z,c),L}_setCursorAndPointerOverMesh(Z,c,L){const k=L.getEngine().getInputElement();if(null!==Z&&void 0!==Z&&Z.pickedMesh){if(this.setPointerOverMesh(Z.pickedMesh,c.pointerId,Z,c),!L.doNotHandleCursors&&k&&this._pointerOverMesh){const Z=this._pointerOverMesh._getActionManagerForTrigger();Z&&Z.hasPointerTriggers&&(k.style.cursor=Z.hoverCursor||L.hoverCursor)}}else this.setPointerOverMesh(null,c.pointerId,Z,c)}simulatePointerMove(Z,c){const L=new PointerEvent("pointermove",c);L.inputIndex=X.Move,this._checkPrePointerObservable(Z,L,j.e.POINTERMOVE)||this._processPointerMove(Z,L)}simulatePointerDown(Z,c){const L=new PointerEvent("pointerdown",c);L.inputIndex=L.button+2,this._checkPrePointerObservable(Z,L,j.e.POINTERDOWN)||this._processPointerDown(Z,L)}_processPointerDown(Z,c){var L;const k=this._scene;if(null!==(L=Z)&&void 0!==L&&L.pickedMesh){this._pickedDownMesh=Z.pickedMesh;const L=Z.pickedMesh._getActionManagerForTrigger();if(L){if(L.hasPickTriggers)switch(L.processTrigger(5,new E(Z.pickedMesh,k.pointerX,k.pointerY,Z.pickedMesh,c,Z)),c.button){case 0:L.processTrigger(2,new E(Z.pickedMesh,k.pointerX,k.pointerY,Z.pickedMesh,c,Z));break;case 1:L.processTrigger(4,new E(Z.pickedMesh,k.pointerX,k.pointerY,Z.pickedMesh,c,Z));break;case 2:L.processTrigger(3,new E(Z.pickedMesh,k.pointerX,k.pointerY,Z.pickedMesh,c,Z))}L.hasSpecificTrigger(8)&&window.setTimeout((()=>{const Z=k.gL(this._unTranslatedPointerX,this._unTranslatedPointerY,(Z=>Z.ep&&Z.isVisible&&Z.isReady()&&Z.actionManager&&Z.actionManager.hasSpecificTrigger(8)&&Z===this._pickedDownMesh),!1,k.cameraToUseForPointers);null!==Z&&void 0!==Z&&Z.pickedMesh&&L&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>A.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,L.processTrigger(8,E.CreateNew(Z.pickedMesh,c)))}),A.LongPressDelay)}}else for(const G of k._pointerDownStage)Z=G.action(this._unTranslatedPointerX,this._unTranslatedPointerY,Z,c,!1);let N;const R=j.e.POINTERDOWN;Z?(k.onPointerDown&&k.onPointerDown(c,Z,R),N=new j.m(R,c,Z),this._setRayOnPointerInfo(Z,c)):N=new j.m(R,c,null,this),k.onPointerObservable.hasObservers()&&k.onPointerObservable.notifyObservers(N,R)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(Z,c,L){const k=new PointerEvent("pointerup",c);k.inputIndex=X.Move;const N=new m;L?N.yk=!0:N.singleClick=!0,this._checkPrePointerObservable(Z,k,j.e.POINTERUP)||this._processPointerUp(Z,k,N)}_processPointerUp(Z,c,L){var k;const N=this._scene;if(null!==(k=Z)&&void 0!==k&&k.pickedMesh){if(this._pickedUpMesh=Z.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(N.onPointerPick&&N.onPointerPick(c,Z),L.singleClick&&!L.ignore&&N.onPointerObservable.observers.length>this._cameraObserverCount)){const L=j.e.POINTERPICK,k=new j.m(L,c,Z);this._setRayOnPointerInfo(Z,c),N.onPointerObservable.notifyObservers(k,L)}const k=Z.pickedMesh._getActionManagerForTrigger();if(k&&!L.ignore){k.processTrigger(7,E.CreateNew(Z.pickedMesh,c,Z)),!L.hasSwiped&&L.singleClick&&k.processTrigger(1,E.CreateNew(Z.pickedMesh,c,Z));const N=Z.pickedMesh._getActionManagerForTrigger(6);L.yk&&N&&N.processTrigger(6,E.CreateNew(Z.pickedMesh,c,Z))}}else if(!L.ignore)for(const R of N._pointerUpStage)Z=R.action(this._unTranslatedPointerX,this._unTranslatedPointerY,Z,c,L.yk);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const Z=this._pickedDownMesh._getActionManagerForTrigger(16);Z&&Z.processTrigger(16,E.CreateNew(this._pickedDownMesh,c))}if(!L.ignore){const k=new j.m(j.e.POINTERUP,c,Z);if(this._setRayOnPointerInfo(Z,c),N.onPointerObservable.notifyObservers(k,j.e.POINTERUP),N.onPointerUp&&N.onPointerUp(c,Z,j.e.POINTERUP),!L.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let k=0;if(L.singleClick?k=j.e.POINTERTAP:L.yk&&(k=j.e.POINTERDOUBLETAP),k){const L=new j.m(k,c,Z);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(k)&&N.onPointerObservable.notifyObservers(L,k)}}}}isPointerCaptured(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[Z]}attachControl(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._scene,R=N.getEngine();k||(k=R.getInputElement()),this._alreadyAttached&&this.Oi(),k&&(this._alreadyAttachedTo=k),this._deviceSourceManager=new S(R),this._initActionManager=Z=>{if(!this._meshPickProceed){const c=N.skipPointerUpPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerUp?null:N.gL(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerUpPredicate,N.pointerUpFastCheck,N.cameraToUseForPointers,N.pointerUpTrianglePredicate);this._currentPickResult=c,c&&(Z=c.hit&&c.pickedMesh?c.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return Z},this._delayedSimpleClick=(Z,c,L)=>{if((Date.now()-this._previousStartingPointerTime>A.DoubleClickDelay&&!this._doubleClickOccured||Z!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,this._delayedClicks[Z])){const c=this._delayedClicks[Z].evt,L=j.e.POINTERTAP,k=new j.m(L,c,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(L)&&N.onPointerObservable.notifyObservers(k,L),this._delayedClicks[Z]=null}},this._initClickEvent=(Z,c,L,k)=>{const N=new m;this._currentPickResult=null;let R=null,G=Z.hasSpecificMask(j.e.POINTERPICK)||c.hasSpecificMask(j.e.POINTERPICK)||Z.hasSpecificMask(j.e.POINTERTAP)||c.hasSpecificMask(j.e.POINTERTAP)||Z.hasSpecificMask(j.e.POINTERDOUBLETAP)||c.hasSpecificMask(j.e.POINTERDOUBLETAP);!G&&o&&(R=this._initActionManager(R,N),R&&(G=R.hasPickTriggers));let V=!1;if(G=G&&!this._isMultiTouchGesture,G){const G=L.button;if(N.hasSwiped=this._isPointerSwiping(),!N.hasSwiped){let z=!A.ExclusiveDoubleClickMode;if(z||(z=!Z.hasSpecificMask(j.e.POINTERDOUBLETAP)&&!c.hasSpecificMask(j.e.POINTERDOUBLETAP),z&&!o.HasSpecificTrigger(6)&&(R=this._initActionManager(R,N),R&&(z=!R.hasSpecificTrigger(6)))),z)(Date.now()-this._previousStartingPointerTime>A.DoubleClickDelay||G!==this._previousButtonPressed)&&(N.singleClick=!0,k(N,this._currentPickResult),V=!0);else{const Z={evt:L,clickInfo:N,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,G,N,k),A.DoubleClickDelay)};this._delayedClicks[G]=Z}let i=Z.hasSpecificMask(j.e.POINTERDOUBLETAP)||c.hasSpecificMask(j.e.POINTERDOUBLETAP);if(!i&&o.HasSpecificTrigger(6)&&(R=this._initActionManager(R,N),R&&(i=R.hasSpecificTrigger(6))),i)if(G===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<A.DoubleClickDelay&&!this._doubleClickOccured){if(N.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=G,A.ExclusiveDoubleClickMode){var p;if(this._delayedClicks[G])clearTimeout(null===(p=this._delayedClicks[G])||void 0===p?void 0:p.timeoutId),this._delayedClicks[G]=null;k(N,this._previousPickResult)}else k(N,this._currentPickResult);else{var J;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,N.yk=!0,N.ignore=!1,A.ExclusiveDoubleClickMode&&this._delayedClicks[G])clearTimeout(null===(J=this._delayedClicks[G])||void 0===J?void 0:J.timeoutId),this._delayedClicks[G]=null;k(N,this._currentPickResult)}V=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=G}}V||k(N,this._currentPickResult)},this._onPointerMove=Z=>{if(this._updatePointerPosition(Z),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>A.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>A.DragMovementThreshold),R.isPointerLock&&R._verifyPointerLock(),this._checkPrePointerObservable(null,Z,Z.inputIndex>=X.MouseWheelX&&Z.inputIndex<=X.MouseWheelZ?j.e.POINTERWHEEL:j.e.POINTERMOVE))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;if(N.Xi)return void this._processPointerMove(new t.e,Z);N.pointerMovePredicate||(N.pointerMovePredicate=Z=>Z.ep&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(Z.enablePointerMoveEvents||N.constantlyUpdateMeshUnderPointer||null!==Z._getActionManagerForTrigger())&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&Z.layerMask)));const c=N._registeredActions>0||N.constantlyUpdateMeshUnderPointer?this._pickMove(Z):null;this._processPointerMove(c,Z)},this._onPointerDown=Z=>{const c=this._activePointerIds.indexOf(-1);if(-1===c?this._activePointerIds.push(Z.pointerId):this._activePointerIds[c]=Z.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,A.ExclusiveDoubleClickMode)for(let k=0;k<this._delayedClicks.length;k++)if(this._delayedClicks[k])if(Z.button===k){var L;clearTimeout(null===(L=this._delayedClicks[k])||void 0===L?void 0:L.timeoutId)}else{const Z=this._delayedClicks[k].clickInfo;this._doubleClickOccured=!1,Z.singleClick=!0,Z.ignore=!1;const c=this._delayedClicks[k].evt,L=j.e.POINTERTAP,R=new j.m(L,c,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(L)&&N.onPointerObservable.notifyObservers(R,L),this._delayedClicks[k]=null}if(this._updatePointerPosition(Z),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=Z.button),N.preventDefaultOnPointerDown&&k&&(Z.preventDefault(),k.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,Z,j.e.POINTERDOWN))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;let R;this._pointerCaptures[Z.pointerId]=!0,N.pointerDownPredicate||(N.pointerDownPredicate=Z=>Z.ep&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&Z.layerMask))),this._pickedDownMesh=null,R=N.skipPointerDownPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerDown?new t.e:N.gL(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerDownPredicate,N.pointerDownFastCheck,N.cameraToUseForPointers,N.pointerDownTrianglePredicate),this._processPointerDown(R,Z)},this._onPointerUp=Z=>{const c=this._activePointerIds.indexOf(Z.pointerId);-1!==c&&(this._activePointerIds[c]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(Z),N.preventDefaultOnPointerUp&&k&&(Z.preventDefault(),k.focus()),this._initClickEvent(N.onPrePointerObservable,N.onPointerObservable,Z,((c,L)=>{if(N.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!c.ignore)){if(this._checkPrePointerObservable(null,Z,j.e.POINTERUP))return this._swipeButtonPressed===Z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===Z.buttons&&(this._pointerCaptures[Z.pointerId]=!1));c.hasSwiped||(c.singleClick&&N.onPrePointerObservable.hasSpecificMask(j.e.POINTERTAP)&&this._checkPrePointerObservable(null,Z,j.e.POINTERTAP)&&(this._skipPointerTap=!0),c.yk&&N.onPrePointerObservable.hasSpecificMask(j.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,Z,j.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[Z.pointerId]?(0===Z.buttons&&(this._pointerCaptures[Z.pointerId]=!1),(N.cameraToUseForPointers||N.activeCamera)&&(N.pointerUpPredicate||(N.pointerUpPredicate=Z=>Z.ep&&Z.isVisible&&Z.isReady()&&Z.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&Z.layerMask))),!this._meshPickProceed&&(o&&o.HasTriggers||this._checkForPicking()||N.onPointerUp)&&this._initActionManager(null,c),L||(L=this._currentPickResult),this._processPointerUp(L,Z,c),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===Z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===Z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=Z=>{const c=l.d.KEYDOWN;if(N.onPreKeyboardObservable.hasObservers()){const L=new l.e(c,Z);if(N.onPreKeyboardObservable.notifyObservers(L,c),L.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const L=new l.h(c,Z);N.onKeyboardObservable.notifyObservers(L,c)}N.actionManager&&N.actionManager.processTrigger(14,E.CreateNewFromScene(N,Z))},this._onKeyUp=Z=>{const c=l.d.KEYUP;if(N.onPreKeyboardObservable.hasObservers()){const L=new l.e(c,Z);if(N.onPreKeyboardObservable.notifyObservers(L,c),L.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const L=new l.h(c,Z);N.onKeyboardObservable.notifyObservers(L,c)}N.actionManager&&N.actionManager.processTrigger(15,E.CreateNewFromScene(N,Z))},this._deviceSourceManager.onDeviceConnectedObservable.add((k=>{k.deviceType===u.Mouse?k.onInputChangedObservable.add((N=>{this._originMouseEvent=N,N.inputIndex===X.LeftClick||N.inputIndex===X.MiddleClick||N.inputIndex===X.RightClick||N.inputIndex===X.BrowserBack||N.inputIndex===X.BrowserForward?c&&1===k.getInput(N.inputIndex)?this._onPointerDown(N):Z&&0===k.getInput(N.inputIndex)&&this._onPointerUp(N):L&&(N.inputIndex===X.Move?this._onPointerMove(N):N.inputIndex!==X.MouseWheelX&&N.inputIndex!==X.MouseWheelY&&N.inputIndex!==X.MouseWheelZ||this._onPointerMove(N))})):k.deviceType===u.Touch?k.onInputChangedObservable.add((N=>{N.inputIndex===X.LeftClick&&(c&&1===k.getInput(N.inputIndex)?(this._onPointerDown(N),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):Z&&0===k.getInput(N.inputIndex)&&(this._onPointerUp(N),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),L&&N.inputIndex===X.Move&&this._onPointerMove(N)})):k.deviceType===u.Keyboard&&k.onInputChangedObservable.add((Z=>{"keydown"===Z.type?this._onKeyDown(Z):"keyup"===Z.type&&this._onKeyUp(Z)}))})),this._alreadyAttached=!0}Oi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,L=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[c]===Z&&(!Z||!Z._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const N=this._meshUnderPointerId[c];let R;N&&(R=N._getActionManagerForTrigger(10),R&&R.processTrigger(10,new E(N,this._pointerX,this._pointerY,Z,k,{pointerId:c}))),Z?(this._meshUnderPointerId[c]=Z,this._pointerOverMesh=Z,R=Z._getActionManagerForTrigger(9),R&&R.processTrigger(9,new E(Z,this._pointerX,this._pointerY,Z,k,{pointerId:c,pickResult:L}))):(delete this._meshUnderPointerId[c],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:Z,pointerId:c})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(Z){this._pointerOverMesh===Z&&(this._pointerOverMesh=null),this._pickedDownMesh===Z&&(this._pickedDownMesh=null),this._pickedUpMesh===Z&&(this._pickedUpMesh=null);for(const c in this._meshUnderPointerId)this._meshUnderPointerId[c]===Z&&delete this._meshUnderPointerId[c]}}A.DragMovementThreshold=10,A.LongPressDelay=500,A.DoubleClickDelay=300,A.ExclusiveDoubleClickMode=!1;var b=L(11496),F=L(11255),U=L(11351),K=L(11645),n=L(11081),g=L(11266),y=L(11008);class v{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Xi=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var Y,a=L(11052),C=L(11012);!function(Z){Z[Z.BackwardCompatible=0]="BackwardCompatible",Z[Z.Intermediate=1]="Intermediate",Z[Z.Aggressive=2]="Aggressive"}(Y||(Y={}));class ZZ{static DefaultMaterialFactory(Z){throw(0,P.e)("Sc")}static CollisionCoordinatorFactory(){throw(0,P.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(Z){Z!==this._clearColor&&(this._clearColor=Z,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(Z){if(Z!==this._performancePriority){switch(this._performancePriority=Z,Z){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Xi=!1,this.wi=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Xi=!0,this.wi=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Xi=!0,this.wi=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(Z)}}set forceWireframe(Z){this._forceWireframe!==Z&&(this._forceWireframe=Z,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(Z){this._skipFrustumClipping!==Z&&(this._skipFrustumClipping=Z)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(Z){this._forcePointsCloud!==Z&&(this._forcePointsCloud=Z,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture!==Z&&(this._environmentTexture=Z,this.onEnvironmentTextureChangedObservable.notifyObservers(Z),this.markAllMaterialsAsDirty(1))}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const c of this.skeletons)Z=Z.concat(c.bones);return Z}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}set onDispose(Z){this._onDisposeObserver&&this.Xc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xc.add(Z)}set beforeRender(Z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),Z&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(Z))}set afterRender(Z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),Z&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(Z))}set beforeCameraRender(Z){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(Z)}set afterCameraRender(Z){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(Z)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(Z){this._pointerPickingConfiguration.pointerDownPredicate=Z}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(Z){this._pointerPickingConfiguration.pointerUpPredicate=Z}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(Z){this._pointerPickingConfiguration.pointerMovePredicate=Z}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(Z){this._pointerPickingConfiguration.pointerDownFastCheck=Z}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(Z){this._pointerPickingConfiguration.pointerUpFastCheck=Z}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(Z){this._pointerPickingConfiguration.pointerMoveFastCheck=Z}get Xi(){return this._pointerPickingConfiguration.Xi}set Xi(Z){this._pointerPickingConfiguration.Xi=Z}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(Z){this._pointerPickingConfiguration.skipPointerDownPicking=Z}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(Z){this._pointerPickingConfiguration.skipPointerUpPicking=Z}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return A.DragMovementThreshold}static set DragMovementThreshold(Z){A.DragMovementThreshold=Z}static get LongPressDelay(){return A.LongPressDelay}static set LongPressDelay(Z){A.LongPressDelay=Z}static get DoubleClickDelay(){return A.DoubleClickDelay}static set DoubleClickDelay(Z){A.DoubleClickDelay=Z}static get ExclusiveDoubleClickMode(){return A.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(Z){A.ExclusiveDoubleClickMode=Z}bindEyePosition(Z){var c;let L=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",k=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(c=this.activeCamera)||void 0===c?void 0:c.globalPosition)??J.h.ZeroReadOnly,R=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return J.d.Vector4[0].set(N.x,N.y,N.z,R?-1:1),Z&&(k?Z.setFloat3(L,J.d.Vector4[0].x,J.d.Vector4[0].y,J.d.Vector4[0].z):Z.setVector4(L,J.d.Vector4[0])),J.d.Vector4[0]}finalizeSceneUbo(){const Z=this.getSceneUniformBuffer(),c=this.bindEyePosition(null);return Z.updateFloat4("vEyePosition",c.x,c.y,c.z,c.w),Z.update(),Z}set useRightHandedSystem(Z){this._useRightHandedSystem!==Z&&(this._useRightHandedSystem=Z,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(Z){this._currentStepId=Z}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(Z){this._fogEnabled!==Z&&(this._fogEnabled=Z,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(Z){this._fogMode!==Z&&(this._fogMode=Z,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(Z){this._shadowsEnabled!==Z&&(this._shadowsEnabled=Z,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(Z){this._lightsEnabled!==Z&&(this._lightsEnabled=Z,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(Z){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),Z&&(this._unObserveActiveCameras=(0,y.h)(Z,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=Z}get activeCamera(){return this._activeCamera}set activeCamera(Z){Z!==this._activeCamera&&(this._activeCamera=Z,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return ZZ.DefaultMaterialFactory!==ZZ._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.Uz||(this.Uz=ZZ.DefaultMaterialFactory(this)),this.Uz}set defaultMaterial(Z){this.Uz=Z}set texturesEnabled(Z){this._texturesEnabled!==Z&&(this._texturesEnabled=Z,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(Z){if(this._frameGraph)return this._frameGraph=Z,void(Z||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=Z,Z&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(Z){this._skeletonsEnabled!==Z&&(this._skeletonsEnabled=Z,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=ZZ.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const Z of this._transientComponents)Z.register();this._transientComponents.length=0}}o(Z){this._components.push(Z),this._transientComponents.push(Z);const c=Z;c.addFromContainer&&c.serialize&&this._serializableComponents.push(c)}_getComponent(Z){for(const c of this._components)if(c.name===Z)return c;return null}get uniqueId(){return this._uniqueId}constructor(Z,c){this._inputManager=new A(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.wi=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new F.h(.2,.2,.3,1),this.onClearColorChangedObservable=new R.b,this.ambientColor=new F.d(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new R.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.si=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Xt=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Xc=new R.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new R.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new R.b,this.onAfterRenderCameraObservable=new R.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new R.b,this.onAfterAnimationsObservable=new R.b,this.onBeforeDrawPhaseObservable=new R.b,this.onAfterDrawPhaseObservable=new R.b,this.onReadyObservable=new R.b,this.onBeforeCameraRenderObservable=new R.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new R.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new R.b,this.onAfterActiveMeshesEvaluationObservable=new R.b,this.onBeforeParticlesRenderingObservable=new R.b,this.onAfterParticlesRenderingObservable=new R.b,this.onDataLoadedObservable=new R.b,this.onNewCameraAddedObservable=new R.b,this.onCameraRemovedObservable=new R.b,this.onNewLightAddedObservable=new R.b,this.onLightRemovedObservable=new R.b,this.onNewGeometryAddedObservable=new R.b,this.onGeometryRemovedObservable=new R.b,this.onNewTransformNodeAddedObservable=new R.b,this.onTransformNodeRemovedObservable=new R.b,this.onNewMeshAddedObservable=new R.b,this.onMeshRemovedObservable=new R.b,this.onNewSkeletonAddedObservable=new R.b,this.onSkeletonRemovedObservable=new R.b,this.onNewMaterialAddedObservable=new R.b,this.onNewMultiMaterialAddedObservable=new R.b,this.onMaterialRemovedObservable=new R.b,this.onMultiMaterialRemovedObservable=new R.b,this.onNewTextureAddedObservable=new R.b,this.onTextureRemovedObservable=new R.b,this.onBeforeRenderTargetsRenderObservable=new R.b,this.onAfterRenderTargetsRenderObservable=new R.b,this.onBeforeStepObservable=new R.b,this.onAfterStepObservable=new R.b,this.onActiveCameraChanged=new R.b,this.onActiveCamerasChanged=new R.b,this.onBeforeRenderingGroupObservable=new R.b,this.onAfterRenderingGroupObservable=new R.b,this.onMeshImportedObservable=new R.b,this.onAnimationFileImportedObservable=new R.b,this.onEnvironmentTextureChangedObservable=new R.b,this.onMeshUnderPointerUpdatedObservable=new R.b,this._registeredForLateAnimationBindings=new G.c(256),this._pointerPickingConfiguration=new v,this.onPrePointerObservable=new R.b,this.onPointerObservable=new R.b,this.onPreKeyboardObservable=new R.b,this.onKeyboardObservable=new R.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=ZZ.FOGMODE_NONE,this.fogColor=new F.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new J.h(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new G.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new b.d,this._activeIndices=new b.d,this._activeParticles=new b.d,this._activeBones=new b.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new G.f(256),this._processedMaterials=new G.f(256),this._renderTargets=new G.c(256),this._materialsRenderTargets=new G.c(256),this._activeParticleSystems=new G.f(256),this._activeSkeletons=new G.c(32),this._softwareSkinnedMeshes=new G.c(32),this._activeAnimatables=new Array,this._transformMatrix=J.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=O.f.Create(),this._beforeClearStage=O.f.Create(),this._beforeRenderTargetClearStage=O.f.Create(),this._gatherRenderTargetsStage=O.f.Create(),this._gatherActiveCameraRenderTargetsStage=O.f.Create(),this._isReadyForMeshStage=O.f.Create(),this._beforeEvaluateActiveMeshStage=O.f.Create(),this._evaluateSubMeshStage=O.f.Create(),this._preActiveMeshStage=O.f.Create(),this._cameraDrawRenderTargetStage=O.f.Create(),this._beforeCameraDrawStage=O.f.Create(),this._beforeRenderTargetDrawStage=O.f.Create(),this._beforeRenderingGroupDrawStage=O.f.Create(),this._beforeRenderingMeshStage=O.f.Create(),this._afterRenderingMeshStage=O.f.Create(),this._afterRenderingGroupDrawStage=O.f.Create(),this._afterCameraDrawStage=O.f.Create(),this._afterCameraPostProcessStage=O.f.Create(),this._afterRenderTargetDrawStage=O.f.Create(),this._afterRenderTargetPostProcessStage=O.f.Create(),this._afterRenderStage=O.f.Create(),this._pointerMoveStage=O.f.Create(),this._pointerDownStage=O.f.Create(),this._pointerUpStage=O.f.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const L={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...c};Z=this._engine=Z||M.d.LastCreatedEngine,L.virtual?Z._virtualScenes.push(this):(M.d._LastCreatedScene=this,Z.scenes.push(this)),this._uid=null,this._renderingManager=new q.c(this),x.c&&(this.postProcessManager=new x.c(this)),(0,w.k)()&&this.attachControl(),this._createUbo(),z.b&&(this._imageProcessingConfiguration=new z.b),this.setDefaultCandidateProviders(),L.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=L.useMaterialMeshMap,this.useClonedMeshMap=L.useClonedMeshMap,c&&c.virtual||Z.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(Z){return this._defaultSubMeshCandidates.data=Z.ec,this._defaultSubMeshCandidates.length=Z.ec.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=Z=>this._getDefaultSubMeshCandidates(Z),this.getIntersectingSubMeshCandidates=(Z,c)=>this._getDefaultSubMeshCandidates(Z),this.getCollidingSubMeshCandidates=(Z,c)=>this._getDefaultSubMeshCandidates(Z)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(Z){this._inputManager.pointerX=Z}get pointerY(){return this._inputManager.pointerY}set pointerY(Z){this._inputManager.pointerY=Z}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(Z,c){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==c||this._cachedMaterial!==Z||this._cachedVisibility!==L}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(Z,c){return this._inputManager.simulatePointerMove(Z,c),this}simulatePointerDown(Z,c){return this._inputManager.simulatePointerDown(Z,c),this}simulatePointerUp(Z,c,L){return this._inputManager.simulatePointerUp(Z,c,L),this}isPointerCaptured(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(Z)}attachControl(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(Z,c,L)}Oi(){this._inputManager.Oi()}isReady(){var Z,c;let L,k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const N=this.getEngine(),R=N.currentRenderPassId;N.currentRenderPassId=(null===(Z=this.activeCamera)||void 0===Z?void 0:Z.renderPassId)??R;let G=!0;for(this._pendingData.length>0&&(G=!1),null===(c=this.prePassRenderer)||void 0===c||c.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&G&&(G=this.depthPeelingRenderer.isReady()),k&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),L=0;L<this.meshes.length;L++){const Z=this.meshes[L];if(!Z.ec||0===Z.ec.length)continue;if(!Z.isReady(!0)){G=!1;continue}const c=Z.hasThinInstances||"InstancedMesh"===Z.getClassName()||"InstancedLinesMesh"===Z.getClassName()||N.getCaps().instancedArrays&&Z.instances.length>0;for(const L of this._isReadyForMeshStage)L.action(Z,c)||(G=!1);if(!k)continue;const R=Z.material||this.defaultMaterial;if(R)if(R._storeEffectOnSubMeshes)for(const L of Z.ec){const Z=L.rZ();Z&&Z.hasRenderTargetTextures&&null!=Z.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Z)&&(this._processedMaterials.push(Z),this._materialsRenderTargets.concatWithNoDuplicate(Z.getRenderTargetTextures()))}else R.hasRenderTargetTextures&&null!=R.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(R)&&(this._processedMaterials.push(R),this._materialsRenderTargets.concatWithNoDuplicate(R.getRenderTargetTextures()))}if(k)for(L=0;L<this._materialsRenderTargets.length;++L){this._materialsRenderTargets.data[L].isReadyForRendering()||(G=!1)}for(L=0;L<this.geometries.length;L++){2===this.geometries[L].delayLoadState&&(G=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const V of this.activeCameras)V.isReady(!0)||(G=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(G=!1));for(const V of this.si)V.isReady()||(G=!1);if(this.layers)for(const V of this.layers)V.isReady()||(G=!1);if(this.effectLayers)for(const V of this.effectLayers)V.isLayerReady()||(G=!1);return N.areAllEffectsReady()||(G=!1),N.currentRenderPassId=R,G}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(Z){this.onBeforeRenderObservable.add(Z)}unregisterBeforeRender(Z){this.onBeforeRenderObservable.removeCallback(Z)}registerAfterRender(Z){this.onAfterRenderObservable.add(Z)}unregisterAfterRender(Z){this.onAfterRenderObservable.removeCallback(Z)}_executeOnceBeforeRender(Z){const c=()=>{Z(),setTimeout((()=>{this.unregisterBeforeRender(c)}))};this.registerBeforeRender(c)}executeOnceBeforeRender(Z,c){void 0!==c?setTimeout((()=>{this._executeOnceBeforeRender(Z)}),c):this._executeOnceBeforeRender(Z)}addPendingData(Z){this._pendingData.push(Z)}removePendingData(Z){const c=this.isLoading,L=this._pendingData.indexOf(Z);-1!==L&&this._pendingData.splice(L,1),c&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(Z),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(c)}async whenReadyAsync(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((c=>{this.executeWhenReady((()=>{c()}),Z)}))}_checkIsReady(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(Z)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(Z)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=N.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(Z,c,L,k){L||k||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===Z.updateFlag&&this._projectionUpdateFlag===c.updateFlag||(this._viewUpdateFlag=Z.updateFlag,this._projectionUpdateFlag=c.updateFlag,this._viewMatrix=Z,this._projectionMatrix=c,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?U.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=U.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(L,k):this._sceneUbo.useUbo&&(this._sceneUbo.hc("viewProjection",this._transformMatrix),this._sceneUbo.hc("view",this._viewMatrix),this._sceneUbo.hc("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(Z){const c=new i.c(this._engine,void 0,!1,Z??"LL");return c.addUniform("viewProjection",16),c.addUniform("view",16),c.addUniform("projection",16),c.addUniform("vEyePosition",4),c}setSceneUniformBuffer(Z){this._sceneUbo=Z,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return K.b.UniqueId}mJ(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(Z),Z._resyncLightSources(),Z.parent||Z._addToSceneRootNodes(),k.c.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(Z)})),c)){const c=Z.getChildMeshes();for(const Z of c)this.mJ(Z)}}sJ(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const L=this.meshes.indexOf(Z);if(-1!==L&&(this.meshes.splice(L,1),Z.parent||Z._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(Z),this.onMeshRemovedObservable.notifyObservers(Z),c){const c=Z.getChildMeshes();for(const Z of c)this.sJ(Z)}return L}addTransformNode(Z){this._blockEntityCollection||Z.XZ()===this&&-1!==Z._indexInSceneTransformNodesArray||(Z._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(Z),Z.parent||Z._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(Z))}removeTransformNode(Z){const c=Z._indexInSceneTransformNodesArray;if(-1!==c){if(c!==this.transformNodes.length-1){const Z=this.transformNodes[this.transformNodes.length-1];this.transformNodes[c]=Z,Z._indexInSceneTransformNodesArray=c}Z._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),Z.parent||Z._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(Z),c}removeSkeleton(Z){const c=this.skeletons.indexOf(Z);return-1!==c&&(this.skeletons.splice(c,1),this.onSkeletonRemovedObservable.notifyObservers(Z),this._executeActiveContainerCleanup(this._activeSkeletons)),c}removeMorphTargetManager(Z){const c=this.morphTargetManagers.indexOf(Z);return-1!==c&&this.morphTargetManagers.splice(c,1),c}removeLight(Z){const c=this.lights.indexOf(Z);if(-1!==c){for(const c of this.meshes)c._removeLightSource(Z,!1);this.lights.splice(c,1),this.sortLightsByPriority(),Z.parent||Z._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(Z),c}removeCamera(Z){const c=this.cameras.indexOf(Z);if(-1!==c&&(this.cameras.splice(c,1),Z.parent||Z._removeFromSceneRootNodes()),this.activeCameras){const c=this.activeCameras.indexOf(Z);-1!==c&&this.activeCameras.splice(c,1)}return this.activeCamera===Z&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(Z),c}removeParticleSystem(Z){const c=this.si.indexOf(Z);return-1!==c&&(this.si.splice(c,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),c}removeAnimation(Z){const c=this.animations.indexOf(Z);return-1!==c&&this.animations.splice(c,1),c}stopAnimation(Z,c,L){}removeAnimationGroup(Z){const c=this.animationGroups.indexOf(Z);return-1!==c&&this.animationGroups.splice(c,1),c}removeMultiMaterial(Z){const c=this.multiMaterials.indexOf(Z);return-1!==c&&this.multiMaterials.splice(c,1),this.onMultiMaterialRemovedObservable.notifyObservers(Z),c}removeMaterial(Z){const c=Z._indexInSceneMaterialArray;if(-1!==c&&c<this.materials.length){if(c!==this.materials.length-1){const Z=this.materials[this.materials.length-1];this.materials[c]=Z,Z._indexInSceneMaterialArray=c}Z._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(Z),c}removeActionManager(Z){const c=this.actionManagers.indexOf(Z);return-1!==c&&this.actionManagers.splice(c,1),c}removeTexture(Z){const c=this.textures.indexOf(Z);return-1!==c&&this.textures.splice(c,1),this.onTextureRemovedObservable.notifyObservers(Z),c}addLight(Z){if(!this._blockEntityCollection){this.lights.push(Z),this.sortLightsByPriority(),Z.parent||Z._addToSceneRootNodes();for(const c of this.meshes)-1===c.lightSources.indexOf(Z)&&(c.lightSources.push(Z),c._resyncLightSources());k.c.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(Z)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(g.c.CompareLightsPriority)}addCamera(Z){this._blockEntityCollection||(this.cameras.push(Z),k.c.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(Z)})),Z.parent||Z._addToSceneRootNodes())}addSkeleton(Z){this._blockEntityCollection||(this.skeletons.push(Z),k.c.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(Z)})))}addParticleSystem(Z){this._blockEntityCollection||this.si.push(Z)}addAnimation(Z){this._blockEntityCollection||this.animations.push(Z)}addAnimationGroup(Z){this._blockEntityCollection||this.animationGroups.push(Z)}addMultiMaterial(Z){this._blockEntityCollection||(this.multiMaterials.push(Z),k.c.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(Z)})))}addMaterial(Z){this._blockEntityCollection||Z.XZ()===this&&-1!==Z._indexInSceneMaterialArray||(Z._indexInSceneMaterialArray=this.materials.length,this.materials.push(Z),k.c.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(Z)})))}addMorphTargetManager(Z){this._blockEntityCollection||this.morphTargetManagers.push(Z)}addGeometry(Z){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[Z.uniqueId]=this.geometries.length),this.geometries.push(Z))}addActionManager(Z){this.actionManagers.push(Z)}addTexture(Z){this._blockEntityCollection||(this.textures.push(Z),this.onNewTextureAddedObservable.notifyObservers(Z))}switchActiveCamera(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Oi(),this.activeCamera=Z,c&&Z.attachControl())}setActiveCameraById(Z){const c=this.getCameraById(Z);return c?(this.activeCamera=c,c):null}setActiveCameraByName(Z){const c=this.getCameraByName(Z);return c?(this.activeCamera=c,c):null}getAnimationGroupByName(Z){for(let c=0;c<this.animationGroups.length;c++)if(this.animationGroups[c].name===Z)return this.animationGroups[c];return null}_getMaterial(Z,c){for(let L=0;L<this.materials.length;L++){const Z=this.materials[L];if(c(Z))return Z}if(Z)for(let L=0;L<this.multiMaterials.length;L++){const Z=this.multiMaterials[L];if(c(Z))return Z}return null}getMaterialByUniqueID(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(Z,c)}getMaterialByUniqueId(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.uniqueId===Z))}getMaterialById(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.id===Z))}getMaterialByName(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.name===Z))}getLastMaterialById(Z){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let L=this.materials.length-1;L>=0;L--)if(this.materials[L].id===Z)return this.materials[L];if(c)for(let L=this.multiMaterials.length-1;L>=0;L--)if(this.multiMaterials[L].id===Z)return this.multiMaterials[L];return null}getTextureByUniqueId(Z){for(let c=0;c<this.textures.length;c++)if(this.textures[c].uniqueId===Z)return this.textures[c];return null}getTextureByName(Z){for(let c=0;c<this.textures.length;c++)if(this.textures[c].name===Z)return this.textures[c];return null}getCameraById(Z){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].id===Z)return this.cameras[c];return null}getCameraByUniqueId(Z){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].uniqueId===Z)return this.cameras[c];return null}getCameraByName(Z){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].name===Z)return this.cameras[c];return null}getBoneById(Z){for(let c=0;c<this.skeletons.length;c++){const L=this.skeletons[c];for(let c=0;c<L.bones.length;c++)if(L.bones[c].id===Z)return L.bones[c]}return null}getBoneByName(Z){for(let c=0;c<this.skeletons.length;c++){const L=this.skeletons[c];for(let c=0;c<L.bones.length;c++)if(L.bones[c].name===Z)return L.bones[c]}return null}getLightByName(Z){for(let c=0;c<this.lights.length;c++)if(this.lights[c].name===Z)return this.lights[c];return null}getLightById(Z){for(let c=0;c<this.lights.length;c++)if(this.lights[c].id===Z)return this.lights[c];return null}getLightByUniqueId(Z){for(let c=0;c<this.lights.length;c++)if(this.lights[c].uniqueId===Z)return this.lights[c];return null}getParticleSystemById(Z){for(let c=0;c<this.si.length;c++)if(this.si[c].id===Z)return this.si[c];return null}getGeometryById(Z){for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].id===Z)return this.geometries[c];return null}_getGeometryByUniqueId(Z){if(this._geometriesByUniqueId){const c=this._geometriesByUniqueId[Z];if(void 0!==c)return this.geometries[c]}else for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].uniqueId===Z)return this.geometries[c];return null}getFrameGraphByName(Z){for(let c=0;c<this.frameGraphs.length;c++)if(this.frameGraphs[c].name===Z)return this.frameGraphs[c];return null}pushGeometry(Z,c){return!(!c&&this._getGeometryByUniqueId(Z.uniqueId))&&(this.addGeometry(Z),k.c.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(Z)})),!0)}removeGeometry(Z){let c;if(this._geometriesByUniqueId){if(c=this._geometriesByUniqueId[Z.uniqueId],void 0===c)return!1}else if(c=this.geometries.indexOf(Z),c<0)return!1;if(c!==this.geometries.length-1){const Z=this.geometries[this.geometries.length-1];Z&&(this.geometries[c]=Z,this._geometriesByUniqueId&&(this._geometriesByUniqueId[Z.uniqueId]=c))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[Z.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(Z),!0}getGeometries(){return this.geometries}getMeshById(Z){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].id===Z)return this.meshes[c];return null}getMeshesById(Z){return this.meshes.filter((function(c){return c.id===Z}))}getTransformNodeById(Z){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].id===Z)return this.transformNodes[c];return null}getTransformNodeByUniqueId(Z){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].uniqueId===Z)return this.transformNodes[c];return null}getTransformNodesById(Z){return this.transformNodes.filter((function(c){return c.id===Z}))}getMeshByUniqueId(Z){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].uniqueId===Z)return this.meshes[c];return null}getLastMeshById(Z){for(let c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===Z)return this.meshes[c];return null}getLastTransformNodeById(Z){for(let c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===Z)return this.transformNodes[c];return null}getLastEntryById(Z){let c;for(c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===Z)return this.meshes[c];for(c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===Z)return this.transformNodes[c];for(c=this.cameras.length-1;c>=0;c--)if(this.cameras[c].id===Z)return this.cameras[c];for(c=this.lights.length-1;c>=0;c--)if(this.lights[c].id===Z)return this.lights[c];return null}getNodeById(Z){const c=this.getMeshById(Z);if(c)return c;const L=this.getTransformNodeById(Z);if(L)return L;const k=this.getLightById(Z);if(k)return k;const N=this.getCameraById(Z);if(N)return N;const R=this.getBoneById(Z);return R||null}getNodeByName(Z){const c=this.getMeshByName(Z);if(c)return c;const L=this.getTransformNodeByName(Z);if(L)return L;const k=this.getLightByName(Z);if(k)return k;const N=this.getCameraByName(Z);if(N)return N;const R=this.getBoneByName(Z);return R||null}getMeshByName(Z){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].name===Z)return this.meshes[c];return null}getTransformNodeByName(Z){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].name===Z)return this.transformNodes[c];return null}getLastSkeletonById(Z){for(let c=this.skeletons.length-1;c>=0;c--)if(this.skeletons[c].id===Z)return this.skeletons[c];return null}getSkeletonByUniqueId(Z){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].uniqueId===Z)return this.skeletons[c];return null}getSkeletonById(Z){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].id===Z)return this.skeletons[c];return null}getSkeletonByName(Z){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].name===Z)return this.skeletons[c];return null}getMorphTargetManagerById(Z){for(let c=0;c<this.morphTargetManagers.length;c++)if(this.morphTargetManagers[c].uniqueId===Z)return this.morphTargetManagers[c];return null}getMorphTargetById(Z){for(let c=0;c<this.morphTargetManagers.length;++c){const L=this.morphTargetManagers[c];for(let c=0;c<L.numTargets;++c){const k=L.getTarget(c);if(k.id===Z)return k}}return null}getMorphTargetByName(Z){for(let c=0;c<this.morphTargetManagers.length;++c){const L=this.morphTargetManagers[c];for(let c=0;c<L.numTargets;++c){const k=L.getTarget(c);if(k.name===Z)return k}}return null}getPostProcessByName(Z){for(let c=0;c<this.postProcesses.length;++c){const L=this.postProcesses[c];if(L.name===Z)return L}return null}isActiveMesh(Z){return-1!==this._activeMeshes.indexOf(Z)}get uid(){return this._uid||(this._uid=k.c.RandomId()),this._uid}addExternalData(Z,c){return this._externalData||(this._externalData=new V),this._externalData.add(Z,c)}getExternalData(Z){return this._externalData?this._externalData.get(Z):null}getOrAddExternalDataWithFactory(Z,c){return this._externalData||(this._externalData=new V),this._externalData.getOrAddWithFactory(Z,c)}removeExternalData(Z){return this._externalData.remove(Z)}_evaluateSubMesh(Z,c,L,k){if(k||Z.isInFrustum(this._frustumPlanes)){for(const k of this._evaluateSubMeshStage)k.action(c,Z);const L=Z.rZ();null!==L&&void 0!==L&&(L.hasRenderTargetTextures&&null!=L.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(L)&&(this._processedMaterials.push(L),this._materialsRenderTargets.concatWithNoDuplicate(L.getRenderTargetTextures())),this._renderingManager.dispatch(Z,c,L))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(Z){this._preventFreeActiveMeshesAndRenderingGroups!==Z&&(Z&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=Z)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let Z=0;Z<this.activeCameras.length;Z++){const c=this.activeCameras[Z];c&&c._activeMeshes&&c._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let Z=0;Z<this.textures.length;Z++){const c=this.textures[Z];c&&c.renderList&&c.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0,L=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=N,this._skipEvaluateActiveMeshesCompletely=Z,k)for(let Z=0;Z<this._activeMeshes.length;Z++)this._activeMeshes.data[Z]._freeze();c&&c()}else L&&L("No active camera found")})),this}unfreezeActiveMeshes(){for(let Z=0;Z<this.meshes.length;Z++){const c=this.meshes[Z];c._internalAbstractMeshDataInfo&&(c._internalAbstractMeshDataInfo._isActive=!1)}for(let Z=0;Z<this._activeMeshes.length;Z++)this._activeMeshes.data[Z]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(Z){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>Z.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var Z;if(this._activeMeshes.length>0)null===(Z=this.activeCamera)||void 0===Z||Z._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const Z=this._activeMeshes.length;for(let c=0;c<Z;c++){this._activeMeshes.data[c].Jc()}}if(this._activeParticleSystems){const Z=this._activeParticleSystems.length;for(let c=0;c<Z;c++)this._activeParticleSystems.data[c].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const k of this._beforeEvaluateActiveMeshStage)k.action();const c=this.getActiveMeshCandidates(),L=c.length;for(let k=0;k<L;k++){const Z=c.data[k];let L=Z._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(L?L[1]=-1:(L=[Z,-1],Z._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,L)),Z.isBlocked)continue;if(this._totalVertices.addCount(Z.getTotalVertices(),!1),!Z.isReady()||!Z.isEnabled()||Z.Pc.hasAZeroComponent)continue;Z.Jc(),Z.actionManager&&Z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(Z);let N=this.customLODSelector?this.customLODSelector(Z,this.activeCamera):Z.getLOD(this.activeCamera);if(L[0]=N,L[1]=this._frameId,void 0!==N&&null!==N&&(N!==Z&&0!==N.billboardMode&&N.Jc(),Z._preActivate(),Z.isVisible&&Z.visibility>0&&0!==(Z.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||Z.BV||Z.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(Z),this.activeCamera._activeMeshes.push(Z),N!==Z&&N._activate(this._renderId,!1);for(const c of this._preActiveMeshStage)c.action(Z);Z._activate(this._renderId,!1)&&(Z.isAnInstance?Z._internalAbstractMeshDataInfo._actAsRegularMesh&&(N=Z):N._internalAbstractMeshDataInfo._onlyForInstances=!1,N._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(Z,N)),Z._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let Z=0;Z<this.si.length;Z++){const c=this.si[Z];if(!c.isStarted()||!c.j)continue;const L=c.j;L.position&&!L.isEnabled()||(this._activeParticleSystems.push(c),c.animate(),this._renderingManager.dispatchParticles(c))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(Z){this._skeletonsEnabled&&Z.skeleton&&(this._activeSkeletons.pushNoDuplicate(Z.skeleton)&&(Z.skeleton.prepare(),this._activeBones.addCount(Z.skeleton.bones.length,!1)),Z.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(Z)&&this.frameGraph&&Z.applySkeleton(Z.skeleton))}_activeMesh(Z,c){this._prepareSkeleton(c);let L=Z.hasInstances||Z.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||c.BV;if(c&&c.ec&&c.ec.length>0){const k=this.getActiveSubMeshCandidates(c),N=k.length;L=L||1===N;for(let R=0;R<N;R++){const N=k.data[R];this._evaluateSubMesh(N,c,Z,L)}}}updateTransformMatrix(Z){const c=this.activeCamera;if(c)if(c._renderingMultiview){const L=c._rigCameras[0],k=c._rigCameras[1];this.setTransformMatrix(L.getViewMatrix(),L.getProjectionMatrix(Z),k.getViewMatrix(),k.getProjectionMatrix(Z))}else this.setTransformMatrix(c.getViewMatrix(),c.getProjectionMatrix(Z))}_bindFrameBuffer(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(Z&&Z._multiviewTexture?Z._multiviewTexture._bindFrameBuffer():Z&&Z.outputRenderTarget?Z.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),c&&this._clearFrameBuffer(Z)}_clearFrameBuffer(Z){if(Z&&Z._multiviewTexture);else if(Z&&Z.outputRenderTarget&&!Z._renderingMultiview){const c=Z.outputRenderTarget;c.onClearObservable.hasObservers()?c.onClearObservable.notifyObservers(this._engine):c.skipInitialClear||Z.isRightCamera||(this.wi&&this._engine.clear(c.clearColor||this._clearColor,!c._cleared,!0,!0),c._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(Z,c){var L;let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Z&&Z._skipRendering)return;const R=this._engine;if(this._activeCamera=Z,!this.activeCamera)throw new Error("Active camera not set");if(R.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&N){let c=!0;Z._renderingMultiview&&Z.outputRenderTarget&&(c=Z.outputRenderTarget.skipInitialClear,this.wi&&(this._defaultFrameBufferCleared=!1,Z.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),Z._renderingMultiview&&Z.outputRenderTarget&&(Z.outputRenderTarget.skipInitialClear=c)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let k=0;k<this._softwareSkinnedMeshes.length;k++){const Z=this._softwareSkinnedMeshes.data[k];Z.applySkeleton(Z.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),Z.customRenderTargets&&Z.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(Z.customRenderTargets),c&&c.customRenderTargets&&c.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(c.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const k of this._gatherActiveCameraRenderTargetsStage)k.action(this._renderTargets);let G=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){k.c.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let Z=0;Z<this._renderTargets.length;Z++){const c=this._renderTargets.data[Z];if(c._shouldRender()){this._renderId++;const Z=c.activeCamera&&c.activeCamera!==this.activeCamera;c.render(Z,this.dumpNextRenderTargets),G=!0}}k.c.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const Z of this._cameraDrawRenderTargetStage)G=Z.action(this.activeCamera)||G;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(L=Z.outputRenderTarget)||void 0===L?void 0:L.renderPassId)??Z.renderPassId??0,G&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||Z._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const k of this._beforeCameraDrawStage)k.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),R.snapshotRendering&&1===R.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const k of this._afterCameraDrawStage)k.action(this.activeCamera);if(this.postProcessManager&&!Z._multiviewTexture){const c=Z.outputRenderTarget?Z.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(Z.isIntermediate,c)}for(const k of this._afterCameraPostProcessStage)k.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(Z){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===Z.cameraRigMode||Z._renderingMultiview)return Z._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(Z,void 0,c),void this.onAfterRenderCameraObservable.notifyObservers(Z);if(Z._useMultiviewToSingleView)this._renderMultiviewToSingleView(Z);else{this.onBeforeCameraRenderObservable.notifyObservers(Z);for(let c=0;c<Z._rigCameras.length;c++)this._renderForCamera(Z._rigCameras[c],Z)}this._activeCamera=Z,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(Z)}_checkIntersections(){for(let Z=0;Z<this._meshesForIntersections.length;Z++){const c=this._meshesForIntersections.data[Z];if(c.actionManager)for(let Z=0;c.actionManager&&Z<c.actionManager.actions.length;Z++){const L=c.actionManager.actions[Z];if(12===L.trigger||13===L.trigger){const Z=L.getTriggerParameter(),k=Z.mesh?Z.mesh:Z,N=k.intersectsMesh(c,Z.usePreciseIntersection),R=c._intersectionsInProgress.indexOf(k);N&&-1===R?12===L.trigger?(L._executeCurrent(E.CreateNew(c,void 0,k)),c._intersectionsInProgress.push(k)):13===L.trigger&&c._intersectionsInProgress.push(k):!N&&R>-1&&(13===L.trigger&&L._executeCurrent(E.CreateNew(c,void 0,k)),c.actionManager.hasSpecificTrigger(13,(Z=>{const c=Z.mesh?Z.mesh:Z;return k===c}))&&13!==L.trigger||c._intersectionsInProgress.splice(R,1))}}}}_advancePhysicsEngineStep(Z){}_animate(Z){}animate(){if(this._engine.isDeterministicLockStep()){let Z=Math.max(ZZ.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ZZ.MaxDeltaTime))+this._timeAccumulator;const c=this._engine.getTimeStep(),L=1e3/c/1e3;let k=0;const N=this._engine.getLockstepMaxSteps();let R=Math.floor(Z/c);for(R=Math.min(R,N);Z>0&&k<R;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=c*L,this._animate(c),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(c),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,k++,Z-=c;this._timeAccumulator=Z<0?0:Z}else{const Z=this.useConstantAnimationDeltaTime?16:Math.max(ZZ.MinDeltaTime,Math.min(this._engine.getDeltaTime(),ZZ.MaxDeltaTime));this._animationRatio=.06*Z,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(Z)}}_clear(){(this.autoClearDepthAndStencil||this.wi)&&this._engine.clear(this._clearColor,this.wi||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(Z){var c;if(null===Z||void 0===Z||!Z.outputRenderTarget||null!==Z&&void 0!==Z&&Z.isRigCamera||(Z.outputRenderTarget._cleared=!1),null!==Z&&void 0!==Z&&null!==(c=Z.rigCameras)&&void 0!==c&&c.length)for(let L=0;L<Z.rigCameras.length;++L){const c=Z.rigCameras[L].outputRenderTarget;c&&(c._cleared=!1)}}resetDrawCache(Z){if(this.meshes)for(const c of this.meshes)c.resetDrawCache(Z)}_renderWithFrameGraph(){var Z;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),c)for(const N of this.cameras)if(N.update(),0!==N.cameraRigMode)for(let Z=0;Z<N._rigCameras.length;Z++)N._rigCameras[Z].update();this.onBeforeRenderObservable.notifyObservers(this);for(const N of this._beforeClearStage)N.action();const L=this.getActiveMeshCandidates(),k=L.length;for(let N=0;N<k;N++){const Z=L.data[N];Z.isBlocked||(this._totalVertices.addCount(Z.getTotalVertices(),!1),Z.isReady()&&Z.isEnabled()&&!Z.Pc.hasAZeroComponent&&(Z.Jc(),Z.actionManager&&Z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(Z)))}if(this.particlesEnabled)for(let N=0;N<this.si.length;N++){const Z=this.si[N];if(!Z.isStarted()||!Z.j)continue;const c=Z.j;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(Z),Z.animate())}null===(Z=this.frameGraph)||void 0===Z||Z.execute()}_renderRenderTarget(Z,c){let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,Z._shouldRender()){if(this._renderId++,this.activeCamera=c,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),Z.render(L,k)}this._intermediateRendering=!1}render(){var Z;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],L=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.p){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(Z=this.activeCameras)&&void 0!==Z&&Z.length)for(const Z of this.activeCameras)this._checkCameraRenderTarget(Z);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),L||this.animate();for(const Z of this._beforeCameraUpdateStage)Z.action();if(c)if(this.activeCameras&&this.activeCameras.length>0)for(let Z=0;Z<this.activeCameras.length;Z++){const c=this.activeCameras[Z];if(c.update(),0!==c.cameraRigMode)for(let Z=0;Z<c._rigCameras.length;Z++)c._rigCameras[Z].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let Z=0;Z<this.activeCamera._rigCameras.length;Z++)this.activeCamera._rigCameras[Z].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(c,L);else{var N;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const Z=null!==(N=this.activeCameras)&&void 0!==N&&N.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){k.c.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let c=0;c<this.customRenderTargets.length;c++){const L=this.customRenderTargets[c],k=L.activeCamera||this.activeCamera;this._renderRenderTarget(L,k,Z!==k,this.dumpNextRenderTargets)}k.c.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===Z||void 0===Z?void 0:Z.renderPassId)??0,this.activeCamera=Z,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const c of this._beforeClearStage)c.action();this._clearFrameBuffer(this.activeCamera);for(const c of this._gatherRenderTargetsStage)c.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let c=0;c<this.activeCameras.length;c++)this._processSubCameras(this.activeCameras[c],c>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const Z of this._afterRenderStage)Z.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let Z=0;Z<this._toBeDisposed.length;Z++){const c=this._toBeDisposed[Z];c&&c.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let Z=0;Z<this.materials.length;Z++)this.materials[Z].freeze()}unfreezeMaterials(){for(let Z=0;Z<this.materials.length;Z++)this.materials[Z].unfreeze()}dispose(){if(this.p)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const Z of this._activeAnimatables)Z.onAnimationEndObservable.clear(),Z.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const Z=this._activeRequests.slice();for(const N of Z)N.abort();this._activeRequests.length=0;try{this.Xc.notifyObservers(this)}catch(k){a.e.Error("An error occurred while calling onDisposeObservable!",k)}this.Oi();if(this._engine.getInputElement())for(let N=0;N<this.cameras.length;N++)this.cameras[N].Oi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.Uz&&this.Uz.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(Z=>Z.dispose(!0))),this._disposeList(this.transformNodes,(Z=>Z.dispose(!0)));const c=this.cameras;this._disposeList(c),this._disposeList(this.si),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let L=this._engine.scenes.indexOf(this);if(L>-1&&this._engine.scenes.splice(L,1),M.d._LastCreatedScene===this){M.d._LastCreatedScene=null;let Z=M.d.Instances.length-1;for(;Z>=0;){const c=M.d.Instances[Z];if(c.scenes.length>0){M.d._LastCreatedScene=c.scenes[this._engine.scenes.length-1];break}Z--}}L=this._engine._virtualScenes.indexOf(this),L>-1&&this._engine._virtualScenes.splice(L,1),this._engine.wipeCaches(!0),this.Xc.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(Z,c){const L=Z.slice(0);c=c??(Z=>Z.dispose());for(const k of L)c(k);Z.length=0}get p(){return this._isDisposed}clearCachedVertexData(){for(let Z=0;Z<this.meshes.length;Z++){const c=this.meshes[Z].zc;c&&c.clearCachedData()}}cleanCachedTextureBuffer(){for(const Z of this.textures){Z._buffer&&(Z._buffer=null)}}getWorldExtends(Z){const c=new J.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new J.h(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);Z=Z||(()=>!0);const k=this.meshes.filter(Z);for(const N of k){if(N.Jc(!0),!N.ec||0===N.ec.length||N.infiniteDistance)continue;const Z=N.getBoundingInfo(),k=Z.boundingBox.minimumWorld,R=Z.boundingBox.maximumWorld;J.h.CheckExtends(k,c,L),J.h.CheckExtends(R,c,L)}return{min:c,max:L}}createPickingRay(Z,c,L,k){throw(0,P.e)("Ray")}createPickingRayToRef(Z,c,L,k,N){throw(0,P.e)("Ray")}createPickingRayInCameraSpace(Z,c,L){throw(0,P.e)("Ray")}createPickingRayInCameraSpaceToRef(Z,c,L,k){throw(0,P.e)("Ray")}gL(Z,c,L,k,N,R){const G=(0,P.e)("Ray",!0);return G&&a.e.Warn(G),new t.e}pickWithBoundingInfo(Z,c,L,k,N){const R=(0,P.e)("Ray",!0);return R&&a.e.Warn(R),new t.e}pickWithRay(Z,c,L,k){throw(0,P.e)("Ray")}multiPick(Z,c,L,k,N){throw(0,P.e)("Ray")}multiPickWithRay(Z,c,L){throw(0,P.e)("Ray")}setPointerOverMesh(Z,c,L){this._inputManager.setPointerOverMesh(Z,c,L)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const Z of this._components)Z.rebuild();for(const Z of this.si)Z.rebuild();if(this.spriteManagers)for(const Z of this.spriteManagers)Z.rebuild()}_rebuildTextures(){for(const Z of this.textures)Z._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(Z,c,L){if(void 0===c)return Z;const k=[];for(const N in Z){const R=Z[N];p.b&&p.b.MatchesQuery(R,c)&&(!L||L(R))&&k.push(R)}return k}getMeshesByTags(Z,c){return this._getByTags(this.meshes,Z,c)}getCamerasByTags(Z,c){return this._getByTags(this.cameras,Z,c)}getLightsByTags(Z,c){return this._getByTags(this.lights,Z,c)}getMaterialByTags(Z,c){return this._getByTags(this.materials,Z,c).concat(this._getByTags(this.multiMaterials,Z,c))}getTransformNodesByTags(Z,c){return this._getByTags(this.transformNodes,Z,c)}setRenderingOrder(Z){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(Z,c,L,k)}setRenderingAutoClearDepthStencil(Z,c){let L=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(Z,c,L,k)}getAutoClearDepthStencilSetup(Z){return this._renderingManager.getAutoClearDepthStencilSetup(Z)}_forceBlockMaterialDirtyMechanism(Z){this._blockMaterialDirtyMechanism=Z}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(Z){this._blockMaterialDirtyMechanism!==Z&&(this._blockMaterialDirtyMechanism=Z,Z||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(Z,c){if(!this._blockMaterialDirtyMechanism)for(const L of this.materials)c&&!c(L)||L.DJ(Z)}_loadFile(Z,c,L,k,N,R,G){const V=(0,n.o)(Z,c,L,k?this.offlineProvider:void 0,N,R,G);return this._activeRequests.push(V),V.onCompleteObservable.add((Z=>{this._activeRequests.splice(this._activeRequests.indexOf(Z),1)})),V}async _loadFileAsync(Z,c,L,k,N){return await new Promise(((R,G)=>{this._loadFile(Z,(Z=>{R(Z)}),c,L,k,((Z,c)=>{G(c)}),N)}))}_requestFile(Z,c,L,k,N,R,G){const V=(0,n.w)(Z,c,L,k?this.offlineProvider:void 0,N,R,G);return this._activeRequests.push(V),V.onCompleteObservable.add((Z=>{this._activeRequests.splice(this._activeRequests.indexOf(Z),1)})),V}async _requestFileAsync(Z,c,L,k,N){return await new Promise(((R,G)=>{this._requestFile(Z,(Z=>{R(Z)}),c,L,k,(Z=>{G(Z)}),N)}))}_readFile(Z,c,L,k,N){const R=(0,n.v)(Z,c,L,k,N);return this._activeRequests.push(R),R.onCompleteObservable.add((Z=>{this._activeRequests.splice(this._activeRequests.indexOf(Z),1)})),R}async _readFileAsync(Z,c,L){return await new Promise(((k,N)=>{this._readFile(Z,(Z=>{k(Z)}),c,L,(Z=>{N(Z)}))}))}getPerfCollector(){throw(0,P.e)("performanceViewerSceneExtension")}setActiveCameraByID(Z){return this.setActiveCameraById(Z)}getMaterialByID(Z){return this.getMaterialById(Z)}getLastMaterialByID(Z){return this.getLastMaterialById(Z)}getTextureByUniqueID(Z){return this.getTextureByUniqueId(Z)}getCameraByID(Z){return this.getCameraById(Z)}getCameraByUniqueID(Z){return this.getCameraByUniqueId(Z)}getBoneByID(Z){return this.getBoneById(Z)}getLightByID(Z){return this.getLightById(Z)}getLightByUniqueID(Z){return this.getLightByUniqueId(Z)}getParticleSystemByID(Z){return this.getParticleSystemById(Z)}getGeometryByID(Z){return this.getGeometryById(Z)}getMeshByID(Z){return this.getMeshById(Z)}getMeshByUniqueID(Z){return this.getMeshByUniqueId(Z)}getLastMeshByID(Z){return this.getLastMeshById(Z)}getMeshesByID(Z){return this.getMeshesById(Z)}getTransformNodeByID(Z){return this.getTransformNodeById(Z)}getTransformNodeByUniqueID(Z){return this.getTransformNodeByUniqueId(Z)}getTransformNodesByID(Z){return this.getTransformNodesById(Z)}getNodeByID(Z){return this.getNodeById(Z)}getLastEntryByID(Z){return this.getLastEntryById(Z)}getLastSkeletonByID(Z){return this.getLastSkeletonById(Z)}}ZZ.FOGMODE_NONE=0,ZZ.FOGMODE_EXP=1,ZZ.FOGMODE_EXP2=2,ZZ.FOGMODE_LINEAR=3,ZZ.MinDeltaTime=1,ZZ.MaxDeltaTime=1e3,ZZ._OriginalDefaultMaterialFactory=ZZ.DefaultMaterialFactory,(0,C.g)("BABYLON.Scene",ZZ)},11386:(Z,c,L)=>{L.d(c,{c:()=>k,f:()=>N});class k{}k.NAME_EFFECTLAYER="EffectLayer",k.NAME_LAYER="Layer",k.NAME_LENSFLARESYSTEM="LensFlareSystem",k.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",k.NAME_PARTICLESYSTEM="bc",k.NAME_GAMEPAD="Gamepad",k.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",k.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",k.NAME_PREPASSRENDERER="PrePassRenderer",k.NAME_DEPTHRENDERER="DepthRenderer",k.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",k.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",k.NAME_SPRITE="Sprite",k.NAME_SUBSURFACE="SubSurface",k.NAME_OUTLINERENDERER="Outline",k.NAME_PROCEDURALTEXTURE="ProceduralTexture",k.NAME_SHADOWGENERATOR="ShadowGenerator",k.NAME_OCTREE="Fc",k.NAME_PHYSICSENGINE="PhysicsEngine",k.NAME_AUDIO="Audio",k.NAME_FLUIDRENDERER="FluidRenderer",k.NAME_IBLCDFGENERATOR="iblCDFGenerator",k.STEP_ISREADYFORMESH_EFFECTLAYER=0,k.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,k.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,k.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,k.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,k.STEP_BEFORECAMERADRAW_PREPASS=0,k.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,k.STEP_BEFORECAMERADRAW_LAYER=2,k.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,k.STEP_BEFORERENDERTARGETDRAW_LAYER=1,k.STEP_BEFORERENDERINGMESH_PREPASS=0,k.STEP_BEFORERENDERINGMESH_OUTLINE=1,k.STEP_AFTERRENDERINGMESH_PREPASS=0,k.STEP_AFTERRENDERINGMESH_OUTLINE=1,k.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,k.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,k.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,k.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,k.STEP_BEFORECLEAR_PREPASS=1,k.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,k.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,k.STEP_AFTERRENDERTARGETDRAW_LAYER=1,k.STEP_AFTERCAMERADRAW_PREPASS=0,k.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,k.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,k.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,k.STEP_AFTERCAMERADRAW_LAYER=4,k.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,k.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,k.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,k.STEP_AFTERRENDER_AUDIO=0,k.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,k.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,k.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,k.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,k.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,k.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,k.STEP_POINTERMOVE_SPRITE=0,k.STEP_POINTERDOWN_SPRITE=0,k.STEP_POINTERUP_SPRITE=0;class N extends Array{constructor(Z){super(...Z)}static Create(){return Object.create(N.prototype)}registerStep(Z,c,L){let k=0,N=Number.MAX_VALUE;for(;k<this.length;k++){if(N=this[k].index,Z<N)break}this.splice(k,0,{index:Z,component:c,action:L.bind(c)})}clear(){this.length=0}}},11170:(Z,c,L)=>{L.d(c,{d:()=>k});function k(Z,c,L,k){var N,R=arguments.length,G=R<3?c:null===k?k=Object.getOwnPropertyDescriptor(c,L):k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)G=Reflect.decorate(Z,c,L,k);else for(var V=Z.length-1;V>=0;V--)(N=Z[V])&&(G=(R<3?N(G):R>3?N(c,L,G):N(c,L))||G);return R>3&&G&&Object.defineProperty(c,L,G),G}Object.create;Object.create}}]);