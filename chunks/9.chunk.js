"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[9],{12634:(q,I,l)=>{l.d(I,{b:()=>e,c:()=>R,i:()=>W,e:()=>D,j:()=>M});class w{constructor(){this.children=[]}isValid(q){return!0}process(q,I,l){let w="";if(this.line){let l=this.line;const Z=I.processor;if(Z){var t,O,c,a,F,s;Z.lineProcessor&&(l=Z.lineProcessor(l,I.isFragment,I.processingContext));const w=(null===(t=I.processor)||void 0===t?void 0:t.attributeKeywordName)??"attribute",r=I.isFragment&&null!==(O=I.processor)&&void 0!==O&&O.varyingFragmentKeywordName?null===(c=I.processor)||void 0===c?void 0:c.varyingFragmentKeywordName:!I.isFragment&&null!==(a=I.processor)&&void 0!==a&&a.varyingVertexKeywordName?null===(F=I.processor)||void 0===F?void 0:F.varyingVertexKeywordName:"varying";if(!I.isFragment&&Z.attributeProcessor&&this.line.startsWith(w))l=Z.attributeProcessor(this.line,q,I.processingContext);else if(Z.varyingProcessor&&(null!==(s=Z.varyingCheck)&&void 0!==s&&s.call(Z,this.line,I.isFragment)||!Z.varyingCheck&&this.line.startsWith(r)))l=Z.varyingProcessor(this.line,I.isFragment,q,I.processingContext);else if(Z.uniformProcessor&&Z.uniformRegexp&&Z.uniformRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(l=Z.uniformProcessor(this.line,I.isFragment,q,I.processingContext));else if(Z.uniformBufferProcessor&&Z.uniformBufferRegexp&&Z.uniformBufferRegexp.test(this.line))I.lookForClosingBracketForUniformBuffer||(l=Z.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0);else if(Z.textureProcessor&&Z.textureRegexp&&Z.textureRegexp.test(this.line))l=Z.textureProcessor(this.line,I.isFragment,q,I.processingContext);else if((Z.uniformProcessor||Z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!I.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?Z.uniformProcessor&&(l=Z.uniformProcessor(this.line,I.isFragment,q,I.processingContext)):Z.uniformBufferProcessor&&(l=Z.uniformBufferProcessor(this.line,I.isFragment,I.processingContext),I.lookForClosingBracketForUniformBuffer=!0)}I.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(I.lookForClosingBracketForUniformBuffer=!1,Z.endOfUniformBufferProcessor&&(l=Z.endOfUniformBufferProcessor(this.line,I.isFragment,I.processingContext)))}w+=l+"\n"}for(const Z of this.children)w+=Z.process(q,I,l);return this.additionalDefineKey&&(q[this.additionalDefineKey]=this.additionalDefineValue||"true",l[this.additionalDefineKey]=q[this.additionalDefineKey]),w}}class t{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(q){this._lines.length=0;for(const I of q){if(!I||"\r"===I)continue;if("#"===I[0]){this._lines.push(I);continue}const q=I.trim();if(!q)continue;if(q.startsWith("//")){this._lines.push(I);continue}const l=q.indexOf(";");if(-1===l)this._lines.push(q);else if(l===q.length-1)q.length>1&&this._lines.push(q);else{const q=I.split(";");for(let I=0;I<q.length;I++){let l=q[I];l&&(l=l.trim(),l&&this._lines.push(l+(I!==q.length-1?";":"")))}}}}}class O extends w{process(q,I,l){for(let w=0;w<this.children.length;w++){const t=this.children[w];if(t.isValid(q))return t.process(q,I,l)}return""}}class c extends w{isValid(q){return this.testExpression.isTrue(q)}}class a{isTrue(q){return!0}static postfixToInfix(q){const I=[];for(const l of q)if(void 0===a._OperatorPriority[l])I.push(l);else{const q=I[I.length-1],w=I[I.length-2];I.length-=2,I.push(`(${w}${l}${q})`)}return I[I.length-1]}static infixToPostfix(q){const I=a._InfixToPostfixCache.get(q);if(I)return I.accessTime=Date.now(),I.result;if(!q.includes("&&")&&!q.includes("||")&&!q.includes(")")&&!q.includes("("))return[q];const l=[];let w=-1;const t=()=>{Z=Z.trim(),""!==Z&&(l.push(Z),Z="")},O=q=>{w<a._Stack.length-1&&(a._Stack[++w]=q)},c=()=>a._Stack[w],F=()=>-1===w?"!!INVALID EXPRESSION!!":a._Stack[w--];let s=0,Z="";for(;s<q.length;){const I=q.charAt(s),r=s<q.length-1?q.substring(s,2+s):"";if("("===I)Z="",O(I);else if(")"===I){for(t();-1!==w&&"("!==c();)l.push(F());F()}else if(a._OperatorPriority[r]>1){for(t();-1!==w&&a._OperatorPriority[c()]>=a._OperatorPriority[r];)l.push(F());O(r),s++}else Z+=I;s++}for(t();-1!==w;)"("===c()?F():l.push(F());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(q,{result:l,accessTime:Date.now()}),l}static ClearCache(){const q=Array.from(a._InfixToPostfixCache.entries()).sort(((q,I)=>q[1].accessTime-I[1].accessTime));for(let I=0;I<a.InfixToPostfixCacheCleanupSize;I++)a._InfixToPostfixCache.delete(q[I][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class F extends a{constructor(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=q,this.not=I}isTrue(q){let I=void 0!==q[this.define];return this.not&&(I=!I),I}}class s extends a{isTrue(q){return this.leftOperand.isTrue(q)||this.rightOperand.isTrue(q)}}class Z extends a{isTrue(q){return this.leftOperand.isTrue(q)&&this.rightOperand.isTrue(q)}}class r extends a{constructor(q,I,l){super(),this.define=q,this.operand=I,this.testValue=l}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(q){let I=!1;const l=parseInt(void 0!=q[this.define]?q[this.define]:this.define),w=parseInt(void 0!=q[this.testValue]?q[this.testValue]:this.testValue);if(isNaN(l)||isNaN(w))return!1;switch(this.operand){case">":I=l>w;break;case"<":I=l<w;break;case"<=":I=l<=w;break;case">=":I=l>=w;break;case"==":I=l===w;break;case"!=":I=l!==w}return I}}var x=l(12603),o=l(12641);const d=/defined\s*?\((.+?)\)/g,T=/defined\s*?\[(.+?)\]/g,V=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,U=/__decl__/,B=/light\{X\}.(\w*)/g,v=/\{X\}/g,k=[],C=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function R(q){q.processor&&q.processor.initializeShaders&&q.processor.initializeShaders(q.processingContext)}function W(q,I,l,w){var t;null!==(t=I.processor)&&void 0!==t&&t.preProcessShaderCode&&(q=I.processor.preProcessShaderCode(q,I.isFragment)),D(q,I,(q=>{I.processCodeAfterIncludes&&(q=I.processCodeAfterIncludes(I.isFragment?"fragment":"vertex",q,I.defines));const t=function(q,I,l){let w=function(q,I){var l;if(null!==(l=I.processor)&&void 0!==l&&l.noPrecision)return q;const w=I.shouldUseHighPrecisionShader;-1===q.indexOf("precision highp float")?q=w?"precision highp float;\n"+q:"precision mediump float;\n"+q:w||(q=q.replace("precision highp float","precision mediump float"));return q}(q,I);if(!I.processor)return w;if(0===I.processor.shaderLanguage&&-1!==w.indexOf("#version 3")&&(w=w.replace("#version 300 es",""),!I.processor.parseGLES3))return w;const t=I.defines,O=K(I,l);I.processor.preProcessor&&(w=I.processor.preProcessor(w,t,O,I.isFragment,I.processingContext));const c={};w=X(w,O,I,c),I.processor.postProcessor&&(w=I.processor.postProcessor(w,t,I.isFragment,I.processingContext,l?{drawBuffersExtensionDisabled:!l.getCaps().drawBuffersExtension}:{},O,c));null!==l&&void 0!==l&&l._features.needShaderCodeInlining&&(w=l.inlineShaderCode(w));return w}(q,I,w);l(t,q)}))}function e(q,I,l){return l.processor&&l.processor.finalizeShaders?l.processor.finalizeShaders(q,I,l.processingContext):{vertexCode:q,fragmentCode:I}}function i(q){const I=/defined\((.+)\)/.exec(q);if(I&&I.length)return new F(I[1].trim(),"!"===q[0]);const l=["==","!=",">=","<=","<",">"];let w="",t=0;for(w of l)if(t=q.indexOf(w),t>-1)break;if(-1===t)return new F(q);const O=q.substring(0,t).trim(),c=q.substring(t+w.length).trim();return new r(O,w,c)}function S(q,I){const l=new c,w=q.substring(0,I);let t=q.substring(I);return t=t.substring(0,(t.indexOf("//")+1||t.length+1)-1).trim(),l.testExpression="#ifdef"===w?new F(t):"#ifndef"===w?new F(t,!0):function(q){q=q.replace(d,"defined[$1]");const I=a.infixToPostfix(q),l=[];for(const t of I)if("||"!==t&&"&&"!==t)l.push(t);else if(l.length>=2){let q=l[l.length-1],I=l[l.length-2];l.length-=2;const w="&&"==t?new Z:new s;"string"===typeof q&&(q=q.replace(T,"defined($1)")),"string"===typeof I&&(I=I.replace(T,"defined($1)")),w.leftOperand="string"===typeof I?i(I):I,w.rightOperand="string"===typeof q?i(q):q,l.push(w)}let w=l[l.length-1];return"string"===typeof w&&(w=w.replace(T,"defined($1)")),"string"===typeof w?i(w):w}(t),l}function g(q,I,l,t){let O=q.currentLine;for(;p(q,l,t);){O=q.currentLine;const c=O.substring(0,5).toLowerCase();if("#else"===c){const l=new w;return I.children.push(l),void p(q,l,t)}if("#elif"===c){const q=S(O,5);I.children.push(q),l=q}}}function p(q,I,l){for(;q.canRead;){q.lineIndex++;const t=q.currentLine;if(t.indexOf("#")>=0){const w=C.exec(t);if(w&&w.length){switch(w[0]){case"#ifdef":{const w=new O;I.children.push(w);const c=S(t,6);w.children.push(c),g(q,w,c,l);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const w=new O;I.children.push(w);const c=S(t,7);w.children.push(c),g(q,w,c,l);break}case"#if":{const w=new O,c=S(t,3);I.children.push(w),w.children.push(c),g(q,w,c,l);break}}continue}}const c=new w;if(c.line=t,I.children.push(c),"#"===t[0]&&"d"===t[1]){const q=t.replace(";","").split(" ");c.additionalDefineKey=q[1],3===q.length&&(c.additionalDefineValue=q[2])}}return!1}function X(q,I,l,O){const c=new w,a=new t;return a.lineIndex=-1,a.lines=q.split("\n"),p(a,c,O),c.process(I,l,O)}function K(q,I){var l;const w=q.defines,t={};for(const O of w){const q=O.replace("#define","").replace(";","").trim().split(" ");t[q[0]]=q.length>1?q[1]:""}return 0===(null===(l=q.processor)||void 0===l?void 0:l.shaderLanguage)&&(t.GL_ES="true"),t.__VERSION__=q.version,t[q.platformName]="true",(0,o.h)(t,null===I||void 0===I?void 0:I.isNDCHalfZRange,null===I||void 0===I?void 0:I.Ic,null===I||void 0===I?void 0:I.useExactSrgbConversions),t}function D(q,I,l){let w;for(k.length=0;null!==(w=V.exec(q));)k.push(w);let t=String(q),O=[q],c=!1;for(const a of k){let q=a[1];if(-1!==q.indexOf("__decl__")&&(q=q.replace(U,""),I.supportsUniformBuffers&&(q=q.replace("Vertex","Ubo").replace("Fragment","Ubo")),q+="Declaration"),!I.includesShadersStore[q]){const w=I.shadersRepository+"ShadersInclude/"+q+".fx";return void M.loadFile(w,(w=>{I.includesShadersStore[q]=w,D(O.join(""),I,l)}))}{let l=I.includesShadersStore[q];if(a[2]){const q=a[3].split(",");for(let I=0;I<q.length;I+=2){const w=new RegExp(q[I],"g"),t=q[I+1];l=l.replace(w,t)}}if(a[4]){const q=a[5];if(-1!==q.indexOf("..")){const w=q.split(".."),t=parseInt(w[0]);let O=parseInt(w[1]),c=l.slice(0);l="",isNaN(O)&&(O=I.indexParameters[w[1]]);for(let q=t;q<O;q++)I.supportsUniformBuffers||(c=c.replace(B,((q,I)=>I+"{X}"))),l+=c.replace(v,q.toString())+"\n"}else I.supportsUniformBuffers||(l=l.replace(B,((q,I)=>I+"{X}"))),l=l.replace(v,q)}const w=[];for(const q of O){const I=q.split(a[0]);for(let q=0;q<I.length-1;q++)w.push(I[q]),w.push(l);w.push(I[I.length-1])}O=w,c=c||l.indexOf("#include<")>=0||l.indexOf("#include <")>=0}}k.length=0,t=O.join(""),c?D(t.toString(),I,l):l(t)}const M={loadFile:(q,I,l,w,t,O)=>{throw(0,x.b)("FileTools")}}},12641:(q,I,l)=>{l.d(I,{c:()=>t,e:()=>O,h:()=>a,k:()=>c,n:()=>F});var w=l(12603);l(12582);const t={};function O(q,I){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(I?I+"\n":"")+q}function c(q,I,l,O,c,a,F){const s=F||t.loadFile;if(s){return s(q,I,l,O,c,a)}throw(0,w.b)("FileTools")}function a(q,I,l,w){if(q)return I?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,l?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(w?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return I&&(q+="#define IS_NDC_HALF_ZRANGE"),l&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),w&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}function F(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;switch(q){case 3:{const q=(ArrayBuffer,new Int8Array(I));return w&&q.set(new Int8Array(w)),q}case 0:{const q=(ArrayBuffer,new Uint8Array(I));return w&&q.set(new Uint8Array(w)),q}case 4:{const q=I instanceof ArrayBuffer?new Int16Array(I):new Int16Array(l?I/2:I);return w&&q.set(new Int16Array(w)),q}case 5:case 8:case 9:case 10:case 2:{const q=I instanceof ArrayBuffer?new Uint16Array(I):new Uint16Array(l?I/2:I);return w&&q.set(new Uint16Array(w)),q}case 6:{const q=I instanceof ArrayBuffer?new Int32Array(I):new Int32Array(l?I/4:I);return w&&q.set(new Int32Array(w)),q}case 7:case 11:case 12:case 13:case 14:case 15:{const q=I instanceof ArrayBuffer?new Uint32Array(I):new Uint32Array(l?I/4:I);return w&&q.set(new Uint32Array(w)),q}case 1:{const q=I instanceof ArrayBuffer?new Float32Array(I):new Float32Array(l?I/4:I);return w&&q.set(new Float32Array(w)),q}}const t=(ArrayBuffer,new Uint8Array(I));return w&&t.set(new Uint8Array(w)),t}},12664:(q,I,l)=>{l.d(I,{e:()=>w});class w{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.ShadersRepository:w.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.ShadersStore:w.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.IncludesShadersStore:w.IncludesShadersStoreWGSL}}w.ShadersRepository="src/Shaders/",w.ShadersStore={},w.IncludesShadersStore={},w.ShadersRepositoryWGSL="src/ShadersWGSL/",w.ShadersStoreWGSL={},w.IncludesShadersStoreWGSL={}},12676:(q,I,l)=>{l.d(I,{b:()=>x,d:()=>v,g:()=>d,j:()=>o,n:()=>T,o:()=>B,r:()=>r,s:()=>s,v:()=>Z,y:()=>F,z:()=>a});class w{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.oI._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(q){q&&this.program&&q(this.program)}setEngine(q){this.oI=q}_fillEffectInformation(q,I,l,w,t,O,c,a){const F=this.oI;if(F.supportsUniformBuffers)for(const Z in I)q.bindUniformBlock(Z,I[Z]);let s;for(this.oI.getUniforms(this,l).forEach(((q,I)=>{w[l[I]]=q})),this._uniforms=w,s=0;s<t.length;s++){null==q.getUniform(t[s])&&(t.splice(s,1),s--)}t.forEach(((q,I)=>{O[q]=I}));for(const Z of F.getAttributes(this,c))a.push(Z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(q,I){const l=this._valueCache[q],w=I.updateFlag;return(void 0===l||l!==w)&&(this._valueCache[q]=w,!0)}_cacheFloat2(q,I,l){let w=this._valueCache[q];if(!w||2!==w.length)return w=[I,l],this._valueCache[q]=w,!0;let t=!1;return w[0]!==I&&(w[0]=I,t=!0),w[1]!==l&&(w[1]=l,t=!0),t}_cacheFloat3(q,I,l,w){let t=this._valueCache[q];if(!t||3!==t.length)return t=[I,l,w],this._valueCache[q]=t,!0;let O=!1;return t[0]!==I&&(t[0]=I,O=!0),t[1]!==l&&(t[1]=l,O=!0),t[2]!==w&&(t[2]=w,O=!0),O}_cacheFloat4(q,I,l,w,t){let O=this._valueCache[q];if(!O||4!==O.length)return O=[I,l,w,t],this._valueCache[q]=O,!0;let c=!1;return O[0]!==I&&(O[0]=I,c=!0),O[1]!==l&&(O[1]=l,c=!0),O[2]!==w&&(O[2]=w,c=!0),O[3]!==t&&(O[3]=t,c=!0),c}setInt(q,I){const l=this._valueCache[q];void 0!==l&&l===I||this.oI.setInt(this._uniforms[q],I)&&(this._valueCache[q]=I)}setInt2(q,I,l){this._cacheFloat2(q,I,l)&&(this.oI.setInt2(this._uniforms[q],I,l)||(this._valueCache[q]=null))}setInt3(q,I,l,w){this._cacheFloat3(q,I,l,w)&&(this.oI.setInt3(this._uniforms[q],I,l,w)||(this._valueCache[q]=null))}setInt4(q,I,l,w,t){this._cacheFloat4(q,I,l,w,t)&&(this.oI.setInt4(this._uniforms[q],I,l,w,t)||(this._valueCache[q]=null))}setIntArray(q,I){this._valueCache[q]=null,this.oI.setIntArray(this._uniforms[q],I)}setIntArray2(q,I){this._valueCache[q]=null,this.oI.setIntArray2(this._uniforms[q],I)}setIntArray3(q,I){this._valueCache[q]=null,this.oI.setIntArray3(this._uniforms[q],I)}setIntArray4(q,I){this._valueCache[q]=null,this.oI.setIntArray4(this._uniforms[q],I)}setUInt(q,I){const l=this._valueCache[q];void 0!==l&&l===I||this.oI.setUInt(this._uniforms[q],I)&&(this._valueCache[q]=I)}setUInt2(q,I,l){this._cacheFloat2(q,I,l)&&(this.oI.setUInt2(this._uniforms[q],I,l)||(this._valueCache[q]=null))}setUInt3(q,I,l,w){this._cacheFloat3(q,I,l,w)&&(this.oI.setUInt3(this._uniforms[q],I,l,w)||(this._valueCache[q]=null))}setUInt4(q,I,l,w,t){this._cacheFloat4(q,I,l,w,t)&&(this.oI.setUInt4(this._uniforms[q],I,l,w,t)||(this._valueCache[q]=null))}setUIntArray(q,I){this._valueCache[q]=null,this.oI.setUIntArray(this._uniforms[q],I)}setUIntArray2(q,I){this._valueCache[q]=null,this.oI.setUIntArray2(this._uniforms[q],I)}setUIntArray3(q,I){this._valueCache[q]=null,this.oI.setUIntArray3(this._uniforms[q],I)}setUIntArray4(q,I){this._valueCache[q]=null,this.oI.setUIntArray4(this._uniforms[q],I)}setArray(q,I){this._valueCache[q]=null,this.oI.setArray(this._uniforms[q],I)}setArray2(q,I){this._valueCache[q]=null,this.oI.setArray2(this._uniforms[q],I)}setArray3(q,I){this._valueCache[q]=null,this.oI.setArray3(this._uniforms[q],I)}setArray4(q,I){this._valueCache[q]=null,this.oI.setArray4(this._uniforms[q],I)}setMatrices(q,I){I&&(this._valueCache[q]=null,this.oI.setMatrices(this._uniforms[q],I))}setMatrix(q,I){this._cacheMatrix(q,I)&&(this.oI.setMatrices(this._uniforms[q],I.Uc())||(this._valueCache[q]=null))}setMatrix3x3(q,I){this._valueCache[q]=null,this.oI.setMatrix3x3(this._uniforms[q],I)}setMatrix2x2(q,I){this._valueCache[q]=null,this.oI.setMatrix2x2(this._uniforms[q],I)}setFloat(q,I){const l=this._valueCache[q];void 0!==l&&l===I||this.oI.setFloat(this._uniforms[q],I)&&(this._valueCache[q]=I)}setVector2(q,I){this._cacheFloat2(q,I.x,I.y)&&(this.oI.setFloat2(this._uniforms[q],I.x,I.y)||(this._valueCache[q]=null))}setFloat2(q,I,l){this._cacheFloat2(q,I,l)&&(this.oI.setFloat2(this._uniforms[q],I,l)||(this._valueCache[q]=null))}setVector3(q,I){this._cacheFloat3(q,I.x,I.y,I.z)&&(this.oI.setFloat3(this._uniforms[q],I.x,I.y,I.z)||(this._valueCache[q]=null))}setFloat3(q,I,l,w){this._cacheFloat3(q,I,l,w)&&(this.oI.setFloat3(this._uniforms[q],I,l,w)||(this._valueCache[q]=null))}setVector4(q,I){this._cacheFloat4(q,I.x,I.y,I.z,I.w)&&(this.oI.setFloat4(this._uniforms[q],I.x,I.y,I.z,I.w)||(this._valueCache[q]=null))}setQuaternion(q,I){this._cacheFloat4(q,I.x,I.y,I.z,I.w)&&(this.oI.setFloat4(this._uniforms[q],I.x,I.y,I.z,I.w)||(this._valueCache[q]=null))}setFloat4(q,I,l,w,t){this._cacheFloat4(q,I,l,w,t)&&(this.oI.setFloat4(this._uniforms[q],I,l,w,t)||(this._valueCache[q]=null))}setColor3(q,I){this._cacheFloat3(q,I.r,I.g,I.b)&&(this.oI.setFloat3(this._uniforms[q],I.r,I.g,I.b)||(this._valueCache[q]=null))}setColor4(q,I,l){this._cacheFloat4(q,I.r,I.g,I.b,l)&&(this.oI.setFloat4(this._uniforms[q],I.r,I.g,I.b,l)||(this._valueCache[q]=null))}setDirectColor4(q,I){this._cacheFloat4(q,I.r,I.g,I.b,I.a)&&(this.oI.setFloat4(this._uniforms[q],I.r,I.g,I.b,I.a)||(this._valueCache[q]=null))}_getVertexShaderCode(){return this.vertexShader?this.oI._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.oI._getShaderSource(this.fragmentShader):null}}var t=l(12641);const O=new WeakMap,c={_webGLVersion:2,cachedPipelines:{}};function a(q){let I=O.get(q);if(!I){if(!q)return c;I={_webGLVersion:q.TEXTURE_BINDING_3D?2:1,_context:q,parallelShaderCompile:q.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},O.set(q,I)}return I}function F(q){O.delete(q)}function s(q,I,l,w,t,O){const c=a(w);O||(O=c._createShaderProgramInjection??x);return O(q,U(I,"vertex",w,c._contextWasLost),U(l,"fragment",w,c._contextWasLost),w,t,c.validateShaderPrograms)}function Z(q,I,l,w,t){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6?arguments[6]:void 0;const F=a(t);c||(c=F._createShaderProgramInjection??x);const s=F._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return c(q,V(I,"vertex",w,s,t,F._contextWasLost),V(l,"fragment",w,s,t,F._contextWasLost),t,O,F.validateShaderPrograms)}function r(q,I){const l=new w,t=a(q);return t.parallelShaderCompile&&!t.disableParallelShaderCompile&&(l.isParallelCompiled=!0),l.context=t._context,l}function x(q,I,l,w){let t=arguments.length>5?arguments[5]:void 0;const O=w.createProgram();if(q.program=O,!O)throw new Error("Unable to create program");return w.attachShader(O,I),w.attachShader(O,l),w.linkProgram(O),q.context=w,q.vertexShader=I,q.fragmentShader=l,q.isParallelCompiled||d(q,w,t),O}function o(q,I,l){const w=q;if(w._isDisposed)return!1;const t=a(I);return!!(t&&t.parallelShaderCompile&&t.parallelShaderCompile.COMPLETION_STATUS_KHR&&w.program&&I.getProgramParameter(w.program,t.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(d(w,I,l),!0)}function d(q,I,l){const w=q.context,t=q.vertexShader,O=q.fragmentShader,c=q.program;if(!w.getProgramParameter(c,w.LINK_STATUS)){if(!I.getShaderParameter(t,I.COMPILE_STATUS)){const l=I.getShaderInfoLog(t);if(l)throw q.vertexCompilationError=l,new Error("VERTEX SHADER "+l)}if(!I.getShaderParameter(O,I.COMPILE_STATUS)){const l=I.getShaderInfoLog(O);if(l)throw q.fragmentCompilationError=l,new Error("FRAGMENT SHADER "+l)}const l=w.getProgramInfoLog(c);if(l)throw q.programLinkError=l,new Error(l)}if(l){w.validateProgram(c);if(!w.getProgramParameter(c,w.VALIDATE_STATUS)){const I=w.getProgramInfoLog(c);if(I)throw q.programValidationError=I,new Error(I)}}w.deleteShader(t),w.deleteShader(O),q.vertexShader=void 0,q.fragmentShader=void 0,q.onCompiled&&(q.onCompiled(),q.onCompiled=void 0)}function T(q,I,l,w,t,O,c,F,r){let x=arguments.length>10?arguments[10]:void 0,o=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0;const T=a(q.context);o||(o=T.createRawShaderProgramInjection??s),d||(d=T.createShaderProgramInjection??Z);const V=q;V.program=w?o(V,I,l,V.context,r):d(V,I,l,F,V.context,r),V.program.__SPECTOR_rebuildProgram=c,x()}function V(q,I,l,w,O,c){return U((0,t.e)(q,l,w),I,O,c)}function U(q,I,l,w){const t=l.createShader("vertex"===I?l.VERTEX_SHADER:l.FRAGMENT_SHADER);if(!t){let q=l.NO_ERROR,t=l.NO_ERROR;for(;(t=l.getError())!==l.NO_ERROR;)q=t;throw new Error(`Something went wrong while creating a gl ${I} shader object. gl error=${q}, gl isContextLost=${l.isContextLost()}, _contextWasLost=${w}`)}return l.shaderSource(t,q),l.compileShader(t),t}function B(q,I){I.useProgram(q)}function v(q,I){const l=q;if(!l.isParallelCompiled)return void I(q);const w=l.onCompiled;l.onCompiled=()=>{null===w||void 0===w||w(),I(q)}}},12672:(q,I,l)=>{l.d(I,{d:()=>r,f:()=>o,j:()=>s,k:()=>Z});var w=l(12582),t=l(12676),O=l(12664),c=l(12591),a=l(12634),F=l(12641);function s(q,I){return(0,t.z)(I).cachedPipelines[q]}function Z(q){const I=q._name,l=q.context;if(I&&l){const q=(0,t.z)(l),w=q.cachedPipelines[I];null===w||void 0===w||w.dispose(),delete q.cachedPipelines[I]}}function r(q,I,l,t,O,c,F){let s,Z;const r=(0,w.f)()?null===c||void 0===c?void 0:c.getHostDocument():null;s="string"===typeof I?I:I.vertexSource?"source:"+I.vertexSource:I.vertexElement?(null===r||void 0===r?void 0:r.getElementById(I.vertexElement))||I.vertexElement:I.vertex||I,Z="string"===typeof I?I:I.fragmentSource?"source:"+I.fragmentSource:I.fragmentElement?(null===r||void 0===r?void 0:r.getElementById(I.fragmentElement))||I.fragmentElement:I.fragment||I;const o=[void 0,void 0],d=()=>{if(o[0]&&o[1]){q.isFragment=!0;const[w,s]=o;(0,a.i)(s,q,((c,s)=>{F&&(F._fragmentSourceCodeBeforeMigration=s),l&&(c=l("fragment",c));const Z=(0,a.b)(w,c,q);q=null;const r=function(q,I,l,w){if(l){return{vertexSourceCode:(1===w?"//":"")+"#define SHADER_NAME vertex:"+(l.vertexElement||l.vertex||l.spectorName||l)+"\n"+q,fragmentSourceCode:(1===w?"//":"")+"#define SHADER_NAME fragment:"+(l.fragmentElement||l.fragment||l.spectorName||l)+"\n"+I}}return{vertexSourceCode:q,fragmentSourceCode:I}}(Z.vertexCode,Z.fragmentCode,I,O);null===t||void 0===t||t(r.vertexSourceCode,r.fragmentSourceCode)}),c)}};x(s,"Vertex","",(I=>{(0,a.c)(q),(0,a.i)(I,q,((q,w)=>{F&&(F._rawVertexSourceCode=I,F._vertexSourceCodeBeforeMigration=w),l&&(q=l("vertex",q)),o[0]=q,d()}),c)}),O),x(Z,"Fragment","Pixel",(q=>{F&&(F._rawFragmentSourceCode=q),o[1]=q,d()}),O)}function x(q,I,l,t,c,a){if("undefined"!==typeof HTMLElement&&q instanceof HTMLElement){return void t((0,w.c)(q))}if("source:"===q.substring(0,7))return void t(q.substring(7));if("base64:"===q.substring(0,7)){return void t(window.atob(q.substring(7)))}const s=O.e.GetShadersStore(c);if(s[q+I+"Shader"])return void t(s[q+I+"Shader"]);if(l&&s[q+l+"Shader"])return void t(s[q+l+"Shader"]);let Z;if(Z="."===q[0]||"/"===q[0]||q.indexOf("http")>-1?q:O.e.GetShadersRepository(c)+q,!(a=a||F.k))throw new Error("loadFileInjection is not defined");a(Z+"."+I.toLowerCase()+".fx",t)}const o=(q,I,l,w)=>{try{const O=q.context?(0,t.z)(q.context):null;O&&(O.disableParallelShaderCompile=q.disableParallelCompilation);const c=q.existingPipelineContext||I(q.shaderProcessingContext);return c._name=q.name,q.name&&O&&(O.cachedPipelines[q.name]=c),l(c,q.vertex,q.fragment,!!q.createAsRaw,"","",q.rebuildRebind,q.defines,q.transformFeedbackVaryings,"",(()=>{w(c,(()=>{var I;null===(I=q.onRenderingStateCompiled)||void 0===I||I.call(q,c)}))})),c}catch(O){throw c.b.Error("Error compiling effect"),O}}},12660:(q,I,l)=>{l.r(I),l.d(I,{Effect:()=>F});var w=l(12573),t=l(12591),O=l(12664),c=l(12672),a=l(12647);class F{static get ShadersRepository(){return O.e.ShadersRepository}static set ShadersRepository(q){O.e.ShadersRepository=q}get Z(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new w.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9?arguments[9]:void 0,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,T=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new w.d,this.onErrorObservable=new w.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=q,this._key=o;const V=this._key.replace(/\r/g,"").replace(/\n/g,"|");let U;if(I.attributes){const q=I;if(this._engine=l,this._attributesNames=q.attributes,this._uniformsNames=q.uniformsNames.concat(q.samplers),this._samplerList=q.samplers.slice(),this.defines=q.defines,this.onError=q.onError,this.onCompiled=q.onCompiled,this._fallbacks=q.fallbacks,this._indexParameters=q.indexParameters,this._transformFeedbackVaryings=q.transformFeedbackVaryings||null,this._multiTarget=!!q.multiTarget,this._shaderLanguage=q.shaderLanguage??0,this._disableParallelShaderCompilation=!!q.disableParallelShaderCompilation,q.uniformBuffersNames){this._uniformBuffersNamesList=q.uniformBuffersNames.slice();for(let I=0;I<q.uniformBuffersNames.length;I++)this._uniformBuffersNames[q.uniformBuffersNames[I]]=I}this._processFinalCode=q.processFinalCode??null,this._processCodeAfterIncludes=q.processCodeAfterIncludes??void 0,T=q.extraInitializationsAsync,U=q.existingPipelineContext}else this._engine=O,this.defines=null==a?"":a,this._uniformsNames=l.concat(t),this._samplerList=t?t.slice():[],this._attributesNames=I,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=r,this.onCompiled=Z,this._indexParameters=x,this._fallbacks=s;"WEBGL2"===this._engine.shaderPlatformName&&(U=(0,c.j)(V,this._engine._gl)??U),this._attributeLocationByName={},this.uniqueId=F._UniqueIdSeed++,U?(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,T),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.Z||this.dispose(!0)}))}async _processShaderCodeAsync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3?arguments[3]:void 0;w&&await w(),this._processingContext=l||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const t={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:q??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:O.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ic:this._engine.Ic,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,c.d)(t,this.name,this._processFinalCode,((q,l)=>{this._vertexSourceCode=q,this._fragmentSourceCode=l,this._prepareEffect(I)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.Z||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(q){return this._attributes[q]}getAttributeLocationByName(q){return this._attributeLocationByName[q]}getAttributesCount(){return this._attributes.length}getUniformIndex(q){return this._uniformsNames.indexOf(q)}getUniform(q){return this._uniforms[q]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((q=>{this.executeWhenCompiled(q)}))}executeWhenCompiled(q){this.isReady()?q(this):(this.onCompileObservable.add((I=>{q(I)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(q){(0,a.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(I=>{this._processCompilationErrors(I,q)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ic:this._engine.Ic,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(q,I,l,w){this._isReady=!1,this._vertexSourceCodeOverride=q,this._fragmentSourceCodeOverride=I,this.onError=(q,I)=>{w&&w(I)},this.onCompiled=()=>{var q,I;const w=this.getEngine().scenes;if(w)for(let l=0;l<w.length;l++)w[l].markAllMaterialsAsDirty(127);null===(q=(I=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===q||q.call(I,l)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(q){if(this._pipelineContext=q,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let I=0;I<this._attributesNames.length;I++){const q=this._attributesNames[I];this._attributeLocationByName[q]=this._attributes[I]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),F.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this._pipelineContext;this._isReady=!1;try{const l=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),w=l?null:this.defines,t=l?this._vertexSourceCodeOverride:this._vertexSourceCode,O=l?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,c.f)({existingPipelineContext:q?I:null,vertex:t,fragment:O,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(q,I,l,w)=>this._rebuildProgram(q,I,l,w),defines:w,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:l,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:l=>{I&&!q&&this._engine._deletePipelineContext(I),l&&this._onRenderingStateCompiled(l)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(I)}catch(l){this._processCompilationErrors(l,I)}}_getShaderCodeAndErrorLine(q,I,l){const w=l?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let t=null;if(I&&q){const O=I.match(w);if(O&&2===O.length){const I=parseInt(O[1]),w=q.split("\n",-1);w.length>=I&&(t=`Offending line [${I}] in ${l?"fragment":"vertex"} code: ${w[I-1]}`)}}return[q,t]}_processCompilationErrors(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=q.message;const l=this._attributesNames,w=this._fallbacks;if(t.b.Error("Unable to compile effect:"),t.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),t.b.Error(`Attributes: ${l.join(" ")}`),t.b.Error("Defines:\n"+this.defines),F.LogShaderCodeOnCompilationError){var O,c;let q=null,I=null,l=null;var a;if(null!==(O=this._pipelineContext)&&void 0!==O&&O._getVertexShaderCode()&&([l,q]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),l&&(t.b.Error("Vertex code:"),t.b.Error(l))),null!==(c=this._pipelineContext)&&void 0!==c&&c._getFragmentShaderCode())[l,I]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),l&&(t.b.Error("Fragment code:"),t.b.Error(l));q&&t.b.Error(q),I&&t.b.Error(I)}t.b.Error("Error: "+this._compilationError);const s=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};I&&(this._pipelineContext=I,this._isReady=!0,s()),w?(this._pipelineContext=null,w.hasMoreFallbacks?(this._allFallbacksProcessed=!1,t.b.Error("Trying next fallback."),this.defines=w.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,s(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,I||s())}get isSupported(){return""===this._compilationError}_bindTexture(q,I){this._engine._bindTexture(this._samplers[q],I,q)}setTexture(q,I){this._engine.setTexture(this._samplers[q],this._uniforms[q],I,q)}setTextureArray(q,I){const l=q+"Ex";if(-1===this._samplerList.indexOf(l+"0")){const w=this._samplerList.indexOf(q);for(let q=1;q<I.length;q++){const I=l+(q-1).toString();this._samplerList.splice(w+q,0,I)}let t=0;for(const q of this._samplerList)this._samplers[q]=t,t+=1}this._engine.setTextureArray(this._samplers[q],this._uniforms[q],I,q)}bindUniformBuffer(q,I){const l=this._uniformBuffersNames[I];void 0===l||F._BaseCache[l]===q&&this._engine._features.useUBOBindingCache||(F._BaseCache[l]=q,this._engine.bindUniformBufferBase(q,l,I))}bindUniformBlock(q,I){this._engine.bindUniformBlock(this._pipelineContext,q,I)}setInt(q,I){return this._pipelineContext.setInt(q,I),this}setInt2(q,I,l){return this._pipelineContext.setInt2(q,I,l),this}setInt3(q,I,l,w){return this._pipelineContext.setInt3(q,I,l,w),this}setInt4(q,I,l,w,t){return this._pipelineContext.setInt4(q,I,l,w,t),this}setIntArray(q,I){return this._pipelineContext.setIntArray(q,I),this}setIntArray2(q,I){return this._pipelineContext.setIntArray2(q,I),this}setIntArray3(q,I){return this._pipelineContext.setIntArray3(q,I),this}setIntArray4(q,I){return this._pipelineContext.setIntArray4(q,I),this}setUInt(q,I){return this._pipelineContext.setUInt(q,I),this}setUInt2(q,I,l){return this._pipelineContext.setUInt2(q,I,l),this}setUInt3(q,I,l,w){return this._pipelineContext.setUInt3(q,I,l,w),this}setUInt4(q,I,l,w,t){return this._pipelineContext.setUInt4(q,I,l,w,t),this}setUIntArray(q,I){return this._pipelineContext.setUIntArray(q,I),this}setUIntArray2(q,I){return this._pipelineContext.setUIntArray2(q,I),this}setUIntArray3(q,I){return this._pipelineContext.setUIntArray3(q,I),this}setUIntArray4(q,I){return this._pipelineContext.setUIntArray4(q,I),this}setFloatArray(q,I){return this._pipelineContext.setArray(q,I),this}setFloatArray2(q,I){return this._pipelineContext.setArray2(q,I),this}setFloatArray3(q,I){return this._pipelineContext.setArray3(q,I),this}setFloatArray4(q,I){return this._pipelineContext.setArray4(q,I),this}setArray(q,I){return this._pipelineContext.setArray(q,I),this}setArray2(q,I){return this._pipelineContext.setArray2(q,I),this}setArray3(q,I){return this._pipelineContext.setArray3(q,I),this}setArray4(q,I){return this._pipelineContext.setArray4(q,I),this}setMatrices(q,I){return this._pipelineContext.setMatrices(q,I),this}setMatrix(q,I){return this._pipelineContext.setMatrix(q,I),this}setMatrix3x3(q,I){return this._pipelineContext.setMatrix3x3(q,I),this}setMatrix2x2(q,I){return this._pipelineContext.setMatrix2x2(q,I),this}setFloat(q,I){return this._pipelineContext.setFloat(q,I),this}setBool(q,I){return this._pipelineContext.setInt(q,I?1:0),this}setVector2(q,I){return this._pipelineContext.setVector2(q,I),this}setFloat2(q,I,l){return this._pipelineContext.setFloat2(q,I,l),this}setVector3(q,I){return this._pipelineContext.setVector3(q,I),this}setFloat3(q,I,l,w){return this._pipelineContext.setFloat3(q,I,l,w),this}setVector4(q,I){return this._pipelineContext.setVector4(q,I),this}setQuaternion(q,I){return this._pipelineContext.setQuaternion(q,I),this}setFloat4(q,I,l,w,t){return this._pipelineContext.setFloat4(q,I,l,w,t),this}setColor3(q,I){return this._pipelineContext.setColor3(q,I),this}setColor4(q,I,l){return this._pipelineContext.setColor4(q,I,l),this}setDirectColor4(q,I){return this._pipelineContext.setDirectColor4(q,I),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(F.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,c.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;I&&(O.e.GetShadersStore(w)[`${q}PixelShader`]=I),l&&(O.e.GetShadersStore(w)[`${q}VertexShader`]=l)}static ResetCache(){F._BaseCache={}}}F.LogShaderCodeOnCompilationError=!0,F.PersistentMode=!1,F.AutomaticallyClearCodeCache=!1,F._UniqueIdSeed=0,F._BaseCache={},F.ShadersStore=O.e.ShadersStore,F.IncludesShadersStore=O.e.IncludesShadersStore},12603:(q,I,l)=>{l.d(I,{b:()=>t});const w={};function t(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!w[q])return w[q]=!0,`${q} needs to be imported before as it contains a side-effect required by your code.`}},12582:(q,I,l)=>{function w(){return"undefined"!==typeof window}function t(){return"undefined"!==typeof navigator}function O(){return"undefined"!==typeof document}function c(q){let I="",l=q.firstChild;for(;l;)3===l.nodeType&&(I+=l.textContent),l=l.nextSibling;return I}l.d(I,{c:()=>c,d:()=>O,e:()=>t,f:()=>w})},12591:(q,I,l)=>{l.d(I,{b:()=>w});class w{static _CheckLimit(q,I){let l=w._LogLimitOutputs[q];return l?l.current++:(l={limit:I,current:1},w._LogLimitOutputs[q]=l),l.current<=l.limit}static _GenerateLimitMessage(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const l=w._LogLimitOutputs[q];if(!l||!w.MessageLimitReached)return;const t=this._Levels[I];l.current===l.limit&&w[t.name](w.MessageLimitReached.replace(/%LIMIT%/g,""+l.limit).replace(/%TYPE%/g,t.name??""))}static _AddLogEntry(q){w._LogCache=q+w._LogCache,w.OnNewCacheEntry&&w.OnNewCacheEntry(q)}static _FormatMessage(q){const I=q=>q<10?"0"+q:""+q,l=new Date;return"["+I(l.getHours())+":"+I(l.getMinutes())+":"+I(l.getSeconds())+"]: "+q}static _LogDisabled(q,I){}static _LogEnabled(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;const t=Array.isArray(I)?I[0]:I;if(void 0!==l&&!w._CheckLimit(t,l))return;const O=w._FormatMessage(t),c=this._Levels[q],a=Array.isArray(I)?I.slice(1):[];c.logFunc&&c.logFunc("BJS - "+O,...a);const F=`<div style='color:${c.color}'>${O}</div><br>`;w._AddLogEntry(F),w._GenerateLimitMessage(t,q)}static get LogCache(){return w._LogCache}static ClearLogCache(){w._LogCache="",w._LogLimitOutputs={},w.errorsCount=0}static set LogLevels(q){w.Log=w._LogDisabled,w.Warn=w._LogDisabled,w.Error=w._LogDisabled;const I=[w.MessageLogLevel,w.WarningLogLevel,w.ErrorLogLevel];for(const l of I)if((q&l)===l){const q=this._Levels[l];w[q.name]=w._LogEnabled.bind(w,l)}}}w.NoneLogLevel=0,w.MessageLogLevel=1,w.WarningLogLevel=2,w.ErrorLogLevel=4,w.AllLogLevel=7,w.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",w._LogCache="",w._LogLimitOutputs={},w._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],w.errorsCount=0,w.Log=w._LogEnabled.bind(w,w.MessageLogLevel),w.Warn=w._LogEnabled.bind(w,w.WarningLogLevel),w.Error=w._LogEnabled.bind(w,w.ErrorLogLevel)},12573:(q,I,l)=>{l.d(I,{d:()=>c});const w="undefined"!==typeof WeakRef;class t{constructor(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;this.initialize(q,I,l,w)}initialize(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;return this.mask=q,this.skipNextObservers=I,this.target=l,this.currentTarget=w,this}}class O{constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=q,this.mask=I,this.scope=l,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(q)}}class c{static FromPromise(q,I){const l=new c;return q.then((q=>{l.notifyObservers(q)})).catch((q=>{if(!I)throw q;I.notifyObservers(q)})),l}get observers(){return this._observers}constructor(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=I,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new t(0),q&&(this._onObserverAdded=q)}add(q){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!q)return null;const t=new O(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);t.unregisterOnNextCall=l,I?this._observers.unshift(t):this._observers.push(t),this._onObserverAdded&&this._onObserverAdded(t),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(t,this._lastNotifiedValue);const c=w?new WeakRef(this):{deref:()=>this};return t._remove=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=c.deref();I&&(q?I.remove(t):I._remove(t))},t}addOnce(q){return this.add(q,void 0,void 0,void 0,!0)}remove(q){if(!q)return!1;q._remove=null;return-1!==this._observers.indexOf(q)&&(this._deferUnregister(q),!0)}removeCallback(q,I){for(let l=0;l<this._observers.length;l++){const w=this._observers[l];if(!w._willBeUnregistered&&(w.callback===q&&(!I||I===w.scope)))return this._deferUnregister(w),!0}return!1}_deferUnregister(q){q._willBeUnregistered||(this._numObserversMarkedAsDeleted++,q.unregisterOnNextCall=!1,q._willBeUnregistered=!0,setTimeout((()=>{this._remove(q)}),0))}_remove(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q)return!1;const l=this._observers.indexOf(q);return-1!==l&&(I&&this._numObserversMarkedAsDeleted--,this._observers.splice(l,1),!0)}makeObserverTopPriority(q){this._remove(q,!1),this._observers.unshift(q)}makeObserverBottomPriority(q){this._remove(q,!1),this._observers.push(q)}notifyObservers(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,l=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),!this._observers.length)return!0;const O=this._eventState;O.mask=I,O.target=l,O.currentTarget=w,O.skipNextObservers=!1,O.lastReturnValue=q,O.userInfo=t;for(const c of this._observers)if(!c._willBeUnregistered&&(c.mask&I&&(c.unregisterOnNextCall&&this._deferUnregister(c),c.scope?O.lastReturnValue=c.callback.apply(c.scope,[q,O]):O.lastReturnValue=c.callback(q,O)),O.skipNextObservers))return!1;return!0}notifyObserver(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=I),q._willBeUnregistered)return;const w=this._eventState;w.mask=l,w.skipNextObservers=!1,q.unregisterOnNextCall&&this._deferUnregister(q),q.callback(I,w)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const q=this._observers.pop();q&&(q._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const q=new c;return q._observers=this._observers.slice(0),q}hasSpecificMask(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const I of this._observers)if(I.mask&q||I.mask===q)return!0;return!1}}},12647:(q,I,l)=>{l.d(I,{c:()=>t,e:()=>c});let w=[];class t{static SetImmediate(q){0===w.length&&setTimeout((()=>{const q=w;w=[];for(const I of q)I()}),1),w.push(q)}}function O(q,I,l){try{if(q())return I(),!0}catch(w){return null===l||void 0===l||l(w),!0}return!1}const c=function(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,c=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&O(q,I,l))return null;const a=setInterval((()=>{O(q,I,l)?clearInterval(a):(t-=w,t<0&&(clearInterval(a),null===l||void 0===l||l(new Error("Operation timed out after maximum retries. "+(c||"")),!0)))}),w);return()=>clearInterval(a)}}}]);