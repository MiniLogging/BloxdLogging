"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[9],{12811:(z,u,U)=>{U.d(u,{e:()=>L,h:()=>t,o:()=>V,l:()=>N,q:()=>D});class J{constructor(){this.children=[]}isValid(z){return!0}process(z,u,U){let J="";if(this.line){let U=this.line;const d=u.processor;if(d){var v,f,g,w,P,R,S;d.lineProcessor&&(U=d.lineProcessor(U,u.isFragment,u.processingContext));const J=null!==(v=null===(f=u.processor)||void 0===f?void 0:f.attributeKeywordName)&&void 0!==v?v:"attribute",mz=u.isFragment&&null!==(g=u.processor)&&void 0!==g&&g.varyingFragmentKeywordName?null===(w=u.processor)||void 0===w?void 0:w.varyingFragmentKeywordName:!u.isFragment&&null!==(P=u.processor)&&void 0!==P&&P.varyingVertexKeywordName?null===(R=u.processor)||void 0===R?void 0:R.varyingVertexKeywordName:"varying";if(!u.isFragment&&d.attributeProcessor&&this.line.startsWith(J))U=d.attributeProcessor(this.line,z,u.processingContext);else if(d.varyingProcessor&&(null!==(S=d.varyingCheck)&&void 0!==S&&S.call(d,this.line,u.isFragment)||!d.varyingCheck&&this.line.startsWith(mz)))U=d.varyingProcessor(this.line,u.isFragment,z,u.processingContext);else if(d.uniformProcessor&&d.uniformRegexp&&d.uniformRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(U=d.uniformProcessor(this.line,u.isFragment,z,u.processingContext));else if(d.uniformBufferProcessor&&d.uniformBufferRegexp&&d.uniformBufferRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(U=d.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0);else if(d.textureProcessor&&d.textureRegexp&&d.textureRegexp.test(this.line))U=d.textureProcessor(this.line,u.isFragment,z,u.processingContext);else if((d.uniformProcessor||d.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!u.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?d.uniformProcessor&&(U=d.uniformProcessor(this.line,u.isFragment,z,u.processingContext)):d.uniformBufferProcessor&&(U=d.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0)}u.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(u.lookForClosingBracketForUniformBuffer=!1,d.endOfUniformBufferProcessor&&(U=d.endOfUniformBufferProcessor(this.line,u.isFragment,u.processingContext)))}J+=U+"\n"}for(const d of this.children)J+=d.process(z,u,U);return this.additionalDefineKey&&(z[this.additionalDefineKey]=this.additionalDefineValue||"true",U[this.additionalDefineKey]=z[this.additionalDefineKey]),J}}class v{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(z){this._lines.length=0;for(const u of z){if(!u||"\r"===u)continue;if("#"===u[0]){this._lines.push(u);continue}const z=u.trim();if(!z)continue;if(z.startsWith("//")){this._lines.push(u);continue}const U=z.indexOf(";");if(-1===U)this._lines.push(z);else if(U===z.length-1)z.length>1&&this._lines.push(z);else{const z=u.split(";");for(let u=0;u<z.length;u++){let U=z[u];U&&(U=U.trim(),U&&this._lines.push(U+(u!==z.length-1?";":"")))}}}}}class f extends J{process(z,u,U){for(let J=0;J<this.children.length;J++){const v=this.children[J];if(v.isValid(z))return v.process(z,u,U)}return""}}class g extends J{isValid(z){return this.testExpression.isTrue(z)}}class w{isTrue(z){return!0}static postfixToInfix(z){const u=[];for(const U of z)if(void 0===w._OperatorPriority[U])u.push(U);else{const z=u[u.length-1],J=u[u.length-2];u.length-=2,u.push("(".concat(J).concat(U).concat(z,")"))}return u[u.length-1]}static infixToPostfix(z){const u=w._InfixToPostfixCache.get(z);if(u)return u.accessTime=Date.now(),u.result;if(!z.includes("&&")&&!z.includes("||")&&!z.includes(")")&&!z.includes("("))return[z];const U=[];let J=-1;const v=()=>{S=S.trim(),""!==S&&(U.push(S),S="")},f=z=>{J<w._Stack.length-1&&(w._Stack[++J]=z)},g=()=>w._Stack[J],P=()=>-1===J?"!!INVALID EXPRESSION!!":w._Stack[J--];let R=0,S="";for(;R<z.length;){const u=z.charAt(R),d=R<z.length-1?z.substring(R,2+R):"";if("("===u)S="",f(u);else if(")"===u){for(v();-1!==J&&"("!==g();)U.push(P());P()}else if(w._OperatorPriority[d]>1){for(v();-1!==J&&w._OperatorPriority[g()]>=w._OperatorPriority[d];)U.push(P());f(d),R++}else S+=u;R++}for(v();-1!==J;)"("===g()?P():U.push(P());return w._InfixToPostfixCache.size>=w.InfixToPostfixCacheLimitSize&&w.ClearCache(),w._InfixToPostfixCache.set(z,{result:U,accessTime:Date.now()}),U}static ClearCache(){const z=Array.from(w._InfixToPostfixCache.entries()).sort(((z,u)=>z[1].accessTime-u[1].accessTime));for(let u=0;u<w.InfixToPostfixCacheCleanupSize;u++)w._InfixToPostfixCache.delete(z[u][0])}}w.InfixToPostfixCacheLimitSize=5e4,w.InfixToPostfixCacheCleanupSize=25e3,w._InfixToPostfixCache=new Map,w._OperatorPriority={")":0,"(":1,"||":2,"&&":3},w._Stack=["","","","","","","","","","","","","","","","","","","",""];class P extends w{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=z,this.not=u}isTrue(z){let u=void 0!==z[this.define];return this.not&&(u=!u),u}}class R extends w{isTrue(z){return this.leftOperand.isTrue(z)||this.rightOperand.isTrue(z)}}class S extends w{isTrue(z){return this.leftOperand.isTrue(z)&&this.rightOperand.isTrue(z)}}class d extends w{constructor(z,u,U){super(),this.define=z,this.operand=u,this.testValue=U}toString(){return"".concat(this.define," ").concat(this.operand," ").concat(this.testValue)}isTrue(z){let u=!1;const U=parseInt(void 0!=z[this.define]?z[this.define]:this.define),J=parseInt(void 0!=z[this.testValue]?z[this.testValue]:this.testValue);if(isNaN(U)||isNaN(J))return!1;switch(this.operand){case">":u=U>J;break;case"<":u=U<J;break;case"<=":u=U<=J;break;case">=":u=U>=J;break;case"==":u=U===J;break;case"!=":u=U!==J}return u}}var mz=U(12782),Z=U(12817);const A=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,C=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,r=/__decl__/,M=/light\{X\}.(\w*)/g,T=/\{X\}/g,X=[],h=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function t(z){z.processor&&z.processor.initializeShaders&&z.processor.initializeShaders(z.processingContext)}function V(z,u,U,J){var v;null!==(v=u.processor)&&void 0!==v&&v.preProcessShaderCode&&(z=u.processor.preProcessShaderCode(z,u.isFragment)),N(z,u,(z=>{u.processCodeAfterIncludes&&(z=u.processCodeAfterIncludes(u.isFragment?"fragment":"vertex",z,u.defines));const v=function(z,u,U){let J=function(z,u){var U;if(null!==(U=u.processor)&&void 0!==U&&U.noPrecision)return z;const J=u.shouldUseHighPrecisionShader;-1===z.indexOf("precision highp float")?z=J?"precision highp float;\n"+z:"precision mediump float;\n"+z:J||(z=z.replace("precision highp float","precision mediump float"));return z}(z,u);if(!u.processor)return J;if(0===u.processor.shaderLanguage&&-1!==J.indexOf("#version 3")&&(J=J.replace("#version 300 es",""),!u.processor.parseGLES3))return J;const v=u.defines,f=p(u,U);u.processor.preProcessor&&(J=u.processor.preProcessor(J,v,f,u.isFragment,u.processingContext));const g={};J=Y(J,f,u,g),u.processor.postProcessor&&(J=u.processor.postProcessor(J,v,u.isFragment,u.processingContext,U?{drawBuffersExtensionDisabled:!U.getCaps().drawBuffersExtension}:{},f,g));null!==U&&void 0!==U&&U._features.needShaderCodeInlining&&(J=U.inlineShaderCode(J));return J}(z,u,J);U(v,z)}))}function L(z,u,U){return U.processor&&U.processor.finalizeShaders?U.processor.finalizeShaders(z,u,U.processingContext):{vertexCode:z,fragmentCode:u}}function O(z){const u=/defined\((.+)\)/.exec(z);if(u&&u.length)return new P(u[1].trim(),"!"===z[0]);const U=["==","!=",">=","<=","<",">"];let J="",v=0;for(J of U)if(v=z.indexOf(J),v>-1)break;if(-1===v)return new P(z);const f=z.substring(0,v).trim(),g=z.substring(v+J.length).trim();return new d(f,J,g)}function x(z,u){const U=new g,J=z.substring(0,u);let v=z.substring(u);return v=v.substring(0,(v.indexOf("//")+1||v.length+1)-1).trim(),U.testExpression="#ifdef"===J?new P(v):"#ifndef"===J?new P(v,!0):function(z){z=z.replace(A,"defined[$1]");const u=w.infixToPostfix(z),U=[];for(const v of u)if("||"!==v&&"&&"!==v)U.push(v);else if(U.length>=2){let z=U[U.length-1],u=U[U.length-2];U.length-=2;const J="&&"==v?new S:new R;"string"===typeof z&&(z=z.replace(E,"defined($1)")),"string"===typeof u&&(u=u.replace(E,"defined($1)")),J.leftOperand="string"===typeof u?O(u):u,J.rightOperand="string"===typeof z?O(z):z,U.push(J)}let J=U[U.length-1];return"string"===typeof J&&(J=J.replace(E,"defined($1)")),"string"===typeof J?O(J):J}(v),U}function Q(z,u,U,v){let f=z.currentLine;for(;K(z,U,v);){f=z.currentLine;const g=f.substring(0,5).toLowerCase();if("#else"===g){const U=new J;return u.children.push(U),void K(z,U,v)}if("#elif"===g){const z=x(f,5);u.children.push(z),U=z}}}function K(z,u,U){for(;z.canRead;){z.lineIndex++;const v=z.currentLine;if(v.indexOf("#")>=0){const J=h.exec(v);if(J&&J.length){switch(J[0]){case"#ifdef":{const J=new f;u.children.push(J);const g=x(v,6);J.children.push(g),Q(z,J,g,U);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const J=new f;u.children.push(J);const g=x(v,7);J.children.push(g),Q(z,J,g,U);break}case"#if":{const J=new f,g=x(v,3);u.children.push(J),J.children.push(g),Q(z,J,g,U);break}}continue}}const g=new J;if(g.line=v,u.children.push(g),"#"===v[0]&&"d"===v[1]){const z=v.replace(";","").split(" ");g.additionalDefineKey=z[1],3===z.length&&(g.additionalDefineValue=z[2])}}return!1}function Y(z,u,U,f){const g=new J,w=new v;return w.lineIndex=-1,w.lines=z.split("\n"),K(w,g,f),g.process(u,U,f)}function p(z,u){var U;const J=z.defines,v={};for(const f of J){const z=f.replace("#define","").replace(";","").trim().split(" ");v[z[0]]=z.length>1?z[1]:""}return 0===(null===(U=z.processor)||void 0===U?void 0:U.shaderLanguage)&&(v.GL_ES="true"),v.__VERSION__=z.version,v[z.platformName]="true",(0,Z.h)(v,null===u||void 0===u?void 0:u.isNDCHalfZRange,null===u||void 0===u?void 0:u.df,null===u||void 0===u?void 0:u.useExactSrgbConversions),v}function N(z,u,U){let J;for(X.length=0;null!==(J=C.exec(z));)X.push(J);let v=String(z),f=[z],g=!1;for(const w of X){let z=w[1];if(-1!==z.indexOf("__decl__")&&(z=z.replace(r,""),u.supportsUniformBuffers&&(z=z.replace("Vertex","Ubo").replace("Fragment","Ubo")),z+="Declaration"),!u.includesShadersStore[z]){const J=u.shadersRepository+"ShadersInclude/"+z+".fx";return void D.loadFile(J,(J=>{u.includesShadersStore[z]=J,N(f.join(""),u,U)}))}{let U=u.includesShadersStore[z];if(w[2]){const z=w[3].split(",");for(let u=0;u<z.length;u+=2){const J=new RegExp(z[u],"g"),v=z[u+1];U=U.replace(J,v)}}if(w[4]){const z=w[5];if(-1!==z.indexOf("..")){const J=z.split(".."),v=parseInt(J[0]);let f=parseInt(J[1]),g=U.slice(0);U="",isNaN(f)&&(f=u.indexParameters[J[1]]);for(let z=v;z<f;z++)u.supportsUniformBuffers||(g=g.replace(M,((z,u)=>u+"{X}"))),U+=g.replace(T,z.toString())+"\n"}else u.supportsUniformBuffers||(U=U.replace(M,((z,u)=>u+"{X}"))),U=U.replace(T,z)}const J=[];for(const z of f){const u=z.split(w[0]);for(let z=0;z<u.length-1;z++)J.push(u[z]),J.push(U);J.push(u[u.length-1])}f=J,g=g||U.indexOf("#include<")>=0||U.indexOf("#include <")>=0}}X.length=0,v=f.join(""),g?N(v.toString(),u,U):U(v)}const D={loadFile:(z,u,U,J,v,f)=>{throw(0,mz.c)("FileTools")}}},12817:(z,u,U)=>{U.d(u,{e:()=>v,f:()=>f,h:()=>w,k:()=>g,m:()=>P});var J=U(12782);U(12758);const v={};function f(z,u){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(u?u+"\n":"")+z}function g(z,u,U,f,g,w,P){const R=P||v.loadFile;if(R){return R(z,u,U,f,g,w)}throw(0,J.c)("FileTools")}function w(z,u,U,J){if(z)return u?z.IS_NDC_HALF_ZRANGE="":delete z.IS_NDC_HALF_ZRANGE,U?z.USE_REVERSE_DEPTHBUFFER="":delete z.USE_REVERSE_DEPTHBUFFER,void(J?z.USE_EXACT_SRGB_CONVERSIONS="":delete z.USE_EXACT_SRGB_CONVERSIONS);{let z="";return u&&(z+="#define IS_NDC_HALF_ZRANGE"),U&&(z&&(z+="\n"),z+="#define USE_REVERSE_DEPTHBUFFER"),J&&(z&&(z+="\n"),z+="#define USE_EXACT_SRGB_CONVERSIONS"),z}}function P(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;switch(z){case 3:{const z=(ArrayBuffer,new Int8Array(u));return J&&z.set(new Int8Array(J)),z}case 0:{const z=(ArrayBuffer,new Uint8Array(u));return J&&z.set(new Uint8Array(J)),z}case 4:{const z=u instanceof ArrayBuffer?new Int16Array(u):new Int16Array(U?u/2:u);return J&&z.set(new Int16Array(J)),z}case 5:case 8:case 9:case 10:case 2:{const z=u instanceof ArrayBuffer?new Uint16Array(u):new Uint16Array(U?u/2:u);return J&&z.set(new Uint16Array(J)),z}case 6:{const z=u instanceof ArrayBuffer?new Int32Array(u):new Int32Array(U?u/4:u);return J&&z.set(new Int32Array(J)),z}case 7:case 11:case 12:case 13:case 14:case 15:{const z=u instanceof ArrayBuffer?new Uint32Array(u):new Uint32Array(U?u/4:u);return J&&z.set(new Uint32Array(J)),z}case 1:{const z=u instanceof ArrayBuffer?new Float32Array(u):new Float32Array(U?u/4:u);return J&&z.set(new Float32Array(J)),z}}const v=(ArrayBuffer,new Uint8Array(u));return J&&v.set(new Uint8Array(J)),v}},12837:(z,u,U)=>{U.d(u,{d:()=>J});class J{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersRepository:J.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersStore:J.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.IncludesShadersStore:J.IncludesShadersStoreWGSL}}J.ShadersRepository="src/Shaders/",J.ShadersStore={},J.IncludesShadersStore={},J.ShadersRepositoryWGSL="src/ShadersWGSL/",J.ShadersStoreWGSL={},J.IncludesShadersStoreWGSL={}},12845:(z,u,U)=>{U.d(u,{c:()=>mz,e:()=>T,f:()=>A,j:()=>Z,n:()=>E,o:()=>M,s:()=>d,t:()=>R,v:()=>S,y:()=>P,C:()=>w});class J{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Au._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(z){z&&this.program&&z(this.program)}setEngine(z){this.Au=z}_fillEffectInformation(z,u,U,J,v,f,g,w){const P=this.Au;if(P.supportsUniformBuffers)for(const S in u)z.bindUniformBlock(S,u[S]);let R;for(this.Au.getUniforms(this,U).forEach(((z,u)=>{J[U[u]]=z})),this._uniforms=J,R=0;R<v.length;R++){null==z.getUniform(v[R])&&(v.splice(R,1),R--)}v.forEach(((z,u)=>{f[z]=u}));for(const S of P.getAttributes(this,g))w.push(S)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(z,u){const U=this._valueCache[z],J=u.updateFlag;return(void 0===U||U!==J)&&(this._valueCache[z]=J,!0)}_cacheFloat2(z,u,U){let J=this._valueCache[z];if(!J||2!==J.length)return J=[u,U],this._valueCache[z]=J,!0;let v=!1;return J[0]!==u&&(J[0]=u,v=!0),J[1]!==U&&(J[1]=U,v=!0),v}_cacheFloat3(z,u,U,J){let v=this._valueCache[z];if(!v||3!==v.length)return v=[u,U,J],this._valueCache[z]=v,!0;let f=!1;return v[0]!==u&&(v[0]=u,f=!0),v[1]!==U&&(v[1]=U,f=!0),v[2]!==J&&(v[2]=J,f=!0),f}_cacheFloat4(z,u,U,J,v){let f=this._valueCache[z];if(!f||4!==f.length)return f=[u,U,J,v],this._valueCache[z]=f,!0;let g=!1;return f[0]!==u&&(f[0]=u,g=!0),f[1]!==U&&(f[1]=U,g=!0),f[2]!==J&&(f[2]=J,g=!0),f[3]!==v&&(f[3]=v,g=!0),g}setInt(z,u){const U=this._valueCache[z];void 0!==U&&U===u||this.Au.setInt(this._uniforms[z],u)&&(this._valueCache[z]=u)}setInt2(z,u,U){this._cacheFloat2(z,u,U)&&(this.Au.setInt2(this._uniforms[z],u,U)||(this._valueCache[z]=null))}setInt3(z,u,U,J){this._cacheFloat3(z,u,U,J)&&(this.Au.setInt3(this._uniforms[z],u,U,J)||(this._valueCache[z]=null))}setInt4(z,u,U,J,v){this._cacheFloat4(z,u,U,J,v)&&(this.Au.setInt4(this._uniforms[z],u,U,J,v)||(this._valueCache[z]=null))}setIntArray(z,u){this._valueCache[z]=null,this.Au.setIntArray(this._uniforms[z],u)}setIntArray2(z,u){this._valueCache[z]=null,this.Au.setIntArray2(this._uniforms[z],u)}setIntArray3(z,u){this._valueCache[z]=null,this.Au.setIntArray3(this._uniforms[z],u)}setIntArray4(z,u){this._valueCache[z]=null,this.Au.setIntArray4(this._uniforms[z],u)}setUInt(z,u){const U=this._valueCache[z];void 0!==U&&U===u||this.Au.setUInt(this._uniforms[z],u)&&(this._valueCache[z]=u)}setUInt2(z,u,U){this._cacheFloat2(z,u,U)&&(this.Au.setUInt2(this._uniforms[z],u,U)||(this._valueCache[z]=null))}setUInt3(z,u,U,J){this._cacheFloat3(z,u,U,J)&&(this.Au.setUInt3(this._uniforms[z],u,U,J)||(this._valueCache[z]=null))}setUInt4(z,u,U,J,v){this._cacheFloat4(z,u,U,J,v)&&(this.Au.setUInt4(this._uniforms[z],u,U,J,v)||(this._valueCache[z]=null))}setUIntArray(z,u){this._valueCache[z]=null,this.Au.setUIntArray(this._uniforms[z],u)}setUIntArray2(z,u){this._valueCache[z]=null,this.Au.setUIntArray2(this._uniforms[z],u)}setUIntArray3(z,u){this._valueCache[z]=null,this.Au.setUIntArray3(this._uniforms[z],u)}setUIntArray4(z,u){this._valueCache[z]=null,this.Au.setUIntArray4(this._uniforms[z],u)}setArray(z,u){this._valueCache[z]=null,this.Au.setArray(this._uniforms[z],u)}setArray2(z,u){this._valueCache[z]=null,this.Au.setArray2(this._uniforms[z],u)}setArray3(z,u){this._valueCache[z]=null,this.Au.setArray3(this._uniforms[z],u)}setArray4(z,u){this._valueCache[z]=null,this.Au.setArray4(this._uniforms[z],u)}setMatrices(z,u){u&&(this._valueCache[z]=null,this.Au.setMatrices(this._uniforms[z],u))}setMatrix(z,u){this._cacheMatrix(z,u)&&(this.Au.setMatrices(this._uniforms[z],u.jf())||(this._valueCache[z]=null))}setMatrix3x3(z,u){this._valueCache[z]=null,this.Au.setMatrix3x3(this._uniforms[z],u)}setMatrix2x2(z,u){this._valueCache[z]=null,this.Au.setMatrix2x2(this._uniforms[z],u)}setFloat(z,u){const U=this._valueCache[z];void 0!==U&&U===u||this.Au.setFloat(this._uniforms[z],u)&&(this._valueCache[z]=u)}setVector2(z,u){this._cacheFloat2(z,u.x,u.y)&&(this.Au.setFloat2(this._uniforms[z],u.x,u.y)||(this._valueCache[z]=null))}setFloat2(z,u,U){this._cacheFloat2(z,u,U)&&(this.Au.setFloat2(this._uniforms[z],u,U)||(this._valueCache[z]=null))}setVector3(z,u){this._cacheFloat3(z,u.x,u.y,u.z)&&(this.Au.setFloat3(this._uniforms[z],u.x,u.y,u.z)||(this._valueCache[z]=null))}setFloat3(z,u,U,J){this._cacheFloat3(z,u,U,J)&&(this.Au.setFloat3(this._uniforms[z],u,U,J)||(this._valueCache[z]=null))}setVector4(z,u){this._cacheFloat4(z,u.x,u.y,u.z,u.w)&&(this.Au.setFloat4(this._uniforms[z],u.x,u.y,u.z,u.w)||(this._valueCache[z]=null))}setQuaternion(z,u){this._cacheFloat4(z,u.x,u.y,u.z,u.w)&&(this.Au.setFloat4(this._uniforms[z],u.x,u.y,u.z,u.w)||(this._valueCache[z]=null))}setFloat4(z,u,U,J,v){this._cacheFloat4(z,u,U,J,v)&&(this.Au.setFloat4(this._uniforms[z],u,U,J,v)||(this._valueCache[z]=null))}setColor3(z,u){this._cacheFloat3(z,u.r,u.g,u.b)&&(this.Au.setFloat3(this._uniforms[z],u.r,u.g,u.b)||(this._valueCache[z]=null))}setColor4(z,u,U){this._cacheFloat4(z,u.r,u.g,u.b,U)&&(this.Au.setFloat4(this._uniforms[z],u.r,u.g,u.b,U)||(this._valueCache[z]=null))}setDirectColor4(z,u){this._cacheFloat4(z,u.r,u.g,u.b,u.a)&&(this.Au.setFloat4(this._uniforms[z],u.r,u.g,u.b,u.a)||(this._valueCache[z]=null))}_getVertexShaderCode(){return this.vertexShader?this.Au._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Au._getShaderSource(this.fragmentShader):null}}var v=U(12817);const f=new WeakMap,g={_webGLVersion:2,cachedPipelines:{}};function w(z){let u=f.get(z);if(!u){if(!z)return g;u={_webGLVersion:z.TEXTURE_BINDING_3D?2:1,_context:z,parallelShaderCompile:z.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},f.set(z,u)}return u}function P(z){f.delete(z)}function R(z,u,U,J,v,f){const g=w(J);var P;f||(f=null!==(P=g._createShaderProgramInjection)&&void 0!==P?P:mz);return f(z,r(u,"vertex",J,g._contextWasLost),r(U,"fragment",J,g._contextWasLost),J,v,g.validateShaderPrograms)}function S(z,u,U,J,v){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0;const P=w(v);var R;g||(g=null!==(R=P._createShaderProgramInjection)&&void 0!==R?R:mz);const S=P._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return g(z,C(u,"vertex",J,S,v,P._contextWasLost),C(U,"fragment",J,S,v,P._contextWasLost),v,f,P.validateShaderPrograms)}function d(z,u){const U=new J,v=w(z);return v.parallelShaderCompile&&!v.disableParallelShaderCompile&&(U.isParallelCompiled=!0),U.context=v._context,U}function mz(z,u,U,J){let v=arguments.length>5?arguments[5]:void 0;const f=J.createProgram();if(z.program=f,!f)throw new Error("Unable to create program");return J.attachShader(f,u),J.attachShader(f,U),J.linkProgram(f),z.context=J,z.vertexShader=u,z.fragmentShader=U,z.isParallelCompiled||A(z,J,v),f}function Z(z,u,U){const J=z;if(J._isDisposed)return!1;const v=w(u);return!!(v&&v.parallelShaderCompile&&v.parallelShaderCompile.COMPLETION_STATUS_KHR&&J.program&&u.getProgramParameter(J.program,v.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(A(J,u,U),!0)}function A(z,u,U){const J=z.context,v=z.vertexShader,f=z.fragmentShader,g=z.program;if(!J.getProgramParameter(g,J.LINK_STATUS)){if(!u.getShaderParameter(v,u.COMPILE_STATUS)){const U=u.getShaderInfoLog(v);if(U)throw z.vertexCompilationError=U,new Error("VERTEX SHADER "+U)}if(!u.getShaderParameter(f,u.COMPILE_STATUS)){const U=u.getShaderInfoLog(f);if(U)throw z.fragmentCompilationError=U,new Error("FRAGMENT SHADER "+U)}const U=J.getProgramInfoLog(g);if(U)throw z.programLinkError=U,new Error(U)}if(U){J.validateProgram(g);if(!J.getProgramParameter(g,J.VALIDATE_STATUS)){const u=J.getProgramInfoLog(g);if(u)throw z.programValidationError=u,new Error(u)}}J.deleteShader(v),J.deleteShader(f),z.vertexShader=void 0,z.fragmentShader=void 0,z.onCompiled&&(z.onCompiled(),z.onCompiled=void 0)}function E(z,u,U,J,v,f,g,P,d){let mz=arguments.length>10?arguments[10]:void 0,Z=arguments.length>11?arguments[11]:void 0,A=arguments.length>12?arguments[12]:void 0;const E=w(z.context);var C,r;Z||(Z=null!==(C=E.createRawShaderProgramInjection)&&void 0!==C?C:R);A||(A=null!==(r=E.createShaderProgramInjection)&&void 0!==r?r:S);const M=z;M.program=J?Z(M,u,U,M.context,d):A(M,u,U,P,M.context,d),M.program.__SPECTOR_rebuildProgram=g,mz()}function C(z,u,U,J,f,g){return r((0,v.f)(z,U,J),u,f,g)}function r(z,u,U,J){const v=U.createShader("vertex"===u?U.VERTEX_SHADER:U.FRAGMENT_SHADER);if(!v){let z=U.NO_ERROR,v=U.NO_ERROR;for(;(v=U.getError())!==U.NO_ERROR;)z=v;throw new Error("Something went wrong while creating a gl ".concat(u," shader object. gl error=").concat(z,", gl isContextLost=").concat(U.isContextLost(),", _contextWasLost=").concat(J))}return U.shaderSource(v,z),U.compileShader(v),v}function M(z,u){u.useProgram(z)}function T(z,u){const U=z;if(!U.isParallelCompiled)return void u(z);const J=U.onCompiled;U.onCompiled=()=>{null===J||void 0===J||J(),u(z)}}},12841:(z,u,U)=>{U.d(u,{e:()=>d,g:()=>Z,i:()=>R,l:()=>S});var J=U(12758),v=U(12845),f=U(12837),g=U(12760),w=U(12811),P=U(12817);function R(z,u){return(0,v.C)(u).cachedPipelines[z]}function S(z){const u=z._name,U=z.context;if(u&&U){const z=(0,v.C)(U),J=z.cachedPipelines[u];null===J||void 0===J||J.dispose(),delete z.cachedPipelines[u]}}function d(z,u,U,v,f,g,P){let R,S;const d=(0,J.i)()?null===g||void 0===g?void 0:g.getHostDocument():null;R="string"===typeof u?u:u.vertexSource?"source:"+u.vertexSource:u.vertexElement?(null===d||void 0===d?void 0:d.getElementById(u.vertexElement))||u.vertexElement:u.vertex||u,S="string"===typeof u?u:u.fragmentSource?"source:"+u.fragmentSource:u.fragmentElement?(null===d||void 0===d?void 0:d.getElementById(u.fragmentElement))||u.fragmentElement:u.fragment||u;const Z=[void 0,void 0],A=()=>{if(Z[0]&&Z[1]){z.isFragment=!0;const[J,R]=Z;(0,w.o)(R,z,((g,R)=>{P&&(P._fragmentSourceCodeBeforeMigration=R),U&&(g=U("fragment",g));const S=(0,w.e)(J,g,z);z=null;const d=function(z,u,U,J){if(U){return{vertexSourceCode:(1===J?"//":"")+"#define SHADER_NAME vertex:"+(U.vertexElement||U.vertex||U.spectorName||U)+"\n"+z,fragmentSourceCode:(1===J?"//":"")+"#define SHADER_NAME fragment:"+(U.fragmentElement||U.fragment||U.spectorName||U)+"\n"+u}}return{vertexSourceCode:z,fragmentSourceCode:u}}(S.vertexCode,S.fragmentCode,u,f);null===v||void 0===v||v(d.vertexSourceCode,d.fragmentSourceCode)}),g)}};mz(R,"Vertex","",(u=>{(0,w.h)(z),(0,w.o)(u,z,((z,J)=>{P&&(P._rawVertexSourceCode=u,P._vertexSourceCodeBeforeMigration=J),U&&(z=U("vertex",z)),Z[0]=z,A()}),g)}),f),mz(S,"Fragment","Pixel",(z=>{P&&(P._rawFragmentSourceCode=z),Z[1]=z,A()}),f)}function mz(z,u,U,v,g,w){if("undefined"!==typeof HTMLElement&&z instanceof HTMLElement){return void v((0,J.b)(z))}if("source:"===z.substring(0,7))return void v(z.substring(7));if("base64:"===z.substring(0,7)){return void v(window.atob(z.substring(7)))}const R=f.d.GetShadersStore(g);if(R[z+u+"Shader"])return void v(R[z+u+"Shader"]);if(U&&R[z+U+"Shader"])return void v(R[z+U+"Shader"]);let S;if(S="."===z[0]||"/"===z[0]||z.indexOf("http")>-1?z:f.d.GetShadersRepository(g)+z,!(w=w||P.k))throw new Error("loadFileInjection is not defined");w(S+"."+u.toLowerCase()+".fx",v)}const Z=(z,u,U,J)=>{try{const f=z.context?(0,v.C)(z.context):null;f&&(f.disableParallelShaderCompile=z.disableParallelCompilation);const g=z.existingPipelineContext||u(z.shaderProcessingContext);return g._name=z.name,z.name&&f&&(f.cachedPipelines[z.name]=g),U(g,z.vertex,z.fragment,!!z.createAsRaw,"","",z.rebuildRebind,z.defines,z.transformFeedbackVaryings,"",(()=>{J(g,(()=>{var u;null===(u=z.onRenderingStateCompiled)||void 0===u||u.call(z,g)}))})),g}catch(f){throw g.d.Error("Error compiling effect"),f}}},12829:(z,u,U)=>{U.r(u),U.d(u,{Effect:()=>P});var J=U(12756),v=U(12760),f=U(12837),g=U(12841),w=U(12825);class P{static get ShadersRepository(){return f.d.ShadersRepository}static set ShadersRepository(z){f.d.ShadersRepository=z}get S(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new J.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,mz=arguments.length>9?arguments[9]:void 0,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",A=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new J.e,this.onErrorObservable=new J.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=z,this._key=Z;const C=this._key.replace(/\r/g,"").replace(/\n/g,"|");let r;if(u.attributes){var M,T,X;const z=u;if(this._engine=U,this._attributesNames=z.attributes,this._uniformsNames=z.uniformsNames.concat(z.samplers),this._samplerList=z.samplers.slice(),this.defines=z.defines,this.onError=z.onError,this.onCompiled=z.onCompiled,this._fallbacks=z.fallbacks,this._indexParameters=z.indexParameters,this._transformFeedbackVaryings=z.transformFeedbackVaryings||null,this._multiTarget=!!z.multiTarget,this._shaderLanguage=null!==(M=z.shaderLanguage)&&void 0!==M?M:0,this._disableParallelShaderCompilation=!!z.disableParallelShaderCompilation,z.uniformBuffersNames){this._uniformBuffersNamesList=z.uniformBuffersNames.slice();for(let u=0;u<z.uniformBuffersNames.length;u++)this._uniformBuffersNames[z.uniformBuffersNames[u]]=u}this._processFinalCode=null!==(T=z.processFinalCode)&&void 0!==T?T:null,this._processCodeAfterIncludes=null!==(X=z.processCodeAfterIncludes)&&void 0!==X?X:void 0,E=z.extraInitializationsAsync,r=z.existingPipelineContext}else this._engine=f,this.defines=null==w?"":w,this._uniformsNames=U.concat(v),this._samplerList=v?v.slice():[],this._attributesNames=u,this._uniformBuffersNamesList=[],this._shaderLanguage=A,this.onError=d,this.onCompiled=S,this._indexParameters=mz,this._fallbacks=R;var h;"WEBGL2"===this._engine.shaderPlatformName&&(r=null!==(h=(0,g.i)(C,this._engine._gl))&&void 0!==h?h:r);this._attributeLocationByName={},this.uniqueId=P._UniqueIdSeed++,r?(this._pipelineContext=r,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.S||this.dispose(!0)}))}async _processShaderCodeAsync(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0;J&&await J(),this._processingContext=U||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const v={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:null!==z&&void 0!==z?z:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:f.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:f.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,df:this._engine.df,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,g.e)(v,this.name,this._processFinalCode,((z,U)=>{this._vertexSourceCode=z,this._fragmentSourceCode=U,this._prepareEffect(u)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(z){return!1}}_isReadyInternal(){return!!this._engine.S||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(z){return this._attributes[z]}getAttributeLocationByName(z){return this._attributeLocationByName[z]}getAttributesCount(){return this._attributes.length}getUniformIndex(z){return this._uniformsNames.indexOf(z)}getUniform(z){return this._uniforms[z]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((z=>{this.executeWhenCompiled(z)}))}executeWhenCompiled(z){this.isReady()?z(this):(this.onCompileObservable.add((u=>{z(u)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(z){(0,w.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(u=>{this._processCompilationErrors(u,z)}),16,12e4,!0," - Effect: ".concat("string"===typeof this.name?this.name:this.key))}get vertexSourceCode(){var z,u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(z=null===(u=this._pipelineContext)||void 0===u?void 0:u._getVertexShaderCode())&&void 0!==z?z:this._vertexSourceCode}get fragmentSourceCode(){var z,u;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(z=null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode())&&void 0!==z?z:this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,df:this._engine.df,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(z,u,U,J){this._isReady=!1,this._vertexSourceCodeOverride=z,this._fragmentSourceCodeOverride=u,this.onError=(z,u)=>{J&&J(u)},this.onCompiled=()=>{var z,u;const J=this.getEngine().scenes;if(J)for(let U=0;U<J.length;U++)J[U].markAllMaterialsAsDirty(127);null===(z=(u=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===z||z.call(u,U)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(z){if(this._pipelineContext=z,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let u=0;u<this._attributesNames.length;u++){const z=this._attributesNames[u];this._attributeLocationByName[z]=this._attributes[u]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),P.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this._pipelineContext;this._isReady=!1;try{const U=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),J=U?null:this.defines,v=U?this._vertexSourceCodeOverride:this._vertexSourceCode,f=U?this._fragmentSourceCodeOverride:this._fragmentSourceCode,w=this._engine;this._pipelineContext=(0,g.g)({existingPipelineContext:z?u:null,vertex:v,fragment:f,context:"WEBGL2"===w.shaderPlatformName||"WEBGL1"===w.shaderPlatformName?w._gl:void 0,rebuildRebind:(z,u,U,J)=>this._rebuildProgram(z,u,U,J),defines:J,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:U,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:U=>{u&&!z&&this._engine._deletePipelineContext(u),U&&this._onRenderingStateCompiled(U)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(u)}catch(U){this._processCompilationErrors(U,u)}}_getShaderCodeAndErrorLine(z,u,U){const J=U?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let v=null;if(u&&z){const f=u.match(J);if(f&&2===f.length){const u=parseInt(f[1]),J=z.split("\n",-1);J.length>=u&&(v="Offending line [".concat(u,"] in ").concat(U?"fragment":"vertex"," code: ").concat(J[u-1]))}}return[z,v]}_processCompilationErrors(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=z.message;const U=this._attributesNames,J=this._fallbacks;if(v.d.Error("Unable to compile effect:"),v.d.Error("Uniforms: ".concat(this._uniformsNames.join(" "))),v.d.Error("Attributes: ".concat(U.join(" "))),v.d.Error("Defines:\n"+this.defines),P.LogShaderCodeOnCompilationError){var f,g;let z=null,u=null,U=null;var w;if(null!==(f=this._pipelineContext)&&void 0!==f&&f._getVertexShaderCode()&&([U,z]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),U&&(v.d.Error("Vertex code:"),v.d.Error(U))),null!==(g=this._pipelineContext)&&void 0!==g&&g._getFragmentShaderCode())[U,u]=this._getShaderCodeAndErrorLine(null===(w=this._pipelineContext)||void 0===w?void 0:w._getFragmentShaderCode(),this._compilationError,!0),U&&(v.d.Error("Fragment code:"),v.d.Error(U));z&&v.d.Error(z),u&&v.d.Error(u)}v.d.Error("Error: "+this._compilationError);const R=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};u&&(this._pipelineContext=u,this._isReady=!0,R()),J?(this._pipelineContext=null,J.hasMoreFallbacks?(this._allFallbacksProcessed=!1,v.d.Error("Trying next fallback."),this.defines=J.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,R(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,u||R())}get isSupported(){return""===this._compilationError}_bindTexture(z,u){this._engine._bindTexture(this._samplers[z],u,z)}setTexture(z,u){this._engine.setTexture(this._samplers[z],this._uniforms[z],u,z)}setTextureArray(z,u){const U=z+"Ex";if(-1===this._samplerList.indexOf(U+"0")){const J=this._samplerList.indexOf(z);for(let z=1;z<u.length;z++){const u=U+(z-1).toString();this._samplerList.splice(J+z,0,u)}let v=0;for(const z of this._samplerList)this._samplers[z]=v,v+=1}this._engine.setTextureArray(this._samplers[z],this._uniforms[z],u,z)}bindUniformBuffer(z,u){const U=this._uniformBuffersNames[u];void 0===U||P._BaseCache[U]===z&&this._engine._features.useUBOBindingCache||(P._BaseCache[U]=z,this._engine.bindUniformBufferBase(z,U,u))}bindUniformBlock(z,u){this._engine.bindUniformBlock(this._pipelineContext,z,u)}setInt(z,u){return this._pipelineContext.setInt(z,u),this}setInt2(z,u,U){return this._pipelineContext.setInt2(z,u,U),this}setInt3(z,u,U,J){return this._pipelineContext.setInt3(z,u,U,J),this}setInt4(z,u,U,J,v){return this._pipelineContext.setInt4(z,u,U,J,v),this}setIntArray(z,u){return this._pipelineContext.setIntArray(z,u),this}setIntArray2(z,u){return this._pipelineContext.setIntArray2(z,u),this}setIntArray3(z,u){return this._pipelineContext.setIntArray3(z,u),this}setIntArray4(z,u){return this._pipelineContext.setIntArray4(z,u),this}setUInt(z,u){return this._pipelineContext.setUInt(z,u),this}setUInt2(z,u,U){return this._pipelineContext.setUInt2(z,u,U),this}setUInt3(z,u,U,J){return this._pipelineContext.setUInt3(z,u,U,J),this}setUInt4(z,u,U,J,v){return this._pipelineContext.setUInt4(z,u,U,J,v),this}setUIntArray(z,u){return this._pipelineContext.setUIntArray(z,u),this}setUIntArray2(z,u){return this._pipelineContext.setUIntArray2(z,u),this}setUIntArray3(z,u){return this._pipelineContext.setUIntArray3(z,u),this}setUIntArray4(z,u){return this._pipelineContext.setUIntArray4(z,u),this}setFloatArray(z,u){return this._pipelineContext.setArray(z,u),this}setFloatArray2(z,u){return this._pipelineContext.setArray2(z,u),this}setFloatArray3(z,u){return this._pipelineContext.setArray3(z,u),this}setFloatArray4(z,u){return this._pipelineContext.setArray4(z,u),this}setArray(z,u){return this._pipelineContext.setArray(z,u),this}setArray2(z,u){return this._pipelineContext.setArray2(z,u),this}setArray3(z,u){return this._pipelineContext.setArray3(z,u),this}setArray4(z,u){return this._pipelineContext.setArray4(z,u),this}setMatrices(z,u){return this._pipelineContext.setMatrices(z,u),this}setMatrix(z,u){return this._pipelineContext.setMatrix(z,u),this}setMatrix3x3(z,u){return this._pipelineContext.setMatrix3x3(z,u),this}setMatrix2x2(z,u){return this._pipelineContext.setMatrix2x2(z,u),this}setFloat(z,u){return this._pipelineContext.setFloat(z,u),this}setBool(z,u){return this._pipelineContext.setInt(z,u?1:0),this}setVector2(z,u){return this._pipelineContext.setVector2(z,u),this}setFloat2(z,u,U){return this._pipelineContext.setFloat2(z,u,U),this}setVector3(z,u){return this._pipelineContext.setVector3(z,u),this}setFloat3(z,u,U,J){return this._pipelineContext.setFloat3(z,u,U,J),this}setVector4(z,u){return this._pipelineContext.setVector4(z,u),this}setQuaternion(z,u){return this._pipelineContext.setQuaternion(z,u),this}setFloat4(z,u,U,J,v){return this._pipelineContext.setFloat4(z,u,U,J,v),this}setColor3(z,u){return this._pipelineContext.setColor3(z,u),this}setColor4(z,u,U){return this._pipelineContext.setColor4(z,u,U),this}setDirectColor4(z,u){return this._pipelineContext.setDirectColor4(z,u),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(P.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,g.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;u&&(f.d.GetShadersStore(J)["".concat(z,"PixelShader")]=u),U&&(f.d.GetShadersStore(J)["".concat(z,"VertexShader")]=U)}static ResetCache(){P._BaseCache={}}}P.LogShaderCodeOnCompilationError=!0,P.PersistentMode=!1,P.AutomaticallyClearCodeCache=!1,P._UniqueIdSeed=0,P._BaseCache={},P.ShadersStore=f.d.ShadersStore,P.IncludesShadersStore=f.d.IncludesShadersStore},12782:(z,u,U)=>{U.d(u,{c:()=>v});const J={};function v(z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!J[z])return J[z]=!0,"".concat(z," needs to be imported before as it contains a side-effect required by your code.")}},12758:(z,u,U)=>{function J(){return"undefined"!==typeof window}function v(){return"undefined"!==typeof navigator}function f(){return"undefined"!==typeof document}function g(z){let u="",U=z.firstChild;for(;U;)3===U.nodeType&&(u+=U.textContent),U=U.nextSibling;return u}U.d(u,{b:()=>g,d:()=>f,g:()=>v,i:()=>J})},12760:(z,u,U)=>{U.d(u,{d:()=>J});class J{static _CheckLimit(z,u){let U=J._LogLimitOutputs[z];return U?U.current++:(U={limit:u,current:1},J._LogLimitOutputs[z]=U),U.current<=U.limit}static _GenerateLimitMessage(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const U=J._LogLimitOutputs[z];if(!U||!J.MessageLimitReached)return;const v=this._Levels[u];var f;U.current===U.limit&&J[v.name](J.MessageLimitReached.replace(/%LIMIT%/g,""+U.limit).replace(/%TYPE%/g,null!==(f=v.name)&&void 0!==f?f:""))}static _AddLogEntry(z){J._LogCache=z+J._LogCache,J.OnNewCacheEntry&&J.OnNewCacheEntry(z)}static _FormatMessage(z){const u=z=>z<10?"0"+z:""+z,U=new Date;return"["+u(U.getHours())+":"+u(U.getMinutes())+":"+u(U.getSeconds())+"]: "+z}static _LogDisabled(z,u){}static _LogEnabled(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;const v=Array.isArray(u)?u[0]:u;if(void 0!==U&&!J._CheckLimit(v,U))return;const f=J._FormatMessage(v),g=this._Levels[z],w=Array.isArray(u)?u.slice(1):[];g.logFunc&&g.logFunc("BJS - "+f,...w);const P="<div style='color:".concat(g.color,"'>").concat(f,"</div><br>");J._AddLogEntry(P),J._GenerateLimitMessage(v,z)}static get LogCache(){return J._LogCache}static ClearLogCache(){J._LogCache="",J._LogLimitOutputs={},J.errorsCount=0}static set LogLevels(z){J.Log=J._LogDisabled,J.Warn=J._LogDisabled,J.Error=J._LogDisabled;const u=[J.MessageLogLevel,J.WarningLogLevel,J.ErrorLogLevel];for(const U of u)if((z&U)===U){const z=this._Levels[U];J[z.name]=J._LogEnabled.bind(J,U)}}}J.NoneLogLevel=0,J.MessageLogLevel=1,J.WarningLogLevel=2,J.ErrorLogLevel=4,J.AllLogLevel=7,J.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",J._LogCache="",J._LogLimitOutputs={},J._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],J.errorsCount=0,J.Log=J._LogEnabled.bind(J,J.MessageLogLevel),J.Warn=J._LogEnabled.bind(J,J.WarningLogLevel),J.Error=J._LogEnabled.bind(J,J.ErrorLogLevel)},12756:(z,u,U)=>{U.d(u,{e:()=>g});const J="undefined"!==typeof WeakRef;class v{constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.initialize(z,u,U,J)}initialize(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;return this.mask=z,this.skipNextObservers=u,this.target=U,this.currentTarget=J,this}}class f{constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=z,this.mask=u,this.scope=U,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(z)}}class g{static FromPromise(z,u){const U=new g;return z.then((z=>{U.notifyObservers(z)})).catch((z=>{if(!u)throw z;u.notifyObservers(z)})),U}get observers(){return this._observers}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=u,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new v(0),z&&(this._onObserverAdded=z)}add(z){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!z)return null;const v=new f(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);v.unregisterOnNextCall=U,u?this._observers.unshift(v):this._observers.push(v),this._onObserverAdded&&this._onObserverAdded(v),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(v,this._lastNotifiedValue);const g=J?new WeakRef(this):{deref:()=>this};return v._remove=function(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=g.deref();u&&(z?u.remove(v):u._remove(v))},v}addOnce(z){return this.add(z,void 0,void 0,void 0,!0)}remove(z){if(!z)return!1;z._remove=null;return-1!==this._observers.indexOf(z)&&(this._deferUnregister(z),!0)}removeCallback(z,u){for(let U=0;U<this._observers.length;U++){const J=this._observers[U];if(!J._willBeUnregistered&&(J.callback===z&&(!u||u===J.scope)))return this._deferUnregister(J),!0}return!1}_deferUnregister(z){z._willBeUnregistered||(this._numObserversMarkedAsDeleted++,z.unregisterOnNextCall=!1,z._willBeUnregistered=!0,setTimeout((()=>{this._remove(z)}),0))}_remove(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!z)return!1;const U=this._observers.indexOf(z);return-1!==U&&(u&&this._numObserversMarkedAsDeleted--,this._observers.splice(U,1),!0)}makeObserverTopPriority(z){this._remove(z,!1),this._observers.unshift(z)}makeObserverBottomPriority(z){this._remove(z,!1),this._observers.push(z)}notifyObservers(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=z),!this._observers.length)return!0;const f=this._eventState;f.mask=u,f.target=U,f.currentTarget=J,f.skipNextObservers=!1,f.lastReturnValue=z,f.userInfo=v;for(const g of this._observers)if(!g._willBeUnregistered&&(g.mask&u&&(g.unregisterOnNextCall&&this._deferUnregister(g),g.scope?f.lastReturnValue=g.callback.apply(g.scope,[z,f]):f.lastReturnValue=g.callback(z,f)),f.skipNextObservers))return!1;return!0}notifyObserver(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),z._willBeUnregistered)return;const J=this._eventState;J.mask=U,J.skipNextObservers=!1,z.unregisterOnNextCall&&this._deferUnregister(z),z.callback(u,J)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const z=this._observers.pop();z&&(z._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const z=new g;return z._observers=this._observers.slice(0),z}hasSpecificMask(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const u of this._observers)if(u.mask&z||u.mask===z)return!0;return!1}}},12825:(z,u,U)=>{U.d(u,{b:()=>v,e:()=>g});let J=[];class v{static SetImmediate(z){0===J.length&&setTimeout((()=>{const z=J;J=[];for(const u of z)u()}),1),J.push(z)}}function f(z,u,U){try{if(z())return u(),!0}catch(J){return null===U||void 0===U||U(J),!0}return!1}const g=function(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,g=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&f(z,u,U))return null;const w=setInterval((()=>{f(z,u,U)?clearInterval(w):(v-=J,v<0&&(clearInterval(w),null===U||void 0===U||U(new Error("Operation timed out after maximum retries. "+(g||"")),!0)))}),J);return()=>clearInterval(w)}}}]);