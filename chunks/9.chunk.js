"use strict";(self.k9ivgwsw3f=self.k9ivgwsw3f||[]).push([[9],{12722:(Y,b,C)=>{C.d(b,{d:()=>c,g:()=>L,m:()=>u,j:()=>z,p:()=>J});class R{constructor(){this.children=[]}isValid(Y){return!0}process(Y,b,C){let R="";if(this.line){let C=this.line;const O=b.processor;if(O){var q,A,E,B,g,r;O.lineProcessor&&(C=O.lineProcessor(C,b.isFragment,b.processingContext));const R=(null===(q=b.processor)||void 0===q?void 0:q.attributeKeywordName)??"attribute",F=b.isFragment&&null!==(A=b.processor)&&void 0!==A&&A.varyingFragmentKeywordName?null===(E=b.processor)||void 0===E?void 0:E.varyingFragmentKeywordName:!b.isFragment&&null!==(B=b.processor)&&void 0!==B&&B.varyingVertexKeywordName?null===(g=b.processor)||void 0===g?void 0:g.varyingVertexKeywordName:"varying";if(!b.isFragment&&O.attributeProcessor&&this.line.startsWith(R))C=O.attributeProcessor(this.line,Y,b.processingContext);else if(O.varyingProcessor&&(null!==(r=O.varyingCheck)&&void 0!==r&&r.call(O,this.line,b.isFragment)||!O.varyingCheck&&this.line.startsWith(F)))C=O.varyingProcessor(this.line,b.isFragment,Y,b.processingContext);else if(O.uniformProcessor&&O.uniformRegexp&&O.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(C=O.uniformProcessor(this.line,b.isFragment,Y,b.processingContext));else if(O.uniformBufferProcessor&&O.uniformBufferRegexp&&O.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(C=O.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(O.textureProcessor&&O.textureRegexp&&O.textureRegexp.test(this.line))C=O.textureProcessor(this.line,b.isFragment,Y,b.processingContext);else if((O.uniformProcessor||O.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?O.uniformProcessor&&(C=O.uniformProcessor(this.line,b.isFragment,Y,b.processingContext)):O.uniformBufferProcessor&&(C=O.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,O.endOfUniformBufferProcessor&&(C=O.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}R+=C+"\n"}for(const O of this.children)R+=O.process(Y,b,C);return this.additionalDefineKey&&(Y[this.additionalDefineKey]=this.additionalDefineValue||"true",C[this.additionalDefineKey]=Y[this.additionalDefineKey]),R}}class q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(Y){this._lines.length=0;for(const b of Y){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const Y=b.trim();if(!Y)continue;if(Y.startsWith("//")){this._lines.push(b);continue}const C=Y.indexOf(";");if(-1===C)this._lines.push(Y);else if(C===Y.length-1)Y.length>1&&this._lines.push(Y);else{const Y=b.split(";");for(let b=0;b<Y.length;b++){let C=Y[b];C&&(C=C.trim(),C&&this._lines.push(C+(b!==Y.length-1?";":"")))}}}}}class A extends R{process(Y,b,C){for(let R=0;R<this.children.length;R++){const q=this.children[R];if(q.isValid(Y))return q.process(Y,b,C)}return""}}class E extends R{isValid(Y){return this.testExpression.isTrue(Y)}}class B{isTrue(Y){return!0}static postfixToInfix(Y){const b=[];for(const C of Y)if(void 0===B._OperatorPriority[C])b.push(C);else{const Y=b[b.length-1],R=b[b.length-2];b.length-=2,b.push(`(${R}${C}${Y})`)}return b[b.length-1]}static infixToPostfix(Y){const b=B._InfixToPostfixCache.get(Y);if(b)return b.accessTime=Date.now(),b.result;if(!Y.includes("&&")&&!Y.includes("||")&&!Y.includes(")")&&!Y.includes("("))return[Y];const C=[];let R=-1;const q=()=>{O=O.trim(),""!==O&&(C.push(O),O="")},A=Y=>{R<B._Stack.length-1&&(B._Stack[++R]=Y)},E=()=>B._Stack[R],g=()=>-1===R?"!!INVALID EXPRESSION!!":B._Stack[R--];let r=0,O="";for(;r<Y.length;){const b=Y.charAt(r),F=r<Y.length-1?Y.substring(r,2+r):"";if("("===b)O="",A(b);else if(")"===b){for(q();-1!==R&&"("!==E();)C.push(g());g()}else if(B._OperatorPriority[F]>1){for(q();-1!==R&&B._OperatorPriority[E()]>=B._OperatorPriority[F];)C.push(g());A(F),r++}else O+=b;r++}for(q();-1!==R;)"("===E()?g():C.push(g());return B._InfixToPostfixCache.size>=B.InfixToPostfixCacheLimitSize&&B.ClearCache(),B._InfixToPostfixCache.set(Y,{result:C,accessTime:Date.now()}),C}static ClearCache(){const Y=Array.from(B._InfixToPostfixCache.entries()).sort(((Y,b)=>Y[1].accessTime-b[1].accessTime));for(let b=0;b<B.InfixToPostfixCacheCleanupSize;b++)B._InfixToPostfixCache.delete(Y[b][0])}}B.InfixToPostfixCacheLimitSize=5e4,B.InfixToPostfixCacheCleanupSize=25e3,B._InfixToPostfixCache=new Map,B._OperatorPriority={")":0,"(":1,"||":2,"&&":3},B._Stack=["","","","","","","","","","","","","","","","","","","",""];class g extends B{constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=Y,this.not=b}isTrue(Y){let b=void 0!==Y[this.define];return this.not&&(b=!b),b}}class r extends B{isTrue(Y){return this.leftOperand.isTrue(Y)||this.rightOperand.isTrue(Y)}}class O extends B{isTrue(Y){return this.leftOperand.isTrue(Y)&&this.rightOperand.isTrue(Y)}}class F extends B{constructor(Y,b,C){super(),this.define=Y,this.operand=b,this.testValue=C}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(Y){let b=!1;const C=parseInt(void 0!=Y[this.define]?Y[this.define]:this.define),R=parseInt(void 0!=Y[this.testValue]?Y[this.testValue]:this.testValue);if(isNaN(C)||isNaN(R))return!1;switch(this.operand){case">":b=C>R;break;case"<":b=C<R;break;case"<=":b=C<=R;break;case">=":b=C>=R;break;case"==":b=C===R;break;case"!=":b=C!==R}return b}}var y=C(12687),S=C(12724);const n=/defined\s*?\((.+?)\)/g,t=/defined\s*?\[(.+?)\]/g,I=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,w=/__decl__/,Q=/light\{X\}.(\w*)/g,N=/\{X\}/g,p=[],mY=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function L(Y){Y.processor&&Y.processor.initializeShaders&&Y.processor.initializeShaders(Y.processingContext)}function u(Y,b,C,R){var q;null!==(q=b.processor)&&void 0!==q&&q.preProcessShaderCode&&(Y=b.processor.preProcessShaderCode(Y,b.isFragment)),z(Y,b,(Y=>{b.processCodeAfterIncludes&&(Y=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",Y,b.defines));const q=function(Y,b,C){let R=function(Y,b){var C;if(null!==(C=b.processor)&&void 0!==C&&C.noPrecision)return Y;const R=b.shouldUseHighPrecisionShader;-1===Y.indexOf("precision highp float")?Y=R?"precision highp float;\n"+Y:"precision mediump float;\n"+Y:R||(Y=Y.replace("precision highp float","precision mediump float"));return Y}(Y,b);if(!b.processor)return R;if(0===b.processor.shaderLanguage&&-1!==R.indexOf("#version 3")&&(R=R.replace("#version 300 es",""),!b.processor.parseGLES3))return R;const q=b.defines,A=v(b,C);b.processor.preProcessor&&(R=b.processor.preProcessor(R,q,A,b.isFragment,b.processingContext));const E={};R=P(R,A,b,E),b.processor.postProcessor&&(R=b.processor.postProcessor(R,q,b.isFragment,b.processingContext,C?{drawBuffersExtensionDisabled:!C.getCaps().drawBuffersExtension}:{},A,E));null!==C&&void 0!==C&&C._features.needShaderCodeInlining&&(R=C.inlineShaderCode(R));return R}(Y,b,R);C(q,Y)}))}function c(Y,b,C){return C.processor&&C.processor.finalizeShaders?C.processor.finalizeShaders(Y,b,C.processingContext):{vertexCode:Y,fragmentCode:b}}function l(Y){const b=/defined\((.+)\)/.exec(Y);if(b&&b.length)return new g(b[1].trim(),"!"===Y[0]);const C=["==","!=",">=","<=","<",">"];let R="",q=0;for(R of C)if(q=Y.indexOf(R),q>-1)break;if(-1===q)return new g(Y);const A=Y.substring(0,q).trim(),E=Y.substring(q+R.length).trim();return new F(A,R,E)}function X(Y,b){const C=new E,R=Y.substring(0,b);let q=Y.substring(b);return q=q.substring(0,(q.indexOf("//")+1||q.length+1)-1).trim(),C.testExpression="#ifdef"===R?new g(q):"#ifndef"===R?new g(q,!0):function(Y){Y=Y.replace(n,"defined[$1]");const b=B.infixToPostfix(Y),C=[];for(const q of b)if("||"!==q&&"&&"!==q)C.push(q);else if(C.length>=2){let Y=C[C.length-1],b=C[C.length-2];C.length-=2;const R="&&"==q?new O:new r;"string"===typeof Y&&(Y=Y.replace(t,"defined($1)")),"string"===typeof b&&(b=b.replace(t,"defined($1)")),R.leftOperand="string"===typeof b?l(b):b,R.rightOperand="string"===typeof Y?l(Y):Y,C.push(R)}let R=C[C.length-1];return"string"===typeof R&&(R=R.replace(t,"defined($1)")),"string"===typeof R?l(R):R}(q),C}function j(Y,b,C,q){let A=Y.currentLine;for(;T(Y,C,q);){A=Y.currentLine;const E=A.substring(0,5).toLowerCase();if("#else"===E){const C=new R;return b.children.push(C),void T(Y,C,q)}if("#elif"===E){const Y=X(A,5);b.children.push(Y),C=Y}}}function T(Y,b,C){for(;Y.canRead;){Y.lineIndex++;const q=Y.currentLine;if(q.indexOf("#")>=0){const R=mY.exec(q);if(R&&R.length){switch(R[0]){case"#ifdef":{const R=new A;b.children.push(R);const E=X(q,6);R.children.push(E),j(Y,R,E,C);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const R=new A;b.children.push(R);const E=X(q,7);R.children.push(E),j(Y,R,E,C);break}case"#if":{const R=new A,E=X(q,3);b.children.push(R),R.children.push(E),j(Y,R,E,C);break}}continue}}const E=new R;if(E.line=q,b.children.push(E),"#"===q[0]&&"d"===q[1]){const Y=q.replace(";","").split(" ");E.additionalDefineKey=Y[1],3===Y.length&&(E.additionalDefineValue=Y[2])}}return!1}function P(Y,b,C,A){const E=new R,B=new q;return B.lineIndex=-1,B.lines=Y.split("\n"),T(B,E,A),E.process(b,C,A)}function v(Y,b){var C;const R=Y.defines,q={};for(const A of R){const Y=A.replace("#define","").replace(";","").trim().split(" ");q[Y[0]]=Y.length>1?Y[1]:""}return 0===(null===(C=Y.processor)||void 0===C?void 0:C.shaderLanguage)&&(q.GL_ES="true"),q.__VERSION__=Y.version,q[Y.platformName]="true",(0,S.h)(q,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.o,null===b||void 0===b?void 0:b.useExactSrgbConversions),q}function z(Y,b,C){let R;for(p.length=0;null!==(R=I.exec(Y));)p.push(R);let q=String(Y),A=[Y],E=!1;for(const B of p){let Y=B[1];if(-1!==Y.indexOf("__decl__")&&(Y=Y.replace(w,""),b.supportsUniformBuffers&&(Y=Y.replace("Vertex","Ubo").replace("Fragment","Ubo")),Y+="Declaration"),!b.includesShadersStore[Y]){const R=b.shadersRepository+"ShadersInclude/"+Y+".fx";return void J.loadFile(R,(R=>{b.includesShadersStore[Y]=R,z(A.join(""),b,C)}))}{let C=b.includesShadersStore[Y];if(B[2]){const Y=B[3].split(",");for(let b=0;b<Y.length;b+=2){const R=new RegExp(Y[b],"g"),q=Y[b+1];C=C.replace(R,q)}}if(B[4]){const Y=B[5];if(-1!==Y.indexOf("..")){const R=Y.split(".."),q=parseInt(R[0]);let A=parseInt(R[1]),E=C.slice(0);C="",isNaN(A)&&(A=b.indexParameters[R[1]]);for(let Y=q;Y<A;Y++)b.supportsUniformBuffers||(E=E.replace(Q,((Y,b)=>b+"{X}"))),C+=E.replace(N,Y.toString())+"\n"}else b.supportsUniformBuffers||(C=C.replace(Q,((Y,b)=>b+"{X}"))),C=C.replace(N,Y)}const R=[];for(const Y of A){const b=Y.split(B[0]);for(let Y=0;Y<b.length-1;Y++)R.push(b[Y]),R.push(C);R.push(b[b.length-1])}A=R,E=E||C.indexOf("#include<")>=0||C.indexOf("#include <")>=0}}p.length=0,q=A.join(""),E?z(q.toString(),b,C):C(q)}const J={loadFile:(Y,b,C,R,q,A)=>{throw(0,y.d)("FileTools")}}},12724:(Y,b,C)=>{C.d(b,{b:()=>q,d:()=>A,h:()=>B,k:()=>E,l:()=>g});var R=C(12687);C(12660);const q={};function A(Y,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+Y}function E(Y,b,C,A,E,B,g){const r=g||q.loadFile;if(r){return r(Y,b,C,A,E,B)}throw(0,R.d)("FileTools")}function B(Y,b,C,R){if(Y)return b?Y.IS_NDC_HALF_ZRANGE="":delete Y.IS_NDC_HALF_ZRANGE,C?Y.USE_REVERSE_DEPTHBUFFER="":delete Y.USE_REVERSE_DEPTHBUFFER,void(R?Y.USE_EXACT_SRGB_CONVERSIONS="":delete Y.USE_EXACT_SRGB_CONVERSIONS);{let Y="";return b&&(Y+="#define IS_NDC_HALF_ZRANGE"),C&&(Y&&(Y+="\n"),Y+="#define USE_REVERSE_DEPTHBUFFER"),R&&(Y&&(Y+="\n"),Y+="#define USE_EXACT_SRGB_CONVERSIONS"),Y}}function g(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3?arguments[3]:void 0;switch(Y){case 3:{const Y=(ArrayBuffer,new Int8Array(b));return R&&Y.set(new Int8Array(R)),Y}case 0:{const Y=(ArrayBuffer,new Uint8Array(b));return R&&Y.set(new Uint8Array(R)),Y}case 4:{const Y=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(C?b/2:b);return R&&Y.set(new Int16Array(R)),Y}case 5:case 8:case 9:case 10:case 2:{const Y=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(C?b/2:b);return R&&Y.set(new Uint16Array(R)),Y}case 6:{const Y=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(C?b/4:b);return R&&Y.set(new Int32Array(R)),Y}case 7:case 11:case 12:case 13:case 14:case 15:{const Y=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(C?b/4:b);return R&&Y.set(new Uint32Array(R)),Y}case 1:{const Y=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(C?b/4:b);return R&&Y.set(new Float32Array(R)),Y}}const q=(ArrayBuffer,new Uint8Array(b));return R&&q.set(new Uint8Array(R)),q}},12747:(Y,b,C)=>{C.d(b,{b:()=>R});class R{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?R.ShadersRepository:R.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?R.ShadersStore:R.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?R.IncludesShadersStore:R.IncludesShadersStoreWGSL}}R.ShadersRepository="src/Shaders/",R.ShadersStore={},R.IncludesShadersStore={},R.ShadersRepositoryWGSL="src/ShadersWGSL/",R.ShadersStoreWGSL={},R.IncludesShadersStoreWGSL={}},12756:(Y,b,C)=>{C.d(b,{e:()=>y,f:()=>N,j:()=>n,k:()=>S,o:()=>t,r:()=>Q,v:()=>F,x:()=>r,B:()=>O,C:()=>g,G:()=>B});class R{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.qC._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(Y){Y&&this.program&&Y(this.program)}setEngine(Y){this.qC=Y}_fillEffectInformation(Y,b,C,R,q,A,E,B){const g=this.qC;if(g.supportsUniformBuffers)for(const O in b)Y.bindUniformBlock(O,b[O]);let r;for(this.qC.getUniforms(this,C).forEach(((Y,b)=>{R[C[b]]=Y})),this._uniforms=R,r=0;r<q.length;r++){null==Y.getUniform(q[r])&&(q.splice(r,1),r--)}q.forEach(((Y,b)=>{A[Y]=b}));for(const O of g.getAttributes(this,E))B.push(O)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(Y,b){const C=this._valueCache[Y],R=b.updateFlag;return(void 0===C||C!==R)&&(this._valueCache[Y]=R,!0)}_cacheFloat2(Y,b,C){let R=this._valueCache[Y];if(!R||2!==R.length)return R=[b,C],this._valueCache[Y]=R,!0;let q=!1;return R[0]!==b&&(R[0]=b,q=!0),R[1]!==C&&(R[1]=C,q=!0),q}_cacheFloat3(Y,b,C,R){let q=this._valueCache[Y];if(!q||3!==q.length)return q=[b,C,R],this._valueCache[Y]=q,!0;let A=!1;return q[0]!==b&&(q[0]=b,A=!0),q[1]!==C&&(q[1]=C,A=!0),q[2]!==R&&(q[2]=R,A=!0),A}_cacheFloat4(Y,b,C,R,q){let A=this._valueCache[Y];if(!A||4!==A.length)return A=[b,C,R,q],this._valueCache[Y]=A,!0;let E=!1;return A[0]!==b&&(A[0]=b,E=!0),A[1]!==C&&(A[1]=C,E=!0),A[2]!==R&&(A[2]=R,E=!0),A[3]!==q&&(A[3]=q,E=!0),E}setInt(Y,b){const C=this._valueCache[Y];void 0!==C&&C===b||this.qC.setInt(this._uniforms[Y],b)&&(this._valueCache[Y]=b)}setInt2(Y,b,C){this._cacheFloat2(Y,b,C)&&(this.qC.setInt2(this._uniforms[Y],b,C)||(this._valueCache[Y]=null))}setInt3(Y,b,C,R){this._cacheFloat3(Y,b,C,R)&&(this.qC.setInt3(this._uniforms[Y],b,C,R)||(this._valueCache[Y]=null))}setInt4(Y,b,C,R,q){this._cacheFloat4(Y,b,C,R,q)&&(this.qC.setInt4(this._uniforms[Y],b,C,R,q)||(this._valueCache[Y]=null))}setIntArray(Y,b){this._valueCache[Y]=null,this.qC.setIntArray(this._uniforms[Y],b)}setIntArray2(Y,b){this._valueCache[Y]=null,this.qC.setIntArray2(this._uniforms[Y],b)}setIntArray3(Y,b){this._valueCache[Y]=null,this.qC.setIntArray3(this._uniforms[Y],b)}setIntArray4(Y,b){this._valueCache[Y]=null,this.qC.setIntArray4(this._uniforms[Y],b)}setUInt(Y,b){const C=this._valueCache[Y];void 0!==C&&C===b||this.qC.setUInt(this._uniforms[Y],b)&&(this._valueCache[Y]=b)}setUInt2(Y,b,C){this._cacheFloat2(Y,b,C)&&(this.qC.setUInt2(this._uniforms[Y],b,C)||(this._valueCache[Y]=null))}setUInt3(Y,b,C,R){this._cacheFloat3(Y,b,C,R)&&(this.qC.setUInt3(this._uniforms[Y],b,C,R)||(this._valueCache[Y]=null))}setUInt4(Y,b,C,R,q){this._cacheFloat4(Y,b,C,R,q)&&(this.qC.setUInt4(this._uniforms[Y],b,C,R,q)||(this._valueCache[Y]=null))}setUIntArray(Y,b){this._valueCache[Y]=null,this.qC.setUIntArray(this._uniforms[Y],b)}setUIntArray2(Y,b){this._valueCache[Y]=null,this.qC.setUIntArray2(this._uniforms[Y],b)}setUIntArray3(Y,b){this._valueCache[Y]=null,this.qC.setUIntArray3(this._uniforms[Y],b)}setUIntArray4(Y,b){this._valueCache[Y]=null,this.qC.setUIntArray4(this._uniforms[Y],b)}setArray(Y,b){this._valueCache[Y]=null,this.qC.setArray(this._uniforms[Y],b)}setArray2(Y,b){this._valueCache[Y]=null,this.qC.setArray2(this._uniforms[Y],b)}setArray3(Y,b){this._valueCache[Y]=null,this.qC.setArray3(this._uniforms[Y],b)}setArray4(Y,b){this._valueCache[Y]=null,this.qC.setArray4(this._uniforms[Y],b)}setMatrices(Y,b){b&&(this._valueCache[Y]=null,this.qC.setMatrices(this._uniforms[Y],b))}setMatrix(Y,b){this._cacheMatrix(Y,b)&&(this.qC.setMatrices(this._uniforms[Y],b.cb())||(this._valueCache[Y]=null))}setMatrix3x3(Y,b){this._valueCache[Y]=null,this.qC.setMatrix3x3(this._uniforms[Y],b)}setMatrix2x2(Y,b){this._valueCache[Y]=null,this.qC.setMatrix2x2(this._uniforms[Y],b)}setFloat(Y,b){const C=this._valueCache[Y];void 0!==C&&C===b||this.qC.setFloat(this._uniforms[Y],b)&&(this._valueCache[Y]=b)}setVector2(Y,b){this._cacheFloat2(Y,b.x,b.y)&&(this.qC.setFloat2(this._uniforms[Y],b.x,b.y)||(this._valueCache[Y]=null))}setFloat2(Y,b,C){this._cacheFloat2(Y,b,C)&&(this.qC.setFloat2(this._uniforms[Y],b,C)||(this._valueCache[Y]=null))}setVector3(Y,b){this._cacheFloat3(Y,b.x,b.y,b.z)&&(this.qC.setFloat3(this._uniforms[Y],b.x,b.y,b.z)||(this._valueCache[Y]=null))}setFloat3(Y,b,C,R){this._cacheFloat3(Y,b,C,R)&&(this.qC.setFloat3(this._uniforms[Y],b,C,R)||(this._valueCache[Y]=null))}setVector4(Y,b){this._cacheFloat4(Y,b.x,b.y,b.z,b.w)&&(this.qC.setFloat4(this._uniforms[Y],b.x,b.y,b.z,b.w)||(this._valueCache[Y]=null))}setQuaternion(Y,b){this._cacheFloat4(Y,b.x,b.y,b.z,b.w)&&(this.qC.setFloat4(this._uniforms[Y],b.x,b.y,b.z,b.w)||(this._valueCache[Y]=null))}setFloat4(Y,b,C,R,q){this._cacheFloat4(Y,b,C,R,q)&&(this.qC.setFloat4(this._uniforms[Y],b,C,R,q)||(this._valueCache[Y]=null))}setColor3(Y,b){this._cacheFloat3(Y,b.r,b.g,b.b)&&(this.qC.setFloat3(this._uniforms[Y],b.r,b.g,b.b)||(this._valueCache[Y]=null))}setColor4(Y,b,C){this._cacheFloat4(Y,b.r,b.g,b.b,C)&&(this.qC.setFloat4(this._uniforms[Y],b.r,b.g,b.b,C)||(this._valueCache[Y]=null))}setDirectColor4(Y,b){this._cacheFloat4(Y,b.r,b.g,b.b,b.a)&&(this.qC.setFloat4(this._uniforms[Y],b.r,b.g,b.b,b.a)||(this._valueCache[Y]=null))}_getVertexShaderCode(){return this.vertexShader?this.qC._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.qC._getShaderSource(this.fragmentShader):null}}var q=C(12724);const A=new WeakMap,E={_webGLVersion:2,cachedPipelines:{}};function B(Y){let b=A.get(Y);if(!b){if(!Y)return E;b={_webGLVersion:Y.TEXTURE_BINDING_3D?2:1,_context:Y,parallelShaderCompile:Y.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},A.set(Y,b)}return b}function g(Y){A.delete(Y)}function r(Y,b,C,R,q,A){const E=B(R);A||(A=E._createShaderProgramInjection??y);return A(Y,w(b,"vertex",R,E._contextWasLost),w(C,"fragment",R,E._contextWasLost),R,q,E.validateShaderPrograms)}function O(Y,b,C,R,q){let A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,E=arguments.length>6?arguments[6]:void 0;const g=B(q);E||(E=g._createShaderProgramInjection??y);const r=g._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return E(Y,I(b,"vertex",R,r,q,g._contextWasLost),I(C,"fragment",R,r,q,g._contextWasLost),q,A,g.validateShaderPrograms)}function F(Y,b){const C=new R,q=B(Y);return q.parallelShaderCompile&&!q.disableParallelShaderCompile&&(C.isParallelCompiled=!0),C.context=q._context,C}function y(Y,b,C,R){let q=arguments.length>5?arguments[5]:void 0;const A=R.createProgram();if(Y.program=A,!A)throw new Error("Unable to create program");return R.attachShader(A,b),R.attachShader(A,C),R.linkProgram(A),Y.context=R,Y.vertexShader=b,Y.fragmentShader=C,Y.isParallelCompiled||n(Y,R,q),A}function S(Y,b,C){const R=Y;if(R._isDisposed)return!1;const q=B(b);return!!(q&&q.parallelShaderCompile&&q.parallelShaderCompile.COMPLETION_STATUS_KHR&&R.program&&b.getProgramParameter(R.program,q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(n(R,b,C),!0)}function n(Y,b,C){const R=Y.context,q=Y.vertexShader,A=Y.fragmentShader,E=Y.program;if(!R.getProgramParameter(E,R.LINK_STATUS)){if(!b.getShaderParameter(q,b.COMPILE_STATUS)){const C=b.getShaderInfoLog(q);if(C)throw Y.vertexCompilationError=C,new Error("VERTEX SHADER "+C)}if(!b.getShaderParameter(A,b.COMPILE_STATUS)){const C=b.getShaderInfoLog(A);if(C)throw Y.fragmentCompilationError=C,new Error("FRAGMENT SHADER "+C)}const C=R.getProgramInfoLog(E);if(C)throw Y.programLinkError=C,new Error(C)}if(C){R.validateProgram(E);if(!R.getProgramParameter(E,R.VALIDATE_STATUS)){const b=R.getProgramInfoLog(E);if(b)throw Y.programValidationError=b,new Error(b)}}R.deleteShader(q),R.deleteShader(A),Y.vertexShader=void 0,Y.fragmentShader=void 0,Y.onCompiled&&(Y.onCompiled(),Y.onCompiled=void 0)}function t(Y,b,C,R,q,A,E,g,F){let y=arguments.length>10?arguments[10]:void 0,S=arguments.length>11?arguments[11]:void 0,n=arguments.length>12?arguments[12]:void 0;const t=B(Y.context);S||(S=t.createRawShaderProgramInjection??r),n||(n=t.createShaderProgramInjection??O);const I=Y;I.program=R?S(I,b,C,I.context,F):n(I,b,C,g,I.context,F),I.program.__SPECTOR_rebuildProgram=E,y()}function I(Y,b,C,R,A,E){return w((0,q.d)(Y,C,R),b,A,E)}function w(Y,b,C,R){const q=C.createShader("vertex"===b?C.VERTEX_SHADER:C.FRAGMENT_SHADER);if(!q){let Y=C.NO_ERROR,q=C.NO_ERROR;for(;(q=C.getError())!==C.NO_ERROR;)Y=q;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${Y}, gl isContextLost=${C.isContextLost()}, _contextWasLost=${R}`)}return C.shaderSource(q,Y),C.compileShader(q),q}function Q(Y,b){b.useProgram(Y)}function N(Y,b){const C=Y;if(!C.isParallelCompiled)return void b(Y);const R=C.onCompiled;C.onCompiled=()=>{null===R||void 0===R||R(),b(Y)}}},12754:(Y,b,C)=>{C.d(b,{c:()=>F,g:()=>S,j:()=>r,n:()=>O});var R=C(12660),q=C(12756),A=C(12747),E=C(12669),B=C(12722),g=C(12724);function r(Y,b){return(0,q.G)(b).cachedPipelines[Y]}function O(Y){const b=Y._name,C=Y.context;if(b&&C){const Y=(0,q.G)(C),R=Y.cachedPipelines[b];null===R||void 0===R||R.dispose(),delete Y.cachedPipelines[b]}}function F(Y,b,C,q,A,E,g){let r,O;const F=(0,R.h)()?null===E||void 0===E?void 0:E.getHostDocument():null;r="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===F||void 0===F?void 0:F.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,O="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===F||void 0===F?void 0:F.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const S=[void 0,void 0],n=()=>{if(S[0]&&S[1]){Y.isFragment=!0;const[R,r]=S;(0,B.m)(r,Y,((E,r)=>{g&&(g._fragmentSourceCodeBeforeMigration=r),C&&(E=C("fragment",E));const O=(0,B.d)(R,E,Y);Y=null;const F=function(Y,b,C,R){if(C){return{vertexSourceCode:(1===R?"//":"")+"#define SHADER_NAME vertex:"+(C.vertexElement||C.vertex||C.spectorName||C)+"\n"+Y,fragmentSourceCode:(1===R?"//":"")+"#define SHADER_NAME fragment:"+(C.fragmentElement||C.fragment||C.spectorName||C)+"\n"+b}}return{vertexSourceCode:Y,fragmentSourceCode:b}}(O.vertexCode,O.fragmentCode,b,A);null===q||void 0===q||q(F.vertexSourceCode,F.fragmentSourceCode)}),E)}};y(r,"Vertex","",(b=>{(0,B.g)(Y),(0,B.m)(b,Y,((Y,R)=>{g&&(g._rawVertexSourceCode=b,g._vertexSourceCodeBeforeMigration=R),C&&(Y=C("vertex",Y)),S[0]=Y,n()}),E)}),A),y(O,"Fragment","Pixel",(Y=>{g&&(g._rawFragmentSourceCode=Y),S[1]=Y,n()}),A)}function y(Y,b,C,q,E,B){if("undefined"!==typeof HTMLElement&&Y instanceof HTMLElement){return void q((0,R.b)(Y))}if("source:"===Y.substring(0,7))return void q(Y.substring(7));if("base64:"===Y.substring(0,7)){return void q(window.atob(Y.substring(7)))}const r=A.b.GetShadersStore(E);if(r[Y+b+"Shader"])return void q(r[Y+b+"Shader"]);if(C&&r[Y+C+"Shader"])return void q(r[Y+C+"Shader"]);let O;if(O="."===Y[0]||"/"===Y[0]||Y.indexOf("http")>-1?Y:A.b.GetShadersRepository(E)+Y,!(B=B||g.k))throw new Error("loadFileInjection is not defined");B(O+"."+b.toLowerCase()+".fx",q)}const S=(Y,b,C,R)=>{try{const A=Y.context?(0,q.G)(Y.context):null;A&&(A.disableParallelShaderCompile=Y.disableParallelCompilation);const E=Y.existingPipelineContext||b(Y.shaderProcessingContext);return E._name=Y.name,Y.name&&A&&(A.cachedPipelines[Y.name]=E),C(E,Y.vertex,Y.fragment,!!Y.createAsRaw,"","",Y.rebuildRebind,Y.defines,Y.transformFeedbackVaryings,"",(()=>{R(E,(()=>{var b;null===(b=Y.onRenderingStateCompiled)||void 0===b||b.call(Y,E)}))})),E}catch(A){throw E.e.Error("Error compiling effect"),A}}},12738:(Y,b,C)=>{C.r(b),C.d(b,{Effect:()=>g});var R=C(12652),q=C(12669),A=C(12747),E=C(12754),B=C(12726);class g{static get ShadersRepository(){return A.b.ShadersRepository}static set ShadersRepository(Y){A.b.ShadersRepository=Y}get O(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new R.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9?arguments[9]:void 0,S=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,t=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new R.d,this.onErrorObservable=new R.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=Y,this._key=S;const I=this._key.replace(/\r/g,"").replace(/\n/g,"|");let w;if(b.attributes){const Y=b;if(this._engine=C,this._attributesNames=Y.attributes,this._uniformsNames=Y.uniformsNames.concat(Y.samplers),this._samplerList=Y.samplers.slice(),this.defines=Y.defines,this.onError=Y.onError,this.onCompiled=Y.onCompiled,this._fallbacks=Y.fallbacks,this._indexParameters=Y.indexParameters,this._transformFeedbackVaryings=Y.transformFeedbackVaryings||null,this._multiTarget=!!Y.multiTarget,this._shaderLanguage=Y.shaderLanguage??0,this._disableParallelShaderCompilation=!!Y.disableParallelShaderCompilation,Y.uniformBuffersNames){this._uniformBuffersNamesList=Y.uniformBuffersNames.slice();for(let b=0;b<Y.uniformBuffersNames.length;b++)this._uniformBuffersNames[Y.uniformBuffersNames[b]]=b}this._processFinalCode=Y.processFinalCode??null,this._processCodeAfterIncludes=Y.processCodeAfterIncludes??void 0,t=Y.extraInitializationsAsync,w=Y.existingPipelineContext}else this._engine=A,this.defines=null==B?"":B,this._uniformsNames=C.concat(q),this._samplerList=q?q.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=n,this.onError=F,this.onCompiled=O,this._indexParameters=y,this._fallbacks=r;"WEBGL2"===this._engine.shaderPlatformName&&(w=(0,E.j)(I,this._engine._gl)??w),this._attributeLocationByName={},this.uniqueId=g._UniqueIdSeed++,w?(this._pipelineContext=w,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,t),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.O||this.dispose(!0)}))}async _processShaderCodeAsync(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3?arguments[3]:void 0;R&&await R(),this._processingContext=C||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:Y??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:A.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:A.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,E.c)(q,this.name,this._processFinalCode,((Y,C)=>{this._vertexSourceCode=Y,this._fragmentSourceCode=C,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.O||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(Y){return this._attributes[Y]}getAttributeLocationByName(Y){return this._attributeLocationByName[Y]}getAttributesCount(){return this._attributes.length}getUniformIndex(Y){return this._uniformsNames.indexOf(Y)}getUniform(Y){return this._uniforms[Y]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((Y=>{this.executeWhenCompiled(Y)}))}executeWhenCompiled(Y){this.isReady()?Y(this):(this.onCompileObservable.add((b=>{Y(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(Y){(0,B.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(b=>{this._processCompilationErrors(b,Y)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var Y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var Y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(Y,b,C,R){this._isReady=!1,this._vertexSourceCodeOverride=Y,this._fragmentSourceCodeOverride=b,this.onError=(Y,b)=>{R&&R(b)},this.onCompiled=()=>{var Y,b;const R=this.getEngine().scenes;if(R)for(let C=0;C<R.length;C++)R[C].markAllMaterialsAsDirty(127);null===(Y=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===Y||Y.call(b,C)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(Y){if(this._pipelineContext=Y,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const Y=this._attributesNames[b];this._attributeLocationByName[Y]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),g.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const C=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),R=C?null:this.defines,q=C?this._vertexSourceCodeOverride:this._vertexSourceCode,A=C?this._fragmentSourceCodeOverride:this._fragmentSourceCode,B=this._engine;this._pipelineContext=(0,E.g)({existingPipelineContext:Y?b:null,vertex:q,fragment:A,context:"WEBGL2"===B.shaderPlatformName||"WEBGL1"===B.shaderPlatformName?B._gl:void 0,rebuildRebind:(Y,b,C,R)=>this._rebuildProgram(Y,b,C,R),defines:R,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:C,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:C=>{b&&!Y&&this._engine._deletePipelineContext(b),C&&this._onRenderingStateCompiled(C)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(C){this._processCompilationErrors(C,b)}}_getShaderCodeAndErrorLine(Y,b,C){const R=C?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let q=null;if(b&&Y){const A=b.match(R);if(A&&2===A.length){const b=parseInt(A[1]),R=Y.split("\n",-1);R.length>=b&&(q=`Offending line [${b}] in ${C?"fragment":"vertex"} code: ${R[b-1]}`)}}return[Y,q]}_processCompilationErrors(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=Y.message;const C=this._attributesNames,R=this._fallbacks;if(q.e.Error("Unable to compile effect:"),q.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),q.e.Error(`Attributes: ${C.join(" ")}`),q.e.Error("Defines:\n"+this.defines),g.LogShaderCodeOnCompilationError){var A,E;let Y=null,b=null,C=null;var B;if(null!==(A=this._pipelineContext)&&void 0!==A&&A._getVertexShaderCode()&&([C,Y]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),C&&(q.e.Error("Vertex code:"),q.e.Error(C))),null!==(E=this._pipelineContext)&&void 0!==E&&E._getFragmentShaderCode())[C,b]=this._getShaderCodeAndErrorLine(null===(B=this._pipelineContext)||void 0===B?void 0:B._getFragmentShaderCode(),this._compilationError,!0),C&&(q.e.Error("Fragment code:"),q.e.Error(C));Y&&q.e.Error(Y),b&&q.e.Error(b)}q.e.Error("Error: "+this._compilationError);const r=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};b&&(this._pipelineContext=b,this._isReady=!0,r()),R?(this._pipelineContext=null,R.hasMoreFallbacks?(this._allFallbacksProcessed=!1,q.e.Error("Trying next fallback."),this.defines=R.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,r(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||r())}get isSupported(){return""===this._compilationError}_bindTexture(Y,b){this._engine._bindTexture(this._samplers[Y],b,Y)}setTexture(Y,b){this._engine.setTexture(this._samplers[Y],this._uniforms[Y],b,Y)}setTextureArray(Y,b){const C=Y+"Ex";if(-1===this._samplerList.indexOf(C+"0")){const R=this._samplerList.indexOf(Y);for(let Y=1;Y<b.length;Y++){const b=C+(Y-1).toString();this._samplerList.splice(R+Y,0,b)}let q=0;for(const Y of this._samplerList)this._samplers[Y]=q,q+=1}this._engine.setTextureArray(this._samplers[Y],this._uniforms[Y],b,Y)}bindUniformBuffer(Y,b){const C=this._uniformBuffersNames[b];void 0===C||g._BaseCache[C]===Y&&this._engine._features.useUBOBindingCache||(g._BaseCache[C]=Y,this._engine.bindUniformBufferBase(Y,C,b))}bindUniformBlock(Y,b){this._engine.bindUniformBlock(this._pipelineContext,Y,b)}setInt(Y,b){return this._pipelineContext.setInt(Y,b),this}setInt2(Y,b,C){return this._pipelineContext.setInt2(Y,b,C),this}setInt3(Y,b,C,R){return this._pipelineContext.setInt3(Y,b,C,R),this}setInt4(Y,b,C,R,q){return this._pipelineContext.setInt4(Y,b,C,R,q),this}setIntArray(Y,b){return this._pipelineContext.setIntArray(Y,b),this}setIntArray2(Y,b){return this._pipelineContext.setIntArray2(Y,b),this}setIntArray3(Y,b){return this._pipelineContext.setIntArray3(Y,b),this}setIntArray4(Y,b){return this._pipelineContext.setIntArray4(Y,b),this}setUInt(Y,b){return this._pipelineContext.setUInt(Y,b),this}setUInt2(Y,b,C){return this._pipelineContext.setUInt2(Y,b,C),this}setUInt3(Y,b,C,R){return this._pipelineContext.setUInt3(Y,b,C,R),this}setUInt4(Y,b,C,R,q){return this._pipelineContext.setUInt4(Y,b,C,R,q),this}setUIntArray(Y,b){return this._pipelineContext.setUIntArray(Y,b),this}setUIntArray2(Y,b){return this._pipelineContext.setUIntArray2(Y,b),this}setUIntArray3(Y,b){return this._pipelineContext.setUIntArray3(Y,b),this}setUIntArray4(Y,b){return this._pipelineContext.setUIntArray4(Y,b),this}setFloatArray(Y,b){return this._pipelineContext.setArray(Y,b),this}setFloatArray2(Y,b){return this._pipelineContext.setArray2(Y,b),this}setFloatArray3(Y,b){return this._pipelineContext.setArray3(Y,b),this}setFloatArray4(Y,b){return this._pipelineContext.setArray4(Y,b),this}setArray(Y,b){return this._pipelineContext.setArray(Y,b),this}setArray2(Y,b){return this._pipelineContext.setArray2(Y,b),this}setArray3(Y,b){return this._pipelineContext.setArray3(Y,b),this}setArray4(Y,b){return this._pipelineContext.setArray4(Y,b),this}setMatrices(Y,b){return this._pipelineContext.setMatrices(Y,b),this}setMatrix(Y,b){return this._pipelineContext.setMatrix(Y,b),this}setMatrix3x3(Y,b){return this._pipelineContext.setMatrix3x3(Y,b),this}setMatrix2x2(Y,b){return this._pipelineContext.setMatrix2x2(Y,b),this}setFloat(Y,b){return this._pipelineContext.setFloat(Y,b),this}setBool(Y,b){return this._pipelineContext.setInt(Y,b?1:0),this}setVector2(Y,b){return this._pipelineContext.setVector2(Y,b),this}setFloat2(Y,b,C){return this._pipelineContext.setFloat2(Y,b,C),this}setVector3(Y,b){return this._pipelineContext.setVector3(Y,b),this}setFloat3(Y,b,C,R){return this._pipelineContext.setFloat3(Y,b,C,R),this}setVector4(Y,b){return this._pipelineContext.setVector4(Y,b),this}setQuaternion(Y,b){return this._pipelineContext.setQuaternion(Y,b),this}setFloat4(Y,b,C,R,q){return this._pipelineContext.setFloat4(Y,b,C,R,q),this}setColor3(Y,b){return this._pipelineContext.setColor3(Y,b),this}setColor4(Y,b,C){return this._pipelineContext.setColor4(Y,b,C),this}setDirectColor4(Y,b){return this._pipelineContext.setDirectColor4(Y,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(g.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,E.n)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(A.b.GetShadersStore(R)[`${Y}PixelShader`]=b),C&&(A.b.GetShadersStore(R)[`${Y}VertexShader`]=C)}static ResetCache(){g._BaseCache={}}}g.LogShaderCodeOnCompilationError=!0,g.PersistentMode=!1,g.AutomaticallyClearCodeCache=!1,g._UniqueIdSeed=0,g._BaseCache={},g.ShadersStore=A.b.ShadersStore,g.IncludesShadersStore=A.b.IncludesShadersStore},12687:(Y,b,C)=>{C.d(b,{d:()=>q});const R={};function q(Y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!R[Y])return R[Y]=!0,`${Y} needs to be imported before as it contains a side-effect required by your code.`}},12660:(Y,b,C)=>{function R(){return"undefined"!==typeof window}function q(){return"undefined"!==typeof navigator}function A(){return"undefined"!==typeof document}function E(Y){let b="",C=Y.firstChild;for(;C;)3===C.nodeType&&(b+=C.textContent),C=C.nextSibling;return b}C.d(b,{b:()=>E,e:()=>A,f:()=>q,h:()=>R})},12669:(Y,b,C)=>{C.d(b,{e:()=>R});class R{static _CheckLimit(Y,b){let C=R._LogLimitOutputs[Y];return C?C.current++:(C={limit:b,current:1},R._LogLimitOutputs[Y]=C),C.current<=C.limit}static _GenerateLimitMessage(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const C=R._LogLimitOutputs[Y];if(!C||!R.MessageLimitReached)return;const q=this._Levels[b];C.current===C.limit&&R[q.name](R.MessageLimitReached.replace(/%LIMIT%/g,""+C.limit).replace(/%TYPE%/g,q.name??""))}static _AddLogEntry(Y){R._LogCache=Y+R._LogCache,R.OnNewCacheEntry&&R.OnNewCacheEntry(Y)}static _FormatMessage(Y){const b=Y=>Y<10?"0"+Y:""+Y,C=new Date;return"["+b(C.getHours())+":"+b(C.getMinutes())+":"+b(C.getSeconds())+"]: "+Y}static _LogDisabled(Y,b){}static _LogEnabled(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;const q=Array.isArray(b)?b[0]:b;if(void 0!==C&&!R._CheckLimit(q,C))return;const A=R._FormatMessage(q),E=this._Levels[Y],B=Array.isArray(b)?b.slice(1):[];E.logFunc&&E.logFunc("BJS - "+A,...B);const g=`<div style='color:${E.color}'>${A}</div><br>`;R._AddLogEntry(g),R._GenerateLimitMessage(q,Y)}static get LogCache(){return R._LogCache}static ClearLogCache(){R._LogCache="",R._LogLimitOutputs={},R.errorsCount=0}static set LogLevels(Y){R.Log=R._LogDisabled,R.Warn=R._LogDisabled,R.Error=R._LogDisabled;const b=[R.MessageLogLevel,R.WarningLogLevel,R.ErrorLogLevel];for(const C of b)if((Y&C)===C){const Y=this._Levels[C];R[Y.name]=R._LogEnabled.bind(R,C)}}}R.NoneLogLevel=0,R.MessageLogLevel=1,R.WarningLogLevel=2,R.ErrorLogLevel=4,R.AllLogLevel=7,R.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",R._LogCache="",R._LogLimitOutputs={},R._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],R.errorsCount=0,R.Log=R._LogEnabled.bind(R,R.MessageLogLevel),R.Warn=R._LogEnabled.bind(R,R.WarningLogLevel),R.Error=R._LogEnabled.bind(R,R.ErrorLogLevel)},12652:(Y,b,C)=>{C.d(b,{d:()=>E});const R="undefined"!==typeof WeakRef;class q{constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,R=arguments.length>3?arguments[3]:void 0;this.initialize(Y,b,C,R)}initialize(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,R=arguments.length>3?arguments[3]:void 0;return this.mask=Y,this.skipNextObservers=b,this.target=C,this.currentTarget=R,this}}class A{constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=Y,this.mask=b,this.scope=C,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(Y)}}class E{static FromPromise(Y,b){const C=new E;return Y.then((Y=>{C.notifyObservers(Y)})).catch((Y=>{if(!b)throw Y;b.notifyObservers(Y)})),C}get observers(){return this._observers}constructor(Y){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new q(0),Y&&(this._onObserverAdded=Y)}add(Y){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Y)return null;const q=new A(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);q.unregisterOnNextCall=C,b?this._observers.unshift(q):this._observers.push(q),this._onObserverAdded&&this._onObserverAdded(q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(q,this._lastNotifiedValue);const E=R?new WeakRef(this):{deref:()=>this};return q._remove=function(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=E.deref();b&&(Y?b.remove(q):b._remove(q))},q}addOnce(Y){return this.add(Y,void 0,void 0,void 0,!0)}remove(Y){if(!Y)return!1;Y._remove=null;return-1!==this._observers.indexOf(Y)&&(this._deferUnregister(Y),!0)}removeCallback(Y,b){for(let C=0;C<this._observers.length;C++){const R=this._observers[C];if(!R._willBeUnregistered&&(R.callback===Y&&(!b||b===R.scope)))return this._deferUnregister(R),!0}return!1}_deferUnregister(Y){Y._willBeUnregistered||(this._numObserversMarkedAsDeleted++,Y.unregisterOnNextCall=!1,Y._willBeUnregistered=!0,setTimeout((()=>{this._remove(Y)}),0))}_remove(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Y)return!1;const C=this._observers.indexOf(Y);return-1!==C&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(C,1),!0)}makeObserverTopPriority(Y){this._remove(Y,!1),this._observers.unshift(Y)}makeObserverBottomPriority(Y){this._remove(Y,!1),this._observers.push(Y)}notifyObservers(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,C=arguments.length>2?arguments[2]:void 0,R=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Y),!this._observers.length)return!0;const A=this._eventState;A.mask=b,A.target=C,A.currentTarget=R,A.skipNextObservers=!1,A.lastReturnValue=Y,A.userInfo=q;for(const E of this._observers)if(!E._willBeUnregistered&&(E.mask&b&&(E.unregisterOnNextCall&&this._deferUnregister(E),E.scope?A.lastReturnValue=E.callback.apply(E.scope,[Y,A]):A.lastReturnValue=E.callback(Y,A)),A.skipNextObservers))return!1;return!0}notifyObserver(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),Y._willBeUnregistered)return;const R=this._eventState;R.mask=C,R.skipNextObservers=!1,Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.callback(b,R)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const Y=this._observers.pop();Y&&(Y._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const Y=new E;return Y._observers=this._observers.slice(0),Y}hasSpecificMask(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&Y||b.mask===Y)return!0;return!1}}},12726:(Y,b,C)=>{C.d(b,{d:()=>q,g:()=>E});let R=[];class q{static SetImmediate(Y){0===R.length&&setTimeout((()=>{const Y=R;R=[];for(const b of Y)b()}),1),R.push(Y)}}function A(Y,b,C){try{if(Y())return b(),!0}catch(R){return null===C||void 0===C||C(R),!0}return!1}const E=function(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,E=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&A(Y,b,C))return null;const B=setInterval((()=>{A(Y,b,C)?clearInterval(B):(q-=R,q<0&&(clearInterval(B),null===C||void 0===C||C(new Error("Operation timed out after maximum retries. "+(E||"")),!0)))}),R);return()=>clearInterval(B)}}}]);