"use strict";(self.zy41qorie9=self.zy41qorie9||[]).push([[9],{12325:(Z,l,C)=>{C.d(l,{b:()=>U,f:()=>n,j:()=>c,i:()=>k,m:()=>V});class B{constructor(){this.children=[]}isValid(Z){return!0}process(Z,l,C){let B="";if(this.line){let C=this.line;const d=l.processor;if(d){var x,b,K,f,W,J;d.lineProcessor&&(C=d.lineProcessor(C,l.isFragment,l.processingContext));const B=(null===(x=l.processor)||void 0===x?void 0:x.attributeKeywordName)??"attribute",E=l.isFragment&&null!==(b=l.processor)&&void 0!==b&&b.varyingFragmentKeywordName?null===(K=l.processor)||void 0===K?void 0:K.varyingFragmentKeywordName:!l.isFragment&&null!==(f=l.processor)&&void 0!==f&&f.varyingVertexKeywordName?null===(W=l.processor)||void 0===W?void 0:W.varyingVertexKeywordName:"varying";if(!l.isFragment&&d.attributeProcessor&&this.line.startsWith(B))C=d.attributeProcessor(this.line,Z,l.processingContext);else if(d.varyingProcessor&&(null!==(J=d.varyingCheck)&&void 0!==J&&J.call(d,this.line,l.isFragment)||!d.varyingCheck&&this.line.startsWith(E)))C=d.varyingProcessor(this.line,l.isFragment,Z,l.processingContext);else if(d.uniformProcessor&&d.uniformRegexp&&d.uniformRegexp.test(this.line))l.lookForClosingBracketForUniformBuffer||(C=d.uniformProcessor(this.line,l.isFragment,Z,l.processingContext));else if(d.uniformBufferProcessor&&d.uniformBufferRegexp&&d.uniformBufferRegexp.test(this.line))l.lookForClosingBracketForUniformBuffer||(C=d.uniformBufferProcessor(this.line,l.isFragment,l.processingContext),l.lookForClosingBracketForUniformBuffer=!0);else if(d.textureProcessor&&d.textureRegexp&&d.textureRegexp.test(this.line))C=d.textureProcessor(this.line,l.isFragment,Z,l.processingContext);else if((d.uniformProcessor||d.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!l.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?d.uniformProcessor&&(C=d.uniformProcessor(this.line,l.isFragment,Z,l.processingContext)):d.uniformBufferProcessor&&(C=d.uniformBufferProcessor(this.line,l.isFragment,l.processingContext),l.lookForClosingBracketForUniformBuffer=!0)}l.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(l.lookForClosingBracketForUniformBuffer=!1,d.endOfUniformBufferProcessor&&(C=d.endOfUniformBufferProcessor(this.line,l.isFragment,l.processingContext)))}B+=C+"\n"}for(const d of this.children)B+=d.process(Z,l,C);return this.additionalDefineKey&&(Z[this.additionalDefineKey]=this.additionalDefineValue||"true",C[this.additionalDefineKey]=Z[this.additionalDefineKey]),B}}class x{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(Z){this._lines.length=0;for(const l of Z){if(!l||"\r"===l)continue;if("#"===l[0]){this._lines.push(l);continue}const Z=l.trim();if(!Z)continue;if(Z.startsWith("//")){this._lines.push(l);continue}const C=Z.indexOf(";");if(-1===C)this._lines.push(Z);else if(C===Z.length-1)Z.length>1&&this._lines.push(Z);else{const Z=l.split(";");for(let l=0;l<Z.length;l++){let C=Z[l];C&&(C=C.trim(),C&&this._lines.push(C+(l!==Z.length-1?";":"")))}}}}}class b extends B{process(Z,l,C){for(let B=0;B<this.children.length;B++){const x=this.children[B];if(x.isValid(Z))return x.process(Z,l,C)}return""}}class K extends B{isValid(Z){return this.testExpression.isTrue(Z)}}class f{isTrue(Z){return!0}static postfixToInfix(Z){const l=[];for(const C of Z)if(void 0===f._OperatorPriority[C])l.push(C);else{const Z=l[l.length-1],B=l[l.length-2];l.length-=2,l.push(`(${B}${C}${Z})`)}return l[l.length-1]}static infixToPostfix(Z){const l=f._InfixToPostfixCache.get(Z);if(l)return l.accessTime=Date.now(),l.result;if(!Z.includes("&&")&&!Z.includes("||")&&!Z.includes(")")&&!Z.includes("("))return[Z];const C=[];let B=-1;const x=()=>{d=d.trim(),""!==d&&(C.push(d),d="")},b=Z=>{B<f._Stack.length-1&&(f._Stack[++B]=Z)},K=()=>f._Stack[B],W=()=>-1===B?"!!INVALID EXPRESSION!!":f._Stack[B--];let J=0,d="";for(;J<Z.length;){const l=Z.charAt(J),E=J<Z.length-1?Z.substring(J,2+J):"";if("("===l)d="",b(l);else if(")"===l){for(x();-1!==B&&"("!==K();)C.push(W());W()}else if(f._OperatorPriority[E]>1){for(x();-1!==B&&f._OperatorPriority[K()]>=f._OperatorPriority[E];)C.push(W());b(E),J++}else d+=l;J++}for(x();-1!==B;)"("===K()?W():C.push(W());return f._InfixToPostfixCache.size>=f.InfixToPostfixCacheLimitSize&&f.ClearCache(),f._InfixToPostfixCache.set(Z,{result:C,accessTime:Date.now()}),C}static ClearCache(){const Z=Array.from(f._InfixToPostfixCache.entries()).sort(((Z,l)=>Z[1].accessTime-l[1].accessTime));for(let l=0;l<f.InfixToPostfixCacheCleanupSize;l++)f._InfixToPostfixCache.delete(Z[l][0])}}f.InfixToPostfixCacheLimitSize=5e4,f.InfixToPostfixCacheCleanupSize=25e3,f._InfixToPostfixCache=new Map,f._OperatorPriority={")":0,"(":1,"||":2,"&&":3},f._Stack=["","","","","","","","","","","","","","","","","","","",""];class W extends f{constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=Z,this.not=l}isTrue(Z){let l=void 0!==Z[this.define];return this.not&&(l=!l),l}}class J extends f{isTrue(Z){return this.leftOperand.isTrue(Z)||this.rightOperand.isTrue(Z)}}class d extends f{isTrue(Z){return this.leftOperand.isTrue(Z)&&this.rightOperand.isTrue(Z)}}class E extends f{constructor(Z,l,C){super(),this.define=Z,this.operand=l,this.testValue=C}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(Z){let l=!1;const C=parseInt(void 0!=Z[this.define]?Z[this.define]:this.define),B=parseInt(void 0!=Z[this.testValue]?Z[this.testValue]:this.testValue);if(isNaN(C)||isNaN(B))return!1;switch(this.operand){case">":l=C>B;break;case"<":l=C<B;break;case"<=":l=C<=B;break;case">=":l=C>=B;break;case"==":l=C===B;break;case"!=":l=C!==B}return l}}var G=C(12282),a=C(12332);const q=/defined\s*?\((.+?)\)/g,z=/defined\s*?\[(.+?)\]/g,Y=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,P=/__decl__/,S=/light\{X\}.(\w*)/g,i=/\{X\}/g,s=[],F=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function n(Z){Z.processor&&Z.processor.initializeShaders&&Z.processor.initializeShaders(Z.processingContext)}function c(Z,l,C,B){var x;null!==(x=l.processor)&&void 0!==x&&x.preProcessShaderCode&&(Z=l.processor.preProcessShaderCode(Z,l.isFragment)),k(Z,l,(Z=>{l.processCodeAfterIncludes&&(Z=l.processCodeAfterIncludes(l.isFragment?"fragment":"vertex",Z,l.defines));const x=function(Z,l,C){let B=function(Z,l){var C;if(null!==(C=l.processor)&&void 0!==C&&C.noPrecision)return Z;const B=l.shouldUseHighPrecisionShader;-1===Z.indexOf("precision highp float")?Z=B?"precision highp float;\n"+Z:"precision mediump float;\n"+Z:B||(Z=Z.replace("precision highp float","precision mediump float"));return Z}(Z,l);if(!l.processor)return B;if(0===l.processor.shaderLanguage&&-1!==B.indexOf("#version 3")&&(B=B.replace("#version 300 es",""),!l.processor.parseGLES3))return B;const x=l.defines,b=R(l,C);l.processor.preProcessor&&(B=l.processor.preProcessor(B,x,b,l.isFragment,l.processingContext));const K={};B=v(B,b,l,K),l.processor.postProcessor&&(B=l.processor.postProcessor(B,x,l.isFragment,l.processingContext,C?{drawBuffersExtensionDisabled:!C.getCaps().drawBuffersExtension}:{},b,K));null!==C&&void 0!==C&&C._features.needShaderCodeInlining&&(B=C.inlineShaderCode(B));return B}(Z,l,B);C(x,Z)}))}function U(Z,l,C){return C.processor&&C.processor.finalizeShaders?C.processor.finalizeShaders(Z,l,C.processingContext):{vertexCode:Z,fragmentCode:l}}function t(Z){const l=/defined\((.+)\)/.exec(Z);if(l&&l.length)return new W(l[1].trim(),"!"===Z[0]);const C=["==","!=",">=","<=","<",">"];let B="",x=0;for(B of C)if(x=Z.indexOf(B),x>-1)break;if(-1===x)return new W(Z);const b=Z.substring(0,x).trim(),K=Z.substring(x+B.length).trim();return new E(b,B,K)}function r(Z,l){const C=new K,B=Z.substring(0,l);let x=Z.substring(l);return x=x.substring(0,(x.indexOf("//")+1||x.length+1)-1).trim(),C.testExpression="#ifdef"===B?new W(x):"#ifndef"===B?new W(x,!0):function(Z){Z=Z.replace(q,"defined[$1]");const l=f.infixToPostfix(Z),C=[];for(const x of l)if("||"!==x&&"&&"!==x)C.push(x);else if(C.length>=2){let Z=C[C.length-1],l=C[C.length-2];C.length-=2;const B="&&"==x?new d:new J;"string"===typeof Z&&(Z=Z.replace(z,"defined($1)")),"string"===typeof l&&(l=l.replace(z,"defined($1)")),B.leftOperand="string"===typeof l?t(l):l,B.rightOperand="string"===typeof Z?t(Z):Z,C.push(B)}let B=C[C.length-1];return"string"===typeof B&&(B=B.replace(z,"defined($1)")),"string"===typeof B?t(B):B}(x),C}function e(Z,l,C,x){let b=Z.currentLine;for(;o(Z,C,x);){b=Z.currentLine;const K=b.substring(0,5).toLowerCase();if("#else"===K){const C=new B;return l.children.push(C),void o(Z,C,x)}if("#elif"===K){const Z=r(b,5);l.children.push(Z),C=Z}}}function o(Z,l,C){for(;Z.canRead;){Z.lineIndex++;const x=Z.currentLine;if(x.indexOf("#")>=0){const B=F.exec(x);if(B&&B.length){switch(B[0]){case"#ifdef":{const B=new b;l.children.push(B);const K=r(x,6);B.children.push(K),e(Z,B,K,C);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const B=new b;l.children.push(B);const K=r(x,7);B.children.push(K),e(Z,B,K,C);break}case"#if":{const B=new b,K=r(x,3);l.children.push(B),B.children.push(K),e(Z,B,K,C);break}}continue}}const K=new B;if(K.line=x,l.children.push(K),"#"===x[0]&&"d"===x[1]){const Z=x.replace(";","").split(" ");K.additionalDefineKey=Z[1],3===Z.length&&(K.additionalDefineValue=Z[2])}}return!1}function v(Z,l,C,b){const K=new B,f=new x;return f.lineIndex=-1,f.lines=Z.split("\n"),o(f,K,b),K.process(l,C,b)}function R(Z,l){var C;const B=Z.defines,x={};for(const b of B){const Z=b.replace("#define","").replace(";","").trim().split(" ");x[Z[0]]=Z.length>1?Z[1]:""}return 0===(null===(C=Z.processor)||void 0===C?void 0:C.shaderLanguage)&&(x.GL_ES="true"),x.__VERSION__=Z.version,x[Z.platformName]="true",(0,a.j)(x,null===l||void 0===l?void 0:l.isNDCHalfZRange,null===l||void 0===l?void 0:l.lb,null===l||void 0===l?void 0:l.useExactSrgbConversions),x}function k(Z,l,C){let B;for(s.length=0;null!==(B=Y.exec(Z));)s.push(B);let x=String(Z),b=[Z],K=!1;for(const f of s){let Z=f[1];if(-1!==Z.indexOf("__decl__")&&(Z=Z.replace(P,""),l.supportsUniformBuffers&&(Z=Z.replace("Vertex","Ubo").replace("Fragment","Ubo")),Z+="Declaration"),!l.includesShadersStore[Z]){const B=l.shadersRepository+"ShadersInclude/"+Z+".fx";return void V.loadFile(B,(B=>{l.includesShadersStore[Z]=B,k(b.join(""),l,C)}))}{let C=l.includesShadersStore[Z];if(f[2]){const Z=f[3].split(",");for(let l=0;l<Z.length;l+=2){const B=new RegExp(Z[l],"g"),x=Z[l+1];C=C.replace(B,x)}}if(f[4]){const Z=f[5];if(-1!==Z.indexOf("..")){const B=Z.split(".."),x=parseInt(B[0]);let b=parseInt(B[1]),K=C.slice(0);C="",isNaN(b)&&(b=l.indexParameters[B[1]]);for(let Z=x;Z<b;Z++)l.supportsUniformBuffers||(K=K.replace(S,((Z,l)=>l+"{X}"))),C+=K.replace(i,Z.toString())+"\n"}else l.supportsUniformBuffers||(C=C.replace(S,((Z,l)=>l+"{X}"))),C=C.replace(i,Z)}const B=[];for(const Z of b){const l=Z.split(f[0]);for(let Z=0;Z<l.length-1;Z++)B.push(l[Z]),B.push(C);B.push(l[l.length-1])}b=B,K=K||C.indexOf("#include<")>=0||C.indexOf("#include <")>=0}}s.length=0,x=b.join(""),K?k(x.toString(),l,C):C(x)}const V={loadFile:(Z,l,C,B,x,b)=>{throw(0,G.d)("FileTools")}}},12332:(Z,l,C)=>{C.d(l,{c:()=>x,g:()=>b,j:()=>f,n:()=>K,p:()=>W});var B=C(12282);C(12255);const x={};function b(Z,l){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(l?l+"\n":"")+Z}function K(Z,l,C,b,K,f,W){const J=W||x.loadFile;if(J){return J(Z,l,C,b,K,f)}throw(0,B.d)("FileTools")}function f(Z,l,C,B){if(Z)return l?Z.IS_NDC_HALF_ZRANGE="":delete Z.IS_NDC_HALF_ZRANGE,C?Z.USE_REVERSE_DEPTHBUFFER="":delete Z.USE_REVERSE_DEPTHBUFFER,void(B?Z.USE_EXACT_SRGB_CONVERSIONS="":delete Z.USE_EXACT_SRGB_CONVERSIONS);{let Z="";return l&&(Z+="#define IS_NDC_HALF_ZRANGE"),C&&(Z&&(Z+="\n"),Z+="#define USE_REVERSE_DEPTHBUFFER"),B&&(Z&&(Z+="\n"),Z+="#define USE_EXACT_SRGB_CONVERSIONS"),Z}}function W(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;switch(Z){case 3:{const Z=(ArrayBuffer,new Int8Array(l));return B&&Z.set(new Int8Array(B)),Z}case 0:{const Z=(ArrayBuffer,new Uint8Array(l));return B&&Z.set(new Uint8Array(B)),Z}case 4:{const Z=l instanceof ArrayBuffer?new Int16Array(l):new Int16Array(C?l/2:l);return B&&Z.set(new Int16Array(B)),Z}case 5:case 8:case 9:case 10:case 2:{const Z=l instanceof ArrayBuffer?new Uint16Array(l):new Uint16Array(C?l/2:l);return B&&Z.set(new Uint16Array(B)),Z}case 6:{const Z=l instanceof ArrayBuffer?new Int32Array(l):new Int32Array(C?l/4:l);return B&&Z.set(new Int32Array(B)),Z}case 7:case 11:case 12:case 13:case 14:case 15:{const Z=l instanceof ArrayBuffer?new Uint32Array(l):new Uint32Array(C?l/4:l);return B&&Z.set(new Uint32Array(B)),Z}case 1:{const Z=l instanceof ArrayBuffer?new Float32Array(l):new Float32Array(C?l/4:l);return B&&Z.set(new Float32Array(B)),Z}}const x=(ArrayBuffer,new Uint8Array(l));return B&&x.set(new Uint8Array(B)),x}},12356:(Z,l,C)=>{C.d(l,{b:()=>B});class B{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersRepository:B.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersStore:B.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.IncludesShadersStore:B.IncludesShadersStoreWGSL}}B.ShadersRepository="src/Shaders/",B.ShadersStore={},B.IncludesShadersStore={},B.ShadersRepositoryWGSL="src/ShadersWGSL/",B.ShadersStoreWGSL={},B.IncludesShadersStoreWGSL={}},12370:(Z,l,C)=>{C.d(l,{e:()=>G,g:()=>i,k:()=>q,m:()=>a,n:()=>z,r:()=>S,t:()=>E,x:()=>J,B:()=>d,D:()=>W,E:()=>f});class B{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.al._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(Z){Z&&this.program&&Z(this.program)}setEngine(Z){this.al=Z}_fillEffectInformation(Z,l,C,B,x,b,K,f){const W=this.al;if(W.supportsUniformBuffers)for(const d in l)Z.bindUniformBlock(d,l[d]);let J;for(this.al.getUniforms(this,C).forEach(((Z,l)=>{B[C[l]]=Z})),this._uniforms=B,J=0;J<x.length;J++){null==Z.getUniform(x[J])&&(x.splice(J,1),J--)}x.forEach(((Z,l)=>{b[Z]=l}));for(const d of W.getAttributes(this,K))f.push(d)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(Z,l){const C=this._valueCache[Z],B=l.updateFlag;return(void 0===C||C!==B)&&(this._valueCache[Z]=B,!0)}_cacheFloat2(Z,l,C){let B=this._valueCache[Z];if(!B||2!==B.length)return B=[l,C],this._valueCache[Z]=B,!0;let x=!1;return B[0]!==l&&(B[0]=l,x=!0),B[1]!==C&&(B[1]=C,x=!0),x}_cacheFloat3(Z,l,C,B){let x=this._valueCache[Z];if(!x||3!==x.length)return x=[l,C,B],this._valueCache[Z]=x,!0;let b=!1;return x[0]!==l&&(x[0]=l,b=!0),x[1]!==C&&(x[1]=C,b=!0),x[2]!==B&&(x[2]=B,b=!0),b}_cacheFloat4(Z,l,C,B,x){let b=this._valueCache[Z];if(!b||4!==b.length)return b=[l,C,B,x],this._valueCache[Z]=b,!0;let K=!1;return b[0]!==l&&(b[0]=l,K=!0),b[1]!==C&&(b[1]=C,K=!0),b[2]!==B&&(b[2]=B,K=!0),b[3]!==x&&(b[3]=x,K=!0),K}setInt(Z,l){const C=this._valueCache[Z];void 0!==C&&C===l||this.al.setInt(this._uniforms[Z],l)&&(this._valueCache[Z]=l)}setInt2(Z,l,C){this._cacheFloat2(Z,l,C)&&(this.al.setInt2(this._uniforms[Z],l,C)||(this._valueCache[Z]=null))}setInt3(Z,l,C,B){this._cacheFloat3(Z,l,C,B)&&(this.al.setInt3(this._uniforms[Z],l,C,B)||(this._valueCache[Z]=null))}setInt4(Z,l,C,B,x){this._cacheFloat4(Z,l,C,B,x)&&(this.al.setInt4(this._uniforms[Z],l,C,B,x)||(this._valueCache[Z]=null))}setIntArray(Z,l){this._valueCache[Z]=null,this.al.setIntArray(this._uniforms[Z],l)}setIntArray2(Z,l){this._valueCache[Z]=null,this.al.setIntArray2(this._uniforms[Z],l)}setIntArray3(Z,l){this._valueCache[Z]=null,this.al.setIntArray3(this._uniforms[Z],l)}setIntArray4(Z,l){this._valueCache[Z]=null,this.al.setIntArray4(this._uniforms[Z],l)}setUInt(Z,l){const C=this._valueCache[Z];void 0!==C&&C===l||this.al.setUInt(this._uniforms[Z],l)&&(this._valueCache[Z]=l)}setUInt2(Z,l,C){this._cacheFloat2(Z,l,C)&&(this.al.setUInt2(this._uniforms[Z],l,C)||(this._valueCache[Z]=null))}setUInt3(Z,l,C,B){this._cacheFloat3(Z,l,C,B)&&(this.al.setUInt3(this._uniforms[Z],l,C,B)||(this._valueCache[Z]=null))}setUInt4(Z,l,C,B,x){this._cacheFloat4(Z,l,C,B,x)&&(this.al.setUInt4(this._uniforms[Z],l,C,B,x)||(this._valueCache[Z]=null))}setUIntArray(Z,l){this._valueCache[Z]=null,this.al.setUIntArray(this._uniforms[Z],l)}setUIntArray2(Z,l){this._valueCache[Z]=null,this.al.setUIntArray2(this._uniforms[Z],l)}setUIntArray3(Z,l){this._valueCache[Z]=null,this.al.setUIntArray3(this._uniforms[Z],l)}setUIntArray4(Z,l){this._valueCache[Z]=null,this.al.setUIntArray4(this._uniforms[Z],l)}setArray(Z,l){this._valueCache[Z]=null,this.al.setArray(this._uniforms[Z],l)}setArray2(Z,l){this._valueCache[Z]=null,this.al.setArray2(this._uniforms[Z],l)}setArray3(Z,l){this._valueCache[Z]=null,this.al.setArray3(this._uniforms[Z],l)}setArray4(Z,l){this._valueCache[Z]=null,this.al.setArray4(this._uniforms[Z],l)}setMatrices(Z,l){l&&(this._valueCache[Z]=null,this.al.setMatrices(this._uniforms[Z],l))}setMatrix(Z,l){this._cacheMatrix(Z,l)&&(this.al.setMatrices(this._uniforms[Z],l.Yb())||(this._valueCache[Z]=null))}setMatrix3x3(Z,l){this._valueCache[Z]=null,this.al.setMatrix3x3(this._uniforms[Z],l)}setMatrix2x2(Z,l){this._valueCache[Z]=null,this.al.setMatrix2x2(this._uniforms[Z],l)}setFloat(Z,l){const C=this._valueCache[Z];void 0!==C&&C===l||this.al.setFloat(this._uniforms[Z],l)&&(this._valueCache[Z]=l)}setVector2(Z,l){this._cacheFloat2(Z,l.x,l.y)&&(this.al.setFloat2(this._uniforms[Z],l.x,l.y)||(this._valueCache[Z]=null))}setFloat2(Z,l,C){this._cacheFloat2(Z,l,C)&&(this.al.setFloat2(this._uniforms[Z],l,C)||(this._valueCache[Z]=null))}setVector3(Z,l){this._cacheFloat3(Z,l.x,l.y,l.z)&&(this.al.setFloat3(this._uniforms[Z],l.x,l.y,l.z)||(this._valueCache[Z]=null))}setFloat3(Z,l,C,B){this._cacheFloat3(Z,l,C,B)&&(this.al.setFloat3(this._uniforms[Z],l,C,B)||(this._valueCache[Z]=null))}setVector4(Z,l){this._cacheFloat4(Z,l.x,l.y,l.z,l.w)&&(this.al.setFloat4(this._uniforms[Z],l.x,l.y,l.z,l.w)||(this._valueCache[Z]=null))}setQuaternion(Z,l){this._cacheFloat4(Z,l.x,l.y,l.z,l.w)&&(this.al.setFloat4(this._uniforms[Z],l.x,l.y,l.z,l.w)||(this._valueCache[Z]=null))}setFloat4(Z,l,C,B,x){this._cacheFloat4(Z,l,C,B,x)&&(this.al.setFloat4(this._uniforms[Z],l,C,B,x)||(this._valueCache[Z]=null))}setColor3(Z,l){this._cacheFloat3(Z,l.r,l.g,l.b)&&(this.al.setFloat3(this._uniforms[Z],l.r,l.g,l.b)||(this._valueCache[Z]=null))}setColor4(Z,l,C){this._cacheFloat4(Z,l.r,l.g,l.b,C)&&(this.al.setFloat4(this._uniforms[Z],l.r,l.g,l.b,C)||(this._valueCache[Z]=null))}setDirectColor4(Z,l){this._cacheFloat4(Z,l.r,l.g,l.b,l.a)&&(this.al.setFloat4(this._uniforms[Z],l.r,l.g,l.b,l.a)||(this._valueCache[Z]=null))}_getVertexShaderCode(){return this.vertexShader?this.al._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.al._getShaderSource(this.fragmentShader):null}}var x=C(12332);const b=new WeakMap,K={_webGLVersion:2,cachedPipelines:{}};function f(Z){let l=b.get(Z);if(!l){if(!Z)return K;l={_webGLVersion:Z.TEXTURE_BINDING_3D?2:1,_context:Z,parallelShaderCompile:Z.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},b.set(Z,l)}return l}function W(Z){b.delete(Z)}function J(Z,l,C,B,x,b){const K=f(B);b||(b=K._createShaderProgramInjection??G);return b(Z,P(l,"vertex",B,K._contextWasLost),P(C,"fragment",B,K._contextWasLost),B,x,K.validateShaderPrograms)}function d(Z,l,C,B,x){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0;const W=f(x);K||(K=W._createShaderProgramInjection??G);const J=W._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return K(Z,Y(l,"vertex",B,J,x,W._contextWasLost),Y(C,"fragment",B,J,x,W._contextWasLost),x,b,W.validateShaderPrograms)}function E(Z,l){const C=new B,x=f(Z);return x.parallelShaderCompile&&!x.disableParallelShaderCompile&&(C.isParallelCompiled=!0),C.context=x._context,C}function G(Z,l,C,B){let x=arguments.length>5?arguments[5]:void 0;const b=B.createProgram();if(Z.program=b,!b)throw new Error("Unable to create program");return B.attachShader(b,l),B.attachShader(b,C),B.linkProgram(b),Z.context=B,Z.vertexShader=l,Z.fragmentShader=C,Z.isParallelCompiled||q(Z,B,x),b}function a(Z,l,C){const B=Z;if(B._isDisposed)return!1;const x=f(l);return!!(x&&x.parallelShaderCompile&&x.parallelShaderCompile.COMPLETION_STATUS_KHR&&B.program&&l.getProgramParameter(B.program,x.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(q(B,l,C),!0)}function q(Z,l,C){const B=Z.context,x=Z.vertexShader,b=Z.fragmentShader,K=Z.program;if(!B.getProgramParameter(K,B.LINK_STATUS)){if(!l.getShaderParameter(x,l.COMPILE_STATUS)){const C=l.getShaderInfoLog(x);if(C)throw Z.vertexCompilationError=C,new Error("VERTEX SHADER "+C)}if(!l.getShaderParameter(b,l.COMPILE_STATUS)){const C=l.getShaderInfoLog(b);if(C)throw Z.fragmentCompilationError=C,new Error("FRAGMENT SHADER "+C)}const C=B.getProgramInfoLog(K);if(C)throw Z.programLinkError=C,new Error(C)}if(C){B.validateProgram(K);if(!B.getProgramParameter(K,B.VALIDATE_STATUS)){const l=B.getProgramInfoLog(K);if(l)throw Z.programValidationError=l,new Error(l)}}B.deleteShader(x),B.deleteShader(b),Z.vertexShader=void 0,Z.fragmentShader=void 0,Z.onCompiled&&(Z.onCompiled(),Z.onCompiled=void 0)}function z(Z,l,C,B,x,b,K,W,E){let G=arguments.length>10?arguments[10]:void 0,a=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0;const z=f(Z.context);a||(a=z.createRawShaderProgramInjection??J),q||(q=z.createShaderProgramInjection??d);const Y=Z;Y.program=B?a(Y,l,C,Y.context,E):q(Y,l,C,W,Y.context,E),Y.program.__SPECTOR_rebuildProgram=K,G()}function Y(Z,l,C,B,b,K){return P((0,x.g)(Z,C,B),l,b,K)}function P(Z,l,C,B){const x=C.createShader("vertex"===l?C.VERTEX_SHADER:C.FRAGMENT_SHADER);if(!x){let Z=C.NO_ERROR,x=C.NO_ERROR;for(;(x=C.getError())!==C.NO_ERROR;)Z=x;throw new Error(`Something went wrong while creating a gl ${l} shader object. gl error=${Z}, gl isContextLost=${C.isContextLost()}, _contextWasLost=${B}`)}return C.shaderSource(x,Z),C.compileShader(x),x}function S(Z,l){l.useProgram(Z)}function i(Z,l){const C=Z;if(!C.isParallelCompiled)return void l(Z);const B=C.onCompiled;C.onCompiled=()=>{null===B||void 0===B||B(),l(Z)}}},12361:(Z,l,C)=>{C.d(l,{d:()=>E,f:()=>a,j:()=>J,l:()=>d});var B=C(12255),x=C(12370),b=C(12356),K=C(12263),f=C(12325),W=C(12332);function J(Z,l){return(0,x.E)(l).cachedPipelines[Z]}function d(Z){const l=Z._name,C=Z.context;if(l&&C){const Z=(0,x.E)(C),B=Z.cachedPipelines[l];null===B||void 0===B||B.dispose(),delete Z.cachedPipelines[l]}}function E(Z,l,C,x,b,K,W){let J,d;const E=(0,B.l)()?null===K||void 0===K?void 0:K.getHostDocument():null;J="string"===typeof l?l:l.vertexSource?"source:"+l.vertexSource:l.vertexElement?(null===E||void 0===E?void 0:E.getElementById(l.vertexElement))||l.vertexElement:l.vertex||l,d="string"===typeof l?l:l.fragmentSource?"source:"+l.fragmentSource:l.fragmentElement?(null===E||void 0===E?void 0:E.getElementById(l.fragmentElement))||l.fragmentElement:l.fragment||l;const a=[void 0,void 0],q=()=>{if(a[0]&&a[1]){Z.isFragment=!0;const[B,J]=a;(0,f.j)(J,Z,((K,J)=>{W&&(W._fragmentSourceCodeBeforeMigration=J),C&&(K=C("fragment",K));const d=(0,f.b)(B,K,Z);Z=null;const E=function(Z,l,C,B){if(C){return{vertexSourceCode:(1===B?"//":"")+"#define SHADER_NAME vertex:"+(C.vertexElement||C.vertex||C.spectorName||C)+"\n"+Z,fragmentSourceCode:(1===B?"//":"")+"#define SHADER_NAME fragment:"+(C.fragmentElement||C.fragment||C.spectorName||C)+"\n"+l}}return{vertexSourceCode:Z,fragmentSourceCode:l}}(d.vertexCode,d.fragmentCode,l,b);null===x||void 0===x||x(E.vertexSourceCode,E.fragmentSourceCode)}),K)}};G(J,"Vertex","",(l=>{(0,f.f)(Z),(0,f.j)(l,Z,((Z,B)=>{W&&(W._rawVertexSourceCode=l,W._vertexSourceCodeBeforeMigration=B),C&&(Z=C("vertex",Z)),a[0]=Z,q()}),K)}),b),G(d,"Fragment","Pixel",(Z=>{W&&(W._rawFragmentSourceCode=Z),a[1]=Z,q()}),b)}function G(Z,l,C,x,K,f){if("undefined"!==typeof HTMLElement&&Z instanceof HTMLElement){return void x((0,B.c)(Z))}if("source:"===Z.substring(0,7))return void x(Z.substring(7));if("base64:"===Z.substring(0,7)){return void x(window.atob(Z.substring(7)))}const J=b.b.GetShadersStore(K);if(J[Z+l+"Shader"])return void x(J[Z+l+"Shader"]);if(C&&J[Z+C+"Shader"])return void x(J[Z+C+"Shader"]);let d;if(d="."===Z[0]||"/"===Z[0]||Z.indexOf("http")>-1?Z:b.b.GetShadersRepository(K)+Z,!(f=f||W.n))throw new Error("loadFileInjection is not defined");f(d+"."+l.toLowerCase()+".fx",x)}const a=(Z,l,C,B)=>{try{const b=Z.context?(0,x.E)(Z.context):null;b&&(b.disableParallelShaderCompile=Z.disableParallelCompilation);const K=Z.existingPipelineContext||l(Z.shaderProcessingContext);return K._name=Z.name,Z.name&&b&&(b.cachedPipelines[Z.name]=K),C(K,Z.vertex,Z.fragment,!!Z.createAsRaw,"","",Z.rebuildRebind,Z.defines,Z.transformFeedbackVaryings,"",(()=>{B(K,(()=>{var l;null===(l=Z.onRenderingStateCompiled)||void 0===l||l.call(Z,K)}))})),K}catch(b){throw K.e.Error("Error compiling effect"),b}}},12354:(Z,l,C)=>{C.r(l),C.d(l,{Effect:()=>W});var B=C(12251),x=C(12263),b=C(12356),K=C(12361),f=C(12339);class W{static get ShadersRepository(){return b.b.ShadersRepository}static set ShadersRepository(Z){b.b.ShadersRepository=Z}get J(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,G=arguments.length>9?arguments[9]:void 0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,z=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new B.b,this.onErrorObservable=new B.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=Z,this._key=a;const Y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let P;if(l.attributes){const Z=l;if(this._engine=C,this._attributesNames=Z.attributes,this._uniformsNames=Z.uniformsNames.concat(Z.samplers),this._samplerList=Z.samplers.slice(),this.defines=Z.defines,this.onError=Z.onError,this.onCompiled=Z.onCompiled,this._fallbacks=Z.fallbacks,this._indexParameters=Z.indexParameters,this._transformFeedbackVaryings=Z.transformFeedbackVaryings||null,this._multiTarget=!!Z.multiTarget,this._shaderLanguage=Z.shaderLanguage??0,this._disableParallelShaderCompilation=!!Z.disableParallelShaderCompilation,Z.uniformBuffersNames){this._uniformBuffersNamesList=Z.uniformBuffersNames.slice();for(let l=0;l<Z.uniformBuffersNames.length;l++)this._uniformBuffersNames[Z.uniformBuffersNames[l]]=l}this._processFinalCode=Z.processFinalCode??null,this._processCodeAfterIncludes=Z.processCodeAfterIncludes??void 0,z=Z.extraInitializationsAsync,P=Z.existingPipelineContext}else this._engine=b,this.defines=null==f?"":f,this._uniformsNames=C.concat(x),this._samplerList=x?x.slice():[],this._attributesNames=l,this._uniformBuffersNamesList=[],this._shaderLanguage=q,this.onError=E,this.onCompiled=d,this._indexParameters=G,this._fallbacks=J;"WEBGL2"===this._engine.shaderPlatformName&&(P=(0,K.j)(Y,this._engine._gl)??P),this._attributeLocationByName={},this.uniqueId=W._UniqueIdSeed++,P?(this._pipelineContext=P,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,z),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.J||this.dispose(!0)}))}async _processShaderCodeAsync(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0;B&&await B(),this._processingContext=C||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const x={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:Z??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:b.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:b.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,lb:this._engine.lb,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,K.d)(x,this.name,this._processFinalCode,((Z,C)=>{this._vertexSourceCode=Z,this._fragmentSourceCode=C,this._prepareEffect(l)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.J||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(Z){return this._attributes[Z]}getAttributeLocationByName(Z){return this._attributeLocationByName[Z]}getAttributesCount(){return this._attributes.length}getUniformIndex(Z){return this._uniformsNames.indexOf(Z)}getUniform(Z){return this._uniforms[Z]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((Z=>{this.executeWhenCompiled(Z)}))}executeWhenCompiled(Z){this.isReady()?Z(this):(this.onCompileObservable.add((l=>{Z(l)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(Z){(0,f.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(l=>{this._processCompilationErrors(l,Z)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var Z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var Z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(Z=this._pipelineContext)||void 0===Z?void 0:Z._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,lb:this._engine.lb,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(Z,l,C,B){this._isReady=!1,this._vertexSourceCodeOverride=Z,this._fragmentSourceCodeOverride=l,this.onError=(Z,l)=>{B&&B(l)},this.onCompiled=()=>{var Z,l;const B=this.getEngine().scenes;if(B)for(let C=0;C<B.length;C++)B[C].markAllMaterialsAsDirty(127);null===(Z=(l=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===Z||Z.call(l,C)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(Z){if(this._pipelineContext=Z,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let l=0;l<this._attributesNames.length;l++){const Z=this._attributesNames[l];this._attributeLocationByName[Z]=this._attributes[l]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),W.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l=this._pipelineContext;this._isReady=!1;try{const C=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),B=C?null:this.defines,x=C?this._vertexSourceCodeOverride:this._vertexSourceCode,b=C?this._fragmentSourceCodeOverride:this._fragmentSourceCode,f=this._engine;this._pipelineContext=(0,K.f)({existingPipelineContext:Z?l:null,vertex:x,fragment:b,context:"WEBGL2"===f.shaderPlatformName||"WEBGL1"===f.shaderPlatformName?f._gl:void 0,rebuildRebind:(Z,l,C,B)=>this._rebuildProgram(Z,l,C,B),defines:B,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:C,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:C=>{l&&!Z&&this._engine._deletePipelineContext(l),C&&this._onRenderingStateCompiled(C)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(l)}catch(C){this._processCompilationErrors(C,l)}}_getShaderCodeAndErrorLine(Z,l,C){const B=C?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let x=null;if(l&&Z){const b=l.match(B);if(b&&2===b.length){const l=parseInt(b[1]),B=Z.split("\n",-1);B.length>=l&&(x=`Offending line [${l}] in ${C?"fragment":"vertex"} code: ${B[l-1]}`)}}return[Z,x]}_processCompilationErrors(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=Z.message;const C=this._attributesNames,B=this._fallbacks;if(x.e.Error("Unable to compile effect:"),x.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),x.e.Error(`Attributes: ${C.join(" ")}`),x.e.Error("Defines:\n"+this.defines),W.LogShaderCodeOnCompilationError){var b,K;let Z=null,l=null,C=null;var f;if(null!==(b=this._pipelineContext)&&void 0!==b&&b._getVertexShaderCode()&&([C,Z]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),C&&(x.e.Error("Vertex code:"),x.e.Error(C))),null!==(K=this._pipelineContext)&&void 0!==K&&K._getFragmentShaderCode())[C,l]=this._getShaderCodeAndErrorLine(null===(f=this._pipelineContext)||void 0===f?void 0:f._getFragmentShaderCode(),this._compilationError,!0),C&&(x.e.Error("Fragment code:"),x.e.Error(C));Z&&x.e.Error(Z),l&&x.e.Error(l)}x.e.Error("Error: "+this._compilationError);const J=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};l&&(this._pipelineContext=l,this._isReady=!0,J()),B?(this._pipelineContext=null,B.hasMoreFallbacks?(this._allFallbacksProcessed=!1,x.e.Error("Trying next fallback."),this.defines=B.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,J(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,l||J())}get isSupported(){return""===this._compilationError}_bindTexture(Z,l){this._engine._bindTexture(this._samplers[Z],l,Z)}setTexture(Z,l){this._engine.setTexture(this._samplers[Z],this._uniforms[Z],l,Z)}setTextureArray(Z,l){const C=Z+"Ex";if(-1===this._samplerList.indexOf(C+"0")){const B=this._samplerList.indexOf(Z);for(let Z=1;Z<l.length;Z++){const l=C+(Z-1).toString();this._samplerList.splice(B+Z,0,l)}let x=0;for(const Z of this._samplerList)this._samplers[Z]=x,x+=1}this._engine.setTextureArray(this._samplers[Z],this._uniforms[Z],l,Z)}bindUniformBuffer(Z,l){const C=this._uniformBuffersNames[l];void 0===C||W._BaseCache[C]===Z&&this._engine._features.useUBOBindingCache||(W._BaseCache[C]=Z,this._engine.bindUniformBufferBase(Z,C,l))}bindUniformBlock(Z,l){this._engine.bindUniformBlock(this._pipelineContext,Z,l)}setInt(Z,l){return this._pipelineContext.setInt(Z,l),this}setInt2(Z,l,C){return this._pipelineContext.setInt2(Z,l,C),this}setInt3(Z,l,C,B){return this._pipelineContext.setInt3(Z,l,C,B),this}setInt4(Z,l,C,B,x){return this._pipelineContext.setInt4(Z,l,C,B,x),this}setIntArray(Z,l){return this._pipelineContext.setIntArray(Z,l),this}setIntArray2(Z,l){return this._pipelineContext.setIntArray2(Z,l),this}setIntArray3(Z,l){return this._pipelineContext.setIntArray3(Z,l),this}setIntArray4(Z,l){return this._pipelineContext.setIntArray4(Z,l),this}setUInt(Z,l){return this._pipelineContext.setUInt(Z,l),this}setUInt2(Z,l,C){return this._pipelineContext.setUInt2(Z,l,C),this}setUInt3(Z,l,C,B){return this._pipelineContext.setUInt3(Z,l,C,B),this}setUInt4(Z,l,C,B,x){return this._pipelineContext.setUInt4(Z,l,C,B,x),this}setUIntArray(Z,l){return this._pipelineContext.setUIntArray(Z,l),this}setUIntArray2(Z,l){return this._pipelineContext.setUIntArray2(Z,l),this}setUIntArray3(Z,l){return this._pipelineContext.setUIntArray3(Z,l),this}setUIntArray4(Z,l){return this._pipelineContext.setUIntArray4(Z,l),this}setFloatArray(Z,l){return this._pipelineContext.setArray(Z,l),this}setFloatArray2(Z,l){return this._pipelineContext.setArray2(Z,l),this}setFloatArray3(Z,l){return this._pipelineContext.setArray3(Z,l),this}setFloatArray4(Z,l){return this._pipelineContext.setArray4(Z,l),this}setArray(Z,l){return this._pipelineContext.setArray(Z,l),this}setArray2(Z,l){return this._pipelineContext.setArray2(Z,l),this}setArray3(Z,l){return this._pipelineContext.setArray3(Z,l),this}setArray4(Z,l){return this._pipelineContext.setArray4(Z,l),this}setMatrices(Z,l){return this._pipelineContext.setMatrices(Z,l),this}setMatrix(Z,l){return this._pipelineContext.setMatrix(Z,l),this}setMatrix3x3(Z,l){return this._pipelineContext.setMatrix3x3(Z,l),this}setMatrix2x2(Z,l){return this._pipelineContext.setMatrix2x2(Z,l),this}setFloat(Z,l){return this._pipelineContext.setFloat(Z,l),this}setBool(Z,l){return this._pipelineContext.setInt(Z,l?1:0),this}setVector2(Z,l){return this._pipelineContext.setVector2(Z,l),this}setFloat2(Z,l,C){return this._pipelineContext.setFloat2(Z,l,C),this}setVector3(Z,l){return this._pipelineContext.setVector3(Z,l),this}setFloat3(Z,l,C,B){return this._pipelineContext.setFloat3(Z,l,C,B),this}setVector4(Z,l){return this._pipelineContext.setVector4(Z,l),this}setQuaternion(Z,l){return this._pipelineContext.setQuaternion(Z,l),this}setFloat4(Z,l,C,B,x){return this._pipelineContext.setFloat4(Z,l,C,B,x),this}setColor3(Z,l){return this._pipelineContext.setColor3(Z,l),this}setColor4(Z,l,C){return this._pipelineContext.setColor4(Z,l,C),this}setDirectColor4(Z,l){return this._pipelineContext.setDirectColor4(Z,l),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(W.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,K.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;l&&(b.b.GetShadersStore(B)[`${Z}PixelShader`]=l),C&&(b.b.GetShadersStore(B)[`${Z}VertexShader`]=C)}static ResetCache(){W._BaseCache={}}}W.LogShaderCodeOnCompilationError=!0,W.PersistentMode=!1,W.AutomaticallyClearCodeCache=!1,W._UniqueIdSeed=0,W._BaseCache={},W.ShadersStore=b.b.ShadersStore,W.IncludesShadersStore=b.b.IncludesShadersStore},12282:(Z,l,C)=>{C.d(l,{d:()=>x});const B={};function x(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!B[Z])return B[Z]=!0,`${Z} needs to be imported before as it contains a side-effect required by your code.`}},12255:(Z,l,C)=>{function B(){return"undefined"!==typeof window}function x(){return"undefined"!==typeof navigator}function b(){return"undefined"!==typeof document}function K(Z){let l="",C=Z.firstChild;for(;C;)3===C.nodeType&&(l+=C.textContent),C=C.nextSibling;return l}C.d(l,{c:()=>K,e:()=>b,i:()=>x,l:()=>B})},12263:(Z,l,C)=>{C.d(l,{e:()=>B});class B{static _CheckLimit(Z,l){let C=B._LogLimitOutputs[Z];return C?C.current++:(C={limit:l,current:1},B._LogLimitOutputs[Z]=C),C.current<=C.limit}static _GenerateLimitMessage(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const C=B._LogLimitOutputs[Z];if(!C||!B.MessageLimitReached)return;const x=this._Levels[l];C.current===C.limit&&B[x.name](B.MessageLimitReached.replace(/%LIMIT%/g,""+C.limit).replace(/%TYPE%/g,x.name??""))}static _AddLogEntry(Z){B._LogCache=Z+B._LogCache,B.OnNewCacheEntry&&B.OnNewCacheEntry(Z)}static _FormatMessage(Z){const l=Z=>Z<10?"0"+Z:""+Z,C=new Date;return"["+l(C.getHours())+":"+l(C.getMinutes())+":"+l(C.getSeconds())+"]: "+Z}static _LogDisabled(Z,l){}static _LogEnabled(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;const x=Array.isArray(l)?l[0]:l;if(void 0!==C&&!B._CheckLimit(x,C))return;const b=B._FormatMessage(x),K=this._Levels[Z],f=Array.isArray(l)?l.slice(1):[];K.logFunc&&K.logFunc("BJS - "+b,...f);const W=`<div style='color:${K.color}'>${b}</div><br>`;B._AddLogEntry(W),B._GenerateLimitMessage(x,Z)}static get LogCache(){return B._LogCache}static ClearLogCache(){B._LogCache="",B._LogLimitOutputs={},B.errorsCount=0}static set LogLevels(Z){B.Log=B._LogDisabled,B.Warn=B._LogDisabled,B.Error=B._LogDisabled;const l=[B.MessageLogLevel,B.WarningLogLevel,B.ErrorLogLevel];for(const C of l)if((Z&C)===C){const Z=this._Levels[C];B[Z.name]=B._LogEnabled.bind(B,C)}}}B.NoneLogLevel=0,B.MessageLogLevel=1,B.WarningLogLevel=2,B.ErrorLogLevel=4,B.AllLogLevel=7,B.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",B._LogCache="",B._LogLimitOutputs={},B._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],B.errorsCount=0,B.Log=B._LogEnabled.bind(B,B.MessageLogLevel),B.Warn=B._LogEnabled.bind(B,B.WarningLogLevel),B.Error=B._LogEnabled.bind(B,B.ErrorLogLevel)},12251:(Z,l,C)=>{C.d(l,{b:()=>K});const B="undefined"!==typeof WeakRef;class x{constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.initialize(Z,l,C,B)}initialize(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;return this.mask=Z,this.skipNextObservers=l,this.target=C,this.currentTarget=B,this}}class b{constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=Z,this.mask=l,this.scope=C,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(Z)}}class K{static FromPromise(Z,l){const C=new K;return Z.then((Z=>{C.notifyObservers(Z)})).catch((Z=>{if(!l)throw Z;l.notifyObservers(Z)})),C}get observers(){return this._observers}constructor(Z){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=l,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new x(0),Z&&(this._onObserverAdded=Z)}add(Z){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Z)return null;const x=new b(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);x.unregisterOnNextCall=C,l?this._observers.unshift(x):this._observers.push(x),this._onObserverAdded&&this._onObserverAdded(x),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(x,this._lastNotifiedValue);const K=B?new WeakRef(this):{deref:()=>this};return x._remove=function(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l=K.deref();l&&(Z?l.remove(x):l._remove(x))},x}addOnce(Z){return this.add(Z,void 0,void 0,void 0,!0)}remove(Z){if(!Z)return!1;Z._remove=null;return-1!==this._observers.indexOf(Z)&&(this._deferUnregister(Z),!0)}removeCallback(Z,l){for(let C=0;C<this._observers.length;C++){const B=this._observers[C];if(!B._willBeUnregistered&&(B.callback===Z&&(!l||l===B.scope)))return this._deferUnregister(B),!0}return!1}_deferUnregister(Z){Z._willBeUnregistered||(this._numObserversMarkedAsDeleted++,Z.unregisterOnNextCall=!1,Z._willBeUnregistered=!0,setTimeout((()=>{this._remove(Z)}),0))}_remove(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Z)return!1;const C=this._observers.indexOf(Z);return-1!==C&&(l&&this._numObserversMarkedAsDeleted--,this._observers.splice(C,1),!0)}makeObserverTopPriority(Z){this._remove(Z,!1),this._observers.unshift(Z)}makeObserverBottomPriority(Z){this._remove(Z,!1),this._observers.push(Z)}notifyObservers(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,C=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Z),!this._observers.length)return!0;const b=this._eventState;b.mask=l,b.target=C,b.currentTarget=B,b.skipNextObservers=!1,b.lastReturnValue=Z,b.userInfo=x;for(const K of this._observers)if(!K._willBeUnregistered&&(K.mask&l&&(K.unregisterOnNextCall&&this._deferUnregister(K),K.scope?b.lastReturnValue=K.callback.apply(K.scope,[Z,b]):b.lastReturnValue=K.callback(Z,b)),b.skipNextObservers))return!1;return!0}notifyObserver(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=l),Z._willBeUnregistered)return;const B=this._eventState;B.mask=C,B.skipNextObservers=!1,Z.unregisterOnNextCall&&this._deferUnregister(Z),Z.callback(l,B)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const Z=this._observers.pop();Z&&(Z._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const Z=new K;return Z._observers=this._observers.slice(0),Z}hasSpecificMask(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const l of this._observers)if(l.mask&Z||l.mask===Z)return!0;return!1}}},12339:(Z,l,C)=>{C.d(l,{c:()=>x,d:()=>K});let B=[];class x{static SetImmediate(Z){0===B.length&&setTimeout((()=>{const Z=B;B=[];for(const l of Z)l()}),1),B.push(Z)}}function b(Z,l,C){try{if(Z())return l(),!0}catch(B){return null===C||void 0===C||C(B),!0}return!1}const K=function(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,K=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&b(Z,l,C))return null;const f=setInterval((()=>{b(Z,l,C)?clearInterval(f):(x-=B,x<0&&(clearInterval(f),null===C||void 0===C||C(new Error("Operation timed out after maximum retries. "+(K||"")),!0)))}),B);return()=>clearInterval(f)}}}]);