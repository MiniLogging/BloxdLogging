"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{2440:(K,Y,l)=>{l.r(Y),l.d(Y,{Dispose:()=>M,DumpData:()=>V,DumpDataAsync:()=>m,DumpFramebuffer:()=>Z,DumpTools:()=>u});var v=l(2331),U=l(475),d=l(695),A=l(526);let c,t=null;async function Z(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0;const c=await l.readPixels(0,0,K,Y);V(K,Y,new Uint8Array(c.buffer),v,U,d,!0,void 0,A)}function m(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0;return new Promise((t=>{V(K,Y,l,(K=>t(K)),v,U,d,A,c)}))}function V(K,Y,Z,m){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((K,Y)=>{let U,d=null;const t={Qk:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};l.e(22).then(l.bind(l,12001)).then((Z=>{let{ThinEngine:m}=Z;try{U=new OffscreenCanvas(100,100),d=new m(U,!1,t)}catch(u){U=document.createElement("canvas"),d=new m(U,!1,t)}A.e.Instances.pop(),A.e.OnEnginesDisposedObservable.add((K=>{d&&K!==d&&!d.u&&0===A.e.Instances.length&&M()})),d.getCaps().parallelShaderCompile=void 0;const V=new v.e(d);l.e(33).then(l.bind(l,12955)).then((l=>{let{passPixelShader:A}=l;if(!d)return void Y("Engine is not defined");const t=new v.f({Ii:d,name:A.name,fragmentShader:A.shader,samplerNames:["textureSampler"]});c={canvas:U,Ii:d,renderer:V,wrapper:t},K(c)}))})).catch(Y)}))),await t})().then((l=>{if(l.Ii.setSize(K,Y,!0),Z instanceof Float32Array){const K=new Uint8Array(Z.length);let Y=Z.length;for(;Y--;){const l=Z[Y];K[Y]=Math.round(255*(0,d.d)(l))}Z=K}const v=l.Ii.createRawTexture(Z,K,Y,5,!1,!o,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",v),l.renderer.draw(),W?U.d.ToBlob(l.canvas,(K=>{const Y=new FileReader;Y.onload=K=>{const Y=K.target.result;m&&m(Y)},Y.readAsArrayBuffer(K)}),V,g):U.d.EncodeScreenshotCanvasData(l.canvas,m,V,u,g),v.dispose()}))}function M(){var K;c?(c.wrapper.dispose(),c.renderer.dispose(),c.Ii.dispose()):null===(K=t)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.Ii.dispose()}));t=null,c=null}const u={DumpData:V,DumpDataAsync:m,DumpFramebuffer:Z,Dispose:M};U.d.DumpData=V,U.d.DumpDataAsync=m,U.d.DumpFramebuffer=Z}}]);