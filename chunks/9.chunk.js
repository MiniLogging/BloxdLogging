"use strict";(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[9],{12746:(Y,c,h)=>{h.d(c,{b:()=>a,f:()=>X,l:()=>Z,i:()=>V,n:()=>U});class C{constructor(){this.children=[]}isValid(Y){return!0}process(Y,c,h){let C="";if(this.line){let h=this.line;const W=c.processor;if(W){var E,N,Q,b,H,w;W.lineProcessor&&(h=W.lineProcessor(h,c.isFragment,c.processingContext));const C=(null===(E=c.processor)||void 0===E?void 0:E.attributeKeywordName)??"attribute",q=c.isFragment&&null!==(N=c.processor)&&void 0!==N&&N.varyingFragmentKeywordName?null===(Q=c.processor)||void 0===Q?void 0:Q.varyingFragmentKeywordName:!c.isFragment&&null!==(b=c.processor)&&void 0!==b&&b.varyingVertexKeywordName?null===(H=c.processor)||void 0===H?void 0:H.varyingVertexKeywordName:"varying";if(!c.isFragment&&W.attributeProcessor&&this.line.startsWith(C))h=W.attributeProcessor(this.line,Y,c.processingContext);else if(W.varyingProcessor&&(null!==(w=W.varyingCheck)&&void 0!==w&&w.call(W,this.line,c.isFragment)||!W.varyingCheck&&this.line.startsWith(q)))h=W.varyingProcessor(this.line,c.isFragment,Y,c.processingContext);else if(W.uniformProcessor&&W.uniformRegexp&&W.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(h=W.uniformProcessor(this.line,c.isFragment,Y,c.processingContext));else if(W.uniformBufferProcessor&&W.uniformBufferRegexp&&W.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(h=W.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(W.textureProcessor&&W.textureRegexp&&W.textureRegexp.test(this.line))h=W.textureProcessor(this.line,c.isFragment,Y,c.processingContext);else if((W.uniformProcessor||W.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?W.uniformProcessor&&(h=W.uniformProcessor(this.line,c.isFragment,Y,c.processingContext)):W.uniformBufferProcessor&&(h=W.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,W.endOfUniformBufferProcessor&&(h=W.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}C+=h+"\n"}for(const W of this.children)C+=W.process(Y,c,h);return this.additionalDefineKey&&(Y[this.additionalDefineKey]=this.additionalDefineValue||"true",h[this.additionalDefineKey]=Y[this.additionalDefineKey]),C}}class E{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(Y){this._lines.length=0;for(const c of Y){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const Y=c.trim();if(!Y)continue;if(Y.startsWith("//")){this._lines.push(c);continue}const h=Y.indexOf(";");if(-1===h)this._lines.push(Y);else if(h===Y.length-1)Y.length>1&&this._lines.push(Y);else{const Y=c.split(";");for(let c=0;c<Y.length;c++){let h=Y[c];h&&(h=h.trim(),h&&this._lines.push(h+(c!==Y.length-1?";":"")))}}}}}class N extends C{process(Y,c,h){for(let C=0;C<this.children.length;C++){const E=this.children[C];if(E.isValid(Y))return E.process(Y,c,h)}return""}}class Q extends C{isValid(Y){return this.testExpression.isTrue(Y)}}class b{isTrue(Y){return!0}static postfixToInfix(Y){const c=[];for(const h of Y)if(void 0===b._OperatorPriority[h])c.push(h);else{const Y=c[c.length-1],C=c[c.length-2];c.length-=2,c.push(`(${C}${h}${Y})`)}return c[c.length-1]}static infixToPostfix(Y){const c=b._InfixToPostfixCache.get(Y);if(c)return c.accessTime=Date.now(),c.result;if(!Y.includes("&&")&&!Y.includes("||")&&!Y.includes(")")&&!Y.includes("("))return[Y];const h=[];let C=-1;const E=()=>{W=W.trim(),""!==W&&(h.push(W),W="")},N=Y=>{C<b._Stack.length-1&&(b._Stack[++C]=Y)},Q=()=>b._Stack[C],H=()=>-1===C?"!!INVALID EXPRESSION!!":b._Stack[C--];let w=0,W="";for(;w<Y.length;){const c=Y.charAt(w),q=w<Y.length-1?Y.substring(w,2+w):"";if("("===c)W="",N(c);else if(")"===c){for(E();-1!==C&&"("!==Q();)h.push(H());H()}else if(b._OperatorPriority[q]>1){for(E();-1!==C&&b._OperatorPriority[Q()]>=b._OperatorPriority[q];)h.push(H());N(q),w++}else W+=c;w++}for(E();-1!==C;)"("===Q()?H():h.push(H());return b._InfixToPostfixCache.size>=b.InfixToPostfixCacheLimitSize&&b.ClearCache(),b._InfixToPostfixCache.set(Y,{result:h,accessTime:Date.now()}),h}static ClearCache(){const Y=Array.from(b._InfixToPostfixCache.entries()).sort(((Y,c)=>Y[1].accessTime-c[1].accessTime));for(let c=0;c<b.InfixToPostfixCacheCleanupSize;c++)b._InfixToPostfixCache.delete(Y[c][0])}}b.InfixToPostfixCacheLimitSize=5e4,b.InfixToPostfixCacheCleanupSize=25e3,b._InfixToPostfixCache=new Map,b._OperatorPriority={")":0,"(":1,"||":2,"&&":3},b._Stack=["","","","","","","","","","","","","","","","","","","",""];class H extends b{constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=Y,this.not=c}isTrue(Y){let c=void 0!==Y[this.define];return this.not&&(c=!c),c}}class w extends b{isTrue(Y){return this.leftOperand.isTrue(Y)||this.rightOperand.isTrue(Y)}}class W extends b{isTrue(Y){return this.leftOperand.isTrue(Y)&&this.rightOperand.isTrue(Y)}}class q extends b{constructor(Y,c,h){super(),this.define=Y,this.operand=c,this.testValue=h}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(Y){let c=!1;const h=parseInt(void 0!=Y[this.define]?Y[this.define]:this.define),C=parseInt(void 0!=Y[this.testValue]?Y[this.testValue]:this.testValue);if(isNaN(h)||isNaN(C))return!1;switch(this.operand){case">":c=h>C;break;case"<":c=h<C;break;case"<=":c=h<=C;break;case">=":c=h>=C;break;case"==":c=h===C;break;case"!=":c=h!==C}return c}}var k=h(12715),M=h(12748);const p=/defined\s*?\((.+?)\)/g,P=/defined\s*?\[(.+?)\]/g,y=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,d=/__decl__/,D=/light\{X\}.(\w*)/g,T=/\{X\}/g,e=[],r=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function X(Y){Y.processor&&Y.processor.initializeShaders&&Y.processor.initializeShaders(Y.processingContext)}function Z(Y,c,h,C){var E;null!==(E=c.processor)&&void 0!==E&&E.preProcessShaderCode&&(Y=c.processor.preProcessShaderCode(Y,c.isFragment)),V(Y,c,(Y=>{c.processCodeAfterIncludes&&(Y=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",Y,c.defines));const E=function(Y,c,h){let C=function(Y,c){var h;if(null!==(h=c.processor)&&void 0!==h&&h.noPrecision)return Y;const C=c.shouldUseHighPrecisionShader;-1===Y.indexOf("precision highp float")?Y=C?"precision highp float;\n"+Y:"precision mediump float;\n"+Y:C||(Y=Y.replace("precision highp float","precision mediump float"));return Y}(Y,c);if(!c.processor)return C;if(0===c.processor.shaderLanguage&&-1!==C.indexOf("#version 3")&&(C=C.replace("#version 300 es",""),!c.processor.parseGLES3))return C;const E=c.defines,N=A(c,h);c.processor.preProcessor&&(C=c.processor.preProcessor(C,E,N,c.isFragment,c.processingContext));const Q={};C=x(C,N,c,Q),c.processor.postProcessor&&(C=c.processor.postProcessor(C,E,c.isFragment,c.processingContext,h?{drawBuffersExtensionDisabled:!h.getCaps().drawBuffersExtension}:{},N,Q));null!==h&&void 0!==h&&h._features.needShaderCodeInlining&&(C=h.inlineShaderCode(C));return C}(Y,c,C);h(E,Y)}))}function a(Y,c,h){return h.processor&&h.processor.finalizeShaders?h.processor.finalizeShaders(Y,c,h.processingContext):{vertexCode:Y,fragmentCode:c}}function G(Y){const c=/defined\((.+)\)/.exec(Y);if(c&&c.length)return new H(c[1].trim(),"!"===Y[0]);const h=["==","!=",">=","<=","<",">"];let C="",E=0;for(C of h)if(E=Y.indexOf(C),E>-1)break;if(-1===E)return new H(Y);const N=Y.substring(0,E).trim(),Q=Y.substring(E+C.length).trim();return new q(N,C,Q)}function K(Y,c){const h=new Q,C=Y.substring(0,c);let E=Y.substring(c);return E=E.substring(0,(E.indexOf("//")+1||E.length+1)-1).trim(),h.testExpression="#ifdef"===C?new H(E):"#ifndef"===C?new H(E,!0):function(Y){Y=Y.replace(p,"defined[$1]");const c=b.infixToPostfix(Y),h=[];for(const E of c)if("||"!==E&&"&&"!==E)h.push(E);else if(h.length>=2){let Y=h[h.length-1],c=h[h.length-2];h.length-=2;const C="&&"==E?new W:new w;"string"===typeof Y&&(Y=Y.replace(P,"defined($1)")),"string"===typeof c&&(c=c.replace(P,"defined($1)")),C.leftOperand="string"===typeof c?G(c):c,C.rightOperand="string"===typeof Y?G(Y):Y,h.push(C)}let C=h[h.length-1];return"string"===typeof C&&(C=C.replace(P,"defined($1)")),"string"===typeof C?G(C):C}(E),h}function I(Y,c,h,E){let N=Y.currentLine;for(;s(Y,h,E);){N=Y.currentLine;const Q=N.substring(0,5).toLowerCase();if("#else"===Q){const h=new C;return c.children.push(h),void s(Y,h,E)}if("#elif"===Q){const Y=K(N,5);c.children.push(Y),h=Y}}}function s(Y,c,h){for(;Y.canRead;){Y.lineIndex++;const E=Y.currentLine;if(E.indexOf("#")>=0){const C=r.exec(E);if(C&&C.length){switch(C[0]){case"#ifdef":{const C=new N;c.children.push(C);const Q=K(E,6);C.children.push(Q),I(Y,C,Q,h);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const C=new N;c.children.push(C);const Q=K(E,7);C.children.push(Q),I(Y,C,Q,h);break}case"#if":{const C=new N,Q=K(E,3);c.children.push(C),C.children.push(Q),I(Y,C,Q,h);break}}continue}}const Q=new C;if(Q.line=E,c.children.push(Q),"#"===E[0]&&"d"===E[1]){const Y=E.replace(";","").split(" ");Q.additionalDefineKey=Y[1],3===Y.length&&(Q.additionalDefineValue=Y[2])}}return!1}function x(Y,c,h,N){const Q=new C,b=new E;return b.lineIndex=-1,b.lines=Y.split("\n"),s(b,Q,N),Q.process(c,h,N)}function A(Y,c){var h;const C=Y.defines,E={};for(const N of C){const Y=N.replace("#define","").replace(";","").trim().split(" ");E[Y[0]]=Y.length>1?Y[1]:""}return 0===(null===(h=Y.processor)||void 0===h?void 0:h.shaderLanguage)&&(E.GL_ES="true"),E.__VERSION__=Y.version,E[Y.platformName]="true",(0,M.h)(E,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.o,null===c||void 0===c?void 0:c.useExactSrgbConversions),E}function V(Y,c,h){let C;for(e.length=0;null!==(C=y.exec(Y));)e.push(C);let E=String(Y),N=[Y],Q=!1;for(const b of e){let Y=b[1];if(-1!==Y.indexOf("__decl__")&&(Y=Y.replace(d,""),c.supportsUniformBuffers&&(Y=Y.replace("Vertex","Ubo").replace("Fragment","Ubo")),Y+="Declaration"),!c.includesShadersStore[Y]){const C=c.shadersRepository+"ShadersInclude/"+Y+".fx";return void U.loadFile(C,(C=>{c.includesShadersStore[Y]=C,V(N.join(""),c,h)}))}{let h=c.includesShadersStore[Y];if(b[2]){const Y=b[3].split(",");for(let c=0;c<Y.length;c+=2){const C=new RegExp(Y[c],"g"),E=Y[c+1];h=h.replace(C,E)}}if(b[4]){const Y=b[5];if(-1!==Y.indexOf("..")){const C=Y.split(".."),E=parseInt(C[0]);let N=parseInt(C[1]),Q=h.slice(0);h="",isNaN(N)&&(N=c.indexParameters[C[1]]);for(let Y=E;Y<N;Y++)c.supportsUniformBuffers||(Q=Q.replace(D,((Y,c)=>c+"{X}"))),h+=Q.replace(T,Y.toString())+"\n"}else c.supportsUniformBuffers||(h=h.replace(D,((Y,c)=>c+"{X}"))),h=h.replace(T,Y)}const C=[];for(const Y of N){const c=Y.split(b[0]);for(let Y=0;Y<c.length-1;Y++)C.push(c[Y]),C.push(h);C.push(c[c.length-1])}N=C,Q=Q||h.indexOf("#include<")>=0||h.indexOf("#include <")>=0}}e.length=0,E=N.join(""),Q?V(E.toString(),c,h):h(E)}const U={loadFile:(Y,c,h,C,E,N)=>{throw(0,k.c)("FileTools")}}},12748:(Y,c,h)=>{h.d(c,{b:()=>E,d:()=>N,h:()=>b,l:()=>Q,o:()=>H});var C=h(12715);h(12693);const E={};function N(Y,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+Y}function Q(Y,c,h,N,Q,b,H){const w=H||E.loadFile;if(w){return w(Y,c,h,N,Q,b)}throw(0,C.c)("FileTools")}function b(Y,c,h,C){if(Y)return c?Y.IS_NDC_HALF_ZRANGE="":delete Y.IS_NDC_HALF_ZRANGE,h?Y.USE_REVERSE_DEPTHBUFFER="":delete Y.USE_REVERSE_DEPTHBUFFER,void(C?Y.USE_EXACT_SRGB_CONVERSIONS="":delete Y.USE_EXACT_SRGB_CONVERSIONS);{let Y="";return c&&(Y+="#define IS_NDC_HALF_ZRANGE"),h&&(Y&&(Y+="\n"),Y+="#define USE_REVERSE_DEPTHBUFFER"),C&&(Y&&(Y+="\n"),Y+="#define USE_EXACT_SRGB_CONVERSIONS"),Y}}function H(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;switch(Y){case 3:{const Y=(ArrayBuffer,new Int8Array(c));return C&&Y.set(new Int8Array(C)),Y}case 0:{const Y=(ArrayBuffer,new Uint8Array(c));return C&&Y.set(new Uint8Array(C)),Y}case 4:{const Y=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(h?c/2:c);return C&&Y.set(new Int16Array(C)),Y}case 5:case 8:case 9:case 10:case 2:{const Y=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(h?c/2:c);return C&&Y.set(new Uint16Array(C)),Y}case 6:{const Y=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(h?c/4:c);return C&&Y.set(new Int32Array(C)),Y}case 7:case 11:case 12:case 13:case 14:case 15:{const Y=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(h?c/4:c);return C&&Y.set(new Uint32Array(C)),Y}case 1:{const Y=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(h?c/4:c);return C&&Y.set(new Float32Array(C)),Y}}const E=(ArrayBuffer,new Uint8Array(c));return C&&E.set(new Uint8Array(C)),E}},12779:(Y,c,h)=>{h.d(c,{b:()=>C});class C{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersRepository:C.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersStore:C.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.IncludesShadersStore:C.IncludesShadersStoreWGSL}}C.ShadersRepository="src/Shaders/",C.ShadersStore={},C.IncludesShadersStore={},C.ShadersRepositoryWGSL="src/ShadersWGSL/",C.ShadersStoreWGSL={},C.IncludesShadersStoreWGSL={}},12795:(Y,c,h)=>{h.d(c,{c:()=>k,e:()=>T,i:()=>p,m:()=>M,p:()=>P,s:()=>D,u:()=>q,w:()=>w,y:()=>W,C:()=>H,E:()=>b});class C{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Qh._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(Y){Y&&this.program&&Y(this.program)}setEngine(Y){this.Qh=Y}_fillEffectInformation(Y,c,h,C,E,N,Q,b){const H=this.Qh;if(H.supportsUniformBuffers)for(const W in c)Y.bindUniformBlock(W,c[W]);let w;for(this.Qh.getUniforms(this,h).forEach(((Y,c)=>{C[h[c]]=Y})),this._uniforms=C,w=0;w<E.length;w++){null==Y.getUniform(E[w])&&(E.splice(w,1),w--)}E.forEach(((Y,c)=>{N[Y]=c}));for(const W of H.getAttributes(this,Q))b.push(W)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(Y,c){const h=this._valueCache[Y],C=c.updateFlag;return(void 0===h||h!==C)&&(this._valueCache[Y]=C,!0)}_cacheFloat2(Y,c,h){let C=this._valueCache[Y];if(!C||2!==C.length)return C=[c,h],this._valueCache[Y]=C,!0;let E=!1;return C[0]!==c&&(C[0]=c,E=!0),C[1]!==h&&(C[1]=h,E=!0),E}_cacheFloat3(Y,c,h,C){let E=this._valueCache[Y];if(!E||3!==E.length)return E=[c,h,C],this._valueCache[Y]=E,!0;let N=!1;return E[0]!==c&&(E[0]=c,N=!0),E[1]!==h&&(E[1]=h,N=!0),E[2]!==C&&(E[2]=C,N=!0),N}_cacheFloat4(Y,c,h,C,E){let N=this._valueCache[Y];if(!N||4!==N.length)return N=[c,h,C,E],this._valueCache[Y]=N,!0;let Q=!1;return N[0]!==c&&(N[0]=c,Q=!0),N[1]!==h&&(N[1]=h,Q=!0),N[2]!==C&&(N[2]=C,Q=!0),N[3]!==E&&(N[3]=E,Q=!0),Q}setInt(Y,c){const h=this._valueCache[Y];void 0!==h&&h===c||this.Qh.setInt(this._uniforms[Y],c)&&(this._valueCache[Y]=c)}setInt2(Y,c,h){this._cacheFloat2(Y,c,h)&&(this.Qh.setInt2(this._uniforms[Y],c,h)||(this._valueCache[Y]=null))}setInt3(Y,c,h,C){this._cacheFloat3(Y,c,h,C)&&(this.Qh.setInt3(this._uniforms[Y],c,h,C)||(this._valueCache[Y]=null))}setInt4(Y,c,h,C,E){this._cacheFloat4(Y,c,h,C,E)&&(this.Qh.setInt4(this._uniforms[Y],c,h,C,E)||(this._valueCache[Y]=null))}setIntArray(Y,c){this._valueCache[Y]=null,this.Qh.setIntArray(this._uniforms[Y],c)}setIntArray2(Y,c){this._valueCache[Y]=null,this.Qh.setIntArray2(this._uniforms[Y],c)}setIntArray3(Y,c){this._valueCache[Y]=null,this.Qh.setIntArray3(this._uniforms[Y],c)}setIntArray4(Y,c){this._valueCache[Y]=null,this.Qh.setIntArray4(this._uniforms[Y],c)}setUInt(Y,c){const h=this._valueCache[Y];void 0!==h&&h===c||this.Qh.setUInt(this._uniforms[Y],c)&&(this._valueCache[Y]=c)}setUInt2(Y,c,h){this._cacheFloat2(Y,c,h)&&(this.Qh.setUInt2(this._uniforms[Y],c,h)||(this._valueCache[Y]=null))}setUInt3(Y,c,h,C){this._cacheFloat3(Y,c,h,C)&&(this.Qh.setUInt3(this._uniforms[Y],c,h,C)||(this._valueCache[Y]=null))}setUInt4(Y,c,h,C,E){this._cacheFloat4(Y,c,h,C,E)&&(this.Qh.setUInt4(this._uniforms[Y],c,h,C,E)||(this._valueCache[Y]=null))}setUIntArray(Y,c){this._valueCache[Y]=null,this.Qh.setUIntArray(this._uniforms[Y],c)}setUIntArray2(Y,c){this._valueCache[Y]=null,this.Qh.setUIntArray2(this._uniforms[Y],c)}setUIntArray3(Y,c){this._valueCache[Y]=null,this.Qh.setUIntArray3(this._uniforms[Y],c)}setUIntArray4(Y,c){this._valueCache[Y]=null,this.Qh.setUIntArray4(this._uniforms[Y],c)}setArray(Y,c){this._valueCache[Y]=null,this.Qh.setArray(this._uniforms[Y],c)}setArray2(Y,c){this._valueCache[Y]=null,this.Qh.setArray2(this._uniforms[Y],c)}setArray3(Y,c){this._valueCache[Y]=null,this.Qh.setArray3(this._uniforms[Y],c)}setArray4(Y,c){this._valueCache[Y]=null,this.Qh.setArray4(this._uniforms[Y],c)}setMatrices(Y,c){c&&(this._valueCache[Y]=null,this.Qh.setMatrices(this._uniforms[Y],c))}setMatrix(Y,c){this._cacheMatrix(Y,c)&&(this.Qh.setMatrices(this._uniforms[Y],c.Xc())||(this._valueCache[Y]=null))}setMatrix3x3(Y,c){this._valueCache[Y]=null,this.Qh.setMatrix3x3(this._uniforms[Y],c)}setMatrix2x2(Y,c){this._valueCache[Y]=null,this.Qh.setMatrix2x2(this._uniforms[Y],c)}setFloat(Y,c){const h=this._valueCache[Y];void 0!==h&&h===c||this.Qh.setFloat(this._uniforms[Y],c)&&(this._valueCache[Y]=c)}setVector2(Y,c){this._cacheFloat2(Y,c.x,c.y)&&(this.Qh.setFloat2(this._uniforms[Y],c.x,c.y)||(this._valueCache[Y]=null))}setFloat2(Y,c,h){this._cacheFloat2(Y,c,h)&&(this.Qh.setFloat2(this._uniforms[Y],c,h)||(this._valueCache[Y]=null))}setVector3(Y,c){this._cacheFloat3(Y,c.x,c.y,c.z)&&(this.Qh.setFloat3(this._uniforms[Y],c.x,c.y,c.z)||(this._valueCache[Y]=null))}setFloat3(Y,c,h,C){this._cacheFloat3(Y,c,h,C)&&(this.Qh.setFloat3(this._uniforms[Y],c,h,C)||(this._valueCache[Y]=null))}setVector4(Y,c){this._cacheFloat4(Y,c.x,c.y,c.z,c.w)&&(this.Qh.setFloat4(this._uniforms[Y],c.x,c.y,c.z,c.w)||(this._valueCache[Y]=null))}setQuaternion(Y,c){this._cacheFloat4(Y,c.x,c.y,c.z,c.w)&&(this.Qh.setFloat4(this._uniforms[Y],c.x,c.y,c.z,c.w)||(this._valueCache[Y]=null))}setFloat4(Y,c,h,C,E){this._cacheFloat4(Y,c,h,C,E)&&(this.Qh.setFloat4(this._uniforms[Y],c,h,C,E)||(this._valueCache[Y]=null))}setColor3(Y,c){this._cacheFloat3(Y,c.r,c.g,c.b)&&(this.Qh.setFloat3(this._uniforms[Y],c.r,c.g,c.b)||(this._valueCache[Y]=null))}setColor4(Y,c,h){this._cacheFloat4(Y,c.r,c.g,c.b,h)&&(this.Qh.setFloat4(this._uniforms[Y],c.r,c.g,c.b,h)||(this._valueCache[Y]=null))}setDirectColor4(Y,c){this._cacheFloat4(Y,c.r,c.g,c.b,c.a)&&(this.Qh.setFloat4(this._uniforms[Y],c.r,c.g,c.b,c.a)||(this._valueCache[Y]=null))}_getVertexShaderCode(){return this.vertexShader?this.Qh._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Qh._getShaderSource(this.fragmentShader):null}}var E=h(12748);const N=new WeakMap,Q={_webGLVersion:2,cachedPipelines:{}};function b(Y){let c=N.get(Y);if(!c){if(!Y)return Q;c={_webGLVersion:Y.TEXTURE_BINDING_3D?2:1,_context:Y,parallelShaderCompile:Y.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},N.set(Y,c)}return c}function H(Y){N.delete(Y)}function w(Y,c,h,C,E,N){const Q=b(C);N||(N=Q._createShaderProgramInjection??k);return N(Y,d(c,"vertex",C,Q._contextWasLost),d(h,"fragment",C,Q._contextWasLost),C,E,Q.validateShaderPrograms)}function W(Y,c,h,C,E){let N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6?arguments[6]:void 0;const H=b(E);Q||(Q=H._createShaderProgramInjection??k);const w=H._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Q(Y,y(c,"vertex",C,w,E,H._contextWasLost),y(h,"fragment",C,w,E,H._contextWasLost),E,N,H.validateShaderPrograms)}function q(Y,c){const h=new C,E=b(Y);return E.parallelShaderCompile&&!E.disableParallelShaderCompile&&(h.isParallelCompiled=!0),h.context=E._context,h}function k(Y,c,h,C){let E=arguments.length>5?arguments[5]:void 0;const N=C.createProgram();if(Y.program=N,!N)throw new Error("Unable to create program");return C.attachShader(N,c),C.attachShader(N,h),C.linkProgram(N),Y.context=C,Y.vertexShader=c,Y.fragmentShader=h,Y.isParallelCompiled||p(Y,C,E),N}function M(Y,c,h){const C=Y;if(C._isDisposed)return!1;const E=b(c);return!!(E&&E.parallelShaderCompile&&E.parallelShaderCompile.COMPLETION_STATUS_KHR&&C.program&&c.getProgramParameter(C.program,E.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(p(C,c,h),!0)}function p(Y,c,h){const C=Y.context,E=Y.vertexShader,N=Y.fragmentShader,Q=Y.program;if(!C.getProgramParameter(Q,C.LINK_STATUS)){if(!c.getShaderParameter(E,c.COMPILE_STATUS)){const h=c.getShaderInfoLog(E);if(h)throw Y.vertexCompilationError=h,new Error("VERTEX SHADER "+h)}if(!c.getShaderParameter(N,c.COMPILE_STATUS)){const h=c.getShaderInfoLog(N);if(h)throw Y.fragmentCompilationError=h,new Error("FRAGMENT SHADER "+h)}const h=C.getProgramInfoLog(Q);if(h)throw Y.programLinkError=h,new Error(h)}if(h){C.validateProgram(Q);if(!C.getProgramParameter(Q,C.VALIDATE_STATUS)){const c=C.getProgramInfoLog(Q);if(c)throw Y.programValidationError=c,new Error(c)}}C.deleteShader(E),C.deleteShader(N),Y.vertexShader=void 0,Y.fragmentShader=void 0,Y.onCompiled&&(Y.onCompiled(),Y.onCompiled=void 0)}function P(Y,c,h,C,E,N,Q,H,q){let k=arguments.length>10?arguments[10]:void 0,M=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0;const P=b(Y.context);M||(M=P.createRawShaderProgramInjection??w),p||(p=P.createShaderProgramInjection??W);const y=Y;y.program=C?M(y,c,h,y.context,q):p(y,c,h,H,y.context,q),y.program.__SPECTOR_rebuildProgram=Q,k()}function y(Y,c,h,C,N,Q){return d((0,E.d)(Y,h,C),c,N,Q)}function d(Y,c,h,C){const E=h.createShader("vertex"===c?h.VERTEX_SHADER:h.FRAGMENT_SHADER);if(!E){let Y=h.NO_ERROR,E=h.NO_ERROR;for(;(E=h.getError())!==h.NO_ERROR;)Y=E;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${Y}, gl isContextLost=${h.isContextLost()}, _contextWasLost=${C}`)}return h.shaderSource(E,Y),h.compileShader(E),E}function D(Y,c){c.useProgram(Y)}function T(Y,c){const h=Y;if(!h.isParallelCompiled)return void c(Y);const C=h.onCompiled;h.onCompiled=()=>{null===C||void 0===C||C(),c(Y)}}},12787:(Y,c,h)=>{h.d(c,{d:()=>q,f:()=>M,h:()=>w,i:()=>W});var C=h(12693),E=h(12795),N=h(12779),Q=h(12700),b=h(12746),H=h(12748);function w(Y,c){return(0,E.E)(c).cachedPipelines[Y]}function W(Y){const c=Y._name,h=Y.context;if(c&&h){const Y=(0,E.E)(h),C=Y.cachedPipelines[c];null===C||void 0===C||C.dispose(),delete Y.cachedPipelines[c]}}function q(Y,c,h,E,N,Q,H){let w,W;const q=(0,C.k)()?null===Q||void 0===Q?void 0:Q.getHostDocument():null;w="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===q||void 0===q?void 0:q.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,W="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===q||void 0===q?void 0:q.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const M=[void 0,void 0],p=()=>{if(M[0]&&M[1]){Y.isFragment=!0;const[C,w]=M;(0,b.l)(w,Y,((Q,w)=>{H&&(H._fragmentSourceCodeBeforeMigration=w),h&&(Q=h("fragment",Q));const W=(0,b.b)(C,Q,Y);Y=null;const q=function(Y,c,h,C){if(h){return{vertexSourceCode:(1===C?"//":"")+"#define SHADER_NAME vertex:"+(h.vertexElement||h.vertex||h.spectorName||h)+"\n"+Y,fragmentSourceCode:(1===C?"//":"")+"#define SHADER_NAME fragment:"+(h.fragmentElement||h.fragment||h.spectorName||h)+"\n"+c}}return{vertexSourceCode:Y,fragmentSourceCode:c}}(W.vertexCode,W.fragmentCode,c,N);null===E||void 0===E||E(q.vertexSourceCode,q.fragmentSourceCode)}),Q)}};k(w,"Vertex","",(c=>{(0,b.f)(Y),(0,b.l)(c,Y,((Y,C)=>{H&&(H._rawVertexSourceCode=c,H._vertexSourceCodeBeforeMigration=C),h&&(Y=h("vertex",Y)),M[0]=Y,p()}),Q)}),N),k(W,"Fragment","Pixel",(Y=>{H&&(H._rawFragmentSourceCode=Y),M[1]=Y,p()}),N)}function k(Y,c,h,E,Q,b){if("undefined"!==typeof HTMLElement&&Y instanceof HTMLElement){return void E((0,C.c)(Y))}if("source:"===Y.substring(0,7))return void E(Y.substring(7));if("base64:"===Y.substring(0,7)){return void E(window.atob(Y.substring(7)))}const w=N.b.GetShadersStore(Q);if(w[Y+c+"Shader"])return void E(w[Y+c+"Shader"]);if(h&&w[Y+h+"Shader"])return void E(w[Y+h+"Shader"]);let W;if(W="."===Y[0]||"/"===Y[0]||Y.indexOf("http")>-1?Y:N.b.GetShadersRepository(Q)+Y,!(b=b||H.l))throw new Error("loadFileInjection is not defined");b(W+"."+c.toLowerCase()+".fx",E)}const M=(Y,c,h,C)=>{try{const N=Y.context?(0,E.E)(Y.context):null;N&&(N.disableParallelShaderCompile=Y.disableParallelCompilation);const Q=Y.existingPipelineContext||c(Y.shaderProcessingContext);return Q._name=Y.name,Y.name&&N&&(N.cachedPipelines[Y.name]=Q),h(Q,Y.vertex,Y.fragment,!!Y.createAsRaw,"","",Y.rebuildRebind,Y.defines,Y.transformFeedbackVaryings,"",(()=>{C(Q,(()=>{var c;null===(c=Y.onRenderingStateCompiled)||void 0===c||c.call(Y,Q)}))})),Q}catch(N){throw Q.e.Error("Error compiling effect"),N}}},12770:(Y,c,h)=>{h.r(c),h.d(c,{Effect:()=>H});var C=h(12690),E=h(12700),N=h(12779),Q=h(12787),b=h(12756);class H{static get ShadersRepository(){return N.b.ShadersRepository}static set ShadersRepository(Y){N.b.ShadersRepository=Y}get q(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new C.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9?arguments[9]:void 0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,P=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new C.c,this.onErrorObservable=new C.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=Y,this._key=M;const y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let d;if(c.attributes){const Y=c;if(this._engine=h,this._attributesNames=Y.attributes,this._uniformsNames=Y.uniformsNames.concat(Y.samplers),this._samplerList=Y.samplers.slice(),this.defines=Y.defines,this.onError=Y.onError,this.onCompiled=Y.onCompiled,this._fallbacks=Y.fallbacks,this._indexParameters=Y.indexParameters,this._transformFeedbackVaryings=Y.transformFeedbackVaryings||null,this._multiTarget=!!Y.multiTarget,this._shaderLanguage=Y.shaderLanguage??0,this._disableParallelShaderCompilation=!!Y.disableParallelShaderCompilation,Y.uniformBuffersNames){this._uniformBuffersNamesList=Y.uniformBuffersNames.slice();for(let c=0;c<Y.uniformBuffersNames.length;c++)this._uniformBuffersNames[Y.uniformBuffersNames[c]]=c}this._processFinalCode=Y.processFinalCode??null,this._processCodeAfterIncludes=Y.processCodeAfterIncludes??void 0,P=Y.extraInitializationsAsync,d=Y.existingPipelineContext}else this._engine=N,this.defines=null==b?"":b,this._uniformsNames=h.concat(E),this._samplerList=E?E.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=p,this.onError=q,this.onCompiled=W,this._indexParameters=k,this._fallbacks=w;"WEBGL2"===this._engine.shaderPlatformName&&(d=(0,Q.h)(y,this._engine._gl)??d),this._attributeLocationByName={},this.uniqueId=H._UniqueIdSeed++,d?(this._pipelineContext=d,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,P),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.q||this.dispose(!0)}))}async _processShaderCodeAsync(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0;C&&await C(),this._processingContext=h||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const E={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:Y??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:N.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:N.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Q.d)(E,this.name,this._processFinalCode,((Y,h)=>{this._vertexSourceCode=Y,this._fragmentSourceCode=h,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.q||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(Y){return this._attributes[Y]}getAttributeLocationByName(Y){return this._attributeLocationByName[Y]}getAttributesCount(){return this._attributes.length}getUniformIndex(Y){return this._uniformsNames.indexOf(Y)}getUniform(Y){return this._uniforms[Y]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((Y=>{this.executeWhenCompiled(Y)}))}executeWhenCompiled(Y){this.isReady()?Y(this):(this.onCompileObservable.add((c=>{Y(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(Y){(0,b.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(c=>{this._processCompilationErrors(c,Y)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var Y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var Y;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(Y,c,h,C){this._isReady=!1,this._vertexSourceCodeOverride=Y,this._fragmentSourceCodeOverride=c,this.onError=(Y,c)=>{C&&C(c)},this.onCompiled=()=>{var Y,c;const C=this.getEngine().scenes;if(C)for(let h=0;h<C.length;h++)C[h].markAllMaterialsAsDirty(127);null===(Y=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===Y||Y.call(c,h)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(Y){if(this._pipelineContext=Y,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const Y=this._attributesNames[c];this._attributeLocationByName[Y]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),H.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const h=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),C=h?null:this.defines,E=h?this._vertexSourceCodeOverride:this._vertexSourceCode,N=h?this._fragmentSourceCodeOverride:this._fragmentSourceCode,b=this._engine;this._pipelineContext=(0,Q.f)({existingPipelineContext:Y?c:null,vertex:E,fragment:N,context:"WEBGL2"===b.shaderPlatformName||"WEBGL1"===b.shaderPlatformName?b._gl:void 0,rebuildRebind:(Y,c,h,C)=>this._rebuildProgram(Y,c,h,C),defines:C,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:h,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:h=>{c&&!Y&&this._engine._deletePipelineContext(c),h&&this._onRenderingStateCompiled(h)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(h){this._processCompilationErrors(h,c)}}_getShaderCodeAndErrorLine(Y,c,h){const C=h?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let E=null;if(c&&Y){const N=c.match(C);if(N&&2===N.length){const c=parseInt(N[1]),C=Y.split("\n",-1);C.length>=c&&(E=`Offending line [${c}] in ${h?"fragment":"vertex"} code: ${C[c-1]}`)}}return[Y,E]}_processCompilationErrors(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=Y.message;const h=this._attributesNames,C=this._fallbacks;if(E.e.Error("Unable to compile effect:"),E.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),E.e.Error(`Attributes: ${h.join(" ")}`),E.e.Error("Defines:\n"+this.defines),H.LogShaderCodeOnCompilationError){var N,Q;let Y=null,c=null,h=null;var b;if(null!==(N=this._pipelineContext)&&void 0!==N&&N._getVertexShaderCode()&&([h,Y]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),h&&(E.e.Error("Vertex code:"),E.e.Error(h))),null!==(Q=this._pipelineContext)&&void 0!==Q&&Q._getFragmentShaderCode())[h,c]=this._getShaderCodeAndErrorLine(null===(b=this._pipelineContext)||void 0===b?void 0:b._getFragmentShaderCode(),this._compilationError,!0),h&&(E.e.Error("Fragment code:"),E.e.Error(h));Y&&E.e.Error(Y),c&&E.e.Error(c)}E.e.Error("Error: "+this._compilationError);const w=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};c&&(this._pipelineContext=c,this._isReady=!0,w()),C?(this._pipelineContext=null,C.hasMoreFallbacks?(this._allFallbacksProcessed=!1,E.e.Error("Trying next fallback."),this.defines=C.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,w(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||w())}get isSupported(){return""===this._compilationError}_bindTexture(Y,c){this._engine._bindTexture(this._samplers[Y],c,Y)}setTexture(Y,c){this._engine.setTexture(this._samplers[Y],this._uniforms[Y],c,Y)}setTextureArray(Y,c){const h=Y+"Ex";if(-1===this._samplerList.indexOf(h+"0")){const C=this._samplerList.indexOf(Y);for(let Y=1;Y<c.length;Y++){const c=h+(Y-1).toString();this._samplerList.splice(C+Y,0,c)}let E=0;for(const Y of this._samplerList)this._samplers[Y]=E,E+=1}this._engine.setTextureArray(this._samplers[Y],this._uniforms[Y],c,Y)}bindUniformBuffer(Y,c){const h=this._uniformBuffersNames[c];void 0===h||H._BaseCache[h]===Y&&this._engine._features.useUBOBindingCache||(H._BaseCache[h]=Y,this._engine.bindUniformBufferBase(Y,h,c))}bindUniformBlock(Y,c){this._engine.bindUniformBlock(this._pipelineContext,Y,c)}setInt(Y,c){return this._pipelineContext.setInt(Y,c),this}setInt2(Y,c,h){return this._pipelineContext.setInt2(Y,c,h),this}setInt3(Y,c,h,C){return this._pipelineContext.setInt3(Y,c,h,C),this}setInt4(Y,c,h,C,E){return this._pipelineContext.setInt4(Y,c,h,C,E),this}setIntArray(Y,c){return this._pipelineContext.setIntArray(Y,c),this}setIntArray2(Y,c){return this._pipelineContext.setIntArray2(Y,c),this}setIntArray3(Y,c){return this._pipelineContext.setIntArray3(Y,c),this}setIntArray4(Y,c){return this._pipelineContext.setIntArray4(Y,c),this}setUInt(Y,c){return this._pipelineContext.setUInt(Y,c),this}setUInt2(Y,c,h){return this._pipelineContext.setUInt2(Y,c,h),this}setUInt3(Y,c,h,C){return this._pipelineContext.setUInt3(Y,c,h,C),this}setUInt4(Y,c,h,C,E){return this._pipelineContext.setUInt4(Y,c,h,C,E),this}setUIntArray(Y,c){return this._pipelineContext.setUIntArray(Y,c),this}setUIntArray2(Y,c){return this._pipelineContext.setUIntArray2(Y,c),this}setUIntArray3(Y,c){return this._pipelineContext.setUIntArray3(Y,c),this}setUIntArray4(Y,c){return this._pipelineContext.setUIntArray4(Y,c),this}setFloatArray(Y,c){return this._pipelineContext.setArray(Y,c),this}setFloatArray2(Y,c){return this._pipelineContext.setArray2(Y,c),this}setFloatArray3(Y,c){return this._pipelineContext.setArray3(Y,c),this}setFloatArray4(Y,c){return this._pipelineContext.setArray4(Y,c),this}setArray(Y,c){return this._pipelineContext.setArray(Y,c),this}setArray2(Y,c){return this._pipelineContext.setArray2(Y,c),this}setArray3(Y,c){return this._pipelineContext.setArray3(Y,c),this}setArray4(Y,c){return this._pipelineContext.setArray4(Y,c),this}setMatrices(Y,c){return this._pipelineContext.setMatrices(Y,c),this}setMatrix(Y,c){return this._pipelineContext.setMatrix(Y,c),this}setMatrix3x3(Y,c){return this._pipelineContext.setMatrix3x3(Y,c),this}setMatrix2x2(Y,c){return this._pipelineContext.setMatrix2x2(Y,c),this}setFloat(Y,c){return this._pipelineContext.setFloat(Y,c),this}setBool(Y,c){return this._pipelineContext.setInt(Y,c?1:0),this}setVector2(Y,c){return this._pipelineContext.setVector2(Y,c),this}setFloat2(Y,c,h){return this._pipelineContext.setFloat2(Y,c,h),this}setVector3(Y,c){return this._pipelineContext.setVector3(Y,c),this}setFloat3(Y,c,h,C){return this._pipelineContext.setFloat3(Y,c,h,C),this}setVector4(Y,c){return this._pipelineContext.setVector4(Y,c),this}setQuaternion(Y,c){return this._pipelineContext.setQuaternion(Y,c),this}setFloat4(Y,c,h,C,E){return this._pipelineContext.setFloat4(Y,c,h,C,E),this}setColor3(Y,c){return this._pipelineContext.setColor3(Y,c),this}setColor4(Y,c,h){return this._pipelineContext.setColor4(Y,c,h),this}setDirectColor4(Y,c){return this._pipelineContext.setDirectColor4(Y,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(H.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Q.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(N.b.GetShadersStore(C)[`${Y}PixelShader`]=c),h&&(N.b.GetShadersStore(C)[`${Y}VertexShader`]=h)}static ResetCache(){H._BaseCache={}}}H.LogShaderCodeOnCompilationError=!0,H.PersistentMode=!1,H.AutomaticallyClearCodeCache=!1,H._UniqueIdSeed=0,H._BaseCache={},H.ShadersStore=N.b.ShadersStore,H.IncludesShadersStore=N.b.IncludesShadersStore},12715:(Y,c,h)=>{h.d(c,{c:()=>E});const C={};function E(Y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!C[Y])return C[Y]=!0,`${Y} needs to be imported before as it contains a side-effect required by your code.`}},12693:(Y,c,h)=>{function C(){return"undefined"!==typeof window}function E(){return"undefined"!==typeof navigator}function N(){return"undefined"!==typeof document}function Q(Y){let c="",h=Y.firstChild;for(;h;)3===h.nodeType&&(c+=h.textContent),h=h.nextSibling;return c}h.d(c,{c:()=>Q,f:()=>N,i:()=>E,k:()=>C})},12700:(Y,c,h)=>{h.d(c,{e:()=>C});class C{static _CheckLimit(Y,c){let h=C._LogLimitOutputs[Y];return h?h.current++:(h={limit:c,current:1},C._LogLimitOutputs[Y]=h),h.current<=h.limit}static _GenerateLimitMessage(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const h=C._LogLimitOutputs[Y];if(!h||!C.MessageLimitReached)return;const E=this._Levels[c];h.current===h.limit&&C[E.name](C.MessageLimitReached.replace(/%LIMIT%/g,""+h.limit).replace(/%TYPE%/g,E.name??""))}static _AddLogEntry(Y){C._LogCache=Y+C._LogCache,C.OnNewCacheEntry&&C.OnNewCacheEntry(Y)}static _FormatMessage(Y){const c=Y=>Y<10?"0"+Y:""+Y,h=new Date;return"["+c(h.getHours())+":"+c(h.getMinutes())+":"+c(h.getSeconds())+"]: "+Y}static _LogDisabled(Y,c){}static _LogEnabled(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const E=Array.isArray(c)?c[0]:c;if(void 0!==h&&!C._CheckLimit(E,h))return;const N=C._FormatMessage(E),Q=this._Levels[Y],b=Array.isArray(c)?c.slice(1):[];Q.logFunc&&Q.logFunc("BJS - "+N,...b);const H=`<div style='color:${Q.color}'>${N}</div><br>`;C._AddLogEntry(H),C._GenerateLimitMessage(E,Y)}static get LogCache(){return C._LogCache}static ClearLogCache(){C._LogCache="",C._LogLimitOutputs={},C.errorsCount=0}static set LogLevels(Y){C.Log=C._LogDisabled,C.Warn=C._LogDisabled,C.Error=C._LogDisabled;const c=[C.MessageLogLevel,C.WarningLogLevel,C.ErrorLogLevel];for(const h of c)if((Y&h)===h){const Y=this._Levels[h];C[Y.name]=C._LogEnabled.bind(C,h)}}}C.NoneLogLevel=0,C.MessageLogLevel=1,C.WarningLogLevel=2,C.ErrorLogLevel=4,C.AllLogLevel=7,C.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",C._LogCache="",C._LogLimitOutputs={},C._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],C.errorsCount=0,C.Log=C._LogEnabled.bind(C,C.MessageLogLevel),C.Warn=C._LogEnabled.bind(C,C.WarningLogLevel),C.Error=C._LogEnabled.bind(C,C.ErrorLogLevel)},12690:(Y,c,h)=>{h.d(c,{c:()=>Q});const C="undefined"!==typeof WeakRef;class E{constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this.initialize(Y,c,h,C)}initialize(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;return this.mask=Y,this.skipNextObservers=c,this.target=h,this.currentTarget=C,this}}class N{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=Y,this.mask=c,this.scope=h,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(Y)}}class Q{static FromPromise(Y,c){const h=new Q;return Y.then((Y=>{h.notifyObservers(Y)})).catch((Y=>{if(!c)throw Y;c.notifyObservers(Y)})),h}get observers(){return this._observers}constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new E(0),Y&&(this._onObserverAdded=Y)}add(Y){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Y)return null;const E=new N(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);E.unregisterOnNextCall=h,c?this._observers.unshift(E):this._observers.push(E),this._onObserverAdded&&this._onObserverAdded(E),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(E,this._lastNotifiedValue);const Q=C?new WeakRef(this):{deref:()=>this};return E._remove=function(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=Q.deref();c&&(Y?c.remove(E):c._remove(E))},E}addOnce(Y){return this.add(Y,void 0,void 0,void 0,!0)}remove(Y){if(!Y)return!1;Y._remove=null;return-1!==this._observers.indexOf(Y)&&(this._deferUnregister(Y),!0)}removeCallback(Y,c){for(let h=0;h<this._observers.length;h++){const C=this._observers[h];if(!C._willBeUnregistered&&(C.callback===Y&&(!c||c===C.scope)))return this._deferUnregister(C),!0}return!1}_deferUnregister(Y){Y._willBeUnregistered||(this._numObserversMarkedAsDeleted++,Y.unregisterOnNextCall=!1,Y._willBeUnregistered=!0,setTimeout((()=>{this._remove(Y)}),0))}_remove(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Y)return!1;const h=this._observers.indexOf(Y);return-1!==h&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(h,1),!0)}makeObserverTopPriority(Y){this._remove(Y,!1),this._observers.unshift(Y)}makeObserverBottomPriority(Y){this._remove(Y,!1),this._observers.push(Y)}notifyObservers(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,h=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Y),!this._observers.length)return!0;const N=this._eventState;N.mask=c,N.target=h,N.currentTarget=C,N.skipNextObservers=!1,N.lastReturnValue=Y,N.userInfo=E;for(const Q of this._observers)if(!Q._willBeUnregistered&&(Q.mask&c&&(Q.unregisterOnNextCall&&this._deferUnregister(Q),Q.scope?N.lastReturnValue=Q.callback.apply(Q.scope,[Y,N]):N.lastReturnValue=Q.callback(Y,N)),N.skipNextObservers))return!1;return!0}notifyObserver(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),Y._willBeUnregistered)return;const C=this._eventState;C.mask=h,C.skipNextObservers=!1,Y.unregisterOnNextCall&&this._deferUnregister(Y),Y.callback(c,C)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const Y=this._observers.pop();Y&&(Y._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const Y=new Q;return Y._observers=this._observers.slice(0),Y}hasSpecificMask(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&Y||c.mask===Y)return!0;return!1}}},12756:(Y,c,h)=>{h.d(c,{c:()=>E,f:()=>Q});let C=[];class E{static SetImmediate(Y){0===C.length&&setTimeout((()=>{const Y=C;C=[];for(const c of Y)c()}),1),C.push(Y)}}function N(Y,c,h){try{if(Y())return c(),!0}catch(C){return null===h||void 0===h||h(C),!0}return!1}const Q=function(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Q=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&N(Y,c,h))return null;const b=setInterval((()=>{N(Y,c,h)?clearInterval(b):(E-=C,E<0&&(clearInterval(b),null===h||void 0===h||h(new Error("Operation timed out after maximum retries. "+(Q||"")),!0)))}),C);return()=>clearInterval(b)}}}]);