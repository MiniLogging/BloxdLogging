"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11078:(P,f,Y)=>{Y.d(f,{e:()=>c,i:()=>l,m:()=>v,k:()=>a,p:()=>Q});class C{constructor(){this.children=[]}isValid(P){return!0}process(P,f,Y){let C="";if(this.line){let Y=this.line;const R=f.processor;if(R){var q,m,L,o,w,d;R.lineProcessor&&(Y=R.lineProcessor(Y,f.isFragment,f.processingContext));const C=(null===(q=f.processor)||void 0===q?void 0:q.attributeKeywordName)??"attribute",y=f.isFragment&&null!==(m=f.processor)&&void 0!==m&&m.varyingFragmentKeywordName?null===(L=f.processor)||void 0===L?void 0:L.varyingFragmentKeywordName:!f.isFragment&&null!==(o=f.processor)&&void 0!==o&&o.varyingVertexKeywordName?null===(w=f.processor)||void 0===w?void 0:w.varyingVertexKeywordName:"varying";if(!f.isFragment&&R.attributeProcessor&&this.line.startsWith(C))Y=R.attributeProcessor(this.line,P,f.processingContext);else if(R.varyingProcessor&&(null!==(d=R.varyingCheck)&&void 0!==d&&d.call(R,this.line,f.isFragment)||!R.varyingCheck&&this.line.startsWith(y)))Y=R.varyingProcessor(this.line,f.isFragment,P,f.processingContext);else if(R.uniformProcessor&&R.uniformRegexp&&R.uniformRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(Y=R.uniformProcessor(this.line,f.isFragment,P,f.processingContext));else if(R.uniformBufferProcessor&&R.uniformBufferRegexp&&R.uniformBufferRegexp.test(this.line))f.lookForClosingBracketForUniformBuffer||(Y=R.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0);else if(R.textureProcessor&&R.textureRegexp&&R.textureRegexp.test(this.line))Y=R.textureProcessor(this.line,f.isFragment,P,f.processingContext);else if((R.uniformProcessor||R.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!f.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?R.uniformProcessor&&(Y=R.uniformProcessor(this.line,f.isFragment,P,f.processingContext)):R.uniformBufferProcessor&&(Y=R.uniformBufferProcessor(this.line,f.isFragment,f.processingContext),f.lookForClosingBracketForUniformBuffer=!0)}f.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(f.lookForClosingBracketForUniformBuffer=!1,R.endOfUniformBufferProcessor&&(Y=R.endOfUniformBufferProcessor(this.line,f.isFragment,f.processingContext)))}C+=Y+"\n"}for(const R of this.children)C+=R.process(P,f,Y);return this.additionalDefineKey&&(P[this.additionalDefineKey]=this.additionalDefineValue||"true",Y[this.additionalDefineKey]=P[this.additionalDefineKey]),C}}class q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(P){this._lines.length=0;for(const f of P){if(!f||"\r"===f)continue;if("#"===f[0]){this._lines.push(f);continue}const P=f.trim();if(!P)continue;if(P.startsWith("//")){this._lines.push(f);continue}const Y=P.indexOf(";");if(-1===Y)this._lines.push(P);else if(Y===P.length-1)P.length>1&&this._lines.push(P);else{const P=f.split(";");for(let f=0;f<P.length;f++){let Y=P[f];Y&&(Y=Y.trim(),Y&&this._lines.push(Y+(f!==P.length-1?";":"")))}}}}}class m extends C{process(P,f,Y){for(let C=0;C<this.children.length;C++){const q=this.children[C];if(q.isValid(P))return q.process(P,f,Y)}return""}}class L extends C{isValid(P){return this.testExpression.isTrue(P)}}class o{isTrue(P){return!0}static postfixToInfix(P){const f=[];for(const Y of P)if(void 0===o._OperatorPriority[Y])f.push(Y);else{const P=f[f.length-1],C=f[f.length-2];f.length-=2,f.push(`(${C}${Y}${P})`)}return f[f.length-1]}static infixToPostfix(P){const f=o._InfixToPostfixCache.get(P);if(f)return f.accessTime=Date.now(),f.result;if(!P.includes("&&")&&!P.includes("||")&&!P.includes(")")&&!P.includes("("))return[P];const Y=[];let C=-1;const q=()=>{R=R.trim(),""!==R&&(Y.push(R),R="")},m=P=>{C<o._Stack.length-1&&(o._Stack[++C]=P)},L=()=>o._Stack[C],w=()=>-1===C?"!!INVALID EXPRESSION!!":o._Stack[C--];let d=0,R="";for(;d<P.length;){const f=P.charAt(d),y=d<P.length-1?P.substring(d,2+d):"";if("("===f)R="",m(f);else if(")"===f){for(q();-1!==C&&"("!==L();)Y.push(w());w()}else if(o._OperatorPriority[y]>1){for(q();-1!==C&&o._OperatorPriority[L()]>=o._OperatorPriority[y];)Y.push(w());m(y),d++}else R+=f;d++}for(q();-1!==C;)"("===L()?w():Y.push(w());return o._InfixToPostfixCache.size>=o.InfixToPostfixCacheLimitSize&&o.ClearCache(),o._InfixToPostfixCache.set(P,{result:Y,accessTime:Date.now()}),Y}static ClearCache(){const P=Array.from(o._InfixToPostfixCache.entries()).sort(((P,f)=>P[1].accessTime-f[1].accessTime));for(let f=0;f<o.InfixToPostfixCacheCleanupSize;f++)o._InfixToPostfixCache.delete(P[f][0])}}o.InfixToPostfixCacheLimitSize=5e4,o.InfixToPostfixCacheCleanupSize=25e3,o._InfixToPostfixCache=new Map,o._OperatorPriority={")":0,"(":1,"||":2,"&&":3},o._Stack=["","","","","","","","","","","","","","","","","","","",""];class w extends o{constructor(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=P,this.not=f}isTrue(P){let f=void 0!==P[this.define];return this.not&&(f=!f),f}}class d extends o{isTrue(P){return this.leftOperand.isTrue(P)||this.rightOperand.isTrue(P)}}class R extends o{isTrue(P){return this.leftOperand.isTrue(P)&&this.rightOperand.isTrue(P)}}class y extends o{constructor(P,f,Y){super(),this.define=P,this.operand=f,this.testValue=Y}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(P){let f=!1;const Y=parseInt(void 0!=P[this.define]?P[this.define]:this.define),C=parseInt(void 0!=P[this.testValue]?P[this.testValue]:this.testValue);if(isNaN(Y)||isNaN(C))return!1;switch(this.operand){case">":f=Y>C;break;case"<":f=Y<C;break;case"<=":f=Y<=C;break;case">=":f=Y>=C;break;case"==":f=Y===C;break;case"!=":f=Y!==C}return f}}var r=Y(11043),i=Y(11082);const u=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,S=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,K=/__decl__/,M=/light\{X\}.(\w*)/g,V=/\{X\}/g,O=[],n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function l(P){P.processor&&P.processor.initializeShaders&&P.processor.initializeShaders(P.processingContext)}function v(P,f,Y,C){var q;null!==(q=f.processor)&&void 0!==q&&q.preProcessShaderCode&&(P=f.processor.preProcessShaderCode(P,f.isFragment)),a(P,f,(P=>{f.processCodeAfterIncludes&&(P=f.processCodeAfterIncludes(f.isFragment?"fragment":"vertex",P,f.defines));const q=function(P,f,Y){let C=function(P,f){var Y;if(null!==(Y=f.processor)&&void 0!==Y&&Y.noPrecision)return P;const C=f.shouldUseHighPrecisionShader;-1===P.indexOf("precision highp float")?P=C?"precision highp float;\n"+P:"precision mediump float;\n"+P:C||(P=P.replace("precision highp float","precision mediump float"));return P}(P,f);if(!f.processor)return C;if(0===f.processor.shaderLanguage&&-1!==C.indexOf("#version 3")&&(C=C.replace("#version 300 es",""),!f.processor.parseGLES3))return C;const q=f.defines,m=s(f,Y);f.processor.preProcessor&&(C=f.processor.preProcessor(C,q,m,f.isFragment,f.processingContext));const L={};C=e(C,m,f,L),f.processor.postProcessor&&(C=f.processor.postProcessor(C,q,f.isFragment,f.processingContext,Y?{drawBuffersExtensionDisabled:!Y.getCaps().drawBuffersExtension}:{},m,L));null!==Y&&void 0!==Y&&Y._features.needShaderCodeInlining&&(C=Y.inlineShaderCode(C));return C}(P,f,C);Y(q,P)}))}function c(P,f,Y){return Y.processor&&Y.processor.finalizeShaders?Y.processor.finalizeShaders(P,f,Y.processingContext):{vertexCode:P,fragmentCode:f}}function T(P){const f=/defined\((.+)\)/.exec(P);if(f&&f.length)return new w(f[1].trim(),"!"===P[0]);const Y=["==","!=",">=","<=","<",">"];let C="",q=0;for(C of Y)if(q=P.indexOf(C),q>-1)break;if(-1===q)return new w(P);const m=P.substring(0,q).trim(),L=P.substring(q+C.length).trim();return new y(m,C,L)}function U(P,f){const Y=new L,C=P.substring(0,f);let q=P.substring(f);return q=q.substring(0,(q.indexOf("//")+1||q.length+1)-1).trim(),Y.testExpression="#ifdef"===C?new w(q):"#ifndef"===C?new w(q,!0):function(P){P=P.replace(u,"defined[$1]");const f=o.infixToPostfix(P),Y=[];for(const q of f)if("||"!==q&&"&&"!==q)Y.push(q);else if(Y.length>=2){let P=Y[Y.length-1],f=Y[Y.length-2];Y.length-=2;const C="&&"==q?new R:new d;"string"===typeof P&&(P=P.replace(g,"defined($1)")),"string"===typeof f&&(f=f.replace(g,"defined($1)")),C.leftOperand="string"===typeof f?T(f):f,C.rightOperand="string"===typeof P?T(P):P,Y.push(C)}let C=Y[Y.length-1];return"string"===typeof C&&(C=C.replace(g,"defined($1)")),"string"===typeof C?T(C):C}(q),Y}function D(P,f,Y,q){let m=P.currentLine;for(;j(P,Y,q);){m=P.currentLine;const L=m.substring(0,5).toLowerCase();if("#else"===L){const Y=new C;return f.children.push(Y),void j(P,Y,q)}if("#elif"===L){const P=U(m,5);f.children.push(P),Y=P}}}function j(P,f,Y){for(;P.canRead;){P.lineIndex++;const q=P.currentLine;if(q.indexOf("#")>=0){const C=n.exec(q);if(C&&C.length){switch(C[0]){case"#ifdef":{const C=new m;f.children.push(C);const L=U(q,6);C.children.push(L),D(P,C,L,Y);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const C=new m;f.children.push(C);const L=U(q,7);C.children.push(L),D(P,C,L,Y);break}case"#if":{const C=new m,L=U(q,3);f.children.push(C),C.children.push(L),D(P,C,L,Y);break}}continue}}const L=new C;if(L.line=q,f.children.push(L),"#"===q[0]&&"d"===q[1]){const P=q.replace(";","").split(" ");L.additionalDefineKey=P[1],3===P.length&&(L.additionalDefineValue=P[2])}}return!1}function e(P,f,Y,m){const L=new C,o=new q;return o.lineIndex=-1,o.lines=P.split("\n"),j(o,L,m),L.process(f,Y,m)}function s(P,f){var Y;const C=P.defines,q={};for(const m of C){const P=m.replace("#define","").replace(";","").trim().split(" ");q[P[0]]=P.length>1?P[1]:""}return 0===(null===(Y=P.processor)||void 0===Y?void 0:Y.shaderLanguage)&&(q.GL_ES="true"),q.__VERSION__=P.version,q[P.platformName]="true",(0,i.h)(q,null===f||void 0===f?void 0:f.isNDCHalfZRange,null===f||void 0===f?void 0:f.useReverseDepthBuffer,null===f||void 0===f?void 0:f.useExactSrgbConversions),q}function a(P,f,Y){let C;for(O.length=0;null!==(C=S.exec(P));)O.push(C);let q=String(P),m=[P],L=!1;for(const o of O){let P=o[1];if(-1!==P.indexOf("__decl__")&&(P=P.replace(K,""),f.supportsUniformBuffers&&(P=P.replace("Vertex","Ubo").replace("Fragment","Ubo")),P+="Declaration"),!f.includesShadersStore[P]){const C=f.shadersRepository+"ShadersInclude/"+P+".fx";return void Q.loadFile(C,(C=>{f.includesShadersStore[P]=C,a(m.join(""),f,Y)}))}{let Y=f.includesShadersStore[P];if(o[2]){const P=o[3].split(",");for(let f=0;f<P.length;f+=2){const C=new RegExp(P[f],"g"),q=P[f+1];Y=Y.replace(C,q)}}if(o[4]){const P=o[5];if(-1!==P.indexOf("..")){const C=P.split(".."),q=parseInt(C[0]);let m=parseInt(C[1]),L=Y.slice(0);Y="",isNaN(m)&&(m=f.indexParameters[C[1]]);for(let P=q;P<m;P++)f.supportsUniformBuffers||(L=L.replace(M,((P,f)=>f+"{X}"))),Y+=L.replace(V,P.toString())+"\n"}else f.supportsUniformBuffers||(Y=Y.replace(M,((P,f)=>f+"{X}"))),Y=Y.replace(V,P)}const C=[];for(const P of m){const f=P.split(o[0]);for(let P=0;P<f.length-1;P++)C.push(f[P]),C.push(Y);C.push(f[f.length-1])}m=C,L=L||Y.indexOf("#include<")>=0||Y.indexOf("#include <")>=0}}O.length=0,q=m.join(""),L?a(q.toString(),f,Y):Y(q)}const Q={loadFile:(P,f,Y,C,q,m)=>{throw(0,r.b)("FileTools")}}},11082:(P,f,Y)=>{Y.d(f,{d:()=>q,f:()=>m,h:()=>o,k:()=>L,o:()=>w});var C=Y(11043);Y(11021);const q={};function m(P,f){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(f?f+"\n":"")+P}function L(P,f,Y,m,L,o,w){const d=w||q.loadFile;if(d){return d(P,f,Y,m,L,o)}throw(0,C.b)("FileTools")}function o(P,f,Y,C){if(P)return f?P.IS_NDC_HALF_ZRANGE="":delete P.IS_NDC_HALF_ZRANGE,Y?P.USE_REVERSE_DEPTHBUFFER="":delete P.USE_REVERSE_DEPTHBUFFER,void(C?P.USE_EXACT_SRGB_CONVERSIONS="":delete P.USE_EXACT_SRGB_CONVERSIONS);{let P="";return f&&(P+="#define IS_NDC_HALF_ZRANGE"),Y&&(P&&(P+="\n"),P+="#define USE_REVERSE_DEPTHBUFFER"),C&&(P&&(P+="\n"),P+="#define USE_EXACT_SRGB_CONVERSIONS"),P}}function w(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;switch(P){case 3:{const P=(ArrayBuffer,new Int8Array(f));return C&&P.set(new Int8Array(C)),P}case 0:{const P=(ArrayBuffer,new Uint8Array(f));return C&&P.set(new Uint8Array(C)),P}case 4:{const P=f instanceof ArrayBuffer?new Int16Array(f):new Int16Array(Y?f/2:f);return C&&P.set(new Int16Array(C)),P}case 5:case 8:case 9:case 10:case 2:{const P=f instanceof ArrayBuffer?new Uint16Array(f):new Uint16Array(Y?f/2:f);return C&&P.set(new Uint16Array(C)),P}case 6:{const P=f instanceof ArrayBuffer?new Int32Array(f):new Int32Array(Y?f/4:f);return C&&P.set(new Int32Array(C)),P}case 7:case 11:case 12:case 13:case 14:case 15:{const P=f instanceof ArrayBuffer?new Uint32Array(f):new Uint32Array(Y?f/4:f);return C&&P.set(new Uint32Array(C)),P}case 1:{const P=f instanceof ArrayBuffer?new Float32Array(f):new Float32Array(Y?f/4:f);return C&&P.set(new Float32Array(C)),P}}const q=(ArrayBuffer,new Uint8Array(f));return C&&q.set(new Uint8Array(C)),q}},11101:(P,f,Y)=>{Y.d(f,{e:()=>C});class C{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersRepository:C.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.ShadersStore:C.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?C.IncludesShadersStore:C.IncludesShadersStoreWGSL}}C.ShadersRepository="src/Shaders/",C.ShadersStore={},C.IncludesShadersStore={},C.ShadersRepositoryWGSL="src/ShadersWGSL/",C.ShadersStoreWGSL={},C.IncludesShadersStoreWGSL={}},11106:(P,f,Y)=>{Y.d(f,{e:()=>r,g:()=>V,h:()=>u,j:()=>i,n:()=>g,r:()=>M,s:()=>y,t:()=>d,x:()=>R,z:()=>w,D:()=>o});class C{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Kf._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(P){P&&this.program&&P(this.program)}setEngine(P){this.Kf=P}_fillEffectInformation(P,f,Y,C,q,m,L,o){const w=this.Kf;if(w.supportsUniformBuffers)for(const R in f)P.bindUniformBlock(R,f[R]);let d;for(this.Kf.getUniforms(this,Y).forEach(((P,f)=>{C[Y[f]]=P})),this._uniforms=C,d=0;d<q.length;d++){null==P.getUniform(q[d])&&(q.splice(d,1),d--)}q.forEach(((P,f)=>{m[P]=f}));for(const R of w.getAttributes(this,L))o.push(R)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(P,f){const Y=this._valueCache[P],C=f.updateFlag;return(void 0===Y||Y!==C)&&(this._valueCache[P]=C,!0)}_cacheFloat2(P,f,Y){let C=this._valueCache[P];if(!C||2!==C.length)return C=[f,Y],this._valueCache[P]=C,!0;let q=!1;return C[0]!==f&&(C[0]=f,q=!0),C[1]!==Y&&(C[1]=Y,q=!0),q}_cacheFloat3(P,f,Y,C){let q=this._valueCache[P];if(!q||3!==q.length)return q=[f,Y,C],this._valueCache[P]=q,!0;let m=!1;return q[0]!==f&&(q[0]=f,m=!0),q[1]!==Y&&(q[1]=Y,m=!0),q[2]!==C&&(q[2]=C,m=!0),m}_cacheFloat4(P,f,Y,C,q){let m=this._valueCache[P];if(!m||4!==m.length)return m=[f,Y,C,q],this._valueCache[P]=m,!0;let L=!1;return m[0]!==f&&(m[0]=f,L=!0),m[1]!==Y&&(m[1]=Y,L=!0),m[2]!==C&&(m[2]=C,L=!0),m[3]!==q&&(m[3]=q,L=!0),L}setInt(P,f){const Y=this._valueCache[P];void 0!==Y&&Y===f||this.Kf.setInt(this._uniforms[P],f)&&(this._valueCache[P]=f)}setInt2(P,f,Y){this._cacheFloat2(P,f,Y)&&(this.Kf.setInt2(this._uniforms[P],f,Y)||(this._valueCache[P]=null))}setInt3(P,f,Y,C){this._cacheFloat3(P,f,Y,C)&&(this.Kf.setInt3(this._uniforms[P],f,Y,C)||(this._valueCache[P]=null))}setInt4(P,f,Y,C,q){this._cacheFloat4(P,f,Y,C,q)&&(this.Kf.setInt4(this._uniforms[P],f,Y,C,q)||(this._valueCache[P]=null))}setIntArray(P,f){this._valueCache[P]=null,this.Kf.setIntArray(this._uniforms[P],f)}setIntArray2(P,f){this._valueCache[P]=null,this.Kf.setIntArray2(this._uniforms[P],f)}setIntArray3(P,f){this._valueCache[P]=null,this.Kf.setIntArray3(this._uniforms[P],f)}setIntArray4(P,f){this._valueCache[P]=null,this.Kf.setIntArray4(this._uniforms[P],f)}setUInt(P,f){const Y=this._valueCache[P];void 0!==Y&&Y===f||this.Kf.setUInt(this._uniforms[P],f)&&(this._valueCache[P]=f)}setUInt2(P,f,Y){this._cacheFloat2(P,f,Y)&&(this.Kf.setUInt2(this._uniforms[P],f,Y)||(this._valueCache[P]=null))}setUInt3(P,f,Y,C){this._cacheFloat3(P,f,Y,C)&&(this.Kf.setUInt3(this._uniforms[P],f,Y,C)||(this._valueCache[P]=null))}setUInt4(P,f,Y,C,q){this._cacheFloat4(P,f,Y,C,q)&&(this.Kf.setUInt4(this._uniforms[P],f,Y,C,q)||(this._valueCache[P]=null))}setUIntArray(P,f){this._valueCache[P]=null,this.Kf.setUIntArray(this._uniforms[P],f)}setUIntArray2(P,f){this._valueCache[P]=null,this.Kf.setUIntArray2(this._uniforms[P],f)}setUIntArray3(P,f){this._valueCache[P]=null,this.Kf.setUIntArray3(this._uniforms[P],f)}setUIntArray4(P,f){this._valueCache[P]=null,this.Kf.setUIntArray4(this._uniforms[P],f)}setArray(P,f){this._valueCache[P]=null,this.Kf.setArray(this._uniforms[P],f)}setArray2(P,f){this._valueCache[P]=null,this.Kf.setArray2(this._uniforms[P],f)}setArray3(P,f){this._valueCache[P]=null,this.Kf.setArray3(this._uniforms[P],f)}setArray4(P,f){this._valueCache[P]=null,this.Kf.setArray4(this._uniforms[P],f)}setMatrices(P,f){f&&(this._valueCache[P]=null,this.Kf.setMatrices(this._uniforms[P],f))}setMatrix(P,f){this._cacheMatrix(P,f)&&(this.Kf.setMatrices(this._uniforms[P],f.If())||(this._valueCache[P]=null))}setMatrix3x3(P,f){this._valueCache[P]=null,this.Kf.setMatrix3x3(this._uniforms[P],f)}setMatrix2x2(P,f){this._valueCache[P]=null,this.Kf.setMatrix2x2(this._uniforms[P],f)}setFloat(P,f){const Y=this._valueCache[P];void 0!==Y&&Y===f||this.Kf.setFloat(this._uniforms[P],f)&&(this._valueCache[P]=f)}setVector2(P,f){this._cacheFloat2(P,f.x,f.y)&&(this.Kf.setFloat2(this._uniforms[P],f.x,f.y)||(this._valueCache[P]=null))}setFloat2(P,f,Y){this._cacheFloat2(P,f,Y)&&(this.Kf.setFloat2(this._uniforms[P],f,Y)||(this._valueCache[P]=null))}setVector3(P,f){this._cacheFloat3(P,f.x,f.y,f.z)&&(this.Kf.setFloat3(this._uniforms[P],f.x,f.y,f.z)||(this._valueCache[P]=null))}setFloat3(P,f,Y,C){this._cacheFloat3(P,f,Y,C)&&(this.Kf.setFloat3(this._uniforms[P],f,Y,C)||(this._valueCache[P]=null))}setVector4(P,f){this._cacheFloat4(P,f.x,f.y,f.z,f.w)&&(this.Kf.setFloat4(this._uniforms[P],f.x,f.y,f.z,f.w)||(this._valueCache[P]=null))}setQuaternion(P,f){this._cacheFloat4(P,f.x,f.y,f.z,f.w)&&(this.Kf.setFloat4(this._uniforms[P],f.x,f.y,f.z,f.w)||(this._valueCache[P]=null))}setFloat4(P,f,Y,C,q){this._cacheFloat4(P,f,Y,C,q)&&(this.Kf.setFloat4(this._uniforms[P],f,Y,C,q)||(this._valueCache[P]=null))}setColor3(P,f){this._cacheFloat3(P,f.r,f.g,f.b)&&(this.Kf.setFloat3(this._uniforms[P],f.r,f.g,f.b)||(this._valueCache[P]=null))}setColor4(P,f,Y){this._cacheFloat4(P,f.r,f.g,f.b,Y)&&(this.Kf.setFloat4(this._uniforms[P],f.r,f.g,f.b,Y)||(this._valueCache[P]=null))}setDirectColor4(P,f){this._cacheFloat4(P,f.r,f.g,f.b,f.a)&&(this.Kf.setFloat4(this._uniforms[P],f.r,f.g,f.b,f.a)||(this._valueCache[P]=null))}_getVertexShaderCode(){return this.vertexShader?this.Kf._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Kf._getShaderSource(this.fragmentShader):null}}var q=Y(11082);const m=new WeakMap,L={_webGLVersion:2,cachedPipelines:{}};function o(P){let f=m.get(P);if(!f){if(!P)return L;f={_webGLVersion:P.TEXTURE_BINDING_3D?2:1,_context:P,parallelShaderCompile:P.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},m.set(P,f)}return f}function w(P){m.delete(P)}function d(P,f,Y,C,q,m){const L=o(C);m||(m=L._createShaderProgramInjection??r);return m(P,K(f,"vertex",C,L._contextWasLost),K(Y,"fragment",C,L._contextWasLost),C,q,L.validateShaderPrograms)}function R(P,f,Y,C,q){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0;const w=o(q);L||(L=w._createShaderProgramInjection??r);const d=w._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return L(P,S(f,"vertex",C,d,q,w._contextWasLost),S(Y,"fragment",C,d,q,w._contextWasLost),q,m,w.validateShaderPrograms)}function y(P,f){const Y=new C,q=o(P);return q.parallelShaderCompile&&!q.disableParallelShaderCompile&&(Y.isParallelCompiled=!0),Y.context=q._context,Y}function r(P,f,Y,C){let q=arguments.length>5?arguments[5]:void 0;const m=C.createProgram();if(P.program=m,!m)throw new Error("Unable to create program");return C.attachShader(m,f),C.attachShader(m,Y),C.linkProgram(m),P.context=C,P.vertexShader=f,P.fragmentShader=Y,P.isParallelCompiled||u(P,C,q),m}function i(P,f,Y){const C=P;if(C._isDisposed)return!1;const q=o(f);return!!(q&&q.parallelShaderCompile&&q.parallelShaderCompile.COMPLETION_STATUS_KHR&&C.program&&f.getProgramParameter(C.program,q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(u(C,f,Y),!0)}function u(P,f,Y){const C=P.context,q=P.vertexShader,m=P.fragmentShader,L=P.program;if(!C.getProgramParameter(L,C.LINK_STATUS)){if(!f.getShaderParameter(q,f.COMPILE_STATUS)){const Y=f.getShaderInfoLog(q);if(Y)throw P.vertexCompilationError=Y,new Error("VERTEX SHADER "+Y)}if(!f.getShaderParameter(m,f.COMPILE_STATUS)){const Y=f.getShaderInfoLog(m);if(Y)throw P.fragmentCompilationError=Y,new Error("FRAGMENT SHADER "+Y)}const Y=C.getProgramInfoLog(L);if(Y)throw P.programLinkError=Y,new Error(Y)}if(Y){C.validateProgram(L);if(!C.getProgramParameter(L,C.VALIDATE_STATUS)){const f=C.getProgramInfoLog(L);if(f)throw P.programValidationError=f,new Error(f)}}C.deleteShader(q),C.deleteShader(m),P.vertexShader=void 0,P.fragmentShader=void 0,P.onCompiled&&(P.onCompiled(),P.onCompiled=void 0)}function g(P,f,Y,C,q,m,L,w,y){let r=arguments.length>10?arguments[10]:void 0,i=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0;const g=o(P.context);i||(i=g.createRawShaderProgramInjection??d),u||(u=g.createShaderProgramInjection??R);const S=P;S.program=C?i(S,f,Y,S.context,y):u(S,f,Y,w,S.context,y),S.program.__SPECTOR_rebuildProgram=L,r()}function S(P,f,Y,C,m,L){return K((0,q.f)(P,Y,C),f,m,L)}function K(P,f,Y,C){const q=Y.createShader("vertex"===f?Y.VERTEX_SHADER:Y.FRAGMENT_SHADER);if(!q){let P=Y.NO_ERROR,q=Y.NO_ERROR;for(;(q=Y.getError())!==Y.NO_ERROR;)P=q;throw new Error(`Something went wrong while creating a gl ${f} shader object. gl error=${P}, gl isContextLost=${Y.isContextLost()}, _contextWasLost=${C}`)}return Y.shaderSource(q,P),Y.compileShader(q),q}function M(P,f){f.useProgram(P)}function V(P,f){const Y=P;if(!Y.isParallelCompiled)return void f(P);const C=Y.onCompiled;Y.onCompiled=()=>{null===C||void 0===C||C(),f(P)}}},11104:(P,f,Y)=>{Y.d(f,{e:()=>y,g:()=>i,i:()=>d,l:()=>R});var C=Y(11021),q=Y(11106),m=Y(11101),L=Y(11025),o=Y(11078),w=Y(11082);function d(P,f){return(0,q.D)(f).cachedPipelines[P]}function R(P){const f=P._name,Y=P.context;if(f&&Y){const P=(0,q.D)(Y),C=P.cachedPipelines[f];null===C||void 0===C||C.dispose(),delete P.cachedPipelines[f]}}function y(P,f,Y,q,m,L,w){let d,R;const y=(0,C.j)()?null===L||void 0===L?void 0:L.getHostDocument():null;d="string"===typeof f?f:f.vertexSource?"source:"+f.vertexSource:f.vertexElement?(null===y||void 0===y?void 0:y.getElementById(f.vertexElement))||f.vertexElement:f.vertex||f,R="string"===typeof f?f:f.fragmentSource?"source:"+f.fragmentSource:f.fragmentElement?(null===y||void 0===y?void 0:y.getElementById(f.fragmentElement))||f.fragmentElement:f.fragment||f;const i=[void 0,void 0],u=()=>{if(i[0]&&i[1]){P.isFragment=!0;const[C,d]=i;(0,o.m)(d,P,((L,d)=>{w&&(w._fragmentSourceCodeBeforeMigration=d),Y&&(L=Y("fragment",L));const R=(0,o.e)(C,L,P);P=null;const y=function(P,f,Y,C){if(Y){return{vertexSourceCode:(1===C?"//":"")+"#define SHADER_NAME vertex:"+(Y.vertexElement||Y.vertex||Y.spectorName||Y)+"\n"+P,fragmentSourceCode:(1===C?"//":"")+"#define SHADER_NAME fragment:"+(Y.fragmentElement||Y.fragment||Y.spectorName||Y)+"\n"+f}}return{vertexSourceCode:P,fragmentSourceCode:f}}(R.vertexCode,R.fragmentCode,f,m);null===q||void 0===q||q(y.vertexSourceCode,y.fragmentSourceCode)}),L)}};r(d,"Vertex","",(f=>{(0,o.i)(P),(0,o.m)(f,P,((P,C)=>{w&&(w._rawVertexSourceCode=f,w._vertexSourceCodeBeforeMigration=C),Y&&(P=Y("vertex",P)),i[0]=P,u()}),L)}),m),r(R,"Fragment","Pixel",(P=>{w&&(w._rawFragmentSourceCode=P),i[1]=P,u()}),m)}function r(P,f,Y,q,L,o){if("undefined"!==typeof HTMLElement&&P instanceof HTMLElement){return void q((0,C.d)(P))}if("source:"===P.substring(0,7))return void q(P.substring(7));if("base64:"===P.substring(0,7)){return void q(window.atob(P.substring(7)))}const d=m.e.GetShadersStore(L);if(d[P+f+"Shader"])return void q(d[P+f+"Shader"]);if(Y&&d[P+Y+"Shader"])return void q(d[P+Y+"Shader"]);let R;if(R="."===P[0]||"/"===P[0]||P.indexOf("http")>-1?P:m.e.GetShadersRepository(L)+P,!(o=o||w.k))throw new Error("loadFileInjection is not defined");o(R+"."+f.toLowerCase()+".fx",q)}const i=(P,f,Y,C)=>{try{const m=P.context?(0,q.D)(P.context):null;m&&(m.disableParallelShaderCompile=P.disableParallelCompilation);const L=P.existingPipelineContext||f(P.shaderProcessingContext);return L._name=P.name,P.name&&m&&(m.cachedPipelines[P.name]=L),Y(L,P.vertex,P.fragment,!!P.createAsRaw,"","",P.rebuildRebind,P.defines,P.transformFeedbackVaryings,"",(()=>{C(L,(()=>{var f;null===(f=P.onRenderingStateCompiled)||void 0===f||f.call(P,L)}))})),L}catch(m){throw L.e.Error("Error compiling effect"),m}}},11093:(P,f,Y)=>{Y.r(f),Y.d(f,{Effect:()=>w});var C=Y(11018),q=Y(11025),m=Y(11101),L=Y(11104),o=Y(11087);class w{static get ShadersRepository(){return m.e.ShadersRepository}static set ShadersRepository(P){m.e.ShadersRepository=P}get R(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new C.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9?arguments[9]:void 0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,g=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new C.e,this.onErrorObservable=new C.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=P,this._key=i;const S=this._key.replace(/\r/g,"").replace(/\n/g,"|");let K;if(f.attributes){const P=f;if(this._engine=Y,this._attributesNames=P.attributes,this._uniformsNames=P.uniformsNames.concat(P.samplers),this._samplerList=P.samplers.slice(),this.defines=P.defines,this.onError=P.onError,this.onCompiled=P.onCompiled,this._fallbacks=P.fallbacks,this._indexParameters=P.indexParameters,this._transformFeedbackVaryings=P.transformFeedbackVaryings||null,this._multiTarget=!!P.multiTarget,this._shaderLanguage=P.shaderLanguage??0,this._disableParallelShaderCompilation=!!P.disableParallelShaderCompilation,P.uniformBuffersNames){this._uniformBuffersNamesList=P.uniformBuffersNames.slice();for(let f=0;f<P.uniformBuffersNames.length;f++)this._uniformBuffersNames[P.uniformBuffersNames[f]]=f}this._processFinalCode=P.processFinalCode??null,this._processCodeAfterIncludes=P.processCodeAfterIncludes??void 0,g=P.extraInitializationsAsync,K=P.existingPipelineContext}else this._engine=m,this.defines=null==o?"":o,this._uniformsNames=Y.concat(q),this._samplerList=q?q.slice():[],this._attributesNames=f,this._uniformBuffersNamesList=[],this._shaderLanguage=u,this.onError=y,this.onCompiled=R,this._indexParameters=r,this._fallbacks=d;"WEBGL2"===this._engine.shaderPlatformName&&(K=(0,L.i)(S,this._engine._gl)??K),this._attributeLocationByName={},this.uniqueId=w._UniqueIdSeed++,K?(this._pipelineContext=K,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,g),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.R||this.dispose(!0)}))}async _processShaderCodeAsync(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0;C&&await C(),this._processingContext=Y||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:P??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:m.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:m.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,L.e)(q,this.name,this._processFinalCode,((P,Y)=>{this._vertexSourceCode=P,this._fragmentSourceCode=Y,this._prepareEffect(f)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.R||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(P){return this._attributes[P]}getAttributeLocationByName(P){return this._attributeLocationByName[P]}getAttributesCount(){return this._attributes.length}getUniformIndex(P){return this._uniformsNames.indexOf(P)}getUniform(P){return this._uniforms[P]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((P=>{this.executeWhenCompiled(P)}))}executeWhenCompiled(P){this.isReady()?P(this):(this.onCompileObservable.add((f=>{P(f)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(P){(0,o.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(f=>{this._processCompilationErrors(f,P)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(P,f,Y,C){this._isReady=!1,this._vertexSourceCodeOverride=P,this._fragmentSourceCodeOverride=f,this.onError=(P,f)=>{C&&C(f)},this.onCompiled=()=>{var P,f;const C=this.getEngine().scenes;if(C)for(let Y=0;Y<C.length;Y++)C[Y].markAllMaterialsAsDirty(127);null===(P=(f=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===P||P.call(f,Y)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(P){if(this._pipelineContext=P,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let f=0;f<this._attributesNames.length;f++){const P=this._attributesNames[f];this._attributeLocationByName[P]=this._attributes[f]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),w.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=this._pipelineContext;this._isReady=!1;try{const Y=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),C=Y?null:this.defines,q=Y?this._vertexSourceCodeOverride:this._vertexSourceCode,m=Y?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=(0,L.g)({existingPipelineContext:P?f:null,vertex:q,fragment:m,context:"WEBGL2"===o.shaderPlatformName||"WEBGL1"===o.shaderPlatformName?o._gl:void 0,rebuildRebind:(P,f,Y,C)=>this._rebuildProgram(P,f,Y,C),defines:C,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:Y,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:Y=>{f&&!P&&this._engine._deletePipelineContext(f),Y&&this._onRenderingStateCompiled(Y)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(f)}catch(Y){this._processCompilationErrors(Y,f)}}_getShaderCodeAndErrorLine(P,f,Y){const C=Y?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let q=null;if(f&&P){const m=f.match(C);if(m&&2===m.length){const f=parseInt(m[1]),C=P.split("\n",-1);C.length>=f&&(q=`Offending line [${f}] in ${Y?"fragment":"vertex"} code: ${C[f-1]}`)}}return[P,q]}_processCompilationErrors(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=P.message;const Y=this._attributesNames,C=this._fallbacks;if(q.e.Error("Unable to compile effect:"),q.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),q.e.Error(`Attributes: ${Y.join(" ")}`),q.e.Error("Defines:\n"+this.defines),w.LogShaderCodeOnCompilationError){var m,L;let P=null,f=null,Y=null;var o;if(null!==(m=this._pipelineContext)&&void 0!==m&&m._getVertexShaderCode()&&([Y,P]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),Y&&(q.e.Error("Vertex code:"),q.e.Error(Y))),null!==(L=this._pipelineContext)&&void 0!==L&&L._getFragmentShaderCode())[Y,f]=this._getShaderCodeAndErrorLine(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode(),this._compilationError,!0),Y&&(q.e.Error("Fragment code:"),q.e.Error(Y));P&&q.e.Error(P),f&&q.e.Error(f)}q.e.Error("Error: "+this._compilationError);const d=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};f&&(this._pipelineContext=f,this._isReady=!0,d()),C?(this._pipelineContext=null,C.hasMoreFallbacks?(this._allFallbacksProcessed=!1,q.e.Error("Trying next fallback."),this.defines=C.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,d(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,f||d())}get isSupported(){return""===this._compilationError}_bindTexture(P,f){this._engine._bindTexture(this._samplers[P],f,P)}setTexture(P,f){this._engine.setTexture(this._samplers[P],this._uniforms[P],f,P)}setTextureArray(P,f){const Y=P+"Ex";if(-1===this._samplerList.indexOf(Y+"0")){const C=this._samplerList.indexOf(P);for(let P=1;P<f.length;P++){const f=Y+(P-1).toString();this._samplerList.splice(C+P,0,f)}let q=0;for(const P of this._samplerList)this._samplers[P]=q,q+=1}this._engine.setTextureArray(this._samplers[P],this._uniforms[P],f,P)}bindUniformBuffer(P,f){const Y=this._uniformBuffersNames[f];void 0===Y||w._BaseCache[Y]===P&&this._engine._features.useUBOBindingCache||(w._BaseCache[Y]=P,this._engine.bindUniformBufferBase(P,Y,f))}bindUniformBlock(P,f){this._engine.bindUniformBlock(this._pipelineContext,P,f)}setInt(P,f){return this._pipelineContext.setInt(P,f),this}setInt2(P,f,Y){return this._pipelineContext.setInt2(P,f,Y),this}setInt3(P,f,Y,C){return this._pipelineContext.setInt3(P,f,Y,C),this}setInt4(P,f,Y,C,q){return this._pipelineContext.setInt4(P,f,Y,C,q),this}setIntArray(P,f){return this._pipelineContext.setIntArray(P,f),this}setIntArray2(P,f){return this._pipelineContext.setIntArray2(P,f),this}setIntArray3(P,f){return this._pipelineContext.setIntArray3(P,f),this}setIntArray4(P,f){return this._pipelineContext.setIntArray4(P,f),this}setUInt(P,f){return this._pipelineContext.setUInt(P,f),this}setUInt2(P,f,Y){return this._pipelineContext.setUInt2(P,f,Y),this}setUInt3(P,f,Y,C){return this._pipelineContext.setUInt3(P,f,Y,C),this}setUInt4(P,f,Y,C,q){return this._pipelineContext.setUInt4(P,f,Y,C,q),this}setUIntArray(P,f){return this._pipelineContext.setUIntArray(P,f),this}setUIntArray2(P,f){return this._pipelineContext.setUIntArray2(P,f),this}setUIntArray3(P,f){return this._pipelineContext.setUIntArray3(P,f),this}setUIntArray4(P,f){return this._pipelineContext.setUIntArray4(P,f),this}setFloatArray(P,f){return this._pipelineContext.setArray(P,f),this}setFloatArray2(P,f){return this._pipelineContext.setArray2(P,f),this}setFloatArray3(P,f){return this._pipelineContext.setArray3(P,f),this}setFloatArray4(P,f){return this._pipelineContext.setArray4(P,f),this}setArray(P,f){return this._pipelineContext.setArray(P,f),this}setArray2(P,f){return this._pipelineContext.setArray2(P,f),this}setArray3(P,f){return this._pipelineContext.setArray3(P,f),this}setArray4(P,f){return this._pipelineContext.setArray4(P,f),this}setMatrices(P,f){return this._pipelineContext.setMatrices(P,f),this}setMatrix(P,f){return this._pipelineContext.setMatrix(P,f),this}setMatrix3x3(P,f){return this._pipelineContext.setMatrix3x3(P,f),this}setMatrix2x2(P,f){return this._pipelineContext.setMatrix2x2(P,f),this}setFloat(P,f){return this._pipelineContext.setFloat(P,f),this}setBool(P,f){return this._pipelineContext.setInt(P,f?1:0),this}setVector2(P,f){return this._pipelineContext.setVector2(P,f),this}setFloat2(P,f,Y){return this._pipelineContext.setFloat2(P,f,Y),this}setVector3(P,f){return this._pipelineContext.setVector3(P,f),this}setFloat3(P,f,Y,C){return this._pipelineContext.setFloat3(P,f,Y,C),this}setVector4(P,f){return this._pipelineContext.setVector4(P,f),this}setQuaternion(P,f){return this._pipelineContext.setQuaternion(P,f),this}setFloat4(P,f,Y,C,q){return this._pipelineContext.setFloat4(P,f,Y,C,q),this}setColor3(P,f){return this._pipelineContext.setColor3(P,f),this}setColor4(P,f,Y){return this._pipelineContext.setColor4(P,f,Y),this}setDirectColor4(P,f){return this._pipelineContext.setDirectColor4(P,f),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(w.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,L.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;f&&(m.e.GetShadersStore(C)[`${P}PixelShader`]=f),Y&&(m.e.GetShadersStore(C)[`${P}VertexShader`]=Y)}static ResetCache(){w._BaseCache={}}}w.LogShaderCodeOnCompilationError=!0,w.PersistentMode=!1,w.AutomaticallyClearCodeCache=!1,w._UniqueIdSeed=0,w._BaseCache={},w.ShadersStore=m.e.ShadersStore,w.IncludesShadersStore=m.e.IncludesShadersStore},11043:(P,f,Y)=>{Y.d(f,{b:()=>q});const C={};function q(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!C[P])return C[P]=!0,`${P} needs to be imported before as it contains a side-effect required by your code.`}},11021:(P,f,Y)=>{function C(){return"undefined"!==typeof window}function q(){return"undefined"!==typeof navigator}function m(){return"undefined"!==typeof document}function L(P){let f="",Y=P.firstChild;for(;Y;)3===Y.nodeType&&(f+=Y.textContent),Y=Y.nextSibling;return f}Y.d(f,{d:()=>L,e:()=>m,g:()=>q,j:()=>C})},11025:(P,f,Y)=>{Y.d(f,{e:()=>C});class C{static _CheckLimit(P,f){let Y=C._LogLimitOutputs[P];return Y?Y.current++:(Y={limit:f,current:1},C._LogLimitOutputs[P]=Y),Y.current<=Y.limit}static _GenerateLimitMessage(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const Y=C._LogLimitOutputs[P];if(!Y||!C.MessageLimitReached)return;const q=this._Levels[f];Y.current===Y.limit&&C[q.name](C.MessageLimitReached.replace(/%LIMIT%/g,""+Y.limit).replace(/%TYPE%/g,q.name??""))}static _AddLogEntry(P){C._LogCache=P+C._LogCache,C.OnNewCacheEntry&&C.OnNewCacheEntry(P)}static _FormatMessage(P){const f=P=>P<10?"0"+P:""+P,Y=new Date;return"["+f(Y.getHours())+":"+f(Y.getMinutes())+":"+f(Y.getSeconds())+"]: "+P}static _LogDisabled(P,f){}static _LogEnabled(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;const q=Array.isArray(f)?f[0]:f;if(void 0!==Y&&!C._CheckLimit(q,Y))return;const m=C._FormatMessage(q),L=this._Levels[P],o=Array.isArray(f)?f.slice(1):[];L.logFunc&&L.logFunc("BJS - "+m,...o);const w=`<div style='color:${L.color}'>${m}</div><br>`;C._AddLogEntry(w),C._GenerateLimitMessage(q,P)}static get LogCache(){return C._LogCache}static ClearLogCache(){C._LogCache="",C._LogLimitOutputs={},C.errorsCount=0}static set LogLevels(P){C.Log=C._LogDisabled,C.Warn=C._LogDisabled,C.Error=C._LogDisabled;const f=[C.MessageLogLevel,C.WarningLogLevel,C.ErrorLogLevel];for(const Y of f)if((P&Y)===Y){const P=this._Levels[Y];C[P.name]=C._LogEnabled.bind(C,Y)}}}C.NoneLogLevel=0,C.MessageLogLevel=1,C.WarningLogLevel=2,C.ErrorLogLevel=4,C.AllLogLevel=7,C.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",C._LogCache="",C._LogLimitOutputs={},C._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],C.errorsCount=0,C.Log=C._LogEnabled.bind(C,C.MessageLogLevel),C.Warn=C._LogEnabled.bind(C,C.WarningLogLevel),C.Error=C._LogEnabled.bind(C,C.ErrorLogLevel)},11018:(P,f,Y)=>{Y.d(f,{e:()=>L});const C="undefined"!==typeof WeakRef;class q{constructor(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;this.initialize(P,f,Y,C)}initialize(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0;return this.mask=P,this.skipNextObservers=f,this.target=Y,this.currentTarget=C,this}}class m{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=P,this.mask=f,this.scope=Y,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(P)}}class L{static FromPromise(P,f){const Y=new L;return P.then((P=>{Y.notifyObservers(P)})).catch((P=>{if(!f)throw P;f.notifyObservers(P)})),Y}get observers(){return this._observers}constructor(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=f,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new q(0),P&&(this._onObserverAdded=P)}add(P){let f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!P)return null;const q=new m(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);q.unregisterOnNextCall=Y,f?this._observers.unshift(q):this._observers.push(q),this._onObserverAdded&&this._onObserverAdded(q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(q,this._lastNotifiedValue);const L=C?new WeakRef(this):{deref:()=>this};return q._remove=function(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f=L.deref();f&&(P?f.remove(q):f._remove(q))},q}addOnce(P){return this.add(P,void 0,void 0,void 0,!0)}remove(P){if(!P)return!1;P._remove=null;return-1!==this._observers.indexOf(P)&&(this._deferUnregister(P),!0)}removeCallback(P,f){for(let Y=0;Y<this._observers.length;Y++){const C=this._observers[Y];if(!C._willBeUnregistered&&(C.callback===P&&(!f||f===C.scope)))return this._deferUnregister(C),!0}return!1}_deferUnregister(P){P._willBeUnregistered||(this._numObserversMarkedAsDeleted++,P.unregisterOnNextCall=!1,P._willBeUnregistered=!0,setTimeout((()=>{this._remove(P)}),0))}_remove(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!P)return!1;const Y=this._observers.indexOf(P);return-1!==Y&&(f&&this._numObserversMarkedAsDeleted--,this._observers.splice(Y,1),!0)}makeObserverTopPriority(P){this._remove(P,!1),this._observers.unshift(P)}makeObserverBottomPriority(P){this._remove(P,!1),this._observers.push(P)}notifyObservers(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,Y=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=P),!this._observers.length)return!0;const m=this._eventState;m.mask=f,m.target=Y,m.currentTarget=C,m.skipNextObservers=!1,m.lastReturnValue=P,m.userInfo=q;for(const L of this._observers)if(!L._willBeUnregistered&&(L.mask&f&&(L.unregisterOnNextCall&&this._deferUnregister(L),L.scope?m.lastReturnValue=L.callback.apply(L.scope,[P,m]):m.lastReturnValue=L.callback(P,m)),m.skipNextObservers))return!1;return!0}notifyObserver(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=f),P._willBeUnregistered)return;const C=this._eventState;C.mask=Y,C.skipNextObservers=!1,P.unregisterOnNextCall&&this._deferUnregister(P),P.callback(f,C)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const P=this._observers.pop();P&&(P._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const P=new L;return P._observers=this._observers.slice(0),P}hasSpecificMask(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const f of this._observers)if(f.mask&P||f.mask===P)return!0;return!1}}},11087:(P,f,Y)=>{Y.d(f,{b:()=>q,e:()=>L});let C=[];class q{static SetImmediate(P){0===C.length&&setTimeout((()=>{const P=C;C=[];for(const f of P)f()}),1),C.push(P)}}function m(P,f,Y){try{if(P())return f(),!0}catch(C){return null===Y||void 0===Y||Y(C),!0}return!1}const L=function(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,L=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&m(P,f,Y))return null;const o=setInterval((()=>{m(P,f,Y)?clearInterval(o):(q-=C,q<0&&(clearInterval(o),null===Y||void 0===Y||Y(new Error("Operation timed out after maximum retries. "+(L||"")),!0)))}),C);return()=>clearInterval(o)}}}]);