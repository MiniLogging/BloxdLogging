"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10512:(M,E,b)=>{b.r(E),b.d(E,{_KTXTextureLoader:()=>t});var x=b(1060);class k{constructor(M,E){if(this.data=M,this.isInvalid=!1,!k.IsValid(M))return this.isInvalid=!0,void x.d.Error("texture missing KTX identifier");const b=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(this.data.buffer,this.data.byteOffset+12,13*b),g=67305985===a.getUint32(0,!0);return this.glType=a.getUint32(1*b,g),this.glTypeSize=a.getUint32(2*b,g),this.glFormat=a.getUint32(3*b,g),this.glInternalFormat=a.getUint32(4*b,g),this.glBaseInternalFormat=a.getUint32(5*b,g),this.pixelWidth=a.getUint32(6*b,g),this.pixelHeight=a.getUint32(7*b,g),this.pixelDepth=a.getUint32(8*b,g),this.numberOfArrayElements=a.getUint32(9*b,g),this.numberOfFaces=a.getUint32(10*b,g),this.numberOfMipmapLevels=a.getUint32(11*b,g),this.bytesOfKeyValueData=a.getUint32(12*b,g),0!==this.glType?(x.d.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(x.d.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(x.d.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==E?(x.d.Error("number of faces expected"+E+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=k.COMPRESSED_2D))}uploadLevels(M,E){switch(this.loadType){case k.COMPRESSED_2D:this._upload2DCompressedLevels(M,E);case k.TEX_2D:case k.COMPRESSED_3D:case k.TEX_3D:}}_upload2DCompressedLevels(M,E){let b=k.HEADER_LEN+this.bytesOfKeyValueData,x=this.pixelWidth,a=this.pixelHeight;const g=E?this.numberOfMipmapLevels:1;for(let k=0;k<g;k++){const E=new Int32Array(this.data.buffer,this.data.byteOffset+b,1)[0];b+=4;for(let g=0;g<this.numberOfFaces;g++){const n=new Uint8Array(this.data.buffer,this.data.byteOffset+b,E);M.getEngine()._uploadCompressedDataToTextureDirectly(M,M.format,x,a,n,g,k),b+=E,b+=3-(E+3)%4}x=Math.max(1,.5*x),a=Math.max(1,.5*a)}}static IsValid(M){if(M.byteLength>=12){const E=new Uint8Array(M.buffer,M.byteOffset,12);if(171===E[0]&&75===E[1]&&84===E[2]&&88===E[3]&&32===E[4]&&49===E[5]&&49===E[6]&&187===E[7]&&13===E[8]&&10===E[9]&&26===E[10]&&10===E[11])return!0}return!1}}k.HEADER_LEN=64,k.COMPRESSED_2D=0,k.COMPRESSED_3D=1,k.TEX_2D=2,k.TEX_3D=3;var a,g,n,J=b(10519),u=b(1176);function T(M,E){const b=(null===E||void 0===E?void 0:E.jsDecoderModule)||KTX2DECODER;M&&(M.wasmUASTCToASTC&&(b.LiteTranscoder_UASTC_ASTC.WasmModuleURL=M.wasmUASTCToASTC),M.wasmUASTCToBC7&&(b.LiteTranscoder_UASTC_BC7.WasmModuleURL=M.wasmUASTCToBC7),M.wasmUASTCToRGBA_UNORM&&(b.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=M.wasmUASTCToRGBA_UNORM),M.wasmUASTCToRGBA_SRGB&&(b.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=M.wasmUASTCToRGBA_SRGB),M.wasmUASTCToR8_UNORM&&(b.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=M.wasmUASTCToR8_UNORM),M.wasmUASTCToRG8_UNORM&&(b.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=M.wasmUASTCToRG8_UNORM),M.jsMSCTranscoder&&(b.MSCTranscoder.JSModuleURL=M.jsMSCTranscoder),M.wasmMSCTranscoder&&(b.MSCTranscoder.WasmModuleURL=M.wasmMSCTranscoder),M.wasmZSTDDecoder&&(b.ZSTDDecoder.WasmModuleURL=M.wasmZSTDDecoder)),E&&(E.wasmUASTCToASTC&&(b.LiteTranscoder_UASTC_ASTC.WasmBinary=E.wasmUASTCToASTC),E.wasmUASTCToBC7&&(b.LiteTranscoder_UASTC_BC7.WasmBinary=E.wasmUASTCToBC7),E.wasmUASTCToRGBA_UNORM&&(b.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=E.wasmUASTCToRGBA_UNORM),E.wasmUASTCToRGBA_SRGB&&(b.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=E.wasmUASTCToRGBA_SRGB),E.wasmUASTCToR8_UNORM&&(b.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=E.wasmUASTCToR8_UNORM),E.wasmUASTCToRG8_UNORM&&(b.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=E.wasmUASTCToRG8_UNORM),E.jsMSCTranscoder&&(b.MSCTranscoder.JSModule=E.jsMSCTranscoder),E.wasmMSCTranscoder&&(b.MSCTranscoder.WasmBinary=E.wasmMSCTranscoder),E.wasmZSTDDecoder&&(b.ZSTDDecoder.WasmBinary=E.wasmZSTDDecoder))}function V(M){let E;"undefined"===typeof M&&"undefined"!==typeof KTX2DECODER&&(M=KTX2DECODER),onmessage=b=>{if(b.data)switch(b.data.action){case"init":{const x=b.data.urls;x&&(x.jsDecoderModule&&"undefined"===typeof M&&(importScripts(x.jsDecoderModule),M=KTX2DECODER),T(x)),b.data.wasmBinaries&&T(void 0,{...b.data.wasmBinaries,jsDecoderModule:M}),E=new M.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":M.KTX2Decoder.DefaultDecoderOptions=b.data.options;break;case"decode":E.decode(b.data.data,b.data.caps,b.data.options).then((M=>{const E=[];for(let b=0;b<M.mipmaps.length;++b){const x=M.mipmaps[b];x&&x.data&&E.push(x.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:M},E)})).catch((M=>{postMessage({action:"decoded",success:!1,msg:M})}))}}}!function(M){M[M.ETC1S=0]="ETC1S",M[M.UASTC4x4=1]="UASTC4x4"}(a||(a={})),function(M){M[M.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",M[M.BC7_RGBA=1]="BC7_RGBA",M[M.BC3_RGBA=2]="BC3_RGBA",M[M.BC1_RGB=3]="BC1_RGB",M[M.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",M[M.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",M[M.ETC2_RGBA=6]="ETC2_RGBA",M[M.ETC1_RGB=7]="ETC1_RGB",M[M.RGBA32=8]="RGBA32",M[M.R8=9]="R8",M[M.RG8=10]="RG8"}(g||(g={})),function(M){M[M.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",M[M.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",M[M.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",M[M.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",M[M.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",M[M.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",M[M.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",M[M.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",M[M.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",M[M.RGBA8Format=32856]="RGBA8Format",M[M.R8Format=33321]="R8Format",M[M.RG8Format=33323]="RG8Format"}(n||(n={}));class I{static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(M){if(I._WorkerPoolPromise||I._DecoderModulePromise)return;const E={jsDecoderModule:u.e.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:u.e.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:u.e.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:u.e.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:u.e.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};M&&"function"===typeof Worker&&"undefined"!==typeof URL?I._WorkerPoolPromise=new Promise((b=>{const x=`${T}(${V})()`,k=URL.createObjectURL(new Blob([x],{type:"application/javascript"}));b(new J.b(M,(()=>function(M,E,b){return new Promise(((x,k)=>{const a=E=>{M.removeEventListener("error",a),M.removeEventListener("message",g),k(E)},g=E=>{"init"===E.data.action&&(M.removeEventListener("error",a),M.removeEventListener("message",g),x(M))};M.addEventListener("error",a),M.addEventListener("message",g),M.postMessage({action:"init",urls:b,wasmBinaries:E})}))}(new Worker(k),void 0,E))))})):"undefined"===typeof I._KTX2DecoderModule?I._DecoderModulePromise=u.e.LoadBabylonScriptAsync(E.jsDecoderModule).then((()=>(I._KTX2DecoderModule=KTX2DECODER,I._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,I._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,T(E,I._KTX2DecoderModule),new I._KTX2DecoderModule.KTX2Decoder))):(I._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,I._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,I._DecoderModulePromise=Promise.resolve(new I._KTX2DecoderModule.KTX2Decoder))}constructor(M){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.DefaultNumWorkers;this._engine=M;const b="object"===typeof E&&E.workerPool||I.WorkerPool;if(b)I._WorkerPoolPromise=Promise.resolve(b);else{var x;if("object"===typeof E)I._KTX2DecoderModule=null===E||void 0===E||null===(x=E.binariesAndModulesContainer)||void 0===x?void 0:x.jsDecoderModule;else"undefined"!==typeof KTX2DECODER&&(I._KTX2DecoderModule=KTX2DECODER);const M="number"===typeof E?E:E.numWorkers??I.DefaultNumWorkers;I._Initialize(M)}}_uploadAsync(M,E,b){const x=this._engine.getCaps(),k={astc:!!x.astc,bptc:!!x.bptc,s3tc:!!x.s3tc,pvrtc:!!x.pvrtc,etc2:!!x.etc2,etc1:!!x.etc1};if(I._WorkerPoolPromise)return I._WorkerPoolPromise.then((x=>new Promise(((a,g)=>{x.push(((x,n)=>{const J=M=>{x.removeEventListener("error",J),x.removeEventListener("message",u),g(M),n()},u=M=>{if("decoded"===M.data.action){if(x.removeEventListener("error",J),x.removeEventListener("message",u),M.data.success)try{this._createTexture(M.data.decodedData,E,b),a()}catch(k){g({message:k})}else g({message:M.data.msg});n()}};x.addEventListener("error",J),x.addEventListener("message",u),x.postMessage({action:"setDefaultDecoderOptions",options:I.DefaultDecoderOptions._getKTX2DecoderOptions()});const T=new Uint8Array(M.byteLength);T.set(new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),x.postMessage({action:"decode",data:T,caps:k,options:b},[T.buffer])}))}))));if(I._DecoderModulePromise)return I._DecoderModulePromise.then((b=>(I.DefaultDecoderOptions.isDirty&&(I._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=I.DefaultDecoderOptions._getKTX2DecoderOptions()),new Promise(((k,a)=>{b.decode(M,x).then((M=>{this._createTexture(M,E),k()})).catch((M=>{a({message:M})}))})))));throw new Error("KTX2 decoder module is not available")}_createTexture(M,E,b){this._engine._bindTextureDirectly(3553,E),b&&(b.transcodedFormat=M.transcodedFormat,b.isInGammaSpace=M.isInGammaSpace,b.bc=M.bc,b.transcoderName=M.transcoderName);let x=!0;switch(M.transcodedFormat){case 32856:E.type=0,E.format=5;break;case 33321:E.type=0,E.format=6;break;case 33323:E.type=0,E.format=7;break;default:E.format=M.transcodedFormat,x=!1}if(E._gammaSpace=M.isInGammaSpace,E.generateMipMaps=M.mipmaps.length>1,M.errors)throw new Error("KTX2 container - could not transcode the data. "+M.errors);for(let k=0;k<M.mipmaps.length;++k){const b=M.mipmaps[k];if(!b||!b.data)throw new Error("KTX2 container - could not transcode one of the image");x?(E.width=b.width,E.height=b.height,this._engine._uploadDataToTextureDirectly(E,b.data,0,k,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(E,M.transcodedFormat,b.width,b.height,b.data,0,k)}E._extension=".ktx2",E.width=M.mipmaps[0].width,E.height=M.mipmaps[0].height,E.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(M){if(M.byteLength>=12){const E=new Uint8Array(M.buffer,M.byteOffset,12);if(171===E[0]&&75===E[1]&&84===E[2]&&88===E[3]&&32===E[4]&&50===E[5]&&48===E[6]&&187===E[7]&&13===E[8]&&10===E[9]&&26===E[10]&&10===E[11])return!0}return!1}}I.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},I.DefaultNumWorkers=I.GetDefaultNumWorkers(),I.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(M){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==M&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=M,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(M){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==M&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=M,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(M){this._forceRGBA!==M&&(this._forceRGBA=M,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(M){this._forceR8!==M&&(this._forceR8=M,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(M){this._forceRG8!==M&&(this._forceRG8=M,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(M){this._bypassTranscoders!==M&&(this._bypassTranscoders=M,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const M={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(M.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[g.BC1_RGB,g.BC3_RGBA],yes:{transcodeFormat:g.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=M,M}};class t{constructor(){this.supportCascades=!1}loadCubeData(M,E,b,x){if(Array.isArray(M))return;E._invertVScale=!E.invertY;const a=E.getEngine(),g=new k(M,6),n=g.numberOfMipmapLevels>1&&E.generateMipMaps;a._unpackFlipY(!0),g.uploadLevels(E,E.generateMipMaps),E.width=g.pixelWidth,E.height=g.pixelHeight,a._setCubeMapTextureParams(E,n,g.numberOfMipmapLevels-1),E.isReady=!0,E.onLoadedObservable.notifyObservers(E),E.onLoadedObservable.clear(),x&&x()}loadData(M,E,b,a){if(k.IsValid(M)){E._invertVScale=!E.invertY;const x=new k(M,1),a=function(M){switch(M){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(x.glInternalFormat);a?(E.format=a,E._useSRGBBuffer=E.getEngine()._getUseSRGBBuffer(!0,E.generateMipMaps),E._gammaSpace=!0):E.format=x.glInternalFormat,b(x.pixelWidth,x.pixelHeight,E.generateMipMaps,!0,(()=>{x.uploadLevels(E,E.generateMipMaps)}),x.isInvalid)}else if(I.IsValid(M)){new I(E.getEngine())._uploadAsync(M,E,a).then((()=>{b(E.width,E.height,E.generateMipMaps,!0,(()=>{}),!1)}),(M=>{x.d.Warn(`Failed to load KTX2 texture data: ${M.message}`),b(0,0,!1,!1,(()=>{}),!0)}))}else x.d.Error("texture missing KTX identifier"),b(0,0,!1,!1,(()=>{}),!0)}}},10519:(M,E,b)=>{b.d(E,{b:()=>k});class x{constructor(M){this._pendingActions=new Array,this._workerInfos=M.map((M=>({workerPromise:Promise.resolve(M),idle:!0})))}dispose(){for(const M of this._workerInfos)M.workerPromise.then((M=>{M.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(M){this._executeOnIdleWorker(M)||this._pendingActions.push(M)}_executeOnIdleWorker(M){for(const E of this._workerInfos)if(E.idle)return this._execute(E,M),!0;return!1}_execute(M,E){M.idle=!1,M.workerPromise.then((b=>{E(b,(()=>{const E=this._pendingActions.shift();E?this._execute(M,E):M.idle=!0}))}))}}class k extends x{constructor(M,E){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.DefaultOptions;super([]),this._maxWorkers=M,this._createWorkerAsync=E,this._options=b}push(M){if(!this._executeOnIdleWorker(M))if(this._workerInfos.length<this._maxWorkers){const E={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(E),this._execute(E,M)}else this._pendingActions.push(M)}_execute(M,E){M.timeoutId&&(clearTimeout(M.timeoutId),delete M.timeoutId),super._execute(M,((b,x)=>{E(b,(()=>{x(),M.idle&&(M.timeoutId=setTimeout((()=>{M.workerPromise.then((M=>{M.terminate()}));const E=this._workerInfos.indexOf(M);-1!==E&&this._workerInfos.splice(E,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}k.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}}}]);