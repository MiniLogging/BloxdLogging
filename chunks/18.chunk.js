"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[18],{12757:(h,b,I)=>{I.r(b),I.d(b,{_ExrTextureLoader:()=>x});var g=I(10841),O=I(11165);const T=65536,N=14,V=65537,M=16384;var y,q;!function(h){h[h.NO_COMPRESSION=0]="NO_COMPRESSION",h[h.RLE_COMPRESSION=1]="RLE_COMPRESSION",h[h.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",h[h.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",h[h.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",h[h.PXR24_COMPRESSION=5]="PXR24_COMPRESSION"}(y||(y={})),function(h){h[h.INCREASING_Y=0]="INCREASING_Y",h[h.DECREASING_Y=1]="DECREASING_Y"}(q||(q={}));const e=function(){const h=new ArrayBuffer(4),b=new Float32Array(h),I=new Uint32Array(h),g=new Uint32Array(512),O=new Uint32Array(512);for(let M=0;M<256;++M){const h=M-127;h<-27?(g[M]=0,g[256|M]=32768,O[M]=24,O[256|M]=24):h<-14?(g[M]=1024>>-h-14,g[256|M]=1024>>-h-14|32768,O[M]=-h-1,O[256|M]=-h-1):h<=15?(g[M]=h+15<<10,g[256|M]=h+15<<10|32768,O[M]=13,O[256|M]=13):h<128?(g[M]=31744,g[256|M]=64512,O[M]=24,O[256|M]=24):(g[M]=31744,g[256|M]=64512,O[M]=13,O[256|M]=13)}const T=new Uint32Array(2048),N=new Uint32Array(64),V=new Uint32Array(64);for(let M=1;M<1024;++M){let h=M<<13,b=0;for(;0===(8388608&h);)h<<=1,b-=8388608;h&=-8388609,b+=947912704,T[M]=h|b}for(let M=1024;M<2048;++M)T[M]=939524096+(M-1024<<13);for(let M=1;M<31;++M)N[M]=M<<23;N[31]=1199570944,N[32]=2147483648;for(let M=33;M<63;++M)N[M]=2147483648+(M-32<<23);N[63]=3347054592;for(let M=1;M<64;++M)32!==M&&(V[M]=1024);return{floatView:b,uint32View:I,baseTable:g,shiftTable:O,mantissaTable:T,exponentTable:N,offsetTable:V}}();function P(h,b){const I=new Uint8Array(h);let g=0;for(;0!=I[b.value+g];)g+=1;const O=(new TextDecoder).decode(I.slice(b.value,b.value+g));return b.value=b.value+g+1,O}function K(h,b){const I=h.getInt32(b.value,!0);return b.value+=4,I}function o(h,b){const I=h.getUint32(b.value,!0);return b.value+=4,I}function R(h,b){const I=h.getUint8(b.value);return b.value+=1,I}function L(h,b){const I=h.getUint16(b.value,!0);return b.value+=2,I}function i(h,b){const I=h[b.value];return b.value+=1,I}function w(h,b){let I;return I="getBigInt64"in DataView.prototype?Number(h.getBigInt64(b.value,!0)):h.getUint32(b.value+4,!0)+Number(h.getUint32(b.value,!0)<<32),b.value+=8,I}function z(h,b){const I=h.getFloat32(b.value,!0);return b.value+=4,I}function F(h,b){return function(h){const b=(31744&h)>>10,I=1023&h;return(h>>15?-1:1)*(b?31===b?I?NaN:1/0:Math.pow(2,b-15)*(1+I/1024):I/1024*6103515625e-14)}(L(h,b))}function v(h,b){return function(h){if(Math.abs(h)>65504)throw new Error("Value out of range.Consider using float instead of half-float.");h=(0,O.e)(h,-65504,65504),e.floatView[0]=h;const b=e.uint32View[0],I=b>>23&511;return e.baseTable[I]+((8388607&b)>>e.shiftTable[I])}(z(h,b))}function l(h,b,I,g){switch(I){case"string":case"stringvector":case"iccProfile":return function(h,b,I){const g=(new TextDecoder).decode(new Uint8Array(h).slice(b.value,b.value+I));return b.value=b.value+I,g}(h.buffer,b,g);case"chlist":return function(h,b,I){const g=b.value,O=[];for(;b.value<g+I-1;){const I=P(h.buffer,b),g=K(h,b),T=R(h,b);b.value+=3;const N=K(h,b),V=K(h,b);O.push({name:I,pixelType:g,pLinear:T,xSampling:N,ySampling:V})}return b.value+=1,O}(h,b,g);case"chromaticities":return function(h,b){return{redX:z(h,b),redY:z(h,b),greenX:z(h,b),greenY:z(h,b),blueX:z(h,b),blueY:z(h,b),whiteX:z(h,b),whiteY:z(h,b)}}(h,b);case"compression":return function(h,b){return R(h,b)}(h,b);case"box2i":return function(h,b){return{xMin:K(h,b),yMin:K(h,b),xMax:K(h,b),yMax:K(h,b)}}(h,b);case"lineOrder":return function(h,b){const I=R(h,b);return q[I]}(h,b);case"float":return z(h,b);case"v2f":return function(h,b){return[z(h,b),z(h,b)]}(h,b);case"v3f":return function(h,b){return[z(h,b),z(h,b),z(h,b)]}(h,b);case"int":return K(h,b);case"rational":return function(h,b){return[K(h,b),o(h,b)]}(h,b);case"timecode":return function(h,b){return[o(h,b),o(h,b)]}(h,b);case"preview":return b.value+=g,"skipped";default:return void(b.value+=g)}}function A(h){for(let b=1;b<h.length;b++){const I=h[b-1]+h[b]-128;h[b]=I}}function J(h,b){let I=0,g=Math.floor((h.length+1)/2),O=0;const T=h.length-1;for(;!(O>T)&&(b[O++]=h[I++],!(O>T));)b[O++]=h[g++]}function C(h,b,I,g,O){for(;I<h;)b=b<<8|i(g,O),I+=8;return{l:b>>(I-=h)&(1<<h)-1,c:b,lc:I}}function G(h,b,I,g){return{c:h=h<<8|i(I,g),lc:b+=8}}function a(h,b,I,g,O,T,N,V,M){if(h==b){if(g<8){const h=G(I,g,O,T);I=h.c,g=h.lc}let h=I>>(g-=8);if(h=new Uint8Array([h])[0],V.value+h>M)return null;const b=N[V.value-1];for(;h-- >0;)N[V.value++]=b}else{if(!(V.value<M))return null;N[V.value++]=h}return{c:I,lc:g}}const t=new Array(59);function j(h,b,I,g,O,T){const N=b;let M=0,y=0;for(;g<=O;g++){if(N.value-b.value>I)return;let V=C(6,M,y,h,N);const q=V.l;if(M=V.c,y=V.lc,T[g]=q,63==q){if(N.value-b.value>I)throw new Error("Error in HufUnpackEncTable");V=C(8,M,y,h,N);let q=V.l+6;if(M=V.c,y=V.lc,g+q>O+1)throw new Error("Error in HufUnpackEncTable");for(;q--;)T[g++]=0;g--}else if(q>=59){let h=q-59+2;if(g+h>O+1)throw new Error("Error in HufUnpackEncTable");for(;h--;)T[g++]=0;g--}}!function(h){for(let I=0;I<=58;++I)t[I]=0;for(let I=0;I<V;++I)t[h[I]]+=1;let b=0;for(let I=58;I>0;--I){const h=b+t[I]>>1;t[I]=b,b=h}for(let I=0;I<V;++I){const b=h[I];b>0&&(h[I]=b|t[b]++<<6)}}(T)}function k(h){return 63&h}function X(h){return h>>6}function D(h,b,I,g,O,T){const y=I.value,q=o(b,I),e=o(b,I);I.value+=4;const P=o(b,I);if(I.value+=4,q<0||q>=V||e<0||e>=V)throw new Error("Wrong HUF_ENCSIZE");const K=new Array(V),R=new Array(M);!function(h){for(let b=0;b<M;b++)h[b]={},h[b].len=0,h[b].lit=0,h[b].p=null}(R);if(j(h,I,g-(I.value-y),q,e,K),P>8*(g-(I.value-y)))throw new Error("Wrong hufUncompress");!function(h,b,I,g){for(;b<=I;b++){const I=X(h[b]),O=k(h[b]);if(I>>O)throw new Error("Invalid table entry");if(O>N){const h=g[I>>O-N];if(h.len)throw new Error("Invalid table entry");if(h.lit++,h.p){const b=h.p;h.p=new Array(h.lit);for(let I=0;I<h.lit-1;++I)h.p[I]=b[I]}else h.p=new Array(1);h.p[h.lit-1]=b}else if(O){let h=0;for(let T=1<<N-O;T>0;T--){const T=g[(I<<N-O)+h];if(T.len||T.p)throw new Error("Invalid table entry");T.len=O,T.lit=b,h++}}}}(K,q,e,R),function(h,b,I,g,O,T,V,M,y){let q=0,e=0;const P=V,K=Math.trunc(g.value+(O+7)/8);for(;g.value<K;){let O=G(q,e,I,g);for(q=O.c,e=O.lc;e>=N;){const V=b[q>>e-N&16383];if(V.len){e-=V.len;const h=a(V.lit,T,q,e,I,g,M,y,P);h&&(q=h.c,e=h.lc)}else{if(!V.p)throw new Error("hufDecode issues");let b;for(b=0;b<V.lit;b++){const N=k(h[V.p[b]]);for(;e<N&&g.value<K;)O=G(q,e,I,g),q=O.c,e=O.lc;if(e>=N&&X(h[V.p[b]])==(q>>e-N&(1<<N)-1)){e-=N;const h=a(V.p[b],T,q,e,I,g,M,y,P);h&&(q=h.c,e=h.lc);break}}if(b==V.lit)throw new Error("HufDecode issues")}}}const o=8-O&7;for(q>>=o,e-=o;e>0;){const h=b[q<<N-e&16383];if(!h.len)throw new Error("HufDecode issues");{e-=h.len;const b=a(h.lit,T,q,e,I,g,M,y,P);b&&(q=b.c,e=b.lc)}}}(K,R,h,I,P,e,T,O,{value:0})}function n(h){return 65535&h}function f(h){const b=n(h);return b>32767?b-65536:b}function r(h,b){const I=f(h),g=f(b),O=I+(1&g)+(g>>1);return{a:O,b:O-g}}function B(h,b){const I=n(h),g=n(b),O=I-(g>>1)&65535;return{a:g+O-32768&65535,b:O}}function m(h,b,I,g,O,T,N){const V=N<16384,M=I>O?O:I;let y,q,e=1;for(;e<=M;)e<<=1;for(e>>=1,y=e,e>>=1;e>=1;){q=0;const N=q+T*(O-y),M=T*e,P=T*y,K=g*e,o=g*y;let R,L,i,w;for(;q<=N;q+=P){let O=q;const T=q+g*(I-y);for(;O<=T;O+=o){const I=O+K,g=O+M,T=g+K;if(V){let N=r(h[O+b],h[g+b]);R=N.a,i=N.b,N=r(h[I+b],h[T+b]),L=N.a,w=N.b,N=r(R,L),h[O+b]=N.a,h[I+b]=N.b,N=r(i,w),h[g+b]=N.a,h[T+b]=N.b}else{let N=B(h[O+b],h[g+b]);R=N.a,i=N.b,N=B(h[I+b],h[T+b]),L=N.a,w=N.b,N=B(R,L),h[O+b]=N.a,h[I+b]=N.b,N=B(i,w),h[g+b]=N.a,h[T+b]=N.b}}if(I&e){const I=O+M;let g;g=V?r(h[O+b],h[I+b]):B(h[O+b],h[I+b]),R=g.a,h[I+b]=g.b,h[O+b]=R}}if(O&e){let O=q;const T=q+g*(I-y);for(;O<=T;O+=o){const I=O+K;let g;g=V?r(h[O+b],h[I+b]):B(h[O+b],h[I+b]),R=g.a,h[I+b]=g.b,h[O+b]=R}}y=e,e>>=1}return q}function U(h){return new DataView(h.array.buffer,h.offset.value,h.size)}function d(h){const b=h.viewer.buffer.slice(h.offset.value,h.offset.value+h.size),I=new Uint8Array(function(h){let b=h.byteLength;const I=new Array;let g=0;const O=new DataView(h);for(;b>0;){const h=O.getInt8(g++);if(h<0){const T=-h;b-=T+1;for(let h=0;h<T;h++)I.push(O.getUint8(g++))}else{const T=h;b-=2;const N=O.getUint8(g++);for(let h=0;h<T+1;h++)I.push(N)}}return I}(b)),g=new Uint8Array(I.length);return A(I),J(I,g),new DataView(g.buffer)}function s(h){const b=h.array.slice(h.offset.value,h.offset.value+h.size),I=fflate.unzlibSync(b),g=new Uint8Array(I.length);return A(I),J(I,g),new DataView(g.buffer)}function c(h){const b=h.array.slice(h.offset.value,h.offset.value+h.size),I=fflate.unzlibSync(b),g=h.lines*h.channels*h.width,O=1==h.type?new Uint16Array(g):new Uint32Array(g);let T=0,N=0;const V=new Array(4);for(let M=0;M<h.lines;M++)for(let b=0;b<h.channels;b++){let b=0;switch(h.type){case 1:V[0]=T,V[1]=V[0]+h.width,T=V[1]+h.width;for(let g=0;g<h.width;++g){b+=I[V[0]++]<<8|I[V[1]++],O[N]=b,N++}break;case 2:V[0]=T,V[1]=V[0]+h.width,V[2]=V[1]+h.width,T=V[2]+h.width;for(let g=0;g<h.width;++g){b+=I[V[0]++]<<24|I[V[1]++]<<16|I[V[2]++]<<8,O[N]=b,N++}}}return new DataView(O.buffer)}function E(h){const b=h.viewer,I={value:h.offset.value},g=new Uint16Array(h.width*h.scanlineBlockSize*(h.channels*h.type)),O=new Uint8Array(8192);let N=0;const V=new Array(h.channels);for(let T=0;T<h.channels;T++)V[T]={},V[T].start=N,V[T].end=V[T].start,V[T].nx=h.width,V[T].ny=h.lines,V[T].size=h.type,N+=V[T].nx*V[T].ny*V[T].size;const M=L(b,I),y=L(b,I);if(y>=8192)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(M<=y)for(let T=0;T<y-M+1;T++)O[T+M]=R(b,I);const q=new Uint16Array(T),e=function(h,b){let I=0;for(let O=0;O<T;++O)(0==O||h[O>>3]&1<<(7&O))&&(b[I++]=O);const g=I-1;for(;I<T;)b[I++]=0;return g}(O,q),P=o(b,I);D(h.array,b,I,P,g,N);for(let T=0;T<h.channels;++T){const h=V[T];for(let b=0;b<V[T].size;++b)m(g,h.start+b,h.nx,h.size,h.ny,h.nx*h.size,e)}!function(h,b,I){for(let g=0;g<I;++g)b[g]=h[b[g]]}(q,g,N);let K=0;const i=new Uint8Array(g.buffer.byteLength);for(let T=0;T<h.lines;T++)for(let b=0;b<h.channels;b++){const h=V[b],I=h.nx*h.size,O=new Uint8Array(g.buffer,2*h.end,2*I);i.set(O,K),K+=2*I,h.end+=I}return new DataView(i.buffer)}var p,W=I(10824);!function(h){h[h.Float=0]="Float",h[h.HalfFloat=1]="HalfFloat"}(p||(p={}));class S{}S.DefaultOutputType=p.HalfFloat,S.FFLATEUrl="https://unpkg.com/fflate@0.8.2";class x{constructor(){this.supportCascades=!1}loadCubeData(h,b,I,g,O){throw".exr not supported in Cube."}async loadData(h,b,I){const O=new DataView(h.buffer),T={value:0},N=function(h,b){if(20000630!=h.getUint32(0,!0))throw new Error("Incorrect OpenEXR format");const I=h.getUint8(4),O=h.getUint8(5),T={singleTile:!!(2&O),longName:!!(4&O),deepFormat:!!(8&O),multiPart:!!(16&O)};b.value=8;const N={};let V=!0;for(;V;){const I=P(h.buffer,b);if(I){const O=P(h.buffer,b),T=l(h,b,O,o(h,b));void 0===T?g.e.Warn(`Unknown header attribute type ${O}'.`):N[I]=T}else V=!1}if(0!=(-5&O))throw new Error("Unsupported file format");return{version:I,spec:T,...N}}(O,T),V=await async function(h,b,I,g){const O={size:0,viewer:b,array:new Uint8Array(b.buffer),offset:I,width:h.dataWindow.xMax-h.dataWindow.xMin+1,height:h.dataWindow.yMax-h.dataWindow.yMin+1,channels:h.channels.length,channelLineOffsets:{},scanOrder:()=>0,bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:()=>0,format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0};switch(h.compression){case y.NO_COMPRESSION:O.lines=1,O.uncompress=U;break;case y.RLE_COMPRESSION:O.lines=1,O.uncompress=d;break;case y.ZIPS_COMPRESSION:O.lines=1,O.uncompress=s,await W.c.LoadScriptAsync(S.FFLATEUrl);break;case y.ZIP_COMPRESSION:O.lines=16,O.uncompress=s,await W.c.LoadScriptAsync(S.FFLATEUrl);break;case y.PIZ_COMPRESSION:O.lines=32,O.uncompress=E;break;case y.PXR24_COMPRESSION:O.lines=16,O.uncompress=c,await W.c.LoadScriptAsync(S.FFLATEUrl);break;default:throw new Error(y[h.compression]+" is unsupported")}O.scanlineBlockSize=O.lines;const T={};for(const y of h.channels)switch(y.name){case"Y":case"R":case"G":case"B":case"A":T[y.name]=!0,O.type=y.pixelType}let N=!1;if(T.R&&T.G&&T.B)N=!T.A,O.outputChannels=4,O.decodeChannels={R:0,G:1,B:2,A:3};else{if(!T.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");O.outputChannels=1,O.decodeChannels={Y:0}}if(1===O.type)switch(g){case p.Float:O.getter=F,O.inputSize=2;break;case p.HalfFloat:O.getter=L,O.inputSize=2}else{if(2!==O.type)throw new Error("Unsupported pixelType "+O.type+" for "+h.compression);switch(g){case p.Float:O.getter=z,O.inputSize=4;break;case p.HalfFloat:O.getter=v,O.inputSize=4}}O.blockCount=O.height/O.scanlineBlockSize;for(let y=0;y<O.blockCount;y++)w(b,I);const V=O.width*O.height*O.outputChannels;switch(g){case p.Float:O.byteArray=new Float32Array(V),O.textureType=1,N&&O.byteArray.fill(1,0,V);break;case p.HalfFloat:O.byteArray=new Uint16Array(V),O.textureType=2,N&&O.byteArray.fill(15360,0,V);break;default:throw new Error("Unsupported type: "+g)}let M=0;for(const y of h.channels)void 0!==O.decodeChannels[y.name]&&(O.channelLineOffsets[y.name]=M*O.width),M+=2*y.pixelType;return O.bytesPerLine=O.width*M,O.outLineWidth=O.width*O.outputChannels,"INCREASING_Y"===h.lineOrder?O.scanOrder=h=>h:O.scanOrder=h=>O.height-1-h,4==O.outputChannels?(O.format=5,O.linearSpace=!0):(O.format=6,O.linearSpace=!1),O}(N,O,T,S.DefaultOutputType);!function(h,b,I,g){const O={value:0};for(let T=0;T<h.height/h.scanlineBlockSize;T++){const N=K(I,g)-b.dataWindow.yMin;h.size=o(I,g),h.lines=N+h.scanlineBlockSize>h.height?h.height-N:h.scanlineBlockSize;const V=h.size<h.lines*h.bytesPerLine&&h.uncompress?h.uncompress(h):U(h);g.value+=h.size;for(let I=0;I<h.scanlineBlockSize;I++){const g=T*h.scanlineBlockSize,N=I+h.scanOrder(g);if(N>=h.height)continue;const M=I*h.bytesPerLine,y=(h.height-1-N)*h.outLineWidth;for(let I=0;I<h.channels;I++){const g=b.channels[I].name,T=h.channelLineOffsets[g],N=h.decodeChannels[g];if(void 0!==N){O.value=M+T;for(let b=0;b<h.width;b++){const I=y+b*h.outputChannels+N;h.byteArray&&(h.byteArray[I]=h.getter(V,O))}}}}}}(V,N,O,T);I(N.dataWindow.xMax-N.dataWindow.xMin+1,N.dataWindow.yMax-N.dataWindow.yMin+1,b.generateMipMaps,!1,(()=>{const h=b.getEngine();b.format=N.format,b.type=V.textureType,b.invertY=!1,b._gammaSpace=!N.linearSpace,V.byteArray&&h._uploadDataToTextureDirectly(b,V.byteArray,0,0,void 0,!0)}))}}}}]);