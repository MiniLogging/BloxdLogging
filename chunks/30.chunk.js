"use strict";(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[30],{14817:(N,U,V)=>{V.r(U),V.d(U,{_KTXTextureLoader:()=>B});var A=V(12193);class t{constructor(N,U){if(this.data=N,this.isInvalid=!1,!t.IsValid(N))return this.isInvalid=!0,void A.b.Error("texture missing KTX identifier");const V=Uint32Array.BYTES_PER_ELEMENT,n=new DataView(this.data.buffer,this.data.byteOffset+12,13*V),q=67305985===n.getUint32(0,!0);return this.glType=n.getUint32(1*V,q),this.glTypeSize=n.getUint32(2*V,q),this.glFormat=n.getUint32(3*V,q),this.glInternalFormat=n.getUint32(4*V,q),this.glBaseInternalFormat=n.getUint32(5*V,q),this.pixelWidth=n.getUint32(6*V,q),this.pixelHeight=n.getUint32(7*V,q),this.pixelDepth=n.getUint32(8*V,q),this.numberOfArrayElements=n.getUint32(9*V,q),this.numberOfFaces=n.getUint32(10*V,q),this.numberOfMipmapLevels=n.getUint32(11*V,q),this.bytesOfKeyValueData=n.getUint32(12*V,q),0!==this.glType?(A.b.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(A.b.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(A.b.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==U?(A.b.Error("number of faces expected"+U+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=t.COMPRESSED_2D))}uploadLevels(N,U){switch(this.loadType){case t.COMPRESSED_2D:this._upload2DCompressedLevels(N,U);case t.TEX_2D:case t.COMPRESSED_3D:case t.TEX_3D:}}_upload2DCompressedLevels(N,U){let V=t.HEADER_LEN+this.bytesOfKeyValueData,A=this.pixelWidth,n=this.pixelHeight;const q=U?this.numberOfMipmapLevels:1;for(let t=0;t<q;t++){const U=new Int32Array(this.data.buffer,this.data.byteOffset+V,1)[0];V+=4;for(let q=0;q<this.numberOfFaces;q++){const i=new Uint8Array(this.data.buffer,this.data.byteOffset+V,U);N.getEngine()._uploadCompressedDataToTextureDirectly(N,N.format,A,n,i,q,t),V+=U,V+=3-(U+3)%4}A=Math.max(1,.5*A),n=Math.max(1,.5*n)}}static IsValid(N){if(N.byteLength>=12){const U=new Uint8Array(N.buffer,N.byteOffset,12);if(171===U[0]&&75===U[1]&&84===U[2]&&88===U[3]&&32===U[4]&&49===U[5]&&49===U[6]&&187===U[7]&&13===U[8]&&10===U[9]&&26===U[10]&&10===U[11])return!0}return!1}}t.HEADER_LEN=64,t.COMPRESSED_2D=0,t.COMPRESSED_3D=1,t.TEX_2D=2,t.TEX_3D=3;var n,q,i,z=V(12918),S=V(12179);function E(N,U){const V=(null===U||void 0===U?void 0:U.jsDecoderModule)||KTX2DECODER;N&&(N.wasmUASTCToASTC&&(V.LiteTranscoder_UASTC_ASTC.WasmModuleURL=N.wasmUASTCToASTC),N.wasmUASTCToBC7&&(V.LiteTranscoder_UASTC_BC7.WasmModuleURL=N.wasmUASTCToBC7),N.wasmUASTCToRGBA_UNORM&&(V.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=N.wasmUASTCToRGBA_UNORM),N.wasmUASTCToRGBA_SRGB&&(V.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=N.wasmUASTCToRGBA_SRGB),N.wasmUASTCToR8_UNORM&&(V.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=N.wasmUASTCToR8_UNORM),N.wasmUASTCToRG8_UNORM&&(V.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=N.wasmUASTCToRG8_UNORM),N.jsMSCTranscoder&&(V.MSCTranscoder.JSModuleURL=N.jsMSCTranscoder),N.wasmMSCTranscoder&&(V.MSCTranscoder.WasmModuleURL=N.wasmMSCTranscoder),N.wasmZSTDDecoder&&(V.ZSTDDecoder.WasmModuleURL=N.wasmZSTDDecoder)),U&&(U.wasmUASTCToASTC&&(V.LiteTranscoder_UASTC_ASTC.WasmBinary=U.wasmUASTCToASTC),U.wasmUASTCToBC7&&(V.LiteTranscoder_UASTC_BC7.WasmBinary=U.wasmUASTCToBC7),U.wasmUASTCToRGBA_UNORM&&(V.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=U.wasmUASTCToRGBA_UNORM),U.wasmUASTCToRGBA_SRGB&&(V.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=U.wasmUASTCToRGBA_SRGB),U.wasmUASTCToR8_UNORM&&(V.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=U.wasmUASTCToR8_UNORM),U.wasmUASTCToRG8_UNORM&&(V.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=U.wasmUASTCToRG8_UNORM),U.jsMSCTranscoder&&(V.MSCTranscoder.JSModule=U.jsMSCTranscoder),U.wasmMSCTranscoder&&(V.MSCTranscoder.WasmBinary=U.wasmMSCTranscoder),U.wasmZSTDDecoder&&(V.ZSTDDecoder.WasmBinary=U.wasmZSTDDecoder))}function p(N){let U;"undefined"===typeof N&&"undefined"!==typeof KTX2DECODER&&(N=KTX2DECODER),onmessage=V=>{if(V.data)switch(V.data.action){case"init":{const A=V.data.urls;A&&(A.jsDecoderModule&&"undefined"===typeof N&&(importScripts(A.jsDecoderModule),N=KTX2DECODER),E(A)),V.data.wasmBinaries&&E(void 0,{...V.data.wasmBinaries,jsDecoderModule:N}),U=new N.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":N.KTX2Decoder.DefaultDecoderOptions=V.data.options;break;case"decode":U.decode(V.data.data,V.data.caps,V.data.options).then((N=>{const U=[];for(let V=0;V<N.mipmaps.length;++V){const A=N.mipmaps[V];A&&A.data&&U.push(A.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:N},U)})).catch((N=>{postMessage({action:"decoded",success:!1,SU:N})}))}}}!function(N){N[N.ETC1S=0]="ETC1S",N[N.UASTC4x4=1]="UASTC4x4"}(n||(n={})),function(N){N[N.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",N[N.BC7_RGBA=1]="BC7_RGBA",N[N.BC3_RGBA=2]="BC3_RGBA",N[N.BC1_RGB=3]="BC1_RGB",N[N.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",N[N.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",N[N.ETC2_RGBA=6]="ETC2_RGBA",N[N.ETC1_RGB=7]="ETC1_RGB",N[N.RGBA32=8]="RGBA32",N[N.R8=9]="R8",N[N.RG8=10]="RG8"}(q||(q={})),function(N){N[N.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",N[N.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",N[N.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",N[N.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",N[N.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",N[N.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",N[N.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",N[N.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",N[N.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",N[N.RGBA8Format=32856]="RGBA8Format",N[N.R8Format=33321]="R8Format",N[N.RG8Format=33323]="RG8Format"}(i||(i={}));class k{static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(N){if(k._WorkerPoolPromise||k._DecoderModulePromise)return;const U={jsDecoderModule:S.Tools.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:S.Tools.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:S.Tools.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};N&&"function"===typeof Worker&&"undefined"!==typeof URL?k._WorkerPoolPromise=new Promise((V=>{const A=`${E}(${p})()`,t=URL.createObjectURL(new Blob([A],{type:"application/javascript"}));V(new z.b(N,(async()=>await async function(N,U,V){return await new Promise(((A,t)=>{const n=U=>{N.removeEventListener("error",n),N.removeEventListener("message",q),t(U)},q=U=>{"init"===U.data.action&&(N.removeEventListener("error",n),N.removeEventListener("message",q),A(N))};N.addEventListener("error",n),N.addEventListener("message",q),N.postMessage({action:"init",urls:V,wasmBinaries:U})}))}(new Worker(t),void 0,U))))})):"undefined"===typeof k._KTX2DecoderModule?k._DecoderModulePromise=S.Tools.LoadBabylonScriptAsync(U.jsDecoderModule).then((()=>(k._KTX2DecoderModule=KTX2DECODER,k._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,k._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,E(U,k._KTX2DecoderModule),new k._KTX2DecoderModule.KTX2Decoder))):(k._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,k._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,k._DecoderModulePromise=Promise.resolve(new k._KTX2DecoderModule.KTX2Decoder))}constructor(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.DefaultNumWorkers;this._engine=N;const V="object"===typeof U&&U.workerPool||k.WorkerPool;if(V)k._WorkerPoolPromise=Promise.resolve(V);else{var A;if("object"===typeof U)k._KTX2DecoderModule=null===U||void 0===U||null===(A=U.binariesAndModulesContainer)||void 0===A?void 0:A.jsDecoderModule;else"undefined"!==typeof KTX2DECODER&&(k._KTX2DecoderModule=KTX2DECODER);const N="number"===typeof U?U:U.numWorkers??k.DefaultNumWorkers;k._Initialize(N)}}async _uploadAsync(N,U,V){const A=this._engine.getCaps(),t={astc:!!A.astc,bptc:!!A.bptc,s3tc:!!A.s3tc,pvrtc:!!A.pvrtc,etc2:!!A.etc2,etc1:!!A.etc1};if(k._WorkerPoolPromise){const A=await k._WorkerPoolPromise;return await new Promise(((n,q)=>{A.push(((A,i)=>{const z=N=>{A.removeEventListener("error",z),A.removeEventListener("message",S),q(N),i()},S=N=>{if("decoded"===N.data.action){if(A.removeEventListener("error",z),A.removeEventListener("message",S),N.data.success)try{this._createTexture(N.data.decodedData,U,V),n()}catch(t){q({message:t})}else q({message:N.data.SU});i()}};A.addEventListener("error",z),A.addEventListener("message",S),A.postMessage({action:"setDefaultDecoderOptions",options:k.DefaultDecoderOptions._getKTX2DecoderOptions()});const E=new Uint8Array(N.byteLength);E.set(new Uint8Array(N.buffer,N.byteOffset,N.byteLength)),A.postMessage({action:"decode",data:E,caps:t,options:V},[E.buffer])}))}))}if(k._DecoderModulePromise){const V=await k._DecoderModulePromise;return k.DefaultDecoderOptions.isDirty&&(k._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=k.DefaultDecoderOptions._getKTX2DecoderOptions()),await new Promise(((t,n)=>{V.decode(N,A).then((N=>{this._createTexture(N,U),t()})).catch((N=>{n({message:N})}))}))}throw new Error("KTX2 decoder module is not available")}_createTexture(N,U,V){this._engine._bindTextureDirectly(3553,U),V&&(V.transcodedFormat=N.transcodedFormat,V.isInGammaSpace=N.isInGammaSpace,V.ki=N.ki,V.transcoderName=N.transcoderName);let A=!0;switch(N.transcodedFormat){case 32856:U.type=0,U.format=5;break;case 33321:U.type=0,U.format=6;break;case 33323:U.type=0,U.format=7;break;default:U.format=N.transcodedFormat,A=!1}if(U._gammaSpace=N.isInGammaSpace,U.generateMipMaps=N.mipmaps.length>1,N.errors)throw new Error("KTX2 container - could not transcode the data. "+N.errors);for(let t=0;t<N.mipmaps.length;++t){const V=N.mipmaps[t];if(!V||!V.data)throw new Error("KTX2 container - could not transcode one of the image");A?(U.width=V.width,U.height=V.height,this._engine._uploadDataToTextureDirectly(U,V.data,0,t,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(U,N.transcodedFormat,V.width,V.height,V.data,0,t)}U._extension=".ktx2",U.width=N.mipmaps[0].width,U.height=N.mipmaps[0].height,U.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(N){if(N.byteLength>=12){const U=new Uint8Array(N.buffer,N.byteOffset,12);if(171===U[0]&&75===U[1]&&84===U[2]&&88===U[3]&&32===U[4]&&50===U[5]&&48===U[6]&&187===U[7]&&13===U[8]&&10===U[9]&&26===U[10]&&10===U[11])return!0}return!1}}k.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},k.DefaultNumWorkers=k.GetDefaultNumWorkers(),k.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(N){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==N&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=N,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(N){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==N&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=N,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(N){this._forceRGBA!==N&&(this._forceRGBA=N,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(N){this._forceR8!==N&&(this._forceR8=N,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(N){this._forceRG8!==N&&(this._forceRG8=N,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(N){this._bypassTranscoders!==N&&(this._bypassTranscoders=N,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const N={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(N.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[q.BC1_RGB,q.BC3_RGBA],yes:{transcodeFormat:q.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=N,N}};class B{constructor(){this.supportCascades=!1}loadCubeData(N,U,V,A){if(Array.isArray(N))return;U._invertVScale=!U.invertY;const n=U.getEngine(),q=new t(N,6),i=q.numberOfMipmapLevels>1&&U.generateMipMaps;n._unpackFlipY(!0),q.uploadLevels(U,U.generateMipMaps),U.width=q.pixelWidth,U.height=q.pixelHeight,n._setCubeMapTextureParams(U,i,q.numberOfMipmapLevels-1),U.isReady=!0,U.onLoadedObservable.notifyObservers(U),U.onLoadedObservable.clear(),A&&A()}loadData(N,U,V,n){if(t.IsValid(N)){U._invertVScale=!U.invertY;const A=new t(N,1),n=function(N){switch(N){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(A.glInternalFormat);n?(U.format=n,U._useSRGBBuffer=U.getEngine()._getUseSRGBBuffer(!0,U.generateMipMaps),U._gammaSpace=!0):U.format=A.glInternalFormat,V(A.pixelWidth,A.pixelHeight,U.generateMipMaps,!0,(()=>{A.uploadLevels(U,U.generateMipMaps)}),A.isInvalid)}else if(k.IsValid(N)){new k(U.getEngine())._uploadAsync(N,U,n).then((()=>{V(U.width,U.height,U.generateMipMaps,!0,(()=>{}),!1)}),(N=>{A.b.Warn(`Failed to load KTX2 texture data: ${N.message}`),V(0,0,!1,!1,(()=>{}),!0)}))}else A.b.Error("texture missing KTX identifier"),V(0,0,!1,!1,(()=>{}),!0)}}},12918:(N,U,V)=>{V.d(U,{b:()=>t});class A{constructor(N){this._pendingActions=new Array,this._workerInfos=N.map((N=>({workerPromise:Promise.resolve(N),idle:!0})))}dispose(){for(const N of this._workerInfos)N.workerPromise.then((N=>{N.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(N){this._executeOnIdleWorker(N)||this._pendingActions.push(N)}_executeOnIdleWorker(N){for(const U of this._workerInfos)if(U.idle)return this._execute(U,N),!0;return!1}_execute(N,U){N.idle=!1,N.workerPromise.then((V=>{U(V,(()=>{const U=this._pendingActions.shift();U?this._execute(N,U):N.idle=!0}))}))}}class t extends A{constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.DefaultOptions;super([]),this._maxWorkers=N,this._createWorkerAsync=U,this._options=V}push(N){if(!this._executeOnIdleWorker(N))if(this._workerInfos.length<this._maxWorkers){const U={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(U),this._execute(U,N)}else this._pendingActions.push(N)}_execute(N,U){N.timeoutId&&(clearTimeout(N.timeoutId),delete N.timeoutId),super._execute(N,((V,A)=>{U(V,(()=>{A(),N.idle&&(N.timeoutId=setTimeout((()=>{N.workerPromise.then((N=>{N.terminate()}));const U=this._workerInfos.indexOf(N);-1!==U&&this._workerInfos.splice(U,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}t.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}}}]);