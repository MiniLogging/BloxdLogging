"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[30],{14108:(b,d,P)=>{P.r(d),P.d(d,{_KTXTextureLoader:()=>E});var G=P(11504);class W{constructor(b,d){if(this.data=b,this.isInvalid=!1,!W.IsValid(b))return this.isInvalid=!0,void G.e.Error("texture missing KTX identifier");const P=Uint32Array.BYTES_PER_ELEMENT,i=new DataView(this.data.buffer,this.data.byteOffset+12,13*P),q=67305985===i.getUint32(0,!0);return this.glType=i.getUint32(1*P,q),this.glTypeSize=i.getUint32(2*P,q),this.glFormat=i.getUint32(3*P,q),this.glInternalFormat=i.getUint32(4*P,q),this.glBaseInternalFormat=i.getUint32(5*P,q),this.pixelWidth=i.getUint32(6*P,q),this.pixelHeight=i.getUint32(7*P,q),this.pixelDepth=i.getUint32(8*P,q),this.numberOfArrayElements=i.getUint32(9*P,q),this.numberOfFaces=i.getUint32(10*P,q),this.numberOfMipmapLevels=i.getUint32(11*P,q),this.bytesOfKeyValueData=i.getUint32(12*P,q),0!==this.glType?(G.e.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(G.e.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(G.e.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==d?(G.e.Error("number of faces expected"+d+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=W.COMPRESSED_2D))}uploadLevels(b,d){switch(this.loadType){case W.COMPRESSED_2D:this._upload2DCompressedLevels(b,d);case W.TEX_2D:case W.COMPRESSED_3D:case W.TEX_3D:}}_upload2DCompressedLevels(b,d){let P=W.HEADER_LEN+this.bytesOfKeyValueData,G=this.pixelWidth,i=this.pixelHeight;const q=d?this.numberOfMipmapLevels:1;for(let W=0;W<q;W++){const d=new Int32Array(this.data.buffer,this.data.byteOffset+P,1)[0];P+=4;for(let q=0;q<this.numberOfFaces;q++){const C=new Uint8Array(this.data.buffer,this.data.byteOffset+P,d);b.getEngine()._uploadCompressedDataToTextureDirectly(b,b.format,G,i,C,q,W),P+=d,P+=3-(d+3)%4}G=Math.max(1,.5*G),i=Math.max(1,.5*i)}}static IsValid(b){if(b.byteLength>=12){const d=new Uint8Array(b.buffer,b.byteOffset,12);if(171===d[0]&&75===d[1]&&84===d[2]&&88===d[3]&&32===d[4]&&49===d[5]&&49===d[6]&&187===d[7]&&13===d[8]&&10===d[9]&&26===d[10]&&10===d[11])return!0}return!1}}W.HEADER_LEN=64,W.COMPRESSED_2D=0,W.COMPRESSED_3D=1,W.TEX_2D=2,W.TEX_3D=3;var i,q,C,J=P(12257),L=P(11484);function x(b,d){const P=(null===d||void 0===d?void 0:d.jsDecoderModule)||KTX2DECODER;b&&(b.wasmUASTCToASTC&&(P.LiteTranscoder_UASTC_ASTC.WasmModuleURL=b.wasmUASTCToASTC),b.wasmUASTCToBC7&&(P.LiteTranscoder_UASTC_BC7.WasmModuleURL=b.wasmUASTCToBC7),b.wasmUASTCToRGBA_UNORM&&(P.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=b.wasmUASTCToRGBA_UNORM),b.wasmUASTCToRGBA_SRGB&&(P.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=b.wasmUASTCToRGBA_SRGB),b.wasmUASTCToR8_UNORM&&(P.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=b.wasmUASTCToR8_UNORM),b.wasmUASTCToRG8_UNORM&&(P.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=b.wasmUASTCToRG8_UNORM),b.jsMSCTranscoder&&(P.MSCTranscoder.JSModuleURL=b.jsMSCTranscoder),b.wasmMSCTranscoder&&(P.MSCTranscoder.WasmModuleURL=b.wasmMSCTranscoder),b.wasmZSTDDecoder&&(P.ZSTDDecoder.WasmModuleURL=b.wasmZSTDDecoder)),d&&(d.wasmUASTCToASTC&&(P.LiteTranscoder_UASTC_ASTC.WasmBinary=d.wasmUASTCToASTC),d.wasmUASTCToBC7&&(P.LiteTranscoder_UASTC_BC7.WasmBinary=d.wasmUASTCToBC7),d.wasmUASTCToRGBA_UNORM&&(P.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=d.wasmUASTCToRGBA_UNORM),d.wasmUASTCToRGBA_SRGB&&(P.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=d.wasmUASTCToRGBA_SRGB),d.wasmUASTCToR8_UNORM&&(P.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=d.wasmUASTCToR8_UNORM),d.wasmUASTCToRG8_UNORM&&(P.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=d.wasmUASTCToRG8_UNORM),d.jsMSCTranscoder&&(P.MSCTranscoder.JSModule=d.jsMSCTranscoder),d.wasmMSCTranscoder&&(P.MSCTranscoder.WasmBinary=d.wasmMSCTranscoder),d.wasmZSTDDecoder&&(P.ZSTDDecoder.WasmBinary=d.wasmZSTDDecoder))}function Y(b){let d;"undefined"===typeof b&&"undefined"!==typeof KTX2DECODER&&(b=KTX2DECODER),onmessage=P=>{if(P.data)switch(P.data.action){case"init":{const G=P.data.urls;G&&(G.jsDecoderModule&&"undefined"===typeof b&&(importScripts(G.jsDecoderModule),b=KTX2DECODER),x(G)),P.data.wasmBinaries&&x(void 0,{...P.data.wasmBinaries,jsDecoderModule:b}),d=new b.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":b.KTX2Decoder.DefaultDecoderOptions=P.data.options;break;case"decode":d.decode(P.data.data,P.data.caps,P.data.options).then((b=>{const d=[];for(let P=0;P<b.mipmaps.length;++P){const G=b.mipmaps[P];G&&G.data&&d.push(G.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:b},d)})).catch((b=>{postMessage({action:"decoded",success:!1,nd:b})}))}}}!function(b){b[b.ETC1S=0]="ETC1S",b[b.UASTC4x4=1]="UASTC4x4"}(i||(i={})),function(b){b[b.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",b[b.BC7_RGBA=1]="BC7_RGBA",b[b.BC3_RGBA=2]="BC3_RGBA",b[b.BC1_RGB=3]="BC1_RGB",b[b.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",b[b.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",b[b.ETC2_RGBA=6]="ETC2_RGBA",b[b.ETC1_RGB=7]="ETC1_RGB",b[b.RGBA32=8]="RGBA32",b[b.R8=9]="R8",b[b.RG8=10]="RG8"}(q||(q={})),function(b){b[b.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",b[b.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",b[b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",b[b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",b[b.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",b[b.RGBA8Format=32856]="RGBA8Format",b[b.R8Format=33321]="R8Format",b[b.RG8Format=33323]="RG8Format"}(C||(C={}));class s{static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(b){if(s._WorkerPoolPromise||s._DecoderModulePromise)return;const d={jsDecoderModule:L.Tools.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:L.Tools.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:L.Tools.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};b&&"function"===typeof Worker&&"undefined"!==typeof URL?s._WorkerPoolPromise=new Promise((P=>{const G=`${x}(${Y})()`,W=URL.createObjectURL(new Blob([G],{type:"application/javascript"}));P(new J.d(b,(async()=>await async function(b,d,P){return await new Promise(((G,W)=>{const i=d=>{b.removeEventListener("error",i),b.removeEventListener("message",q),W(d)},q=d=>{"init"===d.data.action&&(b.removeEventListener("error",i),b.removeEventListener("message",q),G(b))};b.addEventListener("error",i),b.addEventListener("message",q),b.postMessage({action:"init",urls:P,wasmBinaries:d})}))}(new Worker(W),void 0,d))))})):"undefined"===typeof s._KTX2DecoderModule?s._DecoderModulePromise=L.Tools.LoadBabylonScriptAsync(d.jsDecoderModule).then((()=>(s._KTX2DecoderModule=KTX2DECODER,s._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,s._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,x(d,s._KTX2DecoderModule),new s._KTX2DecoderModule.KTX2Decoder))):(s._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,s._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,s._DecoderModulePromise=Promise.resolve(new s._KTX2DecoderModule.KTX2Decoder))}constructor(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.DefaultNumWorkers;this._engine=b;const P="object"===typeof d&&d.workerPool||s.WorkerPool;if(P)s._WorkerPoolPromise=Promise.resolve(P);else{var G;if("object"===typeof d)s._KTX2DecoderModule=null===d||void 0===d||null===(G=d.binariesAndModulesContainer)||void 0===G?void 0:G.jsDecoderModule;else"undefined"!==typeof KTX2DECODER&&(s._KTX2DecoderModule=KTX2DECODER);const b="number"===typeof d?d:d.numWorkers??s.DefaultNumWorkers;s._Initialize(b)}}async _uploadAsync(b,d,P){const G=this._engine.getCaps(),W={astc:!!G.astc,bptc:!!G.bptc,s3tc:!!G.s3tc,pvrtc:!!G.pvrtc,etc2:!!G.etc2,etc1:!!G.etc1};if(s._WorkerPoolPromise){const G=await s._WorkerPoolPromise;return await new Promise(((i,q)=>{G.push(((G,C)=>{const J=b=>{G.removeEventListener("error",J),G.removeEventListener("message",L),q(b),C()},L=b=>{if("decoded"===b.data.action){if(G.removeEventListener("error",J),G.removeEventListener("message",L),b.data.success)try{this._createTexture(b.data.decodedData,d,P),i()}catch(W){q({message:W})}else q({message:b.data.nd});C()}};G.addEventListener("error",J),G.addEventListener("message",L),G.postMessage({action:"setDefaultDecoderOptions",options:s.DefaultDecoderOptions._getKTX2DecoderOptions()});const x=new Uint8Array(b.byteLength);x.set(new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),G.postMessage({action:"decode",data:x,caps:W,options:P},[x.buffer])}))}))}if(s._DecoderModulePromise){const P=await s._DecoderModulePromise;return s.DefaultDecoderOptions.isDirty&&(s._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=s.DefaultDecoderOptions._getKTX2DecoderOptions()),await new Promise(((W,i)=>{P.decode(b,G).then((b=>{this._createTexture(b,d),W()})).catch((b=>{i({message:b})}))}))}throw new Error("KTX2 decoder module is not available")}_createTexture(b,d,P){this._engine._bindTextureDirectly(3553,d),P&&(P.transcodedFormat=b.transcodedFormat,P.isInGammaSpace=b.isInGammaSpace,P.ad=b.ad,P.transcoderName=b.transcoderName);let G=!0;switch(b.transcodedFormat){case 32856:d.type=0,d.format=5;break;case 33321:d.type=0,d.format=6;break;case 33323:d.type=0,d.format=7;break;default:d.format=b.transcodedFormat,G=!1}if(d._gammaSpace=b.isInGammaSpace,d.generateMipMaps=b.mipmaps.length>1,b.errors)throw new Error("KTX2 container - could not transcode the data. "+b.errors);for(let W=0;W<b.mipmaps.length;++W){const P=b.mipmaps[W];if(!P||!P.data)throw new Error("KTX2 container - could not transcode one of the image");G?(d.width=P.width,d.height=P.height,this._engine._uploadDataToTextureDirectly(d,P.data,0,W,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(d,b.transcodedFormat,P.width,P.height,P.data,0,W)}d._extension=".ktx2",d.width=b.mipmaps[0].width,d.height=b.mipmaps[0].height,d.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(b){if(b.byteLength>=12){const d=new Uint8Array(b.buffer,b.byteOffset,12);if(171===d[0]&&75===d[1]&&84===d[2]&&88===d[3]&&32===d[4]&&50===d[5]&&48===d[6]&&187===d[7]&&13===d[8]&&10===d[9]&&26===d[10]&&10===d[11])return!0}return!1}}s.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},s.DefaultNumWorkers=s.GetDefaultNumWorkers(),s.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(b){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==b&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=b,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(b){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==b&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=b,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(b){this._forceRGBA!==b&&(this._forceRGBA=b,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(b){this._forceR8!==b&&(this._forceR8=b,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(b){this._forceRG8!==b&&(this._forceRG8=b,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(b){this._bypassTranscoders!==b&&(this._bypassTranscoders=b,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const b={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(b.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[q.BC1_RGB,q.BC3_RGBA],yes:{transcodeFormat:q.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=b,b}};class E{constructor(){this.supportCascades=!1}loadCubeData(b,d,P,G){if(Array.isArray(b))return;d._invertVScale=!d.invertY;const i=d.getEngine(),q=new W(b,6),C=q.numberOfMipmapLevels>1&&d.generateMipMaps;i._unpackFlipY(!0),q.uploadLevels(d,d.generateMipMaps),d.width=q.pixelWidth,d.height=q.pixelHeight,i._setCubeMapTextureParams(d,C,q.numberOfMipmapLevels-1),d.isReady=!0,d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),G&&G()}loadData(b,d,P,i){if(W.IsValid(b)){d._invertVScale=!d.invertY;const G=new W(b,1),i=function(b){switch(b){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(G.glInternalFormat);i?(d.format=i,d._useSRGBBuffer=d.getEngine()._getUseSRGBBuffer(!0,d.generateMipMaps),d._gammaSpace=!0):d.format=G.glInternalFormat,P(G.pixelWidth,G.pixelHeight,d.generateMipMaps,!0,(()=>{G.uploadLevels(d,d.generateMipMaps)}),G.isInvalid)}else if(s.IsValid(b)){new s(d.getEngine())._uploadAsync(b,d,i).then((()=>{P(d.width,d.height,d.generateMipMaps,!0,(()=>{}),!1)}),(b=>{G.e.Warn(`Failed to load KTX2 texture data: ${b.message}`),P(0,0,!1,!1,(()=>{}),!0)}))}else G.e.Error("texture missing KTX identifier"),P(0,0,!1,!1,(()=>{}),!0)}}},12257:(b,d,P)=>{P.d(d,{d:()=>W});class G{constructor(b){this._pendingActions=new Array,this._workerInfos=b.map((b=>({workerPromise:Promise.resolve(b),idle:!0})))}dispose(){for(const b of this._workerInfos)b.workerPromise.then((b=>{b.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(b){this._executeOnIdleWorker(b)||this._pendingActions.push(b)}_executeOnIdleWorker(b){for(const d of this._workerInfos)if(d.idle)return this._execute(d,b),!0;return!1}_execute(b,d){b.idle=!1,b.workerPromise.then((P=>{d(P,(()=>{const d=this._pendingActions.shift();d?this._execute(b,d):b.idle=!0}))}))}}class W extends G{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.DefaultOptions;super([]),this._maxWorkers=b,this._createWorkerAsync=d,this._options=P}push(b){if(!this._executeOnIdleWorker(b))if(this._workerInfos.length<this._maxWorkers){const d={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(d),this._execute(d,b)}else this._pendingActions.push(b)}_execute(b,d){b.timeoutId&&(clearTimeout(b.timeoutId),delete b.timeoutId),super._execute(b,((P,G)=>{d(P,(()=>{G(),b.idle&&(b.timeoutId=setTimeout((()=>{b.workerPromise.then((b=>{b.terminate()}));const d=this._workerInfos.indexOf(b);-1!==d&&this._workerInfos.splice(d,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}W.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}}}]);