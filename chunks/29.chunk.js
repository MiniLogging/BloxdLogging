"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[29],{13639:(w,p,e)=>{e.r(p),e.d(p,{_BasisTextureLoader:()=>s});var r,I=e(11071),d=e(11511),f=e(11161);function q(){const w=0,p=1,e=2,r=3,I=6,d=8,f=9,q=10,E=14;let j=null;function X(w,p,e,r,I){const d=w.getImageTranscodedSizeInBytes(p,e,r);let f=new Uint8Array(d);if(!w.transcodeImage(f,p,e,r,1,0))return null;if(I){f=function(w,p,e,r){const I=new Uint16Array(4),d=new Uint16Array(e*r),f=e/4,q=r/4;for(let E=0;E<q;E++)for(let r=0;r<f;r++){const q=p+8*(E*f+r);I[0]=w[q]|w[q+1]<<8,I[1]=w[q+2]|w[q+3]<<8,I[2]=(2*(31&I[0])+1*(31&I[1]))/3|(2*(2016&I[0])+1*(2016&I[1]))/3&2016|(2*(63488&I[0])+1*(63488&I[1]))/3&63488,I[3]=(2*(31&I[1])+1*(31&I[0]))/3|(2*(2016&I[1])+1*(2016&I[0]))/3&2016|(2*(63488&I[1])+1*(63488&I[0]))/3&63488;for(let p=0;p<4;p++){const f=w[q+4+p];let j=(4*E+p)*e+4*r;d[j++]=I[3&f],d[j++]=I[f>>2&3],d[j++]=I[f>>4&3],d[j++]=I[f>>6&3]}}return d}(f,0,w.getImageWidth(p,e)+3&-4,w.getImageHeight(p,e)+3&-4)}return f}onmessage=k=>{if("init"===k.data.action){if(k.data.url)try{importScripts(k.data.url)}catch(m){postMessage({action:"error",error:m})}j||(j=BASIS({wasmBinary:k.data.wasmBinary})),null!==j&&j.then((w=>{BASIS=w,w.initializeBasis(),postMessage({action:"init"})}))}else if("transcode"===k.data.action){const j=k.data.config,m=k.data.imageData,J=new BASIS.BasisFile(m),K=function(w){const p=w.getHasAlpha(),e=w.getNumImages(),r=[];for(let I=0;I<e;I++){const p={levels:[]},e=w.getNumLevels(I);for(let r=0;r<e;r++){const e={width:w.getImageWidth(I,r),height:w.getImageHeight(I,r)};p.levels.push(e)}r.push(p)}return{ie:p,images:r}}(J);let y=k.data.ignoreSupportedFormats?null:function(j,X){let k=null;j.supportedCompressionFormats&&(k=j.supportedCompressionFormats.astc?q:j.supportedCompressionFormats.bc7?I:j.supportedCompressionFormats.s3tc?X.ie?r:e:j.supportedCompressionFormats.pvrtc?X.ie?f:d:j.supportedCompressionFormats.etc2?p:j.supportedCompressionFormats.etc1?w:E);return k}(k.data.config,K),c=!1;null===y&&(c=!0,y=K.ie?r:e);let s=!0;J.startTranscoding()||(s=!1);const O=[];for(let w=0;w<K.images.length&&s;w++){const p=K.images[w];if(void 0===j.loadSingleImage||j.loadSingleImage===w){let e=p.levels.length;!1===j.loadMipmapLevels&&(e=1);for(let r=0;r<e;r++){const e=p.levels[r],I=X(J,w,r,y,c);if(!I){s=!1;break}e.transcodedPixels=I,O.push(e.transcodedPixels.buffer)}}}J.close(),J.delete(),c&&(y=-1),s?postMessage({action:"transcode",success:s,id:k.data.id,fileInfo:K,format:y},O):postMessage({action:"transcode",success:s,id:k.data.id})}}}!function(w){w[w.cTFETC1=0]="cTFETC1",w[w.cTFETC2=1]="cTFETC2",w[w.cTFBC1=2]="cTFBC1",w[w.cTFBC3=3]="cTFBC3",w[w.cTFBC4=4]="cTFBC4",w[w.cTFBC5=5]="cTFBC5",w[w.cTFBC7=6]="cTFBC7",w[w.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",w[w.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",w[w.cTFASTC_4x4=10]="cTFASTC_4x4",w[w.cTFATC_RGB=11]="cTFATC_RGB",w[w.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",w[w.cTFRGBA32=13]="cTFRGBA32",w[w.cTFRGB565=14]="cTFRGB565",w[w.cTFBGR565=15]="cTFBGR565",w[w.cTFRGBA4444=16]="cTFRGBA4444",w[w.cTFFXT1_RGB=17]="cTFFXT1_RGB",w[w.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",w[w.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",w[w.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",w[w.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11"}(r||(r={}));const E={JSModuleURL:`${I.g._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.js`,WasmModuleURL:`${I.g._DefaultCdnUrl}/basisTranscoder/1/basis_transcoder.wasm`};let j=null,X=null,k=0;const m=async()=>(j||(j=new Promise(((w,p)=>{X?w(X):I.g.LoadFileAsync(I.g.GetBabylonScriptURL(E.WasmModuleURL)).then((e=>{if("function"!==typeof URL)return p("Basis transcoder requires an environment with a URL constructor");const r=URL.createObjectURL(new Blob([`(${q})()`],{type:"application/javascript"}));X=new Worker(r),async function(w,p,e){return await new Promise(((r,d)=>{const f=p=>{"init"===p.data.action?(w.removeEventListener("message",f),r(w)):"error"===p.data.action&&d(p.data.error||"error initializing worker")};w.addEventListener("message",f),w.postMessage({action:"init",url:e?I.g.GetBabylonScriptURL(e):void 0,wasmBinary:p},[p])}))}(X,e,E.JSModuleURL).then(w,p)})).catch(p)}))),await j),J=async(w,p)=>{const e=w instanceof ArrayBuffer?new Uint8Array(w):w;return await new Promise(((w,r)=>{m().then((()=>{const I=k++,d=p=>{"transcode"===p.data.action&&p.data.id===I&&(X.removeEventListener("message",d),p.data.success?w(p.data):r("Transcode is not supported on this device"))};X.addEventListener("message",d);const f=new Uint8Array(e.byteLength);f.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),X.postMessage({action:"transcode",id:I,imageData:f,config:p,ignoreSupportedFormats:false},[f.buffer])}),(w=>{r(w)}))}))},K=(w,p)=>{var e;let r=null===(e=p._gl)||void 0===e?void 0:e.TEXTURE_2D;var I;w.isCube&&(r=null===(I=p._gl)||void 0===I?void 0:I.TEXTURE_CUBE_MAP);p._bindTextureDirectly(r,w,!0)},y=(w,p)=>{const e=w.getEngine();for(let q=0;q<p.fileInfo.images.length;q++){const E=p.fileInfo.images[q].levels[0];if(w._invertVScale=w.invertY,-1===p.format||p.format===r.cTFRGB565)if(w.type=10,w.format=4,!e._features.basisNeedsPOT||Math.log2(E.width)%1===0&&Math.log2(E.height)%1===0)w._invertVScale=!w.invertY,w.width=E.width+3&-4,w.height=E.height+3&-4,w.samplingMode=2,K(w,e),e._uploadDataToTextureDirectly(w,new Uint16Array(E.transcodedPixels.buffer),q,0,4,!0);else{const p=new f.d(e,2);w._invertVScale=w.invertY,p.type=10,p.format=4,p.width=E.width+3&-4,p.height=E.height+3&-4,K(p,e),e._uploadDataToTextureDirectly(p,new Uint16Array(E.transcodedPixels.buffer),q,0,4,!0),e._rescaleTexture(p,w,e.scenes[0],e._getInternalFormat(4),(()=>{e._releaseTexture(p),K(w,e)}))}else{w.width=E.width,w.height=E.height,w.generateMipMaps=p.fileInfo.images[q].levels.length>1;const r=c.GetInternalFormatFromBasisFormat(p.format,e);w.format=r,K(w,e);const f=p.fileInfo.images[q].levels;for(let p=0;p<f.length;p++){const I=f[p];e._uploadCompressedDataToTextureDirectly(w,r,I.width,I.height,I.transcodedPixels,q,p)}!e._features.basisNeedsPOT||Math.log2(w.width)%1===0&&Math.log2(w.height)%1===0||(I.g.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),w._cachedWrapU=d.e.CLAMP_ADDRESSMODE,w._cachedWrapV=d.e.CLAMP_ADDRESSMODE)}}},c={JSModuleURL:E.JSModuleURL,WasmModuleURL:E.WasmModuleURL,GetInternalFormatFromBasisFormat:(w,p)=>{let e;switch(w){case r.cTFETC1:e=36196;break;case r.cTFBC1:e=33776;break;case r.cTFBC4:e=33779;break;case r.cTFASTC_4x4:e=37808;break;case r.cTFETC2:e=37496;break;case r.cTFBC7:e=36492}if(void 0===e)throw"The chosen Basis transcoder format is not currently supported";return e},TranscodeAsync:J,LoadTextureFromTranscodeResult:y};Object.defineProperty(c,"JSModuleURL",{get:function(){return E.JSModuleURL},set:function(w){E.JSModuleURL=w}}),Object.defineProperty(c,"WasmModuleURL",{get:function(){return E.WasmModuleURL},set:function(w){E.WasmModuleURL=w}});class s{constructor(){this.supportCascades=!1}loadCubeData(w,p,e,r,d){if(Array.isArray(w))return;const f=p.getEngine().getCaps(),q={supportedCompressionFormats:{etc1:!!f.etc1,s3tc:!!f.s3tc,pvrtc:!!f.pvrtc,etc2:!!f.etc2,astc:!!f.astc,bc7:!!f.bptc}};J(w,q).then((w=>{const e=w.fileInfo.images[0].levels.length>1&&p.generateMipMaps;y(p,w),p.getEngine()._setCubeMapTextureParams(p,e),p.isReady=!0,p.onLoadedObservable.notifyObservers(p),p.onLoadedObservable.clear(),r&&r()})).catch((w=>{I.g.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),p.isReady=!0,d&&d(w)}))}loadData(w,p,e){const r=p.getEngine().getCaps(),d={supportedCompressionFormats:{etc1:!!r.etc1,s3tc:!!r.s3tc,pvrtc:!!r.pvrtc,etc2:!!r.etc2,astc:!!r.astc,bc7:!!r.bptc}};J(w,d).then((w=>{const r=w.fileInfo.images[0].levels[0],I=w.fileInfo.images[0].levels.length>1&&p.generateMipMaps;e(r.width,r.height,I,-1!==w.format,(()=>{y(p,w)}))})).catch((w=>{I.g.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),I.g.Warn(`Failed to transcode Basis file: ${w}`),e(0,0,!1,!1,(()=>{}),!0)}))}}}}]);