"use strict";(self["3b8bnhi4gzj"]=self["3b8bnhi4gzj"]||[]).push([[12,20],{11971:(Z,h,V)=>{V.r(h),V.d(h,{Dispose:()=>D,DumpData:()=>N,DumpDataAsync:()=>x,DumpFramebuffer:()=>n,DumpTools:()=>k});var v=V(11850),A=V(11564),H=V(11748),K=V(11599);let d,a=null;async function n(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0;const d=await V.readPixels(0,0,Z,h);N(Z,h,new Uint8Array(d.buffer),v,A,H,!0,void 0,K)}async function x(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return await new Promise((a=>{N(Z,h,V,(Z=>a(Z)),v,A,H,K,d)}))}function N(Z,h,n,x){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8?arguments[8]:void 0;(async function(){return a||(a=new Promise(((Z,h)=>{let A,H=null;const a={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(V.bind(V,11872)).then((n=>{let{ThinEngine:x}=n;const N=K.b.Instances.length;try{A=new OffscreenCanvas(100,100),H=new x(A,!1,a)}catch(F){var k;N<K.b.Instances.length&&(null===(k=K.b.Instances.pop())||void 0===k||k.dispose()),A=document.createElement("canvas"),H=new x(A,!1,a)}K.b.Instances.pop(),K.b.OnEnginesDisposedObservable.add((Z=>{H&&Z!==H&&!H.K&&0===K.b.Instances.length&&D()})),H.getCaps().parallelShaderCompile=void 0;const u=new v.e(H);V.e(52).then(V.bind(V,14279)).then((V=>{let{passPixelShader:K}=V;if(!H)return void h("Engine is not defined");const a=new v.g({Ph:H,name:K.name,fragmentShader:K.shader,samplerNames:["textureSampler"]});d={canvas:A,Ph:H,renderer:u,wrapper:a},Z(d)}))})).catch(h)}))),await a})().then((V=>{if(V.Ph.setSize(Z,h,!0),n instanceof Float32Array){const Z=new Uint8Array(n.length);let h=n.length;for(;h--;){const V=n[h];Z[h]=Math.round(255*(0,H.Clamp)(V))}n=Z}const v=V.Ph.createRawTexture(n,Z,h,5,!1,!u,1);V.renderer.setViewport(),V.renderer.applyEffectWrapper(V.wrapper),V.wrapper.effect._bindTexture("textureSampler",v),V.renderer.draw(),F?A.Tools.ToBlob(V.canvas,(Z=>{const h=new FileReader;h.onload=Z=>{const h=Z.target.result;x&&x(h)},h.readAsArrayBuffer(Z)}),N,b):A.Tools.EncodeScreenshotCanvasData(V.canvas,x,N,k,b),v.dispose()}))}function D(){var Z;d?(d.wrapper.dispose(),d.renderer.dispose(),d.Ph.dispose()):null===(Z=a)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.Ph.dispose()}));a=null,d=null}const k={DumpData:N,DumpDataAsync:x,DumpFramebuffer:n,Dispose:D};A.Tools.DumpData=N,A.Tools.DumpDataAsync=x,A.Tools.DumpFramebuffer=n},11711:(Z,h,V)=>{V.r(h),V.d(h,{CreateScreenshot:()=>X,CreateScreenshotAsync:()=>E,CreateScreenshotUsingRenderTarget:()=>P,CreateScreenshotUsingRenderTargetAsync:()=>C,CreateScreenshotWithResizeAsync:()=>j,ScreenshotTools:()=>B});var v=V(11713),A=V(11797),H=V(11842),K=V(11691),d=V(11769),a=V(11850),n=V(11870),x=V(11729);class N extends a.g{static _GetDefines(Z){if(!Z)return null;return Z.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(Z,h){Z?(this._webGPUReady=!0,h.push(Promise.all([V.e(54).then(V.bind(V,14291)),V.e(55).then(V.bind(V,14299))]))):h.push(Promise.all([V.e(56).then(V.bind(V,14308)),V.e(57).then(V.bind(V,14310))]))}constructor(Z){const h={...arguments.length>2?arguments[2]:void 0,name:Z,Ph:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||n.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:N.VertexUrl,fragmentShader:N.FragmentUrl,uniforms:N.Uniforms};super({...h,defines:N._GetDefines(h.Ph)}),this.texelSize=new x.Vector2(0,0)}bind(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(Z),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}N.VertexUrl="fxaa",N.FragmentUrl="fxaa",N.Uniforms=["texelSize"];class D extends H.d{getClassName(){return"FxaaPostProcess"}constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3?arguments[3]:void 0,H=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a={uniforms:N.Uniforms,size:"number"===typeof h?h:void 0,camera:V,samplingMode:A||v.e.BILINEAR_SAMPLINGMODE,Ph:H,reusable:K,textureType:d,...h};super(Z,N.FragmentUrl,{effectWrapper:"number"!==typeof h&&h.effectWrapper?void 0:new N(Z,H,a),...a}),this.onApplyObservable.add((Z=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(Z,h,V,v){return d.b.Parse((()=>new D(Z.name,Z.options,h,Z.renderTargetSamplingMode,V.getEngine(),Z.reusable)),Z,V,v)}}(0,K.i)("BABYLON.FxaaPostProcess",D);var k=V(11580),u=V(11564),F=V(11971),b=V(11975),o=V(11633);let q=null;function X(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:a,width:n}=l(Z,h,V);if(!a||!n)return void k.b.Error("Invalid 'size' parameter !");h.CZ().activeCamera===h?Z.onEndFrameObservable.addOnce((()=>{q||(q=document.createElement("canvas")),q.width=n,q.height=a;const h=q.getContext("2d"),V=Z.getRenderingCanvas();if(!h||!V)return void k.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const x=V.width,N=V.height,D=q.width,F=q.height,b=D/x,o=F/N,X=d?Math.max(b,o):Math.min(b,o),E=x*X,j=N*X,P=(D-E)/2,C=(F-j)/2;h.drawImage(V,0,0,x,N,P,C,E,j),H?(u.Tools.EncodeScreenshotCanvasData(q,void 0,A,void 0,K),v&&v("")):u.Tools.EncodeScreenshotCanvasData(q,v,A,void 0,K)})):P(Z,h,V,(Z=>{if(H){const h=new Blob([Z]);u.Tools.DownloadBlob(h),v&&v("")}else v&&v(Z)}),A,1,Z.getCreationOptions().antialias,void 0,void 0,void 0,void 0,K)}async function E(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((K,d)=>{X(Z,h,V,(Z=>{"undefined"!==typeof Z?K(Z):d(new Error("Data is undefined"))}),v,void 0,A,H)}))}async function j(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((d=>{X(Z,h,{width:V,height:v},(()=>{d()}),A,!0,H,K)}))}function P(Z,h,H,K){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7?arguments[7]:void 0,N=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]&&arguments[9],q=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],X=arguments.length>11?arguments[11]:void 0,E=arguments.length>12?arguments[12]:void 0,j=arguments.length>13?arguments[13]:void 0;const{height:P,width:C,finalWidth:B,finalHeight:S}=l(Z,h,H),r={width:C,height:P};if(!P||!C)return void k.b.Error("Invalid 'size' parameter !");Z.skipFrameRender=!0;const L=Z.getRenderWidth,y=Z.getRenderHeight;Z.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.width:C},Z.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.height:P},Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z);const W=h.CZ(),z=new A.b("screenShot",r,W,!1,!1,0,!1,v.e.BILINEAR_SAMPLINGMODE,void 0,u,void 0,void 0,void 0,a);z.renderList=W.meshes.slice(),z.samples=a,z.renderSprites=N,z.activeCamera=h,z.forceLayerMaskCheck=q,null===E||void 0===E||E(z);const m=j||F.DumpData,g=()=>{W.incrementRenderId(),W.resetCachedMaterial(),(0,o.h)((()=>z.isReadyForRendering()&&h.isReady(!0)),(()=>{Z.onEndFrameObservable.addOnce((()=>{B===C&&S===P?z.readPixels(void 0,void 0,void 0,!1).then((Z=>{m(C,P,Z,K,d,x,!0,void 0,X),z.dispose()})):(Z.isWebGPU?V.e(51).then(V.bind(V,14277)):V.e(52).then(V.bind(V,14279))).then((async()=>await(0,b.b)("pass",z.getInternalTexture(),W,void 0,void 0,void 0,B,S).then((h=>{Z._readTexturePixels(h,B,S,-1,0,null,!0,!1,0,0).then((Z=>{m(B,S,Z,K,d,x,!0,void 0,X),h.dispose()}))}))))})),W.incrementRenderId(),W.resetCachedMaterial();const v=W.activeCamera,A=W.activeCameras,H=h.outputRenderTarget,a=W.spritesEnabled;W.activeCamera=h,W.activeCameras=null,h.outputRenderTarget=z,W.spritesEnabled=N;const n=W.meshes;W.meshes=z.renderList||W.meshes;try{W.render()}finally{W.activeCamera=v,W.activeCameras=A,h.outputRenderTarget=H,W.spritesEnabled=a,W.meshes=n,Z.getRenderWidth=L,Z.getRenderHeight=y,Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z),h.getProjectionMatrix(!0),Z.skipFrameRender=!1}}),(()=>{Z.skipFrameRender=!1,Z.getRenderWidth=L,Z.getRenderHeight=y}))};if(n){const Z=new D("antialiasing",1,W.activeCamera);z.addPostProcess(Z),Z.yh=!0,Z.onEffectCreatedObservable.addOnce((Z=>{Z.isReady()?g():Z.onCompiled=()=>{g()}}))}else g()}async function C(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],n=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],x=arguments.length>10?arguments[10]:void 0,N=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0;return await new Promise(((k,u)=>{P(Z,h,V,(Z=>{"undefined"!==typeof Z?k(Z):u(new Error("Data is undefined"))}),v,A,H,K,d,a,n,x,N,D)}))}function l(Z,h,V){let v=0,A=0,H=0,K=0;if("object"===typeof V){const d=V.precision?Math.abs(V.precision):1;V.width&&V.height?(v=V.height*d,A=V.width*d):V.width&&!V.height?(A=V.width*d,v=Math.round(A/Z.getAspectRatio(h))):V.height&&!V.width?(v=V.height*d,A=Math.round(v*Z.getAspectRatio(h))):(A=Math.round(Z.getRenderWidth()*d),v=Math.round(A/Z.getAspectRatio(h))),V.finalWidth&&V.finalHeight?(K=V.finalHeight,H=V.finalWidth):V.finalWidth&&!V.finalHeight?(H=V.finalWidth,K=Math.round(H/Z.getAspectRatio(h))):V.finalHeight&&!V.finalWidth?(K=V.finalHeight,H=Math.round(K*Z.getAspectRatio(h))):(H=A,K=v)}else isNaN(V)||(v=V,A=V,H=V,K=V);return A&&(A=Math.floor(A)),v&&(v=Math.floor(v)),H&&(H=Math.floor(H)),K&&(K=Math.floor(K)),{height:0|v,width:0|A,finalWidth:0|H,finalHeight:0|K}}const B={CreateScreenshot:X,CreateScreenshotAsync:E,CreateScreenshotWithResizeAsync:j,CreateScreenshotUsingRenderTarget:P,CreateScreenshotUsingRenderTargetAsync:C};u.Tools.CreateScreenshot=X,u.Tools.CreateScreenshotAsync=E,u.Tools.CreateScreenshotUsingRenderTarget=P,u.Tools.CreateScreenshotUsingRenderTargetAsync=C}}]);