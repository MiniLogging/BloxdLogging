"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[12,20],{11936:(w,o,H)=>{H.r(o),H.d(o,{Dispose:()=>z,DumpData:()=>y,DumpDataAsync:()=>A,DumpFramebuffer:()=>L,DumpTools:()=>C});var h=H(11817),E=H(11531),e=H(11729),D=H(11571);let t,X=null;async function L(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,D=arguments.length>6?arguments[6]:void 0;const t=await H.readPixels(0,0,w,o);y(w,o,new Uint8Array(t.buffer),h,E,e,!0,void 0,D)}async function A(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0;return await new Promise((X=>{y(w,o,H,(w=>X(w)),h,E,e,D,t)}))}function y(w,o,L,A){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],i=arguments.length>8?arguments[8]:void 0;(async function(){return X||(X=new Promise(((w,o)=>{let E,e=null;const X={Ee:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(H.bind(H,11841)).then((L=>{let{ThinEngine:A}=L;const y=D.e.Instances.length;try{E=new OffscreenCanvas(100,100),e=new A(E,!1,X)}catch(M){var C;y<D.e.Instances.length&&(null===(C=D.e.Instances.pop())||void 0===C||C.dispose()),E=document.createElement("canvas"),e=new A(E,!1,X)}D.e.Instances.pop(),D.e.OnEnginesDisposedObservable.add((w=>{e&&w!==e&&!e.A&&0===D.e.Instances.length&&z()})),e.getCaps().parallelShaderCompile=void 0;const Q=new h.c(e);H.e(52).then(H.bind(H,14283)).then((H=>{let{passPixelShader:D}=H;if(!e)return void o("Engine is not defined");const X=new h.d({Mo:e,name:D.name,fragmentShader:D.shader,samplerNames:["textureSampler"]});t={canvas:E,Mo:e,renderer:Q,wrapper:X},w(t)}))})).catch(o)}))),await X})().then((H=>{if(H.Mo.setSize(w,o,!0),L instanceof Float32Array){const w=new Uint8Array(L.length);let o=L.length;for(;o--;){const H=L[o];w[o]=Math.round(255*(0,e.Clamp)(H))}L=w}const h=H.Mo.createRawTexture(L,w,o,5,!1,!Q,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",h),H.renderer.draw(),M?E.Tools.ToBlob(H.canvas,(w=>{const o=new FileReader;o.onload=w=>{const o=w.target.result;A&&A(o)},o.readAsArrayBuffer(w)}),y,i):E.Tools.EncodeScreenshotCanvasData(H.canvas,A,y,C,i),h.dispose()}))}function z(){var w;t?(t.wrapper.dispose(),t.renderer.dispose(),t.Mo.dispose()):null===(w=X)||void 0===w||w.then((w=>{w.wrapper.dispose(),w.renderer.dispose(),w.Mo.dispose()}));X=null,t=null}const C={DumpData:y,DumpDataAsync:A,DumpFramebuffer:L,Dispose:z};E.Tools.DumpData=y,E.Tools.DumpDataAsync=A,E.Tools.DumpFramebuffer=L},11687:(w,o,H)=>{H.r(o),H.d(o,{CreateScreenshot:()=>r,CreateScreenshotAsync:()=>k,CreateScreenshotUsingRenderTarget:()=>l,CreateScreenshotUsingRenderTargetAsync:()=>O,CreateScreenshotWithResizeAsync:()=>P,ScreenshotTools:()=>S});var h=H(11690),E=H(11772),e=H(11813),D=H(11666),t=H(11745),X=H(11817),L=H(11837),A=H(11720);class y extends X.d{static _GetDefines(w){if(!w)return null;return w.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(w,o){w?(this._webGPUReady=!0,o.push(Promise.all([H.e(54).then(H.bind(H,14287)),H.e(55).then(H.bind(H,14295))]))):o.push(Promise.all([H.e(56).then(H.bind(H,14301)),H.e(57).then(H.bind(H,14307))]))}constructor(w){const o={...arguments.length>2?arguments[2]:void 0,name:w,Mo:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||L.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:y.VertexUrl,fragmentShader:y.FragmentUrl,uniforms:y.Uniforms};super({...o,defines:y._GetDefines(o.Mo)}),this.texelSize=new A.Vector2(0,0)}bind(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(w),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}y.VertexUrl="fxaa",y.FragmentUrl="fxaa",y.Uniforms=["texelSize"];class z extends e.e{getClassName(){return"FxaaPostProcess"}constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3?arguments[3]:void 0,e=arguments.length>4?arguments[4]:void 0,D=arguments.length>5?arguments[5]:void 0,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const X={uniforms:y.Uniforms,size:"number"===typeof o?o:void 0,camera:H,samplingMode:E||h.d.BILINEAR_SAMPLINGMODE,Mo:e,reusable:D,textureType:t,...o};super(w,y.FragmentUrl,{effectWrapper:"number"!==typeof o&&o.effectWrapper?void 0:new y(w,e,X),...X}),this.onApplyObservable.add((w=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(w,o,H,h){return t.e.Parse((()=>new z(w.name,w.options,o,w.renderTargetSamplingMode,H.getEngine(),w.reusable)),w,H,h)}}(0,D.g)("BABYLON.FxaaPostProcess",z);var C=H(11551),Q=H(11531),M=H(11936),i=H(11945),s=H(11606);let V=null;function r(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:X,width:L}=T(w,o,H);if(!X||!L)return void C.d.Error("Invalid 'size' parameter !");o.Ow().activeCamera===o?w.onEndFrameObservable.addOnce((()=>{V||(V=document.createElement("canvas")),V.width=L,V.height=X;const o=V.getContext("2d"),H=w.getRenderingCanvas();if(!o||!H)return void C.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const A=H.width,y=H.height,z=V.width,M=V.height,i=z/A,s=M/y,r=t?Math.max(i,s):Math.min(i,s),k=A*r,P=y*r,l=(z-k)/2,O=(M-P)/2;o.drawImage(H,0,0,A,y,l,O,k,P),e?(Q.Tools.EncodeScreenshotCanvasData(V,void 0,E,void 0,D),h&&h("")):Q.Tools.EncodeScreenshotCanvasData(V,h,E,void 0,D)})):l(w,o,H,(w=>{if(e){const o=new Blob([w]);Q.Tools.DownloadBlob(o),h&&h("")}else h&&h(w)}),E,1,w.getCreationOptions().antialias,void 0,void 0,void 0,void 0,D)}async function k(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((D,t)=>{r(w,o,H,(w=>{"undefined"!==typeof w?D(w):t(new Error("Data is undefined"))}),h,void 0,E,e)}))}async function P(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((t=>{r(w,o,{width:H,height:h},(()=>{t()}),E,!0,e,D)}))}function l(w,o,e,D){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7?arguments[7]:void 0,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]&&arguments[9],V=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],r=arguments.length>11?arguments[11]:void 0,k=arguments.length>12?arguments[12]:void 0,P=arguments.length>13?arguments[13]:void 0;const{height:l,width:O,finalWidth:S,finalHeight:c}=T(w,o,e),W={width:O,height:l};if(!l||!O)return void C.d.Error("Invalid 'size' parameter !");w.skipFrameRender=!0;const B=w.getRenderWidth,J=w.getRenderHeight;w.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&w._currentRenderTarget?w._currentRenderTarget.width:O},w.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&w._currentRenderTarget?w._currentRenderTarget.height:l},w.onResizeObservable.hasObservers()&&w.onResizeObservable.notifyObservers(w);const g=o.Ow(),b=new E.d("screenShot",W,g,!1,!1,0,!1,h.d.BILINEAR_SAMPLINGMODE,void 0,Q,void 0,void 0,void 0,X);b.renderList=g.meshes.slice(),b.samples=X,b.renderSprites=y,b.activeCamera=o,b.forceLayerMaskCheck=V,null===k||void 0===k||k(b);const p=P||M.DumpData,f=()=>{g.incrementRenderId(),g.resetCachedMaterial(),(0,s.h)((()=>b.isReadyForRendering()&&o.isReady(!0)),(()=>{w.onEndFrameObservable.addOnce((()=>{S===O&&c===l?b.readPixels(void 0,void 0,void 0,!1).then((w=>{p(O,l,w,D,t,A,!0,void 0,r),b.dispose()})):(w.isWebGPU?H.e(51).then(H.bind(H,14274)):H.e(52).then(H.bind(H,14283))).then((async()=>await(0,i.d)("pass",b.getInternalTexture(),g,void 0,void 0,void 0,S,c).then((o=>{w._readTexturePixels(o,S,c,-1,0,null,!0,!1,0,0).then((w=>{p(S,c,w,D,t,A,!0,void 0,r),o.dispose()}))}))))})),g.incrementRenderId(),g.resetCachedMaterial();const h=g.activeCamera,E=g.activeCameras,e=o.outputRenderTarget,X=g.spritesEnabled;g.activeCamera=o,g.activeCameras=null,o.outputRenderTarget=b,g.spritesEnabled=y;const L=g.meshes;g.meshes=b.renderList||g.meshes;try{g.render()}finally{g.activeCamera=h,g.activeCameras=E,o.outputRenderTarget=e,g.spritesEnabled=X,g.meshes=L,w.getRenderWidth=B,w.getRenderHeight=J,w.onResizeObservable.hasObservers()&&w.onResizeObservable.notifyObservers(w),o.getProjectionMatrix(!0),w.skipFrameRender=!1}}),(()=>{w.skipFrameRender=!1,w.getRenderWidth=B,w.getRenderHeight=J}))};if(L){const w=new z("antialiasing",1,g.activeCamera);b.addPostProcess(w),w.Xe=!0,w.onEffectCreatedObservable.addOnce((w=>{w.isReady()?f():w.onCompiled=()=>{f()}}))}else f()}async function O(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],A=arguments.length>10?arguments[10]:void 0,y=arguments.length>11?arguments[11]:void 0,z=arguments.length>12?arguments[12]:void 0;return await new Promise(((C,Q)=>{l(w,o,H,(w=>{"undefined"!==typeof w?C(w):Q(new Error("Data is undefined"))}),h,E,e,D,t,X,L,A,y,z)}))}function T(w,o,H){let h=0,E=0,e=0,D=0;if("object"===typeof H){const t=H.precision?Math.abs(H.precision):1;H.width&&H.height?(h=H.height*t,E=H.width*t):H.width&&!H.height?(E=H.width*t,h=Math.round(E/w.getAspectRatio(o))):H.height&&!H.width?(h=H.height*t,E=Math.round(h*w.getAspectRatio(o))):(E=Math.round(w.getRenderWidth()*t),h=Math.round(E/w.getAspectRatio(o))),H.finalWidth&&H.finalHeight?(D=H.finalHeight,e=H.finalWidth):H.finalWidth&&!H.finalHeight?(e=H.finalWidth,D=Math.round(e/w.getAspectRatio(o))):H.finalHeight&&!H.finalWidth?(D=H.finalHeight,e=Math.round(D*w.getAspectRatio(o))):(e=E,D=h)}else isNaN(H)||(h=H,E=H,e=H,D=H);return E&&(E=Math.floor(E)),h&&(h=Math.floor(h)),e&&(e=Math.floor(e)),D&&(D=Math.floor(D)),{height:0|h,width:0|E,finalWidth:0|e,finalHeight:0|D}}const S={CreateScreenshot:r,CreateScreenshotAsync:k,CreateScreenshotWithResizeAsync:P,CreateScreenshotUsingRenderTarget:l,CreateScreenshotUsingRenderTargetAsync:O};Q.Tools.CreateScreenshot=r,Q.Tools.CreateScreenshotAsync=k,Q.Tools.CreateScreenshotUsingRenderTarget=l,Q.Tools.CreateScreenshotUsingRenderTargetAsync=O}}]);