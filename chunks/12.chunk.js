"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[12,20],{12972:(q,I,l)=>{l.r(I),l.d(I,{Dispose:()=>x,DumpData:()=>r,DumpDataAsync:()=>Z,DumpFramebuffer:()=>s,DumpTools:()=>o});var w=l(12851),t=l(12564),O=l(12761),c=l(12612);let a,F=null;async function s(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;const a=await l.readPixels(0,0,q,I);r(q,I,new Uint8Array(a.buffer),w,t,O,!0,void 0,c)}async function Z(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((F=>{r(q,I,l,(q=>F(q)),w,t,O,c,a)}))}function r(q,I,s,Z){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8?arguments[8]:void 0;(async function(){return F||(F=new Promise(((q,I)=>{let t,O=null;const F={oc:!0,depth:!1,cc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,12877)).then((s=>{let{ThinEngine:Z}=s;const r=c.e.Instances.length;try{t=new OffscreenCanvas(100,100),O=new Z(t,!1,F)}catch(T){var o;r<c.e.Instances.length&&(null===(o=c.e.Instances.pop())||void 0===o||o.dispose()),t=document.createElement("canvas"),O=new Z(t,!1,F)}c.e.Instances.pop(),c.e.OnEnginesDisposedObservable.add((q=>{O&&q!==O&&!O.Z&&0===c.e.Instances.length&&x()})),O.getCaps().parallelShaderCompile=void 0;const d=new w.b(O);l.e(52).then(l.bind(l,15229)).then((l=>{let{passPixelShader:c}=l;if(!O)return void I("Engine is not defined");const F=new w.f({oI:O,name:c.name,fragmentShader:c.shader,samplerNames:["textureSampler"]});a={canvas:t,oI:O,renderer:d,wrapper:F},q(a)}))})).catch(I)}))),await F})().then((l=>{if(l.oI.setSize(q,I,!0),s instanceof Float32Array){const q=new Uint8Array(s.length);let I=s.length;for(;I--;){const l=s[I];q[I]=Math.round(255*(0,O.Clamp)(l))}s=q}const w=l.oI.createRawTexture(s,q,I,5,!1,!d,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",w),l.renderer.draw(),T?t.Tools.ToBlob(l.canvas,(q=>{const I=new FileReader;I.onload=q=>{const I=q.target.result;Z&&Z(I)},I.readAsArrayBuffer(q)}),r,V):t.Tools.EncodeScreenshotCanvasData(l.canvas,Z,r,o,V),w.dispose()}))}function x(){var q;a?(a.wrapper.dispose(),a.renderer.dispose(),a.oI.dispose()):null===(q=F)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.oI.dispose()}));F=null,a=null}const o={DumpData:r,DumpDataAsync:Z,DumpFramebuffer:s,Dispose:x};t.Tools.DumpData=r,t.Tools.DumpDataAsync=Z,t.Tools.DumpFramebuffer=s},12729:(q,I,l)=>{l.r(I),l.d(I,{CreateScreenshot:()=>v,CreateScreenshotAsync:()=>k,CreateScreenshotUsingRenderTarget:()=>R,CreateScreenshotUsingRenderTargetAsync:()=>W,CreateScreenshotWithResizeAsync:()=>C,ScreenshotTools:()=>i});var w=l(12733),t=l(12805),O=l(12847),c=l(12711),a=l(12777),F=l(12851),s=l(12875),Z=l(12747);class r extends F.f{static _GetDefines(q){if(!q)return null;return q.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(q,I){q?(this._webGPUReady=!0,I.push(Promise.all([l.e(54).then(l.bind(l,15240)),l.e(55).then(l.bind(l,15246))]))):I.push(Promise.all([l.e(56).then(l.bind(l,15249)),l.e(57).then(l.bind(l,15257))]))}constructor(q){const I={...arguments.length>2?arguments[2]:void 0,name:q,oI:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||s.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:r.VertexUrl,fragmentShader:r.FragmentUrl,uniforms:r.Uniforms};super({...I,defines:r._GetDefines(I.oI)}),this.texelSize=new Z.Vector2(0,0)}bind(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(q),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}r.VertexUrl="fxaa",r.FragmentUrl="fxaa",r.Uniforms=["texelSize"];class x extends O.d{getClassName(){return"FxaaPostProcess"}constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const F={uniforms:r.Uniforms,size:"number"===typeof I?I:void 0,camera:l,samplingMode:t||w.d.BILINEAR_SAMPLINGMODE,oI:O,reusable:c,textureType:a,...I};super(q,r.FragmentUrl,{effectWrapper:"number"!==typeof I&&I.effectWrapper?void 0:new r(q,O,F),...F}),this.onApplyObservable.add((q=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(q,I,l,w){return a.c.Parse((()=>new x(q.name,q.options,I,q.renderTargetSamplingMode,l.getEngine(),q.reusable)),q,l,w)}}(0,c.e)("BABYLON.FxaaPostProcess",x);var o=l(12591),d=l(12564),T=l(12972),V=l(12975),U=l(12647);let B=null;function v(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:F,width:s}=e(q,I,l);if(!F||!s)return void o.b.Error("Invalid 'size' parameter !");I.Wq().activeCamera===I?q.onEndFrameObservable.addOnce((()=>{B||(B=document.createElement("canvas")),B.width=s,B.height=F;const I=B.getContext("2d"),l=q.getRenderingCanvas();if(!I||!l)return void o.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const Z=l.width,r=l.height,x=B.width,T=B.height,V=x/Z,U=T/r,v=a?Math.max(V,U):Math.min(V,U),k=Z*v,C=r*v,R=(x-k)/2,W=(T-C)/2;I.drawImage(l,0,0,Z,r,R,W,k,C),O?(d.Tools.EncodeScreenshotCanvasData(B,void 0,t,void 0,c),w&&w("")):d.Tools.EncodeScreenshotCanvasData(B,w,t,void 0,c)})):R(q,I,l,(q=>{if(O){const I=new Blob([q]);d.Tools.DownloadBlob(I),w&&w("")}else w&&w(q)}),t,1,q.getCreationOptions().antialias,void 0,void 0,void 0,void 0,c)}async function k(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((c,a)=>{v(q,I,l,(q=>{"undefined"!==typeof q?c(q):a(new Error("Data is undefined"))}),w,void 0,t,O)}))}async function C(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((a=>{v(q,I,{width:l,height:w},(()=>{a()}),t,!0,O,c)}))}function R(q,I,O,c){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7?arguments[7]:void 0,r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=arguments.length>9&&void 0!==arguments[9]&&arguments[9],B=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],v=arguments.length>11?arguments[11]:void 0,k=arguments.length>12?arguments[12]:void 0,C=arguments.length>13?arguments[13]:void 0;const{height:R,width:W,finalWidth:i,finalHeight:S}=e(q,I,O),g={width:W,height:R};if(!R||!W)return void o.b.Error("Invalid 'size' parameter !");q.skipFrameRender=!0;const p=q.getRenderWidth,X=q.getRenderHeight;q.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&q._currentRenderTarget?q._currentRenderTarget.width:W},q.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&q._currentRenderTarget?q._currentRenderTarget.height:R},q.onResizeObservable.hasObservers()&&q.onResizeObservable.notifyObservers(q);const K=I.Wq(),D=new t.b("screenShot",g,K,!1,!1,0,!1,w.d.BILINEAR_SAMPLINGMODE,void 0,d,void 0,void 0,void 0,F);D.renderList=K.meshes.slice(),D.samples=F,D.renderSprites=r,D.activeCamera=I,D.forceLayerMaskCheck=B,null===k||void 0===k||k(D);const M=C||T.DumpData,n=()=>{K.incrementRenderId(),K.resetCachedMaterial(),(0,U.e)((()=>D.isReadyForRendering()&&I.isReady(!0)),(()=>{q.onEndFrameObservable.addOnce((()=>{i===W&&S===R?D.readPixels(void 0,void 0,void 0,!1).then((q=>{M(W,R,q,c,a,Z,!0,void 0,v),D.dispose()})):(q.isWebGPU?l.e(51).then(l.bind(l,15224)):l.e(52).then(l.bind(l,15229))).then((async()=>await(0,V.b)("pass",D.getInternalTexture(),K,void 0,void 0,void 0,i,S).then((I=>{q._readTexturePixels(I,i,S,-1,0,null,!0,!1,0,0).then((q=>{M(i,S,q,c,a,Z,!0,void 0,v),I.dispose()}))}))))})),K.incrementRenderId(),K.resetCachedMaterial();const w=K.activeCamera,t=K.activeCameras,O=I.outputRenderTarget,F=K.spritesEnabled;K.activeCamera=I,K.activeCameras=null,I.outputRenderTarget=D,K.spritesEnabled=r;const s=K.meshes;K.meshes=D.renderList||K.meshes;try{K.render()}finally{K.activeCamera=w,K.activeCameras=t,I.outputRenderTarget=O,K.spritesEnabled=F,K.meshes=s,q.getRenderWidth=p,q.getRenderHeight=X,q.onResizeObservable.hasObservers()&&q.onResizeObservable.notifyObservers(q),I.getProjectionMatrix(!0),q.skipFrameRender=!1}}),(()=>{q.skipFrameRender=!1,q.getRenderWidth=p,q.getRenderHeight=X}))};if(s){const q=new x("antialiasing",1,K.activeCamera);D.addPostProcess(q),q.dc=!0,q.onEffectCreatedObservable.addOnce((q=>{q.isReady()?n():q.onCompiled=()=>{n()}}))}else n()}async function W(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],Z=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,x=arguments.length>12?arguments[12]:void 0;return await new Promise(((o,d)=>{R(q,I,l,(q=>{"undefined"!==typeof q?o(q):d(new Error("Data is undefined"))}),w,t,O,c,a,F,s,Z,r,x)}))}function e(q,I,l){let w=0,t=0,O=0,c=0;if("object"===typeof l){const a=l.precision?Math.abs(l.precision):1;l.width&&l.height?(w=l.height*a,t=l.width*a):l.width&&!l.height?(t=l.width*a,w=Math.round(t/q.getAspectRatio(I))):l.height&&!l.width?(w=l.height*a,t=Math.round(w*q.getAspectRatio(I))):(t=Math.round(q.getRenderWidth()*a),w=Math.round(t/q.getAspectRatio(I))),l.finalWidth&&l.finalHeight?(c=l.finalHeight,O=l.finalWidth):l.finalWidth&&!l.finalHeight?(O=l.finalWidth,c=Math.round(O/q.getAspectRatio(I))):l.finalHeight&&!l.finalWidth?(c=l.finalHeight,O=Math.round(c*q.getAspectRatio(I))):(O=t,c=w)}else isNaN(l)||(w=l,t=l,O=l,c=l);return t&&(t=Math.floor(t)),w&&(w=Math.floor(w)),O&&(O=Math.floor(O)),c&&(c=Math.floor(c)),{height:0|w,width:0|t,finalWidth:0|O,finalHeight:0|c}}const i={CreateScreenshot:v,CreateScreenshotAsync:k,CreateScreenshotWithResizeAsync:C,CreateScreenshotUsingRenderTarget:R,CreateScreenshotUsingRenderTargetAsync:W};d.Tools.CreateScreenshot=v,d.Tools.CreateScreenshotAsync=k,d.Tools.CreateScreenshotUsingRenderTarget=R,d.Tools.CreateScreenshotUsingRenderTargetAsync=W}}]);