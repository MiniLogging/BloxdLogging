"use strict";(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[12,20],{12468:(I,O,C)=>{C.r(O),C.d(O,{Dispose:()=>s,DumpData:()=>Q,DumpDataAsync:()=>N,DumpFramebuffer:()=>p,DumpTools:()=>Z});var j=C(12370),K=C(12083),i=C(12282),y=C(12132);let S,U=null;async function p(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const S=await C.readPixels(0,0,I,O);Q(I,O,new Uint8Array(S.buffer),j,K,i,!0,void 0,y)}async function N(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{Q(I,O,C,(I=>U(I)),j,K,i,y,S)}))}function Q(I,O,p,N){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],mI=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((I,O)=>{let K,i=null;const U={QS:!0,depth:!1,SS:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12398)).then((p=>{let{ThinEngine:N}=p;const Q=y.e.Instances.length;try{K=new OffscreenCanvas(100,100),i=new N(K,!1,U)}catch(mI){var Z;Q<y.e.Instances.length&&(null===(Z=y.e.Instances.pop())||void 0===Z||Z.dispose()),K=document.createElement("canvas"),i=new N(K,!1,U)}y.e.Instances.pop(),y.e.OnEnginesDisposedObservable.add((I=>{i&&I!==i&&!i.p&&0===y.e.Instances.length&&s()})),i.getCaps().parallelShaderCompile=void 0;const q=new j.b(i);C.e(52).then(C.bind(C,14669)).then((C=>{let{passPixelShader:y}=C;if(!i)return void O("Engine is not defined");const U=new j.c({qO:i,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});S={canvas:K,qO:i,renderer:q,wrapper:U},I(S)}))})).catch(O)}))),await U})().then((C=>{if(C.qO.setSize(I,O,!0),p instanceof Float32Array){const I=new Uint8Array(p.length);let O=p.length;for(;O--;){const C=p[O];I[O]=Math.round(255*(0,i.Clamp)(C))}p=I}const j=C.qO.createRawTexture(p,I,O,5,!1,!q,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",j),C.renderer.draw(),mI?K.Tools.ToBlob(C.canvas,(I=>{const O=new FileReader;O.onload=I=>{const O=I.target.result;N&&N(O)},O.readAsArrayBuffer(I)}),Q,E):K.Tools.EncodeScreenshotCanvasData(C.canvas,N,Q,Z,E),j.dispose()}))}function s(){var I;S?(S.wrapper.dispose(),S.renderer.dispose(),S.qO.dispose()):null===(I=U)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.qO.dispose()}));U=null,S=null}const Z={DumpData:Q,DumpDataAsync:N,DumpFramebuffer:p,Dispose:s};K.Tools.DumpData=Q,K.Tools.DumpDataAsync=N,K.Tools.DumpFramebuffer=p},12242:(I,O,C)=>{C.r(O),C.d(O,{CreateScreenshot:()=>W,CreateScreenshotAsync:()=>Y,CreateScreenshotUsingRenderTarget:()=>c,CreateScreenshotUsingRenderTargetAsync:()=>n,CreateScreenshotWithResizeAsync:()=>o,ScreenshotTools:()=>T});var j=C(12245),K=C(12320),i=C(12363),y=C(12226),S=C(12296),U=C(12370),p=C(12396),N=C(12272);class Q extends U.c{static _GetDefines(I){if(!I)return null;return I.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(I,O){I?(this._webGPUReady=!0,O.push(Promise.all([C.e(54).then(C.bind(C,14681)),C.e(55).then(C.bind(C,14686))]))):O.push(Promise.all([C.e(56).then(C.bind(C,14691)),C.e(57).then(C.bind(C,14696))]))}constructor(I){const O={...arguments.length>2?arguments[2]:void 0,name:I,qO:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||p.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:Q.VertexUrl,fragmentShader:Q.FragmentUrl,uniforms:Q.Uniforms};super({...O,defines:Q._GetDefines(O.qO)}),this.texelSize=new N.Vector2(0,0)}bind(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(I),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}Q.VertexUrl="fxaa",Q.FragmentUrl="fxaa",Q.Uniforms=["texelSize"];class s extends i.c{getClassName(){return"FxaaPostProcess"}constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const U={uniforms:Q.Uniforms,size:"number"===typeof O?O:void 0,camera:C,samplingMode:K||j.e.BILINEAR_SAMPLINGMODE,qO:i,reusable:y,textureType:S,...O};super(I,Q.FragmentUrl,{effectWrapper:"number"!==typeof O&&O.effectWrapper?void 0:new Q(I,i,U),...U}),this.onApplyObservable.add((I=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(I,O,C,j){return S.e.Parse((()=>new s(I.name,I.options,O,I.renderTargetSamplingMode,C.getEngine(),I.reusable)),I,C,j)}}(0,y.e)("BABYLON.FxaaPostProcess",s);var Z=C(12103),q=C(12083),mI=C(12468),E=C(12476),h=C(12163);let r=null;function W(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:U,width:p}=X(I,O,C);if(!U||!p)return void Z.c.Error("Invalid 'size' parameter !");O.nI().activeCamera===O?I.onEndFrameObservable.addOnce((()=>{r||(r=document.createElement("canvas")),r.width=p,r.height=U;const O=r.getContext("2d"),C=I.getRenderingCanvas();if(!O||!C)return void Z.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const N=C.width,Q=C.height,s=r.width,mI=r.height,E=s/N,h=mI/Q,W=S?Math.max(E,h):Math.min(E,h),Y=N*W,o=Q*W,c=(s-Y)/2,n=(mI-o)/2;O.drawImage(C,0,0,N,Q,c,n,Y,o),i?(q.Tools.EncodeScreenshotCanvasData(r,void 0,K,void 0,y),j&&j("")):q.Tools.EncodeScreenshotCanvasData(r,j,K,void 0,y)})):c(I,O,C,(I=>{if(i){const O=new Blob([I]);q.Tools.DownloadBlob(O),j&&j("")}else j&&j(I)}),K,1,I.getCreationOptions().antialias,void 0,void 0,void 0,void 0,y)}async function Y(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((y,S)=>{W(I,O,C,(I=>{"undefined"!==typeof I?y(I):S(new Error("Data is undefined"))}),j,void 0,K,i)}))}async function o(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5?arguments[5]:void 0,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((S=>{W(I,O,{width:C,height:j},(()=>{S()}),K,!0,i,y)}))}function c(I,O,i,y){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]&&arguments[9],r=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],W=arguments.length>11?arguments[11]:void 0,Y=arguments.length>12?arguments[12]:void 0,o=arguments.length>13?arguments[13]:void 0;const{height:c,width:n,finalWidth:T,finalHeight:H}=X(I,O,i),b={width:n,height:c};if(!c||!n)return void Z.c.Error("Invalid 'size' parameter !");I.skipFrameRender=!0;const a=I.getRenderWidth,M=I.getRenderHeight;I.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&I._currentRenderTarget?I._currentRenderTarget.width:n},I.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&I._currentRenderTarget?I._currentRenderTarget.height:c},I.onResizeObservable.hasObservers()&&I.onResizeObservable.notifyObservers(I);const u=O.nI(),J=new K.d("screenShot",b,u,!1,!1,0,!1,j.e.BILINEAR_SAMPLINGMODE,void 0,q,void 0,void 0,void 0,U);J.renderList=u.meshes.slice(),J.samples=U,J.renderSprites=Q,J.activeCamera=O,J.forceLayerMaskCheck=r,null===Y||void 0===Y||Y(J);const f=o||mI.DumpData,l=()=>{u.incrementRenderId(),u.resetCachedMaterial(),(0,h.f)((()=>J.isReadyForRendering()&&O.isReady(!0)),(()=>{I.onEndFrameObservable.addOnce((()=>{T===n&&H===c?J.readPixels(void 0,void 0,void 0,!1).then((I=>{f(n,c,I,y,S,N,!0,void 0,W),J.dispose()})):(I.isWebGPU?C.e(51).then(C.bind(C,14660)):C.e(52).then(C.bind(C,14669))).then((async()=>await(0,E.d)("pass",J.getInternalTexture(),u,void 0,void 0,void 0,T,H).then((O=>{I._readTexturePixels(O,T,H,-1,0,null,!0,!1,0,0).then((I=>{f(T,H,I,y,S,N,!0,void 0,W),O.dispose()}))}))))})),u.incrementRenderId(),u.resetCachedMaterial();const j=u.activeCamera,K=u.activeCameras,i=O.outputRenderTarget,U=u.spritesEnabled;u.activeCamera=O,u.activeCameras=null,O.outputRenderTarget=J,u.spritesEnabled=Q;const p=u.meshes;u.meshes=J.renderList||u.meshes;try{u.render()}finally{u.activeCamera=j,u.activeCameras=K,O.outputRenderTarget=i,u.spritesEnabled=U,u.meshes=p,I.getRenderWidth=a,I.getRenderHeight=M,I.onResizeObservable.hasObservers()&&I.onResizeObservable.notifyObservers(I),O.getProjectionMatrix(!0),I.skipFrameRender=!1}}),(()=>{I.skipFrameRender=!1,I.getRenderWidth=a,I.getRenderHeight=M}))};if(p){const I=new s("antialiasing",1,u.activeCamera);J.addPostProcess(I),I.sS=!0,I.onEffectCreatedObservable.addOnce((I=>{I.isReady()?l():I.onCompiled=()=>{l()}}))}else l()}async function n(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],N=arguments.length>10?arguments[10]:void 0,Q=arguments.length>11?arguments[11]:void 0,s=arguments.length>12?arguments[12]:void 0;return await new Promise(((Z,q)=>{c(I,O,C,(I=>{"undefined"!==typeof I?Z(I):q(new Error("Data is undefined"))}),j,K,i,y,S,U,p,N,Q,s)}))}function X(I,O,C){let j=0,K=0,i=0,y=0;if("object"===typeof C){const S=C.precision?Math.abs(C.precision):1;C.width&&C.height?(j=C.height*S,K=C.width*S):C.width&&!C.height?(K=C.width*S,j=Math.round(K/I.getAspectRatio(O))):C.height&&!C.width?(j=C.height*S,K=Math.round(j*I.getAspectRatio(O))):(K=Math.round(I.getRenderWidth()*S),j=Math.round(K/I.getAspectRatio(O))),C.finalWidth&&C.finalHeight?(y=C.finalHeight,i=C.finalWidth):C.finalWidth&&!C.finalHeight?(i=C.finalWidth,y=Math.round(i/I.getAspectRatio(O))):C.finalHeight&&!C.finalWidth?(y=C.finalHeight,i=Math.round(y*I.getAspectRatio(O))):(i=K,y=j)}else isNaN(C)||(j=C,K=C,i=C,y=C);return K&&(K=Math.floor(K)),j&&(j=Math.floor(j)),i&&(i=Math.floor(i)),y&&(y=Math.floor(y)),{height:0|j,width:0|K,finalWidth:0|i,finalHeight:0|y}}const T={CreateScreenshot:W,CreateScreenshotAsync:Y,CreateScreenshotWithResizeAsync:o,CreateScreenshotUsingRenderTarget:c,CreateScreenshotUsingRenderTargetAsync:n};q.Tools.CreateScreenshot=W,q.Tools.CreateScreenshotAsync=Y,q.Tools.CreateScreenshotUsingRenderTarget=c,q.Tools.CreateScreenshotUsingRenderTargetAsync=n}}]);