/*! For license information please see dmxbp.12.6b4a2937.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12],{12712:K=>{"use strict";K.exports=function(K,Y,l,v,U,d){var A=+Y[0],c=+Y[1],t=+Y[2],Z=+l[0],m=+l[1],V=+l[2],M=Math.sqrt(Z*Z+m*m+V*V);if(0===M)throw new Error("Can't raycast along a zero vector");return function(K,Y,l,v,U,d,A,c,t,Z){for(var m=0,V=Math.floor,M=0|V(Y),u=0|V(l),o=0|V(v),W=U>0?1:-1,g=d>0?1:-1,J=A>0?1:-1,n=Math.abs(1/U),R=Math.abs(1/d),H=Math.abs(1/A),z=n<1/0?n*(W>0?M+1-Y:Y-M):1/0,r=R<1/0?R*(g>0?u+1-l:l-u):1/0,E=H<1/0?H*(J>0?o+1-v:v-o):1/0,y=-1;m<=c;){var T=K(M,u,o);if(T)return t&&(t[0]=Y+m*U,t[1]=l+m*d,t[2]=v+m*A),Z&&(Z[0]=Z[1]=Z[2]=0,0===y&&(Z[0]=-W),1===y&&(Z[1]=-g),2===y&&(Z[2]=-J)),T;z<r?z<E?(M+=W,m=z,z+=n,y=0):(o+=J,m=E,E+=H,y=2):r<E?(u+=g,m=r,r+=R,y=1):(o+=J,m=E,E+=H,y=2)}return t&&(t[0]=Y+m*U,t[1]=l+m*d,t[2]=v+m*A),Z&&(Z[0]=Z[1]=Z[2]=0),0}(K,A,c,t,Z/=M,m/=M,V/=M,v="undefined"===typeof v?64:+v,U,d)}},12754:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>d});var v=l(90);function U(){this.Tl=!1,this.stopPropagation=!1,this.Ul=!1,this.disabled=!1}class d{constructor(K,Y){this.version="0.7.0";var l=Object.assign({},new U,Y||{});this.element=K||document,this.Tl=!!l.Tl,this.stopPropagation=!!l.stopPropagation,this.Ul=!!l.Ul,this.disabled=!!l.disabled,this.filterEvents=(K,Y)=>!0,this.down=new v.EventEmitter,this.up=new v.EventEmitter,this.state={},this.uk={dx:0,dy:0,Am:0,$i:0,Bm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?c(this):document.addEventListener("DOMContentLoaded",(K=>{c(this)}),{once:!0})}bind(K){for(var Y=arguments.length,l=new Array(Y>1?Y-1:0),v=1;v<Y;v++)l[v-1]=arguments[v];l.forEach((Y=>{var l=this._keyBindmap[Y]||[];l.includes(K)||(l.push(K),this._keyBindmap[Y]=l)})),this.state[K]=!!this.state[K],this.pressCount[K]=this.pressCount[K]||0,this.releaseCount[K]=this.releaseCount[K]||0}unbind(K){for(var Y in this._keyBindmap){var l=this._keyBindmap[Y],v=l.indexOf(K);v>-1&&l.splice(v,1)}}getBindings(){var K={};for(var Y in this._keyBindmap){this._keyBindmap[Y].forEach((l=>{K[l]=K[l]||[],K[l].push(Y)}))}return K}bf(){A(this.uk),A(this.pressCount),A(this.releaseCount)}}function A(K){for(var Y in K)K[Y]=0}function c(K){window.addEventListener("keydown",o.bind(null,K,!0),!1),window.addEventListener("keyup",o.bind(null,K,!1),!1);var Y={passive:!0};K.element.addEventListener("touchstart",V.bind(void 0,K),{passive:!1}),K.element.addEventListener("touchend",u.bind(void 0,K),Y),K.element.addEventListener("mousedown",W.bind(null,K,!0),Y),window.document.addEventListener("mouseup",W.bind(null,K,!1),Y),K.element.addEventListener("touchmove",g.bind(null,K),Y),K.element.addEventListener("mousemove",g.bind(null,K),Y),window.PointerEvent,K.element.addEventListener("wheel",J.bind(null,K),Y),K.element.addEventListener("contextmenu",n.bind(null,K),!1),window.addEventListener("blur",R.bind(null,K),!1)}var t=0,Z=0,m=null;function V(K,Y){Y.preventDefault(),M(Y)}function M(K){let Y=!1;for(let l=0;l<K.touches.length;++l)if(K.touches[l].identifier===m){Y=!0;break}if(!Y){const Y=K.changedTouches[0];t=Y.clientX,Z=Y.clientY,m=Y.identifier}}function u(K,Y){for(var l=Y.changedTouches,v=0;v<l.length;++v)l[v].identifier===m&&(m=null)}function o(K,Y,l){H(l.code,Y,K,l)}function W(K,Y,l){if("pointerId"in l)if(Y){if(null!==K._touches.currID)return;K._touches.currID=l.pointerId}else{if(K._touches.currID!==l.pointerId)return;K._touches.currID=null}return H("Mouse"+("button"in l?l.button+1:1),Y,K,l),!1}function g(K,Y){var l=Y.movementX||Y.mozMovementX||0,v=Y.movementY||Y.mozMovementY||0;if(Y.touches&&0===(l|v)){var U=function(K){M(K);for(let Y=0;Y<K.changedTouches.length;++Y)if(K.changedTouches[Y].identifier==m){const l=K.changedTouches[Y],v=[l.clientX-t,l.clientY-Z];return t=l.clientX,Z=l.clientY,v}return console.error(`Did not find touch id ${m}`),[0,0]}(Y);l=U[0],v=U[1]}K.uk.dx+=l,K.uk.dy+=v}function J(K,Y){var l=1;switch(Y.deltaMode){case 0:l=1;break;case 1:l=12;break;case 2:l=K.element.clientHeight||window.innerHeight}K.uk.Am+=(Y.deltaX||0)*l,K.uk.$i+=(Y.deltaY||0)*l,K.uk.Bm+=(Y.deltaZ||0)*l}function n(K,Y){if(!K.Ul)return Y.preventDefault(),!1}function R(K){for(var Y in K._keyStates)K._keyStates[Y]&&(/^Mouse\d/.test(Y)||H(Y,!1,K,{code:Y,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function H(K,Y,l,v){var U=l._keyBindmap[K];U&&(z(l._keyStates[K],Y)&&(l._keyStates[K]=Y,U.forEach((K=>{(!l.filterEvents||l.filterEvents(v,K))&&function(K,Y,l,v){var U=Y?l.pressCount:l.releaseCount;U[K]=(U[K]||0)+1;var d=l._bindPressCount[K]||0;(d+=Y?1:-1)<0&&(d=0);l._bindPressCount[K]=d;var A=l.state[K];if(z(A,d)){l.state[K]=d>0;var c=Y?l.down:l.up;l.disabled||c.emit(K,v)}}(K,Y,l,v)}))),"button"in v||(l.Tl&&!v.defaultPrevented&&v.preventDefault(),l.stopPropagation&&v.stopPropagation()))}function z(K,Y){return K?!Y:Y}},12720:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>v});class v{constructor(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Yk=!1,this.Zk=!1,this.Ih=30,this.Xk=0,this.el=!1,this.fullscreen=!1,this._k=function(K){},this.al=function(){},this.cl=function(){},this.k=function(){},this.bl=function(K){},this.onFullscreenChanged=function(K){},Z((()=>{!function(K,Y){K._nowObject=performance||Date,K._lastTick=0,K._renderAccum=0,K._rt=0,K._frameCB=c.bind(null,K),requestAnimationFrame(K._frameCB),Y>0&&(K._intervalCB=A.bind(null,K),K._interval=setInterval(K._intervalCB,Math.max(Y,1e3/K.Ih/2)))}(this,Y),function(K,Y){if(!Y)return;var l=!1,v=!1;document.addEventListener("pointerlockchange",(v=>{l=document.pointerLockElement===Y,K.bl(l)})),document.addEventListener("fullscreenchange",(l=>{v=document.fullscreenElement===Y,K.onFullscreenChanged(v)})),Object.defineProperty(K,"el",{get:()=>l,set:K=>{K&&!l?t(Y):l&&!K&&function(K){K.exitPointerLock&&K.exitPointerLock()}(document)}}),Object.defineProperty(K,"fullscreen",{get:()=>v,set:K=>{K&&!v?Y.requestFullscreen():v&&!K&&document.exitFullscreen()}}),Y.addEventListener("click",(U=>{K.Yk&&!l&&t(Y),K.Zk&&!v&&Y.requestFullscreen()}));var U=()=>K.k();if(window.ResizeObserver){new ResizeObserver(U).observe(Y)}else window.addEventListener("resize",U)}(this,K),this.cl()}))}}var U=3,d=20;function A(K){for(var Y=1e3/K.Ih,l=K._nowObject.now()+d,v=0;K._nowObject.now()>=K._lastTick+Y&&K._nowObject.now()<l&&++v<=U;)K._k(Y),K._lastTick+=Y;var A=5*(Y+5),c=K._nowObject.now();if(c-K._lastTick>A)for(;c>=K._lastTick+Y;)K._lastTick+=Y}function c(K){requestAnimationFrame(K._frameCB),A(K);var Y=K._nowObject.now(),l=Y-K._rt;if(K._rt=Y,K.Xk>0){K._renderAccum+=l;var v=1e3/K.Xk;if(K._renderAccum<v)return;K._renderAccum=Math.min(K._renderAccum-v,v)}var U=1e3/K.Ih,d=(Y-K._lastTick)/U;K.al(l,d,U)}function t(K){K.requestPointerLock&&K.requestPointerLock()}var Z=K=>{if("loading"===document.readyState){var Y=()=>{document.removeEventListener("readystatechange",Y),K()};document.addEventListener("readystatechange",Y)}else setTimeout(K,1)}},12763:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>V});var v=l(897),U=l(147);class d{constructor(K,Y,l,d,A,c,t){this.Lh=new v(K.base,K.Mh),this.mass=Y,this.friction=l,this.restitution=d,this.zk=A,this.Th=c,this.Ak=!!t,this.Pk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.jh=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Nh=U.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=U.create(),this._impulses=U.create(),this._sleepFrameCount=10}loadFromCopy(K){U.i(this.Lh.base,K.Lh.base),U.i(this.Lh.Mh,K.Lh.Mh),U.i(this.Lh.max,K.Lh.max),this.Lh.mag=K.Lh.mag,this.mass=K.mass,this.friction=K.friction,this.restitution=K.restitution,this.zk=K.zk,this.Th=K.Th,this.Ak=K.Ak,this.Pk=K.Pk,this.fluidDrag=K.fluidDrag,this.jh=K.jh,this.preventFallOffEdge=K.preventFallOffEdge,this.rolledBackLastTick=K.rolledBackLastTick,U.i(this.Nh,K.Nh),U.i(this.resting,K.resting),this.inFluid=K.inFluid,this._ratioInFluid=K._ratioInFluid,U.i(this._forces,K._forces),U.i(this._impulses,K._impulses),this._sleepFrameCount=K._sleepFrameCount}setPosition(K){A(K),U.Lg(K,K,this.Lh.base),this.Lh.translate(K),this.Mg()}We(){return U.clone(this.Lh.base)}applyForce(K){A(K),U.add(this._forces,this._forces,K),this.Mg()}applyImpulse(K){A(K),U.add(this._impulses,this._impulses,K),this.Mg()}Mg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var A=K=>{};var c=l(897),t=l(147),Z=l(902);function m(){this.Pk=.1,this.fluidDrag=.4,this.qj=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function V(K,Y,l){K=Object.assign(new m,K),this.gravity=K.gravity||[0,-10,0],this.Pk=K.Pk||.1,this.qj=K.qj||2,this.fluidDrag=K.fluidDrag||.4,this.minBounceImpulse=K.minBounceImpulse,this.bodies=[],this.sm=K.sm,this.testSolid=Y,this.testFluid=l}V.prototype.Eh=function(K,Y,l,v,U,A){K=K||new c([0,0,0],[1,1,1]),"undefined"==typeof Y&&(Y=1),"undefined"==typeof l&&(l=1),"undefined"==typeof v&&(v=0),"undefined"==typeof U&&(U=1);var t=new d(K,Y,l,v,U,A);return this.bodies.push(t),t},V.prototype.Gh=function(K){var Y=this.bodies.indexOf(K);Y<0||(this.bodies.splice(Y,1),K.Lh=K.Th=null)};var M=t.create(),u=t.create(),o=t.create(),W=t.create(),g=t.create(),J=t.create(),n=t.create(),R=new c([0,0,0],[1,1,1]),H=new d(R,1,1,0,1,(()=>{}),!1);function z(K,Y,l){return Y=l,Y*=1-(1-K.ratioInFluid)**2}V.prototype.bf=function(K){K/=1e3;var Y=I(0,t.squaredLength(this.gravity));this.bodies.forEach((l=>function(K,Y,l,v){t.i(g,Y.resting),K.sm&&H.loadFromCopy(Y);if(Y.mass<=0)return t.set(Y.Nh,0,0,0),t.set(Y._forces,0,0,0),void t.set(Y._impulses,0,0,0);var U=v||0===Y.zk;if(function(K,Y,l,v){if(Y._sleepFrameCount>0)return!1;if(v)return!0;var U=!1,d=.5*l*l*Y.zk;return t.scale(k,K.gravity,d),Z(K.testSolid,Y.Lh,k,(function(){return U=!0,!0}),!0),U}(K,Y,l,U))return;Y._sleepFrameCount--,function(K,Y){var l=Y.Lh,v=Math.floor(l.base[0]),U=Math.floor(l.base[2]),d=Math.floor(l.base[1]),A=Math.floor(l.max[1]);if(!K.testFluid(v,d,U))return Y.inFluid=!1,void(Y.ratioInFluid=0);var c=1,Z=d+1;for(;Z<=A&&K.testFluid(v,Z,U);)c++,Z++;var m=(d+c-l.base[1])/l.Mh[1];m>1&&(m=1);var V=l.Mh[0]*l.Mh[1]*l.Mh[2]*m,M=E;t.scale(M,K.gravity,-K.qj*V*Y.zk),Y.applyForce(M),Y.inFluid=!0,Y.ratioInFluid=m}(K,Y),a(Y._forces),a(Y._impulses),a(Y.Nh),a(Y.resting),t.scale(M,Y._forces,1/Y.mass),t.sh(M,M,K.gravity,Y.zk),t.scale(u,Y._impulses,1/Y.mass),t.sh(u,u,M,l),t.add(Y.Nh,Y.Nh,u),Y.friction&&(y(K,0,Y,u,l),y(K,1,Y,u,l),y(K,2,Y,u,l));var d=Y.fluidDrag>=0?Y.fluidDrag:K.fluidDrag,A=Y.Pk>=0?Y.Pk:K.Pk,c=A,m=A;Y.inFluid&&(c=z(Y,c,Y.fluidDragHoriz>=0?Y.fluidDragHoriz:d),m=z(Y,m,Y.fluidDragVert>=0?Y.fluidDragVert:d));c=Math.max(1-c*l/Y.mass,0),m=Math.max(1-m*l/Y.mass,0),t.set(r,c,m,c),t.multiply(Y.Nh,Y.Nh,r),t.scale(o,Y.Nh,l),t.set(Y._forces,0,0,0),t.set(Y._impulses,0,0,0),Y.Ak&&L(i,Y.Lh);t.i(J,o),t.set(n,0,0,0),Y.preventFallOffEdge&&function(K,Y,l,v){if(!Y.resting[1]||l[1]>0)return;var U=X;L(U,Y.Lh);for(var d=0;d<3;d+=2){t.set(Q,0,0,0),Q[d]=l[d];var A=!0;(A=(A=(A=(A=A&&!w(K,U.base[0]+Q[0]+1e-5,U.base[1],U.base[2]+Q[2]+1e-5))&&!w(K,U.max[0]+Q[0]-1e-5,U.base[1],U.base[2]+Q[2]+1e-5))&&!w(K,U.base[0]+Q[0]+1e-5,U.base[1],U.max[2]+Q[2]-1e-5))&&!w(K,U.max[0]+Q[0]-1e-5,U.base[1],U.max[2]+Q[2]-1e-5))?(v[d]=l[d]>0?1:-1,l[d]=0):0===d&&(t.set(f,l[0],0,0),e(K,U,f,v,Y.slideOnCollision))}}(K,Y,o,n);e(K,Y.Lh,o,Y.resting,Y.slideOnCollision),Y.Ak&&function(K,Y,l,v){if(Y.resting[1]>=0&&!Y.inFluid)return;var U=0!==Y.resting[0],d=0!==Y.resting[2];if(!U&&!d)return;var A=Math.abs(v[0]/v[2]),c=4;if(!U&&A>c)return;if(!d&&A<1/c)return;t.add(B,l.base,v);var m=K.testSolid;Z(m,l,v,(function(K,Y,l,v){if(1!==Y)return!0;v[Y]=0}));var V=l.base[1],M=Y.inFluid?1.951:1.001,u=Math.floor(V+M)-V;t.set(P,0,u,0);var o=!1;if(Z(m,l,P,(function(K,Y,l,v){return o=!0,!0})),o)return;t.Lg(G,B,l.base),G[1]=0,e(K,l,G,D,!0);var W=I(l.base[0],B[0]),g=I(l.base[2],B[2]);if(U&&!W&&(!g||!d))return;if(d&&(!W||!U)&&!g)return;var J=!0;if(J=J&&!w(K,l.base[0]+1e-5,l.base[1],l.base[2]+1e-5),J=J&&!w(K,l.max[0]-1e-5,l.base[1],l.base[2]+1e-5),J=J&&!w(K,l.base[0]+1e-5,l.base[1],l.max[2]-1e-5),J=J&&!w(K,l.max[0]-1e-5,l.base[1],l.max[2]-1e-5),J)return;L(Y.Lh,l),Y.resting[0]=D[0],Y.resting[2]=D[2],Y.jh&&Y.jh()}(K,Y,i,J);for(var V=0;V<3;++V)Y.resting[V]=Y.resting[V]||n[V],W[V]=0,Y.resting[V]&&(g[V]||(W[V]=-Y.Nh[V]),Y.Nh[V]=0);var R=t.length(W);R>.001&&(t.scale(W,W,Y.mass),Y.Th&&Y.Th(W),Y.restitution>0&&R>K.minBounceImpulse&&(t.scale(W,W,Y.restitution),Y.applyImpulse(W)));var T=t.squaredLength(Y.Nh);T>1e-5&&Y.Mg();K.sm&&K.sm(Y)?(Y.loadFromCopy(H),Y.rolledBackLastTick=!0):Y.rolledBackLastTick=!1}(this,l,K,Y)))};var r=t.create([0,0,0]);var E=t.create();function y(K,Y,l,v,U){var d=l.resting[Y],A=v[Y];if(!l.alwaysApplyHorizFriction||1!==Y){if(0===d)return;if(d*A<=0)return}t.i(T,l.Nh),T[Y]=0;var c=t.length(T);if(!I(c,0)){var Z=Math.abs(l.friction*K.gravity[Y]*U),m=c>Z?(c-Z)/c:0;l.Nh[(Y+1)%3]*=m,l.Nh[(Y+2)%3]*=m}}var T=t.create();function e(K,Y,l,v,U){return t.set(v,0,0,0),Z(K.testSolid,Y,l,(function(K,Y,l,d){v[Y]=l,d[Y]=0,U||(d[0]=0,d[1]=0,d[2]=0)}))}var i=new c([],[]),D=t.create(),B=t.create(),P=t.create(),G=t.create();var Q=t.create(),X=new c([],[]),f=t.create();function w(K,Y,l,v){return K.testSolid(Math.floor(Y),Math.floor(l-1),Math.floor(v))}var k=t.create();function I(K,Y){return Math.abs(K-Y)<1e-5}function L(K,Y){for(var l=0;l<3;l++)K.base[l]=Y.base[l],K.max[l]=Y.max[l],K.Mh[l]=Y.Mh[l]}var a=function(K){}},11649:function(K,Y){!function(K){"use strict";var Y=function(K,l){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,Y){K.__proto__=Y}||function(K,Y){for(var l in Y)Object.prototype.hasOwnProperty.call(Y,l)&&(K[l]=Y[l])},Y(K,l)};function l(K,l){if("function"!==typeof l&&null!==l)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");function v(){this.constructor=K}Y(K,l),K.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v)}function v(K,Y,l,v){var U,d=arguments.length,A=d<3?Y:null===v?v=Object.getOwnPropertyDescriptor(Y,l):v;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)A=Reflect.decorate(K,Y,l,v);else for(var c=K.length-1;c>=0;c--)(U=K[c])&&(A=(d<3?U(A):d>3?U(Y,l,A):U(Y,l))||A);return d>3&&A&&Object.defineProperty(Y,l,A),A}function U(K,Y,l){if(l||2===arguments.length)for(var v,U=0,d=Y.length;U<d;U++)!v&&U in Y||(v||(v=Array.prototype.slice.call(Y,0,U)),v[U]=Y[U]);return K.concat(v||Array.prototype.slice.call(Y))}var d,A=255,c=213;K.OPERATION=void 0,(d=K.OPERATION||(K.OPERATION={}))[d.ADD=128]="ADD",d[d.REPLACE=0]="REPLACE",d[d.DELETE=64]="DELETE",d[d.DELETE_AND_ADD=192]="DELETE_AND_ADD",d[d.TOUCH=1]="TOUCH",d[d.CLEAR=10]="CLEAR";var t=function(){function Y(K,Y,l){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=K,this.setParent(Y,l)}return Y.prototype.setParent=function(K,Y,l){var v=this;if(this.indexes||(this.indexes=this.ref instanceof GK?this.ref._definition.indexes:{}),this.parent=K,this.parentIndex=l,Y)if(this.root=Y,this.ref instanceof GK){var U=this.ref._definition;for(var d in U.schema){var A=this.ref[d];if(A&&A.$changes){var c=U.indexes[d];A.$changes.setParent(this.ref,Y,c)}}}else"object"===typeof this.ref&&this.ref.forEach((function(K,Y){if(K instanceof GK){var l=K.$changes,U=v.ref.$changes.indexes[Y];l.setParent(v.ref,v.root,U)}}))},Y.prototype.operation=function(K){this.changes.set(--this.currentCustomOperation,K)},Y.prototype.change=function(Y,l){void 0===l&&(l=K.OPERATION.ADD);var v="number"===typeof Y?Y:this.indexes[Y];this.assertValidIndex(v,Y);var U=this.changes.get(v);U&&U.op!==K.OPERATION.DELETE&&U.op!==K.OPERATION.TOUCH||this.changes.set(v,{op:U&&U.op===K.OPERATION.DELETE?K.OPERATION.DELETE_AND_ADD:l,index:v}),this.allChanges.add(v),this.changed=!0,this.touchParents()},Y.prototype.touch=function(Y){var l="number"===typeof Y?Y:this.indexes[Y];this.assertValidIndex(l,Y),this.changes.has(l)||this.changes.set(l,{op:K.OPERATION.TOUCH,index:l}),this.allChanges.add(l),this.touchParents()},Y.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Y.prototype.getType=function(K){if(this.ref._definition)return(Y=this.ref._definition).schema[Y.fieldsByIndex[K]];var Y,l=(Y=this.parent._definition).schema[Y.fieldsByIndex[this.parentIndex]];return Object.values(l)[0]},Y.prototype.getChildrenFilter=function(){var K=this.parent._definition.childFilters;return K&&K[this.parentIndex]},Y.prototype.getValue=function(K){return this.ref.getByIndex(K)},Y.prototype.delete=function(Y){var l="number"===typeof Y?Y:this.indexes[Y];if(void 0!==l){var v=this.getValue(l);this.changes.set(l,{op:K.OPERATION.DELETE,index:l}),this.allChanges.delete(l),delete this.caches[l],v&&v.$changes&&(v.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Y," (").concat(l,")"))},Y.prototype.discard=function(Y,l){var v=this;void 0===Y&&(Y=!1),void 0===l&&(l=!1),this.ref instanceof GK||this.changes.forEach((function(Y){if(Y.op===K.OPERATION.DELETE){var l=v.ref.getIndex(Y.index);delete v.indexes[l]}})),this.changes.clear(),this.changed=Y,l&&this.allChanges.clear(),this.currentCustomOperation=0},Y.prototype.discardAll=function(){var K=this;this.changes.forEach((function(Y){var l=K.getValue(Y.index);l&&l.$changes&&l.$changes.discardAll()})),this.discard()},Y.prototype.cache=function(K,Y){this.caches[K]=Y},Y.prototype.clone=function(){return new Y(this.ref,this.parent,this.root)},Y.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Y.prototype.assertValidIndex=function(K,Y){if(void 0===K)throw new Error('ChangeTree: missing index for field "'.concat(Y,'"'))},Y}();function Z(K,Y,l,v){return K[Y]||(K[Y]=[]),K[Y].push(l),null===v||void 0===v||v.forEach((function(K,Y){return l(K,Y)})),function(){return V(K[Y],K[Y].indexOf(l))}}function m(Y){var l=this,v="string"!==typeof this.$changes.getType();this.$items.forEach((function(U,d){Y.push({refId:l.$changes.refId,op:K.OPERATION.DELETE,field:d,value:void 0,previousValue:U}),v&&l.$changes.root.removeRef(U.$changes.refId)}))}function V(K,Y){if(-1===Y||Y>=K.length)return!1;for(var l=K.length-1,v=Y;v<l;v++)K[v]=K[v+1];return K.length=l,!0}var M=function(K,Y){var l=K.toString(),v=Y.toString();return l<v?-1:l>v?1:0};function u(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,Y){return"symbol"===typeof Y||isNaN(Y)?K[Y]:K.at(Y)},set:function(K,Y,l){if("symbol"===typeof Y||isNaN(Y))K[Y]=l;else{var v=Array.from(K.$items.keys()),U=parseInt(v[Y]||Y);void 0===l||null===l?K.deleteAt(U):K.setAt(U,l)}return!0},deleteProperty:function(K,Y){return"number"===typeof Y?K.deleteAt(Y):delete K[Y],!0}})}var o=function(){function Y(){for(var K=[],Y=0;Y<arguments.length;Y++)K[Y]=arguments[Y];this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,K)}return Y.prototype.nh=function(Y,l){return void 0===l&&(l=!0),Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,Y,l?this.$items:void 0)},Y.prototype.kh=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,Y)},Y.prototype.onChange=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,Y)},Y.is=function(K){return Array.isArray(K)||void 0!==K.array},Object.defineProperty(Y.prototype,"length",{get:function(){return this.$items.size},set:function(K){0===K?this.clear():this.splice(K,this.length-K)},enumerable:!1,configurable:!0}),Y.prototype.push=function(){for(var K,Y=this,l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return l.forEach((function(l){K=Y.$refId++,Y.setAt(K,l)})),K},Y.prototype.pop=function(){var K=Array.from(this.$indexes.values()).pop();if(void 0!==K){this.$changes.delete(K),this.$indexes.delete(K);var Y=this.$items.get(K);return this.$items.delete(K),Y}},Y.prototype.at=function(K){var Y=Array.from(this.$items.keys())[K];return this.$items.get(Y)},Y.prototype.setAt=function(Y,l){var v,U;if(void 0!==l&&null!==l){if(this.$items.get(Y)!==l){void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,Y);var d=null!==(U=null===(v=this.$changes.indexes[Y])||void 0===v?void 0:v.op)&&void 0!==U?U:K.OPERATION.ADD;this.$changes.indexes[Y]=Y,this.$indexes.set(Y,Y),this.$items.set(Y,l),this.$changes.change(Y,d)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Y.prototype.deleteAt=function(K){var Y=Array.from(this.$items.keys())[K];return void 0!==Y&&this.$deleteAt(Y)},Y.prototype.$deleteAt=function(K){return this.$changes.delete(K),this.$indexes.delete(K),this.$items.delete(K)},Y.prototype.clear=function(Y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Y&&m.call(this,Y),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},Y.prototype.concat=function(){for(var K,l=[],v=0;v<arguments.length;v++)l[v]=arguments[v];return new(Y.bind.apply(Y,U([void 0],(K=Array.from(this.$items.values())).concat.apply(K,l),!1)))},Y.prototype.join=function(K){return Array.from(this.$items.values()).join(K)},Y.prototype.reverse=function(){var K=this,Y=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(l,v){K.setAt(Y[v],l)})),this},Y.prototype.shift=function(){var K=Array.from(this.$items.keys()).shift();if(void 0!==K){var Y=this.$items.get(K);return this.$deleteAt(K),Y}},Y.prototype.slice=function(K,l){var v=new Y;return v.push.apply(v,Array.from(this.$items.values()).slice(K,l)),v},Y.prototype.sort=function(K){var Y=this;void 0===K&&(K=M);var l=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(K).forEach((function(K,v){Y.setAt(l[v],K)})),this},Y.prototype.splice=function(K,Y){void 0===Y&&(Y=this.length-K);for(var l=Array.from(this.$items.keys()),v=[],U=K;U<K+Y;U++)v.push(this.$items.get(l[U])),this.$deleteAt(l[U]);return v},Y.prototype.unshift=function(){for(var K=this,Y=[],l=0;l<arguments.length;l++)Y[l]=arguments[l];var v=this.length,U=Y.length,d=Array.from(this.$items.values());return Y.forEach((function(Y,l){K.setAt(l,Y)})),d.forEach((function(Y,l){K.setAt(U+l,Y)})),v+U},Y.prototype.indexOf=function(K,Y){return Array.from(this.$items.values()).indexOf(K,Y)},Y.prototype.lastIndexOf=function(K,Y){return void 0===Y&&(Y=this.length-1),Array.from(this.$items.values()).lastIndexOf(K,Y)},Y.prototype.every=function(K,Y){return Array.from(this.$items.values()).every(K,Y)},Y.prototype.some=function(K,Y){return Array.from(this.$items.values()).some(K,Y)},Y.prototype.forEach=function(K,Y){Array.from(this.$items.values()).forEach(K,Y)},Y.prototype.map=function(K,Y){return Array.from(this.$items.values()).map(K,Y)},Y.prototype.filter=function(K,Y){return Array.from(this.$items.values()).filter(K,Y)},Y.prototype.reduce=function(K,Y){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Y.prototype.reduceRight=function(K,Y){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Y.prototype.find=function(K,Y){return Array.from(this.$items.values()).find(K,Y)},Y.prototype.findIndex=function(K,Y){return Array.from(this.$items.values()).findIndex(K,Y)},Y.prototype.fill=function(K,Y,l){throw new Error("ArraySchema#fill() not implemented")},Y.prototype.copyWithin=function(K,Y,l){throw new Error("ArraySchema#copyWithin() not implemented")},Y.prototype.toString=function(){return this.$items.toString()},Y.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Y.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Y,Symbol.species,{get:function(){return Y},enumerable:!1,configurable:!0}),Y.prototype.entries=function(){return this.$items.entries()},Y.prototype.keys=function(){return this.$items.keys()},Y.prototype.values=function(){return this.$items.values()},Y.prototype.includes=function(K,Y){return Array.from(this.$items.values()).includes(K,Y)},Y.prototype.flatMap=function(K,Y){throw new Error("ArraySchema#flatMap() is not supported.")},Y.prototype.flat=function(K){throw new Error("ArraySchema#flat() is not supported.")},Y.prototype.findLast=function(){var K=Array.from(this.$items.values());return K.findLast.apply(K,arguments)},Y.prototype.findLastIndex=function(){var K=Array.from(this.$items.values());return K.findLastIndex.apply(K,arguments)},Y.prototype.setIndex=function(K,Y){this.$indexes.set(K,Y)},Y.prototype.getIndex=function(K){return this.$indexes.get(K)},Y.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},Y.prototype.deleteByIndex=function(K){var Y=this.$indexes.get(K);this.$items.delete(Y),this.$indexes.delete(K)},Y.prototype.toArray=function(){return Array.from(this.$items.values())},Y.prototype.toJSON=function(){return this.toArray().map((function(K){return"function"===typeof K.toJSON?K.toJSON():K}))},Y.prototype.clone=function(K){return K?new(Y.bind.apply(Y,U([void 0],Array.from(this.$items.values()),!1))):new(Y.bind.apply(Y,U([void 0],this.map((function(K){return K.$changes?K.clone():K})),!1)))},Y}();function W(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,Y){return"symbol"!==typeof Y&&"undefined"===typeof K[Y]?K.get(Y):K[Y]},set:function(K,Y,l){return"symbol"!==typeof Y&&-1===Y.indexOf("$")&&"nh"!==Y&&"kh"!==Y&&"onChange"!==Y?K.set(Y,l):K[Y]=l,!0},deleteProperty:function(K,Y){return K.delete(Y),!0}})}var g=function(){function Y(K){var l=this;if(this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K)if(K instanceof Map||K instanceof Y)K.forEach((function(K,Y){return l.set(Y,K)}));else for(var v in K)this.set(v,K[v])}return Y.prototype.nh=function(Y,l){return void 0===l&&(l=!0),Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,Y,l?this.$items:void 0)},Y.prototype.kh=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,Y)},Y.prototype.onChange=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,Y)},Y.is=function(K){return void 0!==K.map},Y.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Y.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Y,Symbol.species,{get:function(){return Y},enumerable:!1,configurable:!0}),Y.prototype.set=function(Y,l){if(void 0===l||null===l)throw new Error("MapSchema#set('".concat(Y,"', ").concat(l,"): trying to set ").concat(l," value on '").concat(Y,"'."));Y=Y.toString();var v="undefined"!==typeof this.$changes.indexes[Y],U=v?this.$changes.indexes[Y]:this.$refId++,d=v?K.OPERATION.REPLACE:K.OPERATION.ADD,A=void 0!==l.$changes;if(A&&l.$changes.setParent(this,this.$changes.root,U),v){if(!A&&this.$items.get(Y)===l)return;A&&this.$items.get(Y)!==l&&(d=K.OPERATION.ADD)}else this.$changes.indexes[Y]=U,this.$indexes.set(U,Y);return this.$items.set(Y,l),this.$changes.change(Y,d),this},Y.prototype.get=function(K){return this.$items.get(K)},Y.prototype.delete=function(K){return this.$changes.delete(K),this.$items.delete(K)},Y.prototype.clear=function(Y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Y&&m.call(this,Y),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},Y.prototype.has=function(K){return this.$items.has(K)},Y.prototype.forEach=function(K){this.$items.forEach(K)},Y.prototype.entries=function(){return this.$items.entries()},Y.prototype.keys=function(){return this.$items.keys()},Y.prototype.values=function(){return this.$items.values()},Object.defineProperty(Y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Y.prototype.setIndex=function(K,Y){this.$indexes.set(K,Y)},Y.prototype.getIndex=function(K){return this.$indexes.get(K)},Y.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},Y.prototype.deleteByIndex=function(K){var Y=this.$indexes.get(K);this.$items.delete(Y),this.$indexes.delete(K)},Y.prototype.toJSON=function(){var K={};return this.forEach((function(Y,l){K[l]="function"===typeof Y.toJSON?Y.toJSON():Y})),K},Y.prototype.clone=function(K){var l;return K?l=Object.assign(new Y,this):(l=new Y,this.forEach((function(K,Y){K.$changes?l.set(Y,K.clone()):l.set(Y,K)}))),l},Y}(),J={};function n(K,Y){J[K]=Y}function R(K){return J[K]}var H=function(){function K(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return K.create=function(Y){var l=new K;return l.schema=Object.assign({},Y&&Y.schema||{}),l.indexes=Object.assign({},Y&&Y.indexes||{}),l.fieldsByIndex=Object.assign({},Y&&Y.fieldsByIndex||{}),l.descriptors=Object.assign({},Y&&Y.descriptors||{}),l.deprecated=Object.assign({},Y&&Y.deprecated||{}),l},K.prototype.addField=function(K,Y){var l=this.getNextFieldIndex();this.fieldsByIndex[l]=K,this.indexes[K]=l,this.schema[K]=Array.isArray(Y)?{array:Y[0]}:Y},K.prototype.hasField=function(K){return void 0!==this.indexes[K]},K.prototype.addFilter=function(K,Y){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[K]]=Y,this.indexesWithFilters.push(this.indexes[K]),!0},K.prototype.addChildrenFilter=function(K,Y){var l=this.indexes[K],v=this.schema[K];if(R(Object.keys(v)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[l]=Y,!0;console.warn("@filterChildren: field '".concat(K,"' can't have children. Ignoring filter."))},K.prototype.getChildrenFilter=function(K){return this.childFilters&&this.childFilters[this.indexes[K]]},K.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},K}();function z(K){return K._context&&K._context.useFilters}var r=function(){function K(){this.types={},this.schemas=new Map,this.useFilters=!1}return K.prototype.has=function(K){return this.schemas.has(K)},K.prototype.get=function(K){return this.types[K]},K.prototype.add=function(K,Y){void 0===Y&&(Y=this.schemas.size),K._definition=H.create(K._definition),K._typeid=Y,this.types[Y]=K,this.schemas.set(K,Y)},K.create=function(Y){return void 0===Y&&(Y={}),function(l){return Y.context||(Y.context=new K),y(l,Y)}},K}(),E=new r;function y(K,Y){return void 0===Y&&(Y={}),function(l,v){var d=Y.context||E,A=l.constructor;if(A._context=d,!K)throw new Error("".concat(A.name,': @type() reference provided for "').concat(v,"\" is undefined. Make sure you don't have any circular dependencies."));d.has(A)||d.add(A);var c=A._definition;if(c.addField(v,K),c.descriptors[v]){if(c.deprecated[v])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(v,"' definition on '").concat(A.name,"'.\nCheck @type() annotation"))}catch(J){var t=J.stack.split("\n")[4].trim();throw new Error("".concat(J.message," ").concat(t))}}var Z=o.is(K),m=!Z&&g.is(K);if("string"!==typeof K&&!GK.is(K)){var V=Object.values(K)[0];"string"===typeof V||d.has(V)||d.add(V)}if(Y.manual)c.descriptors[v]={enumerable:!0,configurable:!0,writable:!0};else{var M="_".concat(v);c.descriptors[M]={enumerable:!1,configurable:!1,writable:!0},c.descriptors[v]={get:function(){return this[M]},set:function(K){K!==this[M]&&(void 0!==K&&null!==K?(!Z||K instanceof o||(K=new(o.bind.apply(o,U([void 0],K,!1)))),!m||K instanceof g||(K=new g(K)),void 0===K.$proxy&&(m?K=W(K):Z&&(K=u(K))),this.$changes.change(v),K.$changes&&K.$changes.setParent(this,this.$changes.root,this._definition.indexes[v])):this[M]&&this.$changes.delete(v),this[M]=K)},enumerable:!0,configurable:!0}}}}function T(K){return function(Y,l){var v=Y.constructor;v._definition.addFilter(l,K)&&(v._context.useFilters=!0)}}function e(K){return function(Y,l){var v=Y.constructor;v._definition.addChildrenFilter(l,K)&&(v._context.useFilters=!0)}}function i(K){return void 0===K&&(K=!0),function(Y,l){var v=Y.constructor._definition;v.deprecated[l]=!0,K&&(v.descriptors[l]={get:function(){throw new Error("".concat(l," is deprecated."))},set:function(K){},enumerable:!1,configurable:!0})}}function D(K,Y,l){for(var v in void 0===l&&(l={}),l.context||(l.context=K._context||l.context||E),Y)y(Y[v],l)(K.prototype,v);return K}function B(K){for(var Y=0,l=0,v=0,U=K.length;v<U;v++)(Y=K.charCodeAt(v))<128?l+=1:Y<2048?l+=2:Y<55296||Y>=57344?l+=3:(v++,l+=4);return l}function P(K,Y,l){for(var v=0,U=0,d=l.length;U<d;U++)(v=l.charCodeAt(U))<128?K[Y++]=v:v<2048?(K[Y++]=192|v>>6,K[Y++]=128|63&v):v<55296||v>=57344?(K[Y++]=224|v>>12,K[Y++]=128|v>>6&63,K[Y++]=128|63&v):(U++,v=65536+((1023&v)<<10|1023&l.charCodeAt(U)),K[Y++]=240|v>>18,K[Y++]=128|v>>12&63,K[Y++]=128|v>>6&63,K[Y++]=128|63&v)}function G(K,Y){K.push(255&Y)}function Q(K,Y){K.push(255&Y)}function X(K,Y){K.push(255&Y),K.push(Y>>8&255)}function f(K,Y){K.push(255&Y),K.push(Y>>8&255)}function w(K,Y){K.push(255&Y),K.push(Y>>8&255),K.push(Y>>16&255),K.push(Y>>24&255)}function k(K,Y){var l=Y>>24,v=Y>>16,U=Y>>8,d=Y;K.push(255&d),K.push(255&U),K.push(255&v),K.push(255&l)}function I(K,Y){var l=Math.floor(Y/Math.pow(2,32));k(K,Y>>>0),k(K,l)}function L(K,Y){var l=Y/Math.pow(2,32)|0;k(K,Y>>>0),k(K,l)}function a(K,Y){C(K,Y)}function F(K,Y){N(K,Y)}var s=new Int32Array(2),b=new Float32Array(s.buffer),x=new Float64Array(s.buffer);function C(K,Y){b[0]=Y,w(K,s[0])}function N(K,Y){x[0]=Y,w(K,s[0]),w(K,s[1])}function j(K,Y){return Q(K,Y?1:0)}function p(K,Y){Y||(Y="");var l=B(Y),v=0;if(l<32)K.push(160|l),v=1;else if(l<256)K.push(217),Q(K,l),v=2;else if(l<65536)K.push(218),f(K,l),v=3;else{if(!(l<4294967296))throw new Error("String too long");K.push(219),k(K,l),v=5}return P(K,K.length,Y),v+l}function S(K,Y){return isNaN(Y)?S(K,0):isFinite(Y)?Y!==(0|Y)?(K.push(203),N(K,Y),9):Y>=0?Y<128?(Q(K,Y),1):Y<256?(K.push(204),Q(K,Y),2):Y<65536?(K.push(205),f(K,Y),3):Y<4294967296?(K.push(206),k(K,Y),5):(K.push(207),L(K,Y),9):Y>=-32?(K.push(224|Y+32),1):Y>=-128?(K.push(208),G(K,Y),2):Y>=-32768?(K.push(209),X(K,Y),3):Y>=-2147483648?(K.push(210),w(K,Y),5):(K.push(211),I(K,Y),9):S(K,Y>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var q=Object.freeze({__proto__:null,utf8Write:P,int8:G,uint8:Q,int16:X,uint16:f,int32:w,uint32:k,int64:I,uint64:L,float32:a,float64:F,writeFloat32:C,writeFloat64:N,boolean:j,string:p,number:S});function O(K,Y,l){for(var v="",U=0,d=Y,A=Y+l;d<A;d++){var c=K[d];0!==(128&c)?192!==(224&c)?224!==(240&c)?240!==(248&c)?console.error("Invalid byte "+c.toString(16)):(U=(7&c)<<18|(63&K[++d])<<12|(63&K[++d])<<6|63&K[++d])>=65536?(U-=65536,v+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):v+=String.fromCharCode(U):v+=String.fromCharCode((15&c)<<12|(63&K[++d])<<6|63&K[++d]):v+=String.fromCharCode((31&c)<<6|63&K[++d]):v+=String.fromCharCode(c)}return v}function h(K,Y){return KK(K,Y)<<24>>24}function KK(K,Y){return K[Y.offset++]}function YK(K,Y){return lK(K,Y)<<16>>16}function lK(K,Y){return K[Y.offset++]|K[Y.offset++]<<8}function vK(K,Y){return K[Y.offset++]|K[Y.offset++]<<8|K[Y.offset++]<<16|K[Y.offset++]<<24}function UK(K,Y){return vK(K,Y)>>>0}function dK(K,Y){return MK(K,Y)}function AK(K,Y){return uK(K,Y)}function cK(K,Y){var l=UK(K,Y);return vK(K,Y)*Math.pow(2,32)+l}function tK(K,Y){var l=UK(K,Y);return UK(K,Y)*Math.pow(2,32)+l}var ZK=new Int32Array(2),mK=new Float32Array(ZK.buffer),VK=new Float64Array(ZK.buffer);function MK(K,Y){return ZK[0]=vK(K,Y),mK[0]}function uK(K,Y){return ZK[0]=vK(K,Y),ZK[1]=vK(K,Y),VK[0]}function oK(K,Y){return KK(K,Y)>0}function WK(K,Y){var l,v=K[Y.offset++];v<192?l=31&v:217===v?l=KK(K,Y):218===v?l=lK(K,Y):219===v&&(l=UK(K,Y));var U=O(K,Y.offset,l);return Y.offset+=l,U}function gK(K,Y){var l=K[Y.offset];return l<192&&l>160||217===l||218===l||219===l}function JK(K,Y){var l=K[Y.offset++];return l<128?l:202===l?MK(K,Y):203===l?uK(K,Y):204===l?KK(K,Y):205===l?lK(K,Y):206===l?UK(K,Y):207===l?tK(K,Y):208===l?h(K,Y):209===l?YK(K,Y):210===l?vK(K,Y):211===l?cK(K,Y):l>223?-1*(255-l+1):void 0}function nK(K,Y){var l=K[Y.offset];return l<128||l>=202&&l<=211}function RK(K,Y){return K[Y.offset]<160}function HK(K,Y){return K[Y.offset-1]===A&&(K[Y.offset]<128||K[Y.offset]>=202&&K[Y.offset]<=211)}var zK=Object.freeze({__proto__:null,int8:h,uint8:KK,int16:YK,uint16:lK,int32:vK,uint32:UK,float32:dK,float64:AK,int64:cK,uint64:tK,readFloat32:MK,readFloat64:uK,boolean:oK,string:WK,stringCheck:gK,number:JK,numberCheck:nK,arrayCheck:RK,switchStructureCheck:HK}),rK=function(){function Y(K){var Y=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return Y.add(K)}))}return Y.prototype.nh=function(Y,l){return void 0===l&&(l=!0),Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,Y,l?this.$items:void 0)},Y.prototype.kh=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,Y)},Y.prototype.onChange=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,Y)},Y.is=function(K){return void 0!==K.collection},Y.prototype.add=function(K){var Y=this.$refId++;return void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,Y),this.$changes.indexes[Y]=Y,this.$indexes.set(Y,Y),this.$items.set(Y,K),this.$changes.change(Y),Y},Y.prototype.at=function(K){var Y=Array.from(this.$items.keys())[K];return this.$items.get(Y)},Y.prototype.entries=function(){return this.$items.entries()},Y.prototype.delete=function(K){for(var Y,l,v=this.$items.entries();(l=v.next())&&!l.done;)if(K===l.value[1]){Y=l.value[0];break}return void 0!==Y&&(this.$changes.delete(Y),this.$indexes.delete(Y),this.$items.delete(Y))},Y.prototype.clear=function(Y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Y&&m.call(this,Y),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},Y.prototype.has=function(K){return Array.from(this.$items.values()).some((function(Y){return Y===K}))},Y.prototype.forEach=function(K){var Y=this;this.$items.forEach((function(l,v,U){return K(l,v,Y)}))},Y.prototype.values=function(){return this.$items.values()},Object.defineProperty(Y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Y.prototype.setIndex=function(K,Y){this.$indexes.set(K,Y)},Y.prototype.getIndex=function(K){return this.$indexes.get(K)},Y.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},Y.prototype.deleteByIndex=function(K){var Y=this.$indexes.get(K);this.$items.delete(Y),this.$indexes.delete(K)},Y.prototype.toArray=function(){return Array.from(this.$items.values())},Y.prototype.toJSON=function(){var K=[];return this.forEach((function(Y,l){K.push("function"===typeof Y.toJSON?Y.toJSON():Y)})),K},Y.prototype.clone=function(K){var l;return K?l=Object.assign(new Y,this):(l=new Y,this.forEach((function(K){K.$changes?l.add(K.clone()):l.add(K)}))),l},Y}(),EK=function(){function Y(K){var Y=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return Y.add(K)}))}return Y.prototype.nh=function(Y,l){return void 0===l&&(l=!0),Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,Y,l?this.$items:void 0)},Y.prototype.kh=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,Y)},Y.prototype.onChange=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,Y)},Y.is=function(K){return void 0!==K.set},Y.prototype.add=function(Y){var l,v;if(this.has(Y))return!1;var U=this.$refId++;void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,U);var d=null!==(v=null===(l=this.$changes.indexes[U])||void 0===l?void 0:l.op)&&void 0!==v?v:K.OPERATION.ADD;return this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,Y),this.$changes.change(U,d),U},Y.prototype.entries=function(){return this.$items.entries()},Y.prototype.delete=function(K){for(var Y,l,v=this.$items.entries();(l=v.next())&&!l.done;)if(K===l.value[1]){Y=l.value[0];break}return void 0!==Y&&(this.$changes.delete(Y),this.$indexes.delete(Y),this.$items.delete(Y))},Y.prototype.clear=function(Y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Y&&m.call(this,Y),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},Y.prototype.has=function(K){for(var Y,l=this.$items.values(),v=!1;(Y=l.next())&&!Y.done;)if(K===Y.value){v=!0;break}return v},Y.prototype.forEach=function(K){var Y=this;this.$items.forEach((function(l,v,U){return K(l,v,Y)}))},Y.prototype.values=function(){return this.$items.values()},Object.defineProperty(Y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Y.prototype.setIndex=function(K,Y){this.$indexes.set(K,Y)},Y.prototype.getIndex=function(K){return this.$indexes.get(K)},Y.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},Y.prototype.deleteByIndex=function(K){var Y=this.$indexes.get(K);this.$items.delete(Y),this.$indexes.delete(K)},Y.prototype.toArray=function(){return Array.from(this.$items.values())},Y.prototype.toJSON=function(){var K=[];return this.forEach((function(Y,l){K.push("function"===typeof Y.toJSON?Y.toJSON():Y)})),K},Y.prototype.clone=function(K){var l;return K?l=Object.assign(new Y,this):(l=new Y,this.forEach((function(K){K.$changes?l.add(K.clone()):l.add(K)}))),l},Y}(),yK=function(){function K(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return K.prototype.addRefId=function(K){this.refIds.has(K)||(this.refIds.add(K),this.containerIndexes.set(K,new Set))},K.get=function(Y){return void 0===Y.$filterState&&(Y.$filterState=new K),Y.$filterState},K}(),TK=function(){function K(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return K.prototype.getNextUniqueId=function(){return this.nextUniqueId++},K.prototype.addRef=function(K,Y,l){void 0===l&&(l=!0),this.refs.set(K,Y),l&&(this.refCounts[K]=(this.refCounts[K]||0)+1)},K.prototype.removeRef=function(K){this.refCounts[K]=this.refCounts[K]-1,this.deletedRefs.add(K)},K.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},K.prototype.garbageCollectDeletedRefs=function(){var K=this;this.deletedRefs.forEach((function(Y){if(!(K.refCounts[Y]>0)){var l=K.refs.get(Y);if(l instanceof GK)for(var v in l._definition.schema)"string"!==typeof l._definition.schema[v]&&l[v]&&l[v].$changes&&K.removeRef(l[v].$changes.refId);else{var U=l.$changes.parent._definition,d=U.schema[U.fieldsByIndex[l.$changes.parentIndex]];"function"===typeof Object.values(d)[0]&&Array.from(l.values()).forEach((function(Y){return K.removeRef(Y.$changes.refId)}))}K.refs.delete(Y),delete K.refCounts[Y]}})),this.deletedRefs.clear()},K}(),eK=function(K){function Y(){return null!==K&&K.apply(this,arguments)||this}return l(Y,K),Y}(Error);function iK(K,Y,l,v){var U,d=!1;switch(Y){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":U="number",isNaN(K)&&console.log('trying to encode "NaN" in '.concat(l.constructor.name,"#").concat(v));break;case"string":U="string",d=!0;break;case"boolean":return}if(typeof K!==U&&(!d||d&&null!==K)){var A="'".concat(JSON.stringify(K),"'").concat(K&&K.constructor&&" (".concat(K.constructor.name,")")||"");throw new eK("a '".concat(U,"' was expected, but ").concat(A," was provided in ").concat(l.constructor.name,"#").concat(v))}}function DK(K,Y,l,v){if(!(K instanceof Y))throw new eK("a '".concat(Y.name,"' was expected, but '").concat(K.constructor.name,"' was provided in ").concat(l.constructor.name,"#").concat(v))}function BK(K,Y,l,v,U){iK(l,K,v,U);var d=q[K];if(!d)throw new eK("a '".concat(K,"' was expected, but ").concat(l," was provided in ").concat(v.constructor.name,"#").concat(U));d(Y,l)}function PK(K,Y,l){return zK[K](Y,l)}var GK=function(){function Y(){for(var K=[],Y=0;Y<arguments.length;Y++)K[Y]=arguments[Y];Object.defineProperties(this,{$changes:{value:new t(this,void 0,new TK),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var l=this._definition.descriptors;l&&Object.defineProperties(this,l),K[0]&&this.assign(K[0])}return Y.onError=function(K){console.error(K)},Y.is=function(K){return K._definition&&void 0!==K._definition.schema},Y.prototype.onChange=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,Y)},Y.prototype.kh=function(Y){return Z(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,Y)},Y.prototype.assign=function(K){return Object.assign(this,K),this},Object.defineProperty(Y.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Y.prototype.setDirty=function(K,Y){this.$changes.change(K,Y)},Y.prototype.listen=function(K,Y,l){var v=this;return void 0===l&&(l=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[K]||(this.$callbacks[K]=[]),this.$callbacks[K].push(Y),l&&void 0!==this[K]&&Y(this[K],void 0),function(){return V(v.$callbacks[K],v.$callbacks[K].indexOf(Y))}},Y.prototype.decode=function(l,v,U){var d;void 0===v&&(v={offset:0}),void 0===U&&(U=this);var c=[],t=this.$changes.root,Z=l.length,m=0;for(t.refs.set(m,this);v.offset<Z;){var V=l[v.offset++];if(V!=A){var M=U.$changes,u=void 0!==U._definition,W=u?V>>6<<6:V;if(W!==K.OPERATION.CLEAR){var J=u?V%(W||255):JK(l,v),n=u?U._definition.fieldsByIndex[J]:"",H=M.getType(J),z=void 0,r=void 0,E=void 0;if(u?r=U["_".concat(n)]:(r=U.getByIndex(J),(W&K.OPERATION.ADD)===K.OPERATION.ADD?(E=U instanceof g?WK(l,v):J,U.setIndex(J,E)):E=U.getIndex(J)),(W&K.OPERATION.DELETE)===K.OPERATION.DELETE&&(W!==K.OPERATION.DELETE_AND_ADD&&U.deleteByIndex(J),r&&r.$changes&&t.removeRef(r.$changes.refId),z=null),void 0!==n){if(W===K.OPERATION.DELETE);else if(Y.is(H)){var y=JK(l,v);if(z=t.refs.get(y),W!==K.OPERATION.REPLACE){var T=this.getSchemaType(l,v,H);z||((z=this.createTypeInstance(T)).$changes.refId=y,r&&(z.$callbacks=r.$callbacks,r.$changes.refId&&y!==r.$changes.refId&&t.removeRef(r.$changes.refId))),t.addRef(y,z,z!==r)}}else if("string"===typeof H)z=PK(H,l,v);else{var e=R(Object.keys(H)[0]),i=JK(l,v),D=t.refs.has(i)?r||t.refs.get(i):new e.constructor;if((z=D.clone(!0)).$changes.refId=i,r&&(z.$callbacks=r.$callbacks,r.$changes.refId&&i!==r.$changes.refId)){t.removeRef(r.$changes.refId);for(var B=r.entries(),P=void 0;(P=B.next())&&!P.done;){var G=(d=P.value)[0],Q=d[1];c.push({refId:i,op:K.OPERATION.DELETE,field:G,value:void 0,previousValue:Q})}}t.addRef(i,z,D!==r)}if(null!==z&&void 0!==z)if(z.$changes&&z.$changes.setParent(M.ref,M.root,J),U instanceof Y)U[n]=z;else if(U instanceof g)G=E,U.$items.set(G,z),U.$changes.allChanges.add(J);else if(U instanceof o)U.setAt(J,z);else if(U instanceof rK){var X=U.add(z);U.setIndex(J,X)}else U instanceof EK&&!1!==(X=U.add(z))&&U.setIndex(J,X);r!==z&&c.push({refId:m,op:W,field:n,dynamicIndex:E,value:z,previousValue:r})}else{console.warn("@colyseus/schema: definition mismatch");for(var f={offset:v.offset};v.offset<Z&&(!HK(l,v)||(f.offset=v.offset+1,!t.refs.has(JK(l,f))));)v.offset++}}else U.clear(c)}else{m=JK(l,v);var w=t.refs.get(m);if(!w)throw new Error('"refId" not found: '.concat(m));U=w}}return this._triggerChanges(c),t.garbageCollectDeletedRefs(),c},Y.prototype.encode=function(l,v,U){void 0===l&&(l=!1),void 0===v&&(v=[]),void 0===U&&(U=!1);for(var d=this.$changes,c=new WeakSet,t=[d],Z=1,m=0;m<Z;m++){var V=t[m],M=V.ref,u=M instanceof Y;V.ensureRefId(),c.add(V),V!==d&&(V.changed||l)&&(Q(v,A),S(v,V.refId));for(var o=l?Array.from(V.allChanges):Array.from(V.changes.values()),W=0,J=o.length;W<J;W++){var n=l?{op:K.OPERATION.ADD,index:o[W]}:o[W],H=n.index,z=u?M._definition.fieldsByIndex&&M._definition.fieldsByIndex[H]:H,r=v.length;if(n.op!==K.OPERATION.TOUCH)if(u)Q(v,H|n.op);else{if(Q(v,n.op),n.op===K.OPERATION.CLEAR)continue;S(v,H)}if(u||(n.op&K.OPERATION.ADD)!=K.OPERATION.ADD||M instanceof g&&p(v,V.ref.$indexes.get(H)),n.op!==K.OPERATION.DELETE){var E=V.getType(H),y=V.getValue(H);if(y&&y.$changes&&!c.has(y.$changes)&&(t.push(y.$changes),y.$changes.ensureRefId(),Z++),n.op!==K.OPERATION.TOUCH){if(Y.is(E))DK(y,E,M,z),S(v,y.$changes.refId),(n.op&K.OPERATION.ADD)===K.OPERATION.ADD&&this.tryEncodeTypeId(v,E,y.constructor);else if("string"===typeof E)BK(E,v,y,M,z);else{var T=R(Object.keys(E)[0]);DK(M["_".concat(z)],T.constructor,M,z),S(v,y.$changes.refId)}U&&V.cache(H,v.slice(r))}}}l||U||V.discard()}return v},Y.prototype.encodeAll=function(K){return this.encode(!0,[],K)},Y.prototype.applyFilters=function(l,v){var U,d;void 0===v&&(v=!1);for(var c=this,t=new Set,Z=yK.get(l),m=[this.$changes],V=1,M=[],u=function(u){var o=m[u];if(t.has(o.refId))return"continue";var W=o.ref,J=W instanceof Y;Q(M,A),S(M,o.refId);var n=Z.refIds.has(o),R=v||!n;Z.addRefId(o);var H=Z.containerIndexes.get(o),z=R?Array.from(o.allChanges):Array.from(o.changes.values());!v&&J&&W._definition.indexesWithFilters&&W._definition.indexesWithFilters.forEach((function(Y){!H.has(Y)&&o.allChanges.has(Y)&&(R?z.push(Y):z.push({op:K.OPERATION.ADD,index:Y}))}));for(var r=0,E=z.length;r<E;r++){var y=R?{op:K.OPERATION.ADD,index:z[r]}:z[r];if(y.op!==K.OPERATION.CLEAR){var T=y.index;if(y.op!==K.OPERATION.DELETE){var e=o.getValue(T),i=o.getType(T);if(J){if((D=W._definition.filters&&W._definition.filters[T])&&!D.call(W,l,e,c)){e&&e.$changes&&t.add(e.$changes.refId);continue}}else{var D,B=o.parent;if((D=o.getChildrenFilter())&&!D.call(B,l,W.$indexes.get(T),e,c)){e&&e.$changes&&t.add(e.$changes.refId);continue}}if(e.$changes&&(m.push(e.$changes),V++),y.op!==K.OPERATION.TOUCH)if(y.op===K.OPERATION.ADD||J)M.push.apply(M,null!==(U=o.caches[T])&&void 0!==U?U:[]),H.add(T);else if(H.has(T))M.push.apply(M,null!==(d=o.caches[T])&&void 0!==d?d:[]);else{if(H.add(T),Q(M,K.OPERATION.ADD),S(M,T),W instanceof g){var P=o.ref.$indexes.get(T);p(M,P)}e.$changes?S(M,e.$changes.refId):q[i](M,e)}else e.$changes&&!J&&(Q(M,K.OPERATION.ADD),S(M,T),W instanceof g&&(P=o.ref.$indexes.get(T),p(M,P)),S(M,e.$changes.refId))}else J?Q(M,y.op|T):(Q(M,y.op),S(M,T))}else Q(M,y.op)}},o=0;o<V;o++)u(o);return M},Y.prototype.clone=function(){var K,Y=new this.constructor,l=this._definition.schema;for(var v in l)"object"===typeof this[v]&&"function"===typeof(null===(K=this[v])||void 0===K?void 0:K.clone)?Y[v]=this[v].clone():Y[v]=this[v];return Y},Y.prototype.toJSON=function(){var K=this._definition.schema,Y=this._definition.deprecated,l={};for(var v in K)Y[v]||null===this[v]||"undefined"===typeof this[v]||(l[v]="function"===typeof this[v].toJSON?this[v].toJSON():this["_".concat(v)]);return l},Y.prototype.discardAllChanges=function(){this.$changes.discardAll()},Y.prototype.getByIndex=function(K){return this[this._definition.fieldsByIndex[K]]},Y.prototype.deleteByIndex=function(K){this[this._definition.fieldsByIndex[K]]=void 0},Y.prototype.tryEncodeTypeId=function(K,Y,l){Y._typeid!==l._typeid&&(Q(K,c),S(K,l._typeid))},Y.prototype.getSchemaType=function(K,Y,l){var v;return K[Y.offset]===c&&(Y.offset++,v=this.constructor._context.get(JK(K,Y))),v||l},Y.prototype.createTypeInstance=function(K){var Y=new K;return Y.$changes.root=this.$changes.root,Y},Y.prototype._triggerChanges=function(l){for(var v,U,d,A,c,t,Z,m,V,M=new Set,u=this.$changes.root.refs,o=function(o){var W=l[o],g=W.refId,J=u.get(g),n=J.$callbacks;if((W.op&K.OPERATION.DELETE)===K.OPERATION.DELETE&&W.previousValue instanceof Y&&(null===(U=null===(v=W.previousValue.$callbacks)||void 0===v?void 0:v[K.OPERATION.DELETE])||void 0===U||U.forEach((function(K){return K()}))),!n)return"continue";if(J instanceof Y){if(!M.has(g))try{null===(d=null===n||void 0===n?void 0:n[K.OPERATION.REPLACE])||void 0===d||d.forEach((function(K){return K()}))}catch(R){Y.onError(R)}try{n.hasOwnProperty(W.field)&&(null===(A=n[W.field])||void 0===A||A.forEach((function(K){return K(W.value,W.previousValue)})))}catch(R){Y.onError(R)}}else W.op===K.OPERATION.ADD&&void 0===W.previousValue?null===(c=n[K.OPERATION.ADD])||void 0===c||c.forEach((function(K){var Y;return K(W.value,null!==(Y=W.dynamicIndex)&&void 0!==Y?Y:W.field)})):W.op===K.OPERATION.DELETE?void 0!==W.previousValue&&(null===(t=n[K.OPERATION.DELETE])||void 0===t||t.forEach((function(K){var Y;return K(W.previousValue,null!==(Y=W.dynamicIndex)&&void 0!==Y?Y:W.field)}))):W.op===K.OPERATION.DELETE_AND_ADD&&(void 0!==W.previousValue&&(null===(Z=n[K.OPERATION.DELETE])||void 0===Z||Z.forEach((function(K){var Y;return K(W.previousValue,null!==(Y=W.dynamicIndex)&&void 0!==Y?Y:W.field)}))),null===(m=n[K.OPERATION.ADD])||void 0===m||m.forEach((function(K){var Y;return K(W.value,null!==(Y=W.dynamicIndex)&&void 0!==Y?Y:W.field)}))),W.value!==W.previousValue&&(null===(V=n[K.OPERATION.REPLACE])||void 0===V||V.forEach((function(K){var Y;return K(W.value,null!==(Y=W.dynamicIndex)&&void 0!==Y?Y:W.field)})));M.add(g)},W=0;W<l.length;W++)o(W)},Y._definition=H.create(),Y}();function QK(K){for(var Y=[K.$changes],l=1,v={},U=v,d=function(K){var l=Y[K];l.changes.forEach((function(K){var Y=l.ref,v=K.index,d=Y._definition?Y._definition.fieldsByIndex[v]:Y.$indexes.get(v);U[d]=l.getValue(v)}))},A=0;A<l;A++)d(A);return v}var XK={context:new r},fK=function(K){function Y(){return null!==K&&K.apply(this,arguments)||this}return l(Y,K),v([y("string",XK)],Y.prototype,"name",void 0),v([y("string",XK)],Y.prototype,"type",void 0),v([y("number",XK)],Y.prototype,"referencedType",void 0),Y}(GK),wK=function(K){function Y(){var Y=null!==K&&K.apply(this,arguments)||this;return Y.fields=new o,Y}return l(Y,K),v([y("number",XK)],Y.prototype,"id",void 0),v([y([fK],XK)],Y.prototype,"fields",void 0),Y}(GK),kK=function(K){function Y(){var Y=null!==K&&K.apply(this,arguments)||this;return Y.types=new o,Y}return l(Y,K),Y.encode=function(K){var l=K.constructor,v=new Y;v.rootType=l._typeid;var U=function(K,Y){for(var l in Y){var U=new fK;U.name=l;var d=void 0;if("string"===typeof Y[l])d=Y[l];else{var A=Y[l],c=void 0;GK.is(A)?(d="ref",c=Y[l]):"string"===typeof A[d=Object.keys(A)[0]]?d+=":"+A[d]:c=A[d],U.referencedType=c?c._typeid:-1}U.type=d,K.fields.push(U)}v.types.push(K)},d=l._context.types;for(var A in d){var c=new wK;c.id=Number(A),U(c,d[A]._definition.schema)}return v.encodeAll()},Y.decode=function(K,v){var U=new r,d=new Y;d.decode(K,v);var A=d.types.reduce((function(K,Y){var v=function(K){function Y(){return null!==K&&K.apply(this,arguments)||this}return l(Y,K),Y}(GK),d=Y.id;return K[d]=v,U.add(v,d),K}),{});d.types.forEach((function(K){var Y=A[K.id];K.fields.forEach((function(K){var l;if(void 0!==K.referencedType){var v=K.type,d=A[K.referencedType];if(!d){var c=K.type.split(":");v=c[0],d=c[1]}"ref"===v?y(d,{context:U})(Y.prototype,K.name):y(((l={})[v]=d,l),{context:U})(Y.prototype,K.name)}else y(K.type,{context:U})(Y.prototype,K.name)}))}));var c=A[d.rootType],t=new c;for(var Z in c._definition.schema){var m=c._definition.schema[Z];"string"!==typeof m&&(t[Z]="function"===typeof m?new m:new(R(Object.keys(m)[0]).constructor))}return t},v([y([wK],XK)],Y.prototype,"types",void 0),v([y("number",XK)],Y.prototype,"rootType",void 0),Y}(GK);n("map",{constructor:g}),n("array",{constructor:o}),n("set",{constructor:EK}),n("collection",{constructor:rK}),K.ArraySchema=o,K.CollectionSchema=rK,K.Context=r,K.MapSchema=g,K.Reflection=kK,K.ReflectionField=fK,K.ReflectionType=wK,K.Schema=GK,K.SchemaDefinition=H,K.SetSchema=EK,K.decode=zK,K.defineTypes=D,K.deprecated=i,K.dumpChanges=QK,K.encode=q,K.filter=T,K.filterChildren=e,K.hasFilter=z,K.registerType=n,K.type=y,Object.defineProperty(K,"__esModule",{value:!0})}(Y)},12634:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12630:(K,Y,l)=>{var v=l(12634),U=l(12638),d=Object.hasOwnProperty,A=Object.create(null);for(var c in v)d.call(v,c)&&(A[v[c]]=c);var t=K.exports={to:{},get:{}};function Z(K,Y,l){return Math.min(Math.max(Y,K),l)}function m(K){var Y=Math.round(K).toString(16).toUpperCase();return Y.length<2?"0"+Y:Y}t.get=function(K){var Y,l;switch(K.substring(0,3).toLowerCase()){case"hsl":Y=t.get.hsl(K),l="hsl";break;case"hwb":Y=t.get.hwb(K),l="hwb";break;default:Y=t.get.rgb(K),l="rgb"}return Y?{model:l,value:Y}:null},t.get.rgb=function(K){if(!K)return null;var Y,l,U,A=[0,0,0,1];if(Y=K.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(U=Y[2],Y=Y[1],l=0;l<3;l++){var c=2*l;A[l]=parseInt(Y.slice(c,c+2),16)}U&&(A[3]=parseInt(U,16)/255)}else if(Y=K.match(/^#([a-f0-9]{3,4})$/i)){for(U=(Y=Y[1])[3],l=0;l<3;l++)A[l]=parseInt(Y[l]+Y[l],16);U&&(A[3]=parseInt(U+U,16)/255)}else if(Y=K.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(l=0;l<3;l++)A[l]=parseInt(Y[l+1],0);Y[4]&&(Y[5]?A[3]=.01*parseFloat(Y[4]):A[3]=parseFloat(Y[4]))}else{if(!(Y=K.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Y=K.match(/^(\w+)$/))?"transparent"===Y[1]?[0,0,0,0]:d.call(v,Y[1])?((A=v[Y[1]])[3]=1,A):null:null;for(l=0;l<3;l++)A[l]=Math.round(2.55*parseFloat(Y[l+1]));Y[4]&&(Y[5]?A[3]=.01*parseFloat(Y[4]):A[3]=parseFloat(Y[4]))}for(l=0;l<3;l++)A[l]=Z(A[l],0,255);return A[3]=Z(A[3],0,1),A},t.get.hsl=function(K){if(!K)return null;var Y=K.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Y){var l=parseFloat(Y[4]);return[(parseFloat(Y[1])%360+360)%360,Z(parseFloat(Y[2]),0,100),Z(parseFloat(Y[3]),0,100),Z(isNaN(l)?1:l,0,1)]}return null},t.get.hwb=function(K){if(!K)return null;var Y=K.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Y){var l=parseFloat(Y[4]);return[(parseFloat(Y[1])%360+360)%360,Z(parseFloat(Y[2]),0,100),Z(parseFloat(Y[3]),0,100),Z(isNaN(l)?1:l,0,1)]}return null},t.to.hex=function(){var K=U(arguments);return"#"+m(K[0])+m(K[1])+m(K[2])+(K[3]<1?m(Math.round(255*K[3])):"")},t.to.rgb=function(){var K=U(arguments);return K.length<4||1===K[3]?"rgb("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+")":"rgba("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+", "+K[3]+")"},t.to.rgb.percent=function(){var K=U(arguments),Y=Math.round(K[0]/255*100),l=Math.round(K[1]/255*100),v=Math.round(K[2]/255*100);return K.length<4||1===K[3]?"rgb("+Y+"%, "+l+"%, "+v+"%)":"rgba("+Y+"%, "+l+"%, "+v+"%, "+K[3]+")"},t.to.hsl=function(){var K=U(arguments);return K.length<4||1===K[3]?"hsl("+K[0]+", "+K[1]+"%, "+K[2]+"%)":"hsla("+K[0]+", "+K[1]+"%, "+K[2]+"%, "+K[3]+")"},t.to.hwb=function(){var K=U(arguments),Y="";return K.length>=4&&1!==K[3]&&(Y=", "+K[3]),"hwb("+K[0]+", "+K[1]+"%, "+K[2]+"%"+Y+")"},t.to.keyword=function(K){return A[K.slice(0,3)]}},12623:(K,Y,l)=>{const v=l(12630),U=l(12648),d=["keyword","gray","hex"],A={};for(const u of Object.keys(U))A[[...U[u].labels].sort().join("")]=u;const c={};function t(K,Y){if(!(this instanceof t))return new t(K,Y);if(Y&&Y in d&&(Y=null),Y&&!(Y in U))throw new Error("Unknown model: "+Y);let l,Z;if(null==K)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(K instanceof t)this.model=K.model,this.color=[...K.color],this.valpha=K.valpha;else if("string"===typeof K){const Y=v.get(K);if(null===Y)throw new Error("Unable to parse color from string: "+K);this.model=Y.model,Z=U[this.model].channels,this.color=Y.value.slice(0,Z),this.valpha="number"===typeof Y.value[Z]?Y.value[Z]:1}else if(K.length>0){this.model=Y||"rgb",Z=U[this.model].channels;const l=Array.prototype.slice.call(K,0,Z);this.color=M(l,Z),this.valpha="number"===typeof K[Z]?K[Z]:1}else if("number"===typeof K)this.model="rgb",this.color=[K>>16&255,K>>8&255,255&K],this.valpha=1;else{this.valpha=1;const Y=Object.keys(K);"alpha"in K&&(Y.splice(Y.indexOf("alpha"),1),this.valpha="number"===typeof K.alpha?K.alpha:0);const v=Y.sort().join("");if(!(v in A))throw new Error("Unable to parse color from object: "+JSON.stringify(K));this.model=A[v];const{labels:d}=U[this.model],c=[];for(l=0;l<d.length;l++)c.push(K[d[l]]);this.color=M(c)}if(c[this.model])for(Z=U[this.model].channels,l=0;l<Z;l++){const K=c[this.model][l];K&&(this.color[l]=K(this.color[l]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}t.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(K){let Y=this.model in v.to?this:this.rgb();Y=Y.round("number"===typeof K?K:1);const l=1===Y.valpha?Y.color:[...Y.color,this.valpha];return v.to[Y.model](l)},percentString(K){const Y=this.rgb().round("number"===typeof K?K:1),l=1===Y.valpha?Y.color:[...Y.color,this.valpha];return v.to.rgb.percent(l)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const K={},{channels:Y}=U[this.model],{labels:l}=U[this.model];for(let v=0;v<Y;v++)K[l[v]]=this.color[v];return 1!==this.valpha&&(K.alpha=this.valpha),K},unitArray(){const K=this.rgb().color;return K[0]/=255,K[1]/=255,K[2]/=255,1!==this.valpha&&K.push(this.valpha),K},unitObject(){const K=this.rgb().object();return K.r/=255,K.g/=255,K.b/=255,1!==this.valpha&&(K.alpha=this.valpha),K},round(K){return K=Math.max(K||0,0),new t([...this.color.map(Z(K)),this.valpha],this.model)},alpha(K){return void 0!==K?new t([...this.color,Math.max(0,Math.min(1,K))],this.model):this.valpha},red:m("rgb",0,V(255)),green:m("rgb",1,V(255)),blue:m("rgb",2,V(255)),hue:m(["hsl","hsv","hsl","hwb","hcg"],0,(K=>(K%360+360)%360)),saturationl:m("hsl",1,V(100)),lightness:m("hsl",2,V(100)),saturationv:m("hsv",1,V(100)),value:m("hsv",2,V(100)),chroma:m("hcg",1,V(100)),gray:m("hcg",2,V(100)),white:m("hwb",1,V(100)),wblack:m("hwb",2,V(100)),cyan:m("cmyk",0,V(100)),magenta:m("cmyk",1,V(100)),yellow:m("cmyk",2,V(100)),black:m("cmyk",3,V(100)),x:m("xyz",0,V(95.047)),y:m("xyz",1,V(100)),z:m("xyz",2,V(108.833)),l:m("lab",0,V(100)),a:m("lab",1),b:m("lab",2),keyword(K){return void 0!==K?new t(K):U[this.model].keyword(this.color)},hex(K){return void 0!==K?new t(K):v.to.hex(this.rgb().round().color)},hexa(K){if(void 0!==K)return new t(K);const Y=this.rgb().round().color;let l=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===l.length&&(l="0"+l),v.to.hex(Y)+l},rgbNumber(){const K=this.rgb().color;return(255&K[0])<<16|(255&K[1])<<8|255&K[2]},luminosity(){const K=this.rgb().color,Y=[];for(const[l,v]of K.entries()){const K=v/255;Y[l]=K<=.04045?K/12.92:((K+.055)/1.055)**2.4}return.2126*Y[0]+.7152*Y[1]+.0722*Y[2]},contrast(K){const Y=this.luminosity(),l=K.luminosity();return Y>l?(Y+.05)/(l+.05):(l+.05)/(Y+.05)},level(K){const Y=this.contrast(K);return Y>=7?"AAA":Y>=4.5?"AA":""},isDark(){const K=this.rgb().color;return(2126*K[0]+7152*K[1]+722*K[2])/1e4<128},isLight(){return!this.isDark()},negate(){const K=this.rgb();for(let Y=0;Y<3;Y++)K.color[Y]=255-K.color[Y];return K},lighten(K){const Y=this.hsl();return Y.color[2]+=Y.color[2]*K,Y},darken(K){const Y=this.hsl();return Y.color[2]-=Y.color[2]*K,Y},saturate(K){const Y=this.hsl();return Y.color[1]+=Y.color[1]*K,Y},desaturate(K){const Y=this.hsl();return Y.color[1]-=Y.color[1]*K,Y},whiten(K){const Y=this.hwb();return Y.color[1]+=Y.color[1]*K,Y},blacken(K){const Y=this.hwb();return Y.color[2]+=Y.color[2]*K,Y},grayscale(){const K=this.rgb().color,Y=.3*K[0]+.59*K[1]+.11*K[2];return t.rgb(Y,Y,Y)},fade(K){return this.alpha(this.valpha-this.valpha*K)},opaquer(K){return this.alpha(this.valpha+this.valpha*K)},rotate(K){const Y=this.hsl();let l=Y.color[0];return l=(l+K)%360,l=l<0?360+l:l,Y.color[0]=l,Y},mix(K,Y){if(!K||!K.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof K);const l=K.rgb(),v=this.rgb(),U=void 0===Y?.5:Y,d=2*U-1,A=l.alpha()-v.alpha(),c=((d*A===-1?d:(d+A)/(1+d*A))+1)/2,Z=1-c;return t.rgb(c*l.red()+Z*v.red(),c*l.green()+Z*v.green(),c*l.blue()+Z*v.blue(),l.alpha()*U+v.alpha()*(1-U))}};for(const u of Object.keys(U)){if(d.includes(u))continue;const{channels:K}=U[u];t.prototype[u]=function(){if(this.model===u)return new t(this);for(var K=arguments.length,Y=new Array(K),l=0;l<K;l++)Y[l]=arguments[l];return Y.length>0?new t(Y,u):new t([...(v=U[this.model][u].raw(this.color),Array.isArray(v)?v:[v]),this.valpha],u);var v},t[u]=function(){for(var Y=arguments.length,l=new Array(Y),v=0;v<Y;v++)l[v]=arguments[v];let U=l[0];return"number"===typeof U&&(U=M(l,K)),new t(U,u)}}function Z(K){return function(Y){return function(K,Y){return Number(K.toFixed(Y))}(Y,K)}}function m(K,Y,l){K=Array.isArray(K)?K:[K];for(const v of K)(c[v]||(c[v]=[]))[Y]=l;return K=K[0],function(v){let U;return void 0!==v?(l&&(v=l(v)),U=this[K](),U.color[Y]=v,U):(U=this[K]().color[Y],l&&(U=l(U)),U)}}function V(K){return function(Y){return Math.max(0,Math.min(K,Y))}}function M(K,Y){for(let l=0;l<Y;l++)"number"!==typeof K[l]&&(K[l]=0);return K}K.exports=t},12653:(K,Y,l)=>{const v=l(12658),U={};for(const A of Object.keys(v))U[v[A]]=A;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};K.exports=d;for(const A of Object.keys(d)){if(!("channels"in d[A]))throw new Error("missing channels property: "+A);if(!("labels"in d[A]))throw new Error("missing channel labels property: "+A);if(d[A].labels.length!==d[A].channels)throw new Error("channel and label counts mismatch: "+A);const{channels:K,labels:Y}=d[A];delete d[A].channels,delete d[A].labels,Object.defineProperty(d[A],"channels",{value:K}),Object.defineProperty(d[A],"labels",{value:Y})}d.rgb.hsl=function(K){const Y=K[0]/255,l=K[1]/255,v=K[2]/255,U=Math.min(Y,l,v),d=Math.max(Y,l,v),A=d-U;let c,t;d===U?c=0:Y===d?c=(l-v)/A:l===d?c=2+(v-Y)/A:v===d&&(c=4+(Y-l)/A),c=Math.min(60*c,360),c<0&&(c+=360);const Z=(U+d)/2;return t=d===U?0:Z<=.5?A/(d+U):A/(2-d-U),[c,100*t,100*Z]},d.rgb.hsv=function(K){let Y,l,v,U,d;const A=K[0]/255,c=K[1]/255,t=K[2]/255,Z=Math.max(A,c,t),m=Z-Math.min(A,c,t),V=function(K){return(Z-K)/6/m+.5};return 0===m?(U=0,d=0):(d=m/Z,Y=V(A),l=V(c),v=V(t),A===Z?U=v-l:c===Z?U=1/3+Y-v:t===Z&&(U=2/3+l-Y),U<0?U+=1:U>1&&(U-=1)),[360*U,100*d,100*Z]},d.rgb.hwb=function(K){const Y=K[0],l=K[1];let v=K[2];const U=d.rgb.hsl(K)[0],A=1/255*Math.min(Y,Math.min(l,v));return v=1-1/255*Math.max(Y,Math.max(l,v)),[U,100*A,100*v]},d.rgb.cmyk=function(K){const Y=K[0]/255,l=K[1]/255,v=K[2]/255,U=Math.min(1-Y,1-l,1-v);return[100*((1-Y-U)/(1-U)||0),100*((1-l-U)/(1-U)||0),100*((1-v-U)/(1-U)||0),100*U]},d.rgb.keyword=function(K){const Y=U[K];if(Y)return Y;let l,d=1/0;for(const U of Object.keys(v)){const Y=v[U],t=(c=Y,((A=K)[0]-c[0])**2+(A[1]-c[1])**2+(A[2]-c[2])**2);t<d&&(d=t,l=U)}var A,c;return l},d.keyword.rgb=function(K){return v[K]},d.rgb.xyz=function(K){let Y=K[0]/255,l=K[1]/255,v=K[2]/255;Y=Y>.04045?((Y+.055)/1.055)**2.4:Y/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,v=v>.04045?((v+.055)/1.055)**2.4:v/12.92;return[100*(.4124*Y+.3576*l+.1805*v),100*(.2126*Y+.7152*l+.0722*v),100*(.0193*Y+.1192*l+.9505*v)]},d.rgb.lab=function(K){const Y=d.rgb.xyz(K);let l=Y[0],v=Y[1],U=Y[2];l/=95.047,v/=100,U/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,v=v>.008856?v**(1/3):7.787*v+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*v-16,500*(l-v),200*(v-U)]},d.hsl.rgb=function(K){const Y=K[0]/360,l=K[1]/100,v=K[2]/100;let U,d,A;if(0===l)return A=255*v,[A,A,A];U=v<.5?v*(1+l):v+l-v*l;const c=2*v-U,t=[0,0,0];for(let Z=0;Z<3;Z++)d=Y+1/3*-(Z-1),d<0&&d++,d>1&&d--,A=6*d<1?c+6*(U-c)*d:2*d<1?U:3*d<2?c+(U-c)*(2/3-d)*6:c,t[Z]=255*A;return t},d.hsl.hsv=function(K){const Y=K[0];let l=K[1]/100,v=K[2]/100,U=l;const d=Math.max(v,.01);v*=2,l*=v<=1?v:2-v,U*=d<=1?d:2-d;return[Y,100*(0===v?2*U/(d+U):2*l/(v+l)),100*((v+l)/2)]},d.hsv.rgb=function(K){const Y=K[0]/60,l=K[1]/100;let v=K[2]/100;const U=Math.floor(Y)%6,d=Y-Math.floor(Y),A=255*v*(1-l),c=255*v*(1-l*d),t=255*v*(1-l*(1-d));switch(v*=255,U){case 0:return[v,t,A];case 1:return[c,v,A];case 2:return[A,v,t];case 3:return[A,c,v];case 4:return[t,A,v];case 5:return[v,A,c]}},d.hsv.hsl=function(K){const Y=K[0],l=K[1]/100,v=K[2]/100,U=Math.max(v,.01);let d,A;A=(2-l)*v;const c=(2-l)*U;return d=l*U,d/=c<=1?c:2-c,d=d||0,A/=2,[Y,100*d,100*A]},d.hwb.rgb=function(K){const Y=K[0]/360;let l=K[1]/100,v=K[2]/100;const U=l+v;let d;U>1&&(l/=U,v/=U);const A=Math.floor(6*Y),c=1-v;d=6*Y-A,0!==(1&A)&&(d=1-d);const t=l+d*(c-l);let Z,m,V;switch(A){default:case 6:case 0:Z=c,m=t,V=l;break;case 1:Z=t,m=c,V=l;break;case 2:Z=l,m=c,V=t;break;case 3:Z=l,m=t,V=c;break;case 4:Z=t,m=l,V=c;break;case 5:Z=c,m=l,V=t}return[255*Z,255*m,255*V]},d.cmyk.rgb=function(K){const Y=K[0]/100,l=K[1]/100,v=K[2]/100,U=K[3]/100;return[255*(1-Math.min(1,Y*(1-U)+U)),255*(1-Math.min(1,l*(1-U)+U)),255*(1-Math.min(1,v*(1-U)+U))]},d.xyz.rgb=function(K){const Y=K[0]/100,l=K[1]/100,v=K[2]/100;let U,d,A;return U=3.2406*Y+-1.5372*l+-.4986*v,d=-.9689*Y+1.8758*l+.0415*v,A=.0557*Y+-.204*l+1.057*v,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,U=Math.min(Math.max(0,U),1),d=Math.min(Math.max(0,d),1),A=Math.min(Math.max(0,A),1),[255*U,255*d,255*A]},d.xyz.lab=function(K){let Y=K[0],l=K[1],v=K[2];Y/=95.047,l/=100,v/=108.883,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,v=v>.008856?v**(1/3):7.787*v+16/116;return[116*l-16,500*(Y-l),200*(l-v)]},d.lab.xyz=function(K){let Y,l,v;l=(K[0]+16)/116,Y=K[1]/500+l,v=l-K[2]/200;const U=l**3,d=Y**3,A=v**3;return l=U>.008856?U:(l-16/116)/7.787,Y=d>.008856?d:(Y-16/116)/7.787,v=A>.008856?A:(v-16/116)/7.787,Y*=95.047,l*=100,v*=108.883,[Y,l,v]},d.lab.lch=function(K){const Y=K[0],l=K[1],v=K[2];let U;U=360*Math.atan2(v,l)/2/Math.PI,U<0&&(U+=360);return[Y,Math.sqrt(l*l+v*v),U]},d.lch.lab=function(K){const Y=K[0],l=K[1],v=K[2]/360*2*Math.PI;return[Y,l*Math.cos(v),l*Math.sin(v)]},d.rgb.ansi16=function(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[l,v,U]=K;let A=null===Y?d.rgb.hsv(K)[2]:Y;if(A=Math.round(A/50),0===A)return 30;let c=30+(Math.round(U/255)<<2|Math.round(v/255)<<1|Math.round(l/255));return 2===A&&(c+=60),c},d.hsv.ansi16=function(K){return d.rgb.ansi16(d.hsv.rgb(K),K[2])},d.rgb.ansi256=function(K){const Y=K[0],l=K[1],v=K[2];if(Y===l&&l===v)return Y<8?16:Y>248?231:Math.round((Y-8)/247*24)+232;return 16+36*Math.round(Y/255*5)+6*Math.round(l/255*5)+Math.round(v/255*5)},d.ansi16.rgb=function(K){let Y=K%10;if(0===Y||7===Y)return K>50&&(Y+=3.5),Y=Y/10.5*255,[Y,Y,Y];const l=.5*(1+~~(K>50));return[(1&Y)*l*255,(Y>>1&1)*l*255,(Y>>2&1)*l*255]},d.ansi256.rgb=function(K){if(K>=232){const Y=10*(K-232)+8;return[Y,Y,Y]}let Y;K-=16;return[Math.floor(K/36)/5*255,Math.floor((Y=K%36)/6)/5*255,Y%6/5*255]},d.rgb.hex=function(K){const Y=(((255&Math.round(K[0]))<<16)+((255&Math.round(K[1]))<<8)+(255&Math.round(K[2]))).toString(16).toUpperCase();return"000000".substring(Y.length)+Y},d.hex.rgb=function(K){const Y=K.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Y)return[0,0,0];let l=Y[0];3===Y[0].length&&(l=l.split("").map((K=>K+K)).join(""));const v=parseInt(l,16);return[v>>16&255,v>>8&255,255&v]},d.rgb.hcg=function(K){const Y=K[0]/255,l=K[1]/255,v=K[2]/255,U=Math.max(Math.max(Y,l),v),d=Math.min(Math.min(Y,l),v),A=U-d;let c,t;return c=A<1?d/(1-A):0,t=A<=0?0:U===Y?(l-v)/A%6:U===l?2+(v-Y)/A:4+(Y-l)/A,t/=6,t%=1,[360*t,100*A,100*c]},d.hsl.hcg=function(K){const Y=K[1]/100,l=K[2]/100,v=l<.5?2*Y*l:2*Y*(1-l);let U=0;return v<1&&(U=(l-.5*v)/(1-v)),[K[0],100*v,100*U]},d.hsv.hcg=function(K){const Y=K[1]/100,l=K[2]/100,v=Y*l;let U=0;return v<1&&(U=(l-v)/(1-v)),[K[0],100*v,100*U]},d.hcg.rgb=function(K){const Y=K[0]/360,l=K[1]/100,v=K[2]/100;if(0===l)return[255*v,255*v,255*v];const U=[0,0,0],d=Y%1*6,A=d%1,c=1-A;let t=0;switch(Math.floor(d)){case 0:U[0]=1,U[1]=A,U[2]=0;break;case 1:U[0]=c,U[1]=1,U[2]=0;break;case 2:U[0]=0,U[1]=1,U[2]=A;break;case 3:U[0]=0,U[1]=c,U[2]=1;break;case 4:U[0]=A,U[1]=0,U[2]=1;break;default:U[0]=1,U[1]=0,U[2]=c}return t=(1-l)*v,[255*(l*U[0]+t),255*(l*U[1]+t),255*(l*U[2]+t)]},d.hcg.hsv=function(K){const Y=K[1]/100,l=Y+K[2]/100*(1-Y);let v=0;return l>0&&(v=Y/l),[K[0],100*v,100*l]},d.hcg.hsl=function(K){const Y=K[1]/100,l=K[2]/100*(1-Y)+.5*Y;let v=0;return l>0&&l<.5?v=Y/(2*l):l>=.5&&l<1&&(v=Y/(2*(1-l))),[K[0],100*v,100*l]},d.hcg.hwb=function(K){const Y=K[1]/100,l=Y+K[2]/100*(1-Y);return[K[0],100*(l-Y),100*(1-l)]},d.hwb.hcg=function(K){const Y=K[1]/100,l=1-K[2]/100,v=l-Y;let U=0;return v<1&&(U=(l-v)/(1-v)),[K[0],100*v,100*U]},d.apple.rgb=function(K){return[K[0]/65535*255,K[1]/65535*255,K[2]/65535*255]},d.rgb.apple=function(K){return[K[0]/255*65535,K[1]/255*65535,K[2]/255*65535]},d.gray.rgb=function(K){return[K[0]/100*255,K[0]/100*255,K[0]/100*255]},d.gray.hsl=function(K){return[0,0,K[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(K){return[0,100,K[0]]},d.gray.cmyk=function(K){return[0,0,0,K[0]]},d.gray.lab=function(K){return[K[0],0,0]},d.gray.hex=function(K){const Y=255&Math.round(K[0]/100*255),l=((Y<<16)+(Y<<8)+Y).toString(16).toUpperCase();return"000000".substring(l.length)+l},d.rgb.gray=function(K){return[(K[0]+K[1]+K[2])/3/255*100]}},12648:(K,Y,l)=>{const v=l(12653),U=l(12665),d={};Object.keys(v).forEach((K=>{d[K]={},Object.defineProperty(d[K],"channels",{value:v[K].channels}),Object.defineProperty(d[K],"labels",{value:v[K].labels});const Y=U(K);Object.keys(Y).forEach((l=>{const v=Y[l];d[K][l]=function(K){const Y=function(){for(var Y=arguments.length,l=new Array(Y),v=0;v<Y;v++)l[v]=arguments[v];const U=l[0];if(void 0===U||null===U)return U;U.length>1&&(l=U);const d=K(l);if("object"===typeof d)for(let K=d.length,A=0;A<K;A++)d[A]=Math.round(d[A]);return d};return"conversion"in K&&(Y.conversion=K.conversion),Y}(v),d[K][l].raw=function(K){const Y=function(){for(var Y=arguments.length,l=new Array(Y),v=0;v<Y;v++)l[v]=arguments[v];const U=l[0];return void 0===U||null===U?U:(U.length>1&&(l=U),K(l))};return"conversion"in K&&(Y.conversion=K.conversion),Y}(v)}))})),K.exports=d},12665:(K,Y,l)=>{const v=l(12653);function U(K){const Y=function(){const K={},Y=Object.keys(v);for(let l=Y.length,v=0;v<l;v++)K[Y[v]]={distance:-1,parent:null};return K}(),l=[K];for(Y[K].distance=0;l.length;){const K=l.pop(),U=Object.keys(v[K]);for(let v=U.length,d=0;d<v;d++){const v=U[d],A=Y[v];-1===A.distance&&(A.distance=Y[K].distance+1,A.parent=K,l.unshift(v))}}return Y}function d(K,Y){return function(l){return Y(K(l))}}function A(K,Y){const l=[Y[K].parent,K];let U=v[Y[K].parent][K],A=Y[K].parent;for(;Y[A].parent;)l.unshift(Y[A].parent),U=d(v[Y[A].parent][A],U),A=Y[A].parent;return U.conversion=l,U}K.exports=function(K){const Y=U(K),l={},v=Object.keys(Y);for(let U=v.length,d=0;d<U;d++){const K=v[d];null!==Y[K].parent&&(l[K]=A(K,Y))}return l}},12658:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11657:function(K,Y,l){"use strict";var v=this&&this.__createBinding||(Object.create?function(K,Y,l,v){void 0===v&&(v=l);var U=Object.getOwnPropertyDescriptor(Y,l);U&&!("get"in U?!Y.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return Y[l]}}),Object.defineProperty(K,v,U)}:function(K,Y,l,v){void 0===v&&(v=l),K[v]=Y[l]}),U=this&&this.__setModuleDefault||(Object.create?function(K,Y){Object.defineProperty(K,"default",{enumerable:!0,value:Y})}:function(K,Y){K.default=Y}),d=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var Y={};if(null!=K)for(var l in K)"default"!==l&&Object.prototype.hasOwnProperty.call(K,l)&&v(Y,K,l);return U(Y,K),Y},A=this&&this.__awaiter||function(K,Y,l,v){return new(l||(l=Promise))((function(U,d){function A(K){try{t(v.next(K))}catch(Y){d(Y)}}function c(K){try{t(v.throw(K))}catch(Y){d(Y)}}function t(K){var Y;K.done?U(K.value):(Y=K.value,Y instanceof l?Y:new l((function(K){K(Y)}))).then(A,c)}t((v=v.apply(K,Y||[])).next())}))};Object.defineProperty(Y,"__esModule",{value:!0}),Y.Auth=Y.Platform=void 0;const c=d(l(11601)),t=l(11663),Z="colyseus-auth-token";!function(K){K.ios="ios",K.android="android"}(Y.Platform||(Y.Platform={}));Y.Auth=class{constructor(K){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=K.replace("ws","http"),(0,t.getItem)(Z,(K=>this.token=K))}get hasToken(){return!!this.token}login(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A(this,void 0,void 0,(function*(){const Y=Object.assign({},K);this.hasToken&&(Y.token=this.token);const l=yield this.request("post","/auth",Y);this.token=l.token,(0,t.setItem)(Z,this.token);for(let K in l)this.hasOwnProperty(K)&&(this[K]=l[K]);return this.registerPingService(),this}))}save(){return A(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return A(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(K){return A(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:K})}))}acceptFriendRequest(K){return A(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:K})}))}declineFriendRequest(K){return A(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:K})}))}blockUser(K){return A(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:K})}))}unblockUser(K){return A(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:K})}))}request(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return A(this,void 0,void 0,(function*(){U.Accept="application/json",this.hasToken&&(U.Authorization="Bearer "+this.token);const d=[];for(const K in l)d.push(`${K}=${l[K]}`);const A=d.length>0?`?${d.join("&")}`:"",t={headers:U};return v&&(t.body=v),(yield c[K](`${this.endpoint}${Y}${A}`,t)).data}))}logout(){this.token=void 0,(0,t.removeItem)(Z),this.unregisterPingService()}registerPingService(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),K)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11595:function(K,Y,l){"use strict";var v,U=this&&this.__awaiter||function(K,Y,l,v){return new(l||(l=Promise))((function(U,d){function A(K){try{t(v.next(K))}catch(Y){d(Y)}}function c(K){try{t(v.throw(K))}catch(Y){d(Y)}}function t(K){var Y;K.done?U(K.value):(Y=K.value,Y instanceof l?Y:new l((function(K){K(Y)}))).then(A,c)}t((v=v.apply(K,Y||[])).next())}))};Object.defineProperty(Y,"__esModule",{value:!0}),Y.Client=Y.MatchMakeError=void 0;const d=l(11601),A=l(11606),c=l(11611);class t extends Error{constructor(K,Y){super(K),this.code=Y,Object.setPrototypeOf(this,t.prototype)}}Y.MatchMakeError=t;const Z="undefined"!==typeof window&&"undefined"!==typeof(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Y.Client=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z;if("string"===typeof K){const Y=new URL(K),l="https:"===Y.protocol||"wss:"===Y.protocol,v=Number(Y.port||(l?443:80));this.settings={hostname:Y.hostname,pathname:"/"!==Y.pathname?Y.pathname:"",port:v,secure:l}}else void 0===K.port&&(K.port=K.secure?443:80),void 0===K.pathname&&(K.pathname=""),this.settings=K}joinOrCreate(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",K,Y,l)}))}create(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",K,Y,l)}))}join(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",K,Y,l)}))}joinById(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",K,Y,l)}))}reconnect(K,Y){return U(this,void 0,void 0,(function*(){if("string"===typeof K&&"string"===typeof Y)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[l,v]=K.split(":");return yield this.createMatchMakeRequest("reconnect",l,{reconnectionToken:v},Y)}))}getAvailableRooms(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return U(this,void 0,void 0,(function*(){return(yield(0,d.get)(this.getHttpEndpoint(`${K}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(K,Y,l){return U(this,void 0,void 0,(function*(){const v=this.createRoom(K.room.name,Y);v.roomId=K.room.roomId,v.sessionId=K.sessionId;const d={sessionId:v.sessionId};K.reconnectionToken&&(d.reconnectionToken=K.reconnectionToken);const c=l||v;return v.connect(this.buildEndpoint(K.room,d),K.devMode&&(()=>U(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${v.roomId}'...`);let l=0;const d=()=>U(this,void 0,void 0,(function*(){l++;try{yield this.consumeSeatReservation(K,Y,c),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${v.roomId}'`)}catch(U){l<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${l} out of 8)`),setTimeout(d,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(d,2e3)}))),c),new Promise(((K,Y)=>{const l=(K,l)=>Y(new A.ServerError(K,l));c.onError.once(l),c.onJoin.once((()=>{c.onError.remove(l),K(c)}))}))}))}createMatchMakeRequest(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;return U(this,void 0,void 0,(function*(){const U=(yield(0,d.post)(this.getHttpEndpoint(`${K}/${Y}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(l)})).data;if(U.error)throw new t(U.error,U.code);return"reconnect"===K&&(U.reconnectionToken=l.reconnectionToken),yield this.consumeSeatReservation(U,v,A)}))}createRoom(K,Y){return new c.Room(K,Y)}buildEndpoint(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=[];for(const U in Y)Y.hasOwnProperty(U)&&l.push(`${U}=${Y[U]}`);let v=this.settings.secure?"wss://":"ws://";return K.publicAddress?v+=`${K.publicAddress}`:v+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${v}/${K.processId}/${K.roomId}?${l.join("&")}`}getHttpEndpoint(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${K}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11618:(K,Y,l)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.Connection=void 0;const v=l(11622);Y.Connection=class{constructor(){this.events={},this.transport=new v.WebSocketTransport(this.events)}send(K){this.transport.send(K)}connect(K){this.transport.connect(K)}close(K,Y){this.transport.close(K,Y)}get isOpen(){return this.transport.isOpen}}},11629:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.utf8Length=Y.utf8Read=Y.ErrorCode=Y.Protocol=void 0,function(K){K[K.HANDSHAKE=9]="HANDSHAKE",K[K.JOIN_ROOM=10]="JOIN_ROOM",K[K.ERROR=11]="ERROR",K[K.LEAVE_ROOM=12]="LEAVE_ROOM",K[K.ROOM_DATA=13]="ROOM_DATA",K[K.ROOM_STATE=14]="ROOM_STATE",K[K.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",K[K.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",K[K.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Y.Protocol||(Y.Protocol={})),function(K){K[K.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",K[K.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",K[K.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",K[K.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",K[K.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",K[K.AUTH_FAILED=4215]="AUTH_FAILED",K[K.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Y.ErrorCode||(Y.ErrorCode={})),Y.utf8Read=function(K,Y){const l=K[Y++];for(var v="",U=0,d=Y,A=Y+l;d<A;d++){var c=K[d];if(0!==(128&c))if(192!==(224&c))if(224!==(240&c)){if(240!==(248&c))throw new Error("Invalid byte "+c.toString(16));(U=(7&c)<<18|(63&K[++d])<<12|(63&K[++d])<<6|63&K[++d])>=65536?(U-=65536,v+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):v+=String.fromCharCode(U)}else v+=String.fromCharCode((15&c)<<12|(63&K[++d])<<6|63&K[++d]);else v+=String.fromCharCode((31&c)<<6|63&K[++d]);else v+=String.fromCharCode(c)}return v},Y.utf8Length=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Y=0,l=0;for(let v=0,U=K.length;v<U;v++)Y=K.charCodeAt(v),Y<128?l+=1:Y<2048?l+=2:Y<55296||Y>=57344?l+=3:(v++,l+=4);return l+1}},11611:function(K,Y,l){"use strict";var v=this&&this.__createBinding||(Object.create?function(K,Y,l,v){void 0===v&&(v=l);var U=Object.getOwnPropertyDescriptor(Y,l);U&&!("get"in U?!Y.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return Y[l]}}),Object.defineProperty(K,v,U)}:function(K,Y,l,v){void 0===v&&(v=l),K[v]=Y[l]}),U=this&&this.__setModuleDefault||(Object.create?function(K,Y){Object.defineProperty(K,"default",{enumerable:!0,value:Y})}:function(K,Y){K.default=Y}),d=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var Y={};if(null!=K)for(var l in K)"default"!==l&&Object.prototype.hasOwnProperty.call(K,l)&&v(Y,K,l);return U(Y,K),Y};Object.defineProperty(Y,"__esModule",{value:!0}),Y.Room=void 0;const A=d(l(11615)),c=l(11618),t=l(11629),Z=l(11633),m=l(11636),V=l(11643),M=l(11649),u=l(11606);class o{constructor(K,Y){this.onStateChange=(0,V.createSignal)(),this.onError=(0,V.createSignal)(),this.onLeave=(0,V.createSignal)(),this.onJoin=(0,V.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,m.createNanoEvents)(),this.roomId=null,this.name=K,Y&&(this.serializer=new((0,Z.getSerializer)("schema")),this.rootSchema=Y,this.serializer.state=new Y),this.onError(((K,Y)=>{var l;return null===(l=console.warn)||void 0===l?void 0:l.call(console,`colyseus.js - onError => (${K}) ${Y}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const v=new c.Connection;l.connection=v,v.events.onmessage=o.prototype.onMessageCallback.bind(l),v.events.onclose=function(K){var v;if(!l.hasJoined)return null===(v=console.warn)||void 0===v||v.call(console,`Room connection was closed unexpectedly (${K.code}): ${K.reason}`),void l.onError.invoke(K.code,K.reason);K.code===u.CloseCode.DEVMODE_RESTART&&Y?Y():(l.onLeave.invoke(K.code),l.destroy())},v.events.onerror=function(K){var Y;null===(Y=console.warn)||void 0===Y||Y.call(console,`Room, onError (${K.code}): ${K.reason}`),l.onError.invoke(K.code,K.reason)},v.connect(K)}leave(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Y=>{this.onLeave((K=>Y(K))),this.connection?K?this.connection.send([t.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(u.CloseCode.CONSENTED)}))}onMessage(K,Y){return this.onMessageHandlers.on(this.getMessageHandlerKey(K),Y)}send(K,Y){const l=[t.Protocol.ROOM_DATA];let v;if("string"===typeof K?M.encode.string(l,K):M.encode.number(l,K),void 0!==Y){const K=A.encode(Y);v=new Uint8Array(l.length+K.byteLength),v.set(new Uint8Array(l),0),v.set(new Uint8Array(K),l.length)}else v=new Uint8Array(l);this.connection.send(v.buffer)}sendBytes(K,Y){const l=[t.Protocol.ROOM_DATA_BYTES];let v;"string"===typeof K?M.encode.string(l,K):M.encode.number(l,K),v=new Uint8Array(l.length+(Y.byteLength||Y.length)),v.set(new Uint8Array(l),0),v.set(new Uint8Array(Y),l.length),this.connection.send(v.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(K){const Y=Array.from(new Uint8Array(K.data)),l=Y[0];if(l===t.Protocol.JOIN_ROOM){let K=1;const l=(0,t.utf8Read)(Y,K);if(K+=(0,t.utf8Length)(l),this.serializerId=(0,t.utf8Read)(Y,K),K+=(0,t.utf8Length)(this.serializerId),!this.serializer){const K=(0,Z.getSerializer)(this.serializerId);this.serializer=new K}Y.length>K&&this.serializer.handshake&&this.serializer.handshake(Y,{offset:K}),this.reconnectionToken=`${this.roomId}:${l}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([t.Protocol.JOIN_ROOM])}else if(l===t.Protocol.ERROR){const K={offset:1},l=M.decode.number(Y,K),v=M.decode.string(Y,K);this.onError.invoke(l,v)}else if(l===t.Protocol.LEAVE_ROOM)this.leave();else if(l===t.Protocol.ROOM_DATA_SCHEMA){const K={offset:1},l=this.serializer.getState().constructor._context.get(M.decode.number(Y,K)),v=new l;v.decode(Y,K),this.dispatchMessage(l,v)}else if(l===t.Protocol.ROOM_STATE)Y.shift(),this.setState(Y);else if(l===t.Protocol.ROOM_STATE_PATCH)Y.shift(),this.patch(Y);else if(l===t.Protocol.ROOM_DATA){const l={offset:1},v=M.decode.stringCheck(Y,l)?M.decode.string(Y,l):M.decode.number(Y,l),U=Y.length>l.offset?A.decode(K.data,l.offset):void 0;this.dispatchMessage(v,U)}else if(l===t.Protocol.ROOM_DATA_BYTES){const K={offset:1},l=M.decode.stringCheck(Y,K)?M.decode.string(Y,K):M.decode.number(Y,K);this.dispatchMessage(l,new Uint8Array(Y.slice(K.offset)))}}setState(K){this.serializer.setState(K),this.onStateChange.invoke(this.serializer.getState())}patch(K){this.serializer.patch(K),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(K,Y){var l;const v=this.getMessageHandlerKey(K);this.onMessageHandlers.events[v]?this.onMessageHandlers.emit(v,Y):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",K,Y):null===(l=console.warn)||void 0===l||l.call(console,`colyseus.js: onMessage() not registered for type '${K}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(K){switch(typeof K){case"function":return`$${K._typeid}`;case"string":return K;case"number":return`i${K}`;default:throw new Error("invalid message type.")}}}Y.Room=o},11663:(K,Y)=>{"use strict";let l;function v(){return l||(l="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(K,Y){this.cache[K]=Y},getItem:function(K){this.cache[K]},removeItem:function(K){delete this.cache[K]}}),l}Object.defineProperty(Y,"__esModule",{value:!0}),Y.getItem=Y.removeItem=Y.setItem=void 0,Y.setItem=function(K,Y){v().setItem(K,Y)},Y.removeItem=function(K){v().removeItem(K)},Y.getItem=function(K,Y){const l=v().getItem(K);"undefined"!==typeof Promise&&l instanceof Promise?l.then((K=>Y(K))):Y(l)}},11636:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.createNanoEvents=void 0;Y.createNanoEvents=()=>({emit(K){let Y=this.events[K]||[];for(var l=arguments.length,v=new Array(l>1?l-1:0),U=1;U<l;U++)v[U-1]=arguments[U];for(let d=0,A=Y.length;d<A;d++)Y[d](...v)},events:{},on(K,Y){var l;return(null===(l=this.events[K])||void 0===l?void 0:l.push(Y))||(this.events[K]=[Y]),()=>{var l;this.events[K]=null===(l=this.events[K])||void 0===l?void 0:l.filter((K=>Y!==K))}}})},11643:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.createSignal=Y.EventEmitter=void 0;class l{constructor(){this.handlers=[]}register(K){return this.handlers.push(K),this}invoke(){for(var K=arguments.length,Y=new Array(K),l=0;l<K;l++)Y[l]=arguments[l];this.handlers.forEach((K=>K.apply(this,Y)))}invokeAsync(){for(var K=arguments.length,Y=new Array(K),l=0;l<K;l++)Y[l]=arguments[l];return Promise.all(this.handlers.map((K=>K.apply(this,Y))))}remove(K){const Y=this.handlers.indexOf(K);this.handlers[Y]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Y.EventEmitter=l,Y.createSignal=function(){const K=new l;function Y(Y){return K.register(Y,null===this)}return Y.once=Y=>{const l=function(){for(var v=arguments.length,U=new Array(v),d=0;d<v;d++)U[d]=arguments[d];Y.apply(this,U),K.remove(l)};K.register(l)},Y.remove=Y=>K.remove(Y),Y.invoke=function(){return K.invoke(...arguments)},Y.invokeAsync=function(){return K.invokeAsync(...arguments)},Y.clear=()=>K.clear(),Y}},11606:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.ServerError=Y.CloseCode=void 0,function(K){K[K.CONSENTED=4e3]="CONSENTED",K[K.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Y.CloseCode||(Y.CloseCode={}));class l extends Error{constructor(K,Y){super(Y),this.name="ServerError",this.code=K}}Y.ServerError=l},11584:(K,Y,l)=>{"use strict";Y.e=void 0,l(11593);var v=l(11595);Object.defineProperty(Y,"e",{enumerable:!0,get:function(){return v.Client}});var U=l(11629);var d=l(11611);var A=l(11657);const c=l(11668);const t=l(11670),Z=l(11633);(0,Z.registerSerializer)("schema",c.SchemaSerializer),(0,Z.registerSerializer)("none",t.NoneSerializer)},11593:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=K=>null!==K&&"object"===typeof K&&K.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11615:(K,Y)=>{"use strict";function l(K,Y){if(this._offset=Y,K instanceof ArrayBuffer)this._buffer=K,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(K))throw new Error("Invalid argument");this._buffer=K.buffer,this._view=new DataView(this._buffer,K.byteOffset,K.byteLength)}}Object.defineProperty(Y,"__esModule",{value:!0}),Y.decode=Y.encode=void 0,l.prototype._array=function(K){for(var Y=new Array(K),l=0;l<K;l++)Y[l]=this._parse();return Y},l.prototype._map=function(K){for(var Y={},l=0;l<K;l++)Y[this._parse()]=this._parse();return Y},l.prototype._str=function(K){var Y=function(K,Y,l){for(var v="",U=0,d=Y,A=Y+l;d<A;d++){var c=K.getUint8(d);if(0!==(128&c))if(192!==(224&c))if(224!==(240&c)){if(240!==(248&c))throw new Error("Invalid byte "+c.toString(16));(U=(7&c)<<18|(63&K.getUint8(++d))<<12|(63&K.getUint8(++d))<<6|63&K.getUint8(++d))>=65536?(U-=65536,v+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):v+=String.fromCharCode(U)}else v+=String.fromCharCode((15&c)<<12|(63&K.getUint8(++d))<<6|63&K.getUint8(++d));else v+=String.fromCharCode((31&c)<<6|63&K.getUint8(++d));else v+=String.fromCharCode(c)}return v}(this._view,this._offset,K);return this._offset+=K,Y},l.prototype._bin=function(K){var Y=this._buffer.slice(this._offset,this._offset+K);return this._offset+=K,Y},l.prototype._parse=function(){var K,Y=this._view.getUint8(this._offset++),l=0,v=0,U=0,d=0;if(Y<192)return Y<128?Y:Y<144?this._map(15&Y):Y<160?this._array(15&Y):this._str(31&Y);if(Y>223)return-1*(255-Y+1);switch(Y){case 192:return null;case 194:return!1;case 195:return!0;case 196:return l=this._view.getUint8(this._offset),this._offset+=1,this._bin(l);case 197:return l=this._view.getUint16(this._offset),this._offset+=2,this._bin(l);case 198:return l=this._view.getUint32(this._offset),this._offset+=4,this._bin(l);case 199:if(l=this._view.getUint8(this._offset),v=this._view.getInt8(this._offset+1),this._offset+=2,-1===v){var A=this._view.getUint32(this._offset);return U=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*U+d)+A/1e6)}return[v,this._bin(l)];case 200:return l=this._view.getUint16(this._offset),v=this._view.getInt8(this._offset+2),this._offset+=3,[v,this._bin(l)];case 201:return l=this._view.getUint32(this._offset),v=this._view.getInt8(this._offset+4),this._offset+=5,[v,this._bin(l)];case 202:return K=this._view.getFloat32(this._offset),this._offset+=4,K;case 203:return K=this._view.getFloat64(this._offset),this._offset+=8,K;case 204:return K=this._view.getUint8(this._offset),this._offset+=1,K;case 205:return K=this._view.getUint16(this._offset),this._offset+=2,K;case 206:return K=this._view.getUint32(this._offset),this._offset+=4,K;case 207:return U=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,U+d;case 208:return K=this._view.getInt8(this._offset),this._offset+=1,K;case 209:return K=this._view.getInt16(this._offset),this._offset+=2,K;case 210:return K=this._view.getInt32(this._offset),this._offset+=4,K;case 211:return U=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,U+d;case 212:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?void(this._offset+=1):[v,this._bin(1)];case 213:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(2)];case 214:return v=this._view.getInt8(this._offset),this._offset+=1,-1===v?(K=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*K)):[v,this._bin(4)];case 215:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?(U=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(U+d)):-1===v?(U=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&U)+d)+(U>>>2)/1e6)):[v,this._bin(8)];case 216:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(16)];case 217:return l=this._view.getUint8(this._offset),this._offset+=1,this._str(l);case 218:return l=this._view.getUint16(this._offset),this._offset+=2,this._str(l);case 219:return l=this._view.getUint32(this._offset),this._offset+=4,this._str(l);case 220:return l=this._view.getUint16(this._offset),this._offset+=2,this._array(l);case 221:return l=this._view.getUint32(this._offset),this._offset+=4,this._array(l);case 222:return l=this._view.getUint16(this._offset),this._offset+=2,this._map(l);case 223:return l=this._view.getUint32(this._offset),this._offset+=4,this._map(l)}throw new Error("Could not parse")},Y.decode=function(K){var Y=new l(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),v=Y._parse();if(Y._offset!==K.byteLength)throw new Error(K.byteLength-Y._offset+" trailing bytes");return v};function v(K,Y,l){for(var v=0,U=0,d=l.length;U<d;U++)(v=l.charCodeAt(U))<128?K.setUint8(Y++,v):v<2048?(K.setUint8(Y++,192|v>>6),K.setUint8(Y++,128|63&v)):v<55296||v>=57344?(K.setUint8(Y++,224|v>>12),K.setUint8(Y++,128|v>>6&63),K.setUint8(Y++,128|63&v)):(U++,v=65536+((1023&v)<<10|1023&l.charCodeAt(U)),K.setUint8(Y++,240|v>>18),K.setUint8(Y++,128|v>>12&63),K.setUint8(Y++,128|v>>6&63),K.setUint8(Y++,128|63&v))}function U(K,Y,l){var v=typeof l,d=0,A=0,c=0,t=0,Z=0,m=0;if("string"===v){if(Z=function(K){for(var Y=0,l=0,v=0,U=K.length;v<U;v++)(Y=K.charCodeAt(v))<128?l+=1:Y<2048?l+=2:Y<55296||Y>=57344?l+=3:(v++,l+=4);return l}(l),Z<32)K.push(160|Z),m=1;else if(Z<256)K.push(217,Z),m=2;else if(Z<65536)K.push(218,Z>>8,Z),m=3;else{if(!(Z<4294967296))throw new Error("String too long");K.push(219,Z>>24,Z>>16,Z>>8,Z),m=5}return Y.push({_str:l,_length:Z,_offset:K.length}),m+Z}if("number"===v)return Math.floor(l)===l&&isFinite(l)?l>=0?l<128?(K.push(l),1):l<256?(K.push(204,l),2):l<65536?(K.push(205,l>>8,l),3):l<4294967296?(K.push(206,l>>24,l>>16,l>>8,l),5):(c=l/Math.pow(2,32)|0,t=l>>>0,K.push(207,c>>24,c>>16,c>>8,c,t>>24,t>>16,t>>8,t),9):l>=-32?(K.push(l),1):l>=-128?(K.push(208,l),2):l>=-32768?(K.push(209,l>>8,l),3):l>=-2147483648?(K.push(210,l>>24,l>>16,l>>8,l),5):(c=Math.floor(l/Math.pow(2,32)),t=l>>>0,K.push(211,c>>24,c>>16,c>>8,c,t>>24,t>>16,t>>8,t),9):(K.push(203),Y.push({_float:l,_length:8,_offset:K.length}),9);if("object"===v){if(null===l)return K.push(192),1;if(Array.isArray(l)){if((Z=l.length)<16)K.push(144|Z),m=1;else if(Z<65536)K.push(220,Z>>8,Z),m=3;else{if(!(Z<4294967296))throw new Error("Array too large");K.push(221,Z>>24,Z>>16,Z>>8,Z),m=5}for(d=0;d<Z;d++)m+=U(K,Y,l[d]);return m}if(l instanceof Date){var V=l.getTime(),M=Math.floor(V/1e3),u=1e6*(V-1e3*M);return M>=0&&u>=0&&M<=17179869183?0===u&&M<=4294967295?(K.push(214,255,M>>24,M>>16,M>>8,M),6):(c=M/4294967296,t=4294967295&M,K.push(215,255,u>>22,u>>14,u>>6,c,t>>24,t>>16,t>>8,t),10):(c=Math.floor(M/4294967296),t=M>>>0,K.push(199,12,255,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c,t>>24,t>>16,t>>8,t),15)}if(l instanceof ArrayBuffer){if((Z=l.byteLength)<256)K.push(196,Z),m=2;else if(Z<65536)K.push(197,Z>>8,Z),m=3;else{if(!(Z<4294967296))throw new Error("Buffer too large");K.push(198,Z>>24,Z>>16,Z>>8,Z),m=5}return Y.push({_bin:l,_length:Z,_offset:K.length}),m+Z}if("function"===typeof l.toJSON)return U(K,Y,l.toJSON());var o=[],W="",g=Object.keys(l);for(d=0,A=g.length;d<A;d++)void 0!==l[W=g[d]]&&"function"!==typeof l[W]&&o.push(W);if((Z=o.length)<16)K.push(128|Z),m=1;else if(Z<65536)K.push(222,Z>>8,Z),m=3;else{if(!(Z<4294967296))throw new Error("Object too large");K.push(223,Z>>24,Z>>16,Z>>8,Z),m=5}for(d=0;d<Z;d++)m+=U(K,Y,W=o[d]),m+=U(K,Y,l[W]);return m}if("boolean"===v)return K.push(l?195:194),1;if("undefined"===v)return K.push(192),1;if("function"===typeof l.toJSON)return U(K,Y,l.toJSON());throw new Error("Could not encode")}Y.encode=function(K){var Y=[],l=[],d=U(Y,l,K),A=new ArrayBuffer(d),c=new DataView(A),t=0,Z=0,m=-1;l.length>0&&(m=l[0]._offset);for(var V,M=0,u=0,o=0,W=Y.length;o<W;o++)if(c.setUint8(Z+o,Y[o]),o+1===m){if(M=(V=l[t])._length,u=Z+m,V._bin)for(var g=new Uint8Array(V._bin),J=0;J<M;J++)c.setUint8(u+J,g[J]);else V._str?v(c,u,V._str):void 0!==V._float&&c.setFloat64(u,V._float);Z+=M,l[++t]&&(m=l[t]._offset)}return A}},11670:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.NoneSerializer=void 0;Y.NoneSerializer=class{setState(K){}getState(){return null}patch(K){}teardown(){}handshake(K){}}},11668:(K,Y,l)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.SchemaSerializer=void 0;const v=l(11649);Y.SchemaSerializer=class{setState(K){return this.state.decode(K)}getState(){return this.state}patch(K){return this.state.decode(K)}teardown(){var K,Y;null===(Y=null===(K=this.state)||void 0===K?void 0:K.$changes)||void 0===Y||Y.root.clearRefs()}handshake(K,Y){if(this.state){(new v.Reflection).decode(K,Y)}else this.state=v.Reflection.decode(K,Y)}}},11633:(K,Y)=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0}),Y.getSerializer=Y.registerSerializer=void 0;const l={};Y.registerSerializer=function(K,Y){l[K]=Y},Y.getSerializer=function(K){const Y=l[K];if(!Y)throw new Error("missing serializer: "+K);return Y}},11622:function(K,Y,l){"use strict";var v=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(Y,"__esModule",{value:!0}),Y.WebSocketTransport=void 0;const U=v(l(11625)),d=globalThis.WebSocket||U.default;Y.WebSocketTransport=class{constructor(K){this.events=K}send(K){K instanceof ArrayBuffer?this.ws.send(K):Array.isArray(K)&&this.ws.send(new Uint8Array(K).buffer)}connect(K){this.ws=new d(K,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(K,Y){this.ws.close(K,Y)}get isOpen(){return this.ws.readyState===d.OPEN}}},11625:K=>{"use strict";K.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11719:K=>{"use strict";K.exports=function(K){for(var Y=new Array(K),l=0;l<K;++l)Y[l]=l;return Y}},11725:K=>{function Y(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(Y(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&Y(K.slice(0,0))}(K)||!!K._isBuffer)}},11713:(K,Y,l)=>{var v=l(11719),U=l(11725),d="undefined"!==typeof Float64Array;function A(K,Y){return K[0]-Y[0]}function c(){var K,Y=this.stride,l=new Array(Y.length);for(K=0;K<l.length;++K)l[K]=[Math.abs(Y[K]),K];l.sort(A);var v=new Array(l.length);for(K=0;K<v.length;++K)v[K]=l[K][1];return v}function t(K,Y){var l=["View",Y,"d",K].join("");Y<0&&(l="View_Nil"+K);var U="generic"===K;if(-1===Y){var d="function "+l+"(a){this.data=a;};var proto="+l+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+l+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+l+"(a){return new "+l+"(a);}";return new Function(d)()}if(0===Y){d="function "+l+"(a,d) {this.data = a;this.offset = d};var proto="+l+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+l+"_copy() {return new "+l+"(this.data,this.offset)};proto.pick=function "+l+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+l+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+l+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+l+"(a,b,c,d){return new "+l+"(a,d)}";return new Function("TrivialArray",d)(Z[K][0])}d=["'use strict'"];var A=v(Y),t=A.map((function(K){return"i"+K})),m="this.offset+"+A.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),V=A.map((function(K){return"b"+K})).join(","),M=A.map((function(K){return"c"+K})).join(",");d.push("function "+l+"(a,"+V+","+M+",d){this.data=a","this.shape=["+V+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+l+".prototype","proto.dtype='"+K+"'","proto.dimension="+Y),d.push("Object.defineProperty(proto,'size',{get:function "+l+"_size(){return "+A.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===Y?d.push("proto.order=[0]"):(d.push("Object.defineProperty(proto,'order',{get:"),Y<4?(d.push("function "+l+"_order(){"),2===Y?d.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Y&&d.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):d.push("ORDER})")),d.push("proto.set=function "+l+"_set("+t.join(",")+",v){"),U?d.push("return this.data.set("+m+",v)}"):d.push("return this.data["+m+"]=v}"),d.push("proto.get=function "+l+"_get("+t.join(",")+"){"),U?d.push("return this.data.get("+m+")}"):d.push("return this.data["+m+"]}"),d.push("proto.index=function "+l+"_index(",t.join(),"){return "+m+"}"),d.push("proto.hi=function "+l+"_hi("+t.join(",")+"){return new "+l+"(this.data,"+A.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+A.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var u=A.map((function(K){return"a"+K+"=this.shape["+K+"]"})),o=A.map((function(K){return"c"+K+"=this.stride["+K+"]"}));d.push("proto.lo=function "+l+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+o.join(","));for(var W=0;W<Y;++W)d.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");d.push("return new "+l+"(this.data,"+A.map((function(K){return"a"+K})).join(",")+","+A.map((function(K){return"c"+K})).join(",")+",b)}"),d.push("proto.step=function "+l+"_step("+t.join(",")+"){var "+A.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+A.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<Y;++W)d.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");d.push("return new "+l+"(this.data,"+A.map((function(K){return"a"+K})).join(",")+","+A.map((function(K){return"b"+K})).join(",")+",c)}");var g=new Array(Y),J=new Array(Y);for(W=0;W<Y;++W)g[W]="a[i"+W+"]",J[W]="b[i"+W+"]";d.push("proto.transpose=function "+l+"_transpose("+t+"){"+t.map((function(K,Y){return K+"=("+K+"===undefined?"+Y+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+l+"(this.data,"+g.join(",")+","+J.join(",")+",this.offset)}"),d.push("proto.pick=function "+l+"_pick("+t+"){var a=[],b=[],c=this.offset");for(W=0;W<Y;++W)d.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return d.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),d.push("return function construct_"+l+"(data,shape,stride,offset){return new "+l+"(data,"+A.map((function(K){return"shape["+K+"]"})).join(",")+","+A.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",d.join("\n"))(Z[K],c)}var Z={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,Y,l,v){if(void 0===K)return(0,Z.array[0])([]);"number"===typeof K&&(K=[K]),void 0===Y&&(Y=[K.length]);var A=Y.length;if(void 0===l){l=new Array(A);for(var c=A-1,m=1;c>=0;--c)l[c]=m,m*=Y[c]}if(void 0===v){v=0;for(c=0;c<A;++c)l[c]<0&&(v-=(Y[c]-1)*l[c])}for(var V=function(K){if(U(K))return"buffer";if(d)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),M=Z[V];M.length<=A+1;)M.push(t(V,M.length-1));return(0,M[A+1])(K,Y,l,v)}},11678:K=>{var Y;self,Y=()=>(()=>{"use strict";var K={d:(Y,l)=>{for(var v in l)K.o(l,v)&&!K.o(Y,v)&&Object.defineProperty(Y,v,{enumerable:!0,get:l[v]})},o:(K,Y)=>Object.prototype.hasOwnProperty.call(K,Y)},Y={};K.d(Y,{default:()=>Q});var l,v=function(K,Y){var l=Y.x-K.x,v=Y.y-K.y;return Math.sqrt(l*l+v*v)},U=function(K){return K*(Math.PI/180)},d=new Map,A=function(K){d.has(K)&&clearTimeout(d.get(K)),d.set(K,setTimeout(K,100))},c=function(K,Y,l){for(var v,U=Y.split(/[ ,]+/g),d=0;d<U.length;d+=1)v=U[d],K.addEventListener?K.addEventListener(v,l,!1):K.attachEvent&&K.attachEvent(v,l)},t=function(K,Y,l){for(var v,U=Y.split(/[ ,]+/g),d=0;d<U.length;d+=1)v=U[d],K.removeEventListener?K.removeEventListener(v,l):K.detachEvent&&K.detachEvent(v,l)},Z=function(K){return K.preventDefault(),K.type.match(/^touch/)?K.changedTouches:K},m=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},V=function(K,Y){Y.top||Y.right||Y.bottom||Y.left?(K.style.top=Y.top,K.style.right=Y.right,K.style.bottom=Y.bottom,K.style.left=Y.left):(K.style.left=Y.x+"px",K.style.top=Y.y+"px")},M=function(K,Y,l){var v=u(K);for(var U in v)if(v.hasOwnProperty(U))if("string"==typeof Y)v[U]=Y+" "+l;else{for(var d="",A=0,c=Y.length;A<c;A+=1)d+=Y[A]+" "+l+", ";v[U]=d.slice(0,-2)}return v},u=function(K){var Y={};return Y[K]="",["webkit","Moz","o"].forEach((function(l){Y[l+K.charAt(0).toUpperCase()+K.slice(1)]=""})),Y},o=function(K,Y){for(var l in Y)Y.hasOwnProperty(l)&&(K[l]=Y[l]);return K},W=function(K,Y){if(K.length)for(var l=0,v=K.length;l<v;l+=1)Y(K[l]);else Y(K)},g="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,J=window.matchMedia("(any-hover: none)").matches,n=!!("ontouchstart"in window),R=!!window.PointerEvent,H=!!window.MSPointerEvent,z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},r={start:"mousedown",move:"mousemove",end:"mouseup"},E={};function y(){}g&&!J?l=z:R?l={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:H?l={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(l=z,E=r):l=r,y.prototype.on=function(K,Y){var l,v=this,U=K.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var d=0;d<U.length;d+=1)l=U[d],v._handlers_[l]=v._handlers_[l]||[],v._handlers_[l].push(Y);return v},y.prototype.off=function(K,Y){var l=this;return l._handlers_=l._handlers_||{},void 0===K?l._handlers_={}:void 0===Y?l._handlers_[K]=null:l._handlers_[K]&&l._handlers_[K].indexOf(Y)>=0&&l._handlers_[K].splice(l._handlers_[K].indexOf(Y),1),l},y.prototype.trigger=function(K,Y){var l,v=this,U=K.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var d=0;d<U.length;d+=1)l=U[d],v._handlers_[l]&&v._handlers_[l].length&&v._handlers_[l].forEach((function(K){K.call(v,{type:l,target:v},Y)}))},y.prototype.config=function(K){var Y=this;Y.options=Y.defaults||{},K&&(Y.options=function(K,Y){var l={};for(var v in K)K.hasOwnProperty(v)&&Y.hasOwnProperty(v)?l[v]=Y[v]:K.hasOwnProperty(v)&&(l[v]=K[v]);return l}(Y.options,K))},y.prototype.bindEvt=function(K,Y){var v=this;return v._domHandlers_=v._domHandlers_||{},v._domHandlers_[Y]=function(){"function"==typeof v["on"+Y]?v["on"+Y].apply(v,arguments):console.warn('[WARNING] : Missing "on'+Y+'" handler.')},c(K,l[Y],v._domHandlers_[Y]),E[Y]&&c(K,E[Y],v._domHandlers_[Y]),v},y.prototype.unbindEvt=function(K,Y){var v=this;return v._domHandlers_=v._domHandlers_||{},t(K,l[Y],v._domHandlers_[Y]),E[Y]&&t(K,E[Y],v._domHandlers_[Y]),delete v._domHandlers_[Y],this};const T=y;function e(K,Y){return this.identifier=Y.identifier,this.position=Y.position,this.frontPosition=Y.frontPosition,this.collection=K,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Y),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=e.id,e.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}e.prototype=new T,e.constructor=e,e.id=0,e.prototype.buildEl=function(K){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},e.prototype.stylize=function(){if(this.options.dataOnly)return this;var K=this.options.fadeTime+"ms",Y=function(){var K=u("borderRadius");for(var Y in K)K.hasOwnProperty(Y)&&(K[Y]="50%");return K}(),l=M("transition","opacity",K),v={};return v.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},v.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},v.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},o(v.el,l),"circle"===this.options.shape&&o(v.back,Y),o(v.front,Y),this.applyStyles(v),this},e.prototype.applyStyles=function(K){for(var Y in this.ui)if(this.ui.hasOwnProperty(Y))for(var l in K[Y])this.ui[Y].style[l]=K[Y][l];return this},e.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},e.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},e.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},e.prototype.show=function(K){var Y=this;return Y.options.dataOnly||(clearTimeout(Y.removeTimeout),clearTimeout(Y.showTimeout),clearTimeout(Y.restTimeout),Y.addToDom(),Y.restCallback(),setTimeout((function(){Y.ui.el.style.opacity=1}),0),Y.showTimeout=setTimeout((function(){Y.trigger("shown",Y.instance),"function"==typeof K&&K.call(this)}),Y.options.fadeTime)),Y},e.prototype.hide=function(K){var Y=this;if(Y.options.dataOnly)return Y;if(Y.ui.el.style.opacity=Y.options.restOpacity,clearTimeout(Y.removeTimeout),clearTimeout(Y.showTimeout),clearTimeout(Y.restTimeout),Y.removeTimeout=setTimeout((function(){var l="dynamic"===Y.options.mode?"none":"block";Y.ui.el.style.display=l,"function"==typeof K&&K.call(Y),Y.trigger("hidden",Y.instance)}),Y.options.fadeTime),Y.options.restJoystick){var l=Y.options.restJoystick,v={};v.x=!0===l||!1!==l.x?0:Y.instance.frontPosition.x,v.y=!0===l||!1!==l.y?0:Y.instance.frontPosition.y,Y.setPosition(K,v)}return Y},e.prototype.setPosition=function(K,Y){var l=this;l.frontPosition={x:Y.x,y:Y.y};var v=l.options.fadeTime+"ms",U={};U.front=M("transition",["transform"],v);var d={front:{}};d.front={transform:"translate("+l.frontPosition.x+"px,"+l.frontPosition.y+"px)"},l.applyStyles(U),l.applyStyles(d),l.restTimeout=setTimeout((function(){"function"==typeof K&&K.call(l),l.restCallback()}),l.options.fadeTime)},e.prototype.restCallback=function(){var K=this,Y={};Y.front=M("transition","none",""),K.applyStyles(Y),K.trigger("rested",K.instance)},e.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},e.prototype.computeDirection=function(K){var Y,l,v,U=K.angle.radian,d=Math.PI/4,A=Math.PI/2;if(U>d&&U<3*d&&!K.lockX?Y="up":U>-d&&U<=d&&!K.lockY?Y="left":U>3*-d&&U<=-d&&!K.lockX?Y="down":K.lockY||(Y="right"),K.lockY||(l=U>-A&&U<A?"left":"right"),K.lockX||(v=U>0?"up":"down"),K.force>this.options.threshold){var c,t={};for(c in this.direction)this.direction.hasOwnProperty(c)&&(t[c]=this.direction[c]);var Z={};for(c in this.direction={x:l,y:v,angle:Y},K.direction=this.direction,t)t[c]===this.direction[c]&&(Z[c]=!0);if(Z.x&&Z.y&&Z.angle)return K;Z.x&&Z.y||this.trigger("plain",K),Z.x||this.trigger("plain:"+l,K),Z.y||this.trigger("plain:"+v,K),Z.angle||this.trigger("dir dir:"+Y,K)}else this.resetDirection();return K};const i=e;function D(K,Y){var l=this;l.nipples=[],l.idles=[],l.actives=[],l.ids=[],l.pressureIntervals={},l.manager=K,l.id=D.id,D.id+=1,l.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},l.config(Y),"static"!==l.options.mode&&"semi"!==l.options.mode||(l.options.multitouch=!1),l.options.multitouch||(l.options.maxNumberOfNipples=1);var v=getComputedStyle(l.options.zone.parentElement);return v&&"flex"===v.display&&(l.parentIsFlex=!0),l.updateBox(),l.prepareNipples(),l.Vl(),l.begin(),l.nipples}D.prototype=new T,D.constructor=D,D.id=0,D.prototype.prepareNipples=function(){var K=this,Y=K.nipples;Y.on=K.on.bind(K),Y.off=K.off.bind(K),Y.options=K.options,Y.destroy=K.destroy.bind(K),Y.ids=K.ids,Y.id=K.id,Y.processOnMove=K.processOnMove.bind(K),Y.processOnEnd=K.processOnEnd.bind(K),Y.get=function(K){if(void 0===K)return Y[0];for(var l=0,v=Y.length;l<v;l+=1)if(Y[l].identifier===K)return Y[l];return!1}},D.prototype.Vl=function(){var K=this;K.bindEvt(K.options.zone,"start"),K.options.zone.style.touchAction="none",K.options.zone.style.msTouchAction="none"},D.prototype.begin=function(){var K=this,Y=K.options;if("static"===Y.mode){var l=K.createNipple(Y.position,K.manager.getIdentifier());l.add(),K.idles.push(l)}},D.prototype.createNipple=function(K,Y){var l=this,v=l.manager.scroll,U={},d=l.options,A=l.parentIsFlex?v.x:v.x+l.box.left,c=l.parentIsFlex?v.y:v.y+l.box.top;if(K.x&&K.y)U={x:K.x-A,y:K.y-c};else if(K.top||K.right||K.bottom||K.left){var t=document.createElement("DIV");t.style.display="hidden",t.style.top=K.top,t.style.right=K.right,t.style.bottom=K.bottom,t.style.left=K.left,t.style.position="absolute",d.zone.appendChild(t);var Z=t.getBoundingClientRect();d.zone.removeChild(t),U=K,K={x:Z.left+v.x,y:Z.top+v.y}}var m=new i(l,{color:d.color,size:d.size,threshold:d.threshold,fadeTime:d.fadeTime,dataOnly:d.dataOnly,restJoystick:d.restJoystick,restOpacity:d.restOpacity,mode:d.mode,identifier:Y,position:K,zone:d.zone,frontPosition:{x:0,y:0},shape:d.shape});return d.dataOnly||(V(m.ui.el,U),V(m.ui.front,m.frontPosition)),l.nipples.push(m),l.trigger("added "+m.identifier+":added",m),l.manager.trigger("added "+m.identifier+":added",m),l.bindNipple(m),m},D.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},D.prototype.bindNipple=function(K){var Y,l=this,v=function(K,v){Y=K.type+" "+v.id+":"+K.type,l.trigger(Y,v)};K.on("destroyed",l.onDestroyed.bind(l)),K.on("shown hidden rested dir plain",v),K.on("dir:up dir:right dir:down dir:left",v),K.on("plain:up plain:right plain:down plain:left",v)},D.prototype.pressureFn=function(K,Y,l){var v=this,U=0;clearInterval(v.pressureIntervals[l]),v.pressureIntervals[l]=setInterval(function(){var l=K.force||K.pressure||K.webkitForce||0;l!==U&&(Y.trigger("pressure",l),v.trigger("pressure "+Y.identifier+":pressure",l),U=l)}.bind(v),100)},D.prototype.onstart=function(K){var Y=this,l=Y.options,v=K;return K=Z(K),Y.updateBox(),W(K,(function(U){Y.actives.length<l.maxNumberOfNipples?Y.processOnStart(U):v.type.match(/^touch/)&&(Object.keys(Y.manager.ids).forEach((function(l){if(Object.values(v.touches).findIndex((function(K){return K.identifier===l}))<0){var U=[K[0]];U.identifier=l,Y.processOnEnd(U)}})),Y.actives.length<l.maxNumberOfNipples&&Y.processOnStart(U))})),Y.manager.bindDocument(),!1},D.prototype.processOnStart=function(K){var Y,l=this,U=l.options,d=l.manager.getIdentifier(K),A=K.force||K.pressure||K.webkitForce||0,c={x:K.pageX,y:K.pageY},t=l.getOrCreate(d,c);t.identifier!==d&&l.manager.removeIdentifier(t.identifier),t.identifier=d;var Z=function(Y){Y.trigger("start",Y),l.trigger("start "+Y.id+":start",Y),Y.show(),A>0&&l.pressureFn(K,Y,Y.identifier),l.processOnMove(K)};if((Y=l.idles.indexOf(t))>=0&&l.idles.splice(Y,1),l.actives.push(t),l.ids.push(t.identifier),"semi"!==U.mode)Z(t);else{if(!(v(c,t.position)<=U.catchDistance))return t.destroy(),void l.processOnStart(K);Z(t)}return t},D.prototype.getOrCreate=function(K,Y){var l,v=this,U=v.options;return/(semi|static)/.test(U.mode)?(l=v.idles[0])?(v.idles.splice(0,1),l):"semi"===U.mode?v.createNipple(Y,K):(console.warn("Coudln't find the needed nipple."),!1):l=v.createNipple(Y,K)},D.prototype.processOnMove=function(K){var Y=this,l=Y.options,d=Y.manager.getIdentifier(K),A=Y.nipples.get(d),c=Y.manager.scroll;if(function(K){return isNaN(K.buttons)?0!==K.pressure:0!==K.buttons}(K)){if(!A)return console.error("Found zombie joystick with ID "+d),void Y.manager.removeIdentifier(d);if(l.dynamicPage){var t=A.el.getBoundingClientRect();A.position={x:c.x+t.left,y:c.y+t.top}}A.identifier=d;var Z=A.options.size/2,m={x:K.pageX,y:K.pageY};l.lockX&&(m.y=A.position.y),l.lockY&&(m.x=A.position.x);var V,M,u,o,W,g,J,n,R,H,z=v(m,A.position),r=(V=m,u=(M=A.position).x-V.x,o=M.y-V.y,function(K){return K*(180/Math.PI)}(Math.atan2(o,u))),E=U(r),y=z/Z,T={distance:z,position:m};if("circle"===A.options.shape?(W=Math.min(z,Z),J=A.position,n=W,H={x:0,y:0},R=U(R=r),H.x=J.x-n*Math.cos(R),H.y=J.y-n*Math.sin(R),g=H):(g=function(K,Y,l){return{x:Math.min(Math.max(K.x,Y.x-l),Y.x+l),y:Math.min(Math.max(K.y,Y.y-l),Y.y+l)}}(m,A.position,Z),W=v(g,A.position)),l.follow){if(z>Z){var e=m.x-g.x,i=m.y-g.y;A.position.x+=e,A.position.y+=i,A.el.style.top=A.position.y-(Y.box.top+c.y)+"px",A.el.style.left=A.position.x-(Y.box.left+c.x)+"px",z=v(m,A.position)}}else m=g,z=W;var D=m.x-A.position.x,B=m.y-A.position.y;A.frontPosition={x:D,y:B},l.dataOnly||(A.ui.front.style.transform="translate("+D+"px,"+B+"px)");var P={identifier:A.identifier,position:m,force:y,pressure:K.force||K.pressure||K.webkitForce||0,distance:z,angle:{radian:E,degree:r},vector:{x:D/Z,y:-B/Z},raw:T,instance:A,lockX:l.lockX,lockY:l.lockY};(P=A.computeDirection(P)).angle={radian:U(180-r),degree:180-r},A.trigger("move",P),Y.trigger("move "+A.id+":move",P)}else this.processOnEnd(K)},D.prototype.processOnEnd=function(K){var Y=this,l=Y.options,v=Y.manager.getIdentifier(K),U=Y.nipples.get(v),d=Y.manager.removeIdentifier(U.identifier);U&&(l.dataOnly||U.hide((function(){"dynamic"===l.mode&&(U.trigger("removed",U),Y.trigger("removed "+U.id+":removed",U),Y.manager.trigger("removed "+U.id+":removed",U),U.destroy())})),clearInterval(Y.pressureIntervals[U.identifier]),U.resetDirection(),U.trigger("end",U),Y.trigger("end "+U.id+":end",U),Y.ids.indexOf(U.identifier)>=0&&Y.ids.splice(Y.ids.indexOf(U.identifier),1),Y.actives.indexOf(U)>=0&&Y.actives.splice(Y.actives.indexOf(U),1),/(semi|static)/.test(l.mode)?Y.idles.push(U):Y.nipples.indexOf(U)>=0&&Y.nipples.splice(Y.nipples.indexOf(U),1),Y.manager.unbindDocument(),/(semi|static)/.test(l.mode)&&(Y.manager.ids[d.id]=d.identifier))},D.prototype.onDestroyed=function(K,Y){var l=this;l.nipples.indexOf(Y)>=0&&l.nipples.splice(l.nipples.indexOf(Y),1),l.actives.indexOf(Y)>=0&&l.actives.splice(l.actives.indexOf(Y),1),l.idles.indexOf(Y)>=0&&l.idles.splice(l.idles.indexOf(Y),1),l.ids.indexOf(Y.identifier)>=0&&l.ids.splice(l.ids.indexOf(Y.identifier),1),l.manager.removeIdentifier(Y.identifier),l.manager.unbindDocument()},D.prototype.destroy=function(){var K=this;for(var Y in K.unbindEvt(K.options.zone,"start"),K.nipples.forEach((function(K){K.destroy()})),K.pressureIntervals)K.pressureIntervals.hasOwnProperty(Y)&&clearInterval(K.pressureIntervals[Y]);K.trigger("destroyed",K.nipples),K.manager.unbindDocument(),K.off()};const B=D;function P(K){var Y=this;Y.ids={},Y.index=0,Y.collections=[],Y.scroll=m(),Y.config(K),Y.prepareCollections();var l=function(){var K;Y.collections.forEach((function(l){l.forEach((function(l){K=l.el.getBoundingClientRect(),l.position={x:Y.scroll.x+K.left,y:Y.scroll.y+K.top}}))}))};c(window,"resize",(function(){A(l)}));var v=function(){Y.scroll=m()};return c(window,"scroll",(function(){A(v)})),Y.collections}P.prototype=new T,P.constructor=P,P.prototype.prepareCollections=function(){var K=this;K.collections.create=K.create.bind(K),K.collections.on=K.on.bind(K),K.collections.off=K.off.bind(K),K.collections.destroy=K.destroy.bind(K),K.collections.get=function(Y){var l;return K.collections.every((function(K){return!(l=K.get(Y))})),l}},P.prototype.create=function(K){return this.createCollection(K)},P.prototype.createCollection=function(K){var Y=this,l=new B(Y,K);return Y.bindCollection(l),Y.collections.push(l),l},P.prototype.bindCollection=function(K){var Y,l=this,v=function(K,v){Y=K.type+" "+v.id+":"+K.type,l.trigger(Y,v)};K.on("destroyed",l.onDestroyed.bind(l)),K.on("shown hidden rested dir plain",v),K.on("dir:up dir:right dir:down dir:left",v),K.on("plain:up plain:right plain:down plain:left",v)},P.prototype.bindDocument=function(){var K=this;K.binded||(K.bindEvt(document,"move").bindEvt(document,"end"),K.binded=!0)},P.prototype.unbindDocument=function(K){var Y=this;Object.keys(Y.ids).length&&!0!==K||(Y.unbindEvt(document,"move").unbindEvt(document,"end"),Y.binded=!1)},P.prototype.getIdentifier=function(K){var Y;return K?void 0===(Y=void 0===K.identifier?K.pointerId:K.identifier)&&(Y=this.latest||0):Y=this.index,void 0===this.ids[Y]&&(this.ids[Y]=this.index,this.index+=1),this.latest=Y,this.ids[Y]},P.prototype.removeIdentifier=function(K){var Y={};for(var l in this.ids)if(this.ids[l]===K){Y.id=l,Y.identifier=this.ids[l],delete this.ids[l];break}return Y},P.prototype.onmove=function(K){return this.onAny("move",K),!1},P.prototype.onend=function(K){return this.onAny("end",K),!1},P.prototype.oncancel=function(K){return this.onAny("end",K),!1},P.prototype.onAny=function(K,Y){var l,v=this,U="processOn"+K.charAt(0).toUpperCase()+K.slice(1);Y=Z(Y);var d=function(K,Y,l){l.ids.indexOf(Y)>=0&&(l[U](K),K._found_=!0)};return W(Y,(function(K){l=v.getIdentifier(K),W(v.collections,d.bind(null,K,l)),K._found_||v.removeIdentifier(l)})),!1},P.prototype.destroy=function(){var K=this;K.unbindDocument(!0),K.ids={},K.index=0,K.collections.forEach((function(K){K.destroy()})),K.off()},P.prototype.onDestroyed=function(K,Y){var l=this;if(l.collections.indexOf(Y)<0)return!1;l.collections.splice(l.collections.indexOf(Y),1)};var G=new P;const Q={create:function(K){return G.create(K)},factory:G};return Y.default})(),K.exports=Y()},11736:(K,Y,l)=>{"use strict";const{Deflate:v,deflate:U,deflateRaw:d,gzip:A}=l(11743),{Inflate:c,inflate:t,inflateRaw:Z,ungzip:m}=l(11801),V=l(11784);K.exports.Deflate=v,K.exports.deflate=U,K.exports.deflateRaw=d,K.exports.gzip=A,K.exports.Inflate=c,K.exports.inflate=t,K.exports.inflateRaw=Z,K.exports.ungzip=m,K.exports.constants=V},11743:(K,Y,l)=>{"use strict";const v=l(11750),U=l(11788),d=l(11790),A=l(11776),c=l(11798),t=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_SYNC_FLUSH:m,Z_FULL_FLUSH:V,Z_FINISH:M,Z_OK:u,Z_STREAM_END:o,Z_DEFAULT_COMPRESSION:W,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:J}=l(11784);function n(K){this.options=U.assign({level:W,method:J,Ja:16384,windowBits:15,memLevel:8,strategy:g},K||{});let Y=this.options;Y.raw&&Y.windowBits>0?Y.windowBits=-Y.windowBits:Y.gzip&&Y.windowBits>0&&Y.windowBits<16&&(Y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;let l=v.deflateInit2(this.strm,Y.level,Y.method,Y.windowBits,Y.memLevel,Y.strategy);if(l!==u)throw new Error(A[l]);if(Y.header&&v.deflateSetHeader(this.strm,Y.header),Y.dictionary){let K;if(K="string"===typeof Y.dictionary?d.string2buf(Y.dictionary):"[object ArrayBuffer]"===t.call(Y.dictionary)?new Uint8Array(Y.dictionary):Y.dictionary,l=v.deflateSetDictionary(this.strm,K),l!==u)throw new Error(A[l]);this._dict_set=!0}}function R(K,Y){const l=new n(Y);if(l.push(K,!0),l.err)throw l.msg||A[l.err];return l.result}n.prototype.push=function(K,Y){const l=this.strm,U=this.options.Ja;let A,c;if(this.ended)return!1;for(c=Y===~~Y?Y:!0===Y?M:Z,"string"===typeof K?l.input=d.string2buf(K):"[object ArrayBuffer]"===t.call(K)?l.input=new Uint8Array(K):l.input=K,l.next_in=0,l.avail_in=l.input.length;;)if(0===l.avail_out&&(l.output=new Uint8Array(U),l.next_out=0,l.avail_out=U),(c===m||c===V)&&l.avail_out<=6)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else{if(A=v.deflate(l,c),A===o)return l.next_out>0&&this.onData(l.output.subarray(0,l.next_out)),A=v.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===u;if(0!==l.avail_out){if(c>0&&l.next_out>0)this.onData(l.output.subarray(0,l.next_out)),l.avail_out=0;else if(0===l.avail_in)break}else this.onData(l.output)}return!0},n.prototype.onData=function(K){this.chunks.push(K)},n.prototype.onEnd=function(K){K===u&&(this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.msg=this.strm.msg},K.exports.Deflate=n,K.exports.deflate=R,K.exports.deflateRaw=function(K,Y){return(Y=Y||{}).raw=!0,R(K,Y)},K.exports.gzip=function(K,Y){return(Y=Y||{}).gzip=!0,R(K,Y)},K.exports.constants=l(11784)},11801:(K,Y,l)=>{"use strict";const v=l(11807),U=l(11788),d=l(11790),A=l(11776),c=l(11798),t=l(11824),Z=Object.prototype.toString,{Z_NO_FLUSH:m,Z_FINISH:V,Z_OK:M,Z_STREAM_END:u,Z_NEED_DICT:o,Z_STREAM_ERROR:W,Z_DATA_ERROR:g,Z_MEM_ERROR:J}=l(11784);function n(K){this.options=U.assign({Ja:65536,windowBits:15,to:""},K||{});const Y=this.options;Y.raw&&Y.windowBits>=0&&Y.windowBits<16&&(Y.windowBits=-Y.windowBits,0===Y.windowBits&&(Y.windowBits=-15)),!(Y.windowBits>=0&&Y.windowBits<16)||K&&K.windowBits||(Y.windowBits+=32),Y.windowBits>15&&Y.windowBits<48&&0===(15&Y.windowBits)&&(Y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;let l=v.inflateInit2(this.strm,Y.windowBits);if(l!==M)throw new Error(A[l]);if(this.header=new t,v.inflateGetHeader(this.strm,this.header),Y.dictionary&&("string"===typeof Y.dictionary?Y.dictionary=d.string2buf(Y.dictionary):"[object ArrayBuffer]"===Z.call(Y.dictionary)&&(Y.dictionary=new Uint8Array(Y.dictionary)),Y.raw&&(l=v.inflateSetDictionary(this.strm,Y.dictionary),l!==M)))throw new Error(A[l])}function R(K,Y){const l=new n(Y);if(l.push(K),l.err)throw l.msg||A[l.err];return l.result}n.prototype.push=function(K,Y){const l=this.strm,U=this.options.Ja,A=this.options.dictionary;let c,t,n;if(this.ended)return!1;for(t=Y===~~Y?Y:!0===Y?V:m,"[object ArrayBuffer]"===Z.call(K)?l.input=new Uint8Array(K):l.input=K,l.next_in=0,l.avail_in=l.input.length;;){for(0===l.avail_out&&(l.output=new Uint8Array(U),l.next_out=0,l.avail_out=U),c=v.inflate(l,t),c===o&&A&&(c=v.inflateSetDictionary(l,A),c===M?c=v.inflate(l,t):c===g&&(c=o));l.avail_in>0&&c===u&&l.state.wrap>0&&0!==K[l.next_in];)v.inflateReset(l),c=v.inflate(l,t);switch(c){case W:case g:case o:case J:return this.onEnd(c),this.ended=!0,!1}if(n=l.avail_out,l.next_out&&(0===l.avail_out||c===u))if("string"===this.options.to){let K=d.utf8border(l.output,l.next_out),Y=l.next_out-K,v=d.buf2string(l.output,K);l.next_out=Y,l.avail_out=U-Y,Y&&l.output.set(l.output.subarray(K,K+Y),0),this.onData(v)}else this.onData(l.output.length===l.next_out?l.output:l.output.subarray(0,l.next_out));if(c!==M||0!==n){if(c===u)return c=v.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(0===l.avail_in)break}}return!0},n.prototype.onData=function(K){this.chunks.push(K)},n.prototype.onEnd=function(K){K===M&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.msg=this.strm.msg},K.exports.Inflate=n,K.exports.inflate=R,K.exports.inflateRaw=function(K,Y){return(Y=Y||{}).raw=!0,R(K,Y)},K.exports.ungzip=R,K.exports.constants=l(11784)},11788:K=>{"use strict";const Y=(K,Y)=>Object.prototype.hasOwnProperty.call(K,Y);K.exports.assign=function(K){const l=Array.prototype.slice.call(arguments,1);for(;l.length;){const v=l.shift();if(v){if("object"!==typeof v)throw new TypeError(v+"must be non-object");for(const l in v)Y(v,l)&&(K[l]=v[l])}}return K},K.exports.flattenChunks=K=>{let Y=0;for(let v=0,U=K.length;v<U;v++)Y+=K[v].length;const l=new Uint8Array(Y);for(let v=0,U=0,d=K.length;v<d;v++){let Y=K[v];l.set(Y,U),U+=Y.length}return l}},11790:K=>{"use strict";let Y=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(v){Y=!1}const l=new Uint8Array(256);for(let U=0;U<256;U++)l[U]=U>=252?6:U>=248?5:U>=240?4:U>=224?3:U>=192?2:1;l[254]=l[254]=1,K.exports.string2buf=K=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(K);let Y,l,v,U,d,A=K.length,c=0;for(U=0;U<A;U++)l=K.charCodeAt(U),55296===(64512&l)&&U+1<A&&(v=K.charCodeAt(U+1),56320===(64512&v)&&(l=65536+(l-55296<<10)+(v-56320),U++)),c+=l<128?1:l<2048?2:l<65536?3:4;for(Y=new Uint8Array(c),d=0,U=0;d<c;U++)l=K.charCodeAt(U),55296===(64512&l)&&U+1<A&&(v=K.charCodeAt(U+1),56320===(64512&v)&&(l=65536+(l-55296<<10)+(v-56320),U++)),l<128?Y[d++]=l:l<2048?(Y[d++]=192|l>>>6,Y[d++]=128|63&l):l<65536?(Y[d++]=224|l>>>12,Y[d++]=128|l>>>6&63,Y[d++]=128|63&l):(Y[d++]=240|l>>>18,Y[d++]=128|l>>>12&63,Y[d++]=128|l>>>6&63,Y[d++]=128|63&l);return Y};K.exports.buf2string=(K,v)=>{const U=v||K.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(K.subarray(0,v));let d,A;const c=new Array(2*U);for(A=0,d=0;d<U;){let Y=K[d++];if(Y<128){c[A++]=Y;continue}let v=l[Y];if(v>4)c[A++]=65533,d+=v-1;else{for(Y&=2===v?31:3===v?15:7;v>1&&d<U;)Y=Y<<6|63&K[d++],v--;v>1?c[A++]=65533:Y<65536?c[A++]=Y:(Y-=65536,c[A++]=55296|Y>>10&1023,c[A++]=56320|1023&Y)}}return((K,l)=>{if(l<65534&&K.subarray&&Y)return String.fromCharCode.apply(null,K.length===l?K:K.subarray(0,l));let v="";for(let Y=0;Y<l;Y++)v+=String.fromCharCode(K[Y]);return v})(c,A)},K.exports.utf8border=(K,Y)=>{(Y=Y||K.length)>K.length&&(Y=K.length);let v=Y-1;for(;v>=0&&128===(192&K[v]);)v--;return v<0||0===v?Y:v+l[K[v]]>Y?v:Y}},11761:K=>{"use strict";K.exports=(K,Y,l,v)=>{let U=65535&K,d=K>>>16&65535,A=0;for(;0!==l;){A=l>2e3?2e3:l,l-=A;do{U=U+Y[v++]|0,d=d+U|0}while(--A);U%=65521,d%=65521}return U|d<<16}},11784:K=>{"use strict";K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11768:K=>{"use strict";const Y=new Uint32Array((()=>{let K,Y=[];for(var l=0;l<256;l++){K=l;for(var v=0;v<8;v++)K=1&K?3988292384^K>>>1:K>>>1;Y[l]=K}return Y})());K.exports=(K,l,v,U)=>{const d=Y,A=U+v;K^=-1;for(let Y=U;Y<A;Y++)K=K>>>8^d[255&(K^l[Y])];return~K}},11750:(K,Y,l)=>{"use strict";const{_tr_init:v,_tr_stored_block:U,_tr_flush_block:d,_tr_tally:A,_tr_align:c}=l(11758),t=l(11761),Z=l(11768),m=l(11776),{Z_NO_FLUSH:V,Z_PARTIAL_FLUSH:M,Z_FULL_FLUSH:u,Z_FINISH:o,Z_BLOCK:W,Z_OK:g,Z_STREAM_END:J,Z_STREAM_ERROR:n,Z_DATA_ERROR:R,Z_BUF_ERROR:H,Z_DEFAULT_COMPRESSION:z,Z_FILTERED:r,Z_HUFFMAN_ONLY:E,Z_RLE:y,Z_FIXED:T,Z_DEFAULT_STRATEGY:e,Z_UNKNOWN:i,Z_DEFLATED:D}=l(11784),B=258,P=262,G=103,Q=113,X=666,f=(K,Y)=>(K.msg=m[Y],Y),w=K=>(K<<1)-(K>4?9:0),k=K=>{let Y=K.length;for(;--Y>=0;)K[Y]=0};let I=(K,Y,l)=>(Y<<K.hash_shift^l)&K.hash_mask;const L=K=>{const Y=K.state;let l=Y.pending;l>K.avail_out&&(l=K.avail_out),0!==l&&(K.output.set(Y.pending_buf.subarray(Y.pending_out,Y.pending_out+l),K.next_out),K.next_out+=l,Y.pending_out+=l,K.total_out+=l,K.avail_out-=l,Y.pending-=l,0===Y.pending&&(Y.pending_out=0))},a=(K,Y)=>{d(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,Y),K.block_start=K.strstart,L(K.strm)},F=(K,Y)=>{K.pending_buf[K.pending++]=Y},s=(K,Y)=>{K.pending_buf[K.pending++]=Y>>>8&255,K.pending_buf[K.pending++]=255&Y},b=(K,Y,l,v)=>{let U=K.avail_in;return U>v&&(U=v),0===U?0:(K.avail_in-=U,Y.set(K.input.subarray(K.next_in,K.next_in+U),l),1===K.state.wrap?K.adler=t(K.adler,Y,U,l):2===K.state.wrap&&(K.adler=Z(K.adler,Y,U,l)),K.next_in+=U,K.total_in+=U,U)},x=(K,Y)=>{let l,v,U=K.max_chain_length,d=K.strstart,A=K.prev_length,c=K.nice_match;const t=K.strstart>K.w_size-P?K.strstart-(K.w_size-P):0,Z=K.window,m=K.w_mask,V=K.prev,M=K.strstart+B;let u=Z[d+A-1],o=Z[d+A];K.prev_length>=K.good_match&&(U>>=2),c>K.lookahead&&(c=K.lookahead);do{if(l=Y,Z[l+A]===o&&Z[l+A-1]===u&&Z[l]===Z[d]&&Z[++l]===Z[d+1]){d+=2,l++;do{}while(Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&Z[++d]===Z[++l]&&d<M);if(v=B-(M-d),d=M-B,v>A){if(K.match_start=Y,A=v,v>=c)break;u=Z[d+A-1],o=Z[d+A]}}}while((Y=V[Y&m])>t&&0!==--U);return A<=K.lookahead?A:K.lookahead},C=K=>{const Y=K.w_size;let l,v,U,d,A;do{if(d=K.window_size-K.lookahead-K.strstart,K.strstart>=Y+(Y-P)){K.window.set(K.window.subarray(Y,Y+Y),0),K.match_start-=Y,K.strstart-=Y,K.block_start-=Y,v=K.hash_size,l=v;do{U=K.head[--l],K.head[l]=U>=Y?U-Y:0}while(--v);v=Y,l=v;do{U=K.prev[--l],K.prev[l]=U>=Y?U-Y:0}while(--v);d+=Y}if(0===K.strm.avail_in)break;if(v=b(K.strm,K.window,K.strstart+K.lookahead,d),K.lookahead+=v,K.lookahead+K.insert>=3)for(A=K.strstart-K.insert,K.ins_h=K.window[A],K.ins_h=I(K,K.ins_h,K.window[A+1]);K.insert&&(K.ins_h=I(K,K.ins_h,K.window[A+3-1]),K.prev[A&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=A,A++,K.insert--,!(K.lookahead+K.insert<3)););}while(K.lookahead<P&&0!==K.strm.avail_in)},N=(K,Y)=>{let l,v;for(;;){if(K.lookahead<P){if(C(K),K.lookahead<P&&Y===V)return 1;if(0===K.lookahead)break}if(l=0,K.lookahead>=3&&(K.ins_h=I(K,K.ins_h,K.window[K.strstart+3-1]),l=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),0!==l&&K.strstart-l<=K.w_size-P&&(K.match_length=x(K,l)),K.match_length>=3)if(v=A(K,K.strstart-K.match_start,K.match_length-3),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=3){K.match_length--;do{K.strstart++,K.ins_h=I(K,K.ins_h,K.window[K.strstart+3-1]),l=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart}while(0!==--K.match_length);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=I(K,K.ins_h,K.window[K.strstart+1]);else v=A(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(v&&(a(K,!1),0===K.strm.avail_out))return 1}return K.insert=K.strstart<2?K.strstart:2,Y===o?(a(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(a(K,!1),0===K.strm.avail_out)?1:2},j=(K,Y)=>{let l,v,U;for(;;){if(K.lookahead<P){if(C(K),K.lookahead<P&&Y===V)return 1;if(0===K.lookahead)break}if(l=0,K.lookahead>=3&&(K.ins_h=I(K,K.ins_h,K.window[K.strstart+3-1]),l=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=2,0!==l&&K.prev_length<K.max_lazy_match&&K.strstart-l<=K.w_size-P&&(K.match_length=x(K,l),K.match_length<=5&&(K.strategy===r||3===K.match_length&&K.strstart-K.match_start>4096)&&(K.match_length=2)),K.prev_length>=3&&K.match_length<=K.prev_length){U=K.strstart+K.lookahead-3,v=A(K,K.strstart-1-K.prev_match,K.prev_length-3),K.lookahead-=K.prev_length-1,K.prev_length-=2;do{++K.strstart<=U&&(K.ins_h=I(K,K.ins_h,K.window[K.strstart+3-1]),l=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart)}while(0!==--K.prev_length);if(K.match_available=0,K.match_length=2,K.strstart++,v&&(a(K,!1),0===K.strm.avail_out))return 1}else if(K.match_available){if(v=A(K,0,K.window[K.strstart-1]),v&&a(K,!1),K.strstart++,K.lookahead--,0===K.strm.avail_out)return 1}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(v=A(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<2?K.strstart:2,Y===o?(a(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(a(K,!1),0===K.strm.avail_out)?1:2};function p(K,Y,l,v,U){this.good_length=K,this.max_lazy=Y,this.nice_length=l,this.max_chain=v,this.func=U}const S=[new p(0,0,0,0,((K,Y)=>{let l=65535;for(l>K.pending_buf_size-5&&(l=K.pending_buf_size-5);;){if(K.lookahead<=1){if(C(K),0===K.lookahead&&Y===V)return 1;if(0===K.lookahead)break}K.strstart+=K.lookahead,K.lookahead=0;const v=K.block_start+l;if((0===K.strstart||K.strstart>=v)&&(K.lookahead=K.strstart-v,K.strstart=v,a(K,!1),0===K.strm.avail_out))return 1;if(K.strstart-K.block_start>=K.w_size-P&&(a(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,Y===o?(a(K,!0),0===K.strm.avail_out?3:4):(K.strstart>K.block_start&&(a(K,!1),K.strm.avail_out),1)})),new p(4,4,8,4,N),new p(4,5,16,8,N),new p(4,6,32,32,N),new p(4,4,16,16,j),new p(8,16,32,32,j),new p(8,16,128,128,j),new p(8,32,128,256,j),new p(32,128,258,1024,j),new p(32,258,258,4096,j)];function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),k(this.dyn_ltree),k(this.dyn_dtree),k(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),k(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),k(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const O=K=>{if(!K||!K.state)return f(K,n);K.total_in=K.total_out=0,K.data_type=i;const Y=K.state;return Y.pending=0,Y.pending_out=0,Y.wrap<0&&(Y.wrap=-Y.wrap),Y.status=Y.wrap?42:Q,K.adler=2===Y.wrap?0:1,Y.last_flush=V,v(Y),g},h=K=>{const Y=O(K);var l;return Y===g&&((l=K.state).window_size=2*l.w_size,k(l.head),l.max_lazy_match=S[l.level].max_lazy,l.good_match=S[l.level].good_length,l.nice_match=S[l.level].nice_length,l.max_chain_length=S[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0),Y},KK=(K,Y,l,v,U,d)=>{if(!K)return n;let A=1;if(Y===z&&(Y=6),v<0?(A=0,v=-v):v>15&&(A=2,v-=16),U<1||U>9||l!==D||v<8||v>15||Y<0||Y>9||d<0||d>T)return f(K,n);8===v&&(v=9);const c=new q;return K.state=c,c.strm=K,c.wrap=A,c.gzhead=null,c.w_bits=v,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=U+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<U+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=Y,c.strategy=d,c.method=l,h(K)};K.exports.deflateInit=(K,Y)=>KK(K,Y,D,15,8,e),K.exports.deflateInit2=KK,K.exports.deflateReset=h,K.exports.deflateResetKeep=O,K.exports.deflateSetHeader=(K,Y)=>K&&K.state?2!==K.state.wrap?n:(K.state.gzhead=Y,g):n,K.exports.deflate=(K,Y)=>{let l,v;if(!K||!K.state||Y>W||Y<0)return K?f(K,n):n;const d=K.state;if(!K.output||!K.input&&0!==K.avail_in||d.status===X&&Y!==o)return f(K,0===K.avail_out?H:n);d.strm=K;const t=d.last_flush;if(d.last_flush=Y,42===d.status)if(2===d.wrap)K.adler=0,F(d,31),F(d,139),F(d,8),d.gzhead?(F(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),F(d,255&d.gzhead.time),F(d,d.gzhead.time>>8&255),F(d,d.gzhead.time>>16&255),F(d,d.gzhead.time>>24&255),F(d,9===d.level?2:d.strategy>=E||d.level<2?4:0),F(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(F(d,255&d.gzhead.extra.length),F(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(K.adler=Z(K.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69):(F(d,0),F(d,0),F(d,0),F(d,0),F(d,0),F(d,9===d.level?2:d.strategy>=E||d.level<2?4:0),F(d,3),d.status=Q);else{let Y=D+(d.w_bits-8<<4)<<8,l=-1;l=d.strategy>=E||d.level<2?0:d.level<6?1:6===d.level?2:3,Y|=l<<6,0!==d.strstart&&(Y|=32),Y+=31-Y%31,d.status=Q,s(d,Y),0!==d.strstart&&(s(d,K.adler>>>16),s(d,65535&K.adler)),K.adler=1}if(69===d.status)if(d.gzhead.extra){for(l=d.pending;d.gzindex<(65535&d.gzhead.extra.length)&&(d.pending!==d.pending_buf_size||(d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),L(K),l=d.pending,d.pending!==d.pending_buf_size));)F(d,255&d.gzhead.extra[d.gzindex]),d.gzindex++;d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),d.gzindex===d.gzhead.extra.length&&(d.gzindex=0,d.status=73)}else d.status=73;if(73===d.status)if(d.gzhead.name){l=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),L(K),l=d.pending,d.pending===d.pending_buf_size)){v=1;break}v=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,F(d,v)}while(0!==v);d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),0===v&&(d.gzindex=0,d.status=91)}else d.status=91;if(91===d.status)if(d.gzhead.comment){l=d.pending;do{if(d.pending===d.pending_buf_size&&(d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),L(K),l=d.pending,d.pending===d.pending_buf_size)){v=1;break}v=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,F(d,v)}while(0!==v);d.gzhead.hcrc&&d.pending>l&&(K.adler=Z(K.adler,d.pending_buf,d.pending-l,l)),0===v&&(d.status=G)}else d.status=G;if(d.status===G&&(d.gzhead.hcrc?(d.pending+2>d.pending_buf_size&&L(K),d.pending+2<=d.pending_buf_size&&(F(d,255&K.adler),F(d,K.adler>>8&255),K.adler=0,d.status=Q)):d.status=Q),0!==d.pending){if(L(K),0===K.avail_out)return d.last_flush=-1,g}else if(0===K.avail_in&&w(Y)<=w(t)&&Y!==o)return f(K,H);if(d.status===X&&0!==K.avail_in)return f(K,H);if(0!==K.avail_in||0!==d.lookahead||Y!==V&&d.status!==X){let l=d.strategy===E?((K,Y)=>{let l;for(;;){if(0===K.lookahead&&(C(K),0===K.lookahead)){if(Y===V)return 1;break}if(K.match_length=0,l=A(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,l&&(a(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,Y===o?(a(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(a(K,!1),0===K.strm.avail_out)?1:2})(d,Y):d.strategy===y?((K,Y)=>{let l,v,U,d;const c=K.window;for(;;){if(K.lookahead<=B){if(C(K),K.lookahead<=B&&Y===V)return 1;if(0===K.lookahead)break}if(K.match_length=0,K.lookahead>=3&&K.strstart>0&&(U=K.strstart-1,v=c[U],v===c[++U]&&v===c[++U]&&v===c[++U])){d=K.strstart+B;do{}while(v===c[++U]&&v===c[++U]&&v===c[++U]&&v===c[++U]&&v===c[++U]&&v===c[++U]&&v===c[++U]&&v===c[++U]&&U<d);K.match_length=B-(d-U),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=3?(l=A(K,1,K.match_length-3),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(l=A(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),l&&(a(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,Y===o?(a(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(a(K,!1),0===K.strm.avail_out)?1:2})(d,Y):S[d.level].func(d,Y);if(3!==l&&4!==l||(d.status=X),1===l||3===l)return 0===K.avail_out&&(d.last_flush=-1),g;if(2===l&&(Y===M?c(d):Y!==W&&(U(d,0,0,!1),Y===u&&(k(d.head),0===d.lookahead&&(d.strstart=0,d.block_start=0,d.insert=0))),L(K),0===K.avail_out))return d.last_flush=-1,g}return Y!==o?g:d.wrap<=0?J:(2===d.wrap?(F(d,255&K.adler),F(d,K.adler>>8&255),F(d,K.adler>>16&255),F(d,K.adler>>24&255),F(d,255&K.total_in),F(d,K.total_in>>8&255),F(d,K.total_in>>16&255),F(d,K.total_in>>24&255)):(s(d,K.adler>>>16),s(d,65535&K.adler)),L(K),d.wrap>0&&(d.wrap=-d.wrap),0!==d.pending?g:J)},K.exports.deflateEnd=K=>{if(!K||!K.state)return n;const Y=K.state.status;return 42!==Y&&69!==Y&&73!==Y&&91!==Y&&Y!==G&&Y!==Q&&Y!==X?f(K,n):(K.state=null,Y===Q?f(K,R):g)},K.exports.deflateSetDictionary=(K,Y)=>{let l=Y.length;if(!K||!K.state)return n;const v=K.state,U=v.wrap;if(2===U||1===U&&42!==v.status||v.lookahead)return n;if(1===U&&(K.adler=t(K.adler,Y,l,0)),v.wrap=0,l>=v.w_size){0===U&&(k(v.head),v.strstart=0,v.block_start=0,v.insert=0);let K=new Uint8Array(v.w_size);K.set(Y.subarray(l-v.w_size,l),0),Y=K,l=v.w_size}const d=K.avail_in,A=K.next_in,c=K.input;for(K.avail_in=l,K.next_in=0,K.input=Y,C(v);v.lookahead>=3;){let K=v.strstart,Y=v.lookahead-2;do{v.ins_h=I(v,v.ins_h,v.window[K+3-1]),v.prev[K&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=K,K++}while(--Y);v.strstart=K,v.lookahead=2,C(v)}return v.strstart+=v.lookahead,v.block_start=v.strstart,v.insert=v.lookahead,v.lookahead=0,v.match_length=v.prev_length=2,v.match_available=0,K.next_in=A,K.input=c,K.avail_in=d,v.wrap=U,g},K.exports.deflateInfo="pako deflate (from Nodeca project)"},11824:K=>{"use strict";K.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11809:K=>{"use strict";K.exports=function(K,Y){let l,v,U,d,A,c,t,Z,m,V,M,u,o,W,g,J,n,R,H,z,r,E,y,T;const e=K.state;l=K.next_in,y=K.input,v=l+(K.avail_in-5),U=K.next_out,T=K.output,d=U-(Y-K.avail_out),A=U+(K.avail_out-257),c=e.dmax,t=e.wsize,Z=e.whave,m=e.wnext,V=e.window,M=e.hold,u=e.bits,o=e.lencode,W=e.distcode,g=(1<<e.lenbits)-1,J=(1<<e.distbits)-1;K:do{u<15&&(M+=y[l++]<<u,u+=8,M+=y[l++]<<u,u+=8),n=o[M&g];Y:for(;;){if(R=n>>>24,M>>>=R,u-=R,R=n>>>16&255,0===R)T[U++]=65535&n;else{if(!(16&R)){if(0===(64&R)){n=o[(65535&n)+(M&(1<<R)-1)];continue Y}if(32&R){e.mode=12;break K}K.msg="invalid literal/length code",e.mode=30;break K}H=65535&n,R&=15,R&&(u<R&&(M+=y[l++]<<u,u+=8),H+=M&(1<<R)-1,M>>>=R,u-=R),u<15&&(M+=y[l++]<<u,u+=8,M+=y[l++]<<u,u+=8),n=W[M&J];l:for(;;){if(R=n>>>24,M>>>=R,u-=R,R=n>>>16&255,!(16&R)){if(0===(64&R)){n=W[(65535&n)+(M&(1<<R)-1)];continue l}K.msg="invalid distance code",e.mode=30;break K}if(z=65535&n,R&=15,u<R&&(M+=y[l++]<<u,u+=8,u<R&&(M+=y[l++]<<u,u+=8)),z+=M&(1<<R)-1,z>c){K.msg="invalid distance too far back",e.mode=30;break K}if(M>>>=R,u-=R,R=U-d,z>R){if(R=z-R,R>Z&&e.sane){K.msg="invalid distance too far back",e.mode=30;break K}if(r=0,E=V,0===m){if(r+=t-R,R<H){H-=R;do{T[U++]=V[r++]}while(--R);r=U-z,E=T}}else if(m<R){if(r+=t+m-R,R-=m,R<H){H-=R;do{T[U++]=V[r++]}while(--R);if(r=0,m<H){R=m,H-=R;do{T[U++]=V[r++]}while(--R);r=U-z,E=T}}}else if(r+=m-R,R<H){H-=R;do{T[U++]=V[r++]}while(--R);r=U-z,E=T}for(;H>2;)T[U++]=E[r++],T[U++]=E[r++],T[U++]=E[r++],H-=3;H&&(T[U++]=E[r++],H>1&&(T[U++]=E[r++]))}else{r=U-z;do{T[U++]=T[r++],T[U++]=T[r++],T[U++]=T[r++],H-=3}while(H>2);H&&(T[U++]=T[r++],H>1&&(T[U++]=T[r++]))}break}}break}}while(l<v&&U<A);H=u>>3,l-=H,u-=H<<3,M&=(1<<u)-1,K.next_in=l,K.next_out=U,K.avail_in=l<v?v-l+5:5-(l-v),K.avail_out=U<A?A-U+257:257-(U-A),e.hold=M,e.bits=u}},11807:(K,Y,l)=>{"use strict";const v=l(11761),U=l(11768),d=l(11809),A=l(11818),{Z_FINISH:c,Z_BLOCK:t,Z_TREES:Z,Z_OK:m,Z_STREAM_END:V,Z_NEED_DICT:M,Z_STREAM_ERROR:u,Z_DATA_ERROR:o,Z_MEM_ERROR:W,Z_BUF_ERROR:g,Z_DEFLATED:J}=l(11784),n=12,R=30,H=K=>(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24);function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const r=K=>{if(!K||!K.state)return u;const Y=K.state;return K.total_in=K.total_out=Y.total=0,K.msg="",Y.wrap&&(K.adler=1&Y.wrap),Y.mode=1,Y.last=0,Y.havedict=0,Y.dmax=32768,Y.head=null,Y.hold=0,Y.bits=0,Y.lencode=Y.lendyn=new Int32Array(852),Y.distcode=Y.distdyn=new Int32Array(592),Y.sane=1,Y.back=-1,m},E=K=>{if(!K||!K.state)return u;const Y=K.state;return Y.wsize=0,Y.whave=0,Y.wnext=0,r(K)},y=(K,Y)=>{let l;if(!K||!K.state)return u;const v=K.state;return Y<0?(l=0,Y=-Y):(l=1+(Y>>4),Y<48&&(Y&=15)),Y&&(Y<8||Y>15)?u:(null!==v.window&&v.wbits!==Y&&(v.window=null),v.wrap=l,v.wbits=Y,E(K))},T=(K,Y)=>{if(!K)return u;const l=new z;K.state=l,l.window=null;const v=y(K,Y);return v!==m&&(K.state=null),v};let e,i,D=!0;const B=K=>{if(D){e=new Int32Array(512),i=new Int32Array(32);let Y=0;for(;Y<144;)K.lens[Y++]=8;for(;Y<256;)K.lens[Y++]=9;for(;Y<280;)K.lens[Y++]=7;for(;Y<288;)K.lens[Y++]=8;for(A(1,K.lens,0,288,e,0,K.work,{bits:9}),Y=0;Y<32;)K.lens[Y++]=5;A(2,K.lens,0,32,i,0,K.work,{bits:5}),D=!1}K.lencode=e,K.lenbits=9,K.distcode=i,K.distbits=5},P=(K,Y,l,v)=>{let U;const d=K.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),v>=d.wsize?(d.window.set(Y.subarray(l-d.wsize,l),0),d.wnext=0,d.whave=d.wsize):(U=d.wsize-d.wnext,U>v&&(U=v),d.window.set(Y.subarray(l-v,l-v+U),d.wnext),(v-=U)?(d.window.set(Y.subarray(l-v,l),0),d.wnext=v,d.whave=d.wsize):(d.wnext+=U,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=U))),0};K.exports.inflateReset=E,K.exports.inflateReset2=y,K.exports.inflateResetKeep=r,K.exports.inflateInit=K=>T(K,15),K.exports.inflateInit2=T,K.exports.inflate=(K,Y)=>{let l,z,r,E,y,T,e,i,D,G,Q,X,f,w,k,I,L,a,F,s,b,x,C=0;const N=new Uint8Array(4);let j,p;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!K||!K.state||!K.output||!K.input&&0!==K.avail_in)return u;l=K.state,l.mode===n&&(l.mode=13),y=K.next_out,r=K.output,e=K.avail_out,E=K.next_in,z=K.input,T=K.avail_in,i=l.hold,D=l.bits,G=T,Q=e,x=m;K:for(;;)switch(l.mode){case 1:if(0===l.wrap){l.mode=13;break}for(;D<16;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(2&l.wrap&&35615===i){l.check=0,N[0]=255&i,N[1]=i>>>8&255,l.check=U(l.check,N,2,0),i=0,D=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&i)<<8)+(i>>8))%31){K.msg="incorrect header check",l.mode=R;break}if((15&i)!==J){K.msg="unknown compression method",l.mode=R;break}if(i>>>=4,D-=4,b=8+(15&i),0===l.wbits)l.wbits=b;else if(b>l.wbits){K.msg="invalid window size",l.mode=R;break}l.dmax=1<<l.wbits,K.adler=l.check=1,l.mode=512&i?10:n,i=0,D=0;break;case 2:for(;D<16;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(l.flags=i,(255&l.flags)!==J){K.msg="unknown compression method",l.mode=R;break}if(57344&l.flags){K.msg="unknown header flags set",l.mode=R;break}l.head&&(l.head.text=i>>8&1),512&l.flags&&(N[0]=255&i,N[1]=i>>>8&255,l.check=U(l.check,N,2,0)),i=0,D=0,l.mode=3;case 3:for(;D<32;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.head&&(l.head.time=i),512&l.flags&&(N[0]=255&i,N[1]=i>>>8&255,N[2]=i>>>16&255,N[3]=i>>>24&255,l.check=U(l.check,N,4,0)),i=0,D=0,l.mode=4;case 4:for(;D<16;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.head&&(l.head.xflags=255&i,l.head.os=i>>8),512&l.flags&&(N[0]=255&i,N[1]=i>>>8&255,l.check=U(l.check,N,2,0)),i=0,D=0,l.mode=5;case 5:if(1024&l.flags){for(;D<16;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.length=i,l.head&&(l.head.extra_len=i),512&l.flags&&(N[0]=255&i,N[1]=i>>>8&255,l.check=U(l.check,N,2,0)),i=0,D=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(X=l.length,X>T&&(X=T),X&&(l.head&&(b=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Uint8Array(l.head.extra_len)),l.head.extra.set(z.subarray(E,E+X),b)),512&l.flags&&(l.check=U(l.check,z,X,E)),T-=X,E+=X,l.length-=X),l.length))break K;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(0===T)break K;X=0;do{b=z[E+X++],l.head&&b&&l.length<65536&&(l.head.name+=String.fromCharCode(b))}while(b&&X<T);if(512&l.flags&&(l.check=U(l.check,z,X,E)),T-=X,E+=X,b)break K}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(0===T)break K;X=0;do{b=z[E+X++],l.head&&b&&l.length<65536&&(l.head.comment+=String.fromCharCode(b))}while(b&&X<T);if(512&l.flags&&(l.check=U(l.check,z,X,E)),T-=X,E+=X,b)break K}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;D<16;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(i!==(65535&l.check)){K.msg="header crc mismatch",l.mode=R;break}i=0,D=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),K.adler=l.check=0,l.mode=n;break;case 10:for(;D<32;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}K.adler=l.check=H(i),i=0,D=0,l.mode=11;case 11:if(0===l.havedict)return K.next_out=y,K.avail_out=e,K.next_in=E,K.avail_in=T,l.hold=i,l.bits=D,M;K.adler=l.check=1,l.mode=n;case n:if(Y===t||Y===Z)break K;case 13:if(l.last){i>>>=7&D,D-=7&D,l.mode=27;break}for(;D<3;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}switch(l.last=1&i,i>>>=1,D-=1,3&i){case 0:l.mode=14;break;case 1:if(B(l),l.mode=20,Y===Z){i>>>=2,D-=2;break K}break;case 2:l.mode=17;break;case 3:K.msg="invalid block type",l.mode=R}i>>>=2,D-=2;break;case 14:for(i>>>=7&D,D-=7&D;D<32;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if((65535&i)!==(i>>>16^65535)){K.msg="invalid stored block lengths",l.mode=R;break}if(l.length=65535&i,i=0,D=0,l.mode=15,Y===Z)break K;case 15:l.mode=16;case 16:if(X=l.length,X){if(X>T&&(X=T),X>e&&(X=e),0===X)break K;r.set(z.subarray(E,E+X),y),T-=X,E+=X,e-=X,y+=X,l.length-=X;break}l.mode=n;break;case 17:for(;D<14;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(l.nlen=257+(31&i),i>>>=5,D-=5,l.ndist=1+(31&i),i>>>=5,D-=5,l.ncode=4+(15&i),i>>>=4,D-=4,l.nlen>286||l.ndist>30){K.msg="too many length or distance symbols",l.mode=R;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;D<3;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.lens[S[l.have++]]=7&i,i>>>=3,D-=3}for(;l.have<19;)l.lens[S[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,j={bits:l.lenbits},x=A(0,l.lens,0,19,l.lencode,0,l.work,j),l.lenbits=j.bits,x){K.msg="invalid code lengths set",l.mode=R;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;C=l.lencode[i&(1<<l.lenbits)-1],k=C>>>24,I=C>>>16&255,L=65535&C,!(k<=D);){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(L<16)i>>>=k,D-=k,l.lens[l.have++]=L;else{if(16===L){for(p=k+2;D<p;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(i>>>=k,D-=k,0===l.have){K.msg="invalid bit length repeat",l.mode=R;break}b=l.lens[l.have-1],X=3+(3&i),i>>>=2,D-=2}else if(17===L){for(p=k+3;D<p;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}i>>>=k,D-=k,b=0,X=3+(7&i),i>>>=3,D-=3}else{for(p=k+7;D<p;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}i>>>=k,D-=k,b=0,X=11+(127&i),i>>>=7,D-=7}if(l.have+X>l.nlen+l.ndist){K.msg="invalid bit length repeat",l.mode=R;break}for(;X--;)l.lens[l.have++]=b}}if(l.mode===R)break;if(0===l.lens[256]){K.msg="invalid code -- missing end-of-block",l.mode=R;break}if(l.lenbits=9,j={bits:l.lenbits},x=A(1,l.lens,0,l.nlen,l.lencode,0,l.work,j),l.lenbits=j.bits,x){K.msg="invalid literal/lengths set",l.mode=R;break}if(l.distbits=6,l.distcode=l.distdyn,j={bits:l.distbits},x=A(2,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,j),l.distbits=j.bits,x){K.msg="invalid distances set",l.mode=R;break}if(l.mode=20,Y===Z)break K;case 20:l.mode=21;case 21:if(T>=6&&e>=258){K.next_out=y,K.avail_out=e,K.next_in=E,K.avail_in=T,l.hold=i,l.bits=D,d(K,Q),y=K.next_out,r=K.output,e=K.avail_out,E=K.next_in,z=K.input,T=K.avail_in,i=l.hold,D=l.bits,l.mode===n&&(l.back=-1);break}for(l.back=0;C=l.lencode[i&(1<<l.lenbits)-1],k=C>>>24,I=C>>>16&255,L=65535&C,!(k<=D);){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(I&&0===(240&I)){for(a=k,F=I,s=L;C=l.lencode[s+((i&(1<<a+F)-1)>>a)],k=C>>>24,I=C>>>16&255,L=65535&C,!(a+k<=D);){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}i>>>=a,D-=a,l.back+=a}if(i>>>=k,D-=k,l.back+=k,l.length=L,0===I){l.mode=26;break}if(32&I){l.back=-1,l.mode=n;break}if(64&I){K.msg="invalid literal/length code",l.mode=R;break}l.extra=15&I,l.mode=22;case 22:if(l.extra){for(p=l.extra;D<p;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.length+=i&(1<<l.extra)-1,i>>>=l.extra,D-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;C=l.distcode[i&(1<<l.distbits)-1],k=C>>>24,I=C>>>16&255,L=65535&C,!(k<=D);){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(0===(240&I)){for(a=k,F=I,s=L;C=l.distcode[s+((i&(1<<a+F)-1)>>a)],k=C>>>24,I=C>>>16&255,L=65535&C,!(a+k<=D);){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}i>>>=a,D-=a,l.back+=a}if(i>>>=k,D-=k,l.back+=k,64&I){K.msg="invalid distance code",l.mode=R;break}l.offset=L,l.extra=15&I,l.mode=24;case 24:if(l.extra){for(p=l.extra;D<p;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}l.offset+=i&(1<<l.extra)-1,i>>>=l.extra,D-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){K.msg="invalid distance too far back",l.mode=R;break}l.mode=25;case 25:if(0===e)break K;if(X=Q-e,l.offset>X){if(X=l.offset-X,X>l.whave&&l.sane){K.msg="invalid distance too far back",l.mode=R;break}X>l.wnext?(X-=l.wnext,f=l.wsize-X):f=l.wnext-X,X>l.length&&(X=l.length),w=l.window}else w=r,f=y-l.offset,X=l.length;X>e&&(X=e),e-=X,l.length-=X;do{r[y++]=w[f++]}while(--X);0===l.length&&(l.mode=21);break;case 26:if(0===e)break K;r[y++]=l.length,e--,l.mode=21;break;case 27:if(l.wrap){for(;D<32;){if(0===T)break K;T--,i|=z[E++]<<D,D+=8}if(Q-=e,K.total_out+=Q,l.total+=Q,Q&&(K.adler=l.check=l.flags?U(l.check,r,Q,y-Q):v(l.check,r,Q,y-Q)),Q=e,(l.flags?i:H(i))!==l.check){K.msg="incorrect data check",l.mode=R;break}i=0,D=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;D<32;){if(0===T)break K;T--,i+=z[E++]<<D,D+=8}if(i!==(4294967295&l.total)){K.msg="incorrect length check",l.mode=R;break}i=0,D=0}l.mode=29;case 29:x=V;break K;case R:x=o;break K;case 31:return W;default:return u}return K.next_out=y,K.avail_out=e,K.next_in=E,K.avail_in=T,l.hold=i,l.bits=D,(l.wsize||Q!==K.avail_out&&l.mode<R&&(l.mode<27||Y!==c))&&P(K,K.output,K.next_out,Q-K.avail_out)?(l.mode=31,W):(G-=K.avail_in,Q-=K.avail_out,K.total_in+=G,K.total_out+=Q,l.total+=Q,l.wrap&&Q&&(K.adler=l.check=l.flags?U(l.check,r,Q,K.next_out-Q):v(l.check,r,Q,K.next_out-Q)),K.data_type=l.bits+(l.last?64:0)+(l.mode===n?128:0)+(20===l.mode||15===l.mode?256:0),(0===G&&0===Q||Y===c)&&x===m&&(x=g),x)},K.exports.inflateEnd=K=>{if(!K||!K.state)return u;let Y=K.state;return Y.window&&(Y.window=null),K.state=null,m},K.exports.inflateGetHeader=(K,Y)=>{if(!K||!K.state)return u;const l=K.state;return 0===(2&l.wrap)?u:(l.head=Y,Y.done=!1,m)},K.exports.inflateSetDictionary=(K,Y)=>{const l=Y.length;let U,d,A;return K&&K.state?(U=K.state,0!==U.wrap&&11!==U.mode?u:11===U.mode&&(d=1,d=v(d,Y,l,0),d!==U.check)?o:(A=P(K,Y,l,l),A?(U.mode=31,W):(U.havedict=1,m))):u},K.exports.inflateInfo="pako inflate (from Nodeca project)"},11818:K=>{"use strict";const Y=15,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),v=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),d=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);K.exports=(K,A,c,t,Z,m,V,M)=>{const u=M.bits;let o,W,g,J,n,R,H=0,z=0,r=0,E=0,y=0,T=0,e=0,i=0,D=0,B=0,P=null,G=0;const Q=new Uint16Array(16),X=new Uint16Array(16);let f,w,k,I=null,L=0;for(H=0;H<=Y;H++)Q[H]=0;for(z=0;z<t;z++)Q[A[c+z]]++;for(y=u,E=Y;E>=1&&0===Q[E];E--);if(y>E&&(y=E),0===E)return Z[m++]=20971520,Z[m++]=20971520,M.bits=1,0;for(r=1;r<E&&0===Q[r];r++);for(y<r&&(y=r),i=1,H=1;H<=Y;H++)if(i<<=1,i-=Q[H],i<0)return-1;if(i>0&&(0===K||1!==E))return-1;for(X[1]=0,H=1;H<Y;H++)X[H+1]=X[H]+Q[H];for(z=0;z<t;z++)0!==A[c+z]&&(V[X[A[c+z]]++]=z);if(0===K?(P=I=V,R=19):1===K?(P=l,G-=257,I=v,L-=257,R=256):(P=U,I=d,R=-1),B=0,z=0,H=r,n=m,T=y,e=0,g=-1,D=1<<y,J=D-1,1===K&&D>852||2===K&&D>592)return 1;for(;;){f=H-e,V[z]<R?(w=0,k=V[z]):V[z]>R?(w=I[L+V[z]],k=P[G+V[z]]):(w=96,k=0),o=1<<H-e,W=1<<T,r=W;do{W-=o,Z[n+(B>>e)+W]=f<<24|w<<16|k}while(0!==W);for(o=1<<H-1;B&o;)o>>=1;if(0!==o?(B&=o-1,B+=o):B=0,z++,0===--Q[H]){if(H===E)break;H=A[c+V[z]]}if(H>y&&(B&J)!==g){for(0===e&&(e=y),n+=r,T=H-e,i=1<<T;T+e<E&&(i-=Q[T+e],!(i<=0));)T++,i<<=1;if(D+=1<<T,1===K&&D>852||2===K&&D>592)return 1;g=B&J,Z[g]=y<<24|T<<16|n-m}}return 0!==B&&(Z[n+B]=H-e<<24|64<<16),M.bits=y,0}},11776:K=>{"use strict";K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11758:K=>{"use strict";function Y(K){let Y=K.length;for(;--Y>=0;)K[Y]=0}const l=256,v=286,U=30,d=15,A=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),c=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Array(576);Y(m);const V=new Array(60);Y(V);const M=new Array(512);Y(M);const u=new Array(256);Y(u);const o=new Array(29);Y(o);const W=new Array(U);function g(K,Y,l,v,U){this.static_tree=K,this.extra_bits=Y,this.extra_base=l,this.elems=v,this.max_length=U,this.has_stree=K&&K.length}let J,n,R;function H(K,Y){this.dyn_tree=K,this.max_code=0,this.stat_desc=Y}Y(W);const z=K=>K<256?M[K]:M[256+(K>>>7)],r=(K,Y)=>{K.pending_buf[K.pending++]=255&Y,K.pending_buf[K.pending++]=Y>>>8&255},E=(K,Y,l)=>{K.bi_valid>16-l?(K.bi_buf|=Y<<K.bi_valid&65535,r(K,K.bi_buf),K.bi_buf=Y>>16-K.bi_valid,K.bi_valid+=l-16):(K.bi_buf|=Y<<K.bi_valid&65535,K.bi_valid+=l)},y=(K,Y,l)=>{E(K,l[2*Y],l[2*Y+1])},T=(K,Y)=>{let l=0;do{l|=1&K,K>>>=1,l<<=1}while(--Y>0);return l>>>1},e=(K,Y,l)=>{const v=new Array(16);let U,A,c=0;for(U=1;U<=d;U++)v[U]=c=c+l[U-1]<<1;for(A=0;A<=Y;A++){let Y=K[2*A+1];0!==Y&&(K[2*A]=T(v[Y]++,Y))}},i=K=>{let Y;for(Y=0;Y<v;Y++)K.dyn_ltree[2*Y]=0;for(Y=0;Y<U;Y++)K.dyn_dtree[2*Y]=0;for(Y=0;Y<19;Y++)K.bl_tree[2*Y]=0;K.dyn_ltree[512]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0},D=K=>{K.bi_valid>8?r(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0},B=(K,Y,l,v)=>{const U=2*Y,d=2*l;return K[U]<K[d]||K[U]===K[d]&&v[Y]<=v[l]},P=(K,Y,l)=>{const v=K.heap[l];let U=l<<1;for(;U<=K.heap_len&&(U<K.heap_len&&B(Y,K.heap[U+1],K.heap[U],K.depth)&&U++,!B(Y,v,K.heap[U],K.depth));)K.heap[l]=K.heap[U],l=U,U<<=1;K.heap[l]=v},G=(K,Y,v)=>{let U,d,t,Z,m=0;if(0!==K.last_lit)do{U=K.pending_buf[K.d_buf+2*m]<<8|K.pending_buf[K.d_buf+2*m+1],d=K.pending_buf[K.l_buf+m],m++,0===U?y(K,d,Y):(t=u[d],y(K,t+l+1,Y),Z=A[t],0!==Z&&(d-=o[t],E(K,d,Z)),U--,t=z(U),y(K,t,v),Z=c[t],0!==Z&&(U-=W[t],E(K,U,Z)))}while(m<K.last_lit);y(K,256,Y)},Q=(K,Y)=>{const l=Y.dyn_tree,v=Y.stat_desc.static_tree,U=Y.stat_desc.has_stree,A=Y.stat_desc.elems;let c,t,Z,m=-1;for(K.heap_len=0,K.heap_max=573,c=0;c<A;c++)0!==l[2*c]?(K.heap[++K.heap_len]=m=c,K.depth[c]=0):l[2*c+1]=0;for(;K.heap_len<2;)Z=K.heap[++K.heap_len]=m<2?++m:0,l[2*Z]=1,K.depth[Z]=0,K.opt_len--,U&&(K.static_len-=v[2*Z+1]);for(Y.max_code=m,c=K.heap_len>>1;c>=1;c--)P(K,l,c);Z=A;do{c=K.heap[1],K.heap[1]=K.heap[K.heap_len--],P(K,l,1),t=K.heap[1],K.heap[--K.heap_max]=c,K.heap[--K.heap_max]=t,l[2*Z]=l[2*c]+l[2*t],K.depth[Z]=(K.depth[c]>=K.depth[t]?K.depth[c]:K.depth[t])+1,l[2*c+1]=l[2*t+1]=Z,K.heap[1]=Z++,P(K,l,1)}while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],((K,Y)=>{const l=Y.dyn_tree,v=Y.max_code,U=Y.stat_desc.static_tree,A=Y.stat_desc.has_stree,c=Y.stat_desc.extra_bits,t=Y.stat_desc.extra_base,Z=Y.stat_desc.max_length;let m,V,M,u,o,W,g=0;for(u=0;u<=d;u++)K.bl_count[u]=0;for(l[2*K.heap[K.heap_max]+1]=0,m=K.heap_max+1;m<573;m++)V=K.heap[m],u=l[2*l[2*V+1]+1]+1,u>Z&&(u=Z,g++),l[2*V+1]=u,V>v||(K.bl_count[u]++,o=0,V>=t&&(o=c[V-t]),W=l[2*V],K.opt_len+=W*(u+o),A&&(K.static_len+=W*(U[2*V+1]+o)));if(0!==g){do{for(u=Z-1;0===K.bl_count[u];)u--;K.bl_count[u]--,K.bl_count[u+1]+=2,K.bl_count[Z]--,g-=2}while(g>0);for(u=Z;0!==u;u--)for(V=K.bl_count[u];0!==V;)M=K.heap[--m],M>v||(l[2*M+1]!==u&&(K.opt_len+=(u-l[2*M+1])*l[2*M],l[2*M+1]=u),V--)}})(K,Y),e(l,m,K.bl_count)},X=(K,Y,l)=>{let v,U,d=-1,A=Y[1],c=0,t=7,Z=4;for(0===A&&(t=138,Z=3),Y[2*(l+1)+1]=65535,v=0;v<=l;v++)U=A,A=Y[2*(v+1)+1],++c<t&&U===A||(c<Z?K.bl_tree[2*U]+=c:0!==U?(U!==d&&K.bl_tree[2*U]++,K.bl_tree[32]++):c<=10?K.bl_tree[34]++:K.bl_tree[36]++,c=0,d=U,0===A?(t=138,Z=3):U===A?(t=6,Z=3):(t=7,Z=4))},f=(K,Y,l)=>{let v,U,d=-1,A=Y[1],c=0,t=7,Z=4;for(0===A&&(t=138,Z=3),v=0;v<=l;v++)if(U=A,A=Y[2*(v+1)+1],!(++c<t&&U===A)){if(c<Z)do{y(K,U,K.bl_tree)}while(0!==--c);else 0!==U?(U!==d&&(y(K,U,K.bl_tree),c--),y(K,16,K.bl_tree),E(K,c-3,2)):c<=10?(y(K,17,K.bl_tree),E(K,c-3,3)):(y(K,18,K.bl_tree),E(K,c-11,7));c=0,d=U,0===A?(t=138,Z=3):U===A?(t=6,Z=3):(t=7,Z=4)}};let w=!1;const k=(K,Y,l,v)=>{E(K,0+(v?1:0),3),((K,Y,l,v)=>{D(K),v&&(r(K,l),r(K,~l)),K.pending_buf.set(K.window.subarray(Y,Y+l),K.pending),K.pending+=l})(K,Y,l,!0)};K.exports._tr_init=K=>{w||((()=>{let K,Y,l,Z,H;const z=new Array(16);for(l=0,Z=0;Z<28;Z++)for(o[Z]=l,K=0;K<1<<A[Z];K++)u[l++]=Z;for(u[l-1]=Z,H=0,Z=0;Z<16;Z++)for(W[Z]=H,K=0;K<1<<c[Z];K++)M[H++]=Z;for(H>>=7;Z<U;Z++)for(W[Z]=H<<7,K=0;K<1<<c[Z]-7;K++)M[256+H++]=Z;for(Y=0;Y<=d;Y++)z[Y]=0;for(K=0;K<=143;)m[2*K+1]=8,K++,z[8]++;for(;K<=255;)m[2*K+1]=9,K++,z[9]++;for(;K<=279;)m[2*K+1]=7,K++,z[7]++;for(;K<=287;)m[2*K+1]=8,K++,z[8]++;for(e(m,287,z),K=0;K<U;K++)V[2*K+1]=5,V[2*K]=T(K,5);J=new g(m,A,257,v,d),n=new g(V,c,0,U,d),R=new g(new Array(0),t,0,19,7)})(),w=!0),K.l_desc=new H(K.dyn_ltree,J),K.d_desc=new H(K.dyn_dtree,n),K.bl_desc=new H(K.bl_tree,R),K.bi_buf=0,K.bi_valid=0,i(K)},K.exports._tr_stored_block=k,K.exports._tr_flush_block=(K,Y,v,U)=>{let d,A,c=0;K.level>0?(2===K.strm.data_type&&(K.strm.data_type=(K=>{let Y,v=4093624447;for(Y=0;Y<=31;Y++,v>>>=1)if(1&v&&0!==K.dyn_ltree[2*Y])return 0;if(0!==K.dyn_ltree[18]||0!==K.dyn_ltree[20]||0!==K.dyn_ltree[26])return 1;for(Y=32;Y<l;Y++)if(0!==K.dyn_ltree[2*Y])return 1;return 0})(K)),Q(K,K.l_desc),Q(K,K.d_desc),c=(K=>{let Y;for(X(K,K.dyn_ltree,K.l_desc.max_code),X(K,K.dyn_dtree,K.d_desc.max_code),Q(K,K.bl_desc),Y=18;Y>=3&&0===K.bl_tree[2*Z[Y]+1];Y--);return K.opt_len+=3*(Y+1)+5+5+4,Y})(K),d=K.opt_len+3+7>>>3,A=K.static_len+3+7>>>3,A<=d&&(d=A)):d=A=v+5,v+4<=d&&-1!==Y?k(K,Y,v,U):4===K.strategy||A===d?(E(K,2+(U?1:0),3),G(K,m,V)):(E(K,4+(U?1:0),3),((K,Y,l,v)=>{let U;for(E(K,Y-257,5),E(K,l-1,5),E(K,v-4,4),U=0;U<v;U++)E(K,K.bl_tree[2*Z[U]+1],3);f(K,K.dyn_ltree,Y-1),f(K,K.dyn_dtree,l-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,c+1),G(K,K.dyn_ltree,K.dyn_dtree)),i(K),U&&D(K)},K.exports._tr_tally=(K,Y,v)=>(K.pending_buf[K.d_buf+2*K.last_lit]=Y>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&Y,K.pending_buf[K.l_buf+K.last_lit]=255&v,K.last_lit++,0===Y?K.dyn_ltree[2*v]++:(K.matches++,Y--,K.dyn_ltree[2*(u[v]+l+1)]++,K.dyn_dtree[2*z(Y)]++),K.last_lit===K.lit_bufsize-1),K.exports._tr_align=K=>{E(K,2,3),y(K,256,m),(K=>{16===K.bi_valid?(r(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)})(K)}},11798:K=>{"use strict";K.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12417:K=>{function Y(K,Y,l){for(var v=K.length,U=-1/0,d=1/0,A=0;A<v;A++){var c=(l[0][A]-K[A])/Y[A],t=(l[1][A]-K[A])/Y[A];if(c>t){var Z=c;c=t,t=Z}if(t<U||c>d)return 1/0;c>U&&(U=c),t<d&&(d=t)}return U>d?1/0:U}K.exports=function(K,l,v,U){var d=Y(l,v,U);if(d===1/0)K=null;else{K=K||[];for(var A=0;A<l.length;A++)K[A]=l[A]+v[A]*d}return K},K.exports.distance=Y},12679:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>A});var v=l(33);const U=v.useLayoutEffect;const d=function(K){var Y=(0,v.useRef)(K);return U((function(){Y.current=K})),Y};var A=function(K){var Y=d(K);(0,v.Bb)((function(){var K=function(K){var l;if(null!=Y.current&&(l=Y.current(K)),K.defaultPrevented&&(K.returnValue=""),"string"===typeof l)return K.returnValue=l,l};return window.addEventListener("beforeunload",K),function(){window.removeEventListener("beforeunload",K)}}),[])}},12638:(K,Y,l)=>{"use strict";var v=l(12645),U=Array.prototype.concat,d=Array.prototype.slice,A=K.exports=function(K){for(var Y=[],l=0,A=K.length;l<A;l++){var c=K[l];v(c)?Y=U.call(Y,d.call(c)):Y.push(c)}return Y};A.wrap=function(K){return function(){return K(A(arguments))}}},12645:K=>{K.exports=function(K){return!(!K||"string"===typeof K)&&(K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&"String"!==K.constructor.name))}},11697:(K,Y,l)=>{var v=l(11706);function U(K){for(var Y,l,U=0,d=K.length,A=0;A<K.length;){for(Y=K[A],l=0;A<d&&K[A]===Y;)++A,++l;U+=v.log2(l)/7|0,U+=v.log2(Y>>>0)/7|0,U+=2}return U}Y.size=U,Y.encode=function(K,Y){Y||(Y=new Uint8Array(U(K)));for(var l,v,d=0,A=Y.length,c=0;c<K.length;){for(l=K[c],v=0;c<K.length&&K[c]===l;)++c,++v;for(;d<A&&v>=128;)Y[d++]=128+(127&v),v>>>=7;if(d>=A)throw new Error("RLE buffer overflow");for(Y[d++]=v,l>>>=0;d<A&&l>=128;)Y[d++]=128+(127&l),l>>>=7;if(d>=A)throw new Error("RLE buffer overflow");Y[d++]=l}return Y},Y.decode=function(K,Y){for(var l,v,U,d,A=Y.length,c=K.length,t=0,Z=0;Z<c;){for(l=0,v=0;Z<c&&K[Z]>=128;)l+=(127&K[Z++])<<v,v+=7;if(l+=K[Z++]<<v,Z>=c)throw new Error("RLE buffer underrun");if(t+l>A)throw new Error("Chunk buffer overflow");for(U=0,v=0;Z<c&&K[Z]>=128;)U+=(127&K[Z++])<<v,v+=7;if(Z>=c)throw new Error("RLE buffer underrun");for(U+=K[Z++]<<v,d=0;d<l;++d)Y[t++]=U}return Y}},11706:(K,Y)=>{"use strict";function l(K){var Y=32;return(K&=-K)&&Y--,65535&K&&(Y-=16),16711935&K&&(Y-=8),252645135&K&&(Y-=4),858993459&K&&(Y-=2),1431655765&K&&(Y-=1),Y}Y.INT_BITS=32,Y.INT_MAX=2147483647,Y.INT_MIN=-1<<31,Y.sign=function(K){return(K>0)-(K<0)},Y.abs=function(K){var Y=K>>31;return(K^Y)-Y},Y.min=function(K,Y){return Y^(K^Y)&-(K<Y)},Y.max=function(K,Y){return K^(K^Y)&-(K<Y)},Y.isPow2=function(K){return!(K&K-1)&&!!K},Y.log2=function(K){var Y,l;return Y=(K>65535)<<4,Y|=l=((K>>>=Y)>255)<<3,Y|=l=((K>>>=l)>15)<<2,(Y|=l=((K>>>=l)>3)<<1)|(K>>>=l)>>1},Y.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},Y.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},Y.countTrailingZeros=l,Y.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},Y.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},Y.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var v=new Array(256);!function(K){for(var Y=0;Y<256;++Y){var l=Y,v=Y,U=7;for(l>>>=1;l;l>>>=1)v<<=1,v|=1&l,--U;K[Y]=v<<U&255}}(v),Y.reverse=function(K){return v[255&K]<<24|v[K>>>8&255]<<16|v[K>>>16&255]<<8|v[K>>>24&255]},Y.interleave2=function(K,Y){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(Y=1431655765&((Y=858993459&((Y=252645135&((Y=16711935&((Y&=65535)|Y<<8))|Y<<4))|Y<<2))|Y<<1))<<1},Y.deinterleave2=function(K,Y){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>Y&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},Y.interleave3=function(K,Y,l){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<1)|(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<2},Y.deinterleave3=function(K,Y){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>Y&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},Y.nextCombination=function(K){var Y=K|K-1;return Y+1|(~Y&-~Y)-1>>>l(K)+1}},11731:K=>{"use strict";K.exports=function(K,Y,l,v){var U=self||window;try{try{var d;try{d=new U.Blob([K])}catch(Z){(d=new(U.BlobBuilder||U.WebKitBlobBuilder||U.MozBlobBuilder||U.MSBlobBuilder)).append(K),d=d.getBlob()}var A=U.URL||U.webkitURL,c=A.createObjectURL(d),t=new U[Y](c,l);return A.revokeObjectURL(c),t}catch(Z){return new U[Y]("data:application/javascript,".concat(encodeURIComponent(K)),l)}}catch(Z){if(!v)throw Error("Inline worker is not supported");return new U[Y](v,l)}}},12398:(K,Y,l)=>{"use strict";function v(K,Y,l,v,U){var d={};return Object.keys(v).forEach((function(K){d[K]=v[K]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(l,v){return v(K,Y,l)||l}),d),U&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(U):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(K,Y,d),d=null),d}l.d(Y,{e:()=>v})},12396:(K,Y,l)=>{"use strict";function v(K,Y,l,v){l&&Object.defineProperty(K,Y,{enumerable:l.enumerable,configurable:l.configurable,writable:l.writable,value:l.initializer?l.initializer.call(v):void 0})}l.d(Y,{b:()=>v})},12456:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>R,d:()=>g,e:()=>J,i:()=>M,m:()=>W,p:()=>o,s:()=>u});var v=l(675),U=l(706),d=l(695),A=l(619),c=l(12463),t=l(699),Z=l(2271),m=l(522),V=l(702);const M=Object.freeze(new v.h(0,0,0,0)),u=Object.freeze(v.o.Zero()),o=Object.freeze(v.m.Zero()),W=Object.freeze(Z.d.Zero()),g=Object.freeze(U.e.Black()),J=Object.freeze(new U.g(0,0,0,0)),n={key:0,repeatCount:0,loopMode:2};class R{static _PrepareAnimation(K,Y,l,d,A,c,t,m){let V;if(!isNaN(parseFloat(A))&&isFinite(A)?V=R.ANIMATIONTYPE_FLOAT:A instanceof v.h?V=R.ANIMATIONTYPE_QUATERNION:A instanceof v.o?V=R.ANIMATIONTYPE_VECTOR3:A instanceof v.m?V=R.ANIMATIONTYPE_VECTOR2:A instanceof U.e?V=R.ANIMATIONTYPE_COLOR3:A instanceof U.g?V=R.ANIMATIONTYPE_COLOR4:A instanceof Z.d&&(V=R.ANIMATIONTYPE_SIZE),void 0==V)return null;const M=new R(K,Y,l,V,t),u=[{frame:0,value:A},{frame:d,value:c}];return M.setKeys(u),void 0!==m&&M.setEasingFunction(m),M}static CreateAnimation(K,Y,l,v){const U=new R(K+"Animation",K,l,Y,R.ANIMATIONLOOPMODE_CONSTANT);return U.setEasingFunction(v),U}static CreateAndStartAnimation(K,Y,l,v,U,d,A,c,t,Z,m){const V=R._PrepareAnimation(K,l,v,U,d,A,c,t);return V?(Y.va&&(m=Y.va()),m?m.beginDirectAnimation(Y,[V],0,U,1===V.loopMode,1,Z):null):null}static CreateAndStartHierarchyAnimation(K,Y,l,v,U,d,A,c,t,Z,m){const V=R._PrepareAnimation(K,v,U,d,A,c,t,Z);if(!V)return null;return Y.va().beginDirectHierarchyAnimation(Y,l,[V],0,d,1===V.loopMode,1,m)}static CreateMergeAndStartAnimation(K,Y,l,v,U,d,A,c,t,Z){const m=R._PrepareAnimation(K,l,v,U,d,A,c,t);return m?(Y.animations.push(m),Y.va().beginAnimation(Y,0,U,1===m.loopMode,1,Z)):null}static MakeAnimationAdditive(K,Y,l){let U;U="object"===typeof Y?Y:{referenceFrame:Y??0,range:l,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let d=K;if(U.cloneOriginalAnimation&&(d=K.clone(),d.name=U.clonedAnimationName||d.name),!d._keys.length)return d;const A=U.referenceFrame&&U.referenceFrame>=0?U.referenceFrame:0;let c=0;const t=d._keys[0];let Z=d._keys.length-1;const m=d._keys[Z],V={referenceValue:t.value,referencePosition:v.j.Qi[0],referenceQuaternion:v.j.Quaternion[0],referenceScaling:v.j.Qi[1],keyPosition:v.j.Qi[2],keyQuaternion:v.j.Quaternion[1],keyScaling:v.j.Qi[3]};let M=t.frame,u=m.frame;if(U.range){const K=d.getRange(U.range);K&&(M=K.from,u=K.to)}else M=U.fromFrame??M,u=U.toFrame??u;if(M!==t.frame&&(c=d.createKeyForFrame(M)),u!==m.frame&&(Z=d.createKeyForFrame(u)),1===d._keys.length){const K=d._getKeyValue(d._keys[0]);V.referenceValue=K.clone?K.clone():K}else if(A<=t.frame){const K=d._getKeyValue(t.value);V.referenceValue=K.clone?K.clone():K}else if(A>=m.frame){const K=d._getKeyValue(m.value);V.referenceValue=K.clone?K.clone():K}else{n.key=0;const K=d._interpolate(A,n);V.referenceValue=K.clone?K.clone():K}d.dataType===R.ANIMATIONTYPE_QUATERNION?V.referenceValue.normalize().conjugateInPlace():d.dataType===R.ANIMATIONTYPE_MATRIX&&(V.referenceValue.decompose(V.referenceScaling,V.referenceQuaternion,V.referencePosition),V.referenceQuaternion.normalize().conjugateInPlace());let o=Number.MAX_VALUE;const W=U.clipKeys?[]:null;for(let g=c;g<=Z;g++){let K=d._keys[g];if((W||U.cloneOriginalAnimation)&&(K={frame:K.frame,value:K.value.clone?K.value.clone():K.value,inTangent:K.inTangent,outTangent:K.outTangent,interpolation:K.interpolation,lockedTangent:K.lockedTangent},W&&(o===Number.MAX_VALUE&&(o=K.frame),K.frame-=o,W.push(K))),!g||d.dataType===R.ANIMATIONTYPE_FLOAT||K.value!==t.value)switch(d.dataType){case R.ANIMATIONTYPE_MATRIX:K.value.decompose(V.keyScaling,V.keyQuaternion,V.keyPosition),V.keyPosition.Pi(V.referencePosition),V.keyScaling.divideInPlace(V.referenceScaling),V.referenceQuaternion.multiplyToRef(V.keyQuaternion,V.keyQuaternion),v.d.ComposeToRef(V.keyScaling,V.keyQuaternion,V.keyPosition,K.value);break;case R.ANIMATIONTYPE_QUATERNION:V.referenceValue.multiplyToRef(K.value,K.value);break;case R.ANIMATIONTYPE_VECTOR2:case R.ANIMATIONTYPE_VECTOR3:case R.ANIMATIONTYPE_COLOR3:case R.ANIMATIONTYPE_COLOR4:K.value.subtractToRef(V.referenceValue,K.value);break;case R.ANIMATIONTYPE_SIZE:K.value.width-=V.referenceValue.width,K.value.height-=V.referenceValue.height;break;default:K.value-=V.referenceValue}}return W&&d.setKeys(W,!0),d}static TransitionTo(K,Y,l,v,U,d,A){let c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(A<=0)return l[K]=Y,c&&c(),null;const t=U*(A/1e3);d.setKeys([{frame:0,value:l[K].clone?l[K].clone():l[K]},{frame:t,value:Y}]),l.animations||(l.animations=[]),l.animations.push(d);const Z=v.beginAnimation(l,0,t,!1);return Z.onAnimationEnd=c,Z}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const K of this._runtimeAnimations)if(!K.isStopped())return!0;return!1}constructor(K,Y,l,v,U,d){this.name=K,this.targetProperty=Y,this.framePerSecond=l,this.dataType=v,this.loopMode=U,this.enableBlending=d,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=Y.split("."),this.dataType=v,this.loopMode=void 0===U?R.ANIMATIONLOOPMODE_CYCLE:U,this.uniqueId=R._UniqueIdGenerator++}toString(K){let Y="Name: "+this.name+", property: "+this.targetProperty;if(Y+=", datatype: "+["Float","Qi","Quaternion","Matrix","Ti","Vector2"][this.dataType],Y+=", nKeys: "+(this._keys?this._keys.length:"none"),Y+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),K){Y+=", Ranges: {";let K=!0;for(const l in this._ranges)K&&(Y+=", ",K=!1),Y+=l;Y+="}"}return Y}addEvent(K){this._events.push(K),this._events.sort(((K,Y)=>K.frame-Y.frame))}removeEvents(K){for(let Y=0;Y<this._events.length;Y++)this._events[Y].frame===K&&(this._events.splice(Y,1),Y--)}getEvents(){return this._events}createRange(K,Y,l){this._ranges[K]||(this._ranges[K]=new c.b(K,Y,l))}deleteRange(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const l=this._ranges[K];if(l){if(Y){const K=l.from,Y=l.to;for(let l=this._keys.length-1;l>=0;l--)this._keys[l].frame>=K&&this._keys[l].frame<=Y&&this._keys.splice(l,1)}this._ranges[K]=null}}getRange(K){return this._ranges[K]}getKeys(){return this._keys}getHighestFrame(){let K=0;for(let Y=0,l=this._keys.length;Y<l;Y++)K<this._keys[Y].frame&&(K=this._keys[Y].frame);return K}getEasingFunction(){return this._easingFunction}setEasingFunction(K){this._easingFunction=K}floatInterpolateFunction(K,Y,l){return(0,d.p)(K,Y,l)}floatInterpolateFunctionWithTangents(K,Y,l,v,U){return(0,d.h)(K,Y,l,v,U)}quaternionInterpolateFunction(K,Y,l){return v.h.Slerp(K,Y,l)}quaternionInterpolateFunctionWithTangents(K,Y,l,U,d){return v.h.Hermite(K,Y,l,U,d).normalize()}vector3InterpolateFunction(K,Y,l){return v.o.Lerp(K,Y,l)}vector3InterpolateFunctionWithTangents(K,Y,l,U,d){return v.o.Hermite(K,Y,l,U,d)}vector2InterpolateFunction(K,Y,l){return v.m.Lerp(K,Y,l)}vector2InterpolateFunctionWithTangents(K,Y,l,U,d){return v.m.Hermite(K,Y,l,U,d)}sizeInterpolateFunction(K,Y,l){return Z.d.Lerp(K,Y,l)}color3InterpolateFunction(K,Y,l){return U.e.Lerp(K,Y,l)}color3InterpolateFunctionWithTangents(K,Y,l,v,d){return U.e.Hermite(K,Y,l,v,d)}color4InterpolateFunction(K,Y,l){return U.g.Lerp(K,Y,l)}color4InterpolateFunctionWithTangents(K,Y,l,v,d){return U.g.Hermite(K,Y,l,v,d)}_getKeyValue(K){return"function"===typeof K?K():K}evaluate(K){return n.key=0,this._interpolate(K,n)}_interpolate(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Y.loopMode===R.ANIMATIONLOOPMODE_CONSTANT&&Y.repeatCount>0)return Y.highLimitValue.clone?Y.highLimitValue.clone():Y.highLimitValue;const v=this._keys,U=v.length;let d=Y.key;for(;d>=0&&K<v[d].frame;)--d;for(;d+1<=U-1&&K>=v[d+1].frame;)++d;if(Y.key=d,d<0)return l?void 0:this._getKeyValue(v[0].value);if(d+1>U-1)return l?void 0:this._getKeyValue(v[U-1].value);const A=v[d],c=v[d+1];if(l&&(K===A.frame||K===c.frame))return;const t=this._getKeyValue(A.value),Z=this._getKeyValue(c.value);if(1===A.interpolation)return c.frame>K?t:Z;const m=void 0!==A.outTangent&&void 0!==c.inTangent,V=c.frame-A.frame;let n=(K-A.frame)/V;const H=A.easingFunction||this.getEasingFunction();switch(null!==H&&(n=H.ease(n)),this.dataType){case R.ANIMATIONTYPE_FLOAT:{const K=m?this.floatInterpolateFunctionWithTangents(t,A.outTangent*V,Z,c.inTangent*V,n):this.floatInterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(Y.offsetValue??0)*Y.repeatCount+K}break}case R.ANIMATIONTYPE_QUATERNION:{const K=m?this.quaternionInterpolateFunctionWithTangents(t,A.outTangent.scale(V),Z,c.inTangent.scale(V),n):this.quaternionInterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.addInPlace((Y.offsetValue||M).scale(Y.repeatCount))}return K}case R.ANIMATIONTYPE_VECTOR3:{const K=m?this.vector3InterpolateFunctionWithTangents(t,A.outTangent.scale(V),Z,c.inTangent.scale(V),n):this.vector3InterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((Y.offsetValue||u).scale(Y.repeatCount))}break}case R.ANIMATIONTYPE_VECTOR2:{const K=m?this.vector2InterpolateFunctionWithTangents(t,A.outTangent.scale(V),Z,c.inTangent.scale(V),n):this.vector2InterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((Y.offsetValue||o).scale(Y.repeatCount))}break}case R.ANIMATIONTYPE_SIZE:switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(t,Z,n);case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(t,Z,n).add((Y.offsetValue||W).scale(Y.repeatCount))}break;case R.ANIMATIONTYPE_COLOR3:{const K=m?this.color3InterpolateFunctionWithTangents(t,A.outTangent.scale(V),Z,c.inTangent.scale(V),n):this.color3InterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((Y.offsetValue||g).scale(Y.repeatCount))}break}case R.ANIMATIONTYPE_COLOR4:{const K=m?this.color4InterpolateFunctionWithTangents(t,A.outTangent.scale(V),Z,c.inTangent.scale(V),n):this.color4InterpolateFunction(t,Z,n);switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return K;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((Y.offsetValue||J).scale(Y.repeatCount))}break}case R.ANIMATIONTYPE_MATRIX:switch(Y.loopMode){case R.ANIMATIONLOOPMODE_CYCLE:case R.ANIMATIONLOOPMODE_CONSTANT:case R.ANIMATIONLOOPMODE_YOYO:return R.AllowMatricesInterpolation?this.matrixInterpolateFunction(t,Z,n,Y.workValue):t;case R.ANIMATIONLOOPMODE_RELATIVE:case R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return t}}return 0}matrixInterpolateFunction(K,Y,l,U){return R.AllowMatrixDecomposeForInterpolation?U?(v.d.DecomposeLerpToRef(K,Y,l,U),U):v.d.DecomposeLerp(K,Y,l):U?(v.d.LerpToRef(K,Y,l,U),U):v.d.Lerp(K,Y,l)}clone(){const K=new R(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(K.enableBlending=this.enableBlending,K.blendingSpeed=this.blendingSpeed,this._keys&&K.setKeys(this._keys),this._ranges){K._ranges={};for(const Y in this._ranges){const l=this._ranges[Y];l&&(K._ranges[Y]=l.clone())}}return K}setKeys(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=Y?K:K.slice(0)}createKeyForFrame(K){n.key=0;const Y=this._interpolate(K,n,!0);if(!Y)return this._keys[n.key].frame===K?n.key:n.key+1;const l={frame:K,value:Y.clone?Y.clone():Y};return this._keys.splice(n.key+1,0,l),n.key+1}serialize(){const K={};K.name=this.name,K.property=this.targetProperty,K.framePerSecond=this.framePerSecond,K.dataType=this.dataType,K.loopBehavior=this.loopMode,K.enableBlending=this.enableBlending,K.blendingSpeed=this.blendingSpeed;const Y=this.dataType;K.keys=[];const l=this.getKeys();for(let v=0;v<l.length;v++){const U=l[v],d={};switch(d.frame=U.frame,Y){case R.ANIMATIONTYPE_FLOAT:d.values=[U.value],void 0!==U.inTangent&&d.values.push(U.inTangent),void 0!==U.outTangent&&(void 0===U.inTangent&&d.values.push(void 0),d.values.push(U.outTangent)),void 0!==U.interpolation&&(void 0===U.inTangent&&d.values.push(void 0),void 0===U.outTangent&&d.values.push(void 0),d.values.push(U.interpolation));break;case R.ANIMATIONTYPE_QUATERNION:case R.ANIMATIONTYPE_MATRIX:case R.ANIMATIONTYPE_VECTOR3:case R.ANIMATIONTYPE_COLOR3:case R.ANIMATIONTYPE_COLOR4:d.values=U.value.zi(),void 0!=U.inTangent&&d.values.push(U.inTangent.zi()),void 0!=U.outTangent&&(void 0===U.inTangent&&d.values.push(void 0),d.values.push(U.outTangent.zi())),void 0!==U.interpolation&&(void 0===U.inTangent&&d.values.push(void 0),void 0===U.outTangent&&d.values.push(void 0),d.values.push(U.interpolation))}K.keys.push(d)}K.ranges=[];for(const v in this._ranges){const Y=this._ranges[v];if(!Y)continue;const l={};l.name=v,l.from=Y.from,l.to=Y.to,K.ranges.push(l)}return K}static _UniversalLerp(K,Y,l){const v=K.constructor;return v.Lerp?v.Lerp(K,Y,l):v.Slerp?v.Slerp(K,Y,l):K.toFixed?K*(1-l)+l*Y:Y}static Parse(K){const Y=new R(K.name,K.property,K.framePerSecond,K.dataType,K.loopBehavior),l=K.dataType,d=[];let A,c;for(K.enableBlending&&(Y.enableBlending=K.enableBlending),K.blendingSpeed&&(Y.blendingSpeed=K.blendingSpeed),c=0;c<K.keys.length;c++){const Y=K.keys[c];let t,Z,m;switch(l){case R.ANIMATIONTYPE_FLOAT:A=Y.values[0],Y.values.length>=2&&(t=Y.values[1]),Y.values.length>=3&&(Z=Y.values[2]),Y.values.length>=4&&(m=Y.values[3]);break;case R.ANIMATIONTYPE_QUATERNION:if(A=v.h.yi(Y.values),Y.values.length>=8){const K=v.h.yi(Y.values.slice(4,8));K.equals(v.h.Zero())||(t=K)}if(Y.values.length>=12){const K=v.h.yi(Y.values.slice(8,12));K.equals(v.h.Zero())||(Z=K)}Y.values.length>=13&&(m=Y.values[12]);break;case R.ANIMATIONTYPE_MATRIX:A=v.d.yi(Y.values),Y.values.length>=17&&(m=Y.values[16]);break;case R.ANIMATIONTYPE_COLOR3:A=U.e.yi(Y.values),Y.values[3]&&(t=U.e.yi(Y.values[3])),Y.values[4]&&(Z=U.e.yi(Y.values[4])),Y.values[5]&&(m=Y.values[5]);break;case R.ANIMATIONTYPE_COLOR4:A=U.g.yi(Y.values),Y.values[4]&&(t=U.g.yi(Y.values[4])),Y.values[5]&&(Z=U.g.yi(Y.values[5])),Y.values[6]&&(m=U.g.yi(Y.values[6]));break;case R.ANIMATIONTYPE_VECTOR3:default:A=v.o.yi(Y.values),Y.values[3]&&(t=v.o.yi(Y.values[3])),Y.values[4]&&(Z=v.o.yi(Y.values[4])),Y.values[5]&&(m=Y.values[5])}const V={};V.frame=Y.frame,V.value=A,void 0!=t&&(V.inTangent=t),void 0!=Z&&(V.outTangent=Z),void 0!=m&&(V.interpolation=m),d.push(V)}if(Y.setKeys(d),K.ranges)for(c=0;c<K.ranges.length;c++)A=K.ranges[c],Y.createRange(A.name,A.from,A.to);return Y}static AppendSerializedAnimations(K,Y){V.c.AppendSerializedAnimations(K,Y)}static ParseFromFileAsync(K,Y){return new Promise(((l,v)=>{const U=new m.e;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){let Y=JSON.parse(U.responseText);if(Y.animations&&(Y=Y.animations),Y.length){const K=[];for(const l of Y)K.push(this.Parse(l));l(K)}else{const v=this.Parse(Y);K&&(v.name=K),l(v)}}else v("Unable to load the animation")})),U.open("GET",Y),U.send()}))}static ParseFromSnippetAsync(K){return new Promise(((Y,l)=>{const v=new m.e;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const l=JSON.parse(JSON.parse(v.responseText).jsonPayload);if(l.animations){const v=JSON.parse(l.animations),U=[];for(const Y of v.animations){const l=this.Parse(Y);l.snippetId=K,U.push(l)}Y(U)}else{const v=JSON.parse(l.animation),U=this.Parse(v);U.snippetId=K,Y(U)}}else l("Unable to load the snippet "+K)})),v.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),v.send()}))}}R._UniqueIdGenerator=0,R.AllowMatricesInterpolation=!1,R.AllowMatrixDecomposeForInterpolation=!0,R.SnippetUrl="https://snippet.babylonjs.com",R.ANIMATIONTYPE_FLOAT=0,R.ANIMATIONTYPE_VECTOR3=1,R.ANIMATIONTYPE_QUATERNION=2,R.ANIMATIONTYPE_MATRIX=3,R.ANIMATIONTYPE_COLOR3=4,R.ANIMATIONTYPE_COLOR4=7,R.ANIMATIONTYPE_VECTOR2=5,R.ANIMATIONTYPE_SIZE=6,R.ANIMATIONLOOPMODE_RELATIVE=0,R.ANIMATIONLOOPMODE_CYCLE=1,R.ANIMATIONLOOPMODE_CONSTANT=2,R.ANIMATIONLOOPMODE_YOYO=4,R.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,R.CreateFromSnippetAsync=R.ParseFromSnippetAsync,(0,A.f)("BABYLON.Animation",R),t.b._AnimationRangeFactory=(K,Y,l)=>new c.b(K,Y,l)},12463:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>v});class v{constructor(K,Y,l){this.name=K,this.from=Y,this.to=l}clone(){return new v(this.name,this.from,this.to)}}},12064:(K,Y,l)=>{"use strict";var v=l(469),U=l(492),d=l(567),A=l(484);d.b.AudioEngineFactory=(K,Y,l)=>new c(K,Y,l);class c{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new v.b,this.onAudioLockedObservable=new v.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,A.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const U=document.createElement("audio");this._hostElement=K,this._audioContext=Y,this._audioDestination=l;try{U&&U.canPlayType&&(U.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||U.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(d){}try{U&&U.canPlayType&&U.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(d){}}lock(){this._triggerSuspendedState()}unlock(){var K,Y;if("running"===(null===(K=this._audioContext)||void 0===K?void 0:K.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(Y=this._audioContext)||void 0===Y||Y.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var K;null===(K=this._audioContext)||void 0===K||K.addEventListener("statechange",(()=>{var K;this.unlocked&&"running"!==(null===(K=this._audioContext)||void 0===K?void 0:K.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var K;return null!==(K=this._audioContext)&&void 0!==K&&K.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(K){this.canUseWebAudio=!1,U.e.Error("Web Audio: "+K.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const K=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",Y=document.createElement("style");Y.appendChild(document.createTextNode(K)),document.getElementsByTagName("head")[0].appendChild(Y),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(K){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=K)}connectToAnalyser(K){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=K,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12451:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>A});var v=l(675),U=l(686),d=l(699);class A extends d.b{get _matrix(){return this._compose(),this.Zi}set _matrix(K){(K.updateFlag!==this.Zi.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Zi.p(K),this._markAsDirtyAndDecompose())}constructor(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(K,Y.va(),!1),this.name=K,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Y,this.Zi=(null===U||void 0===U?void 0:U.clone())??v.d.Identity(),this._restMatrix=d??this.Zi.clone(),this._bindMatrix=A??this.Zi.clone(),this._index=c,this._absoluteMatrix=new v.d,this._absoluteBindMatrix=new v.d,this._absoluteInverseBindMatrix=new v.d,this._finalMatrix=new v.d,Y.bones.push(this),this.setParent(l,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(K){this.setParent(K)}setParent(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==K){if(this.parent){const K=this.parent.children.indexOf(this);-1!==K&&this.parent.children.splice(K,1)}this._parentNode=K,this.parent&&this.parent.children.push(this),Y&&this._updateAbsoluteBindMatrices(),this.Mi()}}getLocalMatrix(){return this._compose(),this.Zi}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(K){this._restMatrix.p(K)}setRestPose(K){this.setRestMatrix(K)}getBindPose(){return this.getBindMatrix()}setBindMatrix(K){this.Xi(K)}setBindPose(K){this.setBindMatrix(K)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const K=v.j.Qi[0],Y=v.j.Quaternion[0],l=v.j.Qi[1];this.getRestMatrix().decompose(K,Y,l),this._linkedTransformNode.position.p(l),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??v.h.Identity(),this._linkedTransformNode.rotationQuaternion.p(Y),this._linkedTransformNode.ni.p(K)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(K){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=K,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Hg}set position(K){this._decompose(),this.Hg.p(K),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(K){this.setRotation(K)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(K){this.setRotationQuaternion(K)}get ni(){return this.getScale()}set ni(K){this.setScale(K)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=v.o.Zero(),this._localRotation=v.h.Zero(),this.Hg=v.o.Zero()),this.Zi.decompose(this._localScaling,this._localRotation,this.Hg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,v.d.ComposeToRef(this._localScaling,this._localRotation,this.Hg,this.Zi)):this._needToCompose=!1)}Xi(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(K),Y&&this._updateAbsoluteBindMatrices(),l?this._matrix=K:this.Mi()}_updateAbsoluteBindMatrices(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K||(K=this._bindMatrix),this.parent?K.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(K),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Y)for(let l=0;l<this.children.length;l++)this.children[l]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Mi(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Mi(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Mi(),this._needToDecompose=!0}_updatePosition(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this.getLocalMatrix();if(0==Y)U?(d.addAtIndex(12,K.x),d.addAtIndex(13,K.y),d.addAtIndex(14,K.z)):d.setTranslationFromFloats(K.x,K.y,K.z);else{let Y=null;l&&(Y=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const c=A._TmpMats[0],t=A._TmpVecs[0];this.parent?l&&Y?(c.p(this.parent.getAbsoluteMatrix()),c.multiplyToRef(Y,c)):c.p(this.parent.getAbsoluteMatrix()):v.d.IdentityToRef(c),U&&c.setTranslationFromFloats(0,0,0),c.invert(),v.o.TransformCoordinatesToRef(K,c,t),U?(d.addAtIndex(12,t.x),d.addAtIndex(13,t.y),d.addAtIndex(14,t.z)):d.setTranslationFromFloats(t.x,t.y,t.z)}this._markAsDirtyAndDecompose()}translate(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,Y,l,!0)}setPosition(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,Y,l,!1)}setAbsolutePosition(K,Y){this.setPosition(K,1,Y)}scale(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getLocalMatrix(),c=A._TmpMats[0];v.d.ScalingToRef(K,Y,l,c),c.multiplyToRef(d,d),c.invert();for(const v of this.children){const U=v.getLocalMatrix();U.multiplyToRef(c,U),U.multiplyAtIndex(12,K),U.multiplyAtIndex(13,Y),U.multiplyAtIndex(14,l),v._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),U)for(const v of this.children)v.scale(K,Y,l,U)}setScale(K){this._decompose(),this._localScaling.p(K),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(K){this._decompose(),K.p(this._localScaling)}setYawPitchRoll(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0;if(0===U){const c=A._TmpQuat;return v.h.RotationYawPitchRollToRef(K,Y,l,c),void this.setRotationQuaternion(c,U,d)}const c=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,d))return;const t=A._TmpMats[1];v.d.RotationYawPitchRollToRef(K,Y,l,t),c.multiplyToRef(t,t),this._rotateWithMatrix(t,U,d)}rotate(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;const d=A._TmpMats[0];d.setTranslationFromFloats(0,0,0),v.d.RotationAxisToRef(K,Y,d),this._rotateWithMatrix(d,l,U)}setAxisAngle(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;if(0===l){const d=A._TmpQuat;return v.h.RotationAxisToRef(K,Y,d),void this.setRotationQuaternion(d,l,U)}const d=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,U))return;const c=A._TmpMats[1];v.d.RotationAxisToRef(K,Y,c),d.multiplyToRef(c,c),this._rotateWithMatrix(c,l,U)}setRotation(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(K.y,K.x,K.z,Y,l)}setRotationQuaternion(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===Y)return this._decompose(),this._localRotation.p(K),void this._markAsDirtyAndCompose();const U=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,l))return;const d=A._TmpMats[1];v.d.FromQuaternionToRef(K,d),U.multiplyToRef(d,d),this._rotateWithMatrix(d,Y,l)}setRotationMatrix(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;if(0===Y){const U=A._TmpQuat;return v.h.FromRotationMatrixToRef(K,U),void this.setRotationQuaternion(U,Y,l)}const U=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,l))return;const d=A._TmpMats[1];d.p(K),U.multiplyToRef(K,d),this._rotateWithMatrix(d,Y,l)}_rotateWithMatrix(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const v=this.getLocalMatrix(),U=v.m[12],d=v.m[13],c=v.m[14],t=this.getParent(),Z=A._TmpMats[3],m=A._TmpMats[4];t&&1==Y?(l?(Z.p(l.getWorldMatrix()),t.getAbsoluteMatrix().multiplyToRef(Z,Z)):Z.p(t.getAbsoluteMatrix()),m.p(Z),m.invert(),v.multiplyToRef(Z,v),v.multiplyToRef(K,v),v.multiplyToRef(m,v)):1==Y&&l?(Z.p(l.getWorldMatrix()),m.p(Z),m.invert(),v.multiplyToRef(Z,v),v.multiplyToRef(K,v),v.multiplyToRef(m,v)):v.multiplyToRef(K,v),v.setTranslationFromFloats(U,d,c),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(K,Y){const l=A._TmpMats[2];return K.p(this.getAbsoluteMatrix()),Y?(K.multiplyToRef(Y.getWorldMatrix(),K),v.d.ScalingToRef(Y.ni.x,Y.ni.y,Y.ni.z,l)):v.d.IdentityToRef(l),K.invert(),!isNaN(K.m[0])&&(l.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyToRef(l,K),!0)}We(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.o.Zero();return this.getPositionToRef(K,Y,l),l}getPositionToRef(){let K=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const K=this.getLocalMatrix();Y.x=K.m[12],Y.y=K.m[13],Y.z=K.m[14]}else{let l=null;K&&(l=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let v=A._TmpMats[0];K&&l?(v.p(this.getAbsoluteMatrix()),v.multiplyToRef(l,v)):v=this.getAbsoluteMatrix(),Y.x=v.m[12],Y.y=v.m[13],Y.z=v.m[14]}}getAbsolutePosition(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Y=v.o.Zero();return this.getPositionToRef(1,K,Y),Y}getAbsolutePositionToRef(K,Y){this.getPositionToRef(1,K,Y)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Zi.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Zi);const K=this._skeleton.getPoseMatrix();K&&this._absoluteMatrix.multiplyToRef(K,this._absoluteMatrix)}const K=this.children,Y=K.length;for(let l=0;l<Y;l++)K[l].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ni(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.o.Zero();return this.getDirectionToRef(K,Y,l),l}getDirectionToRef(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,U=null;Y&&(U=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=A._TmpMats[0];d.p(this.getAbsoluteMatrix()),Y&&U&&d.multiplyToRef(U,d),v.o.TransformNormalToRef(K,d,l),l.normalize()}getRotation(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.o.Zero();return this.getRotationToRef(K,Y,l),l}getRotationToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const v=A._TmpQuat;this.getRotationQuaternionToRef(K,Y,v),v.toEulerAnglesToRef(l)}getRotationQuaternion(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.h.Identity();return this.getRotationQuaternionToRef(K,Y,l),l}getRotationQuaternionToRef(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Y.p(this._localRotation);else{const l=A._TmpMats[0],v=this.getAbsoluteMatrix();K?v.multiplyToRef(K.getWorldMatrix(),l):l.p(v),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.decompose(void 0,Y,void 0)}}getRotationMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1?arguments[1]:void 0;const l=v.d.Identity();return this.getRotationMatrixToRef(K,Y,l),l}getRotationMatrixToRef(){let K=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Y);else{const l=A._TmpMats[0],v=this.getAbsoluteMatrix();K?v.multiplyToRef(K.getWorldMatrix(),l):l.p(v),l.multiplyAtIndex(0,this._scalingDeterminant),l.multiplyAtIndex(1,this._scalingDeterminant),l.multiplyAtIndex(2,this._scalingDeterminant),l.getRotationMatrixToRef(Y)}}getAbsolutePositionFromLocal(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.o.Zero();return this.getAbsolutePositionFromLocalToRef(K,Y,l),l}getAbsolutePositionFromLocalToRef(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,U=null;Y&&(U=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=A._TmpMats[0];d.p(this.getAbsoluteMatrix()),Y&&U&&d.multiplyToRef(U,d),v.o.TransformCoordinatesToRef(K,d,l)}getLocalPositionFromAbsolute(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=v.o.Zero();return this.getLocalPositionFromAbsoluteToRef(K,Y,l),l}getLocalPositionFromAbsoluteToRef(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,U=null;Y&&(U=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const d=A._TmpMats[0];d.p(this.getAbsoluteMatrix()),Y&&U&&d.multiplyToRef(U,d),d.invert(),v.o.TransformCoordinatesToRef(K,d,l)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}A._TmpVecs=(0,U.d)(2,v.o.Zero),A._TmpQuat=v.h.Identity(),A._TmpMats=(0,U.d)(5,v.d.Identity)},12669:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>G});var v=l(646),U=l(652),d=l(469),A=l(675),c=l(699),t=l(465),Z=l(2395),m=l(508),V=l(681);class M{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(K){this._idleRotationSpeed=K}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(K){this._idleRotationWaitTime=K}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(K){this._idleRotationSpinupTime=K}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(K){this._attachedCamera=K;const Y=this._attachedCamera.va();this._onPrePointerObservableObserver=Y.onPrePointerObservable.add((K=>{K.type!==Z.b.POINTERDOWN?K.type===Z.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const K=m.d.Now;let Y=0;null!=this._lastFrameTime&&(Y=K-this._lastFrameTime),this._lastFrameTime=K,this._applyUserInteraction();const l=K-this._lastInteractionTime-this._idleRotationWaitTime,v=Math.max(Math.min(l/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*v,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Y/1e3))}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.va();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(K){this._lastInteractionTime=K??m.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<V.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let K=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(K=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?K:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=m.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}l(2265);class u{constructor(){this._easingMode=u.EASINGMODE_EASEIN}setEasingMode(K){const Y=Math.min(Math.max(K,0),2);this._easingMode=Y}getEasingMode(){return this._easingMode}easeInCore(K){throw new Error("You must implement this method")}ease(K){switch(this._easingMode){case u.EASINGMODE_EASEIN:return this.easeInCore(K);case u.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-K)}return K>=.5?.5*(1-this.easeInCore(2*(1-K)))+.5:.5*this.easeInCore(2*K)}}u.EASINGMODE_EASEIN=0,u.EASINGMODE_EASEOUT=1,u.EASINGMODE_EASEINOUT=2;var o=l(12456);class W{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(K){if(this._autoTransitionRange===K)return;this._autoTransitionRange=K;const Y=this._attachedCamera;Y&&(K?this._onMeshTargetChangedObserver=Y.onMeshTargetChangedObservable.add((K=>{if(K&&(K.ri(!0),K.getBoundingInfo)){const Y=K.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Y,this.upperRadiusTransitionRange=.05*Y}})):this._onMeshTargetChangedObserver&&Y.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(K){this._attachedCamera=K,this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(K){return!!this._attachedCamera&&(this._attachedCamera.radius===K&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(K){if(!this._attachedCamera)return;this._radiusBounceTransition||(W.EasingFunction.setEasingMode(W.EasingMode),this._radiusBounceTransition=o.b.CreateAnimation("radius",o.b.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Y=o.b.TransitionTo("radius",this._attachedCamera.radius+K,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Y&&this._animatables.push(Y)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}W.EasingFunction=new class extends u{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=K}easeInCore(K){const Y=Math.max(0,this.amplitude);return Math.pow(K,3)-K*Y*Math.sin(3.141592653589793*K)}}(.3),W.EasingMode=u.EASINGMODE_EASEOUT;class g{constructor(){this.onTargetFramingAnimationEndObservable=new d.b,this._mode=g.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(K){this._mode=K}get mode(){return this._mode}set radiusScale(K){this._radiusScale=K}get radiusScale(){return this._radiusScale}set positionScale(K){this._positionScale=K}get positionScale(){return this._positionScale}set defaultElevation(K){this._defaultElevation=K}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(K){this._elevationReturnTime=K}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(K){this._elevationReturnWaitTime=K}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(K){this._framingTime=K}get framingTime(){return this._framingTime}init(){}attach(K){this._attachedCamera=K;const Y=this._attachedCamera.va();g.EasingFunction.setEasingMode(g.EasingMode),this._onPrePointerObservableObserver=Y.onPrePointerObservable.add((K=>{K.type!==Z.b.POINTERDOWN?K.type===Z.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=K.onMeshTargetChangedObservable.add((K=>{K&&K.getBoundingInfo&&this.zoomOnMesh(K,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.va();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.ri(!0);const v=K.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(v.minimumWorld,v.maximumWorld,Y,l)}zoomOnMeshHierarchy(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.ri(!0);const v=K.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(v.min,v.max,Y,l)}zoomOnMeshesHierarchy(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new A.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let d=0;d<K.length;d++){const Y=K[d].getHierarchyBoundingVectors(!0);A.o.CheckExtends(Y.min,v,U),A.o.CheckExtends(Y.max,v,U)}this.zoomOnBoundingInfo(v,U,Y,l)}zoomOnBoundingInfo(K,Y){let l,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const d=K.y,c=d+(Y.y-d)*this._positionScale,t=Y.Lg(K).scale(.5);if(v)l=new A.o(0,c,0);else{const Y=K.add(t);l=new A.o(Y.x,c,Y.z)}this._vectorTransition||(this._vectorTransition=o.b.CreateAnimation("target",o.b.ANIMATIONTYPE_VECTOR3,60,g.EasingFunction)),this._betaIsAnimating=!0;let Z=o.b.TransitionTo("target",l,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);Z&&this._animatables.push(Z);let m=0;if(this._mode===g.FitFrustumSidesMode){const l=this._calculateLowerRadiusFromModelBoundingSphere(K,Y);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=t.length()+this._attachedCamera.ti),m=l}else this._mode===g.IgnoreBoundsSizeMode&&(m=this._calculateLowerRadiusFromModelBoundingSphere(K,Y),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ti));if(this.autoCorrectCameraLimitsAndSensibility){const l=Y.Lg(K).length();this._attachedCamera.panningSensibility=5e3/l,this._attachedCamera.wheelPrecision=100/m}return this._radiusTransition||(this._radiusTransition=o.b.CreateAnimation("radius",o.b.ANIMATIONTYPE_FLOAT,60,g.EasingFunction)),Z=o.b.TransitionTo("radius",m,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Z&&this._animatables.push(Z),!0}_calculateLowerRadiusFromModelBoundingSphere(K,Y){const l=this._attachedCamera;if(!l)return 0;let v=l._calculateLowerRadiusFromModelBoundingSphere(K,Y,this._radiusScale);return l.lowerRadiusLimit&&this._mode===g.IgnoreBoundsSizeMode&&(v=v<l.lowerRadiusLimit?l.lowerRadiusLimit:v),l.upperRadiusLimit&&(v=v>l.upperRadiusLimit?l.upperRadiusLimit:v),v}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const K=m.d.Now-this._lastInteractionTime,Y=.5*Math.PI-this._defaultElevation,l=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&K>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=o.b.CreateAnimation("beta",o.b.ANIMATIONTYPE_FLOAT,60,g.EasingFunction));const K=o.b.TransitionTo("beta",Y,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));K&&this._animatables.push(K)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=m.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}g.EasingFunction=new class extends u{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=K}easeInCore(K){return this.exponent<=0?K:(Math.exp(this.exponent*K)-1)/(Math.exp(this.exponent)-1)}},g.EasingMode=u.EASINGMODE_EASEINOUT,g.IgnoreBoundsSizeMode=0,g.FitFrustumSidesMode=1;var J=l(644),n=l(12441),R=l(12448),H=l(475);class z{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(K){K=H.d.BackCompatCameraNoPreventDefault(arguments);const Y=this.camera.getEngine(),l=Y.getInputElement();let v=0,U=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=d=>{var A,c;const t=d.event,m="touch"===t.pointerType;if(d.type!==Z.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const V=t.target;if(this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey,this._buttonsPressed=t.buttons,Y.isPointerLock){const K=t.movementX,Y=t.movementY;this.onTouch(null,K,Y),this._pointA=null,this._pointB=null}else{if(d.type!==Z.b.POINTERDOWN&&d.type!==Z.b.POINTERDOUBLETAP&&m&&(null===(A=this._pointA)||void 0===A?void 0:A.pointerId)!==t.pointerId&&(null===(c=this._pointB)||void 0===c?void 0:c.pointerId)!==t.pointerId)return;if(d.type!==Z.b.POINTERDOWN||-1!==this._currentActiveButton&&!m)if(d.type===Z.b.POINTERDOUBLETAP)this.onDoubleTap(t.pointerType);else if(d.type!==Z.b.POINTERUP||this._currentActiveButton!==t.button&&!m){if(d.type===Z.b.POINTERMOVE)if(K||t.preventDefault(),this._pointA&&null===this._pointB){const K=t.clientX-this._pointA.x,Y=t.clientY-this._pointA.y;this._pointA.x=t.clientX,this._pointA.y=t.clientY,this.onTouch(this._pointA,K,Y)}else if(this._pointA&&this._pointB){const K=this._pointA.pointerId===t.pointerId?this._pointA:this._pointB;K.x=t.clientX,K.y=t.clientY;const Y=this._pointA.x-this._pointB.x,l=this._pointA.y-this._pointB.y,A=Y*Y+l*l,c={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:t.pointerId,type:d.type};this.onMultiTouch(this._pointA,this._pointB,v,A,U,c),U=c,v=A}}else{try{null===V||void 0===V||V.releasePointerCapture(t.pointerId)}catch(M){}m||(this._pointB=null),Y._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==t.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==t.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==v||U)&&(this.onMultiTouch(this._pointA,this._pointB,v,0,U,null),v=0,U=null),this._currentActiveButton=-1,this.onButtonUp(t),K||t.preventDefault()}else{try{null===V||void 0===V||V.setPointerCapture(t.pointerId)}catch(M){}if(null===this._pointA)this._pointA={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType};else{if(null!==this._pointB)return;this._pointB={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType}}-1!==this._currentActiveButton||m||(this._currentActiveButton=t.button),this.onButtonDown(t),K||(t.preventDefault(),l&&l.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Z.b.POINTERDOWN|Z.b.POINTERUP|Z.b.POINTERMOVE|Z.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,v=0,U=null,this.onLostFocus()},this._contextMenuBind=K=>this.onContextMenu(K),l&&l.addEventListener("contextmenu",this._contextMenuBind,!1);const d=this.camera.va().getEngine().getHostWindow();d&&H.d.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}Li(){if(this._onLostFocus){const K=this.camera.va().getEngine().getHostWindow();K&&H.d.UnregisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const K=this.camera.va().getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(K){}onTouch(K,Y,l){}onMultiTouch(K,Y,l,v,U,d){}onContextMenu(K){K.preventDefault()}onButtonDown(K){}onButtonUp(K){}onLostFocus(){}}(0,v.d)([(0,U.J)()],z.prototype,"buttons",void 0);class r extends z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(K,Y){if(0!==this.panningSensibility&&K&&Y){const l=Y.x-K.x,v=Y.y-K.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=v/this.panningSensibility}}_computePinchZoom(K,Y){const l=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=l*Math.sqrt(K)/Math.sqrt(Y):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Y-K)*l*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Y-K)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(K,Y,l){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Y/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility):(this.camera.inertialAlphaOffset-=Y/this.angularSensibilityX,this.camera.inertialBetaOffset-=l/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(K,Y,l,v,U,d){0===l&&null===U||0===v&&null===d||(this.multiTouchPanAndZoom?(this._computePinchZoom(l,v),this._computeMultiTouchPanning(U,d)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(v)-Math.sqrt(l))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(l,v),this._isPinching=!0):this._computeMultiTouchPanning(U,d)):this.multiTouchPanning?this._computeMultiTouchPanning(U,d):this.pinchZoom&&this._computePinchZoom(l,v))}onButtonDown(K){this._isPanClick=K.button===this.camera._panningMouseButton}onButtonUp(K){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,v.d)([(0,U.J)()],r.prototype,"buttons",void 0),(0,v.d)([(0,U.J)()],r.prototype,"angularSensibilityX",void 0),(0,v.d)([(0,U.J)()],r.prototype,"angularSensibilityY",void 0),(0,v.d)([(0,U.J)()],r.prototype,"pinchPrecision",void 0),(0,v.d)([(0,U.J)()],r.prototype,"pinchDeltaPercentage",void 0),(0,v.d)([(0,U.J)()],r.prototype,"useNaturalPinchZoom",void 0),(0,v.d)([(0,U.J)()],r.prototype,"pinchZoom",void 0),(0,v.d)([(0,U.J)()],r.prototype,"panningSensibility",void 0),(0,v.d)([(0,U.J)()],r.prototype,"multiTouchPanning",void 0),(0,v.d)([(0,U.J)()],r.prototype,"multiTouchPanAndZoom",void 0),R.e.ArcRotateCameraPointersInput=r;var E=l(2398);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(K){K=H.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Y=>{const l=Y.event;if(!l.metaKey)if(Y.type===E.b.KEYDOWN){if(this._ctrlPressed=l.ctrlKey,this._altPressed=l.altKey,-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),l.preventDefault&&(K||l.preventDefault())}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysReset.indexOf(l.keyCode)){const Y=this._keys.indexOf(l.keyCode);Y>=0&&this._keys.splice(Y,1),l.preventDefault&&(K||l.preventDefault())}})))}Li(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let Y=0;Y<this._keys.length;Y++){const l=this._keys[Y];-1!==this.keysLeft.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX-=1/this.panningSensibility:K.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset+=1/this.zoomingSensibility:K.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX+=1/this.panningSensibility:K.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(l)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset-=1/this.zoomingSensibility:K.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(l)&&K.useInputToRestoreState&&K.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,v.d)([(0,U.J)()],y.prototype,"keysUp",void 0),(0,v.d)([(0,U.J)()],y.prototype,"keysDown",void 0),(0,v.d)([(0,U.J)()],y.prototype,"keysLeft",void 0),(0,v.d)([(0,U.J)()],y.prototype,"keysRight",void 0),(0,v.d)([(0,U.J)()],y.prototype,"keysReset",void 0),(0,v.d)([(0,U.J)()],y.prototype,"panningSensibility",void 0),(0,v.d)([(0,U.J)()],y.prototype,"zoomingSensibility",void 0),(0,v.d)([(0,U.J)()],y.prototype,"useAltToZoom",void 0),(0,v.d)([(0,U.J)()],y.prototype,"angularSpeed",void 0),R.e.ArcRotateCameraKeyboardMoveInput=y;var T=l(725),e=l(2407),i=l(695);class D{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new A.o(0,0,0),this._globalOffset=new A.o(0,0,0),this._inertialPanning=A.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(K,Y){let l=0;const v=.01*K*this.wheelDeltaPercentage*Y;return l=K>0?v/(1+this.wheelDeltaPercentage):v*(1+this.wheelDeltaPercentage),l}attachControl(K){K=H.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=Y=>{if(Y.type!==Z.b.POINTERWHEEL)return;const l=Y.event;let v=0;const U=l.deltaMode===e.b.DOM_DELTA_LINE?40:1,d=-l.deltaY*U;if(this.customComputeDeltaFromMouseWheel)v=this.customComputeDeltaFromMouseWheel(d,this,l);else if(this.wheelDeltaPercentage){if(v=this._computeDeltaFromMouseWheelLegacyEvent(d,this.camera.radius),v>0){let K=this.camera.radius,Y=this.camera.inertialRadiusOffset+v;for(let l=0;l<20&&Math.abs(Y)>.001;l++)K-=Y,Y*=this.camera.inertia;K=(0,i.d)(K,0,Number.MAX_VALUE),v=this._computeDeltaFromMouseWheelLegacyEvent(d,K)}}else v=d/(40*this.wheelPrecision);v&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(v)):this.camera.inertialRadiusOffset+=v),l.preventDefault&&(K||l.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Z.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.li(0)}Li(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const K=this.camera;0+K.inertialAlphaOffset+K.inertialBetaOffset+K.inertialRadiusOffset&&(this._updateHitPlane(),K.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(K.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const K=this.camera,Y=K.target.Lg(K.position);this._hitPlane=T.d.FromPositionAndNormal(K.target,Y)}_getPosition(){const K=this.camera,Y=K.va(),l=Y.createPickingRay(Y.pointerX,Y.pointerY,A.d.Identity(),K,!1);0===K.targetScreenOffset.x&&0===K.targetScreenOffset.y||(this._viewOffset.set(K.targetScreenOffset.x,K.targetScreenOffset.y,0),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),this._globalOffset=A.o.TransformNormal(this._viewOffset,K._cameraTransformMatrix),l.origin.addInPlace(this._globalOffset));let v=0;return this._hitPlane&&(v=l.intersectsPlane(this._hitPlane)??0),l.origin.addInPlace(l.direction.scaleInPlace(v))}_zoomToMouse(K){const Y=this.camera,l=1-Y.inertia;if(Y.lowerRadiusLimit){const v=Y.lowerRadiusLimit??0;Y.radius-(Y.inertialRadiusOffset+K)/l<v&&(K=(Y.radius-v)*l-Y.inertialRadiusOffset)}if(Y.upperRadiusLimit){const v=Y.upperRadiusLimit??0;Y.radius-(Y.inertialRadiusOffset+K)/l>v&&(K=(Y.radius-v)*l-Y.inertialRadiusOffset)}const v=K/l/Y.radius,U=this._getPosition(),d=A.j.Qi[6];U.subtractToRef(Y.target,d),d.scaleInPlace(v),d.scaleInPlace(l),this._inertialPanning.addInPlace(d),Y.inertialRadiusOffset+=K}_zeroIfClose(K){Math.abs(K.x)<V.d&&(K.x=0),Math.abs(K.y)<V.d&&(K.y=0),Math.abs(K.z)<V.d&&(K.z=0)}}(0,v.d)([(0,U.J)()],D.prototype,"wheelPrecision",void 0),(0,v.d)([(0,U.J)()],D.prototype,"zoomToMouseLocation",void 0),(0,v.d)([(0,U.J)()],D.prototype,"wheelDeltaPercentage",void 0),R.e.ArcRotateCameraMouseWheelInput=D;class B extends R.f{constructor(K){super(K)}addMouseWheel(){return this.add(new D),this}addPointers(){return this.add(new r),this}addKeyboard(){return this.add(new y),this}}var P=l(619);c.b.AddNodeConstructor("ArcRotateCamera",((K,Y)=>()=>new G(K,0,0,1,A.o.Zero(),Y)));class G extends n.e{get target(){return this._target}set target(K){this.setTarget(K)}get targetHost(){return this._targetHost}set targetHost(K){K&&this.setTarget(K)}getTarget(){return this.target}get position(){return this._position}set position(K){this.setPosition(K)}set upVector(K){this._upToYMatrix||(this._yToUpMatrix=new A.d,this._upToYMatrix=new A.d,this._upVector=A.o.Zero()),K.normalize(),this._upVector.p(K),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){A.d.RotationAlignToRef(A.o.UpReadOnly,this._upVector,this._yToUpMatrix),A.d.RotationAlignToRef(this._upVector,A.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityX:0}set angularSensibilityX(K){const Y=this.inputs.attached.pointers;Y&&(Y.angularSensibilityX=K)}get angularSensibilityY(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityY:0}set angularSensibilityY(K){const Y=this.inputs.attached.pointers;Y&&(Y.angularSensibilityY=K)}get pinchPrecision(){const K=this.inputs.attached.pointers;return K?K.pinchPrecision:0}set pinchPrecision(K){const Y=this.inputs.attached.pointers;Y&&(Y.pinchPrecision=K)}get pinchDeltaPercentage(){const K=this.inputs.attached.pointers;return K?K.pinchDeltaPercentage:0}set pinchDeltaPercentage(K){const Y=this.inputs.attached.pointers;Y&&(Y.pinchDeltaPercentage=K)}get useNaturalPinchZoom(){const K=this.inputs.attached.pointers;return!!K&&K.useNaturalPinchZoom}set useNaturalPinchZoom(K){const Y=this.inputs.attached.pointers;Y&&(Y.useNaturalPinchZoom=K)}get panningSensibility(){const K=this.inputs.attached.pointers;return K?K.panningSensibility:0}set panningSensibility(K){const Y=this.inputs.attached.pointers;Y&&(Y.panningSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysUp=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysDown=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRight=K)}get wheelPrecision(){const K=this.inputs.attached.mousewheel;return K?K.wheelPrecision:0}set wheelPrecision(K){const Y=this.inputs.attached.mousewheel;Y&&(Y.wheelPrecision=K)}get zoomToMouseLocation(){const K=this.inputs.attached.mousewheel;return!!K&&K.zoomToMouseLocation}set zoomToMouseLocation(K){const Y=this.inputs.attached.mousewheel;Y&&(Y.zoomToMouseLocation=K)}get wheelDeltaPercentage(){const K=this.inputs.attached.mousewheel;return K?K.wheelDeltaPercentage:0}set wheelDeltaPercentage(K){const Y=this.inputs.attached.mousewheel;Y&&(Y.wheelDeltaPercentage=K)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(K){K!==this.useBouncingBehavior&&(K?(this._bouncingBehavior=new W,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(K){K!==this.useFramingBehavior&&(K?(this._framingBehavior=new g,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(K){K!==this.useAutoRotationBehavior&&(K?(this._autoRotationBehavior=new M,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(K,Y,l,v,U,c){var t;let Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(K,A.o.Zero(),c,Z),t=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=A.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=A.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new A.d,this.panningAxis=new A.o(1,1,0),this._transformedDirection=new A.o,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new d.b,this.checkCollisions=!1,this.collisionRadius=new A.o(.5,.5,.5),this._previousPosition=A.o.Zero(),this._collisionVelocity=A.o.Zero(),this._newPosition=A.o.Zero(),this._computationVector=A.o.Zero(),this._onCollisionPositionChange=function(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;l?(t.setPosition(Y),t.Th&&t.Th(l)):t._previousPosition.p(t._position);const v=Math.cos(t.alpha),U=Math.sin(t.alpha),d=Math.cos(t.beta);let A=Math.sin(t.beta);0===A&&(A=1e-4);const c=t._getTargetPosition();t._computationVector.mi(t.radius*v*A,t.radius*d,t.radius*U*A),c.addToRef(t._computationVector,t._newPosition),t._position.p(t._newPosition);let Z=t.upVector;t.allowUpsideDown&&t.beta<0&&(Z=Z.clone(),Z=Z.negate()),t._computeViewMatrix(t._position,c,Z),t._viewMatrix.addAtIndex(12,t.targetScreenOffset.x),t._viewMatrix.addAtIndex(13,t.targetScreenOffset.y),t._collisionTriggered=!1},this._target=A.o.Zero(),U&&this.setTarget(U),this.alpha=Y,this.beta=l,this.radius=v,this.getViewMatrix(),this.inputs=new B(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=A.m.Zero()}_updateCache(K){K||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const K=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?K.addToRef(this._targetBoundingCenter,this._target):this._target.p(K)}const K=this._getLockedTargetPosition();return K||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>V.d&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(K,Y){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const U=arguments;Y=H.d.BackCompatCameraNoPreventDefault(U),this._useCtrlForPanning=l,this._panningMouseButton=v,"boolean"===typeof U[0]&&(U.length>1&&(this._useCtrlForPanning=U[1]),U.length>2&&(this._panningMouseButton=U[2])),this.inputs.attachElement(Y),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Li(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const K=this._scene.getEngine().getDeltaTime()/1e3,Y=1-Math.pow(2,-K/this.restoreStateInterpolationFactor);this.setTarget(A.o.Lerp(this.getTarget(),this._storedTarget,Y)),A.h.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,A.j.Quaternion[0]),A.h.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,A.j.Quaternion[1]),A.h.SlerpToRef(A.j.Quaternion[1],A.j.Quaternion[0],Y,A.j.Quaternion[2]),A.j.Quaternion[2].normalize(),A.j.Quaternion[2].toAlphaBetaGammaToRef(A.j.Qi[0]),this.alpha=A.j.Qi[0].x,this.beta=A.j.Qi[0].y,this.radius+=(this._storedRadius-this.radius)*Y,A.m.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,Y,this.targetScreenOffset),(A.o.DistanceSquared(this.getTarget(),this._storedTarget)<V.d&&A.j.Quaternion[2].equalsWithEpsilon(A.j.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<V.d&&A.m.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<V.d||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const K=this.invertRotation?-1:1,Y=this._calculateHandednessMultiplier();let l=this.inertialAlphaOffset*Y;this.beta<0&&(l*=-1),this.alpha+=l*K,this.beta+=this.inertialBetaOffset*K,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<V.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<V.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*V.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const K=new A.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),K.multiplyInPlace(this.panningAxis),A.o.TransformNormalToRef(K,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const K=this.upVector,Y=A.o.CrossToRef(this._transformedDirection,K,this._transformedDirection);A.o.CrossToRef(K,Y,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);A.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const K=A.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.transposeToRef(K),A.o.TransformCoordinatesToRef(this._transformedDirection,K,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*V.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*V.d&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const K=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const Y=Math.round((K-this.alpha)/(2*Math.PI));this.alpha+=2*Y*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(K){this._position.equals(K)||(this._position.p(K),this.rebuildAnglesAndRadius())}setTarget(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(v=this.overrideCloneAlphaBetaRadius??v,K.ri)Y&&K.getBoundingInfo?this._targetBoundingCenter=K.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,K.ri(),this._targetHost=K,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Y=K,v=this._getTargetPosition();if(v&&!l&&v.equals(Y))return;this._targetHost=null,this._target=Y,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}v||this.rebuildAnglesAndRadius()}_getViewMatrix(){const K=Math.cos(this.alpha),Y=Math.sin(this.alpha),l=Math.cos(this.beta);let v=Math.sin(this.beta);0===v&&(v=1e-4),0===this.radius&&(this.radius=1e-4);const U=this._getTargetPosition();if(this._computationVector.mi(this.radius*K*v,this.radius*l,this.radius*Y*v),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),U.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const K=this.va().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,K.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let K=this.upVector;this.allowUpsideDown&&v<0&&(K=K.negate()),this._computeViewMatrix(this._position,U,K),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=U,this._viewMatrix}zoomOn(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K||this.va().meshes;const l=t.e.MinMax(K);let v=this._calculateLowerRadiusFromModelBoundingSphere(l.min,l.max);v=Math.max(Math.min(v,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=v*this.zoomOnFactor,this.focusOn({min:l.min,max:l.max,distance:v},Y)}focusOn(K){let Y,l,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===K.min){const v=K||this.va().meshes;Y=t.e.MinMax(v),l=A.o.Distance(Y.min,Y.max)}else{Y=K,l=K.distance}this._target=t.e.Center(Y),v||(this.maxZ=2*l)}createRigCamera(K,Y){let l=0;switch(this.cameraRigMode){case J.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.c.RIG_MODE_VR:l=this._cameraRigParams.stereoHalfAngle*(0===Y?1:-1);break;case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:l=this._cameraRigParams.stereoHalfAngle*(0===Y?-1:1)}const v=new G(K,this.alpha+l,this.beta,this.radius,this._target,this.va());return v._cameraRigParams={},v.isRigCamera=!0,v.rigParent=this,v.upVector=this.upVector,v.mode=this.mode,v.orthoLeft=this.orthoLeft,v.orthoRight=this.orthoRight,v.orthoBottom=this.orthoBottom,v.orthoTop=this.orthoTop,v}_updateRigCameras(){const K=this._rigCameras[0],Y=this._rigCameras[1];switch(K.beta=Y.beta=this.beta,this.cameraRigMode){case J.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.c.RIG_MODE_VR:K.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case J.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const v=A.o.Distance(K,Y),U=this.va().getEngine().getAspectRatio(this),d=Math.tan(this.fov/2),c=d*U,t=.5*v*l,Z=t*Math.sqrt(1+1/(c*c)),m=t*Math.sqrt(1+1/(d*d));return Math.max(Z,m)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,v.d)([(0,U.J)()],G.prototype,"alpha",void 0),(0,v.d)([(0,U.J)()],G.prototype,"beta",void 0),(0,v.d)([(0,U.J)()],G.prototype,"radius",void 0),(0,v.d)([(0,U.J)()],G.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,v.d)([(0,U.F)("target")],G.prototype,"_target",void 0),(0,v.d)([(0,U.w)("targetHost")],G.prototype,"_targetHost",void 0),(0,v.d)([(0,U.J)()],G.prototype,"inertialAlphaOffset",void 0),(0,v.d)([(0,U.J)()],G.prototype,"inertialBetaOffset",void 0),(0,v.d)([(0,U.J)()],G.prototype,"inertialRadiusOffset",void 0),(0,v.d)([(0,U.J)()],G.prototype,"lowerAlphaLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"upperAlphaLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"lowerBetaLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"upperBetaLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"lowerRadiusLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"upperRadiusLimit",void 0),(0,v.d)([(0,U.J)()],G.prototype,"inertialPanningX",void 0),(0,v.d)([(0,U.J)()],G.prototype,"inertialPanningY",void 0),(0,v.d)([(0,U.J)()],G.prototype,"pinchToPanMaxDistance",void 0),(0,v.d)([(0,U.J)()],G.prototype,"panningDistanceLimit",void 0),(0,v.d)([(0,U.F)()],G.prototype,"panningOriginTarget",void 0),(0,v.d)([(0,U.J)()],G.prototype,"panningInertia",void 0),(0,v.d)([(0,U.J)()],G.prototype,"zoomToMouseLocation",null),(0,v.d)([(0,U.J)()],G.prototype,"zoomOnFactor",void 0),(0,v.d)([(0,U.E)()],G.prototype,"targetScreenOffset",void 0),(0,v.d)([(0,U.J)()],G.prototype,"allowUpsideDown",void 0),(0,v.d)([(0,U.J)()],G.prototype,"useInputToRestoreState",void 0),(0,v.d)([(0,U.J)()],G.prototype,"restoreStateInterpolationFactor",void 0),(0,P.f)("BABYLON.ArcRotateCamera",G)},12448:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>A,f:()=>c});var v=l(492),U=l(702),d=l(644),A={};class c{constructor(K){this.attachedToElement=!1,this.attached={},this.camera=K,this.checkInputs=()=>{}}add(K){const Y=K.getSimpleName();this.attached[Y]?v.e.Warn("camera input of type "+Y+" already exists on camera"):(this.attached[Y]=K,K.camera=this.camera,K.checkInputs&&(this.checkInputs=this._addCheckInputs(K.checkInputs.bind(K))),this.attachedToElement&&K.attachControl(this.noPreventDefault))}remove(K){for(const Y in this.attached){const l=this.attached[Y];if(l===K)return l.Li(),l.camera=null,delete this.attached[Y],void this.rebuildInputCheck()}}removeByType(K){for(const Y in this.attached){const l=this.attached[Y];l.getClassName()===K&&(l.Li(),l.camera=null,delete this.attached[Y],this.rebuildInputCheck())}}_addCheckInputs(K){const Y=this.checkInputs;return()=>{Y(),K()}}attachInput(K){this.attachedToElement&&K.attachControl(this.noPreventDefault)}attachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){K=!d.c.ForceAttachControlToAlwaysPreventDefault&&K,this.attachedToElement=!0,this.noPreventDefault=K;for(const Y in this.attached)this.attached[Y].attachControl(K)}}detachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Y in this.attached)this.attached[Y].Li(),K&&(this.attached[Y].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const K in this.attached){const Y=this.attached[K];Y.checkInputs&&(this.checkInputs=this._addCheckInputs(Y.checkInputs.bind(Y)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(K){const Y={};for(const l in this.attached){const K=this.attached[l],v=U.c.Serialize(K);Y[K.getClassName()]=v}K.inputsmgr=Y}parse(K){const Y=K.inputsmgr;if(Y){this.clear();for(const K in Y){const l=A[K];if(l){const v=Y[K],d=U.c.Parse((()=>new l),v,null);this.add(d)}}}else for(const l in this.attached){const Y=A[this.attached[l].getClassName()];if(Y){const v=U.c.Parse((()=>new Y),K,null);this.remove(this.attached[l]),this.add(v)}}}}},12432:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>r});var v=l(646),U=l(652),d=l(675),A=l(12441),c=l(12448),t=l(2398),Z=l(475);class m{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(K){K=Z.d.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Y=>{const l=Y.event;if(!l.metaKey)if(Y.type===t.b.KEYDOWN){if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){-1===this._keys.indexOf(l.keyCode)&&this._keys.push(l.keyCode),K||l.preventDefault()}}else if(-1!==this.keysUp.indexOf(l.keyCode)||-1!==this.keysDown.indexOf(l.keyCode)||-1!==this.keysLeft.indexOf(l.keyCode)||-1!==this.keysRight.indexOf(l.keyCode)||-1!==this.keysUpward.indexOf(l.keyCode)||-1!==this.keysDownward.indexOf(l.keyCode)||-1!==this.keysRotateLeft.indexOf(l.keyCode)||-1!==this.keysRotateRight.indexOf(l.keyCode)||-1!==this.keysRotateUp.indexOf(l.keyCode)||-1!==this.keysRotateDown.indexOf(l.keyCode)){const Y=this._keys.indexOf(l.keyCode);Y>=0&&this._keys.splice(Y,1),K||l.preventDefault()}})))}Li(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let Y=0;Y<this._keys.length;Y++){const l=this._keys[Y],v=K._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(l)?K._localDirection.mi(-v,0,0):-1!==this.keysUp.indexOf(l)?K._localDirection.mi(0,0,v):-1!==this.keysRight.indexOf(l)?K._localDirection.mi(v,0,0):-1!==this.keysDown.indexOf(l)?K._localDirection.mi(0,0,-v):-1!==this.keysUpward.indexOf(l)?K._localDirection.mi(0,v,0):-1!==this.keysDownward.indexOf(l)?K._localDirection.mi(0,-v,0):-1!==this.keysRotateLeft.indexOf(l)?(K._localDirection.mi(0,0,0),K.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(l)?(K._localDirection.mi(0,0,0),K.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(l)?(K._localDirection.mi(0,0,0),K.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(l)&&(K._localDirection.mi(0,0,0),K.cameraRotation.x+=this._getLocalRotation()),K.va().useRightHandedSystem&&(K._localDirection.z*=-1),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),d.o.TransformNormalToRef(K._localDirection,K._cameraTransformMatrix,K._transformedDirection),K.cameraDirection.addInPlace(K._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const K=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*K}}(0,v.d)([(0,U.J)()],m.prototype,"keysUp",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysUpward",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysDown",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysDownward",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysLeft",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysRight",void 0),(0,v.d)([(0,U.J)()],m.prototype,"rotationSpeed",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysRotateLeft",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysRotateRight",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysRotateUp",void 0),(0,v.d)([(0,U.J)()],m.prototype,"keysRotateDown",void 0),c.e.FreeCameraKeyboardMoveInput=m;var V=l(469),M=l(2395);class u{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=K,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new V.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(K){K=Z.d.BackCompatCameraNoPreventDefault(arguments);const Y=this.camera.getEngine(),l=Y.getInputElement();this._pointerInput||(this._pointerInput=v=>{const U=v.event,d="touch"===U.pointerType;if(!this.touchEnabled&&d)return;if(v.type!==M.b.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const A=U.target;if(v.type===M.b.POINTERDOWN){if(d&&-1!==this._activePointerId||!d&&-1!==this._currentActiveButton)return;this._activePointerId=U.pointerId;try{null===A||void 0===A||A.setPointerCapture(U.pointerId)}catch(c){}-1===this._currentActiveButton&&(this._currentActiveButton=U.button),this._previousPosition={x:U.clientX,y:U.clientY},K||(U.preventDefault(),l&&l.focus()),Y.isPointerLock&&this._onMouseMove&&this._onMouseMove(v.event)}else if(v.type===M.b.POINTERUP){if(d&&this._activePointerId!==U.pointerId||!d&&this._currentActiveButton!==U.button)return;try{null===A||void 0===A||A.releasePointerCapture(U.pointerId)}catch(c){}this._currentActiveButton=-1,this._previousPosition=null,K||U.preventDefault(),this._activePointerId=-1}else if(v.type===M.b.POINTERMOVE&&(this._activePointerId===U.pointerId||!d))if(Y.isPointerLock&&this._onMouseMove)this._onMouseMove(v.event);else if(this._previousPosition){const Y=this.camera._calculateHandednessMultiplier(),l=(U.clientX-this._previousPosition.x)*Y,v=U.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=l/this.angularSensibility,this.camera.cameraRotation.x+=v/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:l,offsetY:v}),this._previousPosition={x:U.clientX,y:U.clientY},K||U.preventDefault()}}),this._onMouseMove=l=>{if(!Y.isPointerLock)return;const v=this.camera._calculateHandednessMultiplier(),U=l.movementX*v;this.camera.cameraRotation.y+=U/this.angularSensibility;const d=l.movementY;this.camera.cameraRotation.x+=d/this.angularSensibility,this._previousPosition=null,K||l.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,M.b.POINTERDOWN|M.b.POINTERUP|M.b.POINTERMOVE),l&&(this._contextMenuBind=K=>this.onContextMenu(K),l.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(K){K.preventDefault()}Li(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,v.d)([(0,U.J)()],u.prototype,"buttons",void 0),(0,v.d)([(0,U.J)()],u.prototype,"angularSensibility",void 0),c.e.FreeCameraMouseInput=u;var o,W=l(2407);class g{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new V.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(K){K=Z.d.BackCompatCameraNoPreventDefault(arguments),this._wheel=Y=>{if(Y.type!==M.b.POINTERWHEEL)return;const l=Y.event,v=l.deltaMode===W.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*v*l.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*v*l.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*v*l.deltaZ/this._normalize,l.preventDefault&&(K||l.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,M.b.POINTERWHEEL)}Li(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,v.d)([(0,U.J)()],g.prototype,"wheelPrecisionX",void 0),(0,v.d)([(0,U.J)()],g.prototype,"wheelPrecisionY",void 0),(0,v.d)([(0,U.J)()],g.prototype,"wheelPrecisionZ",void 0),function(K){K[K.MoveRelative=0]="MoveRelative",K[K.RotateRelative=1]="RotateRelative",K[K.MoveScene=2]="MoveScene"}(o||(o={}));class J extends g{constructor(){super(...arguments),this._moveRelative=d.o.Zero(),this._rotateRelative=d.o.Zero(),this._moveScene=d.o.Zero(),this._wheelXAction=o.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=o.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(K){null===K&&this._wheelXAction!==o.MoveRelative||(this._wheelXAction=o.MoveRelative,this._wheelXActionCoordinate=K)}get wheelXMoveRelative(){return this._wheelXAction!==o.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(K){null===K&&this._wheelYAction!==o.MoveRelative||(this._wheelYAction=o.MoveRelative,this._wheelYActionCoordinate=K)}get wheelYMoveRelative(){return this._wheelYAction!==o.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(K){null===K&&this._wheelZAction!==o.MoveRelative||(this._wheelZAction=o.MoveRelative,this._wheelZActionCoordinate=K)}get wheelZMoveRelative(){return this._wheelZAction!==o.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(K){null===K&&this._wheelXAction!==o.RotateRelative||(this._wheelXAction=o.RotateRelative,this._wheelXActionCoordinate=K)}get wheelXRotateRelative(){return this._wheelXAction!==o.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(K){null===K&&this._wheelYAction!==o.RotateRelative||(this._wheelYAction=o.RotateRelative,this._wheelYActionCoordinate=K)}get wheelYRotateRelative(){return this._wheelYAction!==o.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(K){null===K&&this._wheelZAction!==o.RotateRelative||(this._wheelZAction=o.RotateRelative,this._wheelZActionCoordinate=K)}get wheelZRotateRelative(){return this._wheelZAction!==o.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(K){null===K&&this._wheelXAction!==o.MoveScene||(this._wheelXAction=o.MoveScene,this._wheelXActionCoordinate=K)}get wheelXMoveScene(){return this._wheelXAction!==o.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(K){null===K&&this._wheelYAction!==o.MoveScene||(this._wheelYAction=o.MoveScene,this._wheelYActionCoordinate=K)}get wheelYMoveScene(){return this._wheelYAction!==o.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(K){null===K&&this._wheelZAction!==o.MoveScene||(this._wheelZAction=o.MoveScene,this._wheelZActionCoordinate=K)}get wheelZMoveScene(){return this._wheelZAction!==o.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.li(0),this._rotateRelative.li(0),this._moveScene.li(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const K=d.d.Zero();this.camera.getViewMatrix().invertToRef(K);const Y=d.o.Zero();d.o.TransformNormalToRef(this._moveRelative,K,Y),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Y),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(K,Y,l){if(0===K)return;if(null===Y||null===l)return;let v=null;switch(Y){case o.MoveRelative:v=this._moveRelative;break;case o.RotateRelative:v=this._rotateRelative;break;case o.MoveScene:v=this._moveScene}switch(l){case 0:v.set(K,0,0);break;case 1:v.set(0,K,0);break;case 2:v.set(0,0,K)}}}(0,v.d)([(0,U.J)()],J.prototype,"wheelXMoveRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelYMoveRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelZMoveRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelXRotateRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelYRotateRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelZRotateRelative",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelXMoveScene",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelYMoveScene",null),(0,v.d)([(0,U.J)()],J.prototype,"wheelZMoveScene",null),c.e.FreeCameraMouseWheelInput=J;class n{constructor(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=K,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Z.d.IsSafari()}attachControl(K){K=Z.d.BackCompatCameraNoPreventDefault(arguments);let Y=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=l=>{const v=l.event,U="mouse"===v.pointerType||this._isSafari&&"undefined"===typeof v.pointerType;if(this.allowMouse||!U)if(l.type===M.b.POINTERDOWN){if(K||v.preventDefault(),this._pointerPressed.push(v.pointerId),1!==this._pointerPressed.length)return;Y={x:v.clientX,y:v.clientY}}else if(l.type===M.b.POINTERUP){K||v.preventDefault();const l=this._pointerPressed.indexOf(v.pointerId);if(-1===l)return;if(this._pointerPressed.splice(l,1),0!=l)return;Y=null,this._offsetX=null,this._offsetY=null}else if(l.type===M.b.POINTERMOVE){if(K||v.preventDefault(),!Y)return;if(0!=this._pointerPressed.indexOf(v.pointerId))return;this._offsetX=v.clientX-Y.x,this._offsetY=-(v.clientY-Y.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,M.b.POINTERDOWN|M.b.POINTERUP|M.b.POINTERMOVE),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.addEventListener("blur",this._onLostFocus)}}Li(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const K=this.camera,Y=K._calculateHandednessMultiplier();K.cameraRotation.y=Y*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)K.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Y=K._computeLocalCameraSpeed(),l=new d.o(0,0,0!==this.touchMoveSensibility?Y*this._offsetY/this.touchMoveSensibility:0);d.d.RotationYawPitchRollToRef(K.rotation.y,K.rotation.x,0,K._cameraRotationMatrix),K.cameraDirection.addInPlace(d.o.TransformCoordinates(l,K._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,v.d)([(0,U.J)()],n.prototype,"touchAngularSensibility",void 0),(0,v.d)([(0,U.J)()],n.prototype,"touchMoveSensibility",void 0),c.e.FreeCameraTouchInput=n;class R extends c.f{constructor(K){super(K),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new m),this}addMouse(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new u(K),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new J,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new n),this}clear(){super.clear(),this._mouseInput=null}}var H=l(619),z=l(567);class r extends A.e{get angularSensibility(){const K=this.inputs.attached.mouse;return K?K.angularSensibility:0}set angularSensibility(K){const Y=this.inputs.attached.mouse;Y&&(Y.angularSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysUp=K)}get keysUpward(){const K=this.inputs.attached.keyboard;return K?K.keysUpward:[]}set keysUpward(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysUpward=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysDown=K)}get keysDownward(){const K=this.inputs.attached.keyboard;return K?K.keysDownward:[]}set keysDownward(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysDownward=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRight=K)}get keysRotateLeft(){const K=this.inputs.attached.keyboard;return K?K.keysRotateLeft:[]}set keysRotateLeft(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRotateLeft=K)}get keysRotateRight(){const K=this.inputs.attached.keyboard;return K?K.keysRotateRight:[]}set keysRotateRight(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRotateRight=K)}get keysRotateUp(){const K=this.inputs.attached.keyboard;return K?K.keysRotateUp:[]}set keysRotateUp(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRotateUp=K)}get keysRotateDown(){const K=this.inputs.attached.keyboard;return K?K.keysRotateDown:[]}set keysRotateDown(K){const Y=this.inputs.attached.keyboard;Y&&(Y.keysRotateDown=K)}constructor(K,Y,l){var v;super(K,Y,l,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),v=this,this.ellipsoid=new d.o(.5,1,.5),this.ellipsoidOffset=new d.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=d.o.Zero(),this._diffPosition=d.o.Zero(),this._newPosition=d.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v._newPosition.p(Y),v._newPosition.subtractToRef(v._oldPosition,v._diffPosition),v._diffPosition.length()>z.b.CollisionsEpsilon&&(v.position.addToRef(v._diffPosition,v._deferredPositionUpdate),v._deferOnly?v._deferredUpdated=!0:v.position.p(v._deferredPositionUpdate),v.Th&&l&&v.Th(l))},this.inputs=new R(this),this.inputs.addKeyboard().addMouse()}attachControl(K,Y){Y=Z.d.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Y)}Li(){this.inputs.detachElement(),this.cameraDirection=new d.o(0,0,0),this.cameraRotation=new d.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(K){this._collisionMask=isNaN(K)?-1:K}_collideWithWorld(K){let Y;Y=this.parent?d.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Y.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const l=this.va().collisionCoordinator;this._collider||(this._collider=l.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let v=K;this.applyGravity&&(v=K.add(this.va().gravity)),l.getNewPosition(this._oldPosition,v,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=d.o.Zero(),this._transformedDirection=d.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(K){this._needMoveForGravity=K}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"eb"}}(0,v.d)([(0,U.F)()],r.prototype,"ellipsoid",void 0),(0,v.d)([(0,U.F)()],r.prototype,"ellipsoidOffset",void 0),(0,v.d)([(0,U.J)()],r.prototype,"checkCollisions",void 0),(0,v.d)([(0,U.J)()],r.prototype,"applyGravity",void 0),(0,H.f)("BABYLON.FreeCamera",r)},12441:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>Z});var v=l(646),U=l(652),d=l(644),A=l(675),c=l(681),t=l(833);l(699).b.AddNodeConstructor("TargetCamera",((K,Y)=>()=>new Z(K,A.o.Zero(),Y)));class Z extends d.c{constructor(K,Y,l){super(K,Y,l,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=A.o.Zero(),this._tmpTargetVector=A.o.Zero(),this.cameraDirection=new A.o(0,0,0),this.cameraRotation=new A.m(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new A.h,this.rotation=new A.o(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=A.o.Zero(),this._initialFocalDistance=1,this._viewMatrix=A.d.Zero(),this._camMatrix=A.d.Zero(),this._cameraTransformMatrix=A.d.Zero(),this._cameraRotationMatrix=A.d.Zero(),this._referencePoint=new A.o(0,0,1),this._transformedReferencePoint=A.o.Zero(),this._deferredPositionUpdate=new A.o,this._deferredRotationQuaternionUpdate=new A.h,this._deferredRotationUpdate=new A.o,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=A.o.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(K){this.getWorldMatrix();const Y=this.getTarget().Lg(this.position);return Y.normalize(),Y.scaleInPlace(K),this.globalPosition.add(Y)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const K=this.lockedTarget;K.ri().getTranslationToRef(K.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.mi(0,0,0),this.cameraRotation.mi(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new A.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new A.h(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(K){K||super._updateCache();const Y=this._getLockedTargetPosition();Y?this._cache.lockedTarget?this._cache.lockedTarget.p(Y):this._cache.lockedTarget=Y.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const K=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(K):!K)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const K=this.getEngine();return this.speed*Math.sqrt(K.getDeltaTime()/(100*K.getFps()))}setTarget(K){this.upVector.normalize(),this._initialFocalDistance=K.Lg(this.position).length(),this.position.z===K.z&&(this.position.z+=c.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),A.d.LookAtLHToRef(this.position,K,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const Y=K.Lg(this.position);Y.x>=0?this.rotation.y=-Math.atan(Y.z/Y.x)+Math.PI/2:this.rotation.y=-Math.atan(Y.z/Y.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&A.h.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(K){this.setTarget(K)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(A.j.Matrix[0]),A.o.TransformNormalToRef(this.cameraDirection,A.j.Matrix[0],A.j.Qi[0]),this._deferredPositionUpdate.addInPlace(A.j.Qi[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const K=this.invertRotation?-this.inverseRotationSpeed:1,Y=this._decideIfNeedsToMove(),l=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),Y&&this._updatePosition(),l){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*K,this._deferredRotationUpdate.y+=this.cameraRotation.y*K,!this.noRotationConstraint){const K=1.570796;this._deferredRotationUpdate.x>K&&(this._deferredRotationUpdate.x=K),this._deferredRotationUpdate.x<-K&&(this._deferredRotationUpdate.x=-K)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(A.h.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}Y&&(Math.abs(this.cameraDirection.x)<this.speed*c.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*c.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*c.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),l&&(Math.abs(this.cameraRotation.x)<this.speed*c.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*c.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):A.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return A.o.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),A.o.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?t.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(A.h.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),t.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(K,Y,l){if(this.ignoreParentScaling){if(this.parent){const v=this.parent.getWorldMatrix();A.o.TransformCoordinatesToRef(K,v,this._globalPosition),A.o.TransformCoordinatesToRef(Y,v,this._tmpTargetVector),A.o.TransformNormalToRef(l,v,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(K),this._tmpTargetVector.p(Y),this._tmpUpVector.p(l);this.va().useRightHandedSystem?A.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):A.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?A.d.LookAtRHToRef(K,Y,l,this._viewMatrix):A.d.LookAtLHToRef(K,Y,l,this._viewMatrix),this.parent){const K=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(K,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(K)}createRigCamera(K,Y){if(this.cameraRigMode!==d.c.RIG_MODE_NONE){const Y=new Z(K,this.position.clone(),this.va());return Y.isRigCamera=!0,Y.rigParent=this,this.cameraRigMode===d.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new A.h),Y._cameraRigParams={},Y.rotationQuaternion=new A.h),Y.mode=this.mode,Y.orthoLeft=this.orthoLeft,Y.orthoRight=this.orthoRight,Y.orthoTop=this.orthoTop,Y.orthoBottom=this.orthoBottom,Y}return null}_updateRigCameras(){const K=this._rigCameras[0],Y=this._rigCameras[1];switch(this.ri(),this.cameraRigMode){case d.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case d.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const l=this.cameraRigMode===d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,v=this.cameraRigMode===d.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*l,K),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*v,Y);break}case d.c.RIG_MODE_VR:K.rotationQuaternion?(K.rotationQuaternion.p(this.rotationQuaternion),Y.rotationQuaternion.p(this.rotationQuaternion)):(K.rotation.p(this.rotation),Y.rotation.p(this.rotation)),K.position.p(this.position),Y.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(K,Y){this.getTarget().subtractToRef(this.position,Z._TargetFocalPoint),Z._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const l=Z._TargetFocalPoint.addInPlace(this.position);A.d.TranslationToRef(-l.x,-l.y,-l.z,Z._TargetTransformMatrix),Z._TargetTransformMatrix.multiplyToRef(A.d.RotationAxis(Y.upVector,K),Z._RigCamTransformMatrix),A.d.TranslationToRef(l.x,l.y,l.z,Z._TargetTransformMatrix),Z._RigCamTransformMatrix.multiplyToRef(Z._TargetTransformMatrix,Z._RigCamTransformMatrix),A.o.TransformCoordinatesToRef(this.position,Z._RigCamTransformMatrix,Y.position),Y.setTarget(l)}getClassName(){return"TargetCamera"}}Z._RigCamTransformMatrix=new A.d,Z._TargetTransformMatrix=new A.d,Z._TargetFocalPoint=new A.o,(0,v.d)([(0,U.F)()],Z.prototype,"rotation",void 0),(0,v.d)([(0,U.J)()],Z.prototype,"speed",void 0),(0,v.d)([(0,U.w)("lockedTargetId")],Z.prototype,"lockedTarget",void 0)},12729:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>d});var v=l(668),U=l(12733);class d{constructor(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=l,this.hl=[],this._maxBlockCapacity=Y||64,this._selectionContent=new v.b(1024),this._creationFunc=K}update(K,Y,l){U.c._CreateBlocks(K,Y,l,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Wi(K){for(let Y=0;Y<this.Sk.length;Y++){this.Sk[Y].addEntry(K)}}gi(K){for(let Y=0;Y<this.Sk.length;Y++){this.Sk[Y].removeEntry(K)}}select(K,Y){this._selectionContent.reset();for(let l=0;l<this.Sk.length;l++){this.Sk[l].select(K,this._selectionContent,Y)}return Y?this._selectionContent.concat(this.hl):this._selectionContent.concatWithNoDuplicate(this.hl),this._selectionContent}intersects(K,Y,l){this._selectionContent.reset();for(let v=0;v<this.Sk.length;v++){this.Sk[v].intersects(K,Y,this._selectionContent,l)}return l?this._selectionContent.concat(this.hl):this._selectionContent.concatWithNoDuplicate(this.hl),this._selectionContent}intersectsRay(K){this._selectionContent.reset();for(let Y=0;Y<this.Sk.length;Y++){this.Sk[Y].intersectsRay(K,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.hl),this._selectionContent}}d.CreationFuncForMeshes=(K,Y)=>{const l=K.getBoundingInfo();!K.isBlocked&&l.boundingBox.intersectsMinMax(Y.jl,Y.kl)&&Y.entries.push(K)},d.CreationFuncForSubMeshes=(K,Y)=>{K.getBoundingInfo().boundingBox.intersectsMinMax(Y.jl,Y.kl)&&Y.entries.push(K)}},12733:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>d});var v=l(675),U=l(769);class d{constructor(K,Y,l,v,U,d){this.entries=[],this.ll=new Array,this._capacity=l,this._depth=v,this._maxDepth=U,this._creationFunc=d,this._minPoint=K,this._maxPoint=Y,this.ll.push(K.clone()),this.ll.push(Y.clone()),this.ll.push(K.clone()),this.ll[2].x=Y.x,this.ll.push(K.clone()),this.ll[3].y=Y.y,this.ll.push(K.clone()),this.ll[4].z=Y.z,this.ll.push(Y.clone()),this.ll[5].z=K.z,this.ll.push(Y.clone()),this.ll[6].x=K.x,this.ll.push(Y.clone()),this.ll[7].y=K.y}get Wh(){return this._capacity}get jl(){return this._minPoint}get kl(){return this._maxPoint}addEntry(K){if(this.Sk)for(let Y=0;Y<this.Sk.length;Y++){this.Sk[Y].addEntry(K)}else this._creationFunc(K,this),this.entries.length>this.Wh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(K){if(this.Sk){for(let Y=0;Y<this.Sk.length;Y++){this.Sk[Y].removeEntry(K)}return}const Y=this.entries.indexOf(K);Y>-1&&this.entries.splice(Y,1)}addEntries(K){for(let Y=0;Y<K.length;Y++){const l=K[Y];this.addEntry(l)}}select(K,Y,l){if(U.b.IsInFrustum(this.ll,K)){if(this.Sk){for(let v=0;v<this.Sk.length;v++){this.Sk[v].select(K,Y,l)}return}l?Y.concat(this.entries):Y.concatWithNoDuplicate(this.entries)}}intersects(K,Y,l,v){if(U.b.IntersectsSphere(this._minPoint,this._maxPoint,K,Y)){if(this.Sk){for(let U=0;U<this.Sk.length;U++){this.Sk[U].intersects(K,Y,l,v)}return}v?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersectsRay(K,Y){if(K.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Sk){for(let l=0;l<this.Sk.length;l++){this.Sk[l].intersectsRay(K,Y)}return}Y.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){d._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(K,Y,l,U,A,c,t,Z){t.Sk=new Array;const m=new v.o((Y.x-K.x)/2,(Y.y-K.y)/2,(Y.z-K.z)/2);for(let v=0;v<2;v++)for(let Y=0;Y<2;Y++)for(let V=0;V<2;V++){const M=K.add(m.multiplyByFloats(v,Y,V)),u=K.add(m.multiplyByFloats(v+1,Y+1,V+1)),o=new d(M,u,U,A+1,c,Z);o.addEntries(l),t.Sk.push(o)}}}},12739:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>m});var v=l(2366),U=l(675),d=l(809),A=l(12151),c=l(863),t=l(12729),Z=l(526);v.b.prototype.createOrUpdateSelectionOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,l=this._getComponent(c.c.NAME_OCTREE);l||(l=new m(this),this.bb(l)),this.fl||(this.fl=new t.b(t.b.CreationFuncForMeshes,K,Y));const v=this.getWorldExtends();return this.fl.update(v.min,v.max,this.meshes),this.fl},Object.defineProperty(v.b.prototype,"selectionOctree",{get:function(){return this.fl},enumerable:!0,configurable:!0}),d.b.prototype.createOrUpdateSubmeshesOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const l=this.va();let v=l._getComponent(c.c.NAME_OCTREE);v||(v=new m(l),l.bb(v)),this._submeshesOctree||(this._submeshesOctree=new t.b(t.b.CreationFuncForSubMeshes,K,Y)),this.ri(!0);const U=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(U.minimumWorld,U.maximumWorld,this.ui),this._submeshesOctree};class m{constructor(K){this.name=c.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new A.c(U.o.Zero(),new U.o(1,1,1)),(K=K||Z.e.LastCreatedScene)&&(this.hi=K,this.hi.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.hi.getActiveSubMeshCandidates=K=>this.getActiveSubMeshCandidates(K),this.hi.getCollidingSubMeshCandidates=(K,Y)=>this.getCollidingSubMeshCandidates(K,Y),this.hi.getIntersectingSubMeshCandidates=(K,Y)=>this.getIntersectingSubMeshCandidates(K,Y))}register(){this.hi.onMeshRemovedObservable.add((K=>{const Y=this.hi.selectionOctree;if(void 0!==Y&&null!==Y){const l=Y.hl.indexOf(K);-1!==l&&Y.hl.splice(l,1)}})),this.hi.onMeshImportedObservable.add((K=>{const Y=this.hi.selectionOctree;void 0!==Y&&null!==Y&&Y.Wi(K)}))}getActiveMeshCandidates(){var K;return(null===(K=this.hi.fl)||void 0===K?void 0:K.select(this.hi.frustumPlanes))||this.hi._getDefaultMeshCandidates()}getActiveSubMeshCandidates(K){if(K._submeshesOctree&&K.useOctreeForRenderingSelection){return K._submeshesOctree.select(this.hi.frustumPlanes)}return this.hi._getDefaultSubMeshCandidates(K)}getIntersectingSubMeshCandidates(K,Y){if(K._submeshesOctree&&K.useOctreeForPicking){A.c.TransformToRef(Y,K.getWorldMatrix(),this._tempRay);return K._submeshesOctree.intersectsRay(this._tempRay)}return this.hi._getDefaultSubMeshCandidates(K)}getCollidingSubMeshCandidates(K,Y){if(K._submeshesOctree&&K.useOctreeForCollisions){const l=Y._velocityWorldLength+Math.max(Y._radius.x,Y._radius.y,Y._radius.z);return K._submeshesOctree.intersects(Y._basePointWorld,l)}return this.hi._getDefaultSubMeshCandidates(K)}rebuild(){}dispose(){}}},12151:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>u});var v=l(2366),U=l(644),d=l(681),A=l(675),c=l(686),t=l(756),Z=l(823),m=l(526),V=l(2413);const M={internalPickerForMesh:void 0};class u{constructor(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.d;this.origin=K,this.direction=Y,this.length=l,this.epsilon=v}clone(){return new u(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const v=u._TmpVector3[0].mi(K.x-l,K.y-l,K.z-l),U=u._TmpVector3[1].mi(Y.x+l,Y.y+l,Y.z+l);let d,A,c,t,Z=0,m=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<v.x||this.origin.x>U.x)return!1}else if(d=1/this.direction.x,A=(v.x-this.origin.x)*d,c=(U.x-this.origin.x)*d,c===-1/0&&(c=1/0),A>c&&(t=A,A=c,c=t),Z=Math.max(A,Z),m=Math.min(c,m),Z>m)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<v.y||this.origin.y>U.y)return!1}else if(d=1/this.direction.y,A=(v.y-this.origin.y)*d,c=(U.y-this.origin.y)*d,c===-1/0&&(c=1/0),A>c&&(t=A,A=c,c=t),Z=Math.max(A,Z),m=Math.min(c,m),Z>m)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<v.z||this.origin.z>U.z)return!1}else if(d=1/this.direction.z,A=(v.z-this.origin.z)*d,c=(U.z-this.origin.z)*d,c===-1/0&&(c=1/0),A>c&&(t=A,A=c,c=t),Z=Math.max(A,Z),m=Math.min(c,m),Z>m)return!1;return!0}intersectsBox(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(K.minimum,K.maximum,Y)}intersectsSphere(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const l=K.center.x-this.origin.x,v=K.center.y-this.origin.y,U=K.center.z-this.origin.z,d=l*l+v*v+U*U,A=K.radius+Y,c=A*A;if(d<=c)return!0;const t=l*this.direction.x+v*this.direction.y+U*this.direction.z;if(t<0)return!1;return d-t*t<=c}intersectsTriangle(K,Y,l){const v=u._TmpVector3[0],U=u._TmpVector3[1],d=u._TmpVector3[2],c=u._TmpVector3[3],Z=u._TmpVector3[4];Y.subtractToRef(K,v),l.subtractToRef(K,U),A.o.CrossToRef(this.direction,U,d);const m=A.o.Dot(v,d);if(0===m)return null;const V=1/m;this.origin.subtractToRef(K,c);const M=A.o.Dot(c,d)*V;if(M<-this.epsilon||M>1+this.epsilon)return null;A.o.CrossToRef(c,v,Z);const o=A.o.Dot(this.direction,Z)*V;if(o<-this.epsilon||M+o>1+this.epsilon)return null;const W=A.o.Dot(U,Z)*V;return W>this.length?null:new t.b(1-M-o,M,W)}intersectsPlane(K){let Y;const l=A.o.Dot(K.Ri,this.direction);if(Math.abs(l)<9.99999997475243e-7)return null;{const v=A.o.Dot(K.Ri,this.origin);return Y=(-K.d-v)/l,Y<0?Y<-9.99999997475243e-7?null:0:Y}}intersectsAxis(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(K){case"y":{const K=(this.origin.y-Y)/this.direction.y;return K>0?null:new A.o(this.origin.x+this.direction.x*-K,Y,this.origin.z+this.direction.z*-K)}case"x":{const K=(this.origin.x-Y)/this.direction.x;return K>0?null:new A.o(Y,this.origin.y+this.direction.y*-K,this.origin.z+this.direction.z*-K)}case"z":{const K=(this.origin.z-Y)/this.direction.z;return K>0?null:new A.o(this.origin.x+this.direction.x*-K,this.origin.y+this.direction.y*-K,Y)}default:return null}}intersectsMesh(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=A.j.Matrix[0];return K.getWorldMatrix().invertToRef(c),this._tmpRay?u.TransformToRef(this,c,this._tmpRay):this._tmpRay=u.Transform(this,c),K.intersects(this._tmpRay,Y,l,v,U,d)}intersectsMeshes(K,Y,l){l?l.length=0:l=[];for(let v=0;v<K.length;v++){const U=this.intersectsMesh(K[v],Y);U.hit&&l.push(U)}return l.sort(this._comparePickingInfo),l}_comparePickingInfo(K,Y){return K.distance<Y.distance?-1:K.distance>Y.distance?1:0}intersectionSegment(K,Y,l){const v=this.origin,U=A.j.Qi[0],d=A.j.Qi[1],c=A.j.Qi[2],t=A.j.Qi[3];Y.subtractToRef(K,U),this.direction.scaleToRef(u._Rayl,c),v.addToRef(c,d),K.subtractToRef(v,t);const Z=A.o.Dot(U,U),m=A.o.Dot(U,c),V=A.o.Dot(c,c),M=A.o.Dot(U,t),o=A.o.Dot(c,t),W=Z*V-m*m;let g,J,n=W,R=W;W<u._Smallnum?(g=0,n=1,J=o,R=V):(g=m*o-V*M,J=Z*o-m*M,g<0?(g=0,J=o,R=V):g>n&&(g=n,J=o+m,R=V)),J<0?(J=0,-M<0?g=0:-M>Z?g=n:(g=-M,n=Z)):J>R&&(J=R,-M+m<0?g=0:-M+m>Z?g=n:(g=-M+m,n=Z));const H=Math.abs(g)<u._Smallnum?0:g/n,z=Math.abs(J)<u._Smallnum?0:J/R,r=A.j.Qi[4];c.scaleToRef(z,r);const E=A.j.Qi[5];U.scaleToRef(H,E),E.addInPlace(t);const y=A.j.Qi[6];E.subtractToRef(r,y);return z>0&&z<=this.length&&y.lengthSquared()<l*l?E.length():-1}update(K,Y,l,v,U,d,c){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){u._RayDistant||(u._RayDistant=u.Zero()),u._RayDistant.unprojectRayToRef(K,Y,l,v,A.d.IdentityReadOnly,d,c);const t=A.j.Matrix[0];U.invertToRef(t),u.TransformToRef(u._RayDistant,t,this)}else this.unprojectRayToRef(K,Y,l,v,U,d,c);return this}static Zero(){return new u(A.o.Zero(),A.o.Zero())}static CreateNew(K,Y,l,v,U,d,A){return u.Zero().update(K,Y,l,v,U,d,A)}static CreateNewFromTo(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.d.IdentityReadOnly;const v=new u(new A.o(0,0,0),new A.o(0,0,0));return u.CreateFromToToRef(K,Y,v,l)}static CreateFromToToRef(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.d.IdentityReadOnly;l.origin.p(K);const U=Y.subtractToRef(K,l.direction),d=Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z);return l.length=d,l.direction.normalize(),u.TransformToRef(l,v,l)}static Transform(K,Y){const l=new u(new A.o(0,0,0),new A.o(0,0,0));return u.TransformToRef(K,Y,l),l}static TransformToRef(K,Y,l){A.o.TransformCoordinatesToRef(K.origin,Y,l.origin),A.o.TransformNormalToRef(K.direction,Y,l.direction),l.length=K.length,l.epsilon=K.epsilon;const v=l.direction,U=v.length();if(0!==U&&1!==U){const K=1/U;v.x*=K,v.y*=K,v.z*=K,l.length*=U}return l}unprojectRayToRef(K,Y,l,v,U,d,c){const t=A.j.Matrix[0];U.multiplyToRef(d,t),t.multiplyToRef(c,t),t.invert();const Z=m.e.LastCreatedEngine,V=A.j.Qi[0];V.x=K/l*2-1,V.y=-(Y/v*2-1),V.z=null!==Z&&void 0!==Z&&Z.useReverseDepthBuffer?1:null!==Z&&void 0!==Z&&Z.isNDCHalfZRange?0:-1;const M=A.j.Qi[1].mi(V.x,V.y,1-1e-8),u=A.j.Qi[2],o=A.j.Qi[3];A.o._UnprojectFromInvertedMatrixToRef(V,t,u),A.o._UnprojectFromInvertedMatrixToRef(M,t,o),this.origin.p(u),o.subtractToRef(u,this.direction),this.direction.normalize()}}function o(K,Y,l,v,U){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=u.Zero();return W(K,Y,l,v,A,U,d),A}function W(K,Y,l,v,U,d){let c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Z=K.getEngine();if(!d&&!(d=K.activeCamera))return K;const m=d.viewport,V=Z.getRenderHeight(),{x:M,y:u,width:o,height:W}=m.toGlobal(Z.getRenderWidth(),V),g=1/Z.getHardwareScalingLevel();return Y=Y*g-M,l=l*g-(V-u-W),U.update(Y,l,o,W,v||A.d.IdentityReadOnly,c?A.d.IdentityReadOnly:d.getViewMatrix(),d.getProjectionMatrix(),t),K}function g(K,Y,l,v,U){if(!Z.c)return K;const d=K.getEngine();if(!U&&!(U=K.activeCamera))throw new Error("Active camera not set");const c=U.viewport,t=d.getRenderHeight(),{x:m,y:V,width:M,height:u}=c.toGlobal(d.getRenderWidth(),t),o=A.d.Identity(),W=1/d.getHardwareScalingLevel();return Y=Y*W-m,l=l*W-(t-V-u),v.update(Y,l,M,u,o,o,U.getProjectionMatrix()),K}function J(K,Y,l,v,U,d,A,c){const t=Y(v,l.enableDistantPicking),Z=l.intersects(t,U,A,d,v,c);return Z&&Z.hit?!U&&null!=K&&Z.distance>=K.distance?null:Z:null}function n(K,Y,l,v,U,d){let c=null;const t=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),m=K.cameraToUseForPointers||K.activeCamera,V=M.internalPickerForMesh||J;for(let Z=0;Z<K.meshes.length;Z++){const M=K.meshes[Z];if(l){if(!l(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.Zh)continue;const u=t&&M.isWorldMatrixCameraDependent(),o=M.ri(u,m);if(M.hasThinInstances&&M.thinInstanceEnablePicking){const K=V(c,Y,M,o,!0,!0,d);if(K){if(U)return K;const t=A.j.Matrix[1],Z=M.thinInstanceGetWorldMatrices();for(let K=0;K<Z.length;K++){if(l&&!l(M,K))continue;Z[K].multiplyToRef(o,t);const A=V(c,Y,M,t,v,U,d,!0);if(A&&(c=A,c.thinInstanceIndex=K,v))return c}}}else{const K=V(c,Y,M,o,v,U,d);if(K&&(c=K,v))return c}}return c||new Z.c}function R(K,Y,l,v){if(!Z.c)return null;const U=[],d=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),c=K.cameraToUseForPointers||K.activeCamera,t=M.internalPickerForMesh||J;for(let Z=0;Z<K.meshes.length;Z++){const m=K.meshes[Z];if(l){if(!l(m,-1))continue}else if(!m.isEnabled()||!m.isVisible||!m.Zh)continue;const V=d&&m.isWorldMatrixCameraDependent(),M=m.ri(V,c);if(m.hasThinInstances&&m.thinInstanceEnablePicking){if(t(null,Y,m,M,!0,!0,v)){const K=A.j.Matrix[1],d=m.thinInstanceGetWorldMatrices();for(let A=0;A<d.length;A++){if(l&&!l(m,A))continue;d[A].multiplyToRef(M,K);const c=t(null,Y,m,K,!1,!1,v,!0);c&&(c.thinInstanceIndex=A,U.push(c))}}}else{const K=t(null,Y,m,M,!1,!1,v);K&&U.push(K)}}return U}function H(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,v=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;v||(v=K.getWorldMatrix()),Y.length=l,U?Y.origin.p(U):Y.origin.p(K.position);const d=A.j.Qi[2];d.set(0,0,K._scene.useRightHandedSystem?-1:1);const c=A.j.Qi[3];return A.o.TransformNormalToRef(d,v,c),A.o.NormalizeToRef(c,Y.direction),Y}var z,r;u._TmpVector3=(0,c.d)(6,A.o.Zero),u._RayDistant=u.Zero(),u._Smallnum=1e-8,u._Rayl=1e9,z=v.b,(r=U.c)&&(r.prototype.getForwardRay=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Y=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return H(this,new u(A.o.Zero(),A.o.Zero(),K),K,Y,l)},r.prototype.getForwardRayToRef=function(K){return H(this,K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),z&&(V.e._IsPickingAvailable=!0,z.prototype.createPickingRay=function(K,Y,l,v){return o(this,K,Y,l,v,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),v.b.prototype.createPickingRayToRef=function(K,Y,l,v,U){return W(this,K,Y,l,v,U,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},v.b.prototype.createPickingRayInCameraSpace=function(K,Y,l){return function(K,Y,l,v){const U=u.Zero();return g(K,Y,l,U,v),U}(this,K,Y,l)},v.b.prototype.createPickingRayInCameraSpaceToRef=function(K,Y,l,v){return g(this,K,Y,l,v)},v.b.prototype.pickWithBoundingInfo=function(K,Y,l,v,U){return function(K,Y,l,v,U,d){if(!Z.c)return null;const c=n(K,(v=>(K._tempPickingRay||(K._tempPickingRay=u.Zero()),W(K,Y,l,v,K._tempPickingRay,d||null),K._tempPickingRay)),v,U,!0);return c&&(c.ray=o(K,Y,l,A.d.Identity(),d||null)),c}(this,K,Y,l,v,U)},v.b.prototype.Ik=function(K,Y,l,v,U,d){return function(K,Y,l,v,U,d,c){const t=n(K,((v,U)=>(K._tempPickingRay||(K._tempPickingRay=u.Zero()),W(K,Y,l,v,K._tempPickingRay,d||null,!1,U),K._tempPickingRay)),v,U,!1,c);return t&&(t.ray=o(K,Y,l,A.d.Identity(),d||null)),t}(this,K,Y,l,v,U,d)},v.b.prototype.pickWithRay=function(K,Y,l,v){return function(K,Y,l,v,U){const d=n(K,(l=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=A.d.Identity()),l.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=u.Zero()),u.TransformToRef(Y,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),l,v,!1,U);return d&&(d.ray=Y),d}(this,K,Y,l,v)},v.b.prototype.multiPick=function(K,Y,l,v,U){return function(K,Y,l,v,U,d){return R(K,(v=>o(K,Y,l,v,U||null)),v,d)}(this,K,Y,l,v,U)},v.b.prototype.multiPickWithRay=function(K,Y,l){return function(K,Y,l,v){return R(K,(l=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=A.d.Identity()),l.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=u.Zero()),u.TransformToRef(Y,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),l,v)}(this,K,Y,l)}},12055:(K,Y,l)=>{"use strict";l(567).b.prototype.createDepthStencilTexture=function(K,Y,l){if(Y.isCube){const l=K.width||K;return this._createDepthStencilCubeTexture(l,Y)}return this._createDepthStencilTexture(K,Y,l)}},12027:(K,Y,l)=>{"use strict";l(12001).ThinEngine.prototype.setAlphaMode=function(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==K){switch(K){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}Y||(this.depthCullingState.depthMask=0===K),this._alphaMode=K}else if(!Y){const Y=0===K;this.depthCullingState.depthMask!==Y&&(this.depthCullingState.depthMask=Y)}}},11993:(K,Y,l)=>{"use strict";var v=l(12001);v.ThinEngine.prototype.updateDynamicIndexBuffer=function(K,Y){let l;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(K),l=K.is32Bits?Y instanceof Uint32Array?Y:new Uint32Array(Y):Y instanceof Uint16Array?Y:new Uint16Array(Y),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,l,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},v.ThinEngine.prototype.updateDynamicVertexBuffer=function(K,Y,l,v){this.bindArrayBuffer(K),void 0===l&&(l=0);const U=Y.byteLength||Y.length;void 0===v||v>=U&&0===l?Y instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,l,new Float32Array(Y)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,l,Y):Y instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(Y).subarray(l,l+v)):(Y=Y instanceof ArrayBuffer?new Uint8Array(Y,l,v):new Uint8Array(Y.buffer,Y.byteOffset+l,v),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Y)),this._resetVertexBufferBinding()}},12040:(K,Y,l)=>{"use strict";var v=l(594),U=l(492),d=l(12001),A=l(12049);class c extends A.d{constructor(K,Y,l,v,U){super(K,Y,l,v),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=U}_cloneRenderTargetWrapper(){let K=null;return this._colorTextureArray&&this._depthStencilTextureArray?(K=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),K.texture.isReady=!0):K=super._cloneRenderTargetWrapper(),K}_swapRenderTargetWrapper(K){super._swapRenderTargetWrapper(K),K._framebuffer=this._framebuffer,K._depthStencilBuffer=this._depthStencilBuffer,K._MSAAFramebuffer=this._MSAAFramebuffer,K._colorTextureArray=this._colorTextureArray,K._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,d=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const K=this._engine,Y=K._currentFramebuffer,l=this._context;K._bindUnboundFramebuffer(this._framebuffer),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,null),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,null),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.STENCIL_ATTACHMENT,l.RENDERBUFFER,null),K._bindUnboundFramebuffer(Y),l.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(K,Y,l,v,U,d)}shareDepth(K){super.shareDepth(K);const Y=this._context,l=this._depthStencilBuffer,v=K._MSAAFramebuffer||K._framebuffer,U=this._engine;K._depthStencilBuffer&&K._depthStencilBuffer!==l&&Y.deleteRenderbuffer(K._depthStencilBuffer),K._depthStencilBuffer=l;const d=K._generateStencilBuffer?Y.DEPTH_STENCIL_ATTACHMENT:Y.DEPTH_ATTACHMENT;U._bindUnboundFramebuffer(v),Y.framebufferRenderbuffer(Y.FRAMEBUFFER,d,Y.RENDERBUFFER,l),U._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!K._hardwareTexture)return;const U=this._framebuffer,d=this._engine,A=d._currentFramebuffer;if(d._bindUnboundFramebuffer(U),d.webGLVersion>1){const U=this._context,d=U["COLOR_ATTACHMENT"+Y];var c;if(K.is2DArray||K.is3D)l=l??(null===(c=this.layerIndices)||void 0===c?void 0:c[Y])??0,U.framebufferTextureLayer(U.FRAMEBUFFER,d,K._hardwareTexture.underlyingResource,v,l);else if(K.isCube){var t;l=l??(null===(t=this.faceIndices)||void 0===t?void 0:t[Y])??0,U.framebufferTexture2D(U.FRAMEBUFFER,d,U.TEXTURE_CUBE_MAP_POSITIVE_X+l,K._hardwareTexture.underlyingResource,v)}else U.framebufferTexture2D(U.FRAMEBUFFER,d,U.TEXTURE_2D,K._hardwareTexture.underlyingResource,v)}else{const U=this._context,d=U["COLOR_ATTACHMENT"+Y+"_WEBGL"],A=void 0!==l?U.TEXTURE_CUBE_MAP_POSITIVE_X+l:U.TEXTURE_2D;U.framebufferTexture2D(U.FRAMEBUFFER,d,A,K._hardwareTexture.underlyingResource,v)}d._bindUnboundFramebuffer(A)}setTexture(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(K,Y,l),this._bindTextureRenderTarget(K,Y)}setLayerAndFaceIndices(K,Y){var l;if(super.setLayerAndFaceIndices(K,Y),!this.textures||!this.layerIndices||!this.faceIndices)return;const v=(null===(l=this._attachments)||void 0===l?void 0:l.length)??this.textures.length;for(let U=0;U<v;U++){const K=this.textures[U];K&&(K.is2DArray||K.is3D?this._bindTextureRenderTarget(K,U,this.layerIndices[U]):K.isCube?this._bindTextureRenderTarget(K,U,this.faceIndices[U]):this._bindTextureRenderTarget(K,U))}}setLayerAndFaceIndex(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(K,Y,l),!this.textures||!this.layerIndices||!this.faceIndices)return;const v=this.textures[K];v.is2DArray||v.is3D?this._bindTextureRenderTarget(this.textures[K],K,this.layerIndices[K]):v.isCube&&this._bindTextureRenderTarget(this.textures[K],K,this.faceIndices[K])}dispose(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const Y=this._context;K||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(Y.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(Y.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(Y.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(K)}}l(12055);d.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(K,Y,l){const v=new c(K,Y,l,this,this._gl);return this._renderTargetWrapperCache.push(v),v},d.ThinEngine.prototype.createRenderTargetTexture=function(K,Y){const l=this._createHardwareRenderTargetWrapper(!1,!1,K);let v,U,d=!0,A=!1,c=!1,t=1;void 0!==Y&&"object"===typeof Y&&(d=Y.generateDepthBuffer??!0,A=!!Y.generateStencilBuffer,c=!!Y.noColorAttachment,v=Y.colorAttachment,t=Y.samples??1,U=Y.label);const Z=v||(c?null:this._createInternalTexture(K,Y,!0,5)),m=K.width||K,V=K.height||K,M=this._currentFramebuffer,u=this._gl,o=u.createFramebuffer();if(this._bindUnboundFramebuffer(o),l._depthStencilBuffer=this._setupFramebufferDepthAttachments(A,d,m,V),!Z||Z.is2DArray||Z.is3D||u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,Z._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(M),l.label=U??"RenderTargetWrapper",l._framebuffer=o,l._generateDepthBuffer=d,l._generateStencilBuffer=A,l.setTextures(Z),v){if(l._samples=v.samples,v.samples>1){const K=v._hardwareTexture.getMSAARenderBuffer(0);l._MSAAFramebuffer=u.createFramebuffer(),this._bindUnboundFramebuffer(l._MSAAFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,K),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(l,t);return l},d.ThinEngine.prototype._createDepthStencilTexture=function(K,Y,l){const d=this._gl,A=K.layers||0,c=K.depth||0;let t=d.TEXTURE_2D;0!==A?t=d.TEXTURE_2D_ARRAY:0!==c&&(t=d.TEXTURE_3D);const Z=new v.e(this,12);if(Z.label=Y.label,!this._caps.depthTextureExtension)return U.e.Error("Depth texture is not supported by your browser or hardware."),Z;const m={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...Y};if(this._bindTextureDirectly(t,Z,!0),this._setupDepthStencilTexture(Z,K,0!==m.comparisonFunction&&m.bilinearFiltering,m.comparisonFunction,m.samples),void 0!==m.depthTextureFormat){if(15!==m.depthTextureFormat&&16!==m.depthTextureFormat&&17!==m.depthTextureFormat&&13!==m.depthTextureFormat&&14!==m.depthTextureFormat&&18!==m.depthTextureFormat)return U.e.Error(`Depth texture ${m.depthTextureFormat} format is not supported.`),Z;Z.format=m.depthTextureFormat}else Z.format=m.generateStencil?13:16;const V=17===Z.format||13===Z.format||18===Z.format;let M=d.UNSIGNED_INT;15===Z.format?M=d.UNSIGNED_SHORT:17===Z.format||13===Z.format?M=d.UNSIGNED_INT_24_8:14===Z.format?M=d.FLOAT:18===Z.format&&(M=d.FLOAT_32_UNSIGNED_INT_24_8_REV);const u=V?d.DEPTH_STENCIL:d.DEPTH_COMPONENT,o=this._getInternalFormatFromDepthTextureFormat(Z.format,!0,V);return Z.is2DArray?d.texImage3D(t,0,o,Z.width,Z.height,A,0,u,M,null):Z.is3D?d.texImage3D(t,0,o,Z.width,Z.height,c,0,u,M,null):d.texImage2D(t,0,o,Z.width,Z.height,0,u,M,null),this._bindTextureDirectly(t,null),this._internalTexturesCache.push(Z),l._depthStencilBuffer&&(d.deleteRenderbuffer(l._depthStencilBuffer),l._depthStencilBuffer=null),this._bindUnboundFramebuffer(l._MSAAFramebuffer??l._framebuffer),l._generateStencilBuffer=V,l._depthStencilTextureWithStencil=V,l._depthStencilBuffer=this._setupFramebufferDepthAttachments(l._generateStencilBuffer,l._generateDepthBuffer,l.width,l.height,l.samples,Z.format),this._bindUnboundFramebuffer(null),Z},d.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(K,Y){var l;if(this.webGLVersion<2||!K)return 1;if(K.samples===Y)return Y;const v=this._gl;Y=Math.min(Y,this.getCaps().maxMSAASamples),K._depthStencilBuffer&&(v.deleteRenderbuffer(K._depthStencilBuffer),K._depthStencilBuffer=null),K._MSAAFramebuffer&&(v.deleteFramebuffer(K._MSAAFramebuffer),K._MSAAFramebuffer=null);const U=null===(l=K.texture)||void 0===l?void 0:l._hardwareTexture;if(null===U||void 0===U||U.releaseMSAARenderBuffers(),K.texture&&Y>1&&"function"===typeof v.renderbufferStorageMultisample){const l=v.createFramebuffer();if(!l)throw new Error("Unable to create multi sampled framebuffer");K._MSAAFramebuffer=l,this._bindUnboundFramebuffer(K._MSAAFramebuffer);const d=this._createRenderBuffer(K.texture.width,K.texture.height,Y,-1,this._getRGBABufferInternalSizedFormat(K.texture.type,K.texture.format,K.texture._useSRGBBuffer),v.COLOR_ATTACHMENT0,!1);if(!d)throw new Error("Unable to create multi sampled framebuffer");null===U||void 0===U||U.addMSAARenderBuffer(d)}this._bindUnboundFramebuffer(K._MSAAFramebuffer??K._framebuffer),K.texture&&(K.texture.samples=Y),K._samples=Y;const d=K._depthStencilTexture?K._depthStencilTexture.format:void 0;return K._depthStencilBuffer=this._setupFramebufferDepthAttachments(K._generateStencilBuffer,K._generateDepthBuffer,K.width,K.height,Y,d),this._bindUnboundFramebuffer(null),Y},d.ThinEngine.prototype._setupDepthStencilTexture=function(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const d=Y.width??Y,A=Y.height??Y,c=Y.layers||0,t=Y.depth||0;K.baseWidth=d,K.baseHeight=A,K.width=d,K.height=A,K.is2DArray=c>0,K.depth=c||t,K.isReady=!0,K.samples=U,K.generateMipMaps=!1,K.samplingMode=l?2:1,K.type=0,K._comparisonFunction=v;const Z=this._gl,m=this._getTextureTarget(K),V=this._getSamplingParameters(K.samplingMode,!1);Z.texParameteri(m,Z.TEXTURE_MAG_FILTER,V.mag),Z.texParameteri(m,Z.TEXTURE_MIN_FILTER,V.min),Z.texParameteri(m,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(m,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===v?(Z.texParameteri(m,Z.TEXTURE_COMPARE_FUNC,515),Z.texParameteri(m,Z.TEXTURE_COMPARE_MODE,Z.NONE)):(Z.texParameteri(m,Z.TEXTURE_COMPARE_FUNC,v),Z.texParameteri(m,Z.TEXTURE_COMPARE_MODE,Z.COMPARE_REF_TO_TEXTURE)))}},12033:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>y});var v=l(594),U=l(526),d=l(12001),A=l(508);class c{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new t(K)}sampleFrame(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const Y=K-this._lastFrameTimeMs;this._rollingFrameTime.add(Y)}this._lastFrameTimeMs=K}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const K=this._rollingFrameTime.history(0);return 0===K?0:1e3/K}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class t{constructor(K){this._samples=new Array(K),this.reset()}add(K){let Y;if(this.isSaturated()){const K=this._samples[this._pos];Y=K-this.average,this.average-=Y/(this._sampleCount-1),this._m2-=Y*(K-this.average)}else this._sampleCount++;Y=K-this.average,this.average+=Y/this._sampleCount,this._m2+=Y*(K-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=K,this._pos++,this._pos%=this._samples.length}history(K){if(K>=this._sampleCount||K>=this._samples.length)return 0;const Y=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(Y-K)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(K){const Y=this._samples.length;return(K%Y+Y)%Y}}var Z=l(12010),m=l(492),V=l(12012),M=(l(12027),l(627));function u(K,Y,l,v){let U,d=1;1===v?U=new Float32Array(Y*l*4):2===v?(U=new Uint16Array(Y*l*4),d=15360):U=7===v?new Uint32Array(Y*l*4):new Uint8Array(Y*l*4);for(let A=0;A<Y;A++)for(let v=0;v<l;v++){const l=3*(v*Y+A),c=4*(v*Y+A);U[c+0]=K[l+0],U[c+1]=K[l+1],U[c+2]=K[l+2],U[c+3]=d}return U}function o(K){return function(Y,l,U,d,A,c,t,Z){let m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const M=K?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,u=K?10:11,o=new v.e(this,u);o.baseWidth=l,o.baseHeight=U,o.baseDepth=d,o.width=l,o.height=U,o.depth=d,o.format=A,o.type=V,o.generateMipMaps=c,o.samplingMode=Z,K?o.is3D=!0:o.is2DArray=!0,this._doNotHandleContextLost||(o._bufferView=Y),K?this.updateRawTexture3D(o,Y,A,t,m,V):this.updateRawTexture2DArray(o,Y,A,t,m,V),this._bindTextureDirectly(M,o,!0);const W=this._getSamplingParameters(Z,c);return this._gl.texParameteri(M,this._gl.TEXTURE_MAG_FILTER,W.mag),this._gl.texParameteri(M,this._gl.TEXTURE_MIN_FILTER,W.min),c&&this._gl.generateMipmap(M),this._bindTextureDirectly(M,null),this._internalTexturesCache.push(o),o}}function W(K){return function(Y,l,v,U){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const c=K?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,t=this._getWebGLTextureType(A),Z=this._getInternalFormat(v),m=this._getRGBABufferInternalSizedFormat(A,v);this._bindTextureDirectly(c,Y,!0),this._unpackFlipY(void 0===U||!!U),this._doNotHandleContextLost||(Y._bufferView=l,Y.format=v,Y.invertY=U,Y._compression=d),Y.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&l?this._gl.compressedTexImage3D(c,0,this.getCaps().s3tc[d],Y.width,Y.height,Y.depth,0,l):this._gl.texImage3D(c,0,m,Y.width,Y.height,Y.depth,0,Z,t,l),Y.generateMipMaps&&this._gl.generateMipmap(c),this._bindTextureDirectly(c,null),Y.isReady=!0}}d.ThinEngine.prototype.updateRawTexture=function(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!K)return;const c=this._getRGBABufferInternalSizedFormat(d,l,A),t=this._getInternalFormat(l),Z=this._getWebGLTextureType(d);this._bindTextureDirectly(this._gl.TEXTURE_2D,K,!0),this._unpackFlipY(void 0===v||!!v),this._doNotHandleContextLost||(K._bufferView=Y,K.format=l,K.type=d,K.invertY=v,K._compression=U),K.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),U&&Y?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[U],K.width,K.height,0,Y):this._gl.texImage2D(this._gl.TEXTURE_2D,0,c,K.width,K.height,0,t,Z,Y),K.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),K.isReady=!0},d.ThinEngine.prototype.createRawTexture=function(K,Y,l,U,d,A,c){let t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const V=new v.e(this,3);V.baseWidth=Y,V.baseHeight=l,V.width=Y,V.height=l,V.format=U,V.generateMipMaps=d,V.samplingMode=c,V.invertY=A,V._compression=t,V.type=Z,V._useSRGBBuffer=this._getUseSRGBBuffer(m,!d),this._doNotHandleContextLost||(V._bufferView=K),this.updateRawTexture(V,K,U,A,t,Z,V._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0);const M=this._getSamplingParameters(c,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,M.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,M.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(V),V},d.ThinEngine.prototype.createRawCubeTexture=function(K,Y,l,U,d,A,c){let t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const Z=this._gl,V=new v.e(this,8);V.isCube=!0,V.format=l,V.type=U,this._doNotHandleContextLost||(V._bufferViewArray=K);const u=this._getWebGLTextureType(U);let o=this._getInternalFormat(l);o===Z.RGB&&(o=Z.RGBA),u!==Z.FLOAT||this._caps.textureFloatLinearFiltering?u!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?u!==Z.FLOAT||this._caps.textureFloatRender?u!==Z.HALF_FLOAT||this._caps.colorBufferFloat||(d=!1,m.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(d=!1,m.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(d=!1,c=1,m.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(d=!1,c=1,m.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const W=Y,g=W;V.width=W,V.height=g,V.invertY=A,V._compression=t;if(!this.needPOTTextures||(0,M.h)(V.width)&&(0,M.h)(V.height)||(d=!1),K)this.updateRawCubeTexture(V,K,l,U,A,t);else{const K=this._getRGBABufferInternalSizedFormat(U),Y=0;this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,V,!0);for(let l=0;l<6;l++)t?Z.compressedTexImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+l,Y,this.getCaps().s3tc[t],V.width,V.height,0,void 0):Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+l,Y,K,V.width,V.height,0,o,u,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,V,!0),K&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const J=this._getSamplingParameters(c,d);return Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,J.mag),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,J.min),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),this._bindTextureDirectly(Z.TEXTURE_CUBE_MAP,null),V.generateMipMaps=d,V.samplingMode=c,V.isReady=!0,V},d.ThinEngine.prototype.updateRawCubeTexture=function(K,Y,l,v,U){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;K._bufferViewArray=Y,K.format=l,K.type=v,K.invertY=U,K._compression=d;const c=this._gl,t=this._getWebGLTextureType(v);let Z=this._getInternalFormat(l);const m=this._getRGBABufferInternalSizedFormat(v);let V=!1;Z===c.RGB&&(Z=c.RGBA,V=!0),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,K,!0),this._unpackFlipY(void 0===U||!!U),K.width%4!==0&&c.pixelStorei(c.UNPACK_ALIGNMENT,1);for(let M=0;M<6;M++){let l=Y[M];d?c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+M,A,this.getCaps().s3tc[d],K.width,K.height,0,l):(V&&(l=u(l,K.width,K.height,v)),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+M,A,m,K.width,K.height,0,Z,t,l))}(!this.needPOTTextures||(0,M.h)(K.width)&&(0,M.h)(K.height))&&K.generateMipMaps&&0===A&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),K.isReady=!0},d.ThinEngine.prototype.createRawCubeTextureFromUrl=function(K,Y,l,v,U,d,A,c){let t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,V=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const M=this._gl,o=this.createRawCubeTexture(null,l,v,U,!d,V,m,null);null===Y||void 0===Y||Y.addPendingData(o),o.url=K,o.isReady=!1,this._internalTexturesCache.push(o);const W=K=>{const l=o.width,d=A(K);if(d){if(c){const K=this._getWebGLTextureType(U);let Y=this._getInternalFormat(v);const A=this._getRGBABufferInternalSizedFormat(U);let t=!1;Y===M.RGB&&(Y=M.RGBA,t=!0),this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,o,!0),this._unpackFlipY(!1);const Z=c(d);for(let v=0;v<Z.length;v++){const d=l>>v;for(let l=0;l<6;l++){let c=Z[v][l];t&&(c=u(c,d,d,U)),M.texImage2D(l,v,A,d,d,0,Y,K,c)}}this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(o,d,v,U,V);o.isReady=!0,null===Y||void 0===Y||Y.removePendingData(o),o.onLoadedObservable.notifyObservers(o),o.onLoadedObservable.clear(),t&&t()}};return this._loadFile(K,(K=>{W(K)}),void 0,null===Y||void 0===Y?void 0:Y.offlineProvider,!0,((K,l)=>{null===Y||void 0===Y||Y.removePendingData(o),Z&&K&&Z(K.status+" "+K.statusText,l)})),o},d.ThinEngine.prototype.createRawTexture2DArray=o(!1),d.ThinEngine.prototype.createRawTexture3D=o(!0),d.ThinEngine.prototype.updateRawTexture2DArray=W(!1),d.ThinEngine.prototype.updateRawTexture3D=W(!0);var g=l(558);d.ThinEngine.prototype._readTexturePixelsSync=function(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const m=this._gl;if(!m)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const K=m.createFramebuffer();if(!K)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=K}var V,M;(m.bindFramebuffer(m.FRAMEBUFFER,this._dummyFramebuffer),v>-1)?m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(V=K._hardwareTexture)||void 0===V?void 0:V.underlyingResource,U):m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,null===(M=K._hardwareTexture)||void 0===M?void 0:M.underlyingResource,U);let u=void 0!==K.type?this._getWebGLTextureType(K.type):m.UNSIGNED_BYTE;if(c)d||(d=(0,g.q)(K.type,4*Y*l));else if(u===m.UNSIGNED_BYTE)d||(d=new Uint8Array(4*Y*l)),u=m.UNSIGNED_BYTE;else d||(d=new Float32Array(4*Y*l)),u=m.FLOAT;return A&&this.flushFramebuffer(),m.readPixels(t,Z,Y,l,m.RGBA,u,d),m.bindFramebuffer(m.FRAMEBUFFER,this._currentFramebuffer),d},d.ThinEngine.prototype._readTexturePixels=function(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(K,Y,l,v,U,d,A,c,t,Z))};l(11993);d.ThinEngine.prototype._createDepthStencilCubeTexture=function(K,Y){const l=new v.e(this,12);if(l.isCube=!0,1===this.webGLVersion)return m.e.Error("Depth cube texture is not supported by WebGL 1."),l;const U={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...Y},d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,l,!0),this._setupDepthStencilTexture(l,K,U.bilinearFiltering,U.comparisonFunction);for(let v=0;v<6;v++)U.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,d.DEPTH24_STENCIL8,K,K,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,d.DEPTH_COMPONENT24,K,K,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(l),l},d.ThinEngine.prototype._setCubeMapTextureParams=function(K,Y,l){const v=this._gl;v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,Y?v.LINEAR_MIPMAP_LINEAR:v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),K.samplingMode=Y?3:2,Y&&this.getCaps().textureMaxLevel&&void 0!==l&&l>0&&(v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAX_LEVEL,l),K._maxLodLevel=l),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null)},d.ThinEngine.prototype.createCubeTexture=function(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,o=arguments.length>13&&void 0!==arguments[13]&&arguments[13],W=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const g=this._gl;return this.createCubeTextureBase(K,Y,l,!!v,U,d,A,c,t,Z,V,u,(K=>this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,K,!0)),((K,Y)=>{const l=this.needPOTTextures?(0,M.e)(Y[0].width,this._caps.maxCubemapTextureSize):Y[0].width,d=l,c=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(g.TEXTURE_CUBE_MAP,K,!0),this._unpackFlipY(!1);const t=A?this._getInternalFormat(A,K._useSRGBBuffer):K._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:g.RGBA;let Z=A?this._getInternalFormat(A):g.RGBA;K._useSRGBBuffer&&1===this.webGLVersion&&(Z=t);for(let v=0;v<c.length;v++)if(Y[v].width!==l||Y[v].height!==d){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void m.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=l,this._workingCanvas.height=d,this._workingContext.drawImage(Y[v],0,0,Y[v].width,Y[v].height,0,0,l,d),g.texImage2D(c[v],0,t,Z,g.UNSIGNED_BYTE,this._workingCanvas)}else g.texImage2D(c[v],0,t,Z,g.UNSIGNED_BYTE,Y[v]);v||g.generateMipmap(g.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(K,!v),K.width=l,K.height=d,K.isReady=!0,A&&(K.format=A),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),U&&U()}),!!o,W)},d.ThinEngine.prototype.generateMipMapsForCubemap=function(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K.generateMipMaps){const l=this._gl;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,K,!0),l.generateMipmap(l.TEXTURE_CUBE_MAP),Y&&this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null)}};l(12040);d.ThinEngine.prototype.setDepthStencilTexture=function(K,Y,l,v){void 0!==K&&(Y&&(this._boundUniforms[K]=Y),l&&l.depthStencilTexture?this._setTexture(K,l,!1,!0,v):this._setTexture(K,null,void 0,void 0,v))},d.ThinEngine.prototype.createRenderTargetCubeTexture=function(K,Y){const l=this._createHardwareRenderTargetWrapper(!1,!0,K),U={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...Y};U.generateStencilBuffer=U.generateDepthBuffer&&U.generateStencilBuffer,(1!==U.type||this._caps.textureFloatLinearFiltering)&&(2!==U.type||this._caps.textureHalfFloatLinearFiltering)||(U.samplingMode=1);const d=this._gl,A=new v.e(this,5);this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,A,!0);const c=this._getSamplingParameters(U.samplingMode,U.generateMipMaps);1!==U.type||this._caps.textureFloat||(U.type=0,m.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,c.mag),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,c.min),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);for(let v=0;v<6;v++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,this._getRGBABufferInternalSizedFormat(U.type,U.format),K,K,0,this._getInternalFormat(U.format),this._getWebGLTextureType(U.type),null);const t=d.createFramebuffer();return this._bindUnboundFramebuffer(t),l._depthStencilBuffer=this._setupFramebufferDepthAttachments(U.generateStencilBuffer,U.generateDepthBuffer,K,K),U.generateMipMaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),l._framebuffer=t,l._generateDepthBuffer=U.generateDepthBuffer,l._generateStencilBuffer=U.generateStencilBuffer,A.width=K,A.height=K,A.isReady=!0,A.isCube=!0,A.samples=1,A.generateMipMaps=U.generateMipMaps,A.samplingMode=U.samplingMode,A.type=U.type,A.format=U.format,this._internalTexturesCache.push(A),l.setTextures(A),l};var J=l(2259),n=l(2305),R=l(2277);d.ThinEngine.prototype.createPrefilteredCubeTexture=function(K,Y,l,U){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6?arguments[6]:void 0,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(K,Y,null,!1,(K=>{if(!K)return void(d&&d(null));const A=K.texture;if(Z?K.info.sphericalPolynomial&&(A._sphericalPolynomial=K.info.sphericalPolynomial):A._sphericalPolynomial=new J.f,A._source=9,this.getCaps().textureLOD)return void(d&&d(A));const c=this._gl,t=K.width;if(!t)return;const V=[];for(let d=0;d<3;d++){const Z=1-d/2,M=U,u=Math.log2(t)*l+U,o=M+(u-M)*Z,W=Math.round(Math.min(Math.max(o,0),u)),g=new v.e(this,2);if(g.type=A.type,g.format=A.format,g.width=Math.pow(2,Math.max(Math.log2(t)-W,0)),g.height=g.width,g.isCube=!0,g._cachedWrapU=0,g._cachedWrapV=0,this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,g,!0),g.samplingMode=2,c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),K.isDDS){const Y=K.info,l=K.data;this._unpackFlipY(Y.isCompressed),R.c.UploadDDSLevels(this,g,l,Y,!0,6,W)}else m.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null);const J=new n.e(Y);J._isCube=!0,J._texture=g,g.isReady=!0,V.push(J)}A._lodTextureHigh=V[2],A._lodTextureMid=V[1],A._lodTextureLow=V[0],d&&d(A)}),A,c,t,Z,l,U)},d.ThinEngine.prototype.createUniformBuffer=function(K,Y){const l=this._gl.createBuffer();if(!l)throw new Error("Unable to create uniform buffer");const v=new Z.b(l);return this.bindUniformBuffer(v),K instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,K,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(K),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),v.references=1,v},d.ThinEngine.prototype.createDynamicUniformBuffer=function(K,Y){const l=this._gl.createBuffer();if(!l)throw new Error("Unable to create dynamic uniform buffer");const v=new Z.b(l);return this.bindUniformBuffer(v),K instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,K,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(K),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),v.references=1,v},d.ThinEngine.prototype.updateUniformBuffer=function(K,Y,l,v){this.bindUniformBuffer(K),void 0===l&&(l=0),void 0===v?Y instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,l,Y):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,l,new Float32Array(Y)):Y instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,Y.subarray(l,l+v)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(Y).subarray(l,l+v)),this.bindUniformBuffer(null)},d.ThinEngine.prototype.bindUniformBuffer=function(K){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,K?K.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBufferBase=function(K,Y,l){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,Y,K?K.underlyingResource:null)},d.ThinEngine.prototype.bindUniformBlock=function(K,Y,l){const v=K.program,U=this._gl.getUniformBlockIndex(v,Y);4294967295!==U&&this._gl.uniformBlockBinding(v,U,l)};var H=l(484),z=l(567);z.b.prototype.displayLoadingUI=function(){if(!(0,H.k)())return;const K=this.loadingScreen;K&&K.displayLoadingUI()},z.b.prototype.hideLoadingUI=function(){if(!(0,H.k)())return;const K=this._loadingScreen;K&&K.hideLoadingUI()},Object.defineProperty(z.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=z.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(K){this._loadingScreen=K},enumerable:!0,configurable:!0}),Object.defineProperty(z.b.prototype,"loadingUIText",{set:function(K){this.loadingScreen.loadingUIText=K},enumerable:!0,configurable:!0}),Object.defineProperty(z.b.prototype,"loadingUIBackgroundColor",{set:function(K){this.loadingScreen.loadingUIBackgroundColor=K},enumerable:!0,configurable:!0}),z.b.prototype.getInputElement=function(){return this._renderingCanvas},z.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},z.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},z.b.prototype.getAspectRatio=function(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const l=K.viewport;return this.getRenderWidth(Y)*l.width/(this.getRenderHeight(Y)*l.height)},z.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},z.b.prototype._verifyPointerLock=function(){var K;null===(K=this._onPointerLockChange)||void 0===K||K.call(this)},z.b.prototype.setAlphaEquation=function(K){if(this._alphaEquation!==K){switch(K){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=K}},z.b.prototype.getInputElement=function(){return this._renderingCanvas},z.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},z.b.prototype.setDepthFunction=function(K){this._depthCullingState.depthFunc=K},z.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},z.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},z.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},z.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},z.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},z.b.prototype.setDepthWrite=function(K){this._depthCullingState.depthMask=K},z.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},z.b.prototype.setStencilBuffer=function(K){this._stencilState.stencilTest=K},z.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},z.b.prototype.setStencilMask=function(K){this._stencilState.stencilMask=K},z.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},z.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},z.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},z.b.prototype.setStencilFunction=function(K){this._stencilState.stencilFunc=K},z.b.prototype.setStencilFunctionReference=function(K){this._stencilState.stencilFuncRef=K},z.b.prototype.setStencilFunctionMask=function(K){this._stencilState.stencilFuncMask=K},z.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},z.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},z.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},z.b.prototype.setStencilOperationFail=function(K){this._stencilState.stencilOpStencilFail=K},z.b.prototype.setStencilOperationDepthFail=function(K){this._stencilState.stencilOpDepthFail=K},z.b.prototype.setStencilOperationPass=function(K){this._stencilState.stencilOpStencilDepthPass=K},z.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},z.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},z.b.prototype.setAlphaConstants=function(K,Y,l,v){this._alphaState.setAlphaBlendConstants(K,Y,l,v)},z.b.prototype.getAlphaMode=function(){return this._alphaMode},z.b.prototype.getAlphaEquation=function(){return this._alphaEquation},z.b.prototype.getRenderPassNames=function(){return this._renderPassNames},z.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},z.b.prototype.createRenderPassId=function(K){const Y=++z.b._RenderPassIdCounter;return this._renderPassNames[Y]=K??"NONAME",Y},z.b.prototype.releaseRenderPassId=function(K){this._renderPassNames[K]=void 0;for(let Y=0;Y<this.scenes.length;++Y){const l=this.scenes[Y];for(let Y=0;Y<l.meshes.length;++Y){const v=l.meshes[Y];if(v.ui)for(let Y=0;Y<v.ui.length;++Y){v.ui[Y]._removeDrawWrapper(K)}}}};l(12055);function r(K){if(K.requestPointerLock){const Y=K.requestPointerLock();Y instanceof Promise?Y.then((()=>{K.focus()})).catch((()=>{})):K.focus()}}var E=l(2419);l(12064);class y extends d.ThinEngine{static get NpmPackage(){return z.b.NpmPackage}static get Version(){return z.b.Version}static get Instances(){return U.e.Instances}static get LastCreatedEngine(){return U.e.LastCreatedEngine}static get LastCreatedScene(){return U.e.LastCreatedScene}static DefaultLoadingScreenFactory(K){return z.b.DefaultLoadingScreenFactory(K)}get _supportsHardwareTextureRescaling(){return!!y._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(K,Y,l){if(super(K,Y,l,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new c,this._drawCalls=new E.b,K&&(this._features.supportRenderPasses=!0,l=this._creationOptions,K.getContext)){const Y=K;this._sharedInit(Y)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(K){super._sharedInit(K),function(K,Y,l){K._onCanvasFocus=()=>{K.onCanvasFocusObservable.notifyObservers(K)},K._onCanvasBlur=()=>{K.onCanvasBlurObservable.notifyObservers(K)},K._onCanvasContextMenu=Y=>{K.disableContextMenu&&Y.preventDefault()},Y.addEventListener("focus",K._onCanvasFocus),Y.addEventListener("blur",K._onCanvasBlur),Y.addEventListener("contextmenu",K._onCanvasContextMenu),K._onBlur=()=>{K.disablePerformanceMonitorInBackground&&K.performanceMonitor.disable(),K._windowIsBackground=!0},K._onFocus=()=>{K.disablePerformanceMonitorInBackground&&K.performanceMonitor.enable(),K._windowIsBackground=!1},K._onCanvasPointerOut=l=>{document.elementFromPoint(l.clientX,l.clientY)!==Y&&K.onCanvasPointerOutObservable.notifyObservers(l)};const v=K.getHostWindow();v&&"function"===typeof v.addEventListener&&(v.addEventListener("blur",K._onBlur),v.addEventListener("focus",K._onFocus)),Y.addEventListener("pointerout",K._onCanvasPointerOut),l.doNotHandleTouchAction||function(K){K&&K.setAttribute&&(K.setAttribute("touch-action","none"),K.style.touchAction="none",K.style.webkitTapHighlightColor="transparent")}(Y),!z.b.audioEngine&&l.audioEngine&&z.b.AudioEngineFactory&&(z.b.audioEngine=z.b.AudioEngineFactory(K.getRenderingCanvas(),K.getAudioContext(),K.getAudioDestination())),(0,H.f)()&&(K._onFullscreenChange=()=>{K.isFullscreen=!!document.fullscreenElement,K.isFullscreen&&K._pointerLockRequested&&Y&&r(Y)},document.addEventListener("fullscreenchange",K._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",K._onFullscreenChange,!1),K._onPointerLockChange=()=>{K.isPointerLock=document.pointerLockElement===Y},document.addEventListener("pointerlockchange",K._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",K._onPointerLockChange,!1)),K.enableOfflineSupport=void 0!==z.b.OfflineProviderFactory,K._deterministicLockstep=!!l.deterministicLockstep,K._lockstepMaxSteps=l.lockstepMaxSteps||0,K._timeStep=l.timeStep||1/60}(this,K,this._creationOptions)}resizeImageBitmap(K,Y,l){return function(K,Y,l,v){const U=K.createCanvas(l,v).getContext("2d");if(!U)throw new Error("Unable to get 2d context for resizeImageBitmap");return U.drawImage(Y,0,0),U.getImageData(0,0,l,v).data}(this,K,Y,l)}_createImageBitmapFromSource(K,Y){return function(K,Y,l){return new Promise(((v,U)=>{const d=new Image;d.onload=()=>{d.decode().then((()=>{K.createImageBitmap(d,l).then((K=>{v(K)}))}))},d.onerror=()=>{U(`Error loading image ${d.src}`)},d.src=Y}))}(this,K,Y)}switchFullscreen(K){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(K)}enterFullscreen(K){this.isFullscreen||(this._pointerLockRequested=K,this._renderingCanvas&&function(K){const Y=K.requestFullscreen||K.webkitRequestFullscreen;Y&&Y.call(K)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const K=document;document.exitFullscreen?document.exitFullscreen():K.webkitCancelFullScreen&&K.webkitCancelFullScreen()}()}setDitheringState(K){K?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(K){K?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(K,Y,l,v){const U=this._cachedViewport;return this._cachedViewport=null,this._viewport(K,Y,l,v),U}scissorClear(K,Y,l,v,U){this.enableScissor(K,Y,l,v),this.clear(U,!0,!0,!0),this.disableScissor()}enableScissor(K,Y,l,v){const U=this._gl;U.enable(U.SCISSOR_TEST),U.scissor(K,Y,l,v)}disableScissor(){const K=this._gl;K.disable(K.SCISSOR_TEST)}_loadFileAsync(K,Y,l){return new Promise(((v,U)=>{this._loadFile(K,(K=>{v(K)}),void 0,Y,l,((K,Y)=>{U(Y)}))}))}getVertexShaderSource(K){const Y=this._gl.getAttachedShaders(K);return Y?this._gl.getShaderSource(Y[0]):null}getFragmentShaderSource(K){const Y=this._gl.getAttachedShaders(K);return Y?this._gl.getShaderSource(Y[1]):null}set framebufferDimensionsObject(K){this._framebufferDimensionsObject=K,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const K of this.scenes)K.resetCachedMaterial(),K._rebuildGeometries();for(const K of this._virtualScenes)K.resetCachedMaterial(),K._rebuildGeometries();super._rebuildBuffers()}getFontOffset(K){return function(K){const Y=document.createElement("span");Y.textContent="Hg",Y.style.font=K;const l=document.createElement("div");l.style.display="inline-block",l.style.width="1px",l.style.height="0px",l.style.verticalAlign="bottom";const v=document.createElement("div");v.style.whiteSpace="nowrap",v.appendChild(Y),v.appendChild(l),document.body.appendChild(v);let U=0,d=0;try{d=l.getBoundingClientRect().top-Y.getBoundingClientRect().top,l.style.verticalAlign="baseline",U=l.getBoundingClientRect().top-Y.getBoundingClientRect().top}finally{document.body.removeChild(v)}return{ascent:U,height:d,descent:d-U}}(K)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:K}=this.customAnimationFrameRequester;K&&K(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let K=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(K=!1),K&&(this.Fi(),this._renderViews()||this._renderFrame(),this.Gi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&r(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Fi(){this._measureFps(),super.Fi()}_deletePipelineContext(K){const Y=K;Y&&Y.program&&Y.transformFeedback&&(this.deleteTransformFeedback(Y.transformFeedback),Y.transformFeedback=null),super._deletePipelineContext(K)}createShaderProgram(K,Y,l,v,U){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;U=U||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const A=super.createShaderProgram(K,Y,l,v,U,d);return this.onAfterShaderCompilationObservable.notifyObservers(this),A}_createShaderProgram(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const d=v.createProgram();if(K.program=d,!d)throw new Error("Unable to create program");if(v.attachShader(d,Y),v.attachShader(d,l),this.webGLVersion>1&&U){const Y=this.createTransformFeedback();this.bindTransformFeedback(Y),this.setTranformFeedbackVaryings(d,U),K.transformFeedback=Y}return v.linkProgram(d),this.webGLVersion>1&&U&&this.bindTransformFeedback(null),K.context=v,K.vertexShader=Y,K.fragmentShader=l,K.isParallelCompiled||this._finalizePipelineContext(K),d}_releaseTexture(K){super._releaseTexture(K)}_releaseRenderTargetWrapper(K){super._releaseRenderTargetWrapper(K),this.scenes.forEach((Y=>{Y.postProcesses.forEach((Y=>{Y._outputTexture===K&&(Y._outputTexture=null)})),Y.cameras.forEach((Y=>{Y._postProcesses.forEach((Y=>{Y&&Y._outputTexture===K&&(Y._outputTexture=null)}))}))}))}_rescaleTexture(K,Y,l,v,U){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const d=this.createRenderTargetTexture({width:Y.width,height:Y.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&y._RescalePostProcessFactory&&(this._rescalePostProcess=y._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const A=()=>{this._rescalePostProcess.onApply=function(Y){Y._bindTexture("textureSampler",K)};let A=l;A||(A=this.scenes[this.scenes.length-1]),A.postProcessManager.directRender([this._rescalePostProcess],d,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,Y,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,v,0,0,Y.width,Y.height,0),this.unBindFramebuffer(d),d.dispose(),U&&U()},c=this._rescalePostProcess.getEffect();c?c.executeWhenCompiled(A):this._rescalePostProcess.onEffectCreatedObservable.addOnce((K=>{K.executeWhenCompiled(A)}))}}wrapWebGLTexture(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const A=new V.e(K,this._gl),c=new v.e(this,0,!0);return c._hardwareTexture=A,c.baseWidth=U,c.baseHeight=d,c.width=U,c.height=d,c.isReady=!0,c.useMipMaps=Y,this.updateTextureSamplingMode(l,c),c}_uploadImageToTexture(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const U=this._gl,d=this._getWebGLTextureType(K.type),A=this._getInternalFormat(K.format),c=this._getRGBABufferInternalSizedFormat(K.type,A),t=K.isCube?U.TEXTURE_CUBE_MAP:U.TEXTURE_2D;this._bindTextureDirectly(t,K,!0),this._unpackFlipY(K.invertY);let Z=U.TEXTURE_2D;K.isCube&&(Z=U.TEXTURE_CUBE_MAP_POSITIVE_X+l),U.texImage2D(Z,v,c,A,d,Y),this._bindTextureDirectly(t,null,!0)}updateTextureComparisonFunction(K,Y){if(1===this.webGLVersion)return void m.e.Error("WebGL 1 does not support texture comparison.");const l=this._gl;K.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,K,!0),0===Y?(l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_COMPARE_FUNC,Y),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,K,!0),0===Y?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_COMPARE_FUNC,Y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),K._comparisonFunction=Y}createInstancesBuffer(K){const Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create instance buffer");const l=new Z.b(Y);return l.Wh=K,this.bindArrayBuffer(l),this._gl.bufferData(this._gl.ARRAY_BUFFER,K,this._gl.DYNAMIC_DRAW),l.references=1,l}deleteInstancesBuffer(K){this._gl.deleteBuffer(K)}_clientWaitAsync(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const v=this._gl;return new Promise(((U,d)=>{const A=()=>{const c=v.clientWaitSync(K,Y,0);c!=v.WAIT_FAILED?c!=v.TIMEOUT_EXPIRED?U():setTimeout(A,l):d()};A()}))}_readPixelsAsync(K,Y,l,v,U,d,A){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const c=this._gl,t=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.bufferData(c.PIXEL_PACK_BUFFER,A.byteLength,c.STREAM_READ),c.readPixels(K,Y,l,v,U,d,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const Z=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);return Z?(c.flush(),this._clientWaitAsync(Z,0,10).then((()=>(c.deleteSync(Z),c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,A),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteBuffer(t),A)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(K,Y){1===U.e.Instances.length&&z.b.audioEngine&&(z.b.audioEngine.dispose(),z.b.audioEngine=null);const l=K.getHostWindow();l&&"function"===typeof l.removeEventListener&&(l.removeEventListener("blur",K._onBlur),l.removeEventListener("focus",K._onFocus)),Y&&(Y.removeEventListener("focus",K._onCanvasFocus),Y.removeEventListener("blur",K._onCanvasBlur),Y.removeEventListener("pointerout",K._onCanvasPointerOut),Y.removeEventListener("contextmenu",K._onCanvasContextMenu)),(0,H.f)()&&(document.removeEventListener("fullscreenchange",K._onFullscreenChange),document.removeEventListener("mozfullscreenchange",K._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",K._onFullscreenChange),document.removeEventListener("msfullscreenchange",K._onFullscreenChange),document.removeEventListener("pointerlockchange",K._onPointerLockChange),document.removeEventListener("mspointerlockchange",K._onPointerLockChange),document.removeEventListener("mozpointerlockchange",K._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",K._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}y.ALPHA_DISABLE=0,y.ALPHA_ADD=1,y.ALPHA_COMBINE=2,y.ALPHA_SUBTRACT=3,y.ALPHA_MULTIPLY=4,y.ALPHA_MAXIMIZED=5,y.ALPHA_ONEONE=6,y.ALPHA_PREMULTIPLIED=7,y.ALPHA_PREMULTIPLIED_PORTERDUFF=8,y.ALPHA_INTERPOLATE=9,y.ALPHA_SCREENMODE=10,y.DELAYLOADSTATE_NONE=0,y.DELAYLOADSTATE_LOADED=1,y.DELAYLOADSTATE_LOADING=2,y.DELAYLOADSTATE_NOTLOADED=4,y.NEVER=512,y.ALWAYS=519,y.LESS=513,y.EQUAL=514,y.LEQUAL=515,y.GREATER=516,y.GEQUAL=518,y.NOTEQUAL=517,y.KEEP=7680,y.REPLACE=7681,y.INCR=7682,y.DECR=7683,y.INVERT=5386,y.INCR_WRAP=34055,y.DECR_WRAP=34056,y.TEXTURE_CLAMP_ADDRESSMODE=0,y.TEXTURE_WRAP_ADDRESSMODE=1,y.TEXTURE_MIRROR_ADDRESSMODE=2,y.TEXTUREFORMAT_ALPHA=0,y.TEXTUREFORMAT_LUMINANCE=1,y.TEXTUREFORMAT_LUMINANCE_ALPHA=2,y.TEXTUREFORMAT_RGB=4,y.TEXTUREFORMAT_RGBA=5,y.TEXTUREFORMAT_RED=6,y.TEXTUREFORMAT_R=6,y.TEXTUREFORMAT_RG=7,y.TEXTUREFORMAT_RED_INTEGER=8,y.TEXTUREFORMAT_R_INTEGER=8,y.TEXTUREFORMAT_RG_INTEGER=9,y.TEXTUREFORMAT_RGB_INTEGER=10,y.TEXTUREFORMAT_RGBA_INTEGER=11,y.TEXTURETYPE_UNSIGNED_BYTE=0,y.TEXTURETYPE_UNSIGNED_INT=0,y.TEXTURETYPE_FLOAT=1,y.TEXTURETYPE_HALF_FLOAT=2,y.TEXTURETYPE_BYTE=3,y.TEXTURETYPE_SHORT=4,y.TEXTURETYPE_UNSIGNED_SHORT=5,y.TEXTURETYPE_INT=6,y.TEXTURETYPE_UNSIGNED_INTEGER=7,y.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,y.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,y.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,y.TEXTURETYPE_UNSIGNED_INT_24_8=12,y.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,y.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,y.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,y.TEXTURE_NEAREST_SAMPLINGMODE=1,y.TEXTURE_BILINEAR_SAMPLINGMODE=2,y.TEXTURE_TRILINEAR_SAMPLINGMODE=3,y.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,y.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,y.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,y.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,y.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,y.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,y.TEXTURE_NEAREST_LINEAR=7,y.TEXTURE_NEAREST_NEAREST=1,y.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,y.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,y.TEXTURE_LINEAR_LINEAR=2,y.TEXTURE_LINEAR_NEAREST=12,y.TEXTURE_EXPLICIT_MODE=0,y.TEXTURE_SPHERICAL_MODE=1,y.TEXTURE_PLANAR_MODE=2,y.TEXTURE_CUBIC_MODE=3,y.TEXTURE_PROJECTION_MODE=4,y.TEXTURE_SKYBOX_MODE=5,y.TEXTURE_INVCUBIC_MODE=6,y.TEXTURE_EQUIRECTANGULAR_MODE=7,y.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,y.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,y.SCALEMODE_FLOOR=1,y.SCALEMODE_NEAREST=2,y.SCALEMODE_CEILING=3},12748:(K,Y,l)=>{"use strict";l(492);var v=l(12033);l(594),l(732),l(589),l(12049),l(12005);v.e},12049:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>v});class v{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var K;return(null===(K=this._textures)||void 0===K?void 0:K[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(K){var Y,l;if(!this._textures)return-1;const v=this._textures[K],U=(null===(Y=this._layerIndices)||void 0===Y?void 0:Y[K])??0,d=(null===(l=this._faceIndices)||void 0===l?void 0:l[K])??0;return v.isCube?6*U+d:v.is3D?0:U}get samples(){return this._samples}setSamples(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===K&&!l)return K;const v=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,K,Y):this._engine.updateRenderTargetTextureSampleCount(this,K);return this._samples=K,v}constructor(K,Y,l,v,U){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=K,this._isCube=Y,this._size=l,this._engine=v,this._depthStencilTexture=null,this.label=U}setTextures(K){Array.isArray(K)?this._textures=K:this._textures=K?[K]:null}setTexture(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[Y]!==K&&(this._textures[Y]&&l&&this._textures[Y].dispose(),this._textures[Y]=K)}setLayerAndFaceIndices(K,Y){this._layerIndices=K,this._faceIndices=Y}setLayerAndFaceIndex(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==Y&&Y>=0&&(this._layerIndices[K]=Y),void 0!==l&&l>=0&&(this._faceIndices[K]=l)}createDepthStencilTexture(){var K;let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,A=arguments.length>5?arguments[5]:void 0;return null===(K=this._depthStencilTexture)||void 0===K||K.dispose(),this._depthStencilTextureWithStencil=v,this._depthStencilTextureLabel=A,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:l,comparisonFunction:Y,generateStencil:v,isCube:this._isCube,samples:U,depthTextureFormat:d,label:A},this),this._depthStencilTexture}_shareDepth(K){this.shareDepth(K)}shareDepth(K){this._depthStencilTexture&&(K._depthStencilTexture&&K._depthStencilTexture.dispose(),K._depthStencilTexture=this._depthStencilTexture,K._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(K){this.texture&&this.texture._swapAndDie(K),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let K=null;if(this._isMulti){const Y=this.textures;if(Y&&Y.length>0){let l=!1,v=Y.length,U=-1;const d=Y[Y.length-1]._source;14!==d&&12!==d||(l=!0,U=Y[Y.length-1].format,v--);const A=[],c=[],t=[],Z=[],m=[],V=[],M=[],u={};for(let K=0;K<v;++K){const l=Y[K];A.push(l.samplingMode),c.push(l.type),t.push(l.format);void 0!==u[l.uniqueId]?(Z.push(-1),M.push(0)):(u[l.uniqueId]=K,l.is2DArray?(Z.push(35866),M.push(l.depth)):l.isCube?(Z.push(34067),M.push(0)):l.is3D?(Z.push(32879),M.push(l.depth)):(Z.push(3553),M.push(0))),this._faceIndices&&m.push(this._faceIndices[K]??0),this._layerIndices&&V.push(this._layerIndices[K]??0)}const o={samplingModes:A,generateMipMaps:Y[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:l,depthTextureFormat:U,types:c,formats:t,textureCount:v,targetTypes:Z,faceIndex:m,layerIndex:V,layerCounts:M,label:this.label},W={width:this.width,height:this.height,depth:this.depth};K=this._engine.createMultipleRenderTarget(W,o);for(let g=0;g<v;++g){if(-1!==Z[g])continue;const l=u[Y[g].uniqueId];K.setTexture(K.textures[l],g)}}}else{var Y,l,v,U;const A={};if(A.generateDepthBuffer=this._generateDepthBuffer,A.generateMipMaps=(null===(Y=this.texture)||void 0===Y?void 0:Y.generateMipMaps)??!1,A.generateStencilBuffer=this._generateStencilBuffer,A.samplingMode=null===(l=this.texture)||void 0===l?void 0:l.samplingMode,A.type=null===(v=this.texture)||void 0===v?void 0:v.type,A.format=null===(U=this.texture)||void 0===U?void 0:U.format,A.noColorAttachment=!this._textures,A.label=this.label,this.isCube)K=this._engine.createRenderTargetCubeTexture(this.width,A);else{var d;const Y={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(d=this.texture)||void 0===d?void 0:d.depth:void 0};K=this._engine.createRenderTargetTexture(Y,A)}K.texture&&(K.texture.isReady=!0)}return K}_swapRenderTargetWrapper(K){if(this._textures&&K._textures)for(let Y=0;Y<this._textures.length;++Y)this._textures[Y]._swapAndDie(K._textures[Y],!1),K._textures[Y].isReady=!0;this._depthStencilTexture&&K._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(K._depthStencilTexture),K._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const K=this._cloneRenderTargetWrapper();if(K){if(this._depthStencilTexture){const Y=this._depthStencilTexture.samplingMode,l=this._depthStencilTexture.format,v=2===Y||3===Y||11===Y;K.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,v,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,l,this._depthStencilTextureLabel)}this.samples>1&&K.setSamples(this.samples),K._swapRenderTargetWrapper(this),K.dispose()}}releaseTextures(){if(this._textures)for(let Y=0;Y<(null===(K=this._textures)||void 0===K?void 0:K.length);++Y){var K;this._textures[Y].dispose()}this._textures=null}dispose(){var K;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(K=this._depthStencilTexture)||void 0===K||K.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11728:(K,Y,l)=>{"use strict";l.r(Y),l.d(Y,{SceneInstrumentation:()=>d});var v=l(475),U=l(2419);class d{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(K){K!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=K,K?(this._onBeforeActiveMeshesEvaluationObserver=this.hi.onBeforeActiveMeshesEvaluationObservable.add((()=>{v.d.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.hi.onAfterActiveMeshesEvaluationObservable.add((()=>{v.d.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.hi.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hi.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(K){K!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=K,K?(this._onBeforeRenderTargetsRenderObserver=this.hi.onBeforeRenderTargetsRenderObservable.add((()=>{v.d.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.hi.onAfterRenderTargetsRenderObservable.add((()=>{v.d.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.hi.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hi.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(K){K!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=K,K?(this._onBeforeParticlesRenderingObserver=this.hi.onBeforeParticlesRenderingObservable.add((()=>{v.d.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.hi.onAfterParticlesRenderingObservable.add((()=>{v.d.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.hi.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hi.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(K){K!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=K,this.hi.spriteManagers&&(K?(this._onBeforeSpritesRenderingObserver=this.hi.onBeforeSpritesRenderingObservable.add((()=>{v.d.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.hi.onAfterSpritesRenderingObservable.add((()=>{v.d.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.hi.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.hi.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(K){K!==this._capturePhysicsTime&&this.hi.onBeforePhysicsObservable&&(this._capturePhysicsTime=K,K?(this._onBeforePhysicsObserver=this.hi.onBeforePhysicsObservable.add((()=>{v.d.StartPerformanceCounter("hb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.hi.onAfterPhysicsObservable.add((()=>{v.d.EndPerformanceCounter("hb"),this._physicsTime.endMonitoring()}))):(this.hi.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.hi.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(K){K!==this._captureAnimationsTime&&(this._captureAnimationsTime=K,K?this._onAfterAnimationsObserver=this.hi.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.hi.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(K){this._captureFrameTime=K}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(K){this._captureInterFrameTime=K}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(K){K!==this._captureRenderTime&&(this._captureRenderTime=K,K?(this._onBeforeDrawPhaseObserver=this.hi.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),v.d.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.hi.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),v.d.EndPerformanceCounter("Main render")}))):(this.hi.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hi.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(K){K!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=K,K?(this._onBeforeCameraRenderObserver=this.hi.onBeforeCameraRenderObservable.add((K=>{this._cameraRenderTime.beginMonitoring(),v.d.StartPerformanceCounter(`Rendering camera ${K.name}`)})),this._onAfterCameraRenderObserver=this.hi.onAfterCameraRenderObservable.add((K=>{this._cameraRenderTime.endMonitoring(!1),v.d.EndPerformanceCounter(`Rendering camera ${K.name}`)}))):(this.hi.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hi.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.hi.getEngine()._drawCalls}constructor(K){this.hi=K,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new U.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new U.b,this._captureFrameTime=!1,this._frameTime=new U.b,this._captureRenderTime=!1,this._renderTime=new U.b,this._captureInterFrameTime=!1,this._interFrameTime=new U.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new U.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new U.b,this._capturePhysicsTime=!1,this._physicsTime=new U.b,this._captureAnimationsTime=!1,this._animationsTime=new U.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new U.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=K.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(v.d.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.hi.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=K.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(v.d.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Gi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Gi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Gi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Gi(),this._captureRenderTime&&this._renderTime.Gi(),this._captureCameraRenderTime&&this._cameraRenderTime.Gi()}))}dispose(){this.hi.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.hi.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.hi.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.hi.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.hi.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.hi.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.hi.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.hi.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.hi.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.hi.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.hi.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.hi.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.hi.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.hi.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.hi.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.hi.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.hi.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.hi=null}}},12504:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>m});var v=l(646),U=l(652),d=l(675),A=l(699),c=l(12484),t=l(12506),Z=l(619);A.b.AddNodeConstructor("Light_Type_1",((K,Y)=>()=>new m(K,d.o.Zero(),Y)));class m extends t.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(K){this._shadowFrustumSize=K,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(K){this._shadowOrthoScale=K,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(K){this._orthoLeft=K}get orthoRight(){return this._orthoRight}set orthoRight(K){this._orthoRight=K}get orthoTop(){return this._orthoTop}set orthoTop(K){this._orthoTop=K}get orthoBottom(){return this._orthoBottom}set orthoBottom(K){this._orthoBottom=K}constructor(K,Y,l){super(K,l),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Y.scale(-1),this.direction=Y}getClassName(){return"ib"}getTypeID(){return c.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(K,Y,l){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(K):this._setDefaultAutoExtendShadowProjectionMatrix(K,Y,l)}_setDefaultFixedFrustumShadowProjectionMatrix(K){const Y=this.va().activeCamera;Y&&d.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Y.ti,void 0!==this.shadowMaxZ?this.shadowMaxZ:Y.maxZ,K,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(K,Y,l){const v=this.va().activeCamera;if(!v)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const K=d.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let v=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let A=0;A<l.length;A++){const c=l[A];if(!c)continue;const t=c.getBoundingInfo().boundingBox;for(let l=0;l<t.vectorsWorld.length;l++)d.o.TransformCoordinatesToRef(t.vectorsWorld[l],Y,K),K.x<this._orthoLeft&&(this._orthoLeft=K.x),K.y<this._orthoBottom&&(this._orthoBottom=K.y),K.x>this._orthoRight&&(this._orthoRight=K.x),K.y>this._orthoTop&&(this._orthoTop=K.y),this.autoCalcShadowZBounds&&(K.z<v&&(v=K.z),K.z>U&&(U=K.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=v,this._shadowMaxZ=U)}const U=this._orthoRight-this._orthoLeft,A=this._orthoTop-this._orthoBottom,c=void 0!==this.shadowMinZ?this.shadowMinZ:v.ti,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,Z=this.va().getEngine().useReverseDepthBuffer;d.d.OrthoOffCenterLHToRef(this._orthoLeft-U*this.shadowOrthoScale,this._orthoRight+U*this.shadowOrthoScale,this._orthoBottom-A*this.shadowOrthoScale,this._orthoTop+A*this.shadowOrthoScale,Z?t:c,Z?c:t,K,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,Y){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Y),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Y),this)}transferToNodeMaterialEffect(K,Y){return this.computeTransformedInformation()?(K.setFloat3(Y,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(K.setFloat3(Y,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(K){const Y=this._scene.getEngine();return!Y.useReverseDepthBuffer&&Y.isNDCHalfZRange?0:1}getDepthMaxZ(K){const Y=this._scene.getEngine();return Y.useReverseDepthBuffer&&Y.isNDCHalfZRange?0:1}prepareLightSpecificDefines(K,Y){K["DIRLIGHT"+Y]=!0}}(0,v.d)([(0,U.J)()],m.prototype,"shadowFrustumSize",null),(0,v.d)([(0,U.J)()],m.prototype,"shadowOrthoScale",null),(0,v.d)([(0,U.J)()],m.prototype,"autoUpdateExtends",void 0),(0,v.d)([(0,U.J)()],m.prototype,"autoCalcShadowZBounds",void 0),(0,v.d)([(0,U.J)("orthoLeft")],m.prototype,"_orthoLeft",void 0),(0,v.d)([(0,U.J)("orthoRight")],m.prototype,"_orthoRight",void 0),(0,v.d)([(0,U.J)("orthoTop")],m.prototype,"_orthoTop",void 0),(0,v.d)([(0,U.J)("orthoBottom")],m.prototype,"_orthoBottom",void 0),(0,Z.f)("BABYLON.DirectionalLight",m)},12674:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>m});var v=l(646),U=l(652),d=l(675),A=l(706),c=l(699),t=l(12484),Z=l(619);c.b.AddNodeConstructor("Light_Type_3",((K,Y)=>()=>new m(K,d.o.Zero(),Y)));class m extends t.c{constructor(K,Y,l){super(K,l),this.groundColor=new A.e(0,0,0),this.direction=Y||d.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(K){return this.direction=d.o.Normalize(K.Lg(d.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(K,Y){const l=d.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",l.x,l.y,l.z,0,Y),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Kl),Y),this}transferToNodeMaterialEffect(K,Y){const l=d.o.Normalize(this.direction);return K.setFloat3(Y,l.x,l.y,l.z),this}ri(){return this._worldMatrix||(this._worldMatrix=d.d.Identity()),this._worldMatrix}getTypeID(){return t.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(K,Y){K["HEMILIGHT"+Y]=!0}}(0,v.d)([(0,U.l)()],m.prototype,"groundColor",void 0),(0,v.d)([(0,U.F)()],m.prototype,"direction",void 0),(0,Z.f)("BABYLON.HemisphericLight",m)},12484:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>M});var v=l(646),U=l(652),d=l(675),A=l(706),c=l(699),t=l(831),Z=l(619),m=l(845),V=l(702);class M extends c.b{get range(){return this._range}set range(K){this._range=K,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(K){this._intensityMode=K,this._computePhotometricScale()}get radius(){return this._radius}set radius(K){this._radius=K,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(K){this._shadowEnabled!==K&&(this._shadowEnabled=K,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(K){this._includedOnlyMeshes=K,this._hookArrayForIncludedOnly(K)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(K){this._excludedMeshes=K,this._hookArrayForExcluded(K)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(K){this._excludeWithLayerMask=K,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(K){this._includeOnlyWithLayerMask=K,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(K){this._lightmapMode!==K&&(this._lightmapMode=K,this._markMeshesAsLightDirty())}getViewMatrix(K){return null}getProjectionMatrix(K,Y){return null}constructor(K,Y){super(K,Y,!1),this.Rk=new A.e(1,1,1),this.bj=new A.e(1,1,1),this.falloffType=M.FALLOFF_DEFAULT,this.Kl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=M.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new t.d(this.va().getEngine(),void 0,void 0,K),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(K,Y){return this}_bindLight(K,Y,l,v){let U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const d=K.toString();let c=!1;if(this._uniformBuffer.bindToEffect(l,"Light"+d),this._renderId!==Y.getRenderId()||this._lastUseSpecular!==v||!this._uniformBuffer.useUbo){this._renderId=Y.getRenderId(),this._lastUseSpecular=v;const K=this.getScaledIntensity();this.transferToEffect(l,d),this.Rk.scaleToRef(K,A.i.Ti[0]),this._uniformBuffer.updateColor4("vLightDiffuse",A.i.Ti[0],this.range,d),v&&(this.bj.scaleToRef(K,A.i.Ti[1]),this._uniformBuffer.updateColor4("vLightSpecular",A.i.Ti[1],this.radius,d)),c=!0}if(this.transferTexturesToEffect(l,d),Y.shadowsEnabled&&this.shadowEnabled&&U){const K=this.getShadowGenerator(Y.activeCamera)??this.getShadowGenerator();K&&(K.bindShadowLight(d,l),c=!0)}c?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(K){let Y="Name: "+this.name;if(Y+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let l=0;l<this.animations.length;l++)Y+=", animation[0]: "+this.animations[l].toString(K);return Y}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}$h(K){super.$h(K),this._resyncMeshes()}getShadowGenerator(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(K)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return d.o.Zero()}canAffectMesh(K){return!K||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(K))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(K))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&K.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&K.layerMask)))}dispose(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const K=this._shadowGenerators.values();for(let Y=K.next();!0!==Y.done;Y=K.next()){Y.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const K=this._parentContainer.lights.indexOf(this);K>-1&&this._parentContainer.lights.splice(K,1),this._parentContainer=null}for(const l of this.va().meshes)l._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(K,Y)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Kl}clone(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=M.GetConstructorFromName(this.getTypeID(),K,this.va());if(!l)return null;const v=V.c.Clone(l,this);return K&&(v.name=K),Y&&(v.parent=Y),v.$h(this.isEnabled()),this.onClonedObservable.notifyObservers(v),v}serialize(){const K=V.c.Serialize(this);return K.uniqueId=this.uniqueId,K.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(K),this.excludedMeshes.length>0&&(K.excludedMeshesIds=[],this.excludedMeshes.forEach((Y=>{K.excludedMeshesIds.push(Y.id)}))),this.includedOnlyMeshes.length>0&&(K.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((Y=>{K.includedOnlyMeshesIds.push(Y.id)}))),V.c.AppendSerializedAnimations(this,K),K.ranges=this.serializeAnimationRanges(),K.isEnabled=this.isEnabled(),K}static GetConstructorFromName(K,Y,l){const v=c.b.Construct("Light_Type_"+K,Y,l);return v||null}static Parse(K,Y){const l=M.GetConstructorFromName(K.type,K.name,Y);if(!l)return null;const v=V.c.Parse(l,K,Y);if(K.excludedMeshesIds&&(v._excludedMeshesIds=K.excludedMeshesIds),K.includedOnlyMeshesIds&&(v._includedOnlyMeshesIds=K.includedOnlyMeshesIds),void 0!==K.parentId&&(v._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(v._waitingParentInstanceIndex=K.parentInstanceIndex),void 0!==K.falloffType&&(v.falloffType=K.falloffType),void 0!==K.lightmapMode&&(v.lightmapMode=K.lightmapMode),K.animations){for(let Y=0;Y<K.animations.length;Y++){const l=K.animations[Y],U=(0,Z.c)("BABYLON.Animation");U&&v.animations.push(U.Parse(l))}c.b.ParseAnimationRanges(v,K,Y)}return K.autoAnimate&&Y.beginAnimation(v,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),void 0!==K.isEnabled&&v.$h(K.isEnabled),v}_hookArrayForExcluded(K){var Y=this;const l=K.push;K.push=function(){for(var v=arguments.length,U=new Array(v),d=0;d<v;d++)U[d]=arguments[d];const A=l.apply(K,U);for(const K of U)K._resyncLightSource(Y);return A};const v=K.splice;K.splice=(Y,l)=>{const U=v.apply(K,[Y,l]);for(const K of U)K._resyncLightSource(this);return U};for(const U of K)U._resyncLightSource(this)}_hookArrayForIncludedOnly(K){var Y=this;const l=K.push;K.push=function(){for(var v=arguments.length,U=new Array(v),d=0;d<v;d++)U[d]=arguments[d];const A=l.apply(K,U);return Y._resyncMeshes(),A};const v=K.splice;K.splice=(Y,l)=>{const U=v.apply(K,[Y,l]);return this._resyncMeshes(),U},this._resyncMeshes()}_resyncMeshes(){for(const K of this.va().meshes)K._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const K of this.va().meshes)-1!==K.lightSources.indexOf(this)&&K._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let K=0;const Y=this.getTypeID();let l=this.intensityMode;switch(l===M.INTENSITYMODE_AUTOMATIC&&(l=Y===M.LIGHTTYPEID_DIRECTIONALLIGHT?M.INTENSITYMODE_ILLUMINANCE:M.INTENSITYMODE_LUMINOUSINTENSITY),Y){case M.LIGHTTYPEID_POINTLIGHT:case M.LIGHTTYPEID_SPOTLIGHT:switch(l){case M.INTENSITYMODE_LUMINOUSPOWER:K=1/(4*Math.PI);break;case M.INTENSITYMODE_LUMINOUSINTENSITY:K=1;break;case M.INTENSITYMODE_LUMINANCE:K=this.radius*this.radius}break;case M.LIGHTTYPEID_DIRECTIONALLIGHT:switch(l){case M.INTENSITYMODE_ILLUMINANCE:K=1;break;case M.INTENSITYMODE_LUMINANCE:{let Y=this.radius;Y=Math.max(Y,.001);K=2*Math.PI*(1-Math.cos(Y));break}}break;case M.LIGHTTYPEID_HEMISPHERICLIGHT:K=1}return K}_reorderLightsInScene(){const K=this.va();0!=this._renderPriority&&(K.requireLightSorting=!0),this.va().sortLightsByPriority()}}M.FALLOFF_DEFAULT=m.b.FALLOFF_DEFAULT,M.FALLOFF_PHYSICAL=m.b.FALLOFF_PHYSICAL,M.FALLOFF_GLTF=m.b.FALLOFF_GLTF,M.FALLOFF_STANDARD=m.b.FALLOFF_STANDARD,M.LIGHTMAP_DEFAULT=m.b.LIGHTMAP_DEFAULT,M.LIGHTMAP_SPECULAR=m.b.LIGHTMAP_SPECULAR,M.LIGHTMAP_SHADOWSONLY=m.b.LIGHTMAP_SHADOWSONLY,M.INTENSITYMODE_AUTOMATIC=m.b.INTENSITYMODE_AUTOMATIC,M.INTENSITYMODE_LUMINOUSPOWER=m.b.INTENSITYMODE_LUMINOUSPOWER,M.INTENSITYMODE_LUMINOUSINTENSITY=m.b.INTENSITYMODE_LUMINOUSINTENSITY,M.INTENSITYMODE_ILLUMINANCE=m.b.INTENSITYMODE_ILLUMINANCE,M.INTENSITYMODE_LUMINANCE=m.b.INTENSITYMODE_LUMINANCE,M.LIGHTTYPEID_POINTLIGHT=m.b.LIGHTTYPEID_POINTLIGHT,M.LIGHTTYPEID_DIRECTIONALLIGHT=m.b.LIGHTTYPEID_DIRECTIONALLIGHT,M.LIGHTTYPEID_SPOTLIGHT=m.b.LIGHTTYPEID_SPOTLIGHT,M.LIGHTTYPEID_HEMISPHERICLIGHT=m.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,v.d)([(0,U.l)()],M.prototype,"diffuse",void 0),(0,v.d)([(0,U.l)()],M.prototype,"specular",void 0),(0,v.d)([(0,U.J)()],M.prototype,"falloffType",void 0),(0,v.d)([(0,U.J)()],M.prototype,"intensity",void 0),(0,v.d)([(0,U.J)()],M.prototype,"range",null),(0,v.d)([(0,U.J)()],M.prototype,"intensityMode",null),(0,v.d)([(0,U.J)()],M.prototype,"radius",null),(0,v.d)([(0,U.J)()],M.prototype,"_renderPriority",void 0),(0,v.d)([(0,U.b)("_reorderLightsInScene")],M.prototype,"renderPriority",void 0),(0,v.d)([(0,U.J)("shadowEnabled")],M.prototype,"_shadowEnabled",void 0),(0,v.d)([(0,U.J)("excludeWithLayerMask")],M.prototype,"_excludeWithLayerMask",void 0),(0,v.d)([(0,U.J)("includeOnlyWithLayerMask")],M.prototype,"_includeOnlyWithLayerMask",void 0),(0,v.d)([(0,U.J)("lightmapMode")],M.prototype,"_lightmapMode",void 0)},12506:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>t});var v=l(646),U=l(652),d=l(675),A=l(12484),c=l(833);class t extends A.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=d.d.Identity(),this._projectionMatrix=d.d.Identity()}_setPosition(K){this._position=K}get position(){return this._position}set position(K){this._setPosition(K)}_setDirection(K){this._direction=K}get direction(){return this._direction}set direction(K){this._setDirection(K)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(K){this._shadowMinZ=K,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(K){this._shadowMaxZ=K,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=d.o.Zero()),d.o.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=d.o.Zero()),d.o.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(K){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(K){return this.direction=d.o.Normalize(K.Lg(this.position)),this.direction}getRotation(){this.direction.normalize();const K=d.o.Cross(this.direction,c.e.Y),Y=d.o.Cross(K,this.direction);return d.o.RotationFromAxis(K,Y,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=d.o.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ri(K){return!K&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=d.d.Identity()),d.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(K){return void 0!==this.shadowMinZ?this.shadowMinZ:K.ti}getDepthMaxZ(K){return void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ}setShadowProjectionMatrix(K,Y,l){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(Y,l,K):this._setDefaultShadowProjectionMatrix(K,Y,l),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(K){const Y=d.j.Qi[0];let l=this.position;this.computeTransformedInformation()&&(l=this.transformedPosition),d.o.NormalizeToRef(this.getShadowDirection(K),Y),1===Math.abs(d.o.Dot(Y,d.o.Up()))&&(Y.z=1e-13);const v=d.j.Qi[1];return l.addToRef(Y,v),d.d.LookAtLHToRef(l,v,d.o.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(K,Y){return this.setShadowProjectionMatrix(this._projectionMatrix,K??this._viewMatrix,Y??[]),this._projectionMatrix}}(0,v.d)([(0,U.F)()],t.prototype,"position",null),(0,v.d)([(0,U.F)()],t.prototype,"direction",null),(0,v.d)([(0,U.J)()],t.prototype,"shadowMinZ",null),(0,v.d)([(0,U.J)()],t.prototype,"shadowMaxZ",null)},12148:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>A,d:()=>d,h:()=>c});const v={},U={};function d(K,Y){v[K]=Y}function A(K,Y){U[K]=Y}function c(K){return U[K]?U[K]:null}},11949:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>Q,h:()=>r});var v,U=l(475),d=l(469),A=l(2366),c=l(526),t=l(492),Z=l(796),m=l(534),V=l(538),M=l(623),u=l(567);!function(K){K[K.Clean=0]="Clean",K[K.Stop=1]="Stop",K[K.Sync=2]="Sync",K[K.NoSync=3]="NoSync"}(v||(v={}));const o=new d.b,W={};let g=!1;function J(){return W[".babylon"]}function n(K){const Y=W[K];return Y||(t.e.Warn("Unable to find a plugin to load "+K+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),J())}function R(K,Y,l){let v="Unable to load from "+(K.rawData?"binary data":K.url);return Y?v+=`: ${Y}`:l&&(v+=`: ${l}`),v}function H(K,Y,l,v,U,d,A,c,t){var Z;const V="data:"===(M=K.url).substring(0,5)?M.substring(5):null;var M;if(K.rawData&&!A)throw"When using ArrayBufferView to load data the file extension must be provided.";const g=A?n(A):V?function(K){for(const Y in W){const l=W[Y].plugin;if(l.canDirectLoad&&l.canDirectLoad(K))return W[Y]}return J()}(K.url):function(K){const Y=K.indexOf("?");-1!==Y&&(K=K.substring(0,Y));const l=K.lastIndexOf(".");return n(K.substring(l,K.length).toLowerCase())}(K.url);if(!g)throw new Error(`No plugin or fallback for ${A??K.url}`);if(!1===(null===t||void 0===t||null===(Z=t[g.plugin.name])||void 0===Z?void 0:Z.enabled))throw new Error(`The '${g.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(K.rawData&&!g.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(K=>{if(g.plugin.createPlugin){const Y=g.plugin.createPlugin(t??{});return Y instanceof Promise?(Y.then(K).catch((K=>{U("Error instantiating plugin.",K)})),null):(K(Y),Y)}return K(g.plugin),g.plugin})((t=>{var Z;if(!t)throw`The loader plugin corresponding to the '${A}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(o.notifyObservers(t),V&&(t.canDirectLoad&&t.canDirectLoad(K.url)||!(0,m.f)(K.url))){if(t.directLoad){const K=t.directLoad(Y,V);K instanceof Promise?K.then((K=>{l(t,K)})).catch((K=>{U("Error in directLoad of _loadData: "+K,K)})):l(t,K)}else l(t,V);return}const M=g.isBinary,W=(K,v)=>{Y.u?U("Scene has been disposed"):l(t,K,v)};let J=null,n=!1;null===(Z=t.Hi)||void 0===Z||Z.add((()=>{n=!0,J&&(J.abort(),J=null),d()}));const R=()=>{if(n)return;const l=(K,Y)=>{U(null===K||void 0===K?void 0:K.statusText,Y)};if(!t.loadFile&&K.rawData)throw"Plugin does not support loading ArrayBufferView.";J=t.loadFile?t.loadFile(Y,K.rawData||K.file||K.url,K.rootUrl,W,v,M,l,c):Y._loadFile(K.file||K.url,W,v,!0,M,l)},H=Y.getEngine();let z=H.enableOfflineSupport;if(z){let l=!1;for(const v of Y.disableOfflineSupportExceptionRules)if(v.test(K.url)){l=!0;break}z=!l}z&&u.b.OfflineProviderFactory?Y.offlineProvider=u.b.OfflineProviderFactory(K.url,R,H.disableManifestCheck):R()}))}function z(K,Y){let l,v,d=null,A=null;if(Y)if(Y.name)l=`file:${Y.name}`,v=Y.name,d=Y;else if(ArrayBuffer.isView(Y))l="",v=(0,M.d)(),A=Y;else if(Y.startsWith("data:"))l=Y,v="";else if(K){const d=Y;if("/"===d.substring(0,1))return U.d.Error("Wrong sceneFilename parameter"),null;l=K+d,v=d}else l=Y,v=U.d.GetFilename(Y),K=U.d.GetFolderPath(Y);else l=K,v=U.d.GetFilename(K),K=U.d.GetFolderPath(K);return{url:l,rootUrl:K,name:v,file:d,rawData:A}}function r(K){if("string"===typeof K.extensions){const Y=K.extensions;W[Y.toLowerCase()]={plugin:K,isBinary:!1}}else{const Y=K.extensions;Object.keys(Y).forEach((l=>{W[l.toLowerCase()]={plugin:K,isBinary:Y[l].isBinary}}))}}function E(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.e.LastCreatedScene,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!v)return t.e.Error("No scene available to import mesh to"),null;const u=z(Y,l);if(!u)return null;const o={};v.addPendingData(o);const W=()=>{v.removePendingData(o)},g=(K,Y)=>{const l=R(u,K,Y);A?A(v,l,new V.h(l,V.d.SceneLoaderError,Y)):t.e.Error(l),W()},J=d?K=>{try{d(K)}catch(Y){g("Error in onProgress callback: "+Y,Y)}}:void 0,n=(K,Y,l,d,A,c,t,Z)=>{if(v.importedMeshesFiles.push(u.url),U)try{U(K,Y,l,d,A,c,t,Z)}catch(m){g("Error in onSuccess callback: "+m,m)}v.removePendingData(o)};return H(u,v,((Y,l,U)=>{if(Y.rewriteRootURL&&(u.rootUrl=Y.rewriteRootURL(u.rootUrl,U)),Y.importMesh){const U=[],d=[],A=[];if(!Y.importMesh(K,v,l,u.rootUrl,U,d,A,g))return;v.loadingPluginName=Y.name,n(U,d,A,[],[],[],[],[])}else{Y.importMeshAsync(K,v,l,u.rootUrl,J,u.name).then((K=>{v.loadingPluginName=Y.name,n(K.meshes,K.qi,K.skeletons,K.animationGroups,K.transformNodes,K.geometries,K.lights,K.spriteManagers)})).catch((K=>{g(K.message,K)}))}}),J,g,W,Z,m,M)}function y(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.e.LastCreatedEngine,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return l?e(K,Y,new A.b(l),v,d,t,Z,m,V):(U.d.Error("No engine available"),null)}function T(K,Y,l,v,U,d,A){return new Promise(((c,t)=>{y(K,Y,l,(K=>{c(K)}),v,((K,Y,l)=>{t(l||new Error(Y))}),U,d,A)}))}function e(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.e.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return t.e.Error("No scene available to append to"),null;const u=z(K,Y);if(!u)return null;const o={};l.addPendingData(o);const W=()=>{l.removePendingData(o)};Z.c.ShowLoadingScreen&&!g&&(g=!0,l.getEngine().displayLoadingUI(),l.executeWhenReady((()=>{l.getEngine().hideLoadingUI(),g=!1})));const J=(K,Y)=>{const v=R(u,K,Y);d?d(l,v,new V.h(v,V.d.SceneLoaderError,Y)):t.e.Error(v),W()},n=U?K=>{try{U(K)}catch(Y){J("Error in onProgress callback",Y)}}:void 0,r=()=>{if(v)try{v(l)}catch(K){J("Error in onSuccess callback",K)}l.removePendingData(o)};return H(u,l,((K,Y)=>{if(K.load){if(!K.load(l,Y,u.rootUrl,J))return;l.loadingPluginName=K.name,r()}else{K.loadAsync(l,Y,u.rootUrl,n,u.name).then((()=>{l.loadingPluginName=K.name,r()})).catch((K=>{J(K.message,K)}))}}),n,J,W,A,m,M)}function i(K,Y,l,v,U,d,A){return new Promise(((c,t)=>{e(K,Y,l,(K=>{c(K)}),v,((K,Y,l)=>{t(l||new Error(Y))}),U,d,A)}))}function D(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.e.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!l)return t.e.Error("No scene available to load asset container to"),null;const M=z(K,Y);if(!M)return null;const u={};l.addPendingData(u);const o=()=>{l.removePendingData(u)},W=(K,Y)=>{const v=R(M,K,Y);d?d(l,v,new V.h(v,V.d.SceneLoaderError,Y)):t.e.Error(v),o()},g=U?K=>{try{U(K)}catch(Y){W("Error in onProgress callback",Y)}}:void 0,J=K=>{if(v)try{v(K)}catch(Y){W("Error in onSuccess callback",Y)}l.removePendingData(u)};return H(M,l,((K,Y)=>{if(K.loadAssetContainer){const v=K.loadAssetContainer(l,Y,M.rootUrl,W);if(!v)return;v.populateRootNodes(),l.loadingPluginName=K.name,J(v)}else if(K.loadAssetContainerAsync){K.loadAssetContainerAsync(l,Y,M.rootUrl,g,M.name).then((Y=>{Y.populateRootNodes(),l.loadingPluginName=K.name,J(Y)})).catch((K=>{W(K.message,K)}))}else W("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),g,W,o,A,Z,m)}function B(K,Y,l,v,U,d,A){return new Promise(((c,t)=>{D(K,Y,l,(K=>{c(K)}),v,((K,Y,l)=>{t(l||new Error(Y))}),U,d,A)}))}function P(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.e.LastCreatedScene,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!l)return void t.e.Error("No scene available to load animations to");if(v){for(const K of l.animatables)K.reset();l.stopAllAnimations(),l.animationGroups.slice().forEach((K=>{K.dispose()}));l.getNodes().forEach((K=>{K.animations&&(K.animations=[])}))}else switch(U){case 0:l.animationGroups.slice().forEach((K=>{K.dispose()}));break;case 1:l.animationGroups.forEach((K=>{K.stop()}));break;case 2:l.animationGroups.forEach((K=>{K.reset(),K.restart()}));break;case 3:break;default:return void t.e.Error("Unknown animation group loading mode value '"+U+"'")}const o=l.animatables.length;D(K,Y,l,(K=>{K.mergeAnimationsTo(l,l.animatables.slice(o),d),K.dispose(),l.onAnimationFileImportedObservable.notifyObservers(l),A&&A(l)}),Z,m,V,M,u)}function G(K,Y,l,v,U,d,A,c,t,Z){return new Promise(((m,V)=>{P(K,Y,l,v,U,d,(K=>{m(K)}),A,((K,Y,l)=>{V(l||new Error(Y))}),c,t,Z)}))}class Q{static get ForceFullSceneLoadingForIncremental(){return Z.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){Z.c.ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return Z.c.ShowLoadingScreen}static set ShowLoadingScreen(K){Z.c.ShowLoadingScreen=K}static get loggingLevel(){return Z.c.loggingLevel}static set loggingLevel(K){Z.c.loggingLevel=K}static get CleanBoneMatrixWeights(){return Z.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){Z.c.CleanBoneMatrixWeights=K}static GetDefaultPlugin(){return J()}static GetPluginForExtension(K){var Y;return null===(Y=n(K))||void 0===Y?void 0:Y.plugin}static IsPluginForExtensionAvailable(K){return function(K){return!!W[K]}(K)}static RegisterPlugin(K){r(K)}static ImportMesh(K,Y,l,v,U,d,A,c,t){return E(K,Y,l,v,U,d,A,c,t)}static ImportMeshAsync(K,Y,l,v,U,d,A){return function(K,Y,l,v,U,d,A,c){return new Promise(((t,Z)=>{E(K,Y,l,v,((K,Y,l,v,U,d,A,c)=>{t({meshes:K,qi:Y,skeletons:l,animationGroups:v,transformNodes:U,geometries:d,lights:A,spriteManagers:c})}),U,((K,Y,l)=>{Z(l||new Error(Y))}),d,A,c)}))}(K,Y,l,v,U,d,A)}static Load(K,Y,l,v,U,d,A,c){return y(K,Y,l,v,U,d,A,c)}static LoadAsync(K,Y,l,v,U,d){return T(K,Y,l,v,U,d)}static Append(K,Y,l,v,U,d,A,c){return e(K,Y,l,v,U,d,A,c)}static AppendAsync(K,Y,l,v,U,d){return i(K,Y,l,v,U,d)}static LoadAssetContainer(K,Y,l,v,U,d,A,c){return D(K,Y,l,v,U,d,A,c)}static LoadAssetContainerAsync(K,Y,l,v,U,d){return B(K,Y,l,v,U,d)}static ImportAnimations(K,Y,l,v,U,d,A,c,t,Z,m){P(K,Y,l,v,U,d,A,c,t,Z,m)}static ImportAnimationsAsync(K,Y,l,v,U,d,A,c,t,Z,m){return G(K,Y,l,v,U,d,c,Z,m)}}Q.NO_LOGGING=0,Q.MINIMAL_LOGGING=1,Q.SUMMARY_LOGGING=2,Q.DETAILED_LOGGING=3,Q.OnPluginActivatedObservable=o},12473:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>a});var v=l(646),U=l(652),d=l(492),A=l(668),c=l(12469),t=l(2366),Z=l(675),m=l(730),V=l(11872),M=l(11897);class u extends V.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class o extends M.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRBRDF",90,new u,Y),this._useEnergyConservation=o.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=o.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=o.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=o.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=o.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=o.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=o.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=o.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=K._dirtyCallbacks[16],this._enable(!0)}prepareDefines(K){K.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,K.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,K.SPHERICAL_HARMONICS=this._useSphericalHarmonics,K.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}o.DEFAULT_USE_ENERGY_CONSERVATION=!0,o.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,o.DEFAULT_USE_SPHERICAL_HARMONICS=!0,o.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsMiscDirty")],o.prototype,"useEnergyConservation",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsMiscDirty")],o.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsMiscDirty")],o.prototype,"useSphericalHarmonics",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsMiscDirty")],o.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var W=l(11865),g=l(706),J=l(2375),n=l(835),R=l(11876),H=l(2299),z=l(11878),r=(l(2438),l(11884)),E=l(837);class y extends V.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class T extends M.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRClearCoat",100,new y,Y),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.roughness=0,this._indexOfRefraction=T._DefaultIndexOfRefraction,this.indexOfRefraction=T._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=g.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,Y,l){if(!this._isEnabled)return!0;const v=this._material._disableBumpMap;if(K._areTexturesDirty&&Y.texturesEnabled){if(this._texture&&z.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&z.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(l.getCaps().standardDerivatives&&this._bumpTexture&&z.e.ClearCoatBumpTextureEnabled&&!v&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&z.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,Y){this._isEnabled?(K.CLEARCOAT=!0,K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,K.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,K._areTexturesDirty&&Y.texturesEnabled&&(this._texture&&z.e.ClearCoatTextureEnabled?(0,E.V)(this._texture,K,"CLEARCOAT_TEXTURE"):K.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&z.e.ClearCoatTextureEnabled?(0,E.V)(this._textureRoughness,K,"CLEARCOAT_TEXTURE_ROUGHNESS"):K.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&z.e.ClearCoatBumpTextureEnabled?(0,E.V)(this._bumpTexture,K,"CLEARCOAT_BUMP"):K.CLEARCOAT_BUMP=!1,K.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===T._DefaultIndexOfRefraction,this._isTintEnabled?(K.CLEARCOAT_TINT=!0,this._tintTexture&&z.e.ClearCoatTintTextureEnabled?((0,E.V)(this._tintTexture,K,"CLEARCOAT_TINT_TEXTURE"),K.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):K.CLEARCOAT_TINT_TEXTURE=!1):(K.CLEARCOAT_TINT=!1,K.CLEARCOAT_TINT_TEXTURE=!1))):(K.CLEARCOAT=!1,K.CLEARCOAT_TEXTURE=!1,K.CLEARCOAT_TEXTURE_ROUGHNESS=!1,K.CLEARCOAT_BUMP=!1,K.CLEARCOAT_TINT=!1,K.CLEARCOAT_TINT_TEXTURE=!1,K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,K.CLEARCOAT_DEFAULTIOR=!1,K.CLEARCOAT_TEXTUREDIRECTUV=0,K.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,K.CLEARCOAT_BUMPDIRECTUV=0,K.CLEARCOAT_REMAP_F0=!1,K.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,K.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(K,Y,l,v){if(!this._isEnabled)return;const U=v.materialDefines,d=this._material.isFrozen,A=this._material._disableBumpMap,c=this._material._invertNormalMapX,t=this._material._invertNormalMapY;if(!K.useUbo||!d||!K.isSync){var Z,m,V,M;if((this._texture||this._textureRoughness)&&z.e.ClearCoatTextureEnabled)K.updateFloat4("vClearCoatInfos",(null===(Z=this._texture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(m=this._texture)||void 0===m?void 0:m.level)??0,(null===(V=this._textureRoughness)||void 0===V?void 0:V.coordinatesIndex)??0,(null===(M=this._textureRoughness)||void 0===M?void 0:M.level)??0),this._texture&&(0,E.t)(this._texture,K,"clearCoat"),this._textureRoughness&&!U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,E.t)(this._textureRoughness,K,"clearCoatRoughness");this._bumpTexture&&l.getCaps().standardDerivatives&&z.e.ClearCoatTextureEnabled&&!A&&(K.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,E.t)(this._bumpTexture,K,"clearCoatBump"),Y._mirroredCameraPosition?K.updateFloat2("vClearCoatTangentSpaceParams",c?1:-1,t?1:-1):K.updateFloat2("vClearCoatTangentSpaceParams",c?-1:1,t?-1:1)),this._tintTexture&&z.e.ClearCoatTintTextureEnabled&&(K.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,E.t)(this._tintTexture,K,"clearCoatTint")),K.updateFloat2("vClearCoatParams",this.Kl,this.roughness);const v=1-this._indexOfRefraction,d=1+this._indexOfRefraction,u=Math.pow(-v/d,2),o=1/this._indexOfRefraction;K.updateFloat4("vClearCoatRefractionParams",u,o,v,d),this._isTintEnabled&&(K.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),K.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}Y.texturesEnabled&&(this._texture&&z.e.ClearCoatTextureEnabled&&K.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!U.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&z.e.ClearCoatTextureEnabled&&K.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&l.getCaps().standardDerivatives&&z.e.ClearCoatBumpTextureEnabled&&!A&&K.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&z.e.ClearCoatTintTextureEnabled&&K.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(K){return this._texture===K||(this._textureRoughness===K||(this._bumpTexture===K||this._tintTexture===K))}getActiveTextures(K){this._texture&&K.push(this._texture),this._textureRoughness&&K.push(this._textureRoughness),this._bumpTexture&&K.push(this._bumpTexture),this._tintTexture&&K.push(this._tintTexture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&K.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&K.push(this._tintTexture)}dispose(K){var Y,l,v,U;K&&(null===(Y=this._texture)||void 0===Y||Y.dispose(),null===(l=this._textureRoughness)||void 0===l||l.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(U=this._tintTexture)||void 0===U||U.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(K,Y,l){return K.CLEARCOAT_BUMP&&Y.addFallback(l++,"CLEARCOAT_BUMP"),K.CLEARCOAT_TINT&&Y.addFallback(l++,"CLEARCOAT_TINT"),K.CLEARCOAT&&Y.addFallback(l++,"CLEARCOAT"),l}getSamplers(K){K.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}T._DefaultIndexOfRefraction=1.5,(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isEnabled",void 0),(0,v.d)([(0,U.J)()],T.prototype,"intensity",void 0),(0,v.d)([(0,U.J)()],T.prototype,"roughness",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"indexOfRefraction",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"texture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMainTexture",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"textureRoughness",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"remapF0OnInterfaceChange",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"bumpTexture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"isTintEnabled",void 0),(0,v.d)([(0,U.l)()],T.prototype,"tintColor",void 0),(0,v.d)([(0,U.J)()],T.prototype,"tintColorAtDistance",void 0),(0,v.d)([(0,U.J)()],T.prototype,"tintThickness",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"tintTexture",void 0);class e extends V.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class i extends M.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRIridescence",110,new e,Y),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.minimumThickness=i._DefaultMinimumThickness,this.maximumThickness=i._DefaultMaximumThickness,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,Y){if(!this._isEnabled)return!0;if(K._areTexturesDirty&&Y.texturesEnabled){if(this._texture&&z.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&z.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,Y){this._isEnabled?(K.IRIDESCENCE=!0,K._areTexturesDirty&&Y.texturesEnabled&&(this._texture&&z.e.IridescenceTextureEnabled?(0,E.V)(this._texture,K,"IRIDESCENCE_TEXTURE"):K.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&z.e.IridescenceTextureEnabled?(0,E.V)(this._thicknessTexture,K,"IRIDESCENCE_THICKNESS_TEXTURE"):K.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(K.IRIDESCENCE=!1,K.IRIDESCENCE_TEXTURE=!1,K.IRIDESCENCE_THICKNESS_TEXTURE=!1,K.IRIDESCENCE_TEXTUREDIRECTUV=0,K.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(K,Y){if(!this._isEnabled)return;const l=this._material.isFrozen;if(!K.useUbo||!l||!K.isSync){var v,U,d,A;if((this._texture||this._thicknessTexture)&&z.e.IridescenceTextureEnabled)K.updateFloat4("vIridescenceInfos",(null===(v=this._texture)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(U=this._texture)||void 0===U?void 0:U.level)??0,(null===(d=this._thicknessTexture)||void 0===d?void 0:d.coordinatesIndex)??0,(null===(A=this._thicknessTexture)||void 0===A?void 0:A.level)??0),this._texture&&(0,E.t)(this._texture,K,"iridescence"),this._thicknessTexture&&(0,E.t)(this._thicknessTexture,K,"iridescenceThickness");K.updateFloat4("vIridescenceParams",this.Kl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}Y.texturesEnabled&&(this._texture&&z.e.IridescenceTextureEnabled&&K.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&z.e.IridescenceTextureEnabled&&K.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(K){return this._texture===K||this._thicknessTexture===K}getActiveTextures(K){this._texture&&K.push(this._texture),this._thicknessTexture&&K.push(this._thicknessTexture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&K.push(this._thicknessTexture)}dispose(K){var Y,l;K&&(null===(Y=this._texture)||void 0===Y||Y.dispose(),null===(l=this._thicknessTexture)||void 0===l||l.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(K,Y,l){return K.IRIDESCENCE&&Y.addFallback(l++,"IRIDESCENCE"),l}getSamplers(K){K.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}i._DefaultMinimumThickness=100,i._DefaultMaximumThickness=400,i._DefaultIndexOfRefraction=1.3,(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,v.d)([(0,U.J)()],i.prototype,"intensity",void 0),(0,v.d)([(0,U.J)()],i.prototype,"minimumThickness",void 0),(0,v.d)([(0,U.J)()],i.prototype,"maximumThickness",void 0),(0,v.d)([(0,U.J)()],i.prototype,"indexOfRefraction",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0);class D extends V.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class B extends M.d{set angle(K){this.direction.x=Math.cos(K),this.direction.y=Math.sin(K)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRAnisotropic",110,new D,Y),this._isEnabled=!1,this.isEnabled=!1,this.Kl=1,this.direction=new Z.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=K._dirtyCallbacks[16]}isReadyForSubMesh(K,Y){return!this._isEnabled||!(K._areTexturesDirty&&Y.texturesEnabled&&this._texture&&z.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(K,Y,l){this._isEnabled?(K.ANISOTROPIC=this._isEnabled,this._isEnabled&&!l.isVerticesDataPresent(m.e.TangentKind)&&(K._needUVs=!0,K.MAINUV1=!0),K._areTexturesDirty&&Y.texturesEnabled&&(this._texture&&z.e.AnisotropicTextureEnabled?(0,E.V)(this._texture,K,"ANISOTROPIC_TEXTURE"):K.ANISOTROPIC_TEXTURE=!1),K._areMiscDirty&&(K.ANISOTROPIC_LEGACY=this._legacy)):(K.ANISOTROPIC=!1,K.ANISOTROPIC_TEXTURE=!1,K.ANISOTROPIC_TEXTUREDIRECTUV=0,K.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(K,Y){if(!this._isEnabled)return;const l=this._material.isFrozen;K.useUbo&&l&&K.isSync||(this._texture&&z.e.AnisotropicTextureEnabled&&(K.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,E.t)(this._texture,K,"anisotropy")),K.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Kl)),Y.texturesEnabled&&this._texture&&z.e.AnisotropicTextureEnabled&&K.setTexture("anisotropySampler",this._texture)}hasTexture(K){return this._texture===K}getActiveTextures(K){this._texture&&K.push(this._texture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture)}dispose(K){K&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(K,Y,l){return K.ANISOTROPIC&&Y.addFallback(l++,"ANISOTROPIC"),l}getSamplers(K){K.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(K,Y,l){super.parse(K,Y,l),void 0===K.legacy&&(this.legacy=!0)}}(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"isEnabled",void 0),(0,v.d)([(0,U.J)()],B.prototype,"intensity",void 0),(0,v.d)([(0,U.E)()],B.prototype,"direction",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],B.prototype,"texture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsMiscDirty")],B.prototype,"legacy",void 0);class P extends V.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class G extends M.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"Sheen",120,new P,Y),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Kl=1,this.color=g.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,Y){if(!this._isEnabled)return!0;if(K._areTexturesDirty&&Y.texturesEnabled){if(this._texture&&z.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&z.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,Y){this._isEnabled?(K.SHEEN=!0,K.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,K.SHEEN_ROUGHNESS=null!==this._roughness,K.SHEEN_ALBEDOSCALING=this._albedoScaling,K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,K._areTexturesDirty&&Y.texturesEnabled&&(this._texture&&z.e.SheenTextureEnabled?((0,E.V)(this._texture,K,"SHEEN_TEXTURE"),K.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):K.SHEEN_TEXTURE=!1,this._textureRoughness&&z.e.SheenTextureEnabled?(0,E.V)(this._textureRoughness,K,"SHEEN_TEXTURE_ROUGHNESS"):K.SHEEN_TEXTURE_ROUGHNESS=!1)):(K.SHEEN=!1,K.SHEEN_TEXTURE=!1,K.SHEEN_TEXTURE_ROUGHNESS=!1,K.SHEEN_LINKWITHALBEDO=!1,K.SHEEN_ROUGHNESS=!1,K.SHEEN_ALBEDOSCALING=!1,K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,K.SHEEN_GAMMATEXTURE=!1,K.SHEEN_TEXTUREDIRECTUV=0,K.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(K,Y,l,v){if(!this._isEnabled)return;const U=v.materialDefines,d=this._material.isFrozen;if(!K.useUbo||!d||!K.isSync){var A,c,t,Z;if((this._texture||this._textureRoughness)&&z.e.SheenTextureEnabled)K.updateFloat4("vSheenInfos",(null===(A=this._texture)||void 0===A?void 0:A.coordinatesIndex)??0,(null===(c=this._texture)||void 0===c?void 0:c.level)??0,(null===(t=this._textureRoughness)||void 0===t?void 0:t.coordinatesIndex)??0,(null===(Z=this._textureRoughness)||void 0===Z?void 0:Z.level)??0),this._texture&&(0,E.t)(this._texture,K,"sheen"),this._textureRoughness&&!U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,E.t)(this._textureRoughness,K,"sheenRoughness");K.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Kl),null!==this._roughness&&K.updateFloat("vSheenRoughness",this._roughness)}Y.texturesEnabled&&(this._texture&&z.e.SheenTextureEnabled&&K.setTexture("sheenSampler",this._texture),this._textureRoughness&&!U.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&z.e.SheenTextureEnabled&&K.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(K){return this._texture===K||this._textureRoughness===K}getActiveTextures(K){this._texture&&K.push(this._texture),this._textureRoughness&&K.push(this._textureRoughness)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&K.push(this._textureRoughness)}dispose(K){var Y,l;K&&(null===(Y=this._texture)||void 0===Y||Y.dispose(),null===(l=this._textureRoughness)||void 0===l||l.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(K,Y,l){return K.SHEEN&&Y.addFallback(l++,"SHEEN"),l}getSamplers(K){K.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"linkSheenWithAlbedo",void 0),(0,v.d)([(0,U.J)()],G.prototype,"intensity",void 0),(0,v.d)([(0,U.l)()],G.prototype,"color",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useRoughnessFromMainTexture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"roughness",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"textureRoughness",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"albedoScaling",void 0);class Q extends V.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class X extends M.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(K){this._scene.enableSubSurfaceForPrePass()&&K&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(K))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(K){this._volumeIndexOfRefraction=K>=1?K:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRSubSurface",130,new Q,Y),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=g.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=g.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=K.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=K._dirtyCallbacks[32]}isReadyForSubMesh(K,Y){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(K._areTexturesDirty&&Y.texturesEnabled){if(this._thicknessTexture&&z.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&z.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&z.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const K=this._getRefractionTexture(Y);if(K&&z.e.RefractionTextureEnabled&&!K.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,Y){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return K.SUBSURFACE=!1,K.SS_DISPERSION=!1,K.SS_TRANSLUCENCY=!1,K.SS_SCATTERING=!1,K.SS_REFRACTION=!1,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_THICKNESSANDMASK_TEXTURE=!1,K.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,K.SS_HAS_THICKNESS=!1,K.SS_REFRACTIONINTENSITY_TEXTURE=!1,K.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,K.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,K.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,K.SS_REFRACTIONMAP_3D=!1,K.SS_REFRACTIONMAP_OPPOSITEZ=!1,K.SS_LODINREFRACTIONALPHA=!1,K.SS_GAMMAREFRACTION=!1,K.SS_RGBDREFRACTION=!1,K.SS_LINEARSPECULARREFRACTION=!1,K.SS_LINKREFRACTIONTOTRANSPARENCY=!1,K.SS_ALBEDOFORREFRACTIONTINT=!1,K.SS_ALBEDOFORTRANSLUCENCYTINT=!1,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,K.SS_USE_THICKNESS_AS_DEPTH=!1,K.SS_USE_GLTF_TEXTURES=!1,K.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(K.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(K._areTexturesDirty){if(K.SUBSURFACE=!0,K.SS_DISPERSION=this._isDispersionEnabled,K.SS_TRANSLUCENCY=this._isTranslucencyEnabled,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_SCATTERING=this._isScatteringEnabled,K.SS_THICKNESSANDMASK_TEXTURE=!1,K.SS_REFRACTIONINTENSITY_TEXTURE=!1,K.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,K.SS_HAS_THICKNESS=!1,K.SS_USE_GLTF_TEXTURES=!1,K.SS_REFRACTION=!1,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_REFRACTIONMAP_3D=!1,K.SS_GAMMAREFRACTION=!1,K.SS_RGBDREFRACTION=!1,K.SS_LINEARSPECULARREFRACTION=!1,K.SS_REFRACTIONMAP_OPPOSITEZ=!1,K.SS_LODINREFRACTIONALPHA=!1,K.SS_LINKREFRACTIONTOTRANSPARENCY=!1,K.SS_ALBEDOFORREFRACTIONTINT=!1,K.SS_ALBEDOFORTRANSLUCENCYTINT=!1,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,K.SS_USE_THICKNESS_AS_DEPTH=!1,K.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,K._areTexturesDirty&&Y.texturesEnabled&&(this._thicknessTexture&&z.e.ThicknessTextureEnabled&&(0,E.V)(this._thicknessTexture,K,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&z.e.RefractionIntensityTextureEnabled&&(0,E.V)(this._refractionIntensityTexture,K,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&z.e.TranslucencyIntensityTextureEnabled&&(0,E.V)(this._translucencyIntensityTexture,K,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&z.e.TranslucencyColorTextureEnabled&&(0,E.V)(this._translucencyColorTexture,K,"SS_TRANSLUCENCYCOLOR_TEXTURE")),K.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,K.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&Y.texturesEnabled){const l=this._getRefractionTexture(Y);l&&z.e.RefractionTextureEnabled&&(K.SS_REFRACTION=!0,K.SS_REFRACTIONMAP_3D=l.isCube,K.SS_GAMMAREFRACTION=l.gammaSpace,K.SS_RGBDREFRACTION=l.isRGBD,K.SS_LINEARSPECULARREFRACTION=l.linearSpecularLOD,K.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&l.isCube?!l.invertZ:l.invertZ,K.SS_LODINREFRACTIONALPHA=l.lodLevelInAlpha,K.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,K.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=l.isCube&&l.boundingBoxSize,K.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(K.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(K,Y,l,v){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)K.updateFloat2("vThicknessParam",0,0);else{v.getRenderingMesh().getWorldMatrix().decompose(Z.j.Qi[0]);const Y=Math.max(Math.abs(Z.j.Qi[0].x),Math.abs(Z.j.Qi[0].y),Math.abs(Z.j.Qi[0].z));K.updateFloat2("vThicknessParam",this.minimumThickness*Y,(this.maximumThickness-this.minimumThickness)*Y)}}bindForSubMesh(K,Y,l,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const U=v.materialDefines,d=this._material.isFrozen,A=this._material.realTimeFiltering,c=U.LODBASEDMICROSFURACE,t=this._getRefractionTexture(Y);if(!K.useUbo||!d||!K.isSync){if(this._thicknessTexture&&z.e.ThicknessTextureEnabled&&(K.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,E.t)(this._thicknessTexture,K,"thickness")),this._refractionIntensityTexture&&z.e.RefractionIntensityTextureEnabled&&U.SS_REFRACTIONINTENSITY_TEXTURE&&(K.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,E.t)(this._refractionIntensityTexture,K,"refractionIntensity")),this._translucencyColorTexture&&z.e.TranslucencyColorTextureEnabled&&U.SS_TRANSLUCENCYCOLOR_TEXTURE&&(K.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,E.t)(this._translucencyColorTexture,K,"translucencyColor")),this._translucencyIntensityTexture&&z.e.TranslucencyIntensityTextureEnabled&&U.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(K.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,E.t)(this._translucencyIntensityTexture,K,"translucencyIntensity")),t&&z.e.RefractionTextureEnabled){K.Xi("refractionMatrix",t.getRefractionTextureMatrix());let Y=1;t.isCube||t.depth&&(Y=t.depth);const l=t.getSize().width,v=this.volumeIndexOfRefraction;if(K.updateFloat4("vRefractionInfos",t.level,1/v,Y,this._invertRefractionY?-1:1),K.updateFloat4("vRefractionMicrosurfaceInfos",l,t.lodGenerationScale,t.lodGenerationOffset,1/this.indexOfRefraction),A&&K.updateFloat2("vRefractionFilteringInfo",l,Math.log2(l)),t.boundingBoxSize){const Y=t;K.updateVector3("vRefractionPosition",Y.boundingBoxPosition),K.updateVector3("vRefractionSize",Y.boundingBoxSize)}}this._isScatteringEnabled&&K.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),K.updateColor3("vDiffusionDistance",this.diffusionDistance),K.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),K.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),K.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),K.updateFloat("dispersion",this.dispersion)}Y.texturesEnabled&&(this._thicknessTexture&&z.e.ThicknessTextureEnabled&&K.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&z.e.RefractionIntensityTextureEnabled&&U.SS_REFRACTIONINTENSITY_TEXTURE&&K.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&z.e.TranslucencyIntensityTextureEnabled&&U.SS_TRANSLUCENCYINTENSITY_TEXTURE&&K.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&z.e.TranslucencyColorTextureEnabled&&U.SS_TRANSLUCENCYCOLOR_TEXTURE&&K.setTexture("translucencyColorSampler",this._translucencyColorTexture),t&&z.e.RefractionTextureEnabled&&(c?K.setTexture("refractionSampler",t):(K.setTexture("refractionSampler",t._lodTextureMid||t),K.setTexture("refractionSamplerLow",t._lodTextureLow||t),K.setTexture("refractionSamplerHigh",t._lodTextureHigh||t))))}_getRefractionTexture(K){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?K.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(K){z.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&K.push(this._refractionTexture)}hasTexture(K){return this._thicknessTexture===K||(this._refractionTexture===K||(this._refractionIntensityTexture===K||(this._translucencyIntensityTexture===K||this._translucencyColorTexture===K)))}hasRenderTargetTextures(){return!!(z.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(K){this._thicknessTexture&&K.push(this._thicknessTexture),this._refractionTexture&&K.push(this._refractionTexture),this._translucencyColorTexture&&K.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&K.push(this._translucencyIntensityTexture)}getAnimatables(K){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&K.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&K.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&K.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&K.push(this._translucencyIntensityTexture)}dispose(K){K&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(K,Y,l){return K.SS_SCATTERING&&Y.addFallback(l++,"SS_SCATTERING"),K.SS_TRANSLUCENCY&&Y.addFallback(l++,"SS_TRANSLUCENCY"),l}getSamplers(K){K.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isRefractionEnabled",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isTranslucencyEnabled",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isDispersionEnabled",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markScenePrePassDirty")],X.prototype,"isScatteringEnabled",void 0),(0,v.d)([(0,U.J)()],X.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,v.d)([(0,U.J)()],X.prototype,"refractionIntensity",void 0),(0,v.d)([(0,U.J)()],X.prototype,"translucencyIntensity",void 0),(0,v.d)([(0,U.J)()],X.prototype,"useAlbedoToTintRefraction",void 0),(0,v.d)([(0,U.J)()],X.prototype,"useAlbedoToTintTranslucency",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"thicknessTexture",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"refractionTexture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"indexOfRefraction",void 0),(0,v.d)([(0,U.J)()],X.prototype,"_volumeIndexOfRefraction",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"volumeIndexOfRefraction",null),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"invertRefractionY",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"linkRefractionWithTransparency",void 0),(0,v.d)([(0,U.J)()],X.prototype,"minimumThickness",void 0),(0,v.d)([(0,U.J)()],X.prototype,"maximumThickness",void 0),(0,v.d)([(0,U.J)()],X.prototype,"useThicknessAsDepth",void 0),(0,v.d)([(0,U.l)()],X.prototype,"tintColor",void 0),(0,v.d)([(0,U.J)()],X.prototype,"tintColorAtDistance",void 0),(0,v.d)([(0,U.J)()],X.prototype,"dispersion",void 0),(0,v.d)([(0,U.l)()],X.prototype,"diffusionDistance",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useMaskFromThicknessTexture",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"refractionIntensityTexture",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"translucencyIntensityTexture",void 0),(0,v.d)([(0,U.l)()],X.prototype,"translucencyColor",void 0),(0,v.d)([(0,U.C)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"translucencyColorTexture",void 0),(0,v.d)([(0,U.J)(),(0,U.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"useGltfStyleTextures",void 0);var f=l(11891),w=l(853),k=l(11900);const I={effect:null,subMesh:null};class L extends V.c{constructor(K){super(K),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class a extends R.e{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(K){this._realTimeFiltering=K,this.Mi(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(K){this._realTimeFilteringQuality=K,this.Mi(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=K||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(K,Y){super(K,Y,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||a.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Z.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=g.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new g.e(0,0,0),this._albedoColor=new g.e(1,1,1),this._reflectivityColor=new g.e(1,1,1),this._reflectionColor=new g.e(1,1,1),this._emissiveColor=new g.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=a.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new A.c(16),this._globalAmbientColor=new g.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new o(this),this.clearCoat=new T(this),this.iridescence=new i(this),this.anisotropy=new B(this),this.sheen=new G(this),this.subSurface=new X(this),this.detailMap=new f.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),z.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,c.d)(this.va()),this.prePassConfiguration=new W.d}get hasRenderTargetTextures(){return!!(z.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var K;return this._transparencyMode===a.PBRMATERIAL_OPAQUE||this._transparencyMode===a.PBRMATERIAL_ALPHATEST||(null===(K=this.subSurface)||void 0===K?void 0:K.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var K;return!!this._forceAlphaTest||(null===(K=this.subSurface)||void 0===K||!K.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===a.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Cj&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==a.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Cj||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(K,Y,l){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const v=Y._drawWrapper;if(v.effect&&this.isFrozen&&v._wasPreviouslyReady&&v._wasPreviouslyUsingInstances===l)return!0;Y.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Y.materialDefines=new L(this._eventInfo.defineNames));const U=Y.materialDefines;if(this._isReadyForSubMesh(Y))return!0;const A=this.va(),c=A.getEngine();if(U._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,A.texturesEnabled)){if(this._albedoTexture&&z.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&z.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&z.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const K=this._getReflectionTexture();if(K&&z.e.ReflectionTextureEnabled){if(!K.isReadyOrNotBlocking())return!1;var t;if(K.irradianceTexture){if(!K.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!K.sphericalPolynomial&&null!==(t=K.getInternalTexture())&&void 0!==t&&t._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&z.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&z.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(z.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(c.getCaps().standardDerivatives&&this._bumpTexture&&z.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&z.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=U,this._eventInfo.subMesh=Y,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(U._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;c.getCaps().standardDerivatives||K.isVerticesDataPresent(m.e.NormalKind)||(K.createNormals(!0),d.e.Warn("PBRMaterial: Normals have been created for the mesh: "+K.name));const Z=Y.effect,V=U._areLightsDisposed;let M=this._prepareEffect(K,U,this.onCompiled,this.onError,l,null,Y.getRenderingMesh().hasThinInstances),u=!1;if(M)if(this._onEffectCreatedObservable&&(I.effect=M,I.subMesh=Y,this._onEffectCreatedObservable.notifyObservers(I)),this.allowShaderHotSwapping&&Z&&!M.isReady()){if(M=Z,U.markAsUnprocessed(),u=this.isFrozen,V)return U._areLightsDisposed=!0,!1}else A.resetCachedMaterial(),Y.setEffect(M,U,this._materialContext);return!(!Y.effect||!Y.effect.isReady())&&(U._renderId=A.getRenderId(),v._wasPreviouslyReady=!u,v._wasPreviouslyUsingInstances=!!l,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(K,Y){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(K,Y,d,A,c),!Y.isDirty)return null;Y.markAsProcessed();const t=this.va().getEngine(),Z=new r.e;let V=0;Y.USESPHERICALINVERTEX&&Z.addFallback(V++,"USESPHERICALINVERTEX"),Y.FOG&&Z.addFallback(V,"FOG"),Y.SPECULARAA&&Z.addFallback(V,"SPECULARAA"),Y.POINTSIZE&&Z.addFallback(V,"POINTSIZE"),Y.LOGARITHMICDEPTH&&Z.addFallback(V,"LOGARITHMICDEPTH"),Y.PARALLAX&&Z.addFallback(V,"PARALLAX"),Y.PARALLAX_RHS&&Z.addFallback(V,"PARALLAX_RHS"),Y.PARALLAXOCCLUSION&&Z.addFallback(V++,"PARALLAXOCCLUSION"),Y.ENVIRONMENTBRDF&&Z.addFallback(V++,"ENVIRONMENTBRDF"),Y.TANGENT&&Z.addFallback(V++,"TANGENT"),Y.BUMP&&Z.addFallback(V++,"BUMP"),V=(0,E.v)(Y,Z,this._maxSimultaneousLights,V++),Y.SPECULARTERM&&Z.addFallback(V++,"SPECULARTERM"),Y.USESPHERICALFROMREFLECTIONMAP&&Z.addFallback(V++,"USESPHERICALFROMREFLECTIONMAP"),Y.USEIRRADIANCEMAP&&Z.addFallback(V++,"USEIRRADIANCEMAP"),Y.LIGHTMAP&&Z.addFallback(V++,"LIGHTMAP"),Y.NORMAL&&Z.addFallback(V++,"NORMAL"),Y.AMBIENT&&Z.addFallback(V++,"AMBIENT"),Y.EMISSIVE&&Z.addFallback(V++,"EMISSIVE"),Y.VERTEXCOLOR&&Z.addFallback(V++,"VERTEXCOLOR"),Y.MORPHTARGETS&&Z.addFallback(V++,"MORPHTARGETS"),Y.MULTIVIEW&&Z.addFallback(0,"MULTIVIEW");const M=[m.e.PositionKind];Y.NORMAL&&M.push(m.e.NormalKind),Y.TANGENT&&M.push(m.e.TangentKind);for(let l=1;l<=6;++l)Y["UV"+l]&&M.push(`uv${1===l?"":l}`);Y.VERTEXCOLOR&&M.push(m.e.ColorKind),(0,E.C)(M,K,Y,Z),(0,E.G)(M,Y),(0,E.K)(M,K,Y),(0,E.z)(M,K,Y);let u="pbr";const o=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],g=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],n=["Material","Scene","Mesh"],R={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Y.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Z,this._eventInfo.fallbackRank=V,this._eventInfo.defines=Y,this._eventInfo.uniforms=o,this._eventInfo.attributes=M,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=n,this._eventInfo.customCode=void 0,this._eventInfo.mesh=K,this._eventInfo.indexParameters=R,this._callbackPluginEventGeneric(128,this._eventInfo),k.c.AddUniformsAndSamplers(o,g),W.d.AddUniforms(o),W.d.AddSamplers(g),(0,w.b)(o),J.e&&(J.e.PrepareUniforms(o,Y),J.e.PrepareSamplers(g,Y)),(0,E.cb)({uniformsNames:o,uniformBuffersNames:n,samplers:g,defines:Y,maxSimultaneousLights:this._maxSimultaneousLights});const H={};this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,o,n,g,Y,M,H));const z=Y.toString(),y=t.createEffect(u,{attributes:M,uniformsNames:o,uniformBuffersNames:n,samplers:g,defines:z,fallbacks:Z,onCompiled:v,onError:U,indexParameters:R,processFinalCode:H.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Y.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([l.e(40),l.e(49)]).then(l.bind(l,13441)),Promise.all([l.e(41),l.e(50)]).then(l.bind(l,13452))]):await Promise.all([Promise.all([l.e(44),l.e(51)]).then(l.bind(l,13457)),Promise.all([l.e(46),l.e(52)]).then(l.bind(l,13472))]),this._shadersLoaded=!0}},t);return this._eventInfo.customCode=void 0,y}_prepareDefines(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this.va(),A=d.getEngine();(0,E.S)(d,K,Y,!0,this._maxSimultaneousLights,this._disableLighting),Y._needNormals=!0,(0,E.Y)(d,Y);const c=this.needAlphaBlendingForMesh(K)&&this.va().useOrderIndependentTransparency;if((0,E.bb)(d,Y,this.canRenderToMRT&&!c),(0,E.Z)(d,Y,c),k.c.PrepareDefines(A.currentRenderPassId,K,Y),Y.METALLICWORKFLOW=this.isMetallicWorkflow(),Y._areTexturesDirty){Y._needUVs=!1;for(let K=1;K<=6;++K)Y["MAINUV"+K]=!1;if(d.texturesEnabled){Y.ALBEDODIRECTUV=0,Y.AMBIENTDIRECTUV=0,Y.OPACITYDIRECTUV=0,Y.EMISSIVEDIRECTUV=0,Y.REFLECTIVITYDIRECTUV=0,Y.MICROSURFACEMAPDIRECTUV=0,Y.METALLIC_REFLECTANCEDIRECTUV=0,Y.REFLECTANCEDIRECTUV=0,Y.BUMPDIRECTUV=0,Y.LIGHTMAPDIRECTUV=0,A.getCaps().textureLOD&&(Y.LODBASEDMICROSFURACE=!0),this._albedoTexture&&z.e.DiffuseTextureEnabled?((0,E.V)(this._albedoTexture,Y,"ALBEDO"),Y.GAMMAALBEDO=this._albedoTexture.gammaSpace):Y.ALBEDO=!1,this._ambientTexture&&z.e.AmbientTextureEnabled?((0,E.V)(this._ambientTexture,Y,"AMBIENT"),Y.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):Y.AMBIENT=!1,this._opacityTexture&&z.e.OpacityTextureEnabled?((0,E.V)(this._opacityTexture,Y,"OPACITY"),Y.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):Y.OPACITY=!1;const K=this._getReflectionTexture();if(K&&z.e.ReflectionTextureEnabled){switch(Y.REFLECTION=!0,Y.GAMMAREFLECTION=K.gammaSpace,Y.RGBDREFLECTION=K.isRGBD,Y.LODINREFLECTIONALPHA=K.lodLevelInAlpha,Y.LINEARSPECULARREFLECTION=K.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(Y.NUM_SAMPLES=""+this.realTimeFilteringQuality,A._features.needTypeSuffixInShaderConstants&&(Y.NUM_SAMPLES=Y.NUM_SAMPLES+"u"),Y.REALTIME_FILTERING=!0):Y.REALTIME_FILTERING=!1,Y.INVERTCUBICMAP=K.coordinatesMode===H.c.INVCUBIC_MODE,Y.REFLECTIONMAP_3D=K.isCube,Y.REFLECTIONMAP_OPPOSITEZ=Y.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!K.invertZ:K.invertZ,Y.REFLECTIONMAP_CUBIC=!1,Y.REFLECTIONMAP_EXPLICIT=!1,Y.REFLECTIONMAP_PLANAR=!1,Y.REFLECTIONMAP_PROJECTION=!1,Y.REFLECTIONMAP_SKYBOX=!1,Y.REFLECTIONMAP_SPHERICAL=!1,Y.REFLECTIONMAP_EQUIRECTANGULAR=!1,Y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,K.coordinatesMode){case H.c.EXPLICIT_MODE:Y.REFLECTIONMAP_EXPLICIT=!0;break;case H.c.PLANAR_MODE:Y.REFLECTIONMAP_PLANAR=!0;break;case H.c.PROJECTION_MODE:Y.REFLECTIONMAP_PROJECTION=!0;break;case H.c.SKYBOX_MODE:Y.REFLECTIONMAP_SKYBOX=!0;break;case H.c.SPHERICAL_MODE:Y.REFLECTIONMAP_SPHERICAL=!0;break;case H.c.EQUIRECTANGULAR_MODE:Y.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case H.c.FIXED_EQUIRECTANGULAR_MODE:Y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case H.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case H.c.CUBIC_MODE:case H.c.INVCUBIC_MODE:default:Y.REFLECTIONMAP_CUBIC=!0,Y.USE_LOCAL_REFLECTIONMAP_CUBIC=!!K.boundingBoxSize}K.coordinatesMode!==H.c.SKYBOX_MODE&&(K.irradianceTexture?(Y.USEIRRADIANCEMAP=!0,Y.USESPHERICALFROMREFLECTIONMAP=!1):K.isCube&&(Y.USESPHERICALFROMREFLECTIONMAP=!0,Y.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||A.getCaps().maxVaryingVectors<=8?Y.USESPHERICALINVERTEX=!1:Y.USESPHERICALINVERTEX=!0))}else Y.REFLECTION=!1,Y.REFLECTIONMAP_3D=!1,Y.REFLECTIONMAP_SPHERICAL=!1,Y.REFLECTIONMAP_PLANAR=!1,Y.REFLECTIONMAP_CUBIC=!1,Y.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Y.REFLECTIONMAP_PROJECTION=!1,Y.REFLECTIONMAP_SKYBOX=!1,Y.REFLECTIONMAP_EXPLICIT=!1,Y.REFLECTIONMAP_EQUIRECTANGULAR=!1,Y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Y.INVERTCUBICMAP=!1,Y.USESPHERICALFROMREFLECTIONMAP=!1,Y.USEIRRADIANCEMAP=!1,Y.USESPHERICALINVERTEX=!1,Y.REFLECTIONMAP_OPPOSITEZ=!1,Y.LODINREFLECTIONALPHA=!1,Y.GAMMAREFLECTION=!1,Y.RGBDREFLECTION=!1,Y.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&z.e.LightmapTextureEnabled?((0,E.V)(this._lightmapTexture,Y,"LIGHTMAP"),Y.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Y.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,Y.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):Y.LIGHTMAP=!1,this._emissiveTexture&&z.e.EmissiveTextureEnabled?((0,E.V)(this._emissiveTexture,Y,"EMISSIVE"),Y.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):Y.EMISSIVE=!1,z.e.SpecularTextureEnabled?(this._metallicTexture?((0,E.V)(this._metallicTexture,Y,"REFLECTIVITY"),Y.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,Y.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,Y.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,Y.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,Y.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,E.V)(this._reflectivityTexture,Y,"REFLECTIVITY"),Y.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,Y.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,Y.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):Y.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(Y.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,E.V)(this._metallicReflectanceTexture,Y,"METALLIC_REFLECTANCE"),Y.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):Y.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,E.V)(this._reflectanceTexture,Y,"REFLECTANCE"),Y.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):Y.REFLECTANCE=!1):(Y.METALLIC_REFLECTANCE=!1,Y.REFLECTANCE=!1),this._microSurfaceTexture?(0,E.V)(this._microSurfaceTexture,Y,"MICROSURFACEMAP"):Y.MICROSURFACEMAP=!1):(Y.REFLECTIVITY=!1,Y.MICROSURFACEMAP=!1),A.getCaps().standardDerivatives&&this._bumpTexture&&z.e.BumpTextureEnabled&&!this._disableBumpMap?((0,E.V)(this._bumpTexture,Y,"BUMP"),this._useParallax&&this._albedoTexture&&z.e.DiffuseTextureEnabled?(Y.PARALLAX=!0,Y.PARALLAX_RHS=d.useRightHandedSystem,Y.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):Y.PARALLAX=!1,Y.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(Y.BUMP=!1,Y.PARALLAX=!1,Y.PARALLAX_RHS=!1,Y.PARALLAXOCCLUSION=!1,Y.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&z.e.ReflectionTextureEnabled?(Y.ENVIRONMENTBRDF=!0,Y.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(Y.ENVIRONMENTBRDF=!1,Y.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?Y.ALPHAFROMALBEDO=!0:Y.ALPHAFROMALBEDO=!1}Y.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===a.LIGHTFALLOFF_STANDARD?(Y.USEPHYSICALLIGHTFALLOFF=!1,Y.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===a.LIGHTFALLOFF_GLTF?(Y.USEPHYSICALLIGHTFALLOFF=!1,Y.USEGLTFLIGHTFALLOFF=!0):(Y.USEPHYSICALLIGHTFALLOFF=!0,Y.USEGLTFLIGHTFALLOFF=!1),Y.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.xi&&this._twoSidedLighting?Y.TWOSIDEDLIGHTING=!0:Y.TWOSIDEDLIGHTING=!1,Y.SPECULARAA=A.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(Y._areTexturesDirty||Y._areMiscDirty)&&(Y.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,Y.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Y.ALPHABLEND=this.needAlphaBlendingForMesh(K),Y.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,Y.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),Y._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(Y),Y.FORCENORMALFORWARD=this._forceNormalForward,Y.RADIANCEOCCLUSION=this._useRadianceOcclusion,Y.HORIZONOCCLUSION=this._useHorizonOcclusion,Y._areMiscDirty&&((0,E.X)(K,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(K)||this._forceAlphaTest,Y,this._applyDecalMapAfterDetailMap),Y.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!K.isVerticesDataPresent(m.e.NormalKind),Y.DEBUGMODE=this._debugMode),(0,E.R)(d,A,this,Y,!!l,v,U),this._eventInfo.defines=Y,this._eventInfo.mesh=K,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,E.N)(K,Y,!0,!0,!0,this._transparencyMode!==a.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(K,Y,l){const v={clipPlane:!1,useInstances:!1,...l};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const l=new L(this._eventInfo.defineNames),U=this._prepareEffect(K,l,void 0,void 0,v.useInstances,v.clipPlane,K.hasThinInstances);this._onEffectCreatedObservable&&(I.effect=U,I.subMesh=null,this._onEffectCreatedObservable.notifyObservers(I)),U.isReady()?Y&&Y(this):U.onCompileObservable.add((()=>{Y&&Y(this)}))})()}buildUniformLayout(){const K=this._uniformBuffer;K.addUniform("vAlbedoInfos",2),K.addUniform("vAmbientInfos",4),K.addUniform("vOpacityInfos",2),K.addUniform("vEmissiveInfos",2),K.addUniform("vLightmapInfos",2),K.addUniform("vReflectivityInfos",3),K.addUniform("vMicroSurfaceSamplerInfos",2),K.addUniform("vReflectionInfos",2),K.addUniform("vReflectionFilteringInfo",2),K.addUniform("vReflectionPosition",3),K.addUniform("vReflectionSize",3),K.addUniform("vBumpInfos",3),K.addUniform("albedoMatrix",16),K.addUniform("ambientMatrix",16),K.addUniform("opacityMatrix",16),K.addUniform("emissiveMatrix",16),K.addUniform("lightmapMatrix",16),K.addUniform("reflectivityMatrix",16),K.addUniform("microSurfaceSamplerMatrix",16),K.addUniform("bumpMatrix",16),K.addUniform("vTangentSpaceParams",2),K.addUniform("reflectionMatrix",16),K.addUniform("vReflectionColor",3),K.addUniform("vAlbedoColor",4),K.addUniform("vLightingIntensity",4),K.addUniform("vReflectionMicrosurfaceInfos",3),K.addUniform("pointSize",1),K.addUniform("vReflectivityColor",4),K.addUniform("vEmissiveColor",3),K.addUniform("vAmbientColor",3),K.addUniform("vDebugMode",2),K.addUniform("vMetallicReflectanceFactors",4),K.addUniform("vMetallicReflectanceInfos",2),K.addUniform("metallicReflectanceMatrix",16),K.addUniform("vReflectanceInfos",2),K.addUniform("reflectanceMatrix",16),K.addUniform("vSphericalL00",3),K.addUniform("vSphericalL1_1",3),K.addUniform("vSphericalL10",3),K.addUniform("vSphericalL11",3),K.addUniform("vSphericalL2_2",3),K.addUniform("vSphericalL2_1",3),K.addUniform("vSphericalL20",3),K.addUniform("vSphericalL21",3),K.addUniform("vSphericalL22",3),K.addUniform("vSphericalX",3),K.addUniform("vSphericalY",3),K.addUniform("vSphericalZ",3),K.addUniform("vSphericalXX_ZZ",3),K.addUniform("vSphericalYY_ZZ",3),K.addUniform("vSphericalZZ",3),K.addUniform("vSphericalXY",3),K.addUniform("vSphericalYZ",3),K.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(K,Y,l){const v=this.va(),U=l.materialDefines;if(!U)return;const d=l.effect;if(!d)return;this._activeEffect=d,Y.getMeshUniformBuffer().bindToEffect(d,"Mesh"),Y.transferToEffect(K);const A=v.getEngine();this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,v,Y,K,this.isFrozen),k.c.Bind(A.currentRenderPassId,this._activeEffect,Y,K),this._eventInfo.subMesh=l,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),U.OBJECTSPACE_NORMALMAP&&(K.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const c=this._mustRebind(v,d,l,Y.visibility);(0,E.b)(Y,this._activeEffect,this.prePassConfiguration);let Z=null;const m=this._uniformBuffer;if(c){if(this.bindViewProjection(d),Z=this._getReflectionTexture(),!m.useUbo||!this.isFrozen||!m.isSync||l._drawWrapper._forceRebindOnNextCall){var V;if(v.texturesEnabled){if(this._albedoTexture&&z.e.DiffuseTextureEnabled&&(m.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,E.t)(this._albedoTexture,m,"albedo")),this._ambientTexture&&z.e.AmbientTextureEnabled&&(m.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,E.t)(this._ambientTexture,m,"ambient")),this._opacityTexture&&z.e.OpacityTextureEnabled&&(m.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,E.t)(this._opacityTexture,m,"opacity")),Z&&z.e.ReflectionTextureEnabled){if(m.Xi("reflectionMatrix",Z.getReflectionTextureMatrix()),m.updateFloat2("vReflectionInfos",Z.level,0),Z.boundingBoxSize){const K=Z;m.updateVector3("vReflectionPosition",K.boundingBoxPosition),m.updateVector3("vReflectionSize",K.boundingBoxSize)}if(this.realTimeFiltering){const K=Z.getSize().width;m.updateFloat2("vReflectionFilteringInfo",K,Math.log2(K))}if(!U.USEIRRADIANCEMAP){const K=Z.sphericalPolynomial;if(U.USESPHERICALFROMREFLECTIONMAP&&K)if(U.SPHERICAL_HARMONICS){const Y=K.preScaledHarmonics;m.updateVector3("vSphericalL00",Y.l00),m.updateVector3("vSphericalL1_1",Y.l1_1),m.updateVector3("vSphericalL10",Y.l10),m.updateVector3("vSphericalL11",Y.l11),m.updateVector3("vSphericalL2_2",Y.l2_2),m.updateVector3("vSphericalL2_1",Y.l2_1),m.updateVector3("vSphericalL20",Y.l20),m.updateVector3("vSphericalL21",Y.l21),m.updateVector3("vSphericalL22",Y.l22)}else m.updateFloat3("vSphericalX",K.x.x,K.x.y,K.x.z),m.updateFloat3("vSphericalY",K.y.x,K.y.y,K.y.z),m.updateFloat3("vSphericalZ",K.z.x,K.z.y,K.z.z),m.updateFloat3("vSphericalXX_ZZ",K.xx.x-K.zz.x,K.xx.y-K.zz.y,K.xx.z-K.zz.z),m.updateFloat3("vSphericalYY_ZZ",K.yy.x-K.zz.x,K.yy.y-K.zz.y,K.yy.z-K.zz.z),m.updateFloat3("vSphericalZZ",K.zz.x,K.zz.y,K.zz.z),m.updateFloat3("vSphericalXY",K.xy.x,K.xy.y,K.xy.z),m.updateFloat3("vSphericalYZ",K.yz.x,K.yz.y,K.yz.z),m.updateFloat3("vSphericalZX",K.zx.x,K.zx.y,K.zx.z)}m.updateFloat3("vReflectionMicrosurfaceInfos",Z.getSize().width,Z.lodGenerationScale,Z.lodGenerationOffset)}this._emissiveTexture&&z.e.EmissiveTextureEnabled&&(m.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,E.t)(this._emissiveTexture,m,"emissive")),this._lightmapTexture&&z.e.LightmapTextureEnabled&&(m.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,E.t)(this._lightmapTexture,m,"lightmap")),z.e.SpecularTextureEnabled&&(this._metallicTexture?(m.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,E.t)(this._metallicTexture,m,"reflectivity")):this._reflectivityTexture&&(m.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,E.t)(this._reflectivityTexture,m,"reflectivity")),this._metallicReflectanceTexture&&(m.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,E.t)(this._metallicReflectanceTexture,m,"metallicReflectance")),this._reflectanceTexture&&U.REFLECTANCE&&(m.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,E.t)(this._reflectanceTexture,m,"reflectance")),this._microSurfaceTexture&&(m.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,E.t)(this._microSurfaceTexture,m,"microSurfaceSampler"))),this._bumpTexture&&A.getCaps().standardDerivatives&&z.e.BumpTextureEnabled&&!this._disableBumpMap&&(m.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,E.t)(this._bumpTexture,m,"bump"),v._mirroredCameraPosition?m.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):m.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&m.updateFloat("pointSize",this.pointSize),U.METALLICWORKFLOW){var M;g.i.Ti[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,g.i.Ti[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,m.updateColor4("vReflectivityColor",g.i.Ti[0],1);const K=(null===(M=this.subSurface)||void 0===M?void 0:M._indexOfRefraction)??1.5,Y=1,l=Math.pow((K-Y)/(K+Y),2);this._metallicReflectanceColor.scaleToRef(l*this._metallicF0Factor,g.i.Ti[0]);const v=this._metallicF0Factor;m.updateColor4("vMetallicReflectanceFactors",g.i.Ti[0],v)}else m.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);m.updateColor3("vEmissiveColor",z.e.EmissiveTextureEnabled?this._emissiveColor:g.e.BlackReadOnly),m.updateColor3("vReflectionColor",this._reflectionColor),!U.SS_REFRACTION&&null!==(V=this.subSurface)&&void 0!==V&&V._linkRefractionWithTransparency?m.updateColor4("vAlbedoColor",this._albedoColor,1):m.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*v.environmentIntensity,this._lightingInfos.w=this._specularIntensity,m.updateVector4("vLightingIntensity",this._lightingInfos),v.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),m.updateColor3("vAmbientColor",this._globalAmbientColor),m.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}v.texturesEnabled&&(this._albedoTexture&&z.e.DiffuseTextureEnabled&&m.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&z.e.AmbientTextureEnabled&&m.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&z.e.OpacityTextureEnabled&&m.setTexture("opacitySampler",this._opacityTexture),Z&&z.e.ReflectionTextureEnabled&&(U.LODBASEDMICROSFURACE?m.setTexture("reflectionSampler",Z):(m.setTexture("reflectionSampler",Z._lodTextureMid||Z),m.setTexture("reflectionSamplerLow",Z._lodTextureLow||Z),m.setTexture("reflectionSamplerHigh",Z._lodTextureHigh||Z)),U.USEIRRADIANCEMAP&&m.setTexture("irradianceSampler",Z.irradianceTexture)),U.ENVIRONMENTBRDF&&m.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&z.e.EmissiveTextureEnabled&&m.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&z.e.LightmapTextureEnabled&&m.setTexture("lightmapSampler",this._lightmapTexture),z.e.SpecularTextureEnabled&&(this._metallicTexture?m.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&m.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&m.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&U.REFLECTANCE&&m.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&m.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&A.getCaps().standardDerivatives&&z.e.BumpTextureEnabled&&!this._disableBumpMap&&m.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Y)&&this.va().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=l,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,w.c)(this._activeEffect,this,v),this.bindEyePosition(d)}else v.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(c||!this.isFrozen){var u;if(v.lightsEnabled&&!this._disableLighting&&(0,E.i)(v,Y,this._activeEffect,U,this._maxSimultaneousLights),(v.fogEnabled&&Y.applyFog&&v.fogMode!==t.b.FOGMODE_NONE||Z||this.subSurface.refractionTexture||Y.receiveShadows||U.PREPASS)&&this.bindView(d),(0,E.e)(v,Y,this._activeEffect,!0),U.NUM_MORPH_INFLUENCERS&&(0,E.n)(Y,this._activeEffect),U.BAKED_VERTEX_ANIMATION_TEXTURE)null===(u=Y.bakedVertexAnimationManager)||void 0===u||u.bind(d,U.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,E.k)(U,this._activeEffect,v)}this._afterBind(Y,this._activeEffect,l),m.update()}getAnimatables(){const K=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&K.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&K.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&K.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&K.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&K.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?K.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&K.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&K.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&K.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&K.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&K.push(this._microSurfaceTexture),K}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const K=super.getActiveTextures();return this._albedoTexture&&K.push(this._albedoTexture),this._ambientTexture&&K.push(this._ambientTexture),this._opacityTexture&&K.push(this._opacityTexture),this._reflectionTexture&&K.push(this._reflectionTexture),this._emissiveTexture&&K.push(this._emissiveTexture),this._reflectivityTexture&&K.push(this._reflectivityTexture),this._metallicTexture&&K.push(this._metallicTexture),this._metallicReflectanceTexture&&K.push(this._metallicReflectanceTexture),this._reflectanceTexture&&K.push(this._reflectanceTexture),this._microSurfaceTexture&&K.push(this._microSurfaceTexture),this._bumpTexture&&K.push(this._bumpTexture),this._lightmapTexture&&K.push(this._lightmapTexture),K}hasTexture(K){return!!super.hasTexture(K)||(this._albedoTexture===K||(this._ambientTexture===K||(this._opacityTexture===K||(this._reflectionTexture===K||(this._emissiveTexture===K||(this._reflectivityTexture===K||(this._metallicTexture===K||(this._metallicReflectanceTexture===K||(this._reflectanceTexture===K||(this._microSurfaceTexture===K||(this._bumpTexture===K||this._lightmapTexture===K)))))))))))}setPrePassRenderer(){var K;if(null===(K=this.subSurface)||void 0===K||!K.isScatteringEnabled)return!1;const Y=this.va().enableSubSurfaceForPrePass();return Y&&(Y.enabled=!0),!0}dispose(K,Y){var l,v,U,d,A,c,t,Z,m,V,M,u;(this._breakShaderLoadedCheck=!0,Y)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(l=this._albedoTexture)||void 0===l||l.dispose(),null===(v=this._ambientTexture)||void 0===v||v.dispose(),null===(U=this._opacityTexture)||void 0===U||U.dispose(),null===(d=this._reflectionTexture)||void 0===d||d.dispose(),null===(A=this._emissiveTexture)||void 0===A||A.dispose(),null===(c=this._metallicTexture)||void 0===c||c.dispose(),null===(t=this._reflectivityTexture)||void 0===t||t.dispose(),null===(Z=this._bumpTexture)||void 0===Z||Z.dispose(),null===(m=this._lightmapTexture)||void 0===m||m.dispose(),null===(V=this._metallicReflectanceTexture)||void 0===V||V.dispose(),null===(M=this._reflectanceTexture)||void 0===M||M.dispose(),null===(u=this._microSurfaceTexture)||void 0===u||u.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(K,Y)}}a.PBRMATERIAL_OPAQUE=n.b.MATERIAL_OPAQUE,a.PBRMATERIAL_ALPHATEST=n.b.MATERIAL_ALPHATEST,a.PBRMATERIAL_ALPHABLEND=n.b.MATERIAL_ALPHABLEND,a.PBRMATERIAL_ALPHATESTANDBLEND=n.b.MATERIAL_ALPHATESTANDBLEND,a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,a.LIGHTFALLOFF_PHYSICAL=0,a.LIGHTFALLOFF_GLTF=1,a.LIGHTFALLOFF_STANDARD=2,a.ForceGLSL=!1,(0,v.d)([(0,U.r)()],a.prototype,"_imageProcessingConfiguration",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsMiscDirty")],a.prototype,"debugMode",void 0)},12497:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>M});var v=l(646),U=l(652),d=l(475),A=l(675),c=l(2305),t=l(2299),Z=l(619),m=l(469),V=l(702);l(2343);class M extends c.e{set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const Y=this.va();Y&&Y.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(K){this._rotationY=K,this.setReflectionTextureMatrix(A.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(K,Y,l){let v="";return K.forEach((K=>v+=K)),new M(v,Y,null,l,K)}static CreateFromPrefilteredData(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=Y.useDelayedTextureLoading;Y.useDelayedTextureLoading=!1;const d=new M(K,Y,null,!1,null,null,null,void 0,!0,l,v);return Y.useDelayedTextureLoading=U,d}constructor(K,Y){var l;let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,o=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,J=arguments.length>13?arguments[13]:void 0,n=arguments.length>14?arguments[14]:void 0;super(Y),this.onLoadObservable=new m.b,this.boundingBoxPosition=A.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new A.d,this._buffer=null,this.name=K,this.url=K,this._noMipmap=U,this.Cj=!1,this.isCube=!0,this._textureMatrix=A.d.Identity(),this.coordinatesMode=t.c.CUBIC_MODE;let R=null,H=null;null===v||Array.isArray(v)?(this._noMipmap=U,this._format=V,this._createPolynomials=o,R=v,this._loaderOptions=J,this._useSRGBBuffer=n,this._lodScale=W,this._lodOffset=g):(R=v.extensions??null,this._noMipmap=v.noMipmap??!1,d=v.files??null,H=v.buffer??null,this._format=v.format??5,M=v.prefiltered??!1,u=v.forcedExtension??null,this._createPolynomials=v.createPolynomials??!1,this._lodScale=v.lodScale??.8,this._lodOffset=v.lodOffset??0,this._loaderOptions=v.loaderOptions,this._useSRGBBuffer=v.useSRGBBuffer,c=v.X??null,Z=v.onError??null),(K||d)&&this.updateURL(K,u,c,M,Z,R,null===(l=this.va())||void 0===l?void 0:l.useDelayedTextureLoading,d,H)}getClassName(){return"CubeTexture"}updateURL(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,Y&&(this._forcedExtension=Y);const Z=K.lastIndexOf("."),m=Y||(Z>-1?K.substring(Z).toLowerCase():""),V=0===m.indexOf(".dds"),M=0===m.indexOf(".env"),u=0===m.indexOf(".basis");if(M?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=v,v&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),c)this._files=c;else if(u||M||V||d||(d=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,d){for(let Y=0;Y<d.length;Y++)this._files.push(K+d[Y]);this._extensions=d}this._buffer=t,A?(this.delayLoadState=4,this._delayedOnLoad=l,this._delayedOnError=U):this._loadTexture(l,U)}delayLoad(K){4===this.delayLoadState&&(K&&(this._forcedExtension=K),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(K){var Y,l;if(K.updateFlag===this._textureMatrix.updateFlag)return;K.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(l=this.va())||void 0===l||l.markAllMaterialsAsDirty(1,(K=>-1!==K.getActiveTextures().indexOf(this))));if(this._textureMatrix=K,null===(Y=this.va())||void 0===Y||!Y.useRightHandedSystem)return;const v=A.j.Qi[0],U=A.j.Quaternion[0],d=A.j.Qi[1];this._textureMatrix.decompose(v,U,d),U.z*=-1,U.w*=-1,A.d.ComposeToRef(v,U,d,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var K;return null!==(K=this.va())&&void 0!==K&&K.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this.va(),v=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const U=()=>{var Y;(this.onLoadObservable.notifyObservers(this),v)&&(v.dispose(),null===(Y=this.va())||void 0===Y||Y.markAllMaterialsAsDirty(1));K&&K()},A=(K,l)=>{this._loadingError=!0,this._errorObject={message:K,exception:l},Y&&Y(K,l),t.c.OnTextureLoadErrorObservable.notifyObservers(this)};var c;this._texture?this._texture.isReady?d.d.SetImmediate((()=>U())):this._texture.onLoadedObservable.add((()=>U())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,l,this._lodScale,this._lodOffset,K,A,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,l,this._files,this._noMipmap,K,A,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(c=this._texture)||void 0===c||c.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(K,Y,l){const v=V.c.Parse((()=>{let v=!1;return K.prefiltered&&(v=K.prefiltered),new M(l+(K.url??K.name),Y,K.extensions,!1,K.files||null,null,null,void 0,v,K.forcedExtension)}),K,Y);if(K.boundingBoxPosition&&(v.boundingBoxPosition=A.o.yi(K.boundingBoxPosition)),K.boundingBoxSize&&(v.boundingBoxSize=A.o.yi(K.boundingBoxSize)),K.animations)for(let U=0;U<K.animations.length;U++){const Y=K.animations[U],l=(0,Z.c)("BABYLON.Animation");l&&v.animations.push(l.Parse(Y))}return v}clone(){let K=0;const Y=V.c.Clone((()=>{const Y=new M(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return K=Y.uniqueId,Y}),this);return Y.uniqueId=K,Y}}(0,v.d)([(0,U.J)()],M.prototype,"url",void 0),(0,v.d)([(0,U.F)()],M.prototype,"boundingBoxPosition",void 0),(0,v.d)([(0,U.F)()],M.prototype,"boundingBoxSize",null),(0,v.d)([(0,U.J)("rotationY")],M.prototype,"rotationY",null),(0,v.d)([(0,U.J)("files")],M.prototype,"_files",void 0),(0,v.d)([(0,U.J)("forcedExtension")],M.prototype,"_forcedExtension",void 0),(0,v.d)([(0,U.J)("extensions")],M.prototype,"_extensions",void 0),(0,v.d)([(0,U.v)("textureMatrix")],M.prototype,"_textureMatrix",void 0),(0,v.d)([(0,U.v)("textureMatrixRefraction")],M.prototype,"_textureMatrixRefraction",void 0),t.c._CubeTextureParser=M.Parse,(0,Z.f)("BABYLON.CubeTexture",M)},12694:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>t});var v=l(492),U=l(2299),d=l(627),A=l(12001),c=l(594);A.ThinEngine.prototype.createDynamicTexture=function(K,Y,l,v){const U=new c.e(this,4);return U.baseWidth=K,U.baseHeight=Y,l&&(K=this.needPOTTextures?(0,d.e)(K,this._caps.maxTextureSize):K,Y=this.needPOTTextures?(0,d.e)(Y,this._caps.maxTextureSize):Y),U.width=K,U.height=Y,U.isReady=!1,U.generateMipMaps=l,U.samplingMode=v,this.updateTextureSamplingMode(v,U),this._internalTexturesCache.push(U),U},A.ThinEngine.prototype.updateDynamicTexture=function(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K)return;const A=this._gl,c=A.TEXTURE_2D,t=this._bindTextureDirectly(c,K,!0,d);this._unpackFlipY(void 0===l?K.invertY:l),v&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Z=this._getWebGLTextureType(K.type),m=this._getInternalFormat(U||K.format),V=this._getRGBABufferInternalSizedFormat(K.type,m);A.texImage2D(c,0,V,m,Z,Y),K.generateMipMaps&&A.generateMipmap(c),t||this._bindTextureDirectly(c,null),v&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),U&&(K.format=U),K._dynamicTextureSource=Y,K._premulAlpha=v,K.invertY=l||!1,K.isReady=!0};class t extends U.c{constructor(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,c=arguments.length>6?arguments[6]:void 0;const t=!l||l._isScene;super(null,t?l:null===l||void 0===l?void 0:l.hi,t?!v:l,c,d,void 0,void 0,void 0,void 0,A),this.name=K,this.wrapU=U.c.CLAMP_ADDRESSMODE,this.wrapV=U.c.CLAMP_ADDRESSMODE,this._generateMipMaps=v;const Z=this._getEngine();if(!Z)return;if(Y.getContext)this._canvas=Y,this._ownCanvas=!1,this._texture=Z.createDynamicTexture(this._canvas.width,this._canvas.height,v,d);else{this._canvas=Z.createCanvas(1,1),this._ownCanvas=!0;const K=Y;K.width||0===K.width?this._texture=Z.createDynamicTexture(K.width,K.height,v,d):this._texture=Z.createDynamicTexture(Y,Y,v,d)}const m=this.getSize();this._canvas.width!==m.width&&(this._canvas.width=m.width),this._canvas.height!==m.height&&(this._canvas.height=m.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(K){this._canvas.width=K.width,this._canvas.height=K.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(K.width,K.height,this._generateMipMaps,this.samplingMode)}scale(K){const Y=this.getSize();Y.width*=K,Y.height*=K,this._recreate(Y)}scaleTo(K,Y){const l=this.getSize();l.width=K,l.height=Y,this._recreate(l)}getContext(){return this._context}clear(K){const Y=this.getSize();K&&(this._context.fillStyle=K),this._context.clearRect(0,0,Y.width,Y.height)}update(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===K||K,Y,this._format||void 0,void 0,l)}drawText(K,Y,l,v,U,d,A){let c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this.getSize();if(d&&(this._context.fillStyle=d,this._context.fillRect(0,0,t.width,t.height)),this._context.font=v,null===Y||void 0===Y){const l=this._context.measureText(K);Y=(t.width-l.width)/2}if(null===l||void 0===l){const K=parseInt(v.replace(/\D/g,""));l=t.height/2+K/3.65}this._context.fillStyle=U||"",this._context.fillText(K,Y,l),c&&this.update(A)}dispose(){var K,Y;(super.dispose(),this._ownCanvas)&&(null===(K=this._canvas)||void 0===K||null===(Y=K.remove)||void 0===Y||Y.call(K));this._canvas=null,this._context=null}clone(){const K=this.va();if(!K)return this;const Y=this.getSize(),l=new t(this.name,Y,K,this._generateMipMaps);return l.Cj=this.Cj,l.level=this.level,l.wrapU=this.wrapU,l.wrapV=this.wrapV,l}serialize(){const K=this.va();K&&!K.isReady()&&v.e.Warn("The scene must be ready before serializing the dynamic texture");const Y=super.serialize();return t._IsCanvasElement(this._canvas)&&(Y.base64String=this._canvas.toDataURL()),Y.invertY=this._invertY,Y.samplingMode=this.samplingMode,Y}static _IsCanvasElement(K){return void 0!==K.toDataURL}_rebuild(){this.update()}}},12020:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>U});var v=l(2299);class U extends v.c{constructor(K,Y,l,U,d){let A=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>9?arguments[9]:void 0,V=arguments.length>10?arguments[10]:void 0;super(null,d,!A,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,m),this.format=U,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==Z||(t=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==Z||(t=1),this._texture=this._engine.createRawTexture(K,Y,l,U,A,c,t,null,Z,m??0,V??!1),this.wrapU=v.c.CLAMP_ADDRESSMODE,this.wrapV=v.c.CLAMP_ADDRESSMODE)}update(K){this._getEngine().updateRawTexture(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const K=new U(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return K._texture=this._texture,this._texture.incrementReferences(),K}static CreateLuminanceTexture(K,Y,l,v){return new U(K,Y,l,1,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(K,Y,l,v){return new U(K,Y,l,2,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(K,Y,l,v){return new U(K,Y,l,0,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(K,Y,l,v){return new U(K,Y,l,4,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(K,Y,l,v){return new U(K,Y,l,5,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(K,Y,l,v){return new U(K,Y,l,5,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(K,Y,l,d){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.c.TRILINEAR_SAMPLINGMODE;return new U(K,Y,l,6,d,A,c,t,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(K,Y,l,d){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.c.TRILINEAR_SAMPLINGMODE;return new U(K,Y,l,6,d,A,c,t,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12342:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>U});var v=l(2299);class U extends v.c{get depth(){return this._depth}constructor(K,Y,l,U,d,A){let c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:v.c.TRILINEAR_SAMPLINGMODE,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,V=arguments.length>10?arguments[10]:void 0;super(null,A,!c,t),this.format=d,this._texture=A.getEngine().createRawTexture2DArray(K,Y,l,U,d,c,t,Z,null,m,V),this._depth=U,this.is2DArray=!0}update(K){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(K,Y,l,v,d){return new U(K,Y,l,v,5,d,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11884:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>v});class v{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(K,Y){this._defines[K]||(K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K),this._defines[K]=new Array),this._defines[K].push(Y)}addCPUSkinningFallback(K,Y){this._mesh=Y,K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(K,Y){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,K=K.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),Y._bonesComputationForcedToCPU=!0;const l=this._mesh.va();for(let K=0;K<l.meshes.length;K++){const v=l.meshes[K];if(v.material){if(v.computeBonesUsingShaders&&0!==v.numBoneInfluencers)if(v.material.getEffect()===Y)v.computeBonesUsingShaders=!1;else if(v.ui)for(const K of v.ui){if(K.effect===Y){v.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&v.computeBonesUsingShaders&&v.numBoneInfluencers>0&&(v.computeBonesUsingShaders=!1)}}else{const Y=this._defines[this._currentRank];if(Y)for(let l=0;l<Y.length;l++)K=K.replace("#define "+Y[l],"");this._currentRank++}return K}}},11891:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>V});var v=l(646),U=l(835),d=l(652),A=l(11878),c=l(11872),t=l(11897),Z=l(837);class m extends c.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class V extends t.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"DetailMap",140,new m,Y),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=U.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,Y,l){return!this._isEnabled||!(K._areTexturesDirty&&Y.texturesEnabled&&l.getCaps().standardDerivatives&&this._texture&&A.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(K,Y){if(this._isEnabled){K.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const l=Y.getEngine();K._areTexturesDirty&&(l.getCaps().standardDerivatives&&this._texture&&A.e.DetailTextureEnabled&&this._isEnabled?((0,Z.V)(this._texture,K,"DETAIL"),K.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):K.DETAIL=!1)}else K.DETAIL=!1}bindForSubMesh(K,Y){if(!this._isEnabled)return;const l=this._material.isFrozen;K.useUbo&&l&&K.isSync||this._texture&&A.e.DetailTextureEnabled&&(K.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,Z.t)(this._texture,K,"detail")),Y.texturesEnabled&&this._texture&&A.e.DetailTextureEnabled&&K.setTexture("detailSampler",this._texture)}hasTexture(K){return this._texture===K}getActiveTextures(K){this._texture&&K.push(this._texture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture)}dispose(K){var Y;K&&(null===(Y=this._texture)||void 0===Y||Y.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(K){K.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,v.d)([(0,d.C)("detailTexture"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,v.d)([(0,d.J)()],V.prototype,"diffuseBlendLevel",void 0),(0,v.d)([(0,d.J)()],V.prototype,"roughnessBlendLevel",void 0),(0,v.d)([(0,d.J)()],V.prototype,"bumpLevel",void 0),(0,v.d)([(0,d.J)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"normalBlendMethod",void 0),(0,v.d)([(0,d.J)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0)},11872:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>v});class v{constructor(K){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=K,K)for(const Y in K)Object.prototype.hasOwnProperty.call(K,Y)&&this._setDefaultValue(Y)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||K,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const K of Object.keys(this))"_"!==K[0]&&this._keys.push(K);if(this._externalProperties)for(const K in this._externalProperties)-1===this._keys.indexOf(K)&&this._keys.push(K)}isEqual(K){if(this._keys.length!==K._keys.length)return!1;for(let Y=0;Y<this._keys.length;Y++){const l=this._keys[Y];if(this[l]!==K[l])return!1}return!0}cloneTo(K){this._keys.length!==K._keys.length&&(K._keys=this._keys.slice(0));for(let Y=0;Y<this._keys.length;Y++){const l=this._keys[Y];K[l]=this[l]}}reset(){this._keys.forEach((K=>this._setDefaultValue(K)))}_setDefaultValue(K){var Y,l,v,U;const d=(null===(Y=this._externalProperties)||void 0===Y||null===(l=Y[K])||void 0===l?void 0:l.type)??typeof this[K],A=null===(v=this._externalProperties)||void 0===v||null===(U=v[K])||void 0===U?void 0:U.default;switch(d){case"number":this[K]=A??0;break;case"string":this[K]=A??"";break;default:this[K]=A??!1}}toString(){let K="";for(let Y=0;Y<this._keys.length;Y++){const l=this._keys[Y],v=this[l];switch(typeof v){case"number":case"string":K+="#define "+l+" "+v+"\n";break;default:v&&(K+="#define "+l+"\n")}}return K}}},11878:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>U});var v=l(567);class U{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(K){this._DiffuseTextureEnabled!==K&&(this._DiffuseTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(K){this._DetailTextureEnabled!==K&&(this._DetailTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(K){this._DecalMapEnabled!==K&&(this._DecalMapEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(K){this._AmbientTextureEnabled!==K&&(this._AmbientTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(K){this._OpacityTextureEnabled!==K&&(this._OpacityTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(K){this._ReflectionTextureEnabled!==K&&(this._ReflectionTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(K){this._EmissiveTextureEnabled!==K&&(this._EmissiveTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(K){this._SpecularTextureEnabled!==K&&(this._SpecularTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(K){this._BumpTextureEnabled!==K&&(this._BumpTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(K){this._LightmapTextureEnabled!==K&&(this._LightmapTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(K){this._RefractionTextureEnabled!==K&&(this._RefractionTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(K){this._ColorGradingTextureEnabled!==K&&(this._ColorGradingTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(K){this._FresnelEnabled!==K&&(this._FresnelEnabled=K,v.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(K){this._ClearCoatTextureEnabled!==K&&(this._ClearCoatTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(K){this._ClearCoatBumpTextureEnabled!==K&&(this._ClearCoatBumpTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(K){this._ClearCoatTintTextureEnabled!==K&&(this._ClearCoatTintTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(K){this._SheenTextureEnabled!==K&&(this._SheenTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(K){this._AnisotropicTextureEnabled!==K&&(this._AnisotropicTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(K){this._ThicknessTextureEnabled!==K&&(this._ThicknessTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(K){this._RefractionIntensityTextureEnabled!==K&&(this._RefractionIntensityTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(K){this._TranslucencyIntensityTextureEnabled!==K&&(this._TranslucencyIntensityTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(K){this._TranslucencyColorTextureEnabled!==K&&(this._TranslucencyColorTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(K){this._IridescenceTextureEnabled!==K&&(this._IridescenceTextureEnabled=K,v.b.MarkAllMaterialsAsDirty(1))}}U._DiffuseTextureEnabled=!0,U._DetailTextureEnabled=!0,U._DecalMapEnabled=!0,U._AmbientTextureEnabled=!0,U._OpacityTextureEnabled=!0,U._ReflectionTextureEnabled=!0,U._EmissiveTextureEnabled=!0,U._SpecularTextureEnabled=!0,U._BumpTextureEnabled=!0,U._LightmapTextureEnabled=!0,U._RefractionTextureEnabled=!0,U._ColorGradingTextureEnabled=!0,U._FresnelEnabled=!0,U._ClearCoatTextureEnabled=!0,U._ClearCoatBumpTextureEnabled=!0,U._ClearCoatTintTextureEnabled=!0,U._SheenTextureEnabled=!0,U._AnisotropicTextureEnabled=!0,U._ThicknessTextureEnabled=!0,U._RefractionIntensityTextureEnabled=!0,U._TranslucencyIntensityTextureEnabled=!0,U._TranslucencyColorTextureEnabled=!0,U._IridescenceTextureEnabled=!0},11900:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>d});var v,U=l(675);!function(K){K[K.Zero=0]="Zero",K[K.One=1]="One",K[K.MaxViewZ=2]="MaxViewZ"}(v||(v={}));class d{static CreateConfiguration(K){return d._Configurations[K]={defines:{},previousWorldMatrices:{},previousViewProjection:U.d.Zero(),currentViewProjection:U.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},d._Configurations[K]}static DeleteConfiguration(K){delete d._Configurations[K]}static GetConfiguration(K){return d._Configurations[K]}static AddUniformsAndSamplers(K,Y){K.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(K,Y){for(const l of Y)if(l.ui)for(const Y of l.ui)Y._removeDrawWrapper(K)}static PrepareDefines(K,Y,l){if(!l._arePrePassDirty)return;const v=d._Configurations[K];if(!v)return;l.PREPASS=!0,l.PREPASS_COLOR=!1,l.PREPASS_COLOR_INDEX=-1;let U=0;for(let A=0;A<d.GeometryTextureDescriptions.length;A++){const K=d.GeometryTextureDescriptions[A],Y=K.define,c=K.defineIndex,t=v.defines[c];void 0!==t?(l[Y]=!0,l[c]=t,U++):(l[Y]=!1,delete l[c])}l.SCENE_MRT_COUNT=U,l.BONES_VELOCITY_ENABLED=Y.useBones&&Y.computeBonesUsingShaders&&Y.skeleton&&!Y.skeleton.isUsingTextureForMatrices&&-1===v.excludedSkinnedMesh.indexOf(Y)}static Bind(K,Y,l,v){const U=d._Configurations[K];if(U&&(void 0!==U.defines.PREPASS_VELOCITY_INDEX||void 0!==U.defines.PREPASS_VELOCITY_LINEAR_INDEX)){U.previousWorldMatrices[l.uniqueId]||(U.previousWorldMatrices[l.uniqueId]=v.clone());const K=l.va();U.previousViewProjection||(U.previousViewProjection=K.getTransformMatrix().clone(),U.currentViewProjection=K.getTransformMatrix().clone());const d=K.getEngine();if(U.currentViewProjection.updateFlag!==K.getTransformMatrix().updateFlag?(U.lastUpdateFrameId=d.frameId,U.previousViewProjection.p(U.currentViewProjection),U.currentViewProjection.p(K.getTransformMatrix())):U.lastUpdateFrameId!==d.frameId&&(U.lastUpdateFrameId=d.frameId,U.previousViewProjection.p(U.currentViewProjection)),Y.setMatrix("previousWorld",U.previousWorldMatrices[l.uniqueId]),Y.setMatrix("previousViewProjection",U.previousViewProjection),U.previousWorldMatrices[l.uniqueId]=v.clone(),l.useBones&&l.computeBonesUsingShaders&&l.skeleton){const K=l.skeleton;if(!K.isUsingTextureForMatrices||-1===Y.getUniformIndex("boneTextureWidth")){const v=K.getTransformMatrices(l);v&&(U.previousBones[l.uniqueId]||(U.previousBones[l.uniqueId]=v.slice()),Y.setMatrices("mPreviousBones",U.previousBones[l.uniqueId]),U.previousBones[l.uniqueId].set(v))}}}}}d.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],d._Configurations={}},11897:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>J});var v=l(646),U=l(652),d=l(835),A=l(526),c=l(549),t=l(577);const Z=new RegExp("^([gimus]+)!");class m{constructor(K){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=K,this._scene=K.va(),this._engine=this._scene.getEngine()}_addPlugin(K){for(let v=0;v<this._plugins.length;++v)if(this._plugins[v].name===K.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!K.isCompatible(this._material.shaderLanguage))throw`The plugin "${K.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const Y=K.getClassName();m._MaterialPluginClassToMainDefine[Y]||(m._MaterialPluginClassToMainDefine[Y]="MATERIALPLUGIN_"+ ++m._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(K,Y)=>this._handlePluginEvent(K,Y),this._plugins.push(K),this._plugins.sort(((K,Y)=>K.priority-Y.priority)),this._codeInjectionPoints={};const l={};l[m._MaterialPluginClassToMainDefine[Y]]={type:"boolean",default:!0};for(const v of this._plugins)v.collectDefines(l),this._collectPointNames("vertex",v.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",v.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=l,!0}_activatePlugin(K){-1===this._activePlugins.indexOf(K)&&(this._activePlugins.push(K),this._activePlugins.sort(((K,Y)=>K.priority-Y.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),K.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(K),this._activePluginsForExtraEvents.sort(((K,Y)=>K.priority-Y.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(K){for(let Y=0;Y<this._plugins.length;++Y)if(this._plugins[Y].name===K)return this._plugins[Y];return null}_handlePluginEventIsReadyForSubMesh(K){let Y=!0;for(const l of this._activePlugins)Y=Y&&l.isReadyForSubMesh(K.defines,this._scene,this._engine,K.subMesh);K.isReadyForSubMesh=Y}_handlePluginEventPrepareDefinesBeforeAttributes(K){for(const Y of this._activePlugins)Y.prepareDefinesBeforeAttributes(K.defines,this._scene,K.mesh)}_handlePluginEventPrepareDefines(K){for(const Y of this._activePlugins)Y.prepareDefines(K.defines,this._scene,K.mesh)}_handlePluginEventHardBindForSubMesh(K){for(const Y of this._activePluginsForExtraEvents)Y.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,K.subMesh)}_handlePluginEventBindForSubMesh(K){for(const Y of this._activePlugins)Y.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,K.subMesh)}_handlePluginEventHasRenderTargetTextures(K){let Y=!1;for(const l of this._activePluginsForExtraEvents)if(Y=l.hasRenderTargetTextures(),Y)break;K.hasRenderTargetTextures=Y}_handlePluginEventFillRenderTargetTextures(K){for(const Y of this._activePluginsForExtraEvents)Y.fillRenderTargetTextures(K.renderTargets)}_handlePluginEvent(K,Y){switch(K){case 512:{const K=Y;for(const Y of this._activePlugins)Y.getActiveTextures(K.activeTextures);break}case 256:{const K=Y;for(const Y of this._activePlugins)Y.getAnimatables(K.animatables);break}case 1024:{const K=Y;let l=!1;for(const Y of this._activePlugins)if(l=Y.hasTexture(K.texture),l)break;K.hasTexture=l;break}case 2:{const K=Y;for(const Y of this._plugins)Y.dispose(K.forceDisposeTextures);break}case 4:Y.defineNames=this._defineNamesFromPlugins;break;case 128:{const K=Y;for(const Y of this._activePlugins)K.fallbackRank=Y.addFallbacks(K.defines,K.fallbacks,K.fallbackRank),Y.getAttributes(K.attributes,this._scene,K.mesh);this._uniformList.length>0&&K.uniforms.push(...this._uniformList),this._samplerList.length>0&&K.samplers.push(...this._samplerList),this._uboList.length>0&&K.uniformBuffersNames.push(...this._uboList),K.customCode=this._injectCustomCode(K,K.customCode);break}case 8:{const K=Y;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const l=1===this._material.shaderLanguage;for(const Y of this._plugins){const v=Y.getUniforms(this._material.shaderLanguage);if(v){if(v.ubo)for(const Y of v.ubo){if(Y.size&&Y.type){const v=Y.arraySize??0;if(K.ubo.addUniform(Y.name,Y.size,v),l){let K;switch(Y.type){case"mat4":K="mat4x4f";break;case"float":K="f32";break;default:K=`${Y.type}f`}this._uboDeclaration+=`uniform ${Y.name}: ${K}${v>0?`[${v}]`:""};\n`}else this._uboDeclaration+=`${Y.type} ${Y.name}${v>0?`[${v}]`:""};\n`}this._uniformList.push(Y.name)}v.vertex&&(this._vertexDeclaration+=v.vertex+"\n"),v.fragment&&(this._fragmentDeclaration+=v.fragment+"\n")}Y.getSamplers(this._samplerList),Y.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(K,Y){if(Y)for(const l in Y)this._codeInjectionPoints[K]||(this._codeInjectionPoints[K]={}),this._codeInjectionPoints[K][l]=!0}_injectCustomCode(K,Y){return(l,v)=>{var U;Y&&(v=Y(l,v)),this._uboDeclaration&&(v=v.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(v=v.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(v=v.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const d=null===(U=this._codeInjectionPoints)||void 0===U?void 0:U[l];if(!d)return v;let A=null;for(let Y in d){let U="";for(const v of this._activePlugins){var m;let d=null===(m=v.getCustomCode(l,this._material.shaderLanguage))||void 0===m?void 0:m[Y];if(d){if(v.resolveIncludes){if(null===A){const Y=0;A={defines:[],indexParameters:K.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:t.e.GetShadersRepository(Y),includesShadersStore:t.e.GetIncludesShadersStore(Y),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}A.isFragment="fragment"===l,(0,c.m)(d,A,(K=>d=K))}U+=d+"\n"}}if(U.length>0)if("!"===Y.charAt(0)){Y=Y.substring(1);let K="g";if("!"===Y.charAt(0))K="",Y=Y.substring(1);else{const l=Z.exec(Y);l&&l.length>=2&&(K=l[1],Y=Y.substring(K.length+1))}K.indexOf("g")<0&&(K+="g");const l=v,d=new RegExp(Y,K);let A=d.exec(l);for(;null!==A;){let K=U;for(let Y=0;Y<A.length;++Y)K=K.replace("$"+Y,A[Y]);v=v.replace(A[0],K),A=d.exec(l)}}else{const K="#define "+Y;v=v.replace(K,"\n"+U+"\n"+K)}}return v}}}m._MaterialPluginClassToMainDefine={},m._MaterialPluginCounter=0,A.e.OnEnginesDisposedObservable.add((()=>{o()}));const V=[];let M=!1,u=null;function o(){V.length=0,M=!1,d.b.OnEventObservable.remove(u),u=null}var W=l(702),g=l(619);class J{isCompatible(K){return 0===K}_enable(K){K&&this._pluginManager._activatePlugin(this)}constructor(K,Y,l,v){let U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=K,this.name=Y,this.priority=l,this.resolveIncludes=A,K.pluginManager||(K.pluginManager=new m(K),K.Hi.add((()=>{K.pluginManager=void 0}))),this._pluginDefineNames=v,this._pluginManager=K.pluginManager,U&&this._pluginManager._addPlugin(this),d&&this._enable(!0),this.markAllDefinesAsDirty=K._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(K,Y,l,v){return!0}hardBindForSubMesh(K,Y,l,v){}bindForSubMesh(K,Y,l,v){}dispose(K){}getCustomCode(K){return null}collectDefines(K){if(this._pluginDefineNames)for(const Y of Object.keys(this._pluginDefineNames)){if("_"===Y[0])continue;const l=typeof this._pluginDefineNames[Y];K[Y]={type:"number"===l?"number":"string"===l?"string":"boolean"===l?"boolean":"object",default:this._pluginDefineNames[Y]}}}prepareDefinesBeforeAttributes(K,Y,l){}prepareDefines(K,Y,l){}hasTexture(K){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(K){}getActiveTextures(K){}getAnimatables(K){}addFallbacks(K,Y,l){return l}getSamplers(K){}getAttributes(K,Y,l){}getUniformBuffersNames(K){}getUniforms(){return{}}copyTo(K){W.c.Clone((()=>K),this)}serialize(){return W.c.Serialize(this)}parse(K,Y,l){W.c.Parse((()=>this),K,Y,l)}}(0,v.d)([(0,U.J)()],J.prototype,"name",void 0),(0,v.d)([(0,U.J)()],J.prototype,"priority",void 0),(0,v.d)([(0,U.J)()],J.prototype,"resolveIncludes",void 0),(0,v.d)([(0,U.J)()],J.prototype,"registerForExtraEvents",void 0),(0,g.f)("BABYLON.MaterialPluginBase",J)},11865:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>v});class v{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(K){K.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(K){}bindForSubMesh(K,Y,l,v,U){if(Y.prePassRenderer&&Y.prePassRenderer.enabled&&Y.prePassRenderer.currentRTisSceneRT&&(-1!==Y.prePassRenderer.getIndex(2)||-1!==Y.prePassRenderer.getIndex(11))){this.previousWorldMatrices[l.uniqueId]||(this.previousWorldMatrices[l.uniqueId]=v.clone()),this.previousViewProjection||(this.previousViewProjection=Y.getTransformMatrix().clone(),this.currentViewProjection=Y.getTransformMatrix().clone());const U=Y.getEngine();this.currentViewProjection.updateFlag!==Y.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=U.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(Y.getTransformMatrix())):this._lastUpdateFrameId!==U.frameId&&(this._lastUpdateFrameId=U.frameId,this.previousViewProjection.p(this.currentViewProjection)),K.setMatrix("previousWorld",this.previousWorldMatrices[l.uniqueId]),K.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[l.uniqueId]=v.clone()}}}},11876:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>d});var v=l(675),U=l(835);class d extends U.b{constructor(K,Y){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(K,Y,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new v.d,this._storeEffectOnSubMeshes=l}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(K,Y){return!!K&&(!this._storeEffectOnSubMeshes||(!K.ui||0===K.ui.length||this.isReadyForSubMesh(K,K.ui[0],Y)))}_isReadyForSubMesh(K){const Y=K.materialDefines;return!(this.checkReadyOnEveryCall||!K.effect||!Y||Y._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(K){this._activeEffect.setMatrix("world",K)}bindOnlyNormalMatrix(K){this._activeEffect.setMatrix("normalMatrix",K)}bind(K,Y){Y&&this.bindForSubMesh(K,Y,Y.ui[0])}_afterBind(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;super._afterBind(K,Y,l),this.va()._cachedEffect=Y,l?l._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return l._drawWrapper._forceRebindOnNextCall||K.isCachedMaterialInvalid(this,Y,v)}dispose(K,Y,l){this._activeEffect=void 0,super.dispose(K,Y,l)}}},11862:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>e});var v=l(646),U=l(652),d=l(668),A=l(2366),c=l(675),t=l(706),Z=l(730),m=l(11865),V=l(2375),M=l(835),u=l(11872),o=l(11876),W=l(2299),g=l(619),J=l(11878),n=l(11884),R=l(11891),H=l(853),z=l(837),r=l(702),E=l(11900);const y={effect:null,subMesh:null};class T extends u.c{constructor(K){super(K),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(K){const Y=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const l of Y)this[l]=l===K}}class e extends o.e{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=K||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(K){this.imageProcessingConfiguration.colorCurvesEnabled=K}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(K){this.imageProcessingConfiguration.colorGradingEnabled=K}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(K){this._imageProcessingConfiguration.toneMappingEnabled=K}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(K){this._imageProcessingConfiguration.exposure=K}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(K){this._imageProcessingConfiguration.contrast=K}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(K){this._imageProcessingConfiguration.colorGradingTexture=K}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(K){this._imageProcessingConfiguration.colorCurves=K}get canRenderToMRT(){return!0}constructor(K,Y){super(K,Y,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new t.e(0,0,0),this.diffuseColor=new t.e(1,1,1),this.specularColor=new t.e(1,1,1),this.emissiveColor=new t.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new d.c(16),this._worldViewProjectionMatrix=c.d.Zero(),this._globalAmbientColor=new t.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new R.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new m.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"cb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===M.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Cj&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==M.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Cj||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(K,Y){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const U=Y._drawWrapper;if(U.effect&&this.isFrozen&&U._wasPreviouslyReady&&U._wasPreviouslyUsingInstances===v)return!0;Y.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Y.materialDefines=new T(this._eventInfo.defineNames));const d=this.va(),A=Y.materialDefines;if(this._isReadyForSubMesh(Y))return!0;const c=d.getEngine();A._needNormals=(0,z.S)(d,K,A,!0,this._maxSimultaneousLights,this._disableLighting),(0,z.Y)(d,A);const t=this.needAlphaBlendingForMesh(K)&&this.va().useOrderIndependentTransparency;if((0,z.bb)(d,A,this.canRenderToMRT&&!t),(0,z.Z)(d,A,t),E.c.PrepareDefines(c.currentRenderPassId,K,A),A._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,A._needUVs=!1;for(let K=1;K<=6;++K)A["MAINUV"+K]=!1;if(d.texturesEnabled){if(A.DIFFUSEDIRECTUV=0,A.BUMPDIRECTUV=0,A.AMBIENTDIRECTUV=0,A.OPACITYDIRECTUV=0,A.EMISSIVEDIRECTUV=0,A.SPECULARDIRECTUV=0,A.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&e.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._diffuseTexture,A,"DIFFUSE")}else A.DIFFUSE=!1;if(this._ambientTexture&&e.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._ambientTexture,A,"AMBIENT")}else A.AMBIENT=!1;if(this._opacityTexture&&e.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._opacityTexture,A,"OPACITY"),A.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else A.OPACITY=!1;if(this._reflectionTexture&&e.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(A._needNormals=!0,A.REFLECTION=!0,A.ROUGHNESS=this._roughness>0,A.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,A.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===W.c.INVCUBIC_MODE,A.REFLECTIONMAP_3D=this._reflectionTexture.isCube,A.REFLECTIONMAP_OPPOSITEZ=A.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,A.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case W.c.EXPLICIT_MODE:A.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case W.c.PLANAR_MODE:A.setReflectionMode("REFLECTIONMAP_PLANAR");break;case W.c.PROJECTION_MODE:A.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case W.c.SKYBOX_MODE:A.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case W.c.SPHERICAL_MODE:A.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case W.c.EQUIRECTANGULAR_MODE:A.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case W.c.FIXED_EQUIRECTANGULAR_MODE:A.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case W.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:A.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case W.c.CUBIC_MODE:case W.c.INVCUBIC_MODE:default:A.setReflectionMode("REFLECTIONMAP_CUBIC")}A.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else A.REFLECTION=!1,A.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&e.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._emissiveTexture,A,"EMISSIVE")}else A.EMISSIVE=!1;if(this._lightmapTexture&&e.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._lightmapTexture,A,"LIGHTMAP"),A.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,A.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else A.LIGHTMAP=!1;if(this._specularTexture&&e.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,z.V)(this._specularTexture,A,"SPECULAR"),A.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else A.SPECULAR=!1;if(d.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,z.V)(this._bumpTexture,A,"BUMP"),A.PARALLAX=this._useParallax,A.PARALLAX_RHS=d.useRightHandedSystem,A.PARALLAXOCCLUSION=this._useParallaxOcclusion,A.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else A.BUMP=!1,A.PARALLAX=!1,A.PARALLAX_RHS=!1,A.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&e.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;A._needUVs=!0,A.REFRACTION=!0,A.REFRACTIONMAP_3D=this._refractionTexture.isCube,A.RGBDREFRACTION=this._refractionTexture.isRGBD,A.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else A.REFRACTION=!1;A.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else A.DIFFUSE=!1,A.AMBIENT=!1,A.OPACITY=!1,A.REFLECTION=!1,A.EMISSIVE=!1,A.LIGHTMAP=!1,A.BUMP=!1,A.REFRACTION=!1;A.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),A.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,A.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,A.SPECULAROVERALPHA=this._useSpecularOverAlpha,A.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,A.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,A.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(K)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._eventInfo.subMesh=Y,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(A._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(A),A.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,A.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}A._areFresnelDirty&&(e.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(A.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,A.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,A.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,A.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,A.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,A.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,A._needNormals=!0,A.FRESNEL=!0):A.FRESNEL=!1),(0,z.X)(K,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(K)||this._forceAlphaTest,A,this._applyDecalMapAfterDetailMap),(0,z.R)(d,c,this,A,v,null,Y.getRenderingMesh().hasThinInstances),this._eventInfo.defines=A,this._eventInfo.mesh=K,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,z.N)(K,A,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let M=!1;if(A.isDirty){const v=A._areLightsDisposed;A.markAsProcessed();const U=new n.e;A.REFLECTION&&U.addFallback(0,"REFLECTION"),A.SPECULAR&&U.addFallback(0,"SPECULAR"),A.BUMP&&U.addFallback(0,"BUMP"),A.PARALLAX&&U.addFallback(1,"PARALLAX"),A.PARALLAX_RHS&&U.addFallback(1,"PARALLAX_RHS"),A.PARALLAXOCCLUSION&&U.addFallback(0,"PARALLAXOCCLUSION"),A.SPECULAROVERALPHA&&U.addFallback(0,"SPECULAROVERALPHA"),A.FOG&&U.addFallback(1,"FOG"),A.POINTSIZE&&U.addFallback(0,"POINTSIZE"),A.LOGARITHMICDEPTH&&U.addFallback(0,"LOGARITHMICDEPTH"),(0,z.v)(A,U,this._maxSimultaneousLights),A.SPECULARTERM&&U.addFallback(0,"SPECULARTERM"),A.DIFFUSEFRESNEL&&U.addFallback(1,"DIFFUSEFRESNEL"),A.OPACITYFRESNEL&&U.addFallback(2,"OPACITYFRESNEL"),A.REFLECTIONFRESNEL&&U.addFallback(3,"REFLECTIONFRESNEL"),A.EMISSIVEFRESNEL&&U.addFallback(4,"EMISSIVEFRESNEL"),A.FRESNEL&&U.addFallback(4,"FRESNEL"),A.MULTIVIEW&&U.addFallback(0,"MULTIVIEW");const t=[Z.e.PositionKind];A.NORMAL&&t.push(Z.e.NormalKind),A.TANGENT&&t.push(Z.e.TangentKind);for(let K=1;K<=6;++K)A["UV"+K]&&t.push(`uv${1===K?"":K}`);A.VERTEXCOLOR&&t.push(Z.e.ColorKind),(0,z.C)(t,K,A,U),(0,z.G)(t,A),(0,z.K)(t,K,A),(0,z.z)(t,K,A);let u="default";const o=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],W=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],g=["Material","Scene","Mesh"],J={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:A.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=U,this._eventInfo.fallbackRank=0,this._eventInfo.defines=A,this._eventInfo.uniforms=o,this._eventInfo.attributes=t,this._eventInfo.samplers=W,this._eventInfo.uniformBuffersNames=g,this._eventInfo.customCode=void 0,this._eventInfo.mesh=K,this._eventInfo.indexParameters=J,this._callbackPluginEventGeneric(128,this._eventInfo),E.c.AddUniformsAndSamplers(o,W),m.d.AddUniforms(o),m.d.AddSamplers(W),V.e&&(V.e.PrepareUniforms(o,A),V.e.PrepareSamplers(W,A)),(0,z.cb)({uniformsNames:o,uniformBuffersNames:g,samplers:W,defines:A,maxSimultaneousLights:this._maxSimultaneousLights}),(0,H.b)(o);const R={};this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,o,g,W,A,t,R));const r=A.toString(),T=Y.effect;let e=d.getEngine().createEffect(u,{attributes:t,uniformsNames:o,uniformBuffersNames:g,samplers:W,defines:r,fallbacks:U,onCompiled:this.onCompiled,onError:this.onError,indexParameters:J,processFinalCode:R.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:A.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([l.e(40),l.e(38)]).then(l.bind(l,13013)),Promise.all([l.e(41),l.e(39)]).then(l.bind(l,13145))]):await Promise.all([Promise.all([l.e(44),l.e(43)]).then(l.bind(l,13217)),Promise.all([l.e(46),l.e(45)]).then(l.bind(l,13347))]),this._shadersLoaded=!0}},c);if(this._eventInfo.customCode=void 0,e)if(this._onEffectCreatedObservable&&(y.effect=e,y.subMesh=Y,this._onEffectCreatedObservable.notifyObservers(y)),this.allowShaderHotSwapping&&T&&!e.isReady()){if(e=T,A.markAsUnprocessed(),M=this.isFrozen,v)return A._areLightsDisposed=!0,!1}else d.resetCachedMaterial(),Y.setEffect(e,A,this._materialContext)}return!(!Y.effect||!Y.effect.isReady())&&(A._renderId=d.getRenderId(),U._wasPreviouslyReady=!M,U._wasPreviouslyUsingInstances=v,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const K=this._uniformBuffer;K.addUniform("diffuseLeftColor",4),K.addUniform("diffuseRightColor",4),K.addUniform("opacityParts",4),K.addUniform("reflectionLeftColor",4),K.addUniform("reflectionRightColor",4),K.addUniform("refractionLeftColor",4),K.addUniform("refractionRightColor",4),K.addUniform("emissiveLeftColor",4),K.addUniform("emissiveRightColor",4),K.addUniform("vDiffuseInfos",2),K.addUniform("vAmbientInfos",2),K.addUniform("vOpacityInfos",2),K.addUniform("vReflectionInfos",2),K.addUniform("vReflectionPosition",3),K.addUniform("vReflectionSize",3),K.addUniform("vEmissiveInfos",2),K.addUniform("vLightmapInfos",2),K.addUniform("vSpecularInfos",2),K.addUniform("vBumpInfos",3),K.addUniform("diffuseMatrix",16),K.addUniform("ambientMatrix",16),K.addUniform("opacityMatrix",16),K.addUniform("reflectionMatrix",16),K.addUniform("emissiveMatrix",16),K.addUniform("lightmapMatrix",16),K.addUniform("specularMatrix",16),K.addUniform("bumpMatrix",16),K.addUniform("vTangentSpaceParams",2),K.addUniform("pointSize",1),K.addUniform("alphaCutOff",1),K.addUniform("refractionMatrix",16),K.addUniform("vRefractionInfos",4),K.addUniform("vRefractionPosition",3),K.addUniform("vRefractionSize",3),K.addUniform("vSpecularColor",4),K.addUniform("vEmissiveColor",3),K.addUniform("vDiffuseColor",4),K.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(K,Y,l){const v=this.va(),U=l.materialDefines;if(!U)return;const d=l.effect;if(!d)return;this._activeEffect=d,Y.getMeshUniformBuffer().bindToEffect(d,"Mesh"),Y.transferToEffect(K),this._uniformBuffer.bindToEffect(d,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,v,Y,K,this.isFrozen),E.c.Bind(v.getEngine().currentRenderPassId,this._activeEffect,Y,K),this._eventInfo.subMesh=l,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),U.OBJECTSPACE_NORMALMAP&&(K.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const c=this._mustRebind(v,d,l,Y.visibility);(0,z.b)(Y,d);const Z=this._uniformBuffer;if(c){if(this.bindViewProjection(d),!Z.useUbo||!this.isFrozen||!Z.isSync||l._drawWrapper._forceRebindOnNextCall){if(e.FresnelEnabled&&U.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Z.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),Z.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&Z.updateColor4("opacityParts",new t.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Z.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),Z.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(Z.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),Z.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Z.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),Z.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),v.texturesEnabled){if(this._diffuseTexture&&e.DiffuseTextureEnabled&&(Z.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,z.t)(this._diffuseTexture,Z,"diffuse")),this._ambientTexture&&e.AmbientTextureEnabled&&(Z.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,z.t)(this._ambientTexture,Z,"ambient")),this._opacityTexture&&e.OpacityTextureEnabled&&(Z.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,z.t)(this._opacityTexture,Z,"opacity")),this._hasAlphaChannel()&&Z.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&e.ReflectionTextureEnabled&&(Z.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),Z.Xi("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const K=this._reflectionTexture;Z.updateVector3("vReflectionPosition",K.boundingBoxPosition),Z.updateVector3("vReflectionSize",K.boundingBoxSize)}if(this._emissiveTexture&&e.EmissiveTextureEnabled&&(Z.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,z.t)(this._emissiveTexture,Z,"emissive")),this._lightmapTexture&&e.LightmapTextureEnabled&&(Z.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,z.t)(this._lightmapTexture,Z,"lightmap")),this._specularTexture&&e.SpecularTextureEnabled&&(Z.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,z.t)(this._specularTexture,Z,"specular")),this._bumpTexture&&v.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&(Z.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,z.t)(this._bumpTexture,Z,"bump"),v._mirroredCameraPosition?Z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&e.RefractionTextureEnabled){let K=1;if(this._refractionTexture.isCube||(Z.Xi("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(K=this._refractionTexture.depth)),Z.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,K,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const K=this._refractionTexture;Z.updateVector3("vRefractionPosition",K.boundingBoxPosition),Z.updateVector3("vRefractionSize",K.boundingBoxSize)}}}this.pointsCloud&&Z.updateFloat("pointSize",this.pointSize),Z.updateColor4("vSpecularColor",this.specularColor,this.specularPower),Z.updateColor3("vEmissiveColor",e.EmissiveTextureEnabled?this.emissiveColor:t.e.BlackReadOnly),Z.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),v.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),Z.updateColor3("vAmbientColor",this._globalAmbientColor)}v.texturesEnabled&&(this._diffuseTexture&&e.DiffuseTextureEnabled&&d.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&e.AmbientTextureEnabled&&d.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.OpacityTextureEnabled&&d.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&e.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?d.setTexture("reflectionCubeSampler",this._reflectionTexture):d.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&e.EmissiveTextureEnabled&&d.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.LightmapTextureEnabled&&d.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&e.SpecularTextureEnabled&&d.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&v.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&d.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&e.RefractionTextureEnabled&&(this._refractionTexture.isCube?d.setTexture("refractionCubeSampler",this._refractionTexture):d.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Y)&&this.va().depthPeelingRenderer.bind(d),this._eventInfo.subMesh=l,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,H.c)(d,this,v),this.bindEyePosition(d)}else v.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(c||!this.isFrozen){var m;if(v.lightsEnabled&&!this._disableLighting&&(0,z.i)(v,Y,d,U,this._maxSimultaneousLights),(v.fogEnabled&&Y.applyFog&&v.fogMode!==A.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||Y.receiveShadows||U.PREPASS)&&this.bindView(d),(0,z.e)(v,Y,d),U.NUM_MORPH_INFLUENCERS&&(0,z.n)(Y,d),U.BAKED_VERTEX_ANIMATION_TEXTURE)null===(m=Y.bakedVertexAnimationManager)||void 0===m||m.bind(d,U.INSTANCES);this.useLogarithmicDepth&&(0,z.k)(U,d,v),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(Y,this._activeEffect,l),Z.update()}getAnimatables(){const K=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&K.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&K.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&K.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&K.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&K.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&K.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&K.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&K.push(this._refractionTexture),K}getActiveTextures(){const K=super.getActiveTextures();return this._diffuseTexture&&K.push(this._diffuseTexture),this._ambientTexture&&K.push(this._ambientTexture),this._opacityTexture&&K.push(this._opacityTexture),this._reflectionTexture&&K.push(this._reflectionTexture),this._emissiveTexture&&K.push(this._emissiveTexture),this._specularTexture&&K.push(this._specularTexture),this._bumpTexture&&K.push(this._bumpTexture),this._lightmapTexture&&K.push(this._lightmapTexture),this._refractionTexture&&K.push(this._refractionTexture),K}hasTexture(K){return!!super.hasTexture(K)||(this._diffuseTexture===K||(this._ambientTexture===K||(this._opacityTexture===K||(this._reflectionTexture===K||(this._emissiveTexture===K||(this._specularTexture===K||(this._bumpTexture===K||(this._lightmapTexture===K||this._refractionTexture===K))))))))}dispose(K,Y){var l,v,U,d,A,c,t,Z,m;Y&&(null===(l=this._diffuseTexture)||void 0===l||l.dispose(),null===(v=this._ambientTexture)||void 0===v||v.dispose(),null===(U=this._opacityTexture)||void 0===U||U.dispose(),null===(d=this._reflectionTexture)||void 0===d||d.dispose(),null===(A=this._emissiveTexture)||void 0===A||A.dispose(),null===(c=this._specularTexture)||void 0===c||c.dispose(),null===(t=this._bumpTexture)||void 0===t||t.dispose(),null===(Z=this._lightmapTexture)||void 0===Z||Z.dispose(),null===(m=this._refractionTexture)||void 0===m||m.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(K,Y)}clone(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const v=r.c.Clone((()=>new e(K,this.va())),this,{cloneTexturesOnlyOnce:Y});return v.name=K,v.id=K,this.stencil.copyTo(v.stencil),this._clonePlugins(v,l),v}static Parse(K,Y,l){const v=r.c.Parse((()=>new e(K.name,Y)),K,Y,l);return K.stencil&&v.stencil.parse(K.stencil,Y,l),M.b._ParsePlugins(K,v,Y,l),v}static get DiffuseTextureEnabled(){return J.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(K){J.e.DiffuseTextureEnabled=K}static get DetailTextureEnabled(){return J.e.DetailTextureEnabled}static set DetailTextureEnabled(K){J.e.DetailTextureEnabled=K}static get AmbientTextureEnabled(){return J.e.AmbientTextureEnabled}static set AmbientTextureEnabled(K){J.e.AmbientTextureEnabled=K}static get OpacityTextureEnabled(){return J.e.OpacityTextureEnabled}static set OpacityTextureEnabled(K){J.e.OpacityTextureEnabled=K}static get ReflectionTextureEnabled(){return J.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(K){J.e.ReflectionTextureEnabled=K}static get EmissiveTextureEnabled(){return J.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(K){J.e.EmissiveTextureEnabled=K}static get SpecularTextureEnabled(){return J.e.SpecularTextureEnabled}static set SpecularTextureEnabled(K){J.e.SpecularTextureEnabled=K}static get BumpTextureEnabled(){return J.e.BumpTextureEnabled}static set BumpTextureEnabled(K){J.e.BumpTextureEnabled=K}static get LightmapTextureEnabled(){return J.e.LightmapTextureEnabled}static set LightmapTextureEnabled(K){J.e.LightmapTextureEnabled=K}static get RefractionTextureEnabled(){return J.e.RefractionTextureEnabled}static set RefractionTextureEnabled(K){J.e.RefractionTextureEnabled=K}static get ColorGradingTextureEnabled(){return J.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(K){J.e.ColorGradingTextureEnabled=K}static get FresnelEnabled(){return J.e.FresnelEnabled}static set FresnelEnabled(K){J.e.FresnelEnabled=K}}e.ForceGLSL=!1,(0,v.d)([(0,U.C)("diffuseTexture")],e.prototype,"_diffuseTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"diffuseTexture",void 0),(0,v.d)([(0,U.C)("ambientTexture")],e.prototype,"_ambientTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"ambientTexture",void 0),(0,v.d)([(0,U.C)("opacityTexture")],e.prototype,"_opacityTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"opacityTexture",void 0),(0,v.d)([(0,U.C)("reflectionTexture")],e.prototype,"_reflectionTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"reflectionTexture",void 0),(0,v.d)([(0,U.C)("emissiveTexture")],e.prototype,"_emissiveTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"emissiveTexture",void 0),(0,v.d)([(0,U.C)("specularTexture")],e.prototype,"_specularTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"specularTexture",void 0),(0,v.d)([(0,U.C)("bumpTexture")],e.prototype,"_bumpTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),(0,v.d)([(0,U.C)("lightmapTexture")],e.prototype,"_lightmapTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"lightmapTexture",void 0),(0,v.d)([(0,U.C)("refractionTexture")],e.prototype,"_refractionTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),(0,v.d)([(0,U.l)("ambient")],e.prototype,"ambientColor",void 0),(0,v.d)([(0,U.l)("diffuse")],e.prototype,"diffuseColor",void 0),(0,v.d)([(0,U.l)("specular")],e.prototype,"specularColor",void 0),(0,v.d)([(0,U.l)("emissive")],e.prototype,"emissiveColor",void 0),(0,v.d)([(0,U.J)()],e.prototype,"specularPower",void 0),(0,v.d)([(0,U.J)("useAlphaFromDiffuseTexture")],e.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"useAlphaFromDiffuseTexture",void 0),(0,v.d)([(0,U.J)("useEmissiveAsIllumination")],e.prototype,"_useEmissiveAsIllumination",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useEmissiveAsIllumination",void 0),(0,v.d)([(0,U.J)("linkEmissiveWithDiffuse")],e.prototype,"_linkEmissiveWithDiffuse",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkEmissiveWithDiffuse",void 0),(0,v.d)([(0,U.J)("useSpecularOverAlpha")],e.prototype,"_useSpecularOverAlpha",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useSpecularOverAlpha",void 0),(0,v.d)([(0,U.J)("useReflectionOverAlpha")],e.prototype,"_useReflectionOverAlpha",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useReflectionOverAlpha",void 0),(0,v.d)([(0,U.J)("disableLighting")],e.prototype,"_disableLighting",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsLightsDirty")],e.prototype,"disableLighting",void 0),(0,v.d)([(0,U.J)("useObjectSpaceNormalMap")],e.prototype,"_useObjectSpaceNormalMap",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useObjectSpaceNormalMap",void 0),(0,v.d)([(0,U.J)("useParallax")],e.prototype,"_useParallax",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useParallax",void 0),(0,v.d)([(0,U.J)("useParallaxOcclusion")],e.prototype,"_useParallaxOcclusion",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useParallaxOcclusion",void 0),(0,v.d)([(0,U.J)()],e.prototype,"parallaxScaleBias",void 0),(0,v.d)([(0,U.J)("roughness")],e.prototype,"_roughness",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"roughness",void 0),(0,v.d)([(0,U.J)()],e.prototype,"indexOfRefraction",void 0),(0,v.d)([(0,U.J)()],e.prototype,"invertRefractionY",void 0),(0,v.d)([(0,U.J)()],e.prototype,"alphaCutOff",void 0),(0,v.d)([(0,U.J)("useLightmapAsShadowmap")],e.prototype,"_useLightmapAsShadowmap",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useLightmapAsShadowmap",void 0),(0,v.d)([(0,U.q)("diffuseFresnelParameters")],e.prototype,"_diffuseFresnelParameters",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelDirty")],e.prototype,"diffuseFresnelParameters",void 0),(0,v.d)([(0,U.q)("opacityFresnelParameters")],e.prototype,"_opacityFresnelParameters",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],e.prototype,"opacityFresnelParameters",void 0),(0,v.d)([(0,U.q)("reflectionFresnelParameters")],e.prototype,"_reflectionFresnelParameters",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelDirty")],e.prototype,"reflectionFresnelParameters",void 0),(0,v.d)([(0,U.q)("refractionFresnelParameters")],e.prototype,"_refractionFresnelParameters",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelDirty")],e.prototype,"refractionFresnelParameters",void 0),(0,v.d)([(0,U.q)("emissiveFresnelParameters")],e.prototype,"_emissiveFresnelParameters",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelDirty")],e.prototype,"emissiveFresnelParameters",void 0),(0,v.d)([(0,U.J)("useReflectionFresnelFromSpecular")],e.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsFresnelDirty")],e.prototype,"useReflectionFresnelFromSpecular",void 0),(0,v.d)([(0,U.J)("useGlossinessFromSpecularMapAlpha")],e.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,v.d)([(0,U.J)("maxSimultaneousLights")],e.prototype,"_maxSimultaneousLights",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsLightsDirty")],e.prototype,"maxSimultaneousLights",void 0),(0,v.d)([(0,U.J)("invertNormalMapX")],e.prototype,"_invertNormalMapX",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertNormalMapX",void 0),(0,v.d)([(0,U.J)("invertNormalMapY")],e.prototype,"_invertNormalMapY",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertNormalMapY",void 0),(0,v.d)([(0,U.J)("twoSidedLighting")],e.prototype,"_twoSidedLighting",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"twoSidedLighting",void 0),(0,v.d)([(0,U.J)("applyDecalMapAfterDetailMap")],e.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,v.d)([(0,U.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"applyDecalMapAfterDetailMap",void 0),(0,g.f)("BABYLON.StandardMaterial",e),A.b.DefaultMaterialFactory=K=>new e("default material",K)},11907:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>Z});var v=l(675),U=l(706),d=l(465),A=l(740),c=l(800);l(11915);function t(K){let Y=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const l=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],d=[];let t=[];const Z=K.width||K.size||1,m=K.height||K.size||1,V=K.depth||K.size||1,M=K.wrap||!1;let u=void 0===K.topBaseAt?1:K.topBaseAt,o=void 0===K.bottomBaseAt?0:K.bottomBaseAt;u=(u+4)%4,o=(o+4)%4;let W=[2,0,3,1][u],g=[2,0,1,3][o],J=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(M){Y=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],J=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let K=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],l=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const v=[17,18,19,16],U=[22,23,20,21];for(;W>0;)K.unshift(K.pop()),v.unshift(v.pop()),W--;for(;g>0;)l.unshift(l.pop()),U.unshift(U.pop()),g--;K=K.flat(),l=l.flat(),J=J.concat(K).concat(l),Y.push(v[0],v[2],v[3],v[0],v[1],v[2]),Y.push(U[0],U[2],U[3],U[0],U[1],U[2])}const n=[Z/2,m/2,V/2];t=J.reduce(((K,Y,l)=>K.concat(Y*n[l%3])),[]);const R=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,H=K.faceUV||new Array(6),z=K.faceColors,r=[];for(let A=0;A<6;A++)void 0===H[A]&&(H[A]=new v.p(0,0,1,1)),z&&void 0===z[A]&&(z[A]=new U.g(1,1,1,1));for(let v=0;v<6;v++)if(d.push(H[v].z,c.d?1-H[v].w:H[v].w),d.push(H[v].x,c.d?1-H[v].w:H[v].w),d.push(H[v].x,c.d?1-H[v].y:H[v].y),d.push(H[v].z,c.d?1-H[v].y:H[v].y),z)for(let K=0;K<4;K++)r.push(z[v].r,z[v].g,z[v].b,z[v].a);A.c._ComputeSides(R,t,Y,l,d,K.frontUVs,K.backUVs);const E=new A.c;if(E.indices=Y,E.xa=t,E.ya=l,E.Aa=d,z){const K=R===A.c.DOUBLESIDE?r.concat(r):r;E.za=K}return E}function Z(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new d.e(K,l);Y.sideOrientation=d.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return t(Y).Ca(v,Y.updatable),v}A.c.CreateBox=t,d.e.CreateBox=function(K,Y){return Z(K,{size:Y,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11915:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>g,c:()=>n,i:()=>J});var v=l(675),U=l(706),d=l(465),A=l(740),c=l(730);d.e._GroundMeshParser=(K,Y)=>t.Parse(K,Y);class t extends d.e{constructor(K,Y){super(K,Y),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=K,this._subdivisionsY=K,this.subdivide(K);const l=this;l.createOrUpdateSubmeshesOctree&&l.createOrUpdateSubmeshesOctree(Y)}getHeightAtCoordinates(K,Y){const l=this.getWorldMatrix(),U=v.j.Matrix[5];l.invertToRef(U);const d=v.j.Qi[8];if(v.o.TransformCoordinatesFromFloatsToRef(K,0,Y,U,d),K=d.x,Y=d.z,K<this._minX||K>=this._maxX||Y<=this._minZ||Y>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(K,Y),c=-(A.x*K+A.z*Y+A.w)/A.y;return v.o.TransformCoordinatesFromFloatsToRef(0,c,0,l,d),d.y}getNormalAtCoordinates(K,Y){const l=new v.o(0,1,0);return this.getNormalAtCoordinatesToRef(K,Y,l),l}getNormalAtCoordinatesToRef(K,Y,l){const U=this.getWorldMatrix(),d=v.j.Matrix[5];U.invertToRef(d);const A=v.j.Qi[8];if(v.o.TransformCoordinatesFromFloatsToRef(K,0,Y,d,A),K=A.x,Y=A.z,K<this._minX||K>this._maxX||Y<this._minZ||Y>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const c=this._getFacetAt(K,Y);return v.o.TransformNormalFromFloatsToRef(c.x,c.y,c.z,U,l),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(K,Y){const l=Math.floor((K+this._maxX)*this._subdivisionsX/this._width),v=Math.floor(-(Y+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),U=this._heightQuads[v*this._subdivisionsX+l];let d;return d=Y<U.slope.x*K+U.slope.y?U.facet1:U.facet2,d}_initHeightQuads(){const K=this._subdivisionsX,Y=this._subdivisionsY;this._heightQuads=new Array;for(let l=0;l<Y;l++)for(let Y=0;Y<K;Y++){const U={slope:v.m.Zero(),facet1:new v.p(0,0,0,0),facet2:new v.p(0,0,0,0)};this._heightQuads[l*K+Y]=U}return this}_computeHeightQuads(){const K=this.getVerticesData(c.e.PositionKind);if(!K)return this;const Y=v.j.Qi[3],l=v.j.Qi[2],U=v.j.Qi[1],d=v.j.Qi[0],A=v.j.Qi[4],t=v.j.Qi[5],Z=v.j.Qi[6],m=v.j.Qi[7],V=v.j.Qi[8];let M=0,u=0,o=0,W=0,g=0,J=0,n=0;const R=this._subdivisionsX,H=this._subdivisionsY;for(let c=0;c<H;c++)for(let H=0;H<R;H++){M=3*H,u=c*(R+1)*3,o=(c+1)*(R+1)*3,Y.x=K[u+M],Y.y=K[u+M+1],Y.z=K[u+M+2],l.x=K[u+M+3],l.y=K[u+M+4],l.z=K[u+M+5],U.x=K[o+M],U.y=K[o+M+1],U.z=K[o+M+2],d.x=K[o+M+3],d.y=K[o+M+4],d.z=K[o+M+5],W=(d.z-Y.z)/(d.x-Y.x),g=Y.z-W*Y.x,l.subtractToRef(Y,A),U.subtractToRef(Y,t),d.subtractToRef(Y,Z),v.o.CrossToRef(Z,t,m),v.o.CrossToRef(A,Z,V),m.normalize(),V.normalize(),J=-(m.x*Y.x+m.y*Y.y+m.z*Y.z),n=-(V.x*l.x+V.y*l.y+V.z*l.z);const z=this._heightQuads[c*R+H];z.slope.mi(W,g),z.facet1.mi(m.x,m.y,m.z,J),z.facet2.mi(V.x,V.y,V.z,n)}return this}serialize(K){super.serialize(K),K.subdivisionsX=this._subdivisionsX,K.subdivisionsY=this._subdivisionsY,K.minX=this._minX,K.maxX=this._maxX,K.ti=this._minZ,K.maxZ=this._maxZ,K.width=this._width,K.height=this._height}static Parse(K,Y){const l=new t(K.name,Y);return l._subdivisionsX=K.subdivisionsX||1,l._subdivisionsY=K.subdivisionsY||1,l._minX=K.minX,l._maxX=K.maxX,l._minZ=K.ti,l._maxZ=K.maxZ,l._width=K.width,l._height=K.height,l}}var Z=l(475),m=l(526),V=l(681),M=l(800);function u(K){const Y=[],l=[],U=[],d=[];let c,t;const Z=K.width||K.size||1,m=K.height||K.size||1,V=0|(K.subdivisionsX||K.subdivisions||1),u=0|(K.subdivisionsY||K.subdivisions||1);for(c=0;c<=u;c++)for(t=0;t<=V;t++){const K=new v.o(t*Z/V-Z/2,0,(u-c)*m/u-m/2),Y=new v.o(0,1,0);l.push(K.x,K.y,K.z),U.push(Y.x,Y.y,Y.z),d.push(t/V,M.d?c/u:1-c/u)}for(c=0;c<u;c++)for(t=0;t<V;t++)Y.push(t+1+(c+1)*(V+1)),Y.push(t+1+c*(V+1)),Y.push(t+c*(V+1)),Y.push(t+(c+1)*(V+1)),Y.push(t+1+(c+1)*(V+1)),Y.push(t+c*(V+1));const o=new A.c;return o.indices=Y,o.xa=l,o.ya=U,o.Aa=d,o}function o(K){const Y=void 0!==K.xmin&&null!==K.xmin?K.xmin:-1,l=void 0!==K.zmin&&null!==K.zmin?K.zmin:-1,U=void 0!==K.xmax&&null!==K.xmax?K.xmax:1,d=void 0!==K.zmax&&null!==K.zmax?K.zmax:1,c=K.subdivisions||{w:1,h:1},t=K.precision||{w:1,h:1},Z=[],m=[],V=[],M=[];let u,o,W,g;c.h=c.h<1?1:c.h,c.w=c.w<1?1:c.w,t.w=t.w<1?1:t.w,t.h=t.h<1?1:t.h;const J=(U-Y)/c.w,n=(d-l)/c.h;function R(K,Y,l,U){const d=m.length/3,A=t.w+1;for(u=0;u<t.h;u++)for(o=0;o<t.w;o++){const K=[d+o+u*A,d+(o+1)+u*A,d+(o+1)+(u+1)*A,d+o+(u+1)*A];Z.push(K[1]),Z.push(K[2]),Z.push(K[3]),Z.push(K[0]),Z.push(K[1]),Z.push(K[3])}const c=v.o.Zero(),W=new v.o(0,1,0);for(u=0;u<=t.h;u++)for(c.z=u*(U-Y)/t.h+Y,o=0;o<=t.w;o++)c.x=o*(l-K)/t.w+K,c.y=0,m.push(c.x,c.y,c.z),V.push(W.x,W.y,W.z),M.push(o/t.w,u/t.h)}for(W=0;W<c.h;W++)for(g=0;g<c.w;g++)R(Y+g*J,l+W*n,Y+(g+1)*J,l+(W+1)*n);const H=new A.c;return H.indices=Z,H.xa=m,H.ya=V,H.Aa=M,H}function W(K){const Y=[],l=[],d=[],c=[];let t,Z;const m=K.colorFilter||new U.e(.3,.59,.11),M=K.alphaFilter||0;let u=!1;if(K.minHeight>K.maxHeight){u=!0;const Y=K.maxHeight;K.maxHeight=K.minHeight,K.minHeight=Y}for(t=0;t<=K.subdivisions;t++)for(Z=0;Z<=K.subdivisions;Z++){const Y=new v.o(Z*K.width/K.subdivisions-K.width/2,0,(K.subdivisions-t)*K.height/K.subdivisions-K.height/2),U=4*(((Y.x+K.width/2)/K.width*(K.bufferWidth-1)|0)+((1-(Y.z+K.height/2)/K.height)*(K.bufferHeight-1)|0)*K.bufferWidth);let A=K.buffer[U]/255,o=K.buffer[U+1]/255,W=K.buffer[U+2]/255;const g=K.buffer[U+3]/255;u&&(A=1-A,o=1-o,W=1-W);const J=A*m.r+o*m.g+W*m.b;Y.y=g>=M?K.minHeight+(K.maxHeight-K.minHeight)*J:K.minHeight-V.d,K.heightBuffer&&(K.heightBuffer[t*(K.subdivisions+1)+Z]=Y.y),l.push(Y.x,Y.y,Y.z),d.push(0,0,0),c.push(Z/K.subdivisions,1-t/K.subdivisions)}for(t=0;t<K.subdivisions;t++)for(Z=0;Z<K.subdivisions;Z++){const v=Z+1+(t+1)*(K.subdivisions+1),U=Z+1+t*(K.subdivisions+1),d=Z+t*(K.subdivisions+1),A=Z+(t+1)*(K.subdivisions+1),c=l[3*v+1]>=K.minHeight,m=l[3*U+1]>=K.minHeight,V=l[3*d+1]>=K.minHeight;c&&m&&V&&(Y.push(v),Y.push(U),Y.push(d));l[3*A+1]>=K.minHeight&&c&&V&&(Y.push(A),Y.push(v),Y.push(d))}A.c.ComputeNormals(l,Y,d);const o=new A.c;return o.indices=Y,o.xa=l,o.ya=d,o.Aa=c,o}function g(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=new t(K,arguments.length>2?arguments[2]:void 0);l._setReady(!1),l._subdivisionsX=Y.subdivisionsX||Y.subdivisions||1,l._subdivisionsY=Y.subdivisionsY||Y.subdivisions||1,l._width=Y.width||1,l._height=Y.height||1,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ;return u(Y).Ca(l,Y.updatable),l._setReady(!0),l}function J(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new d.e(K,l);return o(Y).Ca(v,Y.updatable),v}function n(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=l.width||10,A=l.height||10,c=l.subdivisions||1,V=l.minHeight||0,M=l.maxHeight||1,u=l.colorFilter||new U.e(.3,.59,.11),o=l.alphaFilter||0,g=l.updatable,J=l.onReady;v=v||m.e.LastCreatedScene;const n=new t(K,v);let R;n._subdivisionsX=c,n._subdivisionsY=c,n._width=d,n._height=A,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,n._setReady(!1),l.passHeightBufferInCallback&&(R=new Float32Array((c+1)*(c+1)));const H=(K,Y,l)=>{W({width:d,height:A,subdivisions:c,minHeight:V,maxHeight:M,colorFilter:u,buffer:K,bufferWidth:Y,bufferHeight:l,alphaFilter:o,heightBuffer:R}).Ca(n,g),J&&J(n,R),n._setReady(!0)};if("string"===typeof Y){const K=K=>{var Y;const l=K.width,U=K.height;if(v.u)return;const d=null===(Y=v)||void 0===Y?void 0:Y.getEngine().resizeImageBitmap(K,l,U);H(d,l,U)};Z.d.LoadImage(Y,K,l.onError?l.onError:()=>{},v.offlineProvider)}else H(Y.data,Y.width,Y.height);return n}A.c.CreateGround=u,A.c.CreateTiledGround=o,A.c.CreateGroundFromHeightMap=W,d.e.CreateGround=(K,Y,l,v,U,d)=>g(K,{width:Y,height:l,subdivisions:v,updatable:d},U),d.e.CreateTiledGround=(K,Y,l,v,U,d,A,c,t)=>J(K,{xmin:Y,zmin:l,xmax:v,zmax:U,subdivisions:d,precision:A,updatable:t},c),d.e.CreateGroundFromHeightMap=(K,Y,l,v,U,d,A,c,t,Z,m)=>n(K,Y,{width:l,height:v,subdivisions:U,minHeight:d,maxHeight:A,updatable:t,onReady:Z,alphaFilter:m},c)},12691:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>B,f:()=>i,g:()=>D});var v=l(675),U=l(465),d=l(740),A=l(706),c=l(730),t=l(12480),Z=l(835),m=l(702),V=l(2366),M=l(2299),u=l(619),o=l(11884),W=l(522),g=l(11876),J=l(526),n=l(853),R=l(837);const H={effect:null,subMesh:null};class z extends g.e{constructor(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(K,Y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new v.d,this._cachedWorldViewProjectionMatrix=new v.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=l,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Ri","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...U}}get shaderPath(){return this._shaderPath}set shaderPath(K){this._shaderPath=K}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(K){-1===this._options.uniforms.indexOf(K)&&this._options.uniforms.push(K)}setTexture(K,Y){return-1===this._options.samplers.indexOf(K)&&this._options.samplers.push(K),this._textures[K]=Y,this}removeTexture(K){delete this._textures[K]}setTextureArray(K,Y){return-1===this._options.samplers.indexOf(K)&&this._options.samplers.push(K),this._checkUniform(K),this._textureArrays[K]=Y,this}setExternalTexture(K,Y){return-1===this._options.externalTextures.indexOf(K)&&this._options.externalTextures.push(K),this._externalTextures[K]=Y,this}setFloat(K,Y){return this._checkUniform(K),this._floats[K]=Y,this}setInt(K,Y){return this._checkUniform(K),this._ints[K]=Y,this}setUInt(K,Y){return this._checkUniform(K),this._uints[K]=Y,this}setFloats(K,Y){return this._checkUniform(K),this._floatsArrays[K]=Y,this}setColor3(K,Y){return this._checkUniform(K),this._colors3[K]=Y,this}setColor3Array(K,Y){return this._checkUniform(K),this._colors3Arrays[K]=Y.reduce(((K,Y)=>(Y.toArray(K,K.length),K)),[]),this}setColor4(K,Y){return this._checkUniform(K),this._colors4[K]=Y,this}setColor4Array(K,Y){return this._checkUniform(K),this._colors4Arrays[K]=Y.reduce(((K,Y)=>(Y.toArray(K,K.length),K)),[]),this}setVector2(K,Y){return this._checkUniform(K),this._vectors2[K]=Y,this}setVector3(K,Y){return this._checkUniform(K),this._vectors3[K]=Y,this}setVector4(K,Y){return this._checkUniform(K),this._vectors4[K]=Y,this}setQuaternion(K,Y){return this._checkUniform(K),this._quaternions[K]=Y,this}setQuaternionArray(K,Y){return this._checkUniform(K),this._quaternionsArrays[K]=Y.reduce(((K,Y)=>(Y.toArray(K,K.length),K)),[]),this}setMatrix(K,Y){return this._checkUniform(K),this._matrices[K]=Y,this}setMatrices(K,Y){this._checkUniform(K);const l=new Float32Array(16*Y.length);for(let v=0;v<Y.length;v++){Y[v].copyToArray(l,16*v)}return this._matrixArrays[K]=l,this}setMatrix3x3(K,Y){return this._checkUniform(K),this._matrices3x3[K]=Y,this}setMatrix2x2(K,Y){return this._checkUniform(K),this._matrices2x2[K]=Y,this}setArray2(K,Y){return this._checkUniform(K),this._vectors2Arrays[K]=Y,this}setArray3(K,Y){return this._checkUniform(K),this._vectors3Arrays[K]=Y,this}setArray4(K,Y){return this._checkUniform(K),this._vectors4Arrays[K]=Y,this}setUniformBuffer(K,Y){return-1===this._options.uniformBuffers.indexOf(K)&&this._options.uniformBuffers.push(K),this._uniformBuffers[K]=Y,this}setTextureSampler(K,Y){return-1===this._options.samplerObjects.indexOf(K)&&this._options.samplerObjects.push(K),this._textureSamplers[K]=Y,this}setStorageBuffer(K,Y){return-1===this._options.storageBuffers.indexOf(K)&&this._options.storageBuffers.push(K),this._storageBuffers[K]=Y,this}setDefine(K,Y){const l=K.trimEnd()+" ",v=this.options.defines.findIndex((Y=>Y===K||Y.startsWith(l)));return v>=0&&this.options.defines.splice(v,1),("boolean"!==typeof Y||Y)&&this.options.defines.push(l+Y),this}isReadyForSubMesh(K,Y,l){return this.isReady(K,l,Y)}isReady(K,Y,l){var v;const U=l&&this._storeEffectOnSubMeshes;if(this.isFrozen){const K=U?l._drawWrapper:this._drawWrapper;if(K.effect&&K._wasPreviouslyReady&&K._wasPreviouslyUsingInstances===Y)return!0}const d=this.va(),A=d.getEngine(),t=[],Z=[],m=new o.e;let M=this._shaderPath,u=this._options.uniforms,W=this._options.uniformBuffers,g=this._options.samplers;A.getCaps().multiview&&d.activeCamera&&d.activeCamera.outputRenderTarget&&d.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,t.push("#define MULTIVIEW"),-1!==u.indexOf("viewProjection")&&-1===u.indexOf("viewProjectionR")&&u.push("viewProjectionR"));for(let c=0;c<this._options.defines.length;c++){const K=0===this._options.defines[c].indexOf("#define")?this._options.defines[c]:`#define ${this._options.defines[c]}`;t.push(K)}for(let c=0;c<this._options.attributes.length;c++)Z.push(this._options.attributes[c]);if(K&&K.isVerticesDataPresent(c.e.ColorKind)&&(-1===Z.indexOf(c.e.ColorKind)&&Z.push(c.e.ColorKind),t.push("#define VERTEXCOLOR")),Y&&(t.push("#define INSTANCES"),(0,R.fb)(Z,this._materialHelperNeedsPreviousMatrices),null!==K&&void 0!==K&&K.hasThinInstances&&(t.push("#define THIN_INSTANCES"),K&&K.isVerticesDataPresent(c.e.ColorInstanceKind)&&(Z.push(c.e.ColorInstanceKind),t.push("#define INSTANCESCOLOR")))),K&&K.useBones&&K.computeBonesUsingShaders&&K.skeleton){Z.push(c.e.MatricesIndicesKind),Z.push(c.e.MatricesWeightsKind),K.numBoneInfluencers>4&&(Z.push(c.e.MatricesIndicesExtraKind),Z.push(c.e.MatricesWeightsExtraKind));const Y=K.skeleton;t.push("#define NUM_BONE_INFLUENCERS "+K.numBoneInfluencers),m.addCPUSkinningFallback(0,K),Y.isUsingTextureForMatrices?(t.push("#define BONETEXTURE"),-1===u.indexOf("boneTextureWidth")&&u.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(t.push("#define BonesPerMesh "+(Y.bones.length+1)),-1===u.indexOf("mBones")&&u.push("mBones"))}else t.push("#define NUM_BONE_INFLUENCERS 0");let J=0;const z=K?K.morphTargetManager:null;if(z){const K=z.supportsUVs&&-1!==t.indexOf("#define UV1"),Y=z.supportsTangents&&-1!==t.indexOf("#define TANGENT"),l=z.supportsNormals&&-1!==t.indexOf("#define NORMAL");J=z.numMaxInfluencers||z.numInfluencers,K&&t.push("#define MORPHTARGETS_UV"),Y&&t.push("#define MORPHTARGETS_TANGENT"),l&&t.push("#define MORPHTARGETS_NORMAL"),J>0&&t.push("#define MORPHTARGETS"),z.isUsingTextureForTargets&&(t.push("#define MORPHTARGETS_TEXTURE"),-1===u.indexOf("morphTargetTextureIndices")&&u.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),t.push("#define NUM_MORPH_INFLUENCERS "+J);for(let v=0;v<J;v++)Z.push(c.e.PositionKind+v),l&&Z.push(c.e.NormalKind+v),Y&&Z.push(c.e.TangentKind+v),K&&Z.push(c.e.UVKind+"_"+v);J>0&&(u=u.slice(),u.push("morphTargetInfluences"),u.push("morphTargetCount"),u.push("morphTargetTextureInfo"),u.push("morphTargetTextureIndices"))}else t.push("#define NUM_MORPH_INFLUENCERS 0");if(K){const Y=K.bakedVertexAnimationManager;Y&&Y.isEnabled&&(t.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===u.indexOf("bakedVertexAnimationSettings")&&u.push("bakedVertexAnimationSettings"),-1===u.indexOf("bakedVertexAnimationTextureSizeInverted")&&u.push("bakedVertexAnimationTextureSizeInverted"),-1===u.indexOf("bakedVertexAnimationTime")&&u.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,R.z)(Z,K,t)}for(const c in this._textures)if(!this._textures[c].isReady())return!1;K&&this._shouldTurnAlphaTestOn(K)&&t.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,n.b)(u),(0,n.h)(this,d,t)),d.fogEnabled&&null!==K&&void 0!==K&&K.applyFog&&d.fogMode!==V.b.FOGMODE_NONE&&(t.push("#define FOG"),-1===u.indexOf("view")&&u.push("view"),-1===u.indexOf("vFogInfos")&&u.push("vFogInfos"),-1===u.indexOf("vFogColor")&&u.push("vFogColor")),this._useLogarithmicDepth&&(t.push("#define LOGARITHMICDEPTH"),-1===u.indexOf("logarithmicDepthConstant")&&u.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(u=u.slice(),W=W.slice(),g=g.slice(),M=this.customShaderNameResolve(this.name,u,W,g,t,Z));const r=U?l._getDrawWrapper(void 0,!0):this._drawWrapper,E=(null===r||void 0===r?void 0:r.effect)??null,y=(null===r||void 0===r?void 0:r.defines)??null,T=t.join("\n");let e=E;return y!==T&&(e=A.createEffect(M,{attributes:Z,uniformsNames:u,uniformBuffersNames:W,samplers:g,defines:T,fallbacks:m,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:J},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},A),U?l.setEffect(e,T,this._materialContext):r&&r.setEffect(e,T),this._onEffectCreatedObservable&&(H.effect=e,H.subMesh=l??(null===K||void 0===K?void 0:K.ui[0])??null,this._onEffectCreatedObservable.notifyObservers(H))),r._wasPreviouslyUsingInstances=!!Y,!((null===(v=e)||void 0===v||!v.isReady())??1)&&(E!==e&&d.resetCachedMaterial(),r._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(K,Y){const l=this.va(),v=Y??this.getEffect();v&&(-1!==this._options.uniforms.indexOf("world")&&v.setMatrix("world",K),-1!==this._options.uniforms.indexOf("worldView")&&(K.multiplyToRef(l.getViewMatrix(),this._cachedWorldViewMatrix),v.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(K.multiplyToRef(l.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),v.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&v.setMatrix("view",l.getViewMatrix()))}bindForSubMesh(K,Y,l){var v;this.bind(K,Y,null===(v=l._drawWrapperOverride)||void 0===v?void 0:v.effect,l)}bind(K,Y,l,v){const U=v&&this._storeEffectOnSubMeshes,d=l??(U?v.effect:this.getEffect());if(!d)return;const A=this.va();this._activeEffect=d,this.bindOnlyWorldMatrix(K,l);const c=this._options.uniformBuffers;let t=!1;if(d&&c&&c.length>0&&A.getEngine().supportsUniformBuffers)for(let V=0;V<c.length;++V){switch(c[V]){case"Mesh":Y&&(Y.getMeshUniformBuffer().bindToEffect(d,"Mesh"),Y.transferToEffect(K));break;case"Scene":(0,R.q)(d,A.getSceneUniformBuffer()),A.finalizeSceneUbo(),t=!0}}const Z=Y&&U?this._mustRebind(A,d,v,Y.visibility):A.getCachedMaterial()!==this;if(d&&Z){let K;for(K in t||-1===this._options.uniforms.indexOf("view")||d.setMatrix("view",A.getViewMatrix()),t||-1===this._options.uniforms.indexOf("projection")||d.setMatrix("projection",A.getProjectionMatrix()),t||-1===this._options.uniforms.indexOf("viewProjection")||(d.setMatrix("viewProjection",A.getTransformMatrix()),this._multiview&&d.setMatrix("viewProjectionR",A._transformMatrixR)),A.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&d.setVector3("cameraPosition",A.activeCamera.globalPosition),(0,R.b)(Y,d),(0,n.c)(d,this,A),this._useLogarithmicDepth&&(0,R.k)(U?v.materialDefines:d.defines,d,A),Y&&(0,R.e)(A,Y,d),this._textures)d.setTexture(K,this._textures[K]);for(K in this._textureArrays)d.setTextureArray(K,this._textureArrays[K]);for(K in this._ints)d.setInt(K,this._ints[K]);for(K in this._uints)d.setUInt(K,this._uints[K]);for(K in this._floats)d.setFloat(K,this._floats[K]);for(K in this._floatsArrays)d.setArray(K,this._floatsArrays[K]);for(K in this._colors3)d.setColor3(K,this._colors3[K]);for(K in this._colors3Arrays)d.setArray3(K,this._colors3Arrays[K]);for(K in this._colors4){const Y=this._colors4[K];d.setFloat4(K,Y.r,Y.g,Y.b,Y.a)}for(K in this._colors4Arrays)d.setArray4(K,this._colors4Arrays[K]);for(K in this._vectors2)d.setVector2(K,this._vectors2[K]);for(K in this._vectors3)d.setVector3(K,this._vectors3[K]);for(K in this._vectors4)d.setVector4(K,this._vectors4[K]);for(K in this._quaternions)d.setQuaternion(K,this._quaternions[K]);for(K in this._matrices)d.setMatrix(K,this._matrices[K]);for(K in this._matrixArrays)d.setMatrices(K,this._matrixArrays[K]);for(K in this._matrices3x3)d.setMatrix3x3(K,this._matrices3x3[K]);for(K in this._matrices2x2)d.setMatrix2x2(K,this._matrices2x2[K]);for(K in this._vectors2Arrays)d.setArray2(K,this._vectors2Arrays[K]);for(K in this._vectors3Arrays)d.setArray3(K,this._vectors3Arrays[K]);for(K in this._vectors4Arrays)d.setArray4(K,this._vectors4Arrays[K]);for(K in this._quaternionsArrays)d.setArray4(K,this._quaternionsArrays[K]);for(K in this._uniformBuffers){const Y=this._uniformBuffers[K].getBuffer();Y&&d.bindUniformBuffer(Y,K)}const l=A.getEngine(),c=l.setExternalTexture;if(c)for(K in this._externalTextures)c.call(l,K,this._externalTextures[K]);const Z=l.setTextureSampler;if(Z)for(K in this._textureSamplers)Z.call(l,K,this._textureSamplers[K]);const m=l.setStorageBuffer;if(m)for(K in this._storageBuffers)m.call(l,K,this._storageBuffers[K])}if(d&&Y&&(Z||!this.isFrozen)){const K=Y.morphTargetManager;K&&K.numInfluencers>0&&(0,R.n)(Y,d);const l=Y.bakedVertexAnimationManager;if(l&&l.isEnabled){var m;const K=U?v._drawWrapper:this._drawWrapper;null===(m=Y.bakedVertexAnimationManager)||void 0===m||m.bind(d,!!K._wasPreviouslyUsingInstances)}}this._afterBind(Y,d,v)}getActiveTextures(){const K=super.getActiveTextures();for(const Y in this._textures)K.push(this._textures[Y]);for(const Y in this._textureArrays){const l=this._textureArrays[Y];for(let Y=0;Y<l.length;Y++)K.push(l[Y])}return K}hasTexture(K){if(super.hasTexture(K))return!0;for(const Y in this._textures)if(this._textures[Y]===K)return!0;for(const Y in this._textureArrays){const l=this._textureArrays[Y];for(let Y=0;Y<l.length;Y++)if(l[Y]===K)return!0}return!1}clone(K){const Y=m.c.Clone((()=>new z(K,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);Y.name=K,Y.id=K,"object"===typeof Y._shaderPath&&(Y._shaderPath={...Y._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((K=>{const Y=this._options[K];Array.isArray(Y)&&(this._options[K]=Y.slice(0))})),this.stencil.copyTo(Y.stencil);for(const l in this._textures)Y.setTexture(l,this._textures[l]);for(const l in this._textureArrays)Y.setTextureArray(l,this._textureArrays[l]);for(const l in this._externalTextures)Y.setExternalTexture(l,this._externalTextures[l]);for(const l in this._ints)Y.setInt(l,this._ints[l]);for(const l in this._uints)Y.setUInt(l,this._uints[l]);for(const l in this._floats)Y.setFloat(l,this._floats[l]);for(const l in this._floatsArrays)Y.setFloats(l,this._floatsArrays[l]);for(const l in this._colors3)Y.setColor3(l,this._colors3[l]);for(const l in this._colors3Arrays)Y._colors3Arrays[l]=this._colors3Arrays[l];for(const l in this._colors4)Y.setColor4(l,this._colors4[l]);for(const l in this._colors4Arrays)Y._colors4Arrays[l]=this._colors4Arrays[l];for(const l in this._vectors2)Y.setVector2(l,this._vectors2[l]);for(const l in this._vectors3)Y.setVector3(l,this._vectors3[l]);for(const l in this._vectors4)Y.setVector4(l,this._vectors4[l]);for(const l in this._quaternions)Y.setQuaternion(l,this._quaternions[l]);for(const l in this._quaternionsArrays)Y._quaternionsArrays[l]=this._quaternionsArrays[l];for(const l in this._matrices)Y.setMatrix(l,this._matrices[l]);for(const l in this._matrixArrays)Y._matrixArrays[l]=this._matrixArrays[l].slice();for(const l in this._matrices3x3)Y.setMatrix3x3(l,this._matrices3x3[l]);for(const l in this._matrices2x2)Y.setMatrix2x2(l,this._matrices2x2[l]);for(const l in this._vectors2Arrays)Y.setArray2(l,this._vectors2Arrays[l]);for(const l in this._vectors3Arrays)Y.setArray3(l,this._vectors3Arrays[l]);for(const l in this._vectors4Arrays)Y.setArray4(l,this._vectors4Arrays[l]);for(const l in this._uniformBuffers)Y.setUniformBuffer(l,this._uniformBuffers[l]);for(const l in this._textureSamplers)Y.setTextureSampler(l,this._textureSamplers[l]);for(const l in this._storageBuffers)Y.setStorageBuffer(l,this._storageBuffers[l]);return Y}dispose(K,Y,l){if(Y){let K;for(K in this._textures)this._textures[K].dispose();for(K in this._textureArrays){const Y=this._textureArrays[K];for(let K=0;K<Y.length;K++)Y[K].dispose()}}this._textures={},super.dispose(K,Y,l)}serialize(){const K=m.c.Serialize(this);let Y;for(Y in K.customType="BABYLON.ShaderMaterial",K.uniqueId=this.uniqueId,K.options=this._options,K.shaderPath=this._shaderPath,K.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,K.stencil=this.stencil.serialize(),K.textures={},this._textures)K.textures[Y]=this._textures[Y].serialize();for(Y in K.textureArrays={},this._textureArrays){K.textureArrays[Y]=[];const l=this._textureArrays[Y];for(let v=0;v<l.length;v++)K.textureArrays[Y].push(l[v].serialize())}for(Y in K.ints={},this._ints)K.ints[Y]=this._ints[Y];for(Y in K.uints={},this._uints)K.uints[Y]=this._uints[Y];for(Y in K.floats={},this._floats)K.floats[Y]=this._floats[Y];for(Y in K.floatsArrays={},this._floatsArrays)K.floatsArrays[Y]=this._floatsArrays[Y];for(Y in K.colors3={},this._colors3)K.colors3[Y]=this._colors3[Y].zi();for(Y in K.colors3Arrays={},this._colors3Arrays)K.colors3Arrays[Y]=this._colors3Arrays[Y];for(Y in K.colors4={},this._colors4)K.colors4[Y]=this._colors4[Y].zi();for(Y in K.colors4Arrays={},this._colors4Arrays)K.colors4Arrays[Y]=this._colors4Arrays[Y];for(Y in K.vectors2={},this._vectors2)K.vectors2[Y]=this._vectors2[Y].zi();for(Y in K.vectors3={},this._vectors3)K.vectors3[Y]=this._vectors3[Y].zi();for(Y in K.vectors4={},this._vectors4)K.vectors4[Y]=this._vectors4[Y].zi();for(Y in K.quaternions={},this._quaternions)K.quaternions[Y]=this._quaternions[Y].zi();for(Y in K.matrices={},this._matrices)K.matrices[Y]=this._matrices[Y].zi();for(Y in K.matrixArray={},this._matrixArrays)K.matrixArray[Y]=this._matrixArrays[Y];for(Y in K.matrices3x3={},this._matrices3x3)K.matrices3x3[Y]=this._matrices3x3[Y];for(Y in K.matrices2x2={},this._matrices2x2)K.matrices2x2[Y]=this._matrices2x2[Y];for(Y in K.vectors2Arrays={},this._vectors2Arrays)K.vectors2Arrays[Y]=this._vectors2Arrays[Y];for(Y in K.vectors3Arrays={},this._vectors3Arrays)K.vectors3Arrays[Y]=this._vectors3Arrays[Y];for(Y in K.vectors4Arrays={},this._vectors4Arrays)K.vectors4Arrays[Y]=this._vectors4Arrays[Y];for(Y in K.quaternionsArrays={},this._quaternionsArrays)K.quaternionsArrays[Y]=this._quaternionsArrays[Y];return K}static Parse(K,Y,l){const U=m.c.Parse((()=>new z(K.name,Y,K.shaderPath,K.options,K.storeEffectOnSubMeshes)),K,Y,l);let d;for(d in K.stencil&&U.stencil.parse(K.stencil,Y,l),K.textures)U.setTexture(d,M.c.Parse(K.textures[d],Y,l));for(d in K.textureArrays){const v=K.textureArrays[d],A=[];for(let K=0;K<v.length;K++)A.push(M.c.Parse(v[K],Y,l));U.setTextureArray(d,A)}for(d in K.ints)U.setInt(d,K.ints[d]);for(d in K.uints)U.setUInt(d,K.uints[d]);for(d in K.floats)U.setFloat(d,K.floats[d]);for(d in K.floatsArrays)U.setFloats(d,K.floatsArrays[d]);for(d in K.colors3)U.setColor3(d,A.e.yi(K.colors3[d]));for(d in K.colors3Arrays){const Y=K.colors3Arrays[d].reduce(((K,Y,l)=>(l%3===0?K.push([Y]):K[K.length-1].push(Y),K)),[]).map((K=>A.e.yi(K)));U.setColor3Array(d,Y)}for(d in K.colors4)U.setColor4(d,A.g.yi(K.colors4[d]));for(d in K.colors4Arrays){const Y=K.colors4Arrays[d].reduce(((K,Y,l)=>(l%4===0?K.push([Y]):K[K.length-1].push(Y),K)),[]).map((K=>A.g.yi(K)));U.setColor4Array(d,Y)}for(d in K.vectors2)U.setVector2(d,v.m.yi(K.vectors2[d]));for(d in K.vectors3)U.setVector3(d,v.o.yi(K.vectors3[d]));for(d in K.vectors4)U.setVector4(d,v.p.yi(K.vectors4[d]));for(d in K.quaternions)U.setQuaternion(d,v.h.yi(K.quaternions[d]));for(d in K.matrices)U.setMatrix(d,v.d.yi(K.matrices[d]));for(d in K.matrixArray)U._matrixArrays[d]=new Float32Array(K.matrixArray[d]);for(d in K.matrices3x3)U.setMatrix3x3(d,K.matrices3x3[d]);for(d in K.matrices2x2)U.setMatrix2x2(d,K.matrices2x2[d]);for(d in K.vectors2Arrays)U.setArray2(d,K.vectors2Arrays[d]);for(d in K.vectors3Arrays)U.setArray3(d,K.vectors3Arrays[d]);for(d in K.vectors4Arrays)U.setArray4(d,K.vectors4Arrays[d]);for(d in K.quaternionsArrays)U.setArray4(d,K.quaternionsArrays[d]);return U}static ParseFromFileAsync(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((U,d)=>{const A=new W.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const Y=JSON.parse(A.responseText),d=this.Parse(Y,l||J.e.LastCreatedScene,v);K&&(d.name=K),U(d)}else d("Unable to load the ShaderMaterial")})),A.open("GET",Y),A.send()}))}static ParseFromSnippetAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((v,U)=>{const d=new W.e;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const U=JSON.parse(JSON.parse(d.responseText).jsonPayload),A=JSON.parse(U.shaderMaterial),c=this.Parse(A,Y||J.e.LastCreatedScene,l);c.snippetId=K,v(c)}else U("Unable to load the snippet "+K)})),d.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),d.send()}))}}z.SnippetUrl="https://snippet.babylonjs.com",z.CreateFromSnippetAsync=z.ParseFromSnippetAsync,(0,u.f)("BABYLON.ShaderMaterial",z),U.e._LinesMeshParser=(K,Y)=>r.Parse(K,Y);class r extends U.e{_isShaderMaterial(K){return"ShaderMaterial"===K.getClassName()}constructor(K){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0;super(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y,arguments.length>4?arguments[4]:void 0),this.useVertexColor=v,this.useVertexAlpha=U,this.color=new A.e(1,1,1),this.alpha=1,this._shaderLanguage=0,Y&&(this.color=Y.color.clone(),this.alpha=Y.alpha,this.useVertexColor=Y.useVertexColor,this.useVertexAlpha=Y.useVertexAlpha),this.intersectionThreshold=.1;const t={attributes:[c.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===U?t.needAlphaBlending=!1:t.defines.push("#define VERTEXALPHA"),v?(t.defines.push("#define VERTEXCOLOR"),t.attributes.push(c.e.ColorKind)):(t.uniforms.push("color"),this._color4=new A.g),d)this.material=d;else{this.va().getEngine().isWebGPU&&!r.ForceGLSL&&(this._shaderLanguage=1),t.shaderLanguage=this._shaderLanguage,t.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([l.e(42).then(l.bind(l,13476)),l.e(53).then(l.bind(l,13478))]):await Promise.all([l.e(47).then(l.bind(l,13482)),l.e(54).then(l.bind(l,13485))])},this.material=new z("colorShader",this.va(),"color",t,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(K){this._lineMaterial=K,this._lineMaterial.fillMode=Z.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(K){}_bind(K,Y){if(!this._geometry)return this;const l=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(Y,l):this._geometry._bind(Y,l,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:K,g:Y,b:l}=this.color;this._color4.set(K,Y,l,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(K,Y,l){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const v=this.va().getEngine();return this._unIndexed?v.drawArraysType(Z.b.LineListDrawMode,K.verticesStart,K.verticesCount,l):v.drawElementsType(Z.b.LineListDrawMode,K.indexStart,K.indexCount,l),this}dispose(K){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(K)}clone(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;return new r(K,this.va(),Y,this,l)}createInstance(K){const Y=new E(K,this);if(this.instancedBuffers){Y.instancedBuffers={};for(const K in this.instancedBuffers)Y.instancedBuffers[K]=this.instancedBuffers[K]}return Y}serialize(K){super.serialize(K),K.color=this.color.zi(),K.alpha=this.alpha}static Parse(K,Y){const l=new r(K.name,Y);return l.color=A.e.yi(K.color),l.alpha=K.alpha,l}}r.ForceGLSL=!1;class E extends t.c{constructor(K,Y){super(K,Y),this.intersectionThreshold=Y.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var y=l(492);function T(K){const Y=[],l=[],v=K.lines,U=K.za,A=[];let c=0;for(let d=0;d<v.length;d++){const K=v[d];for(let v=0;v<K.length;v++){const{x:t,y:Z,z:m}=K[v];if(l.push(t,Z,m),U){const K=U[d],{r:Y,g:l,b:c,a:t}=K[v];A.push(Y,l,c,t)}v>0&&(Y.push(c-1),Y.push(c)),c++}}const t=new d.c;return t.indices=Y,t.xa=l,U&&(t.za=A),t}function e(K){const Y=K.dashSize||3,l=K.gapSize||1,U=K.dashNb||200,A=K.points,c=[],t=[],Z=v.o.Zero();let m=0,V=0,M=0,u=0,o=0,W=0,g=0;for(g=0;g<A.length-1;g++)A[g+1].subtractToRef(A[g],Z),m+=Z.length();for(M=m/U,u=Y*M/(Y+l),g=0;g<A.length-1;g++){A[g+1].subtractToRef(A[g],Z),V=Math.floor(Z.length()/M),Z.normalize();for(let K=0;K<V;K++)o=M*K,c.push(A[g].x+o*Z.x,A[g].y+o*Z.y,A[g].z+o*Z.z),c.push(A[g].x+(o+u)*Z.x,A[g].y+(o+u)*Z.y,A[g].z+(o+u)*Z.z),t.push(W,W+1),W+=2}const J=new d.c;return J.xa=c,J.indices=t,J}function i(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=Y.instance,U=Y.lines,d=Y.za;if(v){const K=v.getVerticesData(c.e.PositionKind);let Y,l;d&&(Y=v.getVerticesData(c.e.ColorKind));let A=0,t=0;for(let v=0;v<U.length;v++){const c=U[v];for(let U=0;U<c.length;U++)K[A]=c[U].x,K[A+1]=c[U].y,K[A+2]=c[U].z,d&&Y&&(l=d[v],Y[t]=l[U].r,Y[t+1]=l[U].g,Y[t+2]=l[U].b,Y[t+3]=l[U].a,t+=4),A+=3}return v.updateVerticesData(c.e.PositionKind,K,!1,!1),d&&Y&&v.updateVerticesData(c.e.ColorKind,Y,!1,!1),v.refreshBoundingInfo(),v}const A=new r(K,l,null,void 0,void 0,!!d,Y.useVertexAlpha,Y.material);return T(Y).Ca(A,Y.updatable),A}function D(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=Y.za?[Y.za]:null;return i(K,{lines:[Y.points],updatable:Y.updatable,instance:Y.instance,za:v,useVertexAlpha:Y.useVertexAlpha,material:Y.material},l)}function B(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=Y.points,A=Y.instance,c=Y.gapSize||1,t=Y.dashSize||3;if(A){const K=K=>{const Y=v.o.Zero(),l=K.length/6;let U=0,c=0,t=0,Z=0,m=0,V=0,M=0,u=0;for(M=0;M<d.length-1;M++)d[M+1].subtractToRef(d[M],Y),U+=Y.length();t=U/l;const o=A._creationDataStorage.dashSize;for(Z=o*t/(o+A._creationDataStorage.gapSize),M=0;M<d.length-1;M++)for(d[M+1].subtractToRef(d[M],Y),c=Math.floor(Y.length()/t),Y.normalize(),u=0;u<c&&V<K.length;)m=t*u,K[V]=d[M].x+m*Y.x,K[V+1]=d[M].y+m*Y.y,K[V+2]=d[M].z+m*Y.z,K[V+3]=d[M].x+(m+Z)*Y.x,K[V+4]=d[M].y+(m+Z)*Y.y,K[V+5]=d[M].z+(m+Z)*Y.z,V+=6,u++;for(;V<K.length;)K[V]=d[M].x,K[V+1]=d[M].y,K[V+2]=d[M].z,V+=3};return(Y.dashNb||Y.dashSize||Y.gapSize||Y.useVertexAlpha||Y.material)&&y.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),A.updateMeshPositions(K,!1),A}const Z=new r(K,l,null,void 0,void 0,void 0,Y.useVertexAlpha,Y.material);return e(Y).Ca(Z,Y.updatable),Z._creationDataStorage=new U.f,Z._creationDataStorage.dashSize=t,Z._creationDataStorage.gapSize=c,Z}d.c.CreateLineSystem=T,d.c.CreateDashedLines=e,U.e.Di=function(K,Y){return D(K,{points:Y,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},U.e.CreateDashedLines=function(K,Y,l,v,U){return B(K,{points:Y,dashSize:l,gapSize:v,dashNb:U,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11956:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>c,c:()=>t});var v=l(465),U=l(740),d=l(800);function A(K){const Y=[],l=[],v=[],A=[],c=K.width||K.size||1,t=K.height||K.size||1,Z=0===K.sideOrientation?0:K.sideOrientation||U.c.DEFAULTSIDE,m=c/2,V=t/2;l.push(-m,-V,0),v.push(0,0,-1),A.push(0,d.d?1:0),l.push(m,-V,0),v.push(0,0,-1),A.push(1,d.d?1:0),l.push(m,V,0),v.push(0,0,-1),A.push(1,d.d?0:1),l.push(-m,V,0),v.push(0,0,-1),A.push(0,d.d?0:1),Y.push(0),Y.push(1),Y.push(2),Y.push(0),Y.push(2),Y.push(3),U.c._ComputeSides(Z,l,Y,v,A,K.frontUVs,K.backUVs);const M=new U.c;return M.indices=Y,M.xa=l,M.ya=v,M.Aa=A,M}function c(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new v.e(K,l);Y.sideOrientation=v.e._GetDefaultSideOrientation(Y.sideOrientation),U._originalBuilderSideOrientation=Y.sideOrientation;return A(Y).Ca(U,Y.updatable),Y.sourcePlane&&(U.translate(Y.sourcePlane.Ri,-Y.sourcePlane.d),U.setDirection(Y.sourcePlane.Ri.scale(-1))),U}const t={Ei:c};U.c.Ei=A,v.e.Ei=(K,Y,l,v,U)=>c(K,{size:Y,width:Y,height:Y,sideOrientation:U,updatable:v},l)},12139:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>t});var v=l(675),U=l(465),d=l(740),A=l(800);function c(K){const Y=0|(K.segments||32),l=K.diameterX||K.diameter||1,U=K.diameterY||K.diameter||1,c=K.diameterZ||K.diameter||1,t=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,Z=K.slice&&K.slice<=0?1:K.slice||1,m=0===K.sideOrientation?0:K.sideOrientation||d.c.DEFAULTSIDE,V=!!K.dedupTopBottomIndices,M=new v.o(l/2,U/2,c/2),u=2+Y,o=2*u,W=[],g=[],J=[],n=[];for(let d=0;d<=u;d++){const K=d/u,Y=K*Math.PI*Z;for(let l=0;l<=o;l++){const U=l/o,d=U*Math.PI*2*t,c=v.d.RotationZ(-Y),Z=v.d.RotationY(d),m=v.o.TransformCoordinates(v.o.Up(),c),V=v.o.TransformCoordinates(m,Z),u=V.multiply(M),W=V.divide(M).normalize();g.push(u.x,u.y,u.z),J.push(W.x,W.y,W.z),n.push(U,A.d?1-K:K)}if(d>0){const K=g.length/3;for(let Y=K-2*(o+1);Y+o+2<K;Y++)V?(d>1&&(W.push(Y),W.push(Y+1),W.push(Y+o+1)),(d<u||Z<1)&&(W.push(Y+o+1),W.push(Y+1),W.push(Y+o+2))):(W.push(Y),W.push(Y+1),W.push(Y+o+1),W.push(Y+o+1),W.push(Y+1),W.push(Y+o+2))}}d.c._ComputeSides(m,g,W,J,n,K.frontUVs,K.backUVs);const R=new d.c;return R.indices=W,R.xa=g,R.ya=J,R.Aa=n,R}function t(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return c(Y).Ca(v,Y.updatable),v}d.c.CreateSphere=c,U.e.CreateSphere=(K,Y,l,v,U,d)=>t(K,{segments:Y,diameterX:l,diameterY:l,diameterZ:l,sideOrientation:d,updatable:U},v)},12499:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>V});var v=l(475),U=l(2457),d=l(794),A=l(730),c=l(740),t=l(492);function Z(K,Y,l,v,U){let d=null,A=null,c=null;try{let t;d=new K.Decoder,A=new K.DecoderBuffer,A.Init(Y,Y.byteLength);const Z=d.GetEncodedGeometryType(A);switch(Z){case K.TRIANGULAR_MESH:{const Y=new K.Mesh;if(t=d.DecodeBufferToMesh(A,Y),!t.ok()||0===Y.ptr)throw new Error(t.error_msg());const l=3*Y.num_faces(),U=4*l,Z=K._malloc(U);try{d.GetTrianglesUInt32Array(Y,U,Z);const A=new Uint32Array(l);A.set(new Uint32Array(K.HEAPF32.buffer,Z,l)),v(A)}finally{K._free(Z)}c=Y;break}case K.POINT_CLOUD:{const Y=new K.PointCloud;if(t=d.DecodeBufferToPointCloud(A,Y),!t.ok()||!Y.ptr)throw new Error(t.error_msg());c=Y;break}default:throw new Error(`Invalid geometry type ${Z}`)}const m=c.num_points(),V=(Y,l,v,d)=>{const A=d.data_type(),c=d.num_components(),t=d.normalized(),Z=d.byte_stride(),V=d.byte_offset(),M={[K.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:K.HEAPF32},[K.DT_INT8]:{typedArrayConstructor:Int8Array,heap:K.HEAP8},[K.DT_INT16]:{typedArrayConstructor:Int16Array,heap:K.HEAP16},[K.DT_INT32]:{typedArrayConstructor:Int32Array,heap:K.HEAP32},[K.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:K.HEAPU8},[K.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:K.HEAPU16},[K.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:K.HEAPU32}}[A];if(!M)throw new Error(`Invalid data type ${A}`);const u=m*c,o=u*M.typedArrayConstructor.BYTES_PER_ELEMENT,W=K._malloc(o);try{Y.GetAttributeDataArrayForAllPoints(l,d,A,o,W);const K=new M.typedArrayConstructor(M.heap.buffer,W,u);U(v,K.slice(),c,V,Z,t)}finally{K._free(W)}};if(l)for(const K in l){const Y=l[K],v=d.GetAttributeByUniqueId(c,Y);V(d,c,K,v)}else{const Y={position:K.POSITION,Ri:K.NORMAL,color:K.COLOR,uv:K.TEX_COORD};for(const K in Y){const l=d.GetAttributeId(c,Y[K]);if(-1!==l){const Y=d.GetAttribute(c,l);V(d,c,K,Y)}}}return m}finally{c&&K.destroy(c),A&&K.destroy(A),d&&K.destroy(d)}}function m(){let K;onmessage=Y=>{const l=Y.data;switch(l.id){case"init":{const Y=l.decoder;Y.url&&importScripts(Y.url);const v=Y.wasmBinary?{wasmBinary:Y.wasmBinary}:{};K=DracoDecoderModule(v),postMessage({id:"initDone"});break}case"decodeMesh":if(!K)throw new Error("Draco decoder module is not available");K.then((K=>{const Y=Z(K,l.dataView,l.attributes,(K=>{postMessage({id:"indices",data:K},[K.buffer])}),((K,Y,l,v,U,d)=>{postMessage({id:"attribute",kind:K,data:Y,size:l,byteOffset:v,byteStride:U,normalized:d},[Y.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:Y})}))}}}class V{static get DecoderAvailable(){const K=V.Configuration.decoder;return!!(K.wasmUrl&&K.wasmBinaryUrl&&"object"===typeof WebAssembly||K.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return V._Default||(V._Default=new V),V._Default}static ResetDefault(K){V._Default&&(K||V._Default.dispose(),V._Default=null)}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.DefaultNumWorkers;const Y=V.Configuration.decoder;if(Y.workerPool||"object"===typeof K&&K.workerPool)this._workerPoolPromise=Promise.resolve(Y.workerPool||K.workerPool);else{const l=Y.wasmBinary||"object"===typeof K&&K.wasmBinary,d="number"===typeof K?K:K.numWorkers,A=d&&"function"===typeof Worker&&"function"===typeof URL,c=A||!A&&!Y.jsModule,t=Y.wasmUrl&&Y.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:c?v.d.GetBabylonScriptURL(Y.wasmUrl,!0):"",wasmBinaryPromise:l?Promise.resolve(l):v.d.LoadFileAsync(v.d.GetBabylonScriptURL(Y.wasmBinaryUrl,!0))}:{url:c?v.d.GetBabylonScriptURL(Y.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};A?this._workerPoolPromise=t.wasmBinaryPromise.then((K=>{const Y=`${Z}(${m})()`,l=URL.createObjectURL(new Blob([Y],{type:"application/javascript"}));return new U.c(d,(()=>function(K,Y,l){return new Promise(((v,U)=>{const d=Y=>{K.removeEventListener("error",d),K.removeEventListener("message",A),U(Y)},A=Y=>{"initDone"===Y.data.id&&(K.removeEventListener("error",d),K.removeEventListener("message",A),v(K))};if(K.addEventListener("error",d),K.addEventListener("message",A),Y){const v=Y.slice(0);K.postMessage({id:"init",decoder:{url:l,wasmBinary:v}},[v])}else K.postMessage({id:"init",decoder:{url:l}})}))}(new Worker(l),K,t.url)))})):this._decoderModulePromise=t.wasmBinaryPromise.then((async K=>{if("undefined"===typeof DracoDecoderModule&&!Y.jsModule){if(!t.url)throw new Error("Draco decoder module is not available");await v.d.LoadBabylonScriptAsync(t.url)}return await(l=K,U=Y.jsModule,new Promise((K=>{(U||DracoDecoderModule)({wasmBinary:l}).then((Y=>{K({module:Y})}))})));var l,U}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((K=>{K.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(K,Y,l){const v=K instanceof ArrayBuffer?new Int8Array(K):new Int8Array(K.buffer,K.byteOffset,K.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((K=>new Promise(((U,d)=>{K.push(((K,A)=>{let c=null;const Z=[],m=Y=>{K.removeEventListener("error",m),K.removeEventListener("message",V),d(Y),A()},V=Y=>{const v=Y.data;switch(v.id){case"decodeMeshDone":K.removeEventListener("error",m),K.removeEventListener("message",V),U({indices:c,attributes:Z,totalVertices:v.totalVertices}),A();break;case"indices":c=v.data;break;case"attribute":Z.push({kind:v.kind,data:v.data,size:v.size,byteOffset:v.byteOffset,byteStride:v.byteStride,normalized:(d=v.kind,M=v.normalized,l&&void 0!==l[d]?(M!==l[d]&&t.e.Warn(`Normalized flag from Draco data (${M}) does not match normalized flag from glTF accessor (${l[d]}). Using flag from glTF accessor.`),l[d]):M)})}var d,M};K.addEventListener("error",m),K.addEventListener("message",V);const M=v.slice();K.postMessage({id:"decodeMesh",dataView:M,attributes:Y},[M.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((K=>{let l=null;const U=[],d=Z(K.module,v,Y,(K=>{l=K}),((K,Y,l,v,d,A)=>{U.push({kind:K,data:Y,size:l,byteOffset:v,byteStride:d,normalized:A})}));return{indices:l,attributes:U,totalVertices:d}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(K,Y,l,v){const U=await this.decodeMeshToMeshDataAsync(l,v),c=new d.d(K,Y);U.indices&&c.setIndices(U.indices);for(const d of U.attributes)c.setVerticesBuffer(new A.e(Y.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),U.totalVertices);return c}async _decodeMeshToGeometryForGltfAsync(K,Y,l,v,U){const c=await this.decodeMeshToMeshDataAsync(l,v,U),t=new d.d(K,Y);c.indices&&t.setIndices(c.indices);for(const d of c.attributes)t.setVerticesBuffer(new A.e(Y.getEngine(),d.data,d.kind,!1,void 0,d.byteStride,void 0,d.byteOffset,d.size,void 0,d.normalized,!0),c.totalVertices);return t}async decodeMeshAsync(K,Y){const l=await this.decodeMeshToMeshDataAsync(K,Y),v=new c.c;l.indices&&(v.indices=l.indices);for(const U of l.attributes){const K=A.e.GetFloatData(U.data,U.size,A.e.GetDataType(U.data),U.byteOffset,U.byteStride,U.normalized,l.totalVertices);v.set(K,U.kind)}return v}}V.Configuration={decoder:{wasmUrl:`${v.d._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${v.d._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${v.d._DefaultCdnUrl}/draco_decoder_gltf.js`}},V.DefaultNumWorkers=V.GetDefaultNumWorkers(),V._Default=null},12480:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>M});var v=l(675),U=l(492),d=l(809),A=l(465),c=l(500),t=l(814),Z=l(730),m=l(475),V=l(619);A.e._instancedMeshFactory=(K,Y)=>{const l=new M(K,Y);if(Y.instancedBuffers){l.instancedBuffers={};for(const K in Y.instancedBuffers)l.instancedBuffers[K]=Y.instancedBuffers[K]}return l};class M extends d.b{constructor(K,Y){super(K,Y.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,Y.Bi(this),this._sourceMesh=Y,this._unIndexed=Y._unIndexed,this.position.p(Y.position),this.rotation.p(Y.rotation),this.ni.p(Y.ni),Y.rotationQuaternion&&(this.rotationQuaternion=Y.rotationQuaternion.clone()),this.animations=Y.animations.slice();for(const l of Y.getAnimationRanges())null!=l&&this.createAnimationRange(l.name,l.from,l.to);this.infiniteDistance=Y.infiniteDistance,this.setPivotMatrix(Y.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(K){var Y;(null===(Y=this._sourceMesh)||void 0===Y?void 0:Y.receiveShadows)!==K&&m.d.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(K){var Y;(null===(Y=this._sourceMesh)||void 0===Y?void 0:Y.material)!==K&&m.d.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(K){var Y;(null===(Y=this._sourceMesh)||void 0===Y?void 0:Y.visibility)!==K&&m.d.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(K){var Y;(null===(Y=this._sourceMesh)||void 0===Y?void 0:Y.skeleton)!==K&&m.d.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(K){this._sourceMesh&&K!==this._sourceMesh.renderingGroupId&&U.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(K){return this._sourceMesh.createInstance(K)}isReady(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(K,!0)}getVerticesData(K,Y,l){return this._sourceMesh.getVerticesData(K,Y,l)}copyVerticesData(K,Y){this._sourceMesh.copyVerticesData(K,Y)}Ga(K,Y,l,v){return this.sourceMesh&&this.sourceMesh.Ga(K,Y,l,v),this.sourceMesh}updateVerticesData(K,Y,l,v){return this.sourceMesh&&this.sourceMesh.updateVerticesData(K,Y,l,v),this.sourceMesh}setIndices(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(K,Y),this.sourceMesh}isVerticesDataPresent(K){return this._sourceMesh.isVerticesDataPresent(K)}si(){return this._sourceMesh.si()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let K,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;K="object"===typeof Y?Y:{applySkeleton:Y,applyMorph:l};const v=this._sourceMesh.oi?this._sourceMesh.oi.boundingBias:null;return this.Fa(this._sourceMesh._getData(K,null,Z.e.PositionKind),v),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(K,Y){if(super._activate(K,Y),this._sourceMesh.ui||U.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,K),Y){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==t.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new v.d);const K=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,v.j.Qi[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ri(!0)),this._currentLOD.position.p(v.j.Qi[7]),this._currentLOD._masterMesh=K,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(K){if(!K)return this;const Y=this.sourceMesh.getLODLevels();if(Y&&0!==Y.length){const Y=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(K,Y.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(K){return this.sourceMesh._preActivateForIntermediateRendering(K)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ui)for(let K=0;K<this._sourceMesh.ui.length;K++)this._sourceMesh.ui[K].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;const v=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(K);if(c.e.DeepCopy(this,v,["name","ui","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","pi","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),Y&&(v.parent=Y),!l)for(let U=0;U<this.va().meshes.length;U++){const K=this.va().meshes[U];K.parent===this&&K.clone(K.name,v)}return v.ri(!0),this.onClonedObservable.notifyObservers(v),v}dispose(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ci(this),super.dispose(K,Y)}_serializeAsParent(K){super._serializeAsParent(K),K.parentId=this._sourceMesh.uniqueId,K.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Y=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;const v=this.clone("Clone of "+(this.name||this.id),K||this.parent,!0,Y&&Y.newSourcedMesh);v&&l&&l(this,v);for(const U of this.getChildTransformNodes(!0))U.instantiateHierarchy(v,Y,l);return v}}A.e.prototype.registerInstancedBuffer=function(K,Y){var l,v;if(null===(l=this._userInstancedBuffersStorage)||void 0===l||null===(v=l.vertexBuffers[K])||void 0===v||v.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const K of this.instances)K.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[K]=null,this._userInstancedBuffersStorage.strides[K]=Y,this._userInstancedBuffersStorage.sizes[K]=32*Y,this._userInstancedBuffersStorage.data[K]=new Float32Array(this._userInstancedBuffersStorage.sizes[K]),this._userInstancedBuffersStorage.vertexBuffers[K]=new Z.e(this.getEngine(),this._userInstancedBuffersStorage.data[K],K,!0,!1,Y,!0);for(const U of this.instances)U.instancedBuffers[K]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},A.e.prototype._processInstancedBuffers=function(K,Y){const l=K?K.length:0;for(const v in this.instancedBuffers){let U=this._userInstancedBuffersStorage.sizes[v];const d=this._userInstancedBuffersStorage.strides[v],A=(l+1)*d;for(;U<A;)U*=2;this._userInstancedBuffersStorage.data[v].length!=U&&(this._userInstancedBuffersStorage.data[v]=new Float32Array(U),this._userInstancedBuffersStorage.sizes[v]=U,this._userInstancedBuffersStorage.vertexBuffers[v]&&(this._userInstancedBuffersStorage.vertexBuffers[v].dispose(),this._userInstancedBuffersStorage.vertexBuffers[v]=null));const c=this._userInstancedBuffersStorage.data[v];let t=0;if(Y){const K=this.instancedBuffers[v];K.toArray?K.toArray(c,t):K.copyToArray?K.copyToArray(c,t):c[t]=K,t+=d}for(let Y=0;Y<l;Y++){const l=K[Y].instancedBuffers[v];l.toArray?l.toArray(c,t):l.copyToArray?l.copyToArray(c,t):c[t]=l,t+=d}this._userInstancedBuffersStorage.vertexBuffers[v]?this._userInstancedBuffersStorage.vertexBuffers[v].updateDirectly(c,0):(this._userInstancedBuffersStorage.vertexBuffers[v]=new Z.e(this.getEngine(),this._userInstancedBuffersStorage.data[v],v,!0,!1,d,!0),this._invalidateInstanceVertexArrayObject())}},A.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const K in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[K]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},A.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const K in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[K]&&this._userInstancedBuffersStorage.vertexBuffers[K].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,V.f)("BABYLON.InstancedMesh",M)},12684:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>WK});var v=l(675),U=l(465),d=l(730),A=l(740),c=l(800);function t(K){let Y=K.pathArray;const l=K.closeArray||!1,v=K.closePath||!1,U=K.invertUV||!1,t=Math.floor(Y[0].length/2);let Z=K.offset||t;Z=Z>t?t:Math.floor(Z);const m=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,V=K.Aa,M=K.za,u=[],o=[],W=[],g=[],J=[],n=[],R=[],H=[];let z;const r=[],E=[];let y,T,e;if(Y.length<2){const K=[],l=[];for(T=0;T<Y[0].length-Z;T++)K.push(Y[0][T]),l.push(Y[0][T+Z]);Y=[K,l]}let i=0;const D=v?1:0,B=l?1:0;let P,G,Q,X,f,w;for(z=Y[0].length,y=0;y<Y.length+B;y++){for(R[y]=0,J[y]=[0],P=y===Y.length?Y[0]:Y[y],G=P.length,z=z<G?z:G,e=0;e<G;)u.push(P[e].x,P[e].y,P[e].z),e>0&&(Q=P[e].Lg(P[e-1]).length(),X=Q+R[y],J[y].push(X),R[y]=X),e++;v&&(e--,u.push(P[0].x,P[0].y,P[0].z),Q=P[e].Lg(P[0]).length(),X=Q+R[y],J[y].push(X),R[y]=X),r[y]=G+D,E[y]=i,i+=G+D}let k,I,L=null,a=null;for(T=0;T<z+D;T++)for(H[T]=0,n[T]=[0],y=0;y<Y.length-1+B;y++)f=Y[y],w=y===Y.length-1?Y[0]:Y[y+1],T===z?(L=f[0],a=w[0]):(L=f[T],a=w[T]),Q=a.Lg(L).length(),X=Q+H[T],n[T].push(X),H[T]=X;if(V)for(y=0;y<V.length;y++)g.push(V[y].x,c.d?1-V[y].y:V[y].y);else for(y=0;y<Y.length+B;y++)for(T=0;T<z+D;T++)k=0!=R[y]?J[y][T]/R[y]:0,I=0!=H[T]?n[T][y]/H[T]:0,U?g.push(I,k):g.push(k,c.d?1-I:I);y=0;let F=0,s=r[y]-1,b=r[y+1]-1,x=s<b?s:b,C=E[1]-E[0];const N=r.length-1;for(;F<=x&&y<N;)o.push(F,F+C,F+1),o.push(F+C+1,F+1,F+C),F+=1,F===x&&(y++,C=E[y+1]-E[y],s=r[y]-1,b=r[y+1]-1,F=E[y],x=s<b?s+F:b+F);if(A.c.ComputeNormals(u,o,W),v){let K=0,l=0;for(y=0;y<Y.length;y++){K=3*E[y],l=y+1<Y.length?3*(E[y+1]-1):W.length-3,W[K]=.5*(W[K]+W[l]),W[K+1]=.5*(W[K+1]+W[l+1]),W[K+2]=.5*(W[K+2]+W[l+2]);const v=Math.sqrt(W[K]*W[K]+W[K+1]*W[K+1]+W[K+2]*W[K+2]);W[K]/=v,W[K+1]/=v,W[K+2]/=v,W[l]=W[K],W[l+1]=W[K+1],W[l+2]=W[K+2]}}if(l){let K=3*E[0],l=3*E[Y.length];for(T=0;T<z+D;T++){W[K]=.5*(W[K]+W[l]),W[K+1]=.5*(W[K+1]+W[l+1]),W[K+2]=.5*(W[K+2]+W[l+2]);const Y=Math.sqrt(W[K]*W[K]+W[K+1]*W[K+1]+W[K+2]*W[K+2]);W[K]/=Y,W[K+1]/=Y,W[K+2]/=Y,W[l]=W[K],W[l+1]=W[K+1],W[l+2]=W[K+2],K+=3,l+=3}}A.c._ComputeSides(m,u,o,W,g,K.frontUVs,K.backUVs);let j=null;if(M){j=new Float32Array(4*M.length);for(let K=0;K<M.length;K++)j[4*K]=M[K].r,j[4*K+1]=M[K].g,j[4*K+2]=M[K].b,j[4*K+3]=M[K].a}const p=new A.c,S=new Float32Array(u),q=new Float32Array(W),O=new Float32Array(g);return p.indices=o,p.xa=S,p.ya=q,p.Aa=O,j&&p.set(j,d.e.ColorKind),v&&(p._idx=E),p}function Z(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=Y.pathArray,m=Y.closeArray,V=Y.closePath,M=U.e._GetDefaultSideOrientation(Y.sideOrientation),u=Y.instance,o=Y.updatable;if(u){const K=v.j.Qi[0].li(Number.MAX_VALUE),l=v.j.Qi[1].li(-Number.MAX_VALUE),t=Y=>{let v=Z[0].length;const d=u;let A=0;const c=d._originalBuilderSideOrientation===U.e.DOUBLESIDE?2:1;for(let U=1;U<=c;++U)for(let c=0;c<Z.length;++c){const U=Z[c],t=U.length;v=v<t?v:t;for(let d=0;d<v;++d){const v=U[d];Y[A]=v.x,Y[A+1]=v.y,Y[A+2]=v.z,K.minimizeInPlaceFromFloats(v.x,v.y,v.z),l.maximizeInPlaceFromFloats(v.x,v.y,v.z),A+=3}if(d._creationDataStorage&&d._creationDataStorage.closePath){const K=U[0];Y[A]=K.x,Y[A+1]=K.y,Y[A+2]=K.z,A+=3}}},m=u.getVerticesData(d.e.PositionKind);if(t(m),u.hasBoundingInfo?u.getBoundingInfo().reConstruct(K,l,u._worldMatrix):u.buildBoundingInfo(K,l,u._worldMatrix),u.updateVerticesData(d.e.PositionKind,m,!1,!1),Y.za){const K=u.getVerticesData(d.e.ColorKind);for(let l=0,v=0;l<Y.za.length;l++,v+=4){const U=Y.za[l];K[v]=U.r,K[v+1]=U.g,K[v+2]=U.b,K[v+3]=U.a}u.updateVerticesData(d.e.ColorKind,K,!1,!1)}if(Y.Aa){const K=u.getVerticesData(d.e.UVKind);for(let l=0;l<Y.Aa.length;l++)K[2*l]=Y.Aa[l].x,K[2*l+1]=c.d?1-Y.Aa[l].y:Y.Aa[l].y;u.updateVerticesData(d.e.UVKind,K,!1,!1)}if(!u.areNormalsFrozen||u.isFacetDataEnabled){const K=u.si(),Y=u.getVerticesData(d.e.NormalKind),l=u.isFacetDataEnabled?u.getFacetDataParameters():null;if(A.c.ComputeNormals(m,K,Y,l),u._creationDataStorage&&u._creationDataStorage.closePath){let K=0,l=0;for(let v=0;v<Z.length;v++)K=3*u._creationDataStorage.idx[v],l=v+1<Z.length?3*(u._creationDataStorage.idx[v+1]-1):Y.length-3,Y[K]=.5*(Y[K]+Y[l]),Y[K+1]=.5*(Y[K+1]+Y[l+1]),Y[K+2]=.5*(Y[K+2]+Y[l+2]),Y[l]=Y[K],Y[l+1]=Y[K+1],Y[l+2]=Y[K+2]}u.areNormalsFrozen||u.updateVerticesData(d.e.NormalKind,Y,!1,!1)}return u}{const v=new U.e(K,l);v._originalBuilderSideOrientation=M,v._creationDataStorage=new U.f;const d=t(Y);return V&&(v._creationDataStorage.idx=d._idx),v._creationDataStorage.closePath=V,v._creationDataStorage.closeArray=m,d.Ca(v,o),v}}A.c.CreateRibbon=t,U.e.CreateRibbon=function(K,Y){return Z(K,{pathArray:Y,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var m=l(460),V=l(11907),M=l(706);function u(K){const Y=K.pattern||U.e.NO_FLIP,l=K.tileWidth||K.tileSize||1,v=K.tileHeight||K.tileSize||1,d=K.alignHorizontal||0,c=K.alignVertical||0,t=K.width||K.size||1,Z=Math.floor(t/l);let m=t-Z*l;const V=K.height||K.size||1,M=Math.floor(V/v);let u=V-M*v;const o=l*Z/2,W=v*M/2;let g=0,J=0,n=0,R=0,H=0,z=0;if(m>0||u>0){switch(n=-o,R=-W,H=o,z=W,d){case U.e.CENTER:m/=2,n-=m,H+=m;break;case U.e.LEFT:H+=m,g=-m/2;break;case U.e.RIGHT:n-=m,g=m/2}switch(c){case U.e.CENTER:u/=2,R-=u,z+=u;break;case U.e.BOTTOM:z+=u,J=-u/2;break;case U.e.TOP:R-=u,J=u/2}}const r=[],E=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],Y!==U.e.ROTATE_TILE&&Y!==U.e.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),Y!==U.e.FLIP_TILE&&Y!==U.e.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),Y!==U.e.FLIP_N_ROTATE_TILE&&Y!==U.e.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);let T=[];const e=[],i=[];let D=0;for(let A=0;A<M;A++)for(let K=0;K<Z;K++)r.push(K*l-o+g,A*v-W+J,0),r.push((K+1)*l-o+g,A*v-W+J,0),r.push((K+1)*l-o+g,(A+1)*v-W+J,0),r.push(K*l-o+g,(A+1)*v-W+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),T=Y===U.e.FLIP_TILE||Y===U.e.ROTATE_TILE||Y===U.e.FLIP_N_ROTATE_TILE?T.concat(y[(K%2+A%2)%2]):Y===U.e.FLIP_ROW||Y===U.e.ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_ROW?T.concat(y[A%2]):T.concat(y[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),D+=4;if(m>0||u>0){const K=u>0&&(c===U.e.CENTER||c===U.e.TOP),A=u>0&&(c===U.e.CENTER||c===U.e.BOTTOM),t=m>0&&(d===U.e.CENTER||d===U.e.RIGHT),V=m>0&&(d===U.e.CENTER||d===U.e.LEFT);let y,B,P,G,Q=[];if(K&&t&&(r.push(n+g,R+J,0),r.push(-o+g,R+J,0),r.push(-o+g,R+u+J,0),r.push(n+g,R+u+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,y=1-m/l,B=1-u/v,P=1,G=1,Q=[y,B,P,B,P,G,y,G],Y===U.e.ROTATE_ROW&&(Q=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),Y===U.e.FLIP_ROW&&(Q=[1-y,B,1-P,B,1-P,G,1-y,G]),Y===U.e.FLIP_N_ROTATE_ROW&&(Q=[y,1-B,P,1-B,P,1-G,y,1-G]),T=T.concat(Q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&V&&(r.push(o+g,R+J,0),r.push(H+g,R+J,0),r.push(H+g,R+u+J,0),r.push(o+g,R+u+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,y=0,B=1-u/v,P=m/l,G=1,Q=[y,B,P,B,P,G,y,G],(Y===U.e.ROTATE_ROW||Y===U.e.ROTATE_TILE&&Z%2===0)&&(Q=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),(Y===U.e.FLIP_ROW||Y===U.e.FLIP_TILE&&Z%2===0)&&(Q=[1-y,B,1-P,B,1-P,G,1-y,G]),(Y===U.e.FLIP_N_ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_TILE&&Z%2===0)&&(Q=[y,1-B,P,1-B,P,1-G,y,1-G]),T=T.concat(Q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&t&&(r.push(n+g,W+J,0),r.push(-o+g,W+J,0),r.push(-o+g,z+J,0),r.push(n+g,z+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,y=1-m/l,B=0,P=1,G=u/v,Q=[y,B,P,B,P,G,y,G],(Y===U.e.ROTATE_ROW&&M%2===1||Y===U.e.ROTATE_TILE&&M%1===0)&&(Q=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),(Y===U.e.FLIP_ROW&&M%2===1||Y===U.e.FLIP_TILE&&M%2===0)&&(Q=[1-y,B,1-P,B,1-P,G,1-y,G]),(Y===U.e.FLIP_N_ROTATE_ROW&&M%2===1||Y===U.e.FLIP_N_ROTATE_TILE&&M%2===0)&&(Q=[y,1-B,P,1-B,P,1-G,y,1-G]),T=T.concat(Q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&V&&(r.push(o+g,W+J,0),r.push(H+g,W+J,0),r.push(H+g,z+J,0),r.push(o+g,z+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,y=0,B=0,P=m/l,G=u/v,Q=[y,B,P,B,P,G,y,G],(Y===U.e.ROTATE_ROW&&M%2===1||Y===U.e.ROTATE_TILE&&(M+Z)%2===1)&&(Q=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),(Y===U.e.FLIP_ROW&&M%2===1||Y===U.e.FLIP_TILE&&(M+Z)%2===1)&&(Q=[1-y,B,1-P,B,1-P,G,1-y,G]),(Y===U.e.FLIP_N_ROTATE_ROW&&M%2===1||Y===U.e.FLIP_N_ROTATE_TILE&&(M+Z)%2===1)&&(Q=[y,1-B,P,1-B,P,1-G,y,1-G]),T=T.concat(Q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K){const K=[];y=0,B=1-u/v,P=1,G=1,K[0]=[y,B,P,B,P,G,y,G],K[1]=[y,B,P,B,P,G,y,G],Y!==U.e.ROTATE_TILE&&Y!==U.e.ROTATE_ROW||(K[1]=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),Y!==U.e.FLIP_TILE&&Y!==U.e.FLIP_ROW||(K[1]=[1-y,B,1-P,B,1-P,G,1-y,G]),Y!==U.e.FLIP_N_ROTATE_TILE&&Y!==U.e.FLIP_N_ROTATE_ROW||(K[1]=[y,1-B,P,1-B,P,1-G,y,1-G]);for(let v=0;v<Z;v++)r.push(v*l-o+g,R+J,0),r.push((v+1)*l-o+g,R+J,0),r.push((v+1)*l-o+g,R+u+J,0),r.push(v*l-o+g,R+u+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,T=Y===U.e.FLIP_TILE||Y===U.e.ROTATE_TILE||Y===U.e.FLIP_N_ROTATE_TILE?T.concat(K[(v+1)%2]):Y===U.e.FLIP_ROW||Y===U.e.ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_ROW?T.concat(K[1]):T.concat(K[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const K=[];y=0,B=0,P=1,G=u/v,K[0]=[y,B,P,B,P,G,y,G],K[1]=[y,B,P,B,P,G,y,G],Y!==U.e.ROTATE_TILE&&Y!==U.e.ROTATE_ROW||(K[1]=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),Y!==U.e.FLIP_TILE&&Y!==U.e.FLIP_ROW||(K[1]=[1-y,B,1-P,B,1-P,G,1-y,G]),Y!==U.e.FLIP_N_ROTATE_TILE&&Y!==U.e.FLIP_N_ROTATE_ROW||(K[1]=[y,1-B,P,1-B,P,1-G,y,1-G]);for(let v=0;v<Z;v++)r.push(v*l-o+g,z-u+J,0),r.push((v+1)*l-o+g,z-u+J,0),r.push((v+1)*l-o+g,z+J,0),r.push(v*l-o+g,z+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,T=Y===U.e.FLIP_TILE||Y===U.e.ROTATE_TILE||Y===U.e.FLIP_N_ROTATE_TILE?T.concat(K[(v+M)%2]):Y===U.e.FLIP_ROW||Y===U.e.ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_ROW?T.concat(K[M%2]):T.concat(K[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const K=[];y=1-m/l,B=0,P=1,G=1,K[0]=[y,B,P,B,P,G,y,G],K[1]=[y,B,P,B,P,G,y,G],Y!==U.e.ROTATE_TILE&&Y!==U.e.ROTATE_ROW||(K[1]=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),Y!==U.e.FLIP_TILE&&Y!==U.e.FLIP_ROW||(K[1]=[1-y,B,1-P,B,1-P,G,1-y,G]),Y!==U.e.FLIP_N_ROTATE_TILE&&Y!==U.e.FLIP_N_ROTATE_ROW||(K[1]=[y,1-B,P,1-B,P,1-G,y,1-G]);for(let l=0;l<M;l++)r.push(n+g,l*v-W+J,0),r.push(n+m+g,l*v-W+J,0),r.push(n+m+g,(l+1)*v-W+J,0),r.push(n+g,(l+1)*v-W+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,T=Y===U.e.FLIP_TILE||Y===U.e.ROTATE_TILE||Y===U.e.FLIP_N_ROTATE_TILE?T.concat(K[(l+1)%2]):Y===U.e.FLIP_ROW||Y===U.e.ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_ROW?T.concat(K[l%2]):T.concat(K[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const K=[];y=0,B=0,P=m/v,G=1,K[0]=[y,B,P,B,P,G,y,G],K[1]=[y,B,P,B,P,G,y,G],Y!==U.e.ROTATE_TILE&&Y!==U.e.ROTATE_ROW||(K[1]=[1-y,1-B,1-P,1-B,1-P,1-G,1-y,1-G]),Y!==U.e.FLIP_TILE&&Y!==U.e.FLIP_ROW||(K[1]=[1-y,B,1-P,B,1-P,G,1-y,G]),Y!==U.e.FLIP_N_ROTATE_TILE&&Y!==U.e.FLIP_N_ROTATE_ROW||(K[1]=[y,1-B,P,1-B,P,1-G,y,1-G]);for(let l=0;l<M;l++)r.push(H-m+g,l*v-W+J,0),r.push(H+g,l*v-W+J,0),r.push(H+g,(l+1)*v-W+J,0),r.push(H-m+g,(l+1)*v-W+J,0),i.push(D,D+1,D+3,D+1,D+2,D+3),D+=4,T=Y===U.e.FLIP_TILE||Y===U.e.ROTATE_TILE||Y===U.e.FLIP_N_ROTATE_TILE?T.concat(K[(l+Z)%2]):Y===U.e.FLIP_ROW||Y===U.e.ROTATE_ROW||Y===U.e.FLIP_N_ROTATE_ROW?T.concat(K[l%2]):T.concat(K[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const B=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE;A.c._ComputeSides(B,r,i,E,T,K.frontUVs,K.backUVs);const P=new A.c;P.indices=i,P.xa=r,P.ya=E,P.Aa=T;const G=B===A.c.DOUBLESIDE?e.concat(e):e;return P.za=G,P}function o(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return u(Y).Ca(v,Y.updatable),v}function W(K){const Y=K.faceUV||new Array(6),l=K.faceColors,d=K.pattern||U.e.NO_FLIP,t=K.width||K.size||1,Z=K.height||K.size||1,m=K.depth||K.size||1,V=K.tileWidth||K.tileSize||1,o=K.tileHeight||K.tileSize||1,W=K.alignHorizontal||0,g=K.alignVertical||0,J=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE;for(let U=0;U<6;U++)void 0===Y[U]&&(Y[U]=new v.p(0,0,1,1)),l&&void 0===l[U]&&(l[U]=new M.g(1,1,1,1));const n=t/2,R=Z/2,H=m/2,z=[];for(let v=0;v<2;v++)z[v]=u({pattern:d,tileWidth:V,tileHeight:o,width:t,height:Z,alignVertical:g,alignHorizontal:W,sideOrientation:J});for(let v=2;v<4;v++)z[v]=u({pattern:d,tileWidth:V,tileHeight:o,width:m,height:Z,alignVertical:g,alignHorizontal:W,sideOrientation:J});let r=g;g===U.e.BOTTOM?r=U.e.TOP:g===U.e.TOP&&(r=U.e.BOTTOM);for(let v=4;v<6;v++)z[v]=u({pattern:d,tileWidth:V,tileHeight:o,width:t,height:m,alignVertical:r,alignHorizontal:W,sideOrientation:J});let E=[],y=[],T=[],e=[];const i=[],D=[],B=[],P=[];let G=0,Q=0;for(let U=0;U<6;U++){const K=z[U].xa.length;D[U]=[],B[U]=[];for(let Y=0;Y<K/3;Y++)D[U].push(new v.o(z[U].xa[3*Y],z[U].xa[3*Y+1],z[U].xa[3*Y+2])),B[U].push(new v.o(z[U].ya[3*Y],z[U].ya[3*Y+1],z[U].ya[3*Y+2]));G=z[U].Aa.length,P[U]=[];for(let l=0;l<G;l+=2)P[U][l]=Y[U].x+(Y[U].z-Y[U].x)*z[U].Aa[l],P[U][l+1]=Y[U].y+(Y[U].w-Y[U].y)*z[U].Aa[l+1],c.d&&(P[U][l+1]=1-P[U][l+1]);if(T=T.concat(P[U]),e=e.concat(z[U].indices.map((K=>K+Q))),Q+=D[U].length,l)for(let Y=0;Y<4;Y++)i.push(l[U].r,l[U].g,l[U].b,l[U].a)}const X=new v.o(0,0,H),f=v.d.RotationY(Math.PI);E=D[0].map((K=>v.o.TransformNormal(K,f).add(X))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]),y=B[0].map((K=>v.o.TransformNormal(K,f))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]),E=E.concat(D[1].map((K=>K.Lg(X))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),y=y.concat(B[1].map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]));const w=new v.o(n,0,0),k=v.d.RotationY(-Math.PI/2);E=E.concat(D[2].map((K=>v.o.TransformNormal(K,k).add(w))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),y=y.concat(B[2].map((K=>v.o.TransformNormal(K,k))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]));const I=v.d.RotationY(Math.PI/2);E=E.concat(D[3].map((K=>v.o.TransformNormal(K,I).Lg(w))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),y=y.concat(B[3].map((K=>v.o.TransformNormal(K,I))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]));const L=new v.o(0,R,0),a=v.d.RotationX(Math.PI/2);E=E.concat(D[4].map((K=>v.o.TransformNormal(K,a).add(L))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),y=y.concat(B[4].map((K=>v.o.TransformNormal(K,a))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[]));const F=v.d.RotationX(-Math.PI/2);E=E.concat(D[5].map((K=>v.o.TransformNormal(K,F).Lg(L))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),y=y.concat(B[5].map((K=>v.o.TransformNormal(K,F))).map((K=>[K.x,K.y,K.z])).reduce(((K,Y)=>K.concat(Y)),[])),A.c._ComputeSides(J,E,e,y,T);const s=new A.c;if(s.indices=e,s.xa=E,s.ya=y,s.Aa=T,l){const K=J===A.c.DOUBLESIDE?i.concat(i):i;s.za=K}return s}function g(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return W(Y).Ca(v,Y.updatable),v}A.c.CreateTiledPlane=u;A.c.CreateTiledBox=W;var J=l(12139),n=l(2366),R=l(833);function H(K){const Y=K.height||2;let l=0===K.diameterTop?0:K.diameterTop||K.diameter||1,d=0===K.diameterBottom?0:K.diameterBottom||K.diameter||1;l=l||1e-5,d=d||1e-5;const t=0|(K.tessellation||24),Z=0|(K.subdivisions||1),m=!!K.hasRings,V=!!K.enclose,u=0===K.cap?0:K.cap||U.e.CAP_ALL,o=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,W=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,g=K.faceUV||new Array(3),J=K.faceColors,n=2+(1+(1!==o&&V?2:0))*(m?Z:1);let H;for(H=0;H<n;H++)J&&void 0===J[H]&&(J[H]=new M.g(1,1,1,1));for(H=0;H<n;H++)g&&void 0===g[H]&&(g[H]=new v.p(0,0,1,1));const z=[],r=[],E=[],y=[],T=[],e=2*Math.PI*o/t;let i,D,B;const P=(d-l)/2/Y,G=v.o.Zero(),Q=v.o.Zero(),X=v.o.Zero(),f=v.o.Zero(),w=v.o.Zero(),k=R.e.Y;let I,L,a,F=1,s=1,b=0,x=0;for(I=0;I<=Z;I++)for(D=I/Z,B=(D*(l-d)+d)/2,F=m&&0!==I&&I!==Z?2:1,a=0;a<F;a++){for(m&&(s+=a),V&&(s+=2*a),L=0;L<=t;L++)i=L*e,G.x=Math.cos(-i)*B,G.y=-Y/2+D*Y,G.z=Math.sin(-i)*B,0===l&&I===Z?(Q.x=E[E.length-3*(t+1)],Q.y=E[E.length-3*(t+1)+1],Q.z=E[E.length-3*(t+1)+2]):(Q.x=G.x,Q.z=G.z,Q.y=Math.sqrt(Q.x*Q.x+Q.z*Q.z)*P,Q.normalize()),0===L&&(X.p(G),f.p(Q)),r.push(G.x,G.y,G.z),E.push(Q.x,Q.y,Q.z),x=m?b!==s?g[s].y:g[s].w:g[s].y+(g[s].w-g[s].y)*D,y.push(g[s].x+(g[s].z-g[s].x)*L/t,c.d?1-x:x),J&&T.push(J[s].r,J[s].g,J[s].b,J[s].a);1!==o&&V&&(r.push(G.x,G.y,G.z),r.push(0,G.y,0),r.push(0,G.y,0),r.push(X.x,X.y,X.z),v.o.CrossToRef(k,Q,w),w.normalize(),E.push(w.x,w.y,w.z,w.x,w.y,w.z),v.o.CrossToRef(f,k,w),w.normalize(),E.push(w.x,w.y,w.z,w.x,w.y,w.z),x=m?b!==s?g[s+1].y:g[s+1].w:g[s+1].y+(g[s+1].w-g[s+1].y)*D,y.push(g[s+1].x,c.d?1-x:x),y.push(g[s+1].z,c.d?1-x:x),x=m?b!==s?g[s+2].y:g[s+2].w:g[s+2].y+(g[s+2].w-g[s+2].y)*D,y.push(g[s+2].x,c.d?1-x:x),y.push(g[s+2].z,c.d?1-x:x),J&&(T.push(J[s+1].r,J[s+1].g,J[s+1].b,J[s+1].a),T.push(J[s+1].r,J[s+1].g,J[s+1].b,J[s+1].a),T.push(J[s+2].r,J[s+2].g,J[s+2].b,J[s+2].a),T.push(J[s+2].r,J[s+2].g,J[s+2].b,J[s+2].a))),b!==s&&(b=s)}const C=1!==o&&V?t+4:t;for(I=0,s=0;s<Z;s++){let K=0,Y=0,l=0,v=0;for(L=0;L<t;L++)K=I*(C+1)+L,Y=(I+1)*(C+1)+L,l=I*(C+1)+(L+1),v=(I+1)*(C+1)+(L+1),z.push(K,Y,l),z.push(v,l,Y);1!==o&&V&&(z.push(K+2,Y+2,l+2),z.push(v+2,l+2,Y+2),z.push(K+4,Y+4,l+4),z.push(v+4,l+4,Y+4)),I=m?I+2:I+1}const N=K=>{const U=K?l/2:d/2;if(0===U)return;let A,Z,m;const V=K?g[n-1]:g[0];let M=null;J&&(M=K?J[n-1]:J[0]);const u=r.length/3,W=K?Y/2:-Y/2,R=new v.o(0,W,0);r.push(R.x,R.y,R.z),E.push(0,K?1:-1,0);const H=V.y+.5*(V.w-V.y);y.push(V.x+.5*(V.z-V.x),c.d?1-H:H),M&&T.push(M.r,M.g,M.b,M.a);const e=new v.m(.5,.5);for(m=0;m<=t;m++){A=2*Math.PI*m*o/t;const Y=Math.cos(-A),l=Math.sin(-A);Z=new v.o(Y*U,W,l*U);const d=new v.m(Y*e.x+.5,l*e.y+.5);r.push(Z.x,Z.y,Z.z),E.push(0,K?1:-1,0);const u=V.y+(V.w-V.y)*d.y;y.push(V.x+(V.z-V.x)*d.x,c.d?1-u:u),M&&T.push(M.r,M.g,M.b,M.a)}for(m=0;m<t;m++)K?(z.push(u),z.push(u+(m+2)),z.push(u+(m+1))):(z.push(u),z.push(u+(m+1)),z.push(u+(m+2)))};u!==U.e.CAP_START&&u!==U.e.CAP_ALL||N(!1),u!==U.e.CAP_END&&u!==U.e.CAP_ALL||N(!0),A.c._ComputeSides(W,r,z,E,y,K.frontUVs,K.backUVs);const j=new A.c;return j.indices=z,j.xa=r,j.ya=E,j.Aa=y,J&&(j.za=T),j}function z(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return H(Y).Ca(v,Y.updatable),v}function r(K){const Y=[],l=[],U=[],d=[],t=K.diameter||1,Z=K.thickness||.5,m=0|(K.tessellation||16),V=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,M=m+1;for(let A=0;A<=m;A++){const K=A/m,V=A*Math.PI*2/m-Math.PI/2,u=v.d.Translation(t/2,0,0).multiply(v.d.RotationY(V));for(let t=0;t<=m;t++){const V=1-t/m,o=t*Math.PI*2/m+Math.PI,W=Math.cos(o),g=Math.sin(o);let J=new v.o(W,g,0),n=J.scale(Z/2);const R=new v.m(K,V);n=v.o.TransformCoordinates(n,u),J=v.o.TransformNormal(J,u),l.push(n.x,n.y,n.z),U.push(J.x,J.y,J.z),d.push(R.x,c.d?1-R.y:R.y);const H=(A+1)%M,z=(t+1)%M;Y.push(A*M+t),Y.push(A*M+z),Y.push(H*M+t),Y.push(A*M+z),Y.push(H*M+z),Y.push(H*M+t)}}A.c._ComputeSides(V,l,Y,U,d,K.frontUVs,K.backUVs);const u=new A.c;return u.indices=Y,u.xa=l,u.ya=U,u.Aa=d,u}function E(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return r(Y).Ca(v,Y.updatable),v}A.c.CreateCylinder=H,U.e.CreateCylinder=(K,Y,l,v,d,A,c,t,Z)=>{void 0!==c&&c instanceof n.b||(void 0!==c&&(Z=t||U.e.DEFAULTSIDE,t=c),c=A,A=1);return z(K,{height:Y,diameterTop:l,diameterBottom:v,tessellation:d,subdivisions:A,sideOrientation:Z,updatable:t},c)};function y(K){const Y=[],l=[],U=[],d=[],t=K.radius||2,Z=K.tube||.5,m=K.radialSegments||32,V=K.tubularSegments||32,M=K.p||2,u=K.q||3,o=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,W=K=>{const Y=Math.cos(K),l=Math.sin(K),U=u/M*K,d=Math.cos(U),A=t*(2+d)*.5*Y,c=t*(2+d)*l*.5,Z=t*Math.sin(U)*.5;return new v.o(A,c,Z)};let g,J;for(g=0;g<=m;g++){const K=g%m/m*2*M*Math.PI,Y=W(K),U=W(K+.01),A=U.Lg(Y);let t=U.add(Y);const u=v.o.Cross(A,t);for(t=v.o.Cross(u,A),u.normalize(),t.normalize(),J=0;J<V;J++){const K=J%V/V*2*Math.PI,v=-Z*Math.cos(K),U=Z*Math.sin(K);l.push(Y.x+v*t.x+U*u.x),l.push(Y.y+v*t.y+U*u.y),l.push(Y.z+v*t.z+U*u.z),d.push(g/m),d.push(c.d?1-J/V:J/V)}}for(g=0;g<m;g++)for(J=0;J<V;J++){const K=(J+1)%V,l=g*V+J,v=(g+1)*V+J,U=(g+1)*V+K,d=g*V+K;Y.push(d),Y.push(v),Y.push(l),Y.push(d),Y.push(U),Y.push(v)}A.c.ComputeNormals(l,Y,U),A.c._ComputeSides(o,l,Y,U,d,K.frontUVs,K.backUVs);const n=new A.c;return n.indices=Y,n.xa=l,n.ya=U,n.Aa=d,n}function T(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return y(Y).Ca(v,Y.updatable),v}A.c.CreateTorus=r,U.e.CreateTorus=(K,Y,l,v,U,d,A)=>E(K,{diameter:Y,thickness:l,tessellation:v,sideOrientation:A,updatable:d},U);A.c.CreateTorusKnot=y,U.e.CreateTorusKnot=(K,Y,l,v,U,d,A,c,t,Z)=>T(K,{radius:Y,tube:l,radialSegments:v,tubularSegments:U,p:d,q:A,sideOrientation:Z,updatable:t},c);var e=l(12691),i=l(492),D=l(2265),B=l(681),P=l(526);class G extends v.m{constructor(K,Y){super(K.x,K.y),this.index=Y}}class Q{constructor(){this.elements=[]}add(K){const Y=[];return K.forEach((K=>{const l=new G(K,this.elements.length);Y.push(l),this.elements.push(l)})),Y}computeBounds(){const K=new v.m(this.elements[0].x,this.elements[0].y),Y=new v.m(this.elements[0].x,this.elements[0].y);return this.elements.forEach((l=>{l.x<K.x?K.x=l.x:l.x>Y.x&&(Y.x=l.x),l.y<K.y?K.y=l.y:l.y>Y.y&&(Y.y=l.y)})),{min:K,max:Y,width:Y.x-K.x,height:Y.y-K.y}}}class X{_addToepoint(K){for(const Y of K)this._epoints.push(Y.x,Y.y)}constructor(K,Y,l){let v,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new Q,this._outlinepoints=new Q,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=U,this._name=K,this._scene=l||P.e.LastCreatedScene,v=Y instanceof D.g?Y.getPoints():Y,this._addToepoint(v),this._points.add(v),this._outlinepoints.add(v),"undefined"===typeof this.bjsEarcut&&i.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(K){this._points.add(K);const Y=new Q;return Y.add(K),this._holes.push(Y),this._eholes.push(this._epoints.length/2),this._addToepoint(K),this}build(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const v=new U.e(this._name,this._scene),A=this.buildVertexData(Y,l);return v.Ga(d.e.PositionKind,A.xa,K),v.Ga(d.e.NormalKind,A.ya,K),v.Ga(d.e.UVKind,A.Aa,K),v.setIndices(A.indices),v}buildVertexData(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const l=new A.c,v=[],U=[],d=[],c=this._points.computeBounds();this._points.elements.forEach((K=>{v.push(0,1,0),U.push(K.x,0,K.y),d.push((K.x-c.min.x)/c.width,(K.y-c.min.y)/c.height)}));const t=[],Z=this.bjsEarcut(this._epoints,this._eholes,2);for(let A=0;A<Z.length;A++)t.push(Z[A]);if(K>0){const l=U.length/3;this._points.elements.forEach((Y=>{v.push(0,-1,0),U.push(Y.x,-K,Y.y),d.push(1-(Y.x-c.min.x)/c.width,1-(Y.y-c.min.y)/c.height)}));const A=t.length;for(let K=0;K<A;K+=3){const Y=t[K+0],v=t[K+1],U=t[K+2];t.push(U+l),t.push(v+l),t.push(Y+l)}this._addSide(U,v,d,t,c,this._outlinepoints,K,!1,Y),this._holes.forEach((l=>{this._addSide(U,v,d,t,c,l,K,!0,Y)}))}return l.indices=t,l.xa=U,l.ya=v,l.Aa=d,l}_addSide(K,Y,l,U,d,A,c,t,Z){let m=K.length/3,V=0;for(let M=0;M<A.elements.length;M++){const u=A.elements[M],o=A.elements[(M+1)%A.elements.length];K.push(u.x,0,u.y),K.push(u.x,-c,u.y),K.push(o.x,0,o.y),K.push(o.x,-c,o.y);const W=A.elements[(M+A.elements.length-1)%A.elements.length],g=A.elements[(M+2)%A.elements.length];let J=new v.o(-(o.y-u.y),0,o.x-u.x),n=new v.o(-(u.y-W.y),0,u.x-W.x),R=new v.o(-(g.y-o.y),0,g.x-o.x);t||(J=J.scale(-1),n=n.scale(-1),R=R.scale(-1));const H=J.normalizeToNew();let z=n.normalizeToNew(),r=R.normalizeToNew();const E=v.o.Dot(z,H);z=E>Z?E<B.d-1?new v.o(u.x,0,u.y).Lg(new v.o(o.x,0,o.y)).normalize():n.add(J).normalize():H;const y=v.o.Dot(R,J);r=y>Z?y<B.d-1?new v.o(o.x,0,o.y).Lg(new v.o(u.x,0,u.y)).normalize():R.add(J).normalize():H,l.push(V/d.width,0),l.push(V/d.width,1),V+=J.length(),l.push(V/d.width,0),l.push(V/d.width,1),Y.push(z.x,z.y,z.z),Y.push(z.x,z.y,z.z),Y.push(r.x,r.y,r.z),Y.push(r.x,r.y,r.z),t?(U.push(m),U.push(m+2),U.push(m+1),U.push(m+1),U.push(m+2),U.push(m+3)):(U.push(m),U.push(m+1),U.push(m+2),U.push(m+1),U.push(m+3),U.push(m+2)),m+=4}}}function f(K,Y,l,U,t,Z,m){const V=l||new Array(3),u=U,o=[],W=m||!1;for(let d=0;d<3;d++)void 0===V[d]&&(V[d]=new v.p(0,0,1,1)),u&&void 0===u[d]&&(u[d]=new M.g(1,1,1,1));const g=K.getVerticesData(d.e.PositionKind),J=K.getVerticesData(d.e.NormalKind),n=K.getVerticesData(d.e.UVKind),R=K.si(),H=g.length/9;let z=0,r=0,E=0,y=0,T=0;const e=[0];if(W)for(let v=H;v<g.length/3;v+=4)r=g[3*(v+2)]-g[3*v],E=g[3*(v+2)+2]-g[3*v+2],y=Math.sqrt(r*r+E*E),T+=y,e.push(T);let i=0,D=0;for(let v=0;v<J.length;v+=3)Math.abs(J[v+1])<.001&&(D=1),Math.abs(J[v+1]-1)<.001&&(D=0),Math.abs(J[v+1]+1)<.001&&(D=2),i=v/3,1===D?(z=i-H,n[2*i]=z%4<1.5?W?V[D].x+(V[D].z-V[D].x)*e[Math.floor(z/4)]/T:V[D].x:W?V[D].x+(V[D].z-V[D].x)*e[Math.floor(z/4)+1]/T:V[D].z,n[2*i+1]=z%2===0?c.d?1-V[D].w:V[D].w:c.d?1-V[D].y:V[D].y):(n[2*i]=(1-n[2*i])*V[D].x+n[2*i]*V[D].z,n[2*i+1]=(1-n[2*i+1])*V[D].y+n[2*i+1]*V[D].w,c.d&&(n[2*i+1]=1-n[2*i+1])),u&&o.push(u[D].r,u[D].g,u[D].b,u[D].a);A.c._ComputeSides(Y,g,R,J,n,t,Z);const B=new A.c;if(B.indices=R,B.xa=g,B.ya=J,B.Aa=n,u){const K=Y===A.c.DOUBLESIDE?o.concat(o):o;B.za=K}return B}function w(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation);const A=Y.shape,c=Y.holes||[],t=Y.depth||0,Z=Y.smoothingThreshold||2,m=[];let V=[];for(let U=0;U<A.length;U++)m[U]=new v.m(A[U].x,A[U].z);m[0].equalsWithEpsilon(m[m.length-1],1e-8)&&m.pop();const M=new X(K,m,l||P.e.LastCreatedScene,d);for(let U=0;U<c.length;U++){V=[];for(let K=0;K<c[U].length;K++)V.push(new v.m(c[U][K].x,c[U][K].z));M.addHole(V)}const u=M.build(!1,t,Z);u._originalBuilderSideOrientation=Y.sideOrientation;return f(u,Y.sideOrientation,Y.faceUV,Y.faceColors,Y.frontUVs,Y.backUVs,Y.wrap).Ca(u,Y.updatable),u}function k(K,Y){return w(K,Y,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function I(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=Y.path,d=Y.shape,A=Y.scale||1,c=Y.rotation||0,t=0===Y.cap?0:Y.cap||U.e.NO_CAP,Z=Y.updatable,m=U.e._GetDefaultSideOrientation(Y.sideOrientation),V=Y.instance||null,M=Y.invertUV||!1,u=Y.closeShape||!1;return a(K,d,v,A,c,null,null,Y.closePath||!1,u,t,!1,l,!!Z,m,V,M,Y.frontUVs||null,Y.backUVs||null,Y.firstNormal||null,!!Y.adjustFrame)}function L(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=Y.path,d=Y.shape,A=Y.scaleFunction||(()=>1),c=Y.rotationFunction||(()=>0),t=Y.closePath||Y.ribbonCloseArray||!1,Z=Y.closeShape||Y.ribbonClosePath||!1,m=0===Y.cap?0:Y.cap||U.e.NO_CAP,V=Y.updatable,M=Y.firstNormal||null,u=Y.adjustFrame||!1;return a(K,d,v,null,null,A,c,t,Z,m,!0,l,!!V,U.e._GetDefaultSideOrientation(Y.sideOrientation),Y.instance||null,Y.invertUV||!1,Y.frontUVs||null,Y.backUVs||null,M,u)}function a(K,Y,l,d,A,c,t,m,V,M,u,o,W,g,J,n,R,H,z,r){const E=(K,Y,l,d,A,c,t,Z,m,V,M)=>{const u=l.getTangents(),o=l.getNormals(),W=l.getBinormals(),g=l.getDistances();if(M)for(let U=0;U<u.length;U++)if(0==u[U].x&&0==u[U].y&&0==u[U].z&&u[U].p(u[U-1]),0==o[U].x&&0==o[U].y&&0==o[U].z&&o[U].p(o[U-1]),0==W[U].x&&0==W[U].y&&0==W[U].z&&W[U].p(W[U-1]),U>0){let K=u[U-1];v.o.Dot(K,u[U])<0&&u[U].scaleInPlace(-1),K=o[U-1],v.o.Dot(K,o[U])<0&&o[U].scaleInPlace(-1),K=W[U-1],v.o.Dot(K,W[U])<0&&W[U].scaleInPlace(-1)}let J=0;const n=V&&Z?Z:()=>null!==c?c:0,R=V&&t?t:()=>null!==A?A:1;let H=m===U.e.NO_CAP||m===U.e.CAP_END?0:2;const z=v.j.Matrix[0];for(let U=0;U<Y.length;U++){const l=[],A=n(U,g[U]),c=R(U,g[U]);v.d.RotationAxisToRef(u[U],J,z);for(let d=0;d<K.length;d++){const A=u[U].scale(K[d].z).add(o[U].scale(K[d].x)).add(W[U].scale(K[d].y)),t=v.o.Zero();v.o.TransformCoordinatesToRef(A,z,t),t.scaleInPlace(c).addInPlace(Y[U]),l[d]=t}d[H]=l,J+=A,H++}const r=K=>{const Y=Array(),l=v.o.Zero();let U;for(U=0;U<K.length;U++)l.addInPlace(K[U]);for(l.scaleInPlace(1/K.length),U=0;U<K.length;U++)Y.push(l);return Y};switch(m){case U.e.NO_CAP:break;case U.e.CAP_START:d[0]=r(d[2]),d[1]=d[2];break;case U.e.CAP_END:d[H]=d[H-1],d[H+1]=r(d[H-1]);break;case U.e.CAP_ALL:d[0]=r(d[2]),d[1]=d[2],d[H]=d[H-1],d[H+1]=r(d[H-1])}return d};let y,T;if(J){const K=J._creationDataStorage;return y=z?K.path3D.update(l,z):K.path3D.update(l),T=E(Y,l,K.path3D,K.pathArray,d,A,c,t,K.cap,u,r),J=Z("",{pathArray:T,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:J},o||void 0)}y=z?new D.j(l,z):new D.j(l);T=E(Y,l,y,new Array,d,A,c,t,M=M<0||M>3?0:M,u,r);const e=Z(K,{pathArray:T,closeArray:m,closePath:V,updatable:W,sideOrientation:g,invertUV:n,frontUVs:R||void 0,backUVs:H||void 0},o);return e._creationDataStorage.pathArray=T,e._creationDataStorage.path3D=y,e._creationDataStorage.cap=M,e}A.c.CreatePolygon=f,U.e.CreatePolygon=function(K,Y,l,v,U,d){return w(K,{shape:Y,holes:v,updatable:U,sideOrientation:d},l,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},U.e.ExtrudePolygon=function(K,Y,l,v,U,d,A){return k(K,{shape:Y,holes:U,depth:l,updatable:d,sideOrientation:A},v,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function F(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=Y.arc?Y.arc<=0||Y.arc>1?1:Y.arc:1,A=void 0===Y.closed||Y.closed,c=Y.shape,t=Y.radius||1,m=Y.tessellation||64,V=Y.clip||0,M=Y.updatable,u=U.e._GetDefaultSideOrientation(Y.sideOrientation),o=Y.cap||U.e.NO_CAP,W=2*Math.PI,g=[],J=Y.invertUV||!1;let n=0,R=0;const H=W/m*d;let z,r;for(n=0;n<=m-V;n++){for(r=[],o!=U.e.CAP_START&&o!=U.e.CAP_ALL||(r.push(new v.o(0,c[0].y,0)),r.push(new v.o(Math.cos(n*H)*c[0].x*t,c[0].y,Math.sin(n*H)*c[0].x*t))),R=0;R<c.length;R++)z=new v.o(Math.cos(n*H)*c[R].x*t,c[R].y,Math.sin(n*H)*c[R].x*t),r.push(z);o!=U.e.CAP_END&&o!=U.e.CAP_ALL||(r.push(new v.o(Math.cos(n*H)*c[c.length-1].x*t,c[c.length-1].y,Math.sin(n*H)*c[c.length-1].x*t)),r.push(new v.o(0,c[c.length-1].y,0))),g.push(r)}return Z(K,{pathArray:g,closeArray:A,sideOrientation:u,updatable:M,invertUV:J,frontUVs:Y.frontUVs,backUVs:Y.backUVs},l)}U.e.ExtrudeShape=function(K,Y,l,v,d,A){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8?arguments[8]:void 0,m=arguments.length>9?arguments[9]:void 0;return I(K,{shape:Y,path:l,scale:v,rotation:d,cap:0===A?0:A||U.e.NO_CAP,sideOrientation:Z,instance:m,updatable:t},c)},U.e.ExtrudeShapeCustom=(K,Y,l,v,d,A,c,t,Z,m,V,M)=>L(K,{shape:Y,path:l,scaleFunction:v,rotationFunction:d,ribbonCloseArray:A,ribbonClosePath:c,cap:0===t?0:t||U.e.NO_CAP,sideOrientation:V,instance:M,updatable:m},Z);U.e.CreateLathe=(K,Y,l,v,U,d,A)=>F(K,{shape:Y,radius:l,tessellation:v,sideOrientation:A,updatable:d},U);var s=l(11956),b=l(11915);function x(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=Y.path;let A=Y.instance,c=1;void 0!==Y.radius?c=Y.radius:A&&(c=A._creationDataStorage.radius);const t=Y.tessellation||64,m=Y.radiusFunction||null;let V=Y.cap||U.e.NO_CAP;const M=Y.invertUV||!1,u=Y.updatable,o=U.e._GetDefaultSideOrientation(Y.sideOrientation);Y.arc=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1;const W=(K,Y,l,d,A,c,t,Z)=>{const m=Y.getTangents(),V=Y.getNormals(),M=Y.getDistances(),u=2*Math.PI/A*Z,o=c||(()=>d);let W,g,J,n;const R=v.j.Matrix[0];let H=t===U.e.NO_CAP||t===U.e.CAP_END?0:2;for(let U=0;U<K.length;U++){g=o(U,M[U]),W=Array(),J=V[U];for(let Y=0;Y<A;Y++)v.d.RotationAxisToRef(m[U],u*Y,R),n=W[Y]?W[Y]:v.o.Zero(),v.o.TransformCoordinatesToRef(J,R,n),n.scaleInPlace(g).addInPlace(K[U]),W[Y]=n;l[H]=W,H++}const z=(Y,l)=>{const v=Array();for(let U=0;U<Y;U++)v.push(K[l]);return v};switch(t){case U.e.NO_CAP:break;case U.e.CAP_START:l[0]=z(A,0),l[1]=l[2].slice(0);break;case U.e.CAP_END:l[H]=l[H-1].slice(0),l[H+1]=z(A,K.length-1);break;case U.e.CAP_ALL:l[0]=z(A,0),l[1]=l[2].slice(0),l[H]=l[H-1].slice(0),l[H+1]=z(A,K.length-1)}return l};let g,J;if(A){const K=A._creationDataStorage,l=Y.arc||K.arc;return g=K.path3D.update(d),J=W(d,g,K.pathArray,c,K.tessellation,m,K.cap,l),A=Z("",{pathArray:J,instance:A}),K.path3D=g,K.pathArray=J,K.arc=l,K.radius=c,A}g=new D.j(d);V=V<0||V>3?0:V,J=W(d,g,new Array,c,t,m,V,Y.arc);const n=Z(K,{pathArray:J,closePath:!0,closeArray:!1,updatable:u,sideOrientation:o,invertUV:M,frontUVs:Y.frontUVs,backUVs:Y.backUVs},l);return n._creationDataStorage.pathArray=J,n._creationDataStorage.path3D=g,n._creationDataStorage.tessellation=t,n._creationDataStorage.cap=V,n._creationDataStorage.arc=Y.arc,n._creationDataStorage.radius=c,n}function C(K){const Y=[];Y[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Y[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Y[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Y[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Y[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Y[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Y[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Y[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Y[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Y[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Y[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Y[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Y[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Y[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Y[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const l=K.type&&(K.type<0||K.type>=Y.length)?0:K.type||0,U=K.size,d=K.sizeX||U||1,t=K.sizeY||U||1,Z=K.sizeZ||U||1,m=K.custom||Y[l],V=m.face.length,u=K.faceUV||new Array(V),o=K.faceColors,W=void 0===K.flat||K.flat,g=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,J=[],n=[],R=[],H=[],z=[];let r=0,E=0;const y=[];let T,e,i,D,B,P,G=0,Q=0;if(W)for(Q=0;Q<V;Q++)o&&void 0===o[Q]&&(o[Q]=new M.g(1,1,1,1)),u&&void 0===u[Q]&&(u[Q]=new v.p(0,0,1,1));if(W)for(Q=0;Q<V;Q++){const K=m.face[Q].length;for(i=2*Math.PI/K,D=.5*Math.tan(i/2),B=.5,G=0;G<K;G++)J.push(m.vertex[m.face[Q][G]][0]*d,m.vertex[m.face[Q][G]][1]*t,m.vertex[m.face[Q][G]][2]*Z),y.push(r),r++,T=u[Q].x+(u[Q].z-u[Q].x)*(.5+D),e=u[Q].y+(u[Q].w-u[Q].y)*(B-.5),H.push(T,c.d?1-e:e),P=D*Math.cos(i)-B*Math.sin(i),B=D*Math.sin(i)+B*Math.cos(i),D=P,o&&z.push(o[Q].r,o[Q].g,o[Q].b,o[Q].a);for(G=0;G<K-2;G++)n.push(y[0+E],y[G+2+E],y[G+1+E]);E+=K}else{for(G=0;G<m.vertex.length;G++)J.push(m.vertex[G][0]*d,m.vertex[G][1]*t,m.vertex[G][2]*Z),H.push(0,c.d?1:0);for(Q=0;Q<V;Q++)for(G=0;G<m.face[Q].length-2;G++)n.push(m.face[Q][0],m.face[Q][G+2],m.face[Q][G+1])}A.c.ComputeNormals(J,n,R),A.c._ComputeSides(g,J,n,R,H,K.frontUVs,K.backUVs);const X=new A.c;return X.xa=J,X.indices=n,X.ya=R,X.Aa=H,o&&W&&(X.za=z),X}function N(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return C(Y).Ca(v,Y.updatable),v}U.e.CreateTube=(K,Y,l,v,U,d,A,c,t,Z)=>x(K,{path:Y,radius:l,tessellation:v,radiusFunction:U,arc:1,cap:d,updatable:c,sideOrientation:t,instance:Z},A);function j(K){const Y=K.sideOrientation||A.c.DEFAULTSIDE,l=K.radius||1,U=void 0===K.flat||K.flat,d=0|(K.subdivisions||4),t=K.radiusX||l,Z=K.radiusY||l,m=K.radiusZ||l,V=(1+Math.sqrt(5))/2,M=[-1,V,-0,1,V,0,-1,-V,0,1,-V,0,0,-1,-V,0,1,-V,0,-1,V,0,1,V,V,0,1,V,0,-1,-V,0,1,-V,0,-1],u=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],o=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],W=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],J=[],n=[],R=[],H=[];let z=0;const r=new Array(3),E=new Array(3);let y;for(y=0;y<3;y++)r[y]=v.o.Zero(),E[y]=v.m.Zero();for(let A=0;A<20;A++){for(y=0;y<3;y++){const K=u[3*A+y];r[y].mi(M[3*o[K]],M[3*o[K]+1],M[3*o[K]+2]),r[y].normalize(),E[y].mi(.134765625*W[2*K]+.05859375+-.0390625*g[A],.2333984375*W[2*K+1]+.025390625+.01953125*g[A])}const K=(K,Y,l,A)=>{const V=v.o.Lerp(r[0],r[2],Y/d),M=v.o.Lerp(r[1],r[2],Y/d),u=d===Y?r[2]:v.o.Lerp(V,M,K/(d-Y));let o;if(u.normalize(),U){const K=v.o.Lerp(r[0],r[2],A/d),Y=v.o.Lerp(r[1],r[2],A/d);o=v.o.Lerp(K,Y,l/(d-A))}else o=new v.o(u.x,u.y,u.z);o.x/=t,o.y/=Z,o.z/=m,o.normalize();const W=v.m.Lerp(E[0],E[2],Y/d),g=v.m.Lerp(E[1],E[2],Y/d),y=d===Y?E[2]:v.m.Lerp(W,g,K/(d-Y));n.push(u.x*t,u.y*Z,u.z*m),R.push(o.x,o.y,o.z),H.push(y.x,c.d?1-y.y:y.y),J.push(z),z++};for(let Y=0;Y<d;Y++)for(let l=0;l+Y<d;l++)K(l,Y,l+1/3,Y+1/3),K(l+1,Y,l+1/3,Y+1/3),K(l,Y+1,l+1/3,Y+1/3),l+Y+1<d&&(K(l+1,Y,l+2/3,Y+2/3),K(l+1,Y+1,l+2/3,Y+2/3),K(l,Y+1,l+2/3,Y+2/3))}A.c._ComputeSides(Y,n,J,R,H,K.frontUVs,K.backUVs);const T=new A.c;return T.indices=J,T.xa=n,T.ya=R,T.Aa=H,T}function p(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new U.e(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),v._originalBuilderSideOrientation=Y.sideOrientation;return j(Y).Ca(v,Y.updatable),v}A.c.CreatePolyhedron=C,U.e.CreatePolyhedron=(K,Y,l)=>N(K,Y,l);A.c.CreateIcoSphere=j,U.e.CreateIcoSphere=(K,Y,l)=>p(K,Y,l);var S=l(695);const q=new v.o(1,0,0),O=new v.o(-1,0,0),h=new v.o(0,1,0),KK=new v.o(0,-1,0),YK=new v.o(0,0,1),lK=new v.o(0,0,-1);class vK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.o.Zero(),Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.o.Up(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.m.Zero(),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=K,this.Ri=Y,this.uv=l,this.vertexIdx=U,this.vertexIdxForBones=d,this.localPositionOverride=A,this.localNormalOverride=c,this.matrixIndicesOverride=t,this.matrixWeightsOverride=Z}clone(){var K,Y,l,v;return new vK(this.position.clone(),this.Ri.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(K=this.localPositionOverride)||void 0===K?void 0:K.slice(),null===(Y=this.localNormalOverride)||void 0===Y?void 0:Y.slice(),null===(l=this.matrixIndicesOverride)||void 0===l?void 0:l.slice(),null===(v=this.matrixWeightsOverride)||void 0===v?void 0:v.slice())}}function UK(K,Y,l){var t,Z,m,V;const M=!!Y.skeleton,u=l.localMode||M,o=Y.si(),W=M?Y.Of(!0,!0):Y.getVerticesData(d.e.PositionKind),g=M?Y.getNormalsData(!0,!0):Y.getVerticesData(d.e.NormalKind),J=u?M?Y.getVerticesData(d.e.PositionKind):W:null,n=u?M?Y.getVerticesData(d.e.NormalKind):g:null,R=Y.getVerticesData(d.e.UVKind),H=M?Y.getVerticesData(d.e.MatricesIndicesKind):null,z=M?Y.getVerticesData(d.e.MatricesWeightsKind):null,r=M?Y.getVerticesData(d.e.MatricesIndicesExtraKind):null,E=M?Y.getVerticesData(d.e.MatricesWeightsExtraKind):null,y=l.position||v.o.Zero();let T=l.Ri||v.o.Up();const e=l.size||v.o.One(),i=l.angle||0;if(!T){const K=new v.o(0,0,1),l=Y.va().activeCamera,U=v.o.TransformCoordinates(K,l.getWorldMatrix());T=l.globalPosition.Lg(U)}const D=-Math.atan2(T.z,T.x)-Math.PI/2,B=Math.sqrt(T.x*T.x+T.z*T.z),P=Math.atan2(T.y,B),G=new A.c;G.indices=[],G.xa=[],G.ya=[],G.Aa=[],G.matricesIndices=M?[]:null,G.matricesWeights=M?[]:null,G.matricesIndicesExtra=r?[]:null,G.matricesWeightsExtra=E?[]:null;let Q=0;const X=(K,Y)=>{const U=new vK;if(!o||!W||!g)return U;const d=o[K];if(U.vertexIdx=3*d,U.vertexIdxForBones=4*d,U.position=new v.o(W[3*d],W[3*d+1],W[3*d+2]),v.o.TransformCoordinatesToRef(U.position,Y,U.position),U.Ri=new v.o(g[3*d],g[3*d+1],g[3*d+2]),v.o.TransformNormalToRef(U.Ri,Y,U.Ri),l.captureUVS&&R){const K=R[2*d+1];U.uv=new v.m(R[2*d],c.d?1-K:K)}return U},f=[0,0,0,0],w=(K,Y)=>{if(0===K.length)return K;const l=.5*Math.abs(v.o.Dot(e,Y)),U=(K,Y,l,v)=>{for(let U=0;U<v;++U)if(K[l+U]===Y)return l+U;return-1},d=(K,d)=>{const A=v.o.GetClipFactor(K.position,d.position,Y,l);let c=f,t=f;if(H&&z){const Y=K.matrixIndicesOverride?0:K.vertexIdxForBones,l=K.matrixIndicesOverride??H,v=K.matrixWeightsOverride??z,Z=d.matrixIndicesOverride?0:d.vertexIdxForBones,m=d.matrixIndicesOverride??H,V=d.matrixWeightsOverride??z;c=[0,0,0,0],t=[0,0,0,0];let M=0;for(let K=0;K<4;++K)if(v[Y+K]>0){const d=U(m,l[Y+K],Z,4);c[M]=l[Y+K],t[M]=(0,S.p)(v[Y+K],d>=0?V[d]:0,A),M++}for(let K=0;K<4&&M<4;++K){const v=m[Z+K];-1===U(l,v,Y,4)&&(c[M]=v,t[M]=(0,S.p)(0,V[Z+K],A),M++)}const u=t[0]+t[1]+t[2]+t[3];t[0]/=u,t[1]/=u,t[2]/=u,t[3]/=u}const Z=K.localPositionOverride?K.localPositionOverride[0]:(null===J||void 0===J?void 0:J[K.vertexIdx])??0,m=K.localPositionOverride?K.localPositionOverride[1]:(null===J||void 0===J?void 0:J[K.vertexIdx+1])??0,V=K.localPositionOverride?K.localPositionOverride[2]:(null===J||void 0===J?void 0:J[K.vertexIdx+2])??0,M=d.localPositionOverride?d.localPositionOverride[0]:(null===J||void 0===J?void 0:J[d.vertexIdx])??0,u=d.localPositionOverride?d.localPositionOverride[1]:(null===J||void 0===J?void 0:J[d.vertexIdx+1])??0,o=d.localPositionOverride?d.localPositionOverride[2]:(null===J||void 0===J?void 0:J[d.vertexIdx+2])??0,W=K.localNormalOverride?K.localNormalOverride[0]:(null===n||void 0===n?void 0:n[K.vertexIdx])??0,g=K.localNormalOverride?K.localNormalOverride[1]:(null===n||void 0===n?void 0:n[K.vertexIdx+1])??0,R=K.localNormalOverride?K.localNormalOverride[2]:(null===n||void 0===n?void 0:n[K.vertexIdx+2])??0,r=W+((d.localNormalOverride?d.localNormalOverride[0]:(null===n||void 0===n?void 0:n[d.vertexIdx])??0)-W)*A,E=g+((d.localNormalOverride?d.localNormalOverride[1]:(null===n||void 0===n?void 0:n[d.vertexIdx+1])??0)-g)*A,y=R+((d.localNormalOverride?d.localNormalOverride[2]:(null===n||void 0===n?void 0:n[d.vertexIdx+2])??0)-R)*A,T=Math.sqrt(r*r+E*E+y*y);return new vK(v.o.Lerp(K.position,d.position,A),v.o.Lerp(K.Ri,d.Ri,A).normalize(),v.m.Lerp(K.uv,d.uv,A),-1,-1,J?[Z+(M-Z)*A,m+(u-m)*A,V+(o-V)*A]:null,n?[r/T,E/T,y/T]:null,c,t)};let A=null;K.length>3&&(A=[]);for(let c=0;c<K.length;c+=3){let U=0,t=null,Z=null,m=null,V=null;const M=v.o.Dot(K[c].position,Y)-l>0,u=v.o.Dot(K[c+1].position,Y)-l>0,o=v.o.Dot(K[c+2].position,Y)-l>0;switch(U=(M?1:0)+(u?1:0)+(o?1:0),U){case 0:K.length>3?(A.push(K[c]),A.push(K[c+1]),A.push(K[c+2])):A=K;break;case 1:if(A=A??new Array,M&&(t=K[c+1],Z=K[c+2],m=d(K[c],t),V=d(K[c],Z)),u){t=K[c],Z=K[c+2],m=d(K[c+1],t),V=d(K[c+1],Z),A.push(m),A.push(Z.clone()),A.push(t.clone()),A.push(Z.clone()),A.push(m.clone()),A.push(V);break}o&&(t=K[c],Z=K[c+1],m=d(K[c+2],t),V=d(K[c+2],Z)),t&&Z&&m&&V&&(A.push(t.clone()),A.push(Z.clone()),A.push(m),A.push(V),A.push(m.clone()),A.push(Z.clone()));break;case 2:A=A??new Array,M||(t=K[c].clone(),Z=d(t,K[c+1]),m=d(t,K[c+2]),A.push(t),A.push(Z),A.push(m)),u||(t=K[c+1].clone(),Z=d(t,K[c+2]),m=d(t,K[c]),A.push(t),A.push(Z),A.push(m)),o||(t=K[c+2].clone(),Z=d(t,K[c]),m=d(t,K[c+1]),A.push(t),A.push(Z),A.push(m))}}return A},k=Y instanceof U.e?Y:null,I=null===k||void 0===k?void 0:k._thinInstanceDataStorage.matrixData,L=(null===k||void 0===k?void 0:k.ai)||1,a=v.j.Matrix[0];a.p(v.d.IdentityReadOnly);for(let U=0;U<L;++U){if(null!==k&&void 0!==k&&k.hasThinInstances&&I){const K=16*U;a.setRowFromFloats(0,I[K+0],I[K+1],I[K+2],I[K+3]),a.setRowFromFloats(1,I[K+4],I[K+5],I[K+6],I[K+7]),a.setRowFromFloats(2,I[K+8],I[K+9],I[K+10],I[K+11]),a.setRowFromFloats(3,I[K+12],I[K+13],I[K+14],I[K+15])}const K=v.d.RotationYawPitchRoll(D,P,i).multiply(v.d.Translation(y.x,y.y,y.z)),d=v.d.Invert(K),A=Y.getWorldMatrix(),t=a.multiply(A).multiply(d),Z=new Array(3);for(let Y=0;Y<o.length;Y+=3){let K=Z;if(K[0]=X(Y,t),K[1]=X(Y+1,t),K[2]=X(Y+2,t),!(l.cullBackFaces&&-K[0].Ri.z<=0&&-K[1].Ri.z<=0&&-K[2].Ri.z<=0)&&(K=w(K,q),K&&(K=w(K,O),K&&(K=w(K,h),K&&(K=w(K,KK),K&&(K=w(K,YK),K&&(K=w(K,lK),K)))))))for(let Y=0;Y<K.length;Y++){const v=K[Y];if(G.indices.push(Q),u?(v.localPositionOverride?(G.xa[3*Q]=v.localPositionOverride[0],G.xa[3*Q+1]=v.localPositionOverride[1],G.xa[3*Q+2]=v.localPositionOverride[2]):J&&(G.xa[3*Q]=J[v.vertexIdx],G.xa[3*Q+1]=J[v.vertexIdx+1],G.xa[3*Q+2]=J[v.vertexIdx+2]),v.localNormalOverride?(G.ya[3*Q]=v.localNormalOverride[0],G.ya[3*Q+1]=v.localNormalOverride[1],G.ya[3*Q+2]=v.localNormalOverride[2]):n&&(G.ya[3*Q]=n[v.vertexIdx],G.ya[3*Q+1]=n[v.vertexIdx+1],G.ya[3*Q+2]=n[v.vertexIdx+2])):(v.position.toArray(G.xa,3*Q),v.Ri.toArray(G.ya,3*Q)),G.matricesIndices&&G.matricesWeights&&(v.matrixIndicesOverride?(G.matricesIndices[4*Q]=v.matrixIndicesOverride[0],G.matricesIndices[4*Q+1]=v.matrixIndicesOverride[1],G.matricesIndices[4*Q+2]=v.matrixIndicesOverride[2],G.matricesIndices[4*Q+3]=v.matrixIndicesOverride[3]):(H&&(G.matricesIndices[4*Q]=H[v.vertexIdxForBones],G.matricesIndices[4*Q+1]=H[v.vertexIdxForBones+1],G.matricesIndices[4*Q+2]=H[v.vertexIdxForBones+2],G.matricesIndices[4*Q+3]=H[v.vertexIdxForBones+3]),r&&G.matricesIndicesExtra&&(G.matricesIndicesExtra[4*Q]=r[v.vertexIdxForBones],G.matricesIndicesExtra[4*Q+1]=r[v.vertexIdxForBones+1],G.matricesIndicesExtra[4*Q+2]=r[v.vertexIdxForBones+2],G.matricesIndicesExtra[4*Q+3]=r[v.vertexIdxForBones+3])),v.matrixWeightsOverride?(G.matricesWeights[4*Q]=v.matrixWeightsOverride[0],G.matricesWeights[4*Q+1]=v.matrixWeightsOverride[1],G.matricesWeights[4*Q+2]=v.matrixWeightsOverride[2],G.matricesWeights[4*Q+3]=v.matrixWeightsOverride[3]):(z&&(G.matricesWeights[4*Q]=z[v.vertexIdxForBones],G.matricesWeights[4*Q+1]=z[v.vertexIdxForBones+1],G.matricesWeights[4*Q+2]=z[v.vertexIdxForBones+2],G.matricesWeights[4*Q+3]=z[v.vertexIdxForBones+3]),E&&G.matricesWeightsExtra&&(G.matricesWeightsExtra[4*Q]=E[v.vertexIdxForBones],G.matricesWeightsExtra[4*Q+1]=E[v.vertexIdxForBones+1],G.matricesWeightsExtra[4*Q+2]=E[v.vertexIdxForBones+2],G.matricesWeightsExtra[4*Q+3]=E[v.vertexIdxForBones+3]))),l.captureUVS)v.uv.toArray(G.Aa,2*Q);else{G.Aa.push(.5+v.position.x/e.x);const K=.5+v.position.y/e.y;G.Aa.push(c.d?1-K:K)}Q++}}}0===G.indices.length&&(G.indices=null),0===G.xa.length&&(G.xa=null),0===G.ya.length&&(G.ya=null),0===G.Aa.length&&(G.Aa=null),0===(null===(t=G.matricesIndices)||void 0===t?void 0:t.length)&&(G.matricesIndices=null),0===(null===(Z=G.matricesWeights)||void 0===Z?void 0:Z.length)&&(G.matricesWeights=null),0===(null===(m=G.matricesIndicesExtra)||void 0===m?void 0:m.length)&&(G.matricesIndicesExtra=null),0===(null===(V=G.matricesWeightsExtra)||void 0===V?void 0:V.length)&&(G.matricesWeightsExtra=null);const F=new U.e(K,Y.va());return G.Ca(F),u?(F.skeleton=Y.skeleton,F.parent=Y):(F.position=y.clone(),F.rotation=new v.o(P,D,i)),F.ri(!0),F.refreshBoundingInfo(!0,!0),F}function dK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const Y=0|Math.max(K.subdivisions?K.subdivisions:2,1),l=0|Math.max(K.tessellation?K.tessellation:16,3),U=Math.max(K.height?K.height:1,0),d=Math.max(K.radius?K.radius:.25,0),t=0|Math.max(K.capSubdivisions?K.capSubdivisions:6,1),Z=l,m=Y,V=Math.max(K.radiusTop?K.radiusTop:d,0),M=Math.max(K.radiusBottom?K.radiusBottom:d,0),u=U-(V+M),o=2*Math.PI,W=Math.max(K.topCapSubdivisions?K.topCapSubdivisions:t,1),g=Math.max(K.bottomCapSubdivisions?K.bottomCapSubdivisions:t,1),J=Math.acos((M-V)/U);let n=[];const R=[],H=[],z=[];let r=0;const E=[],y=.5*u,T=.5*Math.PI;let e,i;const D=v.o.Zero(),B=v.o.Zero(),P=Math.cos(J),G=Math.sin(J),Q=new v.m(V*G,y+V*P).Lg(new v.m(M*G,M*P-y)).length(),X=V*J+Q+M*(T-J);let f=0;for(i=0;i<=W;i++){const K=[],Y=T-J*(i/W);f+=V*J/W;const l=Math.cos(Y),v=Math.sin(Y),U=l*V;for(e=0;e<=Z;e++){const Y=e/Z,d=Y*o+0,A=Math.sin(d),t=Math.cos(d);B.x=U*A,B.y=y+v*V,B.z=U*t,R.push(B.x,B.y,B.z),D.set(l*A,v,l*t),H.push(D.x,D.y,D.z),z.push(Y,c.d?f/X:1-f/X),K.push(r),r++}E.push(K)}const w=U-V-M+P*V-P*M,k=G*(M-V)/w;for(i=1;i<=m;i++){const K=[];f+=Q/m;const Y=G*(i*(M-V)/m+V);for(e=0;e<=Z;e++){const l=e/Z,v=l*o+0,U=Math.sin(v),d=Math.cos(v);B.x=Y*U,B.y=y+P*V-i*w/m,B.z=Y*d,R.push(B.x,B.y,B.z),D.set(U,k,d).normalize(),H.push(D.x,D.y,D.z),z.push(l,c.d?f/X:1-f/X),K.push(r),r++}E.push(K)}for(i=1;i<=g;i++){const K=[],Y=T-J-(Math.PI-J)*(i/g);f+=M*J/g;const l=Math.cos(Y),v=Math.sin(Y),U=l*M;for(e=0;e<=Z;e++){const Y=e/Z,d=Y*o+0,A=Math.sin(d),t=Math.cos(d);B.x=U*A,B.y=v*M-y,B.z=U*t,R.push(B.x,B.y,B.z),D.set(l*A,v,l*t),H.push(D.x,D.y,D.z),z.push(Y,c.d?f/X:1-f/X),K.push(r),r++}E.push(K)}for(e=0;e<Z;e++)for(i=0;i<W+m+g;i++){const K=E[i][e],Y=E[i+1][e],l=E[i+1][e+1],v=E[i][e+1];n.push(K),n.push(Y),n.push(v),n.push(Y),n.push(l),n.push(v)}if(n=n.reverse(),K.orientation&&!K.orientation.equals(v.o.Up())){const Y=new v.d;K.orientation.clone().scale(.5*Math.PI).cross(v.o.Up()).toQuaternion().toRotationMatrix(Y);const l=v.o.Zero();for(let K=0;K<R.length;K+=3)l.set(R[K],R[K+1],R[K+2]),v.o.TransformCoordinatesToRef(l.clone(),Y,l),R[K]=l.x,R[K+1]=l.y,R[K+2]=l.z}const I=new A.c;return I.xa=R,I.ya=H,I.Aa=z,I.indices=n,I}function AK(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:v.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new U.e(K,l);return dK(Y).Ca(d,Y.updatable),d}U.e.CreateDecal=(K,Y,l,v,U,d)=>UK(K,Y,{position:l,Ri:v,size:U,angle:d});U.e.CreateCapsule=(K,Y,l)=>AK(K,Y,l),A.c.CreateCapsule=dK;class cK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=Y,K!==Math.floor(K)&&(K=Math.floor(K),i.e.Warn("x is not an integer, floor(x) used")),Y!==Math.floor(Y)&&(Y=Math.floor(Y),i.e.Warn("y is not an integer, floor(y) used"))}clone(){return new cK(this.x,this.y)}rotate60About(K){const Y=this.x;return this.x=K.x+K.y-this.y,this.y=Y+this.y-K.x,this}rotateNeg60About(K){const Y=this.x;return this.x=Y+this.y-K.y,this.y=K.x+K.y-Y,this}rotate120(K,Y){K!==Math.floor(K)&&(K=Math.floor(K),i.e.Warn("m not an integer only floor(m) used")),Y!==Math.floor(Y)&&(Y=Math.floor(Y),i.e.Warn("n not an integer only floor(n) used"));const l=this.x;return this.x=K-l-this.y,this.y=Y+l,this}rotateNeg120(K,Y){K!==Math.floor(K)&&(K=Math.floor(K),i.e.Warn("m is not an integer, floor(m) used")),Y!==Math.floor(Y)&&(Y=Math.floor(Y),i.e.Warn("n is not an integer,   floor(n) used"));const l=this.x;return this.x=this.y-Y,this.y=K+Y-l-this.y,this}toCartesianOrigin(K,Y){const l=v.o.Zero();return l.x=K.x+2*this.x*Y+this.y*Y,l.y=K.y+Math.sqrt(3)*this.y*Y,l}static Zero(){return new cK(0,0)}}class tK{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ZK("icosahedron","Regular",[[0,B.g,-1],[-B.g,1,0],[-1,0,-B.g],[1,0,-B.g],[B.g,1,0],[0,B.g,1],[-1,0,B.g],[-B.g,-1,0],[0,-B.g,-1],[B.g,-1,0],[1,0,B.g],[0,-B.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let K=12;const Y={},l=this.m,v=this.n;let U,d,A,c,t,Z=l,m=1,V=0;0!==v&&(Z=(0,S.k)(l,v)),m=l/Z,V=v/Z;const M=cK.Zero(),u=new cK(l,v),o=new cK(-v,l+v),W=cK.Zero(),g=cK.Zero(),J=cK.Zero();let n,R,H,z,r=[];const E=[],y=this.vertByDist,T=(l,v,U,d)=>{n=l+"|"+U,R=v+"|"+d,n in Y||R in Y?n in Y&&!(R in Y)?Y[R]=Y[n]:R in Y&&!(n in Y)&&(Y[n]=Y[R]):(Y[n]=K,Y[R]=K,K++),y[U][0]>2?E[Y[n]]=[-y[U][0],y[U][1],Y[n]]:E[Y[n]]=[r[y[U][0]],y[U][1],Y[n]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let e=0;e<20;e++){if(r=this.IDATA.face[e],A=r[2],c=r[1],t=r[0],H=M.x+"|"+M.y,n=e+"|"+H,n in Y||(Y[n]=A,E[A]=[r[y[H][0]],y[H][1]]),H=u.x+"|"+u.y,n=e+"|"+H,n in Y||(Y[n]=c,E[c]=[r[y[H][0]],y[H][1]]),H=o.x+"|"+o.y,n=e+"|"+H,n in Y||(Y[n]=t,E[t]=[r[y[H][0]],y[H][1]]),U=this.IDATA.edgematch[e][0],d=this.IDATA.edgematch[e][1],"B"===d)for(let K=1;K<Z;K++)g.x=l-K*(m+V),g.y=v+K*m,J.x=-K*V,J.y=K*(m+V),H=g.x+"|"+g.y,z=J.x+"|"+J.y,T(e,U,H,z);if("O"===d)for(let K=1;K<Z;K++)J.x=-K*V,J.y=K*(m+V),W.x=K*m,W.y=K*V,H=J.x+"|"+J.y,z=W.x+"|"+W.y,T(e,U,H,z);if(U=this.IDATA.edgematch[e][2],d=this.IDATA.edgematch[e][3],d&&"A"===d)for(let K=1;K<Z;K++)W.x=K*m,W.y=K*V,g.x=l-(Z-K)*(m+V),g.y=v+(Z-K)*m,H=W.x+"|"+W.y,z=g.x+"|"+g.y,T(e,U,H,z);for(let l=0;l<this.vertices.length;l++)H=this.vertices[l].x+"|"+this.vertices[l].y,n=e+"|"+H,n in Y||(Y[n]=K++,y[H][0]>2?E[Y[n]]=[-y[H][0],y[H][1],Y[n]]:E[Y[n]]=[r[y[H][0]],y[H][1],Y[n]])}this.closestTo=E,this.vecToidx=Y}calcCoeffs(){const K=this.m,Y=this.n,l=Math.sqrt(3)/3,v=K*K+Y*Y+K*Y;this.coau=(K+Y)/v,this.cobu=-Y/v,this.coav=-l*(K-Y)/v,this.cobv=l*(2*K+Y)/v}createInnerFacets(){const K=this.m,Y=this.n;for(let l=0;l<Y+K+1;l++)for(let K=this.min[l];K<this.max[l]+1;K++)K<this.max[l]&&K<this.max[l+1]+1&&this.innerFacets.push(["|"+K+"|"+l,"|"+K+"|"+(l+1),"|"+(K+1)+"|"+l]),l>0&&K<this.max[l-1]&&K+1<this.max[l]+1&&this.innerFacets.push(["|"+K+"|"+l,"|"+(K+1)+"|"+l,"|"+(K+1)+"|"+(l-1)])}edgeVecsABOB(){const K=this.m,Y=this.n,l=new cK(-Y,K+Y);for(let v=1;v<K+Y;v++){const K=new cK(this.min[v],v),Y=new cK(this.min[v-1],v-1),U=new cK(this.min[v+1],v+1),d=K.clone(),A=Y.clone(),c=U.clone();d.rotate60About(l),A.rotate60About(l),c.rotate60About(l);const t=new cK(this.max[d.y],d.y),Z=new cK(this.max[d.y-1],d.y-1),m=new cK(this.max[d.y-1]-1,d.y-1);d.x===t.x&&d.y===t.y||(d.x!==Z.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Z,m]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,m,t])):d.y===c.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,Y,Z]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([K,Z,U])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,Y,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Z,t])))}}mapABOBtoOBOA(){const K=new cK(0,0);for(let Y=0;Y<this.isoVecsABOB.length;Y++){const l=[];for(let v=0;v<3;v++)K.x=this.isoVecsABOB[Y][v].x,K.y=this.isoVecsABOB[Y][v].y,0===this.vertexTypes[Y][v]&&K.rotateNeg120(this.m,this.n),l.push(K.clone());this.isoVecsOBOA.push(l)}}mapABOBtoBAOA(){const K=new cK(0,0);for(let Y=0;Y<this.isoVecsABOB.length;Y++){const l=[];for(let v=0;v<3;v++)K.x=this.isoVecsABOB[Y][v].x,K.y=this.isoVecsABOB[Y][v].y,1===this.vertexTypes[Y][v]&&K.rotate120(this.m,this.n),l.push(K.clone());this.isoVecsBAOA.push(l)}}MapToFace(K,Y){const l=this.IDATA.face[K],U=l[2],d=l[1],A=l[0],c=v.o.yi(this.IDATA.vertex[U]),t=v.o.yi(this.IDATA.vertex[d]),Z=v.o.yi(this.IDATA.vertex[A]),m=t.Lg(c),V=Z.Lg(c),M=m.scale(this.coau).add(V.scale(this.cobu)),u=m.scale(this.coav).add(V.scale(this.cobv)),o=[];let W,g=v.j.Qi[0];for(let v=0;v<this.cartesian.length;v++)g=M.scale(this.cartesian[v].x).add(u.scale(this.cartesian[v].y)).add(c),o[v]=[g.x,g.y,g.z],W=K+"|"+this.vertices[v].x+"|"+this.vertices[v].y,Y.vertex[this.vecToidx[W]]=[g.x,g.y,g.z]}build(K,Y){const l=[],v=cK.Zero(),U=new cK(K,Y),d=new cK(-Y,K+Y);l.push(v,U,d);for(let H=Y;H<K+1;H++)for(let Y=0;Y<K+1-H;Y++)l.push(new cK(Y,H));if(Y>0){const v=(0,S.k)(K,Y),U=K/v,d=Y/v;for(let c=1;c<v;c++)l.push(new cK(c*U,c*d)),l.push(new cK(-c*d,c*(U+d))),l.push(new cK(K-c*(U+d),Y+c*U));const A=K/Y;for(let c=1;c<Y;c++)for(let v=0;v<c*A;v++)l.push(new cK(v,c)),l.push(new cK(v,c).rotate120(K,Y)),l.push(new cK(v,c).rotateNeg120(K,Y))}l.sort(((K,Y)=>K.x-Y.x)),l.sort(((K,Y)=>K.y-Y.y));const A=new Array(K+Y+1),c=new Array(K+Y+1);for(let H=0;H<A.length;H++)A[H]=1/0,c[H]=-1/0;let t=0,Z=0;const m=l.length;for(let H=0;H<m;H++)Z=l[H].x,t=l[H].y,A[t]=Math.min(Z,A[t]),c[t]=Math.max(Z,c[t]);const V=(l,v)=>{const U=l.clone();return"A"===v&&U.rotateNeg120(K,Y),"B"===v&&U.rotate120(K,Y),U.x<0?U.y:U.x+U.y},M=[],u=[],o=[],W=[],g={},J=[];let n=-1,R=-1;for(let H=0;H<m;H++)M[H]=l[H].toCartesianOrigin(new cK(0,0),.5),u[H]=V(l[H],"O"),o[H]=V(l[H],"A"),W[H]=V(l[H],"B"),u[H]===o[H]&&o[H]===W[H]?(n=3,R=u[H]):u[H]===o[H]?(n=4,R=u[H]):o[H]===W[H]?(n=5,R=o[H]):W[H]===u[H]&&(n=6,R=u[H]),u[H]<o[H]&&u[H]<W[H]&&(n=2,R=u[H]),o[H]<u[H]&&o[H]<W[H]&&(n=1,R=o[H]),W[H]<o[H]&&W[H]<u[H]&&(n=0,R=W[H]),J.push([n,R,l[H].x,l[H].y]);J.sort(((K,Y)=>K[2]-Y[2])),J.sort(((K,Y)=>K[3]-Y[3])),J.sort(((K,Y)=>K[1]-Y[1])),J.sort(((K,Y)=>K[0]-Y[0]));for(let H=0;H<J.length;H++)g[J[H][2]+"|"+J[H][3]]=[J[H][0],J[H][1],H];return this.m=K,this.n=Y,this.vertices=l,this.vertByDist=g,this.cartesian=M,this.min=A,this.max=c,this}}class ZK{constructor(K,Y,l,v){this.name=K,this.category=Y,this.vertex=l,this.face=v}}class mK extends ZK{innerToData(K,Y){for(let l=0;l<Y.innerFacets.length;l++)this.face.push(Y.innerFacets[l].map((l=>Y.vecToidx[K+l])))}mapABOBtoDATA(K,Y){const l=Y.IDATA.edgematch[K][0];for(let v=0;v<Y.isoVecsABOB.length;v++){const U=[];for(let d=0;d<3;d++)0===Y.vertexTypes[v][d]?U.push(K+"|"+Y.isoVecsABOB[v][d].x+"|"+Y.isoVecsABOB[v][d].y):U.push(l+"|"+Y.isoVecsABOB[v][d].x+"|"+Y.isoVecsABOB[v][d].y);this.face.push([Y.vecToidx[U[0]],Y.vecToidx[U[1]],Y.vecToidx[U[2]]])}}mapOBOAtoDATA(K,Y){const l=Y.IDATA.edgematch[K][0];for(let v=0;v<Y.isoVecsOBOA.length;v++){const U=[];for(let d=0;d<3;d++)1===Y.vertexTypes[v][d]?U.push(K+"|"+Y.isoVecsOBOA[v][d].x+"|"+Y.isoVecsOBOA[v][d].y):U.push(l+"|"+Y.isoVecsOBOA[v][d].x+"|"+Y.isoVecsOBOA[v][d].y);this.face.push([Y.vecToidx[U[0]],Y.vecToidx[U[1]],Y.vecToidx[U[2]]])}}mapBAOAtoDATA(K,Y){const l=Y.IDATA.edgematch[K][2];for(let v=0;v<Y.isoVecsBAOA.length;v++){const U=[];for(let d=0;d<3;d++)1===Y.vertexTypes[v][d]?U.push(K+"|"+Y.isoVecsBAOA[v][d].x+"|"+Y.isoVecsBAOA[v][d].y):U.push(l+"|"+Y.isoVecsBAOA[v][d].x+"|"+Y.isoVecsBAOA[v][d].y);this.face.push([Y.vecToidx[U[0]],Y.vecToidx[U[1]],Y.vecToidx[U[2]]])}}orderData(K){const Y=[];for(let d=0;d<13;d++)Y[d]=[];const l=K.closestTo;for(let d=0;d<l.length;d++)l[d][0]>-1?l[d][1]>0&&Y[l[d][0]].push([d,l[d][1]]):Y[12].push([d,l[d][0]]);const v=[];for(let d=0;d<12;d++)v[d]=d;let U=12;for(let d=0;d<12;d++){Y[d].sort(((K,Y)=>K[1]-Y[1]));for(let K=0;K<Y[d].length;K++)v[Y[d][K][0]]=U++}for(let d=0;d<Y[12].length;d++)v[Y[12][d][0]]=U++;for(let d=0;d<this.vertex.length;d++)this.vertex[d].push(v[d]);this.vertex.sort(((K,Y)=>K[3]-Y[3]));for(let d=0;d<this.vertex.length;d++)this.vertex[d].pop();for(let d=0;d<this.face.length;d++)for(let K=0;K<this.face[d].length;K++)this.face[d][K]=v[this.face[d][K]];this.sharedNodes=Y[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(K,Y){const l=[],v=[];let U=Y.pop();v.push(U);let d=this.face[U].indexOf(K);d=(d+2)%3;let A=this.face[U][d];l.push(A);let c=0;for(;Y.length>0;)U=Y[c],this.face[U].indexOf(A)>-1?(d=(this.face[U].indexOf(A)+1)%3,A=this.face[U][d],l.push(A),v.push(U),Y.splice(c,1),c=0):c++;return this.adjacentFaces.push(l),v}toGoldbergPolyhedronData(){const K=new ZK("GeoDual","Goldberg",[],[]);K.name="GD dual";const Y=this.vertex.length,l=new Array(Y);for(let t=0;t<Y;t++)l[t]=[];for(let t=0;t<this.face.length;t++)for(let K=0;K<3;K++)l[this.face[t][K]].push(t);let v=0,U=0,d=0,A=[],c=[];this.adjacentFaces=[];for(let t=0;t<l.length;t++)K.face[t]=this.setOrder(t,l[t].concat([])),l[t].forEach((Y=>{v=0,U=0,d=0,A=this.face[Y];for(let K=0;K<3;K++)c=this.vertex[A[K]],v+=c[0],U+=c[1],d+=c[2];K.vertex[Y]=[v/3,U/3,d/3]}));return K}static BuildGeodesicData(K){const Y=new mK("Geodesic-m-n","Geodesic",[[0,B.g,-1],[-B.g,1,0],[-1,0,-B.g],[1,0,-B.g],[B.g,1,0],[0,B.g,1],[-1,0,B.g],[-B.g,-1,0],[0,-B.g,-1],[B.g,-1,0],[1,0,B.g],[0,-B.g,1]],[]);K.setIndices(),K.calcCoeffs(),K.createInnerFacets(),K.edgeVecsABOB(),K.mapABOBtoOBOA(),K.mapABOBtoBAOA();for(let l=0;l<K.IDATA.face.length;l++)K.MapToFace(l,Y),Y.innerToData(l,K),"B"===K.IDATA.edgematch[l][1]&&Y.mapABOBtoDATA(l,K),"O"===K.IDATA.edgematch[l][1]&&Y.mapOBOAtoDATA(l,K),"A"===K.IDATA.edgematch[l][3]&&Y.mapBAOAtoDATA(l,K);Y.orderData(K);return Y.vertex=Y.vertex.map((function(K){const Y=K[0],l=K[1],v=K[2],U=Math.sqrt(Y*Y+l*l+v*v);return K[0]*=1/U,K[1]*=1/U,K[2]*=1/U,K})),Y}}U.e._GoldbergMeshParser=(K,Y)=>VK.Parse(K,Y);class VK extends U.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(K,Y){return void 0===Y?(K>this.goldbergData.nbUnsharedFaces-1&&(i.e.Warn("Maximum number of unshared faces used"),K=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+K):(K>11&&(i.e.Warn("Last pole used"),K=11),Y>this.goldbergData.nbFacesAtPole-1&&(i.e.Warn("Maximum number of faces at a pole used"),Y=this.goldbergData.nbFacesAtPole-1),12+K*this.goldbergData.nbFacesAtPole+Y)}_changeGoldbergFaceColors(K){for(let l=0;l<K.length;l++){const Y=K[l][0],v=K[l][1],U=K[l][2];for(let K=Y;K<v+1;K++)this.goldbergData.faceColors[K]=U}const Y=[];for(let l=0;l<12;l++)for(let K=0;K<5;K++)Y.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);for(let l=12;l<this.goldbergData.faceColors.length;l++)for(let K=0;K<6;K++)Y.push(this.goldbergData.faceColors[l].r,this.goldbergData.faceColors[l].g,this.goldbergData.faceColors[l].b,this.goldbergData.faceColors[l].a);return Y}setGoldbergFaceColors(K){const Y=this._changeGoldbergFaceColors(K);this.Ga(d.e.ColorKind,Y)}updateGoldbergFaceColors(K){const Y=this._changeGoldbergFaceColors(K);this.updateVerticesData(d.e.ColorKind,Y)}_changeGoldbergFaceUVs(K){const Y=this.getVerticesData(d.e.UVKind);for(let l=0;l<K.length;l++){const v=K[l][0],U=K[l][1],d=K[l][2],A=K[l][3],c=K[l][4],t=[],Z=[];let m,V;for(let K=0;K<5;K++)m=d.x+A*Math.cos(c+K*Math.PI/2.5),V=d.y+A*Math.sin(c+K*Math.PI/2.5),m<0&&(m=0),m>1&&(m=1),t.push(m,V);for(let K=0;K<6;K++)m=d.x+A*Math.cos(c+K*Math.PI/3),V=d.y+A*Math.sin(c+K*Math.PI/3),m<0&&(m=0),m>1&&(m=1),Z.push(m,V);for(let K=v;K<Math.min(12,U+1);K++)for(let l=0;l<5;l++)Y[10*K+2*l]=t[2*l],Y[10*K+2*l+1]=t[2*l+1];for(let K=Math.max(12,v);K<U+1;K++)for(let l=0;l<6;l++)Y[12*K-24+2*l]=Z[2*l],Y[12*K-23+2*l]=Z[2*l+1]}return Y}setGoldbergFaceUVs(K){const Y=this._changeGoldbergFaceUVs(K);this.Ga(d.e.UVKind,Y)}updateGoldbergFaceUVs(K){const Y=this._changeGoldbergFaceUVs(K);this.updateVerticesData(d.e.UVKind,Y)}placeOnGoldbergFaceAt(K,Y,l){const U=v.o.RotationFromAxis(this.goldbergData.faceXaxis[Y],this.goldbergData.faceYaxis[Y],this.goldbergData.faceZaxis[Y]);K.rotation=U,K.position=this.goldbergData.faceCenters[Y].add(this.goldbergData.faceXaxis[Y].scale(l.x)).add(this.goldbergData.faceYaxis[Y].scale(l.y)).add(this.goldbergData.faceZaxis[Y].scale(l.z))}serialize(K){super.serialize(K),K.type="GoldbergMesh";const Y={};if(Y.adjacentFaces=this.goldbergData.adjacentFaces,Y.nbSharedFaces=this.goldbergData.nbSharedFaces,Y.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Y.nbFaces=this.goldbergData.nbFaces,Y.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Y.faceColors=[];for(const K of this.goldbergData.faceColors)Y.faceColors.push(K.zi())}if(this.goldbergData.faceCenters){Y.faceCenters=[];for(const K of this.goldbergData.faceCenters)Y.faceCenters.push(K.zi())}if(this.goldbergData.faceZaxis){Y.faceZaxis=[];for(const K of this.goldbergData.faceZaxis)Y.faceZaxis.push(K.zi())}if(this.goldbergData.faceYaxis){Y.faceYaxis=[];for(const K of this.goldbergData.faceYaxis)Y.faceYaxis.push(K.zi())}if(this.goldbergData.faceXaxis){Y.faceXaxis=[];for(const K of this.goldbergData.faceXaxis)Y.faceXaxis.push(K.zi())}K.goldbergData=Y}static Parse(K,Y){const l=K.goldbergData;l.faceColors=l.faceColors.map((K=>M.g.yi(K))),l.faceCenters=l.faceCenters.map((K=>v.o.yi(K))),l.faceZaxis=l.faceZaxis.map((K=>v.o.yi(K))),l.faceXaxis=l.faceXaxis.map((K=>v.o.yi(K))),l.faceYaxis=l.faceYaxis.map((K=>v.o.yi(K)));const U=new VK(K.name,Y);return U.goldbergData=l,U}}var MK=l(814);class uK{constructor(K){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=K}moveTo(K,Y){this._currentPath=new D.g(K,Y),this._tempPaths.push(this._currentPath)}lineTo(K,Y){this._currentPath.addLineTo(K,Y)}quadraticCurveTo(K,Y,l,v){this._currentPath.addQuadraticCurveTo(K,Y,l,v,this._resolution)}bezierCurveTo(K,Y,l,v,U,d){this._currentPath.addBezierCurveTo(K,Y,l,v,U,d,this._resolution)}extractHoles(){for(const K of this._tempPaths)K.area()>0?this._holes.push(K):this._paths.push(K);if(!this._paths.length&&this._holes.length){const K=this._holes;this._holes=this._paths,this._paths=K}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function oK(K,Y,l,v,U,d){const A=d.glyphs[K]||d.glyphs["?"];if(!A)return null;const c=new uK(U);if(A.o){const K=A.o.split(" ");for(let U=0,d=K.length;U<d;){switch(K[U++]){case"m":{const d=parseInt(K[U++])*Y+l,A=parseInt(K[U++])*Y+v;c.moveTo(d,A);break}case"l":{const d=parseInt(K[U++])*Y+l,A=parseInt(K[U++])*Y+v;c.lineTo(d,A);break}case"q":{const d=parseInt(K[U++])*Y+l,A=parseInt(K[U++])*Y+v,t=parseInt(K[U++])*Y+l,Z=parseInt(K[U++])*Y+v;c.quadraticCurveTo(t,Z,d,A);break}case"b":{const d=parseInt(K[U++])*Y+l,A=parseInt(K[U++])*Y+v,t=parseInt(K[U++])*Y+l,Z=parseInt(K[U++])*Y+v,m=parseInt(K[U++])*Y+l,V=parseInt(K[U++])*Y+v;c.bezierCurveTo(t,Z,m,V,d,A);break}}}}return c.extractHoles(),{offsetX:A.ha*Y,shapePath:c}}const WK={CreateBox:V.c,CreateTiledBox:g,CreateSphere:J.d,CreateDisc:m.e,CreateIcoSphere:p,CreateRibbon:Z,CreateCylinder:z,CreateTorus:E,CreateTorusKnot:T,CreateLineSystem:e.f,Di:e.g,CreateDashedLines:e.e,ExtrudeShape:I,ExtrudeShapeCustom:L,CreateLathe:F,CreateTiledPlane:o,Ei:s.b,CreateGround:b.e,CreateTiledGround:b.i,CreateGroundFromHeightMap:b.c,CreatePolygon:w,ExtrudePolygon:k,CreateTube:x,CreatePolyhedron:N,CreateGeodesic:function(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=Y.m||1;v!==Math.floor(v)&&(v=Math.floor(v),i.e.Warn("m not an integer only floor(m) used"));let U=Y.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),i.e.Warn("n not an integer only floor(n) used")),U>v){const K=U;U=v,v=K,i.e.Warn("n > m therefore m and n swapped")}const d=new tK;return d.build(v,U),N(K,{custom:mK.BuildGeodesicData(d),size:Y.size,sizeX:Y.sizeX,sizeY:Y.sizeY,sizeZ:Y.sizeZ,faceUV:Y.faceUV,faceColors:Y.faceColors,flat:Y.flat,updatable:Y.updatable,sideOrientation:Y.sideOrientation,frontUVs:Y.frontUVs,backUVs:Y.backUVs},l)},CreateGoldberg:function(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=Y.size,t=Y.sizeX||d||1,Z=Y.sizeY||d||1,m=Y.sizeZ||d||1;let V=Y.m||1;V!==Math.floor(V)&&(V=Math.floor(V),i.e.Warn("m not an integer only floor(m) used"));let u=Y.n||0;if(u!==Math.floor(u)&&(u=Math.floor(u),i.e.Warn("n not an integer only floor(n) used")),u>V){const K=u;u=V,V=K,i.e.Warn("n > m therefore m and n swapped")}const o=new tK;o.build(V,u);const W=mK.BuildGeodesicData(o),g=W.toGoldbergPolyhedronData(),J=new VK(K,l);Y.sideOrientation=U.e._GetDefaultSideOrientation(Y.sideOrientation),J._originalBuilderSideOrientation=Y.sideOrientation;(function(K,Y){const l=K.size,U=K.sizeX||l||1,d=K.sizeY||l||1,t=K.sizeZ||l||1,Z=0===K.sideOrientation?0:K.sideOrientation||A.c.DEFAULTSIDE,m=[],V=[],M=[],u=[];let o=1/0,W=-1/0,g=1/0,J=-1/0;for(let v=0;v<Y.vertex.length;v++)o=Math.min(o,Y.vertex[v][0]*U),W=Math.max(W,Y.vertex[v][0]*U),g=Math.min(g,Y.vertex[v][1]*d),J=Math.max(J,Y.vertex[v][1]*d);let n=0;for(let A=0;A<Y.face.length;A++){const K=Y.face[A],l=v.o.yi(Y.vertex[K[0]]),Z=v.o.yi(Y.vertex[K[2]]),R=v.o.yi(Y.vertex[K[1]]),H=Z.Lg(l),z=R.Lg(l),r=v.o.Cross(z,H).normalize();for(let v=0;v<K.length;v++){M.push(r.x,r.y,r.z);const l=Y.vertex[K[v]];m.push(l[0]*U,l[1]*d,l[2]*t);const A=(l[1]*d-g)/(J-g);u.push((l[0]*U-o)/(W-o),c.d?1-A:A)}for(let Y=0;Y<K.length-2;Y++)V.push(n,n+Y+2,n+Y+1);n+=K.length}A.c._ComputeSides(Z,m,V,M,u);const R=new A.c;return R.xa=m,R.indices=V,R.ya=M,R.Aa=u,R})(Y,g).Ca(J,Y.updatable),J.goldbergData.nbSharedFaces=W.sharedNodes,J.goldbergData.nbUnsharedFaces=W.poleNodes,J.goldbergData.adjacentFaces=W.adjacentFaces,J.goldbergData.nbFaces=J.goldbergData.nbSharedFaces+J.goldbergData.nbUnsharedFaces,J.goldbergData.nbFacesAtPole=(J.goldbergData.nbUnsharedFaces-12)/12;for(let U=0;U<W.vertex.length;U++)J.goldbergData.faceCenters.push(v.o.yi(W.vertex[U])),J.goldbergData.faceCenters[U].x*=t,J.goldbergData.faceCenters[U].y*=Z,J.goldbergData.faceCenters[U].z*=m,J.goldbergData.faceColors.push(new M.g(1,1,1,1));for(let U=0;U<g.face.length;U++){const K=g.face[U],Y=v.o.yi(g.vertex[K[0]]),l=v.o.yi(g.vertex[K[2]]),d=v.o.yi(g.vertex[K[1]]),A=l.Lg(Y),c=d.Lg(Y),t=v.o.Cross(c,A).normalize(),Z=v.o.Cross(c,t).normalize();J.goldbergData.faceXaxis.push(c.normalize()),J.goldbergData.faceYaxis.push(t),J.goldbergData.faceZaxis.push(Z)}return J},CreateDecal:UK,CreateCapsule:AK,CreateText:function(K,Y,l){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const t=function(K,Y,l,v){const U=Array.from(K),d=Y/v.resolution,A=(v.boundingBox.yMax-v.boundingBox.yMin+v.underlineThickness)*d,c=[];let t=0,Z=0;for(let m=0;m<U.length;m++){const K=U[m];if("\n"===K)t=0,Z-=A;else{const Y=oK(K,d,t,Z,l,v);Y&&(t+=Y.offsetX,c.push(Y.shapePath))}}return c}(Y,d.size||50,d.resolution||8,l),Z=[];let m=0;for(const o of t){if(!o.paths.length)continue;const Y=o.holes.slice();for(const l of o.paths){var V,M;const t=[],u=[],o=l.getPoints();for(const K of o)u.push(new v.o(K.x,0,K.y));const W=Y.slice();for(const K of W){const U=K.getPoints();let d=!1;for(const K of U)if(l.isPointInside(K)){d=!0;break}if(!d)continue;const A=[];for(const K of U)A.push(new v.o(K.x,0,K.y));t.push(A),Y.splice(Y.indexOf(K),1)}if(!t.length&&Y.length)for(const K of Y){const Y=K.getPoints(),l=[];for(const K of Y)l.push(new v.o(K.x,0,K.y));t.push(l)}const g=k(K,{shape:u,holes:t.length?t:void 0,depth:d.depth||1,faceUV:d.faceUV||(null===(V=d.perLetterFaceUV)||void 0===V?void 0:V.call(d,m)),faceColors:d.faceColors||(null===(M=d.perLetterFaceColors)||void 0===M?void 0:M.call(d,m)),sideOrientation:U.e._GetDefaultSideOrientation(d.sideOrientation||U.e.DOUBLESIDE)},A,c);Z.push(g),m++}}const u=U.e.MergeMeshes(Z,!0,!0);if(u){const Y=u.getBoundingInfo().boundingBox;u.position.x+=-(Y.minimumWorld.x+Y.maximumWorld.x)/2,u.position.y+=-(Y.minimumWorld.y+Y.maximumWorld.y)/2,u.position.z+=-(Y.minimumWorld.z+Y.maximumWorld.z)/2+Y.extendSize.z,u.name=K;const l=new MK.b("pivot",A);l.rotation.x=-Math.PI/2,u.parent=l,u.bakeCurrentTransformIntoVertices(),u.parent=null,l.dispose()}return u}}},12469:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>A});var v=l(2299),U=l(2431);let d=0;const A=K=>{if(!K.environmentBRDFTexture){const Y=K.useDelayedTextureLoading;K.useDelayedTextureLoading=!1;const l=K._blockEntityCollection;K._blockEntityCollection=!1;const A=v.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+d++,K,!0,!1,v.c.BILINEAR_SAMPLINGMODE);K._blockEntityCollection=l;const c=K.getEngine().getLoadedTexturesCache(),t=c.indexOf(A.getInternalTexture());-1!==t&&c.splice(t,1),A.isRGBD=!0,A.wrapU=v.c.CLAMP_ADDRESSMODE,A.wrapV=v.c.CLAMP_ADDRESSMODE,K.environmentBRDFTexture=A,K.useDelayedTextureLoading=Y,U.d.ExpandRGBDTexture(A);const Z=K.getEngine().onContextRestoredObservable.add((()=>{A.isRGBD=!0;const Y=K.onBeforeRenderObservable.add((()=>{A.isReady()&&(K.onBeforeRenderObservable.remove(Y),U.d.ExpandRGBDTexture(A))}))}));K.Hi.add((()=>{K.getEngine().onContextRestoredObservable.remove(Z)}))}return K.environmentBRDFTexture}},2457:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>U});class v{constructor(K){this._pendingActions=new Array,this._workerInfos=K.map((K=>({workerPromise:Promise.resolve(K),idle:!0})))}dispose(){for(const K of this._workerInfos)K.workerPromise.then((K=>{K.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(K){this._executeOnIdleWorker(K)||this._pendingActions.push(K)}_executeOnIdleWorker(K){for(const Y of this._workerInfos)if(Y.idle)return this._execute(Y,K),!0;return!1}_execute(K,Y){K.idle=!1,K.workerPromise.then((l=>{Y(l,(()=>{const Y=this._pendingActions.shift();Y?this._execute(K,Y):K.idle=!0}))}))}}class U extends v{constructor(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.DefaultOptions;super([]),this._maxWorkers=K,this._createWorkerAsync=Y,this._options=l}push(K){if(!this._executeOnIdleWorker(K))if(this._workerInfos.length<this._maxWorkers){const Y={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(Y),this._execute(Y,K)}else this._pendingActions.push(K)}_execute(K,Y){K.timeoutId&&(clearTimeout(K.timeoutId),delete K.timeoutId),super._execute(K,((l,v)=>{Y(l,(()=>{v(),K.idle&&(K.timeoutId=setTimeout((()=>{K.workerPromise.then((K=>{K.terminate()}));const Y=this._workerInfos.indexOf(K);-1!==Y&&this._workerInfos.splice(Y,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}U.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11986:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>JK});var v=l(675),U=l(11872);class d extends U.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var A=l(706),c=(l(11993),l(619));class t{get noiseTexture(){return this._noiseTexture}set noiseTexture(K){this._noiseTexture!==K&&(this._noiseTexture=K,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(K){this._isAnimationSheetEnabled!=K&&(this._isAnimationSheetEnabled=K,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){this._useLogarithmicDepth=K&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:v.o.Zero()}set direction1(K){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=K)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:v.o.Zero()}set direction2(K){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=K)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:v.o.Zero()}set minEmitBox(K){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=K)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:v.o.Zero()}set maxEmitBox(K){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=K)}get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(K){this._isBillboardBased!==K&&(this._isBillboardBased=K,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K)}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(!K&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=K)}_reset(){}_removeGradientAndTexture(K,Y,l){if(!Y)return this;let v=0;for(const U of Y){if(U.gradient===K){Y.splice(v,1);break}v++}return l&&l.dispose(),this}constructor(K){this.animations=[],this.renderingGroupId=0,this.j=v.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new v.o(10,10,10),this.onAnimationEnd=null,this.blendMode=t.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new v.m(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ng=new v.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=v.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new A.g(1,1,1,1),this.color2=new A.g(1,1,1,1),this.colorDead=new A.g(0,0,0,1),this.textureMask=new A.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new d,this.id=K,this.name=K}createPointEmitter(K,Y){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new v.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new v.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new v.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(K,Y,l,v){throw new Error("Method not implemented.")}}t.BLENDMODE_ONEONE=0,t.BLENDMODE_STANDARD=1,t.BLENDMODE_ADD=2,t.BLENDMODE_MULTIPLY=3,t.BLENDMODE_MULTIPLYADD=4,(0,c.f)("BABYLON.BaseParticleSystem",t);var Z=l(695),m=l(500);class V{constructor(){this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0),this.minEmitBox=new v.o(-.5,-.5,-.5),this.maxEmitBox=new v.o(.5,.5,.5)}startDirectionFunction(K,Y,l,U){const d=(0,Z.r)(this.direction1.x,this.direction2.x),A=(0,Z.r)(this.direction1.y,this.direction2.y),c=(0,Z.r)(this.direction1.z,this.direction2.z);if(U)return Y.x=d,Y.y=A,void(Y.z=c);v.o.TransformNormalFromFloatsToRef(d,A,c,K,Y)}startPositionFunction(K,Y,l,U){const d=(0,Z.r)(this.minEmitBox.x,this.maxEmitBox.x),A=(0,Z.r)(this.minEmitBox.y,this.maxEmitBox.y),c=(0,Z.r)(this.minEmitBox.z,this.maxEmitBox.z);if(U)return Y.x=d,Y.y=A,void(Y.z=c);v.o.TransformCoordinatesFromFloatsToRef(d,A,c,K,Y)}clone(){const K=new V;return m.e.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2),K.setVector3("minEmitBox",this.minEmitBox),K.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3),K.addUniform("minEmitBox",3),K.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.zi(),K.direction2=this.direction2.zi(),K.minEmitBox=this.minEmitBox.zi(),K.maxEmitBox=this.maxEmitBox.zi(),K}parse(K){v.o.FromArrayToRef(K.direction1,0,this.direction1),v.o.FromArrayToRef(K.direction2,0,this.direction2),v.o.FromArrayToRef(K.minEmitBox,0,this.minEmitBox),v.o.FromArrayToRef(K.maxEmitBox,0,this.maxEmitBox)}}class M{get radius(){return this._radius}set radius(K){this._radius=K,this._buildHeight()}get angle(){return this._angle}set angle(K){this._angle=K,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=l,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Y,this.radius=K}startDirectionFunction(K,Y,l,U){U?v.j.Qi[0].p(l.Hg).normalize():l.position.subtractToRef(K.getTranslation(),v.j.Qi[0]).normalize();const d=(0,Z.r)(0,this.directionRandomizer),A=(0,Z.r)(0,this.directionRandomizer),c=(0,Z.r)(0,this.directionRandomizer);Y.x=v.j.Qi[0].x+d,Y.y=v.j.Qi[0].y+A,Y.z=v.j.Qi[0].z+c,Y.normalize()}startPositionFunction(K,Y,l,U){const d=(0,Z.r)(0,2*Math.PI);let A;this.emitFromSpawnPointOnly?A=1e-4:(A=(0,Z.r)(0,this.heightRange),A=1-A*A);let c=this._radius-(0,Z.r)(0,this._radius*this.radiusRange);c*=A;const t=c*Math.sin(d),m=c*Math.cos(d),V=A*this._height;if(U)return Y.x=t,Y.y=V,void(Y.z=m);v.o.TransformCoordinatesFromFloatsToRef(t,V,m,K,Y)}clone(){const K=new M(this._radius,this._angle,this.directionRandomizer);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat2("radius",this._radius,this.radiusRange),K.setFloat("coneAngle",this._angle),K.setFloat2("height",this._height,this.heightRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",2),K.addUniform("coneAngle",1),K.addUniform("height",2),K.addUniform("directionRandomizer",1)}getEffectDefines(){let K="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(K+="\n#define CONEEMITTERSPAWNPOINT"),K}getClassName(){return"ConeParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this._radius,K.angle=this._angle,K.directionRandomizer=this.directionRandomizer,K.radiusRange=this.radiusRange,K.heightRange=this.heightRange,K.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,K}parse(K){this.radius=K.radius,this.angle=K.angle,this.directionRandomizer=K.directionRandomizer,this.radiusRange=void 0!==K.radiusRange?K.radiusRange:1,this.heightRange=void 0!==K.radiusRange?K.heightRange:1,this.emitFromSpawnPointOnly=void 0!==K.emitFromSpawnPointOnly&&K.emitFromSpawnPointOnly}}class u extends M{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0);super(K,Y),this.direction1=l,this.direction2=U}startDirectionFunction(K,Y){const l=(0,Z.r)(this.direction1.x,this.direction2.x),U=(0,Z.r)(this.direction1.y,this.direction2.y),d=(0,Z.r)(this.direction1.z,this.direction2.z);v.o.TransformNormalFromFloatsToRef(l,U,d,K,Y)}clone(){const K=new u(this.radius,this.angle,this.direction1,this.direction2);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.zi(),K.direction2=this.direction2.zi(),K}parse(K){super.parse(K),this.direction1.p(K.direction1),this.direction2.p(K.direction2)}}class o{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=K,this.height=Y,this.radiusRange=l,this.directionRandomizer=U,this._tempVector=v.o.Zero()}startDirectionFunction(K,Y,l,U,d){l.position.subtractToRef(K.getTranslation(),this._tempVector),this._tempVector.normalize(),v.o.TransformNormalToRef(this._tempVector,d,this._tempVector);const A=(0,Z.r)(-this.directionRandomizer/2,this.directionRandomizer/2);let c=Math.atan2(this._tempVector.x,this._tempVector.z);c+=(0,Z.r)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=A,this._tempVector.x=Math.sin(c),this._tempVector.z=Math.cos(c),this._tempVector.normalize(),U?Y.p(this._tempVector):v.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K,Y)}startPositionFunction(K,Y,l,U){const d=(0,Z.r)(-this.height/2,this.height/2),A=(0,Z.r)(0,2*Math.PI),c=(0,Z.r)((1-this.radiusRange)*(1-this.radiusRange),1),t=Math.sqrt(c)*this.radius,m=t*Math.cos(A),V=t*Math.sin(A);U?Y.mi(m,d,V):v.o.TransformCoordinatesFromFloatsToRef(m,d,V,K,Y)}clone(){const K=new o(this.radius,this.directionRandomizer);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.height=this.height,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.height=K.height,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class W extends o{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0);super(K,Y,l),this.direction1=U,this.direction2=d}startDirectionFunction(K,Y,l,U){const d=(0,Z.r)(this.direction1.x,this.direction2.x),A=(0,Z.r)(this.direction1.y,this.direction2.y),c=(0,Z.r)(this.direction1.z,this.direction2.z);U?Y.mi(d,A,c):v.o.TransformNormalFromFloatsToRef(d,A,c,K,Y)}clone(){const K=new W(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.zi(),K.direction2=this.direction2.zi(),K}parse(K){super.parse(K),v.o.FromArrayToRef(K.direction1,0,this.direction1),v.o.FromArrayToRef(K.direction2,0,this.direction2)}}class g{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=Y,this.directionRandomizer=l}startDirectionFunction(K,Y,l,U){const d=l.position.Lg(K.getTranslation()).normalize(),A=(0,Z.r)(0,this.directionRandomizer),c=(0,Z.r)(0,this.directionRandomizer),t=(0,Z.r)(0,this.directionRandomizer);d.x+=A,d.y+=c,d.z+=t,d.normalize(),U?Y.p(d):v.o.TransformNormalFromFloatsToRef(d.x,d.y,d.z,K,Y)}startPositionFunction(K,Y,l,U){const d=this.radius-(0,Z.r)(0,this.radius*this.radiusRange),A=(0,Z.r)(0,1),c=(0,Z.r)(0,2*Math.PI),t=Math.acos(2*A-1),m=d*Math.cos(c)*Math.sin(t),V=d*Math.cos(t),M=d*Math.sin(c)*Math.sin(t);U?Y.mi(m,Math.abs(V),M):v.o.TransformCoordinatesFromFloatsToRef(m,Math.abs(V),M,K,Y)}clone(){const K=new g(this.radius,this.directionRandomizer);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class J{constructor(){this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0)}startDirectionFunction(K,Y,l,U){const d=(0,Z.r)(this.direction1.x,this.direction2.x),A=(0,Z.r)(this.direction1.y,this.direction2.y),c=(0,Z.r)(this.direction1.z,this.direction2.z);U?Y.mi(d,A,c):v.o.TransformNormalFromFloatsToRef(d,A,c,K,Y)}startPositionFunction(K,Y,l,U){U?Y.mi(0,0,0):v.o.TransformCoordinatesFromFloatsToRef(0,0,0,K,Y)}clone(){const K=new J;return m.e.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.zi(),K.direction2=this.direction2.zi(),K}parse(K){v.o.FromArrayToRef(K.direction1,0,this.direction1),v.o.FromArrayToRef(K.direction2,0,this.direction2)}}class n{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=Y,this.directionRandomizer=l}startDirectionFunction(K,Y,l,U){const d=l.position.Lg(K.getTranslation()).normalize(),A=(0,Z.r)(0,this.directionRandomizer),c=(0,Z.r)(0,this.directionRandomizer),t=(0,Z.r)(0,this.directionRandomizer);d.x+=A,d.y+=c,d.z+=t,d.normalize(),U?Y.p(d):v.o.TransformNormalFromFloatsToRef(d.x,d.y,d.z,K,Y)}startPositionFunction(K,Y,l,U){const d=this.radius-(0,Z.r)(0,this.radius*this.radiusRange),A=(0,Z.r)(0,1),c=(0,Z.r)(0,2*Math.PI),t=Math.acos(2*A-1),m=d*Math.cos(c)*Math.sin(t),V=d*Math.cos(t),M=d*Math.sin(c)*Math.sin(t);U?Y.mi(m,V,M):v.o.TransformCoordinatesFromFloatsToRef(m,V,M,K,Y)}clone(){const K=new n(this.radius,this.directionRandomizer);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class R extends n{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0);super(K),this.direction1=Y,this.direction2=l}startDirectionFunction(K,Y){const l=(0,Z.r)(this.direction1.x,this.direction2.x),U=(0,Z.r)(this.direction1.y,this.direction2.y),d=(0,Z.r)(this.direction1.z,this.direction2.z);v.o.TransformNormalFromFloatsToRef(l,U,d,K,Y)}clone(){const K=new R(this.radius,this.direction1,this.direction2);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.zi(),K.direction2=this.direction2.zi(),K}parse(K){super.parse(K),this.direction1.p(K.direction1),this.direction2.p(K.direction2)}}class H{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(K,Y,l,U){const d=v.j.Qi[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,l,d);const K=v.j.Qi[1];d.subtractToRef(l.position,K),K.scaleToRef(1/l.lifeTime,d)}else d.set(0,0,0);U?Y.p(d):v.o.TransformNormalToRef(d,K,Y)}startPositionFunction(K,Y,l,U){const d=v.j.Qi[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,l,d):d.set(0,0,0),U?Y.p(d):v.o.TransformCoordinatesToRef(d,K,Y)}clone(){const K=new H;return m.e.DeepCopy(this,K),K}applyToShader(K){}buildUniformLayout(K){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.particlePositionGenerator=this.particlePositionGenerator,K.particleDestinationGenerator=this.particleDestinationGenerator,K}parse(K){K.particlePositionGenerator&&(this.particlePositionGenerator=K.particlePositionGenerator),K.particleDestinationGenerator&&(this.particleDestinationGenerator=K.particleDestinationGenerator)}}var z=l(730);class r{get mesh(){return this._mesh}set mesh(K){this._mesh!==K&&(this._mesh=K,K?(this._indices=K.si(),this._positions=K.getVerticesData(z.e.PositionKind),this._normals=K.getVerticesData(z.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=v.o.Zero(),this._mesh=null,this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=K}startDirectionFunction(K,Y,l,U){if(this.useMeshNormalsForDirection&&this._normals)return void v.o.TransformNormalToRef(this._storedNormal,K,Y);const d=(0,Z.r)(this.direction1.x,this.direction2.x),A=(0,Z.r)(this.direction1.y,this.direction2.y),c=(0,Z.r)(this.direction1.z,this.direction2.z);U?Y.mi(d,A,c):v.o.TransformNormalFromFloatsToRef(d,A,c,K,Y)}startPositionFunction(K,Y,l,U){if(!this._indices||!this._positions)return;const d=3*Math.random()*(this._indices.length/3)|0,A=Math.random(),c=Math.random()*(1-A),t=1-A-c,Z=this._indices[d],m=this._indices[d+1],V=this._indices[d+2],M=v.j.Qi[0],u=v.j.Qi[1],o=v.j.Qi[2],W=v.j.Qi[3];v.o.FromArrayToRef(this._positions,3*Z,M),v.o.FromArrayToRef(this._positions,3*m,u),v.o.FromArrayToRef(this._positions,3*V,o),W.x=A*M.x+c*u.x+t*o.x,W.y=A*M.y+c*u.y+t*o.y,W.z=A*M.z+c*u.z+t*o.z,U?Y.mi(W.x,W.y,W.z):v.o.TransformCoordinatesFromFloatsToRef(W.x,W.y,W.z,K,Y),this.useMeshNormalsForDirection&&this._normals&&(v.o.FromArrayToRef(this._normals,3*Z,M),v.o.FromArrayToRef(this._normals,3*m,u),v.o.FromArrayToRef(this._normals,3*V,o),this._storedNormal.x=A*M.x+c*u.x+t*o.x,this._storedNormal.y=A*M.y+c*u.y+t*o.y,this._storedNormal.z=A*M.z+c*u.z+t*o.z)}clone(){const K=new r(this.mesh);return m.e.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var K;const Y={};return Y.type=this.getClassName(),Y.direction1=this.direction1.zi(),Y.direction2=this.direction2.zi(),Y.meshId=null===(K=this.mesh)||void 0===K?void 0:K.id,Y.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Y}parse(K,Y){v.o.FromArrayToRef(K.direction1,0,this.direction1),v.o.FromArrayToRef(K.direction2,0,this.direction2),K.meshId&&Y&&(this.mesh=Y.getLastMeshById(K.meshId)),this.useMeshNormalsForDirection=K.useMeshNormalsForDirection}}var E=l(569);class y{_isUbo(K){return void 0!==K.addUniform}constructor(K){this._isUbo(K)?(this.setMatrix3x3=K.updateMatrix3x3.bind(K),this.setMatrix2x2=K.updateMatrix2x2.bind(K),this.setFloat=K.updateFloat.bind(K),this.setFloat2=K.updateFloat2.bind(K),this.setFloat3=K.updateFloat3.bind(K),this.setFloat4=K.updateFloat4.bind(K),this.setFloatArray=K.updateFloatArray.bind(K),this.setArray=K.updateArray.bind(K),this.setIntArray=K.updateIntArray.bind(K),this.setMatrix=K.Xi.bind(K),this.setMatrices=K.updateMatrices.bind(K),this.setVector3=K.updateVector3.bind(K),this.setVector4=K.updateVector4.bind(K),this.setColor3=K.updateColor3.bind(K),this.setColor4=K.updateColor4.bind(K),this.setDirectColor4=K.updateDirectColor4.bind(K),this.setInt=K.updateInt.bind(K),this.setInt2=K.updateInt2.bind(K),this.setInt3=K.updateInt3.bind(K),this.setInt4=K.updateInt4.bind(K)):(this.setMatrix3x3=K.setMatrix3x3.bind(K),this.setMatrix2x2=K.setMatrix2x2.bind(K),this.setFloat=K.setFloat.bind(K),this.setFloat2=K.setFloat2.bind(K),this.setFloat3=K.setFloat3.bind(K),this.setFloat4=K.setFloat4.bind(K),this.setFloatArray=K.setFloatArray.bind(K),this.setArray=K.setArray.bind(K),this.setIntArray=K.setIntArray.bind(K),this.setMatrix=K.setMatrix.bind(K),this.setMatrices=K.setMatrices.bind(K),this.setVector3=K.setVector3.bind(K),this.setVector4=K.setVector4.bind(K),this.setColor3=K.setColor3.bind(K),this.setColor4=K.setColor4.bind(K),this.setDirectColor4=K.setDirectColor4.bind(K),this.setInt=K.setInt.bind(K),this.setInt2=K.setInt2.bind(K),this.setInt3=K.setInt3.bind(K),this.setInt4=K.setInt4.bind(K))}}var T=l(577);const e="gpuUpdateParticlesPixelShader",i="#version 300 es\nvoid main() {discard;}\n";T.e.ShadersStore[e]=i;const D="gpuUpdateParticlesVertexShader",B="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.e.ShadersStore[D]=B;(0,c.f)("BABYLON.WebGL2ParticleSystem",class{constructor(K,Y){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=K,this._engine=Y,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var K;return(null===(K=this._updateEffect)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof H&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=K,this._updateEffect=new E.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new y(this._updateEffect)}createVertexBuffers(K,Y){this._updateVAO.push(this._createUpdateVAO(K)),this._renderVAO.push(this._engine.recordVertexArrayObject(Y,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Y}createParticleBuffer(K){return K}bindDrawBuffers(K,Y,l){l?this._engine.bindBuffers(this._renderVertexBuffers,l,Y):this._engine.bindVertexArrayObject(this._renderVAO[K],null)}preUpdateParticleBuffer(){const K=this._engine;if(this._engine.enableEffect(this._updateEffect),!K.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(K,Y,l){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[K],null);const v=this._engine;v.bindTransformFeedbackBuffer(Y.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(3,0,l),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let K=0;K<this._updateVAO.length;K++)this._engine.releaseVertexArrayObject(this._updateVAO[K]);this._updateVAO.length=0;for(let K=0;K<this._renderVAO.length;K++)this._engine.releaseVertexArrayObject(this._renderVAO[K]);this._renderVAO.length=0}_createUpdateVAO(K){const Y={};Y.position=K.createVertexBuffer("position",0,3);let l=3;Y.age=K.createVertexBuffer("age",l,1),l+=1,Y.size=K.createVertexBuffer("size",l,3),l+=3,Y.life=K.createVertexBuffer("life",l,1),l+=1,Y.seed=K.createVertexBuffer("seed",l,4),l+=4,Y.direction=K.createVertexBuffer("direction",l,3),l+=3,this._parent.particleEmitterType instanceof H&&(Y.initialPosition=K.createVertexBuffer("initialPosition",l,3),l+=3),this._parent._colorGradientsTexture||(Y.color=K.createVertexBuffer("color",l,4),l+=4),this._parent._isBillboardBased||(Y.initialDirection=K.createVertexBuffer("initialDirection",l,3),l+=3),this._parent.noiseTexture&&(Y.noiseCoordinates1=K.createVertexBuffer("noiseCoordinates1",l,3),l+=3,Y.noiseCoordinates2=K.createVertexBuffer("noiseCoordinates2",l,3),l+=3),this._parent._angularSpeedGradientsTexture?(Y.angle=K.createVertexBuffer("angle",l,1),l+=1):(Y.angle=K.createVertexBuffer("angle",l,2),l+=2),this._parent._isAnimationSheetEnabled&&(Y.cellIndex=K.createVertexBuffer("cellIndex",l,1),l+=1,this._parent.spriteRandomStartCell&&(Y.cellStartOffset=K.createVertexBuffer("cellStartOffset",l,1),l+=1));const v=this._engine.recordVertexArrayObject(Y,null,this._updateEffect);return this._engine.bindArrayBuffer(null),v}});class P{constructor(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,v=arguments.length>3?arguments[3]:void 0;this._engine=K,this._label=v,this._engine._storageBuffers.push(this),this._create(Y,l)}_create(K,Y){this._bufferSize=K,this._creationFlags=Y,this._buffer=this._engine.createStorageBuffer(K,Y,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(K,Y,l){this._buffer&&this._engine.updateStorageBuffer(this._buffer,K,Y,l)}read(K,Y,l,v){return this._engine.readFromStorageBuffer(this._buffer,K,Y,l,v)}dispose(){const K=this._engine._storageBuffers,Y=K.indexOf(this);-1!==Y&&(K[Y]=K[K.length-1],K.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var G=l(646),Q=l(652),X=l(702),f=l(2299),w=l(2428),k=l(492),I=l(601),L=l(2419);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new L.b}_addDuration(K,Y){K<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==K?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Y,!1),this._gpuTimeInFrameId=K):this.counter.addCount(Y,!1))}}class F{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=K,this._engine=Y,this.uniqueId=w.c.UniqueId,Y.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?v.bindingsMapping?(this._context=Y.createComputeContext(),this._shaderPath=l,this._options={bindingsMapping:{},defines:[],...v}):k.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):k.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(K,Y){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this._bindings[K];this._bindings[K]={type:l?0:4,object:Y,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!v||v.object!==Y||v.type!==this._bindings[K].type)}setStorageTexture(K,Y){const l=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==Y),this._bindings[K]={type:1,object:Y,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setExternalTexture(K,Y){const l=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==Y),this._bindings[K]={type:6,object:Y,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setVideoTexture(K,Y){return!!Y.externalTexture&&(this.setExternalTexture(K,Y.externalTexture),!0)}setUniformBuffer(K,Y){const l=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==Y),this._bindings[K]={type:F._BufferIsDataBuffer(Y)?7:2,object:Y,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setStorageBuffer(K,Y){const l=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!l||l.object!==Y),this._bindings[K]={type:F._BufferIsDataBuffer(Y)?7:3,object:Y,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}setTextureSampler(K,Y){const l=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!l||!Y.compareSampler(l.object)),this._bindings[K]={type:5,object:Y,indexInGroupEntries:null===l||void 0===l?void 0:l.indexInGroupEntries}}isReady(){let K=this._effect;for(const U in this._bindings){const K=this._bindings[U],Y=K.type,l=K.object;switch(Y){case 0:case 4:case 1:if(!l.isReady())return!1;break;case 6:if(!l.isReady())return!1;break}}const Y=[],l=this._shaderPath;if(this._options.defines)for(let U=0;U<this._options.defines.length;U++)Y.push(this._options.defines[U]);const v=Y.join("\n");return this._cachedDefines!==v&&(this._cachedDefines=v,K=this._engine.createComputeEffect(l,{defines:v,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=K),!!K.isReady()}dispatch(K,Y,l){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,K,Y,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const l=F._BufferIsDataBuffer(K)?K:K.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,l,Y,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Y in this._bindings){const l=this._bindings[Y];if(!this._options.bindingsMapping[Y])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Y+"'");switch(l.type){case 0:{const v=this._samplers[Y],U=l.object;var K;if(!v||!U._texture||!v.compareSampler(U._texture))this._samplers[Y]=(new I.d).setParameters(U.wrapU,U.wrapV,U.wrapR,U.anisotropicFilteringLevel,U._texture.samplingMode,null===(K=U._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const K=l.object;K.getBuffer()!==l.buffer&&(l.buffer=K.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((U=>{const d=()=>{this.dispatch(K,Y,l)?U():setTimeout(d,v)};d()}))}serialize(){const K=X.c.Serialize(this);K.options=this._options,K.shaderPath=this._shaderPath,K.Vl={},K.textures={};for(const Y in this._bindings){const l=this._bindings[Y],v=l.object;switch(l.type){case 0:case 4:case 1:{const U=v.serialize();U&&(K.textures[Y]=U,K.Vl[Y]={type:l.type});break}}}return K}static Parse(K,Y,l){const v=X.c.Parse((()=>new F(K.name,Y.getEngine(),K.shaderPath,K.options)),K,Y,l);for(const U in K.textures){const d=K.Vl[U],A=f.c.Parse(K.textures[U],Y,l);0===d.type?v.setTexture(U,A):4===d.type?v.setTexture(U,A,!1):v.setStorageTexture(U,A)}return v}static _BufferIsDataBuffer(K){return void 0!==K.underlyingResource}}(0,G.d)([(0,Q.J)()],F.prototype,"name",void 0),(0,G.d)([(0,Q.J)()],F.prototype,"fastMode",void 0),(0,c.f)("BABYLON.ComputeShader",F);var s=l(831);const b="gpuUpdateParticlesComputeShader",x="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.e.ShadersStoreWGSL[b]=x;(0,c.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(K,Y){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=K,this._engine=Y}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var K;return(null===(K=this._updateComputeShader)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){var Y;const l={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(l.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(l.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(l.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(l.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(l.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(l.noiseTexture={group:1,binding:11}),this._updateComputeShader=new F("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:l,defines:K.split("\n")}),null===(Y=this._simParamsComputeShader)||void 0===Y||Y.dispose(),this._simParamsComputeShader=new s.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new y(this._simParamsComputeShader)}createVertexBuffers(K,Y){this._renderVertexBuffers.push(Y)}createParticleBuffer(K){const Y=new P(this._engine,4*K.length,11,"ComputeShaderParticleSystemBuffer");return Y.update(K),this._bufferComputeShader.push(Y),Y.getBuffer()}bindDrawBuffers(K,Y,l){this._engine.bindBuffers(this._renderVertexBuffers[K],l,Y)}preUpdateParticleBuffer(){}updateParticleBuffer(K,Y,l){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[K]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^K]),this._updateComputeShader.dispatch(Math.ceil(l/64))}releaseBuffers(){var K;for(let Y=0;Y<this._bufferComputeShader.length;++Y)this._bufferComputeShader[Y].dispose();this._bufferComputeShader.length=0,null===(K=this._simParamsComputeShader)||void 0===K||K.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class C{constructor(K,Y,l){this.gradient=K,this.color1=Y,this.color2=l}getColorToRef(K){this.color2?A.g.LerpToRef(this.color1,this.color2,Math.random(),K):K.p(this.color1)}}class N{constructor(K,Y){this.gradient=K,this.color=Y}}class j{constructor(K,Y,l){this.gradient=K,this.factor1=Y,this.factor2=l}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class p{static GetCurrentGradient(K,Y,l){if(Y[0].gradient>K)return void l(Y[0],Y[0],1);for(let U=0;U<Y.length-1;U++){const v=Y[U],d=Y[U+1];if(K>=v.gradient&&K<=d.gradient){return void l(v,d,(K-v.gradient)/(d.gradient-v.gradient))}}const v=Y.length-1;l(Y[v],Y[v],1)}}var S=l(469),q=l(12020),O=l(526);class h{constructor(K){this.particleSystem=K,this.position=v.o.Zero(),this.direction=v.o.Zero(),this.color=new A.g(0,0,0,0),this.colorStep=new A.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new v.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new A.g(0,0,0,0),this._currentColor2=new A.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=h._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let K=this.age,Y=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Y?(Y=1,K=this._randomCellOffset):K+=this._randomCellOffset);const l=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let v;v=this._initialSpriteCellLoop?(0,Z.d)(K*Y%this.lifeTime/this.lifeTime):(0,Z.d)(K*Y/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+v*l|0}_inheritParticleInfoToSubEmitter(K){if(K.particleSystem.j.position){const Y=K.particleSystem.j;if(Y.position.p(this.position),K.inheritDirection){const K=v.j.Qi[0];this.direction.normalizeToRef(K),Y.setDirection(K,0,Math.PI/2)}}else{K.particleSystem.j.p(this.position)}this.direction.scaleToRef(K.inheritedVelocityAmount/2,v.j.Qi[0]),K.particleSystem._inheritedVelocityOffset.p(v.j.Qi[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((K=>{this._inheritParticleInfoToSubEmitter(K)}))}_reset(){this.age=0,this.id=h._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(K){K.position.p(this.position),this._initialDirection?K._initialDirection?K._initialDirection.p(this._initialDirection):K._initialDirection=this._initialDirection.clone():K._initialDirection=null,K.direction.p(this.direction),this.Hg&&(K.Hg?K.Hg.p(this.Hg):K.Hg=this.Hg.clone()),K.color.p(this.color),K.colorStep.p(this.colorStep),K.lifeTime=this.lifeTime,K.age=this.age,K._randomCellOffset=this._randomCellOffset,K.size=this.size,K.scale.p(this.scale),K.angle=this.angle,K.angularSpeed=this.angularSpeed,K.particleSystem=this.particleSystem,K.cellIndex=this.cellIndex,K.id=this.id,K._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(K._currentColorGradient=this._currentColorGradient,K._currentColor1.p(this._currentColor1),K._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(K._currentSizeGradient=this._currentSizeGradient,K._currentSize1=this._currentSize1,K._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(K._currentAngularSpeedGradient=this._currentAngularSpeedGradient,K._currentAngularSpeed1=this._currentAngularSpeed1,K._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(K._currentVelocityGradient=this._currentVelocityGradient,K._currentVelocity1=this._currentVelocity1,K._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(K._currentLimitVelocityGradient=this._currentLimitVelocityGradient,K._currentLimitVelocity1=this._currentLimitVelocity1,K._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(K._currentDragGradient=this._currentDragGradient,K._currentDrag1=this._currentDrag1,K._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(K._initialStartSpriteCellID=this._initialStartSpriteCellID,K._initialEndSpriteCellID=this._initialEndSpriteCellID,K._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(K.remapData&&this.remapData?K.remapData.p(this.remapData):K.remapData=new v.p(0,0,0,0)),this._randomNoiseCoordinates1&&(K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),K._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(K._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),K._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}h._Count=0;var KK=l(791),YK=(l(12027),l(853)),lK=l(837),vK=l(2387);class UK extends t{set onDispose(K){this._onDisposeObserver&&this.Hi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Hi.add(K)}get useRampGradients(){return this._useRampGradients}set useRampGradients(K){this._useRampGradients!==K&&(this._useRampGradients=K,this._resetEffect())}get particles(){return this.Ql}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Ql.length}getClassName(){return"cj"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var K;let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[Y])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Y]=new KK.b(this._engine),this._customWrappers[Y].effect=K,this._customWrappers[Y].drawContext&&(this._customWrappers[Y].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(K),this._emitterInverseWorldMatrix=v.d.Identity(),this._inheritedVelocityOffset=new v.o,this.Hi=new S.b,this.onStoppedObservable=new S.b,this.Ql=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new A.g(0,0,0,0),this._colorDiff=new A.g(0,0,0,0),this._scaledDirection=v.o.Zero(),this._scaledGravity=v.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=K=>{},this.recycleParticle=K=>{const Y=this.Ql.pop();Y!==K&&Y.copyTo(K),this._stockParticles.push(Y)},this._createParticle=()=>{let K;return 0!==this._stockParticles.length?(K=this._stockParticles.pop(),K._reset()):K=new h(this),this._prepareParticle(K),K},this._shadersLoaded=!1,this._capacity=Y,this._epsilon=c,this._isAnimationSheetEnabled=d,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=v.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||O.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qi.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new V;let t=null;this.updateFunction=K=>{let Y=null;var l;this.noiseTexture&&(Y=this.noiseTexture.getSize(),null===(l=this.noiseTexture.getContent())||void 0===l||l.then((K=>{t=K})));const U=K===this.Ql;for(let d=0;d<K.length;d++){const l=K[d];let c=this._scaledUpdateSpeed;const m=l.age;if(l.age+=c,l.age>l.lifeTime){const K=l.age-m;c=(l.lifeTime-m)*c/K,l.age=l.lifeTime}const V=l.age/l.lifeTime;this._colorGradients&&this._colorGradients.length>0?p.GetCurrentGradient(V,this._colorGradients,((K,Y,v)=>{K!==l._currentColorGradient&&(l._currentColor1.p(l._currentColor2),Y.getColorToRef(l._currentColor2),l._currentColorGradient=K),A.g.LerpToRef(l._currentColor1,l._currentColor2,v,l.color)})):(l.colorStep.scaleToRef(c,this._scaledColorStep),l.color.addInPlace(this._scaledColorStep),l.color.a<0&&(l.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&p.GetCurrentGradient(V,this._angularSpeedGradients,((K,Y,v)=>{K!==l._currentAngularSpeedGradient&&(l._currentAngularSpeed1=l._currentAngularSpeed2,l._currentAngularSpeed2=Y.getFactor(),l._currentAngularSpeedGradient=K),l.angularSpeed=(0,Z.p)(l._currentAngularSpeed1,l._currentAngularSpeed2,v)})),l.angle+=l.angularSpeed*c;let M=c;if(this._velocityGradients&&this._velocityGradients.length>0&&p.GetCurrentGradient(V,this._velocityGradients,((K,Y,v)=>{K!==l._currentVelocityGradient&&(l._currentVelocity1=l._currentVelocity2,l._currentVelocity2=Y.getFactor(),l._currentVelocityGradient=K),M*=(0,Z.p)(l._currentVelocity1,l._currentVelocity2,v)})),l.direction.scaleToRef(M,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&p.GetCurrentGradient(V,this._limitVelocityGradients,((K,Y,v)=>{K!==l._currentLimitVelocityGradient&&(l._currentLimitVelocity1=l._currentLimitVelocity2,l._currentLimitVelocity2=Y.getFactor(),l._currentLimitVelocityGradient=K);const U=(0,Z.p)(l._currentLimitVelocity1,l._currentLimitVelocity2,v);l.direction.length()>U&&l.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&p.GetCurrentGradient(V,this._dragGradients,((K,Y,v)=>{K!==l._currentDragGradient&&(l._currentDrag1=l._currentDrag2,l._currentDrag2=Y.getFactor(),l._currentDragGradient=K);const U=(0,Z.p)(l._currentDrag1,l._currentDrag2,v);this._scaledDirection.scaleInPlace(1-U)})),this.isLocal&&l.Hg?(l.Hg.addInPlace(this._scaledDirection),v.o.TransformCoordinatesToRef(l.Hg,this._emitterWorldMatrix,l.position)):l.position.addInPlace(this._scaledDirection),t&&Y&&l._randomNoiseCoordinates1){const K=this._fetchR(l._randomNoiseCoordinates1.x,l._randomNoiseCoordinates1.y,Y.width,Y.height,t),U=this._fetchR(l._randomNoiseCoordinates1.z,l._randomNoiseCoordinates2.x,Y.width,Y.height,t),d=this._fetchR(l._randomNoiseCoordinates2.y,l._randomNoiseCoordinates2.z,Y.width,Y.height,t),A=v.j.Qi[0],Z=v.j.Qi[1];A.mi((2*K-1)*this.noiseStrength.x,(2*U-1)*this.noiseStrength.y,(2*d-1)*this.noiseStrength.z),A.scaleToRef(c,Z),l.direction.addInPlace(Z)}this.gravity.scaleToRef(c,this._scaledGravity),l.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&p.GetCurrentGradient(V,this._sizeGradients,((K,Y,v)=>{K!==l._currentSizeGradient&&(l._currentSize1=l._currentSize2,l._currentSize2=Y.getFactor(),l._currentSizeGradient=K),l.size=(0,Z.p)(l._currentSize1,l._currentSize2,v)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&p.GetCurrentGradient(V,this._colorRemapGradients,((K,Y,v)=>{const U=(0,Z.p)(K.factor1,Y.factor1,v),d=(0,Z.p)(K.factor2,Y.factor2,v);l.remapData.x=U,l.remapData.y=d-U})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&p.GetCurrentGradient(V,this._alphaRemapGradients,((K,Y,v)=>{const U=(0,Z.p)(K.factor1,Y.factor1,v),d=(0,Z.p)(K.factor2,Y.factor2,v);l.remapData.z=U,l.remapData.w=d-U}))),this._isAnimationSheetEnabled&&l.updateCellIndex(),l._inheritParticleInfoToSubEmitters(),l.age>=l.lifeTime&&(this._emitFromParticle(l),l._attachedSubEmitters&&(l._attachedSubEmitters.forEach((K=>{K.particleSystem.disposeOnStop=!0,K.particleSystem.stop()})),l._attachedSubEmitters=null),this.recycleParticle(l),U&&d--)}}}serialize(K){throw new Error("Method not implemented.")}clone(K,Y){throw new Error("Method not implemented.")}_addFactorGradient(K,Y,l,v){const U=new j(Y,l,v);K.push(U),K.sort(((K,Y)=>K.gradient<Y.gradient?-1:K.gradient>Y.gradient?1:0))}_removeFactorGradient(K,Y){if(!K)return;let l=0;for(const v of K){if(v.gradient===Y){K.splice(l,1);break}l++}}addLifeTimeGradient(K,Y,l){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,K,Y,l),this}removeLifeTimeGradient(K){return this._removeFactorGradient(this._lifeTimeGradients,K),this}addSizeGradient(K,Y,l){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,Y,l),this}removeSizeGradient(K){return this._removeFactorGradient(this._sizeGradients,K),this}addColorRemapGradient(K,Y,l){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,K,Y,l),this}removeColorRemapGradient(K){return this._removeFactorGradient(this._colorRemapGradients,K),this}addAlphaRemapGradient(K,Y,l){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,K,Y,l),this}removeAlphaRemapGradient(K){return this._removeFactorGradient(this._alphaRemapGradients,K),this}addAngularSpeedGradient(K,Y,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,Y,l),this}removeAngularSpeedGradient(K){return this._removeFactorGradient(this._angularSpeedGradients,K),this}addVelocityGradient(K,Y,l){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,Y,l),this}removeVelocityGradient(K){return this._removeFactorGradient(this._velocityGradients,K),this}addLimitVelocityGradient(K,Y,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,Y,l),this}removeLimitVelocityGradient(K){return this._removeFactorGradient(this._limitVelocityGradients,K),this}addDragGradient(K,Y,l){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,Y,l),this}removeDragGradient(K){return this._removeFactorGradient(this._dragGradients,K),this}addEmitRateGradient(K,Y,l){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,K,Y,l),this}removeEmitRateGradient(K){return this._removeFactorGradient(this._emitRateGradients,K),this}addStartSizeGradient(K,Y,l){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,K,Y,l),this}removeStartSizeGradient(K){return this._removeFactorGradient(this._startSizeGradients,K),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const K=new Uint8Array(4*this._rawTextureWidth),Y=A.i.Ti[0];for(let l=0;l<this._rawTextureWidth;l++){const v=l/this._rawTextureWidth;p.GetCurrentGradient(v,this._rampGradients,((v,U,d)=>{A.e.LerpToRef(v.color,U.color,d,Y),K[4*l]=255*Y.r,K[4*l+1]=255*Y.g,K[4*l+2]=255*Y.b,K[4*l+3]=255}))}this._rampGradientsTexture=q.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((K,Y)=>K.gradient<Y.gradient?-1:K.gradient>Y.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(K,Y){this._rampGradients||(this._rampGradients=[]);const l=new N(K,Y);return this._rampGradients.push(l),this._syncRampGradientTexture(),this}removeRampGradient(K){return this._removeGradientAndTexture(K,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(K,Y,l){this._colorGradients||(this._colorGradients=[]);const v=new C(K,Y,l);return this._colorGradients.push(v),this._colorGradients.sort(((K,Y)=>K.gradient<Y.gradient?-1:K.gradient>Y.gradient?1:0)),this}removeColorGradient(K){if(!this._colorGradients)return this;let Y=0;for(const l of this._colorGradients){if(l.gradient===K){this._colorGradients.splice(Y,1);break}Y++}return this}resetDrawCache(){for(const K of this._drawWrappers)if(K)for(const Y of K)null===Y||void 0===Y||Y.dispose();this._drawWrappers=[]}_fetchR(K,Y,l,v,U){return U[4*(((K=.5*Math.abs(K)+.5)*l%l|0)+((Y=.5*Math.abs(Y)+.5)*v%v|0)*l)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const K=this._engine,Y=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Y),this._vertexBuffer=new z.b(K,this._vertexData,!0,Y);let l=0;const v=this._vertexBuffer.createVertexBuffer(z.e.PositionKind,l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.e.PositionKind]=v,l+=3;const U=this._vertexBuffer.createVertexBuffer(z.e.ColorKind,l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[z.e.ColorKind]=U,l+=4;const d=this._vertexBuffer.createVertexBuffer("angle",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=d,l+=1;const A=this._vertexBuffer.createVertexBuffer("size",l,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=A,l+=2,this._isAnimationSheetEnabled){const K=this._vertexBuffer.createVertexBuffer("cellIndex",l,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=K,l+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const K=this._vertexBuffer.createVertexBuffer("direction",l,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=K,l+=3}if(this._useRampGradients){const K=this._vertexBuffer.createVertexBuffer("remapData",l,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=K,l+=4}let c;if(this._useInstancing){const Y=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new z.b(K,Y,!1,2),c=this._spriteBuffer.createVertexBuffer("offset",0,2)}else c=this._vertexBuffer.createVertexBuffer("offset",l,2,this._vertexBufferSize,this._useInstancing),l+=2;this._vertexBuffers.offset=c,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const K=[],Y=[];let l=0;for(let v=0;v<this._capacity;v++)K.push(l),K.push(l+1),K.push(l+2),K.push(l),K.push(l+2),K.push(l+3),Y.push(l,l+1,l+1,l+2,l+2,l+3,l+3,l,l,l+3),l+=4;this._indexBuffer=this._engine.createIndexBuffer(K),this._linesIndexBuffer=this._engine.createIndexBuffer(Y)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(K)setTimeout((()=>{this.start(0)}),K);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Y;-1!==(null===(Y=this.j)||void 0===Y?void 0:Y.getClassName().indexOf("Mesh"))&&this.j.ri(!0);const K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Y=0;Y<this.preWarmCycles;Y++)this.animate(!0),K.render()}))}));else for(let Y=0;Y<this.preWarmCycles;Y++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(K))}_postStop(K){}reset(){this._stockParticles.length=0,this.Ql.length=0}_appendParticleVertex(K,Y,l,U){let d=K*this._vertexBufferSize;if(this._vertexData[d++]=Y.position.x+this.ng.x,this._vertexData[d++]=Y.position.y+this.ng.y,this._vertexData[d++]=Y.position.z+this.ng.z,this._vertexData[d++]=Y.color.r,this._vertexData[d++]=Y.color.g,this._vertexData[d++]=Y.color.b,this._vertexData[d++]=Y.color.a,this._vertexData[d++]=Y.angle,this._vertexData[d++]=Y.scale.x*Y.size,this._vertexData[d++]=Y.scale.y*Y.size,this._isAnimationSheetEnabled&&(this._vertexData[d++]=Y.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[d++]=Y.direction.x,this._vertexData[d++]=Y.direction.y,this._vertexData[d++]=Y.direction.z);else if(Y._initialDirection){let K=Y._initialDirection;this.isLocal&&(v.o.TransformNormalToRef(K,this._emitterWorldMatrix,v.j.Qi[0]),K=v.j.Qi[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[d++]=K.x,this._vertexData[d++]=K.y,this._vertexData[d++]=K.z}else{let K=Y.direction;this.isLocal&&(v.o.TransformNormalToRef(K,this._emitterWorldMatrix,v.j.Qi[0]),K=v.j.Qi[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[d++]=K.x,this._vertexData[d++]=K.y,this._vertexData[d++]=K.z}this._useRampGradients&&Y.remapData&&(this._vertexData[d++]=Y.remapData.x,this._vertexData[d++]=Y.remapData.y,this._vertexData[d++]=Y.remapData.z,this._vertexData[d++]=Y.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===l?l=this._epsilon:1===l&&(l=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon)),this._vertexData[d++]=l,this._vertexData[d++]=U)}_prepareParticle(K){}_update(K){if(this._alive=this.Ql.length>0,this.j.position){const K=this.j;this._emitterWorldMatrix=K.getWorldMatrix()}else{const K=this.j;this._emitterWorldMatrix=v.d.Translation(K.x,K.y,K.z)}let Y;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Ql);for(let l=0;l<K&&this.Ql.length!==this._capacity;l++){if(Y=this._createParticle(),this.Ql.push(Y),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const K=(0,Z.d)(this._actualFrame/this.targetStopDuration);p.GetCurrentGradient(K,this._lifeTimeGradients,((l,v)=>{const U=l,d=v,A=U.getFactor(),c=d.getFactor(),t=(K-U.gradient)/(d.gradient-U.gradient);Y.lifeTime=(0,Z.p)(A,c,t)}))}else Y.lifeTime=(0,Z.r)(this.minLifeTime,this.maxLifeTime);const K=(0,Z.r)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,Y.position,Y,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,Y.position,Y,this.isLocal),this.isLocal&&(Y.Hg?Y.Hg.p(Y.position):Y.Hg=Y.position.clone(),v.o.TransformCoordinatesToRef(Y.Hg,this._emitterWorldMatrix,Y.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,Y.direction,Y,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,Y.direction,Y,this.isLocal,this._emitterInverseWorldMatrix),0===K?Y._initialDirection?Y._initialDirection.p(Y.direction):Y._initialDirection=Y.direction.clone():Y._initialDirection=null,Y.direction.scaleInPlace(K),this._sizeGradients&&0!==this._sizeGradients.length?(Y._currentSizeGradient=this._sizeGradients[0],Y._currentSize1=Y._currentSizeGradient.getFactor(),Y.size=Y._currentSize1,this._sizeGradients.length>1?Y._currentSize2=this._sizeGradients[1].getFactor():Y._currentSize2=Y._currentSize1):Y.size=(0,Z.r)(this.minSize,this.maxSize),Y.scale.mi((0,Z.r)(this.minScaleX,this.maxScaleX),(0,Z.r)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const K=this._actualFrame/this.targetStopDuration;p.GetCurrentGradient(K,this._startSizeGradients,((K,l,v)=>{K!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=l.getFactor(),this._currentStartSizeGradient=K);const U=(0,Z.p)(this._currentStartSize1,this._currentStartSize2,v);Y.scale.scaleInPlace(U)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(Y._currentAngularSpeedGradient=this._angularSpeedGradients[0],Y.angularSpeed=Y._currentAngularSpeedGradient.getFactor(),Y._currentAngularSpeed1=Y.angularSpeed,this._angularSpeedGradients.length>1?Y._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():Y._currentAngularSpeed2=Y._currentAngularSpeed1):Y.angularSpeed=(0,Z.r)(this.minAngularSpeed,this.maxAngularSpeed),Y.angle=(0,Z.r)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(Y._currentVelocityGradient=this._velocityGradients[0],Y._currentVelocity1=Y._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?Y._currentVelocity2=this._velocityGradients[1].getFactor():Y._currentVelocity2=Y._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(Y._currentLimitVelocityGradient=this._limitVelocityGradients[0],Y._currentLimitVelocity1=Y._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?Y._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():Y._currentLimitVelocity2=Y._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(Y._currentDragGradient=this._dragGradients[0],Y._currentDrag1=Y._currentDragGradient.getFactor(),this._dragGradients.length>1?Y._currentDrag2=this._dragGradients[1].getFactor():Y._currentDrag2=Y._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)Y._currentColorGradient=this._colorGradients[0],Y._currentColorGradient.getColorToRef(Y.color),Y._currentColor1.p(Y.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(Y._currentColor2):Y._currentColor2.p(Y.color);else{const K=(0,Z.r)(0,1);A.g.LerpToRef(this.color1,this.color2,K,Y.color),this.colorDead.subtractToRef(Y.color,this._colorDiff),this._colorDiff.scaleToRef(1/Y.lifeTime,Y.colorStep)}this._isAnimationSheetEnabled&&(Y._initialStartSpriteCellID=this.startSpriteCellID,Y._initialEndSpriteCellID=this.endSpriteCellID,Y._initialSpriteCellLoop=this.spriteCellLoop),Y.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(Y.remapData=new v.p(0,1,0,1)),this.noiseTexture&&(Y._randomNoiseCoordinates1?(Y._randomNoiseCoordinates1.mi(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2.mi(Math.random(),Math.random(),Math.random())):(Y._randomNoiseCoordinates1=new v.o(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2=new v.o(Math.random(),Math.random(),Math.random()))),Y._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=[z.e.PositionKind,z.e.ColorKind,"angle","offset","size"];return K&&v.push("cellIndex"),Y||v.push("direction"),l&&v.push("remapData"),v}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,YK.b)(v),K&&v.push("particlesInfos"),Y&&v.push("logarithmicDepthConstant"),l&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(K,Y){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,YK.h)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&K.push("#define FOG")),this._isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),Y===t.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&K.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case 2:K.push("#define BILLBOARDY");break;case 8:case 9:K.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&K.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:K.push("#define BILLBOARDMODE_ALL")}l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,Y,l){Y.push(...UK._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),K.push(...UK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,vK.e)(K,this._imageProcessingConfigurationDefines),(0,vK.d)(l,this._imageProcessingConfigurationDefines))}_getWrapper(K){const Y=this._getCustomDrawWrapper(K);if(null!==Y&&void 0!==Y&&Y.effect)return Y;const l=[];this.fillDefines(l,K);const v=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let U=this._drawWrappers[v];U||(U=this._drawWrappers[v]=[]);let d=U[K];d||(d=new KK.b(this._engine),d.drawContext&&(d.drawContext.useInstancing=this._useInstancing),U[K]=d);const A=l.join("\n");if(d.defines!==A){const K=[],Y=[],l=[];this.fillUniformsAttributesAndSamplerNames(Y,K,l),d.setEffect(this._engine.createEffect("particles",K,Y,l,A,void 0,void 0,void 0,void 0,this._shaderLanguage),A)}return d}animate(){var K;let Y,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!l&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(l?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this.manualEmitCount>-1)Y=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let K=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Y=this._actualFrame/this.targetStopDuration;p.GetCurrentGradient(Y,this._emitRateGradients,((Y,l,v)=>{Y!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=l.getFactor(),this._currentEmitRateGradient=Y),K=(0,Z.p)(this._currentEmitRate1,this._currentEmitRate2,v)}))}Y=K*this._scaledUpdateSpeed|0,this._newPartsExcess+=K*this._scaledUpdateSpeed-Y}if(this._newPartsExcess>1&&(Y+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Y=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Y),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!l){let K=0;for(let Y=0;Y<this.Ql.length;Y++){const l=this.Ql[Y];this._appendParticleVertices(K,l),K+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Ql.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(K,Y){this._appendParticleVertex(K++,Y,0,0),this._useInstancing||(this._appendParticleVertex(K++,Y,1,0),this._appendParticleVertex(K++,Y,1,1),this._appendParticleVertex(K++,Y,0,1))}rebuild(){var K;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(K=this._spriteBuffer)||void 0===K||K._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!UK.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(l.bind(l,12240)),Promise.resolve().then(l.bind(l,12185))])):await Promise.all([Promise.resolve().then(l.bind(l,12175)),Promise.resolve().then(l.bind(l,12158))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(t.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(t.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(K){const Y=this._getWrapper(K),l=Y.effect,U=this._engine;U.enableEffect(Y);const d=this.defaultViewMatrix??this._scene.getViewMatrix();if(l.setTexture("diffuseSampler",this.particleTexture),l.setMatrix("view",d),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();l.setFloat3("particlesInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,this.spriteCellWidth/K.width)}if(l.setVector2("translationPivot",this.translationPivot),l.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;l.setVector3("eyePosition",K.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),l.setTexture("rampSampler",this._rampGradientsTexture));const A=l.defines;var c,Z,m,V,M,u;(this._scene&&((0,YK.c)(l,this,this._scene),this.applyFog&&(0,lK.e)(this._scene,void 0,l)),A.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(v.j.Matrix[0]),l.setMatrix("invView",v.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?U.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,l):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,l)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?U.bindBuffers(this._vertexBuffers,null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._linesIndexBuffer:this._indexBuffer,l):U.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,l);switch(this.useLogarithmicDepth&&this._scene&&(0,lK.k)(A,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),K){case t.BLENDMODE_ADD:U.setAlphaMode(1);break;case t.BLENDMODE_ONEONE:U.setAlphaMode(6);break;case t.BLENDMODE_STANDARD:U.setAlphaMode(2);break;case t.BLENDMODE_MULTIPLY:U.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),this._useInstancing)?null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?U.drawElementsType(6,0,10,this.Ql.length):U.drawArraysType(7,0,4,this.Ql.length):null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?U.drawElementsType(1,0,10*this.Ql.length):U.drawElementsType(0,0,6*this.Ql.length);return this.Ql.length}render(){if(!this.isReady()||!this.Ql.length)return 0;const K=this._engine;K.setState&&(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0));let Y=0;return Y=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Y}_onDispose(){}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Y,l),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const K=this._scene.qi.indexOf(this);K>-1&&this._scene.qi.splice(K,1),this._scene._activeParticleSystems.dispose()}this.Hi.notifyObservers(this),this.Hi.clear(),this.onStoppedObservable.clear(),this.reset()}}UK.ForceGLSL=!1;var dK,AK=l(515);!function(K){K[K.ATTACHED=0]="ATTACHED",K[K.END=1]="END"}(dK||(dK={}));class cK{constructor(K){if(this.particleSystem=K,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!K.j||!K.j.dispose){const Y=(0,c.c)("BABYLON.AbstractMesh");K.j=new Y("SubemitterSystemEmitter",K.va()),K._disposeEmitterOnDispose=!0}}clone(){let K=this.particleSystem.j;if(K){if(K instanceof v.o)K=K.clone();else if(-1!==K.getClassName().indexOf("Mesh")){K=new((0,c.c)("BABYLON.Mesh"))("",K.va()),K.isVisible=!1}}else K=new v.o;const Y=new cK(this.particleSystem.clone(this.particleSystem.name,K));return Y.particleSystem.name+="Clone",Y.type=this.type,Y.inheritDirection=this.inheritDirection,Y.inheritedVelocityAmount=this.inheritedVelocityAmount,Y.particleSystem._disposeEmitterOnDispose=!0,Y.particleSystem.disposeOnStop=!0,Y}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Y={};return Y.type=this.type,Y.inheritDirection=this.inheritDirection,Y.inheritedVelocityAmount=this.inheritedVelocityAmount,Y.particleSystem=this.particleSystem.serialize(K),Y}static _ParseParticleSystem(K,Y,l){throw(0,AK.e)("ParseParticle")}static Parse(K,Y,l){const v=K.particleSystem,U=new cK(cK._ParseParticleSystem(v,Y,l,!0));return U.type=K.type,U.inheritDirection=K.inheritDirection,U.inheritedVelocityAmount=K.inheritedVelocityAmount,U.particleSystem._isSubEmitter=!0,U}dispose(){this.particleSystem.dispose()}}var tK=l(567);function ZK(K,Y){const l=new J;return l.direction1=K,l.direction2=Y,l}function mK(){return new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function VK(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function MK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0);return new R(K,Y,l)}function uK(){return new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function oK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0);return new W(K,Y,l,U,d)}function WK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new M(K,Y)}function gK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0);return new u(K,Y,l,U)}class JK extends UK{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=K=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Y=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[Y].forEach((Y=>{if(1===Y.type){const l=Y.clone();K._inheritParticleInfoToSubEmitter(l),l.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(l.particleSystem),l.particleSystem.start()}}))}}createPointEmitter(K,Y){const l=ZK(K,Y);return this.particleEmitterType=l,l}createHemisphericEmitter(){const K=mK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=VK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=MK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=uK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=oK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=WK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=gK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,Y,l,v){const U=new V;return this.particleEmitterType=U,this.direction1=K,this.direction2=Y,this.minEmitBox=l,this.maxEmitBox=v,U}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((K=>{K instanceof JK?this._subEmitters.push([new cK(K)]):K instanceof cK?this._subEmitters.push([K]):K instanceof Array&&this._subEmitters.push(K)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((K=>{K.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const K=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==K&&this._rootParticleSystem.activeSubSystems.splice(K,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(K){K&&this._stopSubEmitters()}_prepareParticle(K){if(this._subEmitters&&this._subEmitters.length>0){const Y=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];K._attachedSubEmitters=[],Y.forEach((Y=>{if(0===Y.type){const l=Y.clone();K._attachedSubEmitters.push(l),l.particleSystem.start()}}))}}_onDispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var l;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),K)&&(null===(l=this.particles)||void 0===l||l.forEach((K=>{if(K._attachedSubEmitters)for(let Y=K._attachedSubEmitters.length-1;Y>=0;Y-=1)K._attachedSubEmitters[Y].dispose()})));if(Y&&this.activeSubSystems)for(let v=this.activeSubSystems.length-1;v>=0;v-=1)this.activeSubSystems[v].dispose();if(this._subEmitters&&this._subEmitters.length){for(let K=0;K<this._subEmitters.length;K++)for(const Y of this._subEmitters[K])Y.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(K,Y,l,U){let d;d=l instanceof tK.b?null:l;const t=(0,c.c)("BABYLON.Texture");if(t&&d&&(K.texture?Y.particleTexture=t.Parse(K.texture,d,U):K.textureName&&(Y.particleTexture=new t(U+K.textureName,d,!1,void 0===K.invertY||K.invertY),Y.particleTexture.name=K.textureName)),K.emitterId||0===K.emitterId||void 0!==K.j?K.emitterId&&d?Y.j=d.getLastMeshById(K.emitterId):Y.j=v.o.yi(K.j):Y.j=v.o.Zero(),Y.isLocal=!!K.isLocal,void 0!==K.renderingGroupId&&(Y.renderingGroupId=K.renderingGroupId),void 0!==K.isBillboardBased&&(Y.isBillboardBased=K.isBillboardBased),void 0!==K.billboardMode&&(Y.billboardMode=K.billboardMode),void 0!==K.useLogarithmicDepth&&(Y.useLogarithmicDepth=K.useLogarithmicDepth),K.animations){for(let l=0;l<K.animations.length;l++){const v=K.animations[l],U=(0,c.c)("BABYLON.Animation");U&&Y.animations.push(U.Parse(v))}Y.beginAnimationOnStart=K.beginAnimationOnStart,Y.beginAnimationFrom=K.beginAnimationFrom,Y.beginAnimationTo=K.beginAnimationTo,Y.beginAnimationLoop=K.beginAnimationLoop}if(K.autoAnimate&&d&&d.beginAnimation(Y,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),Y.startDelay=0|K.startDelay,Y.minAngularSpeed=K.minAngularSpeed,Y.maxAngularSpeed=K.maxAngularSpeed,Y.minSize=K.minSize,Y.maxSize=K.maxSize,K.minScaleX&&(Y.minScaleX=K.minScaleX,Y.maxScaleX=K.maxScaleX,Y.minScaleY=K.minScaleY,Y.maxScaleY=K.maxScaleY),void 0!==K.preWarmCycles&&(Y.preWarmCycles=K.preWarmCycles,Y.preWarmStepOffset=K.preWarmStepOffset),void 0!==K.minInitialRotation&&(Y.minInitialRotation=K.minInitialRotation,Y.maxInitialRotation=K.maxInitialRotation),Y.minLifeTime=K.minLifeTime,Y.maxLifeTime=K.maxLifeTime,Y.minEmitPower=K.minEmitPower,Y.maxEmitPower=K.maxEmitPower,Y.emitRate=K.emitRate,Y.gravity=v.o.yi(K.gravity),K.noiseStrength&&(Y.noiseStrength=v.o.yi(K.noiseStrength)),Y.color1=A.g.yi(K.color1),Y.color2=A.g.yi(K.color2),Y.colorDead=A.g.yi(K.colorDead),Y.updateSpeed=K.updateSpeed,Y.targetStopDuration=K.targetStopDuration,Y.blendMode=K.blendMode,K.colorGradients)for(const v of K.colorGradients)Y.addColorGradient(v.gradient,A.g.yi(v.color1),v.color2?A.g.yi(v.color2):void 0);if(K.rampGradients){for(const l of K.rampGradients)Y.addRampGradient(l.gradient,A.e.yi(l.color));Y.useRampGradients=K.useRampGradients}if(K.colorRemapGradients)for(const v of K.colorRemapGradients)Y.addColorRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.alphaRemapGradients)for(const v of K.alphaRemapGradients)Y.addAlphaRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.sizeGradients)for(const v of K.sizeGradients)Y.addSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.angularSpeedGradients)for(const v of K.angularSpeedGradients)Y.addAngularSpeedGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.velocityGradients)for(const v of K.velocityGradients)Y.addVelocityGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.dragGradients)for(const v of K.dragGradients)Y.addDragGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.emitRateGradients)for(const v of K.emitRateGradients)Y.addEmitRateGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.startSizeGradients)for(const v of K.startSizeGradients)Y.addStartSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.lifeTimeGradients)for(const v of K.lifeTimeGradients)Y.addLifeTimeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(K.limitVelocityGradients){for(const l of K.limitVelocityGradients)Y.addLimitVelocityGradient(l.gradient,void 0!==l.factor1?l.factor1:l.factor,l.factor2);Y.limitVelocityDamping=K.limitVelocityDamping}if(K.noiseTexture&&d){const l=(0,c.c)("BABYLON.ProceduralTexture");Y.noiseTexture=l.Parse(K.noiseTexture,d,U)}let Z;if(K.particleEmitterType){switch(K.particleEmitterType.type){case"SphereParticleEmitter":Z=new n;break;case"SphereDirectedParticleEmitter":Z=new R;break;case"ConeEmitter":case"ConeParticleEmitter":Z=new M;break;case"ConeDirectedParticleEmitter":Z=new u;break;case"CylinderParticleEmitter":Z=new o;break;case"CylinderDirectedParticleEmitter":Z=new W;break;case"HemisphericParticleEmitter":Z=new g;break;case"PointParticleEmitter":Z=new J;break;case"MeshParticleEmitter":Z=new r;break;case"CustomParticleEmitter":Z=new H;break;default:Z=new V}Z.parse(K.particleEmitterType,d)}else Z=new V,Z.parse(K,d);Y.particleEmitterType=Z,Y.startSpriteCellID=K.startSpriteCellID,Y.endSpriteCellID=K.endSpriteCellID,Y.spriteCellLoop=K.spriteCellLoop??!0,Y.spriteCellWidth=K.spriteCellWidth,Y.spriteCellHeight=K.spriteCellHeight,Y.spriteCellChangeSpeed=K.spriteCellChangeSpeed,Y.spriteRandomStartCell=K.spriteRandomStartCell,Y.disposeOnStop=K.disposeOnStop??!1,Y.manualEmitCount=K.manualEmitCount??-1}static Parse(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const c=K.name;let t,Z,m=null,V=null;if(Y instanceof tK.b?t=Y:(Z=Y,t=Z.getEngine()),K.customShader&&t.createEffectForParticles){V=K.customShader;const Y=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"";m=t.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,Y)}const M=new JK(c,d||K.Wh,Y,m,K.isAnimationSheetEnabled);if(M.customShader=V,M._rootUrl=l,K.id&&(M.id=K.id),K.subEmitters){M.subEmitters=[];for(const v of K.subEmitters){const K=[];for(const U of v)K.push(cK.Parse(U,Y,l));M.subEmitters.push(K)}}return JK._Parse(K,M,Y,l),K.textureMask&&(M.textureMask=A.g.yi(K.textureMask)),K.ng&&(M.ng=v.o.yi(K.ng)),K.preventAutoStart&&(M.preventAutoStart=K.preventAutoStart),U||M.preventAutoStart||M.start(),M}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Y={};if(JK._Serialize(Y,this,K),Y.textureMask=this.textureMask.zi(),Y.customShader=this.customShader,Y.preventAutoStart=this.preventAutoStart,Y.ng=this.ng.zi(),this.subEmitters){Y.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const l of this._subEmitters){const v=[];for(const Y of l)v.push(Y.serialize(K));Y.subEmitters.push(v)}}return Y}static _Serialize(K,Y,l){if(K.name=Y.name,K.id=Y.id,K.Wh=Y.getCapacity(),K.disposeOnStop=Y.disposeOnStop,K.manualEmitCount=Y.manualEmitCount,Y.j.position){const l=Y.j;K.emitterId=l.id}else{const l=Y.j;K.j=l.zi()}Y.particleEmitterType&&(K.particleEmitterType=Y.particleEmitterType.serialize()),Y.particleTexture&&(l?K.texture=Y.particleTexture.serialize():(K.textureName=Y.particleTexture.name,K.invertY=!!Y.particleTexture._invertY)),K.isLocal=Y.isLocal,X.c.AppendSerializedAnimations(Y,K),K.beginAnimationOnStart=Y.beginAnimationOnStart,K.beginAnimationFrom=Y.beginAnimationFrom,K.beginAnimationTo=Y.beginAnimationTo,K.beginAnimationLoop=Y.beginAnimationLoop,K.startDelay=Y.startDelay,K.renderingGroupId=Y.renderingGroupId,K.isBillboardBased=Y.isBillboardBased,K.billboardMode=Y.billboardMode,K.minAngularSpeed=Y.minAngularSpeed,K.maxAngularSpeed=Y.maxAngularSpeed,K.minSize=Y.minSize,K.maxSize=Y.maxSize,K.minScaleX=Y.minScaleX,K.maxScaleX=Y.maxScaleX,K.minScaleY=Y.minScaleY,K.maxScaleY=Y.maxScaleY,K.minEmitPower=Y.minEmitPower,K.maxEmitPower=Y.maxEmitPower,K.minLifeTime=Y.minLifeTime,K.maxLifeTime=Y.maxLifeTime,K.emitRate=Y.emitRate,K.gravity=Y.gravity.zi(),K.noiseStrength=Y.noiseStrength.zi(),K.color1=Y.color1.zi(),K.color2=Y.color2.zi(),K.colorDead=Y.colorDead.zi(),K.updateSpeed=Y.updateSpeed,K.targetStopDuration=Y.targetStopDuration,K.blendMode=Y.blendMode,K.preWarmCycles=Y.preWarmCycles,K.preWarmStepOffset=Y.preWarmStepOffset,K.minInitialRotation=Y.minInitialRotation,K.maxInitialRotation=Y.maxInitialRotation,K.startSpriteCellID=Y.startSpriteCellID,K.spriteCellLoop=Y.spriteCellLoop,K.endSpriteCellID=Y.endSpriteCellID,K.spriteCellChangeSpeed=Y.spriteCellChangeSpeed,K.spriteCellWidth=Y.spriteCellWidth,K.spriteCellHeight=Y.spriteCellHeight,K.spriteRandomStartCell=Y.spriteRandomStartCell,K.isAnimationSheetEnabled=Y.isAnimationSheetEnabled,K.useLogarithmicDepth=Y.useLogarithmicDepth;const v=Y.getColorGradients();if(v){K.colorGradients=[];for(const Y of v){const l={gradient:Y.gradient,color1:Y.color1.zi()};Y.color2?l.color2=Y.color2.zi():l.color2=Y.color1.zi(),K.colorGradients.push(l)}}const U=Y.getRampGradients();if(U){K.rampGradients=[];for(const Y of U){const l={gradient:Y.gradient,color:Y.color.zi()};K.rampGradients.push(l)}K.useRampGradients=Y.useRampGradients}const d=Y.getColorRemapGradients();if(d){K.colorRemapGradients=[];for(const Y of d){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.colorRemapGradients.push(l)}}const A=Y.getAlphaRemapGradients();if(A){K.alphaRemapGradients=[];for(const Y of A){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.alphaRemapGradients.push(l)}}const c=Y.getSizeGradients();if(c){K.sizeGradients=[];for(const Y of c){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.sizeGradients.push(l)}}const t=Y.getAngularSpeedGradients();if(t){K.angularSpeedGradients=[];for(const Y of t){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.angularSpeedGradients.push(l)}}const Z=Y.getVelocityGradients();if(Z){K.velocityGradients=[];for(const Y of Z){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.velocityGradients.push(l)}}const m=Y.getDragGradients();if(m){K.dragGradients=[];for(const Y of m){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.dragGradients.push(l)}}const V=Y.getEmitRateGradients();if(V){K.emitRateGradients=[];for(const Y of V){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.emitRateGradients.push(l)}}const M=Y.getStartSizeGradients();if(M){K.startSizeGradients=[];for(const Y of M){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.startSizeGradients.push(l)}}const u=Y.getLifeTimeGradients();if(u){K.lifeTimeGradients=[];for(const Y of u){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.lifeTimeGradients.push(l)}}const o=Y.getLimitVelocityGradients();if(o){K.limitVelocityGradients=[];for(const Y of o){const l={gradient:Y.gradient,factor1:Y.factor1};void 0!==Y.factor2?l.factor2=Y.factor2:l.factor2=Y.factor1,K.limitVelocityGradients.push(l)}K.limitVelocityDamping=Y.limitVelocityDamping}Y.noiseTexture&&(K.noiseTexture=Y.noiseTexture.serialize())}clone(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let U=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){U=this.customShader;const K=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",Y=d.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,K);v[0]?v[0].effect=Y:this.setCustomEffect(Y,0)}const A=this.serialize(l),c=JK.Parse(A,this._scene||this._engine,this._rootUrl);return c.name=K,c.customShader=U,c._customWrappers=v,void 0===Y&&(Y=this.j),this.noiseTexture&&(c.noiseTexture=this.noiseTexture.clone()),c.j=Y,this.preventAutoStart||c.start(),c}}JK.BILLBOARDMODE_Y=2,JK.BILLBOARDMODE_ALL=7,JK.BILLBOARDMODE_STRETCHED=8,JK.BILLBOARDMODE_STRETCHED_LOCAL=9,cK._ParseParticleSystem=JK.Parse;var nK=l(2375),RK=l(2366),HK=l(12033);HK.e.prototype.createTransformFeedback=function(){const K=this._gl.createTransformFeedback();if(!K)throw new Error("Unable to create Transform Feedback");return K},HK.e.prototype.deleteTransformFeedback=function(K){this._gl.deleteTransformFeedback(K)},HK.e.prototype.bindTransformFeedback=function(K){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,K)},HK.e.prototype.beginTransformFeedback=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(K?this._gl.POINTS:this._gl.TRIANGLES)},HK.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},HK.e.prototype.setTranformFeedbackVaryings=function(K,Y){this._gl.transformFeedbackVaryings(K,Y,this._gl.INTERLEAVED_ATTRIBS)},HK.e.prototype.bindTransformFeedbackBuffer=function(K){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K?K.underlyingResource:null)},HK.e.prototype.readTransformFeedbackBuffer=function(K){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K)};const zK="clipPlaneFragmentDeclaration2",rK="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.e.IncludesShadersStore[zK]=rK;l(12066),l(12072),l(12074),l(12081),l(12090),l(12097),l(12101),l(12105);const EK="gpuRenderParticlesPixelShader",yK="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.e.ShadersStore[EK]=yK;const TK="clipPlaneVertexDeclaration2",eK="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.e.IncludesShadersStore[TK]=eK;l(12109),l(12118),l(12125),l(12134);const iK="gpuRenderParticlesVertexShader",DK="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.e.ShadersStore[iK]=DK;class BK extends t{static get IsSupported(){if(!O.e.LastCreatedEngine)return!1;const K=O.e.LastCreatedEngine.getCaps();return K.supportTransformFeedbacks||K.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(K){this._maxActiveParticleCount=Math.min(K,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(K){this.maxActiveParticleCount=K}createPointEmitter(K,Y){const l=ZK(K,Y);return this.particleEmitterType=l,l}createHemisphericEmitter(){const K=mK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=VK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=MK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=uK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=oK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=WK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=gK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,Y,l,v){const U=new V;return this.particleEmitterType=U,this.direction1=K,this.direction2=Y,this.minEmitBox=l,this.maxEmitBox=v,U}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==JK.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(JK.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(JK.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";K?setTimeout((()=>{this.start(0)}),K):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var K;let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[Y])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Y]=new KK.b(this._engine),this._customWrappers[Y].effect=K}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(K,Y,l){return super._removeGradientAndTexture(K,Y,l),this._releaseBuffers(),this}addColorGradient(K,Y){this._colorGradients||(this._colorGradients=[]);const l=new C(K,Y);return this._colorGradients.push(l),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(K&&this._colorGradients.sort(((K,Y)=>K.gradient<Y.gradient?-1:K.gradient>Y.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(K){return this._removeGradientAndTexture(K,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Y in this._drawWrappers){var K;null===(K=this._drawWrappers[Y].drawContext)||void 0===K||K.reset()}}_addFactorGradient(K,Y,l){const v=new j(Y,l);K.push(v),this._releaseBuffers()}addSizeGradient(K,Y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,Y),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(K){return this._removeGradientAndTexture(K,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(K,Y){if(!K)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&K.sort(((K,Y)=>K.gradient<Y.gradient?-1:K.gradient>Y.gradient?1:0));const l=this;l[Y]&&(l[Y].dispose(),l[Y]=null)}addAngularSpeedGradient(K,Y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,Y),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(K){return this._removeGradientAndTexture(K,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(K,Y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,Y),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(K){return this._removeGradientAndTexture(K,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(K,Y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,Y),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(K){return this._removeGradientAndTexture(K,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(K,Y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,Y),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(K){return this._removeGradientAndTexture(K,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(K){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(K),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Hi=new S.b,this.onStoppedObservable=new S.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,l&&"Scene"!==l.getClassName()?(this._engine=l,this.defaultProjectionMatrix=v.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=l||O.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.qi.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,c.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,c.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,c.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,c.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers={0:new KK.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Y=Y??{}).randomTextureSize||delete Y.randomTextureSize;const A={Wh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Y},t=Y;isFinite(t)&&(A.Wh=t),this._capacity=A.Wh,this._maxActiveParticleCount=A.Wh,this._currentActiveCount=0,this._isAnimationSheetEnabled=d,this.particleEmitterType=new V;const Z=Math.min(this._engine.getCaps().maxTextureSize,A.randomTextureSize);let m=[];for(let v=0;v<Z;++v)m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),m.push(Math.random());this._randomTexture=new q.e(new Float32Array(m),Z,1,5,l,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,m=[];for(let v=0;v<Z;++v)m.push(Math.random()),m.push(Math.random()),m.push(Math.random()),m.push(Math.random());this._randomTexture2=new q.e(new Float32Array(m),Z,1,5,l,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Z}_reset(){this._releaseBuffers()}_createVertexBuffers(K,Y,l){const v={};v.position=Y.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let U=3;v.age=Y.createVertexBuffer("age",U,1,this._attributesStrideSize,!0),U+=1,v.size=Y.createVertexBuffer("size",U,3,this._attributesStrideSize,!0),U+=3,v.life=Y.createVertexBuffer("life",U,1,this._attributesStrideSize,!0),U+=1,U+=4,this.billboardMode===JK.BILLBOARDMODE_STRETCHED&&(v.direction=Y.createVertexBuffer("direction",U,3,this._attributesStrideSize,!0)),U+=3,this._platform.alignDataInBuffer&&(U+=1),this.particleEmitterType instanceof H&&(U+=3,this._platform.alignDataInBuffer&&(U+=1)),this._colorGradientsTexture||(v.color=Y.createVertexBuffer("color",U,4,this._attributesStrideSize,!0),U+=4),this._isBillboardBased||(v.initialDirection=Y.createVertexBuffer("initialDirection",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),this.noiseTexture&&(v.noiseCoordinates1=Y.createVertexBuffer("noiseCoordinates1",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1),v.noiseCoordinates2=Y.createVertexBuffer("noiseCoordinates2",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),v.angle=Y.createVertexBuffer("angle",U,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?U++:U+=2,this._isAnimationSheetEnabled&&(v.cellIndex=Y.createVertexBuffer("cellIndex",U,1,this._attributesStrideSize,!0),U+=1,this.spriteRandomStartCell&&(v.cellStartOffset=Y.createVertexBuffer("cellStartOffset",U,1,this._attributesStrideSize,!0),U+=1)),v.offset=l.createVertexBuffer("offset",0,2),v.uv=l.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(v),this._platform.createVertexBuffers(K,v),this.resetDrawCache()}_initialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!K)return;const Y=this._engine,l=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof H&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const U=this.particleEmitterType instanceof H,d=v.j.Qi[0];let A=0;for(let v=0;v<this._capacity;v++)if(l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),U?(this.particleEmitterType.particleDestinationGenerator(v,null,d),l.push(d.x),l.push(d.y),l.push(d.z)):(l.push(0),l.push(0),l.push(0)),this._platform.alignDataInBuffer&&l.push(0),A+=16,U&&(this.particleEmitterType.particlePositionGenerator(v,null,d),l.push(d.x),l.push(d.y),l.push(d.z),this._platform.alignDataInBuffer&&l.push(0),A+=4),this._colorGradientsTexture||(l.push(0),l.push(0),l.push(0),l.push(0),A+=4),this.isBillboardBased||(l.push(0),l.push(0),l.push(0),this._platform.alignDataInBuffer&&l.push(0),A+=4),this.noiseTexture&&(l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),l.push(Math.random()),l.push(Math.random()),l.push(Math.random()),this._platform.alignDataInBuffer&&l.push(0),A+=8),l.push(0),A+=1,this._angularSpeedGradientsTexture||(l.push(0),A+=1),this._isAnimationSheetEnabled&&(l.push(0),A+=1,this.spriteRandomStartCell&&(l.push(0),A+=1)),this._platform.alignDataInBuffer){let K=3-(A+3&3);for(A+=K;K-- >0;)l.push(0)}const c=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),t=this._platform.createParticleBuffer(l),Z=this._platform.createParticleBuffer(l);this._buffer0=new z.b(Y,t,!1,this._attributesStrideSize),this._buffer1=new z.b(Y,Z,!1,this._attributesStrideSize),this._spriteBuffer=new z.b(Y,c,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let K=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(K+="\n#define BILLBOARD"),this._colorGradientsTexture&&(K+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(K+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(K+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(K+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(K+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(K+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(K+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(K+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(K+="\n#define NOISE"),this.isLocal&&(K+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===K||(this._cachedUpdateDefines=K,this._updateBuffer=this._platform.createUpdateBuffer(K)),this._platform.isUpdateBufferReady()}_getWrapper(K){const Y=this._getCustomDrawWrapper(K);if(null!==Y&&void 0!==Y&&Y.effect)return Y;const l=[];this.fillDefines(l,K);let v=this._drawWrappers[K];v||(v=new KK.b(this._engine),v.drawContext&&(v.drawContext.useInstancing=!0),this._drawWrappers[K]=v);const U=l.join("\n");if(v.defines!==U){const K=[],Y=[],l=[];this.fillUniformsAttributesAndSamplerNames(Y,K,l),v.setEffect(this._engine.createEffect("gpuRenderParticles",K,Y,l,U),U)}return v}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=[z.e.PositionKind,"age","life","size","angle"];return K||U.push(z.e.ColorKind),Y&&U.push("cellIndex"),l||U.push("initialDirection"),v&&U.push("direction"),U.push("offset",z.e.UVKind),U}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["emitterWM","ng","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,YK.b)(v),K&&v.push("sheetInfos"),Y&&v.push("logarithmicDepthConstant"),l&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,YK.h)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==RK.b.FOGMODE_NONE&&K.push("#define FOG")),Y===JK.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this.isLocal&&K.push("#define LOCAL"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case JK.BILLBOARDMODE_Y:K.push("#define BILLBOARDY");break;case JK.BILLBOARDMODE_STRETCHED:K.push("#define BILLBOARDSTRETCHED");break;case JK.BILLBOARDMODE_ALL:K.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&K.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),l&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,Y,l){Y.push(...BK._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===JK.BILLBOARDMODE_STRETCHED)),K.push(...BK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),l.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(nK.e.PrepareUniforms(K,this._imageProcessingConfigurationDefines),nK.e.PrepareSamplers(l,this._imageProcessingConfigurationDefines))}animate(){var K;let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Y?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(K,Y){const l=this[Y];if(!K||!K.length||l)return;const v=new Float32Array(this._rawTextureWidth);for(let U=0;U<this._rawTextureWidth;U++){const Y=U/this._rawTextureWidth;p.GetCurrentGradient(Y,K,((K,Y,l)=>{v[U]=(0,Z.p)(K.factor1,Y.factor1,l)}))}this[Y]=q.e.CreateRTexture(v,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Y].name=Y.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const K=new Uint8Array(4*this._rawTextureWidth),Y=A.i.Ui[0];for(let l=0;l<this._rawTextureWidth;l++){const v=l/this._rawTextureWidth;p.GetCurrentGradient(v,this._colorGradients,((v,U,d)=>{A.g.LerpToRef(v.color1,U.color1,d,Y),K[4*l]=255*Y.r,K[4*l+1]=255*Y.g,K[4*l+2]=255*Y.b,K[4*l+3]=255*Y.a}))}this._colorGradientsTexture=q.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(K,Y){var l,U,d,A;const c=this._getWrapper(K),t=c.effect;this._engine.enableEffect(c);const Z=(null===(l=this._scene)||void 0===l?void 0:l.getViewMatrix())||v.d.IdentityReadOnly;if(t.setMatrix("view",Z),t.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),t.setTexture("diffuseSampler",this.particleTexture),t.setVector2("translationPivot",this.translationPivot),t.setVector3("ng",this.ng),this.isLocal&&t.setMatrix("emitterWM",Y),this._colorGradientsTexture?t.setTexture("colorGradientSampler",this._colorGradientsTexture):t.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();t.setFloat3("sheetInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,K.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;t.setVector3("eyePosition",K.globalPosition)}const m=t.defines;if(this._scene&&((0,YK.c)(t,this,this._scene),this.applyFog&&(0,lK.e)(this._scene,void 0,t)),m.indexOf("#define BILLBOARDMODE_ALL")>=0){const K=Z.clone();K.invert(),t.setMatrix("invView",K)}switch(this.useLogarithmicDepth&&this._scene&&(0,lK.k)(m,t,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(t),K){case JK.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case JK.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case JK.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case JK.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,t,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(t),null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(K){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!K)if(this.j.position){K=this.j.getWorldMatrix()}else{const Y=this.j;K=v.j.Matrix[0],v.d.TranslationToRef(Y.x,Y.y,Y.z,K)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",K),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Y=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Y}render(){let K,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Y&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let K=0;K<this.preWarmCycles;K++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const K=0|this._accumulatedCount;this._accumulatedCount-=K,this._currentActiveCount+=K}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){K=this.j.getWorldMatrix()}else{const Y=this.j;K=v.j.Matrix[0],v.d.TranslationToRef(Y.x,Y.y,Y.z,K)}const U=this._engine;this.updateInAnimate||this._update(K);let d=0;return Y||l||(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0),d=this.blendMode===JK.BLENDMODE_MULTIPLYADD?this._render(JK.BLENDMODE_MULTIPLY,K)+this._render(JK.BLENDMODE_ADD,K):this._render(this.blendMode,K),this._engine.setAlphaMode(0)),d}rebuild(){const K=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(K,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,K()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Y in this._drawWrappers){this._drawWrappers[Y].dispose()}if(this._drawWrappers={},this._scene){const K=this._scene.qi.indexOf(this);K>-1&&this._scene.qi.splice(K,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Y=0;Y<this._renderVertexBuffers.length;++Y){const K=this._renderVertexBuffers[Y];for(const Y in K)K[Y].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Hi.notifyObservers(this),this.Hi.clear()}clone(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let U=null;const d=this._engine;if(d.createEffectForParticles&&null!=this.customShader){U=this.customShader;const K=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";v[0]=d.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,K,void 0,void 0,void 0,this)}const A=this.serialize(l),c=BK.Parse(A,this._scene||this._engine,this._rootUrl);return c.name=K,c.customShader=U,c._customWrappers=v,void 0===Y&&(Y=this.j),this.noiseTexture&&(c.noiseTexture=this.noiseTexture.clone()),c.j=Y,c}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Y={};return JK._Serialize(Y,this,K),Y.activeParticleCount=this.activeParticleCount,Y.randomTextureSize=this._randomTextureSize,Y.customShader=this.customShader,Y}static Parse(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0;const d=K.name;let A,c;Y instanceof tK.b?A=Y:(c=Y,A=c.getEngine());const t=new BK(d,{Wh:U||K.Wh,randomTextureSize:K.randomTextureSize},Y,null,K.isAnimationSheetEnabled);if(t._rootUrl=l,K.customShader&&A.createEffectForParticles){const Y=K.customShader,l=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"",v=A.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,l,void 0,void 0,void 0,t);t.setCustomEffect(v,0),t.customShader=Y}return K.id&&(t.id=K.id),K.activeParticleCount&&(t.activeParticleCount=K.activeParticleCount),JK._Parse(K,t,Y,l),K.preventAutoStart&&(t.preventAutoStart=K.preventAutoStart),v||t.preventAutoStart||t.start(),t}}var PK=l(475),GK=l(12139),QK=l(11862);class XK{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(K){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Y of this.systems)Y.j=K;this._emitterNode=K}setEmitterAsSphere(K,Y,l){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:K,renderingGroupId:Y};const v=(0,GK.d)("emitterSphere",{diameter:K.diameter,segments:K.segments},l);v.renderingGroupId=Y;const U=new QK.d("emitterSphereMaterial",l);U.emissiveColor=K.color,v.material=U;for(const d of this.systems)d.j=v;this._emitterNode=v}start(K){for(const Y of this.systems)K&&(Y.j=K),Y.start()}dispose(){for(const K of this.systems)K.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Y={systems:[]};for(const l of this.systems)Y.systems.push(l.serialize(K));return this._emitterNode&&(Y.j=this._emitterCreationOptions),Y}static Parse(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;const U=new XK,d=this.BaseAssetsUrl+"/textures/";Y=Y||O.e.LastCreatedScene;for(const A of K.systems)U.systems.push(l?BK.Parse(A,Y,d,!0,v):JK.Parse(A,Y,d,!0,v));if(K.j){const l=K.j.options;if("Sphere"===K.j.kind)U.setEmitterAsSphere({diameter:l.diameter,segments:l.segments,color:A.e.yi(l.color)},K.j.renderingGroupId,Y)}return U}}XK.BaseAssetsUrl="https://assets.babylonjs.com/particles";var fK=l(522);class wK{static CreateDefault(K){let Y,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,v=arguments.length>2?arguments[2]:void 0;return Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new BK("default system",{Wh:l},v):new JK("default system",l,v),Y.j=K,Y.particleTexture=new f.c("https://assets.babylonjs.com/textures/flare.png",Y.va()),Y.createConeEmitter(.1,Math.PI/4),Y.color1=new A.g(1,1,1,1),Y.color2=new A.g(1,1,1,1),Y.colorDead=new A.g(1,1,1,0),Y.minSize=.1,Y.maxSize=.1,Y.minEmitPower=2,Y.maxEmitPower=2,Y.updateSpeed=1/60,Y.emitRate=30,Y}static CreateAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;Y||(Y=O.e.LastCreatedScene);const U={};return Y.addPendingData(U),new Promise(((d,A)=>{if(l&&!BK.IsSupported)return Y.removePendingData(U),A("Particle system with GPU is not supported.");PK.d.LoadFile(`${wK.BaseAssetsUrl}/systems/${K}.json`,(K=>{Y.removePendingData(U);const A=JSON.parse(K.toString());return d(XK.Parse(A,Y,l,v))}),void 0,void 0,void 0,(()=>(Y.removePendingData(U),A(`An error occurred with the creation of your particle system. Check if your type '${K}' exists.`))))}))}static ExportSet(K){const Y=new XK;for(const l of K)Y.systems.push(l);return Y}static ParseFromFileAsync(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5?arguments[5]:void 0;return new Promise(((A,c)=>{const t=new fK.e;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const Y=JSON.parse(t.responseText);let c;c=v?BK.Parse(Y,l,U,!1,d):JK.Parse(Y,l,U,!1,d),K&&(c.name=K),A(c)}else c("Unable to load the particle system")})),t.open("GET",Y),t.send()}))}static ParseFromSnippetAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",U=arguments.length>4?arguments[4]:void 0;if("_BLANK"===K){const K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise(((d,A)=>{const c=new fK.e;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const A=JSON.parse(JSON.parse(c.responseText).jsonPayload),t=JSON.parse(A.particleSystem);let Z;Z=l?BK.Parse(t,Y,v,!1,U):JK.Parse(t,Y,v,!1,U),Z.snippetId=K,d(Z)}else A("Unable to load the snippet "+K)})),c.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),c.send()}))}}wK.BaseAssetsUrl=XK.BaseAssetsUrl,wK.SnippetUrl="https://snippet.babylonjs.com",wK.CreateFromSnippetAsync=wK.ParseFromSnippetAsync;var kK=l(465),IK=l(863),LK=l(12148);(0,LK.d)(IK.c.NAME_PARTICLESYSTEM,((K,Y,l,v)=>{const U=(0,LK.h)(IK.c.NAME_PARTICLESYSTEM);if(U&&void 0!==K.qi&&null!==K.qi)for(let d=0,A=K.qi.length;d<A;d++){const A=K.qi[d];l.qi.push(U(A,Y,v))}})),(0,LK.b)(IK.c.NAME_PARTICLESYSTEM,((K,Y,l)=>{if(K.activeParticleCount){return BK.Parse(K,Y,l)}return JK.Parse(K,Y,l)})),tK.b.prototype.createEffectForParticles=function(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=[],V=[];const M=[];return t?t.fillUniformsAttributesAndSamplerNames(V,m,M):(m=JK._GetAttributeNamesOrOptions(),V=JK._GetEffectCreationOptions()),-1===U.indexOf(" BILLBOARD")&&(U+="\n#define BILLBOARD\n"),null!==t&&void 0!==t&&t.isAnimationSheetEnabled&&-1===U.indexOf(" ANIMATESHEET")&&(U+="\n#define ANIMATESHEET\n"),-1===v.indexOf("diffuseSampler")&&v.push("diffuseSampler"),this.createEffect({vertex:(null===t||void 0===t?void 0:t.vertexShaderName)??"particles",fragmentElement:K},m,V.concat(Y),M.concat(v),U,d,A,c,void 0,Z,(async()=>{0===Z?await Promise.resolve().then(l.bind(l,12175)):await Promise.resolve().then(l.bind(l,12240))}))},kK.e.prototype.getEmittedParticleSystems=function(){const K=[];for(let Y=0;Y<this.va().qi.length;Y++){const l=this.va().qi[Y];l.j===this&&K.push(l)}return K},kK.e.prototype.getHierarchyEmittedParticleSystems=function(){const K=[],Y=this.getDescendants();Y.push(this);for(let l=0;l<this.va().qi.length;l++){const v=this.va().qi[l],U=v.j;U.position&&-1!==Y.indexOf(U)&&K.push(v)}return K};l(760),l(778),l(809);l(740),l(460),l(833),l(748),l(856);l(2262);var aK;l(12151),l(2305);!function(K){K[K.Color=2]="Color",K[K.UV=1]="UV",K[K.Random=0]="Random",K[K.Stated=3]="Stated"}(aK||(aK={}));l(12158),l(12175),l(12185),l(12240)},12216:(K,Y,l)=>{"use strict";const v="clipPlaneFragment",U="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12188:(K,Y,l)=>{"use strict";const v="clipPlaneFragmentDeclaration",U="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12255:(K,Y,l)=>{"use strict";const v="clipPlaneVertex",U="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12243:(K,Y,l)=>{"use strict";const v="clipPlaneVertexDeclaration",U="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12231:(K,Y,l)=>{"use strict";const v="fogFragment",U="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12211:(K,Y,l)=>{"use strict";const v="fogFragmentDeclaration",U="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12263:(K,Y,l)=>{"use strict";const v="fogVertex",U="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12246:(K,Y,l)=>{"use strict";const v="fogVertexDeclaration",U="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12200:(K,Y,l)=>{"use strict";const v="helperFunctions",U="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12190:(K,Y,l)=>{"use strict";const v="imageProcessingDeclaration",U="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12205:(K,Y,l)=>{"use strict";const v="imageProcessingFunctions",U="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";l(577).e.IncludesShadersStoreWGSL[v]=U},12193:(K,Y,l)=>{"use strict";const v="logDepthDeclaration",U="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12224:(K,Y,l)=>{"use strict";const v="logDepthFragment",U="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12272:(K,Y,l)=>{"use strict";const v="logDepthVertex",U="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";l(577).e.IncludesShadersStoreWGSL[v]=U},12185:(K,Y,l)=>{"use strict";l.r(Y),l.d(Y,{particlesPixelShaderWGSL:()=>A});var v=l(577);l(12188),l(12190),l(12193),l(12200),l(12205),l(12211),l(12216),l(12224),l(12231);const U="particlesPixelShader",d="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.e.ShadersStoreWGSL[U]=d;const A={name:U,shader:d}},12240:(K,Y,l)=>{"use strict";l.r(Y),l.d(Y,{particlesVertexShaderWGSL:()=>A});var v=l(577);l(12243),l(12246),l(12193),l(12255),l(12263),l(12272);const U="particlesVertexShader",d="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.e.ShadersStoreWGSL[U]=d;const A={name:U,shader:d}},12097:(K,Y,l)=>{"use strict";const v="clipPlaneFragment",U="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12167:(K,Y,l)=>{"use strict";const v="clipPlaneFragmentDeclaration",U="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12118:(K,Y,l)=>{"use strict";const v="clipPlaneVertex",U="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12180:(K,Y,l)=>{"use strict";const v="clipPlaneVertexDeclaration",U="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12105:(K,Y,l)=>{"use strict";const v="fogFragment",U="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12090:(K,Y,l)=>{"use strict";const v="fogFragmentDeclaration",U="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12125:(K,Y,l)=>{"use strict";const v="fogVertex",U="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12109:(K,Y,l)=>{"use strict";const v="fogVertexDeclaration",U="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12074:(K,Y,l)=>{"use strict";const v="helperFunctions",U="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";l(577).e.IncludesShadersStore[v]=U},12066:(K,Y,l)=>{"use strict";const v="imageProcessingDeclaration",U="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12081:(K,Y,l)=>{"use strict";const v="imageProcessingFunctions",U="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";l(577).e.IncludesShadersStore[v]=U},12072:(K,Y,l)=>{"use strict";const v="logDepthDeclaration",U="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12101:(K,Y,l)=>{"use strict";const v="logDepthFragment",U="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12134:(K,Y,l)=>{"use strict";const v="logDepthVertex",U="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";l(577).e.IncludesShadersStore[v]=U},12158:(K,Y,l)=>{"use strict";l.r(Y),l.d(Y,{particlesPixelShader:()=>A});var v=l(577);l(12167),l(12066),l(12072),l(12074),l(12081),l(12090),l(12097),l(12101),l(12105);const U="particlesPixelShader",d="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.e.ShadersStore[U]=d;const A={name:U,shader:d}},12175:(K,Y,l)=>{"use strict";l.r(Y),l.d(Y,{particlesVertexShader:()=>A});var v=l(577);l(12180),l(12109),l(12072),l(12118),l(12125),l(12134);const U="particlesVertexShader",d="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.e.ShadersStore[U]=d;const A={name:U,shader:d}},12424:(K,Y,l)=>{"use strict";class v{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((K,Y)=>{this._resolve=K,this._reject=Y}))}}var U=l(675),d=l(706),A=l(475),c=l(644),t=l(12432),Z=l(12451),m=l(469),V=l(12020),M=l(12456),u=l(12463),o=l(526),W=l(492),g=l(500);class J{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(K){this._useTextureToStoreBoneMatrices=K,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(K,Y,l){this.name=K,this.id=Y,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=U.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new m.b,this.bones=[],this._scene=l||o.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const v=this._scene.getEngine().getCaps();this._canUseTextureForBones=v.textureFloat&&v.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((K=>!K.getParent()))}getTransformMatrices(K){if(this.needInitialSkinMatrix){if(!K)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return K._bonesTransformMatrices||this.prepare(!0),K._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(K){return this.needInitialSkinMatrix&&K._transformMatrixTexture?K._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(K){let Y=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Y+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,K){Y+=", Ranges: {";let K=!0;for(const l in this._ranges)K&&(Y+=", ",K=!1),Y+=l;Y+="}"}return Y}getBoneIndexByName(K){for(let Y=0,l=this.bones.length;Y<l;Y++)if(this.bones[Y].name===K)return Y;return-1}createAnimationRange(K,Y,l){if(!this._ranges[K]){this._ranges[K]=new u.b(K,Y,l);for(let v=0,U=this.bones.length;v<U;v++)this.bones[v].animations[0]&&this.bones[v].animations[0].createRange(K,Y,l)}}deleteAnimationRange(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let l=0,v=this.bones.length;l<v;l++)this.bones[l].animations[0]&&this.bones[l].animations[0].deleteRange(K,Y);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}getAnimationRanges(){const K=[];let Y;for(Y in this._ranges)K.push(this._ranges[Y]);return K}copyAnimationRange(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Y]||!K.getAnimationRange(Y))return!1;let v=!0;const U=this._getHighestAnimationFrame()+1,d={},A=K.bones;let c,t;for(t=0,c=A.length;t<c;t++)d[A[t].name]=A[t];this.bones.length!==A.length&&(W.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${A.length}`),v=!1);const Z=l&&this.dimensionsAtRest&&K.dimensionsAtRest?this.dimensionsAtRest.divide(K.dimensionsAtRest):null;for(t=0,c=this.bones.length;t<c;t++){const K=this.bones[t].name,A=d[K];A?v=v&&this.bones[t].copyAnimationRange(A,Y,U,l,Z):(W.e.Warn("copyAnimationRange: not same rig, missing source bone "+K),v=!1)}const m=K.getAnimationRange(Y);return m&&(this._ranges[Y]=new u.b(Y,m.from+U,m.to+U)),v}returnToRest(){for(const K of this.bones)-1!==K._index&&K.returnToRest()}_getHighestAnimationFrame(){let K=0;for(let Y=0,l=this.bones.length;Y<l;Y++)if(this.bones[Y].animations[0]){const l=this.bones[Y].animations[0].getHighestFrame();K<l&&(K=l)}return K}beginAnimation(K,Y,l,v){const U=this.getAnimationRange(K);return U?this._scene.beginAnimation(this,U.from,U.to,Y,l,v):null}static MakeAnimationAdditive(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0;const v=K.getAnimationRange(l);if(!v)return null;const U=K._scene.getAllAnimatablesByTarget(K);let d=null;for(let c=0;c<U.length;c++){const K=U[c];if(K.fromFrame===(null===v||void 0===v?void 0:v.from)&&K.toFrame===(null===v||void 0===v?void 0:v.to)){d=K;break}}const A=K.getAnimatables();for(let c=0;c<A.length;c++){const K=A[c].animations;if(K)for(let v=0;v<K.length;v++)M.b.MakeAnimationAdditive(K[v],Y,l)}return d&&(d.isAdditive=!0),K}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(K){this._meshesWithPoseMatrix.push(K)}_unregisterMeshWithPoseMatrix(K){const Y=this._meshesWithPoseMatrix.indexOf(K);Y>-1&&this._meshesWithPoseMatrix.splice(Y,1)}_computeTransformMatrices(K,Y){this.onBeforeComputeObservable.notifyObservers(this);for(let l=0;l<this.bones.length;l++){const v=this.bones[l];v._childUpdateId++;const U=v.getParent();if(U?v.getLocalMatrix().multiplyToRef(U.getFinalMatrix(),v.getFinalMatrix()):Y?v.getLocalMatrix().multiplyToRef(Y,v.getFinalMatrix()):v.getFinalMatrix().p(v.getLocalMatrix()),-1!==v._index){const Y=null===v._index?l:v._index;v.getAbsoluteInverseBindMatrix().multiplyToArray(v.getFinalMatrix(),K,16*Y)}}this._identity.copyToArray(K,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const K=this.va().getRenderId();if(this._currentRenderId===K)return;this._currentRenderId=K}if(this._numBonesWithLinkedTransformNode>0)for(const K of this.bones)if(K._linkedTransformNode){const Y=K._linkedTransformNode;K.position=Y.position,Y.rotationQuaternion?K.rotationQuaternion=Y.rotationQuaternion:K.rotation=Y.rotation,K.ni=Y.ni}if(this.needInitialSkinMatrix)for(const K of this._meshesWithPoseMatrix){const Y=K.getPoseMatrix();let l=this._isDirty;if(K._bonesTransformMatrices&&K._bonesTransformMatrices.length===16*(this.bones.length+1)||(K._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),l=!0),l){if(this._synchronizedWithMesh!==K){this._synchronizedWithMesh=K;for(const K of this.bones)if(!K.getParent()){K.getBindMatrix().multiplyToRef(Y,U.j.Matrix[1]),K._updateAbsoluteBindMatrices(U.j.Matrix[1])}if(this.isUsingTextureForMatrices){const Y=4*(this.bones.length+1);K._transformMatrixTexture&&K._transformMatrixTexture.getSize().width===Y||(K._transformMatrixTexture&&K._transformMatrixTexture.dispose(),K._transformMatrixTexture=V.e.CreateRGBATexture(K._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(K._bonesTransformMatrices,Y),this.isUsingTextureForMatrices&&K._transformMatrixTexture&&K._transformMatrixTexture.update(K._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=V.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let K=0;K<this.bones.length;K++)this._animatables.push(this.bones[K])}return this._animatables}clone(K,Y){const l=new J(K,Y||K,this._scene);l.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let v=0;v<this.bones.length;v++){const K=this.bones[v];let Y=null;const U=K.getParent();if(U){const K=this.bones.indexOf(U);Y=l.bones[K]}const d=new Z.e(K.name,l,Y,K.getBindMatrix().clone(),K.getRestMatrix().clone());d._index=K._index,K._linkedTransformNode&&d.linkTransformNode(K._linkedTransformNode),g.e.DeepCopy(K.animations,d.animations)}if(this._ranges){l._ranges={};for(const K in this._ranges){const Y=this._ranges[K];Y&&(l._ranges[K]=Y.clone())}}return this._isDirty=!0,l.prepare(!0),l}enableBlending(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((Y=>{Y.animations.forEach((Y=>{Y.enableBlending=!0,Y.blendingSpeed=K}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const K=this._parentContainer.skeletons.indexOf(this);K>-1&&this._parentContainer.skeletons.splice(K,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const K={};K.name=this.name,K.id=this.id,this.dimensionsAtRest&&(K.dimensionsAtRest=this.dimensionsAtRest.zi()),K.bones=[],K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let l=0;l<this.bones.length;l++){var Y;const v=this.bones[l],U=v.getParent(),d={parentBoneIndex:U?this.bones.indexOf(U):-1,index:v.getIndex(),name:v.name,id:v.id,matrix:v.getBindMatrix().zi(),rest:v.getRestMatrix().zi(),linkedTransformNodeId:null===(Y=v.getTransformNode())||void 0===Y?void 0:Y.id};K.bones.push(d),v.length&&(d.length=v.length),v.metadata&&(d.metadata=v.metadata),v.animations&&v.animations.length>0&&(d.animation=v.animations[0].serialize()),K.ranges=[];for(const Y in this._ranges){const l=this._ranges[Y];if(!l)continue;const v={};v.name=Y,v.from=l.from,v.to=l.to,K.ranges.push(v)}}return K}static Parse(K,Y){const l=new J(K.name,K.id,Y);let v;for(K.dimensionsAtRest&&(l.dimensionsAtRest=U.o.yi(K.dimensionsAtRest)),l.needInitialSkinMatrix=K.needInitialSkinMatrix,v=0;v<K.bones.length;v++){const Y=K.bones[v],d=K.bones[v].index;let A=null;Y.parentBoneIndex>-1&&(A=l.bones[Y.parentBoneIndex]);const c=Y.rest?U.d.yi(Y.rest):null,t=new Z.e(Y.name,l,A,U.d.yi(Y.matrix),c,null,d);void 0!==Y.id&&null!==Y.id&&(t.id=Y.id),Y.length&&(t.length=Y.length),Y.metadata&&(t.metadata=Y.metadata),Y.animation&&t.animations.push(M.b.Parse(Y.animation)),void 0!==Y.linkedTransformNodeId&&null!==Y.linkedTransformNodeId&&(l._hasWaitingData=!0,t._waitingTransformNodeId=Y.linkedTransformNodeId)}if(K.ranges)for(v=0;v<K.ranges.length;v++){const Y=K.ranges[v];l.createAnimationRange(Y.name,Y.from,Y.to)}return l}computeAbsoluteMatrices(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||K)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(K)}getPoseMatrix(){let K=null;return this._meshesWithPoseMatrix.length>0&&(K=this._meshesWithPoseMatrix[0].getPoseMatrix()),K}sortBones(){const K=[],Y=new Array(this.bones.length);for(let l=0;l<this.bones.length;l++)this._sortBones(l,K,Y);this.bones=K}_sortBones(K,Y,l){if(l[K])return;l[K]=!0;const v=this.bones[K];if(!v)return;void 0===v._index&&(v._index=K);const U=v.getParent();U&&this._sortBones(this.bones.indexOf(U),Y,l),Y.push(v)}setCurrentPoseAsRest(){this.bones.forEach((K=>{K.setCurrentPoseAsRest()}))}}var n=l(835),R=l(646),H=l(652),z=l(12469),r=l(12473),E=l(619),y=l(702);class T extends r.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(K){this.subSurface.refractionTexture=K,K?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(K){this.subSurface.indexOfRefraction=K}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(K){this.subSurface.invertRefractionY=K}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(K){this.subSurface.linkRefractionWithTransparency=K,K&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===r.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(K){K!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=K?r.b.LIGHTFALLOFF_PHYSICAL:r.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===r.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(K){K!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=K?r.b.LIGHTFALLOFF_GLTF:r.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(K){this.imageProcessingConfiguration.colorCurvesEnabled=K}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(K){this.imageProcessingConfiguration.colorGradingEnabled=K}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(K){this._imageProcessingConfiguration.toneMappingEnabled=K}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(K){this._imageProcessingConfiguration.exposure=K}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(K){this._imageProcessingConfiguration.contrast=K}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(K){this._imageProcessingConfiguration.colorGradingTexture=K}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(K){this._imageProcessingConfiguration.colorCurves=K}constructor(K,Y){super(K,Y,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=d.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new d.e(0,0,0),this.albedoColor=new d.e(1,1,1),this.reflectivityColor=new d.e(1,1,1),this.reflectionColor=new d.e(1,1,1),this.emissiveColor=new d.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,z.d)(this.va())}getClassName(){return"PBRMaterial"}clone(K){let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const v=y.c.Clone((()=>new T(K,this.va())),this,{cloneTexturesOnlyOnce:Y});return v.id=K,v.name=K,this.stencil.copyTo(v.stencil),this._clonePlugins(v,l),v}serialize(){const K=super.serialize();return K.customType="BABYLON.PBRMaterial",K}static Parse(K,Y,l){const v=y.c.Parse((()=>new T(K.name,Y)),K,Y,l);return K.stencil&&v.stencil.parse(K.stencil,Y,l),n.b._ParsePlugins(K,v,Y,l),K.clearCoat&&v.clearCoat.parse(K.clearCoat,Y,l),K.anisotropy&&v.anisotropy.parse(K.anisotropy,Y,l),K.brdf&&v.brdf.parse(K.brdf,Y,l),K.sheen&&v.sheen.parse(K.sheen,Y,l),K.subSurface&&v.subSurface.parse(K.subSurface,Y,l),K.iridescence&&v.iridescence.parse(K.iridescence,Y,l),v}}T.PBRMATERIAL_OPAQUE=r.b.PBRMATERIAL_OPAQUE,T.PBRMATERIAL_ALPHATEST=r.b.PBRMATERIAL_ALPHATEST,T.PBRMATERIAL_ALPHABLEND=r.b.PBRMATERIAL_ALPHABLEND,T.PBRMATERIAL_ALPHATESTANDBLEND=r.b.PBRMATERIAL_ALPHATESTANDBLEND,T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=r.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"directIntensity",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveIntensity",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"environmentIntensity",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"specularIntensity",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"disableBumpMap",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"albedoTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTexture",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTextureStrength",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"opacityTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectionTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectivityTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicTexture",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallic",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"roughness",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicF0Factor",void 0),(0,R.d)([(0,H.l)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicReflectanceColor",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"metallicReflectanceTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectanceTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"microSurfaceTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"bumpTexture",void 0),(0,R.d)([(0,H.C)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty",null)],T.prototype,"lightmapTexture",void 0),(0,R.d)([(0,H.l)("ambient"),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"ambientColor",void 0),(0,R.d)([(0,H.l)("albedo"),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"albedoColor",void 0),(0,R.d)([(0,H.l)("reflectivity"),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectivityColor",void 0),(0,R.d)([(0,H.l)("reflection"),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"reflectionColor",void 0),(0,R.d)([(0,H.l)("emissive"),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"emissiveColor",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"microSurface",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useLightmapAsShadowmap",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"useAlphaFromAlbedoTexture",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"forceAlphaTest",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],T.prototype,"alphaCutOff",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useSpecularOverAlpha",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAmbientInGrayScale",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,R.d)([(0,H.J)()],T.prototype,"usePhysicalLightFalloff",null),(0,R.d)([(0,H.J)()],T.prototype,"useGLTFLightFalloff",null),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRadianceOverAlpha",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useObjectSpaceNormalMap",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useParallax",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useParallaxOcclusion",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"parallaxScaleBias",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsLightsDirty")],T.prototype,"disableLighting",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"forceIrradianceInFragment",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsLightsDirty")],T.prototype,"maxSimultaneousLights",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"invertNormalMapX",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"invertNormalMapY",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"twoSidedLighting",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useAlphaFresnel",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useLinearAlphaFresnel",void 0),(0,R.d)([(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"environmentBRDFTexture",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"forceNormalForward",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"enableSpecularAntiAliasing",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useHorizonOcclusion",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsTexturesDirty")],T.prototype,"useRadianceOcclusion",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"unlit",void 0),(0,R.d)([(0,H.J)(),(0,H.b)("_markAllSubMeshesAsMiscDirty")],T.prototype,"applyDecalMapAfterDetailMap",void 0),(0,E.f)("BABYLON.PBRMaterial",T);var e=l(2299),i=l(814),D=l(730),B=l(794),P=l(809),G=l(465);class Q{get influence(){return this._influence}set influence(K){if(this._influence===K)return;const Y=this._influence;this._influence=K,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===Y||0===K)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}constructor(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=K,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new m.b,this._onDataLayoutChanged=new m.b,this._animationPropertiesOverride=null,this.id=K,this._scene=l||o.e.LastCreatedScene,this.influence=Y,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(K){const Y=this.hasPositions;this._positions=K,Y!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(K){const Y=this.hasNormals;this._normals=K,Y!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(K){const Y=this.hasTangents;this._tangents=K,Y!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(K){const Y=this.hasUVs;this._uvs=K,Y!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const K=y.c.Clone((()=>new Q(this.name,this.influence,this._scene)),this);return K._positions=this._positions,K._normals=this._normals,K._tangents=this._tangents,K._uvs=this._uvs,K}serialize(){const K={};return K.name=this.name,K.influence=this.influence,K.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(K.id=this.id),this.hasNormals&&(K.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(K.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(K.Aa=Array.prototype.slice.call(this.getUVs())),y.c.AppendSerializedAnimations(this,K),K}getClassName(){return"MorphTarget"}static Parse(K,Y){const l=new Q(K.name,K.influence);if(l.setPositions(K.xa),null!=K.id&&(l.id=K.id),K.ya&&l.setNormals(K.ya),K.tangents&&l.setTangents(K.tangents),K.Aa&&l.setUVs(K.Aa),K.animations){for(let Y=0;Y<K.animations.length;Y++){const v=K.animations[Y],U=(0,E.c)("BABYLON.Animation");U&&l.animations.push(U.Parse(v))}K.autoAnimate&&Y&&Y.beginAnimation(l,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1)}return l}static FromMesh(K,Y,l){Y||(Y=K.name);const v=new Q(Y,l,K.va());return v.setPositions(K.getVerticesData(D.e.PositionKind)),K.isVerticesDataPresent(D.e.NormalKind)&&v.setNormals(K.getVerticesData(D.e.NormalKind)),K.isVerticesDataPresent(D.e.TangentKind)&&v.setTangents(K.getVerticesData(D.e.TangentKind)),K.isVerticesDataPresent(D.e.UVKind)&&v.setUVs(K.getVerticesData(D.e.UVKind)),v}}(0,R.d)([(0,H.J)()],Q.prototype,"id",void 0);var X=l(668),f=l(12342);class w{set areUpdatesFrozen(K){K?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new X.c(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,K||(K=o.e.LastCreatedScene),this._scene=K,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const K=this._scene.getEngine().getCaps();this._canUseTextureForTargets=K.canUseGLVertexID&&K.textureFloat&&K.maxVertexTextureImageUnits>0&&K.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(K){this._numMaxInfluencers!==K&&(this._numMaxInfluencers=K,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(K){this._useTextureToStoreTargets=K}get isUsingTextureForTargets(){var K;return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(K=this._scene)&&void 0!==K&&K.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(K){return this._activeTargets.data[K]}getTarget(K){return this._targets[K]}getTargetByName(K){for(const Y of this._targets)if(Y.name===K)return Y;return null}addTarget(K){this._targets.push(K),this._targetInfluenceChangedObservers.push(K.onInfluenceChanged.add((K=>{this._syncActiveTargets(K)}))),this._targetDataLayoutChangedObservers.push(K._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(K){const Y=this._targets.indexOf(K);Y>=0&&(this._targets.splice(Y,1),K.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Y,1)[0]),K._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Y,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(K)}_bind(K){K.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),K.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),K.setTexture("morphTargets",this._targetStoreTexture),K.setInt("morphTargetCount",this.numInfluencers)}clone(){const K=new w(this._scene);for(const Y of this._targets)K.addTarget(Y.clone());return K.enableNormalMorphing=this.enableNormalMorphing,K.enableTangentMorphing=this.enableTangentMorphing,K.enableUVMorphing=this.enableUVMorphing,K}serialize(){const K={};K.id=this.uniqueId,K.targets=[];for(const Y of this._targets)K.targets.push(Y.serialize());return K}_syncActiveTargets(K){if(this.areUpdatesFrozen)return;let Y=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let l=-1;for(const v of this._targets){if(l++,0===v.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=w.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(v),this._morphTargetTextureIndices[Y]=l,this._tempInfluences[Y++]=v.influence,this._supportsNormals=this._supportsNormals&&v.hasNormals,this._supportsTangents=this._supportsTangents&&v.hasTangents,this._supportsUVs=this._supportsUVs&&v.hasUVs;const K=v.getPositions();if(K){const Y=K.length/3;if(0===this._vertexCount)this._vertexCount=Y;else if(this._vertexCount!==Y)return void W.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==Y&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Y)),this._influences&&this._influences.length===Y||(this._influences=new Float32Array(Y));for(let v=0;v<Y;v++)this._influences[v]=this._tempInfluences[v];K&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const K=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>K&&(this._textureHeight=Math.ceil(this._textureWidth/K),this._textureWidth=K);let Y=!0;if(this._targetStoreTexture){const K=this._targetStoreTexture.getSize();K.width===this._textureWidth&&K.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(Y=!1)}if(Y){this._targetStoreTexture&&this._targetStoreTexture.dispose();const K=this._targets.length,Y=new Float32Array(K*this._textureWidth*this._textureHeight*4);let l=0;for(let v=0;v<K;v++){const K=this._targets[v],U=K.getPositions(),d=K.getNormals(),A=K.getUVs(),c=K.getTangents();if(!U)return void(0===v&&W.e.Error("Invalid morph target. Target must have positions."));l=v*this._textureWidth*this._textureHeight*4;for(let v=0;v<this._vertexCount;v++)Y[l]=U[3*v],Y[l+1]=U[3*v+1],Y[l+2]=U[3*v+2],l+=4,this._supportsNormals&&d&&(Y[l]=d[3*v],Y[l+1]=d[3*v+1],Y[l+2]=d[3*v+2],l+=4),this._supportsUVs&&A&&(Y[l]=A[2*v],Y[l+1]=A[2*v+1],l+=4),this._supportsTangents&&c&&(Y[l]=c[3*v],Y[l+1]=c[3*v+1],Y[l+2]=c[3*v+2],l+=4)}this._targetStoreTexture=f.e.CreateRGBATexture(Y,this._textureWidth,this._textureHeight,K,this._scene,!1,!1,1,1)}}for(const K of this._scene.meshes)K.morphTargetManager===this&&K._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const K=this._parentContainer.morphTargetManagers.indexOf(this);K>-1&&this._parentContainer.morphTargetManagers.splice(K,1),this._parentContainer=null}for(const K of this._targets)this._scene.stopAnimation(K)}}static Parse(K,Y){const l=new w(Y);for(const v of K.targets)l.addTarget(Q.Parse(v,Y));return l}}w.EnableTextureStorage=!0,w.MaxActiveMorphTargetsInVertexAttributeMode=8;var k=l(12477),I=l(534),L=l(760);function a(K,Y,l,v){return U.o.yi(Y,l).scaleInPlace(v)}class F{constructor(K,Y,l,v){this.type=K,this.name=Y,this.getValue=l,this.getStride=v}_buildAnimation(K,Y,l){const v=new M.b(K,this.name,Y,this.type);return v.setKeys(l),v}}class s extends F{buildAnimations(K,Y,l,v,U){U(K._babylonTransformNode,this._buildAnimation(Y,l,v))}}const b={translation:[new s(M.b.ANIMATIONTYPE_VECTOR3,"position",a,(()=>3))],rotation:[new s(M.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(K,Y,l,v){return U.h.yi(Y,l).scaleInPlace(v)}),(()=>4))],scale:[new s(M.b.ANIMATIONTYPE_VECTOR3,"ni",a,(()=>3))],weights:[new class extends F{buildAnimations(K,Y,l,v,U){if(K._numMorphTargets)for(let d=0;d<K._numMorphTargets;d++){const A=new M.b(`${Y}_${d}`,this.name,l,this.type);if(A.setKeys(v.map((K=>({frame:K.frame,inTangent:K.inTangent?K.inTangent[d]:void 0,value:K.value[d],outTangent:K.outTangent?K.outTangent[d]:void 0,interpolation:K.interpolation})))),K._primitiveBabylonMeshes)for(const Y of K._primitiveBabylonMeshes)if(Y.morphTargetManager){const K=Y.morphTargetManager.getTarget(d),l=A.clone();K.animations.push(l),U(K,l)}}}}(M.b.ANIMATIONTYPE_FLOAT,"influence",(function(K,Y,l,v){const U=new Array(K._numMorphTargets);for(let d=0;d<U.length;d++)U[d]=Y[l++]*v;return U}),(K=>K._numMorphTargets))]},x=new Map,C=x;function N(K,Y,l){j(K)&&W.e.Warn(`Extension with the name '${K}' already exists`),x.set(K,{isGLTFExtension:Y,factory:l})}function j(K){return x.delete(K)}function p(){const K=K=>K&&"object"===typeof K;for(var Y=arguments.length,l=new Array(Y),v=0;v<Y;v++)l[v]=arguments[v];return l.reduce(((Y,l)=>(Object.keys(l).forEach((v=>{const U=Y[v],d=l[v];Array.isArray(U)&&Array.isArray(d)?Y[v]=U.concat(...d):K(U)&&K(d)?Y[v]=p(U,d):Y[v]=d})),Y)),{})}class S{static Get(K,Y,l){if(!Y||void 0==l||!Y[l])throw new Error(`${K}: Failed to find index (${l})`);return Y[l]}static TryGet(K,Y){return K&&void 0!=Y&&K[Y]?K[Y]:null}static Assign(K){if(K)for(let Y=0;Y<K.length;Y++)K[Y].index=Y}}class q{static RegisterExtension(K,Y){N(K,!1,Y)}static UnregisterExtension(K){return j(K)}get Al(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(K){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=K}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((K=>K.dispose&&K.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(K,Y,l,v,U,d){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=Y,this._assetContainer=l,this._loadData(v);let d=null;if(K){const Y={};if(this._gltf.nodes)for(const K of this._gltf.nodes)K.name&&(Y[K.name]=K.index);d=(K instanceof Array?K:[K]).map((K=>{const l=Y[K];if(void 0===l)throw new Error(`Failed to find node '${K}'`);return l}))}return this._loadAsync(U,A,d,(()=>({meshes:this._getMeshes(),qi:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=K,this._loadData(Y),this._loadAsync(l,U,null,(()=>{})))))}_loadAsync(K,Y,l,v){return Promise.resolve().then((async()=>{this._rootUrl=K,this._uniqueRootUrl=!K.startsWith("file:")&&Y?K:`${K}${Date.now()}/`,this._fileName=Y,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const U=`${k.h[k.h.LOADING]} => ${k.h[k.h.READY]}`,d=`${k.h[k.h.LOADING]} => ${k.h[k.h.COMPLETE]}`;this._parent._startPerformanceCounter(U),this._parent._startPerformanceCounter(d),this._parent._setState(k.h.LOADING),this._extensionsOnLoading();const c=new Array;if(!this.parent.loadOnlyMaterials)if(l)c.push(this.loadSceneAsync("/nodes",{nodes:l,index:-1}));else if(void 0!=this._gltf.hi||this._gltf.scenes&&this._gltf.scenes[0]){const K=S.Get("/scene",this._gltf.scenes,this._gltf.hi||0);c.push(this.loadSceneAsync(`/scenes/${K.index}`,K))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let K=0;K<this._gltf.materials.length;++K){const Y=this._gltf.materials[K],l="/materials/"+K,v=n.b.TriangleFillMode;c.push(this._loadMaterialAsync(l,Y,null,v,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&c.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&c.push(this._compileShadowGeneratorsAsync());return Promise.all(c).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.$h(!0),this._extensionsOnReady(),this._parent._setState(k.h.READY),this._startAnimations(),v()))).then((K=>(this._parent._endPerformanceCounter(U),A.d.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(d),this._parent._setState(k.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(K=>{this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()}))})),K)))})).catch((K=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()),K}))}_loadData(K){if(this._gltf=K.json,this._setupData(),K.bin){const Y=this._gltf.buffers;if(Y&&Y[0]&&!Y[0].uri){const l=Y[0];(l.byteLength<K.bin.byteLength-3||l.byteLength>K.bin.byteLength)&&W.e.Warn(`Binary buffer length (${l.byteLength}) from JSON does not match chunk length (${K.bin.byteLength})`),this._bin=K.bin}else W.e.Warn("Unexpected BIN chunk")}}_setupData(){if(S.Assign(this._gltf.accessors),S.Assign(this._gltf.animations),S.Assign(this._gltf.buffers),S.Assign(this._gltf.bufferViews),S.Assign(this._gltf.cameras),S.Assign(this._gltf.images),S.Assign(this._gltf.materials),S.Assign(this._gltf.meshes),S.Assign(this._gltf.nodes),S.Assign(this._gltf.samplers),S.Assign(this._gltf.scenes),S.Assign(this._gltf.skins),S.Assign(this._gltf.textures),this._gltf.nodes){const K={};for(const l of this._gltf.nodes)if(l.children)for(const Y of l.children)K[Y]=l.index;const Y=this._createRootNode();for(const l of this._gltf.nodes){const v=K[l.index];l.parent=void 0===v?Y:this._gltf.nodes[v]}}}async _loadExtensionsAsync(){const K=[];if(C.forEach(((Y,l)=>{var v;!1===(null===(v=this.parent.extensionOptions[l])||void 0===v?void 0:v.enabled)?Y.isGLTFExtension&&this.isExtensionUsed(l)&&W.e.Warn(`Extension ${l} is used but has been explicitly disabled.`):Y.isGLTFExtension&&!this.isExtensionUsed(l)||K.push((async()=>{const K=await Y.factory(this);return K.name!==l&&W.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${K.name} !== ${l}`),this._parent.onExtensionLoadedObservable.notifyObservers(K),K})())})),this._extensions.push(...await Promise.all(K)),this._extensions.sort(((K,Y)=>(K.order||Number.MAX_VALUE)-(Y.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const l of this._gltf.extensionsRequired){if(!this._extensions.some((K=>K.name===l&&K.enabled))){var Y;if(!1===(null===(Y=this.parent.extensionOptions[l])||void 0===Y?void 0:Y.enabled))throw new Error(`Required extension ${l} is disabled`);throw new Error(`Required extension ${l} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new G.e("__root__",this._babylonScene);this._rootBabylonMesh=K,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.$h(!1);const Y={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.g.AUTO:this._babylonScene.useRightHandedSystem||(Y.rotation=[0,1,0,0],Y.scale=[1,1,-1],q._LoadTransform(Y,this._rootBabylonMesh));break;case k.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(K),Y}loadSceneAsync(K,Y){const l=this._extensionsLoadSceneAsync(K,Y);if(l)return l;const v=new Array;if(this.logOpen(`${K} ${Y.name||""}`),Y.nodes)for(const U of Y.nodes){const Y=S.Get(`${K}/nodes/${U}`,this._gltf.nodes,U);v.push(this.loadNodeAsync(`/nodes/${Y.index}`,Y,(K=>{K.parent=this._rootBabylonMesh})))}for(const U of this._postSceneLoadActions)U();return v.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(v).then((()=>{}))}_forEachPrimitive(K,Y){if(K._primitiveBabylonMeshes)for(const l of K._primitiveBabylonMeshes)Y(l)}_getGeometries(){const K=[],Y=this._gltf.nodes;if(Y)for(const l of Y)this._forEachPrimitive(l,(Y=>{const l=Y.oi;l&&-1===K.indexOf(l)&&K.push(l)}));return K}_getMeshes(){const K=[];this._rootBabylonMesh instanceof P.b&&K.push(this._rootBabylonMesh);const Y=this._gltf.nodes;if(Y)for(const l of Y)this._forEachPrimitive(l,(Y=>{K.push(Y)}));return K}_getTransformNodes(){const K=[],Y=this._gltf.nodes;if(Y)for(const l of Y)l._babylonTransformNode&&"_i"===l._babylonTransformNode.getClassName()&&K.push(l._babylonTransformNode),l._babylonTransformNodeForSkin&&K.push(l._babylonTransformNodeForSkin);return K}_getSkeletons(){const K=[],Y=this._gltf.skins;if(Y)for(const l of Y)l._data&&K.push(l._data.babylonSkeleton);return K}_getAnimationGroups(){const K=[],Y=this._gltf.animations;if(Y)for(const l of Y)l._babylonAnimationGroup&&K.push(l._babylonAnimationGroup);return K}_startAnimations(){switch(this._parent.animationStartMode){case k.c.NONE:break;case k.c.FIRST:{const K=this._getAnimationGroups();0!==K.length&&K[0].start(!0);break}case k.c.ALL:{const K=this._getAnimationGroups();for(const Y of K)Y.start(!0);break}default:return void W.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadNodeAsync(K,Y,l);if(v)return v;if(Y._babylonTransformNode)throw new Error(`${K}: Invalid recursive node hierarchy`);const U=new Array;this.logOpen(`${K} ${Y.name||""}`);const d=v=>{if(q.AddPointerMetadata(v,K),q._LoadTransform(Y,v),void 0!=Y.camera){const l=S.Get(`${K}/camera`,this._gltf.cameras,Y.camera);U.push(this.loadCameraAsync(`/cameras/${l.index}`,l,(K=>{K.parent=v})))}if(Y.children)for(const l of Y.children){const Y=S.Get(`${K}/children/${l}`,this._gltf.nodes,l);U.push(this.loadNodeAsync(`/nodes/${Y.index}`,Y,(K=>{K.parent=v})))}l(v)},A=void 0!=Y.mesh,c=this._parent.loadSkins&&void 0!=Y.skin;if(!A||c){const K=Y.name||`node${Y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new i.b(K,this._babylonScene);l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Y.mesh?Y._babylonTransformNode=l:Y._babylonTransformNodeForSkin=l,d(l)}if(A)if(c){const l=S.Get(`${K}/mesh`,this._gltf.meshes,Y.mesh);U.push(this._loadMeshAsync(`/meshes/${l.index}`,Y,l,(l=>{const v=Y._babylonTransformNodeForSkin;l.metadata=p(v.metadata,l.metadata||{});const d=S.Get(`${K}/skin`,this._gltf.skins,Y.skin);U.push(this._loadSkinAsync(`/skins/${d.index}`,Y,d,(K=>{this._forEachPrimitive(Y,(Y=>{Y.skeleton=K})),this._postSceneLoadActions.push((()=>{if(void 0!=d.skeleton){const K=S.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;Y.index===K.index?l.parent=v.parent:l.parent=K._babylonTransformNode}else l.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:v,skinnedNode:l})}))})))})))}else{const l=S.Get(`${K}/mesh`,this._gltf.meshes,Y.mesh);U.push(this._loadMeshAsync(`/meshes/${l.index}`,Y,l,d))}return this.logClose(),Promise.all(U).then((()=>(this._forEachPrimitive(Y,(K=>{K.oi&&K.oi.useBoundingInfoFromGeometry?K.Ea():K.refreshBoundingInfo(!0,!0)})),Y._babylonTransformNode)))}_loadMeshAsync(K,Y,l,v){const U=l.primitives;if(!U||!U.length)throw new Error(`${K}: Primitives are missing`);void 0==U[0].index&&S.Assign(U);const d=new Array;this.logOpen(`${K} ${l.name||""}`);const A=Y.name||`node${Y.index}`;if(1===U.length){const v=l.primitives[0];d.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${v.index}`,A,Y,l,v,(K=>{Y._babylonTransformNode=K,Y._primitiveBabylonMeshes=[K]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Y._babylonTransformNode=new i.b(A,this._babylonScene),Y._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y._primitiveBabylonMeshes=[];for(const v of U)d.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${v.index}`,`${A}_primitive${v.index}`,Y,l,v,(K=>{K.parent=Y._babylonTransformNode,Y._primitiveBabylonMeshes.push(K)})))}return v(Y._babylonTransformNode),this.logClose(),Promise.all(d).then((()=>Y._babylonTransformNode))}_loadMeshPrimitiveAsync(K,Y,l,v,U,d){const A=this._extensionsLoadMeshPrimitiveAsync(K,Y,l,v,U,d);if(A)return A;this.logOpen(`${K}`);const c=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==l.skin&&!v.primitives[0].targets;let t,Z;if(c&&U._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,t=U._instanceData.babylonSourceMesh.createInstance(Y),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z=U._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new G.e(Y,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.sideOrientation=this._babylonScene.useRightHandedSystem?n.b.CounterClockWiseSideOrientation:n.b.ClockWiseSideOrientation,this._createMorphTargets(K,l,v,U,A),d.push(this._loadVertexDataAsync(K,U,A).then((Y=>this._loadMorphTargetsAsync(K,U,A,Y).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Y.Ca(A),Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const m=q._GetDrawMode(K,U.mode);if(void 0==U.material){let K=this._defaultBabylonMaterialData[m];K||(K=this._createDefaultMaterial("__GLTFLoader._default",m),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[m]=K),A.material=K}else if(!this.parent.skipMaterials){const Y=S.Get(`${K}/material`,this._gltf.materials,U.material);d.push(this._loadMaterialAsync(`/materials/${Y.index}`,Y,A,m,(K=>{A.material=K})))}Z=Promise.all(d),c&&(U._instanceData={babylonSourceMesh:A,promise:Z}),t=A}return q.AddPointerMetadata(t,K),this._parent.onMeshLoadedObservable.notifyObservers(t),d(t),this.logClose(),Z.then((()=>t))}_loadVertexDataAsync(K,Y,l){const v=this._extensionsLoadVertexDataAsync(K,Y,l);if(v)return v;const d=Y.attributes;if(!d)throw new Error(`${K}: Attributes are missing`);const A=new Array,c=new B.d(l.name,this._babylonScene);if(void 0==Y.indices)l.isUnIndexed=!0;else{const l=S.Get(`${K}/indices`,this._gltf.accessors,Y.indices);A.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then((K=>{c.setIndices(K)})))}const t=(Y,v,t)=>{if(void 0==d[Y])return;l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(v)&&l._delayInfo.push(v);const Z=S.Get(`${K}/attributes/${Y}`,this._gltf.accessors,d[Y]);A.push(this._loadVertexAccessorAsync(`/accessors/${Z.index}`,Z,v).then((K=>{if(K.getKind()===D.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!l.skeleton&&Z.min&&Z.max){const K=U.j.Qi[0].mi(...Z.min),Y=U.j.Qi[1].mi(...Z.max);if(Z.normalized&&5126!==Z.componentType){let l=1;switch(Z.componentType){case 5120:l=127;break;case 5121:l=255;break;case 5122:l=32767;break;case 5123:l=65535}const v=1/l;K.scaleInPlace(v),Y.scaleInPlace(v)}c._boundingInfo=new L.d(K,Y),c.useBoundingInfoFromGeometry=!0}c.setVerticesBuffer(K,Z.count)}))),v==D.e.MatricesIndicesExtraKind&&(l.numBoneInfluencers=8),t&&t(Z)};return t("POSITION",D.e.PositionKind),t("NORMAL",D.e.NormalKind),t("TANGENT",D.e.TangentKind),t("TEXCOORD_0",D.e.UVKind),t("TEXCOORD_1",D.e.UV2Kind),t("TEXCOORD_2",D.e.UV3Kind),t("TEXCOORD_3",D.e.UV4Kind),t("TEXCOORD_4",D.e.UV5Kind),t("TEXCOORD_5",D.e.UV6Kind),t("JOINTS_0",D.e.MatricesIndicesKind),t("WEIGHTS_0",D.e.MatricesWeightsKind),t("JOINTS_1",D.e.MatricesIndicesExtraKind),t("WEIGHTS_1",D.e.MatricesWeightsExtraKind),t("COLOR_0",D.e.ColorKind,(K=>{"VEC4"===K.type&&(l.hasVertexAlpha=!0)})),Promise.all(A).then((()=>c))}_createMorphTargets(K,Y,l,v,U){if(!v.targets||!this._parent.loadMorphTargets)return;if(void 0==Y._numMorphTargets)Y._numMorphTargets=v.targets.length;else if(v.targets.length!==Y._numMorphTargets)throw new Error(`${K}: Primitives do not have the same number of targets`);const d=l.extras?l.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,U.morphTargetManager=new w(this._babylonScene),U.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.morphTargetManager.areUpdatesFrozen=!0;for(let A=0;A<v.targets.length;A++){const K=Y.weights?Y.weights[A]:l.weights?l.weights[A]:0,v=d?d[A]:`morphTarget${A}`;U.morphTargetManager.addTarget(new Q(v,K,U.va()))}}_loadMorphTargetsAsync(K,Y,l,v){if(!Y.targets||!this._parent.loadMorphTargets)return Promise.resolve();const U=new Array,d=l.morphTargetManager;for(let A=0;A<d.numTargets;A++){const l=d.getTarget(A);U.push(this._loadMorphTargetVertexDataAsync(`${K}/targets/${A}`,v,Y.targets[A],l))}return Promise.all(U).then((()=>{d.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(K,Y,l,v){const U=new Array,d=(v,d,A)=>{if(void 0==l[v])return;const c=Y.getVertexBuffer(d);if(!c)return;const t=S.Get(`${K}/${v}`,this._gltf.accessors,l[v]);U.push(this._loadFloatAccessorAsync(`/accessors/${t.index}`,t).then((K=>{A(c,K)})))};return d("POSITION",D.e.PositionKind,((K,Y)=>{const l=new Float32Array(Y.length);K.forEach(Y.length,((K,v)=>{l[v]=Y[v]+K})),v.setPositions(l)})),d("NORMAL",D.e.NormalKind,((K,Y)=>{const l=new Float32Array(Y.length);K.forEach(l.length,((K,v)=>{l[v]=Y[v]+K})),v.setNormals(l)})),d("TANGENT",D.e.TangentKind,((K,Y)=>{const l=new Float32Array(Y.length/3*4);let U=0;K.forEach(Y.length/3*4,((K,v)=>{(v+1)%4!==0&&(l[U]=Y[U]+K,U++)})),v.setTangents(l)})),Promise.all(U).then((()=>{}))}static _LoadTransform(K,Y){if(void 0!=K.skin)return;let l=U.o.Zero(),v=U.h.Identity(),d=U.o.One();if(K.matrix){U.d.yi(K.matrix).decompose(d,v,l)}else K.translation&&(l=U.o.yi(K.translation)),K.rotation&&(v=U.h.yi(K.rotation)),K.scale&&(d=U.o.yi(K.scale));Y.position=l,Y.rotationQuaternion=v,Y.ni=d}_loadSkinAsync(K,Y,l,v){if(!this._parent.loadSkins)return Promise.resolve();const U=this._extensionsLoadSkinAsync(K,Y,l);if(U)return U;if(l._data)return v(l._data.babylonSkeleton),l._data.promise;const d=`skeleton${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new J(l.name||d,d,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(K,l,A);const c=this._loadSkinInverseBindMatricesDataAsync(K,l).then((K=>{this._updateBoneMatrices(A,K)}));return l._data={babylonSkeleton:A,promise:c},v(A),c}_loadBones(K,Y,l){if(void 0==Y.skeleton||this._parent.alwaysComputeSkeletonRootNode){const l=this._findSkeletonRootNode(`${K}/joints`,Y.joints);if(l)if(void 0===Y.skeleton)Y.skeleton=l.index;else{const v=(K,Y)=>{for(;Y.parent;Y=Y.parent)if(Y.parent===K)return!0;return!1},U=S.Get(`${K}/skeleton`,this._gltf.nodes,Y.skeleton);U===l||v(U,l)||(W.e.Warn(`${K}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Y.skeleton=l.index)}else W.e.Warn(`${K}: Failed to find common root`)}const v={};for(const U of Y.joints){const d=S.Get(`${K}/joints/${U}`,this._gltf.nodes,U);this._loadBone(d,Y,l,v)}}_findSkeletonRootNode(K,Y){if(0===Y.length)return null;const l={};for(const U of Y){const Y=[];let v=S.Get(`${K}/${U}`,this._gltf.nodes,U);for(;-1!==v.index;)Y.unshift(v),v=v.parent;l[U]=Y}let v=null;for(let U=0;;++U){let K=l[Y[0]];if(U>=K.length)return v;const d=K[U];for(let A=1;A<Y.length;++A)if(K=l[Y[A]],U>=K.length||d!==K[U])return v;v=d}}_loadBone(K,Y,l,v){K._isJoint=!0;let U=v[K.index];if(U)return U;let d=null;K.index!==Y.skeleton&&(K.parent&&-1!==K.parent.index?d=this._loadBone(K.parent,Y,l,v):void 0!==Y.skeleton&&W.e.Warn(`/skins/${Y.index}/skeleton: Skeleton node is not a common root`));const A=Y.joints.indexOf(K.index);return U=new Z.e(K.name||`joint${K.index}`,l,d,this._getNodeMatrix(K),null,null,A),v[K.index]=U,this._postSceneLoadActions.push((()=>{U.linkTransformNode(K._babylonTransformNode)})),U}_loadSkinInverseBindMatricesDataAsync(K,Y){if(void 0==Y.inverseBindMatrices)return Promise.resolve(null);const l=S.Get(`${K}/inverseBindMatrices`,this._gltf.accessors,Y.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${l.index}`,l)}_updateBoneMatrices(K,Y){for(const l of K.bones){const K=U.d.Identity(),v=l._index;Y&&-1!==v&&(U.d.FromArrayToRef(Y,16*v,K),K.invertToRef(K));const d=l.getParent();d&&K.multiplyToRef(d.getAbsoluteInverseBindMatrix(),K),l.Xi(K,!1,!1),l._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(K){return K.matrix?U.d.yi(K.matrix):U.d.Compose(K.scale?U.o.yi(K.scale):U.o.One(),K.rotation?U.h.yi(K.rotation):U.h.Identity(),K.translation?U.o.yi(K.translation):U.o.Zero())}loadCameraAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadCameraAsync(K,Y,l);if(v)return v;const d=new Array;this.logOpen(`${K} ${Y.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new t.e(Y.name||`camera${Y.index}`,U.o.Zero(),this._babylonScene,!1);switch(A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.ignoreParentScaling=!0,Y._babylonCamera=A,A.rotation.set(0,Math.PI,0),Y.type){case"perspective":{const l=Y.perspective;if(!l)throw new Error(`${K}: Camera perspective properties are missing`);A.fov=l.yfov,A.ti=l.znear,A.maxZ=l.zfar||0;break}case"orthographic":if(!Y.orthographic)throw new Error(`${K}: Camera orthographic properties are missing`);A.mode=c.c.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-Y.orthographic.xmag,A.orthoRight=Y.orthographic.xmag,A.orthoBottom=-Y.orthographic.ymag,A.orthoTop=Y.orthographic.ymag,A.ti=Y.orthographic.znear,A.maxZ=Y.orthographic.zfar;break;default:throw new Error(`${K}: Invalid camera type (${Y.type})`)}return q.AddPointerMetadata(A,K),this._parent.onCameraLoadedObservable.notifyObservers(A),l(A),this.logClose(),Promise.all(d).then((()=>A))}_loadAnimationsAsync(){const K=this._gltf.animations;if(!K)return Promise.resolve();const Y=new Array;for(let l=0;l<K.length;l++){const v=K[l];Y.push(this.loadAnimationAsync(`/animations/${v.index}`,v).then((K=>{0===K.targetedAnimations.length&&K.dispose()})))}return Promise.all(Y).then((()=>{}))}loadAnimationAsync(K,Y){const v=this._extensionsLoadAnimationAsync(K,Y);return v||l.e(48).then(l.bind(l,13435)).then((l=>{let{AnimationGroup:v}=l;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new v(Y.name||`animation${Y.index}`,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y._babylonAnimationGroup=U;const d=new Array;S.Assign(Y.channels),S.Assign(Y.samplers);for(const A of Y.channels)d.push(this._loadAnimationChannelAsync(`${K}/channels/${A.index}`,K,Y,A,((K,Y)=>{K.animations=K.animations||[],K.animations.push(Y),U.addTargetedAnimation(Y,K)})));return Promise.all(d).then((()=>(U.normalize(0),U)))}))}_loadAnimationChannelAsync(K,Y,l,v,U){const d=this._extensionsLoadAnimationChannelAsync(K,Y,l,v,U);if(d)return d;if(void 0==v.target.node)return Promise.resolve();const A=S.Get(`${K}/target/node`,this._gltf.nodes,v.target.node),c=v.target.path,t="weights"===c;if(t&&!A._numMorphTargets||!t&&!A._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!t&&!A._isJoint)return Promise.resolve();let Z;switch(c){case"translation":Z=b.translation;break;case"rotation":Z=b.rotation;break;case"scale":Z=b.scale;break;case"weights":Z=b.weights;break;default:throw new Error(`${K}/target/path: Invalid value (${v.target.path})`)}const m={object:A,info:Z};return this._loadAnimationChannelFromTargetInfoAsync(K,Y,l,v,m,U)}_loadAnimationChannelFromTargetInfoAsync(K,Y,l,v,U,d){const A=this.parent.targetFps,c=1/A,t=S.Get(`${K}/sampler`,l.samplers,v.sampler);return this._loadAnimationSamplerAsync(`${Y}/samplers/${v.sampler}`,t).then((K=>{let Y=0;const t=U.object,Z=U.info;for(const U of Z){const Z=U.getStride(t),m=K.input,V=K.output,M=new Array(m.length);let u=0;switch(K.interpolation){case"STEP":for(let K=0;K<m.length;K++){const Y=U.getValue(t,V,u,1);u+=Z,M[K]={frame:m[K]*A,value:Y,interpolation:1}}break;case"CUBICSPLINE":for(let K=0;K<m.length;K++){const Y=U.getValue(t,V,u,c);u+=Z;const l=U.getValue(t,V,u,1);u+=Z;const v=U.getValue(t,V,u,c);u+=Z,M[K]={frame:m[K]*A,inTangent:Y,value:l,outTangent:v}}break;case"LINEAR":for(let K=0;K<m.length;K++){const Y=U.getValue(t,V,u,1);u+=Z,M[K]={frame:m[K]*A,value:Y}}}if(u>0){const K=`${l.name||`animation${l.index}`}_channel${v.index}_${Y}`;U.buildAnimations(t,K,A,M,((K,l)=>{++Y,d(K,l)}))}}}))}_loadAnimationSamplerAsync(K,Y){if(Y._data)return Y._data;const l=Y.interpolation||"LINEAR";switch(l){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${K}/interpolation: Invalid value (${Y.interpolation})`)}const v=S.Get(`${K}/input`,this._gltf.accessors,Y.input),U=S.Get(`${K}/output`,this._gltf.accessors,Y.output);return Y._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${v.index}`,v),this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)]).then((K=>{let[Y,v]=K;return{input:Y,interpolation:l,output:v}})),Y._data}loadBufferAsync(K,Y,l,v){const U=this._extensionsLoadBufferAsync(K,Y,l,v);if(U)return U;if(!Y._data)if(Y.uri)Y._data=this.loadUriAsync(`${K}/uri`,Y,Y.uri);else{if(!this._bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);Y._data=this._bin.readAsync(0,Y.byteLength)}return Y._data.then((Y=>{try{return new Uint8Array(Y.buffer,Y.byteOffset+l,v)}catch(U){throw new Error(`${K}: ${U.message}`)}}))}loadBufferViewAsync(K,Y){const l=this._extensionsLoadBufferViewAsync(K,Y);if(l)return l;if(Y._data)return Y._data;const v=S.Get(`${K}/buffer`,this._gltf.buffers,Y.buffer);return Y._data=this.loadBufferAsync(`/buffers/${v.index}`,v,Y.byteOffset||0,Y.byteLength),Y._data}_loadAccessorAsync(K,Y,l){if(Y._data)return Y._data;const v=q._GetNumComponents(K,Y.type),U=v*D.e.GetTypeByteLength(Y.componentType),d=v*Y.count;if(void 0==Y.bufferView)Y._data=Promise.resolve(new l(d));else{const A=S.Get(`${K}/bufferView`,this._gltf.bufferViews,Y.bufferView);Y._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((c=>{if(5126!==Y.componentType||Y.normalized||A.byteStride&&A.byteStride!==U){const K=new l(d);return D.e.ForEach(c,Y.byteOffset||0,A.byteStride||U,v,Y.componentType,K.length,Y.normalized||!1,((Y,l)=>{K[l]=Y})),K}return q._GetTypedArray(K,Y.componentType,c,Y.byteOffset,d)}))}if(Y.sparse){const d=Y.sparse;Y._data=Y._data.then((A=>{const c=A,t=S.Get(`${K}/sparse/indices/bufferView`,this._gltf.bufferViews,d.indices.bufferView),Z=S.Get(`${K}/sparse/values/bufferView`,this._gltf.bufferViews,d.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${t.index}`,t),this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)]).then((A=>{let[t,Z]=A;const m=q._GetTypedArray(`${K}/sparse/indices`,d.indices.componentType,t,d.indices.byteOffset,d.count),V=v*d.count;let M;if(5126!==Y.componentType||Y.normalized){const A=q._GetTypedArray(`${K}/sparse/values`,Y.componentType,Z,d.values.byteOffset,V);M=new l(V),D.e.ForEach(A,0,U,v,Y.componentType,M.length,Y.normalized||!1,((K,Y)=>{M[Y]=K}))}else M=q._GetTypedArray(`${K}/sparse/values`,Y.componentType,Z,d.values.byteOffset,V);let u=0;for(let K=0;K<m.length;K++){let Y=m[K]*v;for(let K=0;K<v;K++)c[Y++]=M[u++]}return c}))}))}return Y._data}_loadFloatAccessorAsync(K,Y){return this._loadAccessorAsync(K,Y,Float32Array)}_loadIndicesAccessorAsync(K,Y){if("SCALAR"!==Y.type)throw new Error(`${K}/type: Invalid value ${Y.type}`);if(5121!==Y.componentType&&5123!==Y.componentType&&5125!==Y.componentType)throw new Error(`${K}/componentType: Invalid value ${Y.componentType}`);if(Y._data)return Y._data;if(Y.sparse){const l=q._GetTypedArrayConstructor(`${K}/componentType`,Y.componentType);Y._data=this._loadAccessorAsync(K,Y,l)}else{const l=S.Get(`${K}/bufferView`,this._gltf.bufferViews,Y.bufferView);Y._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((l=>q._GetTypedArray(K,Y.componentType,l,Y.byteOffset,Y.count)))}return Y._data}_loadVertexBufferViewAsync(K){if(K._babylonBuffer)return K._babylonBuffer;const Y=this._babylonScene.getEngine();return K._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>new D.b(Y,K,!1))),K._babylonBuffer}_loadVertexAccessorAsync(K,Y,l){var v;if(null!==(v=Y._babylonVertexBuffer)&&void 0!==v&&v[l])return Y._babylonVertexBuffer[l];Y._babylonVertexBuffer||(Y._babylonVertexBuffer={});const U=this._babylonScene.getEngine();if(Y.sparse||void 0==Y.bufferView)Y._babylonVertexBuffer[l]=this._loadFloatAccessorAsync(K,Y).then((K=>new D.e(U,K,l,!1)));else{const v=S.Get(`${K}/bufferView`,this._gltf.bufferViews,Y.bufferView);Y._babylonVertexBuffer[l]=this._loadVertexBufferViewAsync(v).then((d=>{const A=q._GetNumComponents(K,Y.type);return new D.e(U,d,l,!1,void 0,v.byteStride,void 0,Y.byteOffset,A,Y.componentType,Y.normalized,!0,void 0,!0)}))}return Y._babylonVertexBuffer[l]}_loadMaterialMetallicRoughnessPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return Y&&(Y.baseColorFactor?(l.albedoColor=d.e.yi(Y.baseColorFactor),l.alpha=Y.baseColorFactor[3]):l.albedoColor=d.e.White(),l.metallic=void 0==Y.metallicFactor?1:Y.metallicFactor,l.roughness=void 0==Y.roughnessFactor?1:Y.roughnessFactor,Y.baseColorTexture&&v.push(this.loadTextureInfoAsync(`${K}/baseColorTexture`,Y.baseColorTexture,(K=>{K.name=`${l.name} (Base Color)`,l.albedoTexture=K}))),Y.metallicRoughnessTexture&&(Y.metallicRoughnessTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${K}/metallicRoughnessTexture`,Y.metallicRoughnessTexture,(K=>{K.name=`${l.name} (Metallic Roughness)`,l.metallicTexture=K}))),l.useMetallnessFromMetallicTextureBlue=!0,l.useRoughnessFromMetallicTextureGreen=!0,l.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(v).then((()=>{}))}_loadMaterialAsync(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const d=this._extensionsLoadMaterialAsync(K,Y,l,v,U);if(d)return d;Y._data=Y._data||{};let A=Y._data[v];if(!A){this.logOpen(`${K} ${Y.name||""}`);const l=this.createMaterial(K,Y,v);A={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(K,Y,l)},Y._data[v]=A,q.AddPointerMetadata(l,K),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return l&&(A.babylonMeshes.push(l),l.Hi.addOnce((()=>{const K=A.babylonMeshes.indexOf(l);-1!==K&&A.babylonMeshes.splice(K,1)}))),U(A.babylonMaterial),A.promise.then((()=>A.babylonMaterial))}_createDefaultMaterial(K,Y){this._babylonScene._blockEntityCollection=!!this._assetContainer;const l=new T(K,this._babylonScene);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.fillMode=Y,l.enableSpecularAntiAliasing=!0,l.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,l.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,l.transparencyMode=T.PBRMATERIAL_OPAQUE,l.metallic=1,l.roughness=1,l}createMaterial(K,Y,l){const v=this._extensionsCreateMaterial(K,Y,l);if(v)return v;const U=Y.name||`material${Y.index}`;return this._createDefaultMaterial(U,l)}loadMaterialPropertiesAsync(K,Y,l){const v=this._extensionsLoadMaterialPropertiesAsync(K,Y,l);if(v)return v;const U=new Array;return U.push(this.loadMaterialBasePropertiesAsync(K,Y,l)),Y.pbrMetallicRoughness&&U.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${K}/pbrMetallicRoughness`,Y.pbrMetallicRoughness,l)),this.loadMaterialAlphaProperties(K,Y,l),Promise.all(U).then((()=>{}))}loadMaterialBasePropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.emissiveColor=Y.emissiveFactor?d.e.yi(Y.emissiveFactor):new d.e(0,0,0),Y.doubleSided&&(l.xi=!1,l.twoSidedLighting=!0),Y.normalTexture&&(Y.normalTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${K}/normalTexture`,Y.normalTexture,(K=>{K.name=`${l.name} (Normal)`,l.bumpTexture=K}))),l.invertNormalMapX=!this._babylonScene.useRightHandedSystem,l.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Y.normalTexture.scale&&l.bumpTexture&&(l.bumpTexture.level=Y.normalTexture.scale),l.forceIrradianceInFragment=!0),Y.occlusionTexture&&(Y.occlusionTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${K}/occlusionTexture`,Y.occlusionTexture,(K=>{K.name=`${l.name} (Occlusion)`,l.ambientTexture=K}))),l.useAmbientInGrayScale=!0,void 0!=Y.occlusionTexture.strength&&(l.ambientTextureStrength=Y.occlusionTexture.strength)),Y.emissiveTexture&&v.push(this.loadTextureInfoAsync(`${K}/emissiveTexture`,Y.emissiveTexture,(K=>{K.name=`${l.name} (Emissive)`,l.emissiveTexture=K}))),Promise.all(v).then((()=>{}))}loadMaterialAlphaProperties(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);switch(Y.alphaMode||"OPAQUE"){case"OPAQUE":l.transparencyMode=T.PBRMATERIAL_OPAQUE,l.alpha=1;break;case"MASK":l.transparencyMode=T.PBRMATERIAL_ALPHATEST,l.alphaCutOff=void 0==Y.alphaCutoff?.5:Y.alphaCutoff,l.albedoTexture&&(l.albedoTexture.Cj=!0);break;case"BLEND":l.transparencyMode=T.PBRMATERIAL_ALPHABLEND,l.albedoTexture&&(l.albedoTexture.Cj=!0,l.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${K}/alphaMode: Invalid value (${Y.alphaMode})`)}}loadTextureInfoAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureInfoAsync(K,Y,l);if(v)return v;if(this.logOpen(`${K}`),Y.texCoord>=6)throw new Error(`${K}/texCoord: Invalid value (${Y.texCoord})`);const U=S.Get(`${K}/index`,this._gltf.textures,Y.index);U._textureInfo=Y;const d=this._loadTextureAsync(`/textures/${Y.index}`,U,(v=>{v.coordinatesIndex=Y.texCoord||0,q.AddPointerMetadata(v,K),this._parent.onTextureLoadedObservable.notifyObservers(v),l(v)}));return this.logClose(),d}_loadTextureAsync(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureAsync(K,Y,l);if(v)return v;this.logOpen(`${K} ${Y.name||""}`);const U=void 0==Y.sampler?q.DefaultSampler:S.Get(`${K}/sampler`,this._gltf.samplers,Y.sampler),d=S.Get(`${K}/source`,this._gltf.images,Y.source),A=this._createTextureAsync(K,U,d,l,void 0,!Y._textureInfo.nonColorData);return this.logClose(),A}_createTextureAsync(K,Y,l){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},d=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const c=this._loadSampler(`/samplers/${Y.index}`,Y),t=new Array,Z=new v;this._babylonScene._blockEntityCollection=!!this._assetContainer;const m={noMipmap:c.noMipMaps,invertY:!1,samplingMode:c.samplingMode,X:()=>{this._disposed||Z.resolve()},onError:(Y,l)=>{this._disposed||Z.reject(new Error(`${K}: ${l&&l.message?l.message:Y||"Failed to load texture"}`))},mimeType:l.mimeType,loaderOptions:d,useSRGBBuffer:!!A&&this._parent.useSRGBBuffers},V=new e.c(null,this._babylonScene,m);return V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.push(Z.promise),t.push(this.loadImageAsync(`/images/${l.index}`,l).then((K=>{const Y=l.uri||`${this._fileName}#image${l.index}`,v=`data:${this._uniqueRootUrl}${Y}`;V.updateURL(v,K);const U=V.getInternalTexture();U&&(U.label=l.name)}))),V.wrapU=c.wrapU,V.wrapV=c.wrapV,U(V),this._parent.useGltfTextureNames&&(V.name=l.name||l.uri||`image${l.index}`),Promise.all(t).then((()=>V))}_loadSampler(K,Y){return Y._data||(Y._data={noMipMaps:9728===Y.minFilter||9729===Y.minFilter,samplingMode:q._GetTextureSamplingMode(K,Y),wrapU:q._GetTextureWrapMode(`${K}/wrapS`,Y.wrapS),wrapV:q._GetTextureWrapMode(`${K}/wrapT`,Y.wrapT)}),Y._data}loadImageAsync(K,Y){if(!Y._data){if(this.logOpen(`${K} ${Y.name||""}`),Y.uri)Y._data=this.loadUriAsync(`${K}/uri`,Y,Y.uri);else{const l=S.Get(`${K}/bufferView`,this._gltf.bufferViews,Y.bufferView);Y._data=this.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}this.logClose()}return Y._data}loadUriAsync(K,Y,l){const v=this._extensionsLoadUriAsync(K,Y,l);if(v)return v;if(!q._ValidateUri(l))throw new Error(`${K}: '${l}' is invalid`);if((0,I.f)(l)){const Y=new Uint8Array((0,I.d)(l));return this.log(`${K}: Decoded ${l.substring(0,64)}... (${Y.length} bytes)`),Promise.resolve(Y)}return this.log(`${K}: Loading ${l}`),this._parent.preprocessUrlAsync(this._rootUrl+l).then((Y=>new Promise(((v,U)=>{this._parent._loadFile(this._babylonScene,Y,(Y=>{this._disposed||(this.log(`${K}: Loaded ${l} (${Y.byteLength} bytes)`),v(new Uint8Array(Y)))}),!0,(Y=>{U(new I.i(`${K}: Failed to load '${l}'${Y?": "+Y.status+" "+Y.statusText:""}`,Y))}))}))))}static AddPointerMetadata(K,Y){K.metadata=K.metadata||{};const l=K._internalMetadata=K._internalMetadata||{},v=l.Al=l.Al||{};(v.pointers=v.pointers||[]).push(Y)}static _GetTextureWrapMode(K,Y){switch(Y=void 0==Y?10497:Y){case 33071:return e.c.CLAMP_ADDRESSMODE;case 33648:return e.c.MIRROR_ADDRESSMODE;case 10497:return e.c.WRAP_ADDRESSMODE;default:return W.e.Warn(`${K}: Invalid value (${Y})`),e.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(K,Y){const l=void 0==Y.magFilter?9729:Y.magFilter,v=void 0==Y.minFilter?9987:Y.minFilter;if(9729===l)switch(v){case 9728:return e.c.LINEAR_NEAREST;case 9729:return e.c.LINEAR_LINEAR;case 9984:return e.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return e.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return e.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return e.c.LINEAR_LINEAR_MIPLINEAR;default:return W.e.Warn(`${K}/minFilter: Invalid value (${v})`),e.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==l&&W.e.Warn(`${K}/magFilter: Invalid value (${l})`),v){case 9728:return e.c.NEAREST_NEAREST;case 9729:return e.c.NEAREST_LINEAR;case 9984:return e.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return e.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return e.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return e.c.NEAREST_LINEAR_MIPLINEAR;default:return W.e.Warn(`${K}/minFilter: Invalid value (${v})`),e.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(K,Y){switch(Y){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${K}: Invalid component type ${Y}`)}}static _GetTypedArray(K,Y,l,v,U){const d=l.buffer;v=l.byteOffset+(v||0);const A=q._GetTypedArrayConstructor(`${K}/componentType`,Y),c=D.e.GetTypeByteLength(Y);return v%c!==0?(W.e.Warn(`${K}: Copying buffer as byte offset (${v}) is not a multiple of component type byte length (${c})`),new A(d.slice(v,v+U*c),0)):new A(d,v,U)}static _GetNumComponents(K,Y){switch(Y){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${K}: Invalid type (${Y})`)}static _ValidateUri(K){return A.d.IsBase64(K)||-1===K.indexOf("..")}static _GetDrawMode(K,Y){switch(void 0==Y&&(Y=4),Y){case 0:return n.b.PointListDrawMode;case 1:return n.b.LineListDrawMode;case 2:return n.b.LineLoopDrawMode;case 3:return n.b.LineStripDrawMode;case 4:return n.b.TriangleFillMode;case 5:return n.b.TriangleStripDrawMode;case 6:return n.b.TriangleFanDrawMode}throw new Error(`${K}: Invalid mesh primitive mode (${Y})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const K=new Array;if(this._gltf.materials)for(const Y of this._gltf.materials)if(Y._data)for(const l in Y._data){const v=Y._data[l];for(const Y of v.babylonMeshes){Y.ri(!0);const l=v.babylonMaterial;K.push(l.forceCompilationAsync(Y)),K.push(l.forceCompilationAsync(Y,{useInstances:!0})),this._parent.useClipPlane&&(K.push(l.forceCompilationAsync(Y,{clipPlane:!0})),K.push(l.forceCompilationAsync(Y,{clipPlane:!0,useInstances:!0})))}}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const K=new Array,Y=this._babylonScene.lights;for(const l of Y){const Y=l.getShadowGenerator();Y&&K.push(Y.forceCompilationAsync())}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(K){for(const Y of this._extensions)Y.enabled&&K(Y)}_applyExtensions(K,Y,l){for(const v of this._extensions)if(v.enabled){const U=`${v.name}.${Y}`,d=K;d._activeLoaderExtensionFunctions=d._activeLoaderExtensionFunctions||{};const A=d._activeLoaderExtensionFunctions;if(!A[U]){A[U]=!0;try{const K=l(v);if(K)return K}finally{delete A[U]}}}return null}_extensionsOnLoading(){this._forEachExtensions((K=>K.onLoading&&K.onLoading()))}_extensionsOnReady(){this._forEachExtensions((K=>K.onReady&&K.onReady()))}_extensionsLoadSceneAsync(K,Y){return this._applyExtensions(Y,"loadScene",(l=>l.loadSceneAsync&&l.loadSceneAsync(K,Y)))}_extensionsLoadNodeAsync(K,Y,l){return this._applyExtensions(Y,"loadNode",(v=>v.loadNodeAsync&&v.loadNodeAsync(K,Y,l)))}_extensionsLoadCameraAsync(K,Y,l){return this._applyExtensions(Y,"loadCamera",(v=>v.loadCameraAsync&&v.loadCameraAsync(K,Y,l)))}_extensionsLoadVertexDataAsync(K,Y,l){return this._applyExtensions(Y,"loadVertexData",(v=>v._loadVertexDataAsync&&v._loadVertexDataAsync(K,Y,l)))}_extensionsLoadMeshPrimitiveAsync(K,Y,l,v,U,d){return this._applyExtensions(U,"loadMeshPrimitive",(A=>A._loadMeshPrimitiveAsync&&A._loadMeshPrimitiveAsync(K,Y,l,v,U,d)))}_extensionsLoadMaterialAsync(K,Y,l,v,U){return this._applyExtensions(Y,"loadMaterial",(d=>d._loadMaterialAsync&&d._loadMaterialAsync(K,Y,l,v,U)))}_extensionsCreateMaterial(K,Y,l){return this._applyExtensions(Y,"createMaterial",(v=>v.createMaterial&&v.createMaterial(K,Y,l)))}_extensionsLoadMaterialPropertiesAsync(K,Y,l){return this._applyExtensions(Y,"loadMaterialProperties",(v=>v.loadMaterialPropertiesAsync&&v.loadMaterialPropertiesAsync(K,Y,l)))}_extensionsLoadTextureInfoAsync(K,Y,l){return this._applyExtensions(Y,"loadTextureInfo",(v=>v.loadTextureInfoAsync&&v.loadTextureInfoAsync(K,Y,l)))}_extensionsLoadTextureAsync(K,Y,l){return this._applyExtensions(Y,"loadTexture",(v=>v._loadTextureAsync&&v._loadTextureAsync(K,Y,l)))}_extensionsLoadAnimationAsync(K,Y){return this._applyExtensions(Y,"loadAnimation",(l=>l.loadAnimationAsync&&l.loadAnimationAsync(K,Y)))}_extensionsLoadAnimationChannelAsync(K,Y,l,v,U){return this._applyExtensions(l,"loadAnimationChannel",(d=>d._loadAnimationChannelAsync&&d._loadAnimationChannelAsync(K,Y,l,v,U)))}_extensionsLoadSkinAsync(K,Y,l){return this._applyExtensions(l,"loadSkin",(v=>v._loadSkinAsync&&v._loadSkinAsync(K,Y,l)))}_extensionsLoadUriAsync(K,Y,l){return this._applyExtensions(Y,"loadUri",(v=>v._loadUriAsync&&v._loadUriAsync(K,Y,l)))}_extensionsLoadBufferViewAsync(K,Y){return this._applyExtensions(Y,"loadBufferView",(l=>l.loadBufferViewAsync&&l.loadBufferViewAsync(K,Y)))}_extensionsLoadBufferAsync(K,Y,l,v){return this._applyExtensions(Y,"loadBuffer",(U=>U.loadBufferAsync&&U.loadBufferAsync(K,Y,l,v)))}static LoadExtensionAsync(K,Y,l,v){if(!Y.extensions)return null;const U=Y.extensions[l];return U?v(`${K}/extensions/${l}`,U):null}static LoadExtraAsync(K,Y,l,v){if(!Y.extras)return null;const U=Y.extras[l];return U?v(`${K}/extras/${l}`,U):null}isExtensionUsed(K){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(K)}logOpen(K){this._parent._logOpen(K)}logClose(){this._parent._logClose()}log(K){this._parent._log(K)}startPerformanceCounter(K){this._parent._startPerformanceCounter(K)}endPerformanceCounter(K){this._parent._endPerformanceCounter(K)}}q.DefaultSampler={index:-1},k.b._CreateGLTF2Loader=K=>new q(K);var O=l(2259),h=l(2360),KK=l(12497);class YK extends KK.d{constructor(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",K),this._texture=K.getEngine().createRawCubeTexture(Y,l,v,U,d,A,c,t)}update(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,K,Y,l,v,U)}updateRGBDAsync(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,h.i)(this._texture,K,Y,l,v).then((()=>{}))}clone(){return y.c.Clone((()=>{const K=this.va(),Y=this._texture,l=new YK(K,Y._bufferViewArray,Y.width,Y.format,Y.type,Y.generateMipMaps,Y.invertY,Y.samplingMode,Y._compression);return 13===Y.source&&l.updateRGBDAsync(Y._bufferViewArrayArray,Y._sphericalPolynomial,Y._lodGenerationScale,Y._lodGenerationOffset),l}),this)}}const lK="EXT_lights_image_based";class vK{constructor(K){this.name=lK,this._loader=K,this.enabled=this._loader.isExtensionUsed(lK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.Al.extensions;if(K&&K[this.name]){const Y=K[this.name];this._lights=Y.lights}}loadSceneAsync(K,Y){return q.LoadExtensionAsync(K,Y,this.name,((l,v)=>{this._loader._allMaterialsDirtyRequired=!0;const U=new Array;U.push(this._loader.loadSceneAsync(K,Y)),this._loader.logOpen(`${l}`);const d=S.Get(`${l}/light`,this._lights,v.ab);return U.push(this._loadLightAsync(`/extensions/${this.name}/lights/${v.ab}`,d).then((K=>{this._loader.babylonScene.environmentTexture=K}))),this._loader.logClose(),Promise.all(U).then((()=>{}))}))}_loadLightAsync(K,Y){if(!Y._loaded){const l=new Array;this._loader.logOpen(`${K}`);const v=new Array(Y.specularImages.length);for(let U=0;U<Y.specularImages.length;U++){const d=Y.specularImages[U];v[U]=new Array(d.length);for(let Y=0;Y<d.length;Y++){const A=`${K}/specularImages/${U}/${Y}`;this._loader.logOpen(`${A}`);const c=d[Y],t=S.Get(A,this._loader.Al.images,c);l.push(this._loader.loadImageAsync(`/images/${c}`,t).then((K=>{v[U][Y]=K}))),this._loader.logClose()}}this._loader.logClose(),Y._loaded=Promise.all(l).then((()=>{const l=new YK(this._loader.babylonScene,null,Y.specularImageSize);if(l.name=Y.name||"environment",Y._babylonTexture=l,void 0!=Y.Kl&&(l.level=Y.Kl),Y.rotation){let K=U.h.yi(Y.rotation);this._loader.babylonScene.useRightHandedSystem||(K=U.h.Inverse(K)),U.d.FromQuaternionToRef(K,l.getReflectionTextureMatrix())}if(!Y.irradianceCoefficients)throw new Error(`${K}: Irradiance coefficients are missing`);const d=O.c.yi(Y.irradianceCoefficients);d.scaleInPlace(Y.Kl),d.convertIrradianceToLambertianRadiance();const A=O.f.FromHarmonics(d),c=(v.length-1)/Math.log2(Y.specularImageSize);return l.updateRGBDAsync(v,A,c)}))}return Y._loaded.then((()=>Y._babylonTexture))}}j(lK),N(lK,!0,(K=>new vK(K)));l(869);const UK="EXT_mesh_gpu_instancing";class dK{constructor(K){this.name=UK,this._loader=K,this.enabled=this._loader.isExtensionUsed(UK)}dispose(){this._loader=null}loadNodeAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((K,v)=>{this._loader._disableInstancedMesh++;const d=this._loader.loadNodeAsync(`/nodes/${Y.index}`,Y,l);if(this._loader._disableInstancedMesh--,!Y._primitiveBabylonMeshes)return d;const A=new Array;let c=0;const t=Y=>{if(void 0==v.attributes[Y])return void A.push(Promise.resolve(null));const l=S.Get(`${K}/attributes/${Y}`,this._loader.Al.accessors,v.attributes[Y]);if(A.push(this._loader._loadFloatAccessorAsync(`/accessors/${l.bufferView}`,l)),0===c)c=l.count;else if(c!==l.count)throw new Error(`${K}/attributes: Instance buffer accessors do not have the same count.`)};return t("TRANSLATION"),t("ROTATION"),t("SCALE"),d.then((K=>Promise.all(A).then((l=>{let[v,d,A]=l;const t=new Float32Array(16*c);U.j.Qi[0].mi(0,0,0),U.j.Quaternion[0].mi(0,0,0,1),U.j.Qi[1].mi(1,1,1);for(let K=0;K<c;++K)v&&U.o.FromArrayToRef(v,3*K,U.j.Qi[0]),d&&U.h.FromArrayToRef(d,4*K,U.j.Quaternion[0]),A&&U.o.FromArrayToRef(A,3*K,U.j.Qi[1]),U.d.ComposeToRef(U.j.Qi[1],U.j.Quaternion[0],U.j.Qi[0],U.j.Matrix[0]),U.j.Matrix[0].copyToArray(t,16*K);for(const K of Y._primitiveBabylonMeshes)K._h("matrix",t,16,!0);return K}))))}))}}j(UK),N(UK,!0,(K=>new dK(K)));class AK{static get Default(){return AK._Default||(AK._Default=new AK),AK._Default}constructor(){const K=AK.Configuration.decoder;this._decoderModulePromise=A.d.LoadBabylonScriptAsync(K.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(K,Y,l,v,U){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const d=await MeshoptDecoder.decodeGltfBufferAsync(Y,l,K,v,U);return MeshoptDecoder.useWorkers(0),d}))}}AK.Configuration={decoder:{url:`${A.d._DefaultCdnUrl}/meshopt_decoder.js`}},AK._Default=null;const cK="EXT_meshopt_compression";class tK{constructor(K){this.name=cK,this.enabled=K.isExtensionUsed(cK),this._loader=K}dispose(){this._loader=null}loadBufferViewAsync(K,Y){return q.LoadExtensionAsync(K,Y,this.name,((l,v)=>{const U=Y;if(U._meshOptData)return U._meshOptData;const d=S.Get(`${K}/buffer`,this._loader.Al.buffers,v.buffer);return U._meshOptData=this._loader.loadBufferAsync(`/buffers/${d.index}`,d,v.byteOffset||0,v.byteLength).then((K=>AK.Default.decodeGltfBufferAsync(K,v.count,v.byteStride,v.mode,v.filter))),U._meshOptData}))}}j(cK),N(cK,!0,(K=>new tK(K)));const ZK="EXT_texture_webp";class mK{constructor(K){this.name=ZK,this._loader=K,this.enabled=K.isExtensionUsed(ZK)}dispose(){this._loader=null}_loadTextureAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=void 0==Y.sampler?q.DefaultSampler:S.Get(`${K}/sampler`,this._loader.Al.samplers,Y.sampler),A=S.Get(`${v}/source`,this._loader.Al.images,U.source);return this._loader._createTextureAsync(K,d,A,(K=>{l(K)}),void 0,!Y._textureInfo.nonColorData)}))}}j(ZK),N(ZK,!0,(K=>new mK(K)));const VK="EXT_texture_avif";class MK{constructor(K){this.name=VK,this._loader=K,this.enabled=K.isExtensionUsed(VK)}dispose(){this._loader=null}_loadTextureAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=void 0==Y.sampler?q.DefaultSampler:S.Get(`${K}/sampler`,this._loader.Al.samplers,Y.sampler),A=S.Get(`${v}/source`,this._loader.Al.images,U.source);return this._loader._createTextureAsync(K,d,A,(K=>{l(K)}),void 0,!Y._textureInfo.nonColorData)}))}}j(VK),N(VK,!0,(K=>new MK(K)));var uK=l(12499);const oK="KHR_draco_mesh_compression";class WK{constructor(K){this.name=oK,this.useNormalizedFlagFromAccessor=!0,this._loader=K,this.enabled=uK.e.DecoderAvailable&&this._loader.isExtensionUsed(oK)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{if(void 0!=Y.mode&&4!==Y.mode&&5!==Y.mode)throw new Error(`${K}: Unsupported mode ${Y.mode}`);const d={},A={},c=(K,v)=>{const c=U.attributes[K];if(void 0!=c&&(l._delayInfo=l._delayInfo||[],-1===l._delayInfo.indexOf(v)&&l._delayInfo.push(v),d[v]=c,this.useNormalizedFlagFromAccessor)){const l=S.TryGet(this._loader.Al.accessors,Y.attributes[K]);l&&(A[v]=l.normalized||!1)}};c("POSITION",D.e.PositionKind),c("NORMAL",D.e.NormalKind),c("TANGENT",D.e.TangentKind),c("TEXCOORD_0",D.e.UVKind),c("TEXCOORD_1",D.e.UV2Kind),c("TEXCOORD_2",D.e.UV3Kind),c("TEXCOORD_3",D.e.UV4Kind),c("TEXCOORD_4",D.e.UV5Kind),c("TEXCOORD_5",D.e.UV6Kind),c("JOINTS_0",D.e.MatricesIndicesKind),c("WEIGHTS_0",D.e.MatricesWeightsKind),c("COLOR_0",D.e.ColorKind);const t=S.Get(v,this._loader.Al.bufferViews,U.bufferView);return t._dracoBabylonGeometry||(t._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((Y=>(this.dracoCompression||uK.e.Default)._decodeMeshToGeometryForGltfAsync(l.name,this._loader.babylonScene,Y,d,A).catch((Y=>{throw new Error(`${K}: ${Y.message}`)}))))),t._dracoBabylonGeometry}))}}j(oK),N(oK,!0,(K=>new WK(K)));var gK=l(12504),JK=l(699),nK=l(12484),RK=l(12506);JK.b.AddNodeConstructor("Light_Type_0",((K,Y)=>()=>new HK(K,U.o.Zero(),Y)));class HK extends RK.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(K){this._shadowAngle=K,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(K){const Y=this.needCube();if(this._direction=K,this.needCube()!==Y&&this._shadowGenerators){const K=this._shadowGenerators.values();for(let Y=K.next();!0!==Y.done;Y=K.next()){Y.value.recreateShadowMap()}}}constructor(K,Y,l){super(K,l),this._shadowAngle=Math.PI/2,this.position=Y}getClassName(){return"PointLight"}getTypeID(){return nK.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(K){if(this.direction)return super.getShadowDirection(K);switch(K){case 0:return new U.o(1,0,0);case 1:return new U.o(-1,0,0);case 2:return new U.o(0,-1,0);case 3:return new U.o(0,1,0);case 4:return new U.o(0,0,1);case 5:return new U.o(0,0,-1)}return U.o.Zero()}_setDefaultShadowProjectionMatrix(K,Y,l){const v=this.va().activeCamera;if(!v)return;const d=void 0!==this.shadowMinZ?this.shadowMinZ:v.ti,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,c=this.va().getEngine().useReverseDepthBuffer;U.d.PerspectiveFovLHToRef(this.shadowAngle,1,c?A:d,c?d:A,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,c)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,Y){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Y):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Y),this}transferToNodeMaterialEffect(K,Y){return this.computeTransformedInformation()?K.setFloat3(Y,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):K.setFloat3(Y,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(K,Y){K["POINTLIGHT"+Y]=!0}}(0,R.d)([(0,H.J)()],HK.prototype,"shadowAngle",null),(0,E.f)("BABYLON.PointLight",HK),JK.b.AddNodeConstructor("Light_Type_2",((K,Y)=>()=>new zK(K,U.o.Zero(),U.o.Zero(),0,0,Y)));class zK extends RK.b{get angle(){return this._angle}set angle(K){this._angle=K,this._cosHalfAngle=Math.cos(.5*K),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(K){this._innerAngle=K,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(K){this._shadowAngleScale=K,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(K){this._projectionTextureLightNear=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(K){this._projectionTextureLightFar=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(K){this._projectionTextureUpDirection=K,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(K){this._projectionTexture!==K&&(this._projectionTexture=K,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(zK._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):zK._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(K){return void 0!==K.onGeneratedObservable}static _IsTexture(K){return void 0!==K.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(K){this._projectionTextureProjectionLightMatrix=K,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(K,Y,l,v,d,A){super(K,A),this._innerAngle=0,this._projectionTextureMatrix=U.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=U.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=U.o.Zero(),this._projectionTextureViewLightMatrix=U.d.Zero(),this._projectionTextureProjectionLightMatrix=U.d.Zero(),this._projectionTextureScalingMatrix=U.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Y,this.direction=l,this.angle=v,this.exponent=d}getClassName(){return"SpotLight"}getTypeID(){return nK.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(K){super._setDirection(K),this._projectionTextureViewLightDirty=!0}_setPosition(K){super._setPosition(K),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(K,Y,l){const v=this.va().activeCamera;if(!v)return;this._shadowAngleScale=this._shadowAngleScale||1;const d=this._shadowAngleScale*this._angle,A=void 0!==this.shadowMinZ?this.shadowMinZ:v.ti,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,t=this.va().getEngine().useReverseDepthBuffer;U.d.PerspectiveFovLHToRef(d,1,t?c:A,t?A:c,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),U.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const K=this.projectionTextureLightFar,Y=this.projectionTextureLightNear,l=K/(K-Y),v=-l*Y,d=1/Math.tan(this._angle/2);U.d.FromValuesToRef(d/1,0,0,0,0,d,0,0,0,0,l,1,0,0,v,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof e.c){const K=this._projectionTexture.uScale/2,Y=this._projectionTexture.vScale/2;U.d.FromValuesToRef(K,0,0,0,0,Y,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(K,Y){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),K.setMatrix("textureProjectionMatrix"+Y,this._projectionTextureMatrix),K.setTexture("projectionLightTexture"+Y,this.projectionTexture)),this}transferToEffect(K,Y){let l;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Y),l=U.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Y),l=U.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",l.x,l.y,l.z,this._cosHalfAngle,Y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Y),this}transferToNodeMaterialEffect(K,Y){let l;return l=this.computeTransformedInformation()?U.o.Normalize(this.transformedDirection):U.o.Normalize(this.direction),this.va().useRightHandedSystem?K.setFloat3(Y,-l.x,-l.y,-l.z):K.setFloat3(Y,l.x,l.y,l.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(K){const Y=this._scene.getEngine(),l=void 0!==this.shadowMinZ?this.shadowMinZ:K.ti;return Y.useReverseDepthBuffer&&Y.isNDCHalfZRange?l:this._scene.getEngine().isNDCHalfZRange?0:l}getDepthMaxZ(K){const Y=this._scene.getEngine(),l=void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ;return Y.useReverseDepthBuffer&&Y.isNDCHalfZRange?0:l}prepareLightSpecificDefines(K,Y){K["SPOTLIGHT"+Y]=!0,K["PROJECTEDLIGHTTEXTURE"+Y]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,R.d)([(0,H.J)()],zK.prototype,"angle",null),(0,R.d)([(0,H.J)()],zK.prototype,"innerAngle",null),(0,R.d)([(0,H.J)()],zK.prototype,"shadowAngleScale",null),(0,R.d)([(0,H.J)()],zK.prototype,"exponent",void 0),(0,R.d)([(0,H.J)()],zK.prototype,"projectionTextureLightNear",null),(0,R.d)([(0,H.J)()],zK.prototype,"projectionTextureLightFar",null),(0,R.d)([(0,H.J)()],zK.prototype,"projectionTextureUpDirection",null),(0,R.d)([(0,H.C)("projectedLightTexture")],zK.prototype,"_projectionTexture",void 0),(0,E.f)("BABYLON.SpotLight",zK);const rK="KHR_lights_punctual";class EK{constructor(K){this.name=rK,this._loader=K,this.enabled=this._loader.isExtensionUsed(rK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.Al.extensions;if(K&&K[this.name]){const Y=K[this.name];this._lights=Y.lights,S.Assign(this._lights)}}loadNodeAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,A)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(K,Y,(K=>{let Y;const c=S.Get(v,this._lights,A.ab),t=c.name||K.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,c.type){case"directional":{const K=new gK.b(t,U.o.Backward(),this._loader.babylonScene);K.position.li(0),Y=K;break}case"point":Y=new HK(t,U.o.Zero(),this._loader.babylonScene);break;case"spot":{const K=new zK(t,U.o.Zero(),U.o.Backward(),0,1,this._loader.babylonScene);K.angle=2*(c.spot&&c.spot.outerConeAngle||Math.PI/4),K.innerAngle=2*(c.spot&&c.spot.innerConeAngle||0),Y=K;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${v}: Invalid light type (${c.type})`)}Y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,c._babylonLight=Y,Y.falloffType=nK.c.FALLOFF_GLTF,Y.Rk=c.color?d.e.yi(c.color):d.e.White(),Y.Kl=void 0==c.Kl?1:c.Kl,Y.range=void 0==c.range?Number.MAX_VALUE:c.range,Y.parent=K,this._loader._babylonLights.push(Y),q.AddPointerMetadata(Y,v),l(K)})))))}}j(rK),N(rK,!0,(K=>new EK(K)));const yK="KHR_materials_pbrSpecularGlossiness";class TK{constructor(K){this.name=yK,this.order=200,this._loader=K,this.enabled=this._loader.isExtensionUsed(yK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialBasePropertiesAsync(K,Y,l)),d.push(this._loadSpecularGlossinessPropertiesAsync(v,U,l)),this._loader.loadMaterialAlphaProperties(K,Y,l),Promise.all(d).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.metallic=null,l.roughness=null,Y.diffuseFactor?(l.albedoColor=d.e.yi(Y.diffuseFactor),l.alpha=Y.diffuseFactor[3]):l.albedoColor=d.e.White(),l.reflectivityColor=Y.specularFactor?d.e.yi(Y.specularFactor):d.e.White(),l.microSurface=void 0==Y.glossinessFactor?1:Y.glossinessFactor,Y.diffuseTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTexture`,Y.diffuseTexture,(K=>{K.name=`${l.name} (Diffuse)`,l.albedoTexture=K}))),Y.specularGlossinessTexture&&(v.push(this._loader.loadTextureInfoAsync(`${K}/specularGlossinessTexture`,Y.specularGlossinessTexture,(K=>{K.name=`${l.name} (Specular Glossiness)`,l.reflectivityTexture=K,l.reflectivityTexture.Cj=!0}))),l.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(v).then((()=>{}))}}j(yK),N(yK,!0,(K=>new TK(K)));const eK="KHR_materials_unlit";class iK{constructor(K){this.name=eK,this.order=210,this._loader=K,this.enabled=this._loader.isExtensionUsed(eK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,(()=>this._loadUnlitPropertiesAsync(K,Y,l)))}_loadUnlitPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;l.unlit=!0;const U=Y.pbrMetallicRoughness;return U&&(U.baseColorFactor?(l.albedoColor=d.e.yi(U.baseColorFactor),l.alpha=U.baseColorFactor[3]):l.albedoColor=d.e.White(),U.baseColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/baseColorTexture`,U.baseColorTexture,(K=>{K.name=`${l.name} (Base Color)`,l.albedoTexture=K})))),Y.doubleSided&&(l.xi=!1,l.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(K,Y,l),Promise.all(v).then((()=>{}))}}j(eK),N(eK,!0,(K=>new iK(K)));const DK="KHR_materials_clearcoat";class BK{constructor(K){this.name=DK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(DK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadClearCoatPropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadClearCoatPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.clearCoat.isEnabled=!0,l.clearCoat.useRoughnessFromMainTexture=!1,l.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Y.clearcoatFactor?l.clearCoat.Kl=Y.clearcoatFactor:l.clearCoat.Kl=0,Y.clearcoatTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatTexture`,Y.clearcoatTexture,(K=>{K.name=`${l.name} (ClearCoat)`,l.clearCoat.texture=K}))),void 0!=Y.clearcoatRoughnessFactor?l.clearCoat.roughness=Y.clearcoatRoughnessFactor:l.clearCoat.roughness=0,Y.clearcoatRoughnessTexture&&(Y.clearcoatRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatRoughnessTexture`,Y.clearcoatRoughnessTexture,(K=>{K.name=`${l.name} (ClearCoat Roughness)`,l.clearCoat.textureRoughness=K})))),Y.clearcoatNormalTexture&&(Y.clearcoatNormalTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatNormalTexture`,Y.clearcoatNormalTexture,(K=>{K.name=`${l.name} (ClearCoat Normal)`,l.clearCoat.bumpTexture=K}))),l.invertNormalMapX=!l.va().useRightHandedSystem,l.invertNormalMapY=l.va().useRightHandedSystem,void 0!=Y.clearcoatNormalTexture.scale&&(l.clearCoat.bumpTexture.level=Y.clearcoatNormalTexture.scale)),Promise.all(v).then((()=>{}))}}j(DK),N(DK,!0,(K=>new BK(K)));const PK="KHR_materials_iridescence";class GK{constructor(K){this.name=PK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(PK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadIridescencePropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.iridescence.isEnabled=!0,l.iridescence.Kl=Y.iridescenceFactor??0,l.iridescence.indexOfRefraction=Y.iridescenceIor??Y.iridescenceIOR??1.3,l.iridescence.minimumThickness=Y.iridescenceThicknessMinimum??100,l.iridescence.maximumThickness=Y.iridescenceThicknessMaximum??400,Y.iridescenceTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceTexture`,Y.iridescenceTexture,(K=>{K.name=`${l.name} (Iridescence)`,l.iridescence.texture=K}))),Y.iridescenceThicknessTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceThicknessTexture`,Y.iridescenceThicknessTexture,(K=>{K.name=`${l.name} (Iridescence Thickness)`,l.iridescence.thicknessTexture=K}))),Promise.all(v).then((()=>{}))}}j(PK),N(PK,!0,(K=>new GK(K)));const QK="KHR_materials_anisotropy";class XK{constructor(K){this.name=QK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(QK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadIridescencePropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.anisotropy.isEnabled=!0,l.anisotropy.Kl=Y.anisotropyStrength??0,l.anisotropy.angle=Y.anisotropyRotation??0,Y.anisotropyTexture&&(Y.anisotropyTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${K}/anisotropyTexture`,Y.anisotropyTexture,(K=>{K.name=`${l.name} (Anisotropy Intensity)`,l.anisotropy.texture=K})))),Promise.all(v).then((()=>{}))}}j(QK),N(QK,!0,(K=>new XK(K)));const fK="KHR_materials_emissive_strength";class wK{constructor(K){this.name=fK,this.order=170,this._loader=K,this.enabled=this._loader.isExtensionUsed(fK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>this._loader.loadMaterialPropertiesAsync(K,Y,l).then((()=>{this._loadEmissiveProperties(v,U,l)}))))}_loadEmissiveProperties(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);void 0!==Y.emissiveStrength&&(l.emissiveIntensity=Y.emissiveStrength)}}j(fK),N(fK,!0,(K=>new wK(K)));const kK="KHR_materials_sheen";class IK{constructor(K){this.name=kK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(kK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadSheenPropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadSheenPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return l.sheen.isEnabled=!0,l.sheen.Kl=1,void 0!=Y.sheenColorFactor?l.sheen.color=d.e.yi(Y.sheenColorFactor):l.sheen.color=d.e.Black(),Y.sheenColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/sheenColorTexture`,Y.sheenColorTexture,(K=>{K.name=`${l.name} (Sheen Color)`,l.sheen.texture=K}))),void 0!==Y.sheenRoughnessFactor?l.sheen.roughness=Y.sheenRoughnessFactor:l.sheen.roughness=0,Y.sheenRoughnessTexture&&(Y.sheenRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${K}/sheenRoughnessTexture`,Y.sheenRoughnessTexture,(K=>{K.name=`${l.name} (Sheen Roughness)`,l.sheen.textureRoughness=K})))),l.sheen.albedoScaling=!0,l.sheen.useRoughnessFromMainTexture=!1,Promise.all(v).then((()=>{}))}}j(kK),N(kK,!0,(K=>new IK(K)));const LK="KHR_materials_specular";class aK{constructor(K){this.name=LK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(LK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadSpecularPropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadSpecularPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const v=new Array;return void 0!==Y.specularFactor&&(l.metallicF0Factor=Y.specularFactor),void 0!==Y.specularColorFactor&&(l.metallicReflectanceColor=d.e.yi(Y.specularColorFactor)),Y.specularTexture&&(Y.specularTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${K}/specularTexture`,Y.specularTexture,(K=>{K.name=`${l.name} (Specular)`,l.metallicReflectanceTexture=K,l.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Y.specularColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${K}/specularColorTexture`,Y.specularColorTexture,(K=>{K.name=`${l.name} (Specular Color)`,l.reflectanceTexture=K}))),Promise.all(v).then((()=>{}))}}j(LK),N(LK,!0,(K=>new aK(K)));const FK="KHR_materials_ior";class sK{constructor(K){this.name=FK,this.order=180,this._loader=K,this.enabled=this._loader.isExtensionUsed(FK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadIorPropertiesAsync(v,U,l)),Promise.all(d).then((()=>{}))}))}_loadIorPropertiesAsync(K,Y,l){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);return void 0!==Y.ior?l.indexOfRefraction=Y.ior:l.indexOfRefraction=sK._DEFAULT_IOR,Promise.resolve()}}sK._DEFAULT_IOR=1.5,j(FK),N(FK,!0,(K=>new sK(K)));const bK="KHR_materials_variants";class xK{constructor(K){this.name=bK,this._loader=K,this.enabled=this._loader.isExtensionUsed(bK)}dispose(){this._loader=null}static GetAvailableVariants(K){const Y=this._GetExtensionMetadata(K);return Y?Object.keys(Y.variants):[]}getAvailableVariants(K){return xK.GetAvailableVariants(K)}static SelectVariant(K,Y){const l=this._GetExtensionMetadata(K);if(!l)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${bK} extension`);const v=K=>{const Y=l.variants[K];if(Y)for(const l of Y)l.mesh.material=l.material};if(Y instanceof Array)for(const U of Y)v(U);else v(Y);l.lastSelected=Y}selectVariant(K,Y){xK.SelectVariant(K,Y)}static Reset(K){const Y=this._GetExtensionMetadata(K);if(!Y)throw new Error(`Cannot reset on a glTF mesh that does not have the ${bK} extension`);for(const l of Y.original)l.mesh.material=l.material;Y.lastSelected=null}reset(K){xK.Reset(K)}static GetLastSelectedVariant(K){const Y=this._GetExtensionMetadata(K);if(!Y)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${bK} extension`);return Y.lastSelected}getLastSelectedVariant(K){return xK.GetLastSelectedVariant(K)}static _GetExtensionMetadata(K){var Y,l;return(null===K||void 0===K||null===(Y=K._internalMetadata)||void 0===Y||null===(l=Y.Al)||void 0===l?void 0:l[bK])||null}onLoading(){const K=this._loader.Al.extensions;if(K&&K[this.name]){const Y=K[this.name];this._variants=Y.variants}}_loadMeshPrimitiveAsync(K,Y,l,v,U,d){return q.LoadExtensionAsync(K,U,this.name,((A,c)=>{const t=new Array;return t.push(this._loader._loadMeshPrimitiveAsync(K,Y,l,v,U,(Y=>{if(d(Y),Y instanceof G.e){const l=q._GetDrawMode(K,U.mode),v=this._loader.rootBabylonMesh,d=v?v._internalMetadata=v._internalMetadata||{}:{},Z=d.Al=d.Al||{},m=Z[bK]=Z[bK]||{lastSelected:null,original:[],variants:{}};m.original.push({mesh:Y,material:Y.material});for(let K=0;K<c.mappings.length;++K){const U=c.mappings[K],d=S.Get(`${A}/mappings/${K}/material`,this._loader.Al.materials,U.material);t.push(this._loader._loadMaterialAsync(`#/materials/${U.material}`,d,Y,l,(K=>{for(let l=0;l<U.variants.length;++l){const d=U.variants[l],A=S.Get(`/extensions/${bK}/variants/${d}`,this._variants,d);m.variants[A.name]=m.variants[A.name]||[],m.variants[A.name].push({mesh:Y,material:K}),Y.onClonedObservable.add((K=>{const l=K;let U=null,d=l;do{if(d=d.parent,!d)return;U=xK._GetExtensionMetadata(d)}while(null===U);if(v&&U===xK._GetExtensionMetadata(v)){d._internalMetadata={};for(const K in v._internalMetadata)d._internalMetadata[K]=v._internalMetadata[K];d._internalMetadata.Al=[];for(const K in v._internalMetadata.Al)d._internalMetadata.Al[K]=v._internalMetadata.Al[K];d._internalMetadata.Al[bK]={lastSelected:null,original:[],variants:{}};for(const K of U.original)d._internalMetadata.Al[bK].original.push({mesh:K.mesh,material:K.material});for(const K in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,K)){d._internalMetadata.Al[bK].variants[K]=[];for(const Y of U.variants[K])d._internalMetadata.Al[bK].variants[K].push({mesh:Y.mesh,material:Y.material})}U=d._internalMetadata.Al[bK]}for(const v of U.original)v.mesh===Y&&(v.mesh=l);for(const v of U.variants[A.name])v.mesh===Y&&(v.mesh=l)}))}})))}}}))),Promise.all(t).then((K=>{let[Y]=K;return Y}))}))}}j(bK),N(bK,!0,(K=>new xK(K)));var CK=l(2310);class NK{}NK.AUTOSAMPLERSUFFIX="Sampler",NK.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",NK.ALPHA_DISABLE=0,NK.ALPHA_ADD=1,NK.ALPHA_COMBINE=2,NK.ALPHA_SUBTRACT=3,NK.ALPHA_MULTIPLY=4,NK.ALPHA_MAXIMIZED=5,NK.ALPHA_ONEONE=6,NK.ALPHA_PREMULTIPLIED=7,NK.ALPHA_PREMULTIPLIED_PORTERDUFF=8,NK.ALPHA_INTERPOLATE=9,NK.ALPHA_SCREENMODE=10,NK.ALPHA_ONEONE_ONEONE=11,NK.ALPHA_ALPHATOCOLOR=12,NK.ALPHA_REVERSEONEMINUS=13,NK.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,NK.ALPHA_ONEONE_ONEZERO=15,NK.ALPHA_EXCLUSION=16,NK.ALPHA_LAYER_ACCUMULATE=17,NK.ALPHA_EQUATION_ADD=0,NK.ALPHA_EQUATION_SUBSTRACT=1,NK.ALPHA_EQUATION_REVERSE_SUBTRACT=2,NK.ALPHA_EQUATION_MAX=3,NK.ALPHA_EQUATION_MIN=4,NK.ALPHA_EQUATION_DARKEN=5,NK.DELAYLOADSTATE_NONE=0,NK.DELAYLOADSTATE_LOADED=1,NK.DELAYLOADSTATE_LOADING=2,NK.DELAYLOADSTATE_NOTLOADED=4,NK.NEVER=512,NK.ALWAYS=519,NK.LESS=513,NK.EQUAL=514,NK.LEQUAL=515,NK.GREATER=516,NK.GEQUAL=518,NK.NOTEQUAL=517,NK.KEEP=7680,NK.ZERO=0,NK.REPLACE=7681,NK.INCR=7682,NK.DECR=7683,NK.INVERT=5386,NK.INCR_WRAP=34055,NK.DECR_WRAP=34056,NK.TEXTURE_CLAMP_ADDRESSMODE=0,NK.TEXTURE_WRAP_ADDRESSMODE=1,NK.TEXTURE_MIRROR_ADDRESSMODE=2,NK.TEXTURE_CREATIONFLAG_STORAGE=1,NK.TEXTUREFORMAT_ALPHA=0,NK.TEXTUREFORMAT_LUMINANCE=1,NK.TEXTUREFORMAT_LUMINANCE_ALPHA=2,NK.TEXTUREFORMAT_RGB=4,NK.TEXTUREFORMAT_RGBA=5,NK.TEXTUREFORMAT_RED=6,NK.TEXTUREFORMAT_R=6,NK.TEXTUREFORMAT_RG=7,NK.TEXTUREFORMAT_RED_INTEGER=8,NK.TEXTUREFORMAT_R_INTEGER=8,NK.TEXTUREFORMAT_RG_INTEGER=9,NK.TEXTUREFORMAT_RGB_INTEGER=10,NK.TEXTUREFORMAT_RGBA_INTEGER=11,NK.TEXTUREFORMAT_BGRA=12,NK.TEXTUREFORMAT_DEPTH24_STENCIL8=13,NK.TEXTUREFORMAT_DEPTH32_FLOAT=14,NK.TEXTUREFORMAT_DEPTH16=15,NK.TEXTUREFORMAT_DEPTH24=16,NK.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,NK.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,NK.TEXTUREFORMAT_STENCIL8=19,NK.TEXTUREFORMAT_UNDEFINED=4294967295,NK.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,NK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,NK.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,NK.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,NK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,NK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,NK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,NK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,NK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,NK.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,NK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,NK.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,NK.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,NK.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,NK.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,NK.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,NK.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,NK.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,NK.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,NK.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,NK.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,NK.TEXTURETYPE_UNSIGNED_BYTE=0,NK.TEXTURETYPE_UNSIGNED_INT=0,NK.TEXTURETYPE_FLOAT=1,NK.TEXTURETYPE_HALF_FLOAT=2,NK.TEXTURETYPE_BYTE=3,NK.TEXTURETYPE_SHORT=4,NK.TEXTURETYPE_UNSIGNED_SHORT=5,NK.TEXTURETYPE_INT=6,NK.TEXTURETYPE_UNSIGNED_INTEGER=7,NK.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,NK.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,NK.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,NK.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,NK.TEXTURETYPE_UNSIGNED_INT_24_8=12,NK.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,NK.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,NK.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,NK.TEXTURETYPE_UNDEFINED=16,NK.TEXTURE_2D=3553,NK.TEXTURE_2D_ARRAY=35866,NK.TEXTURE_CUBE_MAP=34067,NK.TEXTURE_CUBE_MAP_ARRAY=3735928559,NK.TEXTURE_3D=32879,NK.TEXTURE_NEAREST_SAMPLINGMODE=1,NK.TEXTURE_NEAREST_NEAREST=1,NK.TEXTURE_BILINEAR_SAMPLINGMODE=2,NK.TEXTURE_LINEAR_LINEAR=2,NK.TEXTURE_TRILINEAR_SAMPLINGMODE=3,NK.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,NK.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,NK.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,NK.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,NK.TEXTURE_NEAREST_LINEAR=7,NK.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,NK.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,NK.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,NK.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,NK.TEXTURE_LINEAR_NEAREST=12,NK.TEXTURE_EXPLICIT_MODE=0,NK.TEXTURE_SPHERICAL_MODE=1,NK.TEXTURE_PLANAR_MODE=2,NK.TEXTURE_CUBIC_MODE=3,NK.TEXTURE_PROJECTION_MODE=4,NK.TEXTURE_SKYBOX_MODE=5,NK.TEXTURE_INVCUBIC_MODE=6,NK.TEXTURE_EQUIRECTANGULAR_MODE=7,NK.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,NK.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,NK.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,NK.TEXTURE_FILTERING_QUALITY_HIGH=64,NK.TEXTURE_FILTERING_QUALITY_MEDIUM=16,NK.TEXTURE_FILTERING_QUALITY_LOW=8,NK.SCALEMODE_FLOOR=1,NK.SCALEMODE_NEAREST=2,NK.SCALEMODE_CEILING=3,NK.MATERIAL_TextureDirtyFlag=1,NK.MATERIAL_LightDirtyFlag=2,NK.MATERIAL_FresnelDirtyFlag=4,NK.MATERIAL_AttributesDirtyFlag=8,NK.MATERIAL_MiscDirtyFlag=16,NK.MATERIAL_PrePassDirtyFlag=32,NK.MATERIAL_AllDirtyFlag=63,NK.MATERIAL_TriangleFillMode=0,NK.MATERIAL_WireFrameFillMode=1,NK.MATERIAL_PointFillMode=2,NK.MATERIAL_PointListDrawMode=3,NK.MATERIAL_LineListDrawMode=4,NK.MATERIAL_LineLoopDrawMode=5,NK.MATERIAL_LineStripDrawMode=6,NK.MATERIAL_TriangleStripDrawMode=7,NK.MATERIAL_TriangleFanDrawMode=8,NK.MATERIAL_ClockWiseSideOrientation=0,NK.MATERIAL_CounterClockWiseSideOrientation=1,NK.ACTION_NothingTrigger=0,NK.ACTION_OnPickTrigger=1,NK.ACTION_OnLeftPickTrigger=2,NK.ACTION_OnRightPickTrigger=3,NK.ACTION_OnCenterPickTrigger=4,NK.ACTION_OnPickDownTrigger=5,NK.ACTION_OnDoublePickTrigger=6,NK.ACTION_OnPickUpTrigger=7,NK.ACTION_OnPickOutTrigger=16,NK.ACTION_OnLongPressTrigger=8,NK.ACTION_OnPointerOverTrigger=9,NK.ACTION_OnPointerOutTrigger=10,NK.ACTION_OnEveryFrameTrigger=11,NK.ACTION_OnIntersectionEnterTrigger=12,NK.ACTION_OnIntersectionExitTrigger=13,NK.ACTION_OnKeyDownTrigger=14,NK.ACTION_OnKeyUpTrigger=15,NK.PARTICLES_BILLBOARDMODE_Y=2,NK.PARTICLES_BILLBOARDMODE_ALL=7,NK.PARTICLES_BILLBOARDMODE_STRETCHED=8,NK.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,NK.MESHES_CULLINGSTRATEGY_STANDARD=0,NK.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,NK.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,NK.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,NK.SCENELOADER_NO_LOGGING=0,NK.SCENELOADER_MINIMAL_LOGGING=1,NK.SCENELOADER_SUMMARY_LOGGING=2,NK.SCENELOADER_DETAILED_LOGGING=3,NK.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,NK.PREPASS_POSITION_TEXTURE_TYPE=1,NK.PREPASS_VELOCITY_TEXTURE_TYPE=2,NK.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,NK.PREPASS_COLOR_TEXTURE_TYPE=4,NK.PREPASS_DEPTH_TEXTURE_TYPE=5,NK.PREPASS_NORMAL_TEXTURE_TYPE=6,NK.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,NK.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,NK.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,NK.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,NK.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,NK.PREPASS_ALBEDO_TEXTURE_TYPE=12,NK.BUFFER_CREATIONFLAG_READ=1,NK.BUFFER_CREATIONFLAG_WRITE=2,NK.BUFFER_CREATIONFLAG_READWRITE=3,NK.BUFFER_CREATIONFLAG_UNIFORM=4,NK.BUFFER_CREATIONFLAG_VERTEX=8,NK.BUFFER_CREATIONFLAG_INDEX=16,NK.BUFFER_CREATIONFLAG_STORAGE=32,NK.BUFFER_CREATIONFLAG_INDIRECT=64,NK.RENDERPASS_MAIN=0,NK.INPUT_ALT_KEY=18,NK.INPUT_CTRL_KEY=17,NK.INPUT_META_KEY1=91,NK.INPUT_META_KEY2=92,NK.INPUT_META_KEY3=93,NK.INPUT_SHIFT_KEY=16,NK.SNAPSHOTRENDERING_STANDARD=0,NK.SNAPSHOTRENDERING_FAST=1,NK.PERSPECTIVE_CAMERA=0,NK.ORTHOGRAPHIC_CAMERA=1,NK.FOVMODE_VERTICAL_FIXED=0,NK.FOVMODE_HORIZONTAL_FIXED=1,NK.RIG_MODE_NONE=0,NK.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,NK.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,NK.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,NK.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,NK.RIG_MODE_STEREOSCOPIC_INTERLACED=14,NK.RIG_MODE_VR=20,NK.RIG_MODE_CUSTOM=22,NK.MAX_SUPPORTED_UV_SETS=6,NK.GL_ALPHA_EQUATION_ADD=32774,NK.GL_ALPHA_EQUATION_MIN=32775,NK.GL_ALPHA_EQUATION_MAX=32776,NK.GL_ALPHA_EQUATION_SUBTRACT=32778,NK.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,NK.GL_ALPHA_FUNCTION_SRC=768,NK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,NK.GL_ALPHA_FUNCTION_SRC_ALPHA=770,NK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,NK.GL_ALPHA_FUNCTION_DST_ALPHA=772,NK.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,NK.GL_ALPHA_FUNCTION_DST_COLOR=774,NK.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,NK.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,NK.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,NK.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,NK.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,NK.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,NK.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,NK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,NK.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,NK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,NK.SnippetUrl="https://snippet.babylonjs.com",NK.FOGMODE_NONE=0,NK.FOGMODE_EXP=1,NK.FOGMODE_EXP2=2,NK.FOGMODE_LINEAR=3,NK.BYTE=5120,NK.UNSIGNED_BYTE=5121,NK.SHORT=5122,NK.UNSIGNED_SHORT=5123,NK.INT=5124,NK.UNSIGNED_INT=5125,NK.FLOAT=5126,NK.PositionKind="position",NK.NormalKind="Ri",NK.TangentKind="tangent",NK.UVKind="uv",NK.UV2Kind="uv2",NK.UV3Kind="uv3",NK.UV4Kind="uv4",NK.UV5Kind="uv5",NK.UV6Kind="uv6",NK.ColorKind="color",NK.ColorInstanceKind="instanceColor",NK.MatricesIndicesKind="matricesIndices",NK.MatricesWeightsKind="matricesWeights",NK.MatricesIndicesExtraKind="matricesIndicesExtra",NK.MatricesWeightsExtraKind="matricesWeightsExtra";class jK{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:NK.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(K,Y){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...jK._GetDefaultOptions(),...K},this._scene=Y,this._scene._transmissionHelper=this,this.onErrorObservable=new m.b,this._scene.Hi.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(K){if(!Object.keys(K).filter((Y=>this._options[Y]!==K[Y])).length)return;const Y={...this._options,...K},l=this._options;this._options=Y,Y.renderSize===l.renderSize&&Y.renderTargetTextureType===l.renderTargetTextureType&&Y.generateMipmaps===l.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Y.samples,this._opaqueRenderTarget.lodGenerationScale=Y.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Y.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(K){return!!K&&!!(K instanceof T&&K.subSurface.isRefractionEnabled)}_addMesh(K){this._materialObservers[K.uniqueId]=K.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),A.d.SetImmediate((()=>{this._shouldRenderAsTransmission(K.material)?(K.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(K)&&this._transparentMeshesCache.push(K)):-1===this._opaqueMeshesCache.indexOf(K)&&this._opaqueMeshesCache.push(K)}))}_removeMesh(K){K.onMaterialChangedObservable.remove(this._materialObservers[K.uniqueId]),delete this._materialObservers[K.uniqueId];let Y=this._transparentMeshesCache.indexOf(K);-1!==Y&&this._transparentMeshesCache.splice(Y,1),Y=this._opaqueMeshesCache.indexOf(K),-1!==Y&&this._opaqueMeshesCache.splice(Y,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(K){const Y=this._transparentMeshesCache.indexOf(K),l=this._opaqueMeshesCache.indexOf(K);this._shouldRenderAsTransmission(K.material)?(K.material instanceof T&&(K.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==l?(this._opaqueMeshesCache.splice(l,1),this._transparentMeshesCache.push(K)):-1===Y&&this._transparentMeshesCache.push(K)):-1!==Y?(this._transparentMeshesCache.splice(Y,1),this._opaqueMeshesCache.push(K)):-1===l&&this._opaqueMeshesCache.push(K)}_isRenderTargetValid(){var K;return null!==(null===(K=this._opaqueRenderTarget)||void 0===K?void 0:K.getInternalTexture())}_setupRenderTargets(){var K;let Y,l;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new CK.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(K=this._options.clearColor)||void 0===K?void 0:K.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((K=>{l=this._scene.environmentIntensity,this._scene.environmentIntensity=1,Y=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?K.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(K.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=l,this._scene.imageProcessingConfiguration._applyByPostProcess=Y})),this._transparentMeshesCache.forEach((K=>{this._shouldRenderAsTransmission(K.material)&&(K.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pK="KHR_materials_transmission";class SK{constructor(K){this.name=pK,this.order=175,this._loader=K,this.enabled=this._loader.isExtensionUsed(pK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadTransparentPropertiesAsync(v,Y,l,U)),Promise.all(d).then((()=>{}))}))}_loadTransparentPropertiesAsync(K,Y,l,v){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const U=l;if(U.subSurface.isRefractionEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.useAlbedoToTintRefraction=!0,void 0===v.transmissionFactor)return U.subSurface.refractionIntensity=0,U.subSurface.isRefractionEnabled=!1,Promise.resolve();{var d;U.subSurface.refractionIntensity=v.transmissionFactor;const K=U.va();if(U.subSurface.refractionIntensity&&!K._transmissionHelper)new jK({},U.va());else if(U.subSurface.refractionIntensity&&(null===(d=K._transmissionHelper)||void 0===d||!d._isRenderTargetValid())){var A;null===(A=K._transmissionHelper)||void 0===A||A._setupRenderTargets()}}return U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,v.transmissionTexture?(v.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/transmissionTexture`,v.transmissionTexture,void 0).then((K=>{K.name=`${l.name} (Transmission)`,U.subSurface.refractionIntensityTexture=K,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(pK),N(pK,!0,(K=>new SK(K)));const qK="KHR_materials_diffuse_transmission";class OK{constructor(K){this.name=qK,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(qK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadTranslucentPropertiesAsync(v,Y,l,U)),Promise.all(d).then((()=>{}))}))}_loadTranslucentPropertiesAsync(K,Y,l,v){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);const U=l;if(U.subSurface.isTranslucencyEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,U.subSurface.useAlbedoToTintTranslucency=!1,void 0===v.diffuseTransmissionFactor)return U.subSurface.translucencyIntensity=0,U.subSurface.isTranslucencyEnabled=!1,Promise.resolve();U.subSurface.translucencyIntensity=v.diffuseTransmissionFactor;const A=new Array;return U.subSurface.useGltfStyleTextures=!0,v.diffuseTransmissionTexture&&(v.diffuseTransmissionTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionTexture`,v.diffuseTransmissionTexture).then((K=>{K.name=`${l.name} (Diffuse Transmission)`,U.subSurface.translucencyIntensityTexture=K})))),void 0!==v.diffuseTransmissionColorFactor?U.subSurface.translucencyColor=d.e.yi(v.diffuseTransmissionColorFactor):U.subSurface.translucencyColor=d.e.White(),v.diffuseTransmissionColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionColorTexture`,v.diffuseTransmissionColorTexture).then((K=>{K.name=`${l.name} (Diffuse Transmission Color)`,U.subSurface.translucencyColorTexture=K}))),Promise.all(A).then((()=>{}))}}j(qK),N(qK,!0,(K=>new OK(K)));const hK="KHR_materials_volume";class KY{constructor(K){this.name=hK,this.order=173,this._loader=K,this.enabled=this._loader.isExtensionUsed(hK),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadVolumePropertiesAsync(v,Y,l,U)),Promise.all(d).then((()=>{}))}))}_loadVolumePropertiesAsync(K,Y,l,v){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);if(!l.subSurface.isRefractionEnabled&&!l.subSurface.isTranslucencyEnabled||!v.thicknessFactor)return Promise.resolve();l.subSurface.volumeIndexOfRefraction=l.indexOfRefraction;const U=void 0!==v.attenuationDistance?v.attenuationDistance:Number.MAX_VALUE;return l.subSurface.tintColorAtDistance=U,void 0!==v.attenuationColor&&3==v.attenuationColor.length&&l.subSurface.tintColor.mi(v.attenuationColor[0],v.attenuationColor[1],v.attenuationColor[2]),l.subSurface.minimumThickness=0,l.subSurface.maximumThickness=v.thicknessFactor,l.subSurface.useThicknessAsDepth=!0,v.thicknessTexture?(v.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/thicknessTexture`,v.thicknessTexture).then((K=>{K.name=`${l.name} (Thickness)`,l.subSurface.thicknessTexture=K,l.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}j(hK),N(hK,!0,(K=>new KY(K)));const YY="KHR_materials_dispersion";class lY{constructor(K){this.name=YY,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(YY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=new Array;return d.push(this._loader.loadMaterialPropertiesAsync(K,Y,l)),d.push(this._loadDispersionPropertiesAsync(v,Y,l,U)),Promise.all(d).then((()=>{}))}))}_loadDispersionPropertiesAsync(K,Y,l,v){if(!(l instanceof T))throw new Error(`${K}: Material type not supported`);return l.subSurface.isRefractionEnabled&&v.dispersion?(l.subSurface.isDispersionEnabled=!0,l.subSurface.dispersion=v.dispersion,Promise.resolve()):Promise.resolve()}}j(YY),N(YY,!0,(K=>new lY(K)));const vY="KHR_mesh_quantization";class UY{constructor(K){this.name=vY,this.enabled=K.isExtensionUsed(vY)}dispose(){}}j(vY),N(vY,!0,(K=>new UY(K)));const dY="KHR_texture_basisu";class AY{constructor(K){this.name=dY,this._loader=K,this.enabled=K.isExtensionUsed(dY)}dispose(){this._loader=null}_loadTextureAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>{const d=void 0==Y.sampler?q.DefaultSampler:S.Get(`${K}/sampler`,this._loader.Al.samplers,Y.sampler),A=S.Get(`${v}/source`,this._loader.Al.images,U.source);return this._loader._createTextureAsync(K,d,A,(K=>{l(K)}),Y._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Y._textureInfo.nonColorData)}))}}j(dY),N(dY,!0,(K=>new AY(K)));const cY="KHR_texture_transform";class tY{constructor(K){this.name=cY,this._loader=K,this.enabled=this._loader.isExtensionUsed(cY)}dispose(){this._loader=null}loadTextureInfoAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((v,U)=>this._loader.loadTextureInfoAsync(K,Y,(K=>{if(!(K instanceof e.c))throw new Error(`${v}: Texture type not supported`);U.offset&&(K.uOffset=U.offset[0],K.vOffset=U.offset[1]),K.uRotationCenter=0,K.vRotationCenter=0,U.rotation&&(K.wAng=-U.rotation),U.scale&&(K.uScale=U.scale[0],K.vScale=U.scale[1]),void 0!=U.texCoord&&(K.coordinatesIndex=U.texCoord),l(K)}))))}}j(cY),N(cY,!0,(K=>new tY(K)));const ZY="KHR_xmp_json_ld";class mY{constructor(K){this.name=ZY,this.order=100,this._loader=K,this.enabled=this._loader.isExtensionUsed(ZY)}dispose(){this._loader=null}onLoading(){var K,Y,l;if(null===this._loader.rootBabylonMesh)return;const v=null===(K=this._loader.Al.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld,U=null===(Y=this._loader.Al.asset)||void 0===Y||null===(l=Y.extensions)||void 0===l?void 0:l.KHR_xmp_json_ld;if(v&&U){const K=+U.packet;v.packets&&K<v.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=v.packets[K])}}}function VY(K,Y,l,v){return d.e.yi(Y,l).scale(v)}function MY(K,Y,l,v){return Y[l]*v}function uY(K,Y,l,v){return-Y[l]*v}function oY(K,Y,l,v){return Y[l+1]*v}function WY(K,Y,l,v){return Y[l]*v*2}function gY(K){return{scale:[new nY(M.b.ANIMATIONTYPE_FLOAT,`${K}.uScale`,MY,(()=>2)),new nY(M.b.ANIMATIONTYPE_FLOAT,`${K}.vScale`,oY,(()=>2))],offset:[new nY(M.b.ANIMATIONTYPE_FLOAT,`${K}.uOffset`,MY,(()=>2)),new nY(M.b.ANIMATIONTYPE_FLOAT,`${K}.vOffset`,oY,(()=>2))],rotation:[new nY(M.b.ANIMATIONTYPE_FLOAT,`${K}.wAng`,uY,(()=>1))]}}j(ZY),N(ZY,!0,(K=>new mY(K)));class JY extends F{buildAnimations(K,Y,l,v,U){U(K._babylonCamera,this._buildAnimation(Y,l,v))}}class nY extends F{buildAnimations(K,Y,l,v,U){for(const d in K._data)U(K._data[d].babylonMaterial,this._buildAnimation(Y,l,v))}}class RY extends F{buildAnimations(K,Y,l,v,U){U(K._babylonLight,this._buildAnimation(Y,l,v))}}const HY={__array__:{__target__:!0,...b}},zY={__array__:{__target__:!0,orthographic:{xmag:[new JY(M.b.ANIMATIONTYPE_FLOAT,"orthoLeft",uY,(()=>1)),new JY(M.b.ANIMATIONTYPE_FLOAT,"orthoRight",oY,(()=>1))],ymag:[new JY(M.b.ANIMATIONTYPE_FLOAT,"orthoBottom",uY,(()=>1)),new JY(M.b.ANIMATIONTYPE_FLOAT,"orthoTop",oY,(()=>1))],zfar:[new JY(M.b.ANIMATIONTYPE_FLOAT,"maxZ",MY,(()=>1))],znear:[new JY(M.b.ANIMATIONTYPE_FLOAT,"ti",MY,(()=>1))]},perspective:{yfov:[new JY(M.b.ANIMATIONTYPE_FLOAT,"fov",MY,(()=>1))],zfar:[new JY(M.b.ANIMATIONTYPE_FLOAT,"maxZ",MY,(()=>1))],znear:[new JY(M.b.ANIMATIONTYPE_FLOAT,"ti",MY,(()=>1))]}}},rY={nodes:HY,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"albedoColor",VY,(()=>4)),new nY(M.b.ANIMATIONTYPE_FLOAT,"alpha",(function(K,Y,l,v){return Y[l+3]*v}),(()=>4))],metallicFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"metallic",MY,(()=>1))],roughnessFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"roughness",MY,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:gY("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:gY("metallicTexture")}}},emissiveFactor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"emissiveColor",VY,(()=>3))],normalTexture:{scale:[new nY(M.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",MY,(()=>1))],extensions:{KHR_texture_transform:gY("bumpTexture")}},occlusionTexture:{strength:[new nY(M.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",MY,(()=>1))],extensions:{KHR_texture_transform:gY("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:gY("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new nY(M.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",MY,(()=>1))],anisotropyRotation:[new nY(M.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",MY,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:gY("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",MY,(()=>1))],clearcoatRoughnessFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",MY,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:gY("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new nY(M.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",MY,(()=>1))],extensions:{KHR_texture_transform:gY("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:gY("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new nY(M.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",MY,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new nY(M.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",MY,(()=>1))]},KHR_materials_ior:{ior:[new nY(M.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",MY,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",MY,(()=>1))],iridescenceIor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",MY,(()=>1))],iridescenceThicknessMinimum:[new nY(M.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",MY,(()=>1))],iridescenceThicknessMaximum:[new nY(M.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",MY,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:gY("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:gY("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"sheen.color",VY,(()=>3))],sheenRoughnessFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",MY,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:gY("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:gY("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",MY,(()=>1))],specularColorFactor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",VY,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:gY("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:gY("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",MY,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:gY("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",VY,(()=>3))],attenuationDistance:[new nY(M.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",MY,(()=>1))],thicknessFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",MY,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:gY("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new nY(M.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",MY,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:gY("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new nY(M.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",VY,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:gY("subSurface.translucencyColorTexture")}}}}}},cameras:zY,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new RY(M.b.ANIMATIONTYPE_COLOR3,"diffuse",VY,(()=>3))],Kl:[new RY(M.b.ANIMATIONTYPE_FLOAT,"intensity",MY,(()=>1))],range:[new RY(M.b.ANIMATIONTYPE_FLOAT,"range",MY,(()=>1))],spot:{innerConeAngle:[new RY(M.b.ANIMATIONTYPE_FLOAT,"innerAngle",WY,(()=>1))],outerConeAngle:[new RY(M.b.ANIMATIONTYPE_FLOAT,"angle",WY,(()=>1))]}}}}}};class EY{constructor(K,Y){this._gltf=K,this._infoTree=Y}convert(K){let Y,l=this._gltf,v=this._infoTree;if(!K.startsWith("/"))throw new Error("Path must start with a /");const U=K.split("/");U.shift();for(const d of U){if(v.__array__)v=v.__array__;else if(v=v[d],!v)throw new Error(`Path ${K} is invalid`);if(void 0===l)throw new Error(`Path ${K} is invalid`);l=l[d],v.__target__&&(Y=l)}return{object:Y,info:v}}}const yY="KHR_animation_pointer";class TY extends EY{constructor(K){super(K,rY)}}class eY{constructor(K){this.name=yY,this._loader=K,this._pathToObjectConverter=new TY(this._loader.Al)}get enabled(){return this._loader.isExtensionUsed(yY)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(K,Y,l,v,U){var d;const A=null===(d=v.target.extensions)||void 0===d?void 0:d.KHR_animation_pointer;if(!A||!this._pathToObjectConverter)return null;"pointer"!==v.target.path&&W.e.Warn(`${K}/target/path: Value (${v.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=v.target.node&&W.e.Warn(`${K}/target/node: Value (${v.target.node}) must not be present when using the ${this.name} extension`);const c=`${K}/extensions/${this.name}`,t=A.pointer;if(!t)throw new Error(`${c}: Pointer is missing`);try{const d=this._pathToObjectConverter.convert(t);return this._loader._loadAnimationChannelFromTargetInfoAsync(K,Y,l,v,d,U)}catch(Z){return W.e.Warn(`${c}/pointer: Invalid pointer (${t}) skipped`),null}}}j(yY),N(yY,!0,(K=>new eY(K)));class iY{constructor(K,Y,l){this.frame=K,this.action=Y,this.onlyOnce=l,this.isDone=!1}_clone(){return new iY(this.frame,this.action,this.onlyOnce)}}var DY=l(515),BY=l(567);class PY{get loop(){return this._loop}set loop(K){K!==this._loop&&(this._loop=K,this.updateOptions({loop:K}))}get currentTime(){var K;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(K=BY.b.audioEngine)&&void 0!==K&&K.audioContext&&(this.isPlaying||this.isPaused)){const K=this.isPaused?0:BY.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+K}return 0}get spatialSound(){return this._spatialSound}set spatialSound(K){if(K==this._spatialSound)return;const Y=this.isPlaying;this.pause(),K?(this._spatialSound=K,this._updateSpatialParameters()):this._disableSpatialSound(),Y&&this.play()}constructor(K,Y,l){var v;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new m.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=U.o.Zero(),this._localDirection=new U.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=K,l=l||o.e.LastCreatedScene)if(this._scene=l,PY._SceneComponentInitialization(l),this._readyToPlayCallback=d,this._customAttenuationFunction=(K,Y,l,v,U)=>Y<l?K*(1-Y/l):0,c&&(this.autoplay=c.autoplay||!1,this._loop=c.loop||!1,void 0!==c.volume&&(this._volume=c.volume),this._spatialSound=c.spatialSound??!1,this.maxDistance=c.maxDistance??100,this.useCustomAttenuation=c.useCustomAttenuation??!1,this.rolloffFactor=c.rolloffFactor||1,this.refDistance=c.refDistance||1,this.distanceModel=c.distanceModel||"linear",this._playbackRate=c.playbackRate||1,this._streaming=c.streaming??!1,this._length=c.length,this._offset=c.offset),null!==(v=BY.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&BY.b.audioEngine.audioContext){this._soundGain=BY.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let K=!0;if(Y)try{"string"===typeof Y?(this._urlType="String",this._url=Y):Y instanceof ArrayBuffer?this._urlType="ArrayBuffer":Y instanceof HTMLMediaElement?this._urlType="MediaElement":Y instanceof MediaStream?this._urlType="MediaStream":Y instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Y)&&(this._urlType="Array");let l=[],v=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=BY.b.audioEngine.audioContext.createMediaElementSource(Y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=BY.b.audioEngine.audioContext.createMediaStreamSource(Y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Y.byteLength>0&&(v=!0,this._soundLoaded(Y));break;case"AudioBuffer":this._audioBufferLoaded(Y);break;case"String":l.push(Y);case"Array":0===l.length&&(l=Y);for(let K=0;K<l.length;K++){const Y=l[K];if(v=c&&c.skipCodecCheck||-1!==Y.indexOf(".mp3",Y.length-4)&&BY.b.audioEngine.isMP3supported||-1!==Y.indexOf(".ogg",Y.length-4)&&BY.b.audioEngine.isOGGsupported||-1!==Y.indexOf(".wav",Y.length-4)||-1!==Y.indexOf(".m4a",Y.length-4)||-1!==Y.indexOf(".mp4",Y.length-4)||-1!==Y.indexOf("blob:"),v){this._streaming?(this._htmlAudioElement=new Audio(Y),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,A.d.SetCorsBehavior(Y,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Y,(K=>{this._soundLoaded(K)}),void 0,!0,!0,(K=>{K&&W.e.Error("XHR "+K.status+" error on: "+Y+"."),W.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:K=!1}K?v||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):W.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){W.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),BY.b.audioEngine&&!BY.b.audioEngine.WarnedWebAudioUnsupported&&(W.e.Error("Web Audio is not supported by your browser."),BY.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var K;null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(K){var Y;null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.audioContext&&(this._audioBuffer=K,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(K){var Y;null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.audioContext&&BY.b.audioEngine.audioContext.decodeAudioData(K,(K=>{this._audioBufferLoaded(K)}),(K=>{W.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+K)}))}setAudioBuffer(K){var Y;null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&(this._audioBuffer=K,this._isReadyToPlay=!0)}updateOptions(K){K&&(this.loop=K.loop??this.loop,this.maxDistance=K.maxDistance??this.maxDistance,this.useCustomAttenuation=K.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=K.rolloffFactor??this.rolloffFactor,this.refDistance=K.refDistance??this.refDistance,this.distanceModel=K.distanceModel??this.distanceModel,this._playbackRate=K.playbackRate??this._playbackRate,this._length=K.length??void 0,this.spatialSound=K.spatialSound??this._spatialSound,this._setOffset(K.offset??void 0),this.setVolume(K.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var K;null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&BY.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??BY.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var K;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(K=this._soundPanner)||void 0===K||K.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var K;null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(K){var Y;null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(K),this._isOutputConnected=!0)}setDirectionalCone(K,Y,l){Y<K?W.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=K,this._coneOuterAngle=Y,this._coneOuterGain=l,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!=this._coneInnerAngle){var Y;if(this._coneOuterAngle<K)return void W.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K,null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!=this._coneOuterAngle){var Y;if(K<this._coneInnerAngle)return void W.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K,null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(K){var Y;K.equals(this._position)||(this._position.p(K),null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(K){var Y;this._localDirection=K,null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const K=this._connectedTransformNode.getWorldMatrix(),Y=U.o.TransformNormal(this._localDirection,K);Y.normalize(),this._soundPanner.orientationX.value=Y.x,this._soundPanner.orientationY.value=Y.y,this._soundPanner.orientationZ.value=Y.z}updateDistanceFromListener(){var K;if(null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const K=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Lg(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,K,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(K){this._customAttenuationFunction=K}play(K,Y,l){var v;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(v=BY.b.audioEngine)&&void 0!==v&&v.audioContext)try{var U,d;this._clearTimeoutsAndObservers();let v=K?(null===(U=BY.b.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+K:null===(d=BY.b.audioEngine)||void 0===d?void 0:d.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=BY.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const K=()=>{var l;if(null!==(l=BY.b.audioEngine)&&void 0!==l&&l.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Y??0;const l=this._htmlAudioElement.play();void 0!==l&&l.catch((()=>{var Y,l;(null===(Y=BY.b.audioEngine)||void 0===Y||Y.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(l=BY.b.audioEngine)||void 0===l?void 0:l.onAudioUnlockedObservable.addOnce((()=>{K()})))}))}else{var v;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(v=BY.b.audioEngine)||void 0===v?void 0:v.onAudioUnlockedObservable.addOnce((()=>{K()}))}};K()}}else{var A;const U=()=>{var U;if(null!==(U=BY.b.audioEngine)&&void 0!==U&&U.audioContext){var d;if(l=l||this._length,void 0!==Y&&this._setOffset(Y),this._soundSource){const K=this._soundSource;K.onended=()=>{K.disconnect()}}if(this._soundSource=null===(d=BY.b.audioEngine)||void 0===d?void 0:d.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var A;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Y&&(this._soundSource.loopStart=Y),void 0!==l&&(this._soundSource.loopEnd=(0|Y)+l),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},v=K?(null===(A=BY.b.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+K:BY.b.audioEngine.audioContext.currentTime;const U=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(v,U,this.loop?void 0:l)}}};"suspended"===(null===(A=BY.b.audioEngine)||void 0===A?void 0:A.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var K;"suspended"===(null===(K=BY.b.audioEngine)||void 0===K?void 0:K.audioContext.state)?(BY.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=BY.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{U()})))):U()}),500):U()}this._startTime=v,this.isPlaying=!0,this.isPaused=!1}catch(c){W.e.Error("Error while trying to play audio: "+this.name+", "+c.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(K){var Y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1}else if(null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.audioContext&&this._soundSource){const Y=K?BY.b.audioEngine.audioContext.currentTime+K:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Y)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var K;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Y;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Y=this._streamingSource)||void 0===Y||Y.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(K=BY.b.audioEngine)&&void 0!==K&&K.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=BY.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(K,Y){var l;null!==(l=BY.b.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._soundGain&&(Y&&BY.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(BY.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,BY.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(K,BY.b.audioEngine.audioContext.currentTime+Y)):this._soundGain.gain.value=K),this._volume=K}setPlaybackRate(K){this._playbackRate=K,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(K){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=K,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=K=>this._onRegisterAfterWorldMatrixUpdate(K),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(K){var Y;if(K.getBoundingInfo){const Y=K.getBoundingInfo();this.setPosition(Y.boundingSphere.centerWorld)}else this.setPosition(K.absolutePosition);null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const K=()=>{this._isReadyToPlay?(l._audioBuffer=this.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,this._offset,this._length)):setTimeout(K,300)},Y={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},l=new PY(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Y);return this.useCustomAttenuation&&l.setAttenuationFunction(this._customAttenuationFunction),l.setPosition(this._position),l.setPlaybackRate(this._playbackRate),K(),l}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const K={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(K.connectedMeshId=this._connectedTransformNode.id),K.position=this._position.zi(),K.refDistance=this.refDistance,K.distanceModel=this.distanceModel,K.isDirectional=this._isDirectional,K.localDirectionToMesh=this._localDirection.zi(),K.coneInnerAngle=this._coneInnerAngle,K.coneOuterAngle=this._coneOuterAngle,K.coneOuterGain=this._coneOuterGain),K}static Parse(K,Y,l,v){const d=K.name;let A;A=K.url?l+K.url:l+d;const c={autoplay:K.autoplay,loop:K.loop,volume:K.volume,spatialSound:K.spatialSound,maxDistance:K.maxDistance,rolloffFactor:K.rolloffFactor,refDistance:K.refDistance,distanceModel:K.distanceModel,playbackRate:K.playbackRate};let t;if(v){const K=()=>{v._isReadyToPlay?(t._audioBuffer=v.getAudioBuffer(),t._isReadyToPlay=!0,t.autoplay&&t.play(0,t._offset,t._length)):setTimeout(K,300)};t=new PY(d,new ArrayBuffer(0),Y,null,c),K()}else t=new PY(d,A,Y,(()=>{Y.removePendingData(t)}),c),Y.addPendingData(t);if(K.position){const Y=U.o.yi(K.position);t.setPosition(Y)}if(K.isDirectional&&(t.setDirectionalCone(K.coneInnerAngle||360,K.coneOuterAngle||360,K.coneOuterGain||0),K.localDirectionToMesh)){const Y=U.o.yi(K.localDirectionToMesh);t.setLocalDirectionToMesh(Y)}if(K.connectedMeshId){const l=Y.getMeshById(K.connectedMeshId);l&&t.attachToMesh(l)}return K.metadata&&(t.metadata=K.metadata),t}_setOffset(K){this._offset!==K&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=K)}_clearTimeoutsAndObservers(){var K;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(K=BY.b.audioEngine)||void 0===K||K.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}PY._SceneComponentInitialization=K=>{throw(0,DY.e)("AudioSceneComponent")},(0,E.f)("BABYLON.Sound",PY);class GY{constructor(K,Y,l){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Y.length!==l.length)throw new Error("Sounds length does not equal weights length");this.loop=K,this._weights=l;let v=0;for(const d of l)v+=d;const U=v>0?1/v:0;for(let d=0;d<this._weights.length;d++)this._weights[d]*=U;this._sounds=Y;for(const d of this._sounds)d.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!==this._coneInnerAngle){if(this._coneOuterAngle<K)return void W.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K;for(const Y of this._sounds)Y.directionalConeInnerAngle=K}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!==this._coneOuterAngle){if(K<this._coneInnerAngle)return void W.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K;for(const Y of this._sounds)Y.directionalConeOuterAngle=K}}get volume(){return this._volume}set volume(K){if(K!==this._volume)for(const Y of this._sounds)Y.setVolume(K)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(K){if(!this.isPaused){this.stop();const K=Math.random();let Y=0;for(let l=0;l<this._weights.length;l++)if(Y+=this._weights[l],K<=Y){this._currentIndex=l;break}}const Y=this._sounds[this._currentIndex??0];Y.isReady()?Y.play(0,this.isPaused?void 0:K):Y.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class QY{constructor(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(K=K||o.e.LastCreatedScene)&&(this._scene=K,this.soundCollection=[],this._options=Y,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var K;null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&BY.b.audioEngine.audioContext&&(this._outputAudioNode=BY.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(BY.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(BY.b.audioEngine&&BY.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(K){var Y;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._outputAudioNode&&K.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==K.soundTrackId&&(-1===K.soundTrackId?this._scene.mainSoundTrack.removeSound(K):this._scene.soundTracks&&this._scene.soundTracks[K.soundTrackId].removeSound(K)),this.soundCollection.push(K),K.soundTrackId=this.id}removeSound(K){const Y=this.soundCollection.indexOf(K);-1!==Y&&this.soundCollection.splice(Y,1)}setVolume(K){var Y;null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=K)}switchPanningModelToHRTF(){var K;if(null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let Y=0;Y<this.soundCollection.length;Y++)this.soundCollection[Y].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var K;if(null!==(K=BY.b.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let Y=0;Y<this.soundCollection.length;Y++)this.soundCollection[Y].switchPanningModelToEqualPower()}connectToAnalyser(K){var Y;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=K,null!==(Y=BY.b.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,BY.b.audioEngine.masterGain))}}var XY=l(863),fY=l(2366),wY=(l(12064),l(508));(0,l(12148).d)(XY.c.NAME_AUDIO,((K,Y,l,v)=>{let U,d=[];if(l.om=l.om||[],void 0!==K.om&&null!==K.om)for(let c=0,t=K.om.length;c<t;c++){var A;const t=K.om[c];null!==(A=BY.b.audioEngine)&&void 0!==A&&A.canUseWebAudio?(t.url||(t.url=t.name),d[t.url]?l.om.push(PY.Parse(t,Y,v,d[t.url])):(U=PY.Parse(t,Y,v),d[t.url]=U,l.om.push(U))):l.om.push(new PY(t.name,null,Y))}d=[]})),Object.defineProperty(fY.b.prototype,"mainSoundTrack",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),this._mainSoundTrack||(this._mainSoundTrack=new QY(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),fY.b.prototype.getSoundByName=function(K){let Y;for(Y=0;Y<this.mainSoundTrack.soundCollection.length;Y++)if(this.mainSoundTrack.soundCollection[Y].name===K)return this.mainSoundTrack.soundCollection[Y];if(this.soundTracks)for(let l=0;l<this.soundTracks.length;l++)for(Y=0;Y<this.soundTracks[l].soundCollection.length;Y++)if(this.soundTracks[l].soundCollection[Y].name===K)return this.soundTracks[l].soundCollection[Y];return null},Object.defineProperty(fY.b.prototype,"audioEnabled",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),K.audioEnabled},set:function(K){let Y=this._getComponent(XY.c.NAME_AUDIO);Y||(Y=new kY(this),this.bb(Y)),K?Y.enableAudio():Y.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(fY.b.prototype,"headphone",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),K.headphone},set:function(K){let Y=this._getComponent(XY.c.NAME_AUDIO);Y||(Y=new kY(this),this.bb(Y)),K?Y.switchAudioModeForHeadphones():Y.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(fY.b.prototype,"audioListenerPositionProvider",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),K.audioListenerPositionProvider},set:function(K){let Y=this._getComponent(XY.c.NAME_AUDIO);if(Y||(Y=new kY(this),this.bb(Y)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Y.audioListenerPositionProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(fY.b.prototype,"audioListenerRotationProvider",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),K.audioListenerRotationProvider},set:function(K){let Y=this._getComponent(XY.c.NAME_AUDIO);if(Y||(Y=new kY(this),this.bb(Y)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Y.audioListenerRotationProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(fY.b.prototype,"audioPositioningRefreshRate",{get:function(){let K=this._getComponent(XY.c.NAME_AUDIO);return K||(K=new kY(this),this.bb(K)),K.audioPositioningRefreshRate},set:function(K){let Y=this._getComponent(XY.c.NAME_AUDIO);Y||(Y=new kY(this),this.bb(Y)),Y.audioPositioningRefreshRate=K},enumerable:!0,configurable:!0});class kY{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(K){this.name=XY.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new U.o,this._cachedCameraPosition=new U.o,this._lastCheck=0,this._invertMatrixTemp=new U.d,this._cameraDirectionTemp=new U.o,(K=K||o.e.LastCreatedScene)&&(this.hi=K,K.soundTracks=[],K.om=[])}register(){this.hi._afterRenderStage.registerStep(XY.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(K){if(K.om=[],this.hi.soundTracks)for(let Y=0;Y<this.hi.soundTracks.length;Y++){const l=this.hi.soundTracks[Y];for(let Y=0;Y<l.soundCollection.length;Y++)K.om.push(l.soundCollection[Y].serialize())}}addFromContainer(K){K.om&&K.om.forEach((K=>{K.play(),K.autoplay=!0,this.hi.mainSoundTrack.addSound(K)}))}removeFromContainer(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K.om&&K.om.forEach((K=>{K.stop(),K.autoplay=!1,this.hi.mainSoundTrack.removeSound(K),Y&&K.dispose()}))}dispose(){const K=this.hi;if(K._mainSoundTrack&&K.mainSoundTrack.dispose(),K.soundTracks)for(let Y=0;Y<K.soundTracks.length;Y++)K.soundTracks[Y].dispose()}disableAudio(){const K=this.hi;let Y;for(this._audioEnabled=!1,BY.b.audioEngine&&BY.b.audioEngine.audioContext&&BY.b.audioEngine.audioContext.suspend(),Y=0;Y<K.mainSoundTrack.soundCollection.length;Y++)K.mainSoundTrack.soundCollection[Y].pause();if(K.soundTracks)for(Y=0;Y<K.soundTracks.length;Y++)for(let l=0;l<K.soundTracks[Y].soundCollection.length;l++)K.soundTracks[Y].soundCollection[l].pause()}enableAudio(){const K=this.hi;let Y;for(this._audioEnabled=!0,BY.b.audioEngine&&BY.b.audioEngine.audioContext&&BY.b.audioEngine.audioContext.resume(),Y=0;Y<K.mainSoundTrack.soundCollection.length;Y++)K.mainSoundTrack.soundCollection[Y].isPaused&&K.mainSoundTrack.soundCollection[Y].play();if(K.soundTracks)for(Y=0;Y<K.soundTracks.length;Y++)for(let l=0;l<K.soundTracks[Y].soundCollection.length;l++)K.soundTracks[Y].soundCollection[l].isPaused&&K.soundTracks[Y].soundCollection[l].play()}switchAudioModeForHeadphones(){const K=this.hi;if(this._headphone=!0,K.mainSoundTrack.switchPanningModelToHRTF(),K.soundTracks)for(let Y=0;Y<K.soundTracks.length;Y++)K.soundTracks[Y].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const K=this.hi;if(this._headphone=!1,K.mainSoundTrack.switchPanningModelToEqualPower(),K.soundTracks)for(let Y=0;Y<K.soundTracks.length;Y++)K.soundTracks[Y].switchPanningModelToEqualPower()}_afterRender(){const K=wY.d.Now;if(this._lastCheck&&K-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=K;const Y=this.hi;if(!this._audioEnabled||!Y._mainSoundTrack||!Y.soundTracks||0===Y._mainSoundTrack.soundCollection.length&&1===Y.soundTracks.length)return;const l=BY.b.audioEngine;if(l&&l.audioContext){let K,v=Y.activeCamera;if(Y.activeCameras&&Y.activeCameras.length>0&&(v=Y.activeCameras[0]),this.audioListenerPositionProvider){const K=this.audioListenerPositionProvider();l.audioContext.listener.setPosition(K.x||0,K.y||0,K.z||0)}else v?this._cachedCameraPosition.equals(v.globalPosition)||(this._cachedCameraPosition.p(v.globalPosition),l.audioContext.listener.setPosition(v.globalPosition.x,v.globalPosition.y,v.globalPosition.z)):l.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const K=this.audioListenerRotationProvider();l.audioContext.listener.setOrientation(K.x||0,K.y||0,K.z||0,0,1,0)}else v?(v.rigCameras&&v.rigCameras.length>0&&(v=v.rigCameras[0]),v.getViewMatrix().invertToRef(this._invertMatrixTemp),U.o.TransformNormalToRef(kY._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),l.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):l.audioContext.listener.setOrientation(0,0,0,0,1,0);for(K=0;K<Y.mainSoundTrack.soundCollection.length;K++){const l=Y.mainSoundTrack.soundCollection[K];l.useCustomAttenuation&&l.updateDistanceFromListener()}if(Y.soundTracks)for(K=0;K<Y.soundTracks.length;K++)for(let l=0;l<Y.soundTracks[K].soundCollection.length;l++){const v=Y.soundTracks[K].soundCollection[l];v.useCustomAttenuation&&v.updateDistanceFromListener()}}}}kY._CameraDirection=new U.o(0,0,-1),PY._SceneComponentInitialization=K=>{let Y=K._getComponent(XY.c.NAME_AUDIO);Y||(Y=new kY(K),K.bb(Y))};const IY="MSFT_audio_emitter";class LY{constructor(K){this.name=IY,this._loader=K,this.enabled=this._loader.isExtensionUsed(IY)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const K=this._loader.Al.extensions;if(K&&K[this.name]){const Y=K[this.name];this._clips=Y.clips,this._emitters=Y.emitters,S.Assign(this._clips),S.Assign(this._emitters)}}loadSceneAsync(K,Y){return q.LoadExtensionAsync(K,Y,this.name,((l,v)=>{const U=new Array;U.push(this._loader.loadSceneAsync(K,Y));for(const K of v.emitters){const Y=S.Get(`${l}/emitters`,this._emitters,K);if(void 0!=Y.refDistance||void 0!=Y.maxDistance||void 0!=Y.rolloffFactor||void 0!=Y.distanceModel||void 0!=Y.innerAngle||void 0!=Y.outerAngle)throw new Error(`${l}: Direction or Distance properties are not allowed on emitters attached to a scene`);U.push(this._loadEmitterAsync(`${l}/emitters/${Y.index}`,Y))}return Promise.all(U).then((()=>{}))}))}loadNodeAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((K,v)=>{const d=new Array;return this._loader.loadNodeAsync(K,Y,(Y=>{for(const l of v.emitters){const v=S.Get(`${K}/emitters`,this._emitters,l);d.push(this._loadEmitterAsync(`${K}/emitters/${v.index}`,v).then((()=>{for(const K of v._babylonSounds)K.attachToMesh(Y),void 0==v.innerAngle&&void 0==v.outerAngle||(K.setLocalDirectionToMesh(U.o.Forward()),K.setDirectionalCone(2*A.d.ToDegrees(void 0==v.innerAngle?Math.PI:v.innerAngle),2*A.d.ToDegrees(void 0==v.outerAngle?Math.PI:v.outerAngle),0))})))}l(Y)})).then((K=>Promise.all(d).then((()=>K))))}))}loadAnimationAsync(K,Y){return q.LoadExtensionAsync(K,Y,this.name,((l,v)=>this._loader.loadAnimationAsync(K,Y).then((U=>{const d=new Array;S.Assign(v.events);for(const A of v.events)d.push(this._loadAnimationEventAsync(`${l}/events/${A.index}`,K,Y,A,U));return Promise.all(d).then((()=>U))}))))}_loadClipAsync(K,Y){if(Y._objectURL)return Y._objectURL;let l;if(Y.uri)l=this._loader.loadUriAsync(K,Y,Y.uri);else{const v=S.Get(`${K}/bufferView`,this._loader.Al.bufferViews,Y.bufferView);l=this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return Y._objectURL=l.then((K=>URL.createObjectURL(new Blob([K],{type:Y.mimeType})))),Y._objectURL}_loadEmitterAsync(K,Y){if(Y._babylonSounds=Y._babylonSounds||[],!Y._babylonData){const K=new Array,l=Y.name||`emitter${Y.index}`,v={loop:!1,autoplay:!1,volume:void 0==Y.volume?1:Y.volume};for(let d=0;d<Y.clips.length;d++){const U=`/extensions/${this.name}/clips`,A=S.Get(U,this._clips,Y.clips[d].clip);K.push(this._loadClipAsync(`${U}/${Y.clips[d].clip}`,A).then((K=>{const U=Y._babylonSounds[d]=new PY(l,K,this._loader.babylonScene,null,v);U.refDistance=Y.refDistance||1,U.maxDistance=Y.maxDistance||256,U.rolloffFactor=Y.rolloffFactor||1,U.distanceModel=Y.distanceModel||"exponential"})))}const U=Promise.all(K).then((()=>{const K=Y.clips.map((K=>K.weight||1)),l=new GY(Y.loop||!1,Y._babylonSounds,K);Y.innerAngle&&(l.directionalConeInnerAngle=2*A.d.ToDegrees(Y.innerAngle)),Y.outerAngle&&(l.directionalConeOuterAngle=2*A.d.ToDegrees(Y.outerAngle)),Y.volume&&(l.volume=Y.volume),Y._babylonData.sound=l}));Y._babylonData={loaded:U}}return Y._babylonData.loaded}_getEventAction(K,Y,l,v,U){switch(l){case"play":return K=>{const l=(U||0)+(K-v);Y.play(l)};case"stop":return()=>{Y.stop()};case"pause":return()=>{Y.pause()};default:throw new Error(`${K}: Unsupported action ${l}`)}}_loadAnimationEventAsync(K,Y,l,v,U){if(0==U.targetedAnimations.length)return Promise.resolve();const d=U.targetedAnimations[0],A=v.j,c=S.Get(`/extensions/${this.name}/emitters`,this._emitters,A);return this._loadEmitterAsync(K,c).then((()=>{const Y=c._babylonData.sound;if(Y){const l=new iY(v.time,this._getEventAction(K,Y,v.action,v.time,v.startOffset));d.animation.addEvent(l),U.onAnimationGroupEndObservable.add((()=>{Y.stop()})),U.onAnimationGroupPauseObservable.add((()=>{Y.pause()}))}}))}}j(IY),N(IY,!0,(K=>new LY(K)));const aY="MSFT_lod";class FY{constructor(K){var Y;this.name=aY,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new m.b,this.onMaterialLODsLoadedObservable=new m.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=K,this.maxLODsToLoad=(null===(Y=this._loader.parent.extensionOptions[aY])||void 0===Y?void 0:Y.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(aY)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let K=0;K<this._nodePromiseLODs.length;K++){const Y=Promise.all(this._nodePromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Node LOD ${K}`),this._loader.log(`Loaded node LOD ${K}`)),this.onNodeLODsLoadedObservable.notifyObservers(K),K!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${K+1}`),this._loadBufferLOD(this._nodeBufferLODs,K+1),this._nodeSignalLODs[K]&&this._nodeSignalLODs[K].resolve())}));this._loader._completePromises.push(Y)}for(let K=0;K<this._materialPromiseLODs.length;K++){const Y=Promise.all(this._materialPromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Material LOD ${K}`),this._loader.log(`Loaded material LOD ${K}`)),this.onMaterialLODsLoadedObservable.notifyObservers(K),K!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${K+1}`),this._loadBufferLOD(this._materialBufferLODs,K+1),this._materialSignalLODs[K]&&this._materialSignalLODs[K].resolve())}));this._loader._completePromises.push(Y)}}loadSceneAsync(K,Y){const l=this._loader.loadSceneAsync(K,Y);return this._loadBufferLOD(this._bufferLODs,0),l}loadNodeAsync(K,Y,l){return q.LoadExtensionAsync(K,Y,this.name,((K,U)=>{let d;const A=this._getLODs(K,Y,this._loader.Al.nodes,U.ids);this._loader.logOpen(`${K}`);for(let Y=0;Y<A.length;Y++){const K=A[Y];0!==Y&&(this._nodeIndexLOD=Y,this._nodeSignalLODs[Y]=this._nodeSignalLODs[Y]||new v);const U=K=>{l(K),K.$h(!1)},c=this._loader.loadNodeAsync(`/nodes/${K.index}`,K,U).then((K=>{if(0!==Y){const K=A[Y-1];K._babylonTransformNode&&(this._disposeTransformNode(K._babylonTransformNode),delete K._babylonTransformNode)}return K.$h(!0),K}));this._nodePromiseLODs[Y]=this._nodePromiseLODs[Y]||[],0===Y?d=c:(this._nodeIndexLOD=null,this._nodePromiseLODs[Y].push(c))}return this._loader.logClose(),d}))}_loadMaterialAsync(K,Y,l,v,U){return this._nodeIndexLOD?null:q.LoadExtensionAsync(K,Y,this.name,((K,d)=>{let A;const c=this._getLODs(K,Y,this._loader.Al.materials,d.ids);this._loader.logOpen(`${K}`);for(let Y=0;Y<c.length;Y++){const K=c[Y];0!==Y&&(this._materialIndexLOD=Y);const d=this._loader._loadMaterialAsync(`/materials/${K.index}`,K,l,v,(K=>{0===Y&&U(K)})).then((K=>{if(0!==Y){U(K);const l=c[Y-1]._data;l[v]&&(this._disposeMaterials([l[v].babylonMaterial]),delete l[v])}return K}));this._materialPromiseLODs[Y]=this._materialPromiseLODs[Y]||[],0===Y?A=d:(this._materialIndexLOD=null,this._materialPromiseLODs[Y].push(d))}return this._loader.logClose(),A}))}_loadUriAsync(K,Y,l){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const U=this._nodeIndexLOD-1;return this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new v,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(K,Y,l)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const U=this._materialIndexLOD-1;return this._materialSignalLODs[U]=this._materialSignalLODs[U]||new v,this._materialSignalLODs[U].promise.then((()=>this._loader.loadUriAsync(K,Y,l)))}return null}loadBufferAsync(K,Y,l,U){if(this._loader.parent.useRangeRequests&&!Y.uri){if(!this._loader.bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);const Y=(K,Y)=>{const d=l,A=d+U-1;let c=K[Y];return c?(c.start=Math.min(c.start,d),c.end=Math.max(c.end,A)):(c={start:d,end:A,loaded:new v},K[Y]=c),c.loaded.promise.then((K=>new Uint8Array(K.buffer,K.byteOffset+l-c.start,U)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Y(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Y(this._materialBufferLODs,this._materialIndexLOD):Y(this._bufferLODs,0)}return null}_loadBufferLOD(K,Y){const l=K[Y];l&&(this._loader.log(`Loading buffer range [${l.start}-${l.end}]`),this._loader.bin.readAsync(l.start,l.end-l.start+1).then((K=>{l.loaded.resolve(K)}),(K=>{l.loaded.reject(K)})))}_getLODs(K,Y,l,v){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const U=[];for(let d=v.length-1;d>=0;d--)if(U.push(S.Get(`${K}/ids/${v[d]}`,l,v[d])),U.length===this.maxLODsToLoad)return U;return U.push(Y),U}_disposeTransformNode(K){const Y=[],l=K.material;l&&Y.push(l);for(const U of K.getChildMeshes())U.material&&Y.push(U.material);K.dispose();const v=Y.filter((K=>this._loader.babylonScene.meshes.every((Y=>Y.material!=K))));this._disposeMaterials(v)}_disposeMaterials(K){const Y={};for(const l of K){for(const K of l.getActiveTextures())Y[K.uniqueId]=K;l.dispose()}for(const l in Y)for(const K of this._loader.babylonScene.materials)K.hasTexture(Y[l])&&delete Y[l];for(const l in Y)Y[l].dispose()}}j(aY),N(aY,!0,(K=>new FY(K)));const sY="MSFT_minecraftMesh";class bY{constructor(K){this.name=sY,this._loader=K,this.enabled=this._loader.isExtensionUsed(sY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtraAsync(K,Y,this.name,((v,U)=>{if(U){if(!(l instanceof T))throw new Error(`${v}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(K,Y,l);return l.needAlphaBlending()&&(l.forceDepthWrite=!0,l.separateCullingPass=!0),l.xi=l.forceDepthWrite,l.twoSidedLighting=!0,U}return null}))}}j(sY),N(sY,!0,(K=>new bY(K)));const xY="MSFT_sRGBFactors";class CY{constructor(K){this.name=xY,this._loader=K,this.enabled=this._loader.isExtensionUsed(xY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,Y,l){return q.LoadExtraAsync(K,Y,this.name,((v,U)=>{if(U){if(!(l instanceof T))throw new Error(`${v}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(K,Y,l),d=l.va().getEngine().useExactSrgbConversions;return l.albedoTexture||l.albedoColor.toLinearSpaceToRef(l.albedoColor,d),l.reflectivityTexture||l.reflectivityColor.toLinearSpaceToRef(l.reflectivityColor,d),U}return null}))}}j(xY),N(xY,!0,(K=>new CY(K)));var NY,jY=l(623);!function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(NY||(NY={}));class pY{constructor(K,Y,l){this._ownerBlock=l,this._connectedPoint=[],this.uniqueId=(0,jY.d)(),this.connectedPointIds=[],this.name=K,this._connectionType=Y}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(K){if(this._connectionType===K._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||K._isSingularConnection()&&K._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(K),K._connectedPoint.push(this)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.name=this.name,K._connectionType=this._connectionType,K.connectedPointIds=[],K.className=this.getClassName();for(const Y of this._connectedPoint)K.connectedPointIds.push(Y.uniqueId)}getClassName(){return"FGConnection"}deserialize(K){this.uniqueId=K.uniqueId,this.name=K.name,this._connectionType=K._connectionType,this.connectedPointIds=K.connectedPointIds}static Parse(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Y=arguments.length>1?arguments[1]:void 0;const l=new(A.d.Instantiate(K.className))(K.name,K._connectionType,Y);return l.deserialize(K),l}}class SY{constructor(K){this.value=this._toInt(K)}_toInt(K){return 0|K}add(K){return new SY(this.value+K.value)}Lg(K){return new SY(this.value-K.value)}multiply(K){return new SY(Math.imul(this.value,K.value))}divide(K){return new SY(this.value/K.value)}getClassName(){return SY.ClassName}equals(K){return this.value===K.value}static Parse(K){return new SY(K.value)}}SY.ClassName="FlowGraphInteger",(0,E.f)("FlowGraphInteger",SY);class qY{constructor(K,Y){this.typeName=K,this.defaultValue=Y}serialize(K){K.typeName=this.typeName,K.defaultValue=this.defaultValue}static Parse(K){return new qY(K.typeName,K.defaultValue)}}const OY=new qY("any",void 0),hY=(new qY("string",""),new qY("number",0)),Kl=new qY("boolean",!1),Yl=new qY("Vector2",U.m.Zero()),ll=new qY("Qi",U.o.Zero()),vl=(new qY("Vector4",U.p.Zero()),new qY("Matrix",U.d.Identity())),Ul=(new qY("Ti",d.e.Black()),new qY("Ui",new d.g(0,0,0,0)),new qY("Quaternion",U.h.Identity()),new qY("FlowGraphInteger",new SY(0)));class dl extends pY{constructor(K,Y,l,v){super(K,Y,l),this.richType=v}_isSingularConnection(){return 0===this.connectionType}setValue(K,Y){Y._setConnectionValue(this,K)}connectTo(K){super.connectTo(K)}_getValueOrDefault(K){return K._hasConnectionValue(this)?K._getConnectionValue(this):this.richType.defaultValue}getValue(K){return 1===this.connectionType?(K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(K),this._getValueOrDefault(K)):this.isConnected()?this._connectedPoint[0].getValue(K):this._getValueOrDefault(K)}getClassName(){return"FGDataConnection"}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.richType={},this.richType.serialize(K.richType)}static Parse(K,Y){const l=pY.Parse(K,Y);return l.richType=qY.Parse(K.richType),l}}function Al(K){return"Mesh"===K||"AbstractMesh"===K||"GroundMesh"===K||"InstanceMesh"===K||"LinesMesh"===K||"GoldbergMesh"===K||"GreasedLineMesh"===K||"TrailMesh"===K}function cl(K){return"Vector2"===K||"Qi"===K||"Vector4"===K||"Quaternion"===K||"Ti"===K||"Ui"===K}function tl(K,Y,l){var v;const U=(null===Y||void 0===Y||null===(v=Y.getClassName)||void 0===v?void 0:v.call(Y))??"";Al(U)?l[K]={name:Y.name,className:U}:cl(U)?l[K]={value:Y.zi(),className:U}:l[K]=Y}function Zl(K,Y,l){const v=Y[K];let A;const c=null===v||void 0===v?void 0:v.className;return A=Al(c)?l.getMeshByName(v.name):cl(c)?function(K,Y){if("Vector2"===K)return U.m.yi(Y);if("Qi"===K)return U.o.yi(Y);if("Vector4"===K)return U.p.yi(Y);if("Quaternion"===K)return U.h.yi(Y);if("Ti"===K)return new d.e(Y[0],Y[1],Y[2]);if("Ui"===K)return new d.g(Y[0],Y[1],Y[2],Y[3]);throw new Error(`Unknown vector class name ${K}`)}(c,v.value):"Matrix"===c?U.d.yi(v.value):c===SY.ClassName?SY.Parse(v):v&&void 0!==v.value?v.value:v,A}(0,E.f)("FGDataConnection",dl);class ml{constructor(K){var Y;this.config=K,this.uniqueId=(0,jY.d)(),this.name=(null===(Y=this.config)||void 0===Y?void 0:Y.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(K){}registerDataInput(K,Y){const l=new dl(K,0,this,Y);return this.dataInputs.push(l),l}registerDataOutput(K,Y){const l=new dl(K,1,this,Y);return this.dataOutputs.push(l),l}getDataInput(K){return this.dataInputs.find((Y=>Y.name===K))}getDataOutput(K){return this.dataOutputs.find((Y=>Y.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.config={},this.config&&(K.config.name=this.config.name),K.dataInputs=[],K.dataOutputs=[],K.className=this.getClassName();for(const Y of this.dataInputs){const l={};Y.serialize(l),K.dataInputs.push(l)}for(const Y of this.dataOutputs){const l={};Y.serialize(l),K.dataOutputs.push(l)}}getClassName(){return"FGBlock"}static Parse(K,Y){const l=A.d.Instantiate(K.className),v={},U=Y.valueParseFunction??Zl;if(K.config)for(const A in K.config)v[A]=U(A,K.config,Y.hi);var d;("FGSetPropertyBlock"===(d=K.className)||"FGGetPropertyBlock"===d||"FGPlayAnimationBlock"===d||"FGMeshPickEventBlock"===d)&&(v.pathConverter=Y.pathConverter);const c=new l(v);c.uniqueId=K.uniqueId;for(let A=0;A<K.dataInputs.length;A++){const Y=c.getDataInput(K.dataInputs[A].name);if(!Y)throw new Error("Could not find data input with name "+K.dataInputs[A].name+" in block "+K.className);Y.deserialize(K.dataInputs[A])}for(let A=0;A<K.dataOutputs.length;A++){const Y=c.getDataOutput(K.dataOutputs[A].name);if(!Y)throw new Error("Could not find data output with name "+K.dataOutputs[A].name+" in block "+K.className);Y.deserialize(K.dataOutputs[A])}return c.metadata=K.metadata,c.deserialize&&c.deserialize(K),c}}class Vl extends pY{_isSingularConnection(){return 1===this.connectionType}_activateSignal(K){var Y;0===this.connectionType?(K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(K,this),K._increaseExecutionId()):null===(Y=this._connectedPoint[0])||void 0===Y||Y._activateSignal(K)}}(0,E.f)("FlowGraphSignalConnection",Vl);class Ml extends ml{constructor(K){super(K),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(K){const Y=new Vl(K,0,this);return this.signalInputs.push(Y),Y}_registerSignalOutput(K){const Y=new Vl(K,1,this);return this.signalOutputs.push(Y),Y}getSignalInput(K){return this.signalInputs.find((Y=>Y.name===K))}getSignalOutput(K){return this.signalOutputs.find((Y=>Y.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.signalInputs=[],K.signalOutputs=[];for(const Y of this.signalInputs){const l={};Y.serialize(l),K.signalInputs.push(l)}for(const Y of this.signalOutputs){const l={};Y.serialize(l),K.signalOutputs.push(l)}}deserialize(K){for(let Y=0;Y<K.signalInputs.length;Y++){const l=this.getSignalInput(K.signalInputs[Y].name);if(!l)throw new Error("Could not find signal input with name "+K.signalInputs[Y].name+" in block "+K.className);l.deserialize(K.signalInputs[Y])}for(let Y=0;Y<K.signalOutputs.length;Y++){const l=this.getSignalOutput(K.signalOutputs[Y].name);if(!l)throw new Error("Could not find signal output with name "+K.signalOutputs[Y].name+" in block "+K.className);l.deserialize(K.signalOutputs[Y])}}getClassName(){return"FGExecutionBlock"}}class ul extends Ml{constructor(K){super(K),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(K){this._preparePendingTasks(K),K._addPendingBlock(this)}}class ol extends ul{_execute(K){K._notifyExecuteNode(this),this.out._activateSignal(K)}}class Wl{constructor(K){this.uniqueId=(0,jY.d)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new m.b,this._configuration=K}hasVariable(K){return K in this._userVariables}setVariable(K,Y){this._userVariables[K]=Y}getVariable(K){return this._userVariables[K]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(K,Y){return`${K.uniqueId}_${Y}`}_setExecutionVariable(K,Y,l){this._executionVariables[this._getUniqueIdPrefixedName(K,Y)]=l}_getExecutionVariable(K,Y,l){return this._hasExecutionVariable(K,Y)?this._executionVariables[this._getUniqueIdPrefixedName(K,Y)]:l}_deleteExecutionVariable(K,Y){delete this._executionVariables[this._getUniqueIdPrefixedName(K,Y)]}_hasExecutionVariable(K,Y){return this._getUniqueIdPrefixedName(K,Y)in this._executionVariables}_hasConnectionValue(K){return K.uniqueId in this._connectionValues}_setConnectionValue(K,Y){this._connectionValues[K.uniqueId]=Y}_getConnectionValue(K){return this._connectionValues[K.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(K){this._pendingBlocks.push(K)}_removePendingBlock(K){const Y=this._pendingBlocks.indexOf(K);-1!==Y&&this._pendingBlocks.splice(Y,1)}_clearPendingBlocks(){for(const K of this._pendingBlocks)K._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(K){this.onNodeExecutedObservable.notifyObservers(K)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tl;K.uniqueId=this.uniqueId,K._userVariables={};for(const l in this._userVariables)Y(l,this._userVariables[l],K._userVariables);K._connectionValues={};for(const l in this._connectionValues)Y(l,this._connectionValues[l],K._connectionValues)}getClassName(){return"FGContext"}static Parse(K,Y){const l=Y.graph.createContext(),v=Y.valueParseFunction??Zl;l.uniqueId=K.uniqueId;for(const U in K._userVariables){const Y=v(U,K._userVariables,l._configuration.hi);l._userVariables[U]=Y}for(const U in K._connectionValues){const Y=v(U,K._connectionValues,l._configuration.hi);l._connectionValues[U]=Y}return l}}(0,R.d)([(0,H.J)()],Wl.prototype,"uniqueId",void 0);var gl,Jl,nl=l(2395);function Rl(K,Y){return!(!K.parent||K.parent!==Y&&!Rl(K.parent,Y))}class Hl extends ol{constructor(K){super(K),this.config=K}_getReferencedMesh(){const K=this.config.pathConverter.convert(this.config.path),Y=K.info.getObject(K.object);if(!Y||!(Y instanceof P.b))throw new Error("Mesh pick event block requires a valid mesh");return Y}_preparePendingTasks(K){let Y=K._getExecutionVariable(this,"meshPickObserver");if(!Y){const l=this._getReferencedMesh();K._setExecutionVariable(this,"mesh",l),Y=l.va().onPointerObservable.add((Y=>{var v,U,d;Y.type===nl.b.POINTERPICK&&null!==(v=Y.pickInfo)&&void 0!==v&&v.pickedMesh&&((null===(U=Y.pickInfo)||void 0===U?void 0:U.pickedMesh)===l||Rl(null===(d=Y.pickInfo)||void 0===d?void 0:d.pickedMesh,l))&&this._execute(K)}));const v=l.Hi.add((()=>this._onDispose));K._setExecutionVariable(this,"meshPickObserver",Y),K._setExecutionVariable(this,"meshDisposeObserver",v)}}_onDispose(K){this._cancelPendingTasks(K),K._removePendingBlock(this)}_cancelPendingTasks(K){const Y=K._getExecutionVariable(this,"mesh"),l=K._getExecutionVariable(this,"meshPickObserver"),v=K._getExecutionVariable(this,"meshDisposeObserver");Y.va().onPointerObservable.remove(l),Y.Hi.remove(v),K._deleteExecutionVariable(this,"mesh"),K._deleteExecutionVariable(this,"meshPickObserver"),K._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Hl.ClassName}serialize(K){super.serialize(K),K.config.path=this.config.path}}Hl.ClassName="FGMeshPickEventBlock",(0,E.f)(Hl.ClassName,Hl),function(K){K[K.Stopped=0]="Stopped",K[K.Started=1]="Started"}(gl||(gl={}));class zl{constructor(K){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=K.hi,this._coordinator=K.coordinator,this._sceneDisposeObserver=this._scene.Hi.add((()=>this.dispose()))}createContext(){const K=new Wl({hi:this._scene,coordinator:this._coordinator});return this._executionContexts.push(K),K}getContext(K){return this._executionContexts[K]}addEventBlock(K){this._eventBlocks.push(K)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const K of this._executionContexts){const Y=this._getContextualOrder();for(const l of Y)l._startPendingTasks(K)}}}_getContextualOrder(){const K=[];for(const Y of this._eventBlocks)if(Y.getClassName()===Hl.ClassName){const l=Y._getReferencedMesh();let v=0;for(;v<K.length;v++){const Y=K[v]._getReferencedMesh();if(l&&Y&&Rl(l,Y))break}K.splice(v,0,Y)}else K.push(Y);return K}dispose(){if(0!==this.state){this.state=0;for(const K of this._executionContexts)K._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Hi.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(K){const Y=[],l=new Set;for(const v of this._eventBlocks)Y.push(v),l.add(v.uniqueId);for(;Y.length>0;){const v=Y.pop();K(v);for(const K of v.dataInputs)for(const v of K._connectedPoint)l.has(v._ownerBlock.uniqueId)||(Y.push(v._ownerBlock),l.add(v._ownerBlock.uniqueId));if(v instanceof Ml)for(const K of v.signalOutputs)for(const v of K._connectedPoint)l.has(v._ownerBlock.uniqueId)||(Y.push(v._ownerBlock),l.add(v._ownerBlock.uniqueId))}}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Y=arguments.length>1?arguments[1]:void 0;K.allBlocks=[],this.visitAllBlocks((Y=>{const l={};Y.serialize(l),K.allBlocks.push(l)})),K.executionContexts=[];for(const l of this._executionContexts){const v={};l.serialize(v,Y),K.executionContexts.push(v)}}static GetDataOutConnectionByUniqueId(K,Y){for(const l of K)for(const K of l.dataOutputs)if(K.uniqueId===Y)return K;throw new Error("Could not find data out connection with unique id "+Y)}static GetSignalInConnectionByUniqueId(K,Y){for(const l of K)if(l instanceof Ml)for(const K of l.signalInputs)if(K.uniqueId===Y)return K;throw new Error("Could not find signal in connection with unique id "+Y)}static Parse(K,Y){const l=Y.coordinator.createGraph(),v=[],U=Y.valueParseFunction??Zl;for(const d of K.allBlocks){const K=ml.Parse(d,{hi:Y.coordinator.config.hi,pathConverter:Y.pathConverter,valueParseFunction:U});v.push(K),K instanceof ol&&l.addEventBlock(K)}for(const d of v){for(const K of d.dataInputs)for(const Y of K.connectedPointIds){const l=zl.GetDataOutConnectionByUniqueId(v,Y);K.connectTo(l)}if(d instanceof Ml)for(const K of d.signalOutputs)for(const Y of K.connectedPointIds){const l=zl.GetSignalInConnectionByUniqueId(v,Y);K.connectTo(l)}}for(const d of K.executionContexts)Wl.Parse(d,{graph:l,valueParseFunction:U});return l}}class rl{constructor(K){this.config=K,this._flowGraphs=[],this._customEventsMap=new Map,this.config.hi.Hi.add((()=>{this.dispose()}));(rl.SceneCoordinators.get(this.config.hi)??[]).push(this)}createGraph(){const K=new zl({hi:this.config.hi,coordinator:this});return this._flowGraphs.push(K),K}removeGraph(K){const Y=this._flowGraphs.indexOf(K);-1!==Y&&(K.dispose(),this._flowGraphs.splice(Y,1))}start(){this._flowGraphs.forEach((K=>K.start()))}dispose(){this._flowGraphs.forEach((K=>K.dispose())),this._flowGraphs.length=0;const K=rl.SceneCoordinators.get(this.config.hi)??[],Y=K.indexOf(this);-1!==Y&&K.splice(Y,1)}serialize(K,Y){K._flowGraphs=[],this._flowGraphs.forEach((l=>{const v={};l.serialize(v,Y),K._flowGraphs.push(v)}))}static Parse(K,Y){var l;const v=Y.valueParseFunction??Zl,U=new rl({hi:Y.hi});return null===(l=K._flowGraphs)||void 0===l||l.forEach((K=>{zl.Parse(K,{coordinator:U,valueParseFunction:v,pathConverter:Y.pathConverter})})),U}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(K){let Y=this._customEventsMap.get(K);return Y||(Y=new m.b,this._customEventsMap.set(K,Y)),Y}notifyCustomEvent(K,Y){const l=this._customEventsMap.get(K);l&&l.notifyObservers(Y)}}rl.SceneCoordinators=new Map;class El extends ol{_preparePendingTasks(K){if(!K._getExecutionVariable(this,"sceneReadyObserver")){const Y=K.configuration.hi.onReadyObservable.add((()=>{this._execute(K)}));K._setExecutionVariable(this,"sceneReadyObserver",Y)}}_cancelPendingTasks(K){const Y=K._getExecutionVariable(this,"sceneReadyObserver");K.configuration.hi.onReadyObservable.remove(Y),K._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return El.ClassName}}El.ClassName="FGSceneReadyEventBlock",(0,E.f)("FGSceneReadyEventBlock",El);class yl extends ol{_preparePendingTasks(K){if(!K._getExecutionVariable(this,"sceneBeforeRender")){const Y=K.configuration.hi.onBeforeRenderObservable.add((()=>{this._execute(K)}));K._setExecutionVariable(this,"sceneBeforeRender",Y)}}_cancelPendingTasks(K){const Y=K._getExecutionVariable(this,"sceneBeforeRender");K.configuration.hi.onBeforeRenderObservable.remove(Y),K._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return yl.ClassName}}yl.ClassName="FGSceneTickEventBlock",(0,E.f)(yl.ClassName,yl);class Tl extends Ml{constructor(K){super(K),this.out=this._registerSignalOutput("out")}}class el extends Tl{constructor(K){super(K),this.message=this.registerDataInput("message",OY)}_execute(K){const Y=this.message.getValue(K);W.e.Log(Y),this.out._activateSignal(K)}getClassName(){return el.ClassName}}el.ClassName="FGConsoleLogBlock",(0,E.f)(el.ClassName,el),function(K){K[K.INIT=0]="INIT",K[K.STARTED=1]="STARTED",K[K.ENDED=2]="ENDED"}(Jl||(Jl={}));class il{constructor(K){this.onEachCountObservable=new m.b,this.onTimerAbortedObservable=new m.b,this.onTimerEndedObservable=new m.b,this.onStateChangedObservable=new m.b,this._observer=null,this._breakOnNextTick=!1,this._tick=K=>{const Y=Date.now();this._timer=Y-this._startTime;const l={startTime:this._startTime,currentTime:Y,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:K},v=this._breakOnNextTick||this._breakCondition(l);v||this._timer>=this._timeToEnd?this._stop(l,v):this.onEachCountObservable.notifyObservers(l)},this._setState(0),this._contextObservable=K.contextObservable,this._observableParameters=K.observableParameters??{},this._breakCondition=K.breakCondition??(()=>!1),this._timeToEnd=K.timeout,K.onEnded&&this.onTimerEndedObservable.add(K.onEnded),K._k&&this.onEachCountObservable.add(K._k),K.onAborted&&this.onTimerAbortedObservable.add(K.onAborted)}set breakCondition(K){this._breakCondition=K}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=K,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(K){this._state=K,this.onStateChangedObservable.notifyObservers(this._state)}_stop(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),Y?this.onTimerAbortedObservable.notifyObservers(K):this.onTimerEndedObservable.notifyObservers(K)}}class Dl extends ul{constructor(K){super(K),this.timeout=this.registerDataInput("timeout",hY)}_preparePendingTasks(K){const Y=this.timeout.getValue(K);if(void 0!==Y&&Y>=0){const l=K._getExecutionVariable(this,"runningTimers")||[],v=K.configuration.hi,U=new il({timeout:Y,contextObservable:v.onBeforeRenderObservable,onEnded:()=>this._onEnded(U,K)});U.start(),l.push(U),K._setExecutionVariable(this,"runningTimers",l)}}_execute(K){this._startPendingTasks(K),this.out._activateSignal(K)}_onEnded(K,Y){const l=Y._getExecutionVariable(this,"runningTimers")||[],v=l.indexOf(K);-1!==v?l.splice(v,1):A.d.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),Y._removePendingBlock(this),this.done._activateSignal(Y)}_cancelPendingTasks(K){const Y=K._getExecutionVariable(this,"runningTimers")||[];for(const l of Y)l.dispose();K._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Dl.ClassName}}Dl.ClassName="FGTimerBlock",(0,E.f)("FGTimerBlock",Dl);class Bl extends Tl{constructor(K){super(K),this.config=K;for(let Y=0;Y<this.config.eventData.length;Y++){const K=this.config.eventData[Y];this.registerDataInput(K,OY)}}_execute(K){const Y=this.config.eventId,l=this.dataInputs.map((Y=>Y.getValue(K)));K.configuration.coordinator.notifyCustomEvent(Y,l),this.out._activateSignal(K)}getClassName(){return Bl.ClassName}}Bl.ClassName="FGSendCustomEventBlock",(0,E.f)("FGSendCustomEventBlock",Bl);class Pl extends ol{constructor(K){super(K),this.config=K;for(let Y=0;Y<this.config.eventData.length;Y++){const K=this.config.eventData[Y];this.registerDataOutput(K,OY)}}_preparePendingTasks(K){const Y=K.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=Y.add((Y=>{for(let l=0;l<Y.length;l++)this.dataOutputs[l].setValue(Y[l],K);this._execute(K)}))}_cancelPendingTasks(K){const Y=K.configuration.coordinator.getCustomEventObservable(this.config.eventId);Y?Y.remove(this._eventObserver):A.d.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return Pl.ClassName}serialize(K){super.serialize(K),K.eventId=this.config.eventId,K.eventData=this.config.eventData}}Pl.ClassName="FGReceiveCustomEventBlock",(0,E.f)(Pl.ClassName,Pl);class Gl extends Ml{constructor(K){super(K),this.config=K,this.outFlows=[];for(let Y=0;Y<this.config.numberOutputFlows;Y++)this.outFlows.push(this._registerSignalOutput(`${Y}`))}_execute(K){for(let Y=0;Y<this.config.numberOutputFlows;Y++)this.outFlows[Y]._activateSignal(K)}getClassName(){return Gl.ClassName}}Gl.ClassName="FGSequenceBlock",(0,E.f)(Gl.ClassName,Gl);const Ql=new RegExp(/\{(\w+)\}/g);class Xl{constructor(K,Y){this.path=K,this.ownerBlock=Y,this.templatedInputs=[];let l=Ql.exec(K);for(;l;){const[,v]=l;this.templatedInputs.push(Y.registerDataInput(v,Ul)),l=Ql.exec(K)}}getAccessor(K,Y){let l=this.path;for(const v of this.templatedInputs){const K=v.getValue(Y).value;l=l.replace(`{${v.name}}`,K.toString())}return K.convert(l)}}class fl extends ml{constructor(K){super(K),this.config=K,this.value=this.registerDataOutput("value",OY),this.templateComponent=new Xl(K.path,this)}_updateOutputs(K){const Y=this.templateComponent.getAccessor(this.config.pathConverter,K),l=Y.info.get(Y.object);this.value.setValue(l,K)}getClassName(){return fl.ClassName}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.config.path=this.config.path}}fl.ClassName="FGGetPropertyBlock",(0,E.f)(fl.ClassName,fl);class wl extends Tl{constructor(K){super(K),this.config=K,this.a=this.registerDataInput("a",OY),this.templateComponent=new Xl(K.path,this)}_execute(K){const Y=this.a.getValue(K),l=this.templateComponent.getAccessor(this.config.pathConverter,K);l.info.set(Y,l.object),this.out._activateSignal(K)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.config.path=this.config.path}getClassName(){return wl.ClassName}}wl.ClassName="FGSetPropertyBlock",(0,E.f)("FGSetPropertyBlock",wl);const kl="cachedOperationValue",Il="cachedExecutionId";class Ll extends ml{constructor(K,Y){super(Y),this.value=this.registerDataOutput("value",K)}_updateOutputs(K){const Y=K._getExecutionVariable(this,Il),l=K._getExecutionVariable(this,kl);if(void 0!==l&&Y===K.executionId)this.value.setValue(l,K);else{const Y=this._doOperation(K);K._setExecutionVariable(this,kl,Y),K._setExecutionVariable(this,Il,K.executionId),this.value.setValue(Y,K)}}}class al extends Ll{constructor(K,Y,l,v,U,d){super(l,d),this._operation=v,this._className=U,this.a=this.registerDataInput("a",K),this.b=this.registerDataInput("b",Y)}_doOperation(K){return this._operation(this.a.getValue(K),this.b.getValue(K))}getClassName(){return this._className}}class Fl extends Ll{constructor(K,Y,l,v){super(K,v),this._operation=Y,this._className=l}_doOperation(K){return this._operation()}getClassName(){return this._className}}class sl extends Ll{constructor(K,Y,l,v,U){super(Y,U),this._operation=l,this._className=v,this.a=this.registerDataInput("a",K)}_doOperation(K){return this._operation(this.a.getValue(K))}getClassName(){return this._className}}class bl extends Ll{constructor(K,Y,l,v,U,d,A){super(v,A),this._operation=U,this._className=d,this.a=this.registerDataInput("a",K),this.b=this.registerDataInput("b",Y),this.c=this.registerDataInput("c",l)}_doOperation(K){return this._operation(this.a.getValue(K),this.b.getValue(K),this.c.getValue(K))}getClassName(){return this._className}}function xl(K){return K.getClassName?K.getClassName():""}function Cl(K,Y){return"Vector2"===K&&"Vector2"===Y||"Qi"===K&&"Qi"===Y||"Vector4"===K&&"Vector4"===Y}function Nl(K,Y){return"Matrix"===K&&"Matrix"===Y}function jl(K,Y){return"FlowGraphInteger"===K&&"FlowGraphInteger"===Y}class pl extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicAdd(K,Y)),pl.ClassName,K)}_polymorphicAdd(K,Y){const l=xl(K),v=xl(Y);return Cl(l,v)||Nl(l,v)||jl(l,v)?K.add(Y):K+Y}}pl.ClassName="FGAddBlock",(0,E.f)(pl.ClassName,pl);class Sl extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicAdd(K,Y)),Sl.ClassName,K)}_polymorphicAdd(K,Y){const l=xl(K),v=xl(Y);return Cl(l,v)||jl(l,v)?K.Lg(Y):Nl(l,v)?K.add(Y.scale(-1)):K-Y}}Sl.ClassName="FGSubBlock",(0,E.f)(Sl.ClassName,Sl);class ql extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicMultiply(K,Y)),ql.ClassName,K)}_polymorphicMultiply(K,Y){const l=xl(K),v=xl(Y);return Cl(l,v)||jl(l,v)?K.multiply(Y):Nl(l,v)?U.d.FromValues(K.m[0]*Y.m[0],K.m[4]*Y.m[4],K.m[8]*Y.m[8],K.m[12]*Y.m[12],K.m[1]*Y.m[1],K.m[5]*Y.m[5],K.m[9]*Y.m[9],K.m[13]*Y.m[13],K.m[2]*Y.m[2],K.m[6]*Y.m[6],K.m[10]*Y.m[10],K.m[14]*Y.m[14],K.m[3]*Y.m[3],K.m[7]*Y.m[7],K.m[11]*Y.m[11],K.m[15]*Y.m[15]):K*Y}}ql.ClassName="FGMultiplyBlock",(0,E.f)(ql.ClassName,ql);class Ol extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicDivide(K,Y)),Ol.ClassName,K)}_polymorphicDivide(K,Y){const l=xl(K),v=xl(Y);return Cl(l,v)||jl(l,v)?K.divide(Y):Nl(l,v)?U.d.FromValues(K.m[0]/Y.m[0],K.m[4]/Y.m[4],K.m[8]/Y.m[8],K.m[12]/Y.m[12],K.m[1]/Y.m[1],K.m[5]/Y.m[5],K.m[9]/Y.m[9],K.m[13]/Y.m[13],K.m[2]/Y.m[2],K.m[6]/Y.m[6],K.m[10]/Y.m[10],K.m[14]/Y.m[14],K.m[3]/Y.m[3],K.m[7]/Y.m[7],K.m[11]/Y.m[11],K.m[15]/Y.m[15]):K/Y}}Ol.ClassName="FGDivideBlock",(0,E.f)(Ol.ClassName,Ol);class hl extends Fl{constructor(K){super(hY,(()=>Math.random()),hl.ClassName,K)}}hl.ClassName="FGRandomBlock",(0,E.f)(hl.ClassName,hl);class Kv extends al{constructor(K){super(OY,OY,hY,((K,Y)=>this._polymorphicDot(K,Y)),Kv.ClassName,K)}_polymorphicDot(K,Y){switch(xl(K)){case"Vector2":return U.m.Dot(K,Y);case"Qi":return U.o.Dot(K,Y);case"Vector4":return U.p.Dot(K,Y);default:throw new Error(`Cannot get dot product of ${K} and ${Y}`)}}}Kv.ClassName="FGDotBlock",(0,E.f)(Kv.ClassName,Kv);class Yv extends Fl{constructor(K){super(hY,(()=>Math.E),Yv.ClassName,K)}}Yv.ClassName="FGEBlock",(0,E.f)(Yv.ClassName,Yv);class lv extends Fl{constructor(K){super(hY,(()=>Math.PI),lv.ClassName,K)}}lv.ClassName="FGPIBlock",(0,E.f)(lv.ClassName,lv);class vv extends Fl{constructor(K){super(hY,(()=>Number.POSITIVE_INFINITY),vv.ClassName,K)}}vv.ClassName="FGInfBlock",(0,E.f)(vv.ClassName,vv);class Uv extends Fl{constructor(K){super(hY,(()=>Number.NaN),Uv.ClassName,K)}}function dv(K,Y){switch(xl(K)){case"FlowGraphInteger":return new SY(Y(K.value));case"Vector2":return new U.m(Y(K.x),Y(K.y));case"Qi":return new U.o(Y(K.x),Y(K.y),Y(K.z));case"Vector4":return new U.p(Y(K.x),Y(K.y),Y(K.z),Y(K.w));case"Matrix":return U.d.FromValues(Y(K.m[0]),Y(K.m[4]),Y(K.m[8]),Y(K.m[12]),Y(K.m[1]),Y(K.m[5]),Y(K.m[9]),Y(K.m[13]),Y(K.m[2]),Y(K.m[6]),Y(K.m[10]),Y(K.m[14]),Y(K.m[3]),Y(K.m[7]),Y(K.m[11]),Y(K.m[15]));default:return Y(K)}}Uv.ClassName="FGNaNBlock",(0,E.f)(Uv.ClassName,Uv);class Av extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicAbs(K)),Av.ClassName,K)}_polymorphicAbs(K){return dv(K,Math.abs)}}Av.ClassName="FGAbsBlock",(0,E.f)(Av.ClassName,Av);class cv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicSign(K)),cv.ClassName,K)}_polymorphicSign(K){return dv(K,Math.sign)}}cv.ClassName="FGSignBlock",(0,E.f)(cv.ClassName,cv);class tv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicTrunc(K)),tv.ClassName,K)}_polymorphicTrunc(K){return dv(K,Math.trunc)}}tv.ClassName="FGTruncBlock",(0,E.f)(tv.ClassName,tv);class Zv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicFloor(K)),Zv.ClassName,K)}_polymorphicFloor(K){return dv(K,Math.floor)}}Zv.ClassName="FGFloorBlock",(0,E.f)(Zv.ClassName,Zv);class mv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicCeiling(K)),mv.ClassName,K)}_polymorphicCeiling(K){return dv(K,Math.ceil)}}mv.ClassName="FGCeilBlock",(0,E.f)(mv.ClassName,mv);class Vv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicFract(K)),Vv.ClassName,K)}_polymorphicFract(K){return dv(K,(K=>K-Math.floor(K)))}}Vv.ClassName="FGFractBlock",(0,E.f)(Vv.ClassName,Vv);class Mv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicNeg(K)),Mv.ClassName,K)}_polymorphicNeg(K){return dv(K,(K=>-K))}}function uv(K,Y,l){switch(xl(K)){case"FlowGraphInteger":return new SY(l(K.value,Y.value));case"Vector2":return new U.m(l(K.x,Y.x),l(K.y,Y.y));case"Qi":return new U.o(l(K.x,Y.x),l(K.y,Y.y),l(K.z,Y.z));case"Vector4":return new U.p(l(K.x,Y.x),l(K.y,Y.y),l(K.z,Y.z),l(K.w,Y.w));case"Matrix":return U.d.FromValues(l(K.m[0],Y.m[0]),l(K.m[4],Y.m[4]),l(K.m[8],Y.m[8]),l(K.m[12],Y.m[12]),l(K.m[1],Y.m[1]),l(K.m[5],Y.m[5]),l(K.m[9],Y.m[9]),l(K.m[13],Y.m[13]),l(K.m[2],Y.m[2]),l(K.m[6],Y.m[6]),l(K.m[10],Y.m[10]),l(K.m[14],Y.m[14]),l(K.m[3],Y.m[3]),l(K.m[7],Y.m[7]),l(K.m[11],Y.m[11]),l(K.m[15],Y.m[15]));default:return l(K,Y)}}Mv.ClassName="FGNegBlock",(0,E.f)(Mv.ClassName,Mv);class ov extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicRemainder(K,Y)),ov.ClassName,K)}_polymorphicRemainder(K,Y){return uv(K,Y,((K,Y)=>K%Y))}}ov.ClassName="FGRemainderBlock",(0,E.f)(ov.ClassName,ov);class Wv extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicMin(K,Y)),Wv.ClassName,K)}_polymorphicMin(K,Y){return uv(K,Y,Math.min)}}Wv.ClassName="FGMinBlock",(0,E.f)(Wv.ClassName,Wv);class gv extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicMax(K,Y)),gv.ClassName,K)}_polymorphicMax(K,Y){return uv(K,Y,Math.max)}}function Jv(K,Y,l){return Math.min(Math.max(K,Math.min(Y,l)),Math.max(Y,l))}function nv(K,Y,l,v){switch(xl(K)){case"FlowGraphInteger":return new SY(v(K.value,Y.value,l.value));case"Vector2":return new U.m(v(K.x,Y.x,l.x),v(K.y,Y.y,l.y));case"Qi":return new U.o(v(K.x,Y.x,l.x),v(K.y,Y.y,l.y),v(K.z,Y.z,l.z));case"Vector4":return new U.p(v(K.x,Y.x,l.x),v(K.y,Y.y,l.y),v(K.z,Y.z,l.z),v(K.w,Y.w,l.w));case"Matrix":return U.d.FromValues(v(K.m[0],Y.m[0],l.m[0]),v(K.m[4],Y.m[4],l.m[4]),v(K.m[8],Y.m[8],l.m[8]),v(K.m[12],Y.m[12],l.m[12]),v(K.m[1],Y.m[1],l.m[1]),v(K.m[5],Y.m[5],l.m[5]),v(K.m[9],Y.m[9],l.m[9]),v(K.m[13],Y.m[13],l.m[13]),v(K.m[2],Y.m[2],l.m[2]),v(K.m[6],Y.m[6],l.m[6]),v(K.m[10],Y.m[10],l.m[10]),v(K.m[14],Y.m[14],l.m[14]),v(K.m[3],Y.m[3],l.m[3]),v(K.m[7],Y.m[7],l.m[7]),v(K.m[11],Y.m[11],l.m[11]),v(K.m[15],Y.m[15],l.m[15]));default:return v(K,Y,l)}}gv.ClassName="FGMaxBlock",(0,E.f)(gv.ClassName,gv);class Rv extends bl{constructor(K){super(OY,OY,OY,OY,((K,Y,l)=>this._polymorphicClamp(K,Y,l)),Rv.ClassName,K)}_polymorphicClamp(K,Y,l){return nv(K,Y,l,Jv)}}function Hv(K){return Math.min(Math.max(K,0),1)}Rv.ClassName="FGClampBlock",(0,E.f)(Rv.ClassName,Rv);class zv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicSaturate(K)),zv.ClassName,K)}_polymorphicSaturate(K){return dv(K,Hv)}}zv.ClassName="FGSaturateBlock",(0,E.f)(zv.ClassName,zv);class rv extends bl{constructor(K){super(OY,OY,OY,OY,((K,Y,l)=>this._polymorphicInterpolate(K,Y,l)),rv.ClassName,K)}_interpolate(K,Y,l){return(1-l)*K+l*Y}_polymorphicInterpolate(K,Y,l){return nv(K,Y,l,this._interpolate)}}rv.ClassName="FGInterpolateBlock",(0,E.f)(rv.ClassName,rv);class Ev extends al{constructor(K){super(OY,OY,Kl,((K,Y)=>this._polymorphicEq(K,Y)),Ev.ClassName,K)}_polymorphicEq(K,Y){const l=xl(K),v=xl(Y);return Cl(l,v)||Nl(l,v)||jl(l,v)?K.equals(Y):K===Y}}function yv(K,Y,l){const v=xl(K);if(v===xl(Y)){if(""===v)return l(K,Y);if("FlowGraphInteger"===v)return l(K.value,Y.value);throw new Error(`Cannot compare ${K} and ${Y}`)}throw new Error(`${K} and ${Y} are of different types.`)}Ev.ClassName="FGEqBlock",(0,E.f)(Ev.ClassName,Ev);class Tv extends al{constructor(K){super(OY,OY,Kl,((K,Y)=>this._polymorphicLessThan(K,Y)),Tv.ClassName,K)}_polymorphicLessThan(K,Y){return yv(K,Y,((K,Y)=>K<Y))}}Tv.ClassName="FGLessThanBlock",(0,E.f)(Tv.ClassName,Tv);class ev extends al{constructor(K){super(OY,OY,Kl,((K,Y)=>this._polymorphicLessThanOrEqual(K,Y)),ev.ClassName,K)}_polymorphicLessThanOrEqual(K,Y){return yv(K,Y,((K,Y)=>K<=Y))}}ev.ClassName="FGLessThanOrEqualBlock";class iv extends al{constructor(K){super(OY,OY,Kl,((K,Y)=>this._polymorphicGreaterThan(K,Y)),iv.ClassName,K)}_polymorphicGreaterThan(K,Y){return yv(K,Y,((K,Y)=>K>Y))}}iv.ClassName="FGGreaterThanBlock",(0,E.f)(iv.ClassName,iv);class Dv extends al{constructor(K){super(OY,OY,Kl,((K,Y)=>this._polymorphicGreaterThanOrEqual(K,Y)),Dv.ClassName,K)}_polymorphicGreaterThanOrEqual(K,Y){return yv(K,Y,((K,Y)=>K>=Y))}}Dv.ClassName="FGGreaterThanOrEqualBlock",(0,E.f)(Dv.ClassName,Dv);class Bv extends sl{constructor(K){super(OY,Kl,(K=>this._polymorphicIsNan(K)),Bv.ClassName,K)}_polymorphicIsNan(K){const Y=xl(K);if(""===Y)return isNaN(K);if("FlowGraphInteger"===Y)return isNaN(K.value);throw new Error(`Cannot get NaN of ${K}`)}}Bv.ClassName="FGIsNanBlock",(0,E.f)(Bv.ClassName,Bv);class Pv extends sl{constructor(K){super(OY,Kl,(K=>this._polymorphicIsInf(K)),Pv.ClassName,K)}_polymorphicIsInf(K){const Y=xl(K);if(""===Y)return!isFinite(K);if("FlowGraphInteger"===Y)return!isFinite(K.value);throw new Error(`Cannot get isInf of ${K}`)}}Pv.ClassName="FGIsInfBlock";class Gv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicDegToRad(K)),Gv.ClassName,K)}_degToRad(K){return K*Math.PI/180}_polymorphicDegToRad(K){return dv(K,this._degToRad)}}Gv.ClassName="FGDegToRadBlock",(0,E.f)(Gv.ClassName,Gv);class Qv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicRadToDeg(K)),Qv.ClassName,K)}_radToDeg(K){return 180*K/Math.PI}_polymorphicRadToDeg(K){return dv(K,this._radToDeg)}}Qv.ClassName="FGRadToDegBlock",(0,E.f)(Qv.ClassName,Qv);class Xv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicSin(K)),Xv.ClassName,K)}_polymorphicSin(K){return dv(K,Math.sin)}}Xv.ClassName="FGSinBlock",(0,E.f)(Xv.ClassName,Xv);class fv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicCos(K)),fv.ClassName,K)}_polymorphicCos(K){return dv(K,Math.cos)}}fv.ClassName="FGCosBlock",(0,E.f)(fv.ClassName,fv);class wv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicTan(K)),wv.ClassName,K)}_polymorphicTan(K){return dv(K,Math.tan)}}wv.ClassName="FGTanBlock",(0,E.f)(wv.ClassName,wv);class kv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicAsin(K)),kv.ClassName,K)}_polymorphicAsin(K){return dv(K,Math.asin)}}kv.ClassName="FGAsinBlock",(0,E.f)(kv.ClassName,kv);class Iv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicAcos(K)),Iv.ClassName,K)}_polymorphicAcos(K){return dv(K,Math.acos)}}Iv.ClassName="FGAcosBlock",(0,E.f)(Iv.ClassName,Iv);class Lv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicAtan(K)),Lv.ClassName,K)}_polymorphicAtan(K){return dv(K,Math.atan)}}Lv.ClassName="FGAtanBlock",(0,E.f)(Lv.ClassName,Lv);class av extends al{constructor(K){super(OY,OY,OY,((K,Y)=>this._polymorphicAtan2(K,Y)),av.ClassName,K)}_polymorphicAtan2(K,Y){return uv(K,Y,Math.atan2)}}av.ClassName="FGAtan2Block",(0,E.f)(av.ClassName,av);class Fv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicSinh(K)),Fv.ClassName,K)}_polymorphicSinh(K){return dv(K,Math.sinh)}}Fv.ClassName="FGSinhBlock",(0,E.f)(Fv.ClassName,Fv);class sv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicCosh(K)),sv.ClassName,K)}_polymorphicCosh(K){return dv(K,Math.cosh)}}sv.ClassName="FGCoshBlock",(0,E.f)(sv.ClassName,sv);class bv extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicTanh(K)),bv.ClassName,K)}_polymorphicTanh(K){return dv(K,Math.tanh)}}bv.ClassName="FGTanhBlock",(0,E.f)(bv.ClassName,bv);class xv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicAsinh(K)),xv.ClassName,K)}_polymorphicAsinh(K){return dv(K,Math.asinh)}}xv.ClassName="FGAsinhBlock",(0,E.f)(xv.ClassName,xv);class Cv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicAcosh(K)),Cv.ClassName,K)}_polymorphicAcosh(K){return dv(K,Math.acosh)}}Cv.ClassName="FGAcoshBlock",(0,E.f)(Cv.ClassName,Cv);class Nv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicAtanh(K)),Nv.ClassName,K)}_polymorphicAtanh(K){return dv(K,Math.atanh)}}Nv.ClassName="FGAtanhBlock",(0,E.f)(Nv.ClassName,Nv);class jv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicExp(K)),jv.ClassName,K)}_polymorphicExp(K){return dv(K,Math.exp)}}jv.ClassName="FGExpBlock",(0,E.f)(jv.ClassName,jv);class pv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicLog(K)),pv.ClassName,K)}_polymorphicLog(K){return dv(K,Math.log)}}pv.ClassName="FGLogBlock",(0,E.f)(pv.ClassName,pv);class Sv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicLog2(K)),Sv.ClassName,K)}_polymorphicLog2(K){return dv(K,Math.log2)}}Sv.ClassName="FGLog2Block",(0,E.f)(Sv.ClassName,Sv);class qv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicLog10(K)),qv.ClassName,K)}_polymorphicLog10(K){return dv(K,Math.log10)}}qv.ClassName="FGLog10Block",(0,E.f)(qv.ClassName,qv);class Ov extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicSqrt(K)),Ov.ClassName,K)}_polymorphicSqrt(K){return dv(K,Math.sqrt)}}Ov.ClassName="FGSqrtBlock",(0,E.f)(Ov.ClassName,Ov);class hv extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicCubeRoot(K)),hv.ClassName,K)}_polymorphicCubeRoot(K){return dv(K,Math.cbrt)}}hv.ClassName="FGCubeRootBlock",(0,E.f)(hv.ClassName,hv);class KU extends al{constructor(K){super(OY,hY,hY,((K,Y)=>this._polymorphicPow(K,Y)),KU.ClassName,K)}_polymorphicPow(K,Y){return uv(K,Y,Math.pow)}}KU.ClassName="FGPowBlock",(0,E.f)(KU.ClassName,KU);class YU extends sl{constructor(K){super(OY,hY,(K=>this._polymorphicLength(K)),YU.ClassName,K)}_polymorphicLength(K){switch(xl(K)){case"Vector2":case"Qi":case"Vector4":return K.length();default:throw new Error(`Cannot compute length of value ${K}`)}}}YU.ClassName="FGLengthBlock",(0,E.f)(YU.ClassName,YU);class lU extends sl{constructor(K){super(OY,OY,(K=>this._polymorphicNormalize(K)),lU.ClassName,K)}_polymorphicNormalize(K){switch(xl(K)){case"Vector2":case"Qi":case"Vector4":return K.normalize();default:throw new Error(`Cannot normalize value ${K}`)}}}lU.ClassName="FGNormalizeBlock",(0,E.f)(lU.ClassName,lU);class vU extends al{constructor(K){super(ll,ll,ll,((K,Y)=>U.o.Cross(K,Y)),vU.ClassName,K)}}vU.ClassName="FGCrossBlock",(0,E.f)(vU.ClassName,vU);class UU extends al{constructor(K){super(Yl,hY,Yl,((K,Y)=>U.m.Transform(K,U.d.RotationZ(Y))),UU.ClassName,K)}}UU.ClassName="FGRotate2DBlock",(0,E.f)(UU.ClassName,UU);class dU extends bl{constructor(K){super(ll,ll,hY,ll,((K,Y,l)=>U.o.TransformCoordinates(K,U.d.RotationAxis(Y,l))),dU.ClassName,K)}}dU.ClassName="FGRotate3DBlock",(0,E.f)(dU.ClassName,dU);class AU extends sl{constructor(K){super(vl,vl,(K=>U.d.Transpose(K)),AU.ClassName,K)}}AU.ClassName="FGTransposeBlock",(0,E.f)(AU.ClassName,AU);class cU extends sl{constructor(K){super(vl,hY,(K=>K.determinant()),cU.ClassName,K)}}cU.ClassName="FGDeterminantBlock",(0,E.f)(cU.ClassName,cU);class tU extends sl{constructor(K){super(vl,vl,(K=>U.d.Invert(K)),tU.ClassName,K)}}tU.ClassName="FGInvertMatrixBlock",(0,E.f)(tU.ClassName,tU);class ZU extends al{constructor(K){super(vl,vl,vl,((K,Y)=>Y.multiply(K)),ZU.ClassName,K)}}ZU.ClassName="FGMatMulBlock",(0,E.f)(ZU.ClassName,ZU);class mU extends sl{constructor(K){super(Ul,Ul,(K=>new SY(~K.value)),mU.ClassName,K)}}mU.ClassName="FGBitwiseNotBlock",(0,E.f)(mU.ClassName,mU);class VU extends al{constructor(K){super(Ul,Ul,Ul,((K,Y)=>new SY(K.value&Y.value)),VU.ClassName,K)}}VU.ClassName="FGBitwiseAndBlock",(0,E.f)(VU.ClassName,VU);class MU extends al{constructor(K){super(Ul,Ul,Ul,((K,Y)=>new SY(K.value|Y.value)),MU.ClassName,K)}}MU.ClassName="FGBitwiseOrBlock",(0,E.f)(MU.ClassName,MU);class uU extends al{constructor(K){super(Ul,Ul,Ul,((K,Y)=>new SY(K.value^Y.value)),uU.ClassName,K)}}uU.ClassName="FGBitwiseXorBlock",(0,E.f)(uU.ClassName,uU);class oU extends al{constructor(K){super(Ul,Ul,Ul,((K,Y)=>new SY(K.value<<Y.value)),oU.ClassName,K)}}oU.ClassName="FGBitwiseLeftShiftBlock",(0,E.f)(oU.ClassName,oU);class WU extends al{constructor(K){super(Ul,Ul,Ul,((K,Y)=>new SY(K.value>>Y.value)),WU.ClassName,K)}}WU.ClassName="FGBitwiseRightShiftBlock",(0,E.f)(WU.ClassName,WU);class gU extends sl{constructor(K){super(Ul,Ul,(K=>new SY(Math.clz32(K.value))),gU.ClassName,K)}}gU.ClassName="FGCountLeadingZerosBlock",(0,E.f)(gU.ClassName,gU);class JU extends sl{constructor(K){super(Ul,Ul,(K=>new SY(K.value?31-Math.clz32(K.value&-K.value):32)),JU.ClassName,K)}}JU.ClassName="FGCountTrailingZerosBlock",(0,E.f)(JU.ClassName,JU);class nU extends sl{constructor(K){super(Ul,Ul,(K=>new SY(function(K){let Y=0;for(;K;)Y+=1&K,K>>=1;return Y}(K.value))),nU.ClassName,K)}}nU.ClassName="FGCountOneBitsBlock",(0,E.f)(nU.ClassName,nU);class RU extends Tl{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new SY(0)};super(K),this.config=K,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Ul),this.value=this.registerDataOutput("value",Ul)}_execute(K,Y){if(Y===this.reset)this.value.setValue(this.config.startIndex,K);else{const Y=this.value.getValue(K);Y.value<this.n.getValue(K).value&&(this.value.setValue(new SY(Y.value+1),K),this.out._activateSignal(K))}}getClassName(){return RU.ClassName}}RU.ClassName="FGDoNBlock",(0,E.f)(RU.ClassName,RU);class HU extends ml{constructor(K){super(K),this.config=K,this.output=this.registerDataOutput(K.variableName,OY)}_updateOutputs(K){const Y=this.config.variableName;K.hasVariable(Y)&&this.output.setValue(K.getVariable(Y),K)}getClassName(){return HU.ClassName}serialize(K){super.serialize(K),K.config.variableName=this.config.variableName}}HU.ClassName="FGGetVariableBlock",(0,E.f)(HU.ClassName,HU);class zU extends Tl{constructor(K){super(K),this.config=K,this.input=this.registerDataInput(K.variableName,OY)}_execute(K){const Y=this.config.variableName,l=this.input.getValue(K);K.setVariable(Y,l),this.out._activateSignal(K)}getClassName(){return zU.ClassName}}zU.ClassName="FGSetVariableBlock",(0,E.f)(zU.ClassName,zU);class rU extends Tl{constructor(K){super(K),this.config=K,this.condition=this.registerDataInput("condition",Kl),this.loopBody=this._registerSignalOutput("loopBody")}_execute(K,Y){var l;let v=this.condition.getValue(K);for(null!==(l=this.config)&&void 0!==l&&l.isDo&&!v&&this.loopBody._activateSignal(K);v;)this.loopBody._activateSignal(K),v=this.condition.getValue(K);this.out._activateSignal(K)}getClassName(){return rU.ClassName}serialize(K){var Y;super.serialize(K),K.isDo=null===(Y=this.config)||void 0===Y?void 0:Y.isDo}}rU.ClassName="FGWhileLoopBlock",(0,E.f)(rU.ClassName,rU);const EU={"lifecycle/onStart":El.ClassName,"lifecycle/onTick":yl.ClassName,log:el.ClassName,"flow/delay":Dl.ClassName,"customEvent/send":Bl.ClassName,"customEvent/receive":Pl.ClassName,"flow/sequence":Gl.ClassName,"world/get":fl.ClassName,"world/set":wl.ClassName,"flow/doN":RU.ClassName,"variable/get":HU.ClassName,"variable/set":zU.ClassName,"flow/whileLoop":rU.ClassName,"math/random":hl.ClassName,"math/e":Yv.ClassName,"math/pi":lv.ClassName,"math/inf":vv.ClassName,"math/nan":Uv.ClassName,"math/abs":Av.ClassName,"math/sign":cv.ClassName,"math/trunc":tv.ClassName,"math/floor":Zv.ClassName,"math/ceil":mv.ClassName,"math/fract":Vv.ClassName,"math/neg":Mv.ClassName,"math/add":pl.ClassName,"math/sub":Sl.ClassName,"math/mul":ql.ClassName,"math/div":Ol.ClassName,"math/rem":ov.ClassName,"math/min":Wv.ClassName,"math/max":gv.ClassName,"math/clamp":Rv.ClassName,"math/saturate":zv.ClassName,"math/mix":rv.ClassName,"math/eq":Ev.ClassName,"math/lt":Tv.ClassName,"math/le":ev.ClassName,"math/gt":iv.ClassName,"math/ge":Dv.ClassName,"math/isnan":Bv.ClassName,"math/isinf":Pv.ClassName,"math/rad":Gv.ClassName,"math/deg":Qv.ClassName,"math/sin":Xv.ClassName,"math/cos":fv.ClassName,"math/tan":wv.ClassName,"math/asin":kv.ClassName,"math/acos":Iv.ClassName,"math/atan":Lv.ClassName,"math/atan2":av.ClassName,"math/sinh":Fv.ClassName,"math/cosh":sv.ClassName,"math/tanh":bv.ClassName,"math/asinh":xv.ClassName,"math/acosh":Cv.ClassName,"math/atanh":Nv.ClassName,"math/exp":jv.ClassName,"math/log":pv.ClassName,"math/log2":Sv.ClassName,"math/log10":qv.ClassName,"math/sqrt":Ov.ClassName,"math/cbrt":hv.ClassName,"math/pow":KU.ClassName,"math/length":YU.ClassName,"math/normalize":lU.ClassName,"math/dot":Kv.ClassName,"math/cross":vU.ClassName,"math/rotate2d":UU.ClassName,"math/rotate3d":dU.ClassName,"math/transpose":AU.ClassName,"math/determinant":cU.ClassName,"math/inverse":tU.ClassName,"math/matmul":ZU.ClassName,"math/not":mU.ClassName,"math/and":VU.ClassName,"math/or":MU.ClassName,"math/xor":uU.ClassName,"math/asr":WU.ClassName,"math/lsl":oU.ClassName,"math/clz":gU.ClassName,"math/ctz":JU.ClassName,"math/popcnt":nU.ClassName},yU={float2:"Vector2",float3:"Qi",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function TU(K,Y,l){if(void 0!==K.type){const v=Y.types&&Y.types[K.type];if(!v)throw new Error(`${l}: Unknown type: ${K.type}`);const U=v.signature;if(!U)throw new Error(`${l}: Type ${K.type} has no signature`);const d=yU[U];return{value:K.value,className:d}}return K.value}function eU(K,Y,l){const v=EU[Y.type];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${K}: Unknown block type: ${Y.type}`);const U=K.toString(),d=function(K,Y,l){const v={},U=K.configuration??[];for(const d of U)if("customEvent"===d.id){const K=Y.customEvents&&Y.customEvents[d.value];if(!K)throw new Error(`/extensions/KHR_interactivity/nodes/${l}: Unknown custom event: ${d.value}`);v.eventId=K.id,v.eventData=K.values.map((K=>K.id))}else if("variable"===d.id){const K=Y.variables&&Y.variables[d.value];if(!K)throw new Error(`/extensions/KHR_interactivity/nodes/${l}: Unknown variable: ${d.value}`);v.variableName=K.id}else if("path"===d.id){const K=d.value;v.path=K}else v[d.id]=TU(d,Y,`/extensions/KHR_interactivity/nodes/${l}`);return v}(Y,l,U);return{className:v,config:d,uniqueId:U,metadata:Y.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class iU extends EY{constructor(K){super(K,BU)}}const DU={__array__:{__target__:!0,translation:{type:"Qi",get:K=>K._babylonTransformNode.position,set:(K,Y)=>{Y._babylonTransformNode.position=K},getObject:K=>K._babylonTransformNode}}},BU={nodes:DU},PU="KHR_interactivity";class GU{constructor(K){this._loader=K,this.name=PU,this.enabled=this._loader.isExtensionUsed(PU),this._pathConverter=new iU(this._loader.Al)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var K;if(!this._loader.babylonScene||!this._pathConverter)return;const Y=this._loader.babylonScene,l=function(K){const Y={uniqueId:(0,jY.d)(),_userVariables:{},_connectionValues:{}},l=[Y],v=[];for(let d=0;d<K.nodes.length;d++){const Y=eU(d,K.nodes[d],K);v.push(Y)}for(let d=0;d<K.nodes.length;d++){const l=K.nodes[d],U=v[d],A=l.flows??[];for(const K of A){const Y=K.id,l={uniqueId:(0,jY.d)(),name:Y,_connectionType:1,connectedPointIds:[]};U.signalOutputs.push(l);const A=K.node,c=K.socket,t=v[A];if(!t)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Could not find node with id ${A} that connects its input with with node ${d}'s output ${Y}`);let Z=t.signalInputs.find((K=>K.name===c));Z||(Z={uniqueId:(0,jY.d)(),name:c,_connectionType:0,connectedPointIds:[]},t.signalInputs.push(Z)),Z.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(Z.uniqueId)}const c=l.values??[];for(const t of c){const l=t.id,A={uniqueId:(0,jY.d)(),name:l,_connectionType:0,connectedPointIds:[]};if(U.dataInputs.push(A),void 0!==t.value){const l=TU(t,K,`/extensions/KHR_interactivity/nodes/${d}`);Y._connectionValues[A.uniqueId]=l}else{if(void 0===t.node||void 0===t.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Invalid socket ${l} in node ${d}`);{const K=t.node,Y=t.socket,U=v[K];if(!U)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Could not find node with id ${K} that connects its output with node${d}'s input ${l}`);let c=U.dataOutputs.find((K=>K.name===Y));c||(c={uniqueId:(0,jY.d)(),name:Y,_connectionType:1,connectedPointIds:[]},U.dataOutputs.push(c)),A.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(A.uniqueId)}}}}const U=K.variables??[];for(let d=0;d<U.length;d++){const l=U[d],v=l.id;Y._userVariables[v]=TU(l,K,`/extensions/KHR_interactivity/variables/${d}`)}return{allBlocks:v,executionContexts:l}}(null===(K=this._loader.Al.extensions)||void 0===K?void 0:K.KHR_interactivity),v=new rl({hi:Y});zl.Parse(l,{coordinator:v,pathConverter:this._pathConverter}),v.start()}}j(PU),N(PU,!0,(K=>new GU(K)));const QU="KHR_node_visibility";class XU{constructor(K){this.name=QU,this._loader=K,this.enabled=K.isExtensionUsed(QU)}async onReady(){var K;null===(K=this._loader.Al.nodes)||void 0===K||K.forEach((K=>{var Y,l,v,U;(null===(Y=K._primitiveBabylonMeshes)||void 0===Y||Y.forEach((K=>{K.inheritVisibility=!0})),null!==(l=K.extensions)&&void 0!==l&&l.KHR_node_visibility)&&(!1===(null===(v=K.extensions)||void 0===v?void 0:v.KHR_node_visibility.visible)&&(K._babylonTransformNode&&(K._babylonTransformNode.isVisible=!1),null===(U=K._primitiveBabylonMeshes)||void 0===U||U.forEach((K=>{K.isVisible=!1}))))}))}dispose(){this._loader=null}}j(QU),N(QU,!0,(K=>new XU(K)));const fU="ExtrasAsMetadata";class wU{_assignExtras(K,Y){if(Y.extras&&Object.keys(Y.extras).length>0){const l=K.metadata=K.metadata||{};(l.Al=l.Al||{}).extras=Y.extras}}constructor(K){this.name=fU,this.enabled=!0,this._loader=K}dispose(){this._loader=null}loadNodeAsync(K,Y,l){return this._loader.loadNodeAsync(K,Y,(K=>{this._assignExtras(K,Y),l(K)}))}loadCameraAsync(K,Y,l){return this._loader.loadCameraAsync(K,Y,(K=>{this._assignExtras(K,Y),l(K)}))}createMaterial(K,Y,l){const v=this._loader.createMaterial(K,Y,l);return this._assignExtras(v,Y),v}}j(fU),N(fU,!1,(K=>new wU(K)))},12477:(K,Y,l)=>{"use strict";l.d(Y,{b:()=>P,c:()=>y,g:()=>E,h:()=>T});var v=l(469),U=l(475),d=l(11949),A=l(465),c=l(814),t=l(809),Z=l(492),m=l(526),V=l(12480),M=l(12484),u=l(644);class o{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qi=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.om=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture=K}getNodes(){let K=[];return K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes),this.skeletons.forEach((Y=>K=K.concat(Y.bones))),K}}class W extends o{}class g{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((K=>{K.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((K=>{K.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((K=>{K.dispose()})),this.animationGroups.length=0}}class J extends o{constructor(K){super(),this._wasAddedToScene=!1,(K=K||m.e.LastCreatedScene)&&(this.hi=K,this.proceduralTextures=[],K.Hi.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=K.getEngine().onContextRestoredObservable.add((()=>{for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();for(const K of this.qi)K.rebuild();for(const K of this.textures)K._rebuild()})))}_topologicalSort(K){const Y=new Map;for(const A of K)Y.set(A.uniqueId,A);const l={dependsOn:new Map,dependedBy:new Map};for(const A of K){const K=A.uniqueId;l.dependsOn.set(K,new Set),l.dependedBy.set(K,new Set)}for(const A of K){const K=A.uniqueId,v=l.dependsOn.get(K);if(A instanceof V.c){const U=A.sourceMesh;Y.has(U.uniqueId)&&(v.add(U.uniqueId),l.dependedBy.get(U.uniqueId).add(K))}const U=l.dependedBy.get(K);for(const d of A.getDescendants()){const v=d.uniqueId;if(Y.has(v)){U.add(v);l.dependsOn.get(v).add(K)}}}const v=[],U=[];for(const A of K){const K=A.uniqueId;0===l.dependsOn.get(K).size&&(U.push(A),Y.delete(K))}const d=U;for(;d.length>0;){const K=d.shift();v.push(K);const U=l.dependedBy.get(K.uniqueId);for(const v of Array.from(U.values())){const U=l.dependsOn.get(v);U.delete(K.uniqueId),0===U.size&&Y.get(v)&&(d.push(Y.get(v)),Y.delete(v))}}return Y.size>0&&(Z.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Y.forEach((K=>Z.e.Error(K.name)))),v}_addNodeAndDescendantsToList(K,Y,l,v){if(l&&(!v||v(l))&&!Y.has(l.uniqueId)){K.push(l),Y.add(l.uniqueId);for(const U of l.getDescendants(!0))this._addNodeAndDescendantsToList(K,Y,U,v)}}_isNodeInContainer(K){return K instanceof t.b&&-1!==this.meshes.indexOf(K)||(K instanceof c.b&&-1!==this.transformNodes.indexOf(K)||(K instanceof M.c&&-1!==this.lights.indexOf(K)||K instanceof u.c&&-1!==this.cameras.indexOf(K)))}_isValidHierarchy(){for(const K of this.meshes)if(K.parent&&!this._isNodeInContainer(K.parent))return Z.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.transformNodes)if(K.parent&&!this._isNodeInContainer(K.parent))return Z.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.lights)if(K.parent&&!this._isNodeInContainer(K.parent))return Z.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.cameras)if(K.parent&&!this._isNodeInContainer(K.parent))return Z.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||U.d.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const v={},d={},c=new g,t=[],Z=[],m={doNotInstantiate:!0,...l},V=[],M=new Set;for(const U of this.transformNodes)null===U.parent&&this._addNodeAndDescendantsToList(V,M,U,m.predicate);for(const U of this.meshes)null===U.parent&&this._addNodeAndDescendantsToList(V,M,U,m.predicate);const u=this._topologicalSort(V),o=(l,U)=>{if(((Y,l)=>{if(v[Y.uniqueId]=l.uniqueId,d[l.uniqueId]=l,K&&(l.name=K(Y.name)),l instanceof A.e){const K=l;if(K.morphTargetManager){const l=Y.morphTargetManager;K.morphTargetManager=l.clone();for(let Y=0;Y<l.numTargets;Y++){const U=l.getTarget(Y),A=K.morphTargetManager.getTarget(Y);v[U.uniqueId]=A.uniqueId,d[A.uniqueId]=A}}}})(l,U),l.parent){const K=v[l.parent.uniqueId],Y=d[K];U.parent=Y||l.parent}if(U.position&&l.position&&U.position.p(l.position),U.rotationQuaternion&&l.rotationQuaternion&&U.rotationQuaternion.p(l.rotationQuaternion),U.rotation&&l.rotation&&U.rotation.p(l.rotation),U.ni&&l.ni&&U.ni.p(l.ni),U.material){const A=U;if(A.material)if(Y){const Y=l.material;if(-1===Z.indexOf(Y)){let l=Y.clone(K?K(Y.name):"Clone of "+Y.name);if(Z.push(Y),v[Y.uniqueId]=l.uniqueId,d[l.uniqueId]=l,"MultiMaterial"===Y.getClassName()){const U=Y;for(const Y of U.Ai)Y&&(l=Y.clone(K?K(Y.name):"Clone of "+Y.name),Z.push(Y),v[Y.uniqueId]=l.uniqueId,d[l.uniqueId]=l);U.Ai=U.Ai.map((K=>K&&d[v[K.uniqueId]]))}}"InstancedMesh"!==A.getClassName()&&(A.material=d[v[Y.uniqueId]])}else"MultiMaterial"===A.material.getClassName()?-1===this.hi.multiMaterials.indexOf(A.material)&&this.hi.addMultiMaterial(A.material):-1===this.hi.materials.indexOf(A.material)&&this.hi.addMaterial(A.material)}null===U.parent&&c.rootNodes.push(U)};return u.forEach((K=>{if("InstancedMesh"===K.getClassName()){const Y=K,l=Y.sourceMesh,U=v[l.uniqueId],A=("number"===typeof U?d[U]:l).createInstance(Y.name);o(Y,A)}else{let Y=!0;"_i"===K.getClassName()||"Node"===K.getClassName()||K.skeleton||!K.getTotalVertices||0===K.getTotalVertices()?Y=!1:m.doNotInstantiate&&(Y="function"===typeof m.doNotInstantiate?!m.doNotInstantiate(K):!m.doNotInstantiate);const l=Y?K.createInstance(`instance of ${K.name}`):K.clone(`Clone of ${K.name}`,null,!0);if(!l)throw new Error(`Could not clone or instantiate node on Asset Container ${K.name}`);o(K,l)}})),this.skeletons.forEach((Y=>{if(m.predicate&&!m.predicate(Y))return;const l=Y.clone(K?K(Y.name):"Clone of "+Y.name);for(const K of this.meshes)if(K.skeleton===Y&&!K.isAnInstance){const Y=d[v[K.uniqueId]];if(!Y||Y.isAnInstance)continue;if(Y.skeleton=l,-1!==t.indexOf(l))continue;t.push(l);for(const K of l.bones)K._linkedTransformNode&&(K._linkedTransformNode=d[v[K._linkedTransformNode.uniqueId]])}c.skeletons.push(l)})),this.animationGroups.forEach((Y=>{if(m.predicate&&!m.predicate(Y))return;const l=Y.clone(K?K(Y.name):"Clone of "+Y.name,(K=>d[v[K.uniqueId]]||K));c.animationGroups.push(l)})),c}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||U.d.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.hi.environmentTexture=this.environmentTexture);for(const K of this.hi._serializableComponents)K.addFromContainer(this);this.hi.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Y=[];this.cameras.forEach((l=>{K&&!K(l)||(this.hi.addCamera(l),Y.push(l))})),this.lights.forEach((l=>{K&&!K(l)||(this.hi.addLight(l),Y.push(l))})),this.meshes.forEach((l=>{K&&!K(l)||(this.hi.Wi(l),Y.push(l))})),this.skeletons.forEach((Y=>{K&&!K(Y)||this.hi.addSkeleton(Y)})),this.animations.forEach((Y=>{K&&!K(Y)||this.hi.addAnimation(Y)})),this.animationGroups.forEach((Y=>{K&&!K(Y)||this.hi.addAnimationGroup(Y)})),this.multiMaterials.forEach((Y=>{K&&!K(Y)||this.hi.addMultiMaterial(Y)})),this.materials.forEach((Y=>{K&&!K(Y)||this.hi.addMaterial(Y)})),this.morphTargetManagers.forEach((Y=>{K&&!K(Y)||this.hi.addMorphTargetManager(Y)})),this.geometries.forEach((Y=>{K&&!K(Y)||this.hi.addGeometry(Y)})),this.transformNodes.forEach((l=>{K&&!K(l)||(this.hi.addTransformNode(l),Y.push(l))})),this.actionManagers.forEach((Y=>{K&&!K(Y)||this.hi.addActionManager(Y)})),this.textures.forEach((Y=>{K&&!K(Y)||this.hi.addTexture(Y)})),this.reflectionProbes.forEach((Y=>{K&&!K(Y)||this.hi.addReflectionProbe(Y)}));for(const l of Y)l.parent&&-1===this.hi.getNodes().indexOf(l.parent)&&(l.setParent?l.setParent(null):l.parent=null)}removeAllFromScene(){this._isValidHierarchy()||U.d.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.hi.environmentTexture&&(this.hi.environmentTexture=null);for(const K of this.hi._serializableComponents)K.removeFromContainer(this)}removeFromScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((Y=>{K&&!K(Y)||this.hi.removeCamera(Y)})),this.lights.forEach((Y=>{K&&!K(Y)||this.hi.removeLight(Y)})),this.meshes.forEach((Y=>{K&&!K(Y)||this.hi.gi(Y,!0)})),this.skeletons.forEach((Y=>{K&&!K(Y)||this.hi.removeSkeleton(Y)})),this.animations.forEach((Y=>{K&&!K(Y)||this.hi.removeAnimation(Y)})),this.animationGroups.forEach((Y=>{K&&!K(Y)||this.hi.removeAnimationGroup(Y)})),this.multiMaterials.forEach((Y=>{K&&!K(Y)||this.hi.removeMultiMaterial(Y)})),this.materials.forEach((Y=>{K&&!K(Y)||this.hi.removeMaterial(Y)})),this.morphTargetManagers.forEach((Y=>{K&&!K(Y)||this.hi.removeMorphTargetManager(Y)})),this.geometries.forEach((Y=>{K&&!K(Y)||this.hi.removeGeometry(Y)})),this.transformNodes.forEach((Y=>{K&&!K(Y)||this.hi.removeTransformNode(Y)})),this.actionManagers.forEach((Y=>{K&&!K(Y)||this.hi.removeActionManager(Y)})),this.textures.forEach((Y=>{K&&!K(Y)||this.hi.removeTexture(Y)})),this.reflectionProbes.forEach((Y=>{K&&!K(Y)||this.hi.removeReflectionProbe(Y)}))}dispose(){this.cameras.slice(0).forEach((K=>{K.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((K=>{K.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((K=>{K.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((K=>{K.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((K=>{K.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((K=>{K.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((K=>{K.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((K=>{K.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((K=>{K.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((K=>{K.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((K=>{K.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((K=>{K.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((K=>{K.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const K of this.hi._serializableComponents)K.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.hi.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(K,Y,l){if(K&&Y)for(const v of K){let K=!0;if(l)for(const Y of l)if(v===Y){K=!1;break}K&&(Y.push(v),v._parentContainer=this)}}moveAllFromScene(K){this._wasAddedToScene=!1,void 0===K&&(K=new W);for(const Y in this)Object.prototype.hasOwnProperty.call(this,Y)&&(this[Y]=this[Y]||("_environmentTexture"===Y?null:[]),this._moveAssets(this.hi[Y],this[Y],K[Y]));this.environmentTexture=this.hi.environmentTexture,this.removeAllFromScene()}createRootMesh(){const K=new A.e("assetContainerRootMesh",this.hi);return this.meshes.forEach((Y=>{Y.parent||K.addChild(Y)})),this.meshes.unshift(K),K}mergeAnimationsTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.e.LastCreatedScene,Y=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!K)return Z.e.Error("No scene available to merge animations to"),[];const v=l||(Y=>{let l=null;const v=Y.animations.length?Y.animations[0].targetProperty:"",U=Y.name.split(".").join("").split("_primitive")[0];switch(v){case"position":case"rotationQuaternion":l=K.getTransformNodeByName(Y.name)||K.getTransformNodeByName(U);break;case"influence":l=K.getMorphTargetByName(Y.name)||K.getMorphTargetByName(U);break;default:l=K.getNodeByName(Y.name)||K.getNodeByName(U)}return l});this.getNodes().forEach((K=>{const Y=v(K);if(null!==Y){for(const l of K.animations){const K=Y.animations.filter((K=>K.targetProperty===l.targetProperty));for(const l of K){const K=Y.animations.indexOf(l,0);K>-1&&Y.animations.splice(K,1)}}Y.animations=Y.animations.concat(K.animations)}}));const U=[];return this.animationGroups.slice().forEach((K=>{U.push(K.clone(K.name,v)),K.animatables.forEach((K=>{K.stop()}))})),Y.forEach((Y=>{const l=v(Y.target);l&&(K.beginAnimation(l,Y.fromFrame,Y.toFrame,Y.loopAnimation,Y.speedRatio,Y.onAnimationEnd?Y.onAnimationEnd:void 0,void 0,!0,void 0,Y.onAnimationLoop?Y.onAnimationLoop:void 0),K.stopAnimation(Y.target))})),U}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.transformNodes.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.lights.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.cameras.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)}))}addAllAssetsToContainer(K){if(!K)return;const Y=[],l=new Set;for(Y.push(K);Y.length>0;){const K=Y.pop();if(K instanceof A.e?(K.oi&&-1===this.geometries.indexOf(K.oi)&&this.geometries.push(K.oi),this.meshes.push(K)):K instanceof c.b?this.transformNodes.push(K):K instanceof M.c?this.lights.push(K):K instanceof u.c&&this.cameras.push(K),K instanceof t.b){if(K.material&&-1===this.materials.indexOf(K.material)){this.materials.push(K.material);for(const Y of K.material.getActiveTextures())-1===this.textures.indexOf(Y)&&this.textures.push(Y)}K.skeleton&&-1===this.skeletons.indexOf(K.skeleton)&&this.skeletons.push(K.skeleton),K.morphTargetManager&&-1===this.morphTargetManagers.indexOf(K.morphTargetManager)&&this.morphTargetManagers.push(K.morphTargetManager)}for(const v of K.getChildren())l.has(v)||Y.push(v);l.add(K)}this.populateRootNodes()}}var n=l(541);class R{constructor(K){this.byteOffset=0,this.buffer=K}loadAsync(K){return this.buffer.readAsync(this.byteOffset,K).then((K=>{this._dataView=new DataView(K.buffer,K.byteOffset,K.byteLength),this._dataByteOffset=0}))}readUint32(){const K=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,K}readUint8Array(K){const Y=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,K);return this._dataByteOffset+=K,this.byteOffset+=K,Y}readString(K){return(0,n.j)(this.readUint8Array(K))}skipBytes(K){this._dataByteOffset+=K,this.byteOffset+=K}}var H=l(12493);const z="Z2xURg",r={name:"Al",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:K=>-1!==K.indexOf("asset")&&-1!==K.indexOf("version")||K.startsWith("data:base64,"+z)||K.startsWith("data:;base64,"+z)||K.startsWith("data:application/octet-stream;base64,"+z)||K.startsWith("data:model/gltf-binary;base64,"+z)};var E,y,T,e=l(534),i=l(538);function D(K,Y,l){try{return Promise.resolve(new Uint8Array(K,Y,l))}catch(v){return Promise.reject(v)}}!function(K){K[K.AUTO=0]="AUTO",K[K.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(E||(E={})),function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.ALL=2]="ALL"}(y||(y={})),function(K){K[K.LOADING=0]="LOADING",K[K.READY=1]="READY",K[K.COMPLETE=2]="COMPLETE"}(T||(T={}));class B{constructor(){this.coordinateSystemMode=E.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=K=>Promise.resolve(K),this.extensionOptions={}}p(K){K&&(this.onParsed=K.onParsed,this.coordinateSystemMode=K.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=K.animationStartMode??this.animationStartMode,this.loadNodeAnimations=K.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=K.loadSkins??this.loadSkins,this.loadMorphTargets=K.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=K.compileMaterials??this.compileMaterials,this.useClipPlane=K.useClipPlane??this.useClipPlane,this.compileShadowGenerators=K.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=K.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=K.useRangeRequests??this.useRangeRequests,this.createInstances=K.createInstances??this.createInstances,this.alwaysComputeBoundingBox=K.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=K.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=K.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=K.skipMaterials??this.skipMaterials,this.useSRGBBuffers=K.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=K.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=K.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=K.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=K.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=K.customRootNode,this.onMeshLoaded=K.onMeshLoaded,this.onSkinLoaded=K.onSkinLoaded,this.onTextureLoaded=K.onTextureLoaded,this.onMaterialLoaded=K.onMaterialLoaded,this.onCameraLoaded=K.onCameraLoaded,this.extensionOptions=K.extensionOptions??this.extensionOptions)}}class P extends B{constructor(K){super(),this.onParsedObservable=new v.b,this.onMeshLoadedObservable=new v.b,this.onSkinLoadedObservable=new v.b,this.onTextureLoadedObservable=new v.b,this.onMaterialLoadedObservable=new v.b,this.onCameraLoadedObservable=new v.b,this.onCompleteObservable=new v.b,this.onErrorObservable=new v.b,this.Hi=new v.b,this.onExtensionLoadedObservable=new v.b,this.validate=!1,this.onValidatedObservable=new v.b,this._loader=null,this._state=null,this._requests=new Array,this.name=r.name,this.extensions=r.extensions,this.onLoaderStateChangedObservable=new v.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(K)}set onParsed(K){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),K&&(this._onParsedObserver=this.onParsedObservable.add(K))}set onMeshLoaded(K){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),K&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(K))}set onSkinLoaded(K){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),K&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Y=>K(Y.node,Y.skinnedNode))))}set onTextureLoaded(K){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),K&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(K))}set onMaterialLoaded(K){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),K&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(K))}set onCameraLoaded(K){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),K&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(K))}set onComplete(K){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(K)}set onError(K){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(K)}set onDispose(K){this._onDisposeObserver&&this.Hi.remove(this._onDisposeObserver),this._onDisposeObserver=this.Hi.add(K)}set onExtensionLoaded(K){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(K)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(K){this._loggingEnabled!==K&&(this._loggingEnabled=K,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(K){this._capturePerformanceCounters!==K&&(this._capturePerformanceCounters=K,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(K){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(K)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const K of this._requests)K.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=K=>Promise.resolve(K),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Hi.notifyObservers(void 0),this.Hi.clear()}loadFile(K,Y,l,d,A,c,t,m){if(ArrayBuffer.isView(Y))return this._loadBinary(K,Y,l,d,t,m),null;this._progressCallback=A;const V=Y.name||U.d.GetFilename(Y);if(c){if(this.useRangeRequests){this.validate&&Z.e.Warn("glTF validation is not supported when range requests are enabled");const l={abort:()=>{},onCompleteObservable:new v.b},U={readAsync:(l,v)=>new Promise(((U,d)=>{this._loadFile(K,Y,(K=>{U(new Uint8Array(K))}),!0,(K=>{d(K)}),(K=>{K.setRequestHeader("Range",`bytes=${l}-${l+v-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new R(U)).then((K=>{l.onCompleteObservable.notifyObservers(l),d(K)}),t?K=>t(void 0,K):void 0),l}return this._loadFile(K,Y,(Y=>{this._validate(K,new Uint8Array(Y,0,Y.byteLength),l,V),this._unpackBinaryAsync(new R({readAsync:(K,l)=>D(Y,K,l),byteLength:Y.byteLength})).then((K=>{d(K)}),t?K=>t(void 0,K):void 0)}),!0,t)}return this._loadFile(K,Y,(Y=>{try{this._validate(K,Y,l,V),d({json:this._parseJson(Y)})}catch{t&&t()}}),!1,t)}_loadBinary(K,Y,l,v,U,d){this._validate(K,new Uint8Array(Y.buffer,Y.byteOffset,Y.byteLength),l,d),this._unpackBinaryAsync(new R({readAsync:(K,l)=>function(K,Y,l){try{if(Y<0||Y>=K.byteLength)throw new RangeError("Offset is out of range.");if(Y+l>K.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(K.buffer,K.byteOffset+Y,l))}catch(v){return Promise.reject(v)}}(Y,K,l),byteLength:Y.byteLength})).then((K=>{v(K)}),U?K=>U(void 0,K):void 0)}importMeshAsync(K,Y,l,v,U,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(l),this._loader.importMeshAsync(K,Y,null,l,v,U,d))))}loadAsync(K,Y,l,v,U){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Y),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(Y),this._loader.loadAsync(K,Y,l,v,U))))}loadAssetContainerAsync(K,Y,l,v,U){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Y),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(Y);const d=new J(K),A=[];this.onMaterialLoadedObservable.add((K=>{A.push(K)}));const c=[];this.onTextureLoadedObservable.add((K=>{c.push(K)}));const t=[];this.onCameraLoadedObservable.add((K=>{t.push(K)}));const Z=[];return this.onMeshLoadedObservable.add((K=>{K.morphTargetManager&&Z.push(K.morphTargetManager)})),this._loader.importMeshAsync(null,K,d,Y,l,v,U).then((K=>(Array.prototype.push.apply(d.geometries,K.geometries),Array.prototype.push.apply(d.meshes,K.meshes),Array.prototype.push.apply(d.qi,K.qi),Array.prototype.push.apply(d.skeletons,K.skeletons),Array.prototype.push.apply(d.animationGroups,K.animationGroups),Array.prototype.push.apply(d.materials,A),Array.prototype.push.apply(d.textures,c),Array.prototype.push.apply(d.lights,K.lights),Array.prototype.push.apply(d.transformNodes,K.transformNodes),Array.prototype.push.apply(d.cameras,t),Array.prototype.push.apply(d.morphTargetManagers,Z),d)))}))}canDirectLoad(K){return r.canDirectLoad(K)}directLoad(K,Y){if(Y.startsWith("base64,"+z)||Y.startsWith(";base64,"+z)||Y.startsWith("application/octet-stream;base64,"+z)||Y.startsWith("model/gltf-binary;base64,"+z)){const l=(0,e.d)(Y);return this._validate(K,new Uint8Array(l,0,l.byteLength)),this._unpackBinaryAsync(new R({readAsync:(K,Y)=>D(l,K,Y),byteLength:l.byteLength}))}return this._validate(K,Y),Promise.resolve({json:this._parseJson(Y)})}createPlugin(K){return new P(K[r.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((K,Y)=>{this.onCompleteObservable.addOnce((()=>{K()})),this.onErrorObservable.addOnce((K=>{Y(K)}))}))}_setState(K){this._state!==K&&(this._state=K,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(T[this._state]))}_loadFile(K,Y,l,v,U,d){const A=K._loadFile(Y,l,(K=>{this._onProgress(K,A)}),!0,v,U,d);return A.onCompleteObservable.add((()=>{A._lengthComputable=!0,A._total=A._loaded})),this._requests.push(A),A}_onProgress(K,Y){if(!this._progressCallback)return;Y._lengthComputable=K.lengthComputable,Y._loaded=K.loaded,Y._total=K.total;let l=!0,v=0,U=0;for(const d of this._requests){if(void 0===d._lengthComputable||void 0===d._loaded||void 0===d._total)return;l=l&&d._lengthComputable,v+=d._loaded,U+=d._total}this._progressCallback({lengthComputable:l,loaded:v,total:l?U:0})}_validate(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),H.d.ValidateAsync(Y,l,v,(Y=>this.preprocessUrlAsync(l+Y).then((Y=>K._loadFileAsync(Y,void 0,!0,!0).then((K=>new Uint8Array(K,0,K.byteLength))))))).then((K=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(K),this.onValidatedObservable.clear()}),(K=>{this._endPerformanceCounter("Validate JSON"),U.d.Warn(`Failed to validate: ${K.message}`),this.onValidatedObservable.clear()})))}_getLoader(K){const Y=K.json.asset||{};this._log(`Asset version: ${Y.version}`),Y.minVersion&&this._log(`Asset minimum version: ${Y.minVersion}`),Y.generator&&this._log(`Asset generator: ${Y.generator}`);const l=P._parseVersion(Y.version);if(!l)throw new Error("Invalid version: "+Y.version);if(void 0!==Y.minVersion){const K=P._parseVersion(Y.minVersion);if(!K)throw new Error("Invalid minimum version: "+Y.minVersion);if(P._compareVersion(K,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Y.minVersion)}const v={1:P._CreateGLTF1Loader,2:P._CreateGLTF2Loader}[l.major];if(!v)throw new Error("Unsupported version: "+Y.version);return v(this)}_parseJson(K){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${K.length}`);const Y=JSON.parse(K);return this._endPerformanceCounter("Parse JSON"),Y}_unpackBinaryAsync(K){return this._startPerformanceCounter("Unpack Binary"),K.loadAsync(20).then((()=>{const Y=K.readUint32();if(1179937895!==Y)throw new i.h("Unexpected magic: "+Y,i.d.GLTFLoaderUnexpectedMagicError);const l=K.readUint32();this.loggingEnabled&&this._log(`Binary version: ${l}`);const v=K.readUint32();let U;switch(this.useRangeRequests||v===K.buffer.byteLength||Z.e.Warn(`Length in header does not match actual data length: ${v} != ${K.buffer.byteLength}`),l){case 1:U=this._unpackBinaryV1Async(K,v);break;case 2:U=this._unpackBinaryV2Async(K,v);break;default:throw new Error("Unsupported version: "+l)}return this._endPerformanceCounter("Unpack Binary"),U}))}_unpackBinaryV1Async(K,Y){const l=K.readUint32(),v=K.readUint32();if(0!==v)throw new Error(`Unexpected content format: ${v}`);const U=Y-K.byteOffset,d={json:this._parseJson(K.readString(l)),bin:null};if(0!==U){const Y=K.byteOffset;d.bin={readAsync:(l,v)=>K.buffer.readAsync(Y+l,v),byteLength:U}}return Promise.resolve(d)}_unpackBinaryV2Async(K,Y){const l=1313821514,v=5130562,U=K.readUint32();if(K.readUint32()!==l)throw new Error("First chunk format is not JSON");return K.byteOffset+U===Y?K.loadAsync(U).then((()=>({json:this._parseJson(K.readString(U)),bin:null}))):K.loadAsync(U+8).then((()=>{const d={json:this._parseJson(K.readString(U)),bin:null},A=()=>{const U=K.readUint32();switch(K.readUint32()){case l:throw new Error("Unexpected JSON chunk");case v:{const Y=K.byteOffset;d.bin={readAsync:(l,v)=>K.buffer.readAsync(Y+l,v),byteLength:U},K.skipBytes(U);break}default:K.skipBytes(U)}return K.byteOffset!==Y?K.loadAsync(8).then(A):Promise.resolve(d)};return A()}))}static _parseVersion(K){if("1.0"===K||"1.0.1"===K)return{major:1,minor:0};const Y=(K+"").match(/^(\d+)\.(\d+)/);return Y?{major:parseInt(Y[1]),minor:parseInt(Y[2])}:null}static _compareVersion(K,Y){return K.major>Y.major?1:K.major<Y.major?-1:K.minor>Y.minor?1:K.minor<Y.minor?-1:0}_logOpen(K){this._log(K),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(K){const Y=P._logSpaces.substring(0,2*this._logIndentLevel);Z.e.Log(`${Y}${K}`)}_logDisabled(K){}_startPerformanceCounterEnabled(K){U.d.StartPerformanceCounter(K)}_startPerformanceCounterDisabled(K){}_endPerformanceCounterEnabled(K){U.d.EndPerformanceCounter(K)}_endPerformanceCounterDisabled(K){}}P.IncrementalLoading=!0,P.HomogeneousCoordinates=!1,P._logSpaces="                                ",(0,d.h)(new P)},12493:(K,Y,l)=>{"use strict";l.d(Y,{d:()=>A});var v=l(475);function U(K,Y,l,v){const U={externalResourceFunction:v};return l&&(U.uri="file:"===Y?l:Y+l),ArrayBuffer.isView(K)?GLTFValidator.validateBytes(K,U):GLTFValidator.validateString(K,U)}function d(){const K=[];onmessage=Y=>{const l=Y.data;switch(l.id){case"init":importScripts(l.url);break;case"validate":U(l.data,l.rootUrl,l.fileName,(Y=>new Promise(((l,v)=>{const U=K.length;K.push({resolve:l,reject:v}),postMessage({id:"getExternalResource",index:U,uri:Y})})))).then((K=>{postMessage({id:"validate.resolve",value:K})}),(K=>{postMessage({id:"validate.reject",reason:K})}));break;case"getExternalResource.resolve":K[l.index].resolve(l.value);break;case"getExternalResource.reject":K[l.index].reject(l.reason)}}}class A{static ValidateAsync(K,Y,l,A){return"function"===typeof Worker?new Promise(((c,t)=>{const Z=`${U}(${d})()`,m=URL.createObjectURL(new Blob([Z],{type:"application/javascript"})),V=new Worker(m),M=K=>{V.removeEventListener("error",M),V.removeEventListener("message",u),t(K)},u=K=>{const Y=K.data;switch(Y.id){case"getExternalResource":A(Y.uri).then((K=>{V.postMessage({id:"getExternalResource.resolve",index:Y.index,value:K},[K.buffer])}),(K=>{V.postMessage({id:"getExternalResource.reject",index:Y.index,reason:K})}));break;case"validate.resolve":V.removeEventListener("error",M),V.removeEventListener("message",u),c(Y.value),V.terminate();break;case"validate.reject":V.removeEventListener("error",M),V.removeEventListener("message",u),t(Y.reason),V.terminate()}};if(V.addEventListener("error",M),V.addEventListener("message",u),V.postMessage({id:"init",url:v.d.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(K)){const v=K.slice();V.postMessage({id:"validate",data:v,rootUrl:Y,fileName:l},[v.buffer])}else V.postMessage({id:"validate",data:K,rootUrl:Y,fileName:l})})):(this._LoadScriptPromise||(this._LoadScriptPromise=v.d.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>U(K,Y,l,A))))}}A.Configuration={url:`${v.d._DefaultCdnUrl}/gltf_validator.js`}},12701:(K,Y,l)=>{"use strict";l.d(Y,{c:()=>E});var v=l(646),U=l(652),d=l(702),A=l(675),c=l(11872),t=l(11876),Z=l(730),m=l(2366),V=l(619),M=l(577);l(12167),l(12072),l(12090),l(12074),l(12097),l(12101),l(12105);const u="imageProcessingCompatibility",o="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";M.e.IncludesShadersStore[u]=o;const W="skyPixelShader",g="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";M.e.ShadersStore[W]=g;l(12180),l(12109),l(12118),l(12134),l(12125);const J="skyVertexShader",n="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";M.e.ShadersStore[J]=n;var R=l(11884),H=l(853),z=l(837);class r extends c.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class E extends t.e{constructor(K,Y){super(K,Y),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new A.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=A.o.Zero(),this.up=A.o.Up(),this.dithering=!1,this._cameraPosition=A.o.Zero(),this._skyOrientation=new A.h}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(K,Y){const l=Y._drawWrapper;if(this.isFrozen&&l.effect&&l._wasPreviouslyReady)return!0;Y.materialDefines||(Y.materialDefines=new r);const v=Y.materialDefines,U=this.va();if(this._isReadyForSubMesh(Y))return!0;if((0,z.X)(K,U,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,v),(0,z.N)(K,v,!0,!1),v.IMAGEPROCESSINGPOSTPROCESS!==U.imageProcessingConfiguration.applyByPostProcess&&v.markAsMiscDirty(),v.DITHER!==this.dithering&&v.markAsMiscDirty(),v.isDirty){v.markAsProcessed(),U.resetCachedMaterial();const K=new R.e;v.FOG&&K.addFallback(1,"FOG"),v.IMAGEPROCESSINGPOSTPROCESS=U.imageProcessingConfiguration.applyByPostProcess,v.DITHER=this.dithering;const l=[Z.e.PositionKind];v.VERTEXCOLOR&&l.push(Z.e.ColorKind);const d="sky",A=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,H.b)(A);const c=v.toString();Y.setEffect(U.getEngine().createEffect(d,l,A,[],c,K,this.onCompiled,this.onError),v,this._materialContext)}return!(!Y.effect||!Y.effect.isReady())&&(v._renderId=U.getRenderId(),l._wasPreviouslyReady=!0,!0)}bindForSubMesh(K,Y,l){const v=this.va(),U=l.materialDefines;if(!U)return;const d=l.effect;if(!d)return;this._activeEffect=d,this.bindOnlyWorldMatrix(K),this._activeEffect.setMatrix("viewProjection",v.getTransformMatrix()),this._mustRebind(v,d,l)&&((0,H.c)(d,this,v),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,z.k)(U,d,v)),v.fogEnabled&&Y.applyFog&&v.fogMode!==m.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",v.getViewMatrix()),(0,z.e)(v,Y,this._activeEffect);const c=v.activeCamera;if(c){const K=c.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const K=Math.PI*(this.inclination-.5),Y=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Y)*Math.cos(K),this.sunPosition.y=this.distance*Math.sin(-K),this.sunPosition.z=this.distance*Math.sin(Y)*Math.cos(K),A.h.FromUnitVectorsToRef(A.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Y,this._activeEffect,l)}getAnimatables(){return[]}dispose(K){super.dispose(K)}clone(K){return d.c.Clone((()=>new E(K,this.va())),this)}serialize(){const K=super.serialize();return K.customType="BABYLON.SkyMaterial",K}getClassName(){return"SkyMaterial"}static Parse(K,Y,l){return d.c.Parse((()=>new E(K.name,Y)),K,Y,l)}}(0,v.d)([(0,U.J)()],E.prototype,"luminance",void 0),(0,v.d)([(0,U.J)()],E.prototype,"turbidity",void 0),(0,v.d)([(0,U.J)()],E.prototype,"rayleigh",void 0),(0,v.d)([(0,U.J)()],E.prototype,"mieCoefficient",void 0),(0,v.d)([(0,U.J)()],E.prototype,"mieDirectionalG",void 0),(0,v.d)([(0,U.J)()],E.prototype,"distance",void 0),(0,v.d)([(0,U.J)()],E.prototype,"inclination",void 0),(0,v.d)([(0,U.J)()],E.prototype,"azimuth",void 0),(0,v.d)([(0,U.F)()],E.prototype,"sunPosition",void 0),(0,v.d)([(0,U.J)()],E.prototype,"useSunPosition",void 0),(0,v.d)([(0,U.F)()],E.prototype,"cameraOffset",void 0),(0,v.d)([(0,U.F)()],E.prototype,"up",void 0),(0,v.d)([(0,U.J)()],E.prototype,"dithering",void 0),(0,V.f)("BABYLON.SkyMaterial",E)},11601:(K,Y,l)=>{"use strict";function v(K,Y){Y.headers=K.headers||{},Y.statusMessage=K.statusText,Y.statusCode=K.status,Y.data=K.response}function U(K,Y,l){return new Promise((function(U,d){l=l||{};var A,c,t,Z=new XMLHttpRequest,m=l.body,V=l.headers||{};for(A in l.timeout&&(Z.timeout=l.timeout),Z.ontimeout=Z.onerror=function(K){K.timeout="timeout"==K.type,d(K)},Z.open(K,Y.href||Y),Z.onload=function(){for(t=Z.getAllResponseHeaders().trim().split(/[\r\n]+/),v(Z,Z);c=t.shift();)c=c.split(": "),Z.headers[c.shift().toLowerCase()]=c.join(": ");if((c=Z.headers["content-type"])&&~c.indexOf("application/json"))try{Z.data=JSON.parse(Z.data,l.reviver)}catch(K){return v(Z,K),d(K)}(Z.status>=400?d:U)(Z)},typeof FormData<"u"&&m instanceof FormData||m&&"object"==typeof m&&(V["content-type"]="application/json",m=JSON.stringify(m)),Z.withCredentials=!!l.withCredentials,V)Z.setRequestHeader(A,V[A]);Z.send(m)}))}l.r(Y),l.d(Y,{del:()=>t,get:()=>d,patch:()=>c,post:()=>A,put:()=>Z,send:()=>U});var d=U.bind(U,"GET"),A=U.bind(U,"POST"),c=U.bind(U,"PATCH"),t=U.bind(U,"DELETE"),Z=U.bind(U,"PUT")},12806:(K,Y,l)=>{"use strict";l.d(Y,{e:()=>V});const v=.5*(Math.sqrt(3)-1),U=(3-Math.sqrt(3))/6,d=1/3,A=1/6,c=(Math.sqrt(5)-1)/4,t=(5-Math.sqrt(5))/20,Z=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),m=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const V=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Y="function"==typeof K?K:function(K){let Y=0,l=0,v=0,U=1;const d=function(){let K=4022871197;return function(Y){Y=Y.toString();for(let l=0;l<Y.length;l++){K+=Y.charCodeAt(l);let v=.02519603282416938*K;K=v>>>0,v-=K,v*=K,K=v>>>0,v-=K,K+=4294967296*v}return 2.3283064365386963e-10*(K>>>0)}}();Y=d(" "),l=d(" "),v=d(" "),Y-=d(K),Y<0&&(Y+=1);l-=d(K),l<0&&(l+=1);v-=d(K),v<0&&(v+=1);return function(){const K=2091639*Y+2.3283064365386963e-10*U;return Y=l,l=v,v=K-(U=0|K)}}(K);this.p=function(K){const Y=new Uint8Array(256);for(let l=0;l<256;l++)Y[l]=l;for(let l=0;l<255;l++){const v=l+~~(K()*(256-l)),U=Y[l];Y[l]=Y[v],Y[v]=U}return Y}(Y),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[255&l],this.permMod12[l]=this.perm[l]%12}noise2D(K,Y){const l=this.permMod12,d=this.perm;let A=0,c=0,t=0;const m=(K+Y)*v,V=Math.floor(K+m),M=Math.floor(Y+m),u=(V+M)*U,o=K-(V-u),W=Y-(M-u);let g,J;o>W?(g=1,J=0):(g=0,J=1);const n=o-g+U,R=W-J+U,H=o-1+2*U,z=W-1+2*U,r=255&V,E=255&M;let y=.5-o*o-W*W;if(y>=0){const K=3*l[r+d[E]];y*=y,A=y*y*(Z[K]*o+Z[K+1]*W)}let T=.5-n*n-R*R;if(T>=0){const K=3*l[r+g+d[E+J]];T*=T,c=T*T*(Z[K]*n+Z[K+1]*R)}let e=.5-H*H-z*z;if(e>=0){const K=3*l[r+1+d[E+1]];e*=e,t=e*e*(Z[K]*H+Z[K+1]*z)}return 70*(A+c+t)}noise3D(K,Y,l){const v=this.permMod12,U=this.perm;let c,t,m,V;const M=(K+Y+l)*d,u=Math.floor(K+M),o=Math.floor(Y+M),W=Math.floor(l+M),g=(u+o+W)*A,J=K-(u-g),n=Y-(o-g),R=l-(W-g);let H,z,r,E,y,T;J>=n?n>=R?(H=1,z=0,r=0,E=1,y=1,T=0):J>=R?(H=1,z=0,r=0,E=1,y=0,T=1):(H=0,z=0,r=1,E=1,y=0,T=1):n<R?(H=0,z=0,r=1,E=0,y=1,T=1):J<R?(H=0,z=1,r=0,E=0,y=1,T=1):(H=0,z=1,r=0,E=1,y=1,T=0);const e=J-H+A,i=n-z+A,D=R-r+A,B=J-E+2*A,P=n-y+2*A,G=R-T+2*A,Q=J-1+.5,X=n-1+.5,f=R-1+.5,w=255&u,k=255&o,I=255&W;let L=.6-J*J-n*n-R*R;if(L<0)c=0;else{const K=3*v[w+U[k+U[I]]];L*=L,c=L*L*(Z[K]*J+Z[K+1]*n+Z[K+2]*R)}let a=.6-e*e-i*i-D*D;if(a<0)t=0;else{const K=3*v[w+H+U[k+z+U[I+r]]];a*=a,t=a*a*(Z[K]*e+Z[K+1]*i+Z[K+2]*D)}let F=.6-B*B-P*P-G*G;if(F<0)m=0;else{const K=3*v[w+E+U[k+y+U[I+T]]];F*=F,m=F*F*(Z[K]*B+Z[K+1]*P+Z[K+2]*G)}let s=.6-Q*Q-X*X-f*f;if(s<0)V=0;else{const K=3*v[w+1+U[k+1+U[I+1]]];s*=s,V=s*s*(Z[K]*Q+Z[K+1]*X+Z[K+2]*f)}return 32*(c+t+m+V)}noise4D(K,Y,l,v){const U=this.perm;let d,A,Z,V,M;const u=(K+Y+l+v)*c,o=Math.floor(K+u),W=Math.floor(Y+u),g=Math.floor(l+u),J=Math.floor(v+u),n=(o+W+g+J)*t,R=K-(o-n),H=Y-(W-n),z=l-(g-n),r=v-(J-n);let E=0,y=0,T=0,e=0;R>H?E++:y++,R>z?E++:T++,R>r?E++:e++,H>z?y++:T++,H>r?y++:e++,z>r?T++:e++;const i=E>=3?1:0,D=y>=3?1:0,B=T>=3?1:0,P=e>=3?1:0,G=E>=2?1:0,Q=y>=2?1:0,X=T>=2?1:0,f=e>=2?1:0,w=E>=1?1:0,k=y>=1?1:0,I=T>=1?1:0,L=e>=1?1:0,a=R-i+t,F=H-D+t,s=z-B+t,b=r-P+t,x=R-G+2*t,C=H-Q+2*t,N=z-X+2*t,j=r-f+2*t,p=R-w+3*t,S=H-k+3*t,q=z-I+3*t,O=r-L+3*t,h=R-1+4*t,KK=H-1+4*t,YK=z-1+4*t,lK=r-1+4*t,vK=255&o,UK=255&W,dK=255&g,AK=255&J;let cK=.6-R*R-H*H-z*z-r*r;if(cK<0)d=0;else{const K=U[vK+U[UK+U[dK+U[AK]]]]%32*4;cK*=cK,d=cK*cK*(m[K]*R+m[K+1]*H+m[K+2]*z+m[K+3]*r)}let tK=.6-a*a-F*F-s*s-b*b;if(tK<0)A=0;else{const K=U[vK+i+U[UK+D+U[dK+B+U[AK+P]]]]%32*4;tK*=tK,A=tK*tK*(m[K]*a+m[K+1]*F+m[K+2]*s+m[K+3]*b)}let ZK=.6-x*x-C*C-N*N-j*j;if(ZK<0)Z=0;else{const K=U[vK+G+U[UK+Q+U[dK+X+U[AK+f]]]]%32*4;ZK*=ZK,Z=ZK*ZK*(m[K]*x+m[K+1]*C+m[K+2]*N+m[K+3]*j)}let mK=.6-p*p-S*S-q*q-O*O;if(mK<0)V=0;else{const K=U[vK+w+U[UK+k+U[dK+I+U[AK+L]]]]%32*4;mK*=mK,V=mK*mK*(m[K]*p+m[K+1]*S+m[K+2]*q+m[K+3]*O)}let VK=.6-h*h-KK*KK-YK*YK-lK*lK;if(VK<0)M=0;else{const K=U[vK+1+U[UK+1+U[dK+1+U[AK+1]]]]%32*4;VK*=VK,M=VK*VK*(m[K]*h+m[K+1]*KK+m[K+2]*YK+m[K+3]*lK)}return 27*(d+A+Z+V+M)}}}}]);