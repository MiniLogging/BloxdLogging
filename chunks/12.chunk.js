"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[12,20],{12631:(a,O,i)=>{i.r(O),i.d(O,{Dispose:()=>h,DumpData:()=>e,DumpDataAsync:()=>P,DumpFramebuffer:()=>I,DumpTools:()=>j});var H=i(12505),b=i(12184),G=i(12412),q=i(12236);let Q,k=null;async function I(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const Q=await i.readPixels(0,0,a,O);e(a,O,new Uint8Array(Q.buffer),H,b,G,!0,void 0,q)}async function P(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0;return await new Promise((k=>{e(a,O,i,(a=>k(a)),H,b,G,q,Q)}))}function e(a,O,I,P){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8?arguments[8]:void 0;(async function(){return k||(k=new Promise(((a,O)=>{let b,G=null;const k={rb:!0,depth:!1,hb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,12537)).then((I=>{let{ThinEngine:P}=I;const e=q.b.Instances.length;try{b=new OffscreenCanvas(100,100),G=new P(b,!1,k)}catch(F){var j;e<q.b.Instances.length&&(null===(j=q.b.Instances.pop())||void 0===j||j.dispose()),b=document.createElement("canvas"),G=new P(b,!1,k)}q.b.Instances.pop(),q.b.OnEnginesDisposedObservable.add((a=>{G&&a!==G&&!G.h&&0===q.b.Instances.length&&h()})),G.getCaps().parallelShaderCompile=void 0;const Z=new H.b(G);i.e(52).then(i.bind(i,14893)).then((i=>{let{passPixelShader:q}=i;if(!G)return void O("Engine is not defined");const k=new H.e({jO:G,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});Q={canvas:b,jO:G,renderer:Z,wrapper:k},a(Q)}))})).catch(O)}))),await k})().then((i=>{if(i.jO.setSize(a,O,!0),I instanceof Float32Array){const a=new Uint8Array(I.length);let O=I.length;for(;O--;){const i=I[O];a[O]=Math.round(255*(0,G.Clamp)(i))}I=a}const H=i.jO.createRawTexture(I,a,O,5,!1,!Z,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",H),i.renderer.draw(),F?b.Tools.ToBlob(i.canvas,(a=>{const O=new FileReader;O.onload=a=>{const O=a.target.result;P&&P(O)},O.readAsArrayBuffer(a)}),e,r):b.Tools.EncodeScreenshotCanvasData(i.canvas,P,e,j,r),H.dispose()}))}function h(){var a;Q?(Q.wrapper.dispose(),Q.renderer.dispose(),Q.jO.dispose()):null===(a=k)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.jO.dispose()}));k=null,Q=null}const j={DumpData:e,DumpDataAsync:P,DumpFramebuffer:I,Dispose:h};b.Tools.DumpData=e,b.Tools.DumpDataAsync=P,b.Tools.DumpFramebuffer=I},12363:(a,O,i)=>{i.r(O),i.d(O,{CreateScreenshot:()=>M,CreateScreenshotAsync:()=>C,CreateScreenshotUsingRenderTarget:()=>D,CreateScreenshotUsingRenderTargetAsync:()=>U,CreateScreenshotWithResizeAsync:()=>n,ScreenshotTools:()=>w});var H=i(12370),b=i(12454),G=i(12496),q=i(12346),Q=i(12427),k=i(12505),I=i(12528),P=i(12395);class e extends k.e{static _GetDefines(a){if(!a)return null;return a.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(a,O){a?(this._webGPUReady=!0,O.push(Promise.all([i.e(54).then(i.bind(i,14907)),i.e(55).then(i.bind(i,14915))]))):O.push(Promise.all([i.e(56).then(i.bind(i,14922)),i.e(57).then(i.bind(i,14926))]))}constructor(a){const O={...arguments.length>2?arguments[2]:void 0,name:a,jO:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||I.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:e.VertexUrl,fragmentShader:e.FragmentUrl,uniforms:e.Uniforms};super({...O,defines:e._GetDefines(O.jO)}),this.texelSize=new P.Vector2(0,0)}bind(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(a),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}e.VertexUrl="fxaa",e.FragmentUrl="fxaa",e.Uniforms=["texelSize"];class h extends G.e{getClassName(){return"FxaaPostProcess"}constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const k={uniforms:e.Uniforms,size:"number"===typeof O?O:void 0,camera:i,samplingMode:b||H.e.BILINEAR_SAMPLINGMODE,jO:G,reusable:q,textureType:Q,...O};super(a,e.FragmentUrl,{effectWrapper:"number"!==typeof O&&O.effectWrapper?void 0:new e(a,G,k),...k}),this.onApplyObservable.add((a=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(a,O,i,H){return Q.d.Parse((()=>new h(a.name,a.options,O,a.renderTargetSamplingMode,i.getEngine(),a.reusable)),a,i,H)}}(0,q.h)("BABYLON.FxaaPostProcess",h);var j=i(12209),Z=i(12184),F=i(12631),r=i(12638),J=i(12265);let ma=null;function M(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:k,width:I}=y(a,O,i);if(!k||!I)return void j.c.Error("Invalid 'size' parameter !");O.Ua().activeCamera===O?a.onEndFrameObservable.addOnce((()=>{ma||(ma=document.createElement("canvas")),ma.width=I,ma.height=k;const O=ma.getContext("2d"),i=a.getRenderingCanvas();if(!O||!i)return void j.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const P=i.width,e=i.height,h=ma.width,F=ma.height,r=h/P,J=F/e,M=Q?Math.max(r,J):Math.min(r,J),C=P*M,n=e*M,D=(h-C)/2,U=(F-n)/2;O.drawImage(i,0,0,P,e,D,U,C,n),G?(Z.Tools.EncodeScreenshotCanvasData(ma,void 0,b,void 0,q),H&&H("")):Z.Tools.EncodeScreenshotCanvasData(ma,H,b,void 0,q)})):D(a,O,i,(a=>{if(G){const O=new Blob([a]);Z.Tools.DownloadBlob(O),H&&H("")}else H&&H(a)}),b,1,a.getCreationOptions().antialias,void 0,void 0,void 0,void 0,q)}async function C(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((q,Q)=>{M(a,O,i,(a=>{"undefined"!==typeof a?q(a):Q(new Error("Data is undefined"))}),H,void 0,b,G)}))}async function n(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((Q=>{M(a,O,{width:i,height:H},(()=>{Q()}),b,!0,G,q)}))}function D(a,O,G,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,I=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]&&arguments[9],ma=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],M=arguments.length>11?arguments[11]:void 0,C=arguments.length>12?arguments[12]:void 0,n=arguments.length>13?arguments[13]:void 0;const{height:D,width:U,finalWidth:w,finalHeight:K}=y(a,O,G),S={width:U,height:D};if(!D||!U)return void j.c.Error("Invalid 'size' parameter !");a.skipFrameRender=!0;const f=a.getRenderWidth,B=a.getRenderHeight;a.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&a._currentRenderTarget?a._currentRenderTarget.width:U},a.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&a._currentRenderTarget?a._currentRenderTarget.height:D},a.onResizeObservable.hasObservers()&&a.onResizeObservable.notifyObservers(a);const T=O.Ua(),A=new b.d("screenShot",S,T,!1,!1,0,!1,H.e.BILINEAR_SAMPLINGMODE,void 0,Z,void 0,void 0,void 0,k);A.renderList=T.meshes.slice(),A.samples=k,A.renderSprites=e,A.activeCamera=O,A.forceLayerMaskCheck=ma,null===C||void 0===C||C(A);const E=n||F.DumpData,l=()=>{T.incrementRenderId(),T.resetCachedMaterial(),(0,J.f)((()=>A.isReadyForRendering()&&O.isReady(!0)),(()=>{a.onEndFrameObservable.addOnce((()=>{w===U&&K===D?A.readPixels(void 0,void 0,void 0,!1).then((a=>{E(U,D,a,q,Q,P,!0,void 0,M),A.dispose()})):(a.isWebGPU?i.e(51).then(i.bind(i,14887)):i.e(52).then(i.bind(i,14893))).then((async()=>await(0,r.b)("pass",A.getInternalTexture(),T,void 0,void 0,void 0,w,K).then((O=>{a._readTexturePixels(O,w,K,-1,0,null,!0,!1,0,0).then((a=>{E(w,K,a,q,Q,P,!0,void 0,M),O.dispose()}))}))))})),T.incrementRenderId(),T.resetCachedMaterial();const H=T.activeCamera,b=T.activeCameras,G=O.outputRenderTarget,k=T.spritesEnabled;T.activeCamera=O,T.activeCameras=null,O.outputRenderTarget=A,T.spritesEnabled=e;const I=T.meshes;T.meshes=A.renderList||T.meshes;try{T.render()}finally{T.activeCamera=H,T.activeCameras=b,O.outputRenderTarget=G,T.spritesEnabled=k,T.meshes=I,a.getRenderWidth=f,a.getRenderHeight=B,a.onResizeObservable.hasObservers()&&a.onResizeObservable.notifyObservers(a),O.getProjectionMatrix(!0),a.skipFrameRender=!1}}),(()=>{a.skipFrameRender=!1,a.getRenderWidth=f,a.getRenderHeight=B}))};if(I){const a=new h("antialiasing",1,T.activeCamera);A.addPostProcess(a),a.Jb=!0,a.onEffectCreatedObservable.addOnce((a=>{a.isReady()?l():a.onCompiled=()=>{l()}}))}else l()}async function U(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],I=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],P=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0,h=arguments.length>12?arguments[12]:void 0;return await new Promise(((j,Z)=>{D(a,O,i,(a=>{"undefined"!==typeof a?j(a):Z(new Error("Data is undefined"))}),H,b,G,q,Q,k,I,P,e,h)}))}function y(a,O,i){let H=0,b=0,G=0,q=0;if("object"===typeof i){const Q=i.precision?Math.abs(i.precision):1;i.width&&i.height?(H=i.height*Q,b=i.width*Q):i.width&&!i.height?(b=i.width*Q,H=Math.round(b/a.getAspectRatio(O))):i.height&&!i.width?(H=i.height*Q,b=Math.round(H*a.getAspectRatio(O))):(b=Math.round(a.getRenderWidth()*Q),H=Math.round(b/a.getAspectRatio(O))),i.finalWidth&&i.finalHeight?(q=i.finalHeight,G=i.finalWidth):i.finalWidth&&!i.finalHeight?(G=i.finalWidth,q=Math.round(G/a.getAspectRatio(O))):i.finalHeight&&!i.finalWidth?(q=i.finalHeight,G=Math.round(q*a.getAspectRatio(O))):(G=b,q=H)}else isNaN(i)||(H=i,b=i,G=i,q=i);return b&&(b=Math.floor(b)),H&&(H=Math.floor(H)),G&&(G=Math.floor(G)),q&&(q=Math.floor(q)),{height:0|H,width:0|b,finalWidth:0|G,finalHeight:0|q}}const w={CreateScreenshot:M,CreateScreenshotAsync:C,CreateScreenshotWithResizeAsync:n,CreateScreenshotUsingRenderTarget:D,CreateScreenshotUsingRenderTargetAsync:U};Z.Tools.CreateScreenshot=M,Z.Tools.CreateScreenshotAsync=C,Z.Tools.CreateScreenshotUsingRenderTarget=D,Z.Tools.CreateScreenshotUsingRenderTargetAsync=U}}]);