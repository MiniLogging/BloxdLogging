"use strict";(self.zy41qorie9=self.zy41qorie9||[]).push([[12,20],{12689:(Z,l,C)=>{C.r(l),C.d(l,{Dispose:()=>G,DumpData:()=>E,DumpDataAsync:()=>d,DumpFramebuffer:()=>J,DumpTools:()=>a});var B=C(12568),x=C(12248),b=C(12460),K=C(12295);let f,W=null;async function J(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0;const f=await C.readPixels(0,0,Z,l);E(Z,l,new Uint8Array(f.buffer),B,x,b,!0,void 0,K)}async function d(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7?arguments[7]:void 0;return await new Promise((W=>{E(Z,l,C,(Z=>W(Z)),B,x,b,K,f)}))}function E(Z,l,J,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8?arguments[8]:void 0;(async function(){return W||(W=new Promise(((Z,l)=>{let x,b=null;const W={Gb:!0,depth:!1,bb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12596)).then((J=>{let{ThinEngine:d}=J;const E=K.b.Instances.length;try{x=new OffscreenCanvas(100,100),b=new d(x,!1,W)}catch(z){var a;E<K.b.Instances.length&&(null===(a=K.b.Instances.pop())||void 0===a||a.dispose()),x=document.createElement("canvas"),b=new d(x,!1,W)}K.b.Instances.pop(),K.b.OnEnginesDisposedObservable.add((Z=>{b&&Z!==b&&!b.J&&0===K.b.Instances.length&&G()})),b.getCaps().parallelShaderCompile=void 0;const q=new B.e(b);C.e(52).then(C.bind(C,14623)).then((C=>{let{passPixelShader:K}=C;if(!b)return void l("Engine is not defined");const W=new B.i({al:b,name:K.name,fragmentShader:K.shader,samplerNames:["textureSampler"]});f={canvas:x,al:b,renderer:q,wrapper:W},Z(f)}))})).catch(l)}))),await W})().then((C=>{if(C.al.setSize(Z,l,!0),J instanceof Float32Array){const Z=new Uint8Array(J.length);let l=J.length;for(;l--;){const C=J[l];Z[l]=Math.round(255*(0,b.Clamp)(C))}J=Z}const B=C.al.createRawTexture(J,Z,l,5,!1,!q,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",B),C.renderer.draw(),z?x.Tools.ToBlob(C.canvas,(Z=>{const l=new FileReader;l.onload=Z=>{const l=Z.target.result;d&&d(l)},l.readAsArrayBuffer(Z)}),E,Y):x.Tools.EncodeScreenshotCanvasData(C.canvas,d,E,a,Y),B.dispose()}))}function G(){var Z;f?(f.wrapper.dispose(),f.renderer.dispose(),f.al.dispose()):null===(Z=W)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.al.dispose()}));W=null,f=null}const a={DumpData:E,DumpDataAsync:d,DumpFramebuffer:J,Dispose:G};x.Tools.DumpData=E,x.Tools.DumpDataAsync=d,x.Tools.DumpFramebuffer=J},12416:(Z,l,C)=>{C.r(l),C.d(l,{CreateScreenshot:()=>i,CreateScreenshotAsync:()=>s,CreateScreenshotUsingRenderTarget:()=>n,CreateScreenshotUsingRenderTargetAsync:()=>c,CreateScreenshotWithResizeAsync:()=>F,ScreenshotTools:()=>t});var B=C(12423),x=C(12519),b=C(12565),K=C(12400),f=C(12478),W=C(12568),J=C(12589),d=C(12442);class E extends W.i{static _GetDefines(Z){if(!Z)return null;return Z.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(Z,l){Z?(this._webGPUReady=!0,l.push(Promise.all([C.e(54).then(C.bind(C,14632)),C.e(55).then(C.bind(C,14634))]))):l.push(Promise.all([C.e(56).then(C.bind(C,14637)),C.e(57).then(C.bind(C,14645))]))}constructor(Z){const l={...arguments.length>2?arguments[2]:void 0,name:Z,al:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||J.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:E.VertexUrl,fragmentShader:E.FragmentUrl,uniforms:E.Uniforms};super({...l,defines:E._GetDefines(l.al)}),this.texelSize=new d.Vector2(0,0)}bind(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(Z),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}E.VertexUrl="fxaa",E.FragmentUrl="fxaa",E.Uniforms=["texelSize"];class G extends b.b{getClassName(){return"FxaaPostProcess"}constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const W={uniforms:E.Uniforms,size:"number"===typeof l?l:void 0,camera:C,samplingMode:x||B.c.BILINEAR_SAMPLINGMODE,al:b,reusable:K,textureType:f,...l};super(Z,E.FragmentUrl,{effectWrapper:"number"!==typeof l&&l.effectWrapper?void 0:new E(Z,b,W),...W}),this.onApplyObservable.add((Z=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(Z,l,C,B){return f.b.Parse((()=>new G(Z.name,Z.options,l,Z.renderTargetSamplingMode,C.getEngine(),Z.reusable)),Z,C,B)}}(0,K.c)("BABYLON.FxaaPostProcess",G);var a=C(12263),q=C(12248),z=C(12689),Y=C(12693),P=C(12339);let S=null;function i(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:W,width:J}=U(Z,l,C);if(!W||!J)return void a.e.Error("Invalid 'size' parameter !");l.cZ().activeCamera===l?Z.onEndFrameObservable.addOnce((()=>{S||(S=document.createElement("canvas")),S.width=J,S.height=W;const l=S.getContext("2d"),C=Z.getRenderingCanvas();if(!l||!C)return void a.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const d=C.width,E=C.height,G=S.width,z=S.height,Y=G/d,P=z/E,i=f?Math.max(Y,P):Math.min(Y,P),s=d*i,F=E*i,n=(G-s)/2,c=(z-F)/2;l.drawImage(C,0,0,d,E,n,c,s,F),b?(q.Tools.EncodeScreenshotCanvasData(S,void 0,x,void 0,K),B&&B("")):q.Tools.EncodeScreenshotCanvasData(S,B,x,void 0,K)})):n(Z,l,C,(Z=>{if(b){const l=new Blob([Z]);q.Tools.DownloadBlob(l),B&&B("")}else B&&B(Z)}),x,1,Z.getCreationOptions().antialias,void 0,void 0,void 0,void 0,K)}async function s(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((K,f)=>{i(Z,l,C,(Z=>{"undefined"!==typeof Z?K(Z):f(new Error("Data is undefined"))}),B,void 0,x,b)}))}async function F(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((f=>{i(Z,l,{width:C,height:B},(()=>{f()}),x,!0,b,K)}))}function n(Z,l,b,K){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]&&arguments[9],S=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],i=arguments.length>11?arguments[11]:void 0,s=arguments.length>12?arguments[12]:void 0,F=arguments.length>13?arguments[13]:void 0;const{height:n,width:c,finalWidth:t,finalHeight:r}=U(Z,l,b),e={width:c,height:n};if(!n||!c)return void a.e.Error("Invalid 'size' parameter !");Z.skipFrameRender=!0;const o=Z.getRenderWidth,v=Z.getRenderHeight;Z.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.width:c},Z.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.height:n},Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z);const R=l.cZ(),k=new x.d("screenShot",e,R,!1,!1,0,!1,B.c.BILINEAR_SAMPLINGMODE,void 0,q,void 0,void 0,void 0,W);k.renderList=R.meshes.slice(),k.samples=W,k.renderSprites=E,k.activeCamera=l,k.forceLayerMaskCheck=S,null===s||void 0===s||s(k);const V=F||z.DumpData,g=()=>{R.incrementRenderId(),R.resetCachedMaterial(),(0,P.d)((()=>k.isReadyForRendering()&&l.isReady(!0)),(()=>{Z.onEndFrameObservable.addOnce((()=>{t===c&&r===n?k.readPixels(void 0,void 0,void 0,!1).then((Z=>{V(c,n,Z,K,f,d,!0,void 0,i),k.dispose()})):(Z.isWebGPU?C.e(51).then(C.bind(C,14615)):C.e(52).then(C.bind(C,14623))).then((async()=>await(0,Y.b)("pass",k.getInternalTexture(),R,void 0,void 0,void 0,t,r).then((l=>{Z._readTexturePixels(l,t,r,-1,0,null,!0,!1,0,0).then((Z=>{V(t,r,Z,K,f,d,!0,void 0,i),l.dispose()}))}))))})),R.incrementRenderId(),R.resetCachedMaterial();const B=R.activeCamera,x=R.activeCameras,b=l.outputRenderTarget,W=R.spritesEnabled;R.activeCamera=l,R.activeCameras=null,l.outputRenderTarget=k,R.spritesEnabled=E;const J=R.meshes;R.meshes=k.renderList||R.meshes;try{R.render()}finally{R.activeCamera=B,R.activeCameras=x,l.outputRenderTarget=b,R.spritesEnabled=W,R.meshes=J,Z.getRenderWidth=o,Z.getRenderHeight=v,Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z),l.getProjectionMatrix(!0),Z.skipFrameRender=!1}}),(()=>{Z.skipFrameRender=!1,Z.getRenderWidth=o,Z.getRenderHeight=v}))};if(J){const Z=new G("antialiasing",1,R.activeCamera);k.addPostProcess(Z),Z.ab=!0,Z.onEffectCreatedObservable.addOnce((Z=>{Z.isReady()?g():Z.onCompiled=()=>{g()}}))}else g()}async function c(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=arguments.length>10?arguments[10]:void 0,E=arguments.length>11?arguments[11]:void 0,G=arguments.length>12?arguments[12]:void 0;return await new Promise(((a,q)=>{n(Z,l,C,(Z=>{"undefined"!==typeof Z?a(Z):q(new Error("Data is undefined"))}),B,x,b,K,f,W,J,d,E,G)}))}function U(Z,l,C){let B=0,x=0,b=0,K=0;if("object"===typeof C){const f=C.precision?Math.abs(C.precision):1;C.width&&C.height?(B=C.height*f,x=C.width*f):C.width&&!C.height?(x=C.width*f,B=Math.round(x/Z.getAspectRatio(l))):C.height&&!C.width?(B=C.height*f,x=Math.round(B*Z.getAspectRatio(l))):(x=Math.round(Z.getRenderWidth()*f),B=Math.round(x/Z.getAspectRatio(l))),C.finalWidth&&C.finalHeight?(K=C.finalHeight,b=C.finalWidth):C.finalWidth&&!C.finalHeight?(b=C.finalWidth,K=Math.round(b/Z.getAspectRatio(l))):C.finalHeight&&!C.finalWidth?(K=C.finalHeight,b=Math.round(K*Z.getAspectRatio(l))):(b=x,K=B)}else isNaN(C)||(B=C,x=C,b=C,K=C);return x&&(x=Math.floor(x)),B&&(B=Math.floor(B)),b&&(b=Math.floor(b)),K&&(K=Math.floor(K)),{height:0|B,width:0|x,finalWidth:0|b,finalHeight:0|K}}const t={CreateScreenshot:i,CreateScreenshotAsync:s,CreateScreenshotWithResizeAsync:F,CreateScreenshotUsingRenderTarget:n,CreateScreenshotUsingRenderTargetAsync:c};q.Tools.CreateScreenshot=i,q.Tools.CreateScreenshotAsync=s,q.Tools.CreateScreenshotUsingRenderTarget=n,q.Tools.CreateScreenshotUsingRenderTargetAsync=c}}]);