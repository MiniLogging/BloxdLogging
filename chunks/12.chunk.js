"use strict";(self.n52dyox90qa=self.n52dyox90qa||[]).push([[12,20],{12036:(E,t,z)=>{z.r(t),z.d(t,{Dispose:()=>d,DumpData:()=>h,DumpDataAsync:()=>H,DumpFramebuffer:()=>Z,DumpTools:()=>y});var A=z(11933),X=z(11630),R=z(11834),u=z(11667);let p,C=null;async function Z(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const p=await z.readPixels(0,0,E,t);h(E,t,new Uint8Array(p.buffer),A,X,R,!0,void 0,u)}async function H(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{h(E,t,z,(E=>C(E)),A,X,R,u,p)}))}function h(E,t,Z,H){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((E,t)=>{let X,R=null;const C={Ap:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(z.bind(z,11960)).then((Z=>{let{ThinEngine:H}=Z;const h=u.d.Instances.length;try{X=new OffscreenCanvas(100,100),R=new H(X,!1,C)}catch(c){var y;h<u.d.Instances.length&&(null===(y=u.d.Instances.pop())||void 0===y||y.dispose()),X=document.createElement("canvas"),R=new H(X,!1,C)}u.d.Instances.pop(),u.d.OnEnginesDisposedObservable.add((E=>{R&&E!==R&&!R.C&&0===u.d.Instances.length&&d()})),R.getCaps().parallelShaderCompile=void 0;const O=new A.d(R);z.e(52).then(z.bind(z,14245)).then((z=>{let{passPixelShader:u}=z;if(!R)return void t("Engine is not defined");const C=new A.h({ct:R,name:u.name,fragmentShader:u.shader,samplerNames:["textureSampler"]});p={canvas:X,ct:R,renderer:O,wrapper:C},E(p)}))})).catch(t)}))),await C})().then((z=>{if(z.ct.setSize(E,t,!0),Z instanceof Float32Array){const E=new Uint8Array(Z.length);let t=Z.length;for(;t--;){const z=Z[t];E[t]=Math.round(255*(0,R.Clamp)(z))}Z=E}const A=z.ct.createRawTexture(Z,E,t,5,!1,!O,1);z.renderer.setViewport(),z.renderer.applyEffectWrapper(z.wrapper),z.wrapper.effect._bindTexture("textureSampler",A),z.renderer.draw(),c?X.Tools.ToBlob(z.canvas,(E=>{const t=new FileReader;t.onload=E=>{const t=E.target.result;H&&H(t)},t.readAsArrayBuffer(E)}),h,a):X.Tools.EncodeScreenshotCanvasData(z.canvas,H,h,y,a),A.dispose()}))}function d(){var E;p?(p.wrapper.dispose(),p.renderer.dispose(),p.ct.dispose()):null===(E=C)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.ct.dispose()}));C=null,p=null}const y={DumpData:h,DumpDataAsync:H,DumpFramebuffer:Z,Dispose:d};X.Tools.DumpData=h,X.Tools.DumpDataAsync=H,X.Tools.DumpFramebuffer=Z},11787:(E,t,z)=>{z.r(t),z.d(t,{CreateScreenshot:()=>W,CreateScreenshotAsync:()=>I,CreateScreenshotUsingRenderTarget:()=>D,CreateScreenshotUsingRenderTargetAsync:()=>S,CreateScreenshotWithResizeAsync:()=>e,ScreenshotTools:()=>f});var A=z(11790),X=z(11879),R=z(11929),u=z(11766),p=z(11849),C=z(11933),Z=z(11956),H=z(11812);class h extends C.h{static _GetDefines(E){if(!E)return null;return E.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(E,t){E?(this._webGPUReady=!0,t.push(Promise.all([z.e(54).then(z.bind(z,14258)),z.e(55).then(z.bind(z,14263))]))):t.push(Promise.all([z.e(56).then(z.bind(z,14272)),z.e(57).then(z.bind(z,14279))]))}constructor(E){const t={...arguments.length>2?arguments[2]:void 0,name:E,ct:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||Z.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:h.VertexUrl,fragmentShader:h.FragmentUrl,uniforms:h.Uniforms};super({...t,defines:h._GetDefines(t.ct)}),this.texelSize=new H.Vector2(0,0)}bind(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(E),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}h.VertexUrl="fxaa",h.FragmentUrl="fxaa",h.Uniforms=["texelSize"];class d extends R.b{getClassName(){return"FxaaPostProcess"}constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3?arguments[3]:void 0,R=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const C={uniforms:h.Uniforms,size:"number"===typeof t?t:void 0,camera:z,samplingMode:X||A.d.BILINEAR_SAMPLINGMODE,ct:R,reusable:u,textureType:p,...t};super(E,h.FragmentUrl,{effectWrapper:"number"!==typeof t&&t.effectWrapper?void 0:new h(E,R,C),...C}),this.onApplyObservable.add((E=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(E,t,z,A){return p.b.Parse((()=>new d(E.name,E.options,t,E.renderTargetSamplingMode,z.getEngine(),E.reusable)),E,z,A)}}(0,u.f)("BABYLON.FxaaPostProcess",d);var y=z(11640),O=z(11630),c=z(12036),a=z(12044),L=z(11707);let mE=null;function W(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0,p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:C,width:Z}=l(E,t,z);if(!C||!Z)return void y.d.Error("Invalid 'size' parameter !");t.lE().activeCamera===t?E.onEndFrameObservable.addOnce((()=>{mE||(mE=document.createElement("canvas")),mE.width=Z,mE.height=C;const t=mE.getContext("2d"),z=E.getRenderingCanvas();if(!t||!z)return void y.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const H=z.width,h=z.height,d=mE.width,c=mE.height,a=d/H,L=c/h,W=p?Math.max(a,L):Math.min(a,L),I=H*W,e=h*W,D=(d-I)/2,S=(c-e)/2;t.drawImage(z,0,0,H,h,D,S,I,e),R?(O.Tools.EncodeScreenshotCanvasData(mE,void 0,X,void 0,u),A&&A("")):O.Tools.EncodeScreenshotCanvasData(mE,A,X,void 0,u)})):D(E,t,z,(E=>{if(R){const t=new Blob([E]);O.Tools.DownloadBlob(t),A&&A("")}else A&&A(E)}),X,1,E.getCreationOptions().antialias,void 0,void 0,void 0,void 0,u)}async function I(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((u,p)=>{W(E,t,z,(E=>{"undefined"!==typeof E?u(E):p(new Error("Data is undefined"))}),A,void 0,X,R)}))}async function e(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((p=>{W(E,t,{width:z,height:A},(()=>{p()}),X,!0,R,u)}))}function D(E,t,R,u){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=arguments.length>9&&void 0!==arguments[9]&&arguments[9],mE=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],W=arguments.length>11?arguments[11]:void 0,I=arguments.length>12?arguments[12]:void 0,e=arguments.length>13?arguments[13]:void 0;const{height:D,width:S,finalWidth:f,finalHeight:K}=l(E,t,R),F={width:S,height:D};if(!D||!S)return void y.d.Error("Invalid 'size' parameter !");E.skipFrameRender=!0;const B=E.getRenderWidth,b=E.getRenderHeight;E.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&E._currentRenderTarget?E._currentRenderTarget.width:S},E.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&E._currentRenderTarget?E._currentRenderTarget.height:D},E.onResizeObservable.hasObservers()&&E.onResizeObservable.notifyObservers(E);const x=t.lE(),J=new X.e("screenShot",F,x,!1,!1,0,!1,A.d.BILINEAR_SAMPLINGMODE,void 0,O,void 0,void 0,void 0,C);J.renderList=x.meshes.slice(),J.samples=C,J.renderSprites=h,J.activeCamera=t,J.forceLayerMaskCheck=mE,null===I||void 0===I||I(J);const V=e||c.DumpData,r=()=>{x.incrementRenderId(),x.resetCachedMaterial(),(0,L.e)((()=>J.isReadyForRendering()&&t.isReady(!0)),(()=>{E.onEndFrameObservable.addOnce((()=>{f===S&&K===D?J.readPixels(void 0,void 0,void 0,!1).then((E=>{V(S,D,E,u,p,H,!0,void 0,W),J.dispose()})):(E.isWebGPU?z.e(51).then(z.bind(z,14242)):z.e(52).then(z.bind(z,14245))).then((async()=>await(0,a.c)("pass",J.getInternalTexture(),x,void 0,void 0,void 0,f,K).then((t=>{E._readTexturePixels(t,f,K,-1,0,null,!0,!1,0,0).then((E=>{V(f,K,E,u,p,H,!0,void 0,W),t.dispose()}))}))))})),x.incrementRenderId(),x.resetCachedMaterial();const A=x.activeCamera,X=x.activeCameras,R=t.outputRenderTarget,C=x.spritesEnabled;x.activeCamera=t,x.activeCameras=null,t.outputRenderTarget=J,x.spritesEnabled=h;const Z=x.meshes;x.meshes=J.renderList||x.meshes;try{x.render()}finally{x.activeCamera=A,x.activeCameras=X,t.outputRenderTarget=R,x.spritesEnabled=C,x.meshes=Z,E.getRenderWidth=B,E.getRenderHeight=b,E.onResizeObservable.hasObservers()&&E.onResizeObservable.notifyObservers(E),t.getProjectionMatrix(!0),E.skipFrameRender=!1}}),(()=>{E.skipFrameRender=!1,E.getRenderWidth=B,E.getRenderHeight=b}))};if(Z){const E=new d("antialiasing",1,x.activeCamera);J.addPostProcess(E),E.Xp=!0,E.onEffectCreatedObservable.addOnce((E=>{E.isReady()?r():E.onCompiled=()=>{r()}}))}else r()}async function S(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0,p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],H=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0;return await new Promise(((y,O)=>{D(E,t,z,(E=>{"undefined"!==typeof E?y(E):O(new Error("Data is undefined"))}),A,X,R,u,p,C,Z,H,h,d)}))}function l(E,t,z){let A=0,X=0,R=0,u=0;if("object"===typeof z){const p=z.precision?Math.abs(z.precision):1;z.width&&z.height?(A=z.height*p,X=z.width*p):z.width&&!z.height?(X=z.width*p,A=Math.round(X/E.getAspectRatio(t))):z.height&&!z.width?(A=z.height*p,X=Math.round(A*E.getAspectRatio(t))):(X=Math.round(E.getRenderWidth()*p),A=Math.round(X/E.getAspectRatio(t))),z.finalWidth&&z.finalHeight?(u=z.finalHeight,R=z.finalWidth):z.finalWidth&&!z.finalHeight?(R=z.finalWidth,u=Math.round(R/E.getAspectRatio(t))):z.finalHeight&&!z.finalWidth?(u=z.finalHeight,R=Math.round(u*E.getAspectRatio(t))):(R=X,u=A)}else isNaN(z)||(A=z,X=z,R=z,u=z);return X&&(X=Math.floor(X)),A&&(A=Math.floor(A)),R&&(R=Math.floor(R)),u&&(u=Math.floor(u)),{height:0|A,width:0|X,finalWidth:0|R,finalHeight:0|u}}const f={CreateScreenshot:W,CreateScreenshotAsync:I,CreateScreenshotWithResizeAsync:e,CreateScreenshotUsingRenderTarget:D,CreateScreenshotUsingRenderTargetAsync:S};O.Tools.CreateScreenshot=W,O.Tools.CreateScreenshotAsync=I,O.Tools.CreateScreenshotUsingRenderTarget=D,O.Tools.CreateScreenshotUsingRenderTargetAsync=S}}]);