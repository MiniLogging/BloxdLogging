"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12,20],{11325:(q,S,b)=>{b.r(S),b.d(S,{Dispose:()=>y,DumpData:()=>l,DumpDataAsync:()=>V,DumpFramebuffer:()=>I,DumpTools:()=>R});var z=b(11208),C=b(10921),v=b(11121),U=b(10975);let g,r=null;async function I(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const g=await b.readPixels(0,0,q,S);l(q,S,new Uint8Array(g.buffer),z,C,v,!0,void 0,U)}async function V(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0;return await new Promise((r=>{l(q,S,b,(q=>r(q)),z,C,v,U,g)}))}function l(q,S,I,V){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((q,S)=>{let C,v=null;const r={yb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,11239)).then((I=>{let{ThinEngine:V}=I;const l=U.b.Instances.length;try{C=new OffscreenCanvas(100,100),v=new V(C,!1,r)}catch(Z){var R;l<U.b.Instances.length&&(null===(R=U.b.Instances.pop())||void 0===R||R.dispose()),C=document.createElement("canvas"),v=new V(C,!1,r)}U.b.Instances.pop(),U.b.OnEnginesDisposedObservable.add((q=>{v&&q!==v&&!v.V&&0===U.b.Instances.length&&y()})),v.getCaps().parallelShaderCompile=void 0;const G=new z.c(v);b.e(52).then(b.bind(b,13605)).then((b=>{let{passPixelShader:U}=b;if(!v)return void S("Engine is not defined");const r=new z.e({lS:v,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});g={canvas:C,lS:v,renderer:G,wrapper:r},q(g)}))})).catch(S)}))),await r})().then((b=>{if(b.lS.setSize(q,S,!0),I instanceof Float32Array){const q=new Uint8Array(I.length);let S=I.length;for(;S--;){const b=I[S];q[S]=Math.round(255*(0,v.Clamp)(b))}I=q}const z=b.lS.createRawTexture(I,q,S,5,!1,!G,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",z),b.renderer.draw(),Z?C.Tools.ToBlob(b.canvas,(q=>{const S=new FileReader;S.onload=q=>{const S=q.target.result;V&&V(S)},S.readAsArrayBuffer(q)}),l,H):C.Tools.EncodeScreenshotCanvasData(b.canvas,V,l,R,H),z.dispose()}))}function y(){var q;g?(g.wrapper.dispose(),g.renderer.dispose(),g.lS.dispose()):null===(q=r)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.lS.dispose()}));r=null,g=null}const R={DumpData:l,DumpDataAsync:V,DumpFramebuffer:I,Dispose:y};C.Tools.DumpData=l,C.Tools.DumpDataAsync=V,C.Tools.DumpFramebuffer=I},11072:(q,S,b)=>{b.r(S),b.d(S,{CreateScreenshot:()=>W,CreateScreenshotAsync:()=>N,CreateScreenshotUsingRenderTarget:()=>X,CreateScreenshotUsingRenderTargetAsync:()=>T,CreateScreenshotWithResizeAsync:()=>u,ScreenshotTools:()=>t});var z=b(11075),C=b(11162),v=b(11206),U=b(11058),g=b(11137),r=b(11208),I=b(11231),V=b(11103);class l extends r.e{static _GetDefines(q){if(!q)return null;return q.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(q,S){q?(this._webGPUReady=!0,S.push(Promise.all([b.e(54).then(b.bind(b,13611)),b.e(55).then(b.bind(b,13618))]))):S.push(Promise.all([b.e(56).then(b.bind(b,13625)),b.e(57).then(b.bind(b,13630))]))}constructor(q){const S={...arguments.length>2?arguments[2]:void 0,name:q,lS:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||I.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:l.VertexUrl,fragmentShader:l.FragmentUrl,uniforms:l.Uniforms};super({...S,defines:l._GetDefines(S.lS)}),this.texelSize=new V.Vector2(0,0)}bind(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(q),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}l.VertexUrl="fxaa",l.FragmentUrl="fxaa",l.Uniforms=["texelSize"];class y extends v.d{getClassName(){return"FxaaPostProcess"}constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const r={uniforms:l.Uniforms,size:"number"===typeof S?S:void 0,camera:b,samplingMode:C||z.e.BILINEAR_SAMPLINGMODE,lS:v,reusable:U,textureType:g,...S};super(q,l.FragmentUrl,{effectWrapper:"number"!==typeof S&&S.effectWrapper?void 0:new l(q,v,r),...r}),this.onApplyObservable.add((q=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(q,S,b,z){return g.b.Parse((()=>new y(q.name,q.options,S,q.renderTargetSamplingMode,b.getEngine(),q.reusable)),q,b,z)}}(0,U.f)("BABYLON.FxaaPostProcess",y);var R=b(10943),G=b(10921),Z=b(11325),H=b(11329),Q=b(11e3);let k=null;function W(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:r,width:I}=B(q,S,b);if(!r||!I)return void R.b.Error("Invalid 'size' parameter !");S.Tq().activeCamera===S?q.onEndFrameObservable.addOnce((()=>{k||(k=document.createElement("canvas")),k.width=I,k.height=r;const S=k.getContext("2d"),b=q.getRenderingCanvas();if(!S||!b)return void R.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const V=b.width,l=b.height,y=k.width,Z=k.height,H=y/V,Q=Z/l,W=g?Math.max(H,Q):Math.min(H,Q),N=V*W,u=l*W,X=(y-N)/2,T=(Z-u)/2;S.drawImage(b,0,0,V,l,X,T,N,u),v?(G.Tools.EncodeScreenshotCanvasData(k,void 0,C,void 0,U),z&&z("")):G.Tools.EncodeScreenshotCanvasData(k,z,C,void 0,U)})):X(q,S,b,(q=>{if(v){const S=new Blob([q]);G.Tools.DownloadBlob(S),z&&z("")}else z&&z(q)}),C,1,q.getCreationOptions().antialias,void 0,void 0,void 0,void 0,U)}async function N(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((U,g)=>{W(q,S,b,(q=>{"undefined"!==typeof q?U(q):g(new Error("Data is undefined"))}),z,void 0,C,v)}))}async function u(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((g=>{W(q,S,{width:b,height:z},(()=>{g()}),C,!0,v,U)}))}function X(q,S,v,U){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,I=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]&&arguments[9],k=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],W=arguments.length>11?arguments[11]:void 0,N=arguments.length>12?arguments[12]:void 0,u=arguments.length>13?arguments[13]:void 0;const{height:X,width:T,finalWidth:t,finalHeight:f}=B(q,S,v),m={width:T,height:X};if(!X||!T)return void R.b.Error("Invalid 'size' parameter !");q.skipFrameRender=!0;const E=q.getRenderWidth,e=q.getRenderHeight;q.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&q._currentRenderTarget?q._currentRenderTarget.width:T},q.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&q._currentRenderTarget?q._currentRenderTarget.height:X},q.onResizeObservable.hasObservers()&&q.onResizeObservable.notifyObservers(q);const i=S.Tq(),J=new C.c("screenShot",m,i,!1,!1,0,!1,z.e.BILINEAR_SAMPLINGMODE,void 0,G,void 0,void 0,void 0,r);J.renderList=i.meshes.slice(),J.samples=r,J.renderSprites=l,J.activeCamera=S,J.forceLayerMaskCheck=k,null===N||void 0===N||N(J);const L=u||Z.DumpData,d=()=>{i.incrementRenderId(),i.resetCachedMaterial(),(0,Q.f)((()=>J.isReadyForRendering()&&S.isReady(!0)),(()=>{q.onEndFrameObservable.addOnce((()=>{t===T&&f===X?J.readPixels(void 0,void 0,void 0,!1).then((q=>{L(T,X,q,U,g,V,!0,void 0,W),J.dispose()})):(q.isWebGPU?b.e(51).then(b.bind(b,13597)):b.e(52).then(b.bind(b,13605))).then((async()=>await(0,H.b)("pass",J.getInternalTexture(),i,void 0,void 0,void 0,t,f).then((S=>{q._readTexturePixels(S,t,f,-1,0,null,!0,!1,0,0).then((q=>{L(t,f,q,U,g,V,!0,void 0,W),S.dispose()}))}))))})),i.incrementRenderId(),i.resetCachedMaterial();const z=i.activeCamera,C=i.activeCameras,v=S.outputRenderTarget,r=i.spritesEnabled;i.activeCamera=S,i.activeCameras=null,S.outputRenderTarget=J,i.spritesEnabled=l;const I=i.meshes;i.meshes=J.renderList||i.meshes;try{i.render()}finally{i.activeCamera=z,i.activeCameras=C,S.outputRenderTarget=v,i.spritesEnabled=r,i.meshes=I,q.getRenderWidth=E,q.getRenderHeight=e,q.onResizeObservable.hasObservers()&&q.onResizeObservable.notifyObservers(q),S.getProjectionMatrix(!0),q.skipFrameRender=!1}}),(()=>{q.skipFrameRender=!1,q.getRenderWidth=E,q.getRenderHeight=e}))};if(I){const q=new y("antialiasing",1,i.activeCamera);J.addPostProcess(q),q.Rb=!0,q.onEffectCreatedObservable.addOnce((q=>{q.isReady()?d():q.onCompiled=()=>{d()}}))}else d()}async function T(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],I=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],V=arguments.length>10?arguments[10]:void 0,l=arguments.length>11?arguments[11]:void 0,y=arguments.length>12?arguments[12]:void 0;return await new Promise(((R,G)=>{X(q,S,b,(q=>{"undefined"!==typeof q?R(q):G(new Error("Data is undefined"))}),z,C,v,U,g,r,I,V,l,y)}))}function B(q,S,b){let z=0,C=0,v=0,U=0;if("object"===typeof b){const g=b.precision?Math.abs(b.precision):1;b.width&&b.height?(z=b.height*g,C=b.width*g):b.width&&!b.height?(C=b.width*g,z=Math.round(C/q.getAspectRatio(S))):b.height&&!b.width?(z=b.height*g,C=Math.round(z*q.getAspectRatio(S))):(C=Math.round(q.getRenderWidth()*g),z=Math.round(C/q.getAspectRatio(S))),b.finalWidth&&b.finalHeight?(U=b.finalHeight,v=b.finalWidth):b.finalWidth&&!b.finalHeight?(v=b.finalWidth,U=Math.round(v/q.getAspectRatio(S))):b.finalHeight&&!b.finalWidth?(U=b.finalHeight,v=Math.round(U*q.getAspectRatio(S))):(v=C,U=z)}else isNaN(b)||(z=b,C=b,v=b,U=b);return C&&(C=Math.floor(C)),z&&(z=Math.floor(z)),v&&(v=Math.floor(v)),U&&(U=Math.floor(U)),{height:0|z,width:0|C,finalWidth:0|v,finalHeight:0|U}}const t={CreateScreenshot:W,CreateScreenshotAsync:N,CreateScreenshotWithResizeAsync:u,CreateScreenshotUsingRenderTarget:X,CreateScreenshotUsingRenderTargetAsync:T};G.Tools.CreateScreenshot=W,G.Tools.CreateScreenshotAsync=N,G.Tools.CreateScreenshotUsingRenderTarget=X,G.Tools.CreateScreenshotUsingRenderTargetAsync=T}}]);