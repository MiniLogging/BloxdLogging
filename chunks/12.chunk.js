"use strict";(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[12,20],{13097:(Y,c,h)=>{h.r(c),h.d(c,{Dispose:()=>k,DumpData:()=>q,DumpDataAsync:()=>W,DumpFramebuffer:()=>w,DumpTools:()=>M});var C=h(12986),E=h(12687),N=h(12883),Q=h(12722);let b,H=null;async function w(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0;const b=await h.readPixels(0,0,Y,c);q(Y,c,new Uint8Array(b.buffer),C,E,N,!0,void 0,Q)}async function W(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0;return await new Promise((H=>{q(Y,c,h,(Y=>H(Y)),C,E,N,Q,b)}))}function q(Y,c,w,W){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",M=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],y=arguments.length>8?arguments[8]:void 0;(async function(){return H||(H=new Promise(((Y,c)=>{let E,N=null;const H={Tc:!0,depth:!1,Pc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,13010)).then((w=>{let{ThinEngine:W}=w;const q=Q.d.Instances.length;try{E=new OffscreenCanvas(100,100),N=new W(E,!1,H)}catch(P){var M;q<Q.d.Instances.length&&(null===(M=Q.d.Instances.pop())||void 0===M||M.dispose()),E=document.createElement("canvas"),N=new W(E,!1,H)}Q.d.Instances.pop(),Q.d.OnEnginesDisposedObservable.add((Y=>{N&&Y!==N&&!N.q&&0===Q.d.Instances.length&&k()})),N.getCaps().parallelShaderCompile=void 0;const p=new C.b(N);h.e(52).then(h.bind(h,15450)).then((h=>{let{passPixelShader:Q}=h;if(!N)return void c("Engine is not defined");const H=new C.f({Qh:N,name:Q.name,fragmentShader:Q.shader,samplerNames:["textureSampler"]});b={canvas:E,Qh:N,renderer:p,wrapper:H},Y(b)}))})).catch(c)}))),await H})().then((h=>{if(h.Qh.setSize(Y,c,!0),w instanceof Float32Array){const Y=new Uint8Array(w.length);let c=w.length;for(;c--;){const h=w[c];Y[c]=Math.round(255*(0,N.Clamp)(h))}w=Y}const C=h.Qh.createRawTexture(w,Y,c,5,!1,!p,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",C),h.renderer.draw(),P?E.Tools.ToBlob(h.canvas,(Y=>{const c=new FileReader;c.onload=Y=>{const c=Y.target.result;W&&W(c)},c.readAsArrayBuffer(Y)}),q,y):E.Tools.EncodeScreenshotCanvasData(h.canvas,W,q,M,y),C.dispose()}))}function k(){var Y;b?(b.wrapper.dispose(),b.renderer.dispose(),b.Qh.dispose()):null===(Y=H)||void 0===Y||Y.then((Y=>{Y.wrapper.dispose(),Y.renderer.dispose(),Y.Qh.dispose()}));H=null,b=null}const M={DumpData:q,DumpDataAsync:W,DumpFramebuffer:w,Dispose:k};E.Tools.DumpData=q,E.Tools.DumpDataAsync=W,E.Tools.DumpFramebuffer=w},12845:(Y,c,h)=>{h.r(c),h.d(c,{CreateScreenshot:()=>T,CreateScreenshotAsync:()=>e,CreateScreenshotUsingRenderTarget:()=>X,CreateScreenshotUsingRenderTargetAsync:()=>Z,CreateScreenshotWithResizeAsync:()=>r,ScreenshotTools:()=>G});var C=h(12848),E=h(12938),N=h(12980),Q=h(12825),b=h(12906),H=h(12986),w=h(13006),W=h(12869);class q extends H.f{static _GetDefines(Y){if(!Y)return null;return Y.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(Y,c){Y?(this._webGPUReady=!0,c.push(Promise.all([h.e(54).then(h.bind(h,15459)),h.e(55).then(h.bind(h,15467))]))):c.push(Promise.all([h.e(56).then(h.bind(h,15470)),h.e(57).then(h.bind(h,15475))]))}constructor(Y){const c={...arguments.length>2?arguments[2]:void 0,name:Y,Qh:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||w.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:q.VertexUrl,fragmentShader:q.FragmentUrl,uniforms:q.Uniforms};super({...c,defines:q._GetDefines(c.Qh)}),this.texelSize=new W.Vector2(0,0)}bind(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(Y),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}q.VertexUrl="fxaa",q.FragmentUrl="fxaa",q.Uniforms=["texelSize"];class k extends N.c{getClassName(){return"FxaaPostProcess"}constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const H={uniforms:q.Uniforms,size:"number"===typeof c?c:void 0,camera:h,samplingMode:E||C.d.BILINEAR_SAMPLINGMODE,Qh:N,reusable:Q,textureType:b,...c};super(Y,q.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new q(Y,N,H),...H}),this.onApplyObservable.add((Y=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(Y,c,h,C){return b.d.Parse((()=>new k(Y.name,Y.options,c,Y.renderTargetSamplingMode,h.getEngine(),Y.reusable)),Y,h,C)}}(0,Q.e)("BABYLON.FxaaPostProcess",k);var M=h(12700),p=h(12687),P=h(13097),y=h(13102),d=h(12756);let D=null;function T(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6?arguments[6]:void 0,b=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:H,width:w}=a(Y,c,h);if(!H||!w)return void M.e.Error("Invalid 'size' parameter !");c.ZY().activeCamera===c?Y.onEndFrameObservable.addOnce((()=>{D||(D=document.createElement("canvas")),D.width=w,D.height=H;const c=D.getContext("2d"),h=Y.getRenderingCanvas();if(!c||!h)return void M.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const W=h.width,q=h.height,k=D.width,P=D.height,y=k/W,d=P/q,T=b?Math.max(y,d):Math.min(y,d),e=W*T,r=q*T,X=(k-e)/2,Z=(P-r)/2;c.drawImage(h,0,0,W,q,X,Z,e,r),N?(p.Tools.EncodeScreenshotCanvasData(D,void 0,E,void 0,Q),C&&C("")):p.Tools.EncodeScreenshotCanvasData(D,C,E,void 0,Q)})):X(Y,c,h,(Y=>{if(N){const c=new Blob([Y]);p.Tools.DownloadBlob(c),C&&C("")}else C&&C(Y)}),E,1,Y.getCreationOptions().antialias,void 0,void 0,void 0,void 0,Q)}async function e(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((Q,b)=>{T(Y,c,h,(Y=>{"undefined"!==typeof Y?Q(Y):b(new Error("Data is undefined"))}),C,void 0,E,N)}))}async function r(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((b=>{T(Y,c,{width:h,height:C},(()=>{b()}),E,!0,N,Q)}))}function X(Y,c,N,Q){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],D=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],T=arguments.length>11?arguments[11]:void 0,e=arguments.length>12?arguments[12]:void 0,r=arguments.length>13?arguments[13]:void 0;const{height:X,width:Z,finalWidth:G,finalHeight:K}=a(Y,c,N),I={width:Z,height:X};if(!X||!Z)return void M.e.Error("Invalid 'size' parameter !");Y.skipFrameRender=!0;const s=Y.getRenderWidth,x=Y.getRenderHeight;Y.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Y._currentRenderTarget?Y._currentRenderTarget.width:Z},Y.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Y._currentRenderTarget?Y._currentRenderTarget.height:X},Y.onResizeObservable.hasObservers()&&Y.onResizeObservable.notifyObservers(Y);const A=c.ZY(),V=new E.c("screenShot",I,A,!1,!1,0,!1,C.d.BILINEAR_SAMPLINGMODE,void 0,p,void 0,void 0,void 0,H);V.renderList=A.meshes.slice(),V.samples=H,V.renderSprites=q,V.activeCamera=c,V.forceLayerMaskCheck=D,null===e||void 0===e||e(V);const U=r||P.DumpData,l=()=>{A.incrementRenderId(),A.resetCachedMaterial(),(0,d.f)((()=>V.isReadyForRendering()&&c.isReady(!0)),(()=>{Y.onEndFrameObservable.addOnce((()=>{G===Z&&K===X?V.readPixels(void 0,void 0,void 0,!1).then((Y=>{U(Z,X,Y,Q,b,W,!0,void 0,T),V.dispose()})):(Y.isWebGPU?h.e(51).then(h.bind(h,15442)):h.e(52).then(h.bind(h,15450))).then((async()=>await(0,y.e)("pass",V.getInternalTexture(),A,void 0,void 0,void 0,G,K).then((c=>{Y._readTexturePixels(c,G,K,-1,0,null,!0,!1,0,0).then((Y=>{U(G,K,Y,Q,b,W,!0,void 0,T),c.dispose()}))}))))})),A.incrementRenderId(),A.resetCachedMaterial();const C=A.activeCamera,E=A.activeCameras,N=c.outputRenderTarget,H=A.spritesEnabled;A.activeCamera=c,A.activeCameras=null,c.outputRenderTarget=V,A.spritesEnabled=q;const w=A.meshes;A.meshes=V.renderList||A.meshes;try{A.render()}finally{A.activeCamera=C,A.activeCameras=E,c.outputRenderTarget=N,A.spritesEnabled=H,A.meshes=w,Y.getRenderWidth=s,Y.getRenderHeight=x,Y.onResizeObservable.hasObservers()&&Y.onResizeObservable.notifyObservers(Y),c.getProjectionMatrix(!0),Y.skipFrameRender=!1}}),(()=>{Y.skipFrameRender=!1,Y.getRenderWidth=s,Y.getRenderHeight=x}))};if(w){const Y=new k("antialiasing",1,A.activeCamera);V.addPostProcess(Y),Y.ec=!0,Y.onEffectCreatedObservable.addOnce((Y=>{Y.isReady()?l():Y.onCompiled=()=>{l()}}))}else l()}async function Z(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6?arguments[6]:void 0,b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],w=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],W=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0,k=arguments.length>12?arguments[12]:void 0;return await new Promise(((M,p)=>{X(Y,c,h,(Y=>{"undefined"!==typeof Y?M(Y):p(new Error("Data is undefined"))}),C,E,N,Q,b,H,w,W,q,k)}))}function a(Y,c,h){let C=0,E=0,N=0,Q=0;if("object"===typeof h){const b=h.precision?Math.abs(h.precision):1;h.width&&h.height?(C=h.height*b,E=h.width*b):h.width&&!h.height?(E=h.width*b,C=Math.round(E/Y.getAspectRatio(c))):h.height&&!h.width?(C=h.height*b,E=Math.round(C*Y.getAspectRatio(c))):(E=Math.round(Y.getRenderWidth()*b),C=Math.round(E/Y.getAspectRatio(c))),h.finalWidth&&h.finalHeight?(Q=h.finalHeight,N=h.finalWidth):h.finalWidth&&!h.finalHeight?(N=h.finalWidth,Q=Math.round(N/Y.getAspectRatio(c))):h.finalHeight&&!h.finalWidth?(Q=h.finalHeight,N=Math.round(Q*Y.getAspectRatio(c))):(N=E,Q=C)}else isNaN(h)||(C=h,E=h,N=h,Q=h);return E&&(E=Math.floor(E)),C&&(C=Math.floor(C)),N&&(N=Math.floor(N)),Q&&(Q=Math.floor(Q)),{height:0|C,width:0|E,finalWidth:0|N,finalHeight:0|Q}}const G={CreateScreenshot:T,CreateScreenshotAsync:e,CreateScreenshotWithResizeAsync:r,CreateScreenshotUsingRenderTarget:X,CreateScreenshotUsingRenderTargetAsync:Z};p.Tools.CreateScreenshot=T,p.Tools.CreateScreenshotAsync=e,p.Tools.CreateScreenshotUsingRenderTarget=X,p.Tools.CreateScreenshotUsingRenderTargetAsync=Z}}]);