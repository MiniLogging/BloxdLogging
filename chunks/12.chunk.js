"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12,20],{11423:(B,I,C)=>{C.r(I),C.d(I,{Dispose:()=>H,DumpData:()=>R,DumpDataAsync:()=>N,DumpFramebuffer:()=>g,DumpTools:()=>F});var M=C(11300),x=C(11018),y=C(11212),f=C(11056);let L,e=null;async function g(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;const L=await C.readPixels(0,0,B,I);R(B,I,new Uint8Array(L.buffer),M,x,y,!0,void 0,f)}async function N(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7?arguments[7]:void 0;return await new Promise((e=>{R(B,I,C,(B=>e(B)),M,x,y,f,L)}))}function R(B,I,g,N){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8?arguments[8]:void 0;(async function(){return e||(e=new Promise(((B,I)=>{let x,y=null;const e={Uf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,11332)).then((g=>{let{ThinEngine:N}=g;const R=f.c.Instances.length;try{x=new OffscreenCanvas(100,100),y=new N(x,!1,e)}catch(q){var F;R<f.c.Instances.length&&(null===(F=f.c.Instances.pop())||void 0===F||F.dispose()),x=document.createElement("canvas"),y=new N(x,!1,e)}f.c.Instances.pop(),f.c.OnEnginesDisposedObservable.add((B=>{y&&B!==y&&!y.R&&0===f.c.Instances.length&&H()})),y.getCaps().parallelShaderCompile=void 0;const k=new M.e(y);C.e(52).then(C.bind(C,13679)).then((C=>{let{passPixelShader:f}=C;if(!y)return void I("Engine is not defined");const e=new M.f({RI:y,name:f.name,fragmentShader:f.shader,samplerNames:["textureSampler"]});L={canvas:x,RI:y,renderer:k,wrapper:e},B(L)}))})).catch(I)}))),await e})().then((C=>{if(C.RI.setSize(B,I,!0),g instanceof Float32Array){const B=new Uint8Array(g.length);let I=g.length;for(;I--;){const C=g[I];B[I]=Math.round(255*(0,y.Clamp)(C))}g=B}const M=C.RI.createRawTexture(g,B,I,5,!1,!k,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",M),C.renderer.draw(),q?x.Tools.ToBlob(C.canvas,(B=>{const I=new FileReader;I.onload=B=>{const I=B.target.result;N&&N(I)},I.readAsArrayBuffer(B)}),R,S):x.Tools.EncodeScreenshotCanvasData(C.canvas,N,R,F,S),M.dispose()}))}function H(){var B;L?(L.wrapper.dispose(),L.renderer.dispose(),L.RI.dispose()):null===(B=e)||void 0===B||B.then((B=>{B.wrapper.dispose(),B.renderer.dispose(),B.RI.dispose()}));e=null,L=null}const F={DumpData:R,DumpDataAsync:N,DumpFramebuffer:g,Dispose:H};x.Tools.DumpData=R,x.Tools.DumpDataAsync=N,x.Tools.DumpFramebuffer=g},11167:(B,I,C)=>{C.r(I),C.d(I,{CreateScreenshot:()=>G,CreateScreenshotAsync:()=>V,CreateScreenshotUsingRenderTarget:()=>t,CreateScreenshotUsingRenderTargetAsync:()=>r,CreateScreenshotWithResizeAsync:()=>c,ScreenshotTools:()=>D});var M=C(11171),x=C(11256),y=C(11294),f=C(11149),L=C(11226),e=C(11300),g=C(11324),N=C(11194);class R extends e.f{static _GetDefines(B){if(!B)return null;return B.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(B,I){B?(this._webGPUReady=!0,I.push(Promise.all([C.e(54).then(C.bind(C,13694)),C.e(55).then(C.bind(C,13700))]))):I.push(Promise.all([C.e(56).then(C.bind(C,13705)),C.e(57).then(C.bind(C,13709))]))}constructor(B){const I={...arguments.length>2?arguments[2]:void 0,name:B,RI:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||g.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:R.VertexUrl,fragmentShader:R.FragmentUrl,uniforms:R.Uniforms};super({...I,defines:R._GetDefines(I.RI)}),this.texelSize=new N.Vector2(0,0)}bind(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(B),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}R.VertexUrl="fxaa",R.FragmentUrl="fxaa",R.Uniforms=["texelSize"];class H extends y.d{getClassName(){return"FxaaPostProcess"}constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const e={uniforms:R.Uniforms,size:"number"===typeof I?I:void 0,camera:C,samplingMode:x||M.c.BILINEAR_SAMPLINGMODE,RI:y,reusable:f,textureType:L,...I};super(B,R.FragmentUrl,{effectWrapper:"number"!==typeof I&&I.effectWrapper?void 0:new R(B,y,e),...e}),this.onApplyObservable.add((B=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(B,I,C,M){return L.d.Parse((()=>new H(B.name,B.options,I,B.renderTargetSamplingMode,C.getEngine(),B.reusable)),B,C,M)}}(0,f.h)("BABYLON.FxaaPostProcess",H);var F=C(11027),k=C(11018),q=C(11423),S=C(11426),o=C(11091);let U=null;function G(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0,L=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:e,width:g}=A(B,I,C);if(!e||!g)return void F.b.Error("Invalid 'size' parameter !");I.rB().activeCamera===I?B.onEndFrameObservable.addOnce((()=>{U||(U=document.createElement("canvas")),U.width=g,U.height=e;const I=U.getContext("2d"),C=B.getRenderingCanvas();if(!I||!C)return void F.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const N=C.width,R=C.height,H=U.width,q=U.height,S=H/N,o=q/R,G=L?Math.max(S,o):Math.min(S,o),V=N*G,c=R*G,t=(H-V)/2,r=(q-c)/2;I.drawImage(C,0,0,N,R,t,r,V,c),y?(k.Tools.EncodeScreenshotCanvasData(U,void 0,x,void 0,f),M&&M("")):k.Tools.EncodeScreenshotCanvasData(U,M,x,void 0,f)})):t(B,I,C,(B=>{if(y){const I=new Blob([B]);k.Tools.DownloadBlob(I),M&&M("")}else M&&M(B)}),x,1,B.getCreationOptions().antialias,void 0,void 0,void 0,void 0,f)}async function V(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((f,L)=>{G(B,I,C,(B=>{"undefined"!==typeof B?f(B):L(new Error("Data is undefined"))}),M,void 0,x,y)}))}async function c(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((L=>{G(B,I,{width:C,height:M},(()=>{L()}),x,!0,y,f)}))}function t(B,I,y,f){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7?arguments[7]:void 0,R=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]&&arguments[9],U=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],G=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0,c=arguments.length>13?arguments[13]:void 0;const{height:t,width:r,finalWidth:D,finalHeight:J}=A(B,I,y),i={width:r,height:t};if(!t||!r)return void F.b.Error("Invalid 'size' parameter !");B.skipFrameRender=!0;const u=B.getRenderWidth,p=B.getRenderHeight;B.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&B._currentRenderTarget?B._currentRenderTarget.width:r},B.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&B._currentRenderTarget?B._currentRenderTarget.height:t},B.onResizeObservable.hasObservers()&&B.onResizeObservable.notifyObservers(B);const n=I.rB(),O=new x.c("screenShot",i,n,!1,!1,0,!1,M.c.BILINEAR_SAMPLINGMODE,void 0,k,void 0,void 0,void 0,e);O.renderList=n.meshes.slice(),O.samples=e,O.renderSprites=R,O.activeCamera=I,O.forceLayerMaskCheck=U,null===V||void 0===V||V(O);const a=c||q.DumpData,W=()=>{n.incrementRenderId(),n.resetCachedMaterial(),(0,o.f)((()=>O.isReadyForRendering()&&I.isReady(!0)),(()=>{B.onEndFrameObservable.addOnce((()=>{D===r&&J===t?O.readPixels(void 0,void 0,void 0,!1).then((B=>{a(r,t,B,f,L,N,!0,void 0,G),O.dispose()})):(B.isWebGPU?C.e(51).then(C.bind(C,13673)):C.e(52).then(C.bind(C,13679))).then((async()=>await(0,S.e)("pass",O.getInternalTexture(),n,void 0,void 0,void 0,D,J).then((I=>{B._readTexturePixels(I,D,J,-1,0,null,!0,!1,0,0).then((B=>{a(D,J,B,f,L,N,!0,void 0,G),I.dispose()}))}))))})),n.incrementRenderId(),n.resetCachedMaterial();const M=n.activeCamera,x=n.activeCameras,y=I.outputRenderTarget,e=n.spritesEnabled;n.activeCamera=I,n.activeCameras=null,I.outputRenderTarget=O,n.spritesEnabled=R;const g=n.meshes;n.meshes=O.renderList||n.meshes;try{n.render()}finally{n.activeCamera=M,n.activeCameras=x,I.outputRenderTarget=y,n.spritesEnabled=e,n.meshes=g,B.getRenderWidth=u,B.getRenderHeight=p,B.onResizeObservable.hasObservers()&&B.onResizeObservable.notifyObservers(B),I.getProjectionMatrix(!0),B.skipFrameRender=!1}}),(()=>{B.skipFrameRender=!1,B.getRenderWidth=u,B.getRenderHeight=p}))};if(g){const B=new H("antialiasing",1,n.activeCamera);O.addPostProcess(B),B.Gf=!0,B.onEffectCreatedObservable.addOnce((B=>{B.isReady()?W():B.onCompiled=()=>{W()}}))}else W()}async function r(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0,L=arguments.length>7&&void 0!==arguments[7]&&arguments[7],e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],N=arguments.length>10?arguments[10]:void 0,R=arguments.length>11?arguments[11]:void 0,H=arguments.length>12?arguments[12]:void 0;return await new Promise(((F,k)=>{t(B,I,C,(B=>{"undefined"!==typeof B?F(B):k(new Error("Data is undefined"))}),M,x,y,f,L,e,g,N,R,H)}))}function A(B,I,C){let M=0,x=0,y=0,f=0;if("object"===typeof C){const L=C.precision?Math.abs(C.precision):1;C.width&&C.height?(M=C.height*L,x=C.width*L):C.width&&!C.height?(x=C.width*L,M=Math.round(x/B.getAspectRatio(I))):C.height&&!C.width?(M=C.height*L,x=Math.round(M*B.getAspectRatio(I))):(x=Math.round(B.getRenderWidth()*L),M=Math.round(x/B.getAspectRatio(I))),C.finalWidth&&C.finalHeight?(f=C.finalHeight,y=C.finalWidth):C.finalWidth&&!C.finalHeight?(y=C.finalWidth,f=Math.round(y/B.getAspectRatio(I))):C.finalHeight&&!C.finalWidth?(f=C.finalHeight,y=Math.round(f*B.getAspectRatio(I))):(y=x,f=M)}else isNaN(C)||(M=C,x=C,y=C,f=C);return x&&(x=Math.floor(x)),M&&(M=Math.floor(M)),y&&(y=Math.floor(y)),f&&(f=Math.floor(f)),{height:0|M,width:0|x,finalWidth:0|y,finalHeight:0|f}}const D={CreateScreenshot:G,CreateScreenshotAsync:V,CreateScreenshotWithResizeAsync:c,CreateScreenshotUsingRenderTarget:t,CreateScreenshotUsingRenderTargetAsync:r};k.Tools.CreateScreenshot=G,k.Tools.CreateScreenshotAsync=V,k.Tools.CreateScreenshotUsingRenderTarget=t,k.Tools.CreateScreenshotUsingRenderTargetAsync=r}}]);