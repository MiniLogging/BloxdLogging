"use strict";(self["1kjc9ee3uyt"]=self["1kjc9ee3uyt"]||[]).push([[12,20],{11886:(w,E,G)=>{G.r(E),G.d(E,{Dispose:()=>u,DumpData:()=>O,DumpDataAsync:()=>i,DumpFramebuffer:()=>l,DumpTools:()=>V});var P=G(11776),h=G(11498),B=G(11689),y=G(11543);let x,U=null;async function l(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const x=await G.readPixels(0,0,w,E);O(w,E,new Uint8Array(x.buffer),P,h,B,!0,void 0,y)}async function i(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{O(w,E,G,(w=>U(w)),P,h,B,y,x)}))}function O(w,E,l,i){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",V=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((w,E)=>{let h,B=null;const U={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(G.bind(G,11806)).then((l=>{let{ThinEngine:i}=l;const O=y.e.Instances.length;try{h=new OffscreenCanvas(100,100),B=new i(h,!1,U)}catch(Q){var V;O<y.e.Instances.length&&(null===(V=y.e.Instances.pop())||void 0===V||V.dispose()),h=document.createElement("canvas"),B=new i(h,!1,U)}y.e.Instances.pop(),y.e.OnEnginesDisposedObservable.add((w=>{B&&w!==B&&!B.O&&0===y.e.Instances.length&&u()})),B.getCaps().parallelShaderCompile=void 0;const a=new P.d(B);G.e(52).then(G.bind(G,14044)).then((G=>{let{passPixelShader:y}=G;if(!B)return void E("Engine is not defined");const U=new P.f({aE:B,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});x={canvas:h,aE:B,renderer:a,wrapper:U},w(x)}))})).catch(E)}))),await U})().then((G=>{if(G.aE.setSize(w,E,!0),l instanceof Float32Array){const w=new Uint8Array(l.length);let E=l.length;for(;E--;){const G=l[E];w[E]=Math.round(255*(0,B.Clamp)(G))}l=w}const P=G.aE.createRawTexture(l,w,E,5,!1,!a,1);G.renderer.setViewport(),G.renderer.applyEffectWrapper(G.wrapper),G.wrapper.effect._bindTexture("textureSampler",P),G.renderer.draw(),Q?h.Tools.ToBlob(G.canvas,(w=>{const E=new FileReader;E.onload=w=>{const E=w.target.result;i&&i(E)},E.readAsArrayBuffer(w)}),O,c):h.Tools.EncodeScreenshotCanvasData(G.canvas,i,O,V,c),P.dispose()}))}function u(){var w;x?(x.wrapper.dispose(),x.renderer.dispose(),x.aE.dispose()):null===(w=U)||void 0===w||w.then((w=>{w.wrapper.dispose(),w.renderer.dispose(),w.aE.dispose()}));U=null,x=null}const V={DumpData:O,DumpDataAsync:i,DumpFramebuffer:l,Dispose:u};h.Tools.DumpData=O,h.Tools.DumpDataAsync=i,h.Tools.DumpFramebuffer=l},11659:(w,E,G)=>{G.r(E),G.d(E,{CreateScreenshot:()=>d,CreateScreenshotAsync:()=>K,CreateScreenshotUsingRenderTarget:()=>q,CreateScreenshotUsingRenderTargetAsync:()=>W,CreateScreenshotWithResizeAsync:()=>t,ScreenshotTools:()=>I});var P=G(11663),h=G(11737),B=G(11774),y=G(11646),x=G(11706),U=G(11776),l=G(11797),i=G(11679);class O extends U.f{static _GetDefines(w){if(!w)return null;return w.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(w,E){w?(this._webGPUReady=!0,E.push(Promise.all([G.e(54).then(G.bind(G,14057)),G.e(55).then(G.bind(G,14059))]))):E.push(Promise.all([G.e(56).then(G.bind(G,14067)),G.e(57).then(G.bind(G,14071))]))}constructor(w){const E={...arguments.length>2?arguments[2]:void 0,name:w,aE:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||l.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:O.VertexUrl,fragmentShader:O.FragmentUrl,uniforms:O.Uniforms};super({...E,defines:O._GetDefines(E.aE)}),this.texelSize=new i.Vector2(0,0)}bind(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(w),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}O.VertexUrl="fxaa",O.FragmentUrl="fxaa",O.Uniforms=["texelSize"];class u extends B.e{getClassName(){return"FxaaPostProcess"}constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const U={uniforms:O.Uniforms,size:"number"===typeof E?E:void 0,camera:G,samplingMode:h||P.c.BILINEAR_SAMPLINGMODE,aE:B,reusable:y,textureType:x,...E};super(w,O.FragmentUrl,{effectWrapper:"number"!==typeof E&&E.effectWrapper?void 0:new O(w,B,U),...U}),this.onApplyObservable.add((w=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(w,E,G,P){return x.b.Parse((()=>new u(w.name,w.options,E,w.renderTargetSamplingMode,G.getEngine(),w.reusable)),w,G,P)}}(0,y.g)("BABYLON.FxaaPostProcess",u);var V=G(11518),a=G(11498),Q=G(11886),c=G(11890),Z=G(11576);let J=null;function d(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:U,width:l}=T(w,E,G);if(!U||!l)return void V.e.Error("Invalid 'size' parameter !");E.Ww().activeCamera===E?w.onEndFrameObservable.addOnce((()=>{J||(J=document.createElement("canvas")),J.width=l,J.height=U;const E=J.getContext("2d"),G=w.getRenderingCanvas();if(!E||!G)return void V.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const i=G.width,O=G.height,u=J.width,Q=J.height,c=u/i,Z=Q/O,d=x?Math.max(c,Z):Math.min(c,Z),K=i*d,t=O*d,q=(u-K)/2,W=(Q-t)/2;E.drawImage(G,0,0,i,O,q,W,K,t),B?(a.Tools.EncodeScreenshotCanvasData(J,void 0,h,void 0,y),P&&P("")):a.Tools.EncodeScreenshotCanvasData(J,P,h,void 0,y)})):q(w,E,G,(w=>{if(B){const E=new Blob([w]);a.Tools.DownloadBlob(E),P&&P("")}else P&&P(w)}),h,1,w.getCreationOptions().antialias,void 0,void 0,void 0,void 0,y)}async function K(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((y,x)=>{d(w,E,G,(w=>{"undefined"!==typeof w?y(w):x(new Error("Data is undefined"))}),P,void 0,h,B)}))}async function t(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((x=>{d(w,E,{width:G,height:P},(()=>{x()}),h,!0,B,y)}))}function q(w,E,B,y){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7?arguments[7]:void 0,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]&&arguments[9],J=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],d=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0,t=arguments.length>13?arguments[13]:void 0;const{height:q,width:W,finalWidth:I,finalHeight:j}=T(w,E,B),g={width:W,height:q};if(!q||!W)return void V.e.Error("Invalid 'size' parameter !");w.skipFrameRender=!0;const o=w.getRenderWidth,f=w.getRenderHeight;w.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&w._currentRenderTarget?w._currentRenderTarget.width:W},w.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&w._currentRenderTarget?w._currentRenderTarget.height:q},w.onResizeObservable.hasObservers()&&w.onResizeObservable.notifyObservers(w);const k=E.Ww(),N=new h.d("screenShot",g,k,!1,!1,0,!1,P.c.BILINEAR_SAMPLINGMODE,void 0,a,void 0,void 0,void 0,U);N.renderList=k.meshes.slice(),N.samples=U,N.renderSprites=O,N.activeCamera=E,N.forceLayerMaskCheck=J,null===K||void 0===K||K(N);const v=t||Q.DumpData,C=()=>{k.incrementRenderId(),k.resetCachedMaterial(),(0,Z.g)((()=>N.isReadyForRendering()&&E.isReady(!0)),(()=>{w.onEndFrameObservable.addOnce((()=>{I===W&&j===q?N.readPixels(void 0,void 0,void 0,!1).then((w=>{v(W,q,w,y,x,i,!0,void 0,d),N.dispose()})):(w.isWebGPU?G.e(51).then(G.bind(G,14039)):G.e(52).then(G.bind(G,14044))).then((async()=>await(0,c.e)("pass",N.getInternalTexture(),k,void 0,void 0,void 0,I,j).then((E=>{w._readTexturePixels(E,I,j,-1,0,null,!0,!1,0,0).then((w=>{v(I,j,w,y,x,i,!0,void 0,d),E.dispose()}))}))))})),k.incrementRenderId(),k.resetCachedMaterial();const P=k.activeCamera,h=k.activeCameras,B=E.outputRenderTarget,U=k.spritesEnabled;k.activeCamera=E,k.activeCameras=null,E.outputRenderTarget=N,k.spritesEnabled=O;const l=k.meshes;k.meshes=N.renderList||k.meshes;try{k.render()}finally{k.activeCamera=P,k.activeCameras=h,E.outputRenderTarget=B,k.spritesEnabled=U,k.meshes=l,w.getRenderWidth=o,w.getRenderHeight=f,w.onResizeObservable.hasObservers()&&w.onResizeObservable.notifyObservers(w),E.getProjectionMatrix(!0),w.skipFrameRender=!1}}),(()=>{w.skipFrameRender=!1,w.getRenderWidth=o,w.getRenderHeight=f}))};if(l){const w=new u("antialiasing",1,k.activeCamera);N.addPostProcess(w),w.Nh=!0,w.onEffectCreatedObservable.addOnce((w=>{w.isReady()?C():w.onCompiled=()=>{C()}}))}else C()}async function W(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],i=arguments.length>10?arguments[10]:void 0,O=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0;return await new Promise(((V,a)=>{q(w,E,G,(w=>{"undefined"!==typeof w?V(w):a(new Error("Data is undefined"))}),P,h,B,y,x,U,l,i,O,u)}))}function T(w,E,G){let P=0,h=0,B=0,y=0;if("object"===typeof G){const x=G.precision?Math.abs(G.precision):1;G.width&&G.height?(P=G.height*x,h=G.width*x):G.width&&!G.height?(h=G.width*x,P=Math.round(h/w.getAspectRatio(E))):G.height&&!G.width?(P=G.height*x,h=Math.round(P*w.getAspectRatio(E))):(h=Math.round(w.getRenderWidth()*x),P=Math.round(h/w.getAspectRatio(E))),G.finalWidth&&G.finalHeight?(y=G.finalHeight,B=G.finalWidth):G.finalWidth&&!G.finalHeight?(B=G.finalWidth,y=Math.round(B/w.getAspectRatio(E))):G.finalHeight&&!G.finalWidth?(y=G.finalHeight,B=Math.round(y*w.getAspectRatio(E))):(B=h,y=P)}else isNaN(G)||(P=G,h=G,B=G,y=G);return h&&(h=Math.floor(h)),P&&(P=Math.floor(P)),B&&(B=Math.floor(B)),y&&(y=Math.floor(y)),{height:0|P,width:0|h,finalWidth:0|B,finalHeight:0|y}}const I={CreateScreenshot:d,CreateScreenshotAsync:K,CreateScreenshotWithResizeAsync:t,CreateScreenshotUsingRenderTarget:q,CreateScreenshotUsingRenderTargetAsync:W};a.Tools.CreateScreenshot=d,a.Tools.CreateScreenshotAsync=K,a.Tools.CreateScreenshotUsingRenderTarget=q,a.Tools.CreateScreenshotUsingRenderTargetAsync=W}}]);