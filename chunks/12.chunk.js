"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[12,20],{12639:(e,d,v)=>{v.r(d),v.d(d,{Dispose:()=>g,DumpData:()=>k,DumpDataAsync:()=>V,DumpFramebuffer:()=>W,DumpTools:()=>F});var P=v(12523),p=v(12240),L=v(12440),B=v(12281);let X,z=null;async function W(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const X=await v.readPixels(0,0,e,d);k(e,d,new Uint8Array(X.buffer),P,p,L,!0,void 0,B)}async function V(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((z=>{k(e,d,v,(e=>z(e)),P,p,L,B,X)}))}function k(e,d,W,V){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8?arguments[8]:void 0;(async function(){return z||(z=new Promise(((e,d)=>{let p,L=null;const z={Td:!0,depth:!1,hd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(v.bind(v,12553)).then((W=>{let{ThinEngine:V}=W;const k=B.c.Instances.length;try{p=new OffscreenCanvas(100,100),L=new V(p,!1,z)}catch(G){var F;k<B.c.Instances.length&&(null===(F=B.c.Instances.pop())||void 0===F||F.dispose()),p=document.createElement("canvas"),L=new V(p,!1,z)}B.c.Instances.pop(),B.c.OnEnginesDisposedObservable.add((e=>{L&&e!==L&&!L.W&&0===B.c.Instances.length&&g()})),L.getCaps().parallelShaderCompile=void 0;const w=new P.c(L);v.e(52).then(v.bind(v,14925)).then((v=>{let{passPixelShader:B}=v;if(!L)return void d("Engine is not defined");const z=new P.f({Ad:L,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});X={canvas:p,Ad:L,renderer:w,wrapper:z},e(X)}))})).catch(d)}))),await z})().then((v=>{if(v.Ad.setSize(e,d,!0),W instanceof Float32Array){const e=new Uint8Array(W.length);let d=W.length;for(;d--;){const v=W[d];e[d]=Math.round(255*(0,L.Clamp)(v))}W=e}const P=v.Ad.createRawTexture(W,e,d,5,!1,!w,1);v.renderer.setViewport(),v.renderer.applyEffectWrapper(v.wrapper),v.wrapper.effect._bindTexture("textureSampler",P),v.renderer.draw(),G?p.Tools.ToBlob(v.canvas,(e=>{const d=new FileReader;d.onload=e=>{const d=e.target.result;V&&V(d)},d.readAsArrayBuffer(e)}),k,U):p.Tools.EncodeScreenshotCanvasData(v.canvas,V,k,F,U),P.dispose()}))}function g(){var e;X?(X.wrapper.dispose(),X.renderer.dispose(),X.Ad.dispose()):null===(e=z)||void 0===e||e.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.Ad.dispose()}));z=null,X=null}const F={DumpData:k,DumpDataAsync:V,DumpFramebuffer:W,Dispose:g};p.Tools.DumpData=k,p.Tools.DumpDataAsync=V,p.Tools.DumpFramebuffer=W},12394:(e,d,v)=>{v.r(d),v.d(d,{CreateScreenshot:()=>q,CreateScreenshotAsync:()=>h,CreateScreenshotUsingRenderTarget:()=>n,CreateScreenshotUsingRenderTargetAsync:()=>A,CreateScreenshotWithResizeAsync:()=>l,ScreenshotTools:()=>i});var P=v(12399),p=v(12476),L=v(12514),B=v(12381),X=v(12453),z=v(12523),W=v(12550),V=v(12420);class k extends z.f{static _GetDefines(e){if(!e)return null;return e.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(e,d){e?(this._webGPUReady=!0,d.push(Promise.all([v.e(54).then(v.bind(v,14934)),v.e(55).then(v.bind(v,14939))]))):d.push(Promise.all([v.e(56).then(v.bind(v,14942)),v.e(57).then(v.bind(v,14944))]))}constructor(e){const d={...arguments.length>2?arguments[2]:void 0,name:e,Ad:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||W.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:k.VertexUrl,fragmentShader:k.FragmentUrl,uniforms:k.Uniforms};super({...d,defines:k._GetDefines(d.Ad)}),this.texelSize=new V.Vector2(0,0)}bind(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(e),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}k.VertexUrl="fxaa",k.FragmentUrl="fxaa",k.Uniforms=["texelSize"];class g extends L.b{getClassName(){return"FxaaPostProcess"}constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const z={uniforms:k.Uniforms,size:"number"===typeof d?d:void 0,camera:v,samplingMode:p||P.e.BILINEAR_SAMPLINGMODE,Ad:L,reusable:B,textureType:X,...d};super(e,k.FragmentUrl,{effectWrapper:"number"!==typeof d&&d.effectWrapper?void 0:new k(e,L,z),...z}),this.onApplyObservable.add((e=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(e,d,v,P){return X.c.Parse((()=>new g(e.name,e.options,d,e.renderTargetSamplingMode,v.getEngine(),e.reusable)),e,v,P)}}(0,B.h)("BABYLON.FxaaPostProcess",g);var F=v(12253),w=v(12240),G=v(12639),U=v(12643),D=v(12314);let C=null;function q(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:z,width:W}=x(e,d,v);if(!z||!W)return void F.c.Error("Invalid 'size' parameter !");d.Ae().activeCamera===d?e.onEndFrameObservable.addOnce((()=>{C||(C=document.createElement("canvas")),C.width=W,C.height=z;const d=C.getContext("2d"),v=e.getRenderingCanvas();if(!d||!v)return void F.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const V=v.width,k=v.height,g=C.width,G=C.height,U=g/V,D=G/k,q=X?Math.max(U,D):Math.min(U,D),h=V*q,l=k*q,n=(g-h)/2,A=(G-l)/2;d.drawImage(v,0,0,V,k,n,A,h,l),L?(w.Tools.EncodeScreenshotCanvasData(C,void 0,p,void 0,B),P&&P("")):w.Tools.EncodeScreenshotCanvasData(C,P,p,void 0,B)})):n(e,d,v,(e=>{if(L){const d=new Blob([e]);w.Tools.DownloadBlob(d),P&&P("")}else P&&P(e)}),p,1,e.getCreationOptions().antialias,void 0,void 0,void 0,void 0,B)}async function h(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((B,X)=>{q(e,d,v,(e=>{"undefined"!==typeof e?B(e):X(new Error("Data is undefined"))}),P,void 0,p,L)}))}async function l(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((X=>{q(e,d,{width:v,height:P},(()=>{X()}),p,!0,L,B)}))}function n(e,d,L,B){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],w=arguments.length>9&&void 0!==arguments[9]&&arguments[9],C=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],q=arguments.length>11?arguments[11]:void 0,h=arguments.length>12?arguments[12]:void 0,l=arguments.length>13?arguments[13]:void 0;const{height:n,width:A,finalWidth:i,finalHeight:me}=x(e,d,L),r={width:A,height:n};if(!n||!A)return void F.c.Error("Invalid 'size' parameter !");e.skipFrameRender=!0;const Z=e.getRenderWidth,f=e.getRenderHeight;e.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&e._currentRenderTarget?e._currentRenderTarget.width:A},e.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&e._currentRenderTarget?e._currentRenderTarget.height:n},e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e);const T=d.Ae(),S=new p.d("screenShot",r,T,!1,!1,0,!1,P.e.BILINEAR_SAMPLINGMODE,void 0,w,void 0,void 0,void 0,z);S.renderList=T.meshes.slice(),S.samples=z,S.renderSprites=k,S.activeCamera=d,S.forceLayerMaskCheck=C,null===h||void 0===h||h(S);const o=l||G.DumpData,K=()=>{T.incrementRenderId(),T.resetCachedMaterial(),(0,D.g)((()=>S.isReadyForRendering()&&d.isReady(!0)),(()=>{e.onEndFrameObservable.addOnce((()=>{i===A&&me===n?S.readPixels(void 0,void 0,void 0,!1).then((e=>{o(A,n,e,B,X,V,!0,void 0,q),S.dispose()})):(e.isWebGPU?v.e(51).then(v.bind(v,14921)):v.e(52).then(v.bind(v,14925))).then((async()=>await(0,U.c)("pass",S.getInternalTexture(),T,void 0,void 0,void 0,i,me).then((d=>{e._readTexturePixels(d,i,me,-1,0,null,!0,!1,0,0).then((e=>{o(i,me,e,B,X,V,!0,void 0,q),d.dispose()}))}))))})),T.incrementRenderId(),T.resetCachedMaterial();const P=T.activeCamera,p=T.activeCameras,L=d.outputRenderTarget,z=T.spritesEnabled;T.activeCamera=d,T.activeCameras=null,d.outputRenderTarget=S,T.spritesEnabled=k;const W=T.meshes;T.meshes=S.renderList||T.meshes;try{T.render()}finally{T.activeCamera=P,T.activeCameras=p,d.outputRenderTarget=L,T.spritesEnabled=z,T.meshes=W,e.getRenderWidth=Z,e.getRenderHeight=f,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e),d.getProjectionMatrix(!0),e.skipFrameRender=!1}}),(()=>{e.skipFrameRender=!1,e.getRenderWidth=Z,e.getRenderHeight=f}))};if(W){const e=new g("antialiasing",1,T.activeCamera);S.addPostProcess(e),e.od=!0,e.onEffectCreatedObservable.addOnce((e=>{e.isReady()?K():e.onCompiled=()=>{K()}}))}else K()}async function A(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],V=arguments.length>10?arguments[10]:void 0,k=arguments.length>11?arguments[11]:void 0,g=arguments.length>12?arguments[12]:void 0;return await new Promise(((F,w)=>{n(e,d,v,(e=>{"undefined"!==typeof e?F(e):w(new Error("Data is undefined"))}),P,p,L,B,X,z,W,V,k,g)}))}function x(e,d,v){let P=0,p=0,L=0,B=0;if("object"===typeof v){const X=v.precision?Math.abs(v.precision):1;v.width&&v.height?(P=v.height*X,p=v.width*X):v.width&&!v.height?(p=v.width*X,P=Math.round(p/e.getAspectRatio(d))):v.height&&!v.width?(P=v.height*X,p=Math.round(P*e.getAspectRatio(d))):(p=Math.round(e.getRenderWidth()*X),P=Math.round(p/e.getAspectRatio(d))),v.finalWidth&&v.finalHeight?(B=v.finalHeight,L=v.finalWidth):v.finalWidth&&!v.finalHeight?(L=v.finalWidth,B=Math.round(L/e.getAspectRatio(d))):v.finalHeight&&!v.finalWidth?(B=v.finalHeight,L=Math.round(B*e.getAspectRatio(d))):(L=p,B=P)}else isNaN(v)||(P=v,p=v,L=v,B=v);return p&&(p=Math.floor(p)),P&&(P=Math.floor(P)),L&&(L=Math.floor(L)),B&&(B=Math.floor(B)),{height:0|P,width:0|p,finalWidth:0|L,finalHeight:0|B}}const i={CreateScreenshot:q,CreateScreenshotAsync:h,CreateScreenshotWithResizeAsync:l,CreateScreenshotUsingRenderTarget:n,CreateScreenshotUsingRenderTargetAsync:A};w.Tools.CreateScreenshot=q,w.Tools.CreateScreenshotAsync=h,w.Tools.CreateScreenshotUsingRenderTarget=n,w.Tools.CreateScreenshotUsingRenderTargetAsync=A}}]);