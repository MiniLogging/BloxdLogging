"use strict";(self.u4k1rqylno=self.u4k1rqylno||[]).push([[12,20],{11946:(e,E,H)=>{H.r(E),H.d(E,{Dispose:()=>V,DumpData:()=>i,DumpDataAsync:()=>C,DumpFramebuffer:()=>A,DumpTools:()=>U});var N=H(11842),u=H(11532),z=H(11756),P=H(11579);let M,D=null;async function A(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,P=arguments.length>6?arguments[6]:void 0;const M=await H.readPixels(0,0,e,E);i(e,E,new Uint8Array(M.buffer),N,u,z,!0,void 0,P)}async function C(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7?arguments[7]:void 0;return await new Promise((D=>{i(e,E,H,(e=>D(e)),N,u,z,P,M)}))}function i(e,E,A,C){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return D||(D=new Promise(((e,E)=>{let u,z=null;const D={EM:!0,depth:!1,nP:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(H.bind(H,11868)).then((A=>{let{ThinEngine:C}=A;const i=P.d.Instances.length;try{u=new OffscreenCanvas(100,100),z=new C(u,!1,D)}catch(F){var U;i<P.d.Instances.length&&(null===(U=P.d.Instances.pop())||void 0===U||U.dispose()),u=document.createElement("canvas"),z=new C(u,!1,D)}P.d.Instances.pop(),P.d.OnEnginesDisposedObservable.add((e=>{z&&e!==z&&!z.A&&0===P.d.Instances.length&&V()})),z.getCaps().parallelShaderCompile=void 0;const j=new N.e(z);H.e(52).then(H.bind(H,14168)).then((H=>{let{passPixelShader:P}=H;if(!z)return void E("Engine is not defined");const D=new N.f({UE:z,name:P.name,fragmentShader:P.shader,samplerNames:["textureSampler"]});M={canvas:u,UE:z,renderer:j,wrapper:D},e(M)}))})).catch(E)}))),await D})().then((H=>{if(H.UE.setSize(e,E,!0),A instanceof Float32Array){const e=new Uint8Array(A.length);let E=A.length;for(;E--;){const H=A[E];e[E]=Math.round(255*(0,z.Clamp)(H))}A=e}const N=H.UE.createRawTexture(A,e,E,5,!1,!j,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",N),H.renderer.draw(),F?u.Tools.ToBlob(H.canvas,(e=>{const E=new FileReader;E.onload=e=>{const E=e.target.result;C&&C(E)},E.readAsArrayBuffer(e)}),i,h):u.Tools.EncodeScreenshotCanvasData(H.canvas,C,i,U,h),N.dispose()}))}function V(){var e;M?(M.wrapper.dispose(),M.renderer.dispose(),M.UE.dispose()):null===(e=D)||void 0===e||e.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.UE.dispose()}));D=null,M=null}const U={DumpData:i,DumpDataAsync:C,DumpFramebuffer:A,Dispose:V};u.Tools.DumpData=i,u.Tools.DumpDataAsync=C,u.Tools.DumpFramebuffer=A},11703:(e,E,H)=>{H.r(E),H.d(E,{CreateScreenshot:()=>a,CreateScreenshotAsync:()=>W,CreateScreenshotUsingRenderTarget:()=>Y,CreateScreenshotUsingRenderTargetAsync:()=>f,CreateScreenshotWithResizeAsync:()=>r,ScreenshotTools:()=>s});var N=H(11712),u=H(11807),z=H(11840),P=H(11690),M=H(11776),D=H(11842),A=H(11862),C=H(11738);class i extends D.f{static _GetDefines(e){if(!e)return null;return e.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(e,E){e?(this._webGPUReady=!0,E.push(Promise.all([H.e(54).then(H.bind(H,14177)),H.e(55).then(H.bind(H,14184))]))):E.push(Promise.all([H.e(56).then(H.bind(H,14191)),H.e(57).then(H.bind(H,14198))]))}constructor(e){const E={...arguments.length>2?arguments[2]:void 0,name:e,UE:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||A.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:i.VertexUrl,fragmentShader:i.FragmentUrl,uniforms:i.Uniforms};super({...E,defines:i._GetDefines(E.UE)}),this.texelSize=new C.Vector2(0,0)}bind(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(e),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}i.VertexUrl="fxaa",i.FragmentUrl="fxaa",i.Uniforms=["texelSize"];class V extends z.c{getClassName(){return"FxaaPostProcess"}constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const D={uniforms:i.Uniforms,size:"number"===typeof E?E:void 0,camera:H,samplingMode:u||N.b.BILINEAR_SAMPLINGMODE,UE:z,reusable:P,textureType:M,...E};super(e,i.FragmentUrl,{effectWrapper:"number"!==typeof E&&E.effectWrapper?void 0:new i(e,z,D),...D}),this.onApplyObservable.add((e=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(e,E,H,N){return M.d.Parse((()=>new V(e.name,e.options,E,e.renderTargetSamplingMode,H.getEngine(),e.reusable)),e,H,N)}}(0,P.g)("BABYLON.FxaaPostProcess",V);var U=H(11548),j=H(11532),F=H(11946),h=H(11952),S=H(11611);let X=null;function a(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:D,width:A}=w(e,E,H);if(!D||!A)return void U.d.Error("Invalid 'size' parameter !");E.fe().activeCamera===E?e.onEndFrameObservable.addOnce((()=>{X||(X=document.createElement("canvas")),X.width=A,X.height=D;const E=X.getContext("2d"),H=e.getRenderingCanvas();if(!E||!H)return void U.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const C=H.width,i=H.height,V=X.width,F=X.height,h=V/C,S=F/i,a=M?Math.max(h,S):Math.min(h,S),W=C*a,r=i*a,Y=(V-W)/2,f=(F-r)/2;E.drawImage(H,0,0,C,i,Y,f,W,r),z?(j.Tools.EncodeScreenshotCanvasData(X,void 0,u,void 0,P),N&&N("")):j.Tools.EncodeScreenshotCanvasData(X,N,u,void 0,P)})):Y(e,E,H,(e=>{if(z){const E=new Blob([e]);j.Tools.DownloadBlob(E),N&&N("")}else N&&N(e)}),u,1,e.getCreationOptions().antialias,void 0,void 0,void 0,void 0,P)}async function W(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((P,M)=>{a(e,E,H,(e=>{"undefined"!==typeof e?P(e):M(new Error("Data is undefined"))}),N,void 0,u,z)}))}async function r(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((M=>{a(e,E,{width:H,height:N},(()=>{M()}),u,!0,z,P)}))}function Y(e,E,z,P){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]&&arguments[9],X=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],a=arguments.length>11?arguments[11]:void 0,W=arguments.length>12?arguments[12]:void 0,r=arguments.length>13?arguments[13]:void 0;const{height:Y,width:f,finalWidth:s,finalHeight:p}=w(e,E,z),o={width:f,height:Y};if(!Y||!f)return void U.d.Error("Invalid 'size' parameter !");e.skipFrameRender=!0;const y=e.getRenderWidth,b=e.getRenderHeight;e.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&e._currentRenderTarget?e._currentRenderTarget.width:f},e.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&e._currentRenderTarget?e._currentRenderTarget.height:Y},e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e);const K=E.fe(),l=new u.e("screenShot",o,K,!1,!1,0,!1,N.b.BILINEAR_SAMPLINGMODE,void 0,j,void 0,void 0,void 0,D);l.renderList=K.meshes.slice(),l.samples=D,l.renderSprites=i,l.activeCamera=E,l.forceLayerMaskCheck=X,null===W||void 0===W||W(l);const O=r||F.DumpData,v=()=>{K.incrementRenderId(),K.resetCachedMaterial(),(0,S.f)((()=>l.isReadyForRendering()&&E.isReady(!0)),(()=>{e.onEndFrameObservable.addOnce((()=>{s===f&&p===Y?l.readPixels(void 0,void 0,void 0,!1).then((e=>{O(f,Y,e,P,M,C,!0,void 0,a),l.dispose()})):(e.isWebGPU?H.e(51).then(H.bind(H,14163)):H.e(52).then(H.bind(H,14168))).then((async()=>await(0,h.e)("pass",l.getInternalTexture(),K,void 0,void 0,void 0,s,p).then((E=>{e._readTexturePixels(E,s,p,-1,0,null,!0,!1,0,0).then((e=>{O(s,p,e,P,M,C,!0,void 0,a),E.dispose()}))}))))})),K.incrementRenderId(),K.resetCachedMaterial();const N=K.activeCamera,u=K.activeCameras,z=E.outputRenderTarget,D=K.spritesEnabled;K.activeCamera=E,K.activeCameras=null,E.outputRenderTarget=l,K.spritesEnabled=i;const A=K.meshes;K.meshes=l.renderList||K.meshes;try{K.render()}finally{K.activeCamera=N,K.activeCameras=u,E.outputRenderTarget=z,K.spritesEnabled=D,K.meshes=A,e.getRenderWidth=y,e.getRenderHeight=b,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e),E.getProjectionMatrix(!0),e.skipFrameRender=!1}}),(()=>{e.skipFrameRender=!1,e.getRenderWidth=y,e.getRenderHeight=b}))};if(A){const e=new V("antialiasing",1,K.activeCamera);l.addPostProcess(e),e.HM=!0,e.onEffectCreatedObservable.addOnce((e=>{e.isReady()?v():e.onCompiled=()=>{v()}}))}else v()}async function f(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],A=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],C=arguments.length>10?arguments[10]:void 0,i=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0;return await new Promise(((U,j)=>{Y(e,E,H,(e=>{"undefined"!==typeof e?U(e):j(new Error("Data is undefined"))}),N,u,z,P,M,D,A,C,i,V)}))}function w(e,E,H){let N=0,u=0,z=0,P=0;if("object"===typeof H){const M=H.precision?Math.abs(H.precision):1;H.width&&H.height?(N=H.height*M,u=H.width*M):H.width&&!H.height?(u=H.width*M,N=Math.round(u/e.getAspectRatio(E))):H.height&&!H.width?(N=H.height*M,u=Math.round(N*e.getAspectRatio(E))):(u=Math.round(e.getRenderWidth()*M),N=Math.round(u/e.getAspectRatio(E))),H.finalWidth&&H.finalHeight?(P=H.finalHeight,z=H.finalWidth):H.finalWidth&&!H.finalHeight?(z=H.finalWidth,P=Math.round(z/e.getAspectRatio(E))):H.finalHeight&&!H.finalWidth?(P=H.finalHeight,z=Math.round(P*e.getAspectRatio(E))):(z=u,P=N)}else isNaN(H)||(N=H,u=H,z=H,P=H);return u&&(u=Math.floor(u)),N&&(N=Math.floor(N)),z&&(z=Math.floor(z)),P&&(P=Math.floor(P)),{height:0|N,width:0|u,finalWidth:0|z,finalHeight:0|P}}const s={CreateScreenshot:a,CreateScreenshotAsync:W,CreateScreenshotWithResizeAsync:r,CreateScreenshotUsingRenderTarget:Y,CreateScreenshotUsingRenderTargetAsync:f};j.Tools.CreateScreenshot=a,j.Tools.CreateScreenshotAsync=W,j.Tools.CreateScreenshotUsingRenderTarget=Y,j.Tools.CreateScreenshotUsingRenderTargetAsync=f}}]);