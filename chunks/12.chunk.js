"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[12,20],{12635:(t,U,y)=>{y.r(U),y.d(U,{Dispose:()=>h,DumpData:()=>L,DumpDataAsync:()=>M,DumpFramebuffer:()=>G,DumpTools:()=>Q});var I=y(12505),r=y(12198),Y=y(12404),mt=y(12250);let X,P=null;async function G(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,mt=arguments.length>6?arguments[6]:void 0;const X=await y.readPixels(0,0,t,U);L(t,U,new Uint8Array(X.buffer),I,r,Y,!0,void 0,mt)}async function M(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((P=>{L(t,U,y,(t=>P(t)),I,r,Y,mt,X)}))}function L(t,U,G,M){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8?arguments[8]:void 0;(async function(){return P||(P=new Promise(((t,U)=>{let r,Y=null;const P={o:!0,depth:!1,EX:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(y.bind(y,12543)).then((G=>{let{ThinEngine:M}=G;const L=mt.d.Instances.length;try{r=new OffscreenCanvas(100,100),Y=new M(r,!1,P)}catch(E){var Q;L<mt.d.Instances.length&&(null===(Q=mt.d.Instances.pop())||void 0===Q||Q.dispose()),r=document.createElement("canvas"),Y=new M(r,!1,P)}mt.d.Instances.pop(),mt.d.OnEnginesDisposedObservable.add((t=>{Y&&t!==Y&&!Y.G&&0===mt.d.Instances.length&&h()})),Y.getCaps().parallelShaderCompile=void 0;const F=new I.c(Y);y.e(52).then(y.bind(y,14647)).then((y=>{let{passPixelShader:mt}=y;if(!Y)return void U("Engine is not defined");const P=new I.f({wU:Y,name:mt.name,fragmentShader:mt.shader,samplerNames:["textureSampler"]});X={canvas:r,wU:Y,renderer:F,wrapper:P},t(X)}))})).catch(U)}))),await P})().then((y=>{if(y.wU.setSize(t,U,!0),G instanceof Float32Array){const t=new Uint8Array(G.length);let U=G.length;for(;U--;){const y=G[U];t[U]=Math.round(255*(0,Y.Clamp)(y))}G=t}const I=y.wU.createRawTexture(G,t,U,5,!1,!F,1);y.renderer.setViewport(),y.renderer.applyEffectWrapper(y.wrapper),y.wrapper.effect._bindTexture("textureSampler",I),y.renderer.draw(),E?r.Tools.ToBlob(y.canvas,(t=>{const U=new FileReader;U.onload=t=>{const U=t.target.result;M&&M(U)},U.readAsArrayBuffer(t)}),L,w):r.Tools.EncodeScreenshotCanvasData(y.canvas,M,L,Q,w),I.dispose()}))}function h(){var t;X?(X.wrapper.dispose(),X.renderer.dispose(),X.wU.dispose()):null===(t=P)||void 0===t||t.then((t=>{t.wrapper.dispose(),t.renderer.dispose(),t.wU.dispose()}));P=null,X=null}const Q={DumpData:L,DumpDataAsync:M,DumpFramebuffer:G,Dispose:h};r.Tools.DumpData=L,r.Tools.DumpDataAsync=M,r.Tools.DumpFramebuffer=G},12352:(t,U,y)=>{y.r(U),y.d(U,{CreateScreenshot:()=>g,CreateScreenshotAsync:()=>B,CreateScreenshotUsingRenderTarget:()=>p,CreateScreenshotUsingRenderTargetAsync:()=>c,CreateScreenshotWithResizeAsync:()=>b,ScreenshotTools:()=>S});var I=y(12361),r=y(12469),Y=y(12501),mt=y(12338),X=y(12426),P=y(12505),G=y(12537),M=y(12386);class L extends P.f{static _GetDefines(t){if(!t)return null;return t.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(t,U){t?(this._webGPUReady=!0,U.push(Promise.all([y.e(54).then(y.bind(y,14661)),y.e(55).then(y.bind(y,14664))]))):U.push(Promise.all([y.e(56).then(y.bind(y,14673)),y.e(57).then(y.bind(y,14681))]))}constructor(t){const U={...arguments.length>2?arguments[2]:void 0,name:t,wU:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||G.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:L.VertexUrl,fragmentShader:L.FragmentUrl,uniforms:L.Uniforms};super({...U,defines:L._GetDefines(U.wU)}),this.texelSize=new M.Vector2(0,0)}bind(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(t),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}L.VertexUrl="fxaa",L.FragmentUrl="fxaa",L.Uniforms=["texelSize"];class h extends Y.e{getClassName(){return"FxaaPostProcess"}constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0,mt=arguments.length>5?arguments[5]:void 0,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const P={uniforms:L.Uniforms,size:"number"===typeof U?U:void 0,camera:y,samplingMode:r||I.d.BILINEAR_SAMPLINGMODE,wU:Y,reusable:mt,textureType:X,...U};super(t,L.FragmentUrl,{effectWrapper:"number"!==typeof U&&U.effectWrapper?void 0:new L(t,Y,P),...P}),this.onApplyObservable.add((t=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(t,U,y,I){return X.b.Parse((()=>new h(t.name,t.options,U,t.renderTargetSamplingMode,y.getEngine(),t.reusable)),t,y,I)}}(0,mt.f)("BABYLON.FxaaPostProcess",h);var Q=y(12221),F=y(12198),E=y(12635),w=y(12640),D=y(12277);let l=null;function g(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:P,width:G}=f(t,U,y);if(!P||!G)return void Q.b.Error("Invalid 'size' parameter !");U.St().activeCamera===U?t.onEndFrameObservable.addOnce((()=>{l||(l=document.createElement("canvas")),l.width=G,l.height=P;const U=l.getContext("2d"),y=t.getRenderingCanvas();if(!U||!y)return void Q.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const M=y.width,L=y.height,h=l.width,E=l.height,w=h/M,D=E/L,g=X?Math.max(w,D):Math.min(w,D),B=M*g,b=L*g,p=(h-B)/2,c=(E-b)/2;U.drawImage(y,0,0,M,L,p,c,B,b),Y?(F.Tools.EncodeScreenshotCanvasData(l,void 0,r,void 0,mt),I&&I("")):F.Tools.EncodeScreenshotCanvasData(l,I,r,void 0,mt)})):p(t,U,y,(t=>{if(Y){const U=new Blob([t]);F.Tools.DownloadBlob(U),I&&I("")}else I&&I(t)}),r,1,t.getCreationOptions().antialias,void 0,void 0,void 0,void 0,mt)}async function B(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((mt,X)=>{g(t,U,y,(t=>{"undefined"!==typeof t?mt(t):X(new Error("Data is undefined"))}),I,void 0,r,Y)}))}async function b(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((X=>{g(t,U,{width:y,height:I},(()=>{X()}),r,!0,Y,mt)}))}function p(t,U,Y,mt){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7?arguments[7]:void 0,L=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]&&arguments[9],l=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],g=arguments.length>11?arguments[11]:void 0,B=arguments.length>12?arguments[12]:void 0,b=arguments.length>13?arguments[13]:void 0;const{height:p,width:c,finalWidth:S,finalHeight:N}=f(t,U,Y),j={width:c,height:p};if(!p||!c)return void Q.b.Error("Invalid 'size' parameter !");t.skipFrameRender=!0;const J=t.getRenderWidth,a=t.getRenderHeight;t.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&t._currentRenderTarget?t._currentRenderTarget.width:c},t.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&t._currentRenderTarget?t._currentRenderTarget.height:p},t.onResizeObservable.hasObservers()&&t.onResizeObservable.notifyObservers(t);const d=U.St(),q=new r.d("screenShot",j,d,!1,!1,0,!1,I.d.BILINEAR_SAMPLINGMODE,void 0,F,void 0,void 0,void 0,P);q.renderList=d.meshes.slice(),q.samples=P,q.renderSprites=L,q.activeCamera=U,q.forceLayerMaskCheck=l,null===B||void 0===B||B(q);const H=b||E.DumpData,e=()=>{d.incrementRenderId(),d.resetCachedMaterial(),(0,D.g)((()=>q.isReadyForRendering()&&U.isReady(!0)),(()=>{t.onEndFrameObservable.addOnce((()=>{S===c&&N===p?q.readPixels(void 0,void 0,void 0,!1).then((t=>{H(c,p,t,mt,X,M,!0,void 0,g),q.dispose()})):(t.isWebGPU?y.e(51).then(y.bind(y,14638)):y.e(52).then(y.bind(y,14647))).then((async()=>await(0,w.c)("pass",q.getInternalTexture(),d,void 0,void 0,void 0,S,N).then((U=>{t._readTexturePixels(U,S,N,-1,0,null,!0,!1,0,0).then((t=>{H(S,N,t,mt,X,M,!0,void 0,g),U.dispose()}))}))))})),d.incrementRenderId(),d.resetCachedMaterial();const I=d.activeCamera,r=d.activeCameras,Y=U.outputRenderTarget,P=d.spritesEnabled;d.activeCamera=U,d.activeCameras=null,U.outputRenderTarget=q,d.spritesEnabled=L;const G=d.meshes;d.meshes=q.renderList||d.meshes;try{d.render()}finally{d.activeCamera=I,d.activeCameras=r,U.outputRenderTarget=Y,d.spritesEnabled=P,d.meshes=G,t.getRenderWidth=J,t.getRenderHeight=a,t.onResizeObservable.hasObservers()&&t.onResizeObservable.notifyObservers(t),U.getProjectionMatrix(!0),t.skipFrameRender=!1}}),(()=>{t.skipFrameRender=!1,t.getRenderWidth=J,t.getRenderHeight=a}))};if(G){const t=new h("antialiasing",1,d.activeCamera);q.addPostProcess(t),t.gX=!0,t.onEffectCreatedObservable.addOnce((t=>{t.isReady()?e():t.onCompiled=()=>{e()}}))}else e()}async function c(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],M=arguments.length>10?arguments[10]:void 0,L=arguments.length>11?arguments[11]:void 0,h=arguments.length>12?arguments[12]:void 0;return await new Promise(((Q,F)=>{p(t,U,y,(t=>{"undefined"!==typeof t?Q(t):F(new Error("Data is undefined"))}),I,r,Y,mt,X,P,G,M,L,h)}))}function f(t,U,y){let I=0,r=0,Y=0,mt=0;if("object"===typeof y){const X=y.precision?Math.abs(y.precision):1;y.width&&y.height?(I=y.height*X,r=y.width*X):y.width&&!y.height?(r=y.width*X,I=Math.round(r/t.getAspectRatio(U))):y.height&&!y.width?(I=y.height*X,r=Math.round(I*t.getAspectRatio(U))):(r=Math.round(t.getRenderWidth()*X),I=Math.round(r/t.getAspectRatio(U))),y.finalWidth&&y.finalHeight?(mt=y.finalHeight,Y=y.finalWidth):y.finalWidth&&!y.finalHeight?(Y=y.finalWidth,mt=Math.round(Y/t.getAspectRatio(U))):y.finalHeight&&!y.finalWidth?(mt=y.finalHeight,Y=Math.round(mt*t.getAspectRatio(U))):(Y=r,mt=I)}else isNaN(y)||(I=y,r=y,Y=y,mt=y);return r&&(r=Math.floor(r)),I&&(I=Math.floor(I)),Y&&(Y=Math.floor(Y)),mt&&(mt=Math.floor(mt)),{height:0|I,width:0|r,finalWidth:0|Y,finalHeight:0|mt}}const S={CreateScreenshot:g,CreateScreenshotAsync:B,CreateScreenshotWithResizeAsync:b,CreateScreenshotUsingRenderTarget:p,CreateScreenshotUsingRenderTargetAsync:c};F.Tools.CreateScreenshot=g,F.Tools.CreateScreenshotAsync=B,F.Tools.CreateScreenshotUsingRenderTarget=p,F.Tools.CreateScreenshotUsingRenderTargetAsync=c}}]);