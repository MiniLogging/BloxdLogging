"use strict";(self.nyfa010khv=self.nyfa010khv||[]).push([[12,20],{12336:(L,r,p)=>{p.r(r),p.d(r,{Dispose:()=>x,DumpData:()=>E,DumpDataAsync:()=>t,DumpFramebuffer:()=>C,DumpTools:()=>w});var J=p(12235),i=p(11957),n=p(12154),j=p(12009);let z,G=null;async function C(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;const z=await p.readPixels(0,0,L,r);E(L,r,new Uint8Array(z.buffer),J,i,n,!0,void 0,j)}async function t(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return await new Promise((G=>{E(L,r,p,(L=>G(L)),J,i,n,j,z)}))}function E(L,r,C,t){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return G||(G=new Promise(((L,r)=>{let i,n=null;const G={oi:!0,depth:!1,ti:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(p.bind(p,12257)).then((C=>{let{ThinEngine:t}=C;const E=j.c.Instances.length;try{i=new OffscreenCanvas(100,100),n=new t(i,!1,G)}catch(b){var w;E<j.c.Instances.length&&(null===(w=j.c.Instances.pop())||void 0===w||w.dispose()),i=document.createElement("canvas"),n=new t(i,!1,G)}j.c.Instances.pop(),j.c.OnEnginesDisposedObservable.add((L=>{n&&L!==n&&!n.P&&0===j.c.Instances.length&&x()})),n.getCaps().parallelShaderCompile=void 0;const g=new J.e(n);p.e(52).then(p.bind(p,14636)).then((p=>{let{passPixelShader:j}=p;if(!n)return void r("Engine is not defined");const G=new J.g({gr:n,name:j.name,fragmentShader:j.shader,samplerNames:["textureSampler"]});z={canvas:i,gr:n,renderer:g,wrapper:G},L(z)}))})).catch(r)}))),await G})().then((p=>{if(p.gr.setSize(L,r,!0),C instanceof Float32Array){const L=new Uint8Array(C.length);let r=C.length;for(;r--;){const p=C[r];L[r]=Math.round(255*(0,n.Clamp)(p))}C=L}const J=p.gr.createRawTexture(C,L,r,5,!1,!g,1);p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",J),p.renderer.draw(),b?i.Tools.ToBlob(p.canvas,(L=>{const r=new FileReader;r.onload=L=>{const r=L.target.result;t&&t(r)},r.readAsArrayBuffer(L)}),E,c):i.Tools.EncodeScreenshotCanvasData(p.canvas,t,E,w,c),J.dispose()}))}function x(){var L;z?(z.wrapper.dispose(),z.renderer.dispose(),z.gr.dispose()):null===(L=G)||void 0===L||L.then((L=>{L.wrapper.dispose(),L.renderer.dispose(),L.gr.dispose()}));G=null,z=null}const w={DumpData:E,DumpDataAsync:t,DumpFramebuffer:C,Dispose:x};i.Tools.DumpData=E,i.Tools.DumpDataAsync=t,i.Tools.DumpFramebuffer=C},12105:(L,r,p)=>{p.r(r),p.d(r,{CreateScreenshot:()=>h,CreateScreenshotAsync:()=>U,CreateScreenshotUsingRenderTarget:()=>B,CreateScreenshotUsingRenderTargetAsync:()=>F,CreateScreenshotWithResizeAsync:()=>W,ScreenshotTools:()=>e});var J=p(12111),i=p(12190),n=p(12228),j=p(12087),z=p(12162),G=p(12235),C=p(12253),t=p(12136);class E extends G.g{static _GetDefines(L){if(!L)return null;return L.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(L,r){L?(this._webGPUReady=!0,r.push(Promise.all([p.e(54).then(p.bind(p,14643)),p.e(55).then(p.bind(p,14648))]))):r.push(Promise.all([p.e(56).then(p.bind(p,14654)),p.e(57).then(p.bind(p,14657))]))}constructor(L){const r={...arguments.length>2?arguments[2]:void 0,name:L,gr:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||C.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:E.VertexUrl,fragmentShader:E.FragmentUrl,uniforms:E.Uniforms};super({...r,defines:E._GetDefines(r.gr)}),this.texelSize=new t.Vector2(0,0)}bind(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(L),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}E.VertexUrl="fxaa",E.FragmentUrl="fxaa",E.Uniforms=["texelSize"];class x extends n.d{getClassName(){return"FxaaPostProcess"}constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const G={uniforms:E.Uniforms,size:"number"===typeof r?r:void 0,camera:p,samplingMode:i||J.c.BILINEAR_SAMPLINGMODE,gr:n,reusable:j,textureType:z,...r};super(L,E.FragmentUrl,{effectWrapper:"number"!==typeof r&&r.effectWrapper?void 0:new E(L,n,G),...G}),this.onApplyObservable.add((L=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(L,r,p,J){return z.c.Parse((()=>new x(L.name,L.options,r,L.renderTargetSamplingMode,p.getEngine(),L.reusable)),L,p,J)}}(0,j.e)("BABYLON.FxaaPostProcess",x);var w=p(11975),g=p(11957),b=p(12336),c=p(12343),P=p(12032);let O=null;function h(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:G,width:C}=Q(L,r,p);if(!G||!C)return void w.d.Error("Invalid 'size' parameter !");r.FL().activeCamera===r?L.onEndFrameObservable.addOnce((()=>{O||(O=document.createElement("canvas")),O.width=C,O.height=G;const r=O.getContext("2d"),p=L.getRenderingCanvas();if(!r||!p)return void w.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const t=p.width,E=p.height,x=O.width,b=O.height,c=x/t,P=b/E,h=z?Math.max(c,P):Math.min(c,P),U=t*h,W=E*h,B=(x-U)/2,F=(b-W)/2;r.drawImage(p,0,0,t,E,B,F,U,W),n?(g.Tools.EncodeScreenshotCanvasData(O,void 0,i,void 0,j),J&&J("")):g.Tools.EncodeScreenshotCanvasData(O,J,i,void 0,j)})):B(L,r,p,(L=>{if(n){const r=new Blob([L]);g.Tools.DownloadBlob(r),J&&J("")}else J&&J(L)}),i,1,L.getCreationOptions().antialias,void 0,void 0,void 0,void 0,j)}async function U(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((j,z)=>{h(L,r,p,(L=>{"undefined"!==typeof L?j(L):z(new Error("Data is undefined"))}),J,void 0,i,n)}))}async function W(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((z=>{h(L,r,{width:p,height:J},(()=>{z()}),i,!0,n,j)}))}function B(L,r,n,j){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]&&arguments[9],O=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],h=arguments.length>11?arguments[11]:void 0,U=arguments.length>12?arguments[12]:void 0,W=arguments.length>13?arguments[13]:void 0;const{height:B,width:F,finalWidth:e,finalHeight:v}=Q(L,r,n),y={width:F,height:B};if(!B||!F)return void w.d.Error("Invalid 'size' parameter !");L.skipFrameRender=!0;const A=L.getRenderWidth,u=L.getRenderHeight;L.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&L._currentRenderTarget?L._currentRenderTarget.width:F},L.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&L._currentRenderTarget?L._currentRenderTarget.height:B},L.onResizeObservable.hasObservers()&&L.onResizeObservable.notifyObservers(L);const a=r.FL(),q=new i.d("screenShot",y,a,!1,!1,0,!1,J.c.BILINEAR_SAMPLINGMODE,void 0,g,void 0,void 0,void 0,G);q.renderList=a.meshes.slice(),q.samples=G,q.renderSprites=E,q.activeCamera=r,q.forceLayerMaskCheck=O,null===U||void 0===U||U(q);const Z=W||b.DumpData,X=()=>{a.incrementRenderId(),a.resetCachedMaterial(),(0,P.g)((()=>q.isReadyForRendering()&&r.isReady(!0)),(()=>{L.onEndFrameObservable.addOnce((()=>{e===F&&v===B?q.readPixels(void 0,void 0,void 0,!1).then((L=>{Z(F,B,L,j,z,t,!0,void 0,h),q.dispose()})):(L.isWebGPU?p.e(51).then(p.bind(p,14632)):p.e(52).then(p.bind(p,14636))).then((async()=>await(0,c.d)("pass",q.getInternalTexture(),a,void 0,void 0,void 0,e,v).then((r=>{L._readTexturePixels(r,e,v,-1,0,null,!0,!1,0,0).then((L=>{Z(e,v,L,j,z,t,!0,void 0,h),r.dispose()}))}))))})),a.incrementRenderId(),a.resetCachedMaterial();const J=a.activeCamera,i=a.activeCameras,n=r.outputRenderTarget,G=a.spritesEnabled;a.activeCamera=r,a.activeCameras=null,r.outputRenderTarget=q,a.spritesEnabled=E;const C=a.meshes;a.meshes=q.renderList||a.meshes;try{a.render()}finally{a.activeCamera=J,a.activeCameras=i,r.outputRenderTarget=n,a.spritesEnabled=G,a.meshes=C,L.getRenderWidth=A,L.getRenderHeight=u,L.onResizeObservable.hasObservers()&&L.onResizeObservable.notifyObservers(L),r.getProjectionMatrix(!0),L.skipFrameRender=!1}}),(()=>{L.skipFrameRender=!1,L.getRenderWidth=A,L.getRenderHeight=u}))};if(C){const L=new x("antialiasing",1,a.activeCamera);q.addPostProcess(L),L.en=!0,L.onEffectCreatedObservable.addOnce((L=>{L.isReady()?X():L.onCompiled=()=>{X()}}))}else X()}async function F(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],t=arguments.length>10?arguments[10]:void 0,E=arguments.length>11?arguments[11]:void 0,x=arguments.length>12?arguments[12]:void 0;return await new Promise(((w,g)=>{B(L,r,p,(L=>{"undefined"!==typeof L?w(L):g(new Error("Data is undefined"))}),J,i,n,j,z,G,C,t,E,x)}))}function Q(L,r,p){let J=0,i=0,n=0,j=0;if("object"===typeof p){const z=p.precision?Math.abs(p.precision):1;p.width&&p.height?(J=p.height*z,i=p.width*z):p.width&&!p.height?(i=p.width*z,J=Math.round(i/L.getAspectRatio(r))):p.height&&!p.width?(J=p.height*z,i=Math.round(J*L.getAspectRatio(r))):(i=Math.round(L.getRenderWidth()*z),J=Math.round(i/L.getAspectRatio(r))),p.finalWidth&&p.finalHeight?(j=p.finalHeight,n=p.finalWidth):p.finalWidth&&!p.finalHeight?(n=p.finalWidth,j=Math.round(n/L.getAspectRatio(r))):p.finalHeight&&!p.finalWidth?(j=p.finalHeight,n=Math.round(j*L.getAspectRatio(r))):(n=i,j=J)}else isNaN(p)||(J=p,i=p,n=p,j=p);return i&&(i=Math.floor(i)),J&&(J=Math.floor(J)),n&&(n=Math.floor(n)),j&&(j=Math.floor(j)),{height:0|J,width:0|i,finalWidth:0|n,finalHeight:0|j}}const e={CreateScreenshot:h,CreateScreenshotAsync:U,CreateScreenshotWithResizeAsync:W,CreateScreenshotUsingRenderTarget:B,CreateScreenshotUsingRenderTargetAsync:F};g.Tools.CreateScreenshot=h,g.Tools.CreateScreenshotAsync=U,g.Tools.CreateScreenshotUsingRenderTarget=B,g.Tools.CreateScreenshotUsingRenderTargetAsync=F}}]);