"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[12,20],{12946:(mm,o,u)=>{u.r(o),u.d(o,{Dispose:()=>q,DumpData:()=>Y,DumpDataAsync:()=>z,DumpFramebuffer:()=>K,DumpTools:()=>x});var f=u(12845),B=u(12549),O=u(12752),r=u(12596);let w,p=null;async function K(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;const w=await u.readPixels(0,0,mm,o);Y(mm,o,new Uint8Array(w.buffer),f,B,O,!0,void 0,r)}async function z(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return await new Promise((p=>{Y(mm,o,u,(mm=>p(mm)),f,B,O,r,w)}))}function Y(mm,o,K,z){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],M=arguments.length>8?arguments[8]:void 0;(async function(){return p||(p=new Promise(((mm,o)=>{let B,O=null;const p={Xf:!0,depth:!1,Nf:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(u.bind(u,12865)).then((K=>{let{ThinEngine:z}=K;const Y=r.d.Instances.length;try{B=new OffscreenCanvas(100,100),O=new z(B,!1,p)}catch(E){var x;Y<r.d.Instances.length&&(null===(x=r.d.Instances.pop())||void 0===x||x.dispose()),B=document.createElement("canvas"),O=new z(B,!1,p)}r.d.Instances.pop(),r.d.OnEnginesDisposedObservable.add((mm=>{O&&mm!==O&&!O.q&&0===r.d.Instances.length&&q()})),O.getCaps().parallelShaderCompile=void 0;const H=new f.e(O);u.e(52).then(u.bind(u,15103)).then((u=>{let{passPixelShader:r}=u;if(!O)return void o("Engine is not defined");const p=new f.i({Mo:O,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});w={canvas:B,Mo:O,renderer:H,wrapper:p},mm(w)}))})).catch(o)}))),await p})().then((u=>{if(u.Mo.setSize(mm,o,!0),K instanceof Float32Array){const mm=new Uint8Array(K.length);let o=K.length;for(;o--;){const u=K[o];mm[o]=Math.round(255*(0,O.Clamp)(u))}K=mm}const f=u.Mo.createRawTexture(K,mm,o,5,!1,!H,1);u.renderer.setViewport(),u.renderer.applyEffectWrapper(u.wrapper),u.wrapper.effect._bindTexture("textureSampler",f),u.renderer.draw(),E?B.Tools.ToBlob(u.canvas,(mm=>{const o=new FileReader;o.onload=mm=>{const o=mm.target.result;z&&z(o)},o.readAsArrayBuffer(mm)}),Y,M):B.Tools.EncodeScreenshotCanvasData(u.canvas,z,Y,x,M),f.dispose()}))}function q(){var mm;w?(w.wrapper.dispose(),w.renderer.dispose(),w.Mo.dispose()):null===(mm=p)||void 0===mm||mm.then((mm=>{mm.wrapper.dispose(),mm.renderer.dispose(),mm.Mo.dispose()}));p=null,w=null}const x={DumpData:Y,DumpDataAsync:z,DumpFramebuffer:K,Dispose:q};B.Tools.DumpData=Y,B.Tools.DumpDataAsync=z,B.Tools.DumpFramebuffer=K},12722:(mm,o,u)=>{u.r(o),u.d(o,{CreateScreenshot:()=>Q,CreateScreenshotAsync:()=>b,CreateScreenshotUsingRenderTarget:()=>N,CreateScreenshotUsingRenderTargetAsync:()=>S,CreateScreenshotWithResizeAsync:()=>J,ScreenshotTools:()=>R});var f=u(12727),B=u(12796),O=u(12839),r=u(12702),w=u(12766),p=u(12845),K=u(12863),z=u(12740);class Y extends p.i{static _GetDefines(mm){if(!mm)return null;return mm.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(mm,o){mm?(this._webGPUReady=!0,o.push(Promise.all([u.e(54).then(u.bind(u,15107)),u.e(55).then(u.bind(u,15112))]))):o.push(Promise.all([u.e(56).then(u.bind(u,15119)),u.e(57).then(u.bind(u,15124))]))}constructor(mm){const o={...arguments.length>2?arguments[2]:void 0,name:mm,Mo:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||K.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:Y.VertexUrl,fragmentShader:Y.FragmentUrl,uniforms:Y.Uniforms};super({...o,defines:Y._GetDefines(o.Mo)}),this.texelSize=new z.Vector2(0,0)}bind(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(mm),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}Y.VertexUrl="fxaa",Y.FragmentUrl="fxaa",Y.Uniforms=["texelSize"];class q extends O.d{getClassName(){return"FxaaPostProcess"}constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const p={uniforms:Y.Uniforms,size:"number"===typeof o?o:void 0,camera:u,samplingMode:B||f.b.BILINEAR_SAMPLINGMODE,Mo:O,reusable:r,textureType:w,...o};super(mm,Y.FragmentUrl,{effectWrapper:"number"!==typeof o&&o.effectWrapper?void 0:new Y(mm,O,p),...p}),this.onApplyObservable.add((mm=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(mm,o,u,f){return w.c.Parse((()=>new q(mm.name,mm.options,o,mm.renderTargetSamplingMode,u.getEngine(),mm.reusable)),mm,u,f)}}(0,r.c)("BABYLON.FxaaPostProcess",q);var x=u(12565),H=u(12549),E=u(12946),M=u(12952),l=u(12634);let t=null;function Q(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6?arguments[6]:void 0,w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:p,width:K}=P(mm,o,u);if(!p||!K)return void x.e.Error("Invalid 'size' parameter !");o.Pm().activeCamera===o?mm.onEndFrameObservable.addOnce((()=>{t||(t=document.createElement("canvas")),t.width=K,t.height=p;const o=t.getContext("2d"),u=mm.getRenderingCanvas();if(!o||!u)return void x.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const z=u.width,Y=u.height,q=t.width,E=t.height,M=q/z,l=E/Y,Q=w?Math.max(M,l):Math.min(M,l),b=z*Q,J=Y*Q,N=(q-b)/2,S=(E-J)/2;o.drawImage(u,0,0,z,Y,N,S,b,J),O?(H.Tools.EncodeScreenshotCanvasData(t,void 0,B,void 0,r),f&&f("")):H.Tools.EncodeScreenshotCanvasData(t,f,B,void 0,r)})):N(mm,o,u,(mm=>{if(O){const o=new Blob([mm]);H.Tools.DownloadBlob(o),f&&f("")}else f&&f(mm)}),B,1,mm.getCreationOptions().antialias,void 0,void 0,void 0,void 0,r)}async function b(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((r,w)=>{Q(mm,o,u,(mm=>{"undefined"!==typeof mm?r(mm):w(new Error("Data is undefined"))}),f,void 0,B,O)}))}async function J(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((w=>{Q(mm,o,{width:u,height:f},(()=>{w()}),B,!0,O,r)}))}function N(mm,o,O,r){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],H=arguments.length>9&&void 0!==arguments[9]&&arguments[9],t=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],Q=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0,J=arguments.length>13?arguments[13]:void 0;const{height:N,width:S,finalWidth:R,finalHeight:g}=P(mm,o,O),W={width:S,height:N};if(!N||!S)return void x.e.Error("Invalid 'size' parameter !");mm.skipFrameRender=!0;const F=mm.getRenderWidth,c=mm.getRenderHeight;mm.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&mm._currentRenderTarget?mm._currentRenderTarget.width:S},mm.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&mm._currentRenderTarget?mm._currentRenderTarget.height:N},mm.onResizeObservable.hasObservers()&&mm.onResizeObservable.notifyObservers(mm);const A=o.Pm(),y=new B.c("screenShot",W,A,!1,!1,0,!1,f.b.BILINEAR_SAMPLINGMODE,void 0,H,void 0,void 0,void 0,p);y.renderList=A.meshes.slice(),y.samples=p,y.renderSprites=Y,y.activeCamera=o,y.forceLayerMaskCheck=t,null===b||void 0===b||b(y);const I=J||E.DumpData,s=()=>{A.incrementRenderId(),A.resetCachedMaterial(),(0,l.g)((()=>y.isReadyForRendering()&&o.isReady(!0)),(()=>{mm.onEndFrameObservable.addOnce((()=>{R===S&&g===N?y.readPixels(void 0,void 0,void 0,!1).then((mm=>{I(S,N,mm,r,w,z,!0,void 0,Q),y.dispose()})):(mm.isWebGPU?u.e(51).then(u.bind(u,15097)):u.e(52).then(u.bind(u,15103))).then((async()=>await(0,M.c)("pass",y.getInternalTexture(),A,void 0,void 0,void 0,R,g).then((o=>{mm._readTexturePixels(o,R,g,-1,0,null,!0,!1,0,0).then((mm=>{I(R,g,mm,r,w,z,!0,void 0,Q),o.dispose()}))}))))})),A.incrementRenderId(),A.resetCachedMaterial();const f=A.activeCamera,B=A.activeCameras,O=o.outputRenderTarget,p=A.spritesEnabled;A.activeCamera=o,A.activeCameras=null,o.outputRenderTarget=y,A.spritesEnabled=Y;const K=A.meshes;A.meshes=y.renderList||A.meshes;try{A.render()}finally{A.activeCamera=f,A.activeCameras=B,o.outputRenderTarget=O,A.spritesEnabled=p,A.meshes=K,mm.getRenderWidth=F,mm.getRenderHeight=c,mm.onResizeObservable.hasObservers()&&mm.onResizeObservable.notifyObservers(mm),o.getProjectionMatrix(!0),mm.skipFrameRender=!1}}),(()=>{mm.skipFrameRender=!1,mm.getRenderWidth=F,mm.getRenderHeight=c}))};if(K){const mm=new q("antialiasing",1,A.activeCamera);y.addPostProcess(mm),mm.Gf=!0,mm.onEffectCreatedObservable.addOnce((mm=>{mm.isReady()?s():mm.onCompiled=()=>{s()}}))}else s()}async function S(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6?arguments[6]:void 0,w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],z=arguments.length>10?arguments[10]:void 0,Y=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0;return await new Promise(((x,H)=>{N(mm,o,u,(mm=>{"undefined"!==typeof mm?x(mm):H(new Error("Data is undefined"))}),f,B,O,r,w,p,K,z,Y,q)}))}function P(mm,o,u){let f=0,B=0,O=0,r=0;if("object"===typeof u){const w=u.precision?Math.abs(u.precision):1;u.width&&u.height?(f=u.height*w,B=u.width*w):u.width&&!u.height?(B=u.width*w,f=Math.round(B/mm.getAspectRatio(o))):u.height&&!u.width?(f=u.height*w,B=Math.round(f*mm.getAspectRatio(o))):(B=Math.round(mm.getRenderWidth()*w),f=Math.round(B/mm.getAspectRatio(o))),u.finalWidth&&u.finalHeight?(r=u.finalHeight,O=u.finalWidth):u.finalWidth&&!u.finalHeight?(O=u.finalWidth,r=Math.round(O/mm.getAspectRatio(o))):u.finalHeight&&!u.finalWidth?(r=u.finalHeight,O=Math.round(r*mm.getAspectRatio(o))):(O=B,r=f)}else isNaN(u)||(f=u,B=u,O=u,r=u);return B&&(B=Math.floor(B)),f&&(f=Math.floor(f)),O&&(O=Math.floor(O)),r&&(r=Math.floor(r)),{height:0|f,width:0|B,finalWidth:0|O,finalHeight:0|r}}const R={CreateScreenshot:Q,CreateScreenshotAsync:b,CreateScreenshotWithResizeAsync:J,CreateScreenshotUsingRenderTarget:N,CreateScreenshotUsingRenderTargetAsync:S};H.Tools.CreateScreenshot=Q,H.Tools.CreateScreenshotAsync=b,H.Tools.CreateScreenshotUsingRenderTarget=N,H.Tools.CreateScreenshotUsingRenderTargetAsync=S}}]);