/*! For license information please see ddczdp.12.0cb6ebd6.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12],{12913:f=>{"use strict";f.exports=function(f,z,w,S,C,E){var F=+z[0],J=+z[1],x=+z[2],u=+w[0],h=+w[1],X=+w[2],K=Math.sqrt(u*u+h*h+X*X);if(0===K)throw new Error("Can't raycast along a zero vector");return function(f,z,w,S,C,E,F,J,x,u){for(var h=0,X=Math.floor,K=0|X(z),c=0|X(w),y=0|X(S),e=C>0?1:-1,O=E>0?1:-1,d=F>0?1:-1,B=Math.abs(1/C),V=Math.abs(1/E),W=Math.abs(1/F),T=B<1/0?B*(e>0?K+1-z:z-K):1/0,v=V<1/0?V*(O>0?c+1-w:w-c):1/0,D=W<1/0?W*(d>0?y+1-S:S-y):1/0,A=-1;h<=J;){var M=f(K,c,y);if(M)return x&&(x[0]=z+h*C,x[1]=w+h*E,x[2]=S+h*F),u&&(u[0]=u[1]=u[2]=0,0===A&&(u[0]=-e),1===A&&(u[1]=-O),2===A&&(u[2]=-d)),M;T<v?T<D?(K+=e,h=T,T+=B,A=0):(y+=d,h=D,D+=W,A=2):v<D?(c+=O,h=v,v+=V,A=1):(y+=d,h=D,D+=W,A=2)}return x&&(x[0]=z+h*C,x[1]=w+h*E,x[2]=S+h*F),u&&(u[0]=u[1]=u[2]=0),0}(f,F,J,x,u/=K,h/=K,X/=K,S="undefined"===typeof S?64:+S,C,E)}},12946:(f,z,w)=>{"use strict";w.d(z,{b:()=>E});var S=w(99);function C(){this.Ml=!1,this.stopPropagation=!1,this.Nl=!1,this.disabled=!1}class E{constructor(f,z){this.version="0.7.0";var w=Object.assign({},new C,z||{});this.element=f||document,this.Ml=!!w.Ml,this.stopPropagation=!!w.stopPropagation,this.Nl=!!w.Nl,this.disabled=!!w.disabled,this.filterEvents=(f,z)=>!0,this.down=new S.EventEmitter,this.up=new S.EventEmitter,this.state={},this.hh={dx:0,dy:0,tm:0,Pe:0,um:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?J(this):document.addEventListener("DOMContentLoaded",(f=>{J(this)}),{once:!0})}bind(f){for(var z=arguments.length,w=new Array(z>1?z-1:0),S=1;S<z;S++)w[S-1]=arguments[S];w.forEach((z=>{var w=this._keyBindmap[z]||[];w.includes(f)||(w.push(f),this._keyBindmap[z]=w)})),this.state[f]=!!this.state[f],this.pressCount[f]=this.pressCount[f]||0,this.releaseCount[f]=this.releaseCount[f]||0}unbind(f){for(var z in this._keyBindmap){var w=this._keyBindmap[z],S=w.indexOf(f);S>-1&&w.splice(S,1)}}getBindings(){var f={};for(var z in this._keyBindmap){this._keyBindmap[z].forEach((w=>{f[w]=f[w]||[],f[w].push(z)}))}return f}Ze(){F(this.hh),F(this.pressCount),F(this.releaseCount)}}function F(f){for(var z in f)f[z]=0}function J(f){window.addEventListener("keydown",y.bind(null,f,!0),!1),window.addEventListener("keyup",y.bind(null,f,!1),!1);var z={passive:!0};f.element.addEventListener("touchstart",X.bind(void 0,f),{passive:!1}),f.element.addEventListener("touchend",c.bind(void 0,f),z),f.element.addEventListener("mousedown",e.bind(null,f,!0),z),window.document.addEventListener("mouseup",e.bind(null,f,!1),z),f.element.addEventListener("touchmove",O.bind(null,f),z),f.element.addEventListener("mousemove",O.bind(null,f),z),window.PointerEvent,f.element.addEventListener("wheel",d.bind(null,f),z),f.element.addEventListener("contextmenu",B.bind(null,f),!1),window.addEventListener("blur",V.bind(null,f),!1)}var x=0,u=0,h=null;function X(f,z){z.preventDefault(),K(z)}function K(f){let z=!1;for(let w=0;w<f.touches.length;++w)if(f.touches[w].identifier===h){z=!0;break}if(!z){const z=f.changedTouches[0];x=z.clientX,u=z.clientY,h=z.identifier}}function c(f,z){for(var w=z.changedTouches,S=0;S<w.length;++S)w[S].identifier===h&&(h=null)}function y(f,z,w){W(w.code,z,f,w)}function e(f,z,w){if("pointerId"in w)if(z){if(null!==f._touches.currID)return;f._touches.currID=w.pointerId}else{if(f._touches.currID!==w.pointerId)return;f._touches.currID=null}return W("Mouse"+("button"in w?w.button+1:1),z,f,w),!1}function O(f,z){var w=z.movementX||z.mozMovementX||0,S=z.movementY||z.mozMovementY||0;if(z.touches&&0===(w|S)){var C=function(f){K(f);for(let z=0;z<f.changedTouches.length;++z)if(f.changedTouches[z].identifier==h){const w=f.changedTouches[z],S=[w.clientX-x,w.clientY-u];return x=w.clientX,u=w.clientY,S}return console.error(`Did not find touch id ${h}`),[0,0]}(z);w=C[0],S=C[1]}f.hh.dx+=w,f.hh.dy+=S}function d(f,z){var w=1;switch(z.deltaMode){case 0:w=1;break;case 1:w=12;break;case 2:w=f.element.clientHeight||window.innerHeight}f.hh.tm+=(z.deltaX||0)*w,f.hh.Pe+=(z.deltaY||0)*w,f.hh.um+=(z.deltaZ||0)*w}function B(f,z){if(!f.Nl)return z.preventDefault(),!1}function V(f){for(var z in f._keyStates)f._keyStates[z]&&(/^Mouse\d/.test(z)||W(z,!1,f,{code:z,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function W(f,z,w,S){var C=w._keyBindmap[f];C&&(T(w._keyStates[f],z)&&(w._keyStates[f]=z,C.forEach((f=>{(!w.filterEvents||w.filterEvents(S,f))&&function(f,z,w,S){var C=z?w.pressCount:w.releaseCount;C[f]=(C[f]||0)+1;var E=w._bindPressCount[f]||0;(E+=z?1:-1)<0&&(E=0);w._bindPressCount[f]=E;var F=w.state[f];if(T(F,E)){w.state[f]=E>0;var J=z?w.down:w.up;w.disabled||J.emit(f,S)}}(f,z,w,S)}))),"button"in S||(w.Ml&&!S.defaultPrevented&&S.preventDefault(),w.stopPropagation&&S.stopPropagation()))}function T(f,z){return f?!z:z}},12922:(f,z,w)=>{"use strict";w.d(z,{c:()=>S});class S{constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Rk=!1,this.Sk=!1,this.Tf=30,this.Qk=0,this.Zk=!1,this.fullscreen=!1,this.Uk=function(f){},this.Vk=function(){},this.Xk=function(){},this.k=function(){},this.Wk=function(f){},this.onFullscreenChanged=function(f){},u((()=>{!function(f,z){f._nowObject=performance||Date,f._lastTick=0,f._renderAccum=0,f._rt=0,f._frameCB=J.bind(null,f),requestAnimationFrame(f._frameCB),z>0&&(f._intervalCB=F.bind(null,f),f._interval=setInterval(f._intervalCB,Math.max(z,1e3/f.Tf/2)))}(this,z),function(f,z){if(!z)return;var w=!1,S=!1;document.addEventListener("pointerlockchange",(S=>{w=document.pointerLockElement===z,f.Wk(w)})),document.addEventListener("fullscreenchange",(w=>{S=document.fullscreenElement===z,f.onFullscreenChanged(S)})),Object.defineProperty(f,"Zk",{get:()=>w,set:f=>{f&&!w?x(z):w&&!f&&function(f){f.exitPointerLock&&f.exitPointerLock()}(document)}}),Object.defineProperty(f,"fullscreen",{get:()=>S,set:f=>{f&&!S?z.requestFullscreen():S&&!f&&document.exitFullscreen()}}),z.addEventListener("click",(C=>{f.Rk&&!w&&x(z),f.Sk&&!S&&z.requestFullscreen()}));var C=()=>f.k();if(window.ResizeObserver){new ResizeObserver(C).observe(z)}else window.addEventListener("resize",C)}(this,f),this.Xk()}))}}var C=3,E=20;function F(f){for(var z=1e3/f.Tf,w=f._nowObject.now()+E,S=0;f._nowObject.now()>=f._lastTick+z&&f._nowObject.now()<w&&++S<=C;)f.Uk(z),f._lastTick+=z;var F=5*(z+5),J=f._nowObject.now();if(J-f._lastTick>F)for(;J>=f._lastTick+z;)f._lastTick+=z}function J(f){requestAnimationFrame(f._frameCB),F(f);var z=f._nowObject.now(),w=z-f._rt;if(f._rt=z,f.Qk>0){f._renderAccum+=w;var S=1e3/f.Qk;if(f._renderAccum<S)return;f._renderAccum=Math.min(f._renderAccum-S,S)}var C=1e3/f.Tf,E=(z-f._lastTick)/C;f.Vk(w,E,C)}function x(f){f.requestPointerLock&&f.requestPointerLock()}var u=f=>{if("loading"===document.readyState){var z=()=>{document.removeEventListener("readystatechange",z),f()};document.addEventListener("readystatechange",z)}else setTimeout(f,1)}},12955:(f,z,w)=>{"use strict";w.d(z,{e:()=>X});var S=w(940),C=w(153);class E{constructor(f,z,w,E,F,J,x){this.$f=new S(f.base,f.Ie),this.mass=z,this.friction=w,this.restitution=E,this.we=F,this.sf=J,this.xe=!!x,this.Ag=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.di=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this._f=C.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=C.create(),this._impulses=C.create(),this._sleepFrameCount=10}loadFromCopy(f){C.i(this.$f.base,f.$f.base),C.i(this.$f.Ie,f.$f.Ie),C.i(this.$f.max,f.$f.max),this.$f.mag=f.$f.mag,this.mass=f.mass,this.friction=f.friction,this.restitution=f.restitution,this.we=f.we,this.sf=f.sf,this.xe=f.xe,this.Ag=f.Ag,this.fluidDrag=f.fluidDrag,this.di=f.di,this.preventFallOffEdge=f.preventFallOffEdge,this.rolledBackLastTick=f.rolledBackLastTick,C.i(this._f,f._f),C.i(this.resting,f.resting),this.inFluid=f.inFluid,this._ratioInFluid=f._ratioInFluid,C.i(this._forces,f._forces),C.i(this._impulses,f._impulses),this._sleepFrameCount=f._sleepFrameCount}setPosition(f){F(f),C.te(f,f,this.$f.base),this.$f.translate(f),this._h()}Rg(){return C.clone(this.$f.base)}applyForce(f){F(f),C.add(this._forces,this._forces,f),this._h()}applyImpulse(f){F(f),C.add(this._impulses,this._impulses,f),this._h()}_h(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var F=f=>{};var J=w(940),x=w(153),u=w(949);function h(){this.Ag=.1,this.fluidDrag=.4,this.Fe=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function X(f,z,w){f=Object.assign(new h,f),this.gravity=f.gravity||[0,-10,0],this.Ag=f.Ag||.1,this.Fe=f.Fe||2,this.fluidDrag=f.fluidDrag||.4,this.minBounceImpulse=f.minBounceImpulse,this.bodies=[],this.km=f.km,this.testSolid=z,this.testFluid=w}X.prototype.Mf=function(f,z,w,S,C,F){f=f||new J([0,0,0],[1,1,1]),"undefined"==typeof z&&(z=1),"undefined"==typeof w&&(w=1),"undefined"==typeof S&&(S=0),"undefined"==typeof C&&(C=1);var x=new E(f,z,w,S,C,F);return this.bodies.push(x),x},X.prototype.Pf=function(f){var z=this.bodies.indexOf(f);z<0||(this.bodies.splice(z,1),f.$f=f.sf=null)};var K=x.create(),c=x.create(),y=x.create(),e=x.create(),O=x.create(),d=x.create(),B=x.create(),V=new J([0,0,0],[1,1,1]),W=new E(V,1,1,0,1,(()=>{}),!1);function T(f,z,w){return z=w,z*=1-(1-f.ratioInFluid)**2}X.prototype.Ze=function(f){f/=1e3;var z=i(0,x.squaredLength(this.gravity));this.bodies.forEach((w=>function(f,z,w,S){x.i(O,z.resting),f.km&&W.loadFromCopy(z);if(z.mass<=0)return x.set(z._f,0,0,0),x.set(z._forces,0,0,0),void x.set(z._impulses,0,0,0);var C=S||0===z.we;if(function(f,z,w,S){if(z._sleepFrameCount>0)return!1;if(S)return!0;var C=!1,E=.5*w*w*z.we;return x.scale(U,f.gravity,E),u(f.testSolid,z.$f,U,(function(){return C=!0,!0}),!0),C}(f,z,w,C))return;z._sleepFrameCount--,function(f,z){var w=z.$f,S=Math.floor(w.base[0]),C=Math.floor(w.base[2]),E=Math.floor(w.base[1]),F=Math.floor(w.max[1]);if(!f.testFluid(S,E,C))return z.inFluid=!1,void(z.ratioInFluid=0);var J=1,u=E+1;for(;u<=F&&f.testFluid(S,u,C);)J++,u++;var h=(E+J-w.base[1])/w.Ie[1];h>1&&(h=1);var X=w.Ie[0]*w.Ie[1]*w.Ie[2]*h,K=D;x.scale(K,f.gravity,-f.Fe*X*z.we),z.applyForce(K),z.inFluid=!0,z.ratioInFluid=h}(f,z),r(z._forces),r(z._impulses),r(z._f),r(z.resting),x.scale(K,z._forces,1/z.mass),x.$e(K,K,f.gravity,z.we),x.scale(c,z._impulses,1/z.mass),x.$e(c,c,K,w),x.add(z._f,z._f,c),z.friction&&(A(f,0,z,c,w),A(f,1,z,c,w),A(f,2,z,c,w));var E=z.fluidDrag>=0?z.fluidDrag:f.fluidDrag,F=z.Ag>=0?z.Ag:f.Ag,J=F,h=F;z.inFluid&&(J=T(z,J,z.fluidDragHoriz>=0?z.fluidDragHoriz:E),h=T(z,h,z.fluidDragVert>=0?z.fluidDragVert:E));J=Math.max(1-J*w/z.mass,0),h=Math.max(1-h*w/z.mass,0),x.set(v,J,h,J),x.multiply(z._f,z._f,v),x.scale(y,z._f,w),x.set(z._forces,0,0,0),x.set(z._impulses,0,0,0),z.xe&&m(I,z.$f);x.i(d,y),x.set(B,0,0,0),z.preventFallOffEdge&&function(f,z,w,S){if(!z.resting[1]||w[1]>0)return;var C=s;m(C,z.$f);for(var E=0;E<3;E+=2){x.set(a,0,0,0),a[E]=w[E];var F=!0;(F=(F=(F=(F=F&&!L(f,C.base[0]+a[0]+1e-5,C.base[1],C.base[2]+a[2]+1e-5))&&!L(f,C.max[0]+a[0]-1e-5,C.base[1],C.base[2]+a[2]+1e-5))&&!L(f,C.base[0]+a[0]+1e-5,C.base[1],C.max[2]+a[2]-1e-5))&&!L(f,C.max[0]+a[0]-1e-5,C.base[1],C.max[2]+a[2]-1e-5))?(S[E]=w[E]>0?1:-1,w[E]=0):0===E&&(x.set(H,w[0],0,0),G(f,C,H,S,z.slideOnCollision))}}(f,z,y,B);G(f,z.$f,y,z.resting,z.slideOnCollision),z.xe&&function(f,z,w,S){if(z.resting[1]>=0&&!z.inFluid)return;var C=0!==z.resting[0],E=0!==z.resting[2];if(!C&&!E)return;var F=Math.abs(S[0]/S[2]),J=4;if(!C&&F>J)return;if(!E&&F<1/J)return;x.add(P,w.base,S);var h=f.testSolid;u(h,w,S,(function(f,z,w,S){if(1!==z)return!0;S[z]=0}));var X=w.base[1],K=z.inFluid?1.951:1.001,c=Math.floor(X+K)-X;x.set(R,0,c,0);var y=!1;if(u(h,w,R,(function(f,z,w,S){return y=!0,!0})),y)return;x.te(q,P,w.base),q[1]=0,G(f,w,q,n,!0);var e=i(w.base[0],P[0]),O=i(w.base[2],P[2]);if(C&&!e&&(!O||!E))return;if(E&&(!e||!C)&&!O)return;var d=!0;if(d=d&&!L(f,w.base[0]+1e-5,w.base[1],w.base[2]+1e-5),d=d&&!L(f,w.max[0]-1e-5,w.base[1],w.base[2]+1e-5),d=d&&!L(f,w.base[0]+1e-5,w.base[1],w.max[2]-1e-5),d=d&&!L(f,w.max[0]-1e-5,w.base[1],w.max[2]-1e-5),d)return;m(z.$f,w),z.resting[0]=n[0],z.resting[2]=n[2],z.di&&z.di()}(f,z,I,d);for(var X=0;X<3;++X)z.resting[X]=z.resting[X]||B[X],e[X]=0,z.resting[X]&&(O[X]||(e[X]=-z._f[X]),z._f[X]=0);var V=x.length(e);V>.001&&(x.scale(e,e,z.mass),z.sf&&z.sf(e),z.restitution>0&&V>f.minBounceImpulse&&(x.scale(e,e,z.restitution),z.applyImpulse(e)));var M=x.squaredLength(z._f);M>1e-5&&z._h();f.km&&f.km(z)?(z.loadFromCopy(W),z.rolledBackLastTick=!0):z.rolledBackLastTick=!1}(this,w,f,z)))};var v=x.create([0,0,0]);var D=x.create();function A(f,z,w,S,C){var E=w.resting[z],F=S[z];if(!w.alwaysApplyHorizFriction||1!==z){if(0===E)return;if(E*F<=0)return}x.i(M,w._f),M[z]=0;var J=x.length(M);if(!i(J,0)){var u=Math.abs(w.friction*f.gravity[z]*C),h=J>u?(J-u)/J:0;w._f[(z+1)%3]*=h,w._f[(z+2)%3]*=h}}var M=x.create();function G(f,z,w,S,C){return x.set(S,0,0,0),u(f.testSolid,z,w,(function(f,z,w,E){S[z]=w,E[z]=0,C||(E[0]=0,E[1]=0,E[2]=0)}))}var I=new J([],[]),n=x.create(),P=x.create(),R=x.create(),q=x.create();var a=x.create(),s=new J([],[]),H=x.create();function L(f,z,w,S){return f.testSolid(Math.floor(z),Math.floor(w-1),Math.floor(S))}var U=x.create();function i(f,z){return Math.abs(f-z)<1e-5}function m(f,z){for(var w=0;w<3;w++)f.base[w]=z.base[w],f.max[w]=z.max[w],f.Ie[w]=z.Ie[w]}var r=function(f){}},11873:function(f,z){!function(f){"use strict";var z=function(f,w){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,z){f.__proto__=z}||function(f,z){for(var w in z)Object.prototype.hasOwnProperty.call(z,w)&&(f[w]=z[w])},z(f,w)};function w(f,w){if("function"!==typeof w&&null!==w)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function S(){this.constructor=f}z(f,w),f.prototype=null===w?Object.create(w):(S.prototype=w.prototype,new S)}function S(f,z,w,S){var C,E=arguments.length,F=E<3?z:null===S?S=Object.getOwnPropertyDescriptor(z,w):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)F=Reflect.decorate(f,z,w,S);else for(var J=f.length-1;J>=0;J--)(C=f[J])&&(F=(E<3?C(F):E>3?C(z,w,F):C(z,w))||F);return E>3&&F&&Object.defineProperty(z,w,F),F}function C(f,z,w){if(w||2===arguments.length)for(var S,C=0,E=z.length;C<E;C++)!S&&C in z||(S||(S=Array.prototype.slice.call(z,0,C)),S[C]=z[C]);return f.concat(S||Array.prototype.slice.call(z))}var E,F=255,J=213;f.OPERATION=void 0,(E=f.OPERATION||(f.OPERATION={}))[E.ADD=128]="ADD",E[E.REPLACE=0]="REPLACE",E[E.DELETE=64]="DELETE",E[E.DELETE_AND_ADD=192]="DELETE_AND_ADD",E[E.TOUCH=1]="TOUCH",E[E.CLEAR=10]="CLEAR";var x=function(){function z(f,z,w){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=f,this.setParent(z,w)}return z.prototype.setParent=function(f,z,w){var S=this;if(this.indexes||(this.indexes=this.ref instanceof qf?this.ref._definition.indexes:{}),this.parent=f,this.parentIndex=w,z)if(this.root=z,this.ref instanceof qf){var C=this.ref._definition;for(var E in C.schema){var F=this.ref[E];if(F&&F.$changes){var J=C.indexes[E];F.$changes.setParent(this.ref,z,J)}}}else"object"===typeof this.ref&&this.ref.forEach((function(f,z){if(f instanceof qf){var w=f.$changes,C=S.ref.$changes.indexes[z];w.setParent(S.ref,S.root,C)}}))},z.prototype.operation=function(f){this.changes.set(--this.currentCustomOperation,f)},z.prototype.change=function(z,w){void 0===w&&(w=f.OPERATION.ADD);var S="number"===typeof z?z:this.indexes[z];this.assertValidIndex(S,z);var C=this.changes.get(S);C&&C.op!==f.OPERATION.DELETE&&C.op!==f.OPERATION.TOUCH||this.changes.set(S,{op:C&&C.op===f.OPERATION.DELETE?f.OPERATION.DELETE_AND_ADD:w,index:S}),this.allChanges.add(S),this.changed=!0,this.touchParents()},z.prototype.touch=function(z){var w="number"===typeof z?z:this.indexes[z];this.assertValidIndex(w,z),this.changes.has(w)||this.changes.set(w,{op:f.OPERATION.TOUCH,index:w}),this.allChanges.add(w),this.touchParents()},z.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},z.prototype.getType=function(f){if(this.ref._definition)return(z=this.ref._definition).schema[z.fieldsByIndex[f]];var z,w=(z=this.parent._definition).schema[z.fieldsByIndex[this.parentIndex]];return Object.values(w)[0]},z.prototype.getChildrenFilter=function(){var f=this.parent._definition.childFilters;return f&&f[this.parentIndex]},z.prototype.getValue=function(f){return this.ref.getByIndex(f)},z.prototype.delete=function(z){var w="number"===typeof z?z:this.indexes[z];if(void 0!==w){var S=this.getValue(w);this.changes.set(w,{op:f.OPERATION.DELETE,index:w}),this.allChanges.delete(w),delete this.caches[w],S&&S.$changes&&(S.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(z," (").concat(w,")"))},z.prototype.discard=function(z,w){var S=this;void 0===z&&(z=!1),void 0===w&&(w=!1),this.ref instanceof qf||this.changes.forEach((function(z){if(z.op===f.OPERATION.DELETE){var w=S.ref.getIndex(z.index);delete S.indexes[w]}})),this.changes.clear(),this.changed=z,w&&this.allChanges.clear(),this.currentCustomOperation=0},z.prototype.discardAll=function(){var f=this;this.changes.forEach((function(z){var w=f.getValue(z.index);w&&w.$changes&&w.$changes.discardAll()})),this.discard()},z.prototype.cache=function(f,z){this.caches[f]=z},z.prototype.clone=function(){return new z(this.ref,this.parent,this.root)},z.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},z.prototype.assertValidIndex=function(f,z){if(void 0===f)throw new Error('ChangeTree: missing index for field "'.concat(z,'"'))},z}();function u(f,z,w,S){return f[z]||(f[z]=[]),f[z].push(w),null===S||void 0===S||S.forEach((function(f,z){return w(f,z)})),function(){return X(f[z],f[z].indexOf(w))}}function h(z){var w=this,S="string"!==typeof this.$changes.getType();this.$items.forEach((function(C,E){z.push({refId:w.$changes.refId,op:f.OPERATION.DELETE,field:E,value:void 0,previousValue:C}),S&&w.$changes.root.removeRef(C.$changes.refId)}))}function X(f,z){if(-1===z||z>=f.length)return!1;for(var w=f.length-1,S=z;S<w;S++)f[S]=f[S+1];return f.length=w,!0}var K=function(f,z){var w=f.toString(),S=z.toString();return w<S?-1:w>S?1:0};function c(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,z){return"symbol"===typeof z||isNaN(z)?f[z]:f.at(z)},set:function(f,z,w){if("symbol"===typeof z||isNaN(z))f[z]=w;else{var S=Array.from(f.$items.keys()),C=parseInt(S[z]||z);void 0===w||null===w?f.deleteAt(C):f.setAt(C,w)}return!0},deleteProperty:function(f,z){return"number"===typeof z?f.deleteAt(z):delete f[z],!0}})}var y=function(){function z(){for(var f=[],z=0;z<arguments.length;z++)f[z]=arguments[z];this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,f)}return z.prototype.bd=function(z,w){return void 0===w&&(w=!0),u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,z,w?this.$items:void 0)},z.prototype.kd=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,z)},z.is=function(f){return Array.isArray(f)||void 0!==f.array},Object.defineProperty(z.prototype,"length",{get:function(){return this.$items.size},set:function(f){0===f?this.clear():this.splice(f,this.length-f)},enumerable:!1,configurable:!0}),z.prototype.push=function(){for(var f,z=this,w=[],S=0;S<arguments.length;S++)w[S]=arguments[S];return w.forEach((function(w){f=z.$refId++,z.setAt(f,w)})),f},z.prototype.pop=function(){var f=Array.from(this.$indexes.values()).pop();if(void 0!==f){this.$changes.delete(f),this.$indexes.delete(f);var z=this.$items.get(f);return this.$items.delete(f),z}},z.prototype.at=function(f){var z=Array.from(this.$items.keys())[f];return this.$items.get(z)},z.prototype.setAt=function(z,w){var S,C;if(void 0!==w&&null!==w){if(this.$items.get(z)!==w){void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,z);var E=null!==(C=null===(S=this.$changes.indexes[z])||void 0===S?void 0:S.op)&&void 0!==C?C:f.OPERATION.ADD;this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,w),this.$changes.change(z,E)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},z.prototype.deleteAt=function(f){var z=Array.from(this.$items.keys())[f];return void 0!==z&&this.$deleteAt(z)},z.prototype.$deleteAt=function(f){return this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f)},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&h.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.concat=function(){for(var f,w=[],S=0;S<arguments.length;S++)w[S]=arguments[S];return new(z.bind.apply(z,C([void 0],(f=Array.from(this.$items.values())).concat.apply(f,w),!1)))},z.prototype.join=function(f){return Array.from(this.$items.values()).join(f)},z.prototype.reverse=function(){var f=this,z=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(w,S){f.setAt(z[S],w)})),this},z.prototype.shift=function(){var f=Array.from(this.$items.keys()).shift();if(void 0!==f){var z=this.$items.get(f);return this.$deleteAt(f),z}},z.prototype.slice=function(f,w){var S=new z;return S.push.apply(S,Array.from(this.$items.values()).slice(f,w)),S},z.prototype.sort=function(f){var z=this;void 0===f&&(f=K);var w=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(f).forEach((function(f,S){z.setAt(w[S],f)})),this},z.prototype.splice=function(f,z){void 0===z&&(z=this.length-f);for(var w=Array.from(this.$items.keys()),S=[],C=f;C<f+z;C++)S.push(this.$items.get(w[C])),this.$deleteAt(w[C]);return S},z.prototype.unshift=function(){for(var f=this,z=[],w=0;w<arguments.length;w++)z[w]=arguments[w];var S=this.length,C=z.length,E=Array.from(this.$items.values());return z.forEach((function(z,w){f.setAt(w,z)})),E.forEach((function(z,w){f.setAt(C+w,z)})),S+C},z.prototype.indexOf=function(f,z){return Array.from(this.$items.values()).indexOf(f,z)},z.prototype.lastIndexOf=function(f,z){return void 0===z&&(z=this.length-1),Array.from(this.$items.values()).lastIndexOf(f,z)},z.prototype.every=function(f,z){return Array.from(this.$items.values()).every(f,z)},z.prototype.some=function(f,z){return Array.from(this.$items.values()).some(f,z)},z.prototype.forEach=function(f,z){Array.from(this.$items.values()).forEach(f,z)},z.prototype.map=function(f,z){return Array.from(this.$items.values()).map(f,z)},z.prototype.filter=function(f,z){return Array.from(this.$items.values()).filter(f,z)},z.prototype.reduce=function(f,z){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},z.prototype.reduceRight=function(f,z){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},z.prototype.find=function(f,z){return Array.from(this.$items.values()).find(f,z)},z.prototype.findIndex=function(f,z){return Array.from(this.$items.values()).findIndex(f,z)},z.prototype.fill=function(f,z,w){throw new Error("ArraySchema#fill() not implemented")},z.prototype.copyWithin=function(f,z,w){throw new Error("ArraySchema#copyWithin() not implemented")},z.prototype.toString=function(){return this.$items.toString()},z.prototype.toLocaleString=function(){return this.$items.toLocaleString()},z.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(z,Symbol.species,{get:function(){return z},enumerable:!1,configurable:!0}),z.prototype.entries=function(){return this.$items.entries()},z.prototype.keys=function(){return this.$items.keys()},z.prototype.values=function(){return this.$items.values()},z.prototype.includes=function(f,z){return Array.from(this.$items.values()).includes(f,z)},z.prototype.flatMap=function(f,z){throw new Error("ArraySchema#flatMap() is not supported.")},z.prototype.flat=function(f){throw new Error("ArraySchema#flat() is not supported.")},z.prototype.findLast=function(){var f=Array.from(this.$items.values());return f.findLast.apply(f,arguments)},z.prototype.findLastIndex=function(){var f=Array.from(this.$items.values());return f.findLastIndex.apply(f,arguments)},z.prototype.setIndex=function(f,z){this.$indexes.set(f,z)},z.prototype.getIndex=function(f){return this.$indexes.get(f)},z.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},z.prototype.deleteByIndex=function(f){var z=this.$indexes.get(f);this.$items.delete(z),this.$indexes.delete(f)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){return this.toArray().map((function(f){return"function"===typeof f.toJSON?f.toJSON():f}))},z.prototype.clone=function(f){return f?new(z.bind.apply(z,C([void 0],Array.from(this.$items.values()),!1))):new(z.bind.apply(z,C([void 0],this.map((function(f){return f.$changes?f.clone():f})),!1)))},z}();function e(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,z){return"symbol"!==typeof z&&"undefined"===typeof f[z]?f.get(z):f[z]},set:function(f,z,w){return"symbol"!==typeof z&&-1===z.indexOf("$")&&"bd"!==z&&"kd"!==z&&"onChange"!==z?f.set(z,w):f[z]=w,!0},deleteProperty:function(f,z){return f.delete(z),!0}})}var O=function(){function z(f){var w=this;if(this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f)if(f instanceof Map||f instanceof z)f.forEach((function(f,z){return w.set(z,f)}));else for(var S in f)this.set(S,f[S])}return z.prototype.bd=function(z,w){return void 0===w&&(w=!0),u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,z,w?this.$items:void 0)},z.prototype.kd=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,z)},z.is=function(f){return void 0!==f.map},z.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(z.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(z,Symbol.species,{get:function(){return z},enumerable:!1,configurable:!0}),z.prototype.set=function(z,w){if(void 0===w||null===w)throw new Error("MapSchema#set('".concat(z,"', ").concat(w,"): trying to set ").concat(w," value on '").concat(z,"'."));z=z.toString();var S="undefined"!==typeof this.$changes.indexes[z],C=S?this.$changes.indexes[z]:this.$refId++,E=S?f.OPERATION.REPLACE:f.OPERATION.ADD,F=void 0!==w.$changes;if(F&&w.$changes.setParent(this,this.$changes.root,C),S){if(!F&&this.$items.get(z)===w)return;F&&this.$items.get(z)!==w&&(E=f.OPERATION.ADD)}else this.$changes.indexes[z]=C,this.$indexes.set(C,z);return this.$items.set(z,w),this.$changes.change(z,E),this},z.prototype.get=function(f){return this.$items.get(f)},z.prototype.delete=function(f){return this.$changes.delete(f),this.$items.delete(f)},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&h.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(f){return this.$items.has(f)},z.prototype.forEach=function(f){this.$items.forEach(f)},z.prototype.entries=function(){return this.$items.entries()},z.prototype.keys=function(){return this.$items.keys()},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(f,z){this.$indexes.set(f,z)},z.prototype.getIndex=function(f){return this.$indexes.get(f)},z.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},z.prototype.deleteByIndex=function(f){var z=this.$indexes.get(f);this.$items.delete(z),this.$indexes.delete(f)},z.prototype.toJSON=function(){var f={};return this.forEach((function(z,w){f[w]="function"===typeof z.toJSON?z.toJSON():z})),f},z.prototype.clone=function(f){var w;return f?w=Object.assign(new z,this):(w=new z,this.forEach((function(f,z){f.$changes?w.set(z,f.clone()):w.set(z,f)}))),w},z}(),d={};function B(f,z){d[f]=z}function V(f){return d[f]}var W=function(){function f(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return f.create=function(z){var w=new f;return w.schema=Object.assign({},z&&z.schema||{}),w.indexes=Object.assign({},z&&z.indexes||{}),w.fieldsByIndex=Object.assign({},z&&z.fieldsByIndex||{}),w.descriptors=Object.assign({},z&&z.descriptors||{}),w.deprecated=Object.assign({},z&&z.deprecated||{}),w},f.prototype.addField=function(f,z){var w=this.getNextFieldIndex();this.fieldsByIndex[w]=f,this.indexes[f]=w,this.schema[f]=Array.isArray(z)?{array:z[0]}:z},f.prototype.hasField=function(f){return void 0!==this.indexes[f]},f.prototype.addFilter=function(f,z){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[f]]=z,this.indexesWithFilters.push(this.indexes[f]),!0},f.prototype.addChildrenFilter=function(f,z){var w=this.indexes[f],S=this.schema[f];if(V(Object.keys(S)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[w]=z,!0;console.warn("@filterChildren: field '".concat(f,"' can't have children. Ignoring filter."))},f.prototype.getChildrenFilter=function(f){return this.childFilters&&this.childFilters[this.indexes[f]]},f.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},f}();function T(f){return f._context&&f._context.useFilters}var v=function(){function f(){this.types={},this.schemas=new Map,this.useFilters=!1}return f.prototype.has=function(f){return this.schemas.has(f)},f.prototype.get=function(f){return this.types[f]},f.prototype.add=function(f,z){void 0===z&&(z=this.schemas.size),f._definition=W.create(f._definition),f._typeid=z,this.types[z]=f,this.schemas.set(f,z)},f.create=function(z){return void 0===z&&(z={}),function(w){return z.context||(z.context=new f),A(w,z)}},f}(),D=new v;function A(f,z){return void 0===z&&(z={}),function(w,S){var E=z.context||D,F=w.constructor;if(F._context=E,!f)throw new Error("".concat(F.name,': @type() reference provided for "').concat(S,"\" is undefined. Make sure you don't have any circular dependencies."));E.has(F)||E.add(F);var J=F._definition;if(J.addField(S,f),J.descriptors[S]){if(J.deprecated[S])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(S,"' definition on '").concat(F.name,"'.\nCheck @type() annotation"))}catch(d){var x=d.stack.split("\n")[4].trim();throw new Error("".concat(d.message," ").concat(x))}}var u=y.is(f),h=!u&&O.is(f);if("string"!==typeof f&&!qf.is(f)){var X=Object.values(f)[0];"string"===typeof X||E.has(X)||E.add(X)}if(z.manual)J.descriptors[S]={enumerable:!0,configurable:!0,writable:!0};else{var K="_".concat(S);J.descriptors[K]={enumerable:!1,configurable:!1,writable:!0},J.descriptors[S]={get:function(){return this[K]},set:function(f){f!==this[K]&&(void 0!==f&&null!==f?(!u||f instanceof y||(f=new(y.bind.apply(y,C([void 0],f,!1)))),!h||f instanceof O||(f=new O(f)),void 0===f.$proxy&&(h?f=e(f):u&&(f=c(f))),this.$changes.change(S),f.$changes&&f.$changes.setParent(this,this.$changes.root,this._definition.indexes[S])):this[K]&&this.$changes.delete(S),this[K]=f)},enumerable:!0,configurable:!0}}}}function M(f){return function(z,w){var S=z.constructor;S._definition.addFilter(w,f)&&(S._context.useFilters=!0)}}function G(f){return function(z,w){var S=z.constructor;S._definition.addChildrenFilter(w,f)&&(S._context.useFilters=!0)}}function I(f){return void 0===f&&(f=!0),function(z,w){var S=z.constructor._definition;S.deprecated[w]=!0,f&&(S.descriptors[w]={get:function(){throw new Error("".concat(w," is deprecated."))},set:function(f){},enumerable:!1,configurable:!0})}}function n(f,z,w){for(var S in void 0===w&&(w={}),w.context||(w.context=f._context||w.context||D),z)A(z[S],w)(f.prototype,S);return f}function P(f){for(var z=0,w=0,S=0,C=f.length;S<C;S++)(z=f.charCodeAt(S))<128?w+=1:z<2048?w+=2:z<55296||z>=57344?w+=3:(S++,w+=4);return w}function R(f,z,w){for(var S=0,C=0,E=w.length;C<E;C++)(S=w.charCodeAt(C))<128?f[z++]=S:S<2048?(f[z++]=192|S>>6,f[z++]=128|63&S):S<55296||S>=57344?(f[z++]=224|S>>12,f[z++]=128|S>>6&63,f[z++]=128|63&S):(C++,S=65536+((1023&S)<<10|1023&w.charCodeAt(C)),f[z++]=240|S>>18,f[z++]=128|S>>12&63,f[z++]=128|S>>6&63,f[z++]=128|63&S)}function q(f,z){f.push(255&z)}function a(f,z){f.push(255&z)}function s(f,z){f.push(255&z),f.push(z>>8&255)}function H(f,z){f.push(255&z),f.push(z>>8&255)}function L(f,z){f.push(255&z),f.push(z>>8&255),f.push(z>>16&255),f.push(z>>24&255)}function U(f,z){var w=z>>24,S=z>>16,C=z>>8,E=z;f.push(255&E),f.push(255&C),f.push(255&S),f.push(255&w)}function i(f,z){var w=Math.floor(z/Math.pow(2,32));U(f,z>>>0),U(f,w)}function m(f,z){var w=z/Math.pow(2,32)|0;U(f,z>>>0),U(f,w)}function r(f,z){Z(f,z)}function o(f,z){b(f,z)}var p=new Int32Array(2),Y=new Float32Array(p.buffer),t=new Float64Array(p.buffer);function Z(f,z){Y[0]=z,L(f,p[0])}function b(f,z){t[0]=z,L(f,p[0]),L(f,p[1])}function Q(f,z){return a(f,z?1:0)}function g(f,z){z||(z="");var w=P(z),S=0;if(w<32)f.push(160|w),S=1;else if(w<256)f.push(217),a(f,w),S=2;else if(w<65536)f.push(218),H(f,w),S=3;else{if(!(w<4294967296))throw new Error("String too long");f.push(219),U(f,w),S=5}return R(f,f.length,z),S+w}function k(f,z){return isNaN(z)?k(f,0):isFinite(z)?z!==(0|z)?(f.push(203),b(f,z),9):z>=0?z<128?(a(f,z),1):z<256?(f.push(204),a(f,z),2):z<65536?(f.push(205),H(f,z),3):z<4294967296?(f.push(206),U(f,z),5):(f.push(207),m(f,z),9):z>=-32?(f.push(224|z+32),1):z>=-128?(f.push(208),q(f,z),2):z>=-32768?(f.push(209),s(f,z),3):z>=-2147483648?(f.push(210),L(f,z),5):(f.push(211),i(f,z),9):k(f,z>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:R,int8:q,uint8:a,int16:s,uint16:H,int32:L,uint32:U,int64:i,uint64:m,float32:r,float64:o,writeFloat32:Z,writeFloat64:b,boolean:Q,string:g,number:k});function l(f,z,w){for(var S="",C=0,E=z,F=z+w;E<F;E++){var J=f[E];0!==(128&J)?192!==(224&J)?224!==(240&J)?240!==(248&J)?console.error("Invalid byte "+J.toString(16)):(C=(7&J)<<18|(63&f[++E])<<12|(63&f[++E])<<6|63&f[++E])>=65536?(C-=65536,S+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):S+=String.fromCharCode(C):S+=String.fromCharCode((15&J)<<12|(63&f[++E])<<6|63&f[++E]):S+=String.fromCharCode((31&J)<<6|63&f[++E]):S+=String.fromCharCode(J)}return S}function N(f,z){return ff(f,z)<<24>>24}function ff(f,z){return f[z.offset++]}function zf(f,z){return wf(f,z)<<16>>16}function wf(f,z){return f[z.offset++]|f[z.offset++]<<8}function Sf(f,z){return f[z.offset++]|f[z.offset++]<<8|f[z.offset++]<<16|f[z.offset++]<<24}function Cf(f,z){return Sf(f,z)>>>0}function Ef(f,z){return Kf(f,z)}function Ff(f,z){return cf(f,z)}function Jf(f,z){var w=Cf(f,z);return Sf(f,z)*Math.pow(2,32)+w}function xf(f,z){var w=Cf(f,z);return Cf(f,z)*Math.pow(2,32)+w}var uf=new Int32Array(2),hf=new Float32Array(uf.buffer),Xf=new Float64Array(uf.buffer);function Kf(f,z){return uf[0]=Sf(f,z),hf[0]}function cf(f,z){return uf[0]=Sf(f,z),uf[1]=Sf(f,z),Xf[0]}function yf(f,z){return ff(f,z)>0}function ef(f,z){var w,S=f[z.offset++];S<192?w=31&S:217===S?w=ff(f,z):218===S?w=wf(f,z):219===S&&(w=Cf(f,z));var C=l(f,z.offset,w);return z.offset+=w,C}function Of(f,z){var w=f[z.offset];return w<192&&w>160||217===w||218===w||219===w}function df(f,z){var w=f[z.offset++];return w<128?w:202===w?Kf(f,z):203===w?cf(f,z):204===w?ff(f,z):205===w?wf(f,z):206===w?Cf(f,z):207===w?xf(f,z):208===w?N(f,z):209===w?zf(f,z):210===w?Sf(f,z):211===w?Jf(f,z):w>223?-1*(255-w+1):void 0}function Bf(f,z){var w=f[z.offset];return w<128||w>=202&&w<=211}function Vf(f,z){return f[z.offset]<160}function Wf(f,z){return f[z.offset-1]===F&&(f[z.offset]<128||f[z.offset]>=202&&f[z.offset]<=211)}var Tf=Object.freeze({__proto__:null,int8:N,uint8:ff,int16:zf,uint16:wf,int32:Sf,uint32:Cf,float32:Ef,float64:Ff,int64:Jf,uint64:xf,readFloat32:Kf,readFloat64:cf,boolean:yf,string:ef,stringCheck:Of,number:df,numberCheck:Bf,arrayCheck:Vf,switchStructureCheck:Wf}),vf=function(){function z(f){var z=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return z.add(f)}))}return z.prototype.bd=function(z,w){return void 0===w&&(w=!0),u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,z,w?this.$items:void 0)},z.prototype.kd=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,z)},z.is=function(f){return void 0!==f.collection},z.prototype.add=function(f){var z=this.$refId++;return void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,z),this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,f),this.$changes.change(z),z},z.prototype.at=function(f){var z=Array.from(this.$items.keys())[f];return this.$items.get(z)},z.prototype.entries=function(){return this.$items.entries()},z.prototype.delete=function(f){for(var z,w,S=this.$items.entries();(w=S.next())&&!w.done;)if(f===w.value[1]){z=w.value[0];break}return void 0!==z&&(this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z))},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&h.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(f){return Array.from(this.$items.values()).some((function(z){return z===f}))},z.prototype.forEach=function(f){var z=this;this.$items.forEach((function(w,S,C){return f(w,S,z)}))},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(f,z){this.$indexes.set(f,z)},z.prototype.getIndex=function(f){return this.$indexes.get(f)},z.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},z.prototype.deleteByIndex=function(f){var z=this.$indexes.get(f);this.$items.delete(z),this.$indexes.delete(f)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){var f=[];return this.forEach((function(z,w){f.push("function"===typeof z.toJSON?z.toJSON():z)})),f},z.prototype.clone=function(f){var w;return f?w=Object.assign(new z,this):(w=new z,this.forEach((function(f){f.$changes?w.add(f.clone()):w.add(f)}))),w},z}(),Df=function(){function z(f){var z=this;this.$changes=new x(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return z.add(f)}))}return z.prototype.bd=function(z,w){return void 0===w&&(w=!0),u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,z,w?this.$items:void 0)},z.prototype.kd=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,z)},z.is=function(f){return void 0!==f.set},z.prototype.add=function(z){var w,S;if(this.has(z))return!1;var C=this.$refId++;void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,C);var E=null!==(S=null===(w=this.$changes.indexes[C])||void 0===w?void 0:w.op)&&void 0!==S?S:f.OPERATION.ADD;return this.$changes.indexes[C]=C,this.$indexes.set(C,C),this.$items.set(C,z),this.$changes.change(C,E),C},z.prototype.entries=function(){return this.$items.entries()},z.prototype.delete=function(f){for(var z,w,S=this.$items.entries();(w=S.next())&&!w.done;)if(f===w.value[1]){z=w.value[0];break}return void 0!==z&&(this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z))},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&h.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(f){for(var z,w=this.$items.values(),S=!1;(z=w.next())&&!z.done;)if(f===z.value){S=!0;break}return S},z.prototype.forEach=function(f){var z=this;this.$items.forEach((function(w,S,C){return f(w,S,z)}))},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(f,z){this.$indexes.set(f,z)},z.prototype.getIndex=function(f){return this.$indexes.get(f)},z.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},z.prototype.deleteByIndex=function(f){var z=this.$indexes.get(f);this.$items.delete(z),this.$indexes.delete(f)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){var f=[];return this.forEach((function(z,w){f.push("function"===typeof z.toJSON?z.toJSON():z)})),f},z.prototype.clone=function(f){var w;return f?w=Object.assign(new z,this):(w=new z,this.forEach((function(f){f.$changes?w.add(f.clone()):w.add(f)}))),w},z}(),Af=function(){function f(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return f.prototype.addRefId=function(f){this.refIds.has(f)||(this.refIds.add(f),this.containerIndexes.set(f,new Set))},f.get=function(z){return void 0===z.$filterState&&(z.$filterState=new f),z.$filterState},f}(),Mf=function(){function f(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return f.prototype.getNextUniqueId=function(){return this.nextUniqueId++},f.prototype.addRef=function(f,z,w){void 0===w&&(w=!0),this.refs.set(f,z),w&&(this.refCounts[f]=(this.refCounts[f]||0)+1)},f.prototype.removeRef=function(f){this.refCounts[f]=this.refCounts[f]-1,this.deletedRefs.add(f)},f.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},f.prototype.garbageCollectDeletedRefs=function(){var f=this;this.deletedRefs.forEach((function(z){if(!(f.refCounts[z]>0)){var w=f.refs.get(z);if(w instanceof qf)for(var S in w._definition.schema)"string"!==typeof w._definition.schema[S]&&w[S]&&w[S].$changes&&f.removeRef(w[S].$changes.refId);else{var C=w.$changes.parent._definition,E=C.schema[C.fieldsByIndex[w.$changes.parentIndex]];"function"===typeof Object.values(E)[0]&&Array.from(w.values()).forEach((function(z){return f.removeRef(z.$changes.refId)}))}f.refs.delete(z),delete f.refCounts[z]}})),this.deletedRefs.clear()},f}(),Gf=function(f){function z(){return null!==f&&f.apply(this,arguments)||this}return w(z,f),z}(Error);function If(f,z,w,S){var C,E=!1;switch(z){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":C="number",isNaN(f)&&console.log('trying to encode "NaN" in '.concat(w.constructor.name,"#").concat(S));break;case"string":C="string",E=!0;break;case"boolean":return}if(typeof f!==C&&(!E||E&&null!==f)){var F="'".concat(JSON.stringify(f),"'").concat(f&&f.constructor&&" (".concat(f.constructor.name,")")||"");throw new Gf("a '".concat(C,"' was expected, but ").concat(F," was provided in ").concat(w.constructor.name,"#").concat(S))}}function nf(f,z,w,S){if(!(f instanceof z))throw new Gf("a '".concat(z.name,"' was expected, but '").concat(f.constructor.name,"' was provided in ").concat(w.constructor.name,"#").concat(S))}function Pf(f,z,w,S,C){If(w,f,S,C);var E=j[f];if(!E)throw new Gf("a '".concat(f,"' was expected, but ").concat(w," was provided in ").concat(S.constructor.name,"#").concat(C));E(z,w)}function Rf(f,z,w){return Tf[f](z,w)}var qf=function(){function z(){for(var f=[],z=0;z<arguments.length;z++)f[z]=arguments[z];Object.defineProperties(this,{$changes:{value:new x(this,void 0,new Mf),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var w=this._definition.descriptors;w&&Object.defineProperties(this,w),f[0]&&this.assign(f[0])}return z.onError=function(f){console.error(f)},z.is=function(f){return f._definition&&void 0!==f._definition.schema},z.prototype.onChange=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,z)},z.prototype.kd=function(z){return u(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,z)},z.prototype.assign=function(f){return Object.assign(this,f),this},Object.defineProperty(z.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),z.prototype.setDirty=function(f,z){this.$changes.change(f,z)},z.prototype.listen=function(f,z,w){var S=this;return void 0===w&&(w=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[f]||(this.$callbacks[f]=[]),this.$callbacks[f].push(z),w&&void 0!==this[f]&&z(this[f],void 0),function(){return X(S.$callbacks[f],S.$callbacks[f].indexOf(z))}},z.prototype.decode=function(w,S,C){var E;void 0===S&&(S={offset:0}),void 0===C&&(C=this);var J=[],x=this.$changes.root,u=w.length,h=0;for(x.refs.set(h,this);S.offset<u;){var X=w[S.offset++];if(X!=F){var K=C.$changes,c=void 0!==C._definition,e=c?X>>6<<6:X;if(e!==f.OPERATION.CLEAR){var d=c?X%(e||255):df(w,S),B=c?C._definition.fieldsByIndex[d]:"",W=K.getType(d),T=void 0,v=void 0,D=void 0;if(c?v=C["_".concat(B)]:(v=C.getByIndex(d),(e&f.OPERATION.ADD)===f.OPERATION.ADD?(D=C instanceof O?ef(w,S):d,C.setIndex(d,D)):D=C.getIndex(d)),(e&f.OPERATION.DELETE)===f.OPERATION.DELETE&&(e!==f.OPERATION.DELETE_AND_ADD&&C.deleteByIndex(d),v&&v.$changes&&x.removeRef(v.$changes.refId),T=null),void 0!==B){if(e===f.OPERATION.DELETE);else if(z.is(W)){var A=df(w,S);if(T=x.refs.get(A),e!==f.OPERATION.REPLACE){var M=this.getSchemaType(w,S,W);T||((T=this.createTypeInstance(M)).$changes.refId=A,v&&(T.$callbacks=v.$callbacks,v.$changes.refId&&A!==v.$changes.refId&&x.removeRef(v.$changes.refId))),x.addRef(A,T,T!==v)}}else if("string"===typeof W)T=Rf(W,w,S);else{var G=V(Object.keys(W)[0]),I=df(w,S),n=x.refs.has(I)?v||x.refs.get(I):new G.constructor;if((T=n.clone(!0)).$changes.refId=I,v&&(T.$callbacks=v.$callbacks,v.$changes.refId&&I!==v.$changes.refId)){x.removeRef(v.$changes.refId);for(var P=v.entries(),R=void 0;(R=P.next())&&!R.done;){var q=(E=R.value)[0],a=E[1];J.push({refId:I,op:f.OPERATION.DELETE,field:q,value:void 0,previousValue:a})}}x.addRef(I,T,n!==v)}if(null!==T&&void 0!==T)if(T.$changes&&T.$changes.setParent(K.ref,K.root,d),C instanceof z)C[B]=T;else if(C instanceof O)q=D,C.$items.set(q,T),C.$changes.allChanges.add(d);else if(C instanceof y)C.setAt(d,T);else if(C instanceof vf){var s=C.add(T);C.setIndex(d,s)}else C instanceof Df&&!1!==(s=C.add(T))&&C.setIndex(d,s);v!==T&&J.push({refId:h,op:e,field:B,dynamicIndex:D,value:T,previousValue:v})}else{console.warn("@colyseus/schema: definition mismatch");for(var H={offset:S.offset};S.offset<u&&(!Wf(w,S)||(H.offset=S.offset+1,!x.refs.has(df(w,H))));)S.offset++}}else C.clear(J)}else{h=df(w,S);var L=x.refs.get(h);if(!L)throw new Error('"refId" not found: '.concat(h));C=L}}return this._triggerChanges(J),x.garbageCollectDeletedRefs(),J},z.prototype.encode=function(w,S,C){void 0===w&&(w=!1),void 0===S&&(S=[]),void 0===C&&(C=!1);for(var E=this.$changes,J=new WeakSet,x=[E],u=1,h=0;h<u;h++){var X=x[h],K=X.ref,c=K instanceof z;X.ensureRefId(),J.add(X),X!==E&&(X.changed||w)&&(a(S,F),k(S,X.refId));for(var y=w?Array.from(X.allChanges):Array.from(X.changes.values()),e=0,d=y.length;e<d;e++){var B=w?{op:f.OPERATION.ADD,index:y[e]}:y[e],W=B.index,T=c?K._definition.fieldsByIndex&&K._definition.fieldsByIndex[W]:W,v=S.length;if(B.op!==f.OPERATION.TOUCH)if(c)a(S,W|B.op);else{if(a(S,B.op),B.op===f.OPERATION.CLEAR)continue;k(S,W)}if(c||(B.op&f.OPERATION.ADD)!=f.OPERATION.ADD||K instanceof O&&g(S,X.ref.$indexes.get(W)),B.op!==f.OPERATION.DELETE){var D=X.getType(W),A=X.getValue(W);if(A&&A.$changes&&!J.has(A.$changes)&&(x.push(A.$changes),A.$changes.ensureRefId(),u++),B.op!==f.OPERATION.TOUCH){if(z.is(D))nf(A,D,K,T),k(S,A.$changes.refId),(B.op&f.OPERATION.ADD)===f.OPERATION.ADD&&this.tryEncodeTypeId(S,D,A.constructor);else if("string"===typeof D)Pf(D,S,A,K,T);else{var M=V(Object.keys(D)[0]);nf(K["_".concat(T)],M.constructor,K,T),k(S,A.$changes.refId)}C&&X.cache(W,S.slice(v))}}}w||C||X.discard()}return S},z.prototype.encodeAll=function(f){return this.encode(!0,[],f)},z.prototype.applyFilters=function(w,S){var C,E;void 0===S&&(S=!1);for(var J=this,x=new Set,u=Af.get(w),h=[this.$changes],X=1,K=[],c=function(c){var y=h[c];if(x.has(y.refId))return"continue";var e=y.ref,d=e instanceof z;a(K,F),k(K,y.refId);var B=u.refIds.has(y),V=S||!B;u.addRefId(y);var W=u.containerIndexes.get(y),T=V?Array.from(y.allChanges):Array.from(y.changes.values());!S&&d&&e._definition.indexesWithFilters&&e._definition.indexesWithFilters.forEach((function(z){!W.has(z)&&y.allChanges.has(z)&&(V?T.push(z):T.push({op:f.OPERATION.ADD,index:z}))}));for(var v=0,D=T.length;v<D;v++){var A=V?{op:f.OPERATION.ADD,index:T[v]}:T[v];if(A.op!==f.OPERATION.CLEAR){var M=A.index;if(A.op!==f.OPERATION.DELETE){var G=y.getValue(M),I=y.getType(M);if(d){if((n=e._definition.filters&&e._definition.filters[M])&&!n.call(e,w,G,J)){G&&G.$changes&&x.add(G.$changes.refId);continue}}else{var n,P=y.parent;if((n=y.getChildrenFilter())&&!n.call(P,w,e.$indexes.get(M),G,J)){G&&G.$changes&&x.add(G.$changes.refId);continue}}if(G.$changes&&(h.push(G.$changes),X++),A.op!==f.OPERATION.TOUCH)if(A.op===f.OPERATION.ADD||d)K.push.apply(K,null!==(C=y.caches[M])&&void 0!==C?C:[]),W.add(M);else if(W.has(M))K.push.apply(K,null!==(E=y.caches[M])&&void 0!==E?E:[]);else{if(W.add(M),a(K,f.OPERATION.ADD),k(K,M),e instanceof O){var R=y.ref.$indexes.get(M);g(K,R)}G.$changes?k(K,G.$changes.refId):j[I](K,G)}else G.$changes&&!d&&(a(K,f.OPERATION.ADD),k(K,M),e instanceof O&&(R=y.ref.$indexes.get(M),g(K,R)),k(K,G.$changes.refId))}else d?a(K,A.op|M):(a(K,A.op),k(K,M))}else a(K,A.op)}},y=0;y<X;y++)c(y);return K},z.prototype.clone=function(){var f,z=new this.constructor,w=this._definition.schema;for(var S in w)"object"===typeof this[S]&&"function"===typeof(null===(f=this[S])||void 0===f?void 0:f.clone)?z[S]=this[S].clone():z[S]=this[S];return z},z.prototype.toJSON=function(){var f=this._definition.schema,z=this._definition.deprecated,w={};for(var S in f)z[S]||null===this[S]||"undefined"===typeof this[S]||(w[S]="function"===typeof this[S].toJSON?this[S].toJSON():this["_".concat(S)]);return w},z.prototype.discardAllChanges=function(){this.$changes.discardAll()},z.prototype.getByIndex=function(f){return this[this._definition.fieldsByIndex[f]]},z.prototype.deleteByIndex=function(f){this[this._definition.fieldsByIndex[f]]=void 0},z.prototype.tryEncodeTypeId=function(f,z,w){z._typeid!==w._typeid&&(a(f,J),k(f,w._typeid))},z.prototype.getSchemaType=function(f,z,w){var S;return f[z.offset]===J&&(z.offset++,S=this.constructor._context.get(df(f,z))),S||w},z.prototype.createTypeInstance=function(f){var z=new f;return z.$changes.root=this.$changes.root,z},z.prototype._triggerChanges=function(w){for(var S,C,E,F,J,x,u,h,X,K=new Set,c=this.$changes.root.refs,y=function(y){var e=w[y],O=e.refId,d=c.get(O),B=d.$callbacks;if((e.op&f.OPERATION.DELETE)===f.OPERATION.DELETE&&e.previousValue instanceof z&&(null===(C=null===(S=e.previousValue.$callbacks)||void 0===S?void 0:S[f.OPERATION.DELETE])||void 0===C||C.forEach((function(f){return f()}))),!B)return"continue";if(d instanceof z){if(!K.has(O))try{null===(E=null===B||void 0===B?void 0:B[f.OPERATION.REPLACE])||void 0===E||E.forEach((function(f){return f()}))}catch(V){z.onError(V)}try{B.hasOwnProperty(e.field)&&(null===(F=B[e.field])||void 0===F||F.forEach((function(f){return f(e.value,e.previousValue)})))}catch(V){z.onError(V)}}else e.op===f.OPERATION.ADD&&void 0===e.previousValue?null===(J=B[f.OPERATION.ADD])||void 0===J||J.forEach((function(f){var z;return f(e.value,null!==(z=e.dynamicIndex)&&void 0!==z?z:e.field)})):e.op===f.OPERATION.DELETE?void 0!==e.previousValue&&(null===(x=B[f.OPERATION.DELETE])||void 0===x||x.forEach((function(f){var z;return f(e.previousValue,null!==(z=e.dynamicIndex)&&void 0!==z?z:e.field)}))):e.op===f.OPERATION.DELETE_AND_ADD&&(void 0!==e.previousValue&&(null===(u=B[f.OPERATION.DELETE])||void 0===u||u.forEach((function(f){var z;return f(e.previousValue,null!==(z=e.dynamicIndex)&&void 0!==z?z:e.field)}))),null===(h=B[f.OPERATION.ADD])||void 0===h||h.forEach((function(f){var z;return f(e.value,null!==(z=e.dynamicIndex)&&void 0!==z?z:e.field)}))),e.value!==e.previousValue&&(null===(X=B[f.OPERATION.REPLACE])||void 0===X||X.forEach((function(f){var z;return f(e.value,null!==(z=e.dynamicIndex)&&void 0!==z?z:e.field)})));K.add(O)},e=0;e<w.length;e++)y(e)},z._definition=W.create(),z}();function af(f){for(var z=[f.$changes],w=1,S={},C=S,E=function(f){var w=z[f];w.changes.forEach((function(f){var z=w.ref,S=f.index,E=z._definition?z._definition.fieldsByIndex[S]:z.$indexes.get(S);C[E]=w.getValue(S)}))},F=0;F<w;F++)E(F);return S}var sf={context:new v},Hf=function(f){function z(){return null!==f&&f.apply(this,arguments)||this}return w(z,f),S([A("string",sf)],z.prototype,"name",void 0),S([A("string",sf)],z.prototype,"type",void 0),S([A("number",sf)],z.prototype,"referencedType",void 0),z}(qf),Lf=function(f){function z(){var z=null!==f&&f.apply(this,arguments)||this;return z.fields=new y,z}return w(z,f),S([A("number",sf)],z.prototype,"id",void 0),S([A([Hf],sf)],z.prototype,"fields",void 0),z}(qf),Uf=function(f){function z(){var z=null!==f&&f.apply(this,arguments)||this;return z.types=new y,z}return w(z,f),z.encode=function(f){var w=f.constructor,S=new z;S.rootType=w._typeid;var C=function(f,z){for(var w in z){var C=new Hf;C.name=w;var E=void 0;if("string"===typeof z[w])E=z[w];else{var F=z[w],J=void 0;qf.is(F)?(E="ref",J=z[w]):"string"===typeof F[E=Object.keys(F)[0]]?E+=":"+F[E]:J=F[E],C.referencedType=J?J._typeid:-1}C.type=E,f.fields.push(C)}S.types.push(f)},E=w._context.types;for(var F in E){var J=new Lf;J.id=Number(F),C(J,E[F]._definition.schema)}return S.encodeAll()},z.decode=function(f,S){var C=new v,E=new z;E.decode(f,S);var F=E.types.reduce((function(f,z){var S=function(f){function z(){return null!==f&&f.apply(this,arguments)||this}return w(z,f),z}(qf),E=z.id;return f[E]=S,C.add(S,E),f}),{});E.types.forEach((function(f){var z=F[f.id];f.fields.forEach((function(f){var w;if(void 0!==f.referencedType){var S=f.type,E=F[f.referencedType];if(!E){var J=f.type.split(":");S=J[0],E=J[1]}"ref"===S?A(E,{context:C})(z.prototype,f.name):A(((w={})[S]=E,w),{context:C})(z.prototype,f.name)}else A(f.type,{context:C})(z.prototype,f.name)}))}));var J=F[E.rootType],x=new J;for(var u in J._definition.schema){var h=J._definition.schema[u];"string"!==typeof h&&(x[u]="function"===typeof h?new h:new(V(Object.keys(h)[0]).constructor))}return x},S([A([Lf],sf)],z.prototype,"types",void 0),S([A("number",sf)],z.prototype,"rootType",void 0),z}(qf);B("map",{constructor:O}),B("array",{constructor:y}),B("set",{constructor:Df}),B("collection",{constructor:vf}),f.ArraySchema=y,f.CollectionSchema=vf,f.Context=v,f.MapSchema=O,f.Reflection=Uf,f.ReflectionField=Hf,f.ReflectionType=Lf,f.Schema=qf,f.SchemaDefinition=W,f.SetSchema=Df,f.decode=Tf,f.defineTypes=n,f.deprecated=I,f.dumpChanges=af,f.encode=j,f.filter=M,f.filterChildren=G,f.hasFilter=T,f.registerType=B,f.type=A,Object.defineProperty(f,"__esModule",{value:!0})}(z)},12841:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12835:(f,z,w)=>{var S=w(12841),C=w(12850),E=Object.hasOwnProperty,F=Object.create(null);for(var J in S)E.call(S,J)&&(F[S[J]]=J);var x=f.exports={to:{},get:{}};function u(f,z,w){return Math.min(Math.max(z,f),w)}function h(f){var z=Math.round(f).toString(16).toUpperCase();return z.length<2?"0"+z:z}x.get=function(f){var z,w;switch(f.substring(0,3).toLowerCase()){case"hsl":z=x.get.hsl(f),w="hsl";break;case"hwb":z=x.get.hwb(f),w="hwb";break;default:z=x.get.rgb(f),w="rgb"}return z?{model:w,value:z}:null},x.get.rgb=function(f){if(!f)return null;var z,w,C,F=[0,0,0,1];if(z=f.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(C=z[2],z=z[1],w=0;w<3;w++){var J=2*w;F[w]=parseInt(z.slice(J,J+2),16)}C&&(F[3]=parseInt(C,16)/255)}else if(z=f.match(/^#([a-f0-9]{3,4})$/i)){for(C=(z=z[1])[3],w=0;w<3;w++)F[w]=parseInt(z[w]+z[w],16);C&&(F[3]=parseInt(C+C,16)/255)}else if(z=f.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(w=0;w<3;w++)F[w]=parseInt(z[w+1],0);z[4]&&(z[5]?F[3]=.01*parseFloat(z[4]):F[3]=parseFloat(z[4]))}else{if(!(z=f.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(z=f.match(/^(\w+)$/))?"transparent"===z[1]?[0,0,0,0]:E.call(S,z[1])?((F=S[z[1]])[3]=1,F):null:null;for(w=0;w<3;w++)F[w]=Math.round(2.55*parseFloat(z[w+1]));z[4]&&(z[5]?F[3]=.01*parseFloat(z[4]):F[3]=parseFloat(z[4]))}for(w=0;w<3;w++)F[w]=u(F[w],0,255);return F[3]=u(F[3],0,1),F},x.get.hsl=function(f){if(!f)return null;var z=f.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(z){var w=parseFloat(z[4]);return[(parseFloat(z[1])%360+360)%360,u(parseFloat(z[2]),0,100),u(parseFloat(z[3]),0,100),u(isNaN(w)?1:w,0,1)]}return null},x.get.hwb=function(f){if(!f)return null;var z=f.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(z){var w=parseFloat(z[4]);return[(parseFloat(z[1])%360+360)%360,u(parseFloat(z[2]),0,100),u(parseFloat(z[3]),0,100),u(isNaN(w)?1:w,0,1)]}return null},x.to.hex=function(){var f=C(arguments);return"#"+h(f[0])+h(f[1])+h(f[2])+(f[3]<1?h(Math.round(255*f[3])):"")},x.to.rgb=function(){var f=C(arguments);return f.length<4||1===f[3]?"rgb("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+")":"rgba("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+", "+f[3]+")"},x.to.rgb.percent=function(){var f=C(arguments),z=Math.round(f[0]/255*100),w=Math.round(f[1]/255*100),S=Math.round(f[2]/255*100);return f.length<4||1===f[3]?"rgb("+z+"%, "+w+"%, "+S+"%)":"rgba("+z+"%, "+w+"%, "+S+"%, "+f[3]+")"},x.to.hsl=function(){var f=C(arguments);return f.length<4||1===f[3]?"hsl("+f[0]+", "+f[1]+"%, "+f[2]+"%)":"hsla("+f[0]+", "+f[1]+"%, "+f[2]+"%, "+f[3]+")"},x.to.hwb=function(){var f=C(arguments),z="";return f.length>=4&&1!==f[3]&&(z=", "+f[3]),"hwb("+f[0]+", "+f[1]+"%, "+f[2]+"%"+z+")"},x.to.keyword=function(f){return F[f.slice(0,3)]}},12830:(f,z,w)=>{const S=w(12835),C=w(12858),E=["keyword","gray","hex"],F={};for(const c of Object.keys(C))F[[...C[c].labels].sort().join("")]=c;const J={};function x(f,z){if(!(this instanceof x))return new x(f,z);if(z&&z in E&&(z=null),z&&!(z in C))throw new Error("Unknown model: "+z);let w,u;if(null==f)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(f instanceof x)this.model=f.model,this.color=[...f.color],this.valpha=f.valpha;else if("string"===typeof f){const z=S.get(f);if(null===z)throw new Error("Unable to parse color from string: "+f);this.model=z.model,u=C[this.model].channels,this.color=z.value.slice(0,u),this.valpha="number"===typeof z.value[u]?z.value[u]:1}else if(f.length>0){this.model=z||"rgb",u=C[this.model].channels;const w=Array.prototype.slice.call(f,0,u);this.color=K(w,u),this.valpha="number"===typeof f[u]?f[u]:1}else if("number"===typeof f)this.model="rgb",this.color=[f>>16&255,f>>8&255,255&f],this.valpha=1;else{this.valpha=1;const z=Object.keys(f);"alpha"in f&&(z.splice(z.indexOf("alpha"),1),this.valpha="number"===typeof f.alpha?f.alpha:0);const S=z.sort().join("");if(!(S in F))throw new Error("Unable to parse color from object: "+JSON.stringify(f));this.model=F[S];const{labels:E}=C[this.model],J=[];for(w=0;w<E.length;w++)J.push(f[E[w]]);this.color=K(J)}if(J[this.model])for(u=C[this.model].channels,w=0;w<u;w++){const f=J[this.model][w];f&&(this.color[w]=f(this.color[w]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}x.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(f){let z=this.model in S.to?this:this.rgb();z=z.round("number"===typeof f?f:1);const w=1===z.valpha?z.color:[...z.color,this.valpha];return S.to[z.model](w)},percentString(f){const z=this.rgb().round("number"===typeof f?f:1),w=1===z.valpha?z.color:[...z.color,this.valpha];return S.to.rgb.percent(w)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const f={},{channels:z}=C[this.model],{labels:w}=C[this.model];for(let S=0;S<z;S++)f[w[S]]=this.color[S];return 1!==this.valpha&&(f.alpha=this.valpha),f},unitArray(){const f=this.rgb().color;return f[0]/=255,f[1]/=255,f[2]/=255,1!==this.valpha&&f.push(this.valpha),f},unitObject(){const f=this.rgb().object();return f.r/=255,f.g/=255,f.b/=255,1!==this.valpha&&(f.alpha=this.valpha),f},round(f){return f=Math.max(f||0,0),new x([...this.color.map(u(f)),this.valpha],this.model)},alpha(f){return void 0!==f?new x([...this.color,Math.max(0,Math.min(1,f))],this.model):this.valpha},red:h("rgb",0,X(255)),green:h("rgb",1,X(255)),blue:h("rgb",2,X(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(f=>(f%360+360)%360)),saturationl:h("hsl",1,X(100)),lightness:h("hsl",2,X(100)),saturationv:h("hsv",1,X(100)),value:h("hsv",2,X(100)),chroma:h("hcg",1,X(100)),gray:h("hcg",2,X(100)),white:h("hwb",1,X(100)),wblack:h("hwb",2,X(100)),cyan:h("cmyk",0,X(100)),magenta:h("cmyk",1,X(100)),yellow:h("cmyk",2,X(100)),black:h("cmyk",3,X(100)),x:h("xyz",0,X(95.047)),y:h("xyz",1,X(100)),z:h("xyz",2,X(108.833)),l:h("lab",0,X(100)),a:h("lab",1),b:h("lab",2),keyword(f){return void 0!==f?new x(f):C[this.model].keyword(this.color)},hex(f){return void 0!==f?new x(f):S.to.hex(this.rgb().round().color)},hexa(f){if(void 0!==f)return new x(f);const z=this.rgb().round().color;let w=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===w.length&&(w="0"+w),S.to.hex(z)+w},rgbNumber(){const f=this.rgb().color;return(255&f[0])<<16|(255&f[1])<<8|255&f[2]},luminosity(){const f=this.rgb().color,z=[];for(const[w,S]of f.entries()){const f=S/255;z[w]=f<=.04045?f/12.92:((f+.055)/1.055)**2.4}return.2126*z[0]+.7152*z[1]+.0722*z[2]},contrast(f){const z=this.luminosity(),w=f.luminosity();return z>w?(z+.05)/(w+.05):(w+.05)/(z+.05)},level(f){const z=this.contrast(f);return z>=7?"AAA":z>=4.5?"AA":""},isDark(){const f=this.rgb().color;return(2126*f[0]+7152*f[1]+722*f[2])/1e4<128},isLight(){return!this.isDark()},negate(){const f=this.rgb();for(let z=0;z<3;z++)f.color[z]=255-f.color[z];return f},lighten(f){const z=this.hsl();return z.color[2]+=z.color[2]*f,z},darken(f){const z=this.hsl();return z.color[2]-=z.color[2]*f,z},saturate(f){const z=this.hsl();return z.color[1]+=z.color[1]*f,z},desaturate(f){const z=this.hsl();return z.color[1]-=z.color[1]*f,z},whiten(f){const z=this.hwb();return z.color[1]+=z.color[1]*f,z},blacken(f){const z=this.hwb();return z.color[2]+=z.color[2]*f,z},grayscale(){const f=this.rgb().color,z=.3*f[0]+.59*f[1]+.11*f[2];return x.rgb(z,z,z)},fade(f){return this.alpha(this.valpha-this.valpha*f)},opaquer(f){return this.alpha(this.valpha+this.valpha*f)},rotate(f){const z=this.hsl();let w=z.color[0];return w=(w+f)%360,w=w<0?360+w:w,z.color[0]=w,z},mix(f,z){if(!f||!f.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof f);const w=f.rgb(),S=this.rgb(),C=void 0===z?.5:z,E=2*C-1,F=w.alpha()-S.alpha(),J=((E*F===-1?E:(E+F)/(1+E*F))+1)/2,u=1-J;return x.rgb(J*w.red()+u*S.red(),J*w.green()+u*S.green(),J*w.blue()+u*S.blue(),w.alpha()*C+S.alpha()*(1-C))}};for(const c of Object.keys(C)){if(E.includes(c))continue;const{channels:f}=C[c];x.prototype[c]=function(){if(this.model===c)return new x(this);for(var f=arguments.length,z=new Array(f),w=0;w<f;w++)z[w]=arguments[w];return z.length>0?new x(z,c):new x([...(S=C[this.model][c].raw(this.color),Array.isArray(S)?S:[S]),this.valpha],c);var S},x[c]=function(){for(var z=arguments.length,w=new Array(z),S=0;S<z;S++)w[S]=arguments[S];let C=w[0];return"number"===typeof C&&(C=K(w,f)),new x(C,c)}}function u(f){return function(z){return function(f,z){return Number(f.toFixed(z))}(z,f)}}function h(f,z,w){f=Array.isArray(f)?f:[f];for(const S of f)(J[S]||(J[S]=[]))[z]=w;return f=f[0],function(S){let C;return void 0!==S?(w&&(S=w(S)),C=this[f](),C.color[z]=S,C):(C=this[f]().color[z],w&&(C=w(C)),C)}}function X(f){return function(z){return Math.max(0,Math.min(f,z))}}function K(f,z){for(let w=0;w<z;w++)"number"!==typeof f[w]&&(f[w]=0);return f}f.exports=x},12866:(f,z,w)=>{const S=w(12869),C={};for(const F of Object.keys(S))C[S[F]]=F;const E={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};f.exports=E;for(const F of Object.keys(E)){if(!("channels"in E[F]))throw new Error("missing channels property: "+F);if(!("labels"in E[F]))throw new Error("missing channel labels property: "+F);if(E[F].labels.length!==E[F].channels)throw new Error("channel and label counts mismatch: "+F);const{channels:f,labels:z}=E[F];delete E[F].channels,delete E[F].labels,Object.defineProperty(E[F],"channels",{value:f}),Object.defineProperty(E[F],"labels",{value:z})}E.rgb.hsl=function(f){const z=f[0]/255,w=f[1]/255,S=f[2]/255,C=Math.min(z,w,S),E=Math.max(z,w,S),F=E-C;let J,x;E===C?J=0:z===E?J=(w-S)/F:w===E?J=2+(S-z)/F:S===E&&(J=4+(z-w)/F),J=Math.min(60*J,360),J<0&&(J+=360);const u=(C+E)/2;return x=E===C?0:u<=.5?F/(E+C):F/(2-E-C),[J,100*x,100*u]},E.rgb.hsv=function(f){let z,w,S,C,E;const F=f[0]/255,J=f[1]/255,x=f[2]/255,u=Math.max(F,J,x),h=u-Math.min(F,J,x),X=function(f){return(u-f)/6/h+.5};return 0===h?(C=0,E=0):(E=h/u,z=X(F),w=X(J),S=X(x),F===u?C=S-w:J===u?C=1/3+z-S:x===u&&(C=2/3+w-z),C<0?C+=1:C>1&&(C-=1)),[360*C,100*E,100*u]},E.rgb.hwb=function(f){const z=f[0],w=f[1];let S=f[2];const C=E.rgb.hsl(f)[0],F=1/255*Math.min(z,Math.min(w,S));return S=1-1/255*Math.max(z,Math.max(w,S)),[C,100*F,100*S]},E.rgb.cmyk=function(f){const z=f[0]/255,w=f[1]/255,S=f[2]/255,C=Math.min(1-z,1-w,1-S);return[100*((1-z-C)/(1-C)||0),100*((1-w-C)/(1-C)||0),100*((1-S-C)/(1-C)||0),100*C]},E.rgb.keyword=function(f){const z=C[f];if(z)return z;let w,E=1/0;for(const C of Object.keys(S)){const z=S[C],x=(J=z,((F=f)[0]-J[0])**2+(F[1]-J[1])**2+(F[2]-J[2])**2);x<E&&(E=x,w=C)}var F,J;return w},E.keyword.rgb=function(f){return S[f]},E.rgb.xyz=function(f){let z=f[0]/255,w=f[1]/255,S=f[2]/255;z=z>.04045?((z+.055)/1.055)**2.4:z/12.92,w=w>.04045?((w+.055)/1.055)**2.4:w/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92;return[100*(.4124*z+.3576*w+.1805*S),100*(.2126*z+.7152*w+.0722*S),100*(.0193*z+.1192*w+.9505*S)]},E.rgb.lab=function(f){const z=E.rgb.xyz(f);let w=z[0],S=z[1],C=z[2];w/=95.047,S/=100,C/=108.883,w=w>.008856?w**(1/3):7.787*w+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*S-16,500*(w-S),200*(S-C)]},E.hsl.rgb=function(f){const z=f[0]/360,w=f[1]/100,S=f[2]/100;let C,E,F;if(0===w)return F=255*S,[F,F,F];C=S<.5?S*(1+w):S+w-S*w;const J=2*S-C,x=[0,0,0];for(let u=0;u<3;u++)E=z+1/3*-(u-1),E<0&&E++,E>1&&E--,F=6*E<1?J+6*(C-J)*E:2*E<1?C:3*E<2?J+(C-J)*(2/3-E)*6:J,x[u]=255*F;return x},E.hsl.hsv=function(f){const z=f[0];let w=f[1]/100,S=f[2]/100,C=w;const E=Math.max(S,.01);S*=2,w*=S<=1?S:2-S,C*=E<=1?E:2-E;return[z,100*(0===S?2*C/(E+C):2*w/(S+w)),100*((S+w)/2)]},E.hsv.rgb=function(f){const z=f[0]/60,w=f[1]/100;let S=f[2]/100;const C=Math.floor(z)%6,E=z-Math.floor(z),F=255*S*(1-w),J=255*S*(1-w*E),x=255*S*(1-w*(1-E));switch(S*=255,C){case 0:return[S,x,F];case 1:return[J,S,F];case 2:return[F,S,x];case 3:return[F,J,S];case 4:return[x,F,S];case 5:return[S,F,J]}},E.hsv.hsl=function(f){const z=f[0],w=f[1]/100,S=f[2]/100,C=Math.max(S,.01);let E,F;F=(2-w)*S;const J=(2-w)*C;return E=w*C,E/=J<=1?J:2-J,E=E||0,F/=2,[z,100*E,100*F]},E.hwb.rgb=function(f){const z=f[0]/360;let w=f[1]/100,S=f[2]/100;const C=w+S;let E;C>1&&(w/=C,S/=C);const F=Math.floor(6*z),J=1-S;E=6*z-F,0!==(1&F)&&(E=1-E);const x=w+E*(J-w);let u,h,X;switch(F){default:case 6:case 0:u=J,h=x,X=w;break;case 1:u=x,h=J,X=w;break;case 2:u=w,h=J,X=x;break;case 3:u=w,h=x,X=J;break;case 4:u=x,h=w,X=J;break;case 5:u=J,h=w,X=x}return[255*u,255*h,255*X]},E.cmyk.rgb=function(f){const z=f[0]/100,w=f[1]/100,S=f[2]/100,C=f[3]/100;return[255*(1-Math.min(1,z*(1-C)+C)),255*(1-Math.min(1,w*(1-C)+C)),255*(1-Math.min(1,S*(1-C)+C))]},E.xyz.rgb=function(f){const z=f[0]/100,w=f[1]/100,S=f[2]/100;let C,E,F;return C=3.2406*z+-1.5372*w+-.4986*S,E=-.9689*z+1.8758*w+.0415*S,F=.0557*z+-.204*w+1.057*S,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,C=Math.min(Math.max(0,C),1),E=Math.min(Math.max(0,E),1),F=Math.min(Math.max(0,F),1),[255*C,255*E,255*F]},E.xyz.lab=function(f){let z=f[0],w=f[1],S=f[2];z/=95.047,w/=100,S/=108.883,z=z>.008856?z**(1/3):7.787*z+16/116,w=w>.008856?w**(1/3):7.787*w+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*w-16,500*(z-w),200*(w-S)]},E.lab.xyz=function(f){let z,w,S;w=(f[0]+16)/116,z=f[1]/500+w,S=w-f[2]/200;const C=w**3,E=z**3,F=S**3;return w=C>.008856?C:(w-16/116)/7.787,z=E>.008856?E:(z-16/116)/7.787,S=F>.008856?F:(S-16/116)/7.787,z*=95.047,w*=100,S*=108.883,[z,w,S]},E.lab.lch=function(f){const z=f[0],w=f[1],S=f[2];let C;C=360*Math.atan2(S,w)/2/Math.PI,C<0&&(C+=360);return[z,Math.sqrt(w*w+S*S),C]},E.lch.lab=function(f){const z=f[0],w=f[1],S=f[2]/360*2*Math.PI;return[z,w*Math.cos(S),w*Math.sin(S)]},E.rgb.ansi16=function(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[w,S,C]=f;let F=null===z?E.rgb.hsv(f)[2]:z;if(F=Math.round(F/50),0===F)return 30;let J=30+(Math.round(C/255)<<2|Math.round(S/255)<<1|Math.round(w/255));return 2===F&&(J+=60),J},E.hsv.ansi16=function(f){return E.rgb.ansi16(E.hsv.rgb(f),f[2])},E.rgb.ansi256=function(f){const z=f[0],w=f[1],S=f[2];if(z===w&&w===S)return z<8?16:z>248?231:Math.round((z-8)/247*24)+232;return 16+36*Math.round(z/255*5)+6*Math.round(w/255*5)+Math.round(S/255*5)},E.ansi16.rgb=function(f){let z=f%10;if(0===z||7===z)return f>50&&(z+=3.5),z=z/10.5*255,[z,z,z];const w=.5*(1+~~(f>50));return[(1&z)*w*255,(z>>1&1)*w*255,(z>>2&1)*w*255]},E.ansi256.rgb=function(f){if(f>=232){const z=10*(f-232)+8;return[z,z,z]}let z;f-=16;return[Math.floor(f/36)/5*255,Math.floor((z=f%36)/6)/5*255,z%6/5*255]},E.rgb.hex=function(f){const z=(((255&Math.round(f[0]))<<16)+((255&Math.round(f[1]))<<8)+(255&Math.round(f[2]))).toString(16).toUpperCase();return"000000".substring(z.length)+z},E.hex.rgb=function(f){const z=f.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!z)return[0,0,0];let w=z[0];3===z[0].length&&(w=w.split("").map((f=>f+f)).join(""));const S=parseInt(w,16);return[S>>16&255,S>>8&255,255&S]},E.rgb.hcg=function(f){const z=f[0]/255,w=f[1]/255,S=f[2]/255,C=Math.max(Math.max(z,w),S),E=Math.min(Math.min(z,w),S),F=C-E;let J,x;return J=F<1?E/(1-F):0,x=F<=0?0:C===z?(w-S)/F%6:C===w?2+(S-z)/F:4+(z-w)/F,x/=6,x%=1,[360*x,100*F,100*J]},E.hsl.hcg=function(f){const z=f[1]/100,w=f[2]/100,S=w<.5?2*z*w:2*z*(1-w);let C=0;return S<1&&(C=(w-.5*S)/(1-S)),[f[0],100*S,100*C]},E.hsv.hcg=function(f){const z=f[1]/100,w=f[2]/100,S=z*w;let C=0;return S<1&&(C=(w-S)/(1-S)),[f[0],100*S,100*C]},E.hcg.rgb=function(f){const z=f[0]/360,w=f[1]/100,S=f[2]/100;if(0===w)return[255*S,255*S,255*S];const C=[0,0,0],E=z%1*6,F=E%1,J=1-F;let x=0;switch(Math.floor(E)){case 0:C[0]=1,C[1]=F,C[2]=0;break;case 1:C[0]=J,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=F;break;case 3:C[0]=0,C[1]=J,C[2]=1;break;case 4:C[0]=F,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=J}return x=(1-w)*S,[255*(w*C[0]+x),255*(w*C[1]+x),255*(w*C[2]+x)]},E.hcg.hsv=function(f){const z=f[1]/100,w=z+f[2]/100*(1-z);let S=0;return w>0&&(S=z/w),[f[0],100*S,100*w]},E.hcg.hsl=function(f){const z=f[1]/100,w=f[2]/100*(1-z)+.5*z;let S=0;return w>0&&w<.5?S=z/(2*w):w>=.5&&w<1&&(S=z/(2*(1-w))),[f[0],100*S,100*w]},E.hcg.hwb=function(f){const z=f[1]/100,w=z+f[2]/100*(1-z);return[f[0],100*(w-z),100*(1-w)]},E.hwb.hcg=function(f){const z=f[1]/100,w=1-f[2]/100,S=w-z;let C=0;return S<1&&(C=(w-S)/(1-S)),[f[0],100*S,100*C]},E.apple.rgb=function(f){return[f[0]/65535*255,f[1]/65535*255,f[2]/65535*255]},E.rgb.apple=function(f){return[f[0]/255*65535,f[1]/255*65535,f[2]/255*65535]},E.gray.rgb=function(f){return[f[0]/100*255,f[0]/100*255,f[0]/100*255]},E.gray.hsl=function(f){return[0,0,f[0]]},E.gray.hsv=E.gray.hsl,E.gray.hwb=function(f){return[0,100,f[0]]},E.gray.cmyk=function(f){return[0,0,0,f[0]]},E.gray.lab=function(f){return[f[0],0,0]},E.gray.hex=function(f){const z=255&Math.round(f[0]/100*255),w=((z<<16)+(z<<8)+z).toString(16).toUpperCase();return"000000".substring(w.length)+w},E.rgb.gray=function(f){return[(f[0]+f[1]+f[2])/3/255*100]}},12858:(f,z,w)=>{const S=w(12866),C=w(12873),E={};Object.keys(S).forEach((f=>{E[f]={},Object.defineProperty(E[f],"channels",{value:S[f].channels}),Object.defineProperty(E[f],"labels",{value:S[f].labels});const z=C(f);Object.keys(z).forEach((w=>{const S=z[w];E[f][w]=function(f){const z=function(){for(var z=arguments.length,w=new Array(z),S=0;S<z;S++)w[S]=arguments[S];const C=w[0];if(void 0===C||null===C)return C;C.length>1&&(w=C);const E=f(w);if("object"===typeof E)for(let f=E.length,F=0;F<f;F++)E[F]=Math.round(E[F]);return E};return"conversion"in f&&(z.conversion=f.conversion),z}(S),E[f][w].raw=function(f){const z=function(){for(var z=arguments.length,w=new Array(z),S=0;S<z;S++)w[S]=arguments[S];const C=w[0];return void 0===C||null===C?C:(C.length>1&&(w=C),f(w))};return"conversion"in f&&(z.conversion=f.conversion),z}(S)}))})),f.exports=E},12873:(f,z,w)=>{const S=w(12866);function C(f){const z=function(){const f={},z=Object.keys(S);for(let w=z.length,S=0;S<w;S++)f[z[S]]={distance:-1,parent:null};return f}(),w=[f];for(z[f].distance=0;w.length;){const f=w.pop(),C=Object.keys(S[f]);for(let S=C.length,E=0;E<S;E++){const S=C[E],F=z[S];-1===F.distance&&(F.distance=z[f].distance+1,F.parent=f,w.unshift(S))}}return z}function E(f,z){return function(w){return z(f(w))}}function F(f,z){const w=[z[f].parent,f];let C=S[z[f].parent][f],F=z[f].parent;for(;z[F].parent;)w.unshift(z[F].parent),C=E(S[z[F].parent][F],C),F=z[F].parent;return C.conversion=w,C}f.exports=function(f){const z=C(f),w={},S=Object.keys(z);for(let C=S.length,E=0;E<C;E++){const f=S[E];null!==z[f].parent&&(w[f]=F(f,z))}return w}},12869:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11879:function(f,z,w){"use strict";var S=this&&this.__createBinding||(Object.create?function(f,z,w,S){void 0===S&&(S=w);var C=Object.getOwnPropertyDescriptor(z,w);C&&!("get"in C?!z.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return z[w]}}),Object.defineProperty(f,S,C)}:function(f,z,w,S){void 0===S&&(S=w),f[S]=z[w]}),C=this&&this.__setModuleDefault||(Object.create?function(f,z){Object.defineProperty(f,"default",{enumerable:!0,value:z})}:function(f,z){f.default=z}),E=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var z={};if(null!=f)for(var w in f)"default"!==w&&Object.prototype.hasOwnProperty.call(f,w)&&S(z,f,w);return C(z,f),z},F=this&&this.__awaiter||function(f,z,w,S){return new(w||(w=Promise))((function(C,E){function F(f){try{x(S.next(f))}catch(z){E(z)}}function J(f){try{x(S.throw(f))}catch(z){E(z)}}function x(f){var z;f.done?C(f.value):(z=f.value,z instanceof w?z:new w((function(f){f(z)}))).then(F,J)}x((S=S.apply(f,z||[])).next())}))};Object.defineProperty(z,"__esModule",{value:!0}),z.Auth=z.Platform=void 0;const J=E(w(11823)),x=w(11887),u="colyseus-auth-token";!function(f){f.ios="ios",f.android="android"}(z.Platform||(z.Platform={}));z.Auth=class{constructor(f){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=f.replace("ws","http"),(0,x.getItem)(u,(f=>this.token=f))}get hasToken(){return!!this.token}login(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F(this,void 0,void 0,(function*(){const z=Object.assign({},f);this.hasToken&&(z.token=this.token);const w=yield this.request("post","/auth",z);this.token=w.token,(0,x.setItem)(u,this.token);for(let f in w)this.hasOwnProperty(f)&&(this[f]=w[f]);return this.registerPingService(),this}))}save(){return F(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return F(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(f){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:f})}))}acceptFriendRequest(f){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:f})}))}declineFriendRequest(f){return F(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:f})}))}blockUser(f){return F(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:f})}))}unblockUser(f){return F(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:f})}))}request(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return F(this,void 0,void 0,(function*(){C.Accept="application/json",this.hasToken&&(C.Authorization="Bearer "+this.token);const E=[];for(const f in w)E.push(`${f}=${w[f]}`);const F=E.length>0?`?${E.join("&")}`:"",x={headers:C};return S&&(x.body=S),(yield J[f](`${this.endpoint}${z}${F}`,x)).data}))}logout(){this.token=void 0,(0,x.removeItem)(u),this.unregisterPingService()}registerPingService(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),f)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11821:function(f,z,w){"use strict";var S,C=this&&this.__awaiter||function(f,z,w,S){return new(w||(w=Promise))((function(C,E){function F(f){try{x(S.next(f))}catch(z){E(z)}}function J(f){try{x(S.throw(f))}catch(z){E(z)}}function x(f){var z;f.done?C(f.value):(z=f.value,z instanceof w?z:new w((function(f){f(z)}))).then(F,J)}x((S=S.apply(f,z||[])).next())}))};Object.defineProperty(z,"__esModule",{value:!0}),z.Client=z.MatchMakeError=void 0;const E=w(11823),F=w(11828),J=w(11832);class x extends Error{constructor(f,z){super(f),this.code=z,Object.setPrototypeOf(this,x.prototype)}}z.MatchMakeError=x;const u="undefined"!==typeof window&&"undefined"!==typeof(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";z.Client=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;if("string"===typeof f){const z=new URL(f),w="https:"===z.protocol||"wss:"===z.protocol,S=Number(z.port||(w?443:80));this.settings={hostname:z.hostname,pathname:"/"!==z.pathname?z.pathname:"",port:S,secure:w}}else void 0===f.port&&(f.port=f.secure?443:80),void 0===f.pathname&&(f.pathname=""),this.settings=f}joinOrCreate(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",f,z,w)}))}create(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",f,z,w)}))}join(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",f,z,w)}))}joinById(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",f,z,w)}))}reconnect(f,z){return C(this,void 0,void 0,(function*(){if("string"===typeof f&&"string"===typeof z)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[w,S]=f.split(":");return yield this.createMatchMakeRequest("reconnect",w,{reconnectionToken:S},z)}))}getAvailableRooms(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return C(this,void 0,void 0,(function*(){return(yield(0,E.get)(this.getHttpEndpoint(`${f}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(f,z,w){return C(this,void 0,void 0,(function*(){const S=this.createRoom(f.room.name,z);S.roomId=f.room.roomId,S.sessionId=f.sessionId;const E={sessionId:S.sessionId};f.reconnectionToken&&(E.reconnectionToken=f.reconnectionToken);const J=w||S;return S.connect(this.buildEndpoint(f.room,E),f.devMode&&(()=>C(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${S.roomId}'...`);let w=0;const E=()=>C(this,void 0,void 0,(function*(){w++;try{yield this.consumeSeatReservation(f,z,J),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${S.roomId}'`)}catch(C){w<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${w} out of 8)`),setTimeout(E,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(E,2e3)}))),J),new Promise(((f,z)=>{const w=(f,w)=>z(new F.ServerError(f,w));J.onError.once(w),J.onJoin.once((()=>{J.onError.remove(w),f(J)}))}))}))}createMatchMakeRequest(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;return C(this,void 0,void 0,(function*(){const C=(yield(0,E.post)(this.getHttpEndpoint(`${f}/${z}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(w)})).data;if(C.error)throw new x(C.error,C.code);return"reconnect"===f&&(C.reconnectionToken=w.reconnectionToken),yield this.consumeSeatReservation(C,S,F)}))}createRoom(f,z){return new J.Room(f,z)}buildEndpoint(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const w=[];for(const C in z)z.hasOwnProperty(C)&&w.push(`${C}=${z[C]}`);let S=this.settings.secure?"wss://":"ws://";return f.publicAddress?S+=`${f.publicAddress}`:S+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${S}/${f.processId}/${f.roomId}?${w.join("&")}`}getHttpEndpoint(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${f}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11841:(f,z,w)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.Connection=void 0;const S=w(11849);z.Connection=class{constructor(){this.events={},this.transport=new S.WebSocketTransport(this.events)}send(f){this.transport.send(f)}connect(f){this.transport.connect(f)}close(f,z){this.transport.close(f,z)}get isOpen(){return this.transport.isOpen}}},11856:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.utf8Length=z.utf8Read=z.ErrorCode=z.Protocol=void 0,function(f){f[f.HANDSHAKE=9]="HANDSHAKE",f[f.JOIN_ROOM=10]="JOIN_ROOM",f[f.ERROR=11]="ERROR",f[f.LEAVE_ROOM=12]="LEAVE_ROOM",f[f.ROOM_DATA=13]="ROOM_DATA",f[f.ROOM_STATE=14]="ROOM_STATE",f[f.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",f[f.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",f[f.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(z.Protocol||(z.Protocol={})),function(f){f[f.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",f[f.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",f[f.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",f[f.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",f[f.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",f[f.AUTH_FAILED=4215]="AUTH_FAILED",f[f.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(z.ErrorCode||(z.ErrorCode={})),z.utf8Read=function(f,z){const w=f[z++];for(var S="",C=0,E=z,F=z+w;E<F;E++){var J=f[E];if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(C=(7&J)<<18|(63&f[++E])<<12|(63&f[++E])<<6|63&f[++E])>=65536?(C-=65536,S+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):S+=String.fromCharCode(C)}else S+=String.fromCharCode((15&J)<<12|(63&f[++E])<<6|63&f[++E]);else S+=String.fromCharCode((31&J)<<6|63&f[++E]);else S+=String.fromCharCode(J)}return S},z.utf8Length=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",z=0,w=0;for(let S=0,C=f.length;S<C;S++)z=f.charCodeAt(S),z<128?w+=1:z<2048?w+=2:z<55296||z>=57344?w+=3:(S++,w+=4);return w+1}},11832:function(f,z,w){"use strict";var S=this&&this.__createBinding||(Object.create?function(f,z,w,S){void 0===S&&(S=w);var C=Object.getOwnPropertyDescriptor(z,w);C&&!("get"in C?!z.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return z[w]}}),Object.defineProperty(f,S,C)}:function(f,z,w,S){void 0===S&&(S=w),f[S]=z[w]}),C=this&&this.__setModuleDefault||(Object.create?function(f,z){Object.defineProperty(f,"default",{enumerable:!0,value:z})}:function(f,z){f.default=z}),E=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var z={};if(null!=f)for(var w in f)"default"!==w&&Object.prototype.hasOwnProperty.call(f,w)&&S(z,f,w);return C(z,f),z};Object.defineProperty(z,"__esModule",{value:!0}),z.Room=void 0;const F=E(w(11838)),J=w(11841),x=w(11856),u=w(11860),h=w(11864),X=w(11870),K=w(11873),c=w(11828);class y{constructor(f,z){this.onStateChange=(0,X.createSignal)(),this.onError=(0,X.createSignal)(),this.onLeave=(0,X.createSignal)(),this.onJoin=(0,X.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,h.createNanoEvents)(),this.roomId=null,this.name=f,z&&(this.serializer=new((0,u.getSerializer)("schema")),this.rootSchema=z,this.serializer.state=new z),this.onError(((f,z)=>{var w;return null===(w=console.warn)||void 0===w?void 0:w.call(console,`colyseus.js - onError => (${f}) ${z}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const S=new J.Connection;w.connection=S,S.events.onmessage=y.prototype.onMessageCallback.bind(w),S.events.onclose=function(f){var S;if(!w.hasJoined)return null===(S=console.warn)||void 0===S||S.call(console,`Room connection was closed unexpectedly (${f.code}): ${f.reason}`),void w.onError.invoke(f.code,f.reason);f.code===c.CloseCode.DEVMODE_RESTART&&z?z():(w.onLeave.invoke(f.code),w.destroy())},S.events.onerror=function(f){var z;null===(z=console.warn)||void 0===z||z.call(console,`Room, onError (${f.code}): ${f.reason}`),w.onError.invoke(f.code,f.reason)},S.connect(f)}leave(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((z=>{this.onLeave((f=>z(f))),this.connection?f?this.connection.send([x.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(c.CloseCode.CONSENTED)}))}onMessage(f,z){return this.onMessageHandlers.on(this.getMessageHandlerKey(f),z)}send(f,z){const w=[x.Protocol.ROOM_DATA];let S;if("string"===typeof f?K.encode.string(w,f):K.encode.number(w,f),void 0!==z){const f=F.encode(z);S=new Uint8Array(w.length+f.byteLength),S.set(new Uint8Array(w),0),S.set(new Uint8Array(f),w.length)}else S=new Uint8Array(w);this.connection.send(S.buffer)}sendBytes(f,z){const w=[x.Protocol.ROOM_DATA_BYTES];let S;"string"===typeof f?K.encode.string(w,f):K.encode.number(w,f),S=new Uint8Array(w.length+(z.byteLength||z.length)),S.set(new Uint8Array(w),0),S.set(new Uint8Array(z),w.length),this.connection.send(S.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(f){const z=Array.from(new Uint8Array(f.data)),w=z[0];if(w===x.Protocol.JOIN_ROOM){let f=1;const w=(0,x.utf8Read)(z,f);if(f+=(0,x.utf8Length)(w),this.serializerId=(0,x.utf8Read)(z,f),f+=(0,x.utf8Length)(this.serializerId),!this.serializer){const f=(0,u.getSerializer)(this.serializerId);this.serializer=new f}z.length>f&&this.serializer.handshake&&this.serializer.handshake(z,{offset:f}),this.reconnectionToken=`${this.roomId}:${w}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([x.Protocol.JOIN_ROOM])}else if(w===x.Protocol.ERROR){const f={offset:1},w=K.decode.number(z,f),S=K.decode.string(z,f);this.onError.invoke(w,S)}else if(w===x.Protocol.LEAVE_ROOM)this.leave();else if(w===x.Protocol.ROOM_DATA_SCHEMA){const f={offset:1},w=this.serializer.getState().constructor._context.get(K.decode.number(z,f)),S=new w;S.decode(z,f),this.dispatchMessage(w,S)}else if(w===x.Protocol.ROOM_STATE)z.shift(),this.setState(z);else if(w===x.Protocol.ROOM_STATE_PATCH)z.shift(),this.patch(z);else if(w===x.Protocol.ROOM_DATA){const w={offset:1},S=K.decode.stringCheck(z,w)?K.decode.string(z,w):K.decode.number(z,w),C=z.length>w.offset?F.decode(f.data,w.offset):void 0;this.dispatchMessage(S,C)}else if(w===x.Protocol.ROOM_DATA_BYTES){const f={offset:1},w=K.decode.stringCheck(z,f)?K.decode.string(z,f):K.decode.number(z,f);this.dispatchMessage(w,new Uint8Array(z.slice(f.offset)))}}setState(f){this.serializer.setState(f),this.onStateChange.invoke(this.serializer.getState())}patch(f){this.serializer.patch(f),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(f,z){var w;const S=this.getMessageHandlerKey(f);this.onMessageHandlers.events[S]?this.onMessageHandlers.emit(S,z):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",f,z):null===(w=console.warn)||void 0===w||w.call(console,`colyseus.js: onMessage() not registered for type '${f}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(f){switch(typeof f){case"function":return`$${f._typeid}`;case"string":return f;case"number":return`i${f}`;default:throw new Error("invalid message type.")}}}z.Room=y},11887:(f,z)=>{"use strict";let w;function S(){return w||(w="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(f,z){this.cache[f]=z},getItem:function(f){this.cache[f]},removeItem:function(f){delete this.cache[f]}}),w}Object.defineProperty(z,"__esModule",{value:!0}),z.getItem=z.removeItem=z.setItem=void 0,z.setItem=function(f,z){S().setItem(f,z)},z.removeItem=function(f){S().removeItem(f)},z.getItem=function(f,z){const w=S().getItem(f);"undefined"!==typeof Promise&&w instanceof Promise?w.then((f=>z(f))):z(w)}},11864:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.createNanoEvents=void 0;z.createNanoEvents=()=>({emit(f){let z=this.events[f]||[];for(var w=arguments.length,S=new Array(w>1?w-1:0),C=1;C<w;C++)S[C-1]=arguments[C];for(let E=0,F=z.length;E<F;E++)z[E](...S)},events:{},on(f,z){var w;return(null===(w=this.events[f])||void 0===w?void 0:w.push(z))||(this.events[f]=[z]),()=>{var w;this.events[f]=null===(w=this.events[f])||void 0===w?void 0:w.filter((f=>z!==f))}}})},11870:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.createSignal=z.EventEmitter=void 0;class w{constructor(){this.handlers=[]}register(f){return this.handlers.push(f),this}invoke(){for(var f=arguments.length,z=new Array(f),w=0;w<f;w++)z[w]=arguments[w];this.handlers.forEach((f=>f.apply(this,z)))}invokeAsync(){for(var f=arguments.length,z=new Array(f),w=0;w<f;w++)z[w]=arguments[w];return Promise.all(this.handlers.map((f=>f.apply(this,z))))}remove(f){const z=this.handlers.indexOf(f);this.handlers[z]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}z.EventEmitter=w,z.createSignal=function(){const f=new w;function z(z){return f.register(z,null===this)}return z.once=z=>{const w=function(){for(var S=arguments.length,C=new Array(S),E=0;E<S;E++)C[E]=arguments[E];z.apply(this,C),f.remove(w)};f.register(w)},z.remove=z=>f.remove(z),z.invoke=function(){return f.invoke(...arguments)},z.invokeAsync=function(){return f.invokeAsync(...arguments)},z.clear=()=>f.clear(),z}},11828:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.ServerError=z.CloseCode=void 0,function(f){f[f.CONSENTED=4e3]="CONSENTED",f[f.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(z.CloseCode||(z.CloseCode={}));class w extends Error{constructor(f,z){super(z),this.name="ServerError",this.code=f}}z.ServerError=w},11808:(f,z,w)=>{"use strict";z.b=void 0,w(11815);var S=w(11821);Object.defineProperty(z,"b",{enumerable:!0,get:function(){return S.Client}});var C=w(11856);var E=w(11832);var F=w(11879);const J=w(11891);const x=w(11893),u=w(11860);(0,u.registerSerializer)("schema",J.SchemaSerializer),(0,u.registerSerializer)("none",x.NoneSerializer)},11815:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=f=>null!==f&&"object"===typeof f&&f.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11838:(f,z)=>{"use strict";function w(f,z){if(this._offset=z,f instanceof ArrayBuffer)this._buffer=f,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(f))throw new Error("Invalid argument");this._buffer=f.buffer,this._view=new DataView(this._buffer,f.byteOffset,f.byteLength)}}Object.defineProperty(z,"__esModule",{value:!0}),z.decode=z.encode=void 0,w.prototype._array=function(f){for(var z=new Array(f),w=0;w<f;w++)z[w]=this._parse();return z},w.prototype._map=function(f){for(var z={},w=0;w<f;w++)z[this._parse()]=this._parse();return z},w.prototype._str=function(f){var z=function(f,z,w){for(var S="",C=0,E=z,F=z+w;E<F;E++){var J=f.getUint8(E);if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(C=(7&J)<<18|(63&f.getUint8(++E))<<12|(63&f.getUint8(++E))<<6|63&f.getUint8(++E))>=65536?(C-=65536,S+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):S+=String.fromCharCode(C)}else S+=String.fromCharCode((15&J)<<12|(63&f.getUint8(++E))<<6|63&f.getUint8(++E));else S+=String.fromCharCode((31&J)<<6|63&f.getUint8(++E));else S+=String.fromCharCode(J)}return S}(this._view,this._offset,f);return this._offset+=f,z},w.prototype._bin=function(f){var z=this._buffer.slice(this._offset,this._offset+f);return this._offset+=f,z},w.prototype._parse=function(){var f,z=this._view.getUint8(this._offset++),w=0,S=0,C=0,E=0;if(z<192)return z<128?z:z<144?this._map(15&z):z<160?this._array(15&z):this._str(31&z);if(z>223)return-1*(255-z+1);switch(z){case 192:return null;case 194:return!1;case 195:return!0;case 196:return w=this._view.getUint8(this._offset),this._offset+=1,this._bin(w);case 197:return w=this._view.getUint16(this._offset),this._offset+=2,this._bin(w);case 198:return w=this._view.getUint32(this._offset),this._offset+=4,this._bin(w);case 199:if(w=this._view.getUint8(this._offset),S=this._view.getInt8(this._offset+1),this._offset+=2,-1===S){var F=this._view.getUint32(this._offset);return C=this._view.getInt32(this._offset+4),E=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*C+E)+F/1e6)}return[S,this._bin(w)];case 200:return w=this._view.getUint16(this._offset),S=this._view.getInt8(this._offset+2),this._offset+=3,[S,this._bin(w)];case 201:return w=this._view.getUint32(this._offset),S=this._view.getInt8(this._offset+4),this._offset+=5,[S,this._bin(w)];case 202:return f=this._view.getFloat32(this._offset),this._offset+=4,f;case 203:return f=this._view.getFloat64(this._offset),this._offset+=8,f;case 204:return f=this._view.getUint8(this._offset),this._offset+=1,f;case 205:return f=this._view.getUint16(this._offset),this._offset+=2,f;case 206:return f=this._view.getUint32(this._offset),this._offset+=4,f;case 207:return C=this._view.getUint32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,C+E;case 208:return f=this._view.getInt8(this._offset),this._offset+=1,f;case 209:return f=this._view.getInt16(this._offset),this._offset+=2,f;case 210:return f=this._view.getInt32(this._offset),this._offset+=4,f;case 211:return C=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,C+E;case 212:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?void(this._offset+=1):[S,this._bin(1)];case 213:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(2)];case 214:return S=this._view.getInt8(this._offset),this._offset+=1,-1===S?(f=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*f)):[S,this._bin(4)];case 215:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?(C=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(C+E)):-1===S?(C=this._view.getUint32(this._offset),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&C)+E)+(C>>>2)/1e6)):[S,this._bin(8)];case 216:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(16)];case 217:return w=this._view.getUint8(this._offset),this._offset+=1,this._str(w);case 218:return w=this._view.getUint16(this._offset),this._offset+=2,this._str(w);case 219:return w=this._view.getUint32(this._offset),this._offset+=4,this._str(w);case 220:return w=this._view.getUint16(this._offset),this._offset+=2,this._array(w);case 221:return w=this._view.getUint32(this._offset),this._offset+=4,this._array(w);case 222:return w=this._view.getUint16(this._offset),this._offset+=2,this._map(w);case 223:return w=this._view.getUint32(this._offset),this._offset+=4,this._map(w)}throw new Error("Could not parse")},z.decode=function(f){var z=new w(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),S=z._parse();if(z._offset!==f.byteLength)throw new Error(f.byteLength-z._offset+" trailing bytes");return S};function S(f,z,w){for(var S=0,C=0,E=w.length;C<E;C++)(S=w.charCodeAt(C))<128?f.setUint8(z++,S):S<2048?(f.setUint8(z++,192|S>>6),f.setUint8(z++,128|63&S)):S<55296||S>=57344?(f.setUint8(z++,224|S>>12),f.setUint8(z++,128|S>>6&63),f.setUint8(z++,128|63&S)):(C++,S=65536+((1023&S)<<10|1023&w.charCodeAt(C)),f.setUint8(z++,240|S>>18),f.setUint8(z++,128|S>>12&63),f.setUint8(z++,128|S>>6&63),f.setUint8(z++,128|63&S))}function C(f,z,w){var S=typeof w,E=0,F=0,J=0,x=0,u=0,h=0;if("string"===S){if(u=function(f){for(var z=0,w=0,S=0,C=f.length;S<C;S++)(z=f.charCodeAt(S))<128?w+=1:z<2048?w+=2:z<55296||z>=57344?w+=3:(S++,w+=4);return w}(w),u<32)f.push(160|u),h=1;else if(u<256)f.push(217,u),h=2;else if(u<65536)f.push(218,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("String too long");f.push(219,u>>24,u>>16,u>>8,u),h=5}return z.push({_str:w,_length:u,_offset:f.length}),h+u}if("number"===S)return Math.floor(w)===w&&isFinite(w)?w>=0?w<128?(f.push(w),1):w<256?(f.push(204,w),2):w<65536?(f.push(205,w>>8,w),3):w<4294967296?(f.push(206,w>>24,w>>16,w>>8,w),5):(J=w/Math.pow(2,32)|0,x=w>>>0,f.push(207,J>>24,J>>16,J>>8,J,x>>24,x>>16,x>>8,x),9):w>=-32?(f.push(w),1):w>=-128?(f.push(208,w),2):w>=-32768?(f.push(209,w>>8,w),3):w>=-2147483648?(f.push(210,w>>24,w>>16,w>>8,w),5):(J=Math.floor(w/Math.pow(2,32)),x=w>>>0,f.push(211,J>>24,J>>16,J>>8,J,x>>24,x>>16,x>>8,x),9):(f.push(203),z.push({_float:w,_length:8,_offset:f.length}),9);if("object"===S){if(null===w)return f.push(192),1;if(Array.isArray(w)){if((u=w.length)<16)f.push(144|u),h=1;else if(u<65536)f.push(220,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Array too large");f.push(221,u>>24,u>>16,u>>8,u),h=5}for(E=0;E<u;E++)h+=C(f,z,w[E]);return h}if(w instanceof Date){var X=w.getTime(),K=Math.floor(X/1e3),c=1e6*(X-1e3*K);return K>=0&&c>=0&&K<=17179869183?0===c&&K<=4294967295?(f.push(214,255,K>>24,K>>16,K>>8,K),6):(J=K/4294967296,x=4294967295&K,f.push(215,255,c>>22,c>>14,c>>6,J,x>>24,x>>16,x>>8,x),10):(J=Math.floor(K/4294967296),x=K>>>0,f.push(199,12,255,c>>24,c>>16,c>>8,c,J>>24,J>>16,J>>8,J,x>>24,x>>16,x>>8,x),15)}if(w instanceof ArrayBuffer){if((u=w.byteLength)<256)f.push(196,u),h=2;else if(u<65536)f.push(197,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Buffer too large");f.push(198,u>>24,u>>16,u>>8,u),h=5}return z.push({_bin:w,_length:u,_offset:f.length}),h+u}if("function"===typeof w.toJSON)return C(f,z,w.toJSON());var y=[],e="",O=Object.keys(w);for(E=0,F=O.length;E<F;E++)void 0!==w[e=O[E]]&&"function"!==typeof w[e]&&y.push(e);if((u=y.length)<16)f.push(128|u),h=1;else if(u<65536)f.push(222,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Object too large");f.push(223,u>>24,u>>16,u>>8,u),h=5}for(E=0;E<u;E++)h+=C(f,z,e=y[E]),h+=C(f,z,w[e]);return h}if("boolean"===S)return f.push(w?195:194),1;if("undefined"===S)return f.push(192),1;if("function"===typeof w.toJSON)return C(f,z,w.toJSON());throw new Error("Could not encode")}z.encode=function(f){var z=[],w=[],E=C(z,w,f),F=new ArrayBuffer(E),J=new DataView(F),x=0,u=0,h=-1;w.length>0&&(h=w[0]._offset);for(var X,K=0,c=0,y=0,e=z.length;y<e;y++)if(J.setUint8(u+y,z[y]),y+1===h){if(K=(X=w[x])._length,c=u+h,X._bin)for(var O=new Uint8Array(X._bin),d=0;d<K;d++)J.setUint8(c+d,O[d]);else X._str?S(J,c,X._str):void 0!==X._float&&J.setFloat64(c,X._float);u+=K,w[++x]&&(h=w[x]._offset)}return F}},11893:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.NoneSerializer=void 0;z.NoneSerializer=class{setState(f){}getState(){return null}patch(f){}teardown(){}handshake(f){}}},11891:(f,z,w)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.SchemaSerializer=void 0;const S=w(11873);z.SchemaSerializer=class{setState(f){return this.state.decode(f)}getState(){return this.state}patch(f){return this.state.decode(f)}teardown(){var f,z;null===(z=null===(f=this.state)||void 0===f?void 0:f.$changes)||void 0===z||z.root.clearRefs()}handshake(f,z){if(this.state){(new S.Reflection).decode(f,z)}else this.state=S.Reflection.decode(f,z)}}},11860:(f,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.getSerializer=z.registerSerializer=void 0;const w={};z.registerSerializer=function(f,z){w[f]=z},z.getSerializer=function(f){const z=w[f];if(!z)throw new Error("missing serializer: "+f);return z}},11849:function(f,z,w){"use strict";var S=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(z,"__esModule",{value:!0}),z.WebSocketTransport=void 0;const C=S(w(11854)),E=globalThis.WebSocket||C.default;z.WebSocketTransport=class{constructor(f){this.events=f}send(f){f instanceof ArrayBuffer?this.ws.send(f):Array.isArray(f)&&this.ws.send(new Uint8Array(f).buffer)}connect(f){this.ws=new E(f,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(f,z){this.ws.close(f,z)}get isOpen(){return this.ws.readyState===E.OPEN}}},11854:f=>{"use strict";f.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11942:f=>{"use strict";f.exports=function(f){for(var z=new Array(f),w=0;w<f;++w)z[w]=w;return z}},11948:f=>{function z(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}f.exports=function(f){return null!=f&&(z(f)||function(f){return"function"===typeof f.readFloatLE&&"function"===typeof f.slice&&z(f.slice(0,0))}(f)||!!f._isBuffer)}},11933:(f,z,w)=>{var S=w(11942),C=w(11948),E="undefined"!==typeof Float64Array;function F(f,z){return f[0]-z[0]}function J(){var f,z=this.stride,w=new Array(z.length);for(f=0;f<w.length;++f)w[f]=[Math.abs(z[f]),f];w.sort(F);var S=new Array(w.length);for(f=0;f<S.length;++f)S[f]=w[f][1];return S}function x(f,z){var w=["View",z,"d",f].join("");z<0&&(w="View_Nil"+f);var C="generic"===f;if(-1===z){var E="function "+w+"(a){this.data=a;};var proto="+w+".prototype;proto.dtype='"+f+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+w+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+w+"(a){return new "+w+"(a);}";return new Function(E)()}if(0===z){E="function "+w+"(a,d) {this.data = a;this.offset = d};var proto="+w+".prototype;proto.dtype='"+f+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+w+"_copy() {return new "+w+"(this.data,this.offset)};proto.pick=function "+w+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+w+"_get(){return "+(C?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+w+"_set(v){return "+(C?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+w+"(a,b,c,d){return new "+w+"(a,d)}";return new Function("TrivialArray",E)(u[f][0])}E=["'use strict'"];var F=S(z),x=F.map((function(f){return"i"+f})),h="this.offset+"+F.map((function(f){return"this.stride["+f+"]*i"+f})).join("+"),X=F.map((function(f){return"b"+f})).join(","),K=F.map((function(f){return"c"+f})).join(",");E.push("function "+w+"(a,"+X+","+K+",d){this.data=a","this.shape=["+X+"]","this.stride=["+K+"]","this.offset=d|0}","var proto="+w+".prototype","proto.dtype='"+f+"'","proto.dimension="+z),E.push("Object.defineProperty(proto,'size',{get:function "+w+"_size(){return "+F.map((function(f){return"this.shape["+f+"]"})).join("*"),"}})"),1===z?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),z<4?(E.push("function "+w+"_order(){"),2===z?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===z&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+w+"_set("+x.join(",")+",v){"),C?E.push("return this.data.set("+h+",v)}"):E.push("return this.data["+h+"]=v}"),E.push("proto.get=function "+w+"_get("+x.join(",")+"){"),C?E.push("return this.data.get("+h+")}"):E.push("return this.data["+h+"]}"),E.push("proto.index=function "+w+"_index(",x.join(),"){return "+h+"}"),E.push("proto.hi=function "+w+"_hi("+x.join(",")+"){return new "+w+"(this.data,"+F.map((function(f){return["(typeof i",f,"!=='number'||i",f,"<0)?this.shape[",f,"]:i",f,"|0"].join("")})).join(",")+","+F.map((function(f){return"this.stride["+f+"]"})).join(",")+",this.offset)}");var c=F.map((function(f){return"a"+f+"=this.shape["+f+"]"})),y=F.map((function(f){return"c"+f+"=this.stride["+f+"]"}));E.push("proto.lo=function "+w+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+y.join(","));for(var e=0;e<z;++e)E.push("if(typeof i"+e+"==='number'&&i"+e+">=0){d=i"+e+"|0;b+=c"+e+"*d;a"+e+"-=d}");E.push("return new "+w+"(this.data,"+F.map((function(f){return"a"+f})).join(",")+","+F.map((function(f){return"c"+f})).join(",")+",b)}"),E.push("proto.step=function "+w+"_step("+x.join(",")+"){var "+F.map((function(f){return"a"+f+"=this.shape["+f+"]"})).join(",")+","+F.map((function(f){return"b"+f+"=this.stride["+f+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(e=0;e<z;++e)E.push("if(typeof i"+e+"==='number'){d=i"+e+"|0;if(d<0){c+=b"+e+"*(a"+e+"-1);a"+e+"=ceil(-a"+e+"/d)}else{a"+e+"=ceil(a"+e+"/d)}b"+e+"*=d}");E.push("return new "+w+"(this.data,"+F.map((function(f){return"a"+f})).join(",")+","+F.map((function(f){return"b"+f})).join(",")+",c)}");var O=new Array(z),d=new Array(z);for(e=0;e<z;++e)O[e]="a[i"+e+"]",d[e]="b[i"+e+"]";E.push("proto.transpose=function "+w+"_transpose("+x+"){"+x.map((function(f,z){return f+"=("+f+"===undefined?"+z+":"+f+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+w+"(this.data,"+O.join(",")+","+d.join(",")+",this.offset)}"),E.push("proto.pick=function "+w+"_pick("+x+"){var a=[],b=[],c=this.offset");for(e=0;e<z;++e)E.push("if(typeof i"+e+"==='number'&&i"+e+">=0){c=(c+this.stride["+e+"]*i"+e+")|0}else{a.push(this.shape["+e+"]);b.push(this.stride["+e+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+w+"(data,shape,stride,offset){return new "+w+"(data,"+F.map((function(f){return"shape["+f+"]"})).join(",")+","+F.map((function(f){return"stride["+f+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(u[f],J)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};f.exports=function(f,z,w,S){if(void 0===f)return(0,u.array[0])([]);"number"===typeof f&&(f=[f]),void 0===z&&(z=[f.length]);var F=z.length;if(void 0===w){w=new Array(F);for(var J=F-1,h=1;J>=0;--J)w[J]=h,h*=z[J]}if(void 0===S){S=0;for(J=0;J<F;++J)w[J]<0&&(S-=(z[J]-1)*w[J])}for(var X=function(f){if(C(f))return"buffer";if(E)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}(f),K=u[X];K.length<=F+1;)K.push(x(X,K.length-1));return(0,K[F+1])(f,z,w,S)}},11905:f=>{var z;self,z=()=>(()=>{"use strict";var f={d:(z,w)=>{for(var S in w)f.o(w,S)&&!f.o(z,S)&&Object.defineProperty(z,S,{enumerable:!0,get:w[S]})},o:(f,z)=>Object.prototype.hasOwnProperty.call(f,z)},z={};f.d(z,{default:()=>a});var w,S=function(f,z){var w=z.x-f.x,S=z.y-f.y;return Math.sqrt(w*w+S*S)},C=function(f){return f*(Math.PI/180)},E=new Map,F=function(f){E.has(f)&&clearTimeout(E.get(f)),E.set(f,setTimeout(f,100))},J=function(f,z,w){for(var S,C=z.split(/[ ,]+/g),E=0;E<C.length;E+=1)S=C[E],f.addEventListener?f.addEventListener(S,w,!1):f.attachEvent&&f.attachEvent(S,w)},x=function(f,z,w){for(var S,C=z.split(/[ ,]+/g),E=0;E<C.length;E+=1)S=C[E],f.removeEventListener?f.removeEventListener(S,w):f.detachEvent&&f.detachEvent(S,w)},u=function(f){return f.preventDefault(),f.type.match(/^touch/)?f.changedTouches:f},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},X=function(f,z){z.top||z.right||z.bottom||z.left?(f.style.top=z.top,f.style.right=z.right,f.style.bottom=z.bottom,f.style.left=z.left):(f.style.left=z.x+"px",f.style.top=z.y+"px")},K=function(f,z,w){var S=c(f);for(var C in S)if(S.hasOwnProperty(C))if("string"==typeof z)S[C]=z+" "+w;else{for(var E="",F=0,J=z.length;F<J;F+=1)E+=z[F]+" "+w+", ";S[C]=E.slice(0,-2)}return S},c=function(f){var z={};return z[f]="",["webkit","Moz","o"].forEach((function(w){z[w+f.charAt(0).toUpperCase()+f.slice(1)]=""})),z},y=function(f,z){for(var w in z)z.hasOwnProperty(w)&&(f[w]=z[w]);return f},e=function(f,z){if(f.length)for(var w=0,S=f.length;w<S;w+=1)z(f[w]);else z(f)},O="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,d=window.matchMedia("(any-hover: none)").matches,B=!!("ontouchstart"in window),V=!!window.PointerEvent,W=!!window.MSPointerEvent,T={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function A(){}O&&!d?w=T:V?w={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:W?w={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:B?(w=T,D=v):w=v,A.prototype.on=function(f,z){var w,S=this,C=f.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var E=0;E<C.length;E+=1)w=C[E],S._handlers_[w]=S._handlers_[w]||[],S._handlers_[w].push(z);return S},A.prototype.off=function(f,z){var w=this;return w._handlers_=w._handlers_||{},void 0===f?w._handlers_={}:void 0===z?w._handlers_[f]=null:w._handlers_[f]&&w._handlers_[f].indexOf(z)>=0&&w._handlers_[f].splice(w._handlers_[f].indexOf(z),1),w},A.prototype.trigger=function(f,z){var w,S=this,C=f.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var E=0;E<C.length;E+=1)w=C[E],S._handlers_[w]&&S._handlers_[w].length&&S._handlers_[w].forEach((function(f){f.call(S,{type:w,target:S},z)}))},A.prototype.config=function(f){var z=this;z.options=z.defaults||{},f&&(z.options=function(f,z){var w={};for(var S in f)f.hasOwnProperty(S)&&z.hasOwnProperty(S)?w[S]=z[S]:f.hasOwnProperty(S)&&(w[S]=f[S]);return w}(z.options,f))},A.prototype.bindEvt=function(f,z){var S=this;return S._domHandlers_=S._domHandlers_||{},S._domHandlers_[z]=function(){"function"==typeof S["on"+z]?S["on"+z].apply(S,arguments):console.warn('[WARNING] : Missing "on'+z+'" handler.')},J(f,w[z],S._domHandlers_[z]),D[z]&&J(f,D[z],S._domHandlers_[z]),S},A.prototype.unbindEvt=function(f,z){var S=this;return S._domHandlers_=S._domHandlers_||{},x(f,w[z],S._domHandlers_[z]),D[z]&&x(f,D[z],S._domHandlers_[z]),delete S._domHandlers_[z],this};const M=A;function G(f,z){return this.identifier=z.identifier,this.position=z.position,this.frontPosition=z.frontPosition,this.collection=f,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(z),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=G.id,G.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}G.prototype=new M,G.constructor=G,G.id=0,G.prototype.buildEl=function(f){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},G.prototype.stylize=function(){if(this.options.dataOnly)return this;var f=this.options.fadeTime+"ms",z=function(){var f=c("borderRadius");for(var z in f)f.hasOwnProperty(z)&&(f[z]="50%");return f}(),w=K("transition","opacity",f),S={};return S.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},S.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},S.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},y(S.el,w),"circle"===this.options.shape&&y(S.back,z),y(S.front,z),this.applyStyles(S),this},G.prototype.applyStyles=function(f){for(var z in this.ui)if(this.ui.hasOwnProperty(z))for(var w in f[z])this.ui[z].style[w]=f[z][w];return this},G.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},G.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},G.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},G.prototype.show=function(f){var z=this;return z.options.dataOnly||(clearTimeout(z.removeTimeout),clearTimeout(z.showTimeout),clearTimeout(z.restTimeout),z.addToDom(),z.restCallback(),setTimeout((function(){z.ui.el.style.opacity=1}),0),z.showTimeout=setTimeout((function(){z.trigger("shown",z.instance),"function"==typeof f&&f.call(this)}),z.options.fadeTime)),z},G.prototype.hide=function(f){var z=this;if(z.options.dataOnly)return z;if(z.ui.el.style.opacity=z.options.restOpacity,clearTimeout(z.removeTimeout),clearTimeout(z.showTimeout),clearTimeout(z.restTimeout),z.removeTimeout=setTimeout((function(){var w="dynamic"===z.options.mode?"none":"block";z.ui.el.style.display=w,"function"==typeof f&&f.call(z),z.trigger("hidden",z.instance)}),z.options.fadeTime),z.options.restJoystick){var w=z.options.restJoystick,S={};S.x=!0===w||!1!==w.x?0:z.instance.frontPosition.x,S.y=!0===w||!1!==w.y?0:z.instance.frontPosition.y,z.setPosition(f,S)}return z},G.prototype.setPosition=function(f,z){var w=this;w.frontPosition={x:z.x,y:z.y};var S=w.options.fadeTime+"ms",C={};C.front=K("transition",["transform"],S);var E={front:{}};E.front={transform:"translate("+w.frontPosition.x+"px,"+w.frontPosition.y+"px)"},w.applyStyles(C),w.applyStyles(E),w.restTimeout=setTimeout((function(){"function"==typeof f&&f.call(w),w.restCallback()}),w.options.fadeTime)},G.prototype.restCallback=function(){var f=this,z={};z.front=K("transition","none",""),f.applyStyles(z),f.trigger("rested",f.instance)},G.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},G.prototype.computeDirection=function(f){var z,w,S,C=f.angle.radian,E=Math.PI/4,F=Math.PI/2;if(C>E&&C<3*E&&!f.lockX?z="up":C>-E&&C<=E&&!f.lockY?z="left":C>3*-E&&C<=-E&&!f.lockX?z="down":f.lockY||(z="right"),f.lockY||(w=C>-F&&C<F?"left":"right"),f.lockX||(S=C>0?"up":"down"),f.force>this.options.threshold){var J,x={};for(J in this.direction)this.direction.hasOwnProperty(J)&&(x[J]=this.direction[J]);var u={};for(J in this.direction={x:w,y:S,angle:z},f.direction=this.direction,x)x[J]===this.direction[J]&&(u[J]=!0);if(u.x&&u.y&&u.angle)return f;u.x&&u.y||this.trigger("plain",f),u.x||this.trigger("plain:"+w,f),u.y||this.trigger("plain:"+S,f),u.angle||this.trigger("dir dir:"+z,f)}else this.resetDirection();return f};const I=G;function n(f,z){var w=this;w.nipples=[],w.idles=[],w.actives=[],w.ids=[],w.pressureIntervals={},w.manager=f,w.id=n.id,n.id+=1,w.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},w.config(z),"static"!==w.options.mode&&"semi"!==w.options.mode||(w.options.multitouch=!1),w.options.multitouch||(w.options.maxNumberOfNipples=1);var S=getComputedStyle(w.options.zone.parentElement);return S&&"flex"===S.display&&(w.parentIsFlex=!0),w.updateBox(),w.prepareNipples(),w.Ol(),w.begin(),w.nipples}n.prototype=new M,n.constructor=n,n.id=0,n.prototype.prepareNipples=function(){var f=this,z=f.nipples;z.on=f.on.bind(f),z.off=f.off.bind(f),z.options=f.options,z.destroy=f.destroy.bind(f),z.ids=f.ids,z.id=f.id,z.processOnMove=f.processOnMove.bind(f),z.processOnEnd=f.processOnEnd.bind(f),z.get=function(f){if(void 0===f)return z[0];for(var w=0,S=z.length;w<S;w+=1)if(z[w].identifier===f)return z[w];return!1}},n.prototype.Ol=function(){var f=this;f.bindEvt(f.options.zone,"start"),f.options.zone.style.touchAction="none",f.options.zone.style.msTouchAction="none"},n.prototype.begin=function(){var f=this,z=f.options;if("static"===z.mode){var w=f.createNipple(z.position,f.manager.getIdentifier());w.add(),f.idles.push(w)}},n.prototype.createNipple=function(f,z){var w=this,S=w.manager.scroll,C={},E=w.options,F=w.parentIsFlex?S.x:S.x+w.box.left,J=w.parentIsFlex?S.y:S.y+w.box.top;if(f.x&&f.y)C={x:f.x-F,y:f.y-J};else if(f.top||f.right||f.bottom||f.left){var x=document.createElement("DIV");x.style.display="hidden",x.style.top=f.top,x.style.right=f.right,x.style.bottom=f.bottom,x.style.left=f.left,x.style.position="absolute",E.zone.appendChild(x);var u=x.getBoundingClientRect();E.zone.removeChild(x),C=f,f={x:u.left+S.x,y:u.top+S.y}}var h=new I(w,{color:E.color,size:E.size,threshold:E.threshold,fadeTime:E.fadeTime,dataOnly:E.dataOnly,restJoystick:E.restJoystick,restOpacity:E.restOpacity,mode:E.mode,identifier:z,position:f,zone:E.zone,frontPosition:{x:0,y:0},shape:E.shape});return E.dataOnly||(X(h.ui.el,C),X(h.ui.front,h.frontPosition)),w.nipples.push(h),w.trigger("added "+h.identifier+":added",h),w.manager.trigger("added "+h.identifier+":added",h),w.bindNipple(h),h},n.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},n.prototype.bindNipple=function(f){var z,w=this,S=function(f,S){z=f.type+" "+S.id+":"+f.type,w.trigger(z,S)};f.on("destroyed",w.onDestroyed.bind(w)),f.on("shown hidden rested dir plain",S),f.on("dir:up dir:right dir:down dir:left",S),f.on("plain:up plain:right plain:down plain:left",S)},n.prototype.pressureFn=function(f,z,w){var S=this,C=0;clearInterval(S.pressureIntervals[w]),S.pressureIntervals[w]=setInterval(function(){var w=f.force||f.pressure||f.webkitForce||0;w!==C&&(z.trigger("pressure",w),S.trigger("pressure "+z.identifier+":pressure",w),C=w)}.bind(S),100)},n.prototype.onstart=function(f){var z=this,w=z.options,S=f;return f=u(f),z.updateBox(),e(f,(function(C){z.actives.length<w.maxNumberOfNipples?z.processOnStart(C):S.type.match(/^touch/)&&(Object.keys(z.manager.ids).forEach((function(w){if(Object.values(S.touches).findIndex((function(f){return f.identifier===w}))<0){var C=[f[0]];C.identifier=w,z.processOnEnd(C)}})),z.actives.length<w.maxNumberOfNipples&&z.processOnStart(C))})),z.manager.bindDocument(),!1},n.prototype.processOnStart=function(f){var z,w=this,C=w.options,E=w.manager.getIdentifier(f),F=f.force||f.pressure||f.webkitForce||0,J={x:f.pageX,y:f.pageY},x=w.getOrCreate(E,J);x.identifier!==E&&w.manager.removeIdentifier(x.identifier),x.identifier=E;var u=function(z){z.trigger("start",z),w.trigger("start "+z.id+":start",z),z.show(),F>0&&w.pressureFn(f,z,z.identifier),w.processOnMove(f)};if((z=w.idles.indexOf(x))>=0&&w.idles.splice(z,1),w.actives.push(x),w.ids.push(x.identifier),"semi"!==C.mode)u(x);else{if(!(S(J,x.position)<=C.catchDistance))return x.destroy(),void w.processOnStart(f);u(x)}return x},n.prototype.getOrCreate=function(f,z){var w,S=this,C=S.options;return/(semi|static)/.test(C.mode)?(w=S.idles[0])?(S.idles.splice(0,1),w):"semi"===C.mode?S.createNipple(z,f):(console.warn("Coudln't find the needed nipple."),!1):w=S.createNipple(z,f)},n.prototype.processOnMove=function(f){var z=this,w=z.options,E=z.manager.getIdentifier(f),F=z.nipples.get(E),J=z.manager.scroll;if(function(f){return isNaN(f.buttons)?0!==f.pressure:0!==f.buttons}(f)){if(!F)return console.error("Found zombie joystick with ID "+E),void z.manager.removeIdentifier(E);if(w.dynamicPage){var x=F.el.getBoundingClientRect();F.position={x:J.x+x.left,y:J.y+x.top}}F.identifier=E;var u=F.options.size/2,h={x:f.pageX,y:f.pageY};w.lockX&&(h.y=F.position.y),w.lockY&&(h.x=F.position.x);var X,K,c,y,e,O,d,B,V,W,T=S(h,F.position),v=(X=h,c=(K=F.position).x-X.x,y=K.y-X.y,function(f){return f*(180/Math.PI)}(Math.atan2(y,c))),D=C(v),A=T/u,M={distance:T,position:h};if("circle"===F.options.shape?(e=Math.min(T,u),d=F.position,B=e,W={x:0,y:0},V=C(V=v),W.x=d.x-B*Math.cos(V),W.y=d.y-B*Math.sin(V),O=W):(O=function(f,z,w){return{x:Math.min(Math.max(f.x,z.x-w),z.x+w),y:Math.min(Math.max(f.y,z.y-w),z.y+w)}}(h,F.position,u),e=S(O,F.position)),w.follow){if(T>u){var G=h.x-O.x,I=h.y-O.y;F.position.x+=G,F.position.y+=I,F.el.style.top=F.position.y-(z.box.top+J.y)+"px",F.el.style.left=F.position.x-(z.box.left+J.x)+"px",T=S(h,F.position)}}else h=O,T=e;var n=h.x-F.position.x,P=h.y-F.position.y;F.frontPosition={x:n,y:P},w.dataOnly||(F.ui.front.style.transform="translate("+n+"px,"+P+"px)");var R={identifier:F.identifier,position:h,force:A,pressure:f.force||f.pressure||f.webkitForce||0,distance:T,angle:{radian:D,degree:v},vector:{x:n/u,y:-P/u},raw:M,instance:F,lockX:w.lockX,lockY:w.lockY};(R=F.computeDirection(R)).angle={radian:C(180-v),degree:180-v},F.trigger("move",R),z.trigger("move "+F.id+":move",R)}else this.processOnEnd(f)},n.prototype.processOnEnd=function(f){var z=this,w=z.options,S=z.manager.getIdentifier(f),C=z.nipples.get(S),E=z.manager.removeIdentifier(C.identifier);C&&(w.dataOnly||C.hide((function(){"dynamic"===w.mode&&(C.trigger("removed",C),z.trigger("removed "+C.id+":removed",C),z.manager.trigger("removed "+C.id+":removed",C),C.destroy())})),clearInterval(z.pressureIntervals[C.identifier]),C.resetDirection(),C.trigger("end",C),z.trigger("end "+C.id+":end",C),z.ids.indexOf(C.identifier)>=0&&z.ids.splice(z.ids.indexOf(C.identifier),1),z.actives.indexOf(C)>=0&&z.actives.splice(z.actives.indexOf(C),1),/(semi|static)/.test(w.mode)?z.idles.push(C):z.nipples.indexOf(C)>=0&&z.nipples.splice(z.nipples.indexOf(C),1),z.manager.unbindDocument(),/(semi|static)/.test(w.mode)&&(z.manager.ids[E.id]=E.identifier))},n.prototype.onDestroyed=function(f,z){var w=this;w.nipples.indexOf(z)>=0&&w.nipples.splice(w.nipples.indexOf(z),1),w.actives.indexOf(z)>=0&&w.actives.splice(w.actives.indexOf(z),1),w.idles.indexOf(z)>=0&&w.idles.splice(w.idles.indexOf(z),1),w.ids.indexOf(z.identifier)>=0&&w.ids.splice(w.ids.indexOf(z.identifier),1),w.manager.removeIdentifier(z.identifier),w.manager.unbindDocument()},n.prototype.destroy=function(){var f=this;for(var z in f.unbindEvt(f.options.zone,"start"),f.nipples.forEach((function(f){f.destroy()})),f.pressureIntervals)f.pressureIntervals.hasOwnProperty(z)&&clearInterval(f.pressureIntervals[z]);f.trigger("destroyed",f.nipples),f.manager.unbindDocument(),f.off()};const P=n;function R(f){var z=this;z.ids={},z.index=0,z.collections=[],z.scroll=h(),z.config(f),z.prepareCollections();var w=function(){var f;z.collections.forEach((function(w){w.forEach((function(w){f=w.el.getBoundingClientRect(),w.position={x:z.scroll.x+f.left,y:z.scroll.y+f.top}}))}))};J(window,"resize",(function(){F(w)}));var S=function(){z.scroll=h()};return J(window,"scroll",(function(){F(S)})),z.collections}R.prototype=new M,R.constructor=R,R.prototype.prepareCollections=function(){var f=this;f.collections.create=f.create.bind(f),f.collections.on=f.on.bind(f),f.collections.off=f.off.bind(f),f.collections.destroy=f.destroy.bind(f),f.collections.get=function(z){var w;return f.collections.every((function(f){return!(w=f.get(z))})),w}},R.prototype.create=function(f){return this.createCollection(f)},R.prototype.createCollection=function(f){var z=this,w=new P(z,f);return z.bindCollection(w),z.collections.push(w),w},R.prototype.bindCollection=function(f){var z,w=this,S=function(f,S){z=f.type+" "+S.id+":"+f.type,w.trigger(z,S)};f.on("destroyed",w.onDestroyed.bind(w)),f.on("shown hidden rested dir plain",S),f.on("dir:up dir:right dir:down dir:left",S),f.on("plain:up plain:right plain:down plain:left",S)},R.prototype.bindDocument=function(){var f=this;f.binded||(f.bindEvt(document,"move").bindEvt(document,"end"),f.binded=!0)},R.prototype.unbindDocument=function(f){var z=this;Object.keys(z.ids).length&&!0!==f||(z.unbindEvt(document,"move").unbindEvt(document,"end"),z.binded=!1)},R.prototype.getIdentifier=function(f){var z;return f?void 0===(z=void 0===f.identifier?f.pointerId:f.identifier)&&(z=this.latest||0):z=this.index,void 0===this.ids[z]&&(this.ids[z]=this.index,this.index+=1),this.latest=z,this.ids[z]},R.prototype.removeIdentifier=function(f){var z={};for(var w in this.ids)if(this.ids[w]===f){z.id=w,z.identifier=this.ids[w],delete this.ids[w];break}return z},R.prototype.onmove=function(f){return this.onAny("move",f),!1},R.prototype.onend=function(f){return this.onAny("end",f),!1},R.prototype.oncancel=function(f){return this.onAny("end",f),!1},R.prototype.onAny=function(f,z){var w,S=this,C="processOn"+f.charAt(0).toUpperCase()+f.slice(1);z=u(z);var E=function(f,z,w){w.ids.indexOf(z)>=0&&(w[C](f),f._found_=!0)};return e(z,(function(f){w=S.getIdentifier(f),e(S.collections,E.bind(null,f,w)),f._found_||S.removeIdentifier(w)})),!1},R.prototype.destroy=function(){var f=this;f.unbindDocument(!0),f.ids={},f.index=0,f.collections.forEach((function(f){f.destroy()})),f.off()},R.prototype.onDestroyed=function(f,z){var w=this;if(w.collections.indexOf(z)<0)return!1;w.collections.splice(w.collections.indexOf(z),1)};var q=new R;const a={create:function(f){return q.create(f)},factory:q};return z.default})(),f.exports=z()},11958:(f,z,w)=>{"use strict";const{Deflate:S,deflate:C,deflateRaw:E,gzip:F}=w(11961),{Inflate:J,inflate:x,inflateRaw:u,ungzip:h}=w(12006),X=w(11989);f.exports.Deflate=S,f.exports.deflate=C,f.exports.deflateRaw=E,f.exports.gzip=F,f.exports.Inflate=J,f.exports.inflate=x,f.exports.inflateRaw=u,f.exports.ungzip=h,f.exports.constants=X},11961:(f,z,w)=>{"use strict";const S=w(11965),C=w(11991),E=w(11998),F=w(11985),J=w(12003),x=Object.prototype.toString,{Z_NO_FLUSH:u,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:X,Z_FINISH:K,Z_OK:c,Z_STREAM_END:y,Z_DEFAULT_COMPRESSION:e,Z_DEFAULT_STRATEGY:O,Z_DEFLATED:d}=w(11989);function B(f){this.options=C.assign({level:e,method:d,Ja:16384,windowBits:15,memLevel:8,strategy:O},f||{});let z=this.options;z.raw&&z.windowBits>0?z.windowBits=-z.windowBits:z.gzip&&z.windowBits>0&&z.windowBits<16&&(z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let w=S.deflateInit2(this.strm,z.level,z.method,z.windowBits,z.memLevel,z.strategy);if(w!==c)throw new Error(F[w]);if(z.header&&S.deflateSetHeader(this.strm,z.header),z.dictionary){let f;if(f="string"===typeof z.dictionary?E.string2buf(z.dictionary):"[object ArrayBuffer]"===x.call(z.dictionary)?new Uint8Array(z.dictionary):z.dictionary,w=S.deflateSetDictionary(this.strm,f),w!==c)throw new Error(F[w]);this._dict_set=!0}}function V(f,z){const w=new B(z);if(w.push(f,!0),w.err)throw w.msg||F[w.err];return w.result}B.prototype.push=function(f,z){const w=this.strm,C=this.options.Ja;let F,J;if(this.ended)return!1;for(J=z===~~z?z:!0===z?K:u,"string"===typeof f?w.input=E.string2buf(f):"[object ArrayBuffer]"===x.call(f)?w.input=new Uint8Array(f):w.input=f,w.next_in=0,w.avail_in=w.input.length;;)if(0===w.avail_out&&(w.output=new Uint8Array(C),w.next_out=0,w.avail_out=C),(J===h||J===X)&&w.avail_out<=6)this.onData(w.output.subarray(0,w.next_out)),w.avail_out=0;else{if(F=S.deflate(w,J),F===y)return w.next_out>0&&this.onData(w.output.subarray(0,w.next_out)),F=S.deflateEnd(this.strm),this.onEnd(F),this.ended=!0,F===c;if(0!==w.avail_out){if(J>0&&w.next_out>0)this.onData(w.output.subarray(0,w.next_out)),w.avail_out=0;else if(0===w.avail_in)break}else this.onData(w.output)}return!0},B.prototype.onData=function(f){this.chunks.push(f)},B.prototype.onEnd=function(f){f===c&&(this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},f.exports.Deflate=B,f.exports.deflate=V,f.exports.deflateRaw=function(f,z){return(z=z||{}).raw=!0,V(f,z)},f.exports.gzip=function(f,z){return(z=z||{}).gzip=!0,V(f,z)},f.exports.constants=w(11989)},12006:(f,z,w)=>{"use strict";const S=w(12011),C=w(11991),E=w(11998),F=w(11985),J=w(12003),x=w(12024),u=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:X,Z_OK:K,Z_STREAM_END:c,Z_NEED_DICT:y,Z_STREAM_ERROR:e,Z_DATA_ERROR:O,Z_MEM_ERROR:d}=w(11989);function B(f){this.options=C.assign({Ja:65536,windowBits:15,to:""},f||{});const z=this.options;z.raw&&z.windowBits>=0&&z.windowBits<16&&(z.windowBits=-z.windowBits,0===z.windowBits&&(z.windowBits=-15)),!(z.windowBits>=0&&z.windowBits<16)||f&&f.windowBits||(z.windowBits+=32),z.windowBits>15&&z.windowBits<48&&0===(15&z.windowBits)&&(z.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let w=S.inflateInit2(this.strm,z.windowBits);if(w!==K)throw new Error(F[w]);if(this.header=new x,S.inflateGetHeader(this.strm,this.header),z.dictionary&&("string"===typeof z.dictionary?z.dictionary=E.string2buf(z.dictionary):"[object ArrayBuffer]"===u.call(z.dictionary)&&(z.dictionary=new Uint8Array(z.dictionary)),z.raw&&(w=S.inflateSetDictionary(this.strm,z.dictionary),w!==K)))throw new Error(F[w])}function V(f,z){const w=new B(z);if(w.push(f),w.err)throw w.msg||F[w.err];return w.result}B.prototype.push=function(f,z){const w=this.strm,C=this.options.Ja,F=this.options.dictionary;let J,x,B;if(this.ended)return!1;for(x=z===~~z?z:!0===z?X:h,"[object ArrayBuffer]"===u.call(f)?w.input=new Uint8Array(f):w.input=f,w.next_in=0,w.avail_in=w.input.length;;){for(0===w.avail_out&&(w.output=new Uint8Array(C),w.next_out=0,w.avail_out=C),J=S.inflate(w,x),J===y&&F&&(J=S.inflateSetDictionary(w,F),J===K?J=S.inflate(w,x):J===O&&(J=y));w.avail_in>0&&J===c&&w.state.wrap>0&&0!==f[w.next_in];)S.inflateReset(w),J=S.inflate(w,x);switch(J){case e:case O:case y:case d:return this.onEnd(J),this.ended=!0,!1}if(B=w.avail_out,w.next_out&&(0===w.avail_out||J===c))if("string"===this.options.to){let f=E.utf8border(w.output,w.next_out),z=w.next_out-f,S=E.buf2string(w.output,f);w.next_out=z,w.avail_out=C-z,z&&w.output.set(w.output.subarray(f,f+z),0),this.onData(S)}else this.onData(w.output.length===w.next_out?w.output:w.output.subarray(0,w.next_out));if(J!==K||0!==B){if(J===c)return J=S.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,!0;if(0===w.avail_in)break}}return!0},B.prototype.onData=function(f){this.chunks.push(f)},B.prototype.onEnd=function(f){f===K&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},f.exports.Inflate=B,f.exports.inflate=V,f.exports.inflateRaw=function(f,z){return(z=z||{}).raw=!0,V(f,z)},f.exports.ungzip=V,f.exports.constants=w(11989)},11991:f=>{"use strict";const z=(f,z)=>Object.prototype.hasOwnProperty.call(f,z);f.exports.assign=function(f){const w=Array.prototype.slice.call(arguments,1);for(;w.length;){const S=w.shift();if(S){if("object"!==typeof S)throw new TypeError(S+"must be non-object");for(const w in S)z(S,w)&&(f[w]=S[w])}}return f},f.exports.flattenChunks=f=>{let z=0;for(let S=0,C=f.length;S<C;S++)z+=f[S].length;const w=new Uint8Array(z);for(let S=0,C=0,E=f.length;S<E;S++){let z=f[S];w.set(z,C),C+=z.length}return w}},11998:f=>{"use strict";let z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(S){z=!1}const w=new Uint8Array(256);for(let C=0;C<256;C++)w[C]=C>=252?6:C>=248?5:C>=240?4:C>=224?3:C>=192?2:1;w[254]=w[254]=1,f.exports.string2buf=f=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(f);let z,w,S,C,E,F=f.length,J=0;for(C=0;C<F;C++)w=f.charCodeAt(C),55296===(64512&w)&&C+1<F&&(S=f.charCodeAt(C+1),56320===(64512&S)&&(w=65536+(w-55296<<10)+(S-56320),C++)),J+=w<128?1:w<2048?2:w<65536?3:4;for(z=new Uint8Array(J),E=0,C=0;E<J;C++)w=f.charCodeAt(C),55296===(64512&w)&&C+1<F&&(S=f.charCodeAt(C+1),56320===(64512&S)&&(w=65536+(w-55296<<10)+(S-56320),C++)),w<128?z[E++]=w:w<2048?(z[E++]=192|w>>>6,z[E++]=128|63&w):w<65536?(z[E++]=224|w>>>12,z[E++]=128|w>>>6&63,z[E++]=128|63&w):(z[E++]=240|w>>>18,z[E++]=128|w>>>12&63,z[E++]=128|w>>>6&63,z[E++]=128|63&w);return z};f.exports.buf2string=(f,S)=>{const C=S||f.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(f.subarray(0,S));let E,F;const J=new Array(2*C);for(F=0,E=0;E<C;){let z=f[E++];if(z<128){J[F++]=z;continue}let S=w[z];if(S>4)J[F++]=65533,E+=S-1;else{for(z&=2===S?31:3===S?15:7;S>1&&E<C;)z=z<<6|63&f[E++],S--;S>1?J[F++]=65533:z<65536?J[F++]=z:(z-=65536,J[F++]=55296|z>>10&1023,J[F++]=56320|1023&z)}}return((f,w)=>{if(w<65534&&f.subarray&&z)return String.fromCharCode.apply(null,f.length===w?f:f.subarray(0,w));let S="";for(let z=0;z<w;z++)S+=String.fromCharCode(f[z]);return S})(J,F)},f.exports.utf8border=(f,z)=>{(z=z||f.length)>f.length&&(z=f.length);let S=z-1;for(;S>=0&&128===(192&f[S]);)S--;return S<0||0===S?z:S+w[f[S]]>z?S:z}},11973:f=>{"use strict";f.exports=(f,z,w,S)=>{let C=65535&f,E=f>>>16&65535,F=0;for(;0!==w;){F=w>2e3?2e3:w,w-=F;do{C=C+z[S++]|0,E=E+C|0}while(--F);C%=65521,E%=65521}return C|E<<16}},11989:f=>{"use strict";f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11976:f=>{"use strict";const z=new Uint32Array((()=>{let f,z=[];for(var w=0;w<256;w++){f=w;for(var S=0;S<8;S++)f=1&f?3988292384^f>>>1:f>>>1;z[w]=f}return z})());f.exports=(f,w,S,C)=>{const E=z,F=C+S;f^=-1;for(let z=C;z<F;z++)f=f>>>8^E[255&(f^w[z])];return~f}},11965:(f,z,w)=>{"use strict";const{_tr_init:S,_tr_stored_block:C,_tr_flush_block:E,_tr_tally:F,_tr_align:J}=w(11971),x=w(11973),u=w(11976),h=w(11985),{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:c,Z_FINISH:y,Z_BLOCK:e,Z_OK:O,Z_STREAM_END:d,Z_STREAM_ERROR:B,Z_DATA_ERROR:V,Z_BUF_ERROR:W,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:v,Z_HUFFMAN_ONLY:D,Z_RLE:A,Z_FIXED:M,Z_DEFAULT_STRATEGY:G,Z_UNKNOWN:I,Z_DEFLATED:n}=w(11989),P=258,R=262,q=103,a=113,s=666,H=(f,z)=>(f.msg=h[z],z),L=f=>(f<<1)-(f>4?9:0),U=f=>{let z=f.length;for(;--z>=0;)f[z]=0};let i=(f,z,w)=>(z<<f.hash_shift^w)&f.hash_mask;const m=f=>{const z=f.state;let w=z.pending;w>f.avail_out&&(w=f.avail_out),0!==w&&(f.output.set(z.pending_buf.subarray(z.pending_out,z.pending_out+w),f.next_out),f.next_out+=w,z.pending_out+=w,f.total_out+=w,f.avail_out-=w,z.pending-=w,0===z.pending&&(z.pending_out=0))},r=(f,z)=>{E(f,f.block_start>=0?f.block_start:-1,f.strstart-f.block_start,z),f.block_start=f.strstart,m(f.strm)},o=(f,z)=>{f.pending_buf[f.pending++]=z},p=(f,z)=>{f.pending_buf[f.pending++]=z>>>8&255,f.pending_buf[f.pending++]=255&z},Y=(f,z,w,S)=>{let C=f.avail_in;return C>S&&(C=S),0===C?0:(f.avail_in-=C,z.set(f.input.subarray(f.next_in,f.next_in+C),w),1===f.state.wrap?f.adler=x(f.adler,z,C,w):2===f.state.wrap&&(f.adler=u(f.adler,z,C,w)),f.next_in+=C,f.total_in+=C,C)},t=(f,z)=>{let w,S,C=f.max_chain_length,E=f.strstart,F=f.prev_length,J=f.nice_match;const x=f.strstart>f.w_size-R?f.strstart-(f.w_size-R):0,u=f.window,h=f.w_mask,X=f.prev,K=f.strstart+P;let c=u[E+F-1],y=u[E+F];f.prev_length>=f.good_match&&(C>>=2),J>f.lookahead&&(J=f.lookahead);do{if(w=z,u[w+F]===y&&u[w+F-1]===c&&u[w]===u[E]&&u[++w]===u[E+1]){E+=2,w++;do{}while(u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&u[++E]===u[++w]&&E<K);if(S=P-(K-E),E=K-P,S>F){if(f.match_start=z,F=S,S>=J)break;c=u[E+F-1],y=u[E+F]}}}while((z=X[z&h])>x&&0!==--C);return F<=f.lookahead?F:f.lookahead},Z=f=>{const z=f.w_size;let w,S,C,E,F;do{if(E=f.window_size-f.lookahead-f.strstart,f.strstart>=z+(z-R)){f.window.set(f.window.subarray(z,z+z),0),f.match_start-=z,f.strstart-=z,f.block_start-=z,S=f.hash_size,w=S;do{C=f.head[--w],f.head[w]=C>=z?C-z:0}while(--S);S=z,w=S;do{C=f.prev[--w],f.prev[w]=C>=z?C-z:0}while(--S);E+=z}if(0===f.strm.avail_in)break;if(S=Y(f.strm,f.window,f.strstart+f.lookahead,E),f.lookahead+=S,f.lookahead+f.insert>=3)for(F=f.strstart-f.insert,f.ins_h=f.window[F],f.ins_h=i(f,f.ins_h,f.window[F+1]);f.insert&&(f.ins_h=i(f,f.ins_h,f.window[F+3-1]),f.prev[F&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=F,F++,f.insert--,!(f.lookahead+f.insert<3)););}while(f.lookahead<R&&0!==f.strm.avail_in)},b=(f,z)=>{let w,S;for(;;){if(f.lookahead<R){if(Z(f),f.lookahead<R&&z===X)return 1;if(0===f.lookahead)break}if(w=0,f.lookahead>=3&&(f.ins_h=i(f,f.ins_h,f.window[f.strstart+3-1]),w=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!==w&&f.strstart-w<=f.w_size-R&&(f.match_length=t(f,w)),f.match_length>=3)if(S=F(f,f.strstart-f.match_start,f.match_length-3),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=3){f.match_length--;do{f.strstart++,f.ins_h=i(f,f.ins_h,f.window[f.strstart+3-1]),w=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart}while(0!==--f.match_length);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=i(f,f.ins_h,f.window[f.strstart+1]);else S=F(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(S&&(r(f,!1),0===f.strm.avail_out))return 1}return f.insert=f.strstart<2?f.strstart:2,z===y?(r(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(r(f,!1),0===f.strm.avail_out)?1:2},Q=(f,z)=>{let w,S,C;for(;;){if(f.lookahead<R){if(Z(f),f.lookahead<R&&z===X)return 1;if(0===f.lookahead)break}if(w=0,f.lookahead>=3&&(f.ins_h=i(f,f.ins_h,f.window[f.strstart+3-1]),w=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=2,0!==w&&f.prev_length<f.max_lazy_match&&f.strstart-w<=f.w_size-R&&(f.match_length=t(f,w),f.match_length<=5&&(f.strategy===v||3===f.match_length&&f.strstart-f.match_start>4096)&&(f.match_length=2)),f.prev_length>=3&&f.match_length<=f.prev_length){C=f.strstart+f.lookahead-3,S=F(f,f.strstart-1-f.prev_match,f.prev_length-3),f.lookahead-=f.prev_length-1,f.prev_length-=2;do{++f.strstart<=C&&(f.ins_h=i(f,f.ins_h,f.window[f.strstart+3-1]),w=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart)}while(0!==--f.prev_length);if(f.match_available=0,f.match_length=2,f.strstart++,S&&(r(f,!1),0===f.strm.avail_out))return 1}else if(f.match_available){if(S=F(f,0,f.window[f.strstart-1]),S&&r(f,!1),f.strstart++,f.lookahead--,0===f.strm.avail_out)return 1}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(S=F(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<2?f.strstart:2,z===y?(r(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(r(f,!1),0===f.strm.avail_out)?1:2};function g(f,z,w,S,C){this.good_length=f,this.max_lazy=z,this.nice_length=w,this.max_chain=S,this.func=C}const k=[new g(0,0,0,0,((f,z)=>{let w=65535;for(w>f.pending_buf_size-5&&(w=f.pending_buf_size-5);;){if(f.lookahead<=1){if(Z(f),0===f.lookahead&&z===X)return 1;if(0===f.lookahead)break}f.strstart+=f.lookahead,f.lookahead=0;const S=f.block_start+w;if((0===f.strstart||f.strstart>=S)&&(f.lookahead=f.strstart-S,f.strstart=S,r(f,!1),0===f.strm.avail_out))return 1;if(f.strstart-f.block_start>=f.w_size-R&&(r(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,z===y?(r(f,!0),0===f.strm.avail_out?3:4):(f.strstart>f.block_start&&(r(f,!1),f.strm.avail_out),1)})),new g(4,4,8,4,b),new g(4,5,16,8,b),new g(4,6,32,32,b),new g(4,4,16,16,Q),new g(8,16,32,32,Q),new g(8,16,128,128,Q),new g(8,32,128,256,Q),new g(32,128,258,1024,Q),new g(32,258,258,4096,Q)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=n,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const l=f=>{if(!f||!f.state)return H(f,B);f.total_in=f.total_out=0,f.data_type=I;const z=f.state;return z.pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?42:a,f.adler=2===z.wrap?0:1,z.last_flush=X,S(z),O},N=f=>{const z=l(f);var w;return z===O&&((w=f.state).window_size=2*w.w_size,U(w.head),w.max_lazy_match=k[w.level].max_lazy,w.good_match=k[w.level].good_length,w.nice_match=k[w.level].nice_length,w.max_chain_length=k[w.level].max_chain,w.strstart=0,w.block_start=0,w.lookahead=0,w.insert=0,w.match_length=w.prev_length=2,w.match_available=0,w.ins_h=0),z},ff=(f,z,w,S,C,E)=>{if(!f)return B;let F=1;if(z===T&&(z=6),S<0?(F=0,S=-S):S>15&&(F=2,S-=16),C<1||C>9||w!==n||S<8||S>15||z<0||z>9||E<0||E>M)return H(f,B);8===S&&(S=9);const J=new j;return f.state=J,J.strm=f,J.wrap=F,J.gzhead=null,J.w_bits=S,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=C+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+3-1)/3),J.window=new Uint8Array(2*J.w_size),J.head=new Uint16Array(J.hash_size),J.prev=new Uint16Array(J.w_size),J.lit_bufsize=1<<C+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new Uint8Array(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=z,J.strategy=E,J.method=w,N(f)};f.exports.deflateInit=(f,z)=>ff(f,z,n,15,8,G),f.exports.deflateInit2=ff,f.exports.deflateReset=N,f.exports.deflateResetKeep=l,f.exports.deflateSetHeader=(f,z)=>f&&f.state?2!==f.state.wrap?B:(f.state.gzhead=z,O):B,f.exports.deflate=(f,z)=>{let w,S;if(!f||!f.state||z>e||z<0)return f?H(f,B):B;const E=f.state;if(!f.output||!f.input&&0!==f.avail_in||E.status===s&&z!==y)return H(f,0===f.avail_out?W:B);E.strm=f;const x=E.last_flush;if(E.last_flush=z,42===E.status)if(2===E.wrap)f.adler=0,o(E,31),o(E,139),o(E,8),E.gzhead?(o(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),o(E,255&E.gzhead.time),o(E,E.gzhead.time>>8&255),o(E,E.gzhead.time>>16&255),o(E,E.gzhead.time>>24&255),o(E,9===E.level?2:E.strategy>=D||E.level<2?4:0),o(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(o(E,255&E.gzhead.extra.length),o(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(f.adler=u(f.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(o(E,0),o(E,0),o(E,0),o(E,0),o(E,0),o(E,9===E.level?2:E.strategy>=D||E.level<2?4:0),o(E,3),E.status=a);else{let z=n+(E.w_bits-8<<4)<<8,w=-1;w=E.strategy>=D||E.level<2?0:E.level<6?1:6===E.level?2:3,z|=w<<6,0!==E.strstart&&(z|=32),z+=31-z%31,E.status=a,p(E,z),0!==E.strstart&&(p(E,f.adler>>>16),p(E,65535&f.adler)),f.adler=1}if(69===E.status)if(E.gzhead.extra){for(w=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),m(f),w=E.pending,E.pending!==E.pending_buf_size));)o(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(73===E.status)if(E.gzhead.name){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),m(f),w=E.pending,E.pending===E.pending_buf_size)){S=1;break}S=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,o(E,S)}while(0!==S);E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),0===S&&(E.gzindex=0,E.status=91)}else E.status=91;if(91===E.status)if(E.gzhead.comment){w=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),m(f),w=E.pending,E.pending===E.pending_buf_size)){S=1;break}S=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,o(E,S)}while(0!==S);E.gzhead.hcrc&&E.pending>w&&(f.adler=u(f.adler,E.pending_buf,E.pending-w,w)),0===S&&(E.status=q)}else E.status=q;if(E.status===q&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&m(f),E.pending+2<=E.pending_buf_size&&(o(E,255&f.adler),o(E,f.adler>>8&255),f.adler=0,E.status=a)):E.status=a),0!==E.pending){if(m(f),0===f.avail_out)return E.last_flush=-1,O}else if(0===f.avail_in&&L(z)<=L(x)&&z!==y)return H(f,W);if(E.status===s&&0!==f.avail_in)return H(f,W);if(0!==f.avail_in||0!==E.lookahead||z!==X&&E.status!==s){let w=E.strategy===D?((f,z)=>{let w;for(;;){if(0===f.lookahead&&(Z(f),0===f.lookahead)){if(z===X)return 1;break}if(f.match_length=0,w=F(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++,w&&(r(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,z===y?(r(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(r(f,!1),0===f.strm.avail_out)?1:2})(E,z):E.strategy===A?((f,z)=>{let w,S,C,E;const J=f.window;for(;;){if(f.lookahead<=P){if(Z(f),f.lookahead<=P&&z===X)return 1;if(0===f.lookahead)break}if(f.match_length=0,f.lookahead>=3&&f.strstart>0&&(C=f.strstart-1,S=J[C],S===J[++C]&&S===J[++C]&&S===J[++C])){E=f.strstart+P;do{}while(S===J[++C]&&S===J[++C]&&S===J[++C]&&S===J[++C]&&S===J[++C]&&S===J[++C]&&S===J[++C]&&S===J[++C]&&C<E);f.match_length=P-(E-C),f.match_length>f.lookahead&&(f.match_length=f.lookahead)}if(f.match_length>=3?(w=F(f,1,f.match_length-3),f.lookahead-=f.match_length,f.strstart+=f.match_length,f.match_length=0):(w=F(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++),w&&(r(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,z===y?(r(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(r(f,!1),0===f.strm.avail_out)?1:2})(E,z):k[E.level].func(E,z);if(3!==w&&4!==w||(E.status=s),1===w||3===w)return 0===f.avail_out&&(E.last_flush=-1),O;if(2===w&&(z===K?J(E):z!==e&&(C(E,0,0,!1),z===c&&(U(E.head),0===E.lookahead&&(E.strstart=0,E.block_start=0,E.insert=0))),m(f),0===f.avail_out))return E.last_flush=-1,O}return z!==y?O:E.wrap<=0?d:(2===E.wrap?(o(E,255&f.adler),o(E,f.adler>>8&255),o(E,f.adler>>16&255),o(E,f.adler>>24&255),o(E,255&f.total_in),o(E,f.total_in>>8&255),o(E,f.total_in>>16&255),o(E,f.total_in>>24&255)):(p(E,f.adler>>>16),p(E,65535&f.adler)),m(f),E.wrap>0&&(E.wrap=-E.wrap),0!==E.pending?O:d)},f.exports.deflateEnd=f=>{if(!f||!f.state)return B;const z=f.state.status;return 42!==z&&69!==z&&73!==z&&91!==z&&z!==q&&z!==a&&z!==s?H(f,B):(f.state=null,z===a?H(f,V):O)},f.exports.deflateSetDictionary=(f,z)=>{let w=z.length;if(!f||!f.state)return B;const S=f.state,C=S.wrap;if(2===C||1===C&&42!==S.status||S.lookahead)return B;if(1===C&&(f.adler=x(f.adler,z,w,0)),S.wrap=0,w>=S.w_size){0===C&&(U(S.head),S.strstart=0,S.block_start=0,S.insert=0);let f=new Uint8Array(S.w_size);f.set(z.subarray(w-S.w_size,w),0),z=f,w=S.w_size}const E=f.avail_in,F=f.next_in,J=f.input;for(f.avail_in=w,f.next_in=0,f.input=z,Z(S);S.lookahead>=3;){let f=S.strstart,z=S.lookahead-2;do{S.ins_h=i(S,S.ins_h,S.window[f+3-1]),S.prev[f&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=f,f++}while(--z);S.strstart=f,S.lookahead=2,Z(S)}return S.strstart+=S.lookahead,S.block_start=S.strstart,S.insert=S.lookahead,S.lookahead=0,S.match_length=S.prev_length=2,S.match_available=0,f.next_in=F,f.input=J,f.avail_in=E,S.wrap=C,O},f.exports.deflateInfo="pako deflate (from Nodeca project)"},12024:f=>{"use strict";f.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12020:f=>{"use strict";f.exports=function(f,z){let w,S,C,E,F,J,x,u,h,X,K,c,y,e,O,d,B,V,W,T,v,D,A,M;const G=f.state;w=f.next_in,A=f.input,S=w+(f.avail_in-5),C=f.next_out,M=f.output,E=C-(z-f.avail_out),F=C+(f.avail_out-257),J=G.dmax,x=G.wsize,u=G.whave,h=G.wnext,X=G.window,K=G.hold,c=G.bits,y=G.lencode,e=G.distcode,O=(1<<G.lenbits)-1,d=(1<<G.distbits)-1;f:do{c<15&&(K+=A[w++]<<c,c+=8,K+=A[w++]<<c,c+=8),B=y[K&O];z:for(;;){if(V=B>>>24,K>>>=V,c-=V,V=B>>>16&255,0===V)M[C++]=65535&B;else{if(!(16&V)){if(0===(64&V)){B=y[(65535&B)+(K&(1<<V)-1)];continue z}if(32&V){G.mode=12;break f}f.msg="invalid literal/length code",G.mode=30;break f}W=65535&B,V&=15,V&&(c<V&&(K+=A[w++]<<c,c+=8),W+=K&(1<<V)-1,K>>>=V,c-=V),c<15&&(K+=A[w++]<<c,c+=8,K+=A[w++]<<c,c+=8),B=e[K&d];w:for(;;){if(V=B>>>24,K>>>=V,c-=V,V=B>>>16&255,!(16&V)){if(0===(64&V)){B=e[(65535&B)+(K&(1<<V)-1)];continue w}f.msg="invalid distance code",G.mode=30;break f}if(T=65535&B,V&=15,c<V&&(K+=A[w++]<<c,c+=8,c<V&&(K+=A[w++]<<c,c+=8)),T+=K&(1<<V)-1,T>J){f.msg="invalid distance too far back",G.mode=30;break f}if(K>>>=V,c-=V,V=C-E,T>V){if(V=T-V,V>u&&G.sane){f.msg="invalid distance too far back",G.mode=30;break f}if(v=0,D=X,0===h){if(v+=x-V,V<W){W-=V;do{M[C++]=X[v++]}while(--V);v=C-T,D=M}}else if(h<V){if(v+=x+h-V,V-=h,V<W){W-=V;do{M[C++]=X[v++]}while(--V);if(v=0,h<W){V=h,W-=V;do{M[C++]=X[v++]}while(--V);v=C-T,D=M}}}else if(v+=h-V,V<W){W-=V;do{M[C++]=X[v++]}while(--V);v=C-T,D=M}for(;W>2;)M[C++]=D[v++],M[C++]=D[v++],M[C++]=D[v++],W-=3;W&&(M[C++]=D[v++],W>1&&(M[C++]=D[v++]))}else{v=C-T;do{M[C++]=M[v++],M[C++]=M[v++],M[C++]=M[v++],W-=3}while(W>2);W&&(M[C++]=M[v++],W>1&&(M[C++]=M[v++]))}break}}break}}while(w<S&&C<F);W=c>>3,w-=W,c-=W<<3,K&=(1<<c)-1,f.next_in=w,f.next_out=C,f.avail_in=w<S?S-w+5:5-(w-S),f.avail_out=C<F?F-C+257:257-(C-F),G.hold=K,G.bits=c}},12011:(f,z,w)=>{"use strict";const S=w(11973),C=w(11976),E=w(12020),F=w(12022),{Z_FINISH:J,Z_BLOCK:x,Z_TREES:u,Z_OK:h,Z_STREAM_END:X,Z_NEED_DICT:K,Z_STREAM_ERROR:c,Z_DATA_ERROR:y,Z_MEM_ERROR:e,Z_BUF_ERROR:O,Z_DEFLATED:d}=w(11989),B=12,V=30,W=f=>(f>>>24&255)+(f>>>8&65280)+((65280&f)<<8)+((255&f)<<24);function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const v=f=>{if(!f||!f.state)return c;const z=f.state;return f.total_in=f.total_out=z.total=0,f.msg="",z.wrap&&(f.adler=1&z.wrap),z.mode=1,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new Int32Array(852),z.distcode=z.distdyn=new Int32Array(592),z.sane=1,z.back=-1,h},D=f=>{if(!f||!f.state)return c;const z=f.state;return z.wsize=0,z.whave=0,z.wnext=0,v(f)},A=(f,z)=>{let w;if(!f||!f.state)return c;const S=f.state;return z<0?(w=0,z=-z):(w=1+(z>>4),z<48&&(z&=15)),z&&(z<8||z>15)?c:(null!==S.window&&S.wbits!==z&&(S.window=null),S.wrap=w,S.wbits=z,D(f))},M=(f,z)=>{if(!f)return c;const w=new T;f.state=w,w.window=null;const S=A(f,z);return S!==h&&(f.state=null),S};let G,I,n=!0;const P=f=>{if(n){G=new Int32Array(512),I=new Int32Array(32);let z=0;for(;z<144;)f.lens[z++]=8;for(;z<256;)f.lens[z++]=9;for(;z<280;)f.lens[z++]=7;for(;z<288;)f.lens[z++]=8;for(F(1,f.lens,0,288,G,0,f.work,{bits:9}),z=0;z<32;)f.lens[z++]=5;F(2,f.lens,0,32,I,0,f.work,{bits:5}),n=!1}f.lencode=G,f.lenbits=9,f.distcode=I,f.distbits=5},R=(f,z,w,S)=>{let C;const E=f.state;return null===E.window&&(E.wsize=1<<E.wbits,E.wnext=0,E.whave=0,E.window=new Uint8Array(E.wsize)),S>=E.wsize?(E.window.set(z.subarray(w-E.wsize,w),0),E.wnext=0,E.whave=E.wsize):(C=E.wsize-E.wnext,C>S&&(C=S),E.window.set(z.subarray(w-S,w-S+C),E.wnext),(S-=C)?(E.window.set(z.subarray(w-S,w),0),E.wnext=S,E.whave=E.wsize):(E.wnext+=C,E.wnext===E.wsize&&(E.wnext=0),E.whave<E.wsize&&(E.whave+=C))),0};f.exports.inflateReset=D,f.exports.inflateReset2=A,f.exports.inflateResetKeep=v,f.exports.inflateInit=f=>M(f,15),f.exports.inflateInit2=M,f.exports.inflate=(f,z)=>{let w,T,v,D,A,M,G,I,n,q,a,s,H,L,U,i,m,r,o,p,Y,t,Z=0;const b=new Uint8Array(4);let Q,g;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!f||!f.state||!f.output||!f.input&&0!==f.avail_in)return c;w=f.state,w.mode===B&&(w.mode=13),A=f.next_out,v=f.output,G=f.avail_out,D=f.next_in,T=f.input,M=f.avail_in,I=w.hold,n=w.bits,q=M,a=G,t=h;f:for(;;)switch(w.mode){case 1:if(0===w.wrap){w.mode=13;break}for(;n<16;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(2&w.wrap&&35615===I){w.check=0,b[0]=255&I,b[1]=I>>>8&255,w.check=C(w.check,b,2,0),I=0,n=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&I)<<8)+(I>>8))%31){f.msg="incorrect header check",w.mode=V;break}if((15&I)!==d){f.msg="unknown compression method",w.mode=V;break}if(I>>>=4,n-=4,Y=8+(15&I),0===w.wbits)w.wbits=Y;else if(Y>w.wbits){f.msg="invalid window size",w.mode=V;break}w.dmax=1<<w.wbits,f.adler=w.check=1,w.mode=512&I?10:B,I=0,n=0;break;case 2:for(;n<16;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(w.flags=I,(255&w.flags)!==d){f.msg="unknown compression method",w.mode=V;break}if(57344&w.flags){f.msg="unknown header flags set",w.mode=V;break}w.head&&(w.head.text=I>>8&1),512&w.flags&&(b[0]=255&I,b[1]=I>>>8&255,w.check=C(w.check,b,2,0)),I=0,n=0,w.mode=3;case 3:for(;n<32;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.head&&(w.head.time=I),512&w.flags&&(b[0]=255&I,b[1]=I>>>8&255,b[2]=I>>>16&255,b[3]=I>>>24&255,w.check=C(w.check,b,4,0)),I=0,n=0,w.mode=4;case 4:for(;n<16;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.head&&(w.head.xflags=255&I,w.head.os=I>>8),512&w.flags&&(b[0]=255&I,b[1]=I>>>8&255,w.check=C(w.check,b,2,0)),I=0,n=0,w.mode=5;case 5:if(1024&w.flags){for(;n<16;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.length=I,w.head&&(w.head.extra_len=I),512&w.flags&&(b[0]=255&I,b[1]=I>>>8&255,w.check=C(w.check,b,2,0)),I=0,n=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(s=w.length,s>M&&(s=M),s&&(w.head&&(Y=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Uint8Array(w.head.extra_len)),w.head.extra.set(T.subarray(D,D+s),Y)),512&w.flags&&(w.check=C(w.check,T,s,D)),M-=s,D+=s,w.length-=s),w.length))break f;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(0===M)break f;s=0;do{Y=T[D+s++],w.head&&Y&&w.length<65536&&(w.head.name+=String.fromCharCode(Y))}while(Y&&s<M);if(512&w.flags&&(w.check=C(w.check,T,s,D)),M-=s,D+=s,Y)break f}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(0===M)break f;s=0;do{Y=T[D+s++],w.head&&Y&&w.length<65536&&(w.head.comment+=String.fromCharCode(Y))}while(Y&&s<M);if(512&w.flags&&(w.check=C(w.check,T,s,D)),M-=s,D+=s,Y)break f}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;n<16;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(I!==(65535&w.check)){f.msg="header crc mismatch",w.mode=V;break}I=0,n=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),f.adler=w.check=0,w.mode=B;break;case 10:for(;n<32;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}f.adler=w.check=W(I),I=0,n=0,w.mode=11;case 11:if(0===w.havedict)return f.next_out=A,f.avail_out=G,f.next_in=D,f.avail_in=M,w.hold=I,w.bits=n,K;f.adler=w.check=1,w.mode=B;case B:if(z===x||z===u)break f;case 13:if(w.last){I>>>=7&n,n-=7&n,w.mode=27;break}for(;n<3;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}switch(w.last=1&I,I>>>=1,n-=1,3&I){case 0:w.mode=14;break;case 1:if(P(w),w.mode=20,z===u){I>>>=2,n-=2;break f}break;case 2:w.mode=17;break;case 3:f.msg="invalid block type",w.mode=V}I>>>=2,n-=2;break;case 14:for(I>>>=7&n,n-=7&n;n<32;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if((65535&I)!==(I>>>16^65535)){f.msg="invalid stored block lengths",w.mode=V;break}if(w.length=65535&I,I=0,n=0,w.mode=15,z===u)break f;case 15:w.mode=16;case 16:if(s=w.length,s){if(s>M&&(s=M),s>G&&(s=G),0===s)break f;v.set(T.subarray(D,D+s),A),M-=s,D+=s,G-=s,A+=s,w.length-=s;break}w.mode=B;break;case 17:for(;n<14;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(w.nlen=257+(31&I),I>>>=5,n-=5,w.ndist=1+(31&I),I>>>=5,n-=5,w.ncode=4+(15&I),I>>>=4,n-=4,w.nlen>286||w.ndist>30){f.msg="too many length or distance symbols",w.mode=V;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;n<3;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.lens[k[w.have++]]=7&I,I>>>=3,n-=3}for(;w.have<19;)w.lens[k[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Q={bits:w.lenbits},t=F(0,w.lens,0,19,w.lencode,0,w.work,Q),w.lenbits=Q.bits,t){f.msg="invalid code lengths set",w.mode=V;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;Z=w.lencode[I&(1<<w.lenbits)-1],U=Z>>>24,i=Z>>>16&255,m=65535&Z,!(U<=n);){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(m<16)I>>>=U,n-=U,w.lens[w.have++]=m;else{if(16===m){for(g=U+2;n<g;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(I>>>=U,n-=U,0===w.have){f.msg="invalid bit length repeat",w.mode=V;break}Y=w.lens[w.have-1],s=3+(3&I),I>>>=2,n-=2}else if(17===m){for(g=U+3;n<g;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}I>>>=U,n-=U,Y=0,s=3+(7&I),I>>>=3,n-=3}else{for(g=U+7;n<g;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}I>>>=U,n-=U,Y=0,s=11+(127&I),I>>>=7,n-=7}if(w.have+s>w.nlen+w.ndist){f.msg="invalid bit length repeat",w.mode=V;break}for(;s--;)w.lens[w.have++]=Y}}if(w.mode===V)break;if(0===w.lens[256]){f.msg="invalid code -- missing end-of-block",w.mode=V;break}if(w.lenbits=9,Q={bits:w.lenbits},t=F(1,w.lens,0,w.nlen,w.lencode,0,w.work,Q),w.lenbits=Q.bits,t){f.msg="invalid literal/lengths set",w.mode=V;break}if(w.distbits=6,w.distcode=w.distdyn,Q={bits:w.distbits},t=F(2,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,Q),w.distbits=Q.bits,t){f.msg="invalid distances set",w.mode=V;break}if(w.mode=20,z===u)break f;case 20:w.mode=21;case 21:if(M>=6&&G>=258){f.next_out=A,f.avail_out=G,f.next_in=D,f.avail_in=M,w.hold=I,w.bits=n,E(f,a),A=f.next_out,v=f.output,G=f.avail_out,D=f.next_in,T=f.input,M=f.avail_in,I=w.hold,n=w.bits,w.mode===B&&(w.back=-1);break}for(w.back=0;Z=w.lencode[I&(1<<w.lenbits)-1],U=Z>>>24,i=Z>>>16&255,m=65535&Z,!(U<=n);){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(i&&0===(240&i)){for(r=U,o=i,p=m;Z=w.lencode[p+((I&(1<<r+o)-1)>>r)],U=Z>>>24,i=Z>>>16&255,m=65535&Z,!(r+U<=n);){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}I>>>=r,n-=r,w.back+=r}if(I>>>=U,n-=U,w.back+=U,w.length=m,0===i){w.mode=26;break}if(32&i){w.back=-1,w.mode=B;break}if(64&i){f.msg="invalid literal/length code",w.mode=V;break}w.extra=15&i,w.mode=22;case 22:if(w.extra){for(g=w.extra;n<g;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.length+=I&(1<<w.extra)-1,I>>>=w.extra,n-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;Z=w.distcode[I&(1<<w.distbits)-1],U=Z>>>24,i=Z>>>16&255,m=65535&Z,!(U<=n);){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(0===(240&i)){for(r=U,o=i,p=m;Z=w.distcode[p+((I&(1<<r+o)-1)>>r)],U=Z>>>24,i=Z>>>16&255,m=65535&Z,!(r+U<=n);){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}I>>>=r,n-=r,w.back+=r}if(I>>>=U,n-=U,w.back+=U,64&i){f.msg="invalid distance code",w.mode=V;break}w.offset=m,w.extra=15&i,w.mode=24;case 24:if(w.extra){for(g=w.extra;n<g;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}w.offset+=I&(1<<w.extra)-1,I>>>=w.extra,n-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){f.msg="invalid distance too far back",w.mode=V;break}w.mode=25;case 25:if(0===G)break f;if(s=a-G,w.offset>s){if(s=w.offset-s,s>w.whave&&w.sane){f.msg="invalid distance too far back",w.mode=V;break}s>w.wnext?(s-=w.wnext,H=w.wsize-s):H=w.wnext-s,s>w.length&&(s=w.length),L=w.window}else L=v,H=A-w.offset,s=w.length;s>G&&(s=G),G-=s,w.length-=s;do{v[A++]=L[H++]}while(--s);0===w.length&&(w.mode=21);break;case 26:if(0===G)break f;v[A++]=w.length,G--,w.mode=21;break;case 27:if(w.wrap){for(;n<32;){if(0===M)break f;M--,I|=T[D++]<<n,n+=8}if(a-=G,f.total_out+=a,w.total+=a,a&&(f.adler=w.check=w.flags?C(w.check,v,a,A-a):S(w.check,v,a,A-a)),a=G,(w.flags?I:W(I))!==w.check){f.msg="incorrect data check",w.mode=V;break}I=0,n=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;n<32;){if(0===M)break f;M--,I+=T[D++]<<n,n+=8}if(I!==(4294967295&w.total)){f.msg="incorrect length check",w.mode=V;break}I=0,n=0}w.mode=29;case 29:t=X;break f;case V:t=y;break f;case 31:return e;default:return c}return f.next_out=A,f.avail_out=G,f.next_in=D,f.avail_in=M,w.hold=I,w.bits=n,(w.wsize||a!==f.avail_out&&w.mode<V&&(w.mode<27||z!==J))&&R(f,f.output,f.next_out,a-f.avail_out)?(w.mode=31,e):(q-=f.avail_in,a-=f.avail_out,f.total_in+=q,f.total_out+=a,w.total+=a,w.wrap&&a&&(f.adler=w.check=w.flags?C(w.check,v,a,f.next_out-a):S(w.check,v,a,f.next_out-a)),f.data_type=w.bits+(w.last?64:0)+(w.mode===B?128:0)+(20===w.mode||15===w.mode?256:0),(0===q&&0===a||z===J)&&t===h&&(t=O),t)},f.exports.inflateEnd=f=>{if(!f||!f.state)return c;let z=f.state;return z.window&&(z.window=null),f.state=null,h},f.exports.inflateGetHeader=(f,z)=>{if(!f||!f.state)return c;const w=f.state;return 0===(2&w.wrap)?c:(w.head=z,z.done=!1,h)},f.exports.inflateSetDictionary=(f,z)=>{const w=z.length;let C,E,F;return f&&f.state?(C=f.state,0!==C.wrap&&11!==C.mode?c:11===C.mode&&(E=1,E=S(E,z,w,0),E!==C.check)?y:(F=R(f,z,w,w),F?(C.mode=31,e):(C.havedict=1,h))):c},f.exports.inflateInfo="pako inflate (from Nodeca project)"},12022:f=>{"use strict";const z=15,w=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),C=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),E=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);f.exports=(f,F,J,x,u,h,X,K)=>{const c=K.bits;let y,e,O,d,B,V,W=0,T=0,v=0,D=0,A=0,M=0,G=0,I=0,n=0,P=0,R=null,q=0;const a=new Uint16Array(16),s=new Uint16Array(16);let H,L,U,i=null,m=0;for(W=0;W<=z;W++)a[W]=0;for(T=0;T<x;T++)a[F[J+T]]++;for(A=c,D=z;D>=1&&0===a[D];D--);if(A>D&&(A=D),0===D)return u[h++]=20971520,u[h++]=20971520,K.bits=1,0;for(v=1;v<D&&0===a[v];v++);for(A<v&&(A=v),I=1,W=1;W<=z;W++)if(I<<=1,I-=a[W],I<0)return-1;if(I>0&&(0===f||1!==D))return-1;for(s[1]=0,W=1;W<z;W++)s[W+1]=s[W]+a[W];for(T=0;T<x;T++)0!==F[J+T]&&(X[s[F[J+T]]++]=T);if(0===f?(R=i=X,V=19):1===f?(R=w,q-=257,i=S,m-=257,V=256):(R=C,i=E,V=-1),P=0,T=0,W=v,B=h,M=A,G=0,O=-1,n=1<<A,d=n-1,1===f&&n>852||2===f&&n>592)return 1;for(;;){H=W-G,X[T]<V?(L=0,U=X[T]):X[T]>V?(L=i[m+X[T]],U=R[q+X[T]]):(L=96,U=0),y=1<<W-G,e=1<<M,v=e;do{e-=y,u[B+(P>>G)+e]=H<<24|L<<16|U}while(0!==e);for(y=1<<W-1;P&y;)y>>=1;if(0!==y?(P&=y-1,P+=y):P=0,T++,0===--a[W]){if(W===D)break;W=F[J+X[T]]}if(W>A&&(P&d)!==O){for(0===G&&(G=A),B+=v,M=W-G,I=1<<M;M+G<D&&(I-=a[M+G],!(I<=0));)M++,I<<=1;if(n+=1<<M,1===f&&n>852||2===f&&n>592)return 1;O=P&d,u[O]=A<<24|M<<16|B-h}}return 0!==P&&(u[B+P]=W-G<<24|64<<16),K.bits=A,0}},11985:f=>{"use strict";f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11971:f=>{"use strict";function z(f){let z=f.length;for(;--z>=0;)f[z]=0}const w=256,S=286,C=30,E=15,F=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Array(576);z(h);const X=new Array(60);z(X);const K=new Array(512);z(K);const c=new Array(256);z(c);const y=new Array(29);z(y);const e=new Array(C);function O(f,z,w,S,C){this.static_tree=f,this.extra_bits=z,this.extra_base=w,this.elems=S,this.max_length=C,this.has_stree=f&&f.length}let d,B,V;function W(f,z){this.dyn_tree=f,this.max_code=0,this.stat_desc=z}z(e);const T=f=>f<256?K[f]:K[256+(f>>>7)],v=(f,z)=>{f.pending_buf[f.pending++]=255&z,f.pending_buf[f.pending++]=z>>>8&255},D=(f,z,w)=>{f.bi_valid>16-w?(f.bi_buf|=z<<f.bi_valid&65535,v(f,f.bi_buf),f.bi_buf=z>>16-f.bi_valid,f.bi_valid+=w-16):(f.bi_buf|=z<<f.bi_valid&65535,f.bi_valid+=w)},A=(f,z,w)=>{D(f,w[2*z],w[2*z+1])},M=(f,z)=>{let w=0;do{w|=1&f,f>>>=1,w<<=1}while(--z>0);return w>>>1},G=(f,z,w)=>{const S=new Array(16);let C,F,J=0;for(C=1;C<=E;C++)S[C]=J=J+w[C-1]<<1;for(F=0;F<=z;F++){let z=f[2*F+1];0!==z&&(f[2*F]=M(S[z]++,z))}},I=f=>{let z;for(z=0;z<S;z++)f.dyn_ltree[2*z]=0;for(z=0;z<C;z++)f.dyn_dtree[2*z]=0;for(z=0;z<19;z++)f.bl_tree[2*z]=0;f.dyn_ltree[512]=1,f.opt_len=f.static_len=0,f.last_lit=f.matches=0},n=f=>{f.bi_valid>8?v(f,f.bi_buf):f.bi_valid>0&&(f.pending_buf[f.pending++]=f.bi_buf),f.bi_buf=0,f.bi_valid=0},P=(f,z,w,S)=>{const C=2*z,E=2*w;return f[C]<f[E]||f[C]===f[E]&&S[z]<=S[w]},R=(f,z,w)=>{const S=f.heap[w];let C=w<<1;for(;C<=f.heap_len&&(C<f.heap_len&&P(z,f.heap[C+1],f.heap[C],f.depth)&&C++,!P(z,S,f.heap[C],f.depth));)f.heap[w]=f.heap[C],w=C,C<<=1;f.heap[w]=S},q=(f,z,S)=>{let C,E,x,u,h=0;if(0!==f.last_lit)do{C=f.pending_buf[f.d_buf+2*h]<<8|f.pending_buf[f.d_buf+2*h+1],E=f.pending_buf[f.l_buf+h],h++,0===C?A(f,E,z):(x=c[E],A(f,x+w+1,z),u=F[x],0!==u&&(E-=y[x],D(f,E,u)),C--,x=T(C),A(f,x,S),u=J[x],0!==u&&(C-=e[x],D(f,C,u)))}while(h<f.last_lit);A(f,256,z)},a=(f,z)=>{const w=z.dyn_tree,S=z.stat_desc.static_tree,C=z.stat_desc.has_stree,F=z.stat_desc.elems;let J,x,u,h=-1;for(f.heap_len=0,f.heap_max=573,J=0;J<F;J++)0!==w[2*J]?(f.heap[++f.heap_len]=h=J,f.depth[J]=0):w[2*J+1]=0;for(;f.heap_len<2;)u=f.heap[++f.heap_len]=h<2?++h:0,w[2*u]=1,f.depth[u]=0,f.opt_len--,C&&(f.static_len-=S[2*u+1]);for(z.max_code=h,J=f.heap_len>>1;J>=1;J--)R(f,w,J);u=F;do{J=f.heap[1],f.heap[1]=f.heap[f.heap_len--],R(f,w,1),x=f.heap[1],f.heap[--f.heap_max]=J,f.heap[--f.heap_max]=x,w[2*u]=w[2*J]+w[2*x],f.depth[u]=(f.depth[J]>=f.depth[x]?f.depth[J]:f.depth[x])+1,w[2*J+1]=w[2*x+1]=u,f.heap[1]=u++,R(f,w,1)}while(f.heap_len>=2);f.heap[--f.heap_max]=f.heap[1],((f,z)=>{const w=z.dyn_tree,S=z.max_code,C=z.stat_desc.static_tree,F=z.stat_desc.has_stree,J=z.stat_desc.extra_bits,x=z.stat_desc.extra_base,u=z.stat_desc.max_length;let h,X,K,c,y,e,O=0;for(c=0;c<=E;c++)f.bl_count[c]=0;for(w[2*f.heap[f.heap_max]+1]=0,h=f.heap_max+1;h<573;h++)X=f.heap[h],c=w[2*w[2*X+1]+1]+1,c>u&&(c=u,O++),w[2*X+1]=c,X>S||(f.bl_count[c]++,y=0,X>=x&&(y=J[X-x]),e=w[2*X],f.opt_len+=e*(c+y),F&&(f.static_len+=e*(C[2*X+1]+y)));if(0!==O){do{for(c=u-1;0===f.bl_count[c];)c--;f.bl_count[c]--,f.bl_count[c+1]+=2,f.bl_count[u]--,O-=2}while(O>0);for(c=u;0!==c;c--)for(X=f.bl_count[c];0!==X;)K=f.heap[--h],K>S||(w[2*K+1]!==c&&(f.opt_len+=(c-w[2*K+1])*w[2*K],w[2*K+1]=c),X--)}})(f,z),G(w,h,f.bl_count)},s=(f,z,w)=>{let S,C,E=-1,F=z[1],J=0,x=7,u=4;for(0===F&&(x=138,u=3),z[2*(w+1)+1]=65535,S=0;S<=w;S++)C=F,F=z[2*(S+1)+1],++J<x&&C===F||(J<u?f.bl_tree[2*C]+=J:0!==C?(C!==E&&f.bl_tree[2*C]++,f.bl_tree[32]++):J<=10?f.bl_tree[34]++:f.bl_tree[36]++,J=0,E=C,0===F?(x=138,u=3):C===F?(x=6,u=3):(x=7,u=4))},H=(f,z,w)=>{let S,C,E=-1,F=z[1],J=0,x=7,u=4;for(0===F&&(x=138,u=3),S=0;S<=w;S++)if(C=F,F=z[2*(S+1)+1],!(++J<x&&C===F)){if(J<u)do{A(f,C,f.bl_tree)}while(0!==--J);else 0!==C?(C!==E&&(A(f,C,f.bl_tree),J--),A(f,16,f.bl_tree),D(f,J-3,2)):J<=10?(A(f,17,f.bl_tree),D(f,J-3,3)):(A(f,18,f.bl_tree),D(f,J-11,7));J=0,E=C,0===F?(x=138,u=3):C===F?(x=6,u=3):(x=7,u=4)}};let L=!1;const U=(f,z,w,S)=>{D(f,0+(S?1:0),3),((f,z,w,S)=>{n(f),S&&(v(f,w),v(f,~w)),f.pending_buf.set(f.window.subarray(z,z+w),f.pending),f.pending+=w})(f,z,w,!0)};f.exports._tr_init=f=>{L||((()=>{let f,z,w,u,W;const T=new Array(16);for(w=0,u=0;u<28;u++)for(y[u]=w,f=0;f<1<<F[u];f++)c[w++]=u;for(c[w-1]=u,W=0,u=0;u<16;u++)for(e[u]=W,f=0;f<1<<J[u];f++)K[W++]=u;for(W>>=7;u<C;u++)for(e[u]=W<<7,f=0;f<1<<J[u]-7;f++)K[256+W++]=u;for(z=0;z<=E;z++)T[z]=0;for(f=0;f<=143;)h[2*f+1]=8,f++,T[8]++;for(;f<=255;)h[2*f+1]=9,f++,T[9]++;for(;f<=279;)h[2*f+1]=7,f++,T[7]++;for(;f<=287;)h[2*f+1]=8,f++,T[8]++;for(G(h,287,T),f=0;f<C;f++)X[2*f+1]=5,X[2*f]=M(f,5);d=new O(h,F,257,S,E),B=new O(X,J,0,C,E),V=new O(new Array(0),x,0,19,7)})(),L=!0),f.l_desc=new W(f.dyn_ltree,d),f.d_desc=new W(f.dyn_dtree,B),f.bl_desc=new W(f.bl_tree,V),f.bi_buf=0,f.bi_valid=0,I(f)},f.exports._tr_stored_block=U,f.exports._tr_flush_block=(f,z,S,C)=>{let E,F,J=0;f.level>0?(2===f.strm.data_type&&(f.strm.data_type=(f=>{let z,S=4093624447;for(z=0;z<=31;z++,S>>>=1)if(1&S&&0!==f.dyn_ltree[2*z])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(z=32;z<w;z++)if(0!==f.dyn_ltree[2*z])return 1;return 0})(f)),a(f,f.l_desc),a(f,f.d_desc),J=(f=>{let z;for(s(f,f.dyn_ltree,f.l_desc.max_code),s(f,f.dyn_dtree,f.d_desc.max_code),a(f,f.bl_desc),z=18;z>=3&&0===f.bl_tree[2*u[z]+1];z--);return f.opt_len+=3*(z+1)+5+5+4,z})(f),E=f.opt_len+3+7>>>3,F=f.static_len+3+7>>>3,F<=E&&(E=F)):E=F=S+5,S+4<=E&&-1!==z?U(f,z,S,C):4===f.strategy||F===E?(D(f,2+(C?1:0),3),q(f,h,X)):(D(f,4+(C?1:0),3),((f,z,w,S)=>{let C;for(D(f,z-257,5),D(f,w-1,5),D(f,S-4,4),C=0;C<S;C++)D(f,f.bl_tree[2*u[C]+1],3);H(f,f.dyn_ltree,z-1),H(f,f.dyn_dtree,w-1)})(f,f.l_desc.max_code+1,f.d_desc.max_code+1,J+1),q(f,f.dyn_ltree,f.dyn_dtree)),I(f),C&&n(f)},f.exports._tr_tally=(f,z,S)=>(f.pending_buf[f.d_buf+2*f.last_lit]=z>>>8&255,f.pending_buf[f.d_buf+2*f.last_lit+1]=255&z,f.pending_buf[f.l_buf+f.last_lit]=255&S,f.last_lit++,0===z?f.dyn_ltree[2*S]++:(f.matches++,z--,f.dyn_ltree[2*(c[S]+w+1)]++,f.dyn_dtree[2*T(z)]++),f.last_lit===f.lit_bufsize-1),f.exports._tr_align=f=>{D(f,2,3),A(f,256,h),(f=>{16===f.bi_valid?(v(f,f.bi_buf),f.bi_buf=0,f.bi_valid=0):f.bi_valid>=8&&(f.pending_buf[f.pending++]=255&f.bi_buf,f.bi_buf>>=8,f.bi_valid-=8)})(f)}},12003:f=>{"use strict";f.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12606:f=>{function z(f,z,w){for(var S=f.length,C=-1/0,E=1/0,F=0;F<S;F++){var J=(w[0][F]-f[F])/z[F],x=(w[1][F]-f[F])/z[F];if(J>x){var u=J;J=x,x=u}if(x<C||J>E)return 1/0;J>C&&(C=J),x<E&&(E=x)}return C>E?1/0:C}f.exports=function(f,w,S,C){var E=z(w,S,C);if(E===1/0)f=null;else{f=f||[];for(var F=0;F<w.length;F++)f[F]=w[F]+S[F]*E}return f},f.exports.distance=z},12882:(f,z,w)=>{"use strict";w.d(z,{b:()=>F});var S=w(35);const C=S.useLayoutEffect;const E=function(f){var z=(0,S.useRef)(f);return C((function(){z.current=f})),z};var F=function(f){var z=E(f);(0,S.Md)((function(){var f=function(f){var w;if(null!=z.current&&(w=z.current(f)),f.defaultPrevented&&(f.returnValue=""),"string"===typeof w)return f.returnValue=w,w};return window.addEventListener("beforeunload",f),function(){window.removeEventListener("beforeunload",f)}}),[])}},12850:(f,z,w)=>{"use strict";var S=w(12854),C=Array.prototype.concat,E=Array.prototype.slice,F=f.exports=function(f){for(var z=[],w=0,F=f.length;w<F;w++){var J=f[w];S(J)?z=C.call(z,E.call(J)):z.push(J)}return z};F.wrap=function(f){return function(){return f(F(arguments))}}},12854:f=>{f.exports=function(f){return!(!f||"string"===typeof f)&&(f instanceof Array||Array.isArray(f)||f.length>=0&&(f.splice instanceof Function||Object.getOwnPropertyDescriptor(f,f.length-1)&&"String"!==f.constructor.name))}},11921:(f,z,w)=>{var S=w(11927);function C(f){for(var z,w,C=0,E=f.length,F=0;F<f.length;){for(z=f[F],w=0;F<E&&f[F]===z;)++F,++w;C+=S.log2(w)/7|0,C+=S.log2(z>>>0)/7|0,C+=2}return C}z.size=C,z.encode=function(f,z){z||(z=new Uint8Array(C(f)));for(var w,S,E=0,F=z.length,J=0;J<f.length;){for(w=f[J],S=0;J<f.length&&f[J]===w;)++J,++S;for(;E<F&&S>=128;)z[E++]=128+(127&S),S>>>=7;if(E>=F)throw new Error("RLE buffer overflow");for(z[E++]=S,w>>>=0;E<F&&w>=128;)z[E++]=128+(127&w),w>>>=7;if(E>=F)throw new Error("RLE buffer overflow");z[E++]=w}return z},z.decode=function(f,z){for(var w,S,C,E,F=z.length,J=f.length,x=0,u=0;u<J;){for(w=0,S=0;u<J&&f[u]>=128;)w+=(127&f[u++])<<S,S+=7;if(w+=f[u++]<<S,u>=J)throw new Error("RLE buffer underrun");if(x+w>F)throw new Error("Chunk buffer overflow");for(C=0,S=0;u<J&&f[u]>=128;)C+=(127&f[u++])<<S,S+=7;if(u>=J)throw new Error("RLE buffer underrun");for(C+=f[u++]<<S,E=0;E<w;++E)z[x++]=C}return z}},11927:(f,z)=>{"use strict";function w(f){var z=32;return(f&=-f)&&z--,65535&f&&(z-=16),16711935&f&&(z-=8),252645135&f&&(z-=4),858993459&f&&(z-=2),1431655765&f&&(z-=1),z}z.INT_BITS=32,z.INT_MAX=2147483647,z.INT_MIN=-1<<31,z.sign=function(f){return(f>0)-(f<0)},z.abs=function(f){var z=f>>31;return(f^z)-z},z.min=function(f,z){return z^(f^z)&-(f<z)},z.max=function(f,z){return f^(f^z)&-(f<z)},z.isPow2=function(f){return!(f&f-1)&&!!f},z.log2=function(f){var z,w;return z=(f>65535)<<4,z|=w=((f>>>=z)>255)<<3,z|=w=((f>>>=w)>15)<<2,(z|=w=((f>>>=w)>3)<<1)|(f>>>=w)>>1},z.log10=function(f){return f>=1e9?9:f>=1e8?8:f>=1e7?7:f>=1e6?6:f>=1e5?5:f>=1e4?4:f>=1e3?3:f>=100?2:f>=10?1:0},z.popCount=function(f){return 16843009*((f=(858993459&(f-=f>>>1&1431655765))+(f>>>2&858993459))+(f>>>4)&252645135)>>>24},z.countTrailingZeros=w,z.nextPow2=function(f){return f+=0===f,--f,f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)+1},z.prevPow2=function(f){return f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)-(f>>>1)},z.parity=function(f){return f^=f>>>16,f^=f>>>8,f^=f>>>4,27030>>>(f&=15)&1};var S=new Array(256);!function(f){for(var z=0;z<256;++z){var w=z,S=z,C=7;for(w>>>=1;w;w>>>=1)S<<=1,S|=1&w,--C;f[z]=S<<C&255}}(S),z.reverse=function(f){return S[255&f]<<24|S[f>>>8&255]<<16|S[f>>>16&255]<<8|S[f>>>24&255]},z.interleave2=function(f,z){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))<<1},z.deinterleave2=function(f,z){return(f=65535&((f=16711935&((f=252645135&((f=858993459&((f=f>>>z&1431655765)|f>>>1))|f>>>2))|f>>>4))|f>>>16))<<16>>16},z.interleave3=function(f,z,w){return f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2),(f|=(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<1)|(w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2))<<2},z.deinterleave3=function(f,z){return(f=1023&((f=4278190335&((f=251719695&((f=3272356035&((f=f>>>z&1227133513)|f>>>2))|f>>>4))|f>>>8))|f>>>16))<<22>>22},z.nextCombination=function(f){var z=f|f-1;return z+1|(~z&-~z)-1>>>w(f)+1}},11954:f=>{"use strict";f.exports=function(f,z,w,S){var C=self||window;try{try{var E;try{E=new C.Blob([f])}catch(u){(E=new(C.BlobBuilder||C.WebKitBlobBuilder||C.MozBlobBuilder||C.MSBlobBuilder)).append(f),E=E.getBlob()}var F=C.URL||C.webkitURL,J=F.createObjectURL(E),x=new C[z](J,w);return F.revokeObjectURL(J),x}catch(u){return new C[z]("data:application/javascript,".concat(encodeURIComponent(f)),w)}}catch(u){if(!S)throw Error("Inline worker is not supported");return new C[z](S,w)}}},12586:(f,z,w)=>{"use strict";function S(f,z,w,S,C){var E={};return Object.keys(S).forEach((function(f){E[f]=S[f]})),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=w.slice().reverse().reduce((function(w,S){return S(f,z,w)||w}),E),C&&void 0!==E.initializer&&(E.value=E.initializer?E.initializer.call(C):void 0,E.initializer=void 0),void 0===E.initializer&&(Object.defineProperty(f,z,E),E=null),E}w.d(z,{c:()=>S})},12578:(f,z,w)=>{"use strict";function S(f,z,w,S){w&&Object.defineProperty(f,z,{enumerable:w.enumerable,configurable:w.configurable,writable:w.writable,value:w.initializer?w.initializer.call(S):void 0})}w.d(z,{e:()=>S})},12647:(f,z,w)=>{"use strict";w.d(z,{c:()=>V,g:()=>O,k:()=>d,m:()=>K,o:()=>e,s:()=>y,t:()=>c});var S=w(720),C=w(762),E=w(741),F=w(665),J=w(12656),x=w(749),u=w(2302),h=w(573),X=w(753);const K=Object.freeze(new S.f(0,0,0,0)),c=Object.freeze(S.n.Zero()),y=Object.freeze(S.l.Zero()),e=Object.freeze(u.b.Zero()),O=Object.freeze(C.d.Black()),d=Object.freeze(new C.f(0,0,0,0)),B={key:0,repeatCount:0,loopMode:2};class V{static _PrepareAnimation(f,z,w,E,F,J,x,h){let X;if(!isNaN(parseFloat(F))&&isFinite(F)?X=V.ANIMATIONTYPE_FLOAT:F instanceof S.f?X=V.ANIMATIONTYPE_QUATERNION:F instanceof S.n?X=V.ANIMATIONTYPE_VECTOR3:F instanceof S.l?X=V.ANIMATIONTYPE_VECTOR2:F instanceof C.d?X=V.ANIMATIONTYPE_COLOR3:F instanceof C.f?X=V.ANIMATIONTYPE_COLOR4:F instanceof u.b&&(X=V.ANIMATIONTYPE_SIZE),void 0==X)return null;const K=new V(f,z,w,X,x),c=[{frame:0,value:F},{frame:E,value:J}];return K.setKeys(c),void 0!==h&&K.setEasingFunction(h),K}static CreateAnimation(f,z,w,S){const C=new V(f+"Animation",f,w,z,V.ANIMATIONLOOPMODE_CONSTANT);return C.setEasingFunction(S),C}static CreateAndStartAnimation(f,z,w,S,C,E,F,J,x,u,h){const X=V._PrepareAnimation(f,w,S,C,E,F,J,x);return X?(z.va&&(h=z.va()),h?h.beginDirectAnimation(z,[X],0,C,1===X.loopMode,1,u):null):null}static CreateAndStartHierarchyAnimation(f,z,w,S,C,E,F,J,x,u,h){const X=V._PrepareAnimation(f,S,C,E,F,J,x,u);if(!X)return null;return z.va().beginDirectHierarchyAnimation(z,w,[X],0,E,1===X.loopMode,1,h)}static CreateMergeAndStartAnimation(f,z,w,S,C,E,F,J,x,u){const h=V._PrepareAnimation(f,w,S,C,E,F,J,x);return h?(z.animations.push(h),z.va().beginAnimation(z,0,C,1===h.loopMode,1,u)):null}static MakeAnimationAdditive(f,z,w){let C;C="object"===typeof z?z:{referenceFrame:z??0,range:w,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let E=f;if(C.cloneOriginalAnimation&&(E=f.clone(),E.name=C.clonedAnimationName||E.name),!E._keys.length)return E;const F=C.referenceFrame&&C.referenceFrame>=0?C.referenceFrame:0;let J=0;const x=E._keys[0];let u=E._keys.length-1;const h=E._keys[u],X={referenceValue:x.value,referencePosition:S.j.ek[0],referenceQuaternion:S.j.Quaternion[0],referenceScaling:S.j.ek[1],keyPosition:S.j.ek[2],keyQuaternion:S.j.Quaternion[1],keyScaling:S.j.ek[3]};let K=x.frame,c=h.frame;if(C.range){const f=E.getRange(C.range);f&&(K=f.from,c=f.to)}else K=C.fromFrame??K,c=C.toFrame??c;if(K!==x.frame&&(J=E.createKeyForFrame(K)),c!==h.frame&&(u=E.createKeyForFrame(c)),1===E._keys.length){const f=E._getKeyValue(E._keys[0]);X.referenceValue=f.clone?f.clone():f}else if(F<=x.frame){const f=E._getKeyValue(x.value);X.referenceValue=f.clone?f.clone():f}else if(F>=h.frame){const f=E._getKeyValue(h.value);X.referenceValue=f.clone?f.clone():f}else{B.key=0;const f=E._interpolate(F,B);X.referenceValue=f.clone?f.clone():f}E.dataType===V.ANIMATIONTYPE_QUATERNION?X.referenceValue.normalize().conjugateInPlace():E.dataType===V.ANIMATIONTYPE_MATRIX&&(X.referenceValue.decompose(X.referenceScaling,X.referenceQuaternion,X.referencePosition),X.referenceQuaternion.normalize().conjugateInPlace());let y=Number.MAX_VALUE;const e=C.clipKeys?[]:null;for(let O=J;O<=u;O++){let f=E._keys[O];if((e||C.cloneOriginalAnimation)&&(f={frame:f.frame,value:f.value.clone?f.value.clone():f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation,lockedTangent:f.lockedTangent},e&&(y===Number.MAX_VALUE&&(y=f.frame),f.frame-=y,e.push(f))),!O||E.dataType===V.ANIMATIONTYPE_FLOAT||f.value!==x.value)switch(E.dataType){case V.ANIMATIONTYPE_MATRIX:f.value.decompose(X.keyScaling,X.keyQuaternion,X.keyPosition),X.keyPosition.fk(X.referencePosition),X.keyScaling.divideInPlace(X.referenceScaling),X.referenceQuaternion.multiplyToRef(X.keyQuaternion,X.keyQuaternion),S.b.ComposeToRef(X.keyScaling,X.keyQuaternion,X.keyPosition,f.value);break;case V.ANIMATIONTYPE_QUATERNION:X.referenceValue.multiplyToRef(f.value,f.value);break;case V.ANIMATIONTYPE_VECTOR2:case V.ANIMATIONTYPE_VECTOR3:case V.ANIMATIONTYPE_COLOR3:case V.ANIMATIONTYPE_COLOR4:f.value.subtractToRef(X.referenceValue,f.value);break;case V.ANIMATIONTYPE_SIZE:f.value.width-=X.referenceValue.width,f.value.height-=X.referenceValue.height;break;default:f.value-=X.referenceValue}}return e&&E.setKeys(e,!0),E}static TransitionTo(f,z,w,S,C,E,F){let J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(F<=0)return w[f]=z,J&&J(),null;const x=C*(F/1e3);E.setKeys([{frame:0,value:w[f].clone?w[f].clone():w[f]},{frame:x,value:z}]),w.animations||(w.animations=[]),w.animations.push(E);const u=S.beginAnimation(w,0,x,!1);return u.onAnimationEnd=J,u}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const f of this._runtimeAnimations)if(!f.isStopped())return!0;return!1}constructor(f,z,w,S,C,E){this.name=f,this.targetProperty=z,this.framePerSecond=w,this.dataType=S,this.loopMode=C,this.enableBlending=E,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=z.split("."),this.dataType=S,this.loopMode=void 0===C?V.ANIMATIONLOOPMODE_CYCLE:C,this.uniqueId=V._UniqueIdGenerator++}toString(f){let z="Name: "+this.name+", property: "+this.targetProperty;if(z+=", datatype: "+["Float","ek","Quaternion","Matrix","uk","Vector2"][this.dataType],z+=", nKeys: "+(this._keys?this._keys.length:"none"),z+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),f){z+=", Ranges: {";let f=!0;for(const w in this._ranges)f&&(z+=", ",f=!1),z+=w;z+="}"}return z}addEvent(f){this._events.push(f),this._events.sort(((f,z)=>f.frame-z.frame))}removeEvents(f){for(let z=0;z<this._events.length;z++)this._events[z].frame===f&&(this._events.splice(z,1),z--)}getEvents(){return this._events}createRange(f,z,w){this._ranges[f]||(this._ranges[f]=new J.d(f,z,w))}deleteRange(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const w=this._ranges[f];if(w){if(z){const f=w.from,z=w.to;for(let w=this._keys.length-1;w>=0;w--)this._keys[w].frame>=f&&this._keys[w].frame<=z&&this._keys.splice(w,1)}this._ranges[f]=null}}getRange(f){return this._ranges[f]}getKeys(){return this._keys}getHighestFrame(){let f=0;for(let z=0,w=this._keys.length;z<w;z++)f<this._keys[z].frame&&(f=this._keys[z].frame);return f}getEasingFunction(){return this._easingFunction}setEasingFunction(f){this._easingFunction=f}floatInterpolateFunction(f,z,w){return(0,E.m)(f,z,w)}floatInterpolateFunctionWithTangents(f,z,w,S,C){return(0,E.f)(f,z,w,S,C)}quaternionInterpolateFunction(f,z,w){return S.f.Slerp(f,z,w)}quaternionInterpolateFunctionWithTangents(f,z,w,C,E){return S.f.Hermite(f,z,w,C,E).normalize()}vector3InterpolateFunction(f,z,w){return S.n.Lerp(f,z,w)}vector3InterpolateFunctionWithTangents(f,z,w,C,E){return S.n.Hermite(f,z,w,C,E)}vector2InterpolateFunction(f,z,w){return S.l.Lerp(f,z,w)}vector2InterpolateFunctionWithTangents(f,z,w,C,E){return S.l.Hermite(f,z,w,C,E)}sizeInterpolateFunction(f,z,w){return u.b.Lerp(f,z,w)}color3InterpolateFunction(f,z,w){return C.d.Lerp(f,z,w)}color3InterpolateFunctionWithTangents(f,z,w,S,E){return C.d.Hermite(f,z,w,S,E)}color4InterpolateFunction(f,z,w){return C.f.Lerp(f,z,w)}color4InterpolateFunctionWithTangents(f,z,w,S,E){return C.f.Hermite(f,z,w,S,E)}_getKeyValue(f){return"function"===typeof f?f():f}evaluate(f){return B.key=0,this._interpolate(f,B)}_interpolate(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(z.loopMode===V.ANIMATIONLOOPMODE_CONSTANT&&z.repeatCount>0)return z.highLimitValue.clone?z.highLimitValue.clone():z.highLimitValue;const S=this._keys,C=S.length;let E=z.key;for(;E>=0&&f<S[E].frame;)--E;for(;E+1<=C-1&&f>=S[E+1].frame;)++E;if(z.key=E,E<0)return w?void 0:this._getKeyValue(S[0].value);if(E+1>C-1)return w?void 0:this._getKeyValue(S[C-1].value);const F=S[E],J=S[E+1];if(w&&(f===F.frame||f===J.frame))return;const x=this._getKeyValue(F.value),u=this._getKeyValue(J.value);if(1===F.interpolation)return J.frame>f?x:u;const h=void 0!==F.outTangent&&void 0!==J.inTangent,X=J.frame-F.frame;let B=(f-F.frame)/X;const W=F.easingFunction||this.getEasingFunction();switch(null!==W&&(B=W.ease(B)),this.dataType){case V.ANIMATIONTYPE_FLOAT:{const f=h?this.floatInterpolateFunctionWithTangents(x,F.outTangent*X,u,J.inTangent*X,B):this.floatInterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(z.offsetValue??0)*z.repeatCount+f}break}case V.ANIMATIONTYPE_QUATERNION:{const f=h?this.quaternionInterpolateFunctionWithTangents(x,F.outTangent.scale(X),u,J.inTangent.scale(X),B):this.quaternionInterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.addInPlace((z.offsetValue||K).scale(z.repeatCount))}return f}case V.ANIMATIONTYPE_VECTOR3:{const f=h?this.vector3InterpolateFunctionWithTangents(x,F.outTangent.scale(X),u,J.inTangent.scale(X),B):this.vector3InterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((z.offsetValue||c).scale(z.repeatCount))}break}case V.ANIMATIONTYPE_VECTOR2:{const f=h?this.vector2InterpolateFunctionWithTangents(x,F.outTangent.scale(X),u,J.inTangent.scale(X),B):this.vector2InterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((z.offsetValue||y).scale(z.repeatCount))}break}case V.ANIMATIONTYPE_SIZE:switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(x,u,B);case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(x,u,B).add((z.offsetValue||e).scale(z.repeatCount))}break;case V.ANIMATIONTYPE_COLOR3:{const f=h?this.color3InterpolateFunctionWithTangents(x,F.outTangent.scale(X),u,J.inTangent.scale(X),B):this.color3InterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((z.offsetValue||O).scale(z.repeatCount))}break}case V.ANIMATIONTYPE_COLOR4:{const f=h?this.color4InterpolateFunctionWithTangents(x,F.outTangent.scale(X),u,J.inTangent.scale(X),B):this.color4InterpolateFunction(x,u,B);switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return f;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((z.offsetValue||d).scale(z.repeatCount))}break}case V.ANIMATIONTYPE_MATRIX:switch(z.loopMode){case V.ANIMATIONLOOPMODE_CYCLE:case V.ANIMATIONLOOPMODE_CONSTANT:case V.ANIMATIONLOOPMODE_YOYO:return V.AllowMatricesInterpolation?this.matrixInterpolateFunction(x,u,B,z.workValue):x;case V.ANIMATIONLOOPMODE_RELATIVE:case V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return x}}return 0}matrixInterpolateFunction(f,z,w,C){return V.AllowMatrixDecomposeForInterpolation?C?(S.b.DecomposeLerpToRef(f,z,w,C),C):S.b.DecomposeLerp(f,z,w):C?(S.b.LerpToRef(f,z,w,C),C):S.b.Lerp(f,z,w)}clone(){const f=new V(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(f.enableBlending=this.enableBlending,f.blendingSpeed=this.blendingSpeed,this._keys&&f.setKeys(this._keys),this._ranges){f._ranges={};for(const z in this._ranges){const w=this._ranges[z];w&&(f._ranges[z]=w.clone())}}return f}setKeys(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=z?f:f.slice(0)}createKeyForFrame(f){B.key=0;const z=this._interpolate(f,B,!0);if(!z)return this._keys[B.key].frame===f?B.key:B.key+1;const w={frame:f,value:z.clone?z.clone():z};return this._keys.splice(B.key+1,0,w),B.key+1}serialize(){const f={};f.name=this.name,f.property=this.targetProperty,f.framePerSecond=this.framePerSecond,f.dataType=this.dataType,f.loopBehavior=this.loopMode,f.enableBlending=this.enableBlending,f.blendingSpeed=this.blendingSpeed;const z=this.dataType;f.keys=[];const w=this.getKeys();for(let S=0;S<w.length;S++){const C=w[S],E={};switch(E.frame=C.frame,z){case V.ANIMATIONTYPE_FLOAT:E.values=[C.value],void 0!==C.inTangent&&E.values.push(C.inTangent),void 0!==C.outTangent&&(void 0===C.inTangent&&E.values.push(void 0),E.values.push(C.outTangent)),void 0!==C.interpolation&&(void 0===C.inTangent&&E.values.push(void 0),void 0===C.outTangent&&E.values.push(void 0),E.values.push(C.interpolation));break;case V.ANIMATIONTYPE_QUATERNION:case V.ANIMATIONTYPE_MATRIX:case V.ANIMATIONTYPE_VECTOR3:case V.ANIMATIONTYPE_COLOR3:case V.ANIMATIONTYPE_COLOR4:E.values=C.value.kk(),void 0!=C.inTangent&&E.values.push(C.inTangent.kk()),void 0!=C.outTangent&&(void 0===C.inTangent&&E.values.push(void 0),E.values.push(C.outTangent.kk())),void 0!==C.interpolation&&(void 0===C.inTangent&&E.values.push(void 0),void 0===C.outTangent&&E.values.push(void 0),E.values.push(C.interpolation))}f.keys.push(E)}f.ranges=[];for(const S in this._ranges){const z=this._ranges[S];if(!z)continue;const w={};w.name=S,w.from=z.from,w.to=z.to,f.ranges.push(w)}return f}static _UniversalLerp(f,z,w){const S=f.constructor;return S.Lerp?S.Lerp(f,z,w):S.Slerp?S.Slerp(f,z,w):f.toFixed?f*(1-w)+w*z:z}static Parse(f){const z=new V(f.name,f.property,f.framePerSecond,f.dataType,f.loopBehavior),w=f.dataType,E=[];let F,J;for(f.enableBlending&&(z.enableBlending=f.enableBlending),f.blendingSpeed&&(z.blendingSpeed=f.blendingSpeed),J=0;J<f.keys.length;J++){const z=f.keys[J];let x,u,h;switch(w){case V.ANIMATIONTYPE_FLOAT:F=z.values[0],z.values.length>=2&&(x=z.values[1]),z.values.length>=3&&(u=z.values[2]),z.values.length>=4&&(h=z.values[3]);break;case V.ANIMATIONTYPE_QUATERNION:if(F=S.f.ck(z.values),z.values.length>=8){const f=S.f.ck(z.values.slice(4,8));f.equals(S.f.Zero())||(x=f)}if(z.values.length>=12){const f=S.f.ck(z.values.slice(8,12));f.equals(S.f.Zero())||(u=f)}z.values.length>=13&&(h=z.values[12]);break;case V.ANIMATIONTYPE_MATRIX:F=S.b.ck(z.values),z.values.length>=17&&(h=z.values[16]);break;case V.ANIMATIONTYPE_COLOR3:F=C.d.ck(z.values),z.values[3]&&(x=C.d.ck(z.values[3])),z.values[4]&&(u=C.d.ck(z.values[4])),z.values[5]&&(h=z.values[5]);break;case V.ANIMATIONTYPE_COLOR4:F=C.f.ck(z.values),z.values[4]&&(x=C.f.ck(z.values[4])),z.values[5]&&(u=C.f.ck(z.values[5])),z.values[6]&&(h=C.f.ck(z.values[6]));break;case V.ANIMATIONTYPE_VECTOR3:default:F=S.n.ck(z.values),z.values[3]&&(x=S.n.ck(z.values[3])),z.values[4]&&(u=S.n.ck(z.values[4])),z.values[5]&&(h=z.values[5])}const X={};X.frame=z.frame,X.value=F,void 0!=x&&(X.inTangent=x),void 0!=u&&(X.outTangent=u),void 0!=h&&(X.interpolation=h),E.push(X)}if(z.setKeys(E),f.ranges)for(J=0;J<f.ranges.length;J++)F=f.ranges[J],z.createRange(F.name,F.from,F.to);return z}static AppendSerializedAnimations(f,z){X.b.AppendSerializedAnimations(f,z)}static ParseFromFileAsync(f,z){return new Promise(((w,S)=>{const C=new h.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){let z=JSON.parse(C.responseText);if(z.animations&&(z=z.animations),z.length){const f=[];for(const w of z)f.push(this.Parse(w));w(f)}else{const S=this.Parse(z);f&&(S.name=f),w(S)}}else S("Unable to load the animation")})),C.open("GET",z),C.send()}))}static ParseFromSnippetAsync(f){return new Promise(((z,w)=>{const S=new h.b;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const w=JSON.parse(JSON.parse(S.responseText).jsonPayload);if(w.animations){const S=JSON.parse(w.animations),C=[];for(const z of S.animations){const w=this.Parse(z);w.snippetId=f,C.push(w)}z(C)}else{const S=JSON.parse(w.animation),C=this.Parse(S);C.snippetId=f,z(C)}}else w("Unable to load the snippet "+f)})),S.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),S.send()}))}}V._UniqueIdGenerator=0,V.AllowMatricesInterpolation=!1,V.AllowMatrixDecomposeForInterpolation=!0,V.SnippetUrl="https://snippet.babylonjs.com",V.ANIMATIONTYPE_FLOAT=0,V.ANIMATIONTYPE_VECTOR3=1,V.ANIMATIONTYPE_QUATERNION=2,V.ANIMATIONTYPE_MATRIX=3,V.ANIMATIONTYPE_COLOR3=4,V.ANIMATIONTYPE_COLOR4=7,V.ANIMATIONTYPE_VECTOR2=5,V.ANIMATIONTYPE_SIZE=6,V.ANIMATIONLOOPMODE_RELATIVE=0,V.ANIMATIONLOOPMODE_CYCLE=1,V.ANIMATIONLOOPMODE_CONSTANT=2,V.ANIMATIONLOOPMODE_YOYO=4,V.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,V.CreateFromSnippetAsync=V.ParseFromSnippetAsync,(0,F.f)("BABYLON.Animation",V),x.e._AnimationRangeFactory=(f,z,w)=>new J.d(f,z,w)},12656:(f,z,w)=>{"use strict";w.d(z,{d:()=>S});class S{constructor(f,z,w){this.name=f,this.from=z,this.to=w}clone(){return new S(this.name,this.from,this.to)}}},12238:(f,z,w)=>{"use strict";var S=w(527),C=w(548),E=w(616),F=w(540);E.e.AudioEngineFactory=(f,z,w)=>new J(f,z,w);class J{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.c,this.onAudioLockedObservable=new S.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,F.o)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const C=document.createElement("audio");this._hostElement=f,this._audioContext=z,this._audioDestination=w;try{C&&C.canPlayType&&(C.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||C.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{C&&C.canPlayType&&C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var f,z;if("running"===(null===(f=this._audioContext)||void 0===f?void 0:f.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(z=this._audioContext)||void 0===z||z.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var f;null===(f=this._audioContext)||void 0===f||f.addEventListener("statechange",(()=>{var f;this.unlocked&&"running"!==(null===(f=this._audioContext)||void 0===f?void 0:f.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var f;return null!==(f=this._audioContext)&&void 0!==f&&f.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(f){this.canUseWebAudio=!1,C.b.Error("Web Audio: "+f.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const f=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",z=document.createElement("style");z.appendChild(document.createTextNode(f)),document.getElementsByTagName("head")[0].appendChild(z),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(f){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=f)}connectToAnalyser(f){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=f,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12638:(f,z,w)=>{"use strict";w.d(z,{b:()=>F});var S=w(720),C=w(732),E=w(749);class F extends E.e{get _matrix(){return this._compose(),this.Ik}set _matrix(f){(f.updateFlag!==this.Ik.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ik.p(f),this._markAsDirtyAndDecompose())}constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(f,z.va(),!1),this.name=f,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=z,this.Ik=(null===C||void 0===C?void 0:C.clone())??S.b.Identity(),this._restMatrix=E??this.Ik.clone(),this._bindMatrix=F??this.Ik.clone(),this._index=J,this._absoluteMatrix=new S.b,this._absoluteBindMatrix=new S.b,this._absoluteInverseBindMatrix=new S.b,this._finalMatrix=new S.b,z.bones.push(this),this.setParent(w,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(f){this.setParent(f)}setParent(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==f){if(this.parent){const f=this.parent.children.indexOf(this);-1!==f&&this.parent.children.splice(f,1)}this._parentNode=f,this.parent&&this.parent.children.push(this),z&&this._updateAbsoluteBindMatrices(),this.ak()}}getLocalMatrix(){return this._compose(),this.Ik}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(f){this._restMatrix.p(f)}setRestPose(f){this.setRestMatrix(f)}getBindPose(){return this.getBindMatrix()}setBindMatrix(f){this.rk(f)}setBindPose(f){this.setBindMatrix(f)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const f=S.j.ek[0],z=S.j.Quaternion[0],w=S.j.ek[1];this.getRestMatrix().decompose(f,z,w),this._linkedTransformNode.position.p(w),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??S.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(z),this._linkedTransformNode.Id.p(f)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(f){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=f,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Dd}set position(f){this._decompose(),this.Dd.p(f),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(f){this.setRotation(f)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(f){this.setRotationQuaternion(f)}get Id(){return this.getScale()}set Id(f){this.setScale(f)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=S.n.Zero(),this._localRotation=S.f.Zero(),this.Dd=S.n.Zero()),this.Ik.decompose(this._localScaling,this._localRotation,this.Dd))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,S.b.ComposeToRef(this._localScaling,this._localRotation,this.Dd,this.Ik)):this._needToCompose=!1)}rk(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(f),z&&this._updateAbsoluteBindMatrices(),w?this._matrix=f:this.ak()}_updateAbsoluteBindMatrices(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f||(f=this._bindMatrix),this.parent?f.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(f),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),z)for(let w=0;w<this.children.length;w++)this.children[w]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ak(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ak(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ak(),this._needToDecompose=!0}_updatePosition(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this.getLocalMatrix();if(0==z)C?(E.addAtIndex(12,f.x),E.addAtIndex(13,f.y),E.addAtIndex(14,f.z)):E.setTranslationFromFloats(f.x,f.y,f.z);else{let z=null;w&&(z=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=F._TmpMats[0],x=F._TmpVecs[0];this.parent?w&&z?(J.p(this.parent.getAbsoluteMatrix()),J.multiplyToRef(z,J)):J.p(this.parent.getAbsoluteMatrix()):S.b.IdentityToRef(J),C&&J.setTranslationFromFloats(0,0,0),J.invert(),S.n.TransformCoordinatesToRef(f,J,x),C?(E.addAtIndex(12,x.x),E.addAtIndex(13,x.y),E.addAtIndex(14,x.z)):E.setTranslationFromFloats(x.x,x.y,x.z)}this._markAsDirtyAndDecompose()}translate(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,z,w,!0)}setPosition(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,z,w,!1)}setAbsolutePosition(f,z){this.setPosition(f,1,z)}scale(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getLocalMatrix(),J=F._TmpMats[0];S.b.ScalingToRef(f,z,w,J),J.multiplyToRef(E,E),J.invert();for(const S of this.children){const C=S.getLocalMatrix();C.multiplyToRef(J,C),C.multiplyAtIndex(12,f),C.multiplyAtIndex(13,z),C.multiplyAtIndex(14,w),S._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),C)for(const S of this.children)S.scale(f,z,w,C)}setScale(f){this._decompose(),this._localScaling.p(f),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(f){this._decompose(),f.p(this._localScaling)}setYawPitchRoll(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0;if(0===C){const J=F._TmpQuat;return S.f.RotationYawPitchRollToRef(f,z,w,J),void this.setRotationQuaternion(J,C,E)}const J=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,E))return;const x=F._TmpMats[1];S.b.RotationYawPitchRollToRef(f,z,w,x),J.multiplyToRef(x,x),this._rotateWithMatrix(x,C,E)}rotate(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;const E=F._TmpMats[0];E.setTranslationFromFloats(0,0,0),S.b.RotationAxisToRef(f,z,E),this._rotateWithMatrix(E,w,C)}setAxisAngle(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;if(0===w){const E=F._TmpQuat;return S.f.RotationAxisToRef(f,z,E),void this.setRotationQuaternion(E,w,C)}const E=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,C))return;const J=F._TmpMats[1];S.b.RotationAxisToRef(f,z,J),E.multiplyToRef(J,J),this._rotateWithMatrix(J,w,C)}setRotation(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(f.y,f.x,f.z,z,w)}setRotationQuaternion(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;if(0===z)return this._decompose(),this._localRotation.p(f),void this._markAsDirtyAndCompose();const C=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,w))return;const E=F._TmpMats[1];S.b.FromQuaternionToRef(f,E),C.multiplyToRef(E,E),this._rotateWithMatrix(E,z,w)}setRotationMatrix(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;if(0===z){const C=F._TmpQuat;return S.f.FromRotationMatrixToRef(f,C),void this.setRotationQuaternion(C,z,w)}const C=F._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,w))return;const E=F._TmpMats[1];E.p(f),C.multiplyToRef(f,E),this._rotateWithMatrix(E,z,w)}_rotateWithMatrix(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;const S=this.getLocalMatrix(),C=S.m[12],E=S.m[13],J=S.m[14],x=this.getParent(),u=F._TmpMats[3],h=F._TmpMats[4];x&&1==z?(w?(u.p(w.getWorldMatrix()),x.getAbsoluteMatrix().multiplyToRef(u,u)):u.p(x.getAbsoluteMatrix()),h.p(u),h.invert(),S.multiplyToRef(u,S),S.multiplyToRef(f,S),S.multiplyToRef(h,S)):1==z&&w?(u.p(w.getWorldMatrix()),h.p(u),h.invert(),S.multiplyToRef(u,S),S.multiplyToRef(f,S),S.multiplyToRef(h,S)):S.multiplyToRef(f,S),S.setTranslationFromFloats(C,E,J),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(f,z){const w=F._TmpMats[2];return f.p(this.getAbsoluteMatrix()),z?(f.multiplyToRef(z.getWorldMatrix(),f),S.b.ScalingToRef(z.Id.x,z.Id.y,z.Id.z,w)):S.b.IdentityToRef(w),f.invert(),!isNaN(f.m[0])&&(w.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyToRef(w,f),!0)}Rg(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.n.Zero();return this.getPositionToRef(f,z,w),w}getPositionToRef(){let f=arguments.length>1?arguments[1]:void 0,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const f=this.getLocalMatrix();z.x=f.m[12],z.y=f.m[13],z.z=f.m[14]}else{let w=null;f&&(w=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let S=F._TmpMats[0];f&&w?(S.p(this.getAbsoluteMatrix()),S.multiplyToRef(w,S)):S=this.getAbsoluteMatrix(),z.x=S.m[12],z.y=S.m[13],z.z=S.m[14]}}getAbsolutePosition(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const z=S.n.Zero();return this.getPositionToRef(1,f,z),z}getAbsolutePositionToRef(f,z){this.getPositionToRef(1,f,z)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ik.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Ik);const f=this._skeleton.getPoseMatrix();f&&this._absoluteMatrix.multiplyToRef(f,this._absoluteMatrix)}const f=this.children,z=f.length;for(let w=0;w<z;w++)f[w].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}ah(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.n.Zero();return this.getDirectionToRef(f,z,w),w}getDirectionToRef(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0,C=null;z&&(C=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=F._TmpMats[0];E.p(this.getAbsoluteMatrix()),z&&C&&E.multiplyToRef(C,E),S.n.TransformNormalToRef(f,E,w),w.normalize()}getRotation(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.n.Zero();return this.getRotationToRef(f,z,w),w}getRotationToRef(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0;const S=F._TmpQuat;this.getRotationQuaternionToRef(f,z,S),S.toEulerAnglesToRef(w)}getRotationQuaternion(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.f.Identity();return this.getRotationQuaternionToRef(f,z,w),w}getRotationQuaternionToRef(){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),z.p(this._localRotation);else{const w=F._TmpMats[0],S=this.getAbsoluteMatrix();f?S.multiplyToRef(f.getWorldMatrix(),w):w.p(S),w.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyAtIndex(1,this._scalingDeterminant),w.multiplyAtIndex(2,this._scalingDeterminant),w.decompose(void 0,z,void 0)}}getRotationMatrix(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1?arguments[1]:void 0;const w=S.b.Identity();return this.getRotationMatrixToRef(f,z,w),w}getRotationMatrixToRef(){let f=arguments.length>1?arguments[1]:void 0,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(z);else{const w=F._TmpMats[0],S=this.getAbsoluteMatrix();f?S.multiplyToRef(f.getWorldMatrix(),w):w.p(S),w.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyAtIndex(1,this._scalingDeterminant),w.multiplyAtIndex(2,this._scalingDeterminant),w.getRotationMatrixToRef(z)}}getAbsolutePositionFromLocal(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.n.Zero();return this.getAbsolutePositionFromLocalToRef(f,z,w),w}getAbsolutePositionFromLocalToRef(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0,C=null;z&&(C=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=F._TmpMats[0];E.p(this.getAbsoluteMatrix()),z&&C&&E.multiplyToRef(C,E),S.n.TransformCoordinatesToRef(f,E,w)}getLocalPositionFromAbsolute(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=S.n.Zero();return this.getLocalPositionFromAbsoluteToRef(f,z,w),w}getLocalPositionFromAbsoluteToRef(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0,C=null;z&&(C=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=F._TmpMats[0];E.p(this.getAbsoluteMatrix()),z&&C&&E.multiplyToRef(C,E),E.invert(),S.n.TransformCoordinatesToRef(f,E,w)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}F._TmpVecs=(0,C.e)(2,S.n.Zero),F._TmpQuat=S.f.Identity(),F._TmpMats=(0,C.e)(5,S.b.Identity)},12875:(f,z,w)=>{"use strict";w.d(z,{b:()=>q});var S=w(692),C=w(699),E=w(527),F=w(720),J=w(749),x=w(525),u=w(2412),h=w(560),X=w(726);class K{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(f){this._idleRotationSpeed=f}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(f){this._idleRotationWaitTime=f}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(f){this._idleRotationSpinupTime=f}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(f){this._attachedCamera=f;const z=this._attachedCamera.va();this._onPrePointerObservableObserver=z.onPrePointerObservable.add((f=>{f.type!==u.e.POINTERDOWN?f.type===u.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const f=h.d.Now;let z=0;null!=this._lastFrameTime&&(z=f-this._lastFrameTime),this._lastFrameTime=f,this._applyUserInteraction();const w=f-this._lastInteractionTime-this._idleRotationWaitTime,S=Math.max(Math.min(w/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*S,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(z/1e3))}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.va();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(f){this._lastInteractionTime=f??h.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<X.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let f=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(f=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?f:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=h.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}w(2300);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(f){const z=Math.min(Math.max(f,0),2);this._easingMode=z}getEasingMode(){return this._easingMode}easeInCore(f){throw new Error("You must implement this method")}ease(f){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(f);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-f)}return f>=.5?.5*(1-this.easeInCore(2*(1-f)))+.5:.5*this.easeInCore(2*f)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;var y=w(12647);class e{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(f){if(this._autoTransitionRange===f)return;this._autoTransitionRange=f;const z=this._attachedCamera;z&&(f?this._onMeshTargetChangedObserver=z.onMeshTargetChangedObservable.add((f=>{if(f&&(f.bk(!0),f.getBoundingInfo)){const z=f.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*z,this.upperRadiusTransitionRange=.05*z}})):this._onMeshTargetChangedObserver&&z.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(f){this._attachedCamera=f,this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(f){return!!this._attachedCamera&&(this._attachedCamera.radius===f&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(f){if(!this._attachedCamera)return;this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=y.c.CreateAnimation("radius",y.c.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const z=y.c.TransitionTo("radius",this._attachedCamera.radius+f,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));z&&this._animatables.push(z)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}e.EasingFunction=new class extends c{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=f}easeInCore(f){const z=Math.max(0,this.amplitude);return Math.pow(f,3)-f*z*Math.sin(3.141592653589793*f)}}(.3),e.EasingMode=c.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new E.c,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(f){this._mode=f}get mode(){return this._mode}set radiusScale(f){this._radiusScale=f}get radiusScale(){return this._radiusScale}set positionScale(f){this._positionScale=f}get positionScale(){return this._positionScale}set defaultElevation(f){this._defaultElevation=f}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(f){this._elevationReturnTime=f}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(f){this._elevationReturnWaitTime=f}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(f){this._framingTime=f}get framingTime(){return this._framingTime}init(){}attach(f){this._attachedCamera=f;const z=this._attachedCamera.va();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=z.onPrePointerObservable.add((f=>{f.type!==u.e.POINTERDOWN?f.type===u.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((f=>{f&&f.getBoundingInfo&&this.zoomOnMesh(f,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.va();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.bk(!0);const S=f.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(S.minimumWorld,S.maximumWorld,z,w)}zoomOnMeshHierarchy(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.bk(!0);const S=f.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(S.min,S.max,z,w)}zoomOnMeshesHierarchy(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new F.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let E=0;E<f.length;E++){const z=f[E].getHierarchyBoundingVectors(!0);F.n.CheckExtends(z.min,S,C),F.n.CheckExtends(z.max,S,C)}this.zoomOnBoundingInfo(S,C,z,w)}zoomOnBoundingInfo(f,z){let w,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const E=f.y,J=E+(z.y-E)*this._positionScale,x=z.te(f).scale(.5);if(S)w=new F.n(0,J,0);else{const z=f.add(x);w=new F.n(z.x,J,z.z)}this._vectorTransition||(this._vectorTransition=y.c.CreateAnimation("target",y.c.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let u=y.c.TransitionTo("target",w,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);u&&this._animatables.push(u);let h=0;if(this._mode===O.FitFrustumSidesMode){const w=this._calculateLowerRadiusFromModelBoundingSphere(f,z);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=x.length()+this._attachedCamera.Zj),h=w}else this._mode===O.IgnoreBoundsSizeMode&&(h=this._calculateLowerRadiusFromModelBoundingSphere(f,z),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Zj));if(this.autoCorrectCameraLimitsAndSensibility){const w=z.te(f).length();this._attachedCamera.panningSensibility=5e3/w,this._attachedCamera.wheelPrecision=100/h}return this._radiusTransition||(this._radiusTransition=y.c.CreateAnimation("radius",y.c.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),u=y.c.TransitionTo("radius",h,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),C&&C(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),u&&this._animatables.push(u),!0}_calculateLowerRadiusFromModelBoundingSphere(f,z){const w=this._attachedCamera;if(!w)return 0;let S=w._calculateLowerRadiusFromModelBoundingSphere(f,z,this._radiusScale);return w.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(S=S<w.lowerRadiusLimit?w.lowerRadiusLimit:S),w.upperRadiusLimit&&(S=S>w.upperRadiusLimit?w.upperRadiusLimit:S),S}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const f=h.d.Now-this._lastInteractionTime,z=.5*Math.PI-this._defaultElevation,w=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>w&&f>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=y.c.CreateAnimation("beta",y.c.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const f=y.c.TransitionTo("beta",z,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));f&&this._animatables.push(f)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=h.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new class extends c{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=f}easeInCore(f){return this.exponent<=0?f:(Math.exp(this.exponent*f)-1)/(Math.exp(this.exponent)-1)}},O.EasingMode=c.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var d=w(689),B=w(12627),V=w(12631),W=w(535);class T{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(f){f=W.h.BackCompatCameraNoPreventDefault(arguments);const z=this.camera.getEngine(),w=z.getInputElement();let S=0,C=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=E=>{var F,J;const x=E.event,h="touch"===x.pointerType;if(E.type!==u.e.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const X=x.target;if(this._altKey=x.altKey,this._ctrlKey=x.ctrlKey,this._metaKey=x.metaKey,this._shiftKey=x.shiftKey,this._buttonsPressed=x.buttons,z.isPointerLock){const f=x.movementX,z=x.movementY;this.onTouch(null,f,z),this._pointA=null,this._pointB=null}else{if(E.type!==u.e.POINTERDOWN&&E.type!==u.e.POINTERDOUBLETAP&&h&&(null===(F=this._pointA)||void 0===F?void 0:F.pointerId)!==x.pointerId&&(null===(J=this._pointB)||void 0===J?void 0:J.pointerId)!==x.pointerId)return;if(E.type!==u.e.POINTERDOWN||-1!==this._currentActiveButton&&!h)if(E.type===u.e.POINTERDOUBLETAP)this.onDoubleTap(x.pointerType);else if(E.type!==u.e.POINTERUP||this._currentActiveButton!==x.button&&!h){if(E.type===u.e.POINTERMOVE)if(f||x.preventDefault(),this._pointA&&null===this._pointB){const f=x.clientX-this._pointA.x,z=x.clientY-this._pointA.y;this._pointA.x=x.clientX,this._pointA.y=x.clientY,this.onTouch(this._pointA,f,z)}else if(this._pointA&&this._pointB){const f=this._pointA.pointerId===x.pointerId?this._pointA:this._pointB;f.x=x.clientX,f.y=x.clientY;const z=this._pointA.x-this._pointB.x,w=this._pointA.y-this._pointB.y,F=z*z+w*w,J={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:x.pointerId,type:E.type};this.onMultiTouch(this._pointA,this._pointB,S,F,C,J),C=J,S=F}}else{try{null===X||void 0===X||X.releasePointerCapture(x.pointerId)}catch(K){}h||(this._pointB=null),z._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==x.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==x.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==S||C)&&(this.onMultiTouch(this._pointA,this._pointB,S,0,C,null),S=0,C=null),this._currentActiveButton=-1,this.onButtonUp(x),f||x.preventDefault()}else{try{null===X||void 0===X||X.setPointerCapture(x.pointerId)}catch(K){}if(null===this._pointA)this._pointA={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType};else{if(null!==this._pointB)return;this._pointB={x:x.clientX,y:x.clientY,pointerId:x.pointerId,type:x.pointerType}}-1!==this._currentActiveButton||h||(this._currentActiveButton=x.button),this.onButtonDown(x),f||(x.preventDefault(),w&&w.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,u.e.POINTERDOWN|u.e.POINTERUP|u.e.POINTERMOVE|u.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,S=0,C=null,this.onLostFocus()},this._contextMenuBind=f=>this.onContextMenu(f),w&&w.addEventListener("contextmenu",this._contextMenuBind,!1);const E=this.camera.va().getEngine().getHostWindow();E&&W.h.RegisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}_j(){if(this._onLostFocus){const f=this.camera.va().getEngine().getHostWindow();f&&W.h.UnregisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const f=this.camera.va().getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(f){}onTouch(f,z,w){}onMultiTouch(f,z,w,S,C,E){}onContextMenu(f){f.preventDefault()}onButtonDown(f){}onButtonUp(f){}onLostFocus(){}}(0,S.b)([(0,C.O)()],T.prototype,"buttons",void 0);class v extends T{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(f,z){if(0!==this.panningSensibility&&f&&z){const w=z.x-f.x,S=z.y-f.y;this.camera.inertialPanningX+=-w/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility}}_computePinchZoom(f,z){const w=this.camera.radius||v.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=w*Math.sqrt(f)/Math.sqrt(z):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(z-f)*w*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(z-f)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(f,z,w){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-z/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility):(this.camera.inertialAlphaOffset-=z/this.angularSensibilityX,this.camera.inertialBetaOffset-=w/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(f,z,w,S,C,E){0===w&&null===C||0===S&&null===E||(this.multiTouchPanAndZoom?(this._computePinchZoom(w,S),this._computeMultiTouchPanning(C,E)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(S)-Math.sqrt(w))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(w,S),this._isPinching=!0):this._computeMultiTouchPanning(C,E)):this.multiTouchPanning?this._computeMultiTouchPanning(C,E):this.pinchZoom&&this._computePinchZoom(w,S))}onButtonDown(f){this._isPanClick=f.button===this.camera._panningMouseButton}onButtonUp(f){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}v.MinimumRadiusForPinch=.001,(0,S.b)([(0,C.O)()],v.prototype,"buttons",void 0),(0,S.b)([(0,C.O)()],v.prototype,"angularSensibilityX",void 0),(0,S.b)([(0,C.O)()],v.prototype,"angularSensibilityY",void 0),(0,S.b)([(0,C.O)()],v.prototype,"pinchPrecision",void 0),(0,S.b)([(0,C.O)()],v.prototype,"pinchDeltaPercentage",void 0),(0,S.b)([(0,C.O)()],v.prototype,"useNaturalPinchZoom",void 0),(0,S.b)([(0,C.O)()],v.prototype,"pinchZoom",void 0),(0,S.b)([(0,C.O)()],v.prototype,"panningSensibility",void 0),(0,S.b)([(0,C.O)()],v.prototype,"multiTouchPanning",void 0),(0,S.b)([(0,C.O)()],v.prototype,"multiTouchPanAndZoom",void 0),V.d.ArcRotateCameraPointersInput=v;var D=w(2419);class A{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(f){f=W.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((z=>{const w=z.event;if(!w.metaKey)if(z.type===D.e.KEYDOWN){if(this._ctrlPressed=w.ctrlKey,this._altPressed=w.altKey,-1!==this.keysUp.indexOf(w.keyCode)||-1!==this.keysDown.indexOf(w.keyCode)||-1!==this.keysLeft.indexOf(w.keyCode)||-1!==this.keysRight.indexOf(w.keyCode)||-1!==this.keysReset.indexOf(w.keyCode)){-1===this._keys.indexOf(w.keyCode)&&this._keys.push(w.keyCode),w.preventDefault&&(f||w.preventDefault())}}else if(-1!==this.keysUp.indexOf(w.keyCode)||-1!==this.keysDown.indexOf(w.keyCode)||-1!==this.keysLeft.indexOf(w.keyCode)||-1!==this.keysRight.indexOf(w.keyCode)||-1!==this.keysReset.indexOf(w.keyCode)){const z=this._keys.indexOf(w.keyCode);z>=0&&this._keys.splice(z,1),w.preventDefault&&(f||w.preventDefault())}})))}_j(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let z=0;z<this._keys.length;z++){const w=this._keys[z];-1!==this.keysLeft.indexOf(w)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX-=1/this.panningSensibility:f.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(w)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset+=1/this.zoomingSensibility:f.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(w)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX+=1/this.panningSensibility:f.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(w)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset-=1/this.zoomingSensibility:f.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(w)&&f.useInputToRestoreState&&f.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,S.b)([(0,C.O)()],A.prototype,"keysUp",void 0),(0,S.b)([(0,C.O)()],A.prototype,"keysDown",void 0),(0,S.b)([(0,C.O)()],A.prototype,"keysLeft",void 0),(0,S.b)([(0,C.O)()],A.prototype,"keysRight",void 0),(0,S.b)([(0,C.O)()],A.prototype,"keysReset",void 0),(0,S.b)([(0,C.O)()],A.prototype,"panningSensibility",void 0),(0,S.b)([(0,C.O)()],A.prototype,"zoomingSensibility",void 0),(0,S.b)([(0,C.O)()],A.prototype,"useAltToZoom",void 0),(0,S.b)([(0,C.O)()],A.prototype,"angularSpeed",void 0),V.d.ArcRotateCameraKeyboardMoveInput=A;var M=w(782),G=w(2428),I=w(741);class n{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new F.n(0,0,0),this._globalOffset=new F.n(0,0,0),this._inertialPanning=F.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(f,z){let w=0;const S=.01*f*this.wheelDeltaPercentage*z;return w=f>0?S/(1+this.wheelDeltaPercentage):S*(1+this.wheelDeltaPercentage),w}attachControl(f){f=W.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=z=>{if(z.type!==u.e.POINTERWHEEL)return;const w=z.event;let S=0;const C=w.deltaMode===G.b.DOM_DELTA_LINE?40:1,E=-w.deltaY*C;if(this.customComputeDeltaFromMouseWheel)S=this.customComputeDeltaFromMouseWheel(E,this,w);else if(this.wheelDeltaPercentage){if(S=this._computeDeltaFromMouseWheelLegacyEvent(E,this.camera.radius),S>0){let f=this.camera.radius,z=this.camera.inertialRadiusOffset+S;for(let w=0;w<20&&Math.abs(z)>.001;w++)f-=z,z*=this.camera.inertia;f=(0,I.c)(f,0,Number.MAX_VALUE),S=this._computeDeltaFromMouseWheelLegacyEvent(E,f)}}else S=E/(40*this.wheelPrecision);S&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(S)):this.camera.inertialRadiusOffset+=S),w.preventDefault&&(f||w.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,u.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ed(0)}_j(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const f=this.camera;0+f.inertialAlphaOffset+f.inertialBetaOffset+f.inertialRadiusOffset&&(this._updateHitPlane(),f.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(f.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const f=this.camera,z=f.target.te(f.position);this._hitPlane=M.e.FromPositionAndNormal(f.target,z)}_getPosition(){const f=this.camera,z=f.va(),w=z.createPickingRay(z.pointerX,z.pointerY,F.b.Identity(),f,!1);0===f.targetScreenOffset.x&&0===f.targetScreenOffset.y||(this._viewOffset.set(f.targetScreenOffset.x,f.targetScreenOffset.y,0),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),this._globalOffset=F.n.TransformNormal(this._viewOffset,f._cameraTransformMatrix),w.origin.addInPlace(this._globalOffset));let S=0;return this._hitPlane&&(S=w.intersectsPlane(this._hitPlane)??0),w.origin.addInPlace(w.direction.scaleInPlace(S))}_zoomToMouse(f){const z=this.camera,w=1-z.inertia;if(z.lowerRadiusLimit){const S=z.lowerRadiusLimit??0;z.radius-(z.inertialRadiusOffset+f)/w<S&&(f=(z.radius-S)*w-z.inertialRadiusOffset)}if(z.upperRadiusLimit){const S=z.upperRadiusLimit??0;z.radius-(z.inertialRadiusOffset+f)/w>S&&(f=(z.radius-S)*w-z.inertialRadiusOffset)}const S=f/w/z.radius,C=this._getPosition(),E=F.j.ek[6];C.subtractToRef(z.target,E),E.scaleInPlace(S),E.scaleInPlace(w),this._inertialPanning.addInPlace(E),z.inertialRadiusOffset+=f}_zeroIfClose(f){Math.abs(f.x)<X.e&&(f.x=0),Math.abs(f.y)<X.e&&(f.y=0),Math.abs(f.z)<X.e&&(f.z=0)}}(0,S.b)([(0,C.O)()],n.prototype,"wheelPrecision",void 0),(0,S.b)([(0,C.O)()],n.prototype,"zoomToMouseLocation",void 0),(0,S.b)([(0,C.O)()],n.prototype,"wheelDeltaPercentage",void 0),V.d.ArcRotateCameraMouseWheelInput=n;class P extends V.g{constructor(f){super(f)}addMouseWheel(){return this.add(new n),this}addPointers(){return this.add(new v),this}addKeyboard(){return this.add(new A),this}}var R=w(665);J.e.AddNodeConstructor("ArcRotateCamera",((f,z)=>()=>new q(f,0,0,1,F.n.Zero(),z)));class q extends B.e{get target(){return this._target}set target(f){this.setTarget(f)}get targetHost(){return this._targetHost}set targetHost(f){f&&this.setTarget(f)}getTarget(){return this.target}get position(){return this._position}set position(f){this.setPosition(f)}set upVector(f){this._upToYMatrix||(this._yToUpMatrix=new F.b,this._upToYMatrix=new F.b,this._upVector=F.n.Zero()),f.normalize(),this._upVector.p(f),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){F.b.RotationAlignToRef(F.n.UpReadOnly,this._upVector,this._yToUpMatrix),F.b.RotationAlignToRef(this._upVector,F.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityX:0}set angularSensibilityX(f){const z=this.inputs.attached.pointers;z&&(z.angularSensibilityX=f)}get angularSensibilityY(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityY:0}set angularSensibilityY(f){const z=this.inputs.attached.pointers;z&&(z.angularSensibilityY=f)}get pinchPrecision(){const f=this.inputs.attached.pointers;return f?f.pinchPrecision:0}set pinchPrecision(f){const z=this.inputs.attached.pointers;z&&(z.pinchPrecision=f)}get pinchDeltaPercentage(){const f=this.inputs.attached.pointers;return f?f.pinchDeltaPercentage:0}set pinchDeltaPercentage(f){const z=this.inputs.attached.pointers;z&&(z.pinchDeltaPercentage=f)}get useNaturalPinchZoom(){const f=this.inputs.attached.pointers;return!!f&&f.useNaturalPinchZoom}set useNaturalPinchZoom(f){const z=this.inputs.attached.pointers;z&&(z.useNaturalPinchZoom=f)}get panningSensibility(){const f=this.inputs.attached.pointers;return f?f.panningSensibility:0}set panningSensibility(f){const z=this.inputs.attached.pointers;z&&(z.panningSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const z=this.inputs.attached.keyboard;z&&(z.keysUp=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const z=this.inputs.attached.keyboard;z&&(z.keysDown=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const z=this.inputs.attached.keyboard;z&&(z.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const z=this.inputs.attached.keyboard;z&&(z.keysRight=f)}get wheelPrecision(){const f=this.inputs.attached.mousewheel;return f?f.wheelPrecision:0}set wheelPrecision(f){const z=this.inputs.attached.mousewheel;z&&(z.wheelPrecision=f)}get zoomToMouseLocation(){const f=this.inputs.attached.mousewheel;return!!f&&f.zoomToMouseLocation}set zoomToMouseLocation(f){const z=this.inputs.attached.mousewheel;z&&(z.zoomToMouseLocation=f)}get wheelDeltaPercentage(){const f=this.inputs.attached.mousewheel;return f?f.wheelDeltaPercentage:0}set wheelDeltaPercentage(f){const z=this.inputs.attached.mousewheel;z&&(z.wheelDeltaPercentage=f)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(f){f!==this.useBouncingBehavior&&(f?(this._bouncingBehavior=new e,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(f){f!==this.useFramingBehavior&&(f?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(f){f!==this.useAutoRotationBehavior&&(f?(this._autoRotationBehavior=new K,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(f,z,w,S,C,J){var x;let u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(f,F.n.Zero(),J,u),x=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=F.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=F.l.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new F.b,this.panningAxis=new F.n(1,1,0),this._transformedDirection=new F.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new E.c,this.checkCollisions=!1,this.collisionRadius=new F.n(.5,.5,.5),this._previousPosition=F.n.Zero(),this._collisionVelocity=F.n.Zero(),this._newPosition=F.n.Zero(),this._computationVector=F.n.Zero(),this._onCollisionPositionChange=function(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w?(x.setPosition(z),x.sf&&x.sf(w)):x._previousPosition.p(x._position);const S=Math.cos(x.alpha),C=Math.sin(x.alpha),E=Math.cos(x.beta);let F=Math.sin(x.beta);0===F&&(F=1e-4);const J=x._getTargetPosition();x._computationVector.Gd(x.radius*S*F,x.radius*E,x.radius*C*F),J.addToRef(x._computationVector,x._newPosition),x._position.p(x._newPosition);let u=x.upVector;x.allowUpsideDown&&x.beta<0&&(u=u.clone(),u=u.negate()),x._computeViewMatrix(x._position,J,u),x._viewMatrix.addAtIndex(12,x.targetScreenOffset.x),x._viewMatrix.addAtIndex(13,x.targetScreenOffset.y),x._collisionTriggered=!1},this._target=F.n.Zero(),C&&this.setTarget(C),this.alpha=z,this.beta=w,this.radius=S,this.getViewMatrix(),this.inputs=new P(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=F.l.Zero()}_updateCache(f){f||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const f=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?f.addToRef(this._targetBoundingCenter,this._target):this._target.p(f)}const f=this._getLockedTargetPosition();return f||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>X.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const C=arguments;z=W.h.BackCompatCameraNoPreventDefault(C),this._useCtrlForPanning=w,this._panningMouseButton=S,"boolean"===typeof C[0]&&(C.length>1&&(this._useCtrlForPanning=C[1]),C.length>2&&(this._panningMouseButton=C[2])),this.inputs.attachElement(z),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}_j(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const f=this._scene.getEngine().getDeltaTime()/1e3,z=1-Math.pow(2,-f/this.restoreStateInterpolationFactor);this.setTarget(F.n.Lerp(this.getTarget(),this._storedTarget,z)),F.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,F.j.Quaternion[0]),F.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,F.j.Quaternion[1]),F.f.SlerpToRef(F.j.Quaternion[1],F.j.Quaternion[0],z,F.j.Quaternion[2]),F.j.Quaternion[2].normalize(),F.j.Quaternion[2].toAlphaBetaGammaToRef(F.j.ek[0]),this.alpha=F.j.ek[0].x,this.beta=F.j.ek[0].y,this.radius+=(this._storedRadius-this.radius)*z,F.l.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,z,this.targetScreenOffset),(F.n.DistanceSquared(this.getTarget(),this._storedTarget)<X.e&&F.j.Quaternion[2].equalsWithEpsilon(F.j.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<X.e&&F.l.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<X.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const f=this.invertRotation?-1:1,z=this._calculateHandednessMultiplier();let w=this.inertialAlphaOffset*z;this.beta<0&&(w*=-1),this.alpha+=w*f,this.beta+=this.inertialBetaOffset*f,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<X.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<X.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*X.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const f=new F.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),f.multiplyInPlace(this.panningAxis),F.n.TransformNormalToRef(f,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const f=this.upVector,z=F.n.CrossToRef(this._transformedDirection,f,this._transformedDirection);F.n.CrossToRef(f,z,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);F.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const f=F.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.transposeToRef(f),F.n.TransformCoordinatesToRef(this._transformedDirection,f,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*X.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*X.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const f=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const z=Math.round((f-this.alpha)/(2*Math.PI));this.alpha+=2*z*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(f){this._position.equals(f)||(this._position.p(f),this.rebuildAnglesAndRadius())}setTarget(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(S=this.overrideCloneAlphaBetaRadius??S,f.bk)z&&f.getBoundingInfo?this._targetBoundingCenter=f.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,f.bk(),this._targetHost=f,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const z=f,S=this._getTargetPosition();if(S&&!w&&S.equals(z))return;this._targetHost=null,this._target=z,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}S||this.rebuildAnglesAndRadius()}_getViewMatrix(){const f=Math.cos(this.alpha),z=Math.sin(this.alpha),w=Math.cos(this.beta);let S=Math.sin(this.beta);0===S&&(S=1e-4),0===this.radius&&(this.radius=1e-4);const C=this._getTargetPosition();if(this._computationVector.Gd(this.radius*f*S,this.radius*w,this.radius*z*S),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||F.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),C.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const f=this.va().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,f.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let f=this.upVector;this.allowUpsideDown&&S<0&&(f=f.negate()),this._computeViewMatrix(this._position,C,f),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=C,this._viewMatrix}zoomOn(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f=f||this.va().meshes;const w=x.b.MinMax(f);let S=this._calculateLowerRadiusFromModelBoundingSphere(w.min,w.max);S=Math.max(Math.min(S,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=S*this.zoomOnFactor,this.focusOn({min:w.min,max:w.max,distance:S},z)}focusOn(f){let z,w,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===f.min){const S=f||this.va().meshes;z=x.b.MinMax(S),w=F.n.Distance(z.min,z.max)}else{z=f,w=f.distance}this._target=x.b.Center(z),S||(this.maxZ=2*w)}createRigCamera(f,z){let w=0;switch(this.cameraRigMode){case d.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.e.RIG_MODE_VR:w=this._cameraRigParams.stereoHalfAngle*(0===z?1:-1);break;case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:w=this._cameraRigParams.stereoHalfAngle*(0===z?-1:1)}const S=new q(f,this.alpha+w,this.beta,this.radius,this._target,this.va());return S._cameraRigParams={},S.isRigCamera=!0,S.rigParent=this,S.upVector=this.upVector,S.mode=this.mode,S.orthoLeft=this.orthoLeft,S.orthoRight=this.orthoRight,S.orthoBottom=this.orthoBottom,S.orthoTop=this.orthoTop,S}_updateRigCameras(){const f=this._rigCameras[0],z=this._rigCameras[1];switch(f.beta=z.beta=this.beta,this.cameraRigMode){case d.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.e.RIG_MODE_VR:f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const S=F.n.Distance(f,z),C=this.va().getEngine().getAspectRatio(this),E=Math.tan(this.fov/2),J=E*C,x=.5*S*w,u=x*Math.sqrt(1+1/(J*J)),h=x*Math.sqrt(1+1/(E*E));return Math.max(u,h)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,S.b)([(0,C.O)()],q.prototype,"alpha",void 0),(0,S.b)([(0,C.O)()],q.prototype,"beta",void 0),(0,S.b)([(0,C.O)()],q.prototype,"radius",void 0),(0,S.b)([(0,C.O)()],q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,S.b)([(0,C.K)("target")],q.prototype,"_target",void 0),(0,S.b)([(0,C.B)("targetHost")],q.prototype,"_targetHost",void 0),(0,S.b)([(0,C.O)()],q.prototype,"inertialAlphaOffset",void 0),(0,S.b)([(0,C.O)()],q.prototype,"inertialBetaOffset",void 0),(0,S.b)([(0,C.O)()],q.prototype,"inertialRadiusOffset",void 0),(0,S.b)([(0,C.O)()],q.prototype,"lowerAlphaLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"upperAlphaLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"lowerBetaLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"upperBetaLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"lowerRadiusLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"upperRadiusLimit",void 0),(0,S.b)([(0,C.O)()],q.prototype,"inertialPanningX",void 0),(0,S.b)([(0,C.O)()],q.prototype,"inertialPanningY",void 0),(0,S.b)([(0,C.O)()],q.prototype,"pinchToPanMaxDistance",void 0),(0,S.b)([(0,C.O)()],q.prototype,"panningDistanceLimit",void 0),(0,S.b)([(0,C.K)()],q.prototype,"panningOriginTarget",void 0),(0,S.b)([(0,C.O)()],q.prototype,"panningInertia",void 0),(0,S.b)([(0,C.O)()],q.prototype,"zoomToMouseLocation",null),(0,S.b)([(0,C.O)()],q.prototype,"zoomOnFactor",void 0),(0,S.b)([(0,C.I)()],q.prototype,"targetScreenOffset",void 0),(0,S.b)([(0,C.O)()],q.prototype,"allowUpsideDown",void 0),(0,S.b)([(0,C.O)()],q.prototype,"useInputToRestoreState",void 0),(0,S.b)([(0,C.O)()],q.prototype,"restoreStateInterpolationFactor",void 0),(0,R.f)("BABYLON.ArcRotateCamera",q)},12631:(f,z,w)=>{"use strict";w.d(z,{d:()=>F,g:()=>J});var S=w(548),C=w(753),E=w(689),F={};class J{constructor(f){this.attachedToElement=!1,this.attached={},this.camera=f,this.checkInputs=()=>{}}add(f){const z=f.getSimpleName();this.attached[z]?S.b.Warn("camera input of type "+z+" already exists on camera"):(this.attached[z]=f,f.camera=this.camera,f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f))),this.attachedToElement&&f.attachControl(this.noPreventDefault))}remove(f){for(const z in this.attached){const w=this.attached[z];if(w===f)return w._j(),w.camera=null,delete this.attached[z],void this.rebuildInputCheck()}}removeByType(f){for(const z in this.attached){const w=this.attached[z];w.getClassName()===f&&(w._j(),w.camera=null,delete this.attached[z],this.rebuildInputCheck())}}_addCheckInputs(f){const z=this.checkInputs;return()=>{z(),f()}}attachInput(f){this.attachedToElement&&f.attachControl(this.noPreventDefault)}attachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){f=!E.e.ForceAttachControlToAlwaysPreventDefault&&f,this.attachedToElement=!0,this.noPreventDefault=f;for(const z in this.attached)this.attached[z].attachControl(f)}}detachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const z in this.attached)this.attached[z]._j(),f&&(this.attached[z].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const f in this.attached){const z=this.attached[f];z.checkInputs&&(this.checkInputs=this._addCheckInputs(z.checkInputs.bind(z)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(f){const z={};for(const w in this.attached){const f=this.attached[w],S=C.b.Serialize(f);z[f.getClassName()]=S}f.inputsmgr=z}parse(f){const z=f.inputsmgr;if(z){this.clear();for(const f in z){const w=F[f];if(w){const S=z[f],E=C.b.Parse((()=>new w),S,null);this.add(E)}}}else for(const w in this.attached){const z=F[this.attached[w].getClassName()];if(z){const S=C.b.Parse((()=>new z),f,null);this.remove(this.attached[w]),this.add(S)}}}}},12623:(f,z,w)=>{"use strict";w.d(z,{c:()=>v});var S=w(692),C=w(699),E=w(720),F=w(12627),J=w(12631),x=w(2419),u=w(535);class h{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(f){f=u.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((z=>{const w=z.event;if(!w.metaKey)if(z.type===x.e.KEYDOWN){if(-1!==this.keysUp.indexOf(w.keyCode)||-1!==this.keysDown.indexOf(w.keyCode)||-1!==this.keysLeft.indexOf(w.keyCode)||-1!==this.keysRight.indexOf(w.keyCode)||-1!==this.keysUpward.indexOf(w.keyCode)||-1!==this.keysDownward.indexOf(w.keyCode)||-1!==this.keysRotateLeft.indexOf(w.keyCode)||-1!==this.keysRotateRight.indexOf(w.keyCode)||-1!==this.keysRotateUp.indexOf(w.keyCode)||-1!==this.keysRotateDown.indexOf(w.keyCode)){-1===this._keys.indexOf(w.keyCode)&&this._keys.push(w.keyCode),f||w.preventDefault()}}else if(-1!==this.keysUp.indexOf(w.keyCode)||-1!==this.keysDown.indexOf(w.keyCode)||-1!==this.keysLeft.indexOf(w.keyCode)||-1!==this.keysRight.indexOf(w.keyCode)||-1!==this.keysUpward.indexOf(w.keyCode)||-1!==this.keysDownward.indexOf(w.keyCode)||-1!==this.keysRotateLeft.indexOf(w.keyCode)||-1!==this.keysRotateRight.indexOf(w.keyCode)||-1!==this.keysRotateUp.indexOf(w.keyCode)||-1!==this.keysRotateDown.indexOf(w.keyCode)){const z=this._keys.indexOf(w.keyCode);z>=0&&this._keys.splice(z,1),f||w.preventDefault()}})))}_j(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let z=0;z<this._keys.length;z++){const w=this._keys[z],S=f._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(w)?f._localDirection.Gd(-S,0,0):-1!==this.keysUp.indexOf(w)?f._localDirection.Gd(0,0,S):-1!==this.keysRight.indexOf(w)?f._localDirection.Gd(S,0,0):-1!==this.keysDown.indexOf(w)?f._localDirection.Gd(0,0,-S):-1!==this.keysUpward.indexOf(w)?f._localDirection.Gd(0,S,0):-1!==this.keysDownward.indexOf(w)?f._localDirection.Gd(0,-S,0):-1!==this.keysRotateLeft.indexOf(w)?(f._localDirection.Gd(0,0,0),f.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(w)?(f._localDirection.Gd(0,0,0),f.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(w)?(f._localDirection.Gd(0,0,0),f.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(w)&&(f._localDirection.Gd(0,0,0),f.cameraRotation.x+=this._getLocalRotation()),f.va().useRightHandedSystem&&(f._localDirection.z*=-1),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),E.n.TransformNormalToRef(f._localDirection,f._cameraTransformMatrix,f._transformedDirection),f.cameraDirection.addInPlace(f._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const f=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*f}}(0,S.b)([(0,C.O)()],h.prototype,"keysUp",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysUpward",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysDown",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysDownward",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysLeft",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysRight",void 0),(0,S.b)([(0,C.O)()],h.prototype,"rotationSpeed",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysRotateLeft",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysRotateRight",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysRotateUp",void 0),(0,S.b)([(0,C.O)()],h.prototype,"keysRotateDown",void 0),J.d.FreeCameraKeyboardMoveInput=h;var X=w(527),K=w(2412);class c{constructor(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=f,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new X.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(f){f=u.h.BackCompatCameraNoPreventDefault(arguments);const z=this.camera.getEngine(),w=z.getInputElement();this._pointerInput||(this._pointerInput=S=>{const C=S.event,E="touch"===C.pointerType;if(!this.touchEnabled&&E)return;if(S.type!==K.e.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const F=C.target;if(S.type===K.e.POINTERDOWN){if(E&&-1!==this._activePointerId||!E&&-1!==this._currentActiveButton)return;this._activePointerId=C.pointerId;try{null===F||void 0===F||F.setPointerCapture(C.pointerId)}catch(J){}-1===this._currentActiveButton&&(this._currentActiveButton=C.button),this._previousPosition={x:C.clientX,y:C.clientY},f||(C.preventDefault(),w&&w.focus()),z.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===K.e.POINTERUP){if(E&&this._activePointerId!==C.pointerId||!E&&this._currentActiveButton!==C.button)return;try{null===F||void 0===F||F.releasePointerCapture(C.pointerId)}catch(J){}this._currentActiveButton=-1,this._previousPosition=null,f||C.preventDefault(),this._activePointerId=-1}else if(S.type===K.e.POINTERMOVE&&(this._activePointerId===C.pointerId||!E))if(z.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const z=this.camera._calculateHandednessMultiplier(),w=(C.clientX-this._previousPosition.x)*z,S=C.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=w/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:w,offsetY:S}),this._previousPosition={x:C.clientX,y:C.clientY},f||C.preventDefault()}}),this._onMouseMove=w=>{if(!z.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),C=w.movementX*S;this.camera.cameraRotation.y+=C/this.angularSensibility;const E=w.movementY;this.camera.cameraRotation.x+=E/this.angularSensibility,this._previousPosition=null,f||w.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,K.e.POINTERDOWN|K.e.POINTERUP|K.e.POINTERMOVE),w&&(this._contextMenuBind=f=>this.onContextMenu(f),w.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(f){f.preventDefault()}_j(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,S.b)([(0,C.O)()],c.prototype,"buttons",void 0),(0,S.b)([(0,C.O)()],c.prototype,"angularSensibility",void 0),J.d.FreeCameraMouseInput=c;var y,e=w(2428);class O{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new X.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(f){f=u.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=z=>{if(z.type!==K.e.POINTERWHEEL)return;const w=z.event,S=w.deltaMode===e.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*w.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*w.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*w.deltaZ/this._normalize,w.preventDefault&&(f||w.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,K.e.POINTERWHEEL)}_j(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,S.b)([(0,C.O)()],O.prototype,"wheelPrecisionX",void 0),(0,S.b)([(0,C.O)()],O.prototype,"wheelPrecisionY",void 0),(0,S.b)([(0,C.O)()],O.prototype,"wheelPrecisionZ",void 0),function(f){f[f.MoveRelative=0]="MoveRelative",f[f.RotateRelative=1]="RotateRelative",f[f.MoveScene=2]="MoveScene"}(y||(y={}));class d extends O{constructor(){super(...arguments),this._moveRelative=E.n.Zero(),this._rotateRelative=E.n.Zero(),this._moveScene=E.n.Zero(),this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(f){null===f&&this._wheelXAction!==y.MoveRelative||(this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=f)}get wheelXMoveRelative(){return this._wheelXAction!==y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(f){null===f&&this._wheelYAction!==y.MoveRelative||(this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=f)}get wheelYMoveRelative(){return this._wheelYAction!==y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(f){null===f&&this._wheelZAction!==y.MoveRelative||(this._wheelZAction=y.MoveRelative,this._wheelZActionCoordinate=f)}get wheelZMoveRelative(){return this._wheelZAction!==y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(f){null===f&&this._wheelXAction!==y.RotateRelative||(this._wheelXAction=y.RotateRelative,this._wheelXActionCoordinate=f)}get wheelXRotateRelative(){return this._wheelXAction!==y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(f){null===f&&this._wheelYAction!==y.RotateRelative||(this._wheelYAction=y.RotateRelative,this._wheelYActionCoordinate=f)}get wheelYRotateRelative(){return this._wheelYAction!==y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(f){null===f&&this._wheelZAction!==y.RotateRelative||(this._wheelZAction=y.RotateRelative,this._wheelZActionCoordinate=f)}get wheelZRotateRelative(){return this._wheelZAction!==y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(f){null===f&&this._wheelXAction!==y.MoveScene||(this._wheelXAction=y.MoveScene,this._wheelXActionCoordinate=f)}get wheelXMoveScene(){return this._wheelXAction!==y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(f){null===f&&this._wheelYAction!==y.MoveScene||(this._wheelYAction=y.MoveScene,this._wheelYActionCoordinate=f)}get wheelYMoveScene(){return this._wheelYAction!==y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(f){null===f&&this._wheelZAction!==y.MoveScene||(this._wheelZAction=y.MoveScene,this._wheelZActionCoordinate=f)}get wheelZMoveScene(){return this._wheelZAction!==y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ed(0),this._rotateRelative.Ed(0),this._moveScene.Ed(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const f=E.b.Zero();this.camera.getViewMatrix().invertToRef(f);const z=E.n.Zero();E.n.TransformNormalToRef(this._moveRelative,f,z),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(z),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(f,z,w){if(0===f)return;if(null===z||null===w)return;let S=null;switch(z){case y.MoveRelative:S=this._moveRelative;break;case y.RotateRelative:S=this._rotateRelative;break;case y.MoveScene:S=this._moveScene}switch(w){case 0:S.set(f,0,0);break;case 1:S.set(0,f,0);break;case 2:S.set(0,0,f)}}}(0,S.b)([(0,C.O)()],d.prototype,"wheelXMoveRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelYMoveRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelZMoveRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelXRotateRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelYRotateRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelZRotateRelative",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelXMoveScene",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelYMoveScene",null),(0,S.b)([(0,C.O)()],d.prototype,"wheelZMoveScene",null),J.d.FreeCameraMouseWheelInput=d;class B{constructor(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=f,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=u.h.IsSafari()}attachControl(f){f=u.h.BackCompatCameraNoPreventDefault(arguments);let z=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=w=>{const S=w.event,C="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!C)if(w.type===K.e.POINTERDOWN){if(f||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;z={x:S.clientX,y:S.clientY}}else if(w.type===K.e.POINTERUP){f||S.preventDefault();const w=this._pointerPressed.indexOf(S.pointerId);if(-1===w)return;if(this._pointerPressed.splice(w,1),0!=w)return;z=null,this._offsetX=null,this._offsetY=null}else if(w.type===K.e.POINTERMOVE){if(f||S.preventDefault(),!z)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-z.x,this._offsetY=-(S.clientY-z.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,K.e.POINTERDOWN|K.e.POINTERUP|K.e.POINTERMOVE),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.addEventListener("blur",this._onLostFocus)}}_j(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const f=this.camera,z=f._calculateHandednessMultiplier();f.cameraRotation.y=z*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)f.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const z=f._computeLocalCameraSpeed(),w=new E.n(0,0,0!==this.touchMoveSensibility?z*this._offsetY/this.touchMoveSensibility:0);E.b.RotationYawPitchRollToRef(f.rotation.y,f.rotation.x,0,f._cameraRotationMatrix),f.cameraDirection.addInPlace(E.n.TransformCoordinates(w,f._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,S.b)([(0,C.O)()],B.prototype,"touchAngularSensibility",void 0),(0,S.b)([(0,C.O)()],B.prototype,"touchMoveSensibility",void 0),J.d.FreeCameraTouchInput=B;class V extends J.g{constructor(f){super(f),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new h),this}addMouse(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new c(f),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new d,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new B),this}clear(){super.clear(),this._mouseInput=null}}var W=w(665),T=w(616);class v extends F.e{get angularSensibility(){const f=this.inputs.attached.mouse;return f?f.angularSensibility:0}set angularSensibility(f){const z=this.inputs.attached.mouse;z&&(z.angularSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const z=this.inputs.attached.keyboard;z&&(z.keysUp=f)}get keysUpward(){const f=this.inputs.attached.keyboard;return f?f.keysUpward:[]}set keysUpward(f){const z=this.inputs.attached.keyboard;z&&(z.keysUpward=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const z=this.inputs.attached.keyboard;z&&(z.keysDown=f)}get keysDownward(){const f=this.inputs.attached.keyboard;return f?f.keysDownward:[]}set keysDownward(f){const z=this.inputs.attached.keyboard;z&&(z.keysDownward=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const z=this.inputs.attached.keyboard;z&&(z.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const z=this.inputs.attached.keyboard;z&&(z.keysRight=f)}get keysRotateLeft(){const f=this.inputs.attached.keyboard;return f?f.keysRotateLeft:[]}set keysRotateLeft(f){const z=this.inputs.attached.keyboard;z&&(z.keysRotateLeft=f)}get keysRotateRight(){const f=this.inputs.attached.keyboard;return f?f.keysRotateRight:[]}set keysRotateRight(f){const z=this.inputs.attached.keyboard;z&&(z.keysRotateRight=f)}get keysRotateUp(){const f=this.inputs.attached.keyboard;return f?f.keysRotateUp:[]}set keysRotateUp(f){const z=this.inputs.attached.keyboard;z&&(z.keysRotateUp=f)}get keysRotateDown(){const f=this.inputs.attached.keyboard;return f?f.keysRotateDown:[]}set keysRotateDown(f){const z=this.inputs.attached.keyboard;z&&(z.keysRotateDown=f)}constructor(f,z,w){var S;super(f,z,w,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new E.n(.5,1,.5),this.ellipsoidOffset=new E.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=E.n.Zero(),this._diffPosition=E.n.Zero(),this._newPosition=E.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.p(z),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>T.e.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.p(S._deferredPositionUpdate),S.sf&&w&&S.sf(w))},this.inputs=new V(this),this.inputs.addKeyboard().addMouse()}attachControl(f,z){z=u.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(z)}_j(){this.inputs.detachElement(),this.cameraDirection=new E.n(0,0,0),this.cameraRotation=new E.l(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(f){this._collisionMask=isNaN(f)?-1:f}_collideWithWorld(f){let z;z=this.parent?E.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,z.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const w=this.va().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=f;this.applyGravity&&(S=f.add(this.va().gravity)),w.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=E.n.Zero(),this._transformedDirection=E.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(f){this._needMoveForGravity=f}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"cb"}}(0,S.b)([(0,C.K)()],v.prototype,"ellipsoid",void 0),(0,S.b)([(0,C.K)()],v.prototype,"ellipsoidOffset",void 0),(0,S.b)([(0,C.O)()],v.prototype,"checkCollisions",void 0),(0,S.b)([(0,C.O)()],v.prototype,"applyGravity",void 0),(0,W.f)("BABYLON.FreeCamera",v)},12627:(f,z,w)=>{"use strict";w.d(z,{e:()=>u});var S=w(692),C=w(699),E=w(689),F=w(720),J=w(726),x=w(876);w(749).e.AddNodeConstructor("TargetCamera",((f,z)=>()=>new u(f,F.n.Zero(),z)));class u extends E.e{constructor(f,z,w){super(f,z,w,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=F.n.Zero(),this._tmpTargetVector=F.n.Zero(),this.cameraDirection=new F.n(0,0,0),this.cameraRotation=new F.l(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new F.f,this.rotation=new F.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=F.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=F.b.Zero(),this._camMatrix=F.b.Zero(),this._cameraTransformMatrix=F.b.Zero(),this._cameraRotationMatrix=F.b.Zero(),this._referencePoint=new F.n(0,0,1),this._transformedReferencePoint=F.n.Zero(),this._deferredPositionUpdate=new F.n,this._deferredRotationQuaternionUpdate=new F.f,this._deferredRotationUpdate=new F.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=F.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(f){this.getWorldMatrix();const z=this.getTarget().te(this.position);return z.normalize(),z.scaleInPlace(f),this.globalPosition.add(z)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const f=this.lockedTarget;f.bk().getTranslationToRef(f.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Gd(0,0,0),this.cameraRotation.Gd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new F.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(f){f||super._updateCache();const z=this._getLockedTargetPosition();z?this._cache.lockedTarget?this._cache.lockedTarget.p(z):this._cache.lockedTarget=z.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const f=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(f):!f)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const f=this.getEngine();return this.speed*Math.sqrt(f.getDeltaTime()/(100*f.getFps()))}setTarget(f){this.upVector.normalize(),this._initialFocalDistance=f.te(this.position).length(),this.position.z===f.z&&(this.position.z+=J.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),F.b.LookAtLHToRef(this.position,f,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const z=f.te(this.position);z.x>=0?this.rotation.y=-Math.atan(z.z/z.x)+Math.PI/2:this.rotation.y=-Math.atan(z.z/z.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&F.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(f){this.setTarget(f)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(F.j.Matrix[0]),F.n.TransformNormalToRef(this.cameraDirection,F.j.Matrix[0],F.j.ek[0]),this._deferredPositionUpdate.addInPlace(F.j.ek[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const f=this.invertRotation?-this.inverseRotationSpeed:1,z=this._decideIfNeedsToMove(),w=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),z&&this._updatePosition(),w){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*f,this._deferredRotationUpdate.y+=this.cameraRotation.y*f,!this.noRotationConstraint){const f=1.570796;this._deferredRotationUpdate.x>f&&(this._deferredRotationUpdate.x=f),this._deferredRotationUpdate.x<-f&&(this._deferredRotationUpdate.x=-f)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(F.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}z&&(Math.abs(this.cameraDirection.x)<this.speed*J.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*J.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*J.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),w&&(Math.abs(this.cameraRotation.x)<this.speed*J.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*J.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):F.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return F.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),F.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?x.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(F.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),x.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(f,z,w){if(this.ignoreParentScaling){if(this.parent){const S=this.parent.getWorldMatrix();F.n.TransformCoordinatesToRef(f,S,this._globalPosition),F.n.TransformCoordinatesToRef(z,S,this._tmpTargetVector),F.n.TransformNormalToRef(w,S,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(f),this._tmpTargetVector.p(z),this._tmpUpVector.p(w);this.va().useRightHandedSystem?F.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):F.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?F.b.LookAtRHToRef(f,z,w,this._viewMatrix):F.b.LookAtLHToRef(f,z,w,this._viewMatrix),this.parent){const f=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(f,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(f)}createRigCamera(f,z){if(this.cameraRigMode!==E.e.RIG_MODE_NONE){const z=new u(f,this.position.clone(),this.va());return z.isRigCamera=!0,z.rigParent=this,this.cameraRigMode===E.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new F.f),z._cameraRigParams={},z.rotationQuaternion=new F.f),z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoTop=this.orthoTop,z.orthoBottom=this.orthoBottom,z}return null}_updateRigCameras(){const f=this._rigCameras[0],z=this._rigCameras[1];switch(this.bk(),this.cameraRigMode){case E.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case E.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case E.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const w=this.cameraRigMode===E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,S=this.cameraRigMode===E.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*w,f),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*S,z);break}case E.e.RIG_MODE_VR:f.rotationQuaternion?(f.rotationQuaternion.p(this.rotationQuaternion),z.rotationQuaternion.p(this.rotationQuaternion)):(f.rotation.p(this.rotation),z.rotation.p(this.rotation)),f.position.p(this.position),z.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(f,z){this.getTarget().subtractToRef(this.position,u._TargetFocalPoint),u._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const w=u._TargetFocalPoint.addInPlace(this.position);F.b.TranslationToRef(-w.x,-w.y,-w.z,u._TargetTransformMatrix),u._TargetTransformMatrix.multiplyToRef(F.b.RotationAxis(z.upVector,f),u._RigCamTransformMatrix),F.b.TranslationToRef(w.x,w.y,w.z,u._TargetTransformMatrix),u._RigCamTransformMatrix.multiplyToRef(u._TargetTransformMatrix,u._RigCamTransformMatrix),F.n.TransformCoordinatesToRef(this.position,u._RigCamTransformMatrix,z.position),z.setTarget(w)}getClassName(){return"TargetCamera"}}u._RigCamTransformMatrix=new F.b,u._TargetTransformMatrix=new F.b,u._TargetFocalPoint=new F.n,(0,S.b)([(0,C.K)()],u.prototype,"rotation",void 0),(0,S.b)([(0,C.O)()],u.prototype,"speed",void 0),(0,S.b)([(0,C.B)("lockedTargetId")],u.prototype,"lockedTarget",void 0)},12928:(f,z,w)=>{"use strict";w.d(z,{b:()=>E});var S=w(715),C=w(12936);class E{constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=w,this.al=[],this._maxBlockCapacity=z||64,this._selectionContent=new S.d(1024),this._creationFunc=f}update(f,z,w){C.b._CreateBlocks(f,z,w,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}yk(f){for(let z=0;z<this.$i.length;z++){this.$i[z].addEntry(f)}}Nc(f){for(let z=0;z<this.$i.length;z++){this.$i[z].removeEntry(f)}}select(f,z){this._selectionContent.reset();for(let w=0;w<this.$i.length;w++){this.$i[w].select(f,this._selectionContent,z)}return z?this._selectionContent.concat(this.al):this._selectionContent.concatWithNoDuplicate(this.al),this._selectionContent}intersects(f,z,w){this._selectionContent.reset();for(let S=0;S<this.$i.length;S++){this.$i[S].intersects(f,z,this._selectionContent,w)}return w?this._selectionContent.concat(this.al):this._selectionContent.concatWithNoDuplicate(this.al),this._selectionContent}intersectsRay(f){this._selectionContent.reset();for(let z=0;z<this.$i.length;z++){this.$i[z].intersectsRay(f,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.al),this._selectionContent}}E.CreationFuncForMeshes=(f,z)=>{const w=f.getBoundingInfo();!f.isBlocked&&w.boundingBox.intersectsMinMax(z.cl,z.dl)&&z.entries.push(f)},E.CreationFuncForSubMeshes=(f,z)=>{f.getBoundingInfo().boundingBox.intersectsMinMax(z.cl,z.dl)&&z.entries.push(f)}},12936:(f,z,w)=>{"use strict";w.d(z,{b:()=>E});var S=w(720),C=w(816);class E{constructor(f,z,w,S,C,E){this.entries=[],this.el=new Array,this._capacity=w,this._depth=S,this._maxDepth=C,this._creationFunc=E,this._minPoint=f,this._maxPoint=z,this.el.push(f.clone()),this.el.push(z.clone()),this.el.push(f.clone()),this.el[2].x=z.x,this.el.push(f.clone()),this.el[3].y=z.y,this.el.push(f.clone()),this.el[4].z=z.z,this.el.push(z.clone()),this.el[5].z=f.z,this.el.push(z.clone()),this.el[6].x=f.x,this.el.push(z.clone()),this.el[7].y=f.y}get _a(){return this._capacity}get cl(){return this._minPoint}get dl(){return this._maxPoint}addEntry(f){if(this.$i)for(let z=0;z<this.$i.length;z++){this.$i[z].addEntry(f)}else this._creationFunc(f,this),this.entries.length>this._a&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(f){if(this.$i){for(let z=0;z<this.$i.length;z++){this.$i[z].removeEntry(f)}return}const z=this.entries.indexOf(f);z>-1&&this.entries.splice(z,1)}addEntries(f){for(let z=0;z<f.length;z++){const w=f[z];this.addEntry(w)}}select(f,z,w){if(C.b.IsInFrustum(this.el,f)){if(this.$i){for(let S=0;S<this.$i.length;S++){this.$i[S].select(f,z,w)}return}w?z.concat(this.entries):z.concatWithNoDuplicate(this.entries)}}intersects(f,z,w,S){if(C.b.IntersectsSphere(this._minPoint,this._maxPoint,f,z)){if(this.$i){for(let C=0;C<this.$i.length;C++){this.$i[C].intersects(f,z,w,S)}return}S?w.concat(this.entries):w.concatWithNoDuplicate(this.entries)}}intersectsRay(f,z){if(f.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.$i){for(let w=0;w<this.$i.length;w++){this.$i[w].intersectsRay(f,z)}return}z.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){E._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(f,z,w,C,F,J,x,u){x.$i=new Array;const h=new S.n((z.x-f.x)/2,(z.y-f.y)/2,(z.z-f.z)/2);for(let S=0;S<2;S++)for(let z=0;z<2;z++)for(let X=0;X<2;X++){const K=f.add(h.multiplyByFloats(S,z,X)),c=f.add(h.multiplyByFloats(S+1,z+1,X+1)),y=new E(K,c,C,F+1,J,u);y.addEntries(w),x.$i.push(y)}}}},12938:(f,z,w)=>{"use strict";w.d(z,{e:()=>h});var S=w(2386),C=w(720),E=w(853),F=w(12320),J=w(914),x=w(12928),u=w(580);S.c.prototype.createOrUpdateSelectionOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,w=this._getComponent(J.d.NAME_OCTREE);w||(w=new h(this),this.o(w)),this.$k||(this.$k=new x.b(x.b.CreationFuncForMeshes,f,z));const S=this.getWorldExtends();return this.$k.update(S.min,S.max,this.meshes),this.$k},Object.defineProperty(S.c.prototype,"selectionOctree",{get:function(){return this.$k},enumerable:!0,configurable:!0}),E.c.prototype.createOrUpdateSubmeshesOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const w=this.va();let S=w._getComponent(J.d.NAME_OCTREE);S||(S=new h(w),w.o(S)),this._submeshesOctree||(this._submeshesOctree=new x.b(x.b.CreationFuncForSubMeshes,f,z)),this.bk(!0);const C=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(C.minimumWorld,C.maximumWorld,this.pk),this._submeshesOctree};class h{constructor(f){this.name=J.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new F.e(C.n.Zero(),new C.n(1,1,1)),(f=f||u.c.LastCreatedScene)&&(this.Rc=f,this.Rc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Rc.getActiveSubMeshCandidates=f=>this.getActiveSubMeshCandidates(f),this.Rc.getCollidingSubMeshCandidates=(f,z)=>this.getCollidingSubMeshCandidates(f,z),this.Rc.getIntersectingSubMeshCandidates=(f,z)=>this.getIntersectingSubMeshCandidates(f,z))}register(){this.Rc.onMeshRemovedObservable.add((f=>{const z=this.Rc.selectionOctree;if(void 0!==z&&null!==z){const w=z.al.indexOf(f);-1!==w&&z.al.splice(w,1)}})),this.Rc.onMeshImportedObservable.add((f=>{const z=this.Rc.selectionOctree;void 0!==z&&null!==z&&z.yk(f)}))}getActiveMeshCandidates(){var f;return(null===(f=this.Rc.$k)||void 0===f?void 0:f.select(this.Rc.frustumPlanes))||this.Rc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(f){if(f._submeshesOctree&&f.useOctreeForRenderingSelection){return f._submeshesOctree.select(this.Rc.frustumPlanes)}return this.Rc._getDefaultSubMeshCandidates(f)}getIntersectingSubMeshCandidates(f,z){if(f._submeshesOctree&&f.useOctreeForPicking){F.e.TransformToRef(z,f.getWorldMatrix(),this._tempRay);return f._submeshesOctree.intersectsRay(this._tempRay)}return this.Rc._getDefaultSubMeshCandidates(f)}getCollidingSubMeshCandidates(f,z){if(f._submeshesOctree&&f.useOctreeForCollisions){const w=z._velocityWorldLength+Math.max(z._radius.x,z._radius.y,z._radius.z);return f._submeshesOctree.intersects(z._basePointWorld,w)}return this.Rc._getDefaultSubMeshCandidates(f)}rebuild(){}dispose(){}}},12320:(f,z,w)=>{"use strict";w.d(z,{e:()=>c});var S=w(2386),C=w(689),E=w(726),F=w(720),J=w(732),x=w(803),u=w(865),h=w(580),X=w(2431);const K={internalPickerForMesh:void 0};class c{constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.e;this.origin=f,this.direction=z,this.length=w,this.epsilon=S}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=c._TmpVector3[0].Gd(f.x-w,f.y-w,f.z-w),C=c._TmpVector3[1].Gd(z.x+w,z.y+w,z.z+w);let E,F,J,x,u=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>C.x)return!1}else if(E=1/this.direction.x,F=(S.x-this.origin.x)*E,J=(C.x-this.origin.x)*E,J===-1/0&&(J=1/0),F>J&&(x=F,F=J,J=x),u=Math.max(F,u),h=Math.min(J,h),u>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>C.y)return!1}else if(E=1/this.direction.y,F=(S.y-this.origin.y)*E,J=(C.y-this.origin.y)*E,J===-1/0&&(J=1/0),F>J&&(x=F,F=J,J=x),u=Math.max(F,u),h=Math.min(J,h),u>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>C.z)return!1}else if(E=1/this.direction.z,F=(S.z-this.origin.z)*E,J=(C.z-this.origin.z)*E,J===-1/0&&(J=1/0),F>J&&(x=F,F=J,J=x),u=Math.max(F,u),h=Math.min(J,h),u>h)return!1;return!0}intersectsBox(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(f.minimum,f.maximum,z)}intersectsSphere(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const w=f.center.x-this.origin.x,S=f.center.y-this.origin.y,C=f.center.z-this.origin.z,E=w*w+S*S+C*C,F=f.radius+z,J=F*F;if(E<=J)return!0;const x=w*this.direction.x+S*this.direction.y+C*this.direction.z;if(x<0)return!1;return E-x*x<=J}intersectsTriangle(f,z,w){const S=c._TmpVector3[0],C=c._TmpVector3[1],E=c._TmpVector3[2],J=c._TmpVector3[3],u=c._TmpVector3[4];z.subtractToRef(f,S),w.subtractToRef(f,C),F.n.CrossToRef(this.direction,C,E);const h=F.n.Dot(S,E);if(0===h)return null;const X=1/h;this.origin.subtractToRef(f,J);const K=F.n.Dot(J,E)*X;if(K<-this.epsilon||K>1+this.epsilon)return null;F.n.CrossToRef(J,S,u);const y=F.n.Dot(this.direction,u)*X;if(y<-this.epsilon||K+y>1+this.epsilon)return null;const e=F.n.Dot(C,u)*X;return e>this.length?null:new x.d(1-K-y,K,e)}intersectsPlane(f){let z;const w=F.n.Dot(f.lk,this.direction);if(Math.abs(w)<9.99999997475243e-7)return null;{const S=F.n.Dot(f.lk,this.origin);return z=(-f.d-S)/w,z<0?z<-9.99999997475243e-7?null:0:z}}intersectsAxis(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(f){case"y":{const f=(this.origin.y-z)/this.direction.y;return f>0?null:new F.n(this.origin.x+this.direction.x*-f,z,this.origin.z+this.direction.z*-f)}case"x":{const f=(this.origin.x-z)/this.direction.x;return f>0?null:new F.n(z,this.origin.y+this.direction.y*-f,this.origin.z+this.direction.z*-f)}case"z":{const f=(this.origin.z-z)/this.direction.z;return f>0?null:new F.n(this.origin.x+this.direction.x*-f,this.origin.y+this.direction.y*-f,z)}default:return null}}intersectsMesh(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=F.j.Matrix[0];return f.getWorldMatrix().invertToRef(J),this._tmpRay?c.TransformToRef(this,J,this._tmpRay):this._tmpRay=c.Transform(this,J),f.intersects(this._tmpRay,z,w,S,C,E)}intersectsMeshes(f,z,w){w?w.length=0:w=[];for(let S=0;S<f.length;S++){const C=this.intersectsMesh(f[S],z);C.hit&&w.push(C)}return w.sort(this._comparePickingInfo),w}_comparePickingInfo(f,z){return f.distance<z.distance?-1:f.distance>z.distance?1:0}intersectionSegment(f,z,w){const S=this.origin,C=F.j.ek[0],E=F.j.ek[1],J=F.j.ek[2],x=F.j.ek[3];z.subtractToRef(f,C),this.direction.scaleToRef(c._Rayl,J),S.addToRef(J,E),f.subtractToRef(S,x);const u=F.n.Dot(C,C),h=F.n.Dot(C,J),X=F.n.Dot(J,J),K=F.n.Dot(C,x),y=F.n.Dot(J,x),e=u*X-h*h;let O,d,B=e,V=e;e<c._Smallnum?(O=0,B=1,d=y,V=X):(O=h*y-X*K,d=u*y-h*K,O<0?(O=0,d=y,V=X):O>B&&(O=B,d=y+h,V=X)),d<0?(d=0,-K<0?O=0:-K>u?O=B:(O=-K,B=u)):d>V&&(d=V,-K+h<0?O=0:-K+h>u?O=B:(O=-K+h,B=u));const W=Math.abs(O)<c._Smallnum?0:O/B,T=Math.abs(d)<c._Smallnum?0:d/V,v=F.j.ek[4];J.scaleToRef(T,v);const D=F.j.ek[5];C.scaleToRef(W,D),D.addInPlace(x);const A=F.j.ek[6];D.subtractToRef(v,A);return T>0&&T<=this.length&&A.lengthSquared()<w*w?D.length():-1}update(f,z,w,S,C,E,J){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(f,z,w,S,F.b.IdentityReadOnly,E,J);const x=F.j.Matrix[0];C.invertToRef(x),c.TransformToRef(c._RayDistant,x,this)}else this.unprojectRayToRef(f,z,w,S,C,E,J);return this}static Zero(){return new c(F.n.Zero(),F.n.Zero())}static CreateNew(f,z,w,S,C,E,F){return c.Zero().update(f,z,w,S,C,E,F)}static CreateNewFromTo(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.IdentityReadOnly;const S=new c(new F.n(0,0,0),new F.n(0,0,0));return c.CreateFromToToRef(f,z,S,w)}static CreateFromToToRef(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.b.IdentityReadOnly;w.origin.p(f);const C=z.subtractToRef(f,w.direction),E=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);return w.length=E,w.direction.normalize(),c.TransformToRef(w,S,w)}static Transform(f,z){const w=new c(new F.n(0,0,0),new F.n(0,0,0));return c.TransformToRef(f,z,w),w}static TransformToRef(f,z,w){F.n.TransformCoordinatesToRef(f.origin,z,w.origin),F.n.TransformNormalToRef(f.direction,z,w.direction),w.length=f.length,w.epsilon=f.epsilon;const S=w.direction,C=S.length();if(0!==C&&1!==C){const f=1/C;S.x*=f,S.y*=f,S.z*=f,w.length*=C}return w}unprojectRayToRef(f,z,w,S,C,E,J){const x=F.j.Matrix[0];C.multiplyToRef(E,x),x.multiplyToRef(J,x),x.invert();const u=h.c.LastCreatedEngine,X=F.j.ek[0];X.x=f/w*2-1,X.y=-(z/S*2-1),X.z=null!==u&&void 0!==u&&u.useReverseDepthBuffer?1:null!==u&&void 0!==u&&u.isNDCHalfZRange?0:-1;const K=F.j.ek[1].Gd(X.x,X.y,1-1e-8),c=F.j.ek[2],y=F.j.ek[3];F.n._UnprojectFromInvertedMatrixToRef(X,x,c),F.n._UnprojectFromInvertedMatrixToRef(K,x,y),this.origin.p(c),y.subtractToRef(c,this.direction),this.direction.normalize()}}function y(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=c.Zero();return e(f,z,w,S,F,C,E),F}function e(f,z,w,S,C,E){let J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const u=f.getEngine();if(!E&&!(E=f.activeCamera))return f;const h=E.viewport,X=u.getRenderHeight(),{x:K,y:c,width:y,height:e}=h.toGlobal(u.getRenderWidth(),X),O=1/u.getHardwareScalingLevel();return z=z*O-K,w=w*O-(X-c-e),C.update(z,w,y,e,S||F.b.IdentityReadOnly,J?F.b.IdentityReadOnly:E.getViewMatrix(),E.getProjectionMatrix(),x),f}function O(f,z,w,S,C){if(!u.e)return f;const E=f.getEngine();if(!C&&!(C=f.activeCamera))throw new Error("Active camera not set");const J=C.viewport,x=E.getRenderHeight(),{x:h,y:X,width:K,height:c}=J.toGlobal(E.getRenderWidth(),x),y=F.b.Identity(),e=1/E.getHardwareScalingLevel();return z=z*e-h,w=w*e-(x-X-c),S.update(z,w,K,c,y,y,C.getProjectionMatrix()),f}function d(f,z,w,S,C,E,F,J){const x=z(S,w.enableDistantPicking),u=w.intersects(x,C,F,E,S,J);return u&&u.hit?!C&&null!=f&&u.distance>=f.distance?null:u:null}function B(f,z,w,S,C,E){let J=null;const x=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),h=f.cameraToUseForPointers||f.activeCamera,X=K.internalPickerForMesh||d;for(let u=0;u<f.meshes.length;u++){const K=f.meshes[u];if(w){if(!w(K,-1))continue}else if(!K.isEnabled()||!K.isVisible||!K.yb)continue;const c=x&&K.isWorldMatrixCameraDependent(),y=K.bk(c,h);if(K.hasThinInstances&&K.thinInstanceEnablePicking){const f=X(J,z,K,y,!0,!0,E);if(f){if(C)return f;const x=F.j.Matrix[1],u=K.thinInstanceGetWorldMatrices();for(let f=0;f<u.length;f++){if(w&&!w(K,f))continue;u[f].multiplyToRef(y,x);const F=X(J,z,K,x,S,C,E,!0);if(F&&(J=F,J.thinInstanceIndex=f,S))return J}}}else{const f=X(J,z,K,y,S,C,E);if(f&&(J=f,S))return J}}return J||new u.e}function V(f,z,w,S){if(!u.e)return null;const C=[],E=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),J=f.cameraToUseForPointers||f.activeCamera,x=K.internalPickerForMesh||d;for(let u=0;u<f.meshes.length;u++){const h=f.meshes[u];if(w){if(!w(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.yb)continue;const X=E&&h.isWorldMatrixCameraDependent(),K=h.bk(X,J);if(h.hasThinInstances&&h.thinInstanceEnablePicking){if(x(null,z,h,K,!0,!0,S)){const f=F.j.Matrix[1],E=h.thinInstanceGetWorldMatrices();for(let F=0;F<E.length;F++){if(w&&!w(h,F))continue;E[F].multiplyToRef(K,f);const J=x(null,z,h,f,!1,!1,S,!0);J&&(J.thinInstanceIndex=F,C.push(J))}}}else{const f=x(null,z,h,K,!1,!1,S);f&&C.push(f)}}return C}function W(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;S||(S=f.getWorldMatrix()),z.length=w,C?z.origin.p(C):z.origin.p(f.position);const E=F.j.ek[2];E.set(0,0,f._scene.useRightHandedSystem?-1:1);const J=F.j.ek[3];return F.n.TransformNormalToRef(E,S,J),F.n.NormalizeToRef(J,z.direction),z}var T,v;c._TmpVector3=(0,J.e)(6,F.n.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9,T=S.c,(v=C.e)&&(v.prototype.getForwardRay=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,z=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;return W(this,new c(F.n.Zero(),F.n.Zero(),f),f,z,w)},v.prototype.getForwardRayToRef=function(f){return W(this,f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),T&&(X.d._IsPickingAvailable=!0,T.prototype.createPickingRay=function(f,z,w,S){return y(this,f,z,w,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.c.prototype.createPickingRayToRef=function(f,z,w,S,C){return e(this,f,z,w,S,C,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.c.prototype.createPickingRayInCameraSpace=function(f,z,w){return function(f,z,w,S){const C=c.Zero();return O(f,z,w,C,S),C}(this,f,z,w)},S.c.prototype.createPickingRayInCameraSpaceToRef=function(f,z,w,S){return O(this,f,z,w,S)},S.c.prototype.pickWithBoundingInfo=function(f,z,w,S,C){return function(f,z,w,S,C,E){if(!u.e)return null;const J=B(f,(S=>(f._tempPickingRay||(f._tempPickingRay=c.Zero()),e(f,z,w,S,f._tempPickingRay,E||null),f._tempPickingRay)),S,C,!0);return J&&(J.ray=y(f,z,w,F.b.Identity(),E||null)),J}(this,f,z,w,S,C)},S.c.prototype.se=function(f,z,w,S,C,E){return function(f,z,w,S,C,E,J){const x=B(f,((S,C)=>(f._tempPickingRay||(f._tempPickingRay=c.Zero()),e(f,z,w,S,f._tempPickingRay,E||null,!1,C),f._tempPickingRay)),S,C,!1,J);return x&&(x.ray=y(f,z,w,F.b.Identity(),E||null)),x}(this,f,z,w,S,C,E)},S.c.prototype.pickWithRay=function(f,z,w,S){return function(f,z,w,S,C){const E=B(f,(w=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=F.b.Identity()),w.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=c.Zero()),c.TransformToRef(z,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),w,S,!1,C);return E&&(E.ray=z),E}(this,f,z,w,S)},S.c.prototype.multiPick=function(f,z,w,S,C){return function(f,z,w,S,C,E){return V(f,(S=>y(f,z,w,S,C||null)),S,E)}(this,f,z,w,S,C)},S.c.prototype.multiPickWithRay=function(f,z,w){return function(f,z,w,S){return V(f,(w=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=F.b.Identity()),w.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=c.Zero()),c.TransformToRef(z,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),w,S)}(this,f,z,w)}},12233:(f,z,w)=>{"use strict";w(616).e.prototype.createDepthStencilTexture=function(f,z,w){if(z.isCube){const w=f.width||f;return this._createDepthStencilCubeTexture(w,z)}return this._createDepthStencilTexture(f,z,w)}},12218:(f,z,w)=>{"use strict";w(12186).ThinEngine.prototype.setAlphaMode=function(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==f){switch(f){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}z||(this.depthCullingState.depthMask=0===f),this._alphaMode=f}else if(!z){const z=0===f;this.depthCullingState.depthMask!==z&&(this.depthCullingState.depthMask=z)}}},12177:(f,z,w)=>{"use strict";var S=w(12186);S.ThinEngine.prototype.updateDynamicIndexBuffer=function(f,z){let w;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(f),w=f.is32Bits?z instanceof Uint32Array?z:new Uint32Array(z):z instanceof Uint16Array?z:new Uint16Array(z),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,w,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},S.ThinEngine.prototype.updateDynamicVertexBuffer=function(f,z,w,S){this.bindArrayBuffer(f),void 0===w&&(w=0);const C=z.byteLength||z.length;void 0===S||S>=C&&0===w?z instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,w,new Float32Array(z)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,w,z):z instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(z).subarray(w,w+S)):(z=z instanceof ArrayBuffer?new Uint8Array(z,w,S):new Uint8Array(z.buffer,z.byteOffset+w,S),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,z)),this._resetVertexBufferBinding()}},12225:(f,z,w)=>{"use strict";var S=w(650),C=w(548),E=w(12186),F=w(12227);class J extends F.e{constructor(f,z,w,S,C){super(f,z,w,S),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=C}_cloneRenderTargetWrapper(){let f=null;return this._colorTextureArray&&this._depthStencilTextureArray?(f=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),f.texture.isReady=!0):f=super._cloneRenderTargetWrapper(),f}_swapRenderTargetWrapper(f){super._swapRenderTargetWrapper(f),f._framebuffer=this._framebuffer,f._depthStencilBuffer=this._depthStencilBuffer,f._MSAAFramebuffer=this._MSAAFramebuffer,f._colorTextureArray=this._colorTextureArray,f._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,E=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const f=this._engine,z=f._currentFramebuffer,w=this._context;f._bindUnboundFramebuffer(this._framebuffer),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,w.RENDERBUFFER,null),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,null),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.STENCIL_ATTACHMENT,w.RENDERBUFFER,null),f._bindUnboundFramebuffer(z),w.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(f,z,w,S,C,E)}shareDepth(f){super.shareDepth(f);const z=this._context,w=this._depthStencilBuffer,S=f._MSAAFramebuffer||f._framebuffer,C=this._engine;f._depthStencilBuffer&&f._depthStencilBuffer!==w&&z.deleteRenderbuffer(f._depthStencilBuffer),f._depthStencilBuffer=w;const E=f._generateStencilBuffer?z.DEPTH_STENCIL_ATTACHMENT:z.DEPTH_ATTACHMENT;C._bindUnboundFramebuffer(S),z.framebufferRenderbuffer(z.FRAMEBUFFER,E,z.RENDERBUFFER,w),C._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!f._hardwareTexture)return;const C=this._framebuffer,E=this._engine,F=E._currentFramebuffer;if(E._bindUnboundFramebuffer(C),E.webGLVersion>1){const C=this._context,E=C["COLOR_ATTACHMENT"+z];var J;if(f.is2DArray||f.is3D)w=w??(null===(J=this.layerIndices)||void 0===J?void 0:J[z])??0,C.framebufferTextureLayer(C.FRAMEBUFFER,E,f._hardwareTexture.underlyingResource,S,w);else if(f.isCube){var x;w=w??(null===(x=this.faceIndices)||void 0===x?void 0:x[z])??0,C.framebufferTexture2D(C.FRAMEBUFFER,E,C.TEXTURE_CUBE_MAP_POSITIVE_X+w,f._hardwareTexture.underlyingResource,S)}else C.framebufferTexture2D(C.FRAMEBUFFER,E,C.TEXTURE_2D,f._hardwareTexture.underlyingResource,S)}else{const C=this._context,E=C["COLOR_ATTACHMENT"+z+"_WEBGL"],F=void 0!==w?C.TEXTURE_CUBE_MAP_POSITIVE_X+w:C.TEXTURE_2D;C.framebufferTexture2D(C.FRAMEBUFFER,E,F,f._hardwareTexture.underlyingResource,S)}E._bindUnboundFramebuffer(F)}setTexture(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(f,z,w),this._bindTextureRenderTarget(f,z)}setLayerAndFaceIndices(f,z){var w;if(super.setLayerAndFaceIndices(f,z),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=(null===(w=this._attachments)||void 0===w?void 0:w.length)??this.textures.length;for(let C=0;C<S;C++){const f=this.textures[C];f&&(f.is2DArray||f.is3D?this._bindTextureRenderTarget(f,C,this.layerIndices[C]):f.isCube?this._bindTextureRenderTarget(f,C,this.faceIndices[C]):this._bindTextureRenderTarget(f,C))}}setLayerAndFaceIndex(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(f,z,w),!this.textures||!this.layerIndices||!this.faceIndices)return;const S=this.textures[f];S.is2DArray||S.is3D?this._bindTextureRenderTarget(this.textures[f],f,this.layerIndices[f]):S.isCube&&this._bindTextureRenderTarget(this.textures[f],f,this.faceIndices[f])}dispose(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const z=this._context;f||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(z.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(z.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(z.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(f)}}w(12233);E.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(f,z,w){const S=new J(f,z,w,this,this._gl);return this._renderTargetWrapperCache.push(S),S},E.ThinEngine.prototype.createRenderTargetTexture=function(f,z){const w=this._createHardwareRenderTargetWrapper(!1,!1,f);let S,C,E=!0,F=!1,J=!1,x=1;void 0!==z&&"object"===typeof z&&(E=z.generateDepthBuffer??!0,F=!!z.generateStencilBuffer,J=!!z.noColorAttachment,S=z.colorAttachment,x=z.samples??1,C=z.label);const u=S||(J?null:this._createInternalTexture(f,z,!0,5)),h=f.width||f,X=f.height||f,K=this._currentFramebuffer,c=this._gl,y=c.createFramebuffer();if(this._bindUnboundFramebuffer(y),w._depthStencilBuffer=this._setupFramebufferDepthAttachments(F,E,h,X),!u||u.is2DArray||u.is3D||c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,u._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(K),w.label=C??"RenderTargetWrapper",w._framebuffer=y,w._generateDepthBuffer=E,w._generateStencilBuffer=F,w.setTextures(u),S){if(w._samples=S.samples,S.samples>1){const f=S._hardwareTexture.getMSAARenderBuffer(0);w._MSAAFramebuffer=c.createFramebuffer(),this._bindUnboundFramebuffer(w._MSAAFramebuffer),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.RENDERBUFFER,f),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(w,x);return w},E.ThinEngine.prototype._createDepthStencilTexture=function(f,z,w){const E=this._gl,F=f.layers||0,J=f.depth||0;let x=E.TEXTURE_2D;0!==F?x=E.TEXTURE_2D_ARRAY:0!==J&&(x=E.TEXTURE_3D);const u=new S.e(this,12);if(u.label=z.label,!this._caps.depthTextureExtension)return C.b.Error("Depth texture is not supported by your browser or hardware."),u;const h={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...z};if(this._bindTextureDirectly(x,u,!0),this._setupDepthStencilTexture(u,f,0!==h.comparisonFunction&&h.bilinearFiltering,h.comparisonFunction,h.samples),void 0!==h.depthTextureFormat){if(15!==h.depthTextureFormat&&16!==h.depthTextureFormat&&17!==h.depthTextureFormat&&13!==h.depthTextureFormat&&14!==h.depthTextureFormat&&18!==h.depthTextureFormat)return C.b.Error(`Depth texture ${h.depthTextureFormat} format is not supported.`),u;u.format=h.depthTextureFormat}else u.format=h.generateStencil?13:16;const X=17===u.format||13===u.format||18===u.format;let K=E.UNSIGNED_INT;15===u.format?K=E.UNSIGNED_SHORT:17===u.format||13===u.format?K=E.UNSIGNED_INT_24_8:14===u.format?K=E.FLOAT:18===u.format&&(K=E.FLOAT_32_UNSIGNED_INT_24_8_REV);const c=X?E.DEPTH_STENCIL:E.DEPTH_COMPONENT,y=this._getInternalFormatFromDepthTextureFormat(u.format,!0,X);return u.is2DArray?E.texImage3D(x,0,y,u.width,u.height,F,0,c,K,null):u.is3D?E.texImage3D(x,0,y,u.width,u.height,J,0,c,K,null):E.texImage2D(x,0,y,u.width,u.height,0,c,K,null),this._bindTextureDirectly(x,null),this._internalTexturesCache.push(u),w._depthStencilBuffer&&(E.deleteRenderbuffer(w._depthStencilBuffer),w._depthStencilBuffer=null),this._bindUnboundFramebuffer(w._MSAAFramebuffer??w._framebuffer),w._generateStencilBuffer=X,w._depthStencilTextureWithStencil=X,w._depthStencilBuffer=this._setupFramebufferDepthAttachments(w._generateStencilBuffer,w._generateDepthBuffer,w.width,w.height,w.samples,u.format),this._bindUnboundFramebuffer(null),u},E.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(f,z){var w;if(this.webGLVersion<2||!f)return 1;if(f.samples===z)return z;const S=this._gl;z=Math.min(z,this.getCaps().maxMSAASamples),f._depthStencilBuffer&&(S.deleteRenderbuffer(f._depthStencilBuffer),f._depthStencilBuffer=null),f._MSAAFramebuffer&&(S.deleteFramebuffer(f._MSAAFramebuffer),f._MSAAFramebuffer=null);const C=null===(w=f.texture)||void 0===w?void 0:w._hardwareTexture;if(null===C||void 0===C||C.releaseMSAARenderBuffers(),f.texture&&z>1&&"function"===typeof S.renderbufferStorageMultisample){const w=S.createFramebuffer();if(!w)throw new Error("Unable to create multi sampled framebuffer");f._MSAAFramebuffer=w,this._bindUnboundFramebuffer(f._MSAAFramebuffer);const E=this._createRenderBuffer(f.texture.width,f.texture.height,z,-1,this._getRGBABufferInternalSizedFormat(f.texture.type,f.texture.format,f.texture._useSRGBBuffer),S.COLOR_ATTACHMENT0,!1);if(!E)throw new Error("Unable to create multi sampled framebuffer");null===C||void 0===C||C.addMSAARenderBuffer(E)}this._bindUnboundFramebuffer(f._MSAAFramebuffer??f._framebuffer),f.texture&&(f.texture.samples=z),f._samples=z;const E=f._depthStencilTexture?f._depthStencilTexture.format:void 0;return f._depthStencilBuffer=this._setupFramebufferDepthAttachments(f._generateStencilBuffer,f._generateDepthBuffer,f.width,f.height,z,E),this._bindUnboundFramebuffer(null),z},E.ThinEngine.prototype._setupDepthStencilTexture=function(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const E=z.width??z,F=z.height??z,J=z.layers||0,x=z.depth||0;f.baseWidth=E,f.baseHeight=F,f.width=E,f.height=F,f.is2DArray=J>0,f.depth=J||x,f.isReady=!0,f.samples=C,f.generateMipMaps=!1,f.samplingMode=w?2:1,f.type=0,f._comparisonFunction=S;const u=this._gl,h=this._getTextureTarget(f),X=this._getSamplingParameters(f.samplingMode,!1);u.texParameteri(h,u.TEXTURE_MAG_FILTER,X.mag),u.texParameteri(h,u.TEXTURE_MIN_FILTER,X.min),u.texParameteri(h,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(h,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===S?(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,515),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(h,u.TEXTURE_COMPARE_FUNC,S),u.texParameteri(h,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE)))}},12223:(f,z,w)=>{"use strict";w.d(z,{c:()=>A});var S=w(650),C=w(580),E=w(12186),F=w(560);class J{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new x(f)}sampleFrame(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const z=f-this._lastFrameTimeMs;this._rollingFrameTime.add(z)}this._lastFrameTimeMs=f}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const f=this._rollingFrameTime.history(0);return 0===f?0:1e3/f}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class x{constructor(f){this._samples=new Array(f),this.reset()}add(f){let z;if(this.isSaturated()){const f=this._samples[this._pos];z=f-this.average,this.average-=z/(this._sampleCount-1),this._m2-=z*(f-this.average)}else this._sampleCount++;z=f-this.average,this.average+=z/this._sampleCount,this._m2+=z*(f-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=f,this._pos++,this._pos%=this._samples.length}history(f){if(f>=this._sampleCount||f>=this._samples.length)return 0;const z=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(z-f)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(f){const z=this._samples.length;return(f%z+z)%z}}var u=w(12198),h=w(548),X=w(12202),K=(w(12218),w(670));function c(f,z,w,S){let C,E=1;1===S?C=new Float32Array(z*w*4):2===S?(C=new Uint16Array(z*w*4),E=15360):C=7===S?new Uint32Array(z*w*4):new Uint8Array(z*w*4);for(let F=0;F<z;F++)for(let S=0;S<w;S++){const w=3*(S*z+F),J=4*(S*z+F);C[J+0]=f[w+0],C[J+1]=f[w+1],C[J+2]=f[w+2],C[J+3]=E}return C}function y(f){return function(z,w,C,E,F,J,x,u){let h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const K=f?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,c=f?10:11,y=new S.e(this,c);y.baseWidth=w,y.baseHeight=C,y.baseDepth=E,y.width=w,y.height=C,y.depth=E,y.format=F,y.type=X,y.generateMipMaps=J,y.samplingMode=u,f?y.is3D=!0:y.is2DArray=!0,this._doNotHandleContextLost||(y._bufferView=z),f?this.updateRawTexture3D(y,z,F,x,h,X):this.updateRawTexture2DArray(y,z,F,x,h,X),this._bindTextureDirectly(K,y,!0);const e=this._getSamplingParameters(u,J);return this._gl.texParameteri(K,this._gl.TEXTURE_MAG_FILTER,e.mag),this._gl.texParameteri(K,this._gl.TEXTURE_MIN_FILTER,e.min),J&&this._gl.generateMipmap(K),this._bindTextureDirectly(K,null),this._internalTexturesCache.push(y),y}}function e(f){return function(z,w,S,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const J=f?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,x=this._getWebGLTextureType(F),u=this._getInternalFormat(S),h=this._getRGBABufferInternalSizedFormat(F,S);this._bindTextureDirectly(J,z,!0),this._unpackFlipY(void 0===C||!!C),this._doNotHandleContextLost||(z._bufferView=w,z.format=S,z.invertY=C,z._compression=E),z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),E&&w?this._gl.compressedTexImage3D(J,0,this.getCaps().s3tc[E],z.width,z.height,z.depth,0,w):this._gl.texImage3D(J,0,h,z.width,z.height,z.depth,0,u,x,w),z.generateMipMaps&&this._gl.generateMipmap(J),this._bindTextureDirectly(J,null),z.isReady=!0}}E.ThinEngine.prototype.updateRawTexture=function(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!f)return;const J=this._getRGBABufferInternalSizedFormat(E,w,F),x=this._getInternalFormat(w),u=this._getWebGLTextureType(E);this._bindTextureDirectly(this._gl.TEXTURE_2D,f,!0),this._unpackFlipY(void 0===S||!!S),this._doNotHandleContextLost||(f._bufferView=z,f.format=w,f.type=E,f.invertY=S,f._compression=C),f.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),C&&z?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[C],f.width,f.height,0,z):this._gl.texImage2D(this._gl.TEXTURE_2D,0,J,f.width,f.height,0,x,u,z),f.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),f.isReady=!0},E.ThinEngine.prototype.createRawTexture=function(f,z,w,C,E,F,J){let x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const X=new S.e(this,3);X.baseWidth=z,X.baseHeight=w,X.width=z,X.height=w,X.format=C,X.generateMipMaps=E,X.samplingMode=J,X.invertY=F,X._compression=x,X.type=u,X._useSRGBBuffer=this._getUseSRGBBuffer(h,!E),this._doNotHandleContextLost||(X._bufferView=f),this.updateRawTexture(X,f,C,F,x,u,X._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,X,!0);const K=this._getSamplingParameters(J,E);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,K.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,K.min),E&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(X),X},E.ThinEngine.prototype.createRawCubeTexture=function(f,z,w,C,E,F,J){let x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const u=this._gl,X=new S.e(this,8);X.isCube=!0,X.format=w,X.type=C,this._doNotHandleContextLost||(X._bufferViewArray=f);const c=this._getWebGLTextureType(C);let y=this._getInternalFormat(w);y===u.RGB&&(y=u.RGBA),c!==u.FLOAT||this._caps.textureFloatLinearFiltering?c!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?c!==u.FLOAT||this._caps.textureFloatRender?c!==u.HALF_FLOAT||this._caps.colorBufferFloat||(E=!1,h.b.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(E=!1,h.b.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(E=!1,J=1,h.b.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(E=!1,J=1,h.b.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const e=z,O=e;X.width=e,X.height=O,X.invertY=F,X._compression=x;if(!this.needPOTTextures||(0,K.j)(X.width)&&(0,K.j)(X.height)||(E=!1),f)this.updateRawCubeTexture(X,f,w,C,F,x);else{const f=this._getRGBABufferInternalSizedFormat(C),z=0;this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,X,!0);for(let w=0;w<6;w++)x?u.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+w,z,this.getCaps().s3tc[x],X.width,X.height,0,void 0):u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+w,z,f,X.width,X.height,0,y,c,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,X,!0),f&&E&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const d=this._getSamplingParameters(J,E);return u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,d.mag),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,d.min),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,null),X.generateMipMaps=E,X.samplingMode=J,X.isReady=!0,X},E.ThinEngine.prototype.updateRawCubeTexture=function(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;f._bufferViewArray=z,f.format=w,f.type=S,f.invertY=C,f._compression=E;const J=this._gl,x=this._getWebGLTextureType(S);let u=this._getInternalFormat(w);const h=this._getRGBABufferInternalSizedFormat(S);let X=!1;u===J.RGB&&(u=J.RGBA,X=!0),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,f,!0),this._unpackFlipY(void 0===C||!!C),f.width%4!==0&&J.pixelStorei(J.UNPACK_ALIGNMENT,1);for(let K=0;K<6;K++){let w=z[K];E?J.compressedTexImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+K,F,this.getCaps().s3tc[E],f.width,f.height,0,w):(X&&(w=c(w,f.width,f.height,S)),J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+K,F,h,f.width,f.height,0,u,x,w))}(!this.needPOTTextures||(0,K.j)(f.width)&&(0,K.j)(f.height))&&f.generateMipMaps&&0===F&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),f.isReady=!0},E.ThinEngine.prototype.createRawCubeTextureFromUrl=function(f,z,w,S,C,E,F,J){let x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,X=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const K=this._gl,y=this.createRawCubeTexture(null,w,S,C,!E,X,h,null);null===z||void 0===z||z.addPendingData(y),y.url=f,y.isReady=!1,this._internalTexturesCache.push(y);const e=f=>{const w=y.width,E=F(f);if(E){if(J){const f=this._getWebGLTextureType(C);let z=this._getInternalFormat(S);const F=this._getRGBABufferInternalSizedFormat(C);let x=!1;z===K.RGB&&(z=K.RGBA,x=!0),this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,y,!0),this._unpackFlipY(!1);const u=J(E);for(let S=0;S<u.length;S++){const E=w>>S;for(let w=0;w<6;w++){let J=u[S][w];x&&(J=c(J,E,E,C)),K.texImage2D(w,S,F,E,E,0,z,f,J)}}this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(y,E,S,C,X);y.isReady=!0,null===z||void 0===z||z.removePendingData(y),y.onLoadedObservable.notifyObservers(y),y.onLoadedObservable.clear(),x&&x()}};return this._loadFile(f,(f=>{e(f)}),void 0,null===z||void 0===z?void 0:z.offlineProvider,!0,((f,w)=>{null===z||void 0===z||z.removePendingData(y),u&&f&&u(f.status+" "+f.statusText,w)})),y},E.ThinEngine.prototype.createRawTexture2DArray=y(!1),E.ThinEngine.prototype.createRawTexture3D=y(!0),E.ThinEngine.prototype.updateRawTexture2DArray=e(!1),E.ThinEngine.prototype.updateRawTexture3D=e(!0);var O=w(604);E.ThinEngine.prototype._readTexturePixelsSync=function(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const h=this._gl;if(!h)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const f=h.createFramebuffer();if(!f)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=f}var X,K;(h.bindFramebuffer(h.FRAMEBUFFER,this._dummyFramebuffer),S>-1)?h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+S,null===(X=f._hardwareTexture)||void 0===X?void 0:X.underlyingResource,C):h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,null===(K=f._hardwareTexture)||void 0===K?void 0:K.underlyingResource,C);let c=void 0!==f.type?this._getWebGLTextureType(f.type):h.UNSIGNED_BYTE;if(J)E||(E=(0,O.n)(f.type,4*z*w));else if(c===h.UNSIGNED_BYTE)E||(E=new Uint8Array(4*z*w)),c=h.UNSIGNED_BYTE;else E||(E=new Float32Array(4*z*w)),c=h.FLOAT;return F&&this.flushFramebuffer(),h.readPixels(x,u,z,w,h.RGBA,c,E),h.bindFramebuffer(h.FRAMEBUFFER,this._currentFramebuffer),E},E.ThinEngine.prototype._readTexturePixels=function(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(f,z,w,S,C,E,F,J,x,u))};w(12177);E.ThinEngine.prototype._createDepthStencilCubeTexture=function(f,z){const w=new S.e(this,12);if(w.isCube=!0,1===this.webGLVersion)return h.b.Error("Depth cube texture is not supported by WebGL 1."),w;const C={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...z},E=this._gl;this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,w,!0),this._setupDepthStencilTexture(w,f,C.bilinearFiltering,C.comparisonFunction);for(let S=0;S<6;S++)C.generateStencil?E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,E.DEPTH24_STENCIL8,f,f,0,E.DEPTH_STENCIL,E.UNSIGNED_INT_24_8,null):E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,E.DEPTH_COMPONENT24,f,f,0,E.DEPTH_COMPONENT,E.UNSIGNED_INT,null);return this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(w),w},E.ThinEngine.prototype._setCubeMapTextureParams=function(f,z,w){const S=this._gl;S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,z?S.LINEAR_MIPMAP_LINEAR:S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),f.samplingMode=z?3:2,z&&this.getCaps().textureMaxLevel&&void 0!==w&&w>0&&(S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAX_LEVEL,w),f._maxLodLevel=w),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null)},E.ThinEngine.prototype.createCubeTexture=function(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>13&&void 0!==arguments[13]&&arguments[13],e=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const O=this._gl;return this.createCubeTextureBase(f,z,w,!!S,C,E,F,J,x,u,X,c,(f=>this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,f,!0)),((f,z)=>{const w=this.needPOTTextures?(0,K.f)(z[0].width,this._caps.maxCubemapTextureSize):z[0].width,E=w,J=[O.TEXTURE_CUBE_MAP_POSITIVE_X,O.TEXTURE_CUBE_MAP_POSITIVE_Y,O.TEXTURE_CUBE_MAP_POSITIVE_Z,O.TEXTURE_CUBE_MAP_NEGATIVE_X,O.TEXTURE_CUBE_MAP_NEGATIVE_Y,O.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,f,!0),this._unpackFlipY(!1);const x=F?this._getInternalFormat(F,f._useSRGBBuffer):f._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:O.RGBA;let u=F?this._getInternalFormat(F):O.RGBA;f._useSRGBBuffer&&1===this.webGLVersion&&(u=x);for(let S=0;S<J.length;S++)if(z[S].width!==w||z[S].height!==E){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void h.b.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=w,this._workingCanvas.height=E,this._workingContext.drawImage(z[S],0,0,z[S].width,z[S].height,0,0,w,E),O.texImage2D(J[S],0,x,u,O.UNSIGNED_BYTE,this._workingCanvas)}else O.texImage2D(J[S],0,x,u,O.UNSIGNED_BYTE,z[S]);S||O.generateMipmap(O.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(f,!S),f.width=w,f.height=E,f.isReady=!0,F&&(f.format=F),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear(),C&&C()}),!!y,e)},E.ThinEngine.prototype.generateMipMapsForCubemap=function(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f.generateMipMaps){const w=this._gl;this._bindTextureDirectly(w.TEXTURE_CUBE_MAP,f,!0),w.generateMipmap(w.TEXTURE_CUBE_MAP),z&&this._bindTextureDirectly(w.TEXTURE_CUBE_MAP,null)}};w(12225);E.ThinEngine.prototype.setDepthStencilTexture=function(f,z,w,S){void 0!==f&&(z&&(this._boundUniforms[f]=z),w&&w.depthStencilTexture?this._setTexture(f,w,!1,!0,S):this._setTexture(f,null,void 0,void 0,S))},E.ThinEngine.prototype.createRenderTargetCubeTexture=function(f,z){const w=this._createHardwareRenderTargetWrapper(!1,!0,f),C={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...z};C.generateStencilBuffer=C.generateDepthBuffer&&C.generateStencilBuffer,(1!==C.type||this._caps.textureFloatLinearFiltering)&&(2!==C.type||this._caps.textureHalfFloatLinearFiltering)||(C.samplingMode=1);const E=this._gl,F=new S.e(this,5);this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,F,!0);const J=this._getSamplingParameters(C.samplingMode,C.generateMipMaps);1!==C.type||this._caps.textureFloat||(C.type=0,h.b.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,J.mag),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,J.min),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE);for(let S=0;S<6;S++)E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,this._getRGBABufferInternalSizedFormat(C.type,C.format),f,f,0,this._getInternalFormat(C.format),this._getWebGLTextureType(C.type),null);const x=E.createFramebuffer();return this._bindUnboundFramebuffer(x),w._depthStencilBuffer=this._setupFramebufferDepthAttachments(C.generateStencilBuffer,C.generateDepthBuffer,f,f),C.generateMipMaps&&E.generateMipmap(E.TEXTURE_CUBE_MAP),this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),w._framebuffer=x,w._generateDepthBuffer=C.generateDepthBuffer,w._generateStencilBuffer=C.generateStencilBuffer,F.width=f,F.height=f,F.isReady=!0,F.isCube=!0,F.samples=1,F.generateMipMaps=C.generateMipMaps,F.samplingMode=C.samplingMode,F.type=C.type,F.format=C.format,this._internalTexturesCache.push(F),w.setTextures(F),w};var d=w(2292),B=w(2323),V=w(2310);E.ThinEngine.prototype.createPrefilteredCubeTexture=function(f,z,w,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(f,z,null,!1,(f=>{if(!f)return void(E&&E(null));const F=f.texture;if(u?f.info.sphericalPolynomial&&(F._sphericalPolynomial=f.info.sphericalPolynomial):F._sphericalPolynomial=new d.e,F._source=9,this.getCaps().textureLOD)return void(E&&E(F));const J=this._gl,x=f.width;if(!x)return;const X=[];for(let E=0;E<3;E++){const u=1-E/2,K=C,c=Math.log2(x)*w+C,y=K+(c-K)*u,e=Math.round(Math.min(Math.max(y,0),c)),O=new S.e(this,2);if(O.type=F.type,O.format=F.format,O.width=Math.pow(2,Math.max(Math.log2(x)-e,0)),O.height=O.width,O.isCube=!0,O._cachedWrapU=0,O._cachedWrapV=0,this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,O,!0),O.samplingMode=2,J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),f.isDDS){const z=f.info,w=f.data;this._unpackFlipY(z.isCompressed),V.e.UploadDDSLevels(this,O,w,z,!0,6,e)}else h.b.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null);const d=new B.b(z);d._isCube=!0,d._texture=O,O.isReady=!0,X.push(d)}F._lodTextureHigh=X[2],F._lodTextureMid=X[1],F._lodTextureLow=X[0],E&&E(F)}),F,J,x,u,w,C)},E.ThinEngine.prototype.createUniformBuffer=function(f,z){const w=this._gl.createBuffer();if(!w)throw new Error("Unable to create uniform buffer");const S=new u.e(w);return this.bindUniformBuffer(S),f instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,f,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(f),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},E.ThinEngine.prototype.createDynamicUniformBuffer=function(f,z){const w=this._gl.createBuffer();if(!w)throw new Error("Unable to create dynamic uniform buffer");const S=new u.e(w);return this.bindUniformBuffer(S),f instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,f,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(f),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),S.references=1,S},E.ThinEngine.prototype.updateUniformBuffer=function(f,z,w,S){this.bindUniformBuffer(f),void 0===w&&(w=0),void 0===S?z instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,w,z):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,w,new Float32Array(z)):z instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,z.subarray(w,w+S)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(z).subarray(w,w+S)),this.bindUniformBuffer(null)},E.ThinEngine.prototype.bindUniformBuffer=function(f){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,f?f.underlyingResource:null)},E.ThinEngine.prototype.bindUniformBufferBase=function(f,z,w){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,z,f?f.underlyingResource:null)},E.ThinEngine.prototype.bindUniformBlock=function(f,z,w){const S=f.program,C=this._gl.getUniformBlockIndex(S,z);4294967295!==C&&this._gl.uniformBlockBinding(S,C,w)};var W=w(540),T=w(616);T.e.prototype.displayLoadingUI=function(){if(!(0,W.o)())return;const f=this.loadingScreen;f&&f.displayLoadingUI()},T.e.prototype.hideLoadingUI=function(){if(!(0,W.o)())return;const f=this._loadingScreen;f&&f.hideLoadingUI()},Object.defineProperty(T.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=T.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(f){this._loadingScreen=f},enumerable:!0,configurable:!0}),Object.defineProperty(T.e.prototype,"loadingUIText",{set:function(f){this.loadingScreen.loadingUIText=f},enumerable:!0,configurable:!0}),Object.defineProperty(T.e.prototype,"loadingUIBackgroundColor",{set:function(f){this.loadingScreen.loadingUIBackgroundColor=f},enumerable:!0,configurable:!0}),T.e.prototype.getInputElement=function(){return this._renderingCanvas},T.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},T.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},T.e.prototype.getAspectRatio=function(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const w=f.viewport;return this.getRenderWidth(z)*w.width/(this.getRenderHeight(z)*w.height)},T.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},T.e.prototype._verifyPointerLock=function(){var f;null===(f=this._onPointerLockChange)||void 0===f||f.call(this)},T.e.prototype.setAlphaEquation=function(f){if(this._alphaEquation!==f){switch(f){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=f}},T.e.prototype.getInputElement=function(){return this._renderingCanvas},T.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},T.e.prototype.setDepthFunction=function(f){this._depthCullingState.depthFunc=f},T.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},T.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},T.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},T.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},T.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},T.e.prototype.setDepthWrite=function(f){this._depthCullingState.depthMask=f},T.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},T.e.prototype.setStencilBuffer=function(f){this._stencilState.stencilTest=f},T.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},T.e.prototype.setStencilMask=function(f){this._stencilState.stencilMask=f},T.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},T.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},T.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},T.e.prototype.setStencilFunction=function(f){this._stencilState.stencilFunc=f},T.e.prototype.setStencilFunctionReference=function(f){this._stencilState.stencilFuncRef=f},T.e.prototype.setStencilFunctionMask=function(f){this._stencilState.stencilFuncMask=f},T.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},T.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},T.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},T.e.prototype.setStencilOperationFail=function(f){this._stencilState.stencilOpStencilFail=f},T.e.prototype.setStencilOperationDepthFail=function(f){this._stencilState.stencilOpDepthFail=f},T.e.prototype.setStencilOperationPass=function(f){this._stencilState.stencilOpStencilDepthPass=f},T.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},T.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},T.e.prototype.setAlphaConstants=function(f,z,w,S){this._alphaState.setAlphaBlendConstants(f,z,w,S)},T.e.prototype.getAlphaMode=function(){return this._alphaMode},T.e.prototype.getAlphaEquation=function(){return this._alphaEquation},T.e.prototype.getRenderPassNames=function(){return this._renderPassNames},T.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},T.e.prototype.createRenderPassId=function(f){const z=++T.e._RenderPassIdCounter;return this._renderPassNames[z]=f??"NONAME",z},T.e.prototype.releaseRenderPassId=function(f){this._renderPassNames[f]=void 0;for(let z=0;z<this.scenes.length;++z){const w=this.scenes[z];for(let z=0;z<w.meshes.length;++z){const S=w.meshes[z];if(S.pk)for(let z=0;z<S.pk.length;++z){S.pk[z]._removeDrawWrapper(f)}}}};w(12233);function v(f){if(f.requestPointerLock){const z=f.requestPointerLock();z instanceof Promise?z.then((()=>{f.focus()})).catch((()=>{})):f.focus()}}var D=w(2437);w(12238);class A extends E.ThinEngine{static get NpmPackage(){return T.e.NpmPackage}static get Version(){return T.e.Version}static get Instances(){return C.c.Instances}static get LastCreatedEngine(){return C.c.LastCreatedEngine}static get LastCreatedScene(){return C.c.LastCreatedScene}static DefaultLoadingScreenFactory(f){return T.e.DefaultLoadingScreenFactory(f)}get _supportsHardwareTextureRescaling(){return!!A._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(f,z,w){if(super(f,z,w,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new J,this._drawCalls=new D.c,f&&(this._features.supportRenderPasses=!0,w=this._creationOptions,f.getContext)){const z=f;this._sharedInit(z)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(f){super._sharedInit(f),function(f,z,w){f._onCanvasFocus=()=>{f.onCanvasFocusObservable.notifyObservers(f)},f._onCanvasBlur=()=>{f.onCanvasBlurObservable.notifyObservers(f)},f._onCanvasContextMenu=z=>{f.disableContextMenu&&z.preventDefault()},z.addEventListener("focus",f._onCanvasFocus),z.addEventListener("blur",f._onCanvasBlur),z.addEventListener("contextmenu",f._onCanvasContextMenu),f._onBlur=()=>{f.disablePerformanceMonitorInBackground&&f.performanceMonitor.disable(),f._windowIsBackground=!0},f._onFocus=()=>{f.disablePerformanceMonitorInBackground&&f.performanceMonitor.enable(),f._windowIsBackground=!1},f._onCanvasPointerOut=w=>{document.elementFromPoint(w.clientX,w.clientY)!==z&&f.onCanvasPointerOutObservable.notifyObservers(w)};const S=f.getHostWindow();S&&"function"===typeof S.addEventListener&&(S.addEventListener("blur",f._onBlur),S.addEventListener("focus",f._onFocus)),z.addEventListener("pointerout",f._onCanvasPointerOut),w.doNotHandleTouchAction||function(f){f&&f.setAttribute&&(f.setAttribute("touch-action","none"),f.style.touchAction="none",f.style.webkitTapHighlightColor="transparent")}(z),!T.e.audioEngine&&w.audioEngine&&T.e.AudioEngineFactory&&(T.e.audioEngine=T.e.AudioEngineFactory(f.getRenderingCanvas(),f.getAudioContext(),f.getAudioDestination())),(0,W.h)()&&(f._onFullscreenChange=()=>{f.isFullscreen=!!document.fullscreenElement,f.isFullscreen&&f._pointerLockRequested&&z&&v(z)},document.addEventListener("fullscreenchange",f._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",f._onFullscreenChange,!1),f._onPointerLockChange=()=>{f.isPointerLock=document.pointerLockElement===z},document.addEventListener("pointerlockchange",f._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",f._onPointerLockChange,!1)),f.enableOfflineSupport=void 0!==T.e.OfflineProviderFactory,f._deterministicLockstep=!!w.deterministicLockstep,f._lockstepMaxSteps=w.lockstepMaxSteps||0,f._timeStep=w.timeStep||1/60}(this,f,this._creationOptions)}resizeImageBitmap(f,z,w){return function(f,z,w,S){const C=f.createCanvas(w,S).getContext("2d");if(!C)throw new Error("Unable to get 2d context for resizeImageBitmap");return C.drawImage(z,0,0),C.getImageData(0,0,w,S).data}(this,f,z,w)}_createImageBitmapFromSource(f,z){return function(f,z,w){return new Promise(((S,C)=>{const E=new Image;E.onload=()=>{E.decode().then((()=>{f.createImageBitmap(E,w).then((f=>{S(f)}))}))},E.onerror=()=>{C(`Error loading image ${E.src}`)},E.src=z}))}(this,f,z)}switchFullscreen(f){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(f)}enterFullscreen(f){this.isFullscreen||(this._pointerLockRequested=f,this._renderingCanvas&&function(f){const z=f.requestFullscreen||f.webkitRequestFullscreen;z&&z.call(f)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const f=document;document.exitFullscreen?document.exitFullscreen():f.webkitCancelFullScreen&&f.webkitCancelFullScreen()}()}setDitheringState(f){f?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(f){f?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(f,z,w,S){const C=this._cachedViewport;return this._cachedViewport=null,this._viewport(f,z,w,S),C}scissorClear(f,z,w,S,C){this.enableScissor(f,z,w,S),this.clear(C,!0,!0,!0),this.disableScissor()}enableScissor(f,z,w,S){const C=this._gl;C.enable(C.SCISSOR_TEST),C.scissor(f,z,w,S)}disableScissor(){const f=this._gl;f.disable(f.SCISSOR_TEST)}_loadFileAsync(f,z,w){return new Promise(((S,C)=>{this._loadFile(f,(f=>{S(f)}),void 0,z,w,((f,z)=>{C(z)}))}))}getVertexShaderSource(f){const z=this._gl.getAttachedShaders(f);return z?this._gl.getShaderSource(z[0]):null}getFragmentShaderSource(f){const z=this._gl.getAttachedShaders(f);return z?this._gl.getShaderSource(z[1]):null}set framebufferDimensionsObject(f){this._framebufferDimensionsObject=f,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const f of this.scenes)f.resetCachedMaterial(),f._rebuildGeometries();for(const f of this._virtualScenes)f.resetCachedMaterial(),f._rebuildGeometries();super._rebuildBuffers()}getFontOffset(f){return function(f){const z=document.createElement("span");z.textContent="Hg",z.style.font=f;const w=document.createElement("div");w.style.display="inline-block",w.style.width="1px",w.style.height="0px",w.style.verticalAlign="bottom";const S=document.createElement("div");S.style.whiteSpace="nowrap",S.appendChild(z),S.appendChild(w),document.body.appendChild(S);let C=0,E=0;try{E=w.getBoundingClientRect().top-z.getBoundingClientRect().top,w.style.verticalAlign="baseline",C=w.getBoundingClientRect().top-z.getBoundingClientRect().top}finally{document.body.removeChild(S)}return{ascent:C,height:E,descent:E-C}}(f)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:f}=this.customAnimationFrameRequester;f&&f(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let f=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(f=!1),f&&(this.gk(),this._renderViews()||this._renderFrame(),this.hk())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&v(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}gk(){this._measureFps(),super.gk()}_deletePipelineContext(f){const z=f;z&&z.program&&z.transformFeedback&&(this.deleteTransformFeedback(z.transformFeedback),z.transformFeedback=null),super._deletePipelineContext(f)}createShaderProgram(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;C=C||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const F=super.createShaderProgram(f,z,w,S,C,E);return this.onAfterShaderCompilationObservable.notifyObservers(this),F}_createShaderProgram(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const E=S.createProgram();if(f.program=E,!E)throw new Error("Unable to create program");if(S.attachShader(E,z),S.attachShader(E,w),this.webGLVersion>1&&C){const z=this.createTransformFeedback();this.bindTransformFeedback(z),this.setTranformFeedbackVaryings(E,C),f.transformFeedback=z}return S.linkProgram(E),this.webGLVersion>1&&C&&this.bindTransformFeedback(null),f.context=S,f.vertexShader=z,f.fragmentShader=w,f.isParallelCompiled||this._finalizePipelineContext(f),E}_releaseTexture(f){super._releaseTexture(f)}_releaseRenderTargetWrapper(f){super._releaseRenderTargetWrapper(f),this.scenes.forEach((z=>{z.postProcesses.forEach((z=>{z._outputTexture===f&&(z._outputTexture=null)})),z.cameras.forEach((z=>{z._postProcesses.forEach((z=>{z&&z._outputTexture===f&&(z._outputTexture=null)}))}))}))}_rescaleTexture(f,z,w,S,C){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const E=this.createRenderTargetTexture({width:z.width,height:z.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&A._RescalePostProcessFactory&&(this._rescalePostProcess=A._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const F=()=>{this._rescalePostProcess.onApply=function(z){z._bindTexture("textureSampler",f)};let F=w;F||(F=this.scenes[this.scenes.length-1]),F.postProcessManager.directRender([this._rescalePostProcess],E,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,z,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,S,0,0,z.width,z.height,0),this.unBindFramebuffer(E),E.dispose(),C&&C()},J=this._rescalePostProcess.getEffect();J?J.executeWhenCompiled(F):this._rescalePostProcess.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled(F)}))}}wrapWebGLTexture(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const F=new X.b(f,this._gl),J=new S.e(this,0,!0);return J._hardwareTexture=F,J.baseWidth=C,J.baseHeight=E,J.width=C,J.height=E,J.isReady=!0,J.useMipMaps=z,this.updateTextureSamplingMode(w,J),J}_uploadImageToTexture(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const C=this._gl,E=this._getWebGLTextureType(f.type),F=this._getInternalFormat(f.format),J=this._getRGBABufferInternalSizedFormat(f.type,F),x=f.isCube?C.TEXTURE_CUBE_MAP:C.TEXTURE_2D;this._bindTextureDirectly(x,f,!0),this._unpackFlipY(f.invertY);let u=C.TEXTURE_2D;f.isCube&&(u=C.TEXTURE_CUBE_MAP_POSITIVE_X+w),C.texImage2D(u,S,J,F,E,z),this._bindTextureDirectly(x,null,!0)}updateTextureComparisonFunction(f,z){if(1===this.webGLVersion)return void h.b.Error("WebGL 1 does not support texture comparison.");const w=this._gl;f.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,f,!0),0===z?(w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_COMPARE_FUNC,515),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_COMPARE_MODE,w.NONE)):(w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_COMPARE_FUNC,z),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,f,!0),0===z?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,515),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE)):(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,z),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),f._comparisonFunction=z}createInstancesBuffer(f){const z=this._gl.createBuffer();if(!z)throw new Error("Unable to create instance buffer");const w=new u.e(z);return w._a=f,this.bindArrayBuffer(w),this._gl.bufferData(this._gl.ARRAY_BUFFER,f,this._gl.DYNAMIC_DRAW),w.references=1,w}deleteInstancesBuffer(f){this._gl.deleteBuffer(f)}_clientWaitAsync(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const S=this._gl;return new Promise(((C,E)=>{const F=()=>{const J=S.clientWaitSync(f,z,0);J!=S.WAIT_FAILED?J!=S.TIMEOUT_EXPIRED?C():setTimeout(F,w):E()};F()}))}_readPixelsAsync(f,z,w,S,C,E,F){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const J=this._gl,x=J.createBuffer();J.bindBuffer(J.PIXEL_PACK_BUFFER,x),J.bufferData(J.PIXEL_PACK_BUFFER,F.byteLength,J.STREAM_READ),J.readPixels(f,z,w,S,C,E,0),J.bindBuffer(J.PIXEL_PACK_BUFFER,null);const u=J.fenceSync(J.SYNC_GPU_COMMANDS_COMPLETE,0);return u?(J.flush(),this._clientWaitAsync(u,0,10).then((()=>(J.deleteSync(u),J.bindBuffer(J.PIXEL_PACK_BUFFER,x),J.getBufferSubData(J.PIXEL_PACK_BUFFER,0,F),J.bindBuffer(J.PIXEL_PACK_BUFFER,null),J.deleteBuffer(x),F)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(f,z){1===C.c.Instances.length&&T.e.audioEngine&&(T.e.audioEngine.dispose(),T.e.audioEngine=null);const w=f.getHostWindow();w&&"function"===typeof w.removeEventListener&&(w.removeEventListener("blur",f._onBlur),w.removeEventListener("focus",f._onFocus)),z&&(z.removeEventListener("focus",f._onCanvasFocus),z.removeEventListener("blur",f._onCanvasBlur),z.removeEventListener("pointerout",f._onCanvasPointerOut),z.removeEventListener("contextmenu",f._onCanvasContextMenu)),(0,W.h)()&&(document.removeEventListener("fullscreenchange",f._onFullscreenChange),document.removeEventListener("mozfullscreenchange",f._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",f._onFullscreenChange),document.removeEventListener("msfullscreenchange",f._onFullscreenChange),document.removeEventListener("pointerlockchange",f._onPointerLockChange),document.removeEventListener("mspointerlockchange",f._onPointerLockChange),document.removeEventListener("mozpointerlockchange",f._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",f._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}A.ALPHA_DISABLE=0,A.ALPHA_ADD=1,A.ALPHA_COMBINE=2,A.ALPHA_SUBTRACT=3,A.ALPHA_MULTIPLY=4,A.ALPHA_MAXIMIZED=5,A.ALPHA_ONEONE=6,A.ALPHA_PREMULTIPLIED=7,A.ALPHA_PREMULTIPLIED_PORTERDUFF=8,A.ALPHA_INTERPOLATE=9,A.ALPHA_SCREENMODE=10,A.DELAYLOADSTATE_NONE=0,A.DELAYLOADSTATE_LOADED=1,A.DELAYLOADSTATE_LOADING=2,A.DELAYLOADSTATE_NOTLOADED=4,A.NEVER=512,A.ALWAYS=519,A.LESS=513,A.EQUAL=514,A.LEQUAL=515,A.GREATER=516,A.GEQUAL=518,A.NOTEQUAL=517,A.KEEP=7680,A.REPLACE=7681,A.INCR=7682,A.DECR=7683,A.INVERT=5386,A.INCR_WRAP=34055,A.DECR_WRAP=34056,A.TEXTURE_CLAMP_ADDRESSMODE=0,A.TEXTURE_WRAP_ADDRESSMODE=1,A.TEXTURE_MIRROR_ADDRESSMODE=2,A.TEXTUREFORMAT_ALPHA=0,A.TEXTUREFORMAT_LUMINANCE=1,A.TEXTUREFORMAT_LUMINANCE_ALPHA=2,A.TEXTUREFORMAT_RGB=4,A.TEXTUREFORMAT_RGBA=5,A.TEXTUREFORMAT_RED=6,A.TEXTUREFORMAT_R=6,A.TEXTUREFORMAT_RG=7,A.TEXTUREFORMAT_RED_INTEGER=8,A.TEXTUREFORMAT_R_INTEGER=8,A.TEXTUREFORMAT_RG_INTEGER=9,A.TEXTUREFORMAT_RGB_INTEGER=10,A.TEXTUREFORMAT_RGBA_INTEGER=11,A.TEXTURETYPE_UNSIGNED_BYTE=0,A.TEXTURETYPE_UNSIGNED_INT=0,A.TEXTURETYPE_FLOAT=1,A.TEXTURETYPE_HALF_FLOAT=2,A.TEXTURETYPE_BYTE=3,A.TEXTURETYPE_SHORT=4,A.TEXTURETYPE_UNSIGNED_SHORT=5,A.TEXTURETYPE_INT=6,A.TEXTURETYPE_UNSIGNED_INTEGER=7,A.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,A.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,A.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,A.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,A.TEXTURETYPE_UNSIGNED_INT_24_8=12,A.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,A.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,A.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,A.TEXTURE_NEAREST_SAMPLINGMODE=1,A.TEXTURE_BILINEAR_SAMPLINGMODE=2,A.TEXTURE_TRILINEAR_SAMPLINGMODE=3,A.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,A.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,A.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,A.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,A.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,A.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,A.TEXTURE_NEAREST_LINEAR=7,A.TEXTURE_NEAREST_NEAREST=1,A.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,A.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,A.TEXTURE_LINEAR_LINEAR=2,A.TEXTURE_LINEAR_NEAREST=12,A.TEXTURE_EXPLICIT_MODE=0,A.TEXTURE_SPHERICAL_MODE=1,A.TEXTURE_PLANAR_MODE=2,A.TEXTURE_CUBIC_MODE=3,A.TEXTURE_PROJECTION_MODE=4,A.TEXTURE_SKYBOX_MODE=5,A.TEXTURE_INVCUBIC_MODE=6,A.TEXTURE_EQUIRECTANGULAR_MODE=7,A.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,A.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,A.SCALEMODE_FLOOR=1,A.SCALEMODE_NEAREST=2,A.SCALEMODE_CEILING=3},12940:(f,z,w)=>{"use strict";w(548);var S=w(12223);w(650),w(791),w(647),w(12227),w(12195);S.c},12227:(f,z,w)=>{"use strict";w.d(z,{e:()=>S});class S{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var f;return(null===(f=this._textures)||void 0===f?void 0:f[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(f){var z,w;if(!this._textures)return-1;const S=this._textures[f],C=(null===(z=this._layerIndices)||void 0===z?void 0:z[f])??0,E=(null===(w=this._faceIndices)||void 0===w?void 0:w[f])??0;return S.isCube?6*C+E:S.is3D?0:C}get samples(){return this._samples}setSamples(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===f&&!w)return f;const S=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,f,z):this._engine.updateRenderTargetTextureSampleCount(this,f);return this._samples=f,S}constructor(f,z,w,S,C){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=f,this._isCube=z,this._size=w,this._engine=S,this._depthStencilTexture=null,this.label=C}setTextures(f){Array.isArray(f)?this._textures=f:this._textures=f?[f]:null}setTexture(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[z]!==f&&(this._textures[z]&&w&&this._textures[z].dispose(),this._textures[z]=f)}setLayerAndFaceIndices(f,z){this._layerIndices=f,this._faceIndices=z}setLayerAndFaceIndex(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==z&&z>=0&&(this._layerIndices[f]=z),void 0!==w&&w>=0&&(this._faceIndices[f]=w)}createDepthStencilTexture(){var f;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;return null===(f=this._depthStencilTexture)||void 0===f||f.dispose(),this._depthStencilTextureWithStencil=S,this._depthStencilTextureLabel=F,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:w,comparisonFunction:z,generateStencil:S,isCube:this._isCube,samples:C,depthTextureFormat:E,label:F},this),this._depthStencilTexture}_shareDepth(f){this.shareDepth(f)}shareDepth(f){this._depthStencilTexture&&(f._depthStencilTexture&&f._depthStencilTexture.dispose(),f._depthStencilTexture=this._depthStencilTexture,f._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(f){this.texture&&this.texture._swapAndDie(f),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let f=null;if(this._isMulti){const z=this.textures;if(z&&z.length>0){let w=!1,S=z.length,C=-1;const E=z[z.length-1]._source;14!==E&&12!==E||(w=!0,C=z[z.length-1].format,S--);const F=[],J=[],x=[],u=[],h=[],X=[],K=[],c={};for(let f=0;f<S;++f){const w=z[f];F.push(w.samplingMode),J.push(w.type),x.push(w.format);void 0!==c[w.uniqueId]?(u.push(-1),K.push(0)):(c[w.uniqueId]=f,w.is2DArray?(u.push(35866),K.push(w.depth)):w.isCube?(u.push(34067),K.push(0)):w.is3D?(u.push(32879),K.push(w.depth)):(u.push(3553),K.push(0))),this._faceIndices&&h.push(this._faceIndices[f]??0),this._layerIndices&&X.push(this._layerIndices[f]??0)}const y={samplingModes:F,generateMipMaps:z[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:w,depthTextureFormat:C,types:J,formats:x,textureCount:S,targetTypes:u,faceIndex:h,layerIndex:X,layerCounts:K,label:this.label},e={width:this.width,height:this.height,depth:this.depth};f=this._engine.createMultipleRenderTarget(e,y);for(let O=0;O<S;++O){if(-1!==u[O])continue;const w=c[z[O].uniqueId];f.setTexture(f.textures[w],O)}}}else{var z,w,S,C;const F={};if(F.generateDepthBuffer=this._generateDepthBuffer,F.generateMipMaps=(null===(z=this.texture)||void 0===z?void 0:z.generateMipMaps)??!1,F.generateStencilBuffer=this._generateStencilBuffer,F.samplingMode=null===(w=this.texture)||void 0===w?void 0:w.samplingMode,F.type=null===(S=this.texture)||void 0===S?void 0:S.type,F.format=null===(C=this.texture)||void 0===C?void 0:C.format,F.noColorAttachment=!this._textures,F.label=this.label,this.isCube)f=this._engine.createRenderTargetCubeTexture(this.width,F);else{var E;const z={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(E=this.texture)||void 0===E?void 0:E.depth:void 0};f=this._engine.createRenderTargetTexture(z,F)}f.texture&&(f.texture.isReady=!0)}return f}_swapRenderTargetWrapper(f){if(this._textures&&f._textures)for(let z=0;z<this._textures.length;++z)this._textures[z]._swapAndDie(f._textures[z],!1),f._textures[z].isReady=!0;this._depthStencilTexture&&f._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(f._depthStencilTexture),f._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const f=this._cloneRenderTargetWrapper();if(f){if(this._depthStencilTexture){const z=this._depthStencilTexture.samplingMode,w=this._depthStencilTexture.format,S=2===z||3===z||11===z;f.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,S,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,w,this._depthStencilTextureLabel)}this.samples>1&&f.setSamples(this.samples),f._swapRenderTargetWrapper(this),f.dispose()}}releaseTextures(){if(this._textures)for(let z=0;z<(null===(f=this._textures)||void 0===f?void 0:f.length);++z){var f;this._textures[z].dispose()}this._textures=null}dispose(){var f;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(f=this._depthStencilTexture)||void 0===f||f.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11951:(f,z,w)=>{"use strict";w.r(z),w.d(z,{SceneInstrumentation:()=>E});var S=w(535),C=w(2437);class E{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(f){f!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=f,f?(this._onBeforeActiveMeshesEvaluationObserver=this.Rc.onBeforeActiveMeshesEvaluationObservable.add((()=>{S.h.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Rc.onAfterActiveMeshesEvaluationObservable.add((()=>{S.h.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Rc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(f){f!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=f,f?(this._onBeforeRenderTargetsRenderObserver=this.Rc.onBeforeRenderTargetsRenderObservable.add((()=>{S.h.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Rc.onAfterRenderTargetsRenderObservable.add((()=>{S.h.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Rc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(f){f!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=f,f?(this._onBeforeParticlesRenderingObserver=this.Rc.onBeforeParticlesRenderingObservable.add((()=>{S.h.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Rc.onAfterParticlesRenderingObservable.add((()=>{S.h.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Rc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(f){f!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=f,this.Rc.spriteManagers&&(f?(this._onBeforeSpritesRenderingObserver=this.Rc.onBeforeSpritesRenderingObservable.add((()=>{S.h.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Rc.onAfterSpritesRenderingObservable.add((()=>{S.h.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Rc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Rc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(f){f!==this._capturePhysicsTime&&this.Rc.onBeforePhysicsObservable&&(this._capturePhysicsTime=f,f?(this._onBeforePhysicsObserver=this.Rc.onBeforePhysicsObservable.add((()=>{S.h.StartPerformanceCounter("eb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Rc.onAfterPhysicsObservable.add((()=>{S.h.EndPerformanceCounter("eb"),this._physicsTime.endMonitoring()}))):(this.Rc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Rc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(f){f!==this._captureAnimationsTime&&(this._captureAnimationsTime=f,f?this._onAfterAnimationsObserver=this.Rc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Rc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(f){this._captureFrameTime=f}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(f){this._captureInterFrameTime=f}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(f){f!==this._captureRenderTime&&(this._captureRenderTime=f,f?(this._onBeforeDrawPhaseObserver=this.Rc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),S.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Rc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),S.h.EndPerformanceCounter("Main render")}))):(this.Rc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(f){f!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=f,f?(this._onBeforeCameraRenderObserver=this.Rc.onBeforeCameraRenderObservable.add((f=>{this._cameraRenderTime.beginMonitoring(),S.h.StartPerformanceCounter(`Rendering camera ${f.name}`)})),this._onAfterCameraRenderObserver=this.Rc.onAfterCameraRenderObservable.add((f=>{this._cameraRenderTime.endMonitoring(!1),S.h.EndPerformanceCounter(`Rendering camera ${f.name}`)}))):(this.Rc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Rc.getEngine()._drawCalls}constructor(f){this.Rc=f,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new C.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new C.c,this._captureFrameTime=!1,this._frameTime=new C.c,this._captureRenderTime=!1,this._renderTime=new C.c,this._captureInterFrameTime=!1,this._interFrameTime=new C.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new C.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new C.c,this._capturePhysicsTime=!1,this._physicsTime=new C.c,this._captureAnimationsTime=!1,this._animationsTime=new C.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new C.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=f.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(S.h.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Rc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=f.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(S.h.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.hk(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.hk(),this._captureParticlesRenderTime&&this._particlesRenderTime.hk(),this._captureSpritesRenderTime&&this._spritesRenderTime.hk(),this._captureRenderTime&&this._renderTime.hk(),this._captureCameraRenderTime&&this._cameraRenderTime.hk()}))}dispose(){this.Rc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Rc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Rc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Rc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Rc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Rc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Rc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Rc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Rc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Rc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Rc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Rc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Rc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Rc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Rc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Rc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Rc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Rc=null}}},12713:(f,z,w)=>{"use strict";w.d(z,{b:()=>h});var S=w(692),C=w(699),E=w(720),F=w(749),J=w(12686),x=w(12722),u=w(665);F.e.AddNodeConstructor("Light_Type_1",((f,z)=>()=>new h(f,E.n.Zero(),z)));class h extends x.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(f){this._shadowFrustumSize=f,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(f){this._shadowOrthoScale=f,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(f){this._orthoLeft=f}get orthoRight(){return this._orthoRight}set orthoRight(f){this._orthoRight=f}get orthoTop(){return this._orthoTop}set orthoTop(f){this._orthoTop=f}get orthoBottom(){return this._orthoBottom}set orthoBottom(f){this._orthoBottom=f}constructor(f,z,w){super(f,w),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=z.scale(-1),this.direction=z}getClassName(){return"fb"}getTypeID(){return J.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(f,z,w){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(f):this._setDefaultAutoExtendShadowProjectionMatrix(f,z,w)}_setDefaultFixedFrustumShadowProjectionMatrix(f){const z=this.va().activeCamera;z&&E.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:z.Zj,void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,f,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(f,z,w){const S=this.va().activeCamera;if(!S)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const f=E.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let F=0;F<w.length;F++){const J=w[F];if(!J)continue;const x=J.getBoundingInfo().boundingBox;for(let w=0;w<x.vectorsWorld.length;w++)E.n.TransformCoordinatesToRef(x.vectorsWorld[w],z,f),f.x<this._orthoLeft&&(this._orthoLeft=f.x),f.y<this._orthoBottom&&(this._orthoBottom=f.y),f.x>this._orthoRight&&(this._orthoRight=f.x),f.y>this._orthoTop&&(this._orthoTop=f.y),this.autoCalcShadowZBounds&&(f.z<S&&(S=f.z),f.z>C&&(C=f.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=C)}const C=this._orthoRight-this._orthoLeft,F=this._orthoTop-this._orthoBottom,J=void 0!==this.shadowMinZ?this.shadowMinZ:S.Zj,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,u=this.va().getEngine().useReverseDepthBuffer;E.b.OrthoOffCenterLHToRef(this._orthoLeft-C*this.shadowOrthoScale,this._orthoRight+C*this.shadowOrthoScale,this._orthoBottom-F*this.shadowOrthoScale,this._orthoTop+F*this.shadowOrthoScale,u?x:J,u?J:x,f,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,z){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,z),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,z),this)}transferToNodeMaterialEffect(f,z){return this.computeTransformedInformation()?(f.setFloat3(z,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(f.setFloat3(z,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(f){const z=this._scene.getEngine();return!z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:1}getDepthMaxZ(f){const z=this._scene.getEngine();return z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:1}prepareLightSpecificDefines(f,z){f["DIRLIGHT"+z]=!0}}(0,S.b)([(0,C.O)()],h.prototype,"shadowFrustumSize",null),(0,S.b)([(0,C.O)()],h.prototype,"shadowOrthoScale",null),(0,S.b)([(0,C.O)()],h.prototype,"autoUpdateExtends",void 0),(0,S.b)([(0,C.O)()],h.prototype,"autoCalcShadowZBounds",void 0),(0,S.b)([(0,C.O)("orthoLeft")],h.prototype,"_orthoLeft",void 0),(0,S.b)([(0,C.O)("orthoRight")],h.prototype,"_orthoRight",void 0),(0,S.b)([(0,C.O)("orthoTop")],h.prototype,"_orthoTop",void 0),(0,S.b)([(0,C.O)("orthoBottom")],h.prototype,"_orthoBottom",void 0),(0,u.f)("BABYLON.DirectionalLight",h)},12880:(f,z,w)=>{"use strict";w.d(z,{b:()=>h});var S=w(692),C=w(699),E=w(720),F=w(762),J=w(749),x=w(12686),u=w(665);J.e.AddNodeConstructor("Light_Type_3",((f,z)=>()=>new h(f,E.n.Zero(),z)));class h extends x.b{constructor(f,z,w){super(f,w),this.groundColor=new F.d(0,0,0),this.direction=z||E.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"gb"}setDirectionToTarget(f){return this.direction=E.n.Normalize(f.te(E.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(f,z){const w=E.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",w.x,w.y,w.z,0,z),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Dl),z),this}transferToNodeMaterialEffect(f,z){const w=E.n.Normalize(this.direction);return f.setFloat3(z,w.x,w.y,w.z),this}bk(){return this._worldMatrix||(this._worldMatrix=E.b.Identity()),this._worldMatrix}getTypeID(){return x.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(f,z){f["HEMILIGHT"+z]=!0}}(0,S.b)([(0,C.n)()],h.prototype,"groundColor",void 0),(0,S.b)([(0,C.K)()],h.prototype,"direction",void 0),(0,u.f)("BABYLON.HemisphericLight",h)},12686:(f,z,w)=>{"use strict";w.d(z,{b:()=>K});var S=w(692),C=w(699),E=w(720),F=w(762),J=w(749),x=w(874),u=w(665),h=w(892),X=w(753);class K extends J.e{get range(){return this._range}set range(f){this._range=f,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(f){this._intensityMode=f,this._computePhotometricScale()}get radius(){return this._radius}set radius(f){this._radius=f,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(f){this._shadowEnabled!==f&&(this._shadowEnabled=f,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(f){this._includedOnlyMeshes=f,this._hookArrayForIncludedOnly(f)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(f){this._excludedMeshes=f,this._hookArrayForExcluded(f)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(f){this._excludeWithLayerMask=f,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(f){this._includeOnlyWithLayerMask=f,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(f){this._lightmapMode!==f&&(this._lightmapMode=f,this._markMeshesAsLightDirty())}getViewMatrix(f){return null}getProjectionMatrix(f,z){return null}constructor(f,z){super(f,z,!1),this.rh=new F.d(1,1,1),this.sk=new F.d(1,1,1),this.falloffType=K.FALLOFF_DEFAULT,this.Dl=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=K.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new x.d(this.va().getEngine(),void 0,void 0,f),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(f,z){return this}_bindLight(f,z,w,S){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const E=f.toString();let J=!1;if(this._uniformBuffer.bindToEffect(w,"Light"+E),this._renderId!==z.getRenderId()||this._lastUseSpecular!==S||!this._uniformBuffer.useUbo){this._renderId=z.getRenderId(),this._lastUseSpecular=S;const f=this.getScaledIntensity();this.transferToEffect(w,E),this.rh.scaleToRef(f,F.i.uk[0]),this._uniformBuffer.updateColor4("vLightDiffuse",F.i.uk[0],this.range,E),S&&(this.sk.scaleToRef(f,F.i.uk[1]),this._uniformBuffer.updateColor4("vLightSpecular",F.i.uk[1],this.radius,E)),J=!0}if(this.transferTexturesToEffect(w,E),z.shadowsEnabled&&this.shadowEnabled&&C){const f=this.getShadowGenerator(z.activeCamera)??this.getShadowGenerator();f&&(f.bindShadowLight(E,w),J=!0)}J?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(f){let z="Name: "+this.name;if(z+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let w=0;w<this.animations.length;w++)z+=", animation[0]: "+this.animations[w].toString(f);return z}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Cb(f){super.Cb(f),this._resyncMeshes()}getShadowGenerator(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(f)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return E.n.Zero()}canAffectMesh(f){return!f||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(f))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(f))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&f.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&f.layerMask)))}dispose(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const f=this._shadowGenerators.values();for(let z=f.next();!0!==z.done;z=f.next()){z.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const f=this._parentContainer.lights.indexOf(this);f>-1&&this._parentContainer.lights.splice(f,1),this._parentContainer=null}for(const w of this.va().meshes)w._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(f,z)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Dl}clone(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=K.GetConstructorFromName(this.getTypeID(),f,this.va());if(!w)return null;const S=X.b.Clone(w,this);return f&&(S.name=f),z&&(S.parent=z),S.Cb(this.isEnabled()),this.onClonedObservable.notifyObservers(S),S}serialize(){const f=X.b.Serialize(this);return f.uniqueId=this.uniqueId,f.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(f),this.excludedMeshes.length>0&&(f.excludedMeshesIds=[],this.excludedMeshes.forEach((z=>{f.excludedMeshesIds.push(z.id)}))),this.includedOnlyMeshes.length>0&&(f.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((z=>{f.includedOnlyMeshesIds.push(z.id)}))),X.b.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f.isEnabled=this.isEnabled(),f}static GetConstructorFromName(f,z,w){const S=J.e.Construct("Light_Type_"+f,z,w);return S||null}static Parse(f,z){const w=K.GetConstructorFromName(f.type,f.name,z);if(!w)return null;const S=X.b.Parse(w,f,z);if(f.excludedMeshesIds&&(S._excludedMeshesIds=f.excludedMeshesIds),f.includedOnlyMeshesIds&&(S._includedOnlyMeshesIds=f.includedOnlyMeshesIds),void 0!==f.parentId&&(S._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(S._waitingParentInstanceIndex=f.parentInstanceIndex),void 0!==f.falloffType&&(S.falloffType=f.falloffType),void 0!==f.lightmapMode&&(S.lightmapMode=f.lightmapMode),f.animations){for(let z=0;z<f.animations.length;z++){const w=f.animations[z],C=(0,u.b)("BABYLON.Animation");C&&S.animations.push(C.Parse(w))}J.e.ParseAnimationRanges(S,f,z)}return f.autoAnimate&&z.beginAnimation(S,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),void 0!==f.isEnabled&&S.Cb(f.isEnabled),S}_hookArrayForExcluded(f){var z=this;const w=f.push;f.push=function(){for(var S=arguments.length,C=new Array(S),E=0;E<S;E++)C[E]=arguments[E];const F=w.apply(f,C);for(const f of C)f._resyncLightSource(z);return F};const S=f.splice;f.splice=(z,w)=>{const C=S.apply(f,[z,w]);for(const f of C)f._resyncLightSource(this);return C};for(const C of f)C._resyncLightSource(this)}_hookArrayForIncludedOnly(f){var z=this;const w=f.push;f.push=function(){for(var S=arguments.length,C=new Array(S),E=0;E<S;E++)C[E]=arguments[E];const F=w.apply(f,C);return z._resyncMeshes(),F};const S=f.splice;f.splice=(z,w)=>{const C=S.apply(f,[z,w]);return this._resyncMeshes(),C},this._resyncMeshes()}_resyncMeshes(){for(const f of this.va().meshes)f._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const f of this.va().meshes)-1!==f.lightSources.indexOf(this)&&f._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let f=0;const z=this.getTypeID();let w=this.intensityMode;switch(w===K.INTENSITYMODE_AUTOMATIC&&(w=z===K.LIGHTTYPEID_DIRECTIONALLIGHT?K.INTENSITYMODE_ILLUMINANCE:K.INTENSITYMODE_LUMINOUSINTENSITY),z){case K.LIGHTTYPEID_POINTLIGHT:case K.LIGHTTYPEID_SPOTLIGHT:switch(w){case K.INTENSITYMODE_LUMINOUSPOWER:f=1/(4*Math.PI);break;case K.INTENSITYMODE_LUMINOUSINTENSITY:f=1;break;case K.INTENSITYMODE_LUMINANCE:f=this.radius*this.radius}break;case K.LIGHTTYPEID_DIRECTIONALLIGHT:switch(w){case K.INTENSITYMODE_ILLUMINANCE:f=1;break;case K.INTENSITYMODE_LUMINANCE:{let z=this.radius;z=Math.max(z,.001);f=2*Math.PI*(1-Math.cos(z));break}}break;case K.LIGHTTYPEID_HEMISPHERICLIGHT:f=1}return f}_reorderLightsInScene(){const f=this.va();0!=this._renderPriority&&(f.requireLightSorting=!0),this.va().sortLightsByPriority()}}K.FALLOFF_DEFAULT=h.b.FALLOFF_DEFAULT,K.FALLOFF_PHYSICAL=h.b.FALLOFF_PHYSICAL,K.FALLOFF_GLTF=h.b.FALLOFF_GLTF,K.FALLOFF_STANDARD=h.b.FALLOFF_STANDARD,K.LIGHTMAP_DEFAULT=h.b.LIGHTMAP_DEFAULT,K.LIGHTMAP_SPECULAR=h.b.LIGHTMAP_SPECULAR,K.LIGHTMAP_SHADOWSONLY=h.b.LIGHTMAP_SHADOWSONLY,K.INTENSITYMODE_AUTOMATIC=h.b.INTENSITYMODE_AUTOMATIC,K.INTENSITYMODE_LUMINOUSPOWER=h.b.INTENSITYMODE_LUMINOUSPOWER,K.INTENSITYMODE_LUMINOUSINTENSITY=h.b.INTENSITYMODE_LUMINOUSINTENSITY,K.INTENSITYMODE_ILLUMINANCE=h.b.INTENSITYMODE_ILLUMINANCE,K.INTENSITYMODE_LUMINANCE=h.b.INTENSITYMODE_LUMINANCE,K.LIGHTTYPEID_POINTLIGHT=h.b.LIGHTTYPEID_POINTLIGHT,K.LIGHTTYPEID_DIRECTIONALLIGHT=h.b.LIGHTTYPEID_DIRECTIONALLIGHT,K.LIGHTTYPEID_SPOTLIGHT=h.b.LIGHTTYPEID_SPOTLIGHT,K.LIGHTTYPEID_HEMISPHERICLIGHT=h.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,S.b)([(0,C.n)()],K.prototype,"diffuse",void 0),(0,S.b)([(0,C.n)()],K.prototype,"specular",void 0),(0,S.b)([(0,C.O)()],K.prototype,"falloffType",void 0),(0,S.b)([(0,C.O)()],K.prototype,"intensity",void 0),(0,S.b)([(0,C.O)()],K.prototype,"range",null),(0,S.b)([(0,C.O)()],K.prototype,"intensityMode",null),(0,S.b)([(0,C.O)()],K.prototype,"radius",null),(0,S.b)([(0,C.O)()],K.prototype,"_renderPriority",void 0),(0,S.b)([(0,C.e)("_reorderLightsInScene")],K.prototype,"renderPriority",void 0),(0,S.b)([(0,C.O)("shadowEnabled")],K.prototype,"_shadowEnabled",void 0),(0,S.b)([(0,C.O)("excludeWithLayerMask")],K.prototype,"_excludeWithLayerMask",void 0),(0,S.b)([(0,C.O)("includeOnlyWithLayerMask")],K.prototype,"_includeOnlyWithLayerMask",void 0),(0,S.b)([(0,C.O)("lightmapMode")],K.prototype,"_lightmapMode",void 0)},12722:(f,z,w)=>{"use strict";w.d(z,{e:()=>x});var S=w(692),C=w(699),E=w(720),F=w(12686),J=w(876);class x extends F.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=E.b.Identity(),this._projectionMatrix=E.b.Identity()}_setPosition(f){this._position=f}get position(){return this._position}set position(f){this._setPosition(f)}_setDirection(f){this._direction=f}get direction(){return this._direction}set direction(f){this._setDirection(f)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(f){this._shadowMinZ=f,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(f){this._shadowMaxZ=f,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=E.n.Zero()),E.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=E.n.Zero()),E.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(f){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(f){return this.direction=E.n.Normalize(f.te(this.position)),this.direction}getRotation(){this.direction.normalize();const f=E.n.Cross(this.direction,J.b.Y),z=E.n.Cross(f,this.direction);return E.n.RotationFromAxis(f,z,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=E.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}bk(f){return!f&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=E.b.Identity()),E.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(f){return void 0!==this.shadowMinZ?this.shadowMinZ:f.Zj}getDepthMaxZ(f){return void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ}setShadowProjectionMatrix(f,z,w){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(z,w,f):this._setDefaultShadowProjectionMatrix(f,z,w),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(f){const z=E.j.ek[0];let w=this.position;this.computeTransformedInformation()&&(w=this.transformedPosition),E.n.NormalizeToRef(this.getShadowDirection(f),z),1===Math.abs(E.n.Dot(z,E.n.Up()))&&(z.z=1e-13);const S=E.j.ek[1];return w.addToRef(z,S),E.b.LookAtLHToRef(w,S,E.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(f,z){return this.setShadowProjectionMatrix(this._projectionMatrix,f??this._viewMatrix,z??[]),this._projectionMatrix}}(0,S.b)([(0,C.K)()],x.prototype,"position",null),(0,S.b)([(0,C.K)()],x.prototype,"direction",null),(0,S.b)([(0,C.O)()],x.prototype,"shadowMinZ",null),(0,S.b)([(0,C.O)()],x.prototype,"shadowMaxZ",null)},12311:(f,z,w)=>{"use strict";w.d(z,{e:()=>F,g:()=>E,j:()=>J});const S={},C={};function E(f,z){S[f]=z}function F(f,z){C[f]=z}function J(f){return C[f]?C[f]:null}},12143:(f,z,w)=>{"use strict";w.d(z,{c:()=>a,e:()=>v});var S,C=w(535),E=w(527),F=w(2386),J=w(580),x=w(548),u=w(842),h=w(583),X=w(586),K=w(668),c=w(616);!function(f){f[f.Clean=0]="Clean",f[f.Stop=1]="Stop",f[f.Sync=2]="Sync",f[f.NoSync=3]="NoSync"}(S||(S={}));const y=new E.c,e={};let O=!1;function d(){return e[".babylon"]}function B(f){const z=e[f];return z||(x.b.Warn("Unable to find a plugin to load "+f+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d())}function V(f,z,w){let S="Unable to load from "+(f.rawData?"binary data":f.url);return z?S+=`: ${z}`:w&&(S+=`: ${w}`),S}function W(f,z,w,S,C,E,F,J,x){var u;const X="data:"===(K=f.url).substring(0,5)?K.substring(5):null;var K;if(f.rawData&&!F)throw"When using ArrayBufferView to load data the file extension must be provided.";const O=F?B(F):X?function(f){for(const z in e){const w=e[z].plugin;if(w.canDirectLoad&&w.canDirectLoad(f))return e[z]}return d()}(f.url):function(f){const z=f.indexOf("?");-1!==z&&(f=f.substring(0,z));const w=f.lastIndexOf(".");return B(f.substring(w,f.length).toLowerCase())}(f.url);if(!O)throw new Error(`No plugin or fallback for ${F??f.url}`);if(!1===(null===x||void 0===x||null===(u=x[O.plugin.name])||void 0===u?void 0:u.enabled))throw new Error(`The '${O.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(f.rawData&&!O.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(f=>{if(O.plugin.createPlugin){const z=O.plugin.createPlugin(x??{});return z instanceof Promise?(z.then(f).catch((f=>{C("Error instantiating plugin.",f)})),null):(f(z),z)}return f(O.plugin),O.plugin})((x=>{var u;if(!x)throw`The loader plugin corresponding to the '${F}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(y.notifyObservers(x),X&&(x.canDirectLoad&&x.canDirectLoad(f.url)||!(0,h.h)(f.url))){if(x.directLoad){const f=x.directLoad(z,X);f instanceof Promise?f.then((f=>{w(x,f)})).catch((f=>{C("Error in directLoad of _loadData: "+f,f)})):w(x,f)}else w(x,X);return}const K=O.isBinary,e=(f,S)=>{z.u?C("Scene has been disposed"):w(x,f,S)};let d=null,B=!1;null===(u=x.ik)||void 0===u||u.add((()=>{B=!0,d&&(d.abort(),d=null),E()}));const V=()=>{if(B)return;const w=(f,z)=>{C(null===f||void 0===f?void 0:f.statusText,z)};if(!x.loadFile&&f.rawData)throw"Plugin does not support loading ArrayBufferView.";d=x.loadFile?x.loadFile(z,f.rawData||f.file||f.url,f.rootUrl,e,S,K,w,J):z._loadFile(f.file||f.url,e,S,!0,K,w)},W=z.getEngine();let T=W.enableOfflineSupport;if(T){let w=!1;for(const S of z.disableOfflineSupportExceptionRules)if(S.test(f.url)){w=!0;break}T=!w}T&&c.e.OfflineProviderFactory?z.offlineProvider=c.e.OfflineProviderFactory(f.url,V,W.disableManifestCheck):V()}))}function T(f,z){let w,S,E=null,F=null;if(z)if(z.name)w=`file:${z.name}`,S=z.name,E=z;else if(ArrayBuffer.isView(z))w="",S=(0,K.d)(),F=z;else if(z.startsWith("data:"))w=z,S="";else if(f){const E=z;if("/"===E.substring(0,1))return C.h.Error("Wrong sceneFilename parameter"),null;w=f+E,S=E}else w=z,S=C.h.GetFilename(z),f=C.h.GetFolderPath(z);else w=f,S=C.h.GetFilename(f),f=C.h.GetFolderPath(f);return{url:w,rootUrl:f,name:S,file:E,rawData:F}}function v(f){if("string"===typeof f.extensions){const z=f.extensions;e[z.toLowerCase()]={plugin:f,isBinary:!1}}else{const z=f.extensions;Object.keys(z).forEach((w=>{e[w.toLowerCase()]={plugin:f,isBinary:z[w].isBinary}}))}}function D(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.c.LastCreatedScene,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!S)return x.b.Error("No scene available to import mesh to"),null;const c=T(z,w);if(!c)return null;const y={};S.addPendingData(y);const e=()=>{S.removePendingData(y)},O=(f,z)=>{const w=V(c,f,z);F?F(S,w,new X.g(w,X.f.SceneLoaderError,z)):x.b.Error(w),e()},d=E?f=>{try{E(f)}catch(z){O("Error in onProgress callback: "+z,z)}}:void 0,B=(f,z,w,E,F,J,x,u)=>{if(S.importedMeshesFiles.push(c.url),C)try{C(f,z,w,E,F,J,x,u)}catch(h){O("Error in onSuccess callback: "+h,h)}S.removePendingData(y)};return W(c,S,((z,w,C)=>{if(z.rewriteRootURL&&(c.rootUrl=z.rewriteRootURL(c.rootUrl,C)),z.importMesh){const C=[],E=[],F=[];if(!z.importMesh(f,S,w,c.rootUrl,C,E,F,O))return;S.loadingPluginName=z.name,B(C,E,F,[],[],[],[],[])}else{z.importMeshAsync(f,S,w,c.rootUrl,d,c.name).then((f=>{S.loadingPluginName=z.name,B(f.meshes,f.zk,f.skeletons,f.animationGroups,f.transformNodes,f.geometries,f.lights,f.spriteManagers)})).catch((f=>{O(f.message,f)}))}}),d,O,e,u,h,K)}function A(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.c.LastCreatedEngine,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return w?G(f,z,new F.c(w),S,E,x,u,h,X):(C.h.Error("No engine available"),null)}function M(f,z,w,S,C,E,F){return new Promise(((J,x)=>{A(f,z,w,(f=>{J(f)}),S,((f,z,w)=>{x(w||new Error(z))}),C,E,F)}))}function G(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.c.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!w)return x.b.Error("No scene available to append to"),null;const c=T(f,z);if(!c)return null;const y={};w.addPendingData(y);const e=()=>{w.removePendingData(y)};u.c.ShowLoadingScreen&&!O&&(O=!0,w.getEngine().displayLoadingUI(),w.executeWhenReady((()=>{w.getEngine().hideLoadingUI(),O=!1})));const d=(f,z)=>{const S=V(c,f,z);E?E(w,S,new X.g(S,X.f.SceneLoaderError,z)):x.b.Error(S),e()},B=C?f=>{try{C(f)}catch(z){d("Error in onProgress callback",z)}}:void 0,v=()=>{if(S)try{S(w)}catch(f){d("Error in onSuccess callback",f)}w.removePendingData(y)};return W(c,w,((f,z)=>{if(f.load){if(!f.load(w,z,c.rootUrl,d))return;w.loadingPluginName=f.name,v()}else{f.loadAsync(w,z,c.rootUrl,B,c.name).then((()=>{w.loadingPluginName=f.name,v()})).catch((f=>{d(f.message,f)}))}}),B,d,e,F,h,K)}function I(f,z,w,S,C,E,F){return new Promise(((J,x)=>{G(f,z,w,(f=>{J(f)}),S,((f,z,w)=>{x(w||new Error(z))}),C,E,F)}))}function n(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.c.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!w)return x.b.Error("No scene available to load asset container to"),null;const K=T(f,z);if(!K)return null;const c={};w.addPendingData(c);const y=()=>{w.removePendingData(c)},e=(f,z)=>{const S=V(K,f,z);E?E(w,S,new X.g(S,X.f.SceneLoaderError,z)):x.b.Error(S),y()},O=C?f=>{try{C(f)}catch(z){e("Error in onProgress callback",z)}}:void 0,d=f=>{if(S)try{S(f)}catch(z){e("Error in onSuccess callback",z)}w.removePendingData(c)};return W(K,w,((f,z)=>{if(f.loadAssetContainer){const S=f.loadAssetContainer(w,z,K.rootUrl,e);if(!S)return;S.populateRootNodes(),w.loadingPluginName=f.name,d(S)}else if(f.loadAssetContainerAsync){f.loadAssetContainerAsync(w,z,K.rootUrl,O,K.name).then((z=>{z.populateRootNodes(),w.loadingPluginName=f.name,d(z)})).catch((f=>{e(f.message,f)}))}else e("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),O,e,y,F,u,h)}function P(f,z,w,S,C,E,F){return new Promise(((J,x)=>{n(f,z,w,(f=>{J(f)}),S,((f,z,w)=>{x(w||new Error(z))}),C,E,F)}))}function R(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.c.LastCreatedScene,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!w)return void x.b.Error("No scene available to load animations to");if(S){for(const f of w.animatables)f.reset();w.stopAllAnimations(),w.animationGroups.slice().forEach((f=>{f.dispose()}));w.getNodes().forEach((f=>{f.animations&&(f.animations=[])}))}else switch(C){case 0:w.animationGroups.slice().forEach((f=>{f.dispose()}));break;case 1:w.animationGroups.forEach((f=>{f.stop()}));break;case 2:w.animationGroups.forEach((f=>{f.reset(),f.restart()}));break;case 3:break;default:return void x.b.Error("Unknown animation group loading mode value '"+C+"'")}const y=w.animatables.length;n(f,z,w,(f=>{f.mergeAnimationsTo(w,w.animatables.slice(y),E),f.dispose(),w.onAnimationFileImportedObservable.notifyObservers(w),F&&F(w)}),u,h,X,K,c)}function q(f,z,w,S,C,E,F,J,x,u){return new Promise(((h,X)=>{R(f,z,w,S,C,E,(f=>{h(f)}),F,((f,z,w)=>{X(w||new Error(z))}),J,x,u)}))}class a{static get ForceFullSceneLoadingForIncremental(){return u.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(f){u.c.ForceFullSceneLoadingForIncremental=f}static get ShowLoadingScreen(){return u.c.ShowLoadingScreen}static set ShowLoadingScreen(f){u.c.ShowLoadingScreen=f}static get loggingLevel(){return u.c.loggingLevel}static set loggingLevel(f){u.c.loggingLevel=f}static get CleanBoneMatrixWeights(){return u.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(f){u.c.CleanBoneMatrixWeights=f}static GetDefaultPlugin(){return d()}static GetPluginForExtension(f){var z;return null===(z=B(f))||void 0===z?void 0:z.plugin}static IsPluginForExtensionAvailable(f){return function(f){return!!e[f]}(f)}static RegisterPlugin(f){v(f)}static ImportMesh(f,z,w,S,C,E,F,J,x){return D(f,z,w,S,C,E,F,J,x)}static ImportMeshAsync(f,z,w,S,C,E,F){return function(f,z,w,S,C,E,F,J){return new Promise(((x,u)=>{D(f,z,w,S,((f,z,w,S,C,E,F,J)=>{x({meshes:f,zk:z,skeletons:w,animationGroups:S,transformNodes:C,geometries:E,lights:F,spriteManagers:J})}),C,((f,z,w)=>{u(w||new Error(z))}),E,F,J)}))}(f,z,w,S,C,E,F)}static Load(f,z,w,S,C,E,F,J){return A(f,z,w,S,C,E,F,J)}static LoadAsync(f,z,w,S,C,E){return M(f,z,w,S,C,E)}static Append(f,z,w,S,C,E,F,J){return G(f,z,w,S,C,E,F,J)}static AppendAsync(f,z,w,S,C,E){return I(f,z,w,S,C,E)}static LoadAssetContainer(f,z,w,S,C,E,F,J){return n(f,z,w,S,C,E,F,J)}static LoadAssetContainerAsync(f,z,w,S,C,E){return P(f,z,w,S,C,E)}static ImportAnimations(f,z,w,S,C,E,F,J,x,u,h){R(f,z,w,S,C,E,F,J,x,u,h)}static ImportAnimationsAsync(f,z,w,S,C,E,F,J,x,u,h){return q(f,z,w,S,C,E,J,u,h)}}a.NO_LOGGING=0,a.MINIMAL_LOGGING=1,a.SUMMARY_LOGGING=2,a.DETAILED_LOGGING=3,a.OnPluginActivatedObservable=y},12667:(f,z,w)=>{"use strict";w.d(z,{d:()=>r});var S=w(692),C=w(699),E=w(548),F=w(715),J=w(12661),x=w(2386),u=w(720),h=w(789),X=w(12064),K=w(12089);class c extends X.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class y extends K.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRBRDF",90,new c,z),this._useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=y.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=y.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=f._dirtyCallbacks[16],this._enable(!0)}prepareDefines(f){f.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,f.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,f.SPHERICAL_HARMONICS=this._useSphericalHarmonics,f.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}y.DEFAULT_USE_ENERGY_CONSERVATION=!0,y.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,y.DEFAULT_USE_SPHERICAL_HARMONICS=!0,y.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useEnergyConservation",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSphericalHarmonics",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],y.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var e=w(12060),O=w(762),d=w(2390),B=w(878),V=w(12067),W=w(2321),T=w(12070),v=(w(2456),w(12078)),D=w(885);class A extends X.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class M extends K.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRClearCoat",100,new A,z),this._isEnabled=!1,this.isEnabled=!1,this.Dl=1,this.roughness=0,this._indexOfRefraction=M._DefaultIndexOfRefraction,this.indexOfRefraction=M._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=O.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,z,w){if(!this._isEnabled)return!0;const S=this._material._disableBumpMap;if(f._areTexturesDirty&&z.texturesEnabled){if(this._texture&&T.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(w.getCaps().standardDerivatives&&this._bumpTexture&&T.d.ClearCoatBumpTextureEnabled&&!S&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&T.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,z){this._isEnabled?(f.CLEARCOAT=!0,f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,f.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,f._areTexturesDirty&&z.texturesEnabled&&(this._texture&&T.d.ClearCoatTextureEnabled?(0,D.L)(this._texture,f,"CLEARCOAT_TEXTURE"):f.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&T.d.ClearCoatTextureEnabled?(0,D.L)(this._textureRoughness,f,"CLEARCOAT_TEXTURE_ROUGHNESS"):f.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&T.d.ClearCoatBumpTextureEnabled?(0,D.L)(this._bumpTexture,f,"CLEARCOAT_BUMP"):f.CLEARCOAT_BUMP=!1,f.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===M._DefaultIndexOfRefraction,this._isTintEnabled?(f.CLEARCOAT_TINT=!0,this._tintTexture&&T.d.ClearCoatTintTextureEnabled?((0,D.L)(this._tintTexture,f,"CLEARCOAT_TINT_TEXTURE"),f.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):f.CLEARCOAT_TINT_TEXTURE=!1):(f.CLEARCOAT_TINT=!1,f.CLEARCOAT_TINT_TEXTURE=!1))):(f.CLEARCOAT=!1,f.CLEARCOAT_TEXTURE=!1,f.CLEARCOAT_TEXTURE_ROUGHNESS=!1,f.CLEARCOAT_BUMP=!1,f.CLEARCOAT_TINT=!1,f.CLEARCOAT_TINT_TEXTURE=!1,f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,f.CLEARCOAT_DEFAULTIOR=!1,f.CLEARCOAT_TEXTUREDIRECTUV=0,f.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,f.CLEARCOAT_BUMPDIRECTUV=0,f.CLEARCOAT_REMAP_F0=!1,f.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,f.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(f,z,w,S){if(!this._isEnabled)return;const C=S.materialDefines,E=this._material.isFrozen,F=this._material._disableBumpMap,J=this._material._invertNormalMapX,x=this._material._invertNormalMapY;if(!f.useUbo||!E||!f.isSync){var u,h,X,K;if((this._texture||this._textureRoughness)&&T.d.ClearCoatTextureEnabled)f.updateFloat4("vClearCoatInfos",(null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(h=this._texture)||void 0===h?void 0:h.level)??0,(null===(X=this._textureRoughness)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(K=this._textureRoughness)||void 0===K?void 0:K.level)??0),this._texture&&(0,D.p)(this._texture,f,"clearCoat"),this._textureRoughness&&!C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.p)(this._textureRoughness,f,"clearCoatRoughness");this._bumpTexture&&w.getCaps().standardDerivatives&&T.d.ClearCoatTextureEnabled&&!F&&(f.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,D.p)(this._bumpTexture,f,"clearCoatBump"),z._mirroredCameraPosition?f.updateFloat2("vClearCoatTangentSpaceParams",J?1:-1,x?1:-1):f.updateFloat2("vClearCoatTangentSpaceParams",J?-1:1,x?-1:1)),this._tintTexture&&T.d.ClearCoatTintTextureEnabled&&(f.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,D.p)(this._tintTexture,f,"clearCoatTint")),f.updateFloat2("vClearCoatParams",this.Dl,this.roughness);const S=1-this._indexOfRefraction,E=1+this._indexOfRefraction,c=Math.pow(-S/E,2),y=1/this._indexOfRefraction;f.updateFloat4("vClearCoatRefractionParams",c,y,S,E),this._isTintEnabled&&(f.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),f.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}z.texturesEnabled&&(this._texture&&T.d.ClearCoatTextureEnabled&&f.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!C.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.d.ClearCoatTextureEnabled&&f.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&w.getCaps().standardDerivatives&&T.d.ClearCoatBumpTextureEnabled&&!F&&f.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&T.d.ClearCoatTintTextureEnabled&&f.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(f){return this._texture===f||(this._textureRoughness===f||(this._bumpTexture===f||this._tintTexture===f))}getActiveTextures(f){this._texture&&f.push(this._texture),this._textureRoughness&&f.push(this._textureRoughness),this._bumpTexture&&f.push(this._bumpTexture),this._tintTexture&&f.push(this._tintTexture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&f.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&f.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&f.push(this._tintTexture)}dispose(f){var z,w,S,C;f&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(w=this._textureRoughness)||void 0===w||w.dispose(),null===(S=this._bumpTexture)||void 0===S||S.dispose(),null===(C=this._tintTexture)||void 0===C||C.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(f,z,w){return f.CLEARCOAT_BUMP&&z.addFallback(w++,"CLEARCOAT_BUMP"),f.CLEARCOAT_TINT&&z.addFallback(w++,"CLEARCOAT_TINT"),f.CLEARCOAT&&z.addFallback(w++,"CLEARCOAT"),w}getSamplers(f){f.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}M._DefaultIndexOfRefraction=1.5,(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isEnabled",void 0),(0,S.b)([(0,C.O)()],M.prototype,"intensity",void 0),(0,S.b)([(0,C.O)()],M.prototype,"roughness",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"texture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"textureRoughness",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"remapF0OnInterfaceChange",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"isTintEnabled",void 0),(0,S.b)([(0,C.n)()],M.prototype,"tintColor",void 0),(0,S.b)([(0,C.O)()],M.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,C.O)()],M.prototype,"tintThickness",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"tintTexture",void 0);class G extends X.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class I extends K.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRIridescence",110,new G,z),this._isEnabled=!1,this.isEnabled=!1,this.Dl=1,this.minimumThickness=I._DefaultMinimumThickness,this.maximumThickness=I._DefaultMaximumThickness,this.indexOfRefraction=I._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,z){if(!this._isEnabled)return!0;if(f._areTexturesDirty&&z.texturesEnabled){if(this._texture&&T.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&T.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,z){this._isEnabled?(f.IRIDESCENCE=!0,f._areTexturesDirty&&z.texturesEnabled&&(this._texture&&T.d.IridescenceTextureEnabled?(0,D.L)(this._texture,f,"IRIDESCENCE_TEXTURE"):f.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&T.d.IridescenceTextureEnabled?(0,D.L)(this._thicknessTexture,f,"IRIDESCENCE_THICKNESS_TEXTURE"):f.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(f.IRIDESCENCE=!1,f.IRIDESCENCE_TEXTURE=!1,f.IRIDESCENCE_THICKNESS_TEXTURE=!1,f.IRIDESCENCE_TEXTUREDIRECTUV=0,f.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(f,z){if(!this._isEnabled)return;const w=this._material.isFrozen;if(!f.useUbo||!w||!f.isSync){var S,C,E,F;if((this._texture||this._thicknessTexture)&&T.d.IridescenceTextureEnabled)f.updateFloat4("vIridescenceInfos",(null===(S=this._texture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(C=this._texture)||void 0===C?void 0:C.level)??0,(null===(E=this._thicknessTexture)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(F=this._thicknessTexture)||void 0===F?void 0:F.level)??0),this._texture&&(0,D.p)(this._texture,f,"iridescence"),this._thicknessTexture&&(0,D.p)(this._thicknessTexture,f,"iridescenceThickness");f.updateFloat4("vIridescenceParams",this.Dl,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}z.texturesEnabled&&(this._texture&&T.d.IridescenceTextureEnabled&&f.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&T.d.IridescenceTextureEnabled&&f.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(f){return this._texture===f||this._thicknessTexture===f}getActiveTextures(f){this._texture&&f.push(this._texture),this._thicknessTexture&&f.push(this._thicknessTexture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&f.push(this._thicknessTexture)}dispose(f){var z,w;f&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(w=this._thicknessTexture)||void 0===w||w.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(f,z,w){return f.IRIDESCENCE&&z.addFallback(w++,"IRIDESCENCE"),w}getSamplers(f){f.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}I._DefaultMinimumThickness=100,I._DefaultMaximumThickness=400,I._DefaultIndexOfRefraction=1.3,(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),(0,S.b)([(0,C.O)()],I.prototype,"intensity",void 0),(0,S.b)([(0,C.O)()],I.prototype,"minimumThickness",void 0),(0,S.b)([(0,C.O)()],I.prototype,"maximumThickness",void 0),(0,S.b)([(0,C.O)()],I.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"thicknessTexture",void 0);class n extends X.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class P extends K.d{set angle(f){this.direction.x=Math.cos(f),this.direction.y=Math.sin(f)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRAnisotropic",110,new n,z),this._isEnabled=!1,this.isEnabled=!1,this.Dl=1,this.direction=new u.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=f._dirtyCallbacks[16]}isReadyForSubMesh(f,z){return!this._isEnabled||!(f._areTexturesDirty&&z.texturesEnabled&&this._texture&&T.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(f,z,w){this._isEnabled?(f.ANISOTROPIC=this._isEnabled,this._isEnabled&&!w.isVerticesDataPresent(h.f.TangentKind)&&(f._needUVs=!0,f.MAINUV1=!0),f._areTexturesDirty&&z.texturesEnabled&&(this._texture&&T.d.AnisotropicTextureEnabled?(0,D.L)(this._texture,f,"ANISOTROPIC_TEXTURE"):f.ANISOTROPIC_TEXTURE=!1),f._areMiscDirty&&(f.ANISOTROPIC_LEGACY=this._legacy)):(f.ANISOTROPIC=!1,f.ANISOTROPIC_TEXTURE=!1,f.ANISOTROPIC_TEXTUREDIRECTUV=0,f.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(f,z){if(!this._isEnabled)return;const w=this._material.isFrozen;f.useUbo&&w&&f.isSync||(this._texture&&T.d.AnisotropicTextureEnabled&&(f.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,D.p)(this._texture,f,"anisotropy")),f.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Dl)),z.texturesEnabled&&this._texture&&T.d.AnisotropicTextureEnabled&&f.setTexture("anisotropySampler",this._texture)}hasTexture(f){return this._texture===f}getActiveTextures(f){this._texture&&f.push(this._texture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture)}dispose(f){f&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(f,z,w){return f.ANISOTROPIC&&z.addFallback(w++,"ANISOTROPIC"),w}getSamplers(f){f.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(f,z,w){super.parse(f,z,w),void 0===f.legacy&&(this.legacy=!0)}}(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,S.b)([(0,C.O)()],P.prototype,"intensity",void 0),(0,S.b)([(0,C.I)()],P.prototype,"direction",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsMiscDirty")],P.prototype,"legacy",void 0);class R extends X.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class q extends K.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"Sheen",120,new R,z),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Dl=1,this.color=O.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,z){if(!this._isEnabled)return!0;if(f._areTexturesDirty&&z.texturesEnabled){if(this._texture&&T.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,z){this._isEnabled?(f.SHEEN=!0,f.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,f.SHEEN_ROUGHNESS=null!==this._roughness,f.SHEEN_ALBEDOSCALING=this._albedoScaling,f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,f._areTexturesDirty&&z.texturesEnabled&&(this._texture&&T.d.SheenTextureEnabled?((0,D.L)(this._texture,f,"SHEEN_TEXTURE"),f.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):f.SHEEN_TEXTURE=!1,this._textureRoughness&&T.d.SheenTextureEnabled?(0,D.L)(this._textureRoughness,f,"SHEEN_TEXTURE_ROUGHNESS"):f.SHEEN_TEXTURE_ROUGHNESS=!1)):(f.SHEEN=!1,f.SHEEN_TEXTURE=!1,f.SHEEN_TEXTURE_ROUGHNESS=!1,f.SHEEN_LINKWITHALBEDO=!1,f.SHEEN_ROUGHNESS=!1,f.SHEEN_ALBEDOSCALING=!1,f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,f.SHEEN_GAMMATEXTURE=!1,f.SHEEN_TEXTUREDIRECTUV=0,f.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(f,z,w,S){if(!this._isEnabled)return;const C=S.materialDefines,E=this._material.isFrozen;if(!f.useUbo||!E||!f.isSync){var F,J,x,u;if((this._texture||this._textureRoughness)&&T.d.SheenTextureEnabled)f.updateFloat4("vSheenInfos",(null===(F=this._texture)||void 0===F?void 0:F.coordinatesIndex)??0,(null===(J=this._texture)||void 0===J?void 0:J.level)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(u=this._textureRoughness)||void 0===u?void 0:u.level)??0),this._texture&&(0,D.p)(this._texture,f,"sheen"),this._textureRoughness&&!C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.p)(this._textureRoughness,f,"sheenRoughness");f.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Dl),null!==this._roughness&&f.updateFloat("vSheenRoughness",this._roughness)}z.texturesEnabled&&(this._texture&&T.d.SheenTextureEnabled&&f.setTexture("sheenSampler",this._texture),this._textureRoughness&&!C.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.d.SheenTextureEnabled&&f.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(f){return this._texture===f||this._textureRoughness===f}getActiveTextures(f){this._texture&&f.push(this._texture),this._textureRoughness&&f.push(this._textureRoughness)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&f.push(this._textureRoughness)}dispose(f){var z,w;f&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(w=this._textureRoughness)||void 0===w||w.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(f,z,w){return f.SHEEN&&z.addFallback(w++,"SHEEN"),w}getSamplers(f){f.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isEnabled",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"linkSheenWithAlbedo",void 0),(0,S.b)([(0,C.O)()],q.prototype,"intensity",void 0),(0,S.b)([(0,C.n)()],q.prototype,"color",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"texture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMainTexture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"roughness",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"textureRoughness",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"albedoScaling",void 0);class a extends X.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class s extends K.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(f){this._scene.enableSubSurfaceForPrePass()&&f&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(f))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(f){this._volumeIndexOfRefraction=f>=1?f:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRSubSurface",130,new a,z),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=O.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=O.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=f.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=f._dirtyCallbacks[32]}isReadyForSubMesh(f,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(f._areTexturesDirty&&z.texturesEnabled){if(this._thicknessTexture&&T.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&T.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&T.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const f=this._getRefractionTexture(z);if(f&&T.d.RefractionTextureEnabled&&!f.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return f.SUBSURFACE=!1,f.SS_DISPERSION=!1,f.SS_TRANSLUCENCY=!1,f.SS_SCATTERING=!1,f.SS_REFRACTION=!1,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_THICKNESSANDMASK_TEXTURE=!1,f.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,f.SS_HAS_THICKNESS=!1,f.SS_REFRACTIONINTENSITY_TEXTURE=!1,f.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,f.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,f.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,f.SS_REFRACTIONMAP_3D=!1,f.SS_REFRACTIONMAP_OPPOSITEZ=!1,f.SS_LODINREFRACTIONALPHA=!1,f.SS_GAMMAREFRACTION=!1,f.SS_RGBDREFRACTION=!1,f.SS_LINEARSPECULARREFRACTION=!1,f.SS_LINKREFRACTIONTOTRANSPARENCY=!1,f.SS_ALBEDOFORREFRACTIONTINT=!1,f.SS_ALBEDOFORTRANSLUCENCYTINT=!1,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,f.SS_USE_THICKNESS_AS_DEPTH=!1,f.SS_USE_GLTF_TEXTURES=!1,f.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(f.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(f._areTexturesDirty){if(f.SUBSURFACE=!0,f.SS_DISPERSION=this._isDispersionEnabled,f.SS_TRANSLUCENCY=this._isTranslucencyEnabled,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_SCATTERING=this._isScatteringEnabled,f.SS_THICKNESSANDMASK_TEXTURE=!1,f.SS_REFRACTIONINTENSITY_TEXTURE=!1,f.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,f.SS_HAS_THICKNESS=!1,f.SS_USE_GLTF_TEXTURES=!1,f.SS_REFRACTION=!1,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_REFRACTIONMAP_3D=!1,f.SS_GAMMAREFRACTION=!1,f.SS_RGBDREFRACTION=!1,f.SS_LINEARSPECULARREFRACTION=!1,f.SS_REFRACTIONMAP_OPPOSITEZ=!1,f.SS_LODINREFRACTIONALPHA=!1,f.SS_LINKREFRACTIONTOTRANSPARENCY=!1,f.SS_ALBEDOFORREFRACTIONTINT=!1,f.SS_ALBEDOFORTRANSLUCENCYTINT=!1,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,f.SS_USE_THICKNESS_AS_DEPTH=!1,f.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,f._areTexturesDirty&&z.texturesEnabled&&(this._thicknessTexture&&T.d.ThicknessTextureEnabled&&(0,D.L)(this._thicknessTexture,f,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&T.d.RefractionIntensityTextureEnabled&&(0,D.L)(this._refractionIntensityTexture,f,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&T.d.TranslucencyIntensityTextureEnabled&&(0,D.L)(this._translucencyIntensityTexture,f,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&T.d.TranslucencyColorTextureEnabled&&(0,D.L)(this._translucencyColorTexture,f,"SS_TRANSLUCENCYCOLOR_TEXTURE")),f.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,f.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&z.texturesEnabled){const w=this._getRefractionTexture(z);w&&T.d.RefractionTextureEnabled&&(f.SS_REFRACTION=!0,f.SS_REFRACTIONMAP_3D=w.isCube,f.SS_GAMMAREFRACTION=w.gammaSpace,f.SS_RGBDREFRACTION=w.isRGBD,f.SS_LINEARSPECULARREFRACTION=w.linearSpecularLOD,f.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&w.isCube?!w.invertZ:w.invertZ,f.SS_LODINREFRACTIONALPHA=w.lodLevelInAlpha,f.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,f.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=w.isCube&&w.boundingBoxSize,f.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(f.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(f,z,w,S){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)f.updateFloat2("vThicknessParam",0,0);else{S.getRenderingMesh().getWorldMatrix().decompose(u.j.ek[0]);const z=Math.max(Math.abs(u.j.ek[0].x),Math.abs(u.j.ek[0].y),Math.abs(u.j.ek[0].z));f.updateFloat2("vThicknessParam",this.minimumThickness*z,(this.maximumThickness-this.minimumThickness)*z)}}bindForSubMesh(f,z,w,S){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const C=S.materialDefines,E=this._material.isFrozen,F=this._material.realTimeFiltering,J=C.LODBASEDMICROSFURACE,x=this._getRefractionTexture(z);if(!f.useUbo||!E||!f.isSync){if(this._thicknessTexture&&T.d.ThicknessTextureEnabled&&(f.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,D.p)(this._thicknessTexture,f,"thickness")),this._refractionIntensityTexture&&T.d.RefractionIntensityTextureEnabled&&C.SS_REFRACTIONINTENSITY_TEXTURE&&(f.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,D.p)(this._refractionIntensityTexture,f,"refractionIntensity")),this._translucencyColorTexture&&T.d.TranslucencyColorTextureEnabled&&C.SS_TRANSLUCENCYCOLOR_TEXTURE&&(f.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,D.p)(this._translucencyColorTexture,f,"translucencyColor")),this._translucencyIntensityTexture&&T.d.TranslucencyIntensityTextureEnabled&&C.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(f.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,D.p)(this._translucencyIntensityTexture,f,"translucencyIntensity")),x&&T.d.RefractionTextureEnabled){f.rk("refractionMatrix",x.getRefractionTextureMatrix());let z=1;x.isCube||x.depth&&(z=x.depth);const w=x.getSize().width,S=this.volumeIndexOfRefraction;if(f.updateFloat4("vRefractionInfos",x.level,1/S,z,this._invertRefractionY?-1:1),f.updateFloat4("vRefractionMicrosurfaceInfos",w,x.lodGenerationScale,x.lodGenerationOffset,1/this.indexOfRefraction),F&&f.updateFloat2("vRefractionFilteringInfo",w,Math.log2(w)),x.boundingBoxSize){const z=x;f.updateVector3("vRefractionPosition",z.boundingBoxPosition),f.updateVector3("vRefractionSize",z.boundingBoxSize)}}this._isScatteringEnabled&&f.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),f.updateColor3("vDiffusionDistance",this.diffusionDistance),f.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),f.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),f.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),f.updateFloat("dispersion",this.dispersion)}z.texturesEnabled&&(this._thicknessTexture&&T.d.ThicknessTextureEnabled&&f.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&T.d.RefractionIntensityTextureEnabled&&C.SS_REFRACTIONINTENSITY_TEXTURE&&f.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&T.d.TranslucencyIntensityTextureEnabled&&C.SS_TRANSLUCENCYINTENSITY_TEXTURE&&f.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&T.d.TranslucencyColorTextureEnabled&&C.SS_TRANSLUCENCYCOLOR_TEXTURE&&f.setTexture("translucencyColorSampler",this._translucencyColorTexture),x&&T.d.RefractionTextureEnabled&&(J?f.setTexture("refractionSampler",x):(f.setTexture("refractionSampler",x._lodTextureMid||x),f.setTexture("refractionSamplerLow",x._lodTextureLow||x),f.setTexture("refractionSamplerHigh",x._lodTextureHigh||x))))}_getRefractionTexture(f){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?f.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(f){T.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&f.push(this._refractionTexture)}hasTexture(f){return this._thicknessTexture===f||(this._refractionTexture===f||(this._refractionIntensityTexture===f||(this._translucencyIntensityTexture===f||this._translucencyColorTexture===f)))}hasRenderTargetTextures(){return!!(T.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(f){this._thicknessTexture&&f.push(this._thicknessTexture),this._refractionTexture&&f.push(this._refractionTexture),this._translucencyColorTexture&&f.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&f.push(this._translucencyIntensityTexture)}getAnimatables(f){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&f.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&f.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&f.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&f.push(this._translucencyIntensityTexture)}dispose(f){f&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(f,z,w){return f.SS_SCATTERING&&z.addFallback(w++,"SS_SCATTERING"),f.SS_TRANSLUCENCY&&z.addFallback(w++,"SS_TRANSLUCENCY"),w}getSamplers(f){f.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isRefractionEnabled",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isTranslucencyEnabled",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isDispersionEnabled",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markScenePrePassDirty")],s.prototype,"isScatteringEnabled",void 0),(0,S.b)([(0,C.O)()],s.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,S.b)([(0,C.O)()],s.prototype,"refractionIntensity",void 0),(0,S.b)([(0,C.O)()],s.prototype,"translucencyIntensity",void 0),(0,S.b)([(0,C.O)()],s.prototype,"useAlbedoToTintRefraction",void 0),(0,S.b)([(0,C.O)()],s.prototype,"useAlbedoToTintTranslucency",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionTexture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,C.O)()],s.prototype,"_volumeIndexOfRefraction",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"volumeIndexOfRefraction",null),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertRefractionY",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"linkRefractionWithTransparency",void 0),(0,S.b)([(0,C.O)()],s.prototype,"minimumThickness",void 0),(0,S.b)([(0,C.O)()],s.prototype,"maximumThickness",void 0),(0,S.b)([(0,C.O)()],s.prototype,"useThicknessAsDepth",void 0),(0,S.b)([(0,C.n)()],s.prototype,"tintColor",void 0),(0,S.b)([(0,C.O)()],s.prototype,"tintColorAtDistance",void 0),(0,S.b)([(0,C.O)()],s.prototype,"dispersion",void 0),(0,S.b)([(0,C.n)()],s.prototype,"diffusionDistance",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useMaskFromThicknessTexture",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionIntensityTexture",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyIntensityTexture",void 0),(0,S.b)([(0,C.n)()],s.prototype,"translucencyColor",void 0),(0,S.b)([(0,C.H)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyColorTexture",void 0),(0,S.b)([(0,C.O)(),(0,C.e)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useGltfStyleTextures",void 0);var H=w(12083),L=w(901),U=w(12094);const i={effect:null,subMesh:null};class m extends X.b{constructor(f){super(f),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class r extends V.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(f){this._realTimeFiltering=f,this.ak(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(f){this._realTimeFilteringQuality=f,this.ak(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=f||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(f,z){super(f,z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||r.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new u.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=O.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new O.d(0,0,0),this._albedoColor=new O.d(1,1,1),this._reflectivityColor=new O.d(1,1,1),this._reflectionColor=new O.d(1,1,1),this._emissiveColor=new O.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=r.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new F.h(16),this._globalAmbientColor=new O.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new y(this),this.clearCoat=new M(this),this.iridescence=new I(this),this.anisotropy=new P(this),this.sheen=new q(this),this.subSurface=new s(this),this.detailMap=new H.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),T.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,J.c)(this.va()),this.prePassConfiguration=new e.c}get hasRenderTargetTextures(){return!!(T.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var f;return this._transparencyMode===r.PBRMATERIAL_OPAQUE||this._transparencyMode===r.PBRMATERIAL_ALPHATEST||(null===(f=this.subSurface)||void 0===f?void 0:f.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var f;return!!this._forceAlphaTest||(null===(f=this.subSurface)||void 0===f||!f.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===r.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.xi&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==r.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.xi||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(f,z,w){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const S=z._drawWrapper;if(S.effect&&this.isFrozen&&S._wasPreviouslyReady&&S._wasPreviouslyUsingInstances===w)return!0;z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),z.materialDefines=new m(this._eventInfo.defineNames));const C=z.materialDefines;if(this._isReadyForSubMesh(z))return!0;const F=this.va(),J=F.getEngine();if(C._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F.texturesEnabled)){if(this._albedoTexture&&T.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&T.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&T.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const f=this._getReflectionTexture();if(f&&T.d.ReflectionTextureEnabled){if(!f.isReadyOrNotBlocking())return!1;var x;if(f.irradianceTexture){if(!f.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!f.sphericalPolynomial&&null!==(x=f.getInternalTexture())&&void 0!==x&&x._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&T.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&T.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(T.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(J.getCaps().standardDerivatives&&this._bumpTexture&&T.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&T.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=C,this._eventInfo.subMesh=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(C._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;J.getCaps().standardDerivatives||f.isVerticesDataPresent(h.f.NormalKind)||(f.createNormals(!0),E.b.Warn("PBRMaterial: Normals have been created for the mesh: "+f.name));const u=z.effect,X=C._areLightsDisposed;let K=this._prepareEffect(f,C,this.onCompiled,this.onError,w,null,z.getRenderingMesh().hasThinInstances),c=!1;if(K)if(this._onEffectCreatedObservable&&(i.effect=K,i.subMesh=z,this._onEffectCreatedObservable.notifyObservers(i)),this.allowShaderHotSwapping&&u&&!K.isReady()){if(K=u,C.markAsUnprocessed(),c=this.isFrozen,X)return C._areLightsDisposed=!0,!1}else F.resetCachedMaterial(),z.setEffect(K,C,this._materialContext);return!(!z.effect||!z.effect.isReady())&&(C._renderId=F.getRenderId(),S._wasPreviouslyReady=!c,S._wasPreviouslyUsingInstances=!!w,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(f,z){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(f,z,E,F,J),!z.isDirty)return null;z.markAsProcessed();const x=this.va().getEngine(),u=new v.e;let X=0;z.USESPHERICALINVERTEX&&u.addFallback(X++,"USESPHERICALINVERTEX"),z.FOG&&u.addFallback(X,"FOG"),z.SPECULARAA&&u.addFallback(X,"SPECULARAA"),z.POINTSIZE&&u.addFallback(X,"POINTSIZE"),z.LOGARITHMICDEPTH&&u.addFallback(X,"LOGARITHMICDEPTH"),z.PARALLAX&&u.addFallback(X,"PARALLAX"),z.PARALLAX_RHS&&u.addFallback(X,"PARALLAX_RHS"),z.PARALLAXOCCLUSION&&u.addFallback(X++,"PARALLAXOCCLUSION"),z.ENVIRONMENTBRDF&&u.addFallback(X++,"ENVIRONMENTBRDF"),z.TANGENT&&u.addFallback(X++,"TANGENT"),z.BUMP&&u.addFallback(X++,"BUMP"),X=(0,D.r)(z,u,this._maxSimultaneousLights,X++),z.SPECULARTERM&&u.addFallback(X++,"SPECULARTERM"),z.USESPHERICALFROMREFLECTIONMAP&&u.addFallback(X++,"USESPHERICALFROMREFLECTIONMAP"),z.USEIRRADIANCEMAP&&u.addFallback(X++,"USEIRRADIANCEMAP"),z.LIGHTMAP&&u.addFallback(X++,"LIGHTMAP"),z.NORMAL&&u.addFallback(X++,"NORMAL"),z.AMBIENT&&u.addFallback(X++,"AMBIENT"),z.EMISSIVE&&u.addFallback(X++,"EMISSIVE"),z.VERTEXCOLOR&&u.addFallback(X++,"VERTEXCOLOR"),z.MORPHTARGETS&&u.addFallback(X++,"MORPHTARGETS"),z.MULTIVIEW&&u.addFallback(0,"MULTIVIEW");const K=[h.f.PositionKind];z.NORMAL&&K.push(h.f.NormalKind),z.TANGENT&&K.push(h.f.TangentKind);for(let w=1;w<=6;++w)z["UV"+w]&&K.push(`uv${1===w?"":w}`);z.VERTEXCOLOR&&K.push(h.f.ColorKind),(0,D.u)(K,f,z,u),(0,D.y)(K,z),(0,D.A)(K,f,z),(0,D.s)(K,f,z);let c="pbr";const y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],O=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],B=["Material","Scene","Mesh"],V={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=u,this._eventInfo.fallbackRank=X,this._eventInfo.defines=z,this._eventInfo.uniforms=y,this._eventInfo.attributes=K,this._eventInfo.samplers=O,this._eventInfo.uniformBuffersNames=B,this._eventInfo.customCode=void 0,this._eventInfo.mesh=f,this._eventInfo.indexParameters=V,this._callbackPluginEventGeneric(128,this._eventInfo),U.d.AddUniformsAndSamplers(y,O),e.c.AddUniforms(y),e.c.AddSamplers(O),(0,L.c)(y),d.c&&(d.c.PrepareUniforms(y,z),d.c.PrepareSamplers(O,z)),(0,D._)({uniformsNames:y,uniformBuffersNames:B,samplers:O,defines:z,maxSimultaneousLights:this._maxSimultaneousLights});const W={};this.customShaderNameResolve&&(c=this.customShaderNameResolve(c,y,B,O,z,K,W));const T=z.toString(),A=x.createEffect(c,{attributes:K,uniformsNames:y,uniformBuffersNames:B,samplers:O,defines:T,fallbacks:u,onCompiled:S,onError:C,indexParameters:V,processFinalCode:W.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([w.e(40),w.e(49)]).then(w.bind(w,13692)),Promise.all([w.e(41),w.e(50)]).then(w.bind(w,13703))]):await Promise.all([Promise.all([w.e(44),w.e(51)]).then(w.bind(w,13708)),Promise.all([w.e(46),w.e(52)]).then(w.bind(w,13726))]),this._shadersLoaded=!0}},x);return this._eventInfo.customCode=void 0,A}_prepareDefines(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=this.va(),F=E.getEngine();(0,D.K)(E,f,z,!0,this._maxSimultaneousLights,this._disableLighting),z._needNormals=!0,(0,D.R)(E,z);const J=this.needAlphaBlendingForMesh(f)&&this.va().useOrderIndependentTransparency;if((0,D.Z)(E,z,this.canRenderToMRT&&!J),(0,D.V)(E,z,J),U.d.PrepareDefines(F.currentRenderPassId,f,z),z.METALLICWORKFLOW=this.isMetallicWorkflow(),z._areTexturesDirty){z._needUVs=!1;for(let f=1;f<=6;++f)z["MAINUV"+f]=!1;if(E.texturesEnabled){z.ALBEDODIRECTUV=0,z.AMBIENTDIRECTUV=0,z.OPACITYDIRECTUV=0,z.EMISSIVEDIRECTUV=0,z.REFLECTIVITYDIRECTUV=0,z.MICROSURFACEMAPDIRECTUV=0,z.METALLIC_REFLECTANCEDIRECTUV=0,z.REFLECTANCEDIRECTUV=0,z.BUMPDIRECTUV=0,z.LIGHTMAPDIRECTUV=0,F.getCaps().textureLOD&&(z.LODBASEDMICROSFURACE=!0),this._albedoTexture&&T.d.DiffuseTextureEnabled?((0,D.L)(this._albedoTexture,z,"ALBEDO"),z.GAMMAALBEDO=this._albedoTexture.gammaSpace):z.ALBEDO=!1,this._ambientTexture&&T.d.AmbientTextureEnabled?((0,D.L)(this._ambientTexture,z,"AMBIENT"),z.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):z.AMBIENT=!1,this._opacityTexture&&T.d.OpacityTextureEnabled?((0,D.L)(this._opacityTexture,z,"OPACITY"),z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):z.OPACITY=!1;const f=this._getReflectionTexture();if(f&&T.d.ReflectionTextureEnabled){switch(z.REFLECTION=!0,z.GAMMAREFLECTION=f.gammaSpace,z.RGBDREFLECTION=f.isRGBD,z.LODINREFLECTIONALPHA=f.lodLevelInAlpha,z.LINEARSPECULARREFLECTION=f.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(z.NUM_SAMPLES=""+this.realTimeFilteringQuality,F._features.needTypeSuffixInShaderConstants&&(z.NUM_SAMPLES=z.NUM_SAMPLES+"u"),z.REALTIME_FILTERING=!0):z.REALTIME_FILTERING=!1,z.INVERTCUBICMAP=f.coordinatesMode===W.b.INVCUBIC_MODE,z.REFLECTIONMAP_3D=f.isCube,z.REFLECTIONMAP_OPPOSITEZ=z.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!f.invertZ:f.invertZ,z.REFLECTIONMAP_CUBIC=!1,z.REFLECTIONMAP_EXPLICIT=!1,z.REFLECTIONMAP_PLANAR=!1,z.REFLECTIONMAP_PROJECTION=!1,z.REFLECTIONMAP_SKYBOX=!1,z.REFLECTIONMAP_SPHERICAL=!1,z.REFLECTIONMAP_EQUIRECTANGULAR=!1,z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,f.coordinatesMode){case W.b.EXPLICIT_MODE:z.REFLECTIONMAP_EXPLICIT=!0;break;case W.b.PLANAR_MODE:z.REFLECTIONMAP_PLANAR=!0;break;case W.b.PROJECTION_MODE:z.REFLECTIONMAP_PROJECTION=!0;break;case W.b.SKYBOX_MODE:z.REFLECTIONMAP_SKYBOX=!0;break;case W.b.SPHERICAL_MODE:z.REFLECTIONMAP_SPHERICAL=!0;break;case W.b.EQUIRECTANGULAR_MODE:z.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case W.b.FIXED_EQUIRECTANGULAR_MODE:z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case W.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case W.b.CUBIC_MODE:case W.b.INVCUBIC_MODE:default:z.REFLECTIONMAP_CUBIC=!0,z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!f.boundingBoxSize}f.coordinatesMode!==W.b.SKYBOX_MODE&&(f.irradianceTexture?(z.USEIRRADIANCEMAP=!0,z.USESPHERICALFROMREFLECTIONMAP=!1):f.isCube&&(z.USESPHERICALFROMREFLECTIONMAP=!0,z.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||F.getCaps().maxVaryingVectors<=8?z.USESPHERICALINVERTEX=!1:z.USESPHERICALINVERTEX=!0))}else z.REFLECTION=!1,z.REFLECTIONMAP_3D=!1,z.REFLECTIONMAP_SPHERICAL=!1,z.REFLECTIONMAP_PLANAR=!1,z.REFLECTIONMAP_CUBIC=!1,z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,z.REFLECTIONMAP_PROJECTION=!1,z.REFLECTIONMAP_SKYBOX=!1,z.REFLECTIONMAP_EXPLICIT=!1,z.REFLECTIONMAP_EQUIRECTANGULAR=!1,z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,z.INVERTCUBICMAP=!1,z.USESPHERICALFROMREFLECTIONMAP=!1,z.USEIRRADIANCEMAP=!1,z.USESPHERICALINVERTEX=!1,z.REFLECTIONMAP_OPPOSITEZ=!1,z.LODINREFLECTIONALPHA=!1,z.GAMMAREFLECTION=!1,z.RGBDREFLECTION=!1,z.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&T.d.LightmapTextureEnabled?((0,D.L)(this._lightmapTexture,z,"LIGHTMAP"),z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,z.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):z.LIGHTMAP=!1,this._emissiveTexture&&T.d.EmissiveTextureEnabled?((0,D.L)(this._emissiveTexture,z,"EMISSIVE"),z.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):z.EMISSIVE=!1,T.d.SpecularTextureEnabled?(this._metallicTexture?((0,D.L)(this._metallicTexture,z,"REFLECTIVITY"),z.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,z.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,z.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,z.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,z.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,D.L)(this._reflectivityTexture,z,"REFLECTIVITY"),z.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,z.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,z.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):z.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(z.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,D.L)(this._metallicReflectanceTexture,z,"METALLIC_REFLECTANCE"),z.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):z.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,D.L)(this._reflectanceTexture,z,"REFLECTANCE"),z.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):z.REFLECTANCE=!1):(z.METALLIC_REFLECTANCE=!1,z.REFLECTANCE=!1),this._microSurfaceTexture?(0,D.L)(this._microSurfaceTexture,z,"MICROSURFACEMAP"):z.MICROSURFACEMAP=!1):(z.REFLECTIVITY=!1,z.MICROSURFACEMAP=!1),F.getCaps().standardDerivatives&&this._bumpTexture&&T.d.BumpTextureEnabled&&!this._disableBumpMap?((0,D.L)(this._bumpTexture,z,"BUMP"),this._useParallax&&this._albedoTexture&&T.d.DiffuseTextureEnabled?(z.PARALLAX=!0,z.PARALLAX_RHS=E.useRightHandedSystem,z.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):z.PARALLAX=!1,z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(z.BUMP=!1,z.PARALLAX=!1,z.PARALLAX_RHS=!1,z.PARALLAXOCCLUSION=!1,z.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&T.d.ReflectionTextureEnabled?(z.ENVIRONMENTBRDF=!0,z.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(z.ENVIRONMENTBRDF=!1,z.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?z.ALPHAFROMALBEDO=!0:z.ALPHAFROMALBEDO=!1}z.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===r.LIGHTFALLOFF_STANDARD?(z.USEPHYSICALLIGHTFALLOFF=!1,z.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===r.LIGHTFALLOFF_GLTF?(z.USEPHYSICALLIGHTFALLOFF=!1,z.USEGLTFLIGHTFALLOFF=!0):(z.USEPHYSICALLIGHTFALLOFF=!0,z.USEGLTFLIGHTFALLOFF=!1),z.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.mk&&this._twoSidedLighting?z.TWOSIDEDLIGHTING=!0:z.TWOSIDEDLIGHTING=!1,z.SPECULARAA=F.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(z._areTexturesDirty||z._areMiscDirty)&&(z.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,z.ALPHABLEND=this.needAlphaBlendingForMesh(f),z.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,z.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),z._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(z),z.FORCENORMALFORWARD=this._forceNormalForward,z.RADIANCEOCCLUSION=this._useRadianceOcclusion,z.HORIZONOCCLUSION=this._useHorizonOcclusion,z._areMiscDirty&&((0,D.N)(f,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(f)||this._forceAlphaTest,z,this._applyDecalMapAfterDetailMap),z.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!f.isVerticesDataPresent(h.f.NormalKind),z.DEBUGMODE=this._debugMode),(0,D.G)(E,F,this,z,!!w,S,C),this._eventInfo.defines=z,this._eventInfo.mesh=f,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,D.D)(f,z,!0,!0,!0,this._transparencyMode!==r.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(f,z,w){const S={clipPlane:!1,useInstances:!1,...w};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const w=new m(this._eventInfo.defineNames),C=this._prepareEffect(f,w,void 0,void 0,S.useInstances,S.clipPlane,f.hasThinInstances);this._onEffectCreatedObservable&&(i.effect=C,i.subMesh=null,this._onEffectCreatedObservable.notifyObservers(i)),C.isReady()?z&&z(this):C.onCompileObservable.add((()=>{z&&z(this)}))})()}buildUniformLayout(){const f=this._uniformBuffer;f.addUniform("vAlbedoInfos",2),f.addUniform("vAmbientInfos",4),f.addUniform("vOpacityInfos",2),f.addUniform("vEmissiveInfos",2),f.addUniform("vLightmapInfos",2),f.addUniform("vReflectivityInfos",3),f.addUniform("vMicroSurfaceSamplerInfos",2),f.addUniform("vReflectionInfos",2),f.addUniform("vReflectionFilteringInfo",2),f.addUniform("vReflectionPosition",3),f.addUniform("vReflectionSize",3),f.addUniform("vBumpInfos",3),f.addUniform("albedoMatrix",16),f.addUniform("ambientMatrix",16),f.addUniform("opacityMatrix",16),f.addUniform("emissiveMatrix",16),f.addUniform("lightmapMatrix",16),f.addUniform("reflectivityMatrix",16),f.addUniform("microSurfaceSamplerMatrix",16),f.addUniform("bumpMatrix",16),f.addUniform("vTangentSpaceParams",2),f.addUniform("reflectionMatrix",16),f.addUniform("vReflectionColor",3),f.addUniform("vAlbedoColor",4),f.addUniform("vLightingIntensity",4),f.addUniform("vReflectionMicrosurfaceInfos",3),f.addUniform("pointSize",1),f.addUniform("vReflectivityColor",4),f.addUniform("vEmissiveColor",3),f.addUniform("vAmbientColor",3),f.addUniform("vDebugMode",2),f.addUniform("vMetallicReflectanceFactors",4),f.addUniform("vMetallicReflectanceInfos",2),f.addUniform("metallicReflectanceMatrix",16),f.addUniform("vReflectanceInfos",2),f.addUniform("reflectanceMatrix",16),f.addUniform("vSphericalL00",3),f.addUniform("vSphericalL1_1",3),f.addUniform("vSphericalL10",3),f.addUniform("vSphericalL11",3),f.addUniform("vSphericalL2_2",3),f.addUniform("vSphericalL2_1",3),f.addUniform("vSphericalL20",3),f.addUniform("vSphericalL21",3),f.addUniform("vSphericalL22",3),f.addUniform("vSphericalX",3),f.addUniform("vSphericalY",3),f.addUniform("vSphericalZ",3),f.addUniform("vSphericalXX_ZZ",3),f.addUniform("vSphericalYY_ZZ",3),f.addUniform("vSphericalZZ",3),f.addUniform("vSphericalXY",3),f.addUniform("vSphericalYZ",3),f.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(f,z,w){const S=this.va(),C=w.materialDefines;if(!C)return;const E=w.effect;if(!E)return;this._activeEffect=E,z.getMeshUniformBuffer().bindToEffect(E,"Mesh"),z.transferToEffect(f);const F=S.getEngine();this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,z,f,this.isFrozen),U.d.Bind(F.currentRenderPassId,this._activeEffect,z,f),this._eventInfo.subMesh=w,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),C.OBJECTSPACE_NORMALMAP&&(f.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const J=this._mustRebind(S,E,w,z.visibility);(0,D.b)(z,this._activeEffect,this.prePassConfiguration);let u=null;const h=this._uniformBuffer;if(J){if(this.bindViewProjection(E),u=this._getReflectionTexture(),!h.useUbo||!this.isFrozen||!h.isSync||w._drawWrapper._forceRebindOnNextCall){var X;if(S.texturesEnabled){if(this._albedoTexture&&T.d.DiffuseTextureEnabled&&(h.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,D.p)(this._albedoTexture,h,"albedo")),this._ambientTexture&&T.d.AmbientTextureEnabled&&(h.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,D.p)(this._ambientTexture,h,"ambient")),this._opacityTexture&&T.d.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,D.p)(this._opacityTexture,h,"opacity")),u&&T.d.ReflectionTextureEnabled){if(h.rk("reflectionMatrix",u.getReflectionTextureMatrix()),h.updateFloat2("vReflectionInfos",u.level,0),u.boundingBoxSize){const f=u;h.updateVector3("vReflectionPosition",f.boundingBoxPosition),h.updateVector3("vReflectionSize",f.boundingBoxSize)}if(this.realTimeFiltering){const f=u.getSize().width;h.updateFloat2("vReflectionFilteringInfo",f,Math.log2(f))}if(!C.USEIRRADIANCEMAP){const f=u.sphericalPolynomial;if(C.USESPHERICALFROMREFLECTIONMAP&&f)if(C.SPHERICAL_HARMONICS){const z=f.preScaledHarmonics;h.updateVector3("vSphericalL00",z.l00),h.updateVector3("vSphericalL1_1",z.l1_1),h.updateVector3("vSphericalL10",z.l10),h.updateVector3("vSphericalL11",z.l11),h.updateVector3("vSphericalL2_2",z.l2_2),h.updateVector3("vSphericalL2_1",z.l2_1),h.updateVector3("vSphericalL20",z.l20),h.updateVector3("vSphericalL21",z.l21),h.updateVector3("vSphericalL22",z.l22)}else h.updateFloat3("vSphericalX",f.x.x,f.x.y,f.x.z),h.updateFloat3("vSphericalY",f.y.x,f.y.y,f.y.z),h.updateFloat3("vSphericalZ",f.z.x,f.z.y,f.z.z),h.updateFloat3("vSphericalXX_ZZ",f.xx.x-f.zz.x,f.xx.y-f.zz.y,f.xx.z-f.zz.z),h.updateFloat3("vSphericalYY_ZZ",f.yy.x-f.zz.x,f.yy.y-f.zz.y,f.yy.z-f.zz.z),h.updateFloat3("vSphericalZZ",f.zz.x,f.zz.y,f.zz.z),h.updateFloat3("vSphericalXY",f.xy.x,f.xy.y,f.xy.z),h.updateFloat3("vSphericalYZ",f.yz.x,f.yz.y,f.yz.z),h.updateFloat3("vSphericalZX",f.zx.x,f.zx.y,f.zx.z)}h.updateFloat3("vReflectionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}this._emissiveTexture&&T.d.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,D.p)(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&T.d.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,D.p)(this._lightmapTexture,h,"lightmap")),T.d.SpecularTextureEnabled&&(this._metallicTexture?(h.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,D.p)(this._metallicTexture,h,"reflectivity")):this._reflectivityTexture&&(h.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,D.p)(this._reflectivityTexture,h,"reflectivity")),this._metallicReflectanceTexture&&(h.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,D.p)(this._metallicReflectanceTexture,h,"metallicReflectance")),this._reflectanceTexture&&C.REFLECTANCE&&(h.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,D.p)(this._reflectanceTexture,h,"reflectance")),this._microSurfaceTexture&&(h.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,D.p)(this._microSurfaceTexture,h,"microSurfaceSampler"))),this._bumpTexture&&F.getCaps().standardDerivatives&&T.d.BumpTextureEnabled&&!this._disableBumpMap&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,D.p)(this._bumpTexture,h,"bump"),S._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),C.METALLICWORKFLOW){var K;O.i.uk[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,O.i.uk[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,h.updateColor4("vReflectivityColor",O.i.uk[0],1);const f=(null===(K=this.subSurface)||void 0===K?void 0:K._indexOfRefraction)??1.5,z=1,w=Math.pow((f-z)/(f+z),2);this._metallicReflectanceColor.scaleToRef(w*this._metallicF0Factor,O.i.uk[0]);const S=this._metallicF0Factor;h.updateColor4("vMetallicReflectanceFactors",O.i.uk[0],S)}else h.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);h.updateColor3("vEmissiveColor",T.d.EmissiveTextureEnabled?this._emissiveColor:O.d.BlackReadOnly),h.updateColor3("vReflectionColor",this._reflectionColor),!C.SS_REFRACTION&&null!==(X=this.subSurface)&&void 0!==X&&X._linkRefractionWithTransparency?h.updateColor4("vAlbedoColor",this._albedoColor,1):h.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*S.environmentIntensity,this._lightingInfos.w=this._specularIntensity,h.updateVector4("vLightingIntensity",this._lightingInfos),S.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),h.updateColor3("vAmbientColor",this._globalAmbientColor),h.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}S.texturesEnabled&&(this._albedoTexture&&T.d.DiffuseTextureEnabled&&h.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&T.d.AmbientTextureEnabled&&h.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&T.d.OpacityTextureEnabled&&h.setTexture("opacitySampler",this._opacityTexture),u&&T.d.ReflectionTextureEnabled&&(C.LODBASEDMICROSFURACE?h.setTexture("reflectionSampler",u):(h.setTexture("reflectionSampler",u._lodTextureMid||u),h.setTexture("reflectionSamplerLow",u._lodTextureLow||u),h.setTexture("reflectionSamplerHigh",u._lodTextureHigh||u)),C.USEIRRADIANCEMAP&&h.setTexture("irradianceSampler",u.irradianceTexture)),C.ENVIRONMENTBRDF&&h.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&T.d.EmissiveTextureEnabled&&h.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&T.d.LightmapTextureEnabled&&h.setTexture("lightmapSampler",this._lightmapTexture),T.d.SpecularTextureEnabled&&(this._metallicTexture?h.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&h.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&h.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&C.REFLECTANCE&&h.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&h.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&F.getCaps().standardDerivatives&&T.d.BumpTextureEnabled&&!this._disableBumpMap&&h.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(z)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=w,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,L.g)(this._activeEffect,this,S),this.bindEyePosition(E)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(J||!this.isFrozen){var c;if(S.lightsEnabled&&!this._disableLighting&&(0,D.g)(S,z,this._activeEffect,C,this._maxSimultaneousLights),(S.fogEnabled&&z.applyFog&&S.fogMode!==x.c.FOGMODE_NONE||u||this.subSurface.refractionTexture||z.receiveShadows||C.PREPASS)&&this.bindView(E),(0,D.d)(S,z,this._activeEffect,!0),C.NUM_MORPH_INFLUENCERS&&(0,D.l)(z,this._activeEffect),C.BAKED_VERTEX_ANIMATION_TEXTURE)null===(c=z.bakedVertexAnimationManager)||void 0===c||c.bind(E,C.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,D.h)(C,this._activeEffect,S)}this._afterBind(z,this._activeEffect,w),h.update()}getAnimatables(){const f=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&f.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&f.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&f.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&f.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&f.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?f.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&f.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&f.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&f.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&f.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&f.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&f.push(this._microSurfaceTexture),f}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const f=super.getActiveTextures();return this._albedoTexture&&f.push(this._albedoTexture),this._ambientTexture&&f.push(this._ambientTexture),this._opacityTexture&&f.push(this._opacityTexture),this._reflectionTexture&&f.push(this._reflectionTexture),this._emissiveTexture&&f.push(this._emissiveTexture),this._reflectivityTexture&&f.push(this._reflectivityTexture),this._metallicTexture&&f.push(this._metallicTexture),this._metallicReflectanceTexture&&f.push(this._metallicReflectanceTexture),this._reflectanceTexture&&f.push(this._reflectanceTexture),this._microSurfaceTexture&&f.push(this._microSurfaceTexture),this._bumpTexture&&f.push(this._bumpTexture),this._lightmapTexture&&f.push(this._lightmapTexture),f}hasTexture(f){return!!super.hasTexture(f)||(this._albedoTexture===f||(this._ambientTexture===f||(this._opacityTexture===f||(this._reflectionTexture===f||(this._emissiveTexture===f||(this._reflectivityTexture===f||(this._metallicTexture===f||(this._metallicReflectanceTexture===f||(this._reflectanceTexture===f||(this._microSurfaceTexture===f||(this._bumpTexture===f||this._lightmapTexture===f)))))))))))}setPrePassRenderer(){var f;if(null===(f=this.subSurface)||void 0===f||!f.isScatteringEnabled)return!1;const z=this.va().enableSubSurfaceForPrePass();return z&&(z.enabled=!0),!0}dispose(f,z){var w,S,C,E,F,J,x,u,h,X,K,c;(this._breakShaderLoadedCheck=!0,z)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(w=this._albedoTexture)||void 0===w||w.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(C=this._opacityTexture)||void 0===C||C.dispose(),null===(E=this._reflectionTexture)||void 0===E||E.dispose(),null===(F=this._emissiveTexture)||void 0===F||F.dispose(),null===(J=this._metallicTexture)||void 0===J||J.dispose(),null===(x=this._reflectivityTexture)||void 0===x||x.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(h=this._lightmapTexture)||void 0===h||h.dispose(),null===(X=this._metallicReflectanceTexture)||void 0===X||X.dispose(),null===(K=this._reflectanceTexture)||void 0===K||K.dispose(),null===(c=this._microSurfaceTexture)||void 0===c||c.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(f,z)}}r.PBRMATERIAL_OPAQUE=B.e.MATERIAL_OPAQUE,r.PBRMATERIAL_ALPHATEST=B.e.MATERIAL_ALPHATEST,r.PBRMATERIAL_ALPHABLEND=B.e.MATERIAL_ALPHABLEND,r.PBRMATERIAL_ALPHATESTANDBLEND=B.e.MATERIAL_ALPHATESTANDBLEND,r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,r.LIGHTFALLOFF_PHYSICAL=0,r.LIGHTFALLOFF_GLTF=1,r.LIGHTFALLOFF_STANDARD=2,r.ForceGLSL=!1,(0,S.b)([(0,C.x)()],r.prototype,"_imageProcessingConfiguration",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsMiscDirty")],r.prototype,"debugMode",void 0)},12697:(f,z,w)=>{"use strict";w.d(z,{b:()=>K});var S=w(692),C=w(699),E=w(535),F=w(720),J=w(2323),x=w(2321),u=w(665),h=w(527),X=w(753);w(2359);class K extends J.b{set boundingBoxSize(f){if(this._boundingBoxSize&&this._boundingBoxSize.equals(f))return;this._boundingBoxSize=f;const z=this.va();z&&z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(f){this._rotationY=f,this.setReflectionTextureMatrix(F.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(f,z,w){let S="";return f.forEach((f=>S+=f)),new K(S,z,null,w,f)}static CreateFromPrefilteredData(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=z.useDelayedTextureLoading;z.useDelayedTextureLoading=!1;const E=new K(f,z,null,!1,null,null,null,void 0,!0,w,S);return z.useDelayedTextureLoading=C,E}constructor(f,z){var w;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0;super(z),this.onLoadObservable=new h.c,this.boundingBoxPosition=F.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new F.b,this._buffer=null,this.name=f,this.url=f,this._noMipmap=C,this.xi=!1,this.isCube=!0,this._textureMatrix=F.b.Identity(),this.coordinatesMode=x.b.CUBIC_MODE;let V=null,W=null;null===S||Array.isArray(S)?(this._noMipmap=C,this._format=X,this._createPolynomials=y,V=S,this._loaderOptions=d,this._useSRGBBuffer=B,this._lodScale=e,this._lodOffset=O):(V=S.extensions??null,this._noMipmap=S.noMipmap??!1,E=S.files??null,W=S.buffer??null,this._format=S.format??5,K=S.prefiltered??!1,c=S.forcedExtension??null,this._createPolynomials=S.createPolynomials??!1,this._lodScale=S.lodScale??.8,this._lodOffset=S.lodOffset??0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,J=S.X??null,u=S.onError??null),(f||E)&&this.updateURL(f,c,J,K,u,V,null===(w=this.va())||void 0===w?void 0:w.useDelayedTextureLoading,E,W)}getClassName(){return"CubeTexture"}updateURL(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=f),this.url=f,z&&(this._forcedExtension=z);const u=f.lastIndexOf("."),h=z||(u>-1?f.substring(u).toLowerCase():""),X=0===h.indexOf(".dds"),K=0===h.indexOf(".env"),c=0===h.indexOf(".basis");if(K?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),J)this._files=J;else if(c||K||X||E||(E=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,E){for(let z=0;z<E.length;z++)this._files.push(f+E[z]);this._extensions=E}this._buffer=x,F?(this.delayLoadState=4,this._delayedOnLoad=w,this._delayedOnError=C):this._loadTexture(w,C)}delayLoad(f){4===this.delayLoadState&&(f&&(this._forcedExtension=f),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(f){var z,w;if(f.updateFlag===this._textureMatrix.updateFlag)return;f.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(w=this.va())||void 0===w||w.markAllMaterialsAsDirty(1,(f=>-1!==f.getActiveTextures().indexOf(this))));if(this._textureMatrix=f,null===(z=this.va())||void 0===z||!z.useRightHandedSystem)return;const S=F.j.ek[0],C=F.j.Quaternion[0],E=F.j.ek[1];this._textureMatrix.decompose(S,C,E),C.z*=-1,C.w*=-1,F.b.ComposeToRef(S,C,E,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var f;return null!==(f=this.va())&&void 0!==f&&f.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=this.va(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const C=()=>{var z;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(z=this.va())||void 0===z||z.markAllMaterialsAsDirty(1));f&&f()},F=(f,w)=>{this._loadingError=!0,this._errorObject={message:f,exception:w},z&&z(f,w),x.b.OnTextureLoadErrorObservable.notifyObservers(this)};var J;this._texture?this._texture.isReady?E.h.SetImmediate((()=>C())):this._texture.onLoadedObservable.add((()=>C())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,w,this._lodScale,this._lodOffset,f,F,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,w,this._files,this._noMipmap,f,F,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(J=this._texture)||void 0===J||J.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(f,z,w){const S=X.b.Parse((()=>{let S=!1;return f.prefiltered&&(S=f.prefiltered),new K(w+(f.url??f.name),z,f.extensions,!1,f.files||null,null,null,void 0,S,f.forcedExtension)}),f,z);if(f.boundingBoxPosition&&(S.boundingBoxPosition=F.n.ck(f.boundingBoxPosition)),f.boundingBoxSize&&(S.boundingBoxSize=F.n.ck(f.boundingBoxSize)),f.animations)for(let C=0;C<f.animations.length;C++){const z=f.animations[C],w=(0,u.b)("BABYLON.Animation");w&&S.animations.push(w.Parse(z))}return S}clone(){let f=0;const z=X.b.Clone((()=>{const z=new K(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return f=z.uniqueId,z}),this);return z.uniqueId=f,z}}(0,S.b)([(0,C.O)()],K.prototype,"url",void 0),(0,S.b)([(0,C.K)()],K.prototype,"boundingBoxPosition",void 0),(0,S.b)([(0,C.K)()],K.prototype,"boundingBoxSize",null),(0,S.b)([(0,C.O)("rotationY")],K.prototype,"rotationY",null),(0,S.b)([(0,C.O)("files")],K.prototype,"_files",void 0),(0,S.b)([(0,C.O)("forcedExtension")],K.prototype,"_forcedExtension",void 0),(0,S.b)([(0,C.O)("extensions")],K.prototype,"_extensions",void 0),(0,S.b)([(0,C.z)("textureMatrix")],K.prototype,"_textureMatrix",void 0),(0,S.b)([(0,C.z)("textureMatrixRefraction")],K.prototype,"_textureMatrixRefraction",void 0),x.b._CubeTextureParser=K.Parse,(0,u.f)("BABYLON.CubeTexture",K)},12893:(f,z,w)=>{"use strict";w.d(z,{c:()=>x});var S=w(548),C=w(2321),E=w(670),F=w(12186),J=w(650);F.ThinEngine.prototype.createDynamicTexture=function(f,z,w,S){const C=new J.e(this,4);return C.baseWidth=f,C.baseHeight=z,w&&(f=this.needPOTTextures?(0,E.f)(f,this._caps.maxTextureSize):f,z=this.needPOTTextures?(0,E.f)(z,this._caps.maxTextureSize):z),C.width=f,C.height=z,C.isReady=!1,C.generateMipMaps=w,C.samplingMode=S,this.updateTextureSamplingMode(S,C),this._internalTexturesCache.push(C),C},F.ThinEngine.prototype.updateDynamicTexture=function(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!f)return;const F=this._gl,J=F.TEXTURE_2D,x=this._bindTextureDirectly(J,f,!0,E);this._unpackFlipY(void 0===w?f.invertY:w),S&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const u=this._getWebGLTextureType(f.type),h=this._getInternalFormat(C||f.format),X=this._getRGBABufferInternalSizedFormat(f.type,h);F.texImage2D(J,0,X,h,u,z),f.generateMipMaps&&F.generateMipmap(J),x||this._bindTextureDirectly(J,null),S&&F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),C&&(f.format=C),f._dynamicTextureSource=z,f._premulAlpha=S,f.invertY=w||!1,f.isReady=!0};class x extends C.b{constructor(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,J=arguments.length>6?arguments[6]:void 0;const x=!w||w._isScene;super(null,x?w:null===w||void 0===w?void 0:w.Rc,x?!S:w,J,E,void 0,void 0,void 0,void 0,F),this.name=f,this.wrapU=C.b.CLAMP_ADDRESSMODE,this.wrapV=C.b.CLAMP_ADDRESSMODE,this._generateMipMaps=S;const u=this._getEngine();if(!u)return;if(z.getContext)this._canvas=z,this._ownCanvas=!1,this._texture=u.createDynamicTexture(this._canvas.width,this._canvas.height,S,E);else{this._canvas=u.createCanvas(1,1),this._ownCanvas=!0;const f=z;f.width||0===f.width?this._texture=u.createDynamicTexture(f.width,f.height,S,E):this._texture=u.createDynamicTexture(z,z,S,E)}const h=this.getSize();this._canvas.width!==h.width&&(this._canvas.width=h.width),this._canvas.height!==h.height&&(this._canvas.height=h.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(f){this._canvas.width=f.width,this._canvas.height=f.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(f.width,f.height,this._generateMipMaps,this.samplingMode)}scale(f){const z=this.getSize();z.width*=f,z.height*=f,this._recreate(z)}scaleTo(f,z){const w=this.getSize();w.width=f,w.height=z,this._recreate(w)}getContext(){return this._context}clear(f){const z=this.getSize();f&&(this._context.fillStyle=f),this._context.clearRect(0,0,z.width,z.height)}update(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===f||f,z,this._format||void 0,void 0,w)}drawText(f,z,w,S,C,E,F){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const x=this.getSize();if(E&&(this._context.fillStyle=E,this._context.fillRect(0,0,x.width,x.height)),this._context.font=S,null===z||void 0===z){const w=this._context.measureText(f);z=(x.width-w.width)/2}if(null===w||void 0===w){const f=parseInt(S.replace(/\D/g,""));w=x.height/2+f/3.65}this._context.fillStyle=C||"",this._context.fillText(f,z,w),J&&this.update(F)}dispose(){var f,z;(super.dispose(),this._ownCanvas)&&(null===(f=this._canvas)||void 0===f||null===(z=f.remove)||void 0===z||z.call(f));this._canvas=null,this._context=null}clone(){const f=this.va();if(!f)return this;const z=this.getSize(),w=new x(this.name,z,f,this._generateMipMaps);return w.xi=this.xi,w.level=this.level,w.wrapU=this.wrapU,w.wrapV=this.wrapV,w}serialize(){const f=this.va();f&&!f.isReady()&&S.b.Warn("The scene must be ready before serializing the dynamic texture");const z=super.serialize();return x._IsCanvasElement(this._canvas)&&(z.base64String=this._canvas.toDataURL()),z.invertY=this._invertY,z.samplingMode=this.samplingMode,z}static _IsCanvasElement(f){return void 0!==f.toDataURL}_rebuild(){this.update()}}},12209:(f,z,w)=>{"use strict";w.d(z,{b:()=>C});var S=w(2321);class C extends S.b{constructor(f,z,w,C,E){let F=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9?arguments[9]:void 0,X=arguments.length>10?arguments[10]:void 0;super(null,E,!F,J,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,h),this.format=C,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==u||(x=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==u||(x=1),this._texture=this._engine.createRawTexture(f,z,w,C,F,J,x,null,u,h??0,X??!1),this.wrapU=S.b.CLAMP_ADDRESSMODE,this.wrapV=S.b.CLAMP_ADDRESSMODE)}update(f){this._getEngine().updateRawTexture(this._texture,f,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const f=new C(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return f._texture=this._texture,this._texture.incrementReferences(),f}static CreateLuminanceTexture(f,z,w,S){return new C(f,z,w,1,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(f,z,w,S){return new C(f,z,w,2,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(f,z,w,S){return new C(f,z,w,0,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(f,z,w,S){return new C(f,z,w,4,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(f,z,w,S){return new C(f,z,w,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(f,z,w,S){return new C(f,z,w,5,S,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(f,z,w,E){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.b.TRILINEAR_SAMPLINGMODE;return new C(f,z,w,6,E,F,J,x,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(f,z,w,E){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:S.b.TRILINEAR_SAMPLINGMODE;return new C(f,z,w,6,E,F,J,x,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12529:(f,z,w)=>{"use strict";w.d(z,{b:()=>C});var S=w(2321);class C extends S.b{get depth(){return this._depth}constructor(f,z,w,C,E,F){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:S.b.TRILINEAR_SAMPLINGMODE,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;super(null,F,!J,x),this.format=E,this._texture=F.getEngine().createRawTexture2DArray(f,z,w,C,E,J,x,u,null,h,X),this._depth=C,this.is2DArray=!0}update(f){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,f,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(f,z,w,S,E){return new C(f,z,w,S,5,E,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12078:(f,z,w)=>{"use strict";w.d(z,{e:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(f,z){this._defines[f]||(f<this._currentRank&&(this._currentRank=f),f>this._maxRank&&(this._maxRank=f),this._defines[f]=new Array),this._defines[f].push(z)}addCPUSkinningFallback(f,z){this._mesh=z,f<this._currentRank&&(this._currentRank=f),f>this._maxRank&&(this._maxRank=f)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(f,z){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,f=f.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),z._bonesComputationForcedToCPU=!0;const w=this._mesh.va();for(let f=0;f<w.meshes.length;f++){const S=w.meshes[f];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===z)S.computeBonesUsingShaders=!1;else if(S.pk)for(const f of S.pk){if(f.effect===z){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const z=this._defines[this._currentRank];if(z)for(let w=0;w<z.length;w++)f=f.replace("#define "+z[w],"");this._currentRank++}return f}}},12083:(f,z,w)=>{"use strict";w.d(z,{c:()=>X});var S=w(692),C=w(878),E=w(699),F=w(12070),J=w(12064),x=w(12089),u=w(885);class h extends J.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class X extends x.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"DetailMap",140,new h,z),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=C.e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,z,w){return!this._isEnabled||!(f._areTexturesDirty&&z.texturesEnabled&&w.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(f,z){if(this._isEnabled){f.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const w=z.getEngine();f._areTexturesDirty&&(w.getCaps().standardDerivatives&&this._texture&&F.d.DetailTextureEnabled&&this._isEnabled?((0,u.L)(this._texture,f,"DETAIL"),f.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):f.DETAIL=!1)}else f.DETAIL=!1}bindForSubMesh(f,z){if(!this._isEnabled)return;const w=this._material.isFrozen;f.useUbo&&w&&f.isSync||this._texture&&F.d.DetailTextureEnabled&&(f.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,u.p)(this._texture,f,"detail")),z.texturesEnabled&&this._texture&&F.d.DetailTextureEnabled&&f.setTexture("detailSampler",this._texture)}hasTexture(f){return this._texture===f}getActiveTextures(f){this._texture&&f.push(this._texture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture)}dispose(f){var z;f&&(null===(z=this._texture)||void 0===z||z.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(f){f.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,S.b)([(0,E.H)("detailTexture"),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"texture",void 0),(0,S.b)([(0,E.O)()],X.prototype,"diffuseBlendLevel",void 0),(0,S.b)([(0,E.O)()],X.prototype,"roughnessBlendLevel",void 0),(0,S.b)([(0,E.O)()],X.prototype,"bumpLevel",void 0),(0,S.b)([(0,E.O)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"normalBlendMethod",void 0),(0,S.b)([(0,E.O)(),(0,E.e)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isEnabled",void 0)},12064:(f,z,w)=>{"use strict";w.d(z,{b:()=>S});class S{constructor(f){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=f,f)for(const z in f)Object.prototype.hasOwnProperty.call(f,z)&&this._setDefaultValue(z)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||f,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const f of Object.keys(this))"_"!==f[0]&&this._keys.push(f);if(this._externalProperties)for(const f in this._externalProperties)-1===this._keys.indexOf(f)&&this._keys.push(f)}isEqual(f){if(this._keys.length!==f._keys.length)return!1;for(let z=0;z<this._keys.length;z++){const w=this._keys[z];if(this[w]!==f[w])return!1}return!0}cloneTo(f){this._keys.length!==f._keys.length&&(f._keys=this._keys.slice(0));for(let z=0;z<this._keys.length;z++){const w=this._keys[z];f[w]=this[w]}}reset(){this._keys.forEach((f=>this._setDefaultValue(f)))}_setDefaultValue(f){var z,w,S,C;const E=(null===(z=this._externalProperties)||void 0===z||null===(w=z[f])||void 0===w?void 0:w.type)??typeof this[f],F=null===(S=this._externalProperties)||void 0===S||null===(C=S[f])||void 0===C?void 0:C.default;switch(E){case"number":this[f]=F??0;break;case"string":this[f]=F??"";break;default:this[f]=F??!1}}toString(){let f="";for(let z=0;z<this._keys.length;z++){const w=this._keys[z],S=this[w];switch(typeof S){case"number":case"string":f+="#define "+w+" "+S+"\n";break;default:S&&(f+="#define "+w+"\n")}}return f}}},12070:(f,z,w)=>{"use strict";w.d(z,{d:()=>C});var S=w(616);class C{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(f){this._DiffuseTextureEnabled!==f&&(this._DiffuseTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(f){this._DetailTextureEnabled!==f&&(this._DetailTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(f){this._DecalMapEnabled!==f&&(this._DecalMapEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(f){this._AmbientTextureEnabled!==f&&(this._AmbientTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(f){this._OpacityTextureEnabled!==f&&(this._OpacityTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(f){this._ReflectionTextureEnabled!==f&&(this._ReflectionTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(f){this._EmissiveTextureEnabled!==f&&(this._EmissiveTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(f){this._SpecularTextureEnabled!==f&&(this._SpecularTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(f){this._BumpTextureEnabled!==f&&(this._BumpTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(f){this._LightmapTextureEnabled!==f&&(this._LightmapTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(f){this._RefractionTextureEnabled!==f&&(this._RefractionTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(f){this._ColorGradingTextureEnabled!==f&&(this._ColorGradingTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(f){this._FresnelEnabled!==f&&(this._FresnelEnabled=f,S.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(f){this._ClearCoatTextureEnabled!==f&&(this._ClearCoatTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(f){this._ClearCoatBumpTextureEnabled!==f&&(this._ClearCoatBumpTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(f){this._ClearCoatTintTextureEnabled!==f&&(this._ClearCoatTintTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(f){this._SheenTextureEnabled!==f&&(this._SheenTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(f){this._AnisotropicTextureEnabled!==f&&(this._AnisotropicTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(f){this._ThicknessTextureEnabled!==f&&(this._ThicknessTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(f){this._RefractionIntensityTextureEnabled!==f&&(this._RefractionIntensityTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(f){this._TranslucencyIntensityTextureEnabled!==f&&(this._TranslucencyIntensityTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(f){this._TranslucencyColorTextureEnabled!==f&&(this._TranslucencyColorTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(f){this._IridescenceTextureEnabled!==f&&(this._IridescenceTextureEnabled=f,S.e.MarkAllMaterialsAsDirty(1))}}C._DiffuseTextureEnabled=!0,C._DetailTextureEnabled=!0,C._DecalMapEnabled=!0,C._AmbientTextureEnabled=!0,C._OpacityTextureEnabled=!0,C._ReflectionTextureEnabled=!0,C._EmissiveTextureEnabled=!0,C._SpecularTextureEnabled=!0,C._BumpTextureEnabled=!0,C._LightmapTextureEnabled=!0,C._RefractionTextureEnabled=!0,C._ColorGradingTextureEnabled=!0,C._FresnelEnabled=!0,C._ClearCoatTextureEnabled=!0,C._ClearCoatBumpTextureEnabled=!0,C._ClearCoatTintTextureEnabled=!0,C._SheenTextureEnabled=!0,C._AnisotropicTextureEnabled=!0,C._ThicknessTextureEnabled=!0,C._RefractionIntensityTextureEnabled=!0,C._TranslucencyIntensityTextureEnabled=!0,C._TranslucencyColorTextureEnabled=!0,C._IridescenceTextureEnabled=!0},12094:(f,z,w)=>{"use strict";w.d(z,{d:()=>E});var S,C=w(720);!function(f){f[f.Zero=0]="Zero",f[f.One=1]="One",f[f.MaxViewZ=2]="MaxViewZ"}(S||(S={}));class E{static CreateConfiguration(f){return E._Configurations[f]={defines:{},previousWorldMatrices:{},previousViewProjection:C.b.Zero(),currentViewProjection:C.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},E._Configurations[f]}static DeleteConfiguration(f){delete E._Configurations[f]}static GetConfiguration(f){return E._Configurations[f]}static AddUniformsAndSamplers(f,z){f.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(f,z){for(const w of z)if(w.pk)for(const z of w.pk)z._removeDrawWrapper(f)}static PrepareDefines(f,z,w){if(!w._arePrePassDirty)return;const S=E._Configurations[f];if(!S)return;w.PREPASS=!0,w.PREPASS_COLOR=!1,w.PREPASS_COLOR_INDEX=-1;let C=0;for(let F=0;F<E.GeometryTextureDescriptions.length;F++){const f=E.GeometryTextureDescriptions[F],z=f.define,J=f.defineIndex,x=S.defines[J];void 0!==x?(w[z]=!0,w[J]=x,C++):(w[z]=!1,delete w[J])}w.SCENE_MRT_COUNT=C,w.BONES_VELOCITY_ENABLED=z.useBones&&z.computeBonesUsingShaders&&z.skeleton&&!z.skeleton.isUsingTextureForMatrices&&-1===S.excludedSkinnedMesh.indexOf(z)}static Bind(f,z,w,S){const C=E._Configurations[f];if(C&&(void 0!==C.defines.PREPASS_VELOCITY_INDEX||void 0!==C.defines.PREPASS_VELOCITY_LINEAR_INDEX)){C.previousWorldMatrices[w.uniqueId]||(C.previousWorldMatrices[w.uniqueId]=S.clone());const f=w.va();C.previousViewProjection||(C.previousViewProjection=f.getTransformMatrix().clone(),C.currentViewProjection=f.getTransformMatrix().clone());const E=f.getEngine();if(C.currentViewProjection.updateFlag!==f.getTransformMatrix().updateFlag?(C.lastUpdateFrameId=E.frameId,C.previousViewProjection.p(C.currentViewProjection),C.currentViewProjection.p(f.getTransformMatrix())):C.lastUpdateFrameId!==E.frameId&&(C.lastUpdateFrameId=E.frameId,C.previousViewProjection.p(C.currentViewProjection)),z.setMatrix("previousWorld",C.previousWorldMatrices[w.uniqueId]),z.setMatrix("previousViewProjection",C.previousViewProjection),C.previousWorldMatrices[w.uniqueId]=S.clone(),w.useBones&&w.computeBonesUsingShaders&&w.skeleton){const f=w.skeleton;if(!f.isUsingTextureForMatrices||-1===z.getUniformIndex("boneTextureWidth")){const S=f.getTransformMatrices(w);S&&(C.previousBones[w.uniqueId]||(C.previousBones[w.uniqueId]=S.slice()),z.setMatrices("mPreviousBones",C.previousBones[w.uniqueId]),C.previousBones[w.uniqueId].set(S))}}}}}E.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],E._Configurations={}},12089:(f,z,w)=>{"use strict";w.d(z,{d:()=>d});var S=w(692),C=w(699),E=w(878),F=w(580),J=w(597),x=w(628);const u=new RegExp("^([gimus]+)!");class h{constructor(f){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=f,this._scene=f.va(),this._engine=this._scene.getEngine()}_addPlugin(f){for(let S=0;S<this._plugins.length;++S)if(this._plugins[S].name===f.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!f.isCompatible(this._material.shaderLanguage))throw`The plugin "${f.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const z=f.getClassName();h._MaterialPluginClassToMainDefine[z]||(h._MaterialPluginClassToMainDefine[z]="MATERIALPLUGIN_"+ ++h._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(f,z)=>this._handlePluginEvent(f,z),this._plugins.push(f),this._plugins.sort(((f,z)=>f.priority-z.priority)),this._codeInjectionPoints={};const w={};w[h._MaterialPluginClassToMainDefine[z]]={type:"boolean",default:!0};for(const S of this._plugins)S.collectDefines(w),this._collectPointNames("vertex",S.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",S.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=w,!0}_activatePlugin(f){-1===this._activePlugins.indexOf(f)&&(this._activePlugins.push(f),this._activePlugins.sort(((f,z)=>f.priority-z.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),f.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(f),this._activePluginsForExtraEvents.sort(((f,z)=>f.priority-z.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(f){for(let z=0;z<this._plugins.length;++z)if(this._plugins[z].name===f)return this._plugins[z];return null}_handlePluginEventIsReadyForSubMesh(f){let z=!0;for(const w of this._activePlugins)z=z&&w.isReadyForSubMesh(f.defines,this._scene,this._engine,f.subMesh);f.isReadyForSubMesh=z}_handlePluginEventPrepareDefinesBeforeAttributes(f){for(const z of this._activePlugins)z.prepareDefinesBeforeAttributes(f.defines,this._scene,f.mesh)}_handlePluginEventPrepareDefines(f){for(const z of this._activePlugins)z.prepareDefines(f.defines,this._scene,f.mesh)}_handlePluginEventHardBindForSubMesh(f){for(const z of this._activePluginsForExtraEvents)z.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,f.subMesh)}_handlePluginEventBindForSubMesh(f){for(const z of this._activePlugins)z.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,f.subMesh)}_handlePluginEventHasRenderTargetTextures(f){let z=!1;for(const w of this._activePluginsForExtraEvents)if(z=w.hasRenderTargetTextures(),z)break;f.hasRenderTargetTextures=z}_handlePluginEventFillRenderTargetTextures(f){for(const z of this._activePluginsForExtraEvents)z.fillRenderTargetTextures(f.renderTargets)}_handlePluginEvent(f,z){switch(f){case 512:{const f=z;for(const z of this._activePlugins)z.getActiveTextures(f.activeTextures);break}case 256:{const f=z;for(const z of this._activePlugins)z.getAnimatables(f.animatables);break}case 1024:{const f=z;let w=!1;for(const z of this._activePlugins)if(w=z.hasTexture(f.texture),w)break;f.hasTexture=w;break}case 2:{const f=z;for(const z of this._plugins)z.dispose(f.forceDisposeTextures);break}case 4:z.defineNames=this._defineNamesFromPlugins;break;case 128:{const f=z;for(const z of this._activePlugins)f.fallbackRank=z.addFallbacks(f.defines,f.fallbacks,f.fallbackRank),z.getAttributes(f.attributes,this._scene,f.mesh);this._uniformList.length>0&&f.uniforms.push(...this._uniformList),this._samplerList.length>0&&f.samplers.push(...this._samplerList),this._uboList.length>0&&f.uniformBuffersNames.push(...this._uboList),f.customCode=this._injectCustomCode(f,f.customCode);break}case 8:{const f=z;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const w=1===this._material.shaderLanguage;for(const z of this._plugins){const S=z.getUniforms(this._material.shaderLanguage);if(S){if(S.ubo)for(const z of S.ubo){if(z.size&&z.type){const S=z.arraySize??0;if(f.ubo.addUniform(z.name,z.size,S),w){let f;switch(z.type){case"mat4":f="mat4x4f";break;case"float":f="f32";break;default:f=`${z.type}f`}this._uboDeclaration+=`uniform ${z.name}: ${f}${S>0?`[${S}]`:""};\n`}else this._uboDeclaration+=`${z.type} ${z.name}${S>0?`[${S}]`:""};\n`}this._uniformList.push(z.name)}S.vertex&&(this._vertexDeclaration+=S.vertex+"\n"),S.fragment&&(this._fragmentDeclaration+=S.fragment+"\n")}z.getSamplers(this._samplerList),z.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(f,z){if(z)for(const w in z)this._codeInjectionPoints[f]||(this._codeInjectionPoints[f]={}),this._codeInjectionPoints[f][w]=!0}_injectCustomCode(f,z){return(w,S)=>{var C;z&&(S=z(w,S)),this._uboDeclaration&&(S=S.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(S=S.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(S=S.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const E=null===(C=this._codeInjectionPoints)||void 0===C?void 0:C[w];if(!E)return S;let F=null;for(let z in E){let C="";for(const S of this._activePlugins){var h;let E=null===(h=S.getCustomCode(w,this._material.shaderLanguage))||void 0===h?void 0:h[z];if(E){if(S.resolveIncludes){if(null===F){const z=0;F={defines:[],indexParameters:f.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:x.d.GetShadersRepository(z),includesShadersStore:x.d.GetIncludesShadersStore(z),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}F.isFragment="fragment"===w,(0,J.n)(E,F,(f=>E=f))}C+=E+"\n"}}if(C.length>0)if("!"===z.charAt(0)){z=z.substring(1);let f="g";if("!"===z.charAt(0))f="",z=z.substring(1);else{const w=u.exec(z);w&&w.length>=2&&(f=w[1],z=z.substring(f.length+1))}f.indexOf("g")<0&&(f+="g");const w=S,E=new RegExp(z,f);let F=E.exec(w);for(;null!==F;){let f=C;for(let z=0;z<F.length;++z)f=f.replace("$"+z,F[z]);S=S.replace(F[0],f),F=E.exec(w)}}else{const f="#define "+z;S=S.replace(f,"\n"+C+"\n"+f)}}return S}}}h._MaterialPluginClassToMainDefine={},h._MaterialPluginCounter=0,F.c.OnEnginesDisposedObservable.add((()=>{y()}));const X=[];let K=!1,c=null;function y(){X.length=0,K=!1,E.e.OnEventObservable.remove(c),c=null}var e=w(753),O=w(665);class d{isCompatible(f){return 0===f}_enable(f){f&&this._pluginManager._activatePlugin(this)}constructor(f,z,w,S){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=f,this.name=z,this.priority=w,this.resolveIncludes=F,f.pluginManager||(f.pluginManager=new h(f),f.ik.add((()=>{f.pluginManager=void 0}))),this._pluginDefineNames=S,this._pluginManager=f.pluginManager,C&&this._pluginManager._addPlugin(this),E&&this._enable(!0),this.markAllDefinesAsDirty=f._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(f,z,w,S){return!0}hardBindForSubMesh(f,z,w,S){}bindForSubMesh(f,z,w,S){}dispose(f){}getCustomCode(f){return null}collectDefines(f){if(this._pluginDefineNames)for(const z of Object.keys(this._pluginDefineNames)){if("_"===z[0])continue;const w=typeof this._pluginDefineNames[z];f[z]={type:"number"===w?"number":"string"===w?"string":"boolean"===w?"boolean":"object",default:this._pluginDefineNames[z]}}}prepareDefinesBeforeAttributes(f,z,w){}prepareDefines(f,z,w){}hasTexture(f){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(f){}getActiveTextures(f){}getAnimatables(f){}addFallbacks(f,z,w){return w}getSamplers(f){}getAttributes(f,z,w){}getUniformBuffersNames(f){}getUniforms(){return{}}copyTo(f){e.b.Clone((()=>f),this)}serialize(){return e.b.Serialize(this)}parse(f,z,w){e.b.Parse((()=>this),f,z,w)}}(0,S.b)([(0,C.O)()],d.prototype,"name",void 0),(0,S.b)([(0,C.O)()],d.prototype,"priority",void 0),(0,S.b)([(0,C.O)()],d.prototype,"resolveIncludes",void 0),(0,S.b)([(0,C.O)()],d.prototype,"registerForExtraEvents",void 0),(0,O.f)("BABYLON.MaterialPluginBase",d)},12060:(f,z,w)=>{"use strict";w.d(z,{c:()=>S});class S{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(f){f.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(f){}bindForSubMesh(f,z,w,S,C){if(z.prePassRenderer&&z.prePassRenderer.enabled&&z.prePassRenderer.currentRTisSceneRT&&(-1!==z.prePassRenderer.getIndex(2)||-1!==z.prePassRenderer.getIndex(11))){this.previousWorldMatrices[w.uniqueId]||(this.previousWorldMatrices[w.uniqueId]=S.clone()),this.previousViewProjection||(this.previousViewProjection=z.getTransformMatrix().clone(),this.currentViewProjection=z.getTransformMatrix().clone());const C=z.getEngine();this.currentViewProjection.updateFlag!==z.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=C.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(z.getTransformMatrix())):this._lastUpdateFrameId!==C.frameId&&(this._lastUpdateFrameId=C.frameId,this.previousViewProjection.p(this.currentViewProjection)),f.setMatrix("previousWorld",this.previousWorldMatrices[w.uniqueId]),f.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[w.uniqueId]=S.clone()}}}},12067:(f,z,w)=>{"use strict";w.d(z,{c:()=>E});var S=w(720),C=w(878);class E extends C.e{constructor(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(f,z,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.b,this._storeEffectOnSubMeshes=w}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(f,z){return!!f&&(!this._storeEffectOnSubMeshes||(!f.pk||0===f.pk.length||this.isReadyForSubMesh(f,f.pk[0],z)))}_isReadyForSubMesh(f){const z=f.materialDefines;return!(this.checkReadyOnEveryCall||!f.effect||!z||z._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(f){this._activeEffect.setMatrix("world",f)}bindOnlyNormalMatrix(f){this._activeEffect.setMatrix("normalMatrix",f)}bind(f,z){z&&this.bindForSubMesh(f,z,z.pk[0])}_afterBind(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0;super._afterBind(f,z,w),this.va()._cachedEffect=z,w?w._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return w._drawWrapper._forceRebindOnNextCall||f.isCachedMaterialInvalid(this,z,S)}dispose(f,z,w){this._activeEffect=void 0,super.dispose(f,z,w)}}},12057:(f,z,w)=>{"use strict";w.d(z,{c:()=>G});var S=w(692),C=w(699),E=w(715),F=w(2386),J=w(720),x=w(762),u=w(789),h=w(12060),X=w(2390),K=w(878),c=w(12064),y=w(12067),e=w(2321),O=w(665),d=w(12070),B=w(12078),V=w(12083),W=w(901),T=w(885),v=w(753),D=w(12094);const A={effect:null,subMesh:null};class M extends c.b{constructor(f){super(f),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(f){const z=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const w of z)this[w]=w===f}}class G extends y.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=f||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(f){this.imageProcessingConfiguration.colorCurvesEnabled=f}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(f){this.imageProcessingConfiguration.colorGradingEnabled=f}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(f){this._imageProcessingConfiguration.toneMappingEnabled=f}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(f){this._imageProcessingConfiguration.exposure=f}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(f){this._imageProcessingConfiguration.contrast=f}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(f){this._imageProcessingConfiguration.colorGradingTexture=f}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(f){this._imageProcessingConfiguration.colorCurves=f}get canRenderToMRT(){return!0}constructor(f,z){super(f,z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||G.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new x.d(0,0,0),this.diffuseColor=new x.d(1,1,1),this.specularColor=new x.d(1,1,1),this.emissiveColor=new x.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new E.h(16),this._worldViewProjectionMatrix=J.b.Zero(),this._globalAmbientColor=new x.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new V.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new h.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),G.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),G.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(G.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(G.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"bb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===K.e.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.xi&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==K.e.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.xi||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(f,z){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const C=z._drawWrapper;if(C.effect&&this.isFrozen&&C._wasPreviouslyReady&&C._wasPreviouslyUsingInstances===S)return!0;z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),z.materialDefines=new M(this._eventInfo.defineNames));const E=this.va(),F=z.materialDefines;if(this._isReadyForSubMesh(z))return!0;const J=E.getEngine();F._needNormals=(0,T.K)(E,f,F,!0,this._maxSimultaneousLights,this._disableLighting),(0,T.R)(E,F);const x=this.needAlphaBlendingForMesh(f)&&this.va().useOrderIndependentTransparency;if((0,T.Z)(E,F,this.canRenderToMRT&&!x),(0,T.V)(E,F,x),D.d.PrepareDefines(J.currentRenderPassId,f,F),F._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,F._needUVs=!1;for(let f=1;f<=6;++f)F["MAINUV"+f]=!1;if(E.texturesEnabled){if(F.DIFFUSEDIRECTUV=0,F.BUMPDIRECTUV=0,F.AMBIENTDIRECTUV=0,F.OPACITYDIRECTUV=0,F.EMISSIVEDIRECTUV=0,F.SPECULARDIRECTUV=0,F.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&G.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._diffuseTexture,F,"DIFFUSE")}else F.DIFFUSE=!1;if(this._ambientTexture&&G.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._ambientTexture,F,"AMBIENT")}else F.AMBIENT=!1;if(this._opacityTexture&&G.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._opacityTexture,F,"OPACITY"),F.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else F.OPACITY=!1;if(this._reflectionTexture&&G.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(F._needNormals=!0,F.REFLECTION=!0,F.ROUGHNESS=this._roughness>0,F.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,F.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===e.b.INVCUBIC_MODE,F.REFLECTIONMAP_3D=this._reflectionTexture.isCube,F.REFLECTIONMAP_OPPOSITEZ=F.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,F.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case e.b.EXPLICIT_MODE:F.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case e.b.PLANAR_MODE:F.setReflectionMode("REFLECTIONMAP_PLANAR");break;case e.b.PROJECTION_MODE:F.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case e.b.SKYBOX_MODE:F.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case e.b.SPHERICAL_MODE:F.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case e.b.EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case e.b.FIXED_EQUIRECTANGULAR_MODE:F.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case e.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:F.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case e.b.CUBIC_MODE:case e.b.INVCUBIC_MODE:default:F.setReflectionMode("REFLECTIONMAP_CUBIC")}F.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else F.REFLECTION=!1,F.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&G.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._emissiveTexture,F,"EMISSIVE")}else F.EMISSIVE=!1;if(this._lightmapTexture&&G.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._lightmapTexture,F,"LIGHTMAP"),F.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,F.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else F.LIGHTMAP=!1;if(this._specularTexture&&G.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,T.L)(this._specularTexture,F,"SPECULAR"),F.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else F.SPECULAR=!1;if(E.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&G.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,T.L)(this._bumpTexture,F,"BUMP"),F.PARALLAX=this._useParallax,F.PARALLAX_RHS=E.useRightHandedSystem,F.PARALLAXOCCLUSION=this._useParallaxOcclusion,F.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else F.BUMP=!1,F.PARALLAX=!1,F.PARALLAX_RHS=!1,F.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&G.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;F._needUVs=!0,F.REFRACTION=!0,F.REFRACTIONMAP_3D=this._refractionTexture.isCube,F.RGBDREFRACTION=this._refractionTexture.isRGBD,F.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else F.REFRACTION=!1;F.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else F.DIFFUSE=!1,F.AMBIENT=!1,F.OPACITY=!1,F.REFLECTION=!1,F.EMISSIVE=!1,F.LIGHTMAP=!1,F.BUMP=!1,F.REFRACTION=!1;F.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),F.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,F.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,F.SPECULAROVERALPHA=this._useSpecularOverAlpha,F.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,F.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,F.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(f)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=F,this._eventInfo.subMesh=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(F),F.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,F.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}F._areFresnelDirty&&(G.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(F.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,F.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,F.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,F.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,F.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,F.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,F._needNormals=!0,F.FRESNEL=!0):F.FRESNEL=!1),(0,T.N)(f,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(f)||this._forceAlphaTest,F,this._applyDecalMapAfterDetailMap),(0,T.G)(E,J,this,F,S,null,z.getRenderingMesh().hasThinInstances),this._eventInfo.defines=F,this._eventInfo.mesh=f,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,T.D)(f,F,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let K=!1;if(F.isDirty){const S=F._areLightsDisposed;F.markAsProcessed();const C=new B.e;F.REFLECTION&&C.addFallback(0,"REFLECTION"),F.SPECULAR&&C.addFallback(0,"SPECULAR"),F.BUMP&&C.addFallback(0,"BUMP"),F.PARALLAX&&C.addFallback(1,"PARALLAX"),F.PARALLAX_RHS&&C.addFallback(1,"PARALLAX_RHS"),F.PARALLAXOCCLUSION&&C.addFallback(0,"PARALLAXOCCLUSION"),F.SPECULAROVERALPHA&&C.addFallback(0,"SPECULAROVERALPHA"),F.FOG&&C.addFallback(1,"FOG"),F.POINTSIZE&&C.addFallback(0,"POINTSIZE"),F.LOGARITHMICDEPTH&&C.addFallback(0,"LOGARITHMICDEPTH"),(0,T.r)(F,C,this._maxSimultaneousLights),F.SPECULARTERM&&C.addFallback(0,"SPECULARTERM"),F.DIFFUSEFRESNEL&&C.addFallback(1,"DIFFUSEFRESNEL"),F.OPACITYFRESNEL&&C.addFallback(2,"OPACITYFRESNEL"),F.REFLECTIONFRESNEL&&C.addFallback(3,"REFLECTIONFRESNEL"),F.EMISSIVEFRESNEL&&C.addFallback(4,"EMISSIVEFRESNEL"),F.FRESNEL&&C.addFallback(4,"FRESNEL"),F.MULTIVIEW&&C.addFallback(0,"MULTIVIEW");const x=[u.f.PositionKind];F.NORMAL&&x.push(u.f.NormalKind),F.TANGENT&&x.push(u.f.TangentKind);for(let f=1;f<=6;++f)F["UV"+f]&&x.push(`uv${1===f?"":f}`);F.VERTEXCOLOR&&x.push(u.f.ColorKind),(0,T.u)(x,f,F,C),(0,T.y)(x,F),(0,T.A)(x,f,F),(0,T.s)(x,f,F);let c="default";const y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],e=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],O=["Material","Scene","Mesh"],d={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:F.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=C,this._eventInfo.fallbackRank=0,this._eventInfo.defines=F,this._eventInfo.uniforms=y,this._eventInfo.attributes=x,this._eventInfo.samplers=e,this._eventInfo.uniformBuffersNames=O,this._eventInfo.customCode=void 0,this._eventInfo.mesh=f,this._eventInfo.indexParameters=d,this._callbackPluginEventGeneric(128,this._eventInfo),D.d.AddUniformsAndSamplers(y,e),h.c.AddUniforms(y),h.c.AddSamplers(e),X.c&&(X.c.PrepareUniforms(y,F),X.c.PrepareSamplers(e,F)),(0,T._)({uniformsNames:y,uniformBuffersNames:O,samplers:e,defines:F,maxSimultaneousLights:this._maxSimultaneousLights}),(0,W.c)(y);const V={};this.customShaderNameResolve&&(c=this.customShaderNameResolve(c,y,O,e,F,x,V));const v=F.toString(),M=z.effect;let G=E.getEngine().createEffect(c,{attributes:x,uniformsNames:y,uniformBuffersNames:O,samplers:e,defines:v,fallbacks:C,onCompiled:this.onCompiled,onError:this.onError,indexParameters:d,processFinalCode:V.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:F.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([w.e(40),w.e(38)]).then(w.bind(w,13200)),Promise.all([w.e(41),w.e(39)]).then(w.bind(w,13351))]):await Promise.all([Promise.all([w.e(44),w.e(43)]).then(w.bind(w,13432)),Promise.all([w.e(46),w.e(45)]).then(w.bind(w,13587))]),this._shadersLoaded=!0}},J);if(this._eventInfo.customCode=void 0,G)if(this._onEffectCreatedObservable&&(A.effect=G,A.subMesh=z,this._onEffectCreatedObservable.notifyObservers(A)),this.allowShaderHotSwapping&&M&&!G.isReady()){if(G=M,F.markAsUnprocessed(),K=this.isFrozen,S)return F._areLightsDisposed=!0,!1}else E.resetCachedMaterial(),z.setEffect(G,F,this._materialContext)}return!(!z.effect||!z.effect.isReady())&&(F._renderId=E.getRenderId(),C._wasPreviouslyReady=!K,C._wasPreviouslyUsingInstances=S,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const f=this._uniformBuffer;f.addUniform("diffuseLeftColor",4),f.addUniform("diffuseRightColor",4),f.addUniform("opacityParts",4),f.addUniform("reflectionLeftColor",4),f.addUniform("reflectionRightColor",4),f.addUniform("refractionLeftColor",4),f.addUniform("refractionRightColor",4),f.addUniform("emissiveLeftColor",4),f.addUniform("emissiveRightColor",4),f.addUniform("vDiffuseInfos",2),f.addUniform("vAmbientInfos",2),f.addUniform("vOpacityInfos",2),f.addUniform("vReflectionInfos",2),f.addUniform("vReflectionPosition",3),f.addUniform("vReflectionSize",3),f.addUniform("vEmissiveInfos",2),f.addUniform("vLightmapInfos",2),f.addUniform("vSpecularInfos",2),f.addUniform("vBumpInfos",3),f.addUniform("diffuseMatrix",16),f.addUniform("ambientMatrix",16),f.addUniform("opacityMatrix",16),f.addUniform("reflectionMatrix",16),f.addUniform("emissiveMatrix",16),f.addUniform("lightmapMatrix",16),f.addUniform("specularMatrix",16),f.addUniform("bumpMatrix",16),f.addUniform("vTangentSpaceParams",2),f.addUniform("pointSize",1),f.addUniform("alphaCutOff",1),f.addUniform("refractionMatrix",16),f.addUniform("vRefractionInfos",4),f.addUniform("vRefractionPosition",3),f.addUniform("vRefractionSize",3),f.addUniform("vSpecularColor",4),f.addUniform("vEmissiveColor",3),f.addUniform("vDiffuseColor",4),f.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(f,z,w){const S=this.va(),C=w.materialDefines;if(!C)return;const E=w.effect;if(!E)return;this._activeEffect=E,z.getMeshUniformBuffer().bindToEffect(E,"Mesh"),z.transferToEffect(f),this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,S,z,f,this.isFrozen),D.d.Bind(S.getEngine().currentRenderPassId,this._activeEffect,z,f),this._eventInfo.subMesh=w,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),C.OBJECTSPACE_NORMALMAP&&(f.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const J=this._mustRebind(S,E,w,z.visibility);(0,T.b)(z,E);const u=this._uniformBuffer;if(J){if(this.bindViewProjection(E),!u.useUbo||!this.isFrozen||!u.isSync||w._drawWrapper._forceRebindOnNextCall){if(G.FresnelEnabled&&C.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(u.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),u.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&u.updateColor4("opacityParts",new x.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(u.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),u.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(u.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),u.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(u.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),u.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),S.texturesEnabled){if(this._diffuseTexture&&G.DiffuseTextureEnabled&&(u.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,T.p)(this._diffuseTexture,u,"diffuse")),this._ambientTexture&&G.AmbientTextureEnabled&&(u.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,T.p)(this._ambientTexture,u,"ambient")),this._opacityTexture&&G.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,T.p)(this._opacityTexture,u,"opacity")),this._hasAlphaChannel()&&u.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&G.ReflectionTextureEnabled&&(u.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),u.rk("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const f=this._reflectionTexture;u.updateVector3("vReflectionPosition",f.boundingBoxPosition),u.updateVector3("vReflectionSize",f.boundingBoxSize)}if(this._emissiveTexture&&G.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,T.p)(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&G.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,T.p)(this._lightmapTexture,u,"lightmap")),this._specularTexture&&G.SpecularTextureEnabled&&(u.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,T.p)(this._specularTexture,u,"specular")),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&G.BumpTextureEnabled&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,T.p)(this._bumpTexture,u,"bump"),S._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&G.RefractionTextureEnabled){let f=1;if(this._refractionTexture.isCube||(u.rk("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(f=this._refractionTexture.depth)),u.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,f,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const f=this._refractionTexture;u.updateVector3("vRefractionPosition",f.boundingBoxPosition),u.updateVector3("vRefractionSize",f.boundingBoxSize)}}}this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),u.updateColor4("vSpecularColor",this.specularColor,this.specularPower),u.updateColor3("vEmissiveColor",G.EmissiveTextureEnabled?this.emissiveColor:x.d.BlackReadOnly),u.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),S.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),u.updateColor3("vAmbientColor",this._globalAmbientColor)}S.texturesEnabled&&(this._diffuseTexture&&G.DiffuseTextureEnabled&&E.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&G.AmbientTextureEnabled&&E.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&G.OpacityTextureEnabled&&E.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&G.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?E.setTexture("reflectionCubeSampler",this._reflectionTexture):E.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&G.EmissiveTextureEnabled&&E.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&G.LightmapTextureEnabled&&E.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&G.SpecularTextureEnabled&&E.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&S.getEngine().getCaps().standardDerivatives&&G.BumpTextureEnabled&&E.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&G.RefractionTextureEnabled&&(this._refractionTexture.isCube?E.setTexture("refractionCubeSampler",this._refractionTexture):E.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(z)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=w,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,W.g)(E,this,S),this.bindEyePosition(E)}else S.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(J||!this.isFrozen){var h;if(S.lightsEnabled&&!this._disableLighting&&(0,T.g)(S,z,E,C,this._maxSimultaneousLights),(S.fogEnabled&&z.applyFog&&S.fogMode!==F.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||z.receiveShadows||C.PREPASS)&&this.bindView(E),(0,T.d)(S,z,E),C.NUM_MORPH_INFLUENCERS&&(0,T.l)(z,E),C.BAKED_VERTEX_ANIMATION_TEXTURE)null===(h=z.bakedVertexAnimationManager)||void 0===h||h.bind(E,C.INSTANCES);this.useLogarithmicDepth&&(0,T.h)(C,E,S),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(z,this._activeEffect,w),u.update()}getAnimatables(){const f=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&f.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&f.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&f.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&f.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&f.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&f.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&f.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&f.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&f.push(this._refractionTexture),f}getActiveTextures(){const f=super.getActiveTextures();return this._diffuseTexture&&f.push(this._diffuseTexture),this._ambientTexture&&f.push(this._ambientTexture),this._opacityTexture&&f.push(this._opacityTexture),this._reflectionTexture&&f.push(this._reflectionTexture),this._emissiveTexture&&f.push(this._emissiveTexture),this._specularTexture&&f.push(this._specularTexture),this._bumpTexture&&f.push(this._bumpTexture),this._lightmapTexture&&f.push(this._lightmapTexture),this._refractionTexture&&f.push(this._refractionTexture),f}hasTexture(f){return!!super.hasTexture(f)||(this._diffuseTexture===f||(this._ambientTexture===f||(this._opacityTexture===f||(this._reflectionTexture===f||(this._emissiveTexture===f||(this._specularTexture===f||(this._bumpTexture===f||(this._lightmapTexture===f||this._refractionTexture===f))))))))}dispose(f,z){var w,S,C,E,F,J,x,u,h;z&&(null===(w=this._diffuseTexture)||void 0===w||w.dispose(),null===(S=this._ambientTexture)||void 0===S||S.dispose(),null===(C=this._opacityTexture)||void 0===C||C.dispose(),null===(E=this._reflectionTexture)||void 0===E||E.dispose(),null===(F=this._emissiveTexture)||void 0===F||F.dispose(),null===(J=this._specularTexture)||void 0===J||J.dispose(),null===(x=this._bumpTexture)||void 0===x||x.dispose(),null===(u=this._lightmapTexture)||void 0===u||u.dispose(),null===(h=this._refractionTexture)||void 0===h||h.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(f,z)}clone(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const S=v.b.Clone((()=>new G(f,this.va())),this,{cloneTexturesOnlyOnce:z});return S.name=f,S.id=f,this.stencil.copyTo(S.stencil),this._clonePlugins(S,w),S}static Parse(f,z,w){const S=v.b.Parse((()=>new G(f.name,z)),f,z,w);return f.stencil&&S.stencil.parse(f.stencil,z,w),K.e._ParsePlugins(f,S,z,w),S}static get DiffuseTextureEnabled(){return d.d.DiffuseTextureEnabled}static set DiffuseTextureEnabled(f){d.d.DiffuseTextureEnabled=f}static get DetailTextureEnabled(){return d.d.DetailTextureEnabled}static set DetailTextureEnabled(f){d.d.DetailTextureEnabled=f}static get AmbientTextureEnabled(){return d.d.AmbientTextureEnabled}static set AmbientTextureEnabled(f){d.d.AmbientTextureEnabled=f}static get OpacityTextureEnabled(){return d.d.OpacityTextureEnabled}static set OpacityTextureEnabled(f){d.d.OpacityTextureEnabled=f}static get ReflectionTextureEnabled(){return d.d.ReflectionTextureEnabled}static set ReflectionTextureEnabled(f){d.d.ReflectionTextureEnabled=f}static get EmissiveTextureEnabled(){return d.d.EmissiveTextureEnabled}static set EmissiveTextureEnabled(f){d.d.EmissiveTextureEnabled=f}static get SpecularTextureEnabled(){return d.d.SpecularTextureEnabled}static set SpecularTextureEnabled(f){d.d.SpecularTextureEnabled=f}static get BumpTextureEnabled(){return d.d.BumpTextureEnabled}static set BumpTextureEnabled(f){d.d.BumpTextureEnabled=f}static get LightmapTextureEnabled(){return d.d.LightmapTextureEnabled}static set LightmapTextureEnabled(f){d.d.LightmapTextureEnabled=f}static get RefractionTextureEnabled(){return d.d.RefractionTextureEnabled}static set RefractionTextureEnabled(f){d.d.RefractionTextureEnabled=f}static get ColorGradingTextureEnabled(){return d.d.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(f){d.d.ColorGradingTextureEnabled=f}static get FresnelEnabled(){return d.d.FresnelEnabled}static set FresnelEnabled(f){d.d.FresnelEnabled=f}}G.ForceGLSL=!1,(0,S.b)([(0,C.H)("diffuseTexture")],G.prototype,"_diffuseTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],G.prototype,"diffuseTexture",void 0),(0,S.b)([(0,C.H)("ambientTexture")],G.prototype,"_ambientTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"ambientTexture",void 0),(0,S.b)([(0,C.H)("opacityTexture")],G.prototype,"_opacityTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],G.prototype,"opacityTexture",void 0),(0,S.b)([(0,C.H)("reflectionTexture")],G.prototype,"_reflectionTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"reflectionTexture",void 0),(0,S.b)([(0,C.H)("emissiveTexture")],G.prototype,"_emissiveTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"emissiveTexture",void 0),(0,S.b)([(0,C.H)("specularTexture")],G.prototype,"_specularTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"specularTexture",void 0),(0,S.b)([(0,C.H)("bumpTexture")],G.prototype,"_bumpTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"bumpTexture",void 0),(0,S.b)([(0,C.H)("lightmapTexture")],G.prototype,"_lightmapTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"lightmapTexture",void 0),(0,S.b)([(0,C.H)("refractionTexture")],G.prototype,"_refractionTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"refractionTexture",void 0),(0,S.b)([(0,C.n)("ambient")],G.prototype,"ambientColor",void 0),(0,S.b)([(0,C.n)("diffuse")],G.prototype,"diffuseColor",void 0),(0,S.b)([(0,C.n)("specular")],G.prototype,"specularColor",void 0),(0,S.b)([(0,C.n)("emissive")],G.prototype,"emissiveColor",void 0),(0,S.b)([(0,C.O)()],G.prototype,"specularPower",void 0),(0,S.b)([(0,C.O)("useAlphaFromDiffuseTexture")],G.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],G.prototype,"useAlphaFromDiffuseTexture",void 0),(0,S.b)([(0,C.O)("useEmissiveAsIllumination")],G.prototype,"_useEmissiveAsIllumination",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useEmissiveAsIllumination",void 0),(0,S.b)([(0,C.O)("linkEmissiveWithDiffuse")],G.prototype,"_linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"linkEmissiveWithDiffuse",void 0),(0,S.b)([(0,C.O)("useSpecularOverAlpha")],G.prototype,"_useSpecularOverAlpha",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useSpecularOverAlpha",void 0),(0,S.b)([(0,C.O)("useReflectionOverAlpha")],G.prototype,"_useReflectionOverAlpha",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useReflectionOverAlpha",void 0),(0,S.b)([(0,C.O)("disableLighting")],G.prototype,"_disableLighting",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsLightsDirty")],G.prototype,"disableLighting",void 0),(0,S.b)([(0,C.O)("useObjectSpaceNormalMap")],G.prototype,"_useObjectSpaceNormalMap",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useObjectSpaceNormalMap",void 0),(0,S.b)([(0,C.O)("useParallax")],G.prototype,"_useParallax",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useParallax",void 0),(0,S.b)([(0,C.O)("useParallaxOcclusion")],G.prototype,"_useParallaxOcclusion",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useParallaxOcclusion",void 0),(0,S.b)([(0,C.O)()],G.prototype,"parallaxScaleBias",void 0),(0,S.b)([(0,C.O)("roughness")],G.prototype,"_roughness",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"roughness",void 0),(0,S.b)([(0,C.O)()],G.prototype,"indexOfRefraction",void 0),(0,S.b)([(0,C.O)()],G.prototype,"invertRefractionY",void 0),(0,S.b)([(0,C.O)()],G.prototype,"alphaCutOff",void 0),(0,S.b)([(0,C.O)("useLightmapAsShadowmap")],G.prototype,"_useLightmapAsShadowmap",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useLightmapAsShadowmap",void 0),(0,S.b)([(0,C.v)("diffuseFresnelParameters")],G.prototype,"_diffuseFresnelParameters",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelDirty")],G.prototype,"diffuseFresnelParameters",void 0),(0,S.b)([(0,C.v)("opacityFresnelParameters")],G.prototype,"_opacityFresnelParameters",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelAndMiscDirty")],G.prototype,"opacityFresnelParameters",void 0),(0,S.b)([(0,C.v)("reflectionFresnelParameters")],G.prototype,"_reflectionFresnelParameters",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelDirty")],G.prototype,"reflectionFresnelParameters",void 0),(0,S.b)([(0,C.v)("refractionFresnelParameters")],G.prototype,"_refractionFresnelParameters",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelDirty")],G.prototype,"refractionFresnelParameters",void 0),(0,S.b)([(0,C.v)("emissiveFresnelParameters")],G.prototype,"_emissiveFresnelParameters",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelDirty")],G.prototype,"emissiveFresnelParameters",void 0),(0,S.b)([(0,C.O)("useReflectionFresnelFromSpecular")],G.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsFresnelDirty")],G.prototype,"useReflectionFresnelFromSpecular",void 0),(0,S.b)([(0,C.O)("useGlossinessFromSpecularMapAlpha")],G.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,S.b)([(0,C.O)("maxSimultaneousLights")],G.prototype,"_maxSimultaneousLights",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsLightsDirty")],G.prototype,"maxSimultaneousLights",void 0),(0,S.b)([(0,C.O)("invertNormalMapX")],G.prototype,"_invertNormalMapX",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"invertNormalMapX",void 0),(0,S.b)([(0,C.O)("invertNormalMapY")],G.prototype,"_invertNormalMapY",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"invertNormalMapY",void 0),(0,S.b)([(0,C.O)("twoSidedLighting")],G.prototype,"_twoSidedLighting",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"twoSidedLighting",void 0),(0,S.b)([(0,C.O)("applyDecalMapAfterDetailMap")],G.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,S.b)([(0,C.e)("_markAllSubMeshesAsMiscDirty")],G.prototype,"applyDecalMapAfterDetailMap",void 0),(0,O.f)("BABYLON.StandardMaterial",G),F.c.DefaultMaterialFactory=f=>new G("default material",f)},12102:(f,z,w)=>{"use strict";w.d(z,{c:()=>u});var S=w(720),C=w(762),E=w(525),F=w(795),J=w(848);w(12105);function x(f){let z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const w=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],E=[];let x=[];const u=f.width||f.size||1,h=f.height||f.size||1,X=f.depth||f.size||1,K=f.wrap||!1;let c=void 0===f.topBaseAt?1:f.topBaseAt,y=void 0===f.bottomBaseAt?0:f.bottomBaseAt;c=(c+4)%4,y=(y+4)%4;let e=[2,0,3,1][c],O=[2,0,1,3][y],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(K){z=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let f=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],w=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const S=[17,18,19,16],C=[22,23,20,21];for(;e>0;)f.unshift(f.pop()),S.unshift(S.pop()),e--;for(;O>0;)w.unshift(w.pop()),C.unshift(C.pop()),O--;f=f.flat(),w=w.flat(),d=d.concat(f).concat(w),z.push(S[0],S[2],S[3],S[0],S[1],S[2]),z.push(C[0],C[2],C[3],C[0],C[1],C[2])}const B=[u/2,h/2,X/2];x=d.reduce(((f,z,w)=>f.concat(z*B[w%3])),[]);const V=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,W=f.faceUV||new Array(6),T=f.faceColors,v=[];for(let F=0;F<6;F++)void 0===W[F]&&(W[F]=new S.p(0,0,1,1)),T&&void 0===T[F]&&(T[F]=new C.f(1,1,1,1));for(let S=0;S<6;S++)if(E.push(W[S].z,J.c?1-W[S].w:W[S].w),E.push(W[S].x,J.c?1-W[S].w:W[S].w),E.push(W[S].x,J.c?1-W[S].y:W[S].y),E.push(W[S].z,J.c?1-W[S].y:W[S].y),T)for(let f=0;f<4;f++)v.push(T[S].r,T[S].g,T[S].b,T[S].a);F.d._ComputeSides(V,x,z,w,E,f.frontUVs,f.backUVs);const D=new F.d;if(D.indices=z,D.xa=x,D.ya=w,D.Aa=E,T){const f=V===F.d.DOUBLESIDE?v.concat(v):v;D.za=f}return D}function u(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new E.b(f,w);z.sideOrientation=E.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return x(z).Ca(S,z.updatable),S}F.d.CreateBox=x,E.b.CreateBox=function(f,z){return u(f,{size:z,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12105:(f,z,w)=>{"use strict";w.d(z,{f:()=>O,d:()=>B,j:()=>d});var S=w(720),C=w(762),E=w(525),F=w(795),J=w(789);E.b._GroundMeshParser=(f,z)=>x.Parse(f,z);class x extends E.b{constructor(f,z){super(f,z),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=f,this._subdivisionsY=f,this.subdivide(f);const w=this;w.createOrUpdateSubmeshesOctree&&w.createOrUpdateSubmeshesOctree(z)}getHeightAtCoordinates(f,z){const w=this.getWorldMatrix(),C=S.j.Matrix[5];w.invertToRef(C);const E=S.j.ek[8];if(S.n.TransformCoordinatesFromFloatsToRef(f,0,z,C,E),f=E.x,z=E.z,f<this._minX||f>=this._maxX||z<=this._minZ||z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(f,z),J=-(F.x*f+F.z*z+F.w)/F.y;return S.n.TransformCoordinatesFromFloatsToRef(0,J,0,w,E),E.y}getNormalAtCoordinates(f,z){const w=new S.n(0,1,0);return this.getNormalAtCoordinatesToRef(f,z,w),w}getNormalAtCoordinatesToRef(f,z,w){const C=this.getWorldMatrix(),E=S.j.Matrix[5];C.invertToRef(E);const F=S.j.ek[8];if(S.n.TransformCoordinatesFromFloatsToRef(f,0,z,E,F),f=F.x,z=F.z,f<this._minX||f>this._maxX||z<this._minZ||z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const J=this._getFacetAt(f,z);return S.n.TransformNormalFromFloatsToRef(J.x,J.y,J.z,C,w),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(f,z){const w=Math.floor((f+this._maxX)*this._subdivisionsX/this._width),S=Math.floor(-(z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),C=this._heightQuads[S*this._subdivisionsX+w];let E;return E=z<C.slope.x*f+C.slope.y?C.facet1:C.facet2,E}_initHeightQuads(){const f=this._subdivisionsX,z=this._subdivisionsY;this._heightQuads=new Array;for(let w=0;w<z;w++)for(let z=0;z<f;z++){const C={slope:S.l.Zero(),facet1:new S.p(0,0,0,0),facet2:new S.p(0,0,0,0)};this._heightQuads[w*f+z]=C}return this}_computeHeightQuads(){const f=this.getVerticesData(J.f.PositionKind);if(!f)return this;const z=S.j.ek[3],w=S.j.ek[2],C=S.j.ek[1],E=S.j.ek[0],F=S.j.ek[4],x=S.j.ek[5],u=S.j.ek[6],h=S.j.ek[7],X=S.j.ek[8];let K=0,c=0,y=0,e=0,O=0,d=0,B=0;const V=this._subdivisionsX,W=this._subdivisionsY;for(let J=0;J<W;J++)for(let W=0;W<V;W++){K=3*W,c=J*(V+1)*3,y=(J+1)*(V+1)*3,z.x=f[c+K],z.y=f[c+K+1],z.z=f[c+K+2],w.x=f[c+K+3],w.y=f[c+K+4],w.z=f[c+K+5],C.x=f[y+K],C.y=f[y+K+1],C.z=f[y+K+2],E.x=f[y+K+3],E.y=f[y+K+4],E.z=f[y+K+5],e=(E.z-z.z)/(E.x-z.x),O=z.z-e*z.x,w.subtractToRef(z,F),C.subtractToRef(z,x),E.subtractToRef(z,u),S.n.CrossToRef(u,x,h),S.n.CrossToRef(F,u,X),h.normalize(),X.normalize(),d=-(h.x*z.x+h.y*z.y+h.z*z.z),B=-(X.x*w.x+X.y*w.y+X.z*w.z);const T=this._heightQuads[J*V+W];T.slope.Gd(e,O),T.facet1.Gd(h.x,h.y,h.z,d),T.facet2.Gd(X.x,X.y,X.z,B)}return this}serialize(f){super.serialize(f),f.subdivisionsX=this._subdivisionsX,f.subdivisionsY=this._subdivisionsY,f.minX=this._minX,f.maxX=this._maxX,f.Zj=this._minZ,f.maxZ=this._maxZ,f.width=this._width,f.height=this._height}static Parse(f,z){const w=new x(f.name,z);return w._subdivisionsX=f.subdivisionsX||1,w._subdivisionsY=f.subdivisionsY||1,w._minX=f.minX,w._maxX=f.maxX,w._minZ=f.Zj,w._maxZ=f.maxZ,w._width=f.width,w._height=f.height,w}}var u=w(535),h=w(580),X=w(726),K=w(848);function c(f){const z=[],w=[],C=[],E=[];let J,x;const u=f.width||f.size||1,h=f.height||f.size||1,X=0|(f.subdivisionsX||f.subdivisions||1),c=0|(f.subdivisionsY||f.subdivisions||1);for(J=0;J<=c;J++)for(x=0;x<=X;x++){const f=new S.n(x*u/X-u/2,0,(c-J)*h/c-h/2),z=new S.n(0,1,0);w.push(f.x,f.y,f.z),C.push(z.x,z.y,z.z),E.push(x/X,K.c?J/c:1-J/c)}for(J=0;J<c;J++)for(x=0;x<X;x++)z.push(x+1+(J+1)*(X+1)),z.push(x+1+J*(X+1)),z.push(x+J*(X+1)),z.push(x+(J+1)*(X+1)),z.push(x+1+(J+1)*(X+1)),z.push(x+J*(X+1));const y=new F.d;return y.indices=z,y.xa=w,y.ya=C,y.Aa=E,y}function y(f){const z=void 0!==f.xmin&&null!==f.xmin?f.xmin:-1,w=void 0!==f.zmin&&null!==f.zmin?f.zmin:-1,C=void 0!==f.xmax&&null!==f.xmax?f.xmax:1,E=void 0!==f.zmax&&null!==f.zmax?f.zmax:1,J=f.subdivisions||{w:1,h:1},x=f.precision||{w:1,h:1},u=[],h=[],X=[],K=[];let c,y,e,O;J.h=J.h<1?1:J.h,J.w=J.w<1?1:J.w,x.w=x.w<1?1:x.w,x.h=x.h<1?1:x.h;const d=(C-z)/J.w,B=(E-w)/J.h;function V(f,z,w,C){const E=h.length/3,F=x.w+1;for(c=0;c<x.h;c++)for(y=0;y<x.w;y++){const f=[E+y+c*F,E+(y+1)+c*F,E+(y+1)+(c+1)*F,E+y+(c+1)*F];u.push(f[1]),u.push(f[2]),u.push(f[3]),u.push(f[0]),u.push(f[1]),u.push(f[3])}const J=S.n.Zero(),e=new S.n(0,1,0);for(c=0;c<=x.h;c++)for(J.z=c*(C-z)/x.h+z,y=0;y<=x.w;y++)J.x=y*(w-f)/x.w+f,J.y=0,h.push(J.x,J.y,J.z),X.push(e.x,e.y,e.z),K.push(y/x.w,c/x.h)}for(e=0;e<J.h;e++)for(O=0;O<J.w;O++)V(z+O*d,w+e*B,z+(O+1)*d,w+(e+1)*B);const W=new F.d;return W.indices=u,W.xa=h,W.ya=X,W.Aa=K,W}function e(f){const z=[],w=[],E=[],J=[];let x,u;const h=f.colorFilter||new C.d(.3,.59,.11),K=f.alphaFilter||0;let c=!1;if(f.minHeight>f.maxHeight){c=!0;const z=f.maxHeight;f.maxHeight=f.minHeight,f.minHeight=z}for(x=0;x<=f.subdivisions;x++)for(u=0;u<=f.subdivisions;u++){const z=new S.n(u*f.width/f.subdivisions-f.width/2,0,(f.subdivisions-x)*f.height/f.subdivisions-f.height/2),C=4*(((z.x+f.width/2)/f.width*(f.bufferWidth-1)|0)+((1-(z.z+f.height/2)/f.height)*(f.bufferHeight-1)|0)*f.bufferWidth);let F=f.buffer[C]/255,y=f.buffer[C+1]/255,e=f.buffer[C+2]/255;const O=f.buffer[C+3]/255;c&&(F=1-F,y=1-y,e=1-e);const d=F*h.r+y*h.g+e*h.b;z.y=O>=K?f.minHeight+(f.maxHeight-f.minHeight)*d:f.minHeight-X.e,f.heightBuffer&&(f.heightBuffer[x*(f.subdivisions+1)+u]=z.y),w.push(z.x,z.y,z.z),E.push(0,0,0),J.push(u/f.subdivisions,1-x/f.subdivisions)}for(x=0;x<f.subdivisions;x++)for(u=0;u<f.subdivisions;u++){const S=u+1+(x+1)*(f.subdivisions+1),C=u+1+x*(f.subdivisions+1),E=u+x*(f.subdivisions+1),F=u+(x+1)*(f.subdivisions+1),J=w[3*S+1]>=f.minHeight,h=w[3*C+1]>=f.minHeight,X=w[3*E+1]>=f.minHeight;J&&h&&X&&(z.push(S),z.push(C),z.push(E));w[3*F+1]>=f.minHeight&&J&&X&&(z.push(F),z.push(S),z.push(E))}F.d.ComputeNormals(w,z,E);const y=new F.d;return y.indices=z,y.xa=w,y.ya=E,y.Aa=J,y}function O(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const w=new x(f,arguments.length>2?arguments[2]:void 0);w._setReady(!1),w._subdivisionsX=z.subdivisionsX||z.subdivisions||1,w._subdivisionsY=z.subdivisionsY||z.subdivisions||1,w._width=z.width||1,w._height=z.height||1,w._maxX=w._width/2,w._maxZ=w._height/2,w._minX=-w._maxX,w._minZ=-w._maxZ;return c(z).Ca(w,z.updatable),w._setReady(!0),w}function d(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new E.b(f,w);return y(z).Ca(S,z.updatable),S}function B(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=w.width||10,F=w.height||10,J=w.subdivisions||1,X=w.minHeight||0,K=w.maxHeight||1,c=w.colorFilter||new C.d(.3,.59,.11),y=w.alphaFilter||0,O=w.updatable,d=w.onReady;S=S||h.c.LastCreatedScene;const B=new x(f,S);let V;B._subdivisionsX=J,B._subdivisionsY=J,B._width=E,B._height=F,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ,B._setReady(!1),w.passHeightBufferInCallback&&(V=new Float32Array((J+1)*(J+1)));const W=(f,z,w)=>{e({width:E,height:F,subdivisions:J,minHeight:X,maxHeight:K,colorFilter:c,buffer:f,bufferWidth:z,bufferHeight:w,alphaFilter:y,heightBuffer:V}).Ca(B,O),d&&d(B,V),B._setReady(!0)};if("string"===typeof z){const f=f=>{var z;const w=f.width,C=f.height;if(S.u)return;const E=null===(z=S)||void 0===z?void 0:z.getEngine().resizeImageBitmap(f,w,C);W(E,w,C)};u.h.LoadImage(z,f,w.onError?w.onError:()=>{},S.offlineProvider)}else W(z.data,z.width,z.height);return B}F.d.CreateGround=c,F.d.CreateTiledGround=y,F.d.CreateGroundFromHeightMap=e,E.b.CreateGround=(f,z,w,S,C,E)=>O(f,{width:z,height:w,subdivisions:S,updatable:E},C),E.b.CreateTiledGround=(f,z,w,S,C,E,F,J,x)=>d(f,{xmin:z,zmin:w,xmax:S,zmax:C,subdivisions:E,precision:F,updatable:x},J),E.b.CreateGroundFromHeightMap=(f,z,w,S,C,E,F,J,x,u,h)=>B(f,z,{width:w,height:S,subdivisions:C,minHeight:E,maxHeight:F,updatable:x,onReady:u,alphaFilter:h},J)},12891:(f,z,w)=>{"use strict";w.d(z,{c:()=>P,g:()=>I,j:()=>n});var S=w(720),C=w(525),E=w(795),F=w(762),J=w(789),x=w(12678),u=w(878),h=w(753),X=w(2386),K=w(2321),c=w(665),y=w(12078),e=w(573),O=w(12067),d=w(580),B=w(901),V=w(885);const W={effect:null,subMesh:null};class T extends O.c{constructor(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(f,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new S.b,this._cachedWorldViewProjectionMatrix=new S.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=w,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","lk","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...C}}get shaderPath(){return this._shaderPath}set shaderPath(f){this._shaderPath=f}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(f){-1===this._options.uniforms.indexOf(f)&&this._options.uniforms.push(f)}setTexture(f,z){return-1===this._options.samplers.indexOf(f)&&this._options.samplers.push(f),this._textures[f]=z,this}removeTexture(f){delete this._textures[f]}setTextureArray(f,z){return-1===this._options.samplers.indexOf(f)&&this._options.samplers.push(f),this._checkUniform(f),this._textureArrays[f]=z,this}setExternalTexture(f,z){return-1===this._options.externalTextures.indexOf(f)&&this._options.externalTextures.push(f),this._externalTextures[f]=z,this}setFloat(f,z){return this._checkUniform(f),this._floats[f]=z,this}setInt(f,z){return this._checkUniform(f),this._ints[f]=z,this}setUInt(f,z){return this._checkUniform(f),this._uints[f]=z,this}setFloats(f,z){return this._checkUniform(f),this._floatsArrays[f]=z,this}setColor3(f,z){return this._checkUniform(f),this._colors3[f]=z,this}setColor3Array(f,z){return this._checkUniform(f),this._colors3Arrays[f]=z.reduce(((f,z)=>(z.toArray(f,f.length),f)),[]),this}setColor4(f,z){return this._checkUniform(f),this._colors4[f]=z,this}setColor4Array(f,z){return this._checkUniform(f),this._colors4Arrays[f]=z.reduce(((f,z)=>(z.toArray(f,f.length),f)),[]),this}setVector2(f,z){return this._checkUniform(f),this._vectors2[f]=z,this}setVector3(f,z){return this._checkUniform(f),this._vectors3[f]=z,this}setVector4(f,z){return this._checkUniform(f),this._vectors4[f]=z,this}setQuaternion(f,z){return this._checkUniform(f),this._quaternions[f]=z,this}setQuaternionArray(f,z){return this._checkUniform(f),this._quaternionsArrays[f]=z.reduce(((f,z)=>(z.toArray(f,f.length),f)),[]),this}setMatrix(f,z){return this._checkUniform(f),this._matrices[f]=z,this}setMatrices(f,z){this._checkUniform(f);const w=new Float32Array(16*z.length);for(let S=0;S<z.length;S++){z[S].copyToArray(w,16*S)}return this._matrixArrays[f]=w,this}setMatrix3x3(f,z){return this._checkUniform(f),this._matrices3x3[f]=z,this}setMatrix2x2(f,z){return this._checkUniform(f),this._matrices2x2[f]=z,this}setArray2(f,z){return this._checkUniform(f),this._vectors2Arrays[f]=z,this}setArray3(f,z){return this._checkUniform(f),this._vectors3Arrays[f]=z,this}setArray4(f,z){return this._checkUniform(f),this._vectors4Arrays[f]=z,this}setUniformBuffer(f,z){return-1===this._options.uniformBuffers.indexOf(f)&&this._options.uniformBuffers.push(f),this._uniformBuffers[f]=z,this}setTextureSampler(f,z){return-1===this._options.samplerObjects.indexOf(f)&&this._options.samplerObjects.push(f),this._textureSamplers[f]=z,this}setStorageBuffer(f,z){return-1===this._options.storageBuffers.indexOf(f)&&this._options.storageBuffers.push(f),this._storageBuffers[f]=z,this}setDefine(f,z){const w=f.trimEnd()+" ",S=this.options.defines.findIndex((z=>z===f||z.startsWith(w)));return S>=0&&this.options.defines.splice(S,1),("boolean"!==typeof z||z)&&this.options.defines.push(w+z),this}isReadyForSubMesh(f,z,w){return this.isReady(f,w,z)}isReady(f,z,w){var S;const C=w&&this._storeEffectOnSubMeshes;if(this.isFrozen){const f=C?w._drawWrapper:this._drawWrapper;if(f.effect&&f._wasPreviouslyReady&&f._wasPreviouslyUsingInstances===z)return!0}const E=this.va(),F=E.getEngine(),x=[],u=[],h=new y.e;let K=this._shaderPath,c=this._options.uniforms,e=this._options.uniformBuffers,O=this._options.samplers;F.getCaps().multiview&&E.activeCamera&&E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,x.push("#define MULTIVIEW"),-1!==c.indexOf("viewProjection")&&-1===c.indexOf("viewProjectionR")&&c.push("viewProjectionR"));for(let J=0;J<this._options.defines.length;J++){const f=0===this._options.defines[J].indexOf("#define")?this._options.defines[J]:`#define ${this._options.defines[J]}`;x.push(f)}for(let J=0;J<this._options.attributes.length;J++)u.push(this._options.attributes[J]);if(f&&f.isVerticesDataPresent(J.f.ColorKind)&&(-1===u.indexOf(J.f.ColorKind)&&u.push(J.f.ColorKind),x.push("#define VERTEXCOLOR")),z&&(x.push("#define INSTANCES"),(0,V.ab)(u,this._materialHelperNeedsPreviousMatrices),null!==f&&void 0!==f&&f.hasThinInstances&&(x.push("#define THIN_INSTANCES"),f&&f.isVerticesDataPresent(J.f.ColorInstanceKind)&&(u.push(J.f.ColorInstanceKind),x.push("#define INSTANCESCOLOR")))),f&&f.useBones&&f.computeBonesUsingShaders&&f.skeleton){u.push(J.f.MatricesIndicesKind),u.push(J.f.MatricesWeightsKind),f.numBoneInfluencers>4&&(u.push(J.f.MatricesIndicesExtraKind),u.push(J.f.MatricesWeightsExtraKind));const z=f.skeleton;x.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),h.addCPUSkinningFallback(0,f),z.isUsingTextureForMatrices?(x.push("#define BONETEXTURE"),-1===c.indexOf("boneTextureWidth")&&c.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(x.push("#define BonesPerMesh "+(z.bones.length+1)),-1===c.indexOf("mBones")&&c.push("mBones"))}else x.push("#define NUM_BONE_INFLUENCERS 0");let d=0;const T=f?f.morphTargetManager:null;if(T){const f=T.supportsUVs&&-1!==x.indexOf("#define UV1"),z=T.supportsTangents&&-1!==x.indexOf("#define TANGENT"),w=T.supportsNormals&&-1!==x.indexOf("#define NORMAL");d=T.numMaxInfluencers||T.numInfluencers,f&&x.push("#define MORPHTARGETS_UV"),z&&x.push("#define MORPHTARGETS_TANGENT"),w&&x.push("#define MORPHTARGETS_NORMAL"),d>0&&x.push("#define MORPHTARGETS"),T.isUsingTextureForTargets&&(x.push("#define MORPHTARGETS_TEXTURE"),-1===c.indexOf("morphTargetTextureIndices")&&c.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),x.push("#define NUM_MORPH_INFLUENCERS "+d);for(let S=0;S<d;S++)u.push(J.f.PositionKind+S),w&&u.push(J.f.NormalKind+S),z&&u.push(J.f.TangentKind+S),f&&u.push(J.f.UVKind+"_"+S);d>0&&(c=c.slice(),c.push("morphTargetInfluences"),c.push("morphTargetCount"),c.push("morphTargetTextureInfo"),c.push("morphTargetTextureIndices"))}else x.push("#define NUM_MORPH_INFLUENCERS 0");if(f){const z=f.bakedVertexAnimationManager;z&&z.isEnabled&&(x.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===c.indexOf("bakedVertexAnimationSettings")&&c.push("bakedVertexAnimationSettings"),-1===c.indexOf("bakedVertexAnimationTextureSizeInverted")&&c.push("bakedVertexAnimationTextureSizeInverted"),-1===c.indexOf("bakedVertexAnimationTime")&&c.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,V.s)(u,f,x)}for(const J in this._textures)if(!this._textures[J].isReady())return!1;f&&this._shouldTurnAlphaTestOn(f)&&x.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,B.c)(c),(0,B.j)(this,E,x)),E.fogEnabled&&null!==f&&void 0!==f&&f.applyFog&&E.fogMode!==X.c.FOGMODE_NONE&&(x.push("#define FOG"),-1===c.indexOf("view")&&c.push("view"),-1===c.indexOf("vFogInfos")&&c.push("vFogInfos"),-1===c.indexOf("vFogColor")&&c.push("vFogColor")),this._useLogarithmicDepth&&(x.push("#define LOGARITHMICDEPTH"),-1===c.indexOf("logarithmicDepthConstant")&&c.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(c=c.slice(),e=e.slice(),O=O.slice(),K=this.customShaderNameResolve(this.name,c,e,O,x,u));const v=C?w._getDrawWrapper(void 0,!0):this._drawWrapper,D=(null===v||void 0===v?void 0:v.effect)??null,A=(null===v||void 0===v?void 0:v.defines)??null,M=x.join("\n");let G=D;return A!==M&&(G=F.createEffect(K,{attributes:u,uniformsNames:c,uniformBuffersNames:e,samplers:O,defines:M,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:d},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},F),C?w.setEffect(G,M,this._materialContext):v&&v.setEffect(G,M),this._onEffectCreatedObservable&&(W.effect=G,W.subMesh=w??(null===f||void 0===f?void 0:f.pk[0])??null,this._onEffectCreatedObservable.notifyObservers(W))),v._wasPreviouslyUsingInstances=!!z,!((null===(S=G)||void 0===S||!S.isReady())??1)&&(D!==G&&E.resetCachedMaterial(),v._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(f,z){const w=this.va(),S=z??this.getEffect();S&&(-1!==this._options.uniforms.indexOf("world")&&S.setMatrix("world",f),-1!==this._options.uniforms.indexOf("worldView")&&(f.multiplyToRef(w.getViewMatrix(),this._cachedWorldViewMatrix),S.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(f.multiplyToRef(w.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),S.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&S.setMatrix("view",w.getViewMatrix()))}bindForSubMesh(f,z,w){var S;this.bind(f,z,null===(S=w._drawWrapperOverride)||void 0===S?void 0:S.effect,w)}bind(f,z,w,S){const C=S&&this._storeEffectOnSubMeshes,E=w??(C?S.effect:this.getEffect());if(!E)return;const F=this.va();this._activeEffect=E,this.bindOnlyWorldMatrix(f,w);const J=this._options.uniformBuffers;let x=!1;if(E&&J&&J.length>0&&F.getEngine().supportsUniformBuffers)for(let X=0;X<J.length;++X){switch(J[X]){case"Mesh":z&&(z.getMeshUniformBuffer().bindToEffect(E,"Mesh"),z.transferToEffect(f));break;case"Scene":(0,V.n)(E,F.getSceneUniformBuffer()),F.finalizeSceneUbo(),x=!0}}const u=z&&C?this._mustRebind(F,E,S,z.visibility):F.getCachedMaterial()!==this;if(E&&u){let f;for(f in x||-1===this._options.uniforms.indexOf("view")||E.setMatrix("view",F.getViewMatrix()),x||-1===this._options.uniforms.indexOf("projection")||E.setMatrix("projection",F.getProjectionMatrix()),x||-1===this._options.uniforms.indexOf("viewProjection")||(E.setMatrix("viewProjection",F.getTransformMatrix()),this._multiview&&E.setMatrix("viewProjectionR",F._transformMatrixR)),F.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&E.setVector3("cameraPosition",F.activeCamera.globalPosition),(0,V.b)(z,E),(0,B.g)(E,this,F),this._useLogarithmicDepth&&(0,V.h)(C?S.materialDefines:E.defines,E,F),z&&(0,V.d)(F,z,E),this._textures)E.setTexture(f,this._textures[f]);for(f in this._textureArrays)E.setTextureArray(f,this._textureArrays[f]);for(f in this._ints)E.setInt(f,this._ints[f]);for(f in this._uints)E.setUInt(f,this._uints[f]);for(f in this._floats)E.setFloat(f,this._floats[f]);for(f in this._floatsArrays)E.setArray(f,this._floatsArrays[f]);for(f in this._colors3)E.setColor3(f,this._colors3[f]);for(f in this._colors3Arrays)E.setArray3(f,this._colors3Arrays[f]);for(f in this._colors4){const z=this._colors4[f];E.setFloat4(f,z.r,z.g,z.b,z.a)}for(f in this._colors4Arrays)E.setArray4(f,this._colors4Arrays[f]);for(f in this._vectors2)E.setVector2(f,this._vectors2[f]);for(f in this._vectors3)E.setVector3(f,this._vectors3[f]);for(f in this._vectors4)E.setVector4(f,this._vectors4[f]);for(f in this._quaternions)E.setQuaternion(f,this._quaternions[f]);for(f in this._matrices)E.setMatrix(f,this._matrices[f]);for(f in this._matrixArrays)E.setMatrices(f,this._matrixArrays[f]);for(f in this._matrices3x3)E.setMatrix3x3(f,this._matrices3x3[f]);for(f in this._matrices2x2)E.setMatrix2x2(f,this._matrices2x2[f]);for(f in this._vectors2Arrays)E.setArray2(f,this._vectors2Arrays[f]);for(f in this._vectors3Arrays)E.setArray3(f,this._vectors3Arrays[f]);for(f in this._vectors4Arrays)E.setArray4(f,this._vectors4Arrays[f]);for(f in this._quaternionsArrays)E.setArray4(f,this._quaternionsArrays[f]);for(f in this._uniformBuffers){const z=this._uniformBuffers[f].getBuffer();z&&E.bindUniformBuffer(z,f)}const w=F.getEngine(),J=w.setExternalTexture;if(J)for(f in this._externalTextures)J.call(w,f,this._externalTextures[f]);const u=w.setTextureSampler;if(u)for(f in this._textureSamplers)u.call(w,f,this._textureSamplers[f]);const h=w.setStorageBuffer;if(h)for(f in this._storageBuffers)h.call(w,f,this._storageBuffers[f])}if(E&&z&&(u||!this.isFrozen)){const f=z.morphTargetManager;f&&f.numInfluencers>0&&(0,V.l)(z,E);const w=z.bakedVertexAnimationManager;if(w&&w.isEnabled){var h;const f=C?S._drawWrapper:this._drawWrapper;null===(h=z.bakedVertexAnimationManager)||void 0===h||h.bind(E,!!f._wasPreviouslyUsingInstances)}}this._afterBind(z,E,S)}getActiveTextures(){const f=super.getActiveTextures();for(const z in this._textures)f.push(this._textures[z]);for(const z in this._textureArrays){const w=this._textureArrays[z];for(let z=0;z<w.length;z++)f.push(w[z])}return f}hasTexture(f){if(super.hasTexture(f))return!0;for(const z in this._textures)if(this._textures[z]===f)return!0;for(const z in this._textureArrays){const w=this._textureArrays[z];for(let z=0;z<w.length;z++)if(w[z]===f)return!0}return!1}clone(f){const z=h.b.Clone((()=>new T(f,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);z.name=f,z.id=f,"object"===typeof z._shaderPath&&(z._shaderPath={...z._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((f=>{const z=this._options[f];Array.isArray(z)&&(this._options[f]=z.slice(0))})),this.stencil.copyTo(z.stencil);for(const w in this._textures)z.setTexture(w,this._textures[w]);for(const w in this._textureArrays)z.setTextureArray(w,this._textureArrays[w]);for(const w in this._externalTextures)z.setExternalTexture(w,this._externalTextures[w]);for(const w in this._ints)z.setInt(w,this._ints[w]);for(const w in this._uints)z.setUInt(w,this._uints[w]);for(const w in this._floats)z.setFloat(w,this._floats[w]);for(const w in this._floatsArrays)z.setFloats(w,this._floatsArrays[w]);for(const w in this._colors3)z.setColor3(w,this._colors3[w]);for(const w in this._colors3Arrays)z._colors3Arrays[w]=this._colors3Arrays[w];for(const w in this._colors4)z.setColor4(w,this._colors4[w]);for(const w in this._colors4Arrays)z._colors4Arrays[w]=this._colors4Arrays[w];for(const w in this._vectors2)z.setVector2(w,this._vectors2[w]);for(const w in this._vectors3)z.setVector3(w,this._vectors3[w]);for(const w in this._vectors4)z.setVector4(w,this._vectors4[w]);for(const w in this._quaternions)z.setQuaternion(w,this._quaternions[w]);for(const w in this._quaternionsArrays)z._quaternionsArrays[w]=this._quaternionsArrays[w];for(const w in this._matrices)z.setMatrix(w,this._matrices[w]);for(const w in this._matrixArrays)z._matrixArrays[w]=this._matrixArrays[w].slice();for(const w in this._matrices3x3)z.setMatrix3x3(w,this._matrices3x3[w]);for(const w in this._matrices2x2)z.setMatrix2x2(w,this._matrices2x2[w]);for(const w in this._vectors2Arrays)z.setArray2(w,this._vectors2Arrays[w]);for(const w in this._vectors3Arrays)z.setArray3(w,this._vectors3Arrays[w]);for(const w in this._vectors4Arrays)z.setArray4(w,this._vectors4Arrays[w]);for(const w in this._uniformBuffers)z.setUniformBuffer(w,this._uniformBuffers[w]);for(const w in this._textureSamplers)z.setTextureSampler(w,this._textureSamplers[w]);for(const w in this._storageBuffers)z.setStorageBuffer(w,this._storageBuffers[w]);return z}dispose(f,z,w){if(z){let f;for(f in this._textures)this._textures[f].dispose();for(f in this._textureArrays){const z=this._textureArrays[f];for(let f=0;f<z.length;f++)z[f].dispose()}}this._textures={},super.dispose(f,z,w)}serialize(){const f=h.b.Serialize(this);let z;for(z in f.customType="BABYLON.ShaderMaterial",f.uniqueId=this.uniqueId,f.options=this._options,f.shaderPath=this._shaderPath,f.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,f.stencil=this.stencil.serialize(),f.textures={},this._textures)f.textures[z]=this._textures[z].serialize();for(z in f.textureArrays={},this._textureArrays){f.textureArrays[z]=[];const w=this._textureArrays[z];for(let S=0;S<w.length;S++)f.textureArrays[z].push(w[S].serialize())}for(z in f.ints={},this._ints)f.ints[z]=this._ints[z];for(z in f.uints={},this._uints)f.uints[z]=this._uints[z];for(z in f.floats={},this._floats)f.floats[z]=this._floats[z];for(z in f.floatsArrays={},this._floatsArrays)f.floatsArrays[z]=this._floatsArrays[z];for(z in f.colors3={},this._colors3)f.colors3[z]=this._colors3[z].kk();for(z in f.colors3Arrays={},this._colors3Arrays)f.colors3Arrays[z]=this._colors3Arrays[z];for(z in f.colors4={},this._colors4)f.colors4[z]=this._colors4[z].kk();for(z in f.colors4Arrays={},this._colors4Arrays)f.colors4Arrays[z]=this._colors4Arrays[z];for(z in f.vectors2={},this._vectors2)f.vectors2[z]=this._vectors2[z].kk();for(z in f.vectors3={},this._vectors3)f.vectors3[z]=this._vectors3[z].kk();for(z in f.vectors4={},this._vectors4)f.vectors4[z]=this._vectors4[z].kk();for(z in f.quaternions={},this._quaternions)f.quaternions[z]=this._quaternions[z].kk();for(z in f.matrices={},this._matrices)f.matrices[z]=this._matrices[z].kk();for(z in f.matrixArray={},this._matrixArrays)f.matrixArray[z]=this._matrixArrays[z];for(z in f.matrices3x3={},this._matrices3x3)f.matrices3x3[z]=this._matrices3x3[z];for(z in f.matrices2x2={},this._matrices2x2)f.matrices2x2[z]=this._matrices2x2[z];for(z in f.vectors2Arrays={},this._vectors2Arrays)f.vectors2Arrays[z]=this._vectors2Arrays[z];for(z in f.vectors3Arrays={},this._vectors3Arrays)f.vectors3Arrays[z]=this._vectors3Arrays[z];for(z in f.vectors4Arrays={},this._vectors4Arrays)f.vectors4Arrays[z]=this._vectors4Arrays[z];for(z in f.quaternionsArrays={},this._quaternionsArrays)f.quaternionsArrays[z]=this._quaternionsArrays[z];return f}static Parse(f,z,w){const C=h.b.Parse((()=>new T(f.name,z,f.shaderPath,f.options,f.storeEffectOnSubMeshes)),f,z,w);let E;for(E in f.stencil&&C.stencil.parse(f.stencil,z,w),f.textures)C.setTexture(E,K.b.Parse(f.textures[E],z,w));for(E in f.textureArrays){const S=f.textureArrays[E],F=[];for(let f=0;f<S.length;f++)F.push(K.b.Parse(S[f],z,w));C.setTextureArray(E,F)}for(E in f.ints)C.setInt(E,f.ints[E]);for(E in f.uints)C.setUInt(E,f.uints[E]);for(E in f.floats)C.setFloat(E,f.floats[E]);for(E in f.floatsArrays)C.setFloats(E,f.floatsArrays[E]);for(E in f.colors3)C.setColor3(E,F.d.ck(f.colors3[E]));for(E in f.colors3Arrays){const z=f.colors3Arrays[E].reduce(((f,z,w)=>(w%3===0?f.push([z]):f[f.length-1].push(z),f)),[]).map((f=>F.d.ck(f)));C.setColor3Array(E,z)}for(E in f.colors4)C.setColor4(E,F.f.ck(f.colors4[E]));for(E in f.colors4Arrays){const z=f.colors4Arrays[E].reduce(((f,z,w)=>(w%4===0?f.push([z]):f[f.length-1].push(z),f)),[]).map((f=>F.f.ck(f)));C.setColor4Array(E,z)}for(E in f.vectors2)C.setVector2(E,S.l.ck(f.vectors2[E]));for(E in f.vectors3)C.setVector3(E,S.n.ck(f.vectors3[E]));for(E in f.vectors4)C.setVector4(E,S.p.ck(f.vectors4[E]));for(E in f.quaternions)C.setQuaternion(E,S.f.ck(f.quaternions[E]));for(E in f.matrices)C.setMatrix(E,S.b.ck(f.matrices[E]));for(E in f.matrixArray)C._matrixArrays[E]=new Float32Array(f.matrixArray[E]);for(E in f.matrices3x3)C.setMatrix3x3(E,f.matrices3x3[E]);for(E in f.matrices2x2)C.setMatrix2x2(E,f.matrices2x2[E]);for(E in f.vectors2Arrays)C.setArray2(E,f.vectors2Arrays[E]);for(E in f.vectors3Arrays)C.setArray3(E,f.vectors3Arrays[E]);for(E in f.vectors4Arrays)C.setArray4(E,f.vectors4Arrays[E]);for(E in f.quaternionsArrays)C.setArray4(E,f.quaternionsArrays[E]);return C}static ParseFromFileAsync(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((C,E)=>{const F=new e.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const z=JSON.parse(F.responseText),E=this.Parse(z,w||d.c.LastCreatedScene,S);f&&(E.name=f),C(E)}else E("Unable to load the ShaderMaterial")})),F.open("GET",z),F.send()}))}static ParseFromSnippetAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((S,C)=>{const E=new e.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const C=JSON.parse(JSON.parse(E.responseText).jsonPayload),F=JSON.parse(C.shaderMaterial),J=this.Parse(F,z||d.c.LastCreatedScene,w);J.snippetId=f,S(J)}else C("Unable to load the snippet "+f)})),E.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),E.send()}))}}T.SnippetUrl="https://snippet.babylonjs.com",T.CreateFromSnippetAsync=T.ParseFromSnippetAsync,(0,c.f)("BABYLON.ShaderMaterial",T),C.b._LinesMeshParser=(f,z)=>v.Parse(f,z);class v extends C.b{_isShaderMaterial(f){return"ShaderMaterial"===f.getClassName()}constructor(f){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0;super(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z,arguments.length>4?arguments[4]:void 0),this.useVertexColor=S,this.useVertexAlpha=C,this.color=new F.d(1,1,1),this.alpha=1,this._shaderLanguage=0,z&&(this.color=z.color.clone(),this.alpha=z.alpha,this.useVertexColor=z.useVertexColor,this.useVertexAlpha=z.useVertexAlpha),this.intersectionThreshold=.1;const x={attributes:[J.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===C?x.needAlphaBlending=!1:x.defines.push("#define VERTEXALPHA"),S?(x.defines.push("#define VERTEXCOLOR"),x.attributes.push(J.f.ColorKind)):(x.uniforms.push("color"),this._color4=new F.f),E)this.material=E;else{this.va().getEngine().isWebGPU&&!v.ForceGLSL&&(this._shaderLanguage=1),x.shaderLanguage=this._shaderLanguage,x.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([w.e(42).then(w.bind(w,13734)),w.e(53).then(w.bind(w,13736))]):await Promise.all([w.e(47).then(w.bind(w,13743)),w.e(54).then(w.bind(w,13752))])},this.material=new T("colorShader",this.va(),"color",x,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(f){this._lineMaterial=f,this._lineMaterial.fillMode=u.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(f){}_bind(f,z){if(!this._geometry)return this;const w=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(z,w):this._geometry._bind(z,w,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:f,g:z,b:w}=this.color;this._color4.set(f,z,w,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(f,z,w){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const S=this.va().getEngine();return this._unIndexed?S.drawArraysType(u.e.LineListDrawMode,f.verticesStart,f.verticesCount,w):S.drawElementsType(u.e.LineListDrawMode,f.indexStart,f.indexCount,w),this}dispose(f){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(f)}clone(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0;return new v(f,this.va(),z,this,w)}createInstance(f){const z=new D(f,this);if(this.instancedBuffers){z.instancedBuffers={};for(const f in this.instancedBuffers)z.instancedBuffers[f]=this.instancedBuffers[f]}return z}serialize(f){super.serialize(f),f.color=this.color.kk(),f.alpha=this.alpha}static Parse(f,z){const w=new v(f.name,z);return w.color=F.d.ck(f.color),w.alpha=f.alpha,w}}v.ForceGLSL=!1;class D extends x.d{constructor(f,z){super(f,z),this.intersectionThreshold=z.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var A=w(548);function M(f){const z=[],w=[],S=f.lines,C=f.za,F=[];let J=0;for(let E=0;E<S.length;E++){const f=S[E];for(let S=0;S<f.length;S++){const{x:x,y:u,z:h}=f[S];if(w.push(x,u,h),C){const f=C[E],{r:z,g:w,b:J,a:x}=f[S];F.push(z,w,J,x)}S>0&&(z.push(J-1),z.push(J)),J++}}const x=new E.d;return x.indices=z,x.xa=w,C&&(x.za=F),x}function G(f){const z=f.dashSize||3,w=f.gapSize||1,C=f.dashNb||200,F=f.points,J=[],x=[],u=S.n.Zero();let h=0,X=0,K=0,c=0,y=0,e=0,O=0;for(O=0;O<F.length-1;O++)F[O+1].subtractToRef(F[O],u),h+=u.length();for(K=h/C,c=z*K/(z+w),O=0;O<F.length-1;O++){F[O+1].subtractToRef(F[O],u),X=Math.floor(u.length()/K),u.normalize();for(let f=0;f<X;f++)y=K*f,J.push(F[O].x+y*u.x,F[O].y+y*u.y,F[O].z+y*u.z),J.push(F[O].x+(y+c)*u.x,F[O].y+(y+c)*u.y,F[O].z+(y+c)*u.z),x.push(e,e+1),e+=2}const d=new E.d;return d.xa=J,d.indices=x,d}function I(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=z.instance,C=z.lines,E=z.za;if(S){const f=S.getVerticesData(J.f.PositionKind);let z,w;E&&(z=S.getVerticesData(J.f.ColorKind));let F=0,x=0;for(let S=0;S<C.length;S++){const J=C[S];for(let C=0;C<J.length;C++)f[F]=J[C].x,f[F+1]=J[C].y,f[F+2]=J[C].z,E&&z&&(w=E[S],z[x]=w[C].r,z[x+1]=w[C].g,z[x+2]=w[C].b,z[x+3]=w[C].a,x+=4),F+=3}return S.updateVerticesData(J.f.PositionKind,f,!1,!1),E&&z&&S.updateVerticesData(J.f.ColorKind,z,!1,!1),S.refreshBoundingInfo(),S}const F=new v(f,w,null,void 0,void 0,!!E,z.useVertexAlpha,z.material);return M(z).Ca(F,z.updatable),F}function n(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=z.za?[z.za]:null;return I(f,{lines:[z.points],updatable:z.updatable,instance:z.instance,za:S,useVertexAlpha:z.useVertexAlpha,material:z.material},w)}function P(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=z.points,F=z.instance,J=z.gapSize||1,x=z.dashSize||3;if(F){const f=f=>{const z=S.n.Zero(),w=f.length/6;let C=0,J=0,x=0,u=0,h=0,X=0,K=0,c=0;for(K=0;K<E.length-1;K++)E[K+1].subtractToRef(E[K],z),C+=z.length();x=C/w;const y=F._creationDataStorage.dashSize;for(u=y*x/(y+F._creationDataStorage.gapSize),K=0;K<E.length-1;K++)for(E[K+1].subtractToRef(E[K],z),J=Math.floor(z.length()/x),z.normalize(),c=0;c<J&&X<f.length;)h=x*c,f[X]=E[K].x+h*z.x,f[X+1]=E[K].y+h*z.y,f[X+2]=E[K].z+h*z.z,f[X+3]=E[K].x+(h+u)*z.x,f[X+4]=E[K].y+(h+u)*z.y,f[X+5]=E[K].z+(h+u)*z.z,X+=6,c++;for(;X<f.length;)f[X]=E[K].x,f[X+1]=E[K].y,f[X+2]=E[K].z,X+=3};return(z.dashNb||z.dashSize||z.gapSize||z.useVertexAlpha||z.material)&&A.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),F.updateMeshPositions(f,!1),F}const u=new v(f,w,null,void 0,void 0,void 0,z.useVertexAlpha,z.material);return G(z).Ca(u,z.updatable),u._creationDataStorage=new C.e,u._creationDataStorage.dashSize=x,u._creationDataStorage.gapSize=J,u}E.d.CreateLineSystem=M,E.d.CreateDashedLines=G,C.b.Fk=function(f,z){return n(f,{points:z,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},C.b.CreateDashedLines=function(f,z,w,S,C){return P(f,{points:z,dashSize:w,gapSize:S,dashNb:C,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12146:(f,z,w)=>{"use strict";w.d(z,{d:()=>J,g:()=>x});var S=w(525),C=w(795),E=w(848);function F(f){const z=[],w=[],S=[],F=[],J=f.width||f.size||1,x=f.height||f.size||1,u=0===f.sideOrientation?0:f.sideOrientation||C.d.DEFAULTSIDE,h=J/2,X=x/2;w.push(-h,-X,0),S.push(0,0,-1),F.push(0,E.c?1:0),w.push(h,-X,0),S.push(0,0,-1),F.push(1,E.c?1:0),w.push(h,X,0),S.push(0,0,-1),F.push(1,E.c?0:1),w.push(-h,X,0),S.push(0,0,-1),F.push(0,E.c?0:1),z.push(0),z.push(1),z.push(2),z.push(0),z.push(2),z.push(3),C.d._ComputeSides(u,w,z,S,F,f.frontUVs,f.backUVs);const K=new C.d;return K.indices=z,K.xa=w,K.ya=S,K.Aa=F,K}function J(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new S.b(f,w);z.sideOrientation=S.b._GetDefaultSideOrientation(z.sideOrientation),C._originalBuilderSideOrientation=z.sideOrientation;return F(z).Ca(C,z.updatable),z.sourcePlane&&(C.translate(z.sourcePlane.lk,-z.sourcePlane.d),C.setDirection(z.sourcePlane.lk.scale(-1))),C}const x={Gk:J};C.d.Gk=F,S.b.Gk=(f,z,w,S,C)=>J(f,{size:z,width:z,height:z,sideOrientation:C,updatable:S},w)},12304:(f,z,w)=>{"use strict";w.d(z,{d:()=>x});var S=w(720),C=w(525),E=w(795),F=w(848);function J(f){const z=0|(f.segments||32),w=f.diameterX||f.diameter||1,C=f.diameterY||f.diameter||1,J=f.diameterZ||f.diameter||1,x=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,u=f.slice&&f.slice<=0?1:f.slice||1,h=0===f.sideOrientation?0:f.sideOrientation||E.d.DEFAULTSIDE,X=!!f.dedupTopBottomIndices,K=new S.n(w/2,C/2,J/2),c=2+z,y=2*c,e=[],O=[],d=[],B=[];for(let E=0;E<=c;E++){const f=E/c,z=f*Math.PI*u;for(let w=0;w<=y;w++){const C=w/y,E=C*Math.PI*2*x,J=S.b.RotationZ(-z),u=S.b.RotationY(E),h=S.n.TransformCoordinates(S.n.Up(),J),X=S.n.TransformCoordinates(h,u),c=X.multiply(K),e=X.divide(K).normalize();O.push(c.x,c.y,c.z),d.push(e.x,e.y,e.z),B.push(C,F.c?1-f:f)}if(E>0){const f=O.length/3;for(let z=f-2*(y+1);z+y+2<f;z++)X?(E>1&&(e.push(z),e.push(z+1),e.push(z+y+1)),(E<c||u<1)&&(e.push(z+y+1),e.push(z+1),e.push(z+y+2))):(e.push(z),e.push(z+1),e.push(z+y+1),e.push(z+y+1),e.push(z+1),e.push(z+y+2))}}E.d._ComputeSides(h,O,e,d,B,f.frontUVs,f.backUVs);const V=new E.d;return V.indices=e,V.xa=O,V.ya=d,V.Aa=B,V}function x(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return J(z).Ca(S,z.updatable),S}E.d.CreateSphere=J,C.b.CreateSphere=(f,z,w,S,C,E)=>x(f,{segments:z,diameterX:w,diameterY:w,diameterZ:w,sideOrientation:E,updatable:C},S)},12706:(f,z,w)=>{"use strict";w.d(z,{e:()=>X});var S=w(535),C=w(2477),E=w(833),F=w(789),J=w(795),x=w(548);function u(f,z,w,S,C){let E=null,F=null,J=null;try{let x;E=new f.Decoder,F=new f.DecoderBuffer,F.Init(z,z.byteLength);const u=E.GetEncodedGeometryType(F);switch(u){case f.TRIANGULAR_MESH:{const z=new f.Mesh;if(x=E.DecodeBufferToMesh(F,z),!x.ok()||0===z.ptr)throw new Error(x.error_msg());const w=3*z.num_faces(),C=4*w,u=f._malloc(C);try{E.GetTrianglesUInt32Array(z,C,u);const F=new Uint32Array(w);F.set(new Uint32Array(f.HEAPF32.buffer,u,w)),S(F)}finally{f._free(u)}J=z;break}case f.POINT_CLOUD:{const z=new f.PointCloud;if(x=E.DecodeBufferToPointCloud(F,z),!x.ok()||!z.ptr)throw new Error(x.error_msg());J=z;break}default:throw new Error(`Invalid geometry type ${u}`)}const h=J.num_points(),X=(z,w,S,E)=>{const F=E.data_type(),J=E.num_components(),x=E.normalized(),u=E.byte_stride(),X=E.byte_offset(),K={[f.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:f.HEAPF32},[f.DT_INT8]:{typedArrayConstructor:Int8Array,heap:f.HEAP8},[f.DT_INT16]:{typedArrayConstructor:Int16Array,heap:f.HEAP16},[f.DT_INT32]:{typedArrayConstructor:Int32Array,heap:f.HEAP32},[f.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:f.HEAPU8},[f.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:f.HEAPU16},[f.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:f.HEAPU32}}[F];if(!K)throw new Error(`Invalid data type ${F}`);const c=h*J,y=c*K.typedArrayConstructor.BYTES_PER_ELEMENT,e=f._malloc(y);try{z.GetAttributeDataArrayForAllPoints(w,E,F,y,e);const f=new K.typedArrayConstructor(K.heap.buffer,e,c);C(S,f.slice(),J,X,u,x)}finally{f._free(e)}};if(w)for(const f in w){const z=w[f],S=E.GetAttributeByUniqueId(J,z);X(E,J,f,S)}else{const z={position:f.POSITION,lk:f.NORMAL,color:f.COLOR,uv:f.TEX_COORD};for(const f in z){const w=E.GetAttributeId(J,z[f]);if(-1!==w){const z=E.GetAttribute(J,w);X(E,J,f,z)}}}return h}finally{J&&f.destroy(J),F&&f.destroy(F),E&&f.destroy(E)}}function h(){let f;onmessage=z=>{const w=z.data;switch(w.id){case"init":{const z=w.decoder;z.url&&importScripts(z.url);const S=z.wasmBinary?{wasmBinary:z.wasmBinary}:{};f=DracoDecoderModule(S),postMessage({id:"initDone"});break}case"decodeMesh":if(!f)throw new Error("Draco decoder module is not available");f.then((f=>{const z=u(f,w.dataView,w.attributes,(f=>{postMessage({id:"indices",data:f},[f.buffer])}),((f,z,w,S,C,E)=>{postMessage({id:"attribute",kind:f,data:z,size:w,byteOffset:S,byteStride:C,normalized:E},[z.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:z})}))}}}class X{static get DecoderAvailable(){const f=X.Configuration.decoder;return!!(f.wasmUrl&&f.wasmBinaryUrl&&"object"===typeof WebAssembly||f.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return X._Default||(X._Default=new X),X._Default}static ResetDefault(f){X._Default&&(f||X._Default.dispose(),X._Default=null)}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const z=X.Configuration.decoder;if(z.workerPool||"object"===typeof f&&f.workerPool)this._workerPoolPromise=Promise.resolve(z.workerPool||f.workerPool);else{const w=z.wasmBinary||"object"===typeof f&&f.wasmBinary,E="number"===typeof f?f:f.numWorkers,F=E&&"function"===typeof Worker&&"function"===typeof URL,J=F||!F&&!z.jsModule,x=z.wasmUrl&&z.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:J?S.h.GetBabylonScriptURL(z.wasmUrl,!0):"",wasmBinaryPromise:w?Promise.resolve(w):S.h.LoadFileAsync(S.h.GetBabylonScriptURL(z.wasmBinaryUrl,!0))}:{url:J?S.h.GetBabylonScriptURL(z.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};F?this._workerPoolPromise=x.wasmBinaryPromise.then((f=>{const z=`${u}(${h})()`,w=URL.createObjectURL(new Blob([z],{type:"application/javascript"}));return new C.c(E,(()=>function(f,z,w){return new Promise(((S,C)=>{const E=z=>{f.removeEventListener("error",E),f.removeEventListener("message",F),C(z)},F=z=>{"initDone"===z.data.id&&(f.removeEventListener("error",E),f.removeEventListener("message",F),S(f))};if(f.addEventListener("error",E),f.addEventListener("message",F),z){const S=z.slice(0);f.postMessage({id:"init",decoder:{url:w,wasmBinary:S}},[S])}else f.postMessage({id:"init",decoder:{url:w}})}))}(new Worker(w),f,x.url)))})):this._decoderModulePromise=x.wasmBinaryPromise.then((async f=>{if("undefined"===typeof DracoDecoderModule&&!z.jsModule){if(!x.url)throw new Error("Draco decoder module is not available");await S.h.LoadBabylonScriptAsync(x.url)}return await(w=f,C=z.jsModule,new Promise((f=>{(C||DracoDecoderModule)({wasmBinary:w}).then((z=>{f({module:z})}))})));var w,C}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((f=>{f.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(f,z,w){const S=f instanceof ArrayBuffer?new Int8Array(f):new Int8Array(f.buffer,f.byteOffset,f.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((f=>new Promise(((C,E)=>{f.push(((f,F)=>{let J=null;const u=[],h=z=>{f.removeEventListener("error",h),f.removeEventListener("message",X),E(z),F()},X=z=>{const S=z.data;switch(S.id){case"decodeMeshDone":f.removeEventListener("error",h),f.removeEventListener("message",X),C({indices:J,attributes:u,totalVertices:S.totalVertices}),F();break;case"indices":J=S.data;break;case"attribute":u.push({kind:S.kind,data:S.data,size:S.size,byteOffset:S.byteOffset,byteStride:S.byteStride,normalized:(E=S.kind,K=S.normalized,w&&void 0!==w[E]?(K!==w[E]&&x.b.Warn(`Normalized flag from Draco data (${K}) does not match normalized flag from glTF accessor (${w[E]}). Using flag from glTF accessor.`),w[E]):K)})}var E,K};f.addEventListener("error",h),f.addEventListener("message",X);const K=S.slice();f.postMessage({id:"decodeMesh",dataView:K,attributes:z},[K.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((f=>{let w=null;const C=[],E=u(f.module,S,z,(f=>{w=f}),((f,z,w,S,E,F)=>{C.push({kind:f,data:z,size:w,byteOffset:S,byteStride:E,normalized:F})}));return{indices:w,attributes:C,totalVertices:E}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(f,z,w,S){const C=await this.decodeMeshToMeshDataAsync(w,S),J=new E.e(f,z);C.indices&&J.setIndices(C.indices);for(const E of C.attributes)J.setVerticesBuffer(new F.f(z.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),C.totalVertices);return J}async _decodeMeshToGeometryForGltfAsync(f,z,w,S,C){const J=await this.decodeMeshToMeshDataAsync(w,S,C),x=new E.e(f,z);J.indices&&x.setIndices(J.indices);for(const E of J.attributes)x.setVerticesBuffer(new F.f(z.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),J.totalVertices);return x}async decodeMeshAsync(f,z){const w=await this.decodeMeshToMeshDataAsync(f,z),S=new J.d;w.indices&&(S.indices=w.indices);for(const C of w.attributes){const f=F.f.GetFloatData(C.data,C.size,F.f.GetDataType(C.data),C.byteOffset,C.byteStride,C.normalized,w.totalVertices);S.set(f,C.kind)}return S}}X.Configuration={decoder:{wasmUrl:`${S.h._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${S.h._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${S.h._DefaultCdnUrl}/draco_decoder_gltf.js`}},X.DefaultNumWorkers=X.GetDefaultNumWorkers(),X._Default=null},12678:(f,z,w)=>{"use strict";w.d(z,{d:()=>K});var S=w(720),C=w(548),E=w(853),F=w(525),J=w(553),x=w(862),u=w(789),h=w(535),X=w(665);F.b._instancedMeshFactory=(f,z)=>{const w=new K(f,z);if(z.instancedBuffers){w.instancedBuffers={};for(const f in z.instancedBuffers)w.instancedBuffers[f]=z.instancedBuffers[f]}return w};class K extends E.c{constructor(f,z){super(f,z.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,z.Dk(this),this._sourceMesh=z,this._unIndexed=z._unIndexed,this.position.p(z.position),this.rotation.p(z.rotation),this.Id.p(z.Id),z.rotationQuaternion&&(this.rotationQuaternion=z.rotationQuaternion.clone()),this.animations=z.animations.slice();for(const w of z.getAnimationRanges())null!=w&&this.createAnimationRange(w.name,w.from,w.to);this.infiniteDistance=z.infiniteDistance,this.setPivotMatrix(z.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(f){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.receiveShadows)!==f&&h.h.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(f){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.material)!==f&&h.h.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(f){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.visibility)!==f&&h.h.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(f){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.skeleton)!==f&&h.h.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(f){this._sourceMesh&&f!==this._sourceMesh.renderingGroupId&&C.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(f){return this._sourceMesh.createInstance(f)}isReady(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(f,!0)}getVerticesData(f,z,w){return this._sourceMesh.getVerticesData(f,z,w)}copyVerticesData(f,z){this._sourceMesh.copyVerticesData(f,z)}Ga(f,z,w,S){return this.sourceMesh&&this.sourceMesh.Ga(f,z,w,S),this.sourceMesh}updateVerticesData(f,z,w,S){return this.sourceMesh&&this.sourceMesh.updateVerticesData(f,z,w,S),this.sourceMesh}setIndices(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(f,z),this.sourceMesh}isVerticesDataPresent(f){return this._sourceMesh.isVerticesDataPresent(f)}dk(){return this._sourceMesh.dk()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let f,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;f="object"===typeof z?z:{applySkeleton:z,applyMorph:w};const S=this._sourceMesh.qk?this._sourceMesh.qk.boundingBias:null;return this.Fa(this._sourceMesh._getData(f,null,u.f.PositionKind),S),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(f,z){if(super._activate(f,z),this._sourceMesh.pk||C.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,f),z){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==x.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new S.b);const f=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,S.j.ek[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.bk(!0)),this._currentLOD.position.p(S.j.ek[7]),this._currentLOD._masterMesh=f,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(f){if(!f)return this;const z=this.sourceMesh.getLODLevels();if(z&&0!==z.length){const z=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(f,z.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(f){return this.sourceMesh._preActivateForIntermediateRendering(f)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.pk)for(let f=0;f<this._sourceMesh.pk.length;f++)this._sourceMesh.pk[f].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0;const S=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(f);if(J.b.DeepCopy(this,S,["name","pk","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Bk","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),z&&(S.parent=z),!w)for(let C=0;C<this.va().meshes.length;C++){const f=this.va().meshes[C];f.parent===this&&f.clone(f.name,S)}return S.bk(!0),this.onClonedObservable.notifyObservers(S),S}dispose(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Ek(this),super.dispose(f,z)}_serializeAsParent(f){super._serializeAsParent(f),f.parentId=this._sourceMesh.uniqueId,f.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1?arguments[1]:void 0,w=arguments.length>2?arguments[2]:void 0;const S=this.clone("Clone of "+(this.name||this.id),f||this.parent,!0,z&&z.newSourcedMesh);S&&w&&w(this,S);for(const C of this.getChildTransformNodes(!0))C.instantiateHierarchy(S,z,w);return S}}F.b.prototype.registerInstancedBuffer=function(f,z){var w,S;if(null===(w=this._userInstancedBuffersStorage)||void 0===w||null===(S=w.vertexBuffers[f])||void 0===S||S.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const f of this.instances)f.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[f]=null,this._userInstancedBuffersStorage.strides[f]=z,this._userInstancedBuffersStorage.sizes[f]=32*z,this._userInstancedBuffersStorage.data[f]=new Float32Array(this._userInstancedBuffersStorage.sizes[f]),this._userInstancedBuffersStorage.vertexBuffers[f]=new u.f(this.getEngine(),this._userInstancedBuffersStorage.data[f],f,!0,!1,z,!0);for(const C of this.instances)C.instancedBuffers[f]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},F.b.prototype._processInstancedBuffers=function(f,z){const w=f?f.length:0;for(const S in this.instancedBuffers){let C=this._userInstancedBuffersStorage.sizes[S];const E=this._userInstancedBuffersStorage.strides[S],F=(w+1)*E;for(;C<F;)C*=2;this._userInstancedBuffersStorage.data[S].length!=C&&(this._userInstancedBuffersStorage.data[S]=new Float32Array(C),this._userInstancedBuffersStorage.sizes[S]=C,this._userInstancedBuffersStorage.vertexBuffers[S]&&(this._userInstancedBuffersStorage.vertexBuffers[S].dispose(),this._userInstancedBuffersStorage.vertexBuffers[S]=null));const J=this._userInstancedBuffersStorage.data[S];let x=0;if(z){const f=this.instancedBuffers[S];f.toArray?f.toArray(J,x):f.copyToArray?f.copyToArray(J,x):J[x]=f,x+=E}for(let z=0;z<w;z++){const w=f[z].instancedBuffers[S];w.toArray?w.toArray(J,x):w.copyToArray?w.copyToArray(J,x):J[x]=w,x+=E}this._userInstancedBuffersStorage.vertexBuffers[S]?this._userInstancedBuffersStorage.vertexBuffers[S].updateDirectly(J,0):(this._userInstancedBuffersStorage.vertexBuffers[S]=new u.f(this.getEngine(),this._userInstancedBuffersStorage.data[S],S,!0,!1,E,!0),this._invalidateInstanceVertexArrayObject())}},F.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const f in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[f]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},F.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const f in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[f]&&this._userInstancedBuffersStorage.vertexBuffers[f].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,X.f)("BABYLON.InstancedMesh",K)},12887:(f,z,w)=>{"use strict";w.d(z,{d:()=>ef});var S=w(720),C=w(525),E=w(789),F=w(795),J=w(848);function x(f){let z=f.pathArray;const w=f.closeArray||!1,S=f.closePath||!1,C=f.invertUV||!1,x=Math.floor(z[0].length/2);let u=f.offset||x;u=u>x?x:Math.floor(u);const h=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,X=f.Aa,K=f.za,c=[],y=[],e=[],O=[],d=[],B=[],V=[],W=[];let T;const v=[],D=[];let A,M,G;if(z.length<2){const f=[],w=[];for(M=0;M<z[0].length-u;M++)f.push(z[0][M]),w.push(z[0][M+u]);z=[f,w]}let I=0;const n=S?1:0,P=w?1:0;let R,q,a,s,H,L;for(T=z[0].length,A=0;A<z.length+P;A++){for(V[A]=0,d[A]=[0],R=A===z.length?z[0]:z[A],q=R.length,T=T<q?T:q,G=0;G<q;)c.push(R[G].x,R[G].y,R[G].z),G>0&&(a=R[G].te(R[G-1]).length(),s=a+V[A],d[A].push(s),V[A]=s),G++;S&&(G--,c.push(R[0].x,R[0].y,R[0].z),a=R[G].te(R[0]).length(),s=a+V[A],d[A].push(s),V[A]=s),v[A]=q+n,D[A]=I,I+=q+n}let U,i,m=null,r=null;for(M=0;M<T+n;M++)for(W[M]=0,B[M]=[0],A=0;A<z.length-1+P;A++)H=z[A],L=A===z.length-1?z[0]:z[A+1],M===T?(m=H[0],r=L[0]):(m=H[M],r=L[M]),a=r.te(m).length(),s=a+W[M],B[M].push(s),W[M]=s;if(X)for(A=0;A<X.length;A++)O.push(X[A].x,J.c?1-X[A].y:X[A].y);else for(A=0;A<z.length+P;A++)for(M=0;M<T+n;M++)U=0!=V[A]?d[A][M]/V[A]:0,i=0!=W[M]?B[M][A]/W[M]:0,C?O.push(i,U):O.push(U,J.c?1-i:i);A=0;let o=0,p=v[A]-1,Y=v[A+1]-1,t=p<Y?p:Y,Z=D[1]-D[0];const b=v.length-1;for(;o<=t&&A<b;)y.push(o,o+Z,o+1),y.push(o+Z+1,o+1,o+Z),o+=1,o===t&&(A++,Z=D[A+1]-D[A],p=v[A]-1,Y=v[A+1]-1,o=D[A],t=p<Y?p+o:Y+o);if(F.d.ComputeNormals(c,y,e),S){let f=0,w=0;for(A=0;A<z.length;A++){f=3*D[A],w=A+1<z.length?3*(D[A+1]-1):e.length-3,e[f]=.5*(e[f]+e[w]),e[f+1]=.5*(e[f+1]+e[w+1]),e[f+2]=.5*(e[f+2]+e[w+2]);const S=Math.sqrt(e[f]*e[f]+e[f+1]*e[f+1]+e[f+2]*e[f+2]);e[f]/=S,e[f+1]/=S,e[f+2]/=S,e[w]=e[f],e[w+1]=e[f+1],e[w+2]=e[f+2]}}if(w){let f=3*D[0],w=3*D[z.length];for(M=0;M<T+n;M++){e[f]=.5*(e[f]+e[w]),e[f+1]=.5*(e[f+1]+e[w+1]),e[f+2]=.5*(e[f+2]+e[w+2]);const z=Math.sqrt(e[f]*e[f]+e[f+1]*e[f+1]+e[f+2]*e[f+2]);e[f]/=z,e[f+1]/=z,e[f+2]/=z,e[w]=e[f],e[w+1]=e[f+1],e[w+2]=e[f+2],f+=3,w+=3}}F.d._ComputeSides(h,c,y,e,O,f.frontUVs,f.backUVs);let Q=null;if(K){Q=new Float32Array(4*K.length);for(let f=0;f<K.length;f++)Q[4*f]=K[f].r,Q[4*f+1]=K[f].g,Q[4*f+2]=K[f].b,Q[4*f+3]=K[f].a}const g=new F.d,k=new Float32Array(c),j=new Float32Array(e),l=new Float32Array(O);return g.indices=y,g.xa=k,g.ya=j,g.Aa=l,Q&&g.set(Q,E.f.ColorKind),S&&(g._idx=D),g}function u(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=z.pathArray,h=z.closeArray,X=z.closePath,K=C.b._GetDefaultSideOrientation(z.sideOrientation),c=z.instance,y=z.updatable;if(c){const f=S.j.ek[0].Ed(Number.MAX_VALUE),w=S.j.ek[1].Ed(-Number.MAX_VALUE),x=z=>{let S=u[0].length;const E=c;let F=0;const J=E._originalBuilderSideOrientation===C.b.DOUBLESIDE?2:1;for(let C=1;C<=J;++C)for(let J=0;J<u.length;++J){const C=u[J],x=C.length;S=S<x?S:x;for(let E=0;E<S;++E){const S=C[E];z[F]=S.x,z[F+1]=S.y,z[F+2]=S.z,f.minimizeInPlaceFromFloats(S.x,S.y,S.z),w.maximizeInPlaceFromFloats(S.x,S.y,S.z),F+=3}if(E._creationDataStorage&&E._creationDataStorage.closePath){const f=C[0];z[F]=f.x,z[F+1]=f.y,z[F+2]=f.z,F+=3}}},h=c.getVerticesData(E.f.PositionKind);if(x(h),c.hasBoundingInfo?c.getBoundingInfo().reConstruct(f,w,c._worldMatrix):c.buildBoundingInfo(f,w,c._worldMatrix),c.updateVerticesData(E.f.PositionKind,h,!1,!1),z.za){const f=c.getVerticesData(E.f.ColorKind);for(let w=0,S=0;w<z.za.length;w++,S+=4){const C=z.za[w];f[S]=C.r,f[S+1]=C.g,f[S+2]=C.b,f[S+3]=C.a}c.updateVerticesData(E.f.ColorKind,f,!1,!1)}if(z.Aa){const f=c.getVerticesData(E.f.UVKind);for(let w=0;w<z.Aa.length;w++)f[2*w]=z.Aa[w].x,f[2*w+1]=J.c?1-z.Aa[w].y:z.Aa[w].y;c.updateVerticesData(E.f.UVKind,f,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){const f=c.dk(),z=c.getVerticesData(E.f.NormalKind),w=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(F.d.ComputeNormals(h,f,z,w),c._creationDataStorage&&c._creationDataStorage.closePath){let f=0,w=0;for(let S=0;S<u.length;S++)f=3*c._creationDataStorage.idx[S],w=S+1<u.length?3*(c._creationDataStorage.idx[S+1]-1):z.length-3,z[f]=.5*(z[f]+z[w]),z[f+1]=.5*(z[f+1]+z[w+1]),z[f+2]=.5*(z[f+2]+z[w+2]),z[w]=z[f],z[w+1]=z[f+1],z[w+2]=z[f+2]}c.areNormalsFrozen||c.updateVerticesData(E.f.NormalKind,z,!1,!1)}return c}{const S=new C.b(f,w);S._originalBuilderSideOrientation=K,S._creationDataStorage=new C.e;const E=x(z);return X&&(S._creationDataStorage.idx=E._idx),S._creationDataStorage.closePath=X,S._creationDataStorage.closeArray=h,E.Ca(S,y),S}}F.d.CreateRibbon=x,C.b.CreateRibbon=function(f,z){return u(f,{pathArray:z,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var h=w(516),X=w(12102),K=w(762);function c(f){const z=f.pattern||C.b.NO_FLIP,w=f.tileWidth||f.tileSize||1,S=f.tileHeight||f.tileSize||1,E=f.alignHorizontal||0,J=f.alignVertical||0,x=f.width||f.size||1,u=Math.floor(x/w);let h=x-u*w;const X=f.height||f.size||1,K=Math.floor(X/S);let c=X-K*S;const y=w*u/2,e=S*K/2;let O=0,d=0,B=0,V=0,W=0,T=0;if(h>0||c>0){switch(B=-y,V=-e,W=y,T=e,E){case C.b.CENTER:h/=2,B-=h,W+=h;break;case C.b.LEFT:W+=h,O=-h/2;break;case C.b.RIGHT:B-=h,O=h/2}switch(J){case C.b.CENTER:c/=2,V-=c,T+=c;break;case C.b.BOTTOM:T+=c,d=-c/2;break;case C.b.TOP:V-=c,d=c/2}}const v=[],D=[],A=[];A[0]=[0,0,1,0,1,1,0,1],A[1]=[0,0,1,0,1,1,0,1],z!==C.b.ROTATE_TILE&&z!==C.b.ROTATE_ROW||(A[1]=[1,1,0,1,0,0,1,0]),z!==C.b.FLIP_TILE&&z!==C.b.FLIP_ROW||(A[1]=[1,0,0,0,0,1,1,1]),z!==C.b.FLIP_N_ROTATE_TILE&&z!==C.b.FLIP_N_ROTATE_ROW||(A[1]=[0,1,1,1,1,0,0,0]);let M=[];const G=[],I=[];let n=0;for(let F=0;F<K;F++)for(let f=0;f<u;f++)v.push(f*w-y+O,F*S-e+d,0),v.push((f+1)*w-y+O,F*S-e+d,0),v.push((f+1)*w-y+O,(F+1)*S-e+d,0),v.push(f*w-y+O,(F+1)*S-e+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),M=z===C.b.FLIP_TILE||z===C.b.ROTATE_TILE||z===C.b.FLIP_N_ROTATE_TILE?M.concat(A[(f%2+F%2)%2]):z===C.b.FLIP_ROW||z===C.b.ROTATE_ROW||z===C.b.FLIP_N_ROTATE_ROW?M.concat(A[F%2]):M.concat(A[0]),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),n+=4;if(h>0||c>0){const f=c>0&&(J===C.b.CENTER||J===C.b.TOP),F=c>0&&(J===C.b.CENTER||J===C.b.BOTTOM),x=h>0&&(E===C.b.CENTER||E===C.b.RIGHT),X=h>0&&(E===C.b.CENTER||E===C.b.LEFT);let A,P,R,q,a=[];if(f&&x&&(v.push(B+O,V+d,0),v.push(-y+O,V+d,0),v.push(-y+O,V+c+d,0),v.push(B+O,V+c+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,A=1-h/w,P=1-c/S,R=1,q=1,a=[A,P,R,P,R,q,A,q],z===C.b.ROTATE_ROW&&(a=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),z===C.b.FLIP_ROW&&(a=[1-A,P,1-R,P,1-R,q,1-A,q]),z===C.b.FLIP_N_ROTATE_ROW&&(a=[A,1-P,R,1-P,R,1-q,A,1-q]),M=M.concat(a),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&X&&(v.push(y+O,V+d,0),v.push(W+O,V+d,0),v.push(W+O,V+c+d,0),v.push(y+O,V+c+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,A=0,P=1-c/S,R=h/w,q=1,a=[A,P,R,P,R,q,A,q],(z===C.b.ROTATE_ROW||z===C.b.ROTATE_TILE&&u%2===0)&&(a=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),(z===C.b.FLIP_ROW||z===C.b.FLIP_TILE&&u%2===0)&&(a=[1-A,P,1-R,P,1-R,q,1-A,q]),(z===C.b.FLIP_N_ROTATE_ROW||z===C.b.FLIP_N_ROTATE_TILE&&u%2===0)&&(a=[A,1-P,R,1-P,R,1-q,A,1-q]),M=M.concat(a),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&x&&(v.push(B+O,e+d,0),v.push(-y+O,e+d,0),v.push(-y+O,T+d,0),v.push(B+O,T+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,A=1-h/w,P=0,R=1,q=c/S,a=[A,P,R,P,R,q,A,q],(z===C.b.ROTATE_ROW&&K%2===1||z===C.b.ROTATE_TILE&&K%1===0)&&(a=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),(z===C.b.FLIP_ROW&&K%2===1||z===C.b.FLIP_TILE&&K%2===0)&&(a=[1-A,P,1-R,P,1-R,q,1-A,q]),(z===C.b.FLIP_N_ROTATE_ROW&&K%2===1||z===C.b.FLIP_N_ROTATE_TILE&&K%2===0)&&(a=[A,1-P,R,1-P,R,1-q,A,1-q]),M=M.concat(a),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&X&&(v.push(y+O,e+d,0),v.push(W+O,e+d,0),v.push(W+O,T+d,0),v.push(y+O,T+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,A=0,P=0,R=h/w,q=c/S,a=[A,P,R,P,R,q,A,q],(z===C.b.ROTATE_ROW&&K%2===1||z===C.b.ROTATE_TILE&&(K+u)%2===1)&&(a=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),(z===C.b.FLIP_ROW&&K%2===1||z===C.b.FLIP_TILE&&(K+u)%2===1)&&(a=[1-A,P,1-R,P,1-R,q,1-A,q]),(z===C.b.FLIP_N_ROTATE_ROW&&K%2===1||z===C.b.FLIP_N_ROTATE_TILE&&(K+u)%2===1)&&(a=[A,1-P,R,1-P,R,1-q,A,1-q]),M=M.concat(a),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f){const f=[];A=0,P=1-c/S,R=1,q=1,f[0]=[A,P,R,P,R,q,A,q],f[1]=[A,P,R,P,R,q,A,q],z!==C.b.ROTATE_TILE&&z!==C.b.ROTATE_ROW||(f[1]=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),z!==C.b.FLIP_TILE&&z!==C.b.FLIP_ROW||(f[1]=[1-A,P,1-R,P,1-R,q,1-A,q]),z!==C.b.FLIP_N_ROTATE_TILE&&z!==C.b.FLIP_N_ROTATE_ROW||(f[1]=[A,1-P,R,1-P,R,1-q,A,1-q]);for(let S=0;S<u;S++)v.push(S*w-y+O,V+d,0),v.push((S+1)*w-y+O,V+d,0),v.push((S+1)*w-y+O,V+c+d,0),v.push(S*w-y+O,V+c+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,M=z===C.b.FLIP_TILE||z===C.b.ROTATE_TILE||z===C.b.FLIP_N_ROTATE_TILE?M.concat(f[(S+1)%2]):z===C.b.FLIP_ROW||z===C.b.ROTATE_ROW||z===C.b.FLIP_N_ROTATE_ROW?M.concat(f[1]):M.concat(f[0]),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const f=[];A=0,P=0,R=1,q=c/S,f[0]=[A,P,R,P,R,q,A,q],f[1]=[A,P,R,P,R,q,A,q],z!==C.b.ROTATE_TILE&&z!==C.b.ROTATE_ROW||(f[1]=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),z!==C.b.FLIP_TILE&&z!==C.b.FLIP_ROW||(f[1]=[1-A,P,1-R,P,1-R,q,1-A,q]),z!==C.b.FLIP_N_ROTATE_TILE&&z!==C.b.FLIP_N_ROTATE_ROW||(f[1]=[A,1-P,R,1-P,R,1-q,A,1-q]);for(let S=0;S<u;S++)v.push(S*w-y+O,T-c+d,0),v.push((S+1)*w-y+O,T-c+d,0),v.push((S+1)*w-y+O,T+d,0),v.push(S*w-y+O,T+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,M=z===C.b.FLIP_TILE||z===C.b.ROTATE_TILE||z===C.b.FLIP_N_ROTATE_TILE?M.concat(f[(S+K)%2]):z===C.b.FLIP_ROW||z===C.b.ROTATE_ROW||z===C.b.FLIP_N_ROTATE_ROW?M.concat(f[K%2]):M.concat(f[0]),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const f=[];A=1-h/w,P=0,R=1,q=1,f[0]=[A,P,R,P,R,q,A,q],f[1]=[A,P,R,P,R,q,A,q],z!==C.b.ROTATE_TILE&&z!==C.b.ROTATE_ROW||(f[1]=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),z!==C.b.FLIP_TILE&&z!==C.b.FLIP_ROW||(f[1]=[1-A,P,1-R,P,1-R,q,1-A,q]),z!==C.b.FLIP_N_ROTATE_TILE&&z!==C.b.FLIP_N_ROTATE_ROW||(f[1]=[A,1-P,R,1-P,R,1-q,A,1-q]);for(let w=0;w<K;w++)v.push(B+O,w*S-e+d,0),v.push(B+h+O,w*S-e+d,0),v.push(B+h+O,(w+1)*S-e+d,0),v.push(B+O,(w+1)*S-e+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,M=z===C.b.FLIP_TILE||z===C.b.ROTATE_TILE||z===C.b.FLIP_N_ROTATE_TILE?M.concat(f[(w+1)%2]):z===C.b.FLIP_ROW||z===C.b.ROTATE_ROW||z===C.b.FLIP_N_ROTATE_ROW?M.concat(f[w%2]):M.concat(f[0]),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const f=[];A=0,P=0,R=h/S,q=1,f[0]=[A,P,R,P,R,q,A,q],f[1]=[A,P,R,P,R,q,A,q],z!==C.b.ROTATE_TILE&&z!==C.b.ROTATE_ROW||(f[1]=[1-A,1-P,1-R,1-P,1-R,1-q,1-A,1-q]),z!==C.b.FLIP_TILE&&z!==C.b.FLIP_ROW||(f[1]=[1-A,P,1-R,P,1-R,q,1-A,q]),z!==C.b.FLIP_N_ROTATE_TILE&&z!==C.b.FLIP_N_ROTATE_ROW||(f[1]=[A,1-P,R,1-P,R,1-q,A,1-q]);for(let w=0;w<K;w++)v.push(W-h+O,w*S-e+d,0),v.push(W+O,w*S-e+d,0),v.push(W+O,(w+1)*S-e+d,0),v.push(W-h+O,(w+1)*S-e+d,0),I.push(n,n+1,n+3,n+1,n+2,n+3),n+=4,M=z===C.b.FLIP_TILE||z===C.b.ROTATE_TILE||z===C.b.FLIP_N_ROTATE_TILE?M.concat(f[(w+u)%2]):z===C.b.FLIP_ROW||z===C.b.ROTATE_ROW||z===C.b.FLIP_N_ROTATE_ROW?M.concat(f[w%2]):M.concat(f[0]),G.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const P=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE;F.d._ComputeSides(P,v,I,D,M,f.frontUVs,f.backUVs);const R=new F.d;R.indices=I,R.xa=v,R.ya=D,R.Aa=M;const q=P===F.d.DOUBLESIDE?G.concat(G):G;return R.za=q,R}function y(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return c(z).Ca(S,z.updatable),S}function e(f){const z=f.faceUV||new Array(6),w=f.faceColors,E=f.pattern||C.b.NO_FLIP,x=f.width||f.size||1,u=f.height||f.size||1,h=f.depth||f.size||1,X=f.tileWidth||f.tileSize||1,y=f.tileHeight||f.tileSize||1,e=f.alignHorizontal||0,O=f.alignVertical||0,d=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE;for(let C=0;C<6;C++)void 0===z[C]&&(z[C]=new S.p(0,0,1,1)),w&&void 0===w[C]&&(w[C]=new K.f(1,1,1,1));const B=x/2,V=u/2,W=h/2,T=[];for(let S=0;S<2;S++)T[S]=c({pattern:E,tileWidth:X,tileHeight:y,width:x,height:u,alignVertical:O,alignHorizontal:e,sideOrientation:d});for(let S=2;S<4;S++)T[S]=c({pattern:E,tileWidth:X,tileHeight:y,width:h,height:u,alignVertical:O,alignHorizontal:e,sideOrientation:d});let v=O;O===C.b.BOTTOM?v=C.b.TOP:O===C.b.TOP&&(v=C.b.BOTTOM);for(let S=4;S<6;S++)T[S]=c({pattern:E,tileWidth:X,tileHeight:y,width:x,height:h,alignVertical:v,alignHorizontal:e,sideOrientation:d});let D=[],A=[],M=[],G=[];const I=[],n=[],P=[],R=[];let q=0,a=0;for(let C=0;C<6;C++){const f=T[C].xa.length;n[C]=[],P[C]=[];for(let z=0;z<f/3;z++)n[C].push(new S.n(T[C].xa[3*z],T[C].xa[3*z+1],T[C].xa[3*z+2])),P[C].push(new S.n(T[C].ya[3*z],T[C].ya[3*z+1],T[C].ya[3*z+2]));q=T[C].Aa.length,R[C]=[];for(let w=0;w<q;w+=2)R[C][w]=z[C].x+(z[C].z-z[C].x)*T[C].Aa[w],R[C][w+1]=z[C].y+(z[C].w-z[C].y)*T[C].Aa[w+1],J.c&&(R[C][w+1]=1-R[C][w+1]);if(M=M.concat(R[C]),G=G.concat(T[C].indices.map((f=>f+a))),a+=n[C].length,w)for(let z=0;z<4;z++)I.push(w[C].r,w[C].g,w[C].b,w[C].a)}const s=new S.n(0,0,W),H=S.b.RotationY(Math.PI);D=n[0].map((f=>S.n.TransformNormal(f,H).add(s))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]),A=P[0].map((f=>S.n.TransformNormal(f,H))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]),D=D.concat(n[1].map((f=>f.te(s))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),A=A.concat(P[1].map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]));const L=new S.n(B,0,0),U=S.b.RotationY(-Math.PI/2);D=D.concat(n[2].map((f=>S.n.TransformNormal(f,U).add(L))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),A=A.concat(P[2].map((f=>S.n.TransformNormal(f,U))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]));const i=S.b.RotationY(Math.PI/2);D=D.concat(n[3].map((f=>S.n.TransformNormal(f,i).te(L))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),A=A.concat(P[3].map((f=>S.n.TransformNormal(f,i))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]));const m=new S.n(0,V,0),r=S.b.RotationX(Math.PI/2);D=D.concat(n[4].map((f=>S.n.TransformNormal(f,r).add(m))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),A=A.concat(P[4].map((f=>S.n.TransformNormal(f,r))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[]));const o=S.b.RotationX(-Math.PI/2);D=D.concat(n[5].map((f=>S.n.TransformNormal(f,o).te(m))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),A=A.concat(P[5].map((f=>S.n.TransformNormal(f,o))).map((f=>[f.x,f.y,f.z])).reduce(((f,z)=>f.concat(z)),[])),F.d._ComputeSides(d,D,G,A,M);const p=new F.d;if(p.indices=G,p.xa=D,p.ya=A,p.Aa=M,w){const f=d===F.d.DOUBLESIDE?I.concat(I):I;p.za=f}return p}function O(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return e(z).Ca(S,z.updatable),S}F.d.CreateTiledPlane=c;F.d.CreateTiledBox=e;var d=w(12304),B=w(2386),V=w(876);function W(f){const z=f.height||2;let w=0===f.diameterTop?0:f.diameterTop||f.diameter||1,E=0===f.diameterBottom?0:f.diameterBottom||f.diameter||1;w=w||1e-5,E=E||1e-5;const x=0|(f.tessellation||24),u=0|(f.subdivisions||1),h=!!f.hasRings,X=!!f.enclose,c=0===f.cap?0:f.cap||C.b.CAP_ALL,y=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,e=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,O=f.faceUV||new Array(3),d=f.faceColors,B=2+(1+(1!==y&&X?2:0))*(h?u:1);let W;for(W=0;W<B;W++)d&&void 0===d[W]&&(d[W]=new K.f(1,1,1,1));for(W=0;W<B;W++)O&&void 0===O[W]&&(O[W]=new S.p(0,0,1,1));const T=[],v=[],D=[],A=[],M=[],G=2*Math.PI*y/x;let I,n,P;const R=(E-w)/2/z,q=S.n.Zero(),a=S.n.Zero(),s=S.n.Zero(),H=S.n.Zero(),L=S.n.Zero(),U=V.b.Y;let i,m,r,o=1,p=1,Y=0,t=0;for(i=0;i<=u;i++)for(n=i/u,P=(n*(w-E)+E)/2,o=h&&0!==i&&i!==u?2:1,r=0;r<o;r++){for(h&&(p+=r),X&&(p+=2*r),m=0;m<=x;m++)I=m*G,q.x=Math.cos(-I)*P,q.y=-z/2+n*z,q.z=Math.sin(-I)*P,0===w&&i===u?(a.x=D[D.length-3*(x+1)],a.y=D[D.length-3*(x+1)+1],a.z=D[D.length-3*(x+1)+2]):(a.x=q.x,a.z=q.z,a.y=Math.sqrt(a.x*a.x+a.z*a.z)*R,a.normalize()),0===m&&(s.p(q),H.p(a)),v.push(q.x,q.y,q.z),D.push(a.x,a.y,a.z),t=h?Y!==p?O[p].y:O[p].w:O[p].y+(O[p].w-O[p].y)*n,A.push(O[p].x+(O[p].z-O[p].x)*m/x,J.c?1-t:t),d&&M.push(d[p].r,d[p].g,d[p].b,d[p].a);1!==y&&X&&(v.push(q.x,q.y,q.z),v.push(0,q.y,0),v.push(0,q.y,0),v.push(s.x,s.y,s.z),S.n.CrossToRef(U,a,L),L.normalize(),D.push(L.x,L.y,L.z,L.x,L.y,L.z),S.n.CrossToRef(H,U,L),L.normalize(),D.push(L.x,L.y,L.z,L.x,L.y,L.z),t=h?Y!==p?O[p+1].y:O[p+1].w:O[p+1].y+(O[p+1].w-O[p+1].y)*n,A.push(O[p+1].x,J.c?1-t:t),A.push(O[p+1].z,J.c?1-t:t),t=h?Y!==p?O[p+2].y:O[p+2].w:O[p+2].y+(O[p+2].w-O[p+2].y)*n,A.push(O[p+2].x,J.c?1-t:t),A.push(O[p+2].z,J.c?1-t:t),d&&(M.push(d[p+1].r,d[p+1].g,d[p+1].b,d[p+1].a),M.push(d[p+1].r,d[p+1].g,d[p+1].b,d[p+1].a),M.push(d[p+2].r,d[p+2].g,d[p+2].b,d[p+2].a),M.push(d[p+2].r,d[p+2].g,d[p+2].b,d[p+2].a))),Y!==p&&(Y=p)}const Z=1!==y&&X?x+4:x;for(i=0,p=0;p<u;p++){let f=0,z=0,w=0,S=0;for(m=0;m<x;m++)f=i*(Z+1)+m,z=(i+1)*(Z+1)+m,w=i*(Z+1)+(m+1),S=(i+1)*(Z+1)+(m+1),T.push(f,z,w),T.push(S,w,z);1!==y&&X&&(T.push(f+2,z+2,w+2),T.push(S+2,w+2,z+2),T.push(f+4,z+4,w+4),T.push(S+4,w+4,z+4)),i=h?i+2:i+1}const b=f=>{const C=f?w/2:E/2;if(0===C)return;let F,u,h;const X=f?O[B-1]:O[0];let K=null;d&&(K=f?d[B-1]:d[0]);const c=v.length/3,e=f?z/2:-z/2,V=new S.n(0,e,0);v.push(V.x,V.y,V.z),D.push(0,f?1:-1,0);const W=X.y+.5*(X.w-X.y);A.push(X.x+.5*(X.z-X.x),J.c?1-W:W),K&&M.push(K.r,K.g,K.b,K.a);const G=new S.l(.5,.5);for(h=0;h<=x;h++){F=2*Math.PI*h*y/x;const z=Math.cos(-F),w=Math.sin(-F);u=new S.n(z*C,e,w*C);const E=new S.l(z*G.x+.5,w*G.y+.5);v.push(u.x,u.y,u.z),D.push(0,f?1:-1,0);const c=X.y+(X.w-X.y)*E.y;A.push(X.x+(X.z-X.x)*E.x,J.c?1-c:c),K&&M.push(K.r,K.g,K.b,K.a)}for(h=0;h<x;h++)f?(T.push(c),T.push(c+(h+2)),T.push(c+(h+1))):(T.push(c),T.push(c+(h+1)),T.push(c+(h+2)))};c!==C.b.CAP_START&&c!==C.b.CAP_ALL||b(!1),c!==C.b.CAP_END&&c!==C.b.CAP_ALL||b(!0),F.d._ComputeSides(e,v,T,D,A,f.frontUVs,f.backUVs);const Q=new F.d;return Q.indices=T,Q.xa=v,Q.ya=D,Q.Aa=A,d&&(Q.za=M),Q}function T(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return W(z).Ca(S,z.updatable),S}function v(f){const z=[],w=[],C=[],E=[],x=f.diameter||1,u=f.thickness||.5,h=0|(f.tessellation||16),X=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,K=h+1;for(let F=0;F<=h;F++){const f=F/h,X=F*Math.PI*2/h-Math.PI/2,c=S.b.Translation(x/2,0,0).multiply(S.b.RotationY(X));for(let x=0;x<=h;x++){const X=1-x/h,y=x*Math.PI*2/h+Math.PI,e=Math.cos(y),O=Math.sin(y);let d=new S.n(e,O,0),B=d.scale(u/2);const V=new S.l(f,X);B=S.n.TransformCoordinates(B,c),d=S.n.TransformNormal(d,c),w.push(B.x,B.y,B.z),C.push(d.x,d.y,d.z),E.push(V.x,J.c?1-V.y:V.y);const W=(F+1)%K,T=(x+1)%K;z.push(F*K+x),z.push(F*K+T),z.push(W*K+x),z.push(F*K+T),z.push(W*K+T),z.push(W*K+x)}}F.d._ComputeSides(X,w,z,C,E,f.frontUVs,f.backUVs);const c=new F.d;return c.indices=z,c.xa=w,c.ya=C,c.Aa=E,c}function D(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return v(z).Ca(S,z.updatable),S}F.d.CreateCylinder=W,C.b.CreateCylinder=(f,z,w,S,E,F,J,x,u)=>{void 0!==J&&J instanceof B.c||(void 0!==J&&(u=x||C.b.DEFAULTSIDE,x=J),J=F,F=1);return T(f,{height:z,diameterTop:w,diameterBottom:S,tessellation:E,subdivisions:F,sideOrientation:u,updatable:x},J)};function A(f){const z=[],w=[],C=[],E=[],x=f.radius||2,u=f.tube||.5,h=f.radialSegments||32,X=f.tubularSegments||32,K=f.p||2,c=f.q||3,y=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,e=f=>{const z=Math.cos(f),w=Math.sin(f),C=c/K*f,E=Math.cos(C),F=x*(2+E)*.5*z,J=x*(2+E)*w*.5,u=x*Math.sin(C)*.5;return new S.n(F,J,u)};let O,d;for(O=0;O<=h;O++){const f=O%h/h*2*K*Math.PI,z=e(f),C=e(f+.01),F=C.te(z);let x=C.add(z);const c=S.n.Cross(F,x);for(x=S.n.Cross(c,F),c.normalize(),x.normalize(),d=0;d<X;d++){const f=d%X/X*2*Math.PI,S=-u*Math.cos(f),C=u*Math.sin(f);w.push(z.x+S*x.x+C*c.x),w.push(z.y+S*x.y+C*c.y),w.push(z.z+S*x.z+C*c.z),E.push(O/h),E.push(J.c?1-d/X:d/X)}}for(O=0;O<h;O++)for(d=0;d<X;d++){const f=(d+1)%X,w=O*X+d,S=(O+1)*X+d,C=(O+1)*X+f,E=O*X+f;z.push(E),z.push(S),z.push(w),z.push(E),z.push(C),z.push(S)}F.d.ComputeNormals(w,z,C),F.d._ComputeSides(y,w,z,C,E,f.frontUVs,f.backUVs);const B=new F.d;return B.indices=z,B.xa=w,B.ya=C,B.Aa=E,B}function M(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2?arguments[2]:void 0;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return A(z).Ca(S,z.updatable),S}F.d.CreateTorus=v,C.b.CreateTorus=(f,z,w,S,C,E,F)=>D(f,{diameter:z,thickness:w,tessellation:S,sideOrientation:F,updatable:E},C);F.d.CreateTorusKnot=A,C.b.CreateTorusKnot=(f,z,w,S,C,E,F,J,x,u)=>M(f,{radius:z,tube:w,radialSegments:S,tubularSegments:C,p:E,q:F,sideOrientation:u,updatable:x},J);var G=w(12891),I=w(548),n=w(2300),P=w(726),R=w(580);class q extends S.l{constructor(f,z){super(f.x,f.y),this.index=z}}class a{constructor(){this.elements=[]}add(f){const z=[];return f.forEach((f=>{const w=new q(f,this.elements.length);z.push(w),this.elements.push(w)})),z}computeBounds(){const f=new S.l(this.elements[0].x,this.elements[0].y),z=new S.l(this.elements[0].x,this.elements[0].y);return this.elements.forEach((w=>{w.x<f.x?f.x=w.x:w.x>z.x&&(z.x=w.x),w.y<f.y?f.y=w.y:w.y>z.y&&(z.y=w.y)})),{min:f,max:z,width:z.x-f.x,height:z.y-f.y}}}class s{_addToepoint(f){for(const z of f)this._epoints.push(z.x,z.y)}constructor(f,z,w){let S,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new a,this._outlinepoints=new a,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=C,this._name=f,this._scene=w||R.c.LastCreatedScene,S=z instanceof n.h?z.getPoints():z,this._addToepoint(S),this._points.add(S),this._outlinepoints.add(S),"undefined"===typeof this.bjsEarcut&&I.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(f){this._points.add(f);const z=new a;return z.add(f),this._holes.push(z),this._eholes.push(this._epoints.length/2),this._addToepoint(f),this}build(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const S=new C.b(this._name,this._scene),F=this.buildVertexData(z,w);return S.Ga(E.f.PositionKind,F.xa,f),S.Ga(E.f.NormalKind,F.ya,f),S.Ga(E.f.UVKind,F.Aa,f),S.setIndices(F.indices),S}buildVertexData(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const w=new F.d,S=[],C=[],E=[],J=this._points.computeBounds();this._points.elements.forEach((f=>{S.push(0,1,0),C.push(f.x,0,f.y),E.push((f.x-J.min.x)/J.width,(f.y-J.min.y)/J.height)}));const x=[],u=this.bjsEarcut(this._epoints,this._eholes,2);for(let F=0;F<u.length;F++)x.push(u[F]);if(f>0){const w=C.length/3;this._points.elements.forEach((z=>{S.push(0,-1,0),C.push(z.x,-f,z.y),E.push(1-(z.x-J.min.x)/J.width,1-(z.y-J.min.y)/J.height)}));const F=x.length;for(let f=0;f<F;f+=3){const z=x[f+0],S=x[f+1],C=x[f+2];x.push(C+w),x.push(S+w),x.push(z+w)}this._addSide(C,S,E,x,J,this._outlinepoints,f,!1,z),this._holes.forEach((w=>{this._addSide(C,S,E,x,J,w,f,!0,z)}))}return w.indices=x,w.xa=C,w.ya=S,w.Aa=E,w}_addSide(f,z,w,C,E,F,J,x,u){let h=f.length/3,X=0;for(let K=0;K<F.elements.length;K++){const c=F.elements[K],y=F.elements[(K+1)%F.elements.length];f.push(c.x,0,c.y),f.push(c.x,-J,c.y),f.push(y.x,0,y.y),f.push(y.x,-J,y.y);const e=F.elements[(K+F.elements.length-1)%F.elements.length],O=F.elements[(K+2)%F.elements.length];let d=new S.n(-(y.y-c.y),0,y.x-c.x),B=new S.n(-(c.y-e.y),0,c.x-e.x),V=new S.n(-(O.y-y.y),0,O.x-y.x);x||(d=d.scale(-1),B=B.scale(-1),V=V.scale(-1));const W=d.normalizeToNew();let T=B.normalizeToNew(),v=V.normalizeToNew();const D=S.n.Dot(T,W);T=D>u?D<P.e-1?new S.n(c.x,0,c.y).te(new S.n(y.x,0,y.y)).normalize():B.add(d).normalize():W;const A=S.n.Dot(V,d);v=A>u?A<P.e-1?new S.n(y.x,0,y.y).te(new S.n(c.x,0,c.y)).normalize():V.add(d).normalize():W,w.push(X/E.width,0),w.push(X/E.width,1),X+=d.length(),w.push(X/E.width,0),w.push(X/E.width,1),z.push(T.x,T.y,T.z),z.push(T.x,T.y,T.z),z.push(v.x,v.y,v.z),z.push(v.x,v.y,v.z),x?(C.push(h),C.push(h+2),C.push(h+1),C.push(h+1),C.push(h+2),C.push(h+3)):(C.push(h),C.push(h+1),C.push(h+2),C.push(h+1),C.push(h+3),C.push(h+2)),h+=4}}}function H(f,z,w,C,x,u,h){const X=w||new Array(3),c=C,y=[],e=h||!1;for(let E=0;E<3;E++)void 0===X[E]&&(X[E]=new S.p(0,0,1,1)),c&&void 0===c[E]&&(c[E]=new K.f(1,1,1,1));const O=f.getVerticesData(E.f.PositionKind),d=f.getVerticesData(E.f.NormalKind),B=f.getVerticesData(E.f.UVKind),V=f.dk(),W=O.length/9;let T=0,v=0,D=0,A=0,M=0;const G=[0];if(e)for(let S=W;S<O.length/3;S+=4)v=O[3*(S+2)]-O[3*S],D=O[3*(S+2)+2]-O[3*S+2],A=Math.sqrt(v*v+D*D),M+=A,G.push(M);let I=0,n=0;for(let S=0;S<d.length;S+=3)Math.abs(d[S+1])<.001&&(n=1),Math.abs(d[S+1]-1)<.001&&(n=0),Math.abs(d[S+1]+1)<.001&&(n=2),I=S/3,1===n?(T=I-W,B[2*I]=T%4<1.5?e?X[n].x+(X[n].z-X[n].x)*G[Math.floor(T/4)]/M:X[n].x:e?X[n].x+(X[n].z-X[n].x)*G[Math.floor(T/4)+1]/M:X[n].z,B[2*I+1]=T%2===0?J.c?1-X[n].w:X[n].w:J.c?1-X[n].y:X[n].y):(B[2*I]=(1-B[2*I])*X[n].x+B[2*I]*X[n].z,B[2*I+1]=(1-B[2*I+1])*X[n].y+B[2*I+1]*X[n].w,J.c&&(B[2*I+1]=1-B[2*I+1])),c&&y.push(c[n].r,c[n].g,c[n].b,c[n].a);F.d._ComputeSides(z,O,V,d,B,x,u);const P=new F.d;if(P.indices=V,P.xa=O,P.ya=d,P.Aa=B,c){const f=z===F.d.DOUBLESIDE?y.concat(y):y;P.za=f}return P}function L(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation);const F=z.shape,J=z.holes||[],x=z.depth||0,u=z.smoothingThreshold||2,h=[];let X=[];for(let C=0;C<F.length;C++)h[C]=new S.l(F[C].x,F[C].z);h[0].equalsWithEpsilon(h[h.length-1],1e-8)&&h.pop();const K=new s(f,h,w||R.c.LastCreatedScene,E);for(let C=0;C<J.length;C++){X=[];for(let f=0;f<J[C].length;f++)X.push(new S.l(J[C][f].x,J[C][f].z));K.addHole(X)}const c=K.build(!1,x,u);c._originalBuilderSideOrientation=z.sideOrientation;return H(c,z.sideOrientation,z.faceUV,z.faceColors,z.frontUVs,z.backUVs,z.wrap).Ca(c,z.updatable),c}function U(f,z){return L(f,z,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function i(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=z.path,E=z.shape,F=z.scale||1,J=z.rotation||0,x=0===z.cap?0:z.cap||C.b.NO_CAP,u=z.updatable,h=C.b._GetDefaultSideOrientation(z.sideOrientation),X=z.instance||null,K=z.invertUV||!1,c=z.closeShape||!1;return r(f,E,S,F,J,null,null,z.closePath||!1,c,x,!1,w,!!u,h,X,K,z.frontUVs||null,z.backUVs||null,z.firstNormal||null,!!z.adjustFrame)}function m(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=z.path,E=z.shape,F=z.scaleFunction||(()=>1),J=z.rotationFunction||(()=>0),x=z.closePath||z.ribbonCloseArray||!1,u=z.closeShape||z.ribbonClosePath||!1,h=0===z.cap?0:z.cap||C.b.NO_CAP,X=z.updatable,K=z.firstNormal||null,c=z.adjustFrame||!1;return r(f,E,S,null,null,F,J,x,u,h,!0,w,!!X,C.b._GetDefaultSideOrientation(z.sideOrientation),z.instance||null,z.invertUV||!1,z.frontUVs||null,z.backUVs||null,K,c)}function r(f,z,w,E,F,J,x,h,X,K,c,y,e,O,d,B,V,W,T,v){const D=(f,z,w,E,F,J,x,u,h,X,K)=>{const c=w.getTangents(),y=w.getNormals(),e=w.getBinormals(),O=w.getDistances();if(K)for(let C=0;C<c.length;C++)if(0==c[C].x&&0==c[C].y&&0==c[C].z&&c[C].p(c[C-1]),0==y[C].x&&0==y[C].y&&0==y[C].z&&y[C].p(y[C-1]),0==e[C].x&&0==e[C].y&&0==e[C].z&&e[C].p(e[C-1]),C>0){let f=c[C-1];S.n.Dot(f,c[C])<0&&c[C].scaleInPlace(-1),f=y[C-1],S.n.Dot(f,y[C])<0&&y[C].scaleInPlace(-1),f=e[C-1],S.n.Dot(f,e[C])<0&&e[C].scaleInPlace(-1)}let d=0;const B=X&&u?u:()=>null!==J?J:0,V=X&&x?x:()=>null!==F?F:1;let W=h===C.b.NO_CAP||h===C.b.CAP_END?0:2;const T=S.j.Matrix[0];for(let C=0;C<z.length;C++){const w=[],F=B(C,O[C]),J=V(C,O[C]);S.b.RotationAxisToRef(c[C],d,T);for(let E=0;E<f.length;E++){const F=c[C].scale(f[E].z).add(y[C].scale(f[E].x)).add(e[C].scale(f[E].y)),x=S.n.Zero();S.n.TransformCoordinatesToRef(F,T,x),x.scaleInPlace(J).addInPlace(z[C]),w[E]=x}E[W]=w,d+=F,W++}const v=f=>{const z=Array(),w=S.n.Zero();let C;for(C=0;C<f.length;C++)w.addInPlace(f[C]);for(w.scaleInPlace(1/f.length),C=0;C<f.length;C++)z.push(w);return z};switch(h){case C.b.NO_CAP:break;case C.b.CAP_START:E[0]=v(E[2]),E[1]=E[2];break;case C.b.CAP_END:E[W]=E[W-1],E[W+1]=v(E[W-1]);break;case C.b.CAP_ALL:E[0]=v(E[2]),E[1]=E[2],E[W]=E[W-1],E[W+1]=v(E[W-1])}return E};let A,M;if(d){const f=d._creationDataStorage;return A=T?f.path3D.update(w,T):f.path3D.update(w),M=D(z,w,f.path3D,f.pathArray,E,F,J,x,f.cap,c,v),d=u("",{pathArray:M,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:d},y||void 0)}A=T?new n.l(w,T):new n.l(w);M=D(z,w,A,new Array,E,F,J,x,K=K<0||K>3?0:K,c,v);const G=u(f,{pathArray:M,closeArray:h,closePath:X,updatable:e,sideOrientation:O,invertUV:B,frontUVs:V||void 0,backUVs:W||void 0},y);return G._creationDataStorage.pathArray=M,G._creationDataStorage.path3D=A,G._creationDataStorage.cap=K,G}F.d.CreatePolygon=H,C.b.CreatePolygon=function(f,z,w,S,C,E){return L(f,{shape:z,holes:S,updatable:C,sideOrientation:E},w,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},C.b.ExtrudePolygon=function(f,z,w,S,C,E,F){return U(f,{shape:z,holes:C,depth:w,updatable:E,sideOrientation:F},S,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function o(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=z.arc?z.arc<=0||z.arc>1?1:z.arc:1,F=void 0===z.closed||z.closed,J=z.shape,x=z.radius||1,h=z.tessellation||64,X=z.clip||0,K=z.updatable,c=C.b._GetDefaultSideOrientation(z.sideOrientation),y=z.cap||C.b.NO_CAP,e=2*Math.PI,O=[],d=z.invertUV||!1;let B=0,V=0;const W=e/h*E;let T,v;for(B=0;B<=h-X;B++){for(v=[],y!=C.b.CAP_START&&y!=C.b.CAP_ALL||(v.push(new S.n(0,J[0].y,0)),v.push(new S.n(Math.cos(B*W)*J[0].x*x,J[0].y,Math.sin(B*W)*J[0].x*x))),V=0;V<J.length;V++)T=new S.n(Math.cos(B*W)*J[V].x*x,J[V].y,Math.sin(B*W)*J[V].x*x),v.push(T);y!=C.b.CAP_END&&y!=C.b.CAP_ALL||(v.push(new S.n(Math.cos(B*W)*J[J.length-1].x*x,J[J.length-1].y,Math.sin(B*W)*J[J.length-1].x*x)),v.push(new S.n(0,J[J.length-1].y,0))),O.push(v)}return u(f,{pathArray:O,closeArray:F,sideOrientation:c,updatable:K,invertUV:d,frontUVs:z.frontUVs,backUVs:z.backUVs},w)}C.b.ExtrudeShape=function(f,z,w,S,E,F){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0;return i(f,{shape:z,path:w,scale:S,rotation:E,cap:0===F?0:F||C.b.NO_CAP,sideOrientation:u,instance:h,updatable:x},J)},C.b.ExtrudeShapeCustom=(f,z,w,S,E,F,J,x,u,h,X,K)=>m(f,{shape:z,path:w,scaleFunction:S,rotationFunction:E,ribbonCloseArray:F,ribbonClosePath:J,cap:0===x?0:x||C.b.NO_CAP,sideOrientation:X,instance:K,updatable:h},u);C.b.CreateLathe=(f,z,w,S,C,E,F)=>o(f,{shape:z,radius:w,tessellation:S,sideOrientation:F,updatable:E},C);var p=w(12146),Y=w(12105);function t(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=z.path;let F=z.instance,J=1;void 0!==z.radius?J=z.radius:F&&(J=F._creationDataStorage.radius);const x=z.tessellation||64,h=z.radiusFunction||null;let X=z.cap||C.b.NO_CAP;const K=z.invertUV||!1,c=z.updatable,y=C.b._GetDefaultSideOrientation(z.sideOrientation);z.arc=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1;const e=(f,z,w,E,F,J,x,u)=>{const h=z.getTangents(),X=z.getNormals(),K=z.getDistances(),c=2*Math.PI/F*u,y=J||(()=>E);let e,O,d,B;const V=S.j.Matrix[0];let W=x===C.b.NO_CAP||x===C.b.CAP_END?0:2;for(let C=0;C<f.length;C++){O=y(C,K[C]),e=Array(),d=X[C];for(let z=0;z<F;z++)S.b.RotationAxisToRef(h[C],c*z,V),B=e[z]?e[z]:S.n.Zero(),S.n.TransformCoordinatesToRef(d,V,B),B.scaleInPlace(O).addInPlace(f[C]),e[z]=B;w[W]=e,W++}const T=(z,w)=>{const S=Array();for(let C=0;C<z;C++)S.push(f[w]);return S};switch(x){case C.b.NO_CAP:break;case C.b.CAP_START:w[0]=T(F,0),w[1]=w[2].slice(0);break;case C.b.CAP_END:w[W]=w[W-1].slice(0),w[W+1]=T(F,f.length-1);break;case C.b.CAP_ALL:w[0]=T(F,0),w[1]=w[2].slice(0),w[W]=w[W-1].slice(0),w[W+1]=T(F,f.length-1)}return w};let O,d;if(F){const f=F._creationDataStorage,w=z.arc||f.arc;return O=f.path3D.update(E),d=e(E,O,f.pathArray,J,f.tessellation,h,f.cap,w),F=u("",{pathArray:d,instance:F}),f.path3D=O,f.pathArray=d,f.arc=w,f.radius=J,F}O=new n.l(E);X=X<0||X>3?0:X,d=e(E,O,new Array,J,x,h,X,z.arc);const B=u(f,{pathArray:d,closePath:!0,closeArray:!1,updatable:c,sideOrientation:y,invertUV:K,frontUVs:z.frontUVs,backUVs:z.backUVs},w);return B._creationDataStorage.pathArray=d,B._creationDataStorage.path3D=O,B._creationDataStorage.tessellation=x,B._creationDataStorage.cap=X,B._creationDataStorage.arc=z.arc,B._creationDataStorage.radius=J,B}function Z(f){const z=[];z[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},z[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},z[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},z[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},z[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},z[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},z[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},z[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},z[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},z[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},z[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},z[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},z[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},z[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},z[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const w=f.type&&(f.type<0||f.type>=z.length)?0:f.type||0,C=f.size,E=f.sizeX||C||1,x=f.sizeY||C||1,u=f.sizeZ||C||1,h=f.custom||z[w],X=h.face.length,c=f.faceUV||new Array(X),y=f.faceColors,e=void 0===f.flat||f.flat,O=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,d=[],B=[],V=[],W=[],T=[];let v=0,D=0;const A=[];let M,G,I,n,P,R,q=0,a=0;if(e)for(a=0;a<X;a++)y&&void 0===y[a]&&(y[a]=new K.f(1,1,1,1)),c&&void 0===c[a]&&(c[a]=new S.p(0,0,1,1));if(e)for(a=0;a<X;a++){const f=h.face[a].length;for(I=2*Math.PI/f,n=.5*Math.tan(I/2),P=.5,q=0;q<f;q++)d.push(h.vertex[h.face[a][q]][0]*E,h.vertex[h.face[a][q]][1]*x,h.vertex[h.face[a][q]][2]*u),A.push(v),v++,M=c[a].x+(c[a].z-c[a].x)*(.5+n),G=c[a].y+(c[a].w-c[a].y)*(P-.5),W.push(M,J.c?1-G:G),R=n*Math.cos(I)-P*Math.sin(I),P=n*Math.sin(I)+P*Math.cos(I),n=R,y&&T.push(y[a].r,y[a].g,y[a].b,y[a].a);for(q=0;q<f-2;q++)B.push(A[0+D],A[q+2+D],A[q+1+D]);D+=f}else{for(q=0;q<h.vertex.length;q++)d.push(h.vertex[q][0]*E,h.vertex[q][1]*x,h.vertex[q][2]*u),W.push(0,J.c?1:0);for(a=0;a<X;a++)for(q=0;q<h.face[a].length-2;q++)B.push(h.face[a][0],h.face[a][q+2],h.face[a][q+1])}F.d.ComputeNormals(d,B,V),F.d._ComputeSides(O,d,B,V,W,f.frontUVs,f.backUVs);const s=new F.d;return s.xa=d,s.indices=B,s.ya=V,s.Aa=W,y&&e&&(s.za=T),s}function b(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return Z(z).Ca(S,z.updatable),S}C.b.CreateTube=(f,z,w,S,C,E,F,J,x,u)=>t(f,{path:z,radius:w,tessellation:S,radiusFunction:C,arc:1,cap:E,updatable:J,sideOrientation:x,instance:u},F);function Q(f){const z=f.sideOrientation||F.d.DEFAULTSIDE,w=f.radius||1,C=void 0===f.flat||f.flat,E=0|(f.subdivisions||4),x=f.radiusX||w,u=f.radiusY||w,h=f.radiusZ||w,X=(1+Math.sqrt(5))/2,K=[-1,X,-0,1,X,0,-1,-X,0,1,-X,0,0,-1,-X,0,1,-X,0,-1,X,0,1,X,X,0,1,X,0,-1,-X,0,1,-X,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],e=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],O=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],d=[],B=[],V=[],W=[];let T=0;const v=new Array(3),D=new Array(3);let A;for(A=0;A<3;A++)v[A]=S.n.Zero(),D[A]=S.l.Zero();for(let F=0;F<20;F++){for(A=0;A<3;A++){const f=c[3*F+A];v[A].Gd(K[3*y[f]],K[3*y[f]+1],K[3*y[f]+2]),v[A].normalize(),D[A].Gd(.134765625*e[2*f]+.05859375+-.0390625*O[F],.2333984375*e[2*f+1]+.025390625+.01953125*O[F])}const f=(f,z,w,F)=>{const X=S.n.Lerp(v[0],v[2],z/E),K=S.n.Lerp(v[1],v[2],z/E),c=E===z?v[2]:S.n.Lerp(X,K,f/(E-z));let y;if(c.normalize(),C){const f=S.n.Lerp(v[0],v[2],F/E),z=S.n.Lerp(v[1],v[2],F/E);y=S.n.Lerp(f,z,w/(E-F))}else y=new S.n(c.x,c.y,c.z);y.x/=x,y.y/=u,y.z/=h,y.normalize();const e=S.l.Lerp(D[0],D[2],z/E),O=S.l.Lerp(D[1],D[2],z/E),A=E===z?D[2]:S.l.Lerp(e,O,f/(E-z));B.push(c.x*x,c.y*u,c.z*h),V.push(y.x,y.y,y.z),W.push(A.x,J.c?1-A.y:A.y),d.push(T),T++};for(let z=0;z<E;z++)for(let w=0;w+z<E;w++)f(w,z,w+1/3,z+1/3),f(w+1,z,w+1/3,z+1/3),f(w,z+1,w+1/3,z+1/3),w+z+1<E&&(f(w+1,z,w+2/3,z+2/3),f(w+1,z+1,w+2/3,z+2/3),f(w,z+1,w+2/3,z+2/3))}F.d._ComputeSides(z,B,d,V,W,f.frontUVs,f.backUVs);const M=new F.d;return M.indices=d,M.xa=B,M.ya=V,M.Aa=W,M}function g(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new C.b(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),S._originalBuilderSideOrientation=z.sideOrientation;return Q(z).Ca(S,z.updatable),S}F.d.CreatePolyhedron=Z,C.b.CreatePolyhedron=(f,z,w)=>b(f,z,w);F.d.CreateIcoSphere=Q,C.b.CreateIcoSphere=(f,z,w)=>g(f,z,w);var k=w(741);const j=new S.n(1,0,0),l=new S.n(-1,0,0),N=new S.n(0,1,0),ff=new S.n(0,-1,0),zf=new S.n(0,0,1),wf=new S.n(0,0,-1);class Sf{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.n.Zero(),z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.n.Up(),w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.l.Zero(),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=f,this.lk=z,this.uv=w,this.vertexIdx=C,this.vertexIdxForBones=E,this.localPositionOverride=F,this.localNormalOverride=J,this.matrixIndicesOverride=x,this.matrixWeightsOverride=u}clone(){var f,z,w,S;return new Sf(this.position.clone(),this.lk.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(f=this.localPositionOverride)||void 0===f?void 0:f.slice(),null===(z=this.localNormalOverride)||void 0===z?void 0:z.slice(),null===(w=this.matrixIndicesOverride)||void 0===w?void 0:w.slice(),null===(S=this.matrixWeightsOverride)||void 0===S?void 0:S.slice())}}function Cf(f,z,w){var x,u,h,X;const K=!!z.skeleton,c=w.localMode||K,y=z.dk(),e=K?z.md(!0,!0):z.getVerticesData(E.f.PositionKind),O=K?z.getNormalsData(!0,!0):z.getVerticesData(E.f.NormalKind),d=c?K?z.getVerticesData(E.f.PositionKind):e:null,B=c?K?z.getVerticesData(E.f.NormalKind):O:null,V=z.getVerticesData(E.f.UVKind),W=K?z.getVerticesData(E.f.MatricesIndicesKind):null,T=K?z.getVerticesData(E.f.MatricesWeightsKind):null,v=K?z.getVerticesData(E.f.MatricesIndicesExtraKind):null,D=K?z.getVerticesData(E.f.MatricesWeightsExtraKind):null,A=w.position||S.n.Zero();let M=w.lk||S.n.Up();const G=w.size||S.n.One(),I=w.angle||0;if(!M){const f=new S.n(0,0,1),w=z.va().activeCamera,C=S.n.TransformCoordinates(f,w.getWorldMatrix());M=w.globalPosition.te(C)}const n=-Math.atan2(M.z,M.x)-Math.PI/2,P=Math.sqrt(M.x*M.x+M.z*M.z),R=Math.atan2(M.y,P),q=new F.d;q.indices=[],q.xa=[],q.ya=[],q.Aa=[],q.matricesIndices=K?[]:null,q.matricesWeights=K?[]:null,q.matricesIndicesExtra=v?[]:null,q.matricesWeightsExtra=D?[]:null;let a=0;const s=(f,z)=>{const C=new Sf;if(!y||!e||!O)return C;const E=y[f];if(C.vertexIdx=3*E,C.vertexIdxForBones=4*E,C.position=new S.n(e[3*E],e[3*E+1],e[3*E+2]),S.n.TransformCoordinatesToRef(C.position,z,C.position),C.lk=new S.n(O[3*E],O[3*E+1],O[3*E+2]),S.n.TransformNormalToRef(C.lk,z,C.lk),w.captureUVS&&V){const f=V[2*E+1];C.uv=new S.l(V[2*E],J.c?1-f:f)}return C},H=[0,0,0,0],L=(f,z)=>{if(0===f.length)return f;const w=.5*Math.abs(S.n.Dot(G,z)),C=(f,z,w,S)=>{for(let C=0;C<S;++C)if(f[w+C]===z)return w+C;return-1},E=(f,E)=>{const F=S.n.GetClipFactor(f.position,E.position,z,w);let J=H,x=H;if(W&&T){const z=f.matrixIndicesOverride?0:f.vertexIdxForBones,w=f.matrixIndicesOverride??W,S=f.matrixWeightsOverride??T,u=E.matrixIndicesOverride?0:E.vertexIdxForBones,h=E.matrixIndicesOverride??W,X=E.matrixWeightsOverride??T;J=[0,0,0,0],x=[0,0,0,0];let K=0;for(let f=0;f<4;++f)if(S[z+f]>0){const E=C(h,w[z+f],u,4);J[K]=w[z+f],x[K]=(0,k.m)(S[z+f],E>=0?X[E]:0,F),K++}for(let f=0;f<4&&K<4;++f){const S=h[u+f];-1===C(w,S,z,4)&&(J[K]=S,x[K]=(0,k.m)(0,X[u+f],F),K++)}const c=x[0]+x[1]+x[2]+x[3];x[0]/=c,x[1]/=c,x[2]/=c,x[3]/=c}const u=f.localPositionOverride?f.localPositionOverride[0]:(null===d||void 0===d?void 0:d[f.vertexIdx])??0,h=f.localPositionOverride?f.localPositionOverride[1]:(null===d||void 0===d?void 0:d[f.vertexIdx+1])??0,X=f.localPositionOverride?f.localPositionOverride[2]:(null===d||void 0===d?void 0:d[f.vertexIdx+2])??0,K=E.localPositionOverride?E.localPositionOverride[0]:(null===d||void 0===d?void 0:d[E.vertexIdx])??0,c=E.localPositionOverride?E.localPositionOverride[1]:(null===d||void 0===d?void 0:d[E.vertexIdx+1])??0,y=E.localPositionOverride?E.localPositionOverride[2]:(null===d||void 0===d?void 0:d[E.vertexIdx+2])??0,e=f.localNormalOverride?f.localNormalOverride[0]:(null===B||void 0===B?void 0:B[f.vertexIdx])??0,O=f.localNormalOverride?f.localNormalOverride[1]:(null===B||void 0===B?void 0:B[f.vertexIdx+1])??0,V=f.localNormalOverride?f.localNormalOverride[2]:(null===B||void 0===B?void 0:B[f.vertexIdx+2])??0,v=e+((E.localNormalOverride?E.localNormalOverride[0]:(null===B||void 0===B?void 0:B[E.vertexIdx])??0)-e)*F,D=O+((E.localNormalOverride?E.localNormalOverride[1]:(null===B||void 0===B?void 0:B[E.vertexIdx+1])??0)-O)*F,A=V+((E.localNormalOverride?E.localNormalOverride[2]:(null===B||void 0===B?void 0:B[E.vertexIdx+2])??0)-V)*F,M=Math.sqrt(v*v+D*D+A*A);return new Sf(S.n.Lerp(f.position,E.position,F),S.n.Lerp(f.lk,E.lk,F).normalize(),S.l.Lerp(f.uv,E.uv,F),-1,-1,d?[u+(K-u)*F,h+(c-h)*F,X+(y-X)*F]:null,B?[v/M,D/M,A/M]:null,J,x)};let F=null;f.length>3&&(F=[]);for(let J=0;J<f.length;J+=3){let C=0,x=null,u=null,h=null,X=null;const K=S.n.Dot(f[J].position,z)-w>0,c=S.n.Dot(f[J+1].position,z)-w>0,y=S.n.Dot(f[J+2].position,z)-w>0;switch(C=(K?1:0)+(c?1:0)+(y?1:0),C){case 0:f.length>3?(F.push(f[J]),F.push(f[J+1]),F.push(f[J+2])):F=f;break;case 1:if(F=F??new Array,K&&(x=f[J+1],u=f[J+2],h=E(f[J],x),X=E(f[J],u)),c){x=f[J],u=f[J+2],h=E(f[J+1],x),X=E(f[J+1],u),F.push(h),F.push(u.clone()),F.push(x.clone()),F.push(u.clone()),F.push(h.clone()),F.push(X);break}y&&(x=f[J],u=f[J+1],h=E(f[J+2],x),X=E(f[J+2],u)),x&&u&&h&&X&&(F.push(x.clone()),F.push(u.clone()),F.push(h),F.push(X),F.push(h.clone()),F.push(u.clone()));break;case 2:F=F??new Array,K||(x=f[J].clone(),u=E(x,f[J+1]),h=E(x,f[J+2]),F.push(x),F.push(u),F.push(h)),c||(x=f[J+1].clone(),u=E(x,f[J+2]),h=E(x,f[J]),F.push(x),F.push(u),F.push(h)),y||(x=f[J+2].clone(),u=E(x,f[J]),h=E(x,f[J+1]),F.push(x),F.push(u),F.push(h))}}return F},U=z instanceof C.b?z:null,i=null===U||void 0===U?void 0:U._thinInstanceDataStorage.matrixData,m=(null===U||void 0===U?void 0:U.hc)||1,r=S.j.Matrix[0];r.p(S.b.IdentityReadOnly);for(let C=0;C<m;++C){if(null!==U&&void 0!==U&&U.hasThinInstances&&i){const f=16*C;r.setRowFromFloats(0,i[f+0],i[f+1],i[f+2],i[f+3]),r.setRowFromFloats(1,i[f+4],i[f+5],i[f+6],i[f+7]),r.setRowFromFloats(2,i[f+8],i[f+9],i[f+10],i[f+11]),r.setRowFromFloats(3,i[f+12],i[f+13],i[f+14],i[f+15])}const f=S.b.RotationYawPitchRoll(n,R,I).multiply(S.b.Translation(A.x,A.y,A.z)),E=S.b.Invert(f),F=z.getWorldMatrix(),x=r.multiply(F).multiply(E),u=new Array(3);for(let z=0;z<y.length;z+=3){let f=u;if(f[0]=s(z,x),f[1]=s(z+1,x),f[2]=s(z+2,x),!(w.cullBackFaces&&-f[0].lk.z<=0&&-f[1].lk.z<=0&&-f[2].lk.z<=0)&&(f=L(f,j),f&&(f=L(f,l),f&&(f=L(f,N),f&&(f=L(f,ff),f&&(f=L(f,zf),f&&(f=L(f,wf),f)))))))for(let z=0;z<f.length;z++){const S=f[z];if(q.indices.push(a),c?(S.localPositionOverride?(q.xa[3*a]=S.localPositionOverride[0],q.xa[3*a+1]=S.localPositionOverride[1],q.xa[3*a+2]=S.localPositionOverride[2]):d&&(q.xa[3*a]=d[S.vertexIdx],q.xa[3*a+1]=d[S.vertexIdx+1],q.xa[3*a+2]=d[S.vertexIdx+2]),S.localNormalOverride?(q.ya[3*a]=S.localNormalOverride[0],q.ya[3*a+1]=S.localNormalOverride[1],q.ya[3*a+2]=S.localNormalOverride[2]):B&&(q.ya[3*a]=B[S.vertexIdx],q.ya[3*a+1]=B[S.vertexIdx+1],q.ya[3*a+2]=B[S.vertexIdx+2])):(S.position.toArray(q.xa,3*a),S.lk.toArray(q.ya,3*a)),q.matricesIndices&&q.matricesWeights&&(S.matrixIndicesOverride?(q.matricesIndices[4*a]=S.matrixIndicesOverride[0],q.matricesIndices[4*a+1]=S.matrixIndicesOverride[1],q.matricesIndices[4*a+2]=S.matrixIndicesOverride[2],q.matricesIndices[4*a+3]=S.matrixIndicesOverride[3]):(W&&(q.matricesIndices[4*a]=W[S.vertexIdxForBones],q.matricesIndices[4*a+1]=W[S.vertexIdxForBones+1],q.matricesIndices[4*a+2]=W[S.vertexIdxForBones+2],q.matricesIndices[4*a+3]=W[S.vertexIdxForBones+3]),v&&q.matricesIndicesExtra&&(q.matricesIndicesExtra[4*a]=v[S.vertexIdxForBones],q.matricesIndicesExtra[4*a+1]=v[S.vertexIdxForBones+1],q.matricesIndicesExtra[4*a+2]=v[S.vertexIdxForBones+2],q.matricesIndicesExtra[4*a+3]=v[S.vertexIdxForBones+3])),S.matrixWeightsOverride?(q.matricesWeights[4*a]=S.matrixWeightsOverride[0],q.matricesWeights[4*a+1]=S.matrixWeightsOverride[1],q.matricesWeights[4*a+2]=S.matrixWeightsOverride[2],q.matricesWeights[4*a+3]=S.matrixWeightsOverride[3]):(T&&(q.matricesWeights[4*a]=T[S.vertexIdxForBones],q.matricesWeights[4*a+1]=T[S.vertexIdxForBones+1],q.matricesWeights[4*a+2]=T[S.vertexIdxForBones+2],q.matricesWeights[4*a+3]=T[S.vertexIdxForBones+3]),D&&q.matricesWeightsExtra&&(q.matricesWeightsExtra[4*a]=D[S.vertexIdxForBones],q.matricesWeightsExtra[4*a+1]=D[S.vertexIdxForBones+1],q.matricesWeightsExtra[4*a+2]=D[S.vertexIdxForBones+2],q.matricesWeightsExtra[4*a+3]=D[S.vertexIdxForBones+3]))),w.captureUVS)S.uv.toArray(q.Aa,2*a);else{q.Aa.push(.5+S.position.x/G.x);const f=.5+S.position.y/G.y;q.Aa.push(J.c?1-f:f)}a++}}}0===q.indices.length&&(q.indices=null),0===q.xa.length&&(q.xa=null),0===q.ya.length&&(q.ya=null),0===q.Aa.length&&(q.Aa=null),0===(null===(x=q.matricesIndices)||void 0===x?void 0:x.length)&&(q.matricesIndices=null),0===(null===(u=q.matricesWeights)||void 0===u?void 0:u.length)&&(q.matricesWeights=null),0===(null===(h=q.matricesIndicesExtra)||void 0===h?void 0:h.length)&&(q.matricesIndicesExtra=null),0===(null===(X=q.matricesWeightsExtra)||void 0===X?void 0:X.length)&&(q.matricesWeightsExtra=null);const o=new C.b(f,z.va());return q.Ca(o),c?(o.skeleton=z.skeleton,o.parent=z):(o.position=A.clone(),o.rotation=new S.n(R,n,I)),o.bk(!0),o.refreshBoundingInfo(!0,!0),o}function Ef(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const z=0|Math.max(f.subdivisions?f.subdivisions:2,1),w=0|Math.max(f.tessellation?f.tessellation:16,3),C=Math.max(f.height?f.height:1,0),E=Math.max(f.radius?f.radius:.25,0),x=0|Math.max(f.capSubdivisions?f.capSubdivisions:6,1),u=w,h=z,X=Math.max(f.radiusTop?f.radiusTop:E,0),K=Math.max(f.radiusBottom?f.radiusBottom:E,0),c=C-(X+K),y=2*Math.PI,e=Math.max(f.topCapSubdivisions?f.topCapSubdivisions:x,1),O=Math.max(f.bottomCapSubdivisions?f.bottomCapSubdivisions:x,1),d=Math.acos((K-X)/C);let B=[];const V=[],W=[],T=[];let v=0;const D=[],A=.5*c,M=.5*Math.PI;let G,I;const n=S.n.Zero(),P=S.n.Zero(),R=Math.cos(d),q=Math.sin(d),a=new S.l(X*q,A+X*R).te(new S.l(K*q,K*R-A)).length(),s=X*d+a+K*(M-d);let H=0;for(I=0;I<=e;I++){const f=[],z=M-d*(I/e);H+=X*d/e;const w=Math.cos(z),S=Math.sin(z),C=w*X;for(G=0;G<=u;G++){const z=G/u,E=z*y+0,F=Math.sin(E),x=Math.cos(E);P.x=C*F,P.y=A+S*X,P.z=C*x,V.push(P.x,P.y,P.z),n.set(w*F,S,w*x),W.push(n.x,n.y,n.z),T.push(z,J.c?H/s:1-H/s),f.push(v),v++}D.push(f)}const L=C-X-K+R*X-R*K,U=q*(K-X)/L;for(I=1;I<=h;I++){const f=[];H+=a/h;const z=q*(I*(K-X)/h+X);for(G=0;G<=u;G++){const w=G/u,S=w*y+0,C=Math.sin(S),E=Math.cos(S);P.x=z*C,P.y=A+R*X-I*L/h,P.z=z*E,V.push(P.x,P.y,P.z),n.set(C,U,E).normalize(),W.push(n.x,n.y,n.z),T.push(w,J.c?H/s:1-H/s),f.push(v),v++}D.push(f)}for(I=1;I<=O;I++){const f=[],z=M-d-(Math.PI-d)*(I/O);H+=K*d/O;const w=Math.cos(z),S=Math.sin(z),C=w*K;for(G=0;G<=u;G++){const z=G/u,E=z*y+0,F=Math.sin(E),x=Math.cos(E);P.x=C*F,P.y=S*K-A,P.z=C*x,V.push(P.x,P.y,P.z),n.set(w*F,S,w*x),W.push(n.x,n.y,n.z),T.push(z,J.c?H/s:1-H/s),f.push(v),v++}D.push(f)}for(G=0;G<u;G++)for(I=0;I<e+h+O;I++){const f=D[I][G],z=D[I+1][G],w=D[I+1][G+1],S=D[I][G+1];B.push(f),B.push(z),B.push(S),B.push(z),B.push(w),B.push(S)}if(B=B.reverse(),f.orientation&&!f.orientation.equals(S.n.Up())){const z=new S.b;f.orientation.clone().scale(.5*Math.PI).cross(S.n.Up()).toQuaternion().toRotationMatrix(z);const w=S.n.Zero();for(let f=0;f<V.length;f+=3)w.set(V[f],V[f+1],V[f+2]),S.n.TransformCoordinatesToRef(w.clone(),z,w),V[f]=w.x,V[f+1]=w.y,V[f+2]=w.z}const i=new F.d;return i.xa=V,i.ya=W,i.Aa=T,i.indices=B,i}function Ff(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:S.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new C.b(f,w);return Ef(z).Ca(E,z.updatable),E}C.b.CreateDecal=(f,z,w,S,C,E)=>Cf(f,z,{position:w,lk:S,size:C,angle:E});C.b.CreateCapsule=(f,z,w)=>Ff(f,z,w),F.d.CreateCapsule=Ef;class Jf{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=f,this.y=z,f!==Math.floor(f)&&(f=Math.floor(f),I.b.Warn("x is not an integer, floor(x) used")),z!==Math.floor(z)&&(z=Math.floor(z),I.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Jf(this.x,this.y)}rotate60About(f){const z=this.x;return this.x=f.x+f.y-this.y,this.y=z+this.y-f.x,this}rotateNeg60About(f){const z=this.x;return this.x=z+this.y-f.y,this.y=f.x+f.y-z,this}rotate120(f,z){f!==Math.floor(f)&&(f=Math.floor(f),I.b.Warn("m not an integer only floor(m) used")),z!==Math.floor(z)&&(z=Math.floor(z),I.b.Warn("n not an integer only floor(n) used"));const w=this.x;return this.x=f-w-this.y,this.y=z+w,this}rotateNeg120(f,z){f!==Math.floor(f)&&(f=Math.floor(f),I.b.Warn("m is not an integer, floor(m) used")),z!==Math.floor(z)&&(z=Math.floor(z),I.b.Warn("n is not an integer,   floor(n) used"));const w=this.x;return this.x=this.y-z,this.y=f+z-w-this.y,this}toCartesianOrigin(f,z){const w=S.n.Zero();return w.x=f.x+2*this.x*z+this.y*z,w.y=f.y+Math.sqrt(3)*this.y*z,w}static Zero(){return new Jf(0,0)}}class xf{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new uf("icosahedron","Regular",[[0,P.f,-1],[-P.f,1,0],[-1,0,-P.f],[1,0,-P.f],[P.f,1,0],[0,P.f,1],[-1,0,P.f],[-P.f,-1,0],[0,-P.f,-1],[P.f,-1,0],[1,0,P.f],[0,-P.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let f=12;const z={},w=this.m,S=this.n;let C,E,F,J,x,u=w,h=1,X=0;0!==S&&(u=(0,k.g)(w,S)),h=w/u,X=S/u;const K=Jf.Zero(),c=new Jf(w,S),y=new Jf(-S,w+S),e=Jf.Zero(),O=Jf.Zero(),d=Jf.Zero();let B,V,W,T,v=[];const D=[],A=this.vertByDist,M=(w,S,C,E)=>{B=w+"|"+C,V=S+"|"+E,B in z||V in z?B in z&&!(V in z)?z[V]=z[B]:V in z&&!(B in z)&&(z[B]=z[V]):(z[B]=f,z[V]=f,f++),A[C][0]>2?D[z[B]]=[-A[C][0],A[C][1],z[B]]:D[z[B]]=[v[A[C][0]],A[C][1],z[B]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let G=0;G<20;G++){if(v=this.IDATA.face[G],F=v[2],J=v[1],x=v[0],W=K.x+"|"+K.y,B=G+"|"+W,B in z||(z[B]=F,D[F]=[v[A[W][0]],A[W][1]]),W=c.x+"|"+c.y,B=G+"|"+W,B in z||(z[B]=J,D[J]=[v[A[W][0]],A[W][1]]),W=y.x+"|"+y.y,B=G+"|"+W,B in z||(z[B]=x,D[x]=[v[A[W][0]],A[W][1]]),C=this.IDATA.edgematch[G][0],E=this.IDATA.edgematch[G][1],"B"===E)for(let f=1;f<u;f++)O.x=w-f*(h+X),O.y=S+f*h,d.x=-f*X,d.y=f*(h+X),W=O.x+"|"+O.y,T=d.x+"|"+d.y,M(G,C,W,T);if("O"===E)for(let f=1;f<u;f++)d.x=-f*X,d.y=f*(h+X),e.x=f*h,e.y=f*X,W=d.x+"|"+d.y,T=e.x+"|"+e.y,M(G,C,W,T);if(C=this.IDATA.edgematch[G][2],E=this.IDATA.edgematch[G][3],E&&"A"===E)for(let f=1;f<u;f++)e.x=f*h,e.y=f*X,O.x=w-(u-f)*(h+X),O.y=S+(u-f)*h,W=e.x+"|"+e.y,T=O.x+"|"+O.y,M(G,C,W,T);for(let w=0;w<this.vertices.length;w++)W=this.vertices[w].x+"|"+this.vertices[w].y,B=G+"|"+W,B in z||(z[B]=f++,A[W][0]>2?D[z[B]]=[-A[W][0],A[W][1],z[B]]:D[z[B]]=[v[A[W][0]],A[W][1],z[B]])}this.closestTo=D,this.vecToidx=z}calcCoeffs(){const f=this.m,z=this.n,w=Math.sqrt(3)/3,S=f*f+z*z+f*z;this.coau=(f+z)/S,this.cobu=-z/S,this.coav=-w*(f-z)/S,this.cobv=w*(2*f+z)/S}createInnerFacets(){const f=this.m,z=this.n;for(let w=0;w<z+f+1;w++)for(let f=this.min[w];f<this.max[w]+1;f++)f<this.max[w]&&f<this.max[w+1]+1&&this.innerFacets.push(["|"+f+"|"+w,"|"+f+"|"+(w+1),"|"+(f+1)+"|"+w]),w>0&&f<this.max[w-1]&&f+1<this.max[w]+1&&this.innerFacets.push(["|"+f+"|"+w,"|"+(f+1)+"|"+w,"|"+(f+1)+"|"+(w-1)])}edgeVecsABOB(){const f=this.m,z=this.n,w=new Jf(-z,f+z);for(let S=1;S<f+z;S++){const f=new Jf(this.min[S],S),z=new Jf(this.min[S-1],S-1),C=new Jf(this.min[S+1],S+1),E=f.clone(),F=z.clone(),J=C.clone();E.rotate60About(w),F.rotate60About(w),J.rotate60About(w);const x=new Jf(this.max[E.y],E.y),u=new Jf(this.max[E.y-1],E.y-1),h=new Jf(this.max[E.y-1]-1,E.y-1);E.x===x.x&&E.y===x.y||(E.x!==u.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,u,h]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,h,x])):E.y===J.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,z,u]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([f,u,C])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,z,u]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,u,x])))}}mapABOBtoOBOA(){const f=new Jf(0,0);for(let z=0;z<this.isoVecsABOB.length;z++){const w=[];for(let S=0;S<3;S++)f.x=this.isoVecsABOB[z][S].x,f.y=this.isoVecsABOB[z][S].y,0===this.vertexTypes[z][S]&&f.rotateNeg120(this.m,this.n),w.push(f.clone());this.isoVecsOBOA.push(w)}}mapABOBtoBAOA(){const f=new Jf(0,0);for(let z=0;z<this.isoVecsABOB.length;z++){const w=[];for(let S=0;S<3;S++)f.x=this.isoVecsABOB[z][S].x,f.y=this.isoVecsABOB[z][S].y,1===this.vertexTypes[z][S]&&f.rotate120(this.m,this.n),w.push(f.clone());this.isoVecsBAOA.push(w)}}MapToFace(f,z){const w=this.IDATA.face[f],C=w[2],E=w[1],F=w[0],J=S.n.ck(this.IDATA.vertex[C]),x=S.n.ck(this.IDATA.vertex[E]),u=S.n.ck(this.IDATA.vertex[F]),h=x.te(J),X=u.te(J),K=h.scale(this.coau).add(X.scale(this.cobu)),c=h.scale(this.coav).add(X.scale(this.cobv)),y=[];let e,O=S.j.ek[0];for(let S=0;S<this.cartesian.length;S++)O=K.scale(this.cartesian[S].x).add(c.scale(this.cartesian[S].y)).add(J),y[S]=[O.x,O.y,O.z],e=f+"|"+this.vertices[S].x+"|"+this.vertices[S].y,z.vertex[this.vecToidx[e]]=[O.x,O.y,O.z]}build(f,z){const w=[],S=Jf.Zero(),C=new Jf(f,z),E=new Jf(-z,f+z);w.push(S,C,E);for(let W=z;W<f+1;W++)for(let z=0;z<f+1-W;z++)w.push(new Jf(z,W));if(z>0){const S=(0,k.g)(f,z),C=f/S,E=z/S;for(let J=1;J<S;J++)w.push(new Jf(J*C,J*E)),w.push(new Jf(-J*E,J*(C+E))),w.push(new Jf(f-J*(C+E),z+J*C));const F=f/z;for(let J=1;J<z;J++)for(let S=0;S<J*F;S++)w.push(new Jf(S,J)),w.push(new Jf(S,J).rotate120(f,z)),w.push(new Jf(S,J).rotateNeg120(f,z))}w.sort(((f,z)=>f.x-z.x)),w.sort(((f,z)=>f.y-z.y));const F=new Array(f+z+1),J=new Array(f+z+1);for(let W=0;W<F.length;W++)F[W]=1/0,J[W]=-1/0;let x=0,u=0;const h=w.length;for(let W=0;W<h;W++)u=w[W].x,x=w[W].y,F[x]=Math.min(u,F[x]),J[x]=Math.max(u,J[x]);const X=(w,S)=>{const C=w.clone();return"A"===S&&C.rotateNeg120(f,z),"B"===S&&C.rotate120(f,z),C.x<0?C.y:C.x+C.y},K=[],c=[],y=[],e=[],O={},d=[];let B=-1,V=-1;for(let W=0;W<h;W++)K[W]=w[W].toCartesianOrigin(new Jf(0,0),.5),c[W]=X(w[W],"O"),y[W]=X(w[W],"A"),e[W]=X(w[W],"B"),c[W]===y[W]&&y[W]===e[W]?(B=3,V=c[W]):c[W]===y[W]?(B=4,V=c[W]):y[W]===e[W]?(B=5,V=y[W]):e[W]===c[W]&&(B=6,V=c[W]),c[W]<y[W]&&c[W]<e[W]&&(B=2,V=c[W]),y[W]<c[W]&&y[W]<e[W]&&(B=1,V=y[W]),e[W]<y[W]&&e[W]<c[W]&&(B=0,V=e[W]),d.push([B,V,w[W].x,w[W].y]);d.sort(((f,z)=>f[2]-z[2])),d.sort(((f,z)=>f[3]-z[3])),d.sort(((f,z)=>f[1]-z[1])),d.sort(((f,z)=>f[0]-z[0]));for(let W=0;W<d.length;W++)O[d[W][2]+"|"+d[W][3]]=[d[W][0],d[W][1],W];return this.m=f,this.n=z,this.vertices=w,this.vertByDist=O,this.cartesian=K,this.min=F,this.max=J,this}}class uf{constructor(f,z,w,S){this.name=f,this.category=z,this.vertex=w,this.face=S}}class hf extends uf{innerToData(f,z){for(let w=0;w<z.innerFacets.length;w++)this.face.push(z.innerFacets[w].map((w=>z.vecToidx[f+w])))}mapABOBtoDATA(f,z){const w=z.IDATA.edgematch[f][0];for(let S=0;S<z.isoVecsABOB.length;S++){const C=[];for(let E=0;E<3;E++)0===z.vertexTypes[S][E]?C.push(f+"|"+z.isoVecsABOB[S][E].x+"|"+z.isoVecsABOB[S][E].y):C.push(w+"|"+z.isoVecsABOB[S][E].x+"|"+z.isoVecsABOB[S][E].y);this.face.push([z.vecToidx[C[0]],z.vecToidx[C[1]],z.vecToidx[C[2]]])}}mapOBOAtoDATA(f,z){const w=z.IDATA.edgematch[f][0];for(let S=0;S<z.isoVecsOBOA.length;S++){const C=[];for(let E=0;E<3;E++)1===z.vertexTypes[S][E]?C.push(f+"|"+z.isoVecsOBOA[S][E].x+"|"+z.isoVecsOBOA[S][E].y):C.push(w+"|"+z.isoVecsOBOA[S][E].x+"|"+z.isoVecsOBOA[S][E].y);this.face.push([z.vecToidx[C[0]],z.vecToidx[C[1]],z.vecToidx[C[2]]])}}mapBAOAtoDATA(f,z){const w=z.IDATA.edgematch[f][2];for(let S=0;S<z.isoVecsBAOA.length;S++){const C=[];for(let E=0;E<3;E++)1===z.vertexTypes[S][E]?C.push(f+"|"+z.isoVecsBAOA[S][E].x+"|"+z.isoVecsBAOA[S][E].y):C.push(w+"|"+z.isoVecsBAOA[S][E].x+"|"+z.isoVecsBAOA[S][E].y);this.face.push([z.vecToidx[C[0]],z.vecToidx[C[1]],z.vecToidx[C[2]]])}}orderData(f){const z=[];for(let E=0;E<13;E++)z[E]=[];const w=f.closestTo;for(let E=0;E<w.length;E++)w[E][0]>-1?w[E][1]>0&&z[w[E][0]].push([E,w[E][1]]):z[12].push([E,w[E][0]]);const S=[];for(let E=0;E<12;E++)S[E]=E;let C=12;for(let E=0;E<12;E++){z[E].sort(((f,z)=>f[1]-z[1]));for(let f=0;f<z[E].length;f++)S[z[E][f][0]]=C++}for(let E=0;E<z[12].length;E++)S[z[12][E][0]]=C++;for(let E=0;E<this.vertex.length;E++)this.vertex[E].push(S[E]);this.vertex.sort(((f,z)=>f[3]-z[3]));for(let E=0;E<this.vertex.length;E++)this.vertex[E].pop();for(let E=0;E<this.face.length;E++)for(let f=0;f<this.face[E].length;f++)this.face[E][f]=S[this.face[E][f]];this.sharedNodes=z[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(f,z){const w=[],S=[];let C=z.pop();S.push(C);let E=this.face[C].indexOf(f);E=(E+2)%3;let F=this.face[C][E];w.push(F);let J=0;for(;z.length>0;)C=z[J],this.face[C].indexOf(F)>-1?(E=(this.face[C].indexOf(F)+1)%3,F=this.face[C][E],w.push(F),S.push(C),z.splice(J,1),J=0):J++;return this.adjacentFaces.push(w),S}toGoldbergPolyhedronData(){const f=new uf("GeoDual","Goldberg",[],[]);f.name="GD dual";const z=this.vertex.length,w=new Array(z);for(let x=0;x<z;x++)w[x]=[];for(let x=0;x<this.face.length;x++)for(let f=0;f<3;f++)w[this.face[x][f]].push(x);let S=0,C=0,E=0,F=[],J=[];this.adjacentFaces=[];for(let x=0;x<w.length;x++)f.face[x]=this.setOrder(x,w[x].concat([])),w[x].forEach((z=>{S=0,C=0,E=0,F=this.face[z];for(let f=0;f<3;f++)J=this.vertex[F[f]],S+=J[0],C+=J[1],E+=J[2];f.vertex[z]=[S/3,C/3,E/3]}));return f}static BuildGeodesicData(f){const z=new hf("Geodesic-m-n","Geodesic",[[0,P.f,-1],[-P.f,1,0],[-1,0,-P.f],[1,0,-P.f],[P.f,1,0],[0,P.f,1],[-1,0,P.f],[-P.f,-1,0],[0,-P.f,-1],[P.f,-1,0],[1,0,P.f],[0,-P.f,1]],[]);f.setIndices(),f.calcCoeffs(),f.createInnerFacets(),f.edgeVecsABOB(),f.mapABOBtoOBOA(),f.mapABOBtoBAOA();for(let w=0;w<f.IDATA.face.length;w++)f.MapToFace(w,z),z.innerToData(w,f),"B"===f.IDATA.edgematch[w][1]&&z.mapABOBtoDATA(w,f),"O"===f.IDATA.edgematch[w][1]&&z.mapOBOAtoDATA(w,f),"A"===f.IDATA.edgematch[w][3]&&z.mapBAOAtoDATA(w,f);z.orderData(f);return z.vertex=z.vertex.map((function(f){const z=f[0],w=f[1],S=f[2],C=Math.sqrt(z*z+w*w+S*S);return f[0]*=1/C,f[1]*=1/C,f[2]*=1/C,f})),z}}C.b._GoldbergMeshParser=(f,z)=>Xf.Parse(f,z);class Xf extends C.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(f,z){return void 0===z?(f>this.goldbergData.nbUnsharedFaces-1&&(I.b.Warn("Maximum number of unshared faces used"),f=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+f):(f>11&&(I.b.Warn("Last pole used"),f=11),z>this.goldbergData.nbFacesAtPole-1&&(I.b.Warn("Maximum number of faces at a pole used"),z=this.goldbergData.nbFacesAtPole-1),12+f*this.goldbergData.nbFacesAtPole+z)}_changeGoldbergFaceColors(f){for(let w=0;w<f.length;w++){const z=f[w][0],S=f[w][1],C=f[w][2];for(let f=z;f<S+1;f++)this.goldbergData.faceColors[f]=C}const z=[];for(let w=0;w<12;w++)for(let f=0;f<5;f++)z.push(this.goldbergData.faceColors[w].r,this.goldbergData.faceColors[w].g,this.goldbergData.faceColors[w].b,this.goldbergData.faceColors[w].a);for(let w=12;w<this.goldbergData.faceColors.length;w++)for(let f=0;f<6;f++)z.push(this.goldbergData.faceColors[w].r,this.goldbergData.faceColors[w].g,this.goldbergData.faceColors[w].b,this.goldbergData.faceColors[w].a);return z}setGoldbergFaceColors(f){const z=this._changeGoldbergFaceColors(f);this.Ga(E.f.ColorKind,z)}updateGoldbergFaceColors(f){const z=this._changeGoldbergFaceColors(f);this.updateVerticesData(E.f.ColorKind,z)}_changeGoldbergFaceUVs(f){const z=this.getVerticesData(E.f.UVKind);for(let w=0;w<f.length;w++){const S=f[w][0],C=f[w][1],E=f[w][2],F=f[w][3],J=f[w][4],x=[],u=[];let h,X;for(let f=0;f<5;f++)h=E.x+F*Math.cos(J+f*Math.PI/2.5),X=E.y+F*Math.sin(J+f*Math.PI/2.5),h<0&&(h=0),h>1&&(h=1),x.push(h,X);for(let f=0;f<6;f++)h=E.x+F*Math.cos(J+f*Math.PI/3),X=E.y+F*Math.sin(J+f*Math.PI/3),h<0&&(h=0),h>1&&(h=1),u.push(h,X);for(let f=S;f<Math.min(12,C+1);f++)for(let w=0;w<5;w++)z[10*f+2*w]=x[2*w],z[10*f+2*w+1]=x[2*w+1];for(let f=Math.max(12,S);f<C+1;f++)for(let w=0;w<6;w++)z[12*f-24+2*w]=u[2*w],z[12*f-23+2*w]=u[2*w+1]}return z}setGoldbergFaceUVs(f){const z=this._changeGoldbergFaceUVs(f);this.Ga(E.f.UVKind,z)}updateGoldbergFaceUVs(f){const z=this._changeGoldbergFaceUVs(f);this.updateVerticesData(E.f.UVKind,z)}placeOnGoldbergFaceAt(f,z,w){const C=S.n.RotationFromAxis(this.goldbergData.faceXaxis[z],this.goldbergData.faceYaxis[z],this.goldbergData.faceZaxis[z]);f.rotation=C,f.position=this.goldbergData.faceCenters[z].add(this.goldbergData.faceXaxis[z].scale(w.x)).add(this.goldbergData.faceYaxis[z].scale(w.y)).add(this.goldbergData.faceZaxis[z].scale(w.z))}serialize(f){super.serialize(f),f.type="GoldbergMesh";const z={};if(z.adjacentFaces=this.goldbergData.adjacentFaces,z.nbSharedFaces=this.goldbergData.nbSharedFaces,z.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,z.nbFaces=this.goldbergData.nbFaces,z.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){z.faceColors=[];for(const f of this.goldbergData.faceColors)z.faceColors.push(f.kk())}if(this.goldbergData.faceCenters){z.faceCenters=[];for(const f of this.goldbergData.faceCenters)z.faceCenters.push(f.kk())}if(this.goldbergData.faceZaxis){z.faceZaxis=[];for(const f of this.goldbergData.faceZaxis)z.faceZaxis.push(f.kk())}if(this.goldbergData.faceYaxis){z.faceYaxis=[];for(const f of this.goldbergData.faceYaxis)z.faceYaxis.push(f.kk())}if(this.goldbergData.faceXaxis){z.faceXaxis=[];for(const f of this.goldbergData.faceXaxis)z.faceXaxis.push(f.kk())}f.goldbergData=z}static Parse(f,z){const w=f.goldbergData;w.faceColors=w.faceColors.map((f=>K.f.ck(f))),w.faceCenters=w.faceCenters.map((f=>S.n.ck(f))),w.faceZaxis=w.faceZaxis.map((f=>S.n.ck(f))),w.faceXaxis=w.faceXaxis.map((f=>S.n.ck(f))),w.faceYaxis=w.faceYaxis.map((f=>S.n.ck(f)));const C=new Xf(f.name,z);return C.goldbergData=w,C}}var Kf=w(862);class cf{constructor(f){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=f}moveTo(f,z){this._currentPath=new n.h(f,z),this._tempPaths.push(this._currentPath)}lineTo(f,z){this._currentPath.addLineTo(f,z)}quadraticCurveTo(f,z,w,S){this._currentPath.addQuadraticCurveTo(f,z,w,S,this._resolution)}bezierCurveTo(f,z,w,S,C,E){this._currentPath.addBezierCurveTo(f,z,w,S,C,E,this._resolution)}extractHoles(){for(const f of this._tempPaths)f.area()>0?this._holes.push(f):this._paths.push(f);if(!this._paths.length&&this._holes.length){const f=this._holes;this._holes=this._paths,this._paths=f}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function yf(f,z,w,S,C,E){const F=E.glyphs[f]||E.glyphs["?"];if(!F)return null;const J=new cf(C);if(F.o){const f=F.o.split(" ");for(let C=0,E=f.length;C<E;){switch(f[C++]){case"m":{const E=parseInt(f[C++])*z+w,F=parseInt(f[C++])*z+S;J.moveTo(E,F);break}case"l":{const E=parseInt(f[C++])*z+w,F=parseInt(f[C++])*z+S;J.lineTo(E,F);break}case"q":{const E=parseInt(f[C++])*z+w,F=parseInt(f[C++])*z+S,x=parseInt(f[C++])*z+w,u=parseInt(f[C++])*z+S;J.quadraticCurveTo(x,u,E,F);break}case"b":{const E=parseInt(f[C++])*z+w,F=parseInt(f[C++])*z+S,x=parseInt(f[C++])*z+w,u=parseInt(f[C++])*z+S,h=parseInt(f[C++])*z+w,X=parseInt(f[C++])*z+S;J.bezierCurveTo(x,u,h,X,E,F);break}}}}return J.extractHoles(),{offsetX:F.ha*z,shapePath:J}}const ef={CreateBox:X.c,CreateTiledBox:O,CreateSphere:d.d,CreateDisc:h.b,CreateIcoSphere:g,CreateRibbon:u,CreateCylinder:T,CreateTorus:D,CreateTorusKnot:M,CreateLineSystem:G.g,Fk:G.j,CreateDashedLines:G.c,ExtrudeShape:i,ExtrudeShapeCustom:m,CreateLathe:o,CreateTiledPlane:y,Gk:p.d,CreateGround:Y.f,CreateTiledGround:Y.j,CreateGroundFromHeightMap:Y.d,CreatePolygon:L,ExtrudePolygon:U,CreateTube:t,CreatePolyhedron:b,CreateGeodesic:function(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=z.m||1;S!==Math.floor(S)&&(S=Math.floor(S),I.b.Warn("m not an integer only floor(m) used"));let C=z.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),I.b.Warn("n not an integer only floor(n) used")),C>S){const f=C;C=S,S=f,I.b.Warn("n > m therefore m and n swapped")}const E=new xf;return E.build(S,C),b(f,{custom:hf.BuildGeodesicData(E),size:z.size,sizeX:z.sizeX,sizeY:z.sizeY,sizeZ:z.sizeZ,faceUV:z.faceUV,faceColors:z.faceColors,flat:z.flat,updatable:z.updatable,sideOrientation:z.sideOrientation,frontUVs:z.frontUVs,backUVs:z.backUVs},w)},CreateGoldberg:function(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=z.size,x=z.sizeX||E||1,u=z.sizeY||E||1,h=z.sizeZ||E||1;let X=z.m||1;X!==Math.floor(X)&&(X=Math.floor(X),I.b.Warn("m not an integer only floor(m) used"));let c=z.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),I.b.Warn("n not an integer only floor(n) used")),c>X){const f=c;c=X,X=f,I.b.Warn("n > m therefore m and n swapped")}const y=new xf;y.build(X,c);const e=hf.BuildGeodesicData(y),O=e.toGoldbergPolyhedronData(),d=new Xf(f,w);z.sideOrientation=C.b._GetDefaultSideOrientation(z.sideOrientation),d._originalBuilderSideOrientation=z.sideOrientation;(function(f,z){const w=f.size,C=f.sizeX||w||1,E=f.sizeY||w||1,x=f.sizeZ||w||1,u=0===f.sideOrientation?0:f.sideOrientation||F.d.DEFAULTSIDE,h=[],X=[],K=[],c=[];let y=1/0,e=-1/0,O=1/0,d=-1/0;for(let S=0;S<z.vertex.length;S++)y=Math.min(y,z.vertex[S][0]*C),e=Math.max(e,z.vertex[S][0]*C),O=Math.min(O,z.vertex[S][1]*E),d=Math.max(d,z.vertex[S][1]*E);let B=0;for(let F=0;F<z.face.length;F++){const f=z.face[F],w=S.n.ck(z.vertex[f[0]]),u=S.n.ck(z.vertex[f[2]]),V=S.n.ck(z.vertex[f[1]]),W=u.te(w),T=V.te(w),v=S.n.Cross(T,W).normalize();for(let S=0;S<f.length;S++){K.push(v.x,v.y,v.z);const w=z.vertex[f[S]];h.push(w[0]*C,w[1]*E,w[2]*x);const F=(w[1]*E-O)/(d-O);c.push((w[0]*C-y)/(e-y),J.c?1-F:F)}for(let z=0;z<f.length-2;z++)X.push(B,B+z+2,B+z+1);B+=f.length}F.d._ComputeSides(u,h,X,K,c);const V=new F.d;return V.xa=h,V.indices=X,V.ya=K,V.Aa=c,V})(z,O).Ca(d,z.updatable),d.goldbergData.nbSharedFaces=e.sharedNodes,d.goldbergData.nbUnsharedFaces=e.poleNodes,d.goldbergData.adjacentFaces=e.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let C=0;C<e.vertex.length;C++)d.goldbergData.faceCenters.push(S.n.ck(e.vertex[C])),d.goldbergData.faceCenters[C].x*=x,d.goldbergData.faceCenters[C].y*=u,d.goldbergData.faceCenters[C].z*=h,d.goldbergData.faceColors.push(new K.f(1,1,1,1));for(let C=0;C<O.face.length;C++){const f=O.face[C],z=S.n.ck(O.vertex[f[0]]),w=S.n.ck(O.vertex[f[2]]),E=S.n.ck(O.vertex[f[1]]),F=w.te(z),J=E.te(z),x=S.n.Cross(J,F).normalize(),u=S.n.Cross(J,x).normalize();d.goldbergData.faceXaxis.push(J.normalize()),d.goldbergData.faceYaxis.push(x),d.goldbergData.faceZaxis.push(u)}return d},CreateDecal:Cf,CreateCapsule:Ff,CreateText:function(f,z,w){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const x=function(f,z,w,S){const C=Array.from(f),E=z/S.resolution,F=(S.boundingBox.yMax-S.boundingBox.yMin+S.underlineThickness)*E,J=[];let x=0,u=0;for(let h=0;h<C.length;h++){const f=C[h];if("\n"===f)x=0,u-=F;else{const z=yf(f,E,x,u,w,S);z&&(x+=z.offsetX,J.push(z.shapePath))}}return J}(z,E.size||50,E.resolution||8,w),u=[];let h=0;for(const y of x){if(!y.paths.length)continue;const z=y.holes.slice();for(const w of y.paths){var X,K;const x=[],c=[],y=w.getPoints();for(const f of y)c.push(new S.n(f.x,0,f.y));const e=z.slice();for(const f of e){const C=f.getPoints();let E=!1;for(const f of C)if(w.isPointInside(f)){E=!0;break}if(!E)continue;const F=[];for(const f of C)F.push(new S.n(f.x,0,f.y));x.push(F),z.splice(z.indexOf(f),1)}if(!x.length&&z.length)for(const f of z){const z=f.getPoints(),w=[];for(const f of z)w.push(new S.n(f.x,0,f.y));x.push(w)}const O=U(f,{shape:c,holes:x.length?x:void 0,depth:E.depth||1,faceUV:E.faceUV||(null===(X=E.perLetterFaceUV)||void 0===X?void 0:X.call(E,h)),faceColors:E.faceColors||(null===(K=E.perLetterFaceColors)||void 0===K?void 0:K.call(E,h)),sideOrientation:C.b._GetDefaultSideOrientation(E.sideOrientation||C.b.DOUBLESIDE)},F,J);u.push(O),h++}}const c=C.b.MergeMeshes(u,!0,!0);if(c){const z=c.getBoundingInfo().boundingBox;c.position.x+=-(z.minimumWorld.x+z.maximumWorld.x)/2,c.position.y+=-(z.minimumWorld.y+z.maximumWorld.y)/2,c.position.z+=-(z.minimumWorld.z+z.maximumWorld.z)/2+z.extendSize.z,c.name=f;const w=new Kf.e("pivot",F);w.rotation.x=-Math.PI/2,c.parent=w,c.bakeCurrentTransformIntoVertices(),c.parent=null,w.dispose()}return c}}},12661:(f,z,w)=>{"use strict";w.d(z,{c:()=>F});var S=w(2321),C=w(2447);let E=0;const F=f=>{if(!f.environmentBRDFTexture){const z=f.useDelayedTextureLoading;f.useDelayedTextureLoading=!1;const w=f._blockEntityCollection;f._blockEntityCollection=!1;const F=S.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+E++,f,!0,!1,S.b.BILINEAR_SAMPLINGMODE);f._blockEntityCollection=w;const J=f.getEngine().getLoadedTexturesCache(),x=J.indexOf(F.getInternalTexture());-1!==x&&J.splice(x,1),F.isRGBD=!0,F.wrapU=S.b.CLAMP_ADDRESSMODE,F.wrapV=S.b.CLAMP_ADDRESSMODE,f.environmentBRDFTexture=F,f.useDelayedTextureLoading=z,C.c.ExpandRGBDTexture(F);const u=f.getEngine().onContextRestoredObservable.add((()=>{F.isRGBD=!0;const z=f.onBeforeRenderObservable.add((()=>{F.isReady()&&(f.onBeforeRenderObservable.remove(z),C.c.ExpandRGBDTexture(F))}))}));f.ik.add((()=>{f.getEngine().onContextRestoredObservable.remove(u)}))}return f.environmentBRDFTexture}},2477:(f,z,w)=>{"use strict";w.d(z,{c:()=>C});class S{constructor(f){this._pendingActions=new Array,this._workerInfos=f.map((f=>({workerPromise:Promise.resolve(f),idle:!0})))}dispose(){for(const f of this._workerInfos)f.workerPromise.then((f=>{f.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(f){this._executeOnIdleWorker(f)||this._pendingActions.push(f)}_executeOnIdleWorker(f){for(const z of this._workerInfos)if(z.idle)return this._execute(z,f),!0;return!1}_execute(f,z){f.idle=!1,f.workerPromise.then((w=>{z(w,(()=>{const z=this._pendingActions.shift();z?this._execute(f,z):f.idle=!0}))}))}}class C extends S{constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.DefaultOptions;super([]),this._maxWorkers=f,this._createWorkerAsync=z,this._options=w}push(f){if(!this._executeOnIdleWorker(f))if(this._workerInfos.length<this._maxWorkers){const z={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(z),this._execute(z,f)}else this._pendingActions.push(f)}_execute(f,z){f.timeoutId&&(clearTimeout(f.timeoutId),delete f.timeoutId),super._execute(f,((w,S)=>{z(w,(()=>{S(),f.idle&&(f.timeoutId=setTimeout((()=>{f.workerPromise.then((f=>{f.terminate()}));const z=this._workerInfos.indexOf(f);-1!==z&&this._workerInfos.splice(z,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}C.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12173:(f,z,w)=>{"use strict";w.d(z,{b:()=>df});var S=w(720),C=w(12064);class E extends C.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var F=w(762),J=(w(12177),w(665));class x{get noiseTexture(){return this._noiseTexture}set noiseTexture(f){this._noiseTexture!==f&&(this._noiseTexture=f,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(f){this._isAnimationSheetEnabled!=f&&(this._isAnimationSheetEnabled=f,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(f){this._useLogarithmicDepth=f&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.n.Zero()}set direction1(f){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=f)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.n.Zero()}set direction2(f){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=f)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.n.Zero()}set minEmitBox(f){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=f)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.n.Zero()}set maxEmitBox(f){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=f)}get billboardMode(){return this._billboardMode}set billboardMode(f){this._billboardMode!==f&&(this._billboardMode=f,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(f){this._isBillboardBased!==f&&(this._isBillboardBased=f,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f)}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(!f&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=f)}_reset(){}_removeGradientAndTexture(f,z,w){if(!z)return this;let S=0;for(const C of z){if(C.gradient===f){z.splice(S,1);break}S++}return w&&w.dispose(),this}constructor(f){this.animations=[],this.renderingGroupId=0,this.j=S.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.n(10,10,10),this.onAnimationEnd=null,this.blendMode=x.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.l(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.me=new S.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new F.f(1,1,1,1),this.color2=new F.f(1,1,1,1),this.colorDead=new F.f(0,0,0,1),this.textureMask=new F.f(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new E,this.id=f,this.name=f}createPointEmitter(f,z){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(f,z,w,S){throw new Error("Method not implemented.")}}x.BLENDMODE_ONEONE=0,x.BLENDMODE_STANDARD=1,x.BLENDMODE_ADD=2,x.BLENDMODE_MULTIPLY=3,x.BLENDMODE_MULTIPLYADD=4,(0,J.f)("BABYLON.BaseParticleSystem",x);var u=w(741),h=w(553);class X{constructor(){this.direction1=new S.n(0,1,0),this.direction2=new S.n(0,1,0),this.minEmitBox=new S.n(-.5,-.5,-.5),this.maxEmitBox=new S.n(.5,.5,.5)}startDirectionFunction(f,z,w,C){const E=(0,u.q)(this.direction1.x,this.direction2.x),F=(0,u.q)(this.direction1.y,this.direction2.y),J=(0,u.q)(this.direction1.z,this.direction2.z);if(C)return z.x=E,z.y=F,void(z.z=J);S.n.TransformNormalFromFloatsToRef(E,F,J,f,z)}startPositionFunction(f,z,w,C){const E=(0,u.q)(this.minEmitBox.x,this.maxEmitBox.x),F=(0,u.q)(this.minEmitBox.y,this.maxEmitBox.y),J=(0,u.q)(this.minEmitBox.z,this.maxEmitBox.z);if(C)return z.x=E,z.y=F,void(z.z=J);S.n.TransformCoordinatesFromFloatsToRef(E,F,J,f,z)}clone(){const f=new X;return h.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2),f.setVector3("minEmitBox",this.minEmitBox),f.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3),f.addUniform("minEmitBox",3),f.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.kk(),f.direction2=this.direction2.kk(),f.minEmitBox=this.minEmitBox.kk(),f.maxEmitBox=this.maxEmitBox.kk(),f}parse(f){S.n.FromArrayToRef(f.direction1,0,this.direction1),S.n.FromArrayToRef(f.direction2,0,this.direction2),S.n.FromArrayToRef(f.minEmitBox,0,this.minEmitBox),S.n.FromArrayToRef(f.maxEmitBox,0,this.maxEmitBox)}}class K{get radius(){return this._radius}set radius(f){this._radius=f,this._buildHeight()}get angle(){return this._angle}set angle(f){this._angle=f,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=w,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=z,this.radius=f}startDirectionFunction(f,z,w,C){C?S.j.ek[0].p(w.Dd).normalize():w.position.subtractToRef(f.getTranslation(),S.j.ek[0]).normalize();const E=(0,u.q)(0,this.directionRandomizer),F=(0,u.q)(0,this.directionRandomizer),J=(0,u.q)(0,this.directionRandomizer);z.x=S.j.ek[0].x+E,z.y=S.j.ek[0].y+F,z.z=S.j.ek[0].z+J,z.normalize()}startPositionFunction(f,z,w,C){const E=(0,u.q)(0,2*Math.PI);let F;this.emitFromSpawnPointOnly?F=1e-4:(F=(0,u.q)(0,this.heightRange),F=1-F*F);let J=this._radius-(0,u.q)(0,this._radius*this.radiusRange);J*=F;const x=J*Math.sin(E),h=J*Math.cos(E),X=F*this._height;if(C)return z.x=x,z.y=X,void(z.z=h);S.n.TransformCoordinatesFromFloatsToRef(x,X,h,f,z)}clone(){const f=new K(this._radius,this._angle,this.directionRandomizer);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat2("radius",this._radius,this.radiusRange),f.setFloat("coneAngle",this._angle),f.setFloat2("height",this._height,this.heightRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",2),f.addUniform("coneAngle",1),f.addUniform("height",2),f.addUniform("directionRandomizer",1)}getEffectDefines(){let f="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(f+="\n#define CONEEMITTERSPAWNPOINT"),f}getClassName(){return"ConeParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this._radius,f.angle=this._angle,f.directionRandomizer=this.directionRandomizer,f.radiusRange=this.radiusRange,f.heightRange=this.heightRange,f.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,f}parse(f){this.radius=f.radius,this.angle=f.angle,this.directionRandomizer=f.directionRandomizer,this.radiusRange=void 0!==f.radiusRange?f.radiusRange:1,this.heightRange=void 0!==f.radiusRange?f.heightRange:1,this.emitFromSpawnPointOnly=void 0!==f.emitFromSpawnPointOnly&&f.emitFromSpawnPointOnly}}class c extends K{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0);super(f,z),this.direction1=w,this.direction2=C}startDirectionFunction(f,z){const w=(0,u.q)(this.direction1.x,this.direction2.x),C=(0,u.q)(this.direction1.y,this.direction2.y),E=(0,u.q)(this.direction1.z,this.direction2.z);S.n.TransformNormalFromFloatsToRef(w,C,E,f,z)}clone(){const f=new c(this.radius,this.angle,this.direction1,this.direction2);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.kk(),f.direction2=this.direction2.kk(),f}parse(f){super.parse(f),this.direction1.p(f.direction1),this.direction2.p(f.direction2)}}class y{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=f,this.height=z,this.radiusRange=w,this.directionRandomizer=C,this._tempVector=S.n.Zero()}startDirectionFunction(f,z,w,C,E){w.position.subtractToRef(f.getTranslation(),this._tempVector),this._tempVector.normalize(),S.n.TransformNormalToRef(this._tempVector,E,this._tempVector);const F=(0,u.q)(-this.directionRandomizer/2,this.directionRandomizer/2);let J=Math.atan2(this._tempVector.x,this._tempVector.z);J+=(0,u.q)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=F,this._tempVector.x=Math.sin(J),this._tempVector.z=Math.cos(J),this._tempVector.normalize(),C?z.p(this._tempVector):S.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,f,z)}startPositionFunction(f,z,w,C){const E=(0,u.q)(-this.height/2,this.height/2),F=(0,u.q)(0,2*Math.PI),J=(0,u.q)((1-this.radiusRange)*(1-this.radiusRange),1),x=Math.sqrt(J)*this.radius,h=x*Math.cos(F),X=x*Math.sin(F);C?z.Gd(h,E,X):S.n.TransformCoordinatesFromFloatsToRef(h,E,X,f,z)}clone(){const f=new y(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.height=this.height,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.height=f.height,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class e extends y{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.n(0,1,0);super(f,z,w),this.direction1=C,this.direction2=E}startDirectionFunction(f,z,w,C){const E=(0,u.q)(this.direction1.x,this.direction2.x),F=(0,u.q)(this.direction1.y,this.direction2.y),J=(0,u.q)(this.direction1.z,this.direction2.z);C?z.Gd(E,F,J):S.n.TransformNormalFromFloatsToRef(E,F,J,f,z)}clone(){const f=new e(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.kk(),f.direction2=this.direction2.kk(),f}parse(f){super.parse(f),S.n.FromArrayToRef(f.direction1,0,this.direction1),S.n.FromArrayToRef(f.direction2,0,this.direction2)}}class O{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=f,this.radiusRange=z,this.directionRandomizer=w}startDirectionFunction(f,z,w,C){const E=w.position.te(f.getTranslation()).normalize(),F=(0,u.q)(0,this.directionRandomizer),J=(0,u.q)(0,this.directionRandomizer),x=(0,u.q)(0,this.directionRandomizer);E.x+=F,E.y+=J,E.z+=x,E.normalize(),C?z.p(E):S.n.TransformNormalFromFloatsToRef(E.x,E.y,E.z,f,z)}startPositionFunction(f,z,w,C){const E=this.radius-(0,u.q)(0,this.radius*this.radiusRange),F=(0,u.q)(0,1),J=(0,u.q)(0,2*Math.PI),x=Math.acos(2*F-1),h=E*Math.cos(J)*Math.sin(x),X=E*Math.cos(x),K=E*Math.sin(J)*Math.sin(x);C?z.Gd(h,Math.abs(X),K):S.n.TransformCoordinatesFromFloatsToRef(h,Math.abs(X),K,f,z)}clone(){const f=new O(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class d{constructor(){this.direction1=new S.n(0,1,0),this.direction2=new S.n(0,1,0)}startDirectionFunction(f,z,w,C){const E=(0,u.q)(this.direction1.x,this.direction2.x),F=(0,u.q)(this.direction1.y,this.direction2.y),J=(0,u.q)(this.direction1.z,this.direction2.z);C?z.Gd(E,F,J):S.n.TransformNormalFromFloatsToRef(E,F,J,f,z)}startPositionFunction(f,z,w,C){C?z.Gd(0,0,0):S.n.TransformCoordinatesFromFloatsToRef(0,0,0,f,z)}clone(){const f=new d;return h.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.kk(),f.direction2=this.direction2.kk(),f}parse(f){S.n.FromArrayToRef(f.direction1,0,this.direction1),S.n.FromArrayToRef(f.direction2,0,this.direction2)}}class B{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=f,this.radiusRange=z,this.directionRandomizer=w}startDirectionFunction(f,z,w,C){const E=w.position.te(f.getTranslation()).normalize(),F=(0,u.q)(0,this.directionRandomizer),J=(0,u.q)(0,this.directionRandomizer),x=(0,u.q)(0,this.directionRandomizer);E.x+=F,E.y+=J,E.z+=x,E.normalize(),C?z.p(E):S.n.TransformNormalFromFloatsToRef(E.x,E.y,E.z,f,z)}startPositionFunction(f,z,w,C){const E=this.radius-(0,u.q)(0,this.radius*this.radiusRange),F=(0,u.q)(0,1),J=(0,u.q)(0,2*Math.PI),x=Math.acos(2*F-1),h=E*Math.cos(J)*Math.sin(x),X=E*Math.cos(x),K=E*Math.sin(J)*Math.sin(x);C?z.Gd(h,X,K):S.n.TransformCoordinatesFromFloatsToRef(h,X,K,f,z)}clone(){const f=new B(this.radius,this.directionRandomizer);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.radius=this.radius,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.radius=f.radius,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class V extends B{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.n(0,1,0),w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0);super(f),this.direction1=z,this.direction2=w}startDirectionFunction(f,z){const w=(0,u.q)(this.direction1.x,this.direction2.x),C=(0,u.q)(this.direction1.y,this.direction2.y),E=(0,u.q)(this.direction1.z,this.direction2.z);S.n.TransformNormalFromFloatsToRef(w,C,E,f,z)}clone(){const f=new V(this.radius,this.direction1,this.direction2);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("radius",this.radius),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("radius",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.kk(),f.direction2=this.direction2.kk(),f}parse(f){super.parse(f),this.direction1.p(f.direction1),this.direction2.p(f.direction2)}}class W{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(f,z,w,C){const E=S.j.ek[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,w,E);const f=S.j.ek[1];E.subtractToRef(w.position,f),f.scaleToRef(1/w.lifeTime,E)}else E.set(0,0,0);C?z.p(E):S.n.TransformNormalToRef(E,f,z)}startPositionFunction(f,z,w,C){const E=S.j.ek[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,w,E):E.set(0,0,0),C?z.p(E):S.n.TransformCoordinatesToRef(E,f,z)}clone(){const f=new W;return h.b.DeepCopy(this,f),f}applyToShader(f){}buildUniformLayout(f){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.particlePositionGenerator=this.particlePositionGenerator,f.particleDestinationGenerator=this.particleDestinationGenerator,f}parse(f){f.particlePositionGenerator&&(this.particlePositionGenerator=f.particlePositionGenerator),f.particleDestinationGenerator&&(this.particleDestinationGenerator=f.particleDestinationGenerator)}}var T=w(789);class v{get mesh(){return this._mesh}set mesh(f){this._mesh!==f&&(this._mesh=f,f?(this._indices=f.dk(),this._positions=f.getVerticesData(T.f.PositionKind),this._normals=f.getVerticesData(T.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.n.Zero(),this._mesh=null,this.direction1=new S.n(0,1,0),this.direction2=new S.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=f}startDirectionFunction(f,z,w,C){if(this.useMeshNormalsForDirection&&this._normals)return void S.n.TransformNormalToRef(this._storedNormal,f,z);const E=(0,u.q)(this.direction1.x,this.direction2.x),F=(0,u.q)(this.direction1.y,this.direction2.y),J=(0,u.q)(this.direction1.z,this.direction2.z);C?z.Gd(E,F,J):S.n.TransformNormalFromFloatsToRef(E,F,J,f,z)}startPositionFunction(f,z,w,C){if(!this._indices||!this._positions)return;const E=3*Math.random()*(this._indices.length/3)|0,F=Math.random(),J=Math.random()*(1-F),x=1-F-J,u=this._indices[E],h=this._indices[E+1],X=this._indices[E+2],K=S.j.ek[0],c=S.j.ek[1],y=S.j.ek[2],e=S.j.ek[3];S.n.FromArrayToRef(this._positions,3*u,K),S.n.FromArrayToRef(this._positions,3*h,c),S.n.FromArrayToRef(this._positions,3*X,y),e.x=F*K.x+J*c.x+x*y.x,e.y=F*K.y+J*c.y+x*y.y,e.z=F*K.z+J*c.z+x*y.z,C?z.Gd(e.x,e.y,e.z):S.n.TransformCoordinatesFromFloatsToRef(e.x,e.y,e.z,f,z),this.useMeshNormalsForDirection&&this._normals&&(S.n.FromArrayToRef(this._normals,3*u,K),S.n.FromArrayToRef(this._normals,3*h,c),S.n.FromArrayToRef(this._normals,3*X,y),this._storedNormal.x=F*K.x+J*c.x+x*y.x,this._storedNormal.y=F*K.y+J*c.y+x*y.y,this._storedNormal.z=F*K.z+J*c.z+x*y.z)}clone(){const f=new v(this.mesh);return h.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var f;const z={};return z.type=this.getClassName(),z.direction1=this.direction1.kk(),z.direction2=this.direction2.kk(),z.meshId=null===(f=this.mesh)||void 0===f?void 0:f.id,z.useMeshNormalsForDirection=this.useMeshNormalsForDirection,z}parse(f,z){S.n.FromArrayToRef(f.direction1,0,this.direction1),S.n.FromArrayToRef(f.direction2,0,this.direction2),f.meshId&&z&&(this.mesh=z.getLastMeshById(f.meshId)),this.useMeshNormalsForDirection=f.useMeshNormalsForDirection}}var D=w(624);class A{_isUbo(f){return void 0!==f.addUniform}constructor(f){this._isUbo(f)?(this.setMatrix3x3=f.updateMatrix3x3.bind(f),this.setMatrix2x2=f.updateMatrix2x2.bind(f),this.setFloat=f.updateFloat.bind(f),this.setFloat2=f.updateFloat2.bind(f),this.setFloat3=f.updateFloat3.bind(f),this.setFloat4=f.updateFloat4.bind(f),this.setFloatArray=f.updateFloatArray.bind(f),this.setArray=f.updateArray.bind(f),this.setIntArray=f.updateIntArray.bind(f),this.setMatrix=f.rk.bind(f),this.setMatrices=f.updateMatrices.bind(f),this.setVector3=f.updateVector3.bind(f),this.setVector4=f.updateVector4.bind(f),this.setColor3=f.updateColor3.bind(f),this.setColor4=f.updateColor4.bind(f),this.setDirectColor4=f.updateDirectColor4.bind(f),this.setInt=f.updateInt.bind(f),this.setInt2=f.updateInt2.bind(f),this.setInt3=f.updateInt3.bind(f),this.setInt4=f.updateInt4.bind(f)):(this.setMatrix3x3=f.setMatrix3x3.bind(f),this.setMatrix2x2=f.setMatrix2x2.bind(f),this.setFloat=f.setFloat.bind(f),this.setFloat2=f.setFloat2.bind(f),this.setFloat3=f.setFloat3.bind(f),this.setFloat4=f.setFloat4.bind(f),this.setFloatArray=f.setFloatArray.bind(f),this.setArray=f.setArray.bind(f),this.setIntArray=f.setIntArray.bind(f),this.setMatrix=f.setMatrix.bind(f),this.setMatrices=f.setMatrices.bind(f),this.setVector3=f.setVector3.bind(f),this.setVector4=f.setVector4.bind(f),this.setColor3=f.setColor3.bind(f),this.setColor4=f.setColor4.bind(f),this.setDirectColor4=f.setDirectColor4.bind(f),this.setInt=f.setInt.bind(f),this.setInt2=f.setInt2.bind(f),this.setInt3=f.setInt3.bind(f),this.setInt4=f.setInt4.bind(f))}}var M=w(628);const G="gpuUpdateParticlesPixelShader",I="#version 300 es\nvoid main() {discard;}\n";M.d.ShadersStore[G]=I;const n="gpuUpdateParticlesVertexShader",P="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";M.d.ShadersStore[n]=P;(0,J.f)("BABYLON.WebGL2ParticleSystem",class{constructor(f,z){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=f,this._engine=z,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var f;return(null===(f=this._updateEffect)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof W&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=f,this._updateEffect=new D.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new A(this._updateEffect)}createVertexBuffers(f,z){this._updateVAO.push(this._createUpdateVAO(f)),this._renderVAO.push(this._engine.recordVertexArrayObject(z,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=z}createParticleBuffer(f){return f}bindDrawBuffers(f,z,w){w?this._engine.bindBuffers(this._renderVertexBuffers,w,z):this._engine.bindVertexArrayObject(this._renderVAO[f],null)}preUpdateParticleBuffer(){const f=this._engine;if(this._engine.enableEffect(this._updateEffect),!f.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(f,z,w){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[f],null);const S=this._engine;S.bindTransformFeedbackBuffer(z.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,w),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let f=0;f<this._updateVAO.length;f++)this._engine.releaseVertexArrayObject(this._updateVAO[f]);this._updateVAO.length=0;for(let f=0;f<this._renderVAO.length;f++)this._engine.releaseVertexArrayObject(this._renderVAO[f]);this._renderVAO.length=0}_createUpdateVAO(f){const z={};z.position=f.createVertexBuffer("position",0,3);let w=3;z.age=f.createVertexBuffer("age",w,1),w+=1,z.size=f.createVertexBuffer("size",w,3),w+=3,z.life=f.createVertexBuffer("life",w,1),w+=1,z.seed=f.createVertexBuffer("seed",w,4),w+=4,z.direction=f.createVertexBuffer("direction",w,3),w+=3,this._parent.particleEmitterType instanceof W&&(z.initialPosition=f.createVertexBuffer("initialPosition",w,3),w+=3),this._parent._colorGradientsTexture||(z.color=f.createVertexBuffer("color",w,4),w+=4),this._parent._isBillboardBased||(z.initialDirection=f.createVertexBuffer("initialDirection",w,3),w+=3),this._parent.noiseTexture&&(z.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",w,3),w+=3,z.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",w,3),w+=3),this._parent._angularSpeedGradientsTexture?(z.angle=f.createVertexBuffer("angle",w,1),w+=1):(z.angle=f.createVertexBuffer("angle",w,2),w+=2),this._parent._isAnimationSheetEnabled&&(z.cellIndex=f.createVertexBuffer("cellIndex",w,1),w+=1,this._parent.spriteRandomStartCell&&(z.cellStartOffset=f.createVertexBuffer("cellStartOffset",w,1),w+=1));const S=this._engine.recordVertexArrayObject(z,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class R{constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=f,this._label=S,this._engine._storageBuffers.push(this),this._create(z,w)}_create(f,z){this._bufferSize=f,this._creationFlags=z,this._buffer=this._engine.createStorageBuffer(f,z,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(f,z,w){this._buffer&&this._engine.updateStorageBuffer(this._buffer,f,z,w)}read(f,z,w,S){return this._engine.readFromStorageBuffer(this._buffer,f,z,w,S)}dispose(){const f=this._engine._storageBuffers,z=f.indexOf(this);-1!==z&&(f[z]=f[f.length-1],f.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var q=w(692),a=w(699),s=w(753),H=w(2321),L=w(2443),U=w(548),i=w(658),m=w(2437);class r{constructor(){this._gpuTimeInFrameId=-1,this.counter=new m.c}_addDuration(f,z){f<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==f?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(z,!1),this._gpuTimeInFrameId=f):this.counter.addCount(z,!1))}}class o{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=f,this._engine=z,this.uniqueId=L.e.UniqueId,z.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new r),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=z.createComputeContext(),this._shaderPath=w,this._options={bindingsMapping:{},defines:[],...S}):U.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):U.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[f];this._bindings[f]={type:w?0:4,object:z,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==z||S.type!==this._bindings[f].type)}setStorageTexture(f,z){const w=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!w||w.object!==z),this._bindings[f]={type:1,object:z,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries}}setExternalTexture(f,z){const w=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!w||w.object!==z),this._bindings[f]={type:6,object:z,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries}}setVideoTexture(f,z){return!!z.externalTexture&&(this.setExternalTexture(f,z.externalTexture),!0)}setUniformBuffer(f,z){const w=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!w||w.object!==z),this._bindings[f]={type:o._BufferIsDataBuffer(z)?7:2,object:z,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries}}setStorageBuffer(f,z){const w=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!w||w.object!==z),this._bindings[f]={type:o._BufferIsDataBuffer(z)?7:3,object:z,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries}}setTextureSampler(f,z){const w=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!w||!z.compareSampler(w.object)),this._bindings[f]={type:5,object:z,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries}}isReady(){let f=this._effect;for(const C in this._bindings){const f=this._bindings[C],z=f.type,w=f.object;switch(z){case 0:case 4:case 1:if(!w.isReady())return!1;break;case 6:if(!w.isReady())return!1;break}}const z=[],w=this._shaderPath;if(this._options.defines)for(let C=0;C<this._options.defines.length;C++)z.push(this._options.defines[C]);const S=z.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,f=this._engine.createComputeEffect(w,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=f),!!f.isReady()}dispatch(f,z,w){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,f,z,w,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const w=o._BufferIsDataBuffer(f)?f:f.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,w,z,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const z in this._bindings){const w=this._bindings[z];if(!this._options.bindingsMapping[z])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+z+"'");switch(w.type){case 0:{const S=this._samplers[z],C=w.object;var f;if(!S||!C._texture||!S.compareSampler(C._texture))this._samplers[z]=(new i.b).setParameters(C.wrapU,C.wrapV,C.wrapR,C.anisotropicFilteringLevel,C._texture.samplingMode,null===(f=C._texture)||void 0===f?void 0:f._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const f=w.object;f.getBuffer()!==w.buffer&&(w.buffer=f.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((C=>{const E=()=>{this.dispatch(f,z,w)?C():setTimeout(E,S)};E()}))}serialize(){const f=s.b.Serialize(this);f.options=this._options,f.shaderPath=this._shaderPath,f.Ol={},f.textures={};for(const z in this._bindings){const w=this._bindings[z],S=w.object;switch(w.type){case 0:case 4:case 1:{const C=S.serialize();C&&(f.textures[z]=C,f.Ol[z]={type:w.type});break}}}return f}static Parse(f,z,w){const S=s.b.Parse((()=>new o(f.name,z.getEngine(),f.shaderPath,f.options)),f,z,w);for(const C in f.textures){const E=f.Ol[C],F=H.b.Parse(f.textures[C],z,w);0===E.type?S.setTexture(C,F):4===E.type?S.setTexture(C,F,!1):S.setStorageTexture(C,F)}return S}static _BufferIsDataBuffer(f){return void 0!==f.underlyingResource}}(0,q.b)([(0,a.O)()],o.prototype,"name",void 0),(0,q.b)([(0,a.O)()],o.prototype,"fastMode",void 0),(0,J.f)("BABYLON.ComputeShader",o);var p=w(874);const Y="gpuUpdateParticlesComputeShader",t="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";M.d.ShadersStoreWGSL[Y]=t;(0,J.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(f,z){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=f,this._engine=z}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var f;return(null===(f=this._updateComputeShader)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){var z;const w={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(w.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(w.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(w.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(w.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(w.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(w.noiseTexture={group:1,binding:11}),this._updateComputeShader=new o("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:w,defines:f.split("\n")}),null===(z=this._simParamsComputeShader)||void 0===z||z.dispose(),this._simParamsComputeShader=new p.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new A(this._simParamsComputeShader)}createVertexBuffers(f,z){this._renderVertexBuffers.push(z)}createParticleBuffer(f){const z=new R(this._engine,4*f.length,11,"ComputeShaderParticleSystemBuffer");return z.update(f),this._bufferComputeShader.push(z),z.getBuffer()}bindDrawBuffers(f,z,w){this._engine.bindBuffers(this._renderVertexBuffers[f],w,z)}preUpdateParticleBuffer(){}updateParticleBuffer(f,z,w){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[f]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^f]),this._updateComputeShader.dispatch(Math.ceil(w/64))}releaseBuffers(){var f;for(let z=0;z<this._bufferComputeShader.length;++z)this._bufferComputeShader[z].dispose();this._bufferComputeShader.length=0,null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Z{constructor(f,z,w){this.gradient=f,this.color1=z,this.color2=w}getColorToRef(f){this.color2?F.f.LerpToRef(this.color1,this.color2,Math.random(),f):f.p(this.color1)}}class b{constructor(f,z){this.gradient=f,this.color=z}}class Q{constructor(f,z,w){this.gradient=f,this.factor1=z,this.factor2=w}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class g{static GetCurrentGradient(f,z,w){if(z[0].gradient>f)return void w(z[0],z[0],1);for(let C=0;C<z.length-1;C++){const S=z[C],E=z[C+1];if(f>=S.gradient&&f<=E.gradient){return void w(S,E,(f-S.gradient)/(E.gradient-S.gradient))}}const S=z.length-1;w(z[S],z[S],1)}}var k=w(527),j=w(12209),l=w(580);class N{constructor(f){this.particleSystem=f,this.position=S.n.Zero(),this.direction=S.n.Zero(),this.color=new F.f(0,0,0,0),this.colorStep=new F.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.l(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new F.f(0,0,0,0),this._currentColor2=new F.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=N._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let f=this.age,z=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===z?(z=1,f=this._randomCellOffset):f+=this._randomCellOffset);const w=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let S;S=this._initialSpriteCellLoop?(0,u.c)(f*z%this.lifeTime/this.lifeTime):(0,u.c)(f*z/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+S*w|0}_inheritParticleInfoToSubEmitter(f){if(f.particleSystem.j.position){const z=f.particleSystem.j;if(z.position.p(this.position),f.inheritDirection){const f=S.j.ek[0];this.direction.normalizeToRef(f),z.setDirection(f,0,Math.PI/2)}}else{f.particleSystem.j.p(this.position)}this.direction.scaleToRef(f.inheritedVelocityAmount/2,S.j.ek[0]),f.particleSystem._inheritedVelocityOffset.p(S.j.ek[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((f=>{this._inheritParticleInfoToSubEmitter(f)}))}_reset(){this.age=0,this.id=N._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(f){f.position.p(this.position),this._initialDirection?f._initialDirection?f._initialDirection.p(this._initialDirection):f._initialDirection=this._initialDirection.clone():f._initialDirection=null,f.direction.p(this.direction),this.Dd&&(f.Dd?f.Dd.p(this.Dd):f.Dd=this.Dd.clone()),f.color.p(this.color),f.colorStep.p(this.colorStep),f.lifeTime=this.lifeTime,f.age=this.age,f._randomCellOffset=this._randomCellOffset,f.size=this.size,f.scale.p(this.scale),f.angle=this.angle,f.angularSpeed=this.angularSpeed,f.particleSystem=this.particleSystem,f.cellIndex=this.cellIndex,f.id=this.id,f._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(f._currentColorGradient=this._currentColorGradient,f._currentColor1.p(this._currentColor1),f._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(f._currentSizeGradient=this._currentSizeGradient,f._currentSize1=this._currentSize1,f._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(f._currentAngularSpeedGradient=this._currentAngularSpeedGradient,f._currentAngularSpeed1=this._currentAngularSpeed1,f._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(f._currentVelocityGradient=this._currentVelocityGradient,f._currentVelocity1=this._currentVelocity1,f._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(f._currentLimitVelocityGradient=this._currentLimitVelocityGradient,f._currentLimitVelocity1=this._currentLimitVelocity1,f._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(f._currentDragGradient=this._currentDragGradient,f._currentDrag1=this._currentDrag1,f._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(f._initialStartSpriteCellID=this._initialStartSpriteCellID,f._initialEndSpriteCellID=this._initialEndSpriteCellID,f._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(f.remapData&&this.remapData?f.remapData.p(this.remapData):f.remapData=new S.p(0,0,0,0)),this._randomNoiseCoordinates1&&(f._randomNoiseCoordinates1?(f._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),f._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(f._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),f._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}N._Count=0;var ff=w(831),zf=(w(12218),w(901)),wf=w(885),Sf=w(2403);class Cf extends x{set onDispose(f){this._onDisposeObserver&&this.ik.remove(this._onDisposeObserver),this._onDisposeObserver=this.ik.add(f)}get useRampGradients(){return this._useRampGradients}set useRampGradients(f){this._useRampGradients!==f&&(this._useRampGradients=f,this._resetEffect())}get particles(){return this.Jl}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Jl.length}getClassName(){return"Kk"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var f;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[z])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[z]=new ff.b(this._engine),this._customWrappers[z].effect=f,this._customWrappers[z].drawContext&&(this._customWrappers[z].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(f),this._emitterInverseWorldMatrix=S.b.Identity(),this._inheritedVelocityOffset=new S.n,this.ik=new k.c,this.onStoppedObservable=new k.c,this.Jl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new F.f(0,0,0,0),this._colorDiff=new F.f(0,0,0,0),this._scaledDirection=S.n.Zero(),this._scaledGravity=S.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=f=>{},this.recycleParticle=f=>{const z=this.Jl.pop();z!==f&&z.copyTo(f),this._stockParticles.push(z)},this._createParticle=()=>{let f;return 0!==this._stockParticles.length?(f=this._stockParticles.pop(),f._reset()):f=new N(this),this._prepareParticle(f),f},this._shadersLoaded=!1,this._capacity=z,this._epsilon=J,this._isAnimationSheetEnabled=E,w&&"Scene"!==w.getClassName()?(this._engine=w,this.defaultProjectionMatrix=S.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=w||l.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zk.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ff.b(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new X;let x=null;this.updateFunction=f=>{let z=null;var w;this.noiseTexture&&(z=this.noiseTexture.getSize(),null===(w=this.noiseTexture.getContent())||void 0===w||w.then((f=>{x=f})));const C=f===this.Jl;for(let E=0;E<f.length;E++){const w=f[E];let J=this._scaledUpdateSpeed;const h=w.age;if(w.age+=J,w.age>w.lifeTime){const f=w.age-h;J=(w.lifeTime-h)*J/f,w.age=w.lifeTime}const X=w.age/w.lifeTime;this._colorGradients&&this._colorGradients.length>0?g.GetCurrentGradient(X,this._colorGradients,((f,z,S)=>{f!==w._currentColorGradient&&(w._currentColor1.p(w._currentColor2),z.getColorToRef(w._currentColor2),w._currentColorGradient=f),F.f.LerpToRef(w._currentColor1,w._currentColor2,S,w.color)})):(w.colorStep.scaleToRef(J,this._scaledColorStep),w.color.addInPlace(this._scaledColorStep),w.color.a<0&&(w.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&g.GetCurrentGradient(X,this._angularSpeedGradients,((f,z,S)=>{f!==w._currentAngularSpeedGradient&&(w._currentAngularSpeed1=w._currentAngularSpeed2,w._currentAngularSpeed2=z.getFactor(),w._currentAngularSpeedGradient=f),w.angularSpeed=(0,u.m)(w._currentAngularSpeed1,w._currentAngularSpeed2,S)})),w.angle+=w.angularSpeed*J;let K=J;if(this._velocityGradients&&this._velocityGradients.length>0&&g.GetCurrentGradient(X,this._velocityGradients,((f,z,S)=>{f!==w._currentVelocityGradient&&(w._currentVelocity1=w._currentVelocity2,w._currentVelocity2=z.getFactor(),w._currentVelocityGradient=f),K*=(0,u.m)(w._currentVelocity1,w._currentVelocity2,S)})),w.direction.scaleToRef(K,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&g.GetCurrentGradient(X,this._limitVelocityGradients,((f,z,S)=>{f!==w._currentLimitVelocityGradient&&(w._currentLimitVelocity1=w._currentLimitVelocity2,w._currentLimitVelocity2=z.getFactor(),w._currentLimitVelocityGradient=f);const C=(0,u.m)(w._currentLimitVelocity1,w._currentLimitVelocity2,S);w.direction.length()>C&&w.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&g.GetCurrentGradient(X,this._dragGradients,((f,z,S)=>{f!==w._currentDragGradient&&(w._currentDrag1=w._currentDrag2,w._currentDrag2=z.getFactor(),w._currentDragGradient=f);const C=(0,u.m)(w._currentDrag1,w._currentDrag2,S);this._scaledDirection.scaleInPlace(1-C)})),this.isLocal&&w.Dd?(w.Dd.addInPlace(this._scaledDirection),S.n.TransformCoordinatesToRef(w.Dd,this._emitterWorldMatrix,w.position)):w.position.addInPlace(this._scaledDirection),x&&z&&w._randomNoiseCoordinates1){const f=this._fetchR(w._randomNoiseCoordinates1.x,w._randomNoiseCoordinates1.y,z.width,z.height,x),C=this._fetchR(w._randomNoiseCoordinates1.z,w._randomNoiseCoordinates2.x,z.width,z.height,x),E=this._fetchR(w._randomNoiseCoordinates2.y,w._randomNoiseCoordinates2.z,z.width,z.height,x),F=S.j.ek[0],u=S.j.ek[1];F.Gd((2*f-1)*this.noiseStrength.x,(2*C-1)*this.noiseStrength.y,(2*E-1)*this.noiseStrength.z),F.scaleToRef(J,u),w.direction.addInPlace(u)}this.gravity.scaleToRef(J,this._scaledGravity),w.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&g.GetCurrentGradient(X,this._sizeGradients,((f,z,S)=>{f!==w._currentSizeGradient&&(w._currentSize1=w._currentSize2,w._currentSize2=z.getFactor(),w._currentSizeGradient=f),w.size=(0,u.m)(w._currentSize1,w._currentSize2,S)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&g.GetCurrentGradient(X,this._colorRemapGradients,((f,z,S)=>{const C=(0,u.m)(f.factor1,z.factor1,S),E=(0,u.m)(f.factor2,z.factor2,S);w.remapData.x=C,w.remapData.y=E-C})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&g.GetCurrentGradient(X,this._alphaRemapGradients,((f,z,S)=>{const C=(0,u.m)(f.factor1,z.factor1,S),E=(0,u.m)(f.factor2,z.factor2,S);w.remapData.z=C,w.remapData.w=E-C}))),this._isAnimationSheetEnabled&&w.updateCellIndex(),w._inheritParticleInfoToSubEmitters(),w.age>=w.lifeTime&&(this._emitFromParticle(w),w._attachedSubEmitters&&(w._attachedSubEmitters.forEach((f=>{f.particleSystem.disposeOnStop=!0,f.particleSystem.stop()})),w._attachedSubEmitters=null),this.recycleParticle(w),C&&E--)}}}serialize(f){throw new Error("Method not implemented.")}clone(f,z){throw new Error("Method not implemented.")}_addFactorGradient(f,z,w,S){const C=new Q(z,w,S);f.push(C),f.sort(((f,z)=>f.gradient<z.gradient?-1:f.gradient>z.gradient?1:0))}_removeFactorGradient(f,z){if(!f)return;let w=0;for(const S of f){if(S.gradient===z){f.splice(w,1);break}w++}}addLifeTimeGradient(f,z,w){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,f,z,w),this}removeLifeTimeGradient(f){return this._removeFactorGradient(this._lifeTimeGradients,f),this}addSizeGradient(f,z,w){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,f,z,w),this}removeSizeGradient(f){return this._removeFactorGradient(this._sizeGradients,f),this}addColorRemapGradient(f,z,w){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,f,z,w),this}removeColorRemapGradient(f){return this._removeFactorGradient(this._colorRemapGradients,f),this}addAlphaRemapGradient(f,z,w){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,f,z,w),this}removeAlphaRemapGradient(f){return this._removeFactorGradient(this._alphaRemapGradients,f),this}addAngularSpeedGradient(f,z,w){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,f,z,w),this}removeAngularSpeedGradient(f){return this._removeFactorGradient(this._angularSpeedGradients,f),this}addVelocityGradient(f,z,w){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,f,z,w),this}removeVelocityGradient(f){return this._removeFactorGradient(this._velocityGradients,f),this}addLimitVelocityGradient(f,z,w){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,f,z,w),this}removeLimitVelocityGradient(f){return this._removeFactorGradient(this._limitVelocityGradients,f),this}addDragGradient(f,z,w){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,f,z,w),this}removeDragGradient(f){return this._removeFactorGradient(this._dragGradients,f),this}addEmitRateGradient(f,z,w){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,f,z,w),this}removeEmitRateGradient(f){return this._removeFactorGradient(this._emitRateGradients,f),this}addStartSizeGradient(f,z,w){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,f,z,w),this}removeStartSizeGradient(f){return this._removeFactorGradient(this._startSizeGradients,f),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const f=new Uint8Array(4*this._rawTextureWidth),z=F.i.uk[0];for(let w=0;w<this._rawTextureWidth;w++){const S=w/this._rawTextureWidth;g.GetCurrentGradient(S,this._rampGradients,((S,C,E)=>{F.d.LerpToRef(S.color,C.color,E,z),f[4*w]=255*z.r,f[4*w+1]=255*z.g,f[4*w+2]=255*z.b,f[4*w+3]=255}))}this._rampGradientsTexture=j.b.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((f,z)=>f.gradient<z.gradient?-1:f.gradient>z.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(f,z){this._rampGradients||(this._rampGradients=[]);const w=new b(f,z);return this._rampGradients.push(w),this._syncRampGradientTexture(),this}removeRampGradient(f){return this._removeGradientAndTexture(f,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(f,z,w){this._colorGradients||(this._colorGradients=[]);const S=new Z(f,z,w);return this._colorGradients.push(S),this._colorGradients.sort(((f,z)=>f.gradient<z.gradient?-1:f.gradient>z.gradient?1:0)),this}removeColorGradient(f){if(!this._colorGradients)return this;let z=0;for(const w of this._colorGradients){if(w.gradient===f){this._colorGradients.splice(z,1);break}z++}return this}resetDrawCache(){for(const f of this._drawWrappers)if(f)for(const z of f)null===z||void 0===z||z.dispose();this._drawWrappers=[]}_fetchR(f,z,w,S,C){return C[4*(((f=.5*Math.abs(f)+.5)*w%w|0)+((z=.5*Math.abs(z)+.5)*S%S|0)*w)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const f=this._engine,z=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*z),this._vertexBuffer=new T.b(f,this._vertexData,!0,z);let w=0;const S=this._vertexBuffer.createVertexBuffer(T.f.PositionKind,w,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.f.PositionKind]=S,w+=3;const C=this._vertexBuffer.createVertexBuffer(T.f.ColorKind,w,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[T.f.ColorKind]=C,w+=4;const E=this._vertexBuffer.createVertexBuffer("angle",w,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=E,w+=1;const F=this._vertexBuffer.createVertexBuffer("size",w,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=F,w+=2,this._isAnimationSheetEnabled){const f=this._vertexBuffer.createVertexBuffer("cellIndex",w,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=f,w+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const f=this._vertexBuffer.createVertexBuffer("direction",w,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=f,w+=3}if(this._useRampGradients){const f=this._vertexBuffer.createVertexBuffer("remapData",w,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=f,w+=4}let J;if(this._useInstancing){const z=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new T.b(f,z,!1,2),J=this._spriteBuffer.createVertexBuffer("offset",0,2)}else J=this._vertexBuffer.createVertexBuffer("offset",w,2,this._vertexBufferSize,this._useInstancing),w+=2;this._vertexBuffers.offset=J,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const f=[],z=[];let w=0;for(let S=0;S<this._capacity;S++)f.push(w),f.push(w+1),f.push(w+2),f.push(w),f.push(w+2),f.push(w+3),z.push(w,w+1,w+1,w+2,w+2,w+3,w+3,w,w,w+3),w+=4;this._indexBuffer=this._engine.createIndexBuffer(f),this._linesIndexBuffer=this._engine.createIndexBuffer(z)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(f)setTimeout((()=>{this.start(0)}),f);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var z;-1!==(null===(z=this.j)||void 0===z?void 0:z.getClassName().indexOf("Mesh"))&&this.j.bk(!0);const f=this.noiseTexture;if(f&&f.onGeneratedObservable)f.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let z=0;z<this.preWarmCycles;z++)this.animate(!0),f.render()}))}));else for(let z=0;z<this.preWarmCycles;z++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(f))}_postStop(f){}reset(){this._stockParticles.length=0,this.Jl.length=0}_appendParticleVertex(f,z,w,C){let E=f*this._vertexBufferSize;if(this._vertexData[E++]=z.position.x+this.me.x,this._vertexData[E++]=z.position.y+this.me.y,this._vertexData[E++]=z.position.z+this.me.z,this._vertexData[E++]=z.color.r,this._vertexData[E++]=z.color.g,this._vertexData[E++]=z.color.b,this._vertexData[E++]=z.color.a,this._vertexData[E++]=z.angle,this._vertexData[E++]=z.scale.x*z.size,this._vertexData[E++]=z.scale.y*z.size,this._isAnimationSheetEnabled&&(this._vertexData[E++]=z.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[E++]=z.direction.x,this._vertexData[E++]=z.direction.y,this._vertexData[E++]=z.direction.z);else if(z._initialDirection){let f=z._initialDirection;this.isLocal&&(S.n.TransformNormalToRef(f,this._emitterWorldMatrix,S.j.ek[0]),f=S.j.ek[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[E++]=f.x,this._vertexData[E++]=f.y,this._vertexData[E++]=f.z}else{let f=z.direction;this.isLocal&&(S.n.TransformNormalToRef(f,this._emitterWorldMatrix,S.j.ek[0]),f=S.j.ek[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[E++]=f.x,this._vertexData[E++]=f.y,this._vertexData[E++]=f.z}this._useRampGradients&&z.remapData&&(this._vertexData[E++]=z.remapData.x,this._vertexData[E++]=z.remapData.y,this._vertexData[E++]=z.remapData.z,this._vertexData[E++]=z.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===w?w=this._epsilon:1===w&&(w=1-this._epsilon),0===C?C=this._epsilon:1===C&&(C=1-this._epsilon)),this._vertexData[E++]=w,this._vertexData[E++]=C)}_prepareParticle(f){}_update(f){if(this._alive=this.Jl.length>0,this.j.position){const f=this.j;this._emitterWorldMatrix=f.getWorldMatrix()}else{const f=this.j;this._emitterWorldMatrix=S.b.Translation(f.x,f.y,f.z)}let z;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Jl);for(let w=0;w<f&&this.Jl.length!==this._capacity;w++){if(z=this._createParticle(),this.Jl.push(z),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const f=(0,u.c)(this._actualFrame/this.targetStopDuration);g.GetCurrentGradient(f,this._lifeTimeGradients,((w,S)=>{const C=w,E=S,F=C.getFactor(),J=E.getFactor(),x=(f-C.gradient)/(E.gradient-C.gradient);z.lifeTime=(0,u.m)(F,J,x)}))}else z.lifeTime=(0,u.q)(this.minLifeTime,this.maxLifeTime);const f=(0,u.q)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,z.position,z,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,z.position,z,this.isLocal),this.isLocal&&(z.Dd?z.Dd.p(z.position):z.Dd=z.position.clone(),S.n.TransformCoordinatesToRef(z.Dd,this._emitterWorldMatrix,z.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,z.direction,z,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,z.direction,z,this.isLocal,this._emitterInverseWorldMatrix),0===f?z._initialDirection?z._initialDirection.p(z.direction):z._initialDirection=z.direction.clone():z._initialDirection=null,z.direction.scaleInPlace(f),this._sizeGradients&&0!==this._sizeGradients.length?(z._currentSizeGradient=this._sizeGradients[0],z._currentSize1=z._currentSizeGradient.getFactor(),z.size=z._currentSize1,this._sizeGradients.length>1?z._currentSize2=this._sizeGradients[1].getFactor():z._currentSize2=z._currentSize1):z.size=(0,u.q)(this.minSize,this.maxSize),z.scale.Gd((0,u.q)(this.minScaleX,this.maxScaleX),(0,u.q)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const f=this._actualFrame/this.targetStopDuration;g.GetCurrentGradient(f,this._startSizeGradients,((f,w,S)=>{f!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=w.getFactor(),this._currentStartSizeGradient=f);const C=(0,u.m)(this._currentStartSize1,this._currentStartSize2,S);z.scale.scaleInPlace(C)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(z._currentAngularSpeedGradient=this._angularSpeedGradients[0],z.angularSpeed=z._currentAngularSpeedGradient.getFactor(),z._currentAngularSpeed1=z.angularSpeed,this._angularSpeedGradients.length>1?z._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():z._currentAngularSpeed2=z._currentAngularSpeed1):z.angularSpeed=(0,u.q)(this.minAngularSpeed,this.maxAngularSpeed),z.angle=(0,u.q)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(z._currentVelocityGradient=this._velocityGradients[0],z._currentVelocity1=z._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?z._currentVelocity2=this._velocityGradients[1].getFactor():z._currentVelocity2=z._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(z._currentLimitVelocityGradient=this._limitVelocityGradients[0],z._currentLimitVelocity1=z._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?z._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():z._currentLimitVelocity2=z._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(z._currentDragGradient=this._dragGradients[0],z._currentDrag1=z._currentDragGradient.getFactor(),this._dragGradients.length>1?z._currentDrag2=this._dragGradients[1].getFactor():z._currentDrag2=z._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)z._currentColorGradient=this._colorGradients[0],z._currentColorGradient.getColorToRef(z.color),z._currentColor1.p(z.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(z._currentColor2):z._currentColor2.p(z.color);else{const f=(0,u.q)(0,1);F.f.LerpToRef(this.color1,this.color2,f,z.color),this.colorDead.subtractToRef(z.color,this._colorDiff),this._colorDiff.scaleToRef(1/z.lifeTime,z.colorStep)}this._isAnimationSheetEnabled&&(z._initialStartSpriteCellID=this.startSpriteCellID,z._initialEndSpriteCellID=this.endSpriteCellID,z._initialSpriteCellLoop=this.spriteCellLoop),z.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(z.remapData=new S.p(0,1,0,1)),this.noiseTexture&&(z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.Gd(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2.Gd(Math.random(),Math.random(),Math.random())):(z._randomNoiseCoordinates1=new S.n(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2=new S.n(Math.random(),Math.random(),Math.random()))),z._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[T.f.PositionKind,T.f.ColorKind,"angle","offset","size"];return f&&S.push("cellIndex"),z||S.push("direction"),w&&S.push("remapData"),S}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,zf.c)(S),f&&S.push("particlesInfos"),z&&S.push("logarithmicDepthConstant"),w&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,zf.j)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&f.push("#define FOG")),this._isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),z===x.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&f.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case 2:f.push("#define BILLBOARDY");break;case 8:case 9:f.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&f.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:f.push("#define BILLBOARDMODE_ALL")}w&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,z,w){z.push(...Cf._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),f.push(...Cf._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),w.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Sf.e)(f,this._imageProcessingConfigurationDefines),(0,Sf.d)(w,this._imageProcessingConfigurationDefines))}_getWrapper(f){const z=this._getCustomDrawWrapper(f);if(null!==z&&void 0!==z&&z.effect)return z;const w=[];this.fillDefines(w,f);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let C=this._drawWrappers[S];C||(C=this._drawWrappers[S]=[]);let E=C[f];E||(E=new ff.b(this._engine),E.drawContext&&(E.drawContext.useInstancing=this._useInstancing),C[f]=E);const F=w.join("\n");if(E.defines!==F){const f=[],z=[],w=[];this.fillUniformsAttributesAndSamplerNames(z,f,w),E.setEffect(this._engine.createEffect("particles",f,z,w,F,void 0,void 0,void 0,void 0,this._shaderLanguage),F)}return E}animate(){var f;let z,w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!w&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(w?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this.manualEmitCount>-1)z=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let f=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const z=this._actualFrame/this.targetStopDuration;g.GetCurrentGradient(z,this._emitRateGradients,((z,w,S)=>{z!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=w.getFactor(),this._currentEmitRateGradient=z),f=(0,u.m)(this._currentEmitRate1,this._currentEmitRate2,S)}))}z=f*this._scaledUpdateSpeed|0,this._newPartsExcess+=f*this._scaledUpdateSpeed-z}if(this._newPartsExcess>1&&(z+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?z=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(z),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!w){let f=0;for(let z=0;z<this.Jl.length;z++){const w=this.Jl[z];this._appendParticleVertices(f,w),f+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Jl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(f,z){this._appendParticleVertex(f++,z,0,0),this._useInstancing||(this._appendParticleVertex(f++,z,1,0),this._appendParticleVertex(f++,z,1,1),this._appendParticleVertex(f++,z,0,1))}rebuild(){var f;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(f=this._spriteBuffer)||void 0===f||f._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Cf.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(w.bind(w,12416)),Promise.resolve().then(w.bind(w,12347))])):await Promise.all([Promise.resolve().then(w.bind(w,12339)),Promise.resolve().then(w.bind(w,12328))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==x.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(x.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(x.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(f){const z=this._getWrapper(f),w=z.effect,C=this._engine;C.enableEffect(z);const E=this.defaultViewMatrix??this._scene.getViewMatrix();if(w.setTexture("diffuseSampler",this.particleTexture),w.setMatrix("view",E),w.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();w.setFloat3("particlesInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,this.spriteCellWidth/f.width)}if(w.setVector2("translationPivot",this.translationPivot),w.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;w.setVector3("eyePosition",f.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),w.setTexture("rampSampler",this._rampGradientsTexture));const F=w.defines;var J,u,h,X,K,c;(this._scene&&((0,zf.g)(w,this,this._scene),this.applyFog&&(0,wf.d)(this._scene,void 0,w)),F.indexOf("#define BILLBOARDMODE_ALL")>=0&&(E.invertToRef(S.j.Matrix[0]),w.setMatrix("invView",S.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?C.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,w):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,w)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?C.bindBuffers(this._vertexBuffers,null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._linesIndexBuffer:this._indexBuffer,w):C.bindBuffers(this._vertexBuffers,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null,w);switch(this.useLogarithmicDepth&&this._scene&&(0,wf.h)(F,w,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),f){case x.BLENDMODE_ADD:C.setAlphaMode(1);break;case x.BLENDMODE_ONEONE:C.setAlphaMode(6);break;case x.BLENDMODE_STANDARD:C.setAlphaMode(2);break;case x.BLENDMODE_MULTIPLY:C.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(w),this._useInstancing)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?C.drawElementsType(6,0,10,this.Jl.length):C.drawArraysType(7,0,4,this.Jl.length):null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?C.drawElementsType(1,0,10*this.Jl.length):C.drawElementsType(0,0,6*this.Jl.length);return this.Jl.length}render(){if(!this.isReady()||!this.Jl.length)return 0;const f=this._engine;f.setState&&(f.setState(!1),this.forceDepthWrite&&f.setDepthWrite(!0));let z=0;return z=this.blendMode===x.BLENDMODE_MULTIPLYADD?this._render(x.BLENDMODE_MULTIPLY)+this._render(x.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),z}_onDispose(){}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(z,w),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const f=this._scene.zk.indexOf(this);f>-1&&this._scene.zk.splice(f,1),this._scene._activeParticleSystems.dispose()}this.ik.notifyObservers(this),this.ik.clear(),this.onStoppedObservable.clear(),this.reset()}}Cf.ForceGLSL=!1;var Ef,Ff=w(568);!function(f){f[f.ATTACHED=0]="ATTACHED",f[f.END=1]="END"}(Ef||(Ef={}));class Jf{constructor(f){if(this.particleSystem=f,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!f.j||!f.j.dispose){const z=(0,J.b)("BABYLON.AbstractMesh");f.j=new z("SubemitterSystemEmitter",f.va()),f._disposeEmitterOnDispose=!0}}clone(){let f=this.particleSystem.j;if(f){if(f instanceof S.n)f=f.clone();else if(-1!==f.getClassName().indexOf("Mesh")){f=new((0,J.b)("BABYLON.Mesh"))("",f.va()),f.isVisible=!1}}else f=new S.n;const z=new Jf(this.particleSystem.clone(this.particleSystem.name,f));return z.particleSystem.name+="Clone",z.type=this.type,z.inheritDirection=this.inheritDirection,z.inheritedVelocityAmount=this.inheritedVelocityAmount,z.particleSystem._disposeEmitterOnDispose=!0,z.particleSystem.disposeOnStop=!0,z}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};return z.type=this.type,z.inheritDirection=this.inheritDirection,z.inheritedVelocityAmount=this.inheritedVelocityAmount,z.particleSystem=this.particleSystem.serialize(f),z}static _ParseParticleSystem(f,z,w){throw(0,Ff.d)("ParseParticle")}static Parse(f,z,w){const S=f.particleSystem,C=new Jf(Jf._ParseParticleSystem(S,z,w,!0));return C.type=f.type,C.inheritDirection=f.inheritDirection,C.inheritedVelocityAmount=f.inheritedVelocityAmount,C.particleSystem._isSubEmitter=!0,C}dispose(){this.particleSystem.dispose()}}var xf=w(616);function uf(f,z){const w=new d;return w.direction1=f,w.direction2=z,w}function hf(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Xf(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Kf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.n(0,1,0),w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0);return new V(f,z,w)}function cf(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function yf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.n(0,1,0);return new e(f,z,w,C,E)}function ef(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new K(f,z)}function Of(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0);return new c(f,z,w,C)}class df extends Cf{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=f=>{if(!this._subEmitters||0===this._subEmitters.length)return;const z=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[z].forEach((z=>{if(1===z.type){const w=z.clone();f._inheritParticleInfoToSubEmitter(w),w.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(w.particleSystem),w.particleSystem.start()}}))}}createPointEmitter(f,z){const w=uf(f,z);return this.particleEmitterType=w,w}createHemisphericEmitter(){const f=hf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=Xf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=Kf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=cf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.n(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=ef(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=Of(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,z,w,S){const C=new X;return this.particleEmitterType=C,this.direction1=f,this.direction2=z,this.minEmitBox=w,this.maxEmitBox=S,C}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((f=>{f instanceof df?this._subEmitters.push([new Jf(f)]):f instanceof Jf?this._subEmitters.push([f]):f instanceof Array&&this._subEmitters.push(f)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((f=>{f.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const f=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==f&&this._rootParticleSystem.activeSubSystems.splice(f,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(f){f&&this._stopSubEmitters()}_prepareParticle(f){if(this._subEmitters&&this._subEmitters.length>0){const z=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];f._attachedSubEmitters=[],z.forEach((z=>{if(0===z.type){const w=z.clone();f._attachedSubEmitters.push(w),w.particleSystem.start()}}))}}_onDispose(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var w;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),f)&&(null===(w=this.particles)||void 0===w||w.forEach((f=>{if(f._attachedSubEmitters)for(let z=f._attachedSubEmitters.length-1;z>=0;z-=1)f._attachedSubEmitters[z].dispose()})));if(z&&this.activeSubSystems)for(let S=this.activeSubSystems.length-1;S>=0;S-=1)this.activeSubSystems[S].dispose();if(this._subEmitters&&this._subEmitters.length){for(let f=0;f<this._subEmitters.length;f++)for(const z of this._subEmitters[f])z.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(f,z,w,C){let E;E=w instanceof xf.e?null:w;const x=(0,J.b)("BABYLON.Texture");if(x&&E&&(f.texture?z.particleTexture=x.Parse(f.texture,E,C):f.textureName&&(z.particleTexture=new x(C+f.textureName,E,!1,void 0===f.invertY||f.invertY),z.particleTexture.name=f.textureName)),f.emitterId||0===f.emitterId||void 0!==f.j?f.emitterId&&E?z.j=E.getLastMeshById(f.emitterId):z.j=S.n.ck(f.j):z.j=S.n.Zero(),z.isLocal=!!f.isLocal,void 0!==f.renderingGroupId&&(z.renderingGroupId=f.renderingGroupId),void 0!==f.isBillboardBased&&(z.isBillboardBased=f.isBillboardBased),void 0!==f.billboardMode&&(z.billboardMode=f.billboardMode),void 0!==f.useLogarithmicDepth&&(z.useLogarithmicDepth=f.useLogarithmicDepth),f.animations){for(let w=0;w<f.animations.length;w++){const S=f.animations[w],C=(0,J.b)("BABYLON.Animation");C&&z.animations.push(C.Parse(S))}z.beginAnimationOnStart=f.beginAnimationOnStart,z.beginAnimationFrom=f.beginAnimationFrom,z.beginAnimationTo=f.beginAnimationTo,z.beginAnimationLoop=f.beginAnimationLoop}if(f.autoAnimate&&E&&E.beginAnimation(z,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),z.startDelay=0|f.startDelay,z.minAngularSpeed=f.minAngularSpeed,z.maxAngularSpeed=f.maxAngularSpeed,z.minSize=f.minSize,z.maxSize=f.maxSize,f.minScaleX&&(z.minScaleX=f.minScaleX,z.maxScaleX=f.maxScaleX,z.minScaleY=f.minScaleY,z.maxScaleY=f.maxScaleY),void 0!==f.preWarmCycles&&(z.preWarmCycles=f.preWarmCycles,z.preWarmStepOffset=f.preWarmStepOffset),void 0!==f.minInitialRotation&&(z.minInitialRotation=f.minInitialRotation,z.maxInitialRotation=f.maxInitialRotation),z.minLifeTime=f.minLifeTime,z.maxLifeTime=f.maxLifeTime,z.minEmitPower=f.minEmitPower,z.maxEmitPower=f.maxEmitPower,z.emitRate=f.emitRate,z.gravity=S.n.ck(f.gravity),f.noiseStrength&&(z.noiseStrength=S.n.ck(f.noiseStrength)),z.color1=F.f.ck(f.color1),z.color2=F.f.ck(f.color2),z.colorDead=F.f.ck(f.colorDead),z.updateSpeed=f.updateSpeed,z.targetStopDuration=f.targetStopDuration,z.blendMode=f.blendMode,f.colorGradients)for(const S of f.colorGradients)z.addColorGradient(S.gradient,F.f.ck(S.color1),S.color2?F.f.ck(S.color2):void 0);if(f.rampGradients){for(const w of f.rampGradients)z.addRampGradient(w.gradient,F.d.ck(w.color));z.useRampGradients=f.useRampGradients}if(f.colorRemapGradients)for(const S of f.colorRemapGradients)z.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.alphaRemapGradients)for(const S of f.alphaRemapGradients)z.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.sizeGradients)for(const S of f.sizeGradients)z.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.angularSpeedGradients)for(const S of f.angularSpeedGradients)z.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.velocityGradients)for(const S of f.velocityGradients)z.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.dragGradients)for(const S of f.dragGradients)z.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.emitRateGradients)for(const S of f.emitRateGradients)z.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.startSizeGradients)for(const S of f.startSizeGradients)z.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.lifeTimeGradients)for(const S of f.lifeTimeGradients)z.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(f.limitVelocityGradients){for(const w of f.limitVelocityGradients)z.addLimitVelocityGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);z.limitVelocityDamping=f.limitVelocityDamping}if(f.noiseTexture&&E){const w=(0,J.b)("BABYLON.ProceduralTexture");z.noiseTexture=w.Parse(f.noiseTexture,E,C)}let u;if(f.particleEmitterType){switch(f.particleEmitterType.type){case"SphereParticleEmitter":u=new B;break;case"SphereDirectedParticleEmitter":u=new V;break;case"ConeEmitter":case"ConeParticleEmitter":u=new K;break;case"ConeDirectedParticleEmitter":u=new c;break;case"CylinderParticleEmitter":u=new y;break;case"CylinderDirectedParticleEmitter":u=new e;break;case"HemisphericParticleEmitter":u=new O;break;case"PointParticleEmitter":u=new d;break;case"MeshParticleEmitter":u=new v;break;case"CustomParticleEmitter":u=new W;break;default:u=new X}u.parse(f.particleEmitterType,E)}else u=new X,u.parse(f,E);z.particleEmitterType=u,z.startSpriteCellID=f.startSpriteCellID,z.endSpriteCellID=f.endSpriteCellID,z.spriteCellLoop=f.spriteCellLoop??!0,z.spriteCellWidth=f.spriteCellWidth,z.spriteCellHeight=f.spriteCellHeight,z.spriteCellChangeSpeed=f.spriteCellChangeSpeed,z.spriteRandomStartCell=f.spriteRandomStartCell,z.disposeOnStop=f.disposeOnStop??!1,z.manualEmitCount=f.manualEmitCount??-1}static Parse(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const J=f.name;let x,u,h=null,X=null;if(z instanceof xf.e?x=z:(u=z,x=u.getEngine()),f.customShader&&x.createEffectForParticles){X=f.customShader;const z=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";h=x.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,z)}const K=new df(J,E||f._a,z,h,f.isAnimationSheetEnabled);if(K.customShader=X,K._rootUrl=w,f.id&&(K.id=f.id),f.subEmitters){K.subEmitters=[];for(const S of f.subEmitters){const f=[];for(const C of S)f.push(Jf.Parse(C,z,w));K.subEmitters.push(f)}}return df._Parse(f,K,z,w),f.textureMask&&(K.textureMask=F.f.ck(f.textureMask)),f.me&&(K.me=S.n.ck(f.me)),f.preventAutoStart&&(K.preventAutoStart=f.preventAutoStart),C||K.preventAutoStart||K.start(),K}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};if(df._Serialize(z,this,f),z.textureMask=this.textureMask.kk(),z.customShader=this.customShader,z.preventAutoStart=this.preventAutoStart,z.me=this.me.kk(),this.subEmitters){z.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const w of this._subEmitters){const S=[];for(const z of w)S.push(z.serialize(f));z.subEmitters.push(S)}}return z}static _Serialize(f,z,w){if(f.name=z.name,f.id=z.id,f._a=z.getCapacity(),f.disposeOnStop=z.disposeOnStop,f.manualEmitCount=z.manualEmitCount,z.j.position){const w=z.j;f.emitterId=w.id}else{const w=z.j;f.j=w.kk()}z.particleEmitterType&&(f.particleEmitterType=z.particleEmitterType.serialize()),z.particleTexture&&(w?f.texture=z.particleTexture.serialize():(f.textureName=z.particleTexture.name,f.invertY=!!z.particleTexture._invertY)),f.isLocal=z.isLocal,s.b.AppendSerializedAnimations(z,f),f.beginAnimationOnStart=z.beginAnimationOnStart,f.beginAnimationFrom=z.beginAnimationFrom,f.beginAnimationTo=z.beginAnimationTo,f.beginAnimationLoop=z.beginAnimationLoop,f.startDelay=z.startDelay,f.renderingGroupId=z.renderingGroupId,f.isBillboardBased=z.isBillboardBased,f.billboardMode=z.billboardMode,f.minAngularSpeed=z.minAngularSpeed,f.maxAngularSpeed=z.maxAngularSpeed,f.minSize=z.minSize,f.maxSize=z.maxSize,f.minScaleX=z.minScaleX,f.maxScaleX=z.maxScaleX,f.minScaleY=z.minScaleY,f.maxScaleY=z.maxScaleY,f.minEmitPower=z.minEmitPower,f.maxEmitPower=z.maxEmitPower,f.minLifeTime=z.minLifeTime,f.maxLifeTime=z.maxLifeTime,f.emitRate=z.emitRate,f.gravity=z.gravity.kk(),f.noiseStrength=z.noiseStrength.kk(),f.color1=z.color1.kk(),f.color2=z.color2.kk(),f.colorDead=z.colorDead.kk(),f.updateSpeed=z.updateSpeed,f.targetStopDuration=z.targetStopDuration,f.blendMode=z.blendMode,f.preWarmCycles=z.preWarmCycles,f.preWarmStepOffset=z.preWarmStepOffset,f.minInitialRotation=z.minInitialRotation,f.maxInitialRotation=z.maxInitialRotation,f.startSpriteCellID=z.startSpriteCellID,f.spriteCellLoop=z.spriteCellLoop,f.endSpriteCellID=z.endSpriteCellID,f.spriteCellChangeSpeed=z.spriteCellChangeSpeed,f.spriteCellWidth=z.spriteCellWidth,f.spriteCellHeight=z.spriteCellHeight,f.spriteRandomStartCell=z.spriteRandomStartCell,f.isAnimationSheetEnabled=z.isAnimationSheetEnabled,f.useLogarithmicDepth=z.useLogarithmicDepth;const S=z.getColorGradients();if(S){f.colorGradients=[];for(const z of S){const w={gradient:z.gradient,color1:z.color1.kk()};z.color2?w.color2=z.color2.kk():w.color2=z.color1.kk(),f.colorGradients.push(w)}}const C=z.getRampGradients();if(C){f.rampGradients=[];for(const z of C){const w={gradient:z.gradient,color:z.color.kk()};f.rampGradients.push(w)}f.useRampGradients=z.useRampGradients}const E=z.getColorRemapGradients();if(E){f.colorRemapGradients=[];for(const z of E){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.colorRemapGradients.push(w)}}const F=z.getAlphaRemapGradients();if(F){f.alphaRemapGradients=[];for(const z of F){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.alphaRemapGradients.push(w)}}const J=z.getSizeGradients();if(J){f.sizeGradients=[];for(const z of J){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.sizeGradients.push(w)}}const x=z.getAngularSpeedGradients();if(x){f.angularSpeedGradients=[];for(const z of x){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.angularSpeedGradients.push(w)}}const u=z.getVelocityGradients();if(u){f.velocityGradients=[];for(const z of u){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.velocityGradients.push(w)}}const h=z.getDragGradients();if(h){f.dragGradients=[];for(const z of h){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.dragGradients.push(w)}}const X=z.getEmitRateGradients();if(X){f.emitRateGradients=[];for(const z of X){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.emitRateGradients.push(w)}}const K=z.getStartSizeGradients();if(K){f.startSizeGradients=[];for(const z of K){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.startSizeGradients.push(w)}}const c=z.getLifeTimeGradients();if(c){f.lifeTimeGradients=[];for(const z of c){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.lifeTimeGradients.push(w)}}const y=z.getLimitVelocityGradients();if(y){f.limitVelocityGradients=[];for(const z of y){const w={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?w.factor2=z.factor2:w.factor2=z.factor1,f.limitVelocityGradients.push(w)}f.limitVelocityDamping=z.limitVelocityDamping}z.noiseTexture&&(f.noiseTexture=z.noiseTexture.serialize())}clone(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let C=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){C=this.customShader;const f=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"",z=E.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,f);S[0]?S[0].effect=z:this.setCustomEffect(z,0)}const F=this.serialize(w),J=df.Parse(F,this._scene||this._engine,this._rootUrl);return J.name=f,J.customShader=C,J._customWrappers=S,void 0===z&&(z=this.j),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.j=z,this.preventAutoStart||J.start(),J}}df.BILLBOARDMODE_Y=2,df.BILLBOARDMODE_ALL=7,df.BILLBOARDMODE_STRETCHED=8,df.BILLBOARDMODE_STRETCHED_LOCAL=9,Jf._ParseParticleSystem=df.Parse;var Bf=w(2390),Vf=w(2386),Wf=w(12223);Wf.c.prototype.createTransformFeedback=function(){const f=this._gl.createTransformFeedback();if(!f)throw new Error("Unable to create Transform Feedback");return f},Wf.c.prototype.deleteTransformFeedback=function(f){this._gl.deleteTransformFeedback(f)},Wf.c.prototype.bindTransformFeedback=function(f){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,f)},Wf.c.prototype.beginTransformFeedback=function(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(f?this._gl.POINTS:this._gl.TRIANGLES)},Wf.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Wf.c.prototype.setTranformFeedbackVaryings=function(f,z){this._gl.transformFeedbackVaryings(f,z,this._gl.INTERLEAVED_ATTRIBS)},Wf.c.prototype.bindTransformFeedbackBuffer=function(f){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f?f.underlyingResource:null)},Wf.c.prototype.readTransformFeedbackBuffer=function(f){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f)};const Tf="clipPlaneFragmentDeclaration2",vf="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[Tf]=vf;w(12241),w(12246),w(12253),w(12259),w(12266),w(12270),w(12273),w(12279);const Df="gpuRenderParticlesPixelShader",Af="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";M.d.ShadersStore[Df]=Af;const Mf="clipPlaneVertexDeclaration2",Gf="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[Mf]=Gf;w(12283),w(12287),w(12294),w(12296);const If="gpuRenderParticlesVertexShader",nf="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";M.d.ShadersStore[If]=nf;class Pf extends x{static get IsSupported(){if(!l.c.LastCreatedEngine)return!1;const f=l.c.LastCreatedEngine.getCaps();return f.supportTransformFeedbacks||f.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(f){this._maxActiveParticleCount=Math.min(f,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(f){this.maxActiveParticleCount=f}createPointEmitter(f,z){const w=uf(f,z);return this.particleEmitterType=w,w}createHemisphericEmitter(){const f=hf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=Xf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=Kf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=cf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.n(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=ef(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=Of(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.n(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,z,w,S){const C=new X;return this.particleEmitterType=C,this.direction1=f,this.direction2=z,this.minEmitBox=w,this.maxEmitBox=S,C}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==df.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(df.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(df.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";f?setTimeout((()=>{this.start(0)}),f):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var f;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[z])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[z]=new ff.b(this._engine),this._customWrappers[z].effect=f}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(f,z,w){return super._removeGradientAndTexture(f,z,w),this._releaseBuffers(),this}addColorGradient(f,z){this._colorGradients||(this._colorGradients=[]);const w=new Z(f,z);return this._colorGradients.push(w),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(f&&this._colorGradients.sort(((f,z)=>f.gradient<z.gradient?-1:f.gradient>z.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(f){return this._removeGradientAndTexture(f,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const z in this._drawWrappers){var f;null===(f=this._drawWrappers[z].drawContext)||void 0===f||f.reset()}}_addFactorGradient(f,z,w){const S=new Q(z,w);f.push(S),this._releaseBuffers()}addSizeGradient(f,z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,f,z),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(f){return this._removeGradientAndTexture(f,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(f,z){if(!f)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&f.sort(((f,z)=>f.gradient<z.gradient?-1:f.gradient>z.gradient?1:0));const w=this;w[z]&&(w[z].dispose(),w[z]=null)}addAngularSpeedGradient(f,z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,f,z),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(f){return this._removeGradientAndTexture(f,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(f,z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,f,z),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(f){return this._removeGradientAndTexture(f,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(f,z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,f,z),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(f){return this._removeGradientAndTexture(f,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(f,z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,f,z),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(f){return this._removeGradientAndTexture(f,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(f){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(f),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ik=new k.c,this.onStoppedObservable=new k.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,w&&"Scene"!==w.getClassName()?(this._engine=w,this.defaultProjectionMatrix=S.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=w||l.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.zk.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,J.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,J.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ff.b(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers={0:new ff.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(z=z??{}).randomTextureSize||delete z.randomTextureSize;const F={_a:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...z},x=z;isFinite(x)&&(F._a=x),this._capacity=F._a,this._maxActiveParticleCount=F._a,this._currentActiveCount=0,this._isAnimationSheetEnabled=E,this.particleEmitterType=new X;const u=Math.min(this._engine.getCaps().maxTextureSize,F.randomTextureSize);let h=[];for(let S=0;S<u;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture=new j.b(new Float32Array(h),u,1,5,w,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,h=[];for(let S=0;S<u;++S)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());this._randomTexture2=new j.b(new Float32Array(h),u,1,5,w,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=u}_reset(){this._releaseBuffers()}_createVertexBuffers(f,z,w){const S={};S.position=z.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let C=3;S.age=z.createVertexBuffer("age",C,1,this._attributesStrideSize,!0),C+=1,S.size=z.createVertexBuffer("size",C,3,this._attributesStrideSize,!0),C+=3,S.life=z.createVertexBuffer("life",C,1,this._attributesStrideSize,!0),C+=1,C+=4,this.billboardMode===df.BILLBOARDMODE_STRETCHED&&(S.direction=z.createVertexBuffer("direction",C,3,this._attributesStrideSize,!0)),C+=3,this._platform.alignDataInBuffer&&(C+=1),this.particleEmitterType instanceof W&&(C+=3,this._platform.alignDataInBuffer&&(C+=1)),this._colorGradientsTexture||(S.color=z.createVertexBuffer("color",C,4,this._attributesStrideSize,!0),C+=4),this._isBillboardBased||(S.initialDirection=z.createVertexBuffer("initialDirection",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),this.noiseTexture&&(S.noiseCoordinates1=z.createVertexBuffer("noiseCoordinates1",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1),S.noiseCoordinates2=z.createVertexBuffer("noiseCoordinates2",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),S.angle=z.createVertexBuffer("angle",C,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?C++:C+=2,this._isAnimationSheetEnabled&&(S.cellIndex=z.createVertexBuffer("cellIndex",C,1,this._attributesStrideSize,!0),C+=1,this.spriteRandomStartCell&&(S.cellStartOffset=z.createVertexBuffer("cellStartOffset",C,1,this._attributesStrideSize,!0),C+=1)),S.offset=w.createVertexBuffer("offset",0,2),S.uv=w.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(f,S),this.resetDrawCache()}_initialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!f)return;const z=this._engine,w=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof W&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const C=this.particleEmitterType instanceof W,E=S.j.ek[0];let F=0;for(let S=0;S<this._capacity;S++)if(w.push(0),w.push(0),w.push(0),w.push(0),w.push(0),w.push(0),w.push(0),w.push(0),w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),C?(this.particleEmitterType.particleDestinationGenerator(S,null,E),w.push(E.x),w.push(E.y),w.push(E.z)):(w.push(0),w.push(0),w.push(0)),this._platform.alignDataInBuffer&&w.push(0),F+=16,C&&(this.particleEmitterType.particlePositionGenerator(S,null,E),w.push(E.x),w.push(E.y),w.push(E.z),this._platform.alignDataInBuffer&&w.push(0),F+=4),this._colorGradientsTexture||(w.push(0),w.push(0),w.push(0),w.push(0),F+=4),this.isBillboardBased||(w.push(0),w.push(0),w.push(0),this._platform.alignDataInBuffer&&w.push(0),F+=4),this.noiseTexture&&(w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),this._platform.alignDataInBuffer&&w.push(0),w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),this._platform.alignDataInBuffer&&w.push(0),F+=8),w.push(0),F+=1,this._angularSpeedGradientsTexture||(w.push(0),F+=1),this._isAnimationSheetEnabled&&(w.push(0),F+=1,this.spriteRandomStartCell&&(w.push(0),F+=1)),this._platform.alignDataInBuffer){let f=3-(F+3&3);for(F+=f;f-- >0;)w.push(0)}const J=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),x=this._platform.createParticleBuffer(w),u=this._platform.createParticleBuffer(w);this._buffer0=new T.b(z,x,!1,this._attributesStrideSize),this._buffer1=new T.b(z,u,!1,this._attributesStrideSize),this._spriteBuffer=new T.b(z,J,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let f=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(f+="\n#define BILLBOARD"),this._colorGradientsTexture&&(f+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(f+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(f+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(f+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(f+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(f+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(f+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(f+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(f+="\n#define NOISE"),this.isLocal&&(f+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===f||(this._cachedUpdateDefines=f,this._updateBuffer=this._platform.createUpdateBuffer(f)),this._platform.isUpdateBufferReady()}_getWrapper(f){const z=this._getCustomDrawWrapper(f);if(null!==z&&void 0!==z&&z.effect)return z;const w=[];this.fillDefines(w,f);let S=this._drawWrappers[f];S||(S=new ff.b(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[f]=S);const C=w.join("\n");if(S.defines!==C){const f=[],z=[],w=[];this.fillUniformsAttributesAndSamplerNames(z,f,w),S.setEffect(this._engine.createEffect("gpuRenderParticles",f,z,w,C),C)}return S}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=[T.f.PositionKind,"age","life","size","angle"];return f||C.push(T.f.ColorKind),z&&C.push("cellIndex"),w||C.push("initialDirection"),S&&C.push("direction"),C.push("offset",T.f.UVKind),C}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","me","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,zf.c)(S),f&&S.push("sheetInfos"),z&&S.push("logarithmicDepthConstant"),w&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,zf.j)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Vf.c.FOGMODE_NONE&&f.push("#define FOG")),z===df.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this.isLocal&&f.push("#define LOCAL"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case df.BILLBOARDMODE_Y:f.push("#define BILLBOARDY");break;case df.BILLBOARDMODE_STRETCHED:f.push("#define BILLBOARDSTRETCHED");break;case df.BILLBOARDMODE_ALL:f.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&f.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),w&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,z,w){z.push(...Pf._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===df.BILLBOARDMODE_STRETCHED)),f.push(...Pf._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),w.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Bf.c.PrepareUniforms(f,this._imageProcessingConfigurationDefines),Bf.c.PrepareSamplers(w,this._imageProcessingConfigurationDefines))}animate(){var f;let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(z?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(f,z){const w=this[z];if(!f||!f.length||w)return;const S=new Float32Array(this._rawTextureWidth);for(let C=0;C<this._rawTextureWidth;C++){const z=C/this._rawTextureWidth;g.GetCurrentGradient(z,f,((f,z,w)=>{S[C]=(0,u.m)(f.factor1,z.factor1,w)}))}this[z]=j.b.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[z].name=z.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const f=new Uint8Array(4*this._rawTextureWidth),z=F.i.vk[0];for(let w=0;w<this._rawTextureWidth;w++){const S=w/this._rawTextureWidth;g.GetCurrentGradient(S,this._colorGradients,((S,C,E)=>{F.f.LerpToRef(S.color1,C.color1,E,z),f[4*w]=255*z.r,f[4*w+1]=255*z.g,f[4*w+2]=255*z.b,f[4*w+3]=255*z.a}))}this._colorGradientsTexture=j.b.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(f,z){var w,C,E,F;const J=this._getWrapper(f),x=J.effect;this._engine.enableEffect(J);const u=(null===(w=this._scene)||void 0===w?void 0:w.getViewMatrix())||S.b.IdentityReadOnly;if(x.setMatrix("view",u),x.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),x.setTexture("diffuseSampler",this.particleTexture),x.setVector2("translationPivot",this.translationPivot),x.setVector3("me",this.me),this.isLocal&&x.setMatrix("emitterWM",z),this._colorGradientsTexture?x.setTexture("colorGradientSampler",this._colorGradientsTexture):x.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();x.setFloat3("sheetInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,f.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;x.setVector3("eyePosition",f.globalPosition)}const h=x.defines;if(this._scene&&((0,zf.g)(x,this,this._scene),this.applyFog&&(0,wf.d)(this._scene,void 0,x)),h.indexOf("#define BILLBOARDMODE_ALL")>=0){const f=u.clone();f.invert(),x.setMatrix("invView",f)}switch(this.useLogarithmicDepth&&this._scene&&(0,wf.h)(h,x,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(x),f){case df.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case df.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case df.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case df.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,x,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(x),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(F=this._scene)&&void 0!==F&&F.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(f){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!f)if(this.j.position){f=this.j.getWorldMatrix()}else{const z=this.j;f=S.j.Matrix[0],S.b.TranslationToRef(z.x,z.y,z.z,f)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",f),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=z}render(){let f,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const f=0|this._accumulatedCount;this._accumulatedCount-=f,this._currentActiveCount+=f}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){f=this.j.getWorldMatrix()}else{const z=this.j;f=S.j.Matrix[0],S.b.TranslationToRef(z.x,z.y,z.z,f)}const C=this._engine;this.updateInAnimate||this._update(f);let E=0;return z||w||(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0),E=this.blendMode===df.BLENDMODE_MULTIPLYADD?this._render(df.BLENDMODE_MULTIPLY,f)+this._render(df.BLENDMODE_ADD,f):this._render(this.blendMode,f),this._engine.setAlphaMode(0)),E}rebuild(){const f=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(f,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,f()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const z in this._drawWrappers){this._drawWrappers[z].dispose()}if(this._drawWrappers={},this._scene){const f=this._scene.zk.indexOf(this);f>-1&&this._scene.zk.splice(f,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let z=0;z<this._renderVertexBuffers.length;++z){const f=this._renderVertexBuffers[z];for(const z in f)f[z].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ik.notifyObservers(this),this.ik.clear()}clone(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S={...this._customWrappers};let C=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){C=this.customShader;const f=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"";S[0]=E.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,f,void 0,void 0,void 0,this)}const F=this.serialize(w),J=Pf.Parse(F,this._scene||this._engine,this._rootUrl);return J.name=f,J.customShader=C,J._customWrappers=S,void 0===z&&(z=this.j),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.j=z,J}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};return df._Serialize(z,this,f),z.activeParticleCount=this.activeParticleCount,z.randomTextureSize=this._randomTextureSize,z.customShader=this.customShader,z}static Parse(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const E=f.name;let F,J;z instanceof xf.e?F=z:(J=z,F=J.getEngine());const x=new Pf(E,{_a:C||f._a,randomTextureSize:f.randomTextureSize},z,null,f.isAnimationSheetEnabled);if(x._rootUrl=w,f.customShader&&F.createEffectForParticles){const z=f.customShader,w=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",S=F.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,w,void 0,void 0,void 0,x);x.setCustomEffect(S,0),x.customShader=z}return f.id&&(x.id=f.id),f.activeParticleCount&&(x.activeParticleCount=f.activeParticleCount),df._Parse(f,x,z,w),f.preventAutoStart&&(x.preventAutoStart=f.preventAutoStart),S||x.preventAutoStart||x.start(),x}}var Rf=w(535),qf=w(12304),af=w(12057);class sf{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(f){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const z of this.systems)z.j=f;this._emitterNode=f}setEmitterAsSphere(f,z,w){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:f,renderingGroupId:z};const S=(0,qf.d)("emitterSphere",{diameter:f.diameter,segments:f.segments},w);S.renderingGroupId=z;const C=new af.c("emitterSphereMaterial",w);C.emissiveColor=f.color,S.material=C;for(const E of this.systems)E.j=S;this._emitterNode=S}start(f){for(const z of this.systems)f&&(z.j=f),z.start()}dispose(){for(const f of this.systems)f.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={systems:[]};for(const w of this.systems)z.systems.push(w.serialize(f));return this._emitterNode&&(z.j=this._emitterCreationOptions),z}static Parse(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const C=new sf,E=this.BaseAssetsUrl+"/textures/";z=z||l.c.LastCreatedScene;for(const F of f.systems)C.systems.push(w?Pf.Parse(F,z,E,!0,S):df.Parse(F,z,E,!0,S));if(f.j){const w=f.j.options;if("Sphere"===f.j.kind)C.setEmitterAsSphere({diameter:w.diameter,segments:w.segments,color:F.d.ck(w.color)},f.j.renderingGroupId,z)}return C}}sf.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Hf=w(573);class Lf{static CreateDefault(f){let z,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;return z=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Pf("default system",{_a:w},S):new df("default system",w,S),z.j=f,z.particleTexture=new H.b("https://assets.babylonjs.com/textures/flare.png",z.va()),z.createConeEmitter(.1,Math.PI/4),z.color1=new F.f(1,1,1,1),z.color2=new F.f(1,1,1,1),z.colorDead=new F.f(1,1,1,0),z.minSize=.1,z.maxSize=.1,z.minEmitPower=2,z.maxEmitPower=2,z.updateSpeed=1/60,z.emitRate=30,z}static CreateAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;z||(z=l.c.LastCreatedScene);const C={};return z.addPendingData(C),new Promise(((E,F)=>{if(w&&!Pf.IsSupported)return z.removePendingData(C),F("Particle system with GPU is not supported.");Rf.h.LoadFile(`${Lf.BaseAssetsUrl}/systems/${f}.json`,(f=>{z.removePendingData(C);const F=JSON.parse(f.toString());return E(sf.Parse(F,z,w,S))}),void 0,void 0,void 0,(()=>(z.removePendingData(C),F(`An error occurred with the creation of your particle system. Check if your type '${f}' exists.`))))}))}static ExportSet(f){const z=new sf;for(const w of f)z.systems.push(w);return z}static ParseFromFileAsync(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",E=arguments.length>5?arguments[5]:void 0;return new Promise(((F,J)=>{const x=new Hf.b;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const z=JSON.parse(x.responseText);let J;J=S?Pf.Parse(z,w,C,!1,E):df.Parse(z,w,C,!1,E),f&&(J.name=f),F(J)}else J("Unable to load the particle system")})),x.open("GET",z),x.send()}))}static ParseFromSnippetAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0;if("_BLANK"===f){const f=this.CreateDefault(null);return f.start(),Promise.resolve(f)}return new Promise(((E,F)=>{const J=new Hf.b;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const F=JSON.parse(JSON.parse(J.responseText).jsonPayload),x=JSON.parse(F.particleSystem);let u;u=w?Pf.Parse(x,z,S,!1,C):df.Parse(x,z,S,!1,C),u.snippetId=f,E(u)}else F("Unable to load the snippet "+f)})),J.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),J.send()}))}}Lf.BaseAssetsUrl=sf.BaseAssetsUrl,Lf.SnippetUrl="https://snippet.babylonjs.com",Lf.CreateFromSnippetAsync=Lf.ParseFromSnippetAsync;var Uf=w(525),mf=w(914),rf=w(12311);(0,rf.g)(mf.d.NAME_PARTICLESYSTEM,((f,z,w,S)=>{const C=(0,rf.j)(mf.d.NAME_PARTICLESYSTEM);if(C&&void 0!==f.zk&&null!==f.zk)for(let E=0,F=f.zk.length;E<F;E++){const F=f.zk[E];w.zk.push(C(F,z,S))}})),(0,rf.e)(mf.d.NAME_PARTICLESYSTEM,((f,z,w)=>{if(f.activeParticleCount){return Pf.Parse(f,z,w)}return df.Parse(f,z,w)})),xf.e.prototype.createEffectForParticles=function(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,x=arguments.length>7?arguments[7]:void 0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=[],X=[];const K=[];return x?x.fillUniformsAttributesAndSamplerNames(X,h,K):(h=df._GetAttributeNamesOrOptions(),X=df._GetEffectCreationOptions()),-1===C.indexOf(" BILLBOARD")&&(C+="\n#define BILLBOARD\n"),null!==x&&void 0!==x&&x.isAnimationSheetEnabled&&-1===C.indexOf(" ANIMATESHEET")&&(C+="\n#define ANIMATESHEET\n"),-1===S.indexOf("diffuseSampler")&&S.push("diffuseSampler"),this.createEffect({vertex:(null===x||void 0===x?void 0:x.vertexShaderName)??"particles",fragmentElement:f},h,X.concat(z),K.concat(S),C,E,F,J,void 0,u,(async()=>{0===u?await Promise.resolve().then(w.bind(w,12339)):await Promise.resolve().then(w.bind(w,12416))}))},Uf.b.prototype.getEmittedParticleSystems=function(){const f=[];for(let z=0;z<this.va().zk.length;z++){const w=this.va().zk[z];w.j===this&&f.push(w)}return f},Uf.b.prototype.getHierarchyEmittedParticleSystems=function(){const f=[],z=this.getDescendants();z.push(this);for(let w=0;w<this.va().zk.length;w++){const S=this.va().zk[w],C=S.j;C.position&&-1!==z.indexOf(C)&&f.push(S)}return f};w(807),w(819),w(853);w(795),w(516),w(876),w(799),w(907);w(2295);var of;w(12320),w(2323);!function(f){f[f.Color=2]="Color",f[f.UV=1]="UV",f[f.Random=0]="Random",f[f.Stated=3]="Stated"}(of||(of={}));w(12328),w(12339),w(12347),w(12416)},12395:(f,z,w)=>{"use strict";const S="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12354:(f,z,w)=>{"use strict";const S="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12431:(f,z,w)=>{"use strict";const S="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12421:(f,z,w)=>{"use strict";const S="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12407:(f,z,w)=>{"use strict";const S="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12391:(f,z,w)=>{"use strict";const S="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12437:(f,z,w)=>{"use strict";const S="fogVertex",C="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12427:(f,z,w)=>{"use strict";const S="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12379:(f,z,w)=>{"use strict";const S="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12362:(f,z,w)=>{"use strict";const S="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12385:(f,z,w)=>{"use strict";const S="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";w(628).d.IncludesShadersStoreWGSL[S]=C},12370:(f,z,w)=>{"use strict";const S="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12400:(f,z,w)=>{"use strict";const S="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12440:(f,z,w)=>{"use strict";const S="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";w(628).d.IncludesShadersStoreWGSL[S]=C},12347:(f,z,w)=>{"use strict";w.r(z),w.d(z,{particlesPixelShaderWGSL:()=>F});var S=w(628);w(12354),w(12362),w(12370),w(12379),w(12385),w(12391),w(12395),w(12400),w(12407);const C="particlesPixelShader",E="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStoreWGSL[C]=E;const F={name:C,shader:E}},12416:(f,z,w)=>{"use strict";w.r(z),w.d(z,{particlesVertexShaderWGSL:()=>F});var S=w(628);w(12421),w(12427),w(12370),w(12431),w(12437),w(12440);const C="particlesVertexShader",E="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStoreWGSL[C]=E;const F={name:C,shader:E}},12270:(f,z,w)=>{"use strict";const S="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12336:(f,z,w)=>{"use strict";const S="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12287:(f,z,w)=>{"use strict";const S="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12344:(f,z,w)=>{"use strict";const S="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12279:(f,z,w)=>{"use strict";const S="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12266:(f,z,w)=>{"use strict";const S="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12294:(f,z,w)=>{"use strict";const S="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12283:(f,z,w)=>{"use strict";const S="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12253:(f,z,w)=>{"use strict";const S="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";w(628).d.IncludesShadersStore[S]=C},12241:(f,z,w)=>{"use strict";const S="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12259:(f,z,w)=>{"use strict";const S="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";w(628).d.IncludesShadersStore[S]=C},12246:(f,z,w)=>{"use strict";const S="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12273:(f,z,w)=>{"use strict";const S="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12296:(f,z,w)=>{"use strict";const S="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";w(628).d.IncludesShadersStore[S]=C},12328:(f,z,w)=>{"use strict";w.r(z),w.d(z,{particlesPixelShader:()=>F});var S=w(628);w(12336),w(12241),w(12246),w(12253),w(12259),w(12266),w(12270),w(12273),w(12279);const C="particlesPixelShader",E="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.d.ShadersStore[C]=E;const F={name:C,shader:E}},12339:(f,z,w)=>{"use strict";w.r(z),w.d(z,{particlesVertexShader:()=>F});var S=w(628);w(12344),w(12283),w(12246),w(12287),w(12294),w(12296);const C="particlesVertexShader",E="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.d.ShadersStore[C]=E;const F={name:C,shader:E}},12617:(f,z,w)=>{"use strict";class S{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((f,z)=>{this._resolve=f,this._reject=z}))}}var C=w(720),E=w(762),F=w(535),J=w(689),x=w(12623),u=w(12638),h=w(527),X=w(12209),K=w(12647),c=w(12656),y=w(580),e=w(548),O=w(553);class d{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(f){this._useTextureToStoreBoneMatrices=f,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(f,z,w){this.name=f,this.id=z,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=C.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new h.c,this.bones=[],this._scene=w||y.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const S=this._scene.getEngine().getCaps();this._canUseTextureForBones=S.textureFloat&&S.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((f=>!f.getParent()))}getTransformMatrices(f){if(this.needInitialSkinMatrix){if(!f)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return f._bonesTransformMatrices||this.prepare(!0),f._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(f){return this.needInitialSkinMatrix&&f._transformMatrixTexture?f._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(f){let z=`Name: ${this.name}, nBones: ${this.bones.length}`;if(z+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,f){z+=", Ranges: {";let f=!0;for(const w in this._ranges)f&&(z+=", ",f=!1),z+=w;z+="}"}return z}getBoneIndexByName(f){for(let z=0,w=this.bones.length;z<w;z++)if(this.bones[z].name===f)return z;return-1}createAnimationRange(f,z,w){if(!this._ranges[f]){this._ranges[f]=new c.d(f,z,w);for(let S=0,C=this.bones.length;S<C;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].createRange(f,z,w)}}deleteAnimationRange(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let w=0,S=this.bones.length;w<S;w++)this.bones[w].animations[0]&&this.bones[w].animations[0].deleteRange(f,z);this._ranges[f]=null}getAnimationRange(f){return this._ranges[f]||null}getAnimationRanges(){const f=[];let z;for(z in this._ranges)f.push(this._ranges[z]);return f}copyAnimationRange(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[z]||!f.getAnimationRange(z))return!1;let S=!0;const C=this._getHighestAnimationFrame()+1,E={},F=f.bones;let J,x;for(x=0,J=F.length;x<J;x++)E[F[x].name]=F[x];this.bones.length!==F.length&&(e.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${F.length}`),S=!1);const u=w&&this.dimensionsAtRest&&f.dimensionsAtRest?this.dimensionsAtRest.divide(f.dimensionsAtRest):null;for(x=0,J=this.bones.length;x<J;x++){const f=this.bones[x].name,F=E[f];F?S=S&&this.bones[x].copyAnimationRange(F,z,C,w,u):(e.b.Warn("copyAnimationRange: not same rig, missing source bone "+f),S=!1)}const h=f.getAnimationRange(z);return h&&(this._ranges[z]=new c.d(z,h.from+C,h.to+C)),S}returnToRest(){for(const f of this.bones)-1!==f._index&&f.returnToRest()}_getHighestAnimationFrame(){let f=0;for(let z=0,w=this.bones.length;z<w;z++)if(this.bones[z].animations[0]){const w=this.bones[z].animations[0].getHighestFrame();f<w&&(f=w)}return f}beginAnimation(f,z,w,S){const C=this.getAnimationRange(f);return C?this._scene.beginAnimation(this,C.from,C.to,z,w,S):null}static MakeAnimationAdditive(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0;const S=f.getAnimationRange(w);if(!S)return null;const C=f._scene.getAllAnimatablesByTarget(f);let E=null;for(let J=0;J<C.length;J++){const f=C[J];if(f.fromFrame===(null===S||void 0===S?void 0:S.from)&&f.toFrame===(null===S||void 0===S?void 0:S.to)){E=f;break}}const F=f.getAnimatables();for(let J=0;J<F.length;J++){const f=F[J].animations;if(f)for(let S=0;S<f.length;S++)K.c.MakeAnimationAdditive(f[S],z,w)}return E&&(E.isAdditive=!0),f}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(f){this._meshesWithPoseMatrix.push(f)}_unregisterMeshWithPoseMatrix(f){const z=this._meshesWithPoseMatrix.indexOf(f);z>-1&&this._meshesWithPoseMatrix.splice(z,1)}_computeTransformMatrices(f,z){this.onBeforeComputeObservable.notifyObservers(this);for(let w=0;w<this.bones.length;w++){const S=this.bones[w];S._childUpdateId++;const C=S.getParent();if(C?S.getLocalMatrix().multiplyToRef(C.getFinalMatrix(),S.getFinalMatrix()):z?S.getLocalMatrix().multiplyToRef(z,S.getFinalMatrix()):S.getFinalMatrix().p(S.getLocalMatrix()),-1!==S._index){const z=null===S._index?w:S._index;S.getAbsoluteInverseBindMatrix().multiplyToArray(S.getFinalMatrix(),f,16*z)}}this._identity.copyToArray(f,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const f=this.va().getRenderId();if(this._currentRenderId===f)return;this._currentRenderId=f}if(this._numBonesWithLinkedTransformNode>0)for(const f of this.bones)if(f._linkedTransformNode){const z=f._linkedTransformNode;f.position=z.position,z.rotationQuaternion?f.rotationQuaternion=z.rotationQuaternion:f.rotation=z.rotation,f.Id=z.Id}if(this.needInitialSkinMatrix)for(const f of this._meshesWithPoseMatrix){const z=f.getPoseMatrix();let w=this._isDirty;if(f._bonesTransformMatrices&&f._bonesTransformMatrices.length===16*(this.bones.length+1)||(f._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),w=!0),w){if(this._synchronizedWithMesh!==f){this._synchronizedWithMesh=f;for(const f of this.bones)if(!f.getParent()){f.getBindMatrix().multiplyToRef(z,C.j.Matrix[1]),f._updateAbsoluteBindMatrices(C.j.Matrix[1])}if(this.isUsingTextureForMatrices){const z=4*(this.bones.length+1);f._transformMatrixTexture&&f._transformMatrixTexture.getSize().width===z||(f._transformMatrixTexture&&f._transformMatrixTexture.dispose(),f._transformMatrixTexture=X.b.CreateRGBATexture(f._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(f._bonesTransformMatrices,z),this.isUsingTextureForMatrices&&f._transformMatrixTexture&&f._transformMatrixTexture.update(f._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=X.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let f=0;f<this.bones.length;f++)this._animatables.push(this.bones[f])}return this._animatables}clone(f,z){const w=new d(f,z||f,this._scene);w.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){const f=this.bones[S];let z=null;const C=f.getParent();if(C){const f=this.bones.indexOf(C);z=w.bones[f]}const E=new u.b(f.name,w,z,f.getBindMatrix().clone(),f.getRestMatrix().clone());E._index=f._index,f._linkedTransformNode&&E.linkTransformNode(f._linkedTransformNode),O.b.DeepCopy(f.animations,E.animations)}if(this._ranges){w._ranges={};for(const f in this._ranges){const z=this._ranges[f];z&&(w._ranges[f]=z.clone())}}return this._isDirty=!0,w.prepare(!0),w}enableBlending(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((z=>{z.animations.forEach((z=>{z.enableBlending=!0,z.blendingSpeed=f}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const f=this._parentContainer.skeletons.indexOf(this);f>-1&&this._parentContainer.skeletons.splice(f,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const f={};f.name=this.name,f.id=this.id,this.dimensionsAtRest&&(f.dimensionsAtRest=this.dimensionsAtRest.kk()),f.bones=[],f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let w=0;w<this.bones.length;w++){var z;const S=this.bones[w],C=S.getParent(),E={parentBoneIndex:C?this.bones.indexOf(C):-1,index:S.getIndex(),name:S.name,id:S.id,matrix:S.getBindMatrix().kk(),rest:S.getRestMatrix().kk(),linkedTransformNodeId:null===(z=S.getTransformNode())||void 0===z?void 0:z.id};f.bones.push(E),S.length&&(E.length=S.length),S.metadata&&(E.metadata=S.metadata),S.animations&&S.animations.length>0&&(E.animation=S.animations[0].serialize()),f.ranges=[];for(const z in this._ranges){const w=this._ranges[z];if(!w)continue;const S={};S.name=z,S.from=w.from,S.to=w.to,f.ranges.push(S)}}return f}static Parse(f,z){const w=new d(f.name,f.id,z);let S;for(f.dimensionsAtRest&&(w.dimensionsAtRest=C.n.ck(f.dimensionsAtRest)),w.needInitialSkinMatrix=f.needInitialSkinMatrix,S=0;S<f.bones.length;S++){const z=f.bones[S],E=f.bones[S].index;let F=null;z.parentBoneIndex>-1&&(F=w.bones[z.parentBoneIndex]);const J=z.rest?C.b.ck(z.rest):null,x=new u.b(z.name,w,F,C.b.ck(z.matrix),J,null,E);void 0!==z.id&&null!==z.id&&(x.id=z.id),z.length&&(x.length=z.length),z.metadata&&(x.metadata=z.metadata),z.animation&&x.animations.push(K.c.Parse(z.animation)),void 0!==z.linkedTransformNodeId&&null!==z.linkedTransformNodeId&&(w._hasWaitingData=!0,x._waitingTransformNodeId=z.linkedTransformNodeId)}if(f.ranges)for(S=0;S<f.ranges.length;S++){const z=f.ranges[S];w.createAnimationRange(z.name,z.from,z.to)}return w}computeAbsoluteMatrices(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||f)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(f)}getPoseMatrix(){let f=null;return this._meshesWithPoseMatrix.length>0&&(f=this._meshesWithPoseMatrix[0].getPoseMatrix()),f}sortBones(){const f=[],z=new Array(this.bones.length);for(let w=0;w<this.bones.length;w++)this._sortBones(w,f,z);this.bones=f}_sortBones(f,z,w){if(w[f])return;w[f]=!0;const S=this.bones[f];if(!S)return;void 0===S._index&&(S._index=f);const C=S.getParent();C&&this._sortBones(this.bones.indexOf(C),z,w),z.push(S)}setCurrentPoseAsRest(){this.bones.forEach((f=>{f.setCurrentPoseAsRest()}))}}var B=w(878),V=w(692),W=w(699),T=w(12661),v=w(12667),D=w(665),A=w(753);class M extends v.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(f){this.subSurface.refractionTexture=f,f?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(f){this.subSurface.indexOfRefraction=f}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(f){this.subSurface.invertRefractionY=f}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(f){this.subSurface.linkRefractionWithTransparency=f,f&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===v.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(f){f!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=f?v.d.LIGHTFALLOFF_PHYSICAL:v.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===v.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(f){f!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=f?v.d.LIGHTFALLOFF_GLTF:v.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(f){this.imageProcessingConfiguration.colorCurvesEnabled=f}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(f){this.imageProcessingConfiguration.colorGradingEnabled=f}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(f){this._imageProcessingConfiguration.toneMappingEnabled=f}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(f){this._imageProcessingConfiguration.exposure=f}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(f){this._imageProcessingConfiguration.contrast=f}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(f){this._imageProcessingConfiguration.colorGradingTexture=f}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(f){this._imageProcessingConfiguration.colorCurves=f}constructor(f,z){super(f,z,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=E.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new E.d(0,0,0),this.albedoColor=new E.d(1,1,1),this.reflectivityColor=new E.d(1,1,1),this.reflectionColor=new E.d(1,1,1),this.emissiveColor=new E.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,T.c)(this.va())}getClassName(){return"PBRMaterial"}clone(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const S=A.b.Clone((()=>new M(f,this.va())),this,{cloneTexturesOnlyOnce:z});return S.id=f,S.name=f,this.stencil.copyTo(S.stencil),this._clonePlugins(S,w),S}serialize(){const f=super.serialize();return f.customType="BABYLON.PBRMaterial",f}static Parse(f,z,w){const S=A.b.Parse((()=>new M(f.name,z)),f,z,w);return f.stencil&&S.stencil.parse(f.stencil,z,w),B.e._ParsePlugins(f,S,z,w),f.clearCoat&&S.clearCoat.parse(f.clearCoat,z,w),f.anisotropy&&S.anisotropy.parse(f.anisotropy,z,w),f.brdf&&S.brdf.parse(f.brdf,z,w),f.sheen&&S.sheen.parse(f.sheen,z,w),f.subSurface&&S.subSurface.parse(f.subSurface,z,w),f.iridescence&&S.iridescence.parse(f.iridescence,z,w),S}}M.PBRMATERIAL_OPAQUE=v.d.PBRMATERIAL_OPAQUE,M.PBRMATERIAL_ALPHATEST=v.d.PBRMATERIAL_ALPHATEST,M.PBRMATERIAL_ALPHABLEND=v.d.PBRMATERIAL_ALPHABLEND,M.PBRMATERIAL_ALPHATESTANDBLEND=v.d.PBRMATERIAL_ALPHATESTANDBLEND,M.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=v.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"directIntensity",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveIntensity",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"environmentIntensity",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"specularIntensity",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"disableBumpMap",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"albedoTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTexture",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTextureStrength",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"opacityTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectivityTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicTexture",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallic",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"roughness",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicF0Factor",void 0),(0,V.b)([(0,W.n)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicReflectanceColor",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"metallicReflectanceTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectanceTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"microSurfaceTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"bumpTexture",void 0),(0,V.b)([(0,W.H)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty",null)],M.prototype,"lightmapTexture",void 0),(0,V.b)([(0,W.n)("ambient"),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"ambientColor",void 0),(0,V.b)([(0,W.n)("albedo"),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"albedoColor",void 0),(0,V.b)([(0,W.n)("reflectivity"),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectivityColor",void 0),(0,V.b)([(0,W.n)("reflection"),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"reflectionColor",void 0),(0,V.b)([(0,W.n)("emissive"),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"emissiveColor",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"microSurface",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLightmapAsShadowmap",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"useAlphaFromAlbedoTexture",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"forceAlphaTest",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],M.prototype,"alphaCutOff",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useSpecularOverAlpha",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAmbientInGrayScale",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,V.b)([(0,W.O)()],M.prototype,"usePhysicalLightFalloff",null),(0,V.b)([(0,W.O)()],M.prototype,"useGLTFLightFalloff",null),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRadianceOverAlpha",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useObjectSpaceNormalMap",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallax",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useParallaxOcclusion",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"parallaxScaleBias",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsLightsDirty")],M.prototype,"disableLighting",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"forceIrradianceInFragment",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsLightsDirty")],M.prototype,"maxSimultaneousLights",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapX",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"invertNormalMapY",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"twoSidedLighting",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useAlphaFresnel",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useLinearAlphaFresnel",void 0),(0,V.b)([(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"environmentBRDFTexture",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"forceNormalForward",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"enableSpecularAntiAliasing",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useHorizonOcclusion",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsTexturesDirty")],M.prototype,"useRadianceOcclusion",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsMiscDirty")],M.prototype,"unlit",void 0),(0,V.b)([(0,W.O)(),(0,W.e)("_markAllSubMeshesAsMiscDirty")],M.prototype,"applyDecalMapAfterDetailMap",void 0),(0,D.f)("BABYLON.PBRMaterial",M);var G=w(2321),I=w(862),n=w(789),P=w(833),R=w(853),q=w(525);class a{get influence(){return this._influence}set influence(f){if(this._influence===f)return;const z=this._influence;this._influence=f,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===z||0===f)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=f,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new h.c,this._onDataLayoutChanged=new h.c,this._animationPropertiesOverride=null,this.id=f,this._scene=w||y.c.LastCreatedScene,this.influence=z,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(f){const z=this.hasPositions;this._positions=f,z!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(f){const z=this.hasNormals;this._normals=f,z!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(f){const z=this.hasTangents;this._tangents=f,z!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(f){const z=this.hasUVs;this._uvs=f,z!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const f=A.b.Clone((()=>new a(this.name,this.influence,this._scene)),this);return f._positions=this._positions,f._normals=this._normals,f._tangents=this._tangents,f._uvs=this._uvs,f}serialize(){const f={};return f.name=this.name,f.influence=this.influence,f.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(f.id=this.id),this.hasNormals&&(f.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(f.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(f.Aa=Array.prototype.slice.call(this.getUVs())),A.b.AppendSerializedAnimations(this,f),f}getClassName(){return"MorphTarget"}static Parse(f,z){const w=new a(f.name,f.influence);if(w.setPositions(f.xa),null!=f.id&&(w.id=f.id),f.ya&&w.setNormals(f.ya),f.tangents&&w.setTangents(f.tangents),f.Aa&&w.setUVs(f.Aa),f.animations){for(let z=0;z<f.animations.length;z++){const S=f.animations[z],C=(0,D.b)("BABYLON.Animation");C&&w.animations.push(C.Parse(S))}f.autoAnimate&&z&&z.beginAnimation(w,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}return w}static FromMesh(f,z,w){z||(z=f.name);const S=new a(z,w,f.va());return S.setPositions(f.getVerticesData(n.f.PositionKind)),f.isVerticesDataPresent(n.f.NormalKind)&&S.setNormals(f.getVerticesData(n.f.NormalKind)),f.isVerticesDataPresent(n.f.TangentKind)&&S.setTangents(f.getVerticesData(n.f.TangentKind)),f.isVerticesDataPresent(n.f.UVKind)&&S.setUVs(f.getVerticesData(n.f.UVKind)),S}}(0,V.b)([(0,W.O)()],a.prototype,"id",void 0);var s=w(715),H=w(12529);class L{set areUpdatesFrozen(f){f?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new s.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,f||(f=y.c.LastCreatedScene),this._scene=f,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const f=this._scene.getEngine().getCaps();this._canUseTextureForTargets=f.canUseGLVertexID&&f.textureFloat&&f.maxVertexTextureImageUnits>0&&f.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(f){this._numMaxInfluencers!==f&&(this._numMaxInfluencers=f,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(f){this._useTextureToStoreTargets=f}get isUsingTextureForTargets(){var f;return L.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(f=this._scene)&&void 0!==f&&f.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(f){return this._activeTargets.data[f]}getTarget(f){return this._targets[f]}getTargetByName(f){for(const z of this._targets)if(z.name===f)return z;return null}addTarget(f){this._targets.push(f),this._targetInfluenceChangedObservers.push(f.onInfluenceChanged.add((f=>{this._syncActiveTargets(f)}))),this._targetDataLayoutChangedObservers.push(f._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(f){const z=this._targets.indexOf(f);z>=0&&(this._targets.splice(z,1),f.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(z,1)[0]),f._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(z,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(f)}_bind(f){f.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),f.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),f.setTexture("morphTargets",this._targetStoreTexture),f.setInt("morphTargetCount",this.numInfluencers)}clone(){const f=new L(this._scene);for(const z of this._targets)f.addTarget(z.clone());return f.enableNormalMorphing=this.enableNormalMorphing,f.enableTangentMorphing=this.enableTangentMorphing,f.enableUVMorphing=this.enableUVMorphing,f}serialize(){const f={};f.id=this.uniqueId,f.targets=[];for(const z of this._targets)f.targets.push(z.serialize());return f}_syncActiveTargets(f){if(this.areUpdatesFrozen)return;let z=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let w=-1;for(const S of this._targets){if(w++,0===S.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=L.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(S),this._morphTargetTextureIndices[z]=w,this._tempInfluences[z++]=S.influence,this._supportsNormals=this._supportsNormals&&S.hasNormals,this._supportsTangents=this._supportsTangents&&S.hasTangents,this._supportsUVs=this._supportsUVs&&S.hasUVs;const f=S.getPositions();if(f){const z=f.length/3;if(0===this._vertexCount)this._vertexCount=z;else if(this._vertexCount!==z)return void e.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,z)),this._influences&&this._influences.length===z||(this._influences=new Float32Array(z));for(let S=0;S<z;S++)this._influences[S]=this._tempInfluences[S];f&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const f=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>f&&(this._textureHeight=Math.ceil(this._textureWidth/f),this._textureWidth=f);let z=!0;if(this._targetStoreTexture){const f=this._targetStoreTexture.getSize();f.width===this._textureWidth&&f.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(z=!1)}if(z){this._targetStoreTexture&&this._targetStoreTexture.dispose();const f=this._targets.length,z=new Float32Array(f*this._textureWidth*this._textureHeight*4);let w=0;for(let S=0;S<f;S++){const f=this._targets[S],C=f.getPositions(),E=f.getNormals(),F=f.getUVs(),J=f.getTangents();if(!C)return void(0===S&&e.b.Error("Invalid morph target. Target must have positions."));w=S*this._textureWidth*this._textureHeight*4;for(let S=0;S<this._vertexCount;S++)z[w]=C[3*S],z[w+1]=C[3*S+1],z[w+2]=C[3*S+2],w+=4,this._supportsNormals&&E&&(z[w]=E[3*S],z[w+1]=E[3*S+1],z[w+2]=E[3*S+2],w+=4),this._supportsUVs&&F&&(z[w]=F[2*S],z[w+1]=F[2*S+1],w+=4),this._supportsTangents&&J&&(z[w]=J[3*S],z[w+1]=J[3*S+1],z[w+2]=J[3*S+2],w+=4)}this._targetStoreTexture=H.b.CreateRGBATexture(z,this._textureWidth,this._textureHeight,f,this._scene,!1,!1,1,1)}}for(const f of this._scene.meshes)f.morphTargetManager===this&&f._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const f=this._parentContainer.morphTargetManagers.indexOf(this);f>-1&&this._parentContainer.morphTargetManagers.splice(f,1),this._parentContainer=null}for(const f of this._targets)this._scene.stopAnimation(f)}}static Parse(f,z){const w=new L(z);for(const S of f.targets)w.addTarget(a.Parse(S,z));return w}}L.EnableTextureStorage=!0,L.MaxActiveMorphTargetsInVertexAttributeMode=8;var U=w(12674),i=w(583),m=w(807);function r(f,z,w,S){return C.n.ck(z,w).scaleInPlace(S)}class o{constructor(f,z,w,S){this.type=f,this.name=z,this.getValue=w,this.getStride=S}_buildAnimation(f,z,w){const S=new K.c(f,this.name,z,this.type);return S.setKeys(w),S}}class p extends o{buildAnimations(f,z,w,S,C){C(f._babylonTransformNode,this._buildAnimation(z,w,S))}}const Y={translation:[new p(K.c.ANIMATIONTYPE_VECTOR3,"position",r,(()=>3))],rotation:[new p(K.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(f,z,w,S){return C.f.ck(z,w).scaleInPlace(S)}),(()=>4))],scale:[new p(K.c.ANIMATIONTYPE_VECTOR3,"Id",r,(()=>3))],weights:[new class extends o{buildAnimations(f,z,w,S,C){if(f._numMorphTargets)for(let E=0;E<f._numMorphTargets;E++){const F=new K.c(`${z}_${E}`,this.name,w,this.type);if(F.setKeys(S.map((f=>({frame:f.frame,inTangent:f.inTangent?f.inTangent[E]:void 0,value:f.value[E],outTangent:f.outTangent?f.outTangent[E]:void 0,interpolation:f.interpolation})))),f._primitiveBabylonMeshes)for(const z of f._primitiveBabylonMeshes)if(z.morphTargetManager){const f=z.morphTargetManager.getTarget(E),w=F.clone();f.animations.push(w),C(f,w)}}}}(K.c.ANIMATIONTYPE_FLOAT,"influence",(function(f,z,w,S){const C=new Array(f._numMorphTargets);for(let E=0;E<C.length;E++)C[E]=z[w++]*S;return C}),(f=>f._numMorphTargets))]},t=new Map,Z=t;function b(f,z,w){Q(f)&&e.b.Warn(`Extension with the name '${f}' already exists`),t.set(f,{isGLTFExtension:z,factory:w})}function Q(f){return t.delete(f)}function g(){const f=f=>f&&"object"===typeof f;for(var z=arguments.length,w=new Array(z),S=0;S<z;S++)w[S]=arguments[S];return w.reduce(((z,w)=>(Object.keys(w).forEach((S=>{const C=z[S],E=w[S];Array.isArray(C)&&Array.isArray(E)?z[S]=C.concat(...E):f(C)&&f(E)?z[S]=g(C,E):z[S]=E})),z)),{})}class k{static Get(f,z,w){if(!z||void 0==w||!z[w])throw new Error(`${f}: Failed to find index (${w})`);return z[w]}static TryGet(f,z){return f&&void 0!=z&&f[z]?f[z]:null}static Assign(f){if(f)for(let z=0;z<f.length;z++)f[z].index=z}}class j{static RegisterExtension(f,z){b(f,!1,z)}static UnregisterExtension(f){return Q(f)}get tl(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(f){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=f}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((f=>f.dispose&&f.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(f,z,w,S,C,E){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=z,this._assetContainer=w,this._loadData(S);let E=null;if(f){const z={};if(this._gltf.nodes)for(const f of this._gltf.nodes)f.name&&(z[f.name]=f.index);E=(f instanceof Array?f:[f]).map((f=>{const w=z[f];if(void 0===w)throw new Error(`Failed to find node '${f}'`);return w}))}return this._loadAsync(C,F,E,(()=>({meshes:this._getMeshes(),zk:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=f,this._loadData(z),this._loadAsync(w,C,null,(()=>{})))))}_loadAsync(f,z,w,S){return Promise.resolve().then((async()=>{this._rootUrl=f,this._uniqueRootUrl=!f.startsWith("file:")&&z?f:`${f}${Date.now()}/`,this._fileName=z,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const C=`${U.k[U.k.LOADING]} => ${U.k[U.k.READY]}`,E=`${U.k[U.k.LOADING]} => ${U.k[U.k.COMPLETE]}`;this._parent._startPerformanceCounter(C),this._parent._startPerformanceCounter(E),this._parent._setState(U.k.LOADING),this._extensionsOnLoading();const J=new Array;if(!this.parent.loadOnlyMaterials)if(w)J.push(this.loadSceneAsync("/nodes",{nodes:w,index:-1}));else if(void 0!=this._gltf.Rc||this._gltf.scenes&&this._gltf.scenes[0]){const f=k.Get("/scene",this._gltf.scenes,this._gltf.Rc||0);J.push(this.loadSceneAsync(`/scenes/${f.index}`,f))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let f=0;f<this._gltf.materials.length;++f){const z=this._gltf.materials[f],w="/materials/"+f,S=B.e.TriangleFillMode;J.push(this._loadMaterialAsync(w,z,null,S,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&J.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&J.push(this._compileShadowGeneratorsAsync());return Promise.all(J).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Cb(!0),this._extensionsOnReady(),this._parent._setState(U.k.READY),this._startAnimations(),S()))).then((f=>(this._parent._endPerformanceCounter(C),F.h.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(E),this._parent._setState(U.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(f=>{this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()}))})),f)))})).catch((f=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()),f}))}_loadData(f){if(this._gltf=f.json,this._setupData(),f.bin){const z=this._gltf.buffers;if(z&&z[0]&&!z[0].uri){const w=z[0];(w.byteLength<f.bin.byteLength-3||w.byteLength>f.bin.byteLength)&&e.b.Warn(`Binary buffer length (${w.byteLength}) from JSON does not match chunk length (${f.bin.byteLength})`),this._bin=f.bin}else e.b.Warn("Unexpected BIN chunk")}}_setupData(){if(k.Assign(this._gltf.accessors),k.Assign(this._gltf.animations),k.Assign(this._gltf.buffers),k.Assign(this._gltf.bufferViews),k.Assign(this._gltf.cameras),k.Assign(this._gltf.images),k.Assign(this._gltf.materials),k.Assign(this._gltf.meshes),k.Assign(this._gltf.nodes),k.Assign(this._gltf.samplers),k.Assign(this._gltf.scenes),k.Assign(this._gltf.skins),k.Assign(this._gltf.textures),this._gltf.nodes){const f={};for(const w of this._gltf.nodes)if(w.children)for(const z of w.children)f[z]=w.index;const z=this._createRootNode();for(const w of this._gltf.nodes){const S=f[w.index];w.parent=void 0===S?z:this._gltf.nodes[S]}}}async _loadExtensionsAsync(){const f=[];if(Z.forEach(((z,w)=>{var S;!1===(null===(S=this.parent.extensionOptions[w])||void 0===S?void 0:S.enabled)?z.isGLTFExtension&&this.isExtensionUsed(w)&&e.b.Warn(`Extension ${w} is used but has been explicitly disabled.`):z.isGLTFExtension&&!this.isExtensionUsed(w)||f.push((async()=>{const f=await z.factory(this);return f.name!==w&&e.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${f.name} !== ${w}`),this._parent.onExtensionLoadedObservable.notifyObservers(f),f})())})),this._extensions.push(...await Promise.all(f)),this._extensions.sort(((f,z)=>(f.order||Number.MAX_VALUE)-(z.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const w of this._gltf.extensionsRequired){if(!this._extensions.some((f=>f.name===w&&f.enabled))){var z;if(!1===(null===(z=this.parent.extensionOptions[w])||void 0===z?void 0:z.enabled))throw new Error(`Required extension ${w} is disabled`);throw new Error(`Required extension ${w} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new q.b("__root__",this._babylonScene);this._rootBabylonMesh=f,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Cb(!1);const z={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case U.h.AUTO:this._babylonScene.useRightHandedSystem||(z.rotation=[0,1,0,0],z.scale=[1,1,-1],j._LoadTransform(z,this._rootBabylonMesh));break;case U.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(f),z}loadSceneAsync(f,z){const w=this._extensionsLoadSceneAsync(f,z);if(w)return w;const S=new Array;if(this.logOpen(`${f} ${z.name||""}`),z.nodes)for(const C of z.nodes){const z=k.Get(`${f}/nodes/${C}`,this._gltf.nodes,C);S.push(this.loadNodeAsync(`/nodes/${z.index}`,z,(f=>{f.parent=this._rootBabylonMesh})))}for(const C of this._postSceneLoadActions)C();return S.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(S).then((()=>{}))}_forEachPrimitive(f,z){if(f._primitiveBabylonMeshes)for(const w of f._primitiveBabylonMeshes)z(w)}_getGeometries(){const f=[],z=this._gltf.nodes;if(z)for(const w of z)this._forEachPrimitive(w,(z=>{const w=z.qk;w&&-1===f.indexOf(w)&&f.push(w)}));return f}_getMeshes(){const f=[];this._rootBabylonMesh instanceof R.c&&f.push(this._rootBabylonMesh);const z=this._gltf.nodes;if(z)for(const w of z)this._forEachPrimitive(w,(z=>{f.push(z)}));return f}_getTransformNodes(){const f=[],z=this._gltf.nodes;if(z)for(const w of z)w._babylonTransformNode&&"Jk"===w._babylonTransformNode.getClassName()&&f.push(w._babylonTransformNode),w._babylonTransformNodeForSkin&&f.push(w._babylonTransformNodeForSkin);return f}_getSkeletons(){const f=[],z=this._gltf.skins;if(z)for(const w of z)w._data&&f.push(w._data.babylonSkeleton);return f}_getAnimationGroups(){const f=[],z=this._gltf.animations;if(z)for(const w of z)w._babylonAnimationGroup&&f.push(w._babylonAnimationGroup);return f}_startAnimations(){switch(this._parent.animationStartMode){case U.e.NONE:break;case U.e.FIRST:{const f=this._getAnimationGroups();0!==f.length&&f[0].start(!0);break}case U.e.ALL:{const f=this._getAnimationGroups();for(const z of f)z.start(!0);break}default:return void e.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadNodeAsync(f,z,w);if(S)return S;if(z._babylonTransformNode)throw new Error(`${f}: Invalid recursive node hierarchy`);const C=new Array;this.logOpen(`${f} ${z.name||""}`);const E=S=>{if(j.AddPointerMetadata(S,f),j._LoadTransform(z,S),void 0!=z.camera){const w=k.Get(`${f}/camera`,this._gltf.cameras,z.camera);C.push(this.loadCameraAsync(`/cameras/${w.index}`,w,(f=>{f.parent=S})))}if(z.children)for(const w of z.children){const z=k.Get(`${f}/children/${w}`,this._gltf.nodes,w);C.push(this.loadNodeAsync(`/nodes/${z.index}`,z,(f=>{f.parent=S})))}w(S)},F=void 0!=z.mesh,J=this._parent.loadSkins&&void 0!=z.skin;if(!F||J){const f=z.name||`node${z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new I.e(f,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==z.mesh?z._babylonTransformNode=w:z._babylonTransformNodeForSkin=w,E(w)}if(F)if(J){const w=k.Get(`${f}/mesh`,this._gltf.meshes,z.mesh);C.push(this._loadMeshAsync(`/meshes/${w.index}`,z,w,(w=>{const S=z._babylonTransformNodeForSkin;w.metadata=g(S.metadata,w.metadata||{});const E=k.Get(`${f}/skin`,this._gltf.skins,z.skin);C.push(this._loadSkinAsync(`/skins/${E.index}`,z,E,(f=>{this._forEachPrimitive(z,(z=>{z.skeleton=f})),this._postSceneLoadActions.push((()=>{if(void 0!=E.skeleton){const f=k.Get(`/skins/${E.index}/skeleton`,this._gltf.nodes,E.skeleton).parent;z.index===f.index?w.parent=S.parent:w.parent=f._babylonTransformNode}else w.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:S,skinnedNode:w})}))})))})))}else{const w=k.Get(`${f}/mesh`,this._gltf.meshes,z.mesh);C.push(this._loadMeshAsync(`/meshes/${w.index}`,z,w,E))}return this.logClose(),Promise.all(C).then((()=>(this._forEachPrimitive(z,(f=>{f.qk&&f.qk.useBoundingInfoFromGeometry?f.Ea():f.refreshBoundingInfo(!0,!0)})),z._babylonTransformNode)))}_loadMeshAsync(f,z,w,S){const C=w.primitives;if(!C||!C.length)throw new Error(`${f}: Primitives are missing`);void 0==C[0].index&&k.Assign(C);const E=new Array;this.logOpen(`${f} ${w.name||""}`);const F=z.name||`node${z.index}`;if(1===C.length){const S=w.primitives[0];E.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${S.index}`,F,z,w,S,(f=>{z._babylonTransformNode=f,z._primitiveBabylonMeshes=[f]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,z._babylonTransformNode=new I.e(F,this._babylonScene),z._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z._primitiveBabylonMeshes=[];for(const S of C)E.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${S.index}`,`${F}_primitive${S.index}`,z,w,S,(f=>{f.parent=z._babylonTransformNode,z._primitiveBabylonMeshes.push(f)})))}return S(z._babylonTransformNode),this.logClose(),Promise.all(E).then((()=>z._babylonTransformNode))}_loadMeshPrimitiveAsync(f,z,w,S,C,E){const F=this._extensionsLoadMeshPrimitiveAsync(f,z,w,S,C,E);if(F)return F;this.logOpen(`${f}`);const J=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==w.skin&&!S.primitives[0].targets;let x,u;if(J&&C._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,x=C._instanceData.babylonSourceMesh.createInstance(z),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u=C._instanceData.promise;else{const E=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new q.b(z,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.sideOrientation=this._babylonScene.useRightHandedSystem?B.e.CounterClockWiseSideOrientation:B.e.ClockWiseSideOrientation,this._createMorphTargets(f,w,S,C,F),E.push(this._loadVertexDataAsync(f,C,F).then((z=>this._loadMorphTargetsAsync(f,C,F,z).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,z.Ca(F),z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=j._GetDrawMode(f,C.mode);if(void 0==C.material){let f=this._defaultBabylonMaterialData[h];f||(f=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(f),this._defaultBabylonMaterialData[h]=f),F.material=f}else if(!this.parent.skipMaterials){const z=k.Get(`${f}/material`,this._gltf.materials,C.material);E.push(this._loadMaterialAsync(`/materials/${z.index}`,z,F,h,(f=>{F.material=f})))}u=Promise.all(E),J&&(C._instanceData={babylonSourceMesh:F,promise:u}),x=F}return j.AddPointerMetadata(x,f),this._parent.onMeshLoadedObservable.notifyObservers(x),E(x),this.logClose(),u.then((()=>x))}_loadVertexDataAsync(f,z,w){const S=this._extensionsLoadVertexDataAsync(f,z,w);if(S)return S;const E=z.attributes;if(!E)throw new Error(`${f}: Attributes are missing`);const F=new Array,J=new P.e(w.name,this._babylonScene);if(void 0==z.indices)w.isUnIndexed=!0;else{const w=k.Get(`${f}/indices`,this._gltf.accessors,z.indices);F.push(this._loadIndicesAccessorAsync(`/accessors/${w.index}`,w).then((f=>{J.setIndices(f)})))}const x=(z,S,x)=>{if(void 0==E[z])return;w._delayInfo=w._delayInfo||[],-1===w._delayInfo.indexOf(S)&&w._delayInfo.push(S);const u=k.Get(`${f}/attributes/${z}`,this._gltf.accessors,E[z]);F.push(this._loadVertexAccessorAsync(`/accessors/${u.index}`,u,S).then((f=>{if(f.getKind()===n.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!w.skeleton&&u.min&&u.max){const f=C.j.ek[0].Gd(...u.min),z=C.j.ek[1].Gd(...u.max);if(u.normalized&&5126!==u.componentType){let w=1;switch(u.componentType){case 5120:w=127;break;case 5121:w=255;break;case 5122:w=32767;break;case 5123:w=65535}const S=1/w;f.scaleInPlace(S),z.scaleInPlace(S)}J._boundingInfo=new m.d(f,z),J.useBoundingInfoFromGeometry=!0}J.setVerticesBuffer(f,u.count)}))),S==n.f.MatricesIndicesExtraKind&&(w.numBoneInfluencers=8),x&&x(u)};return x("POSITION",n.f.PositionKind),x("NORMAL",n.f.NormalKind),x("TANGENT",n.f.TangentKind),x("TEXCOORD_0",n.f.UVKind),x("TEXCOORD_1",n.f.UV2Kind),x("TEXCOORD_2",n.f.UV3Kind),x("TEXCOORD_3",n.f.UV4Kind),x("TEXCOORD_4",n.f.UV5Kind),x("TEXCOORD_5",n.f.UV6Kind),x("JOINTS_0",n.f.MatricesIndicesKind),x("WEIGHTS_0",n.f.MatricesWeightsKind),x("JOINTS_1",n.f.MatricesIndicesExtraKind),x("WEIGHTS_1",n.f.MatricesWeightsExtraKind),x("COLOR_0",n.f.ColorKind,(f=>{"VEC4"===f.type&&(w.hasVertexAlpha=!0)})),Promise.all(F).then((()=>J))}_createMorphTargets(f,z,w,S,C){if(!S.targets||!this._parent.loadMorphTargets)return;if(void 0==z._numMorphTargets)z._numMorphTargets=S.targets.length;else if(S.targets.length!==z._numMorphTargets)throw new Error(`${f}: Primitives do not have the same number of targets`);const E=w.extras?w.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,C.morphTargetManager=new L(this._babylonScene),C.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.morphTargetManager.areUpdatesFrozen=!0;for(let F=0;F<S.targets.length;F++){const f=z.weights?z.weights[F]:w.weights?w.weights[F]:0,S=E?E[F]:`morphTarget${F}`;C.morphTargetManager.addTarget(new a(S,f,C.va()))}}_loadMorphTargetsAsync(f,z,w,S){if(!z.targets||!this._parent.loadMorphTargets)return Promise.resolve();const C=new Array,E=w.morphTargetManager;for(let F=0;F<E.numTargets;F++){const w=E.getTarget(F);C.push(this._loadMorphTargetVertexDataAsync(`${f}/targets/${F}`,S,z.targets[F],w))}return Promise.all(C).then((()=>{E.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(f,z,w,S){const C=new Array,E=(S,E,F)=>{if(void 0==w[S])return;const J=z.getVertexBuffer(E);if(!J)return;const x=k.Get(`${f}/${S}`,this._gltf.accessors,w[S]);C.push(this._loadFloatAccessorAsync(`/accessors/${x.index}`,x).then((f=>{F(J,f)})))};return E("POSITION",n.f.PositionKind,((f,z)=>{const w=new Float32Array(z.length);f.forEach(z.length,((f,S)=>{w[S]=z[S]+f})),S.setPositions(w)})),E("NORMAL",n.f.NormalKind,((f,z)=>{const w=new Float32Array(z.length);f.forEach(w.length,((f,S)=>{w[S]=z[S]+f})),S.setNormals(w)})),E("TANGENT",n.f.TangentKind,((f,z)=>{const w=new Float32Array(z.length/3*4);let C=0;f.forEach(z.length/3*4,((f,S)=>{(S+1)%4!==0&&(w[C]=z[C]+f,C++)})),S.setTangents(w)})),Promise.all(C).then((()=>{}))}static _LoadTransform(f,z){if(void 0!=f.skin)return;let w=C.n.Zero(),S=C.f.Identity(),E=C.n.One();if(f.matrix){C.b.ck(f.matrix).decompose(E,S,w)}else f.translation&&(w=C.n.ck(f.translation)),f.rotation&&(S=C.f.ck(f.rotation)),f.scale&&(E=C.n.ck(f.scale));z.position=w,z.rotationQuaternion=S,z.Id=E}_loadSkinAsync(f,z,w,S){if(!this._parent.loadSkins)return Promise.resolve();const C=this._extensionsLoadSkinAsync(f,z,w);if(C)return C;if(w._data)return S(w._data.babylonSkeleton),w._data.promise;const E=`skeleton${w.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new d(w.name||E,E,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(f,w,F);const J=this._loadSkinInverseBindMatricesDataAsync(f,w).then((f=>{this._updateBoneMatrices(F,f)}));return w._data={babylonSkeleton:F,promise:J},S(F),J}_loadBones(f,z,w){if(void 0==z.skeleton||this._parent.alwaysComputeSkeletonRootNode){const w=this._findSkeletonRootNode(`${f}/joints`,z.joints);if(w)if(void 0===z.skeleton)z.skeleton=w.index;else{const S=(f,z)=>{for(;z.parent;z=z.parent)if(z.parent===f)return!0;return!1},C=k.Get(`${f}/skeleton`,this._gltf.nodes,z.skeleton);C===w||S(C,w)||(e.b.Warn(`${f}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),z.skeleton=w.index)}else e.b.Warn(`${f}: Failed to find common root`)}const S={};for(const C of z.joints){const E=k.Get(`${f}/joints/${C}`,this._gltf.nodes,C);this._loadBone(E,z,w,S)}}_findSkeletonRootNode(f,z){if(0===z.length)return null;const w={};for(const C of z){const z=[];let S=k.Get(`${f}/${C}`,this._gltf.nodes,C);for(;-1!==S.index;)z.unshift(S),S=S.parent;w[C]=z}let S=null;for(let C=0;;++C){let f=w[z[0]];if(C>=f.length)return S;const E=f[C];for(let F=1;F<z.length;++F)if(f=w[z[F]],C>=f.length||E!==f[C])return S;S=E}}_loadBone(f,z,w,S){f._isJoint=!0;let C=S[f.index];if(C)return C;let E=null;f.index!==z.skeleton&&(f.parent&&-1!==f.parent.index?E=this._loadBone(f.parent,z,w,S):void 0!==z.skeleton&&e.b.Warn(`/skins/${z.index}/skeleton: Skeleton node is not a common root`));const F=z.joints.indexOf(f.index);return C=new u.b(f.name||`joint${f.index}`,w,E,this._getNodeMatrix(f),null,null,F),S[f.index]=C,this._postSceneLoadActions.push((()=>{C.linkTransformNode(f._babylonTransformNode)})),C}_loadSkinInverseBindMatricesDataAsync(f,z){if(void 0==z.inverseBindMatrices)return Promise.resolve(null);const w=k.Get(`${f}/inverseBindMatrices`,this._gltf.accessors,z.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${w.index}`,w)}_updateBoneMatrices(f,z){for(const w of f.bones){const f=C.b.Identity(),S=w._index;z&&-1!==S&&(C.b.FromArrayToRef(z,16*S,f),f.invertToRef(f));const E=w.getParent();E&&f.multiplyToRef(E.getAbsoluteInverseBindMatrix(),f),w.rk(f,!1,!1),w._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(f){return f.matrix?C.b.ck(f.matrix):C.b.Compose(f.scale?C.n.ck(f.scale):C.n.One(),f.rotation?C.f.ck(f.rotation):C.f.Identity(),f.translation?C.n.ck(f.translation):C.n.Zero())}loadCameraAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadCameraAsync(f,z,w);if(S)return S;const E=new Array;this.logOpen(`${f} ${z.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new x.c(z.name||`camera${z.index}`,C.n.Zero(),this._babylonScene,!1);switch(F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.ignoreParentScaling=!0,z._babylonCamera=F,F.rotation.set(0,Math.PI,0),z.type){case"perspective":{const w=z.perspective;if(!w)throw new Error(`${f}: Camera perspective properties are missing`);F.fov=w.yfov,F.Zj=w.znear,F.maxZ=w.zfar||0;break}case"orthographic":if(!z.orthographic)throw new Error(`${f}: Camera orthographic properties are missing`);F.mode=J.e.ORTHOGRAPHIC_CAMERA,F.orthoLeft=-z.orthographic.xmag,F.orthoRight=z.orthographic.xmag,F.orthoBottom=-z.orthographic.ymag,F.orthoTop=z.orthographic.ymag,F.Zj=z.orthographic.znear,F.maxZ=z.orthographic.zfar;break;default:throw new Error(`${f}: Invalid camera type (${z.type})`)}return j.AddPointerMetadata(F,f),this._parent.onCameraLoadedObservable.notifyObservers(F),w(F),this.logClose(),Promise.all(E).then((()=>F))}_loadAnimationsAsync(){const f=this._gltf.animations;if(!f)return Promise.resolve();const z=new Array;for(let w=0;w<f.length;w++){const S=f[w];z.push(this.loadAnimationAsync(`/animations/${S.index}`,S).then((f=>{0===f.targetedAnimations.length&&f.dispose()})))}return Promise.all(z).then((()=>{}))}loadAnimationAsync(f,z){const S=this._extensionsLoadAnimationAsync(f,z);return S||w.e(48).then(w.bind(w,13685)).then((w=>{let{AnimationGroup:S}=w;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new S(z.name||`animation${z.index}`,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z._babylonAnimationGroup=C;const E=new Array;k.Assign(z.channels),k.Assign(z.samplers);for(const F of z.channels)E.push(this._loadAnimationChannelAsync(`${f}/channels/${F.index}`,f,z,F,((f,z)=>{f.animations=f.animations||[],f.animations.push(z),C.addTargetedAnimation(z,f)})));return Promise.all(E).then((()=>(C.normalize(0),C)))}))}_loadAnimationChannelAsync(f,z,w,S,C){const E=this._extensionsLoadAnimationChannelAsync(f,z,w,S,C);if(E)return E;if(void 0==S.target.node)return Promise.resolve();const F=k.Get(`${f}/target/node`,this._gltf.nodes,S.target.node),J=S.target.path,x="weights"===J;if(x&&!F._numMorphTargets||!x&&!F._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!x&&!F._isJoint)return Promise.resolve();let u;switch(J){case"translation":u=Y.translation;break;case"rotation":u=Y.rotation;break;case"scale":u=Y.scale;break;case"weights":u=Y.weights;break;default:throw new Error(`${f}/target/path: Invalid value (${S.target.path})`)}const h={object:F,info:u};return this._loadAnimationChannelFromTargetInfoAsync(f,z,w,S,h,C)}_loadAnimationChannelFromTargetInfoAsync(f,z,w,S,C,E){const F=this.parent.targetFps,J=1/F,x=k.Get(`${f}/sampler`,w.samplers,S.sampler);return this._loadAnimationSamplerAsync(`${z}/samplers/${S.sampler}`,x).then((f=>{let z=0;const x=C.object,u=C.info;for(const C of u){const u=C.getStride(x),h=f.input,X=f.output,K=new Array(h.length);let c=0;switch(f.interpolation){case"STEP":for(let f=0;f<h.length;f++){const z=C.getValue(x,X,c,1);c+=u,K[f]={frame:h[f]*F,value:z,interpolation:1}}break;case"CUBICSPLINE":for(let f=0;f<h.length;f++){const z=C.getValue(x,X,c,J);c+=u;const w=C.getValue(x,X,c,1);c+=u;const S=C.getValue(x,X,c,J);c+=u,K[f]={frame:h[f]*F,inTangent:z,value:w,outTangent:S}}break;case"LINEAR":for(let f=0;f<h.length;f++){const z=C.getValue(x,X,c,1);c+=u,K[f]={frame:h[f]*F,value:z}}}if(c>0){const f=`${w.name||`animation${w.index}`}_channel${S.index}_${z}`;C.buildAnimations(x,f,F,K,((f,w)=>{++z,E(f,w)}))}}}))}_loadAnimationSamplerAsync(f,z){if(z._data)return z._data;const w=z.interpolation||"LINEAR";switch(w){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${f}/interpolation: Invalid value (${z.interpolation})`)}const S=k.Get(`${f}/input`,this._gltf.accessors,z.input),C=k.Get(`${f}/output`,this._gltf.accessors,z.output);return z._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${S.index}`,S),this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)]).then((f=>{let[z,S]=f;return{input:z,interpolation:w,output:S}})),z._data}loadBufferAsync(f,z,w,S){const C=this._extensionsLoadBufferAsync(f,z,w,S);if(C)return C;if(!z._data)if(z.uri)z._data=this.loadUriAsync(`${f}/uri`,z,z.uri);else{if(!this._bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);z._data=this._bin.readAsync(0,z.byteLength)}return z._data.then((z=>{try{return new Uint8Array(z.buffer,z.byteOffset+w,S)}catch(C){throw new Error(`${f}: ${C.message}`)}}))}loadBufferViewAsync(f,z){const w=this._extensionsLoadBufferViewAsync(f,z);if(w)return w;if(z._data)return z._data;const S=k.Get(`${f}/buffer`,this._gltf.buffers,z.buffer);return z._data=this.loadBufferAsync(`/buffers/${S.index}`,S,z.byteOffset||0,z.byteLength),z._data}_loadAccessorAsync(f,z,w){if(z._data)return z._data;const S=j._GetNumComponents(f,z.type),C=S*n.f.GetTypeByteLength(z.componentType),E=S*z.count;if(void 0==z.bufferView)z._data=Promise.resolve(new w(E));else{const F=k.Get(`${f}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((J=>{if(5126!==z.componentType||z.normalized||F.byteStride&&F.byteStride!==C){const f=new w(E);return n.f.ForEach(J,z.byteOffset||0,F.byteStride||C,S,z.componentType,f.length,z.normalized||!1,((z,w)=>{f[w]=z})),f}return j._GetTypedArray(f,z.componentType,J,z.byteOffset,E)}))}if(z.sparse){const E=z.sparse;z._data=z._data.then((F=>{const J=F,x=k.Get(`${f}/sparse/indices/bufferView`,this._gltf.bufferViews,E.indices.bufferView),u=k.Get(`${f}/sparse/values/bufferView`,this._gltf.bufferViews,E.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${x.index}`,x),this.loadBufferViewAsync(`/bufferViews/${u.index}`,u)]).then((F=>{let[x,u]=F;const h=j._GetTypedArray(`${f}/sparse/indices`,E.indices.componentType,x,E.indices.byteOffset,E.count),X=S*E.count;let K;if(5126!==z.componentType||z.normalized){const F=j._GetTypedArray(`${f}/sparse/values`,z.componentType,u,E.values.byteOffset,X);K=new w(X),n.f.ForEach(F,0,C,S,z.componentType,K.length,z.normalized||!1,((f,z)=>{K[z]=f}))}else K=j._GetTypedArray(`${f}/sparse/values`,z.componentType,u,E.values.byteOffset,X);let c=0;for(let f=0;f<h.length;f++){let z=h[f]*S;for(let f=0;f<S;f++)J[z++]=K[c++]}return J}))}))}return z._data}_loadFloatAccessorAsync(f,z){return this._loadAccessorAsync(f,z,Float32Array)}_loadIndicesAccessorAsync(f,z){if("SCALAR"!==z.type)throw new Error(`${f}/type: Invalid value ${z.type}`);if(5121!==z.componentType&&5123!==z.componentType&&5125!==z.componentType)throw new Error(`${f}/componentType: Invalid value ${z.componentType}`);if(z._data)return z._data;if(z.sparse){const w=j._GetTypedArrayConstructor(`${f}/componentType`,z.componentType);z._data=this._loadAccessorAsync(f,z,w)}else{const w=k.Get(`${f}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((w=>j._GetTypedArray(f,z.componentType,w,z.byteOffset,z.count)))}return z._data}_loadVertexBufferViewAsync(f){if(f._babylonBuffer)return f._babylonBuffer;const z=this._babylonScene.getEngine();return f._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((f=>new n.b(z,f,!1))),f._babylonBuffer}_loadVertexAccessorAsync(f,z,w){var S;if(null!==(S=z._babylonVertexBuffer)&&void 0!==S&&S[w])return z._babylonVertexBuffer[w];z._babylonVertexBuffer||(z._babylonVertexBuffer={});const C=this._babylonScene.getEngine();if(z.sparse||void 0==z.bufferView)z._babylonVertexBuffer[w]=this._loadFloatAccessorAsync(f,z).then((f=>new n.f(C,f,w,!1)));else{const S=k.Get(`${f}/bufferView`,this._gltf.bufferViews,z.bufferView);z._babylonVertexBuffer[w]=this._loadVertexBufferViewAsync(S).then((E=>{const F=j._GetNumComponents(f,z.type);return new n.f(C,E,w,!1,void 0,S.byteStride,void 0,z.byteOffset,F,z.componentType,z.normalized,!0,void 0,!0)}))}return z._babylonVertexBuffer[w]}_loadMaterialMetallicRoughnessPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return z&&(z.baseColorFactor?(w.albedoColor=E.d.ck(z.baseColorFactor),w.alpha=z.baseColorFactor[3]):w.albedoColor=E.d.White(),w.metallic=void 0==z.metallicFactor?1:z.metallicFactor,w.roughness=void 0==z.roughnessFactor?1:z.roughnessFactor,z.baseColorTexture&&S.push(this.loadTextureInfoAsync(`${f}/baseColorTexture`,z.baseColorTexture,(f=>{f.name=`${w.name} (Base Color)`,w.albedoTexture=f}))),z.metallicRoughnessTexture&&(z.metallicRoughnessTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${f}/metallicRoughnessTexture`,z.metallicRoughnessTexture,(f=>{f.name=`${w.name} (Metallic Roughness)`,w.metallicTexture=f}))),w.useMetallnessFromMetallicTextureBlue=!0,w.useRoughnessFromMetallicTextureGreen=!0,w.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(S).then((()=>{}))}_loadMaterialAsync(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const E=this._extensionsLoadMaterialAsync(f,z,w,S,C);if(E)return E;z._data=z._data||{};let F=z._data[S];if(!F){this.logOpen(`${f} ${z.name||""}`);const w=this.createMaterial(f,z,S);F={babylonMaterial:w,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(f,z,w)},z._data[S]=F,j.AddPointerMetadata(w,f),this._parent.onMaterialLoadedObservable.notifyObservers(w),this.logClose()}return w&&(F.babylonMeshes.push(w),w.ik.addOnce((()=>{const f=F.babylonMeshes.indexOf(w);-1!==f&&F.babylonMeshes.splice(f,1)}))),C(F.babylonMaterial),F.promise.then((()=>F.babylonMaterial))}_createDefaultMaterial(f,z){this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new M(f,this._babylonScene);return w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.fillMode=z,w.enableSpecularAntiAliasing=!0,w.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,w.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,w.transparencyMode=M.PBRMATERIAL_OPAQUE,w.metallic=1,w.roughness=1,w}createMaterial(f,z,w){const S=this._extensionsCreateMaterial(f,z,w);if(S)return S;const C=z.name||`material${z.index}`;return this._createDefaultMaterial(C,w)}loadMaterialPropertiesAsync(f,z,w){const S=this._extensionsLoadMaterialPropertiesAsync(f,z,w);if(S)return S;const C=new Array;return C.push(this.loadMaterialBasePropertiesAsync(f,z,w)),z.pbrMetallicRoughness&&C.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${f}/pbrMetallicRoughness`,z.pbrMetallicRoughness,w)),this.loadMaterialAlphaProperties(f,z,w),Promise.all(C).then((()=>{}))}loadMaterialBasePropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.emissiveColor=z.emissiveFactor?E.d.ck(z.emissiveFactor):new E.d(0,0,0),z.doubleSided&&(w.mk=!1,w.twoSidedLighting=!0),z.normalTexture&&(z.normalTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${f}/normalTexture`,z.normalTexture,(f=>{f.name=`${w.name} (Normal)`,w.bumpTexture=f}))),w.invertNormalMapX=!this._babylonScene.useRightHandedSystem,w.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=z.normalTexture.scale&&w.bumpTexture&&(w.bumpTexture.level=z.normalTexture.scale),w.forceIrradianceInFragment=!0),z.occlusionTexture&&(z.occlusionTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync(`${f}/occlusionTexture`,z.occlusionTexture,(f=>{f.name=`${w.name} (Occlusion)`,w.ambientTexture=f}))),w.useAmbientInGrayScale=!0,void 0!=z.occlusionTexture.strength&&(w.ambientTextureStrength=z.occlusionTexture.strength)),z.emissiveTexture&&S.push(this.loadTextureInfoAsync(`${f}/emissiveTexture`,z.emissiveTexture,(f=>{f.name=`${w.name} (Emissive)`,w.emissiveTexture=f}))),Promise.all(S).then((()=>{}))}loadMaterialAlphaProperties(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);switch(z.alphaMode||"OPAQUE"){case"OPAQUE":w.transparencyMode=M.PBRMATERIAL_OPAQUE,w.alpha=1;break;case"MASK":w.transparencyMode=M.PBRMATERIAL_ALPHATEST,w.alphaCutOff=void 0==z.alphaCutoff?.5:z.alphaCutoff,w.albedoTexture&&(w.albedoTexture.xi=!0);break;case"BLEND":w.transparencyMode=M.PBRMATERIAL_ALPHABLEND,w.albedoTexture&&(w.albedoTexture.xi=!0,w.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${f}/alphaMode: Invalid value (${z.alphaMode})`)}}loadTextureInfoAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureInfoAsync(f,z,w);if(S)return S;if(this.logOpen(`${f}`),z.texCoord>=6)throw new Error(`${f}/texCoord: Invalid value (${z.texCoord})`);const C=k.Get(`${f}/index`,this._gltf.textures,z.index);C._textureInfo=z;const E=this._loadTextureAsync(`/textures/${z.index}`,C,(S=>{S.coordinatesIndex=z.texCoord||0,j.AddPointerMetadata(S,f),this._parent.onTextureLoadedObservable.notifyObservers(S),w(S)}));return this.logClose(),E}_loadTextureAsync(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureAsync(f,z,w);if(S)return S;this.logOpen(`${f} ${z.name||""}`);const C=void 0==z.sampler?j.DefaultSampler:k.Get(`${f}/sampler`,this._gltf.samplers,z.sampler),E=k.Get(`${f}/source`,this._gltf.images,z.source),F=this._createTextureAsync(f,C,E,w,void 0,!z._textureInfo.nonColorData);return this.logClose(),F}_createTextureAsync(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},E=arguments.length>4?arguments[4]:void 0,F=arguments.length>5?arguments[5]:void 0;const J=this._loadSampler(`/samplers/${z.index}`,z),x=new Array,u=new S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:J.noMipMaps,invertY:!1,samplingMode:J.samplingMode,X:()=>{this._disposed||u.resolve()},onError:(z,w)=>{this._disposed||u.reject(new Error(`${f}: ${w&&w.message?w.message:z||"Failed to load texture"}`))},mimeType:w.mimeType,loaderOptions:E,useSRGBBuffer:!!F&&this._parent.useSRGBBuffers},X=new G.b(null,this._babylonScene,h);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.push(u.promise),x.push(this.loadImageAsync(`/images/${w.index}`,w).then((f=>{const z=w.uri||`${this._fileName}#image${w.index}`,S=`data:${this._uniqueRootUrl}${z}`;X.updateURL(S,f);const C=X.getInternalTexture();C&&(C.label=w.name)}))),X.wrapU=J.wrapU,X.wrapV=J.wrapV,C(X),this._parent.useGltfTextureNames&&(X.name=w.name||w.uri||`image${w.index}`),Promise.all(x).then((()=>X))}_loadSampler(f,z){return z._data||(z._data={noMipMaps:9728===z.minFilter||9729===z.minFilter,samplingMode:j._GetTextureSamplingMode(f,z),wrapU:j._GetTextureWrapMode(`${f}/wrapS`,z.wrapS),wrapV:j._GetTextureWrapMode(`${f}/wrapT`,z.wrapT)}),z._data}loadImageAsync(f,z){if(!z._data){if(this.logOpen(`${f} ${z.name||""}`),z.uri)z._data=this.loadUriAsync(`${f}/uri`,z,z.uri);else{const w=k.Get(`${f}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w)}this.logClose()}return z._data}loadUriAsync(f,z,w){const S=this._extensionsLoadUriAsync(f,z,w);if(S)return S;if(!j._ValidateUri(w))throw new Error(`${f}: '${w}' is invalid`);if((0,i.h)(w)){const z=new Uint8Array((0,i.b)(w));return this.log(`${f}: Decoded ${w.substring(0,64)}... (${z.length} bytes)`),Promise.resolve(z)}return this.log(`${f}: Loading ${w}`),this._parent.preprocessUrlAsync(this._rootUrl+w).then((z=>new Promise(((S,C)=>{this._parent._loadFile(this._babylonScene,z,(z=>{this._disposed||(this.log(`${f}: Loaded ${w} (${z.byteLength} bytes)`),S(new Uint8Array(z)))}),!0,(z=>{C(new i.l(`${f}: Failed to load '${w}'${z?": "+z.status+" "+z.statusText:""}`,z))}))}))))}static AddPointerMetadata(f,z){f.metadata=f.metadata||{};const w=f._internalMetadata=f._internalMetadata||{},S=w.tl=w.tl||{};(S.pointers=S.pointers||[]).push(z)}static _GetTextureWrapMode(f,z){switch(z=void 0==z?10497:z){case 33071:return G.b.CLAMP_ADDRESSMODE;case 33648:return G.b.MIRROR_ADDRESSMODE;case 10497:return G.b.WRAP_ADDRESSMODE;default:return e.b.Warn(`${f}: Invalid value (${z})`),G.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(f,z){const w=void 0==z.magFilter?9729:z.magFilter,S=void 0==z.minFilter?9987:z.minFilter;if(9729===w)switch(S){case 9728:return G.b.LINEAR_NEAREST;case 9729:return G.b.LINEAR_LINEAR;case 9984:return G.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return G.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return G.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return G.b.LINEAR_LINEAR_MIPLINEAR;default:return e.b.Warn(`${f}/minFilter: Invalid value (${S})`),G.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==w&&e.b.Warn(`${f}/magFilter: Invalid value (${w})`),S){case 9728:return G.b.NEAREST_NEAREST;case 9729:return G.b.NEAREST_LINEAR;case 9984:return G.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return G.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return G.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return G.b.NEAREST_LINEAR_MIPLINEAR;default:return e.b.Warn(`${f}/minFilter: Invalid value (${S})`),G.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(f,z){switch(z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${f}: Invalid component type ${z}`)}}static _GetTypedArray(f,z,w,S,C){const E=w.buffer;S=w.byteOffset+(S||0);const F=j._GetTypedArrayConstructor(`${f}/componentType`,z),J=n.f.GetTypeByteLength(z);return S%J!==0?(e.b.Warn(`${f}: Copying buffer as byte offset (${S}) is not a multiple of component type byte length (${J})`),new F(E.slice(S,S+C*J),0)):new F(E,S,C)}static _GetNumComponents(f,z){switch(z){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${f}: Invalid type (${z})`)}static _ValidateUri(f){return F.h.IsBase64(f)||-1===f.indexOf("..")}static _GetDrawMode(f,z){switch(void 0==z&&(z=4),z){case 0:return B.e.PointListDrawMode;case 1:return B.e.LineListDrawMode;case 2:return B.e.LineLoopDrawMode;case 3:return B.e.LineStripDrawMode;case 4:return B.e.TriangleFillMode;case 5:return B.e.TriangleStripDrawMode;case 6:return B.e.TriangleFanDrawMode}throw new Error(`${f}: Invalid mesh primitive mode (${z})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const f=new Array;if(this._gltf.materials)for(const z of this._gltf.materials)if(z._data)for(const w in z._data){const S=z._data[w];for(const z of S.babylonMeshes){z.bk(!0);const w=S.babylonMaterial;f.push(w.forceCompilationAsync(z)),f.push(w.forceCompilationAsync(z,{useInstances:!0})),this._parent.useClipPlane&&(f.push(w.forceCompilationAsync(z,{clipPlane:!0})),f.push(w.forceCompilationAsync(z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const f=new Array,z=this._babylonScene.lights;for(const w of z){const z=w.getShadowGenerator();z&&f.push(z.forceCompilationAsync())}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(f){for(const z of this._extensions)z.enabled&&f(z)}_applyExtensions(f,z,w){for(const S of this._extensions)if(S.enabled){const C=`${S.name}.${z}`,E=f;E._activeLoaderExtensionFunctions=E._activeLoaderExtensionFunctions||{};const F=E._activeLoaderExtensionFunctions;if(!F[C]){F[C]=!0;try{const f=w(S);if(f)return f}finally{delete F[C]}}}return null}_extensionsOnLoading(){this._forEachExtensions((f=>f.onLoading&&f.onLoading()))}_extensionsOnReady(){this._forEachExtensions((f=>f.onReady&&f.onReady()))}_extensionsLoadSceneAsync(f,z){return this._applyExtensions(z,"loadScene",(w=>w.loadSceneAsync&&w.loadSceneAsync(f,z)))}_extensionsLoadNodeAsync(f,z,w){return this._applyExtensions(z,"loadNode",(S=>S.loadNodeAsync&&S.loadNodeAsync(f,z,w)))}_extensionsLoadCameraAsync(f,z,w){return this._applyExtensions(z,"loadCamera",(S=>S.loadCameraAsync&&S.loadCameraAsync(f,z,w)))}_extensionsLoadVertexDataAsync(f,z,w){return this._applyExtensions(z,"loadVertexData",(S=>S._loadVertexDataAsync&&S._loadVertexDataAsync(f,z,w)))}_extensionsLoadMeshPrimitiveAsync(f,z,w,S,C,E){return this._applyExtensions(C,"loadMeshPrimitive",(F=>F._loadMeshPrimitiveAsync&&F._loadMeshPrimitiveAsync(f,z,w,S,C,E)))}_extensionsLoadMaterialAsync(f,z,w,S,C){return this._applyExtensions(z,"loadMaterial",(E=>E._loadMaterialAsync&&E._loadMaterialAsync(f,z,w,S,C)))}_extensionsCreateMaterial(f,z,w){return this._applyExtensions(z,"createMaterial",(S=>S.createMaterial&&S.createMaterial(f,z,w)))}_extensionsLoadMaterialPropertiesAsync(f,z,w){return this._applyExtensions(z,"loadMaterialProperties",(S=>S.loadMaterialPropertiesAsync&&S.loadMaterialPropertiesAsync(f,z,w)))}_extensionsLoadTextureInfoAsync(f,z,w){return this._applyExtensions(z,"loadTextureInfo",(S=>S.loadTextureInfoAsync&&S.loadTextureInfoAsync(f,z,w)))}_extensionsLoadTextureAsync(f,z,w){return this._applyExtensions(z,"loadTexture",(S=>S._loadTextureAsync&&S._loadTextureAsync(f,z,w)))}_extensionsLoadAnimationAsync(f,z){return this._applyExtensions(z,"loadAnimation",(w=>w.loadAnimationAsync&&w.loadAnimationAsync(f,z)))}_extensionsLoadAnimationChannelAsync(f,z,w,S,C){return this._applyExtensions(w,"loadAnimationChannel",(E=>E._loadAnimationChannelAsync&&E._loadAnimationChannelAsync(f,z,w,S,C)))}_extensionsLoadSkinAsync(f,z,w){return this._applyExtensions(w,"loadSkin",(S=>S._loadSkinAsync&&S._loadSkinAsync(f,z,w)))}_extensionsLoadUriAsync(f,z,w){return this._applyExtensions(z,"loadUri",(S=>S._loadUriAsync&&S._loadUriAsync(f,z,w)))}_extensionsLoadBufferViewAsync(f,z){return this._applyExtensions(z,"loadBufferView",(w=>w.loadBufferViewAsync&&w.loadBufferViewAsync(f,z)))}_extensionsLoadBufferAsync(f,z,w,S){return this._applyExtensions(z,"loadBuffer",(C=>C.loadBufferAsync&&C.loadBufferAsync(f,z,w,S)))}static LoadExtensionAsync(f,z,w,S){if(!z.extensions)return null;const C=z.extensions[w];return C?S(`${f}/extensions/${w}`,C):null}static LoadExtraAsync(f,z,w,S){if(!z.extras)return null;const C=z.extras[w];return C?S(`${f}/extras/${w}`,C):null}isExtensionUsed(f){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(f)}logOpen(f){this._parent._logOpen(f)}logClose(){this._parent._logClose()}log(f){this._parent._log(f)}startPerformanceCounter(f){this._parent._startPerformanceCounter(f)}endPerformanceCounter(f){this._parent._endPerformanceCounter(f)}}j.DefaultSampler={index:-1},U.d._CreateGLTF2Loader=f=>new j(f);var l=w(2292),N=w(2377),ff=w(12697);class zf extends ff.b{constructor(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",f),this._texture=f.getEngine().createRawCubeTexture(z,w,S,C,E,F,J,x)}update(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,f,z,w,S,C)}updateRGBDAsync(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,N.o)(this._texture,f,z,w,S).then((()=>{}))}clone(){return A.b.Clone((()=>{const f=this.va(),z=this._texture,w=new zf(f,z._bufferViewArray,z.width,z.format,z.type,z.generateMipMaps,z.invertY,z.samplingMode,z._compression);return 13===z.source&&w.updateRGBDAsync(z._bufferViewArrayArray,z._sphericalPolynomial,z._lodGenerationScale,z._lodGenerationOffset),w}),this)}}const wf="EXT_lights_image_based";class Sf{constructor(f){this.name=wf,this._loader=f,this.enabled=this._loader.isExtensionUsed(wf)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.tl.extensions;if(f&&f[this.name]){const z=f[this.name];this._lights=z.lights}}loadSceneAsync(f,z){return j.LoadExtensionAsync(f,z,this.name,((w,S)=>{this._loader._allMaterialsDirtyRequired=!0;const C=new Array;C.push(this._loader.loadSceneAsync(f,z)),this._loader.logOpen(`${w}`);const E=k.Get(`${w}/light`,this._lights,S.ab);return C.push(this._loadLightAsync(`/extensions/${this.name}/lights/${S.ab}`,E).then((f=>{this._loader.babylonScene.environmentTexture=f}))),this._loader.logClose(),Promise.all(C).then((()=>{}))}))}_loadLightAsync(f,z){if(!z._loaded){const w=new Array;this._loader.logOpen(`${f}`);const S=new Array(z.specularImages.length);for(let C=0;C<z.specularImages.length;C++){const E=z.specularImages[C];S[C]=new Array(E.length);for(let z=0;z<E.length;z++){const F=`${f}/specularImages/${C}/${z}`;this._loader.logOpen(`${F}`);const J=E[z],x=k.Get(F,this._loader.tl.images,J);w.push(this._loader.loadImageAsync(`/images/${J}`,x).then((f=>{S[C][z]=f}))),this._loader.logClose()}}this._loader.logClose(),z._loaded=Promise.all(w).then((()=>{const w=new zf(this._loader.babylonScene,null,z.specularImageSize);if(w.name=z.name||"environment",z._babylonTexture=w,void 0!=z.Dl&&(w.level=z.Dl),z.rotation){let f=C.f.ck(z.rotation);this._loader.babylonScene.useRightHandedSystem||(f=C.f.Inverse(f)),C.b.FromQuaternionToRef(f,w.getReflectionTextureMatrix())}if(!z.irradianceCoefficients)throw new Error(`${f}: Irradiance coefficients are missing`);const E=l.d.ck(z.irradianceCoefficients);E.scaleInPlace(z.Dl),E.convertIrradianceToLambertianRadiance();const F=l.e.FromHarmonics(E),J=(S.length-1)/Math.log2(z.specularImageSize);return w.updateRGBDAsync(S,F,J)}))}return z._loaded.then((()=>z._babylonTexture))}}Q(wf),b(wf,!0,(f=>new Sf(f)));w(920);const Cf="EXT_mesh_gpu_instancing";class Ef{constructor(f){this.name=Cf,this._loader=f,this.enabled=this._loader.isExtensionUsed(Cf)}dispose(){this._loader=null}loadNodeAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((f,S)=>{this._loader._disableInstancedMesh++;const E=this._loader.loadNodeAsync(`/nodes/${z.index}`,z,w);if(this._loader._disableInstancedMesh--,!z._primitiveBabylonMeshes)return E;const F=new Array;let J=0;const x=z=>{if(void 0==S.attributes[z])return void F.push(Promise.resolve(null));const w=k.Get(`${f}/attributes/${z}`,this._loader.tl.accessors,S.attributes[z]);if(F.push(this._loader._loadFloatAccessorAsync(`/accessors/${w.bufferView}`,w)),0===J)J=w.count;else if(J!==w.count)throw new Error(`${f}/attributes: Instance buffer accessors do not have the same count.`)};return x("TRANSLATION"),x("ROTATION"),x("SCALE"),E.then((f=>Promise.all(F).then((w=>{let[S,E,F]=w;const x=new Float32Array(16*J);C.j.ek[0].Gd(0,0,0),C.j.Quaternion[0].Gd(0,0,0,1),C.j.ek[1].Gd(1,1,1);for(let f=0;f<J;++f)S&&C.n.FromArrayToRef(S,3*f,C.j.ek[0]),E&&C.f.FromArrayToRef(E,4*f,C.j.Quaternion[0]),F&&C.n.FromArrayToRef(F,3*f,C.j.ek[1]),C.b.ComposeToRef(C.j.ek[1],C.j.Quaternion[0],C.j.ek[0],C.j.Matrix[0]),C.j.Matrix[0].copyToArray(x,16*f);for(const f of z._primitiveBabylonMeshes)f.Hb("matrix",x,16,!0);return f}))))}))}}Q(Cf),b(Cf,!0,(f=>new Ef(f)));class Ff{static get Default(){return Ff._Default||(Ff._Default=new Ff),Ff._Default}constructor(){const f=Ff.Configuration.decoder;this._decoderModulePromise=F.h.LoadBabylonScriptAsync(f.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(f,z,w,S,C){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const E=await MeshoptDecoder.decodeGltfBufferAsync(z,w,f,S,C);return MeshoptDecoder.useWorkers(0),E}))}}Ff.Configuration={decoder:{url:`${F.h._DefaultCdnUrl}/meshopt_decoder.js`}},Ff._Default=null;const Jf="EXT_meshopt_compression";class xf{constructor(f){this.name=Jf,this.enabled=f.isExtensionUsed(Jf),this._loader=f}dispose(){this._loader=null}loadBufferViewAsync(f,z){return j.LoadExtensionAsync(f,z,this.name,((w,S)=>{const C=z;if(C._meshOptData)return C._meshOptData;const E=k.Get(`${f}/buffer`,this._loader.tl.buffers,S.buffer);return C._meshOptData=this._loader.loadBufferAsync(`/buffers/${E.index}`,E,S.byteOffset||0,S.byteLength).then((f=>Ff.Default.decodeGltfBufferAsync(f,S.count,S.byteStride,S.mode,S.filter))),C._meshOptData}))}}Q(Jf),b(Jf,!0,(f=>new xf(f)));const uf="EXT_texture_webp";class hf{constructor(f){this.name=uf,this._loader=f,this.enabled=f.isExtensionUsed(uf)}dispose(){this._loader=null}_loadTextureAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=void 0==z.sampler?j.DefaultSampler:k.Get(`${f}/sampler`,this._loader.tl.samplers,z.sampler),F=k.Get(`${S}/source`,this._loader.tl.images,C.source);return this._loader._createTextureAsync(f,E,F,(f=>{w(f)}),void 0,!z._textureInfo.nonColorData)}))}}Q(uf),b(uf,!0,(f=>new hf(f)));const Xf="EXT_texture_avif";class Kf{constructor(f){this.name=Xf,this._loader=f,this.enabled=f.isExtensionUsed(Xf)}dispose(){this._loader=null}_loadTextureAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=void 0==z.sampler?j.DefaultSampler:k.Get(`${f}/sampler`,this._loader.tl.samplers,z.sampler),F=k.Get(`${S}/source`,this._loader.tl.images,C.source);return this._loader._createTextureAsync(f,E,F,(f=>{w(f)}),void 0,!z._textureInfo.nonColorData)}))}}Q(Xf),b(Xf,!0,(f=>new Kf(f)));var cf=w(12706);const yf="KHR_draco_mesh_compression";class ef{constructor(f){this.name=yf,this.useNormalizedFlagFromAccessor=!0,this._loader=f,this.enabled=cf.e.DecoderAvailable&&this._loader.isExtensionUsed(yf)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{if(void 0!=z.mode&&4!==z.mode&&5!==z.mode)throw new Error(`${f}: Unsupported mode ${z.mode}`);const E={},F={},J=(f,S)=>{const J=C.attributes[f];if(void 0!=J&&(w._delayInfo=w._delayInfo||[],-1===w._delayInfo.indexOf(S)&&w._delayInfo.push(S),E[S]=J,this.useNormalizedFlagFromAccessor)){const w=k.TryGet(this._loader.tl.accessors,z.attributes[f]);w&&(F[S]=w.normalized||!1)}};J("POSITION",n.f.PositionKind),J("NORMAL",n.f.NormalKind),J("TANGENT",n.f.TangentKind),J("TEXCOORD_0",n.f.UVKind),J("TEXCOORD_1",n.f.UV2Kind),J("TEXCOORD_2",n.f.UV3Kind),J("TEXCOORD_3",n.f.UV4Kind),J("TEXCOORD_4",n.f.UV5Kind),J("TEXCOORD_5",n.f.UV6Kind),J("JOINTS_0",n.f.MatricesIndicesKind),J("WEIGHTS_0",n.f.MatricesWeightsKind),J("COLOR_0",n.f.ColorKind);const x=k.Get(S,this._loader.tl.bufferViews,C.bufferView);return x._dracoBabylonGeometry||(x._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((z=>(this.dracoCompression||cf.e.Default)._decodeMeshToGeometryForGltfAsync(w.name,this._loader.babylonScene,z,E,F).catch((z=>{throw new Error(`${f}: ${z.message}`)}))))),x._dracoBabylonGeometry}))}}Q(yf),b(yf,!0,(f=>new ef(f)));var Of=w(12713),df=w(749),Bf=w(12686),Vf=w(12722);df.e.AddNodeConstructor("Light_Type_0",((f,z)=>()=>new Wf(f,C.n.Zero(),z)));class Wf extends Vf.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(f){this._shadowAngle=f,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(f){const z=this.needCube();if(this._direction=f,this.needCube()!==z&&this._shadowGenerators){const f=this._shadowGenerators.values();for(let z=f.next();!0!==z.done;z=f.next()){z.value.recreateShadowMap()}}}constructor(f,z,w){super(f,w),this._shadowAngle=Math.PI/2,this.position=z}getClassName(){return"PointLight"}getTypeID(){return Bf.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(f){if(this.direction)return super.getShadowDirection(f);switch(f){case 0:return new C.n(1,0,0);case 1:return new C.n(-1,0,0);case 2:return new C.n(0,-1,0);case 3:return new C.n(0,1,0);case 4:return new C.n(0,0,1);case 5:return new C.n(0,0,-1)}return C.n.Zero()}_setDefaultShadowProjectionMatrix(f,z,w){const S=this.va().activeCamera;if(!S)return;const E=void 0!==this.shadowMinZ?this.shadowMinZ:S.Zj,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,J=this.va().getEngine().useReverseDepthBuffer;C.b.PerspectiveFovLHToRef(this.shadowAngle,1,J?F:E,J?E:F,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,z){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,z):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,z),this}transferToNodeMaterialEffect(f,z){return this.computeTransformedInformation()?f.setFloat3(z,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):f.setFloat3(z,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(f,z){f["POINTLIGHT"+z]=!0}}(0,V.b)([(0,W.O)()],Wf.prototype,"shadowAngle",null),(0,D.f)("BABYLON.PointLight",Wf),df.e.AddNodeConstructor("Light_Type_2",((f,z)=>()=>new Tf(f,C.n.Zero(),C.n.Zero(),0,0,z)));class Tf extends Vf.e{get angle(){return this._angle}set angle(f){this._angle=f,this._cosHalfAngle=Math.cos(.5*f),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(f){this._innerAngle=f,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(f){this._shadowAngleScale=f,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(f){this._projectionTextureLightNear=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(f){this._projectionTextureLightFar=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(f){this._projectionTextureUpDirection=f,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(f){this._projectionTexture!==f&&(this._projectionTexture=f,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Tf._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Tf._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(f){return void 0!==f.onGeneratedObservable}static _IsTexture(f){return void 0!==f.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(f){this._projectionTextureProjectionLightMatrix=f,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(f,z,w,S,E,F){super(f,F),this._innerAngle=0,this._projectionTextureMatrix=C.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.n.Zero(),this._projectionTextureViewLightMatrix=C.b.Zero(),this._projectionTextureProjectionLightMatrix=C.b.Zero(),this._projectionTextureScalingMatrix=C.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=z,this.direction=w,this.angle=S,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return Bf.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(f){super._setDirection(f),this._projectionTextureViewLightDirty=!0}_setPosition(f){super._setPosition(f),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(f,z,w){const S=this.va().activeCamera;if(!S)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,F=void 0!==this.shadowMinZ?this.shadowMinZ:S.Zj,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,x=this.va().getEngine().useReverseDepthBuffer;C.b.PerspectiveFovLHToRef(E,1,x?J:F,x?F:J,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,x)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const f=this.projectionTextureLightFar,z=this.projectionTextureLightNear,w=f/(f-z),S=-w*z,E=1/Math.tan(this._angle/2);C.b.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,w,1,0,0,S,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof G.b){const f=this._projectionTexture.uScale/2,z=this._projectionTexture.vScale/2;C.b.FromValuesToRef(f,0,0,0,0,z,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(f,z){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),f.setMatrix("textureProjectionMatrix"+z,this._projectionTextureMatrix),f.setTexture("projectionLightTexture"+z,this.projectionTexture)),this}transferToEffect(f,z){let w;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,z),w=C.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,z),w=C.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",w.x,w.y,w.z,this._cosHalfAngle,z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,z),this}transferToNodeMaterialEffect(f,z){let w;return w=this.computeTransformedInformation()?C.n.Normalize(this.transformedDirection):C.n.Normalize(this.direction),this.va().useRightHandedSystem?f.setFloat3(z,-w.x,-w.y,-w.z):f.setFloat3(z,w.x,w.y,w.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(f){const z=this._scene.getEngine(),w=void 0!==this.shadowMinZ?this.shadowMinZ:f.Zj;return z.useReverseDepthBuffer&&z.isNDCHalfZRange?w:this._scene.getEngine().isNDCHalfZRange?0:w}getDepthMaxZ(f){const z=this._scene.getEngine(),w=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ;return z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:w}prepareLightSpecificDefines(f,z){f["SPOTLIGHT"+z]=!0,f["PROJECTEDLIGHTTEXTURE"+z]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,V.b)([(0,W.O)()],Tf.prototype,"angle",null),(0,V.b)([(0,W.O)()],Tf.prototype,"innerAngle",null),(0,V.b)([(0,W.O)()],Tf.prototype,"shadowAngleScale",null),(0,V.b)([(0,W.O)()],Tf.prototype,"exponent",void 0),(0,V.b)([(0,W.O)()],Tf.prototype,"projectionTextureLightNear",null),(0,V.b)([(0,W.O)()],Tf.prototype,"projectionTextureLightFar",null),(0,V.b)([(0,W.O)()],Tf.prototype,"projectionTextureUpDirection",null),(0,V.b)([(0,W.H)("projectedLightTexture")],Tf.prototype,"_projectionTexture",void 0),(0,D.f)("BABYLON.SpotLight",Tf);const vf="KHR_lights_punctual";class Df{constructor(f){this.name=vf,this._loader=f,this.enabled=this._loader.isExtensionUsed(vf)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.tl.extensions;if(f&&f[this.name]){const z=f[this.name];this._lights=z.lights,k.Assign(this._lights)}}loadNodeAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,F)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(f,z,(f=>{let z;const J=k.Get(S,this._lights,F.ab),x=J.name||f.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J.type){case"directional":{const f=new Of.b(x,C.n.Backward(),this._loader.babylonScene);f.position.Ed(0),z=f;break}case"point":z=new Wf(x,C.n.Zero(),this._loader.babylonScene);break;case"spot":{const f=new Tf(x,C.n.Zero(),C.n.Backward(),0,1,this._loader.babylonScene);f.angle=2*(J.spot&&J.spot.outerConeAngle||Math.PI/4),f.innerAngle=2*(J.spot&&J.spot.innerConeAngle||0),z=f;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${S}: Invalid light type (${J.type})`)}z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=z,z.falloffType=Bf.b.FALLOFF_GLTF,z.rh=J.color?E.d.ck(J.color):E.d.White(),z.Dl=void 0==J.Dl?1:J.Dl,z.range=void 0==J.range?Number.MAX_VALUE:J.range,z.parent=f,this._loader._babylonLights.push(z),j.AddPointerMetadata(z,S),w(f)})))))}}Q(vf),b(vf,!0,(f=>new Df(f)));const Af="KHR_materials_pbrSpecularGlossiness";class Mf{constructor(f){this.name=Af,this.order=200,this._loader=f,this.enabled=this._loader.isExtensionUsed(Af)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialBasePropertiesAsync(f,z,w)),E.push(this._loadSpecularGlossinessPropertiesAsync(S,C,w)),this._loader.loadMaterialAlphaProperties(f,z,w),Promise.all(E).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.metallic=null,w.roughness=null,z.diffuseFactor?(w.albedoColor=E.d.ck(z.diffuseFactor),w.alpha=z.diffuseFactor[3]):w.albedoColor=E.d.White(),w.reflectivityColor=z.specularFactor?E.d.ck(z.specularFactor):E.d.White(),w.microSurface=void 0==z.glossinessFactor?1:z.glossinessFactor,z.diffuseTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTexture`,z.diffuseTexture,(f=>{f.name=`${w.name} (Diffuse)`,w.albedoTexture=f}))),z.specularGlossinessTexture&&(S.push(this._loader.loadTextureInfoAsync(`${f}/specularGlossinessTexture`,z.specularGlossinessTexture,(f=>{f.name=`${w.name} (Specular Glossiness)`,w.reflectivityTexture=f,w.reflectivityTexture.xi=!0}))),w.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(S).then((()=>{}))}}Q(Af),b(Af,!0,(f=>new Mf(f)));const Gf="KHR_materials_unlit";class If{constructor(f){this.name=Gf,this.order=210,this._loader=f,this.enabled=this._loader.isExtensionUsed(Gf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,(()=>this._loadUnlitPropertiesAsync(f,z,w)))}_loadUnlitPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;w.unlit=!0;const C=z.pbrMetallicRoughness;return C&&(C.baseColorFactor?(w.albedoColor=E.d.ck(C.baseColorFactor),w.alpha=C.baseColorFactor[3]):w.albedoColor=E.d.White(),C.baseColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/baseColorTexture`,C.baseColorTexture,(f=>{f.name=`${w.name} (Base Color)`,w.albedoTexture=f})))),z.doubleSided&&(w.mk=!1,w.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(f,z,w),Promise.all(S).then((()=>{}))}}Q(Gf),b(Gf,!0,(f=>new If(f)));const nf="KHR_materials_clearcoat";class Pf{constructor(f){this.name=nf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(nf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadClearCoatPropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadClearCoatPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.clearCoat.isEnabled=!0,w.clearCoat.useRoughnessFromMainTexture=!1,w.clearCoat.remapF0OnInterfaceChange=!1,void 0!=z.clearcoatFactor?w.clearCoat.Dl=z.clearcoatFactor:w.clearCoat.Dl=0,z.clearcoatTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatTexture`,z.clearcoatTexture,(f=>{f.name=`${w.name} (ClearCoat)`,w.clearCoat.texture=f}))),void 0!=z.clearcoatRoughnessFactor?w.clearCoat.roughness=z.clearcoatRoughnessFactor:w.clearCoat.roughness=0,z.clearcoatRoughnessTexture&&(z.clearcoatRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatRoughnessTexture`,z.clearcoatRoughnessTexture,(f=>{f.name=`${w.name} (ClearCoat Roughness)`,w.clearCoat.textureRoughness=f})))),z.clearcoatNormalTexture&&(z.clearcoatNormalTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatNormalTexture`,z.clearcoatNormalTexture,(f=>{f.name=`${w.name} (ClearCoat Normal)`,w.clearCoat.bumpTexture=f}))),w.invertNormalMapX=!w.va().useRightHandedSystem,w.invertNormalMapY=w.va().useRightHandedSystem,void 0!=z.clearcoatNormalTexture.scale&&(w.clearCoat.bumpTexture.level=z.clearcoatNormalTexture.scale)),Promise.all(S).then((()=>{}))}}Q(nf),b(nf,!0,(f=>new Pf(f)));const Rf="KHR_materials_iridescence";class qf{constructor(f){this.name=Rf,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(Rf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadIridescencePropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.iridescence.isEnabled=!0,w.iridescence.Dl=z.iridescenceFactor??0,w.iridescence.indexOfRefraction=z.iridescenceIor??z.iridescenceIOR??1.3,w.iridescence.minimumThickness=z.iridescenceThicknessMinimum??100,w.iridescence.maximumThickness=z.iridescenceThicknessMaximum??400,z.iridescenceTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceTexture`,z.iridescenceTexture,(f=>{f.name=`${w.name} (Iridescence)`,w.iridescence.texture=f}))),z.iridescenceThicknessTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceThicknessTexture`,z.iridescenceThicknessTexture,(f=>{f.name=`${w.name} (Iridescence Thickness)`,w.iridescence.thicknessTexture=f}))),Promise.all(S).then((()=>{}))}}Q(Rf),b(Rf,!0,(f=>new qf(f)));const af="KHR_materials_anisotropy";class sf{constructor(f){this.name=af,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(af)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadIridescencePropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.anisotropy.isEnabled=!0,w.anisotropy.Dl=z.anisotropyStrength??0,w.anisotropy.angle=z.anisotropyRotation??0,z.anisotropyTexture&&(z.anisotropyTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${f}/anisotropyTexture`,z.anisotropyTexture,(f=>{f.name=`${w.name} (Anisotropy Intensity)`,w.anisotropy.texture=f})))),Promise.all(S).then((()=>{}))}}Q(af),b(af,!0,(f=>new sf(f)));const Hf="KHR_materials_emissive_strength";class Lf{constructor(f){this.name=Hf,this.order=170,this._loader=f,this.enabled=this._loader.isExtensionUsed(Hf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>this._loader.loadMaterialPropertiesAsync(f,z,w).then((()=>{this._loadEmissiveProperties(S,C,w)}))))}_loadEmissiveProperties(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);void 0!==z.emissiveStrength&&(w.emissiveIntensity=z.emissiveStrength)}}Q(Hf),b(Hf,!0,(f=>new Lf(f)));const Uf="KHR_materials_sheen";class mf{constructor(f){this.name=Uf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(Uf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadSheenPropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadSheenPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return w.sheen.isEnabled=!0,w.sheen.Dl=1,void 0!=z.sheenColorFactor?w.sheen.color=E.d.ck(z.sheenColorFactor):w.sheen.color=E.d.Black(),z.sheenColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/sheenColorTexture`,z.sheenColorTexture,(f=>{f.name=`${w.name} (Sheen Color)`,w.sheen.texture=f}))),void 0!==z.sheenRoughnessFactor?w.sheen.roughness=z.sheenRoughnessFactor:w.sheen.roughness=0,z.sheenRoughnessTexture&&(z.sheenRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${f}/sheenRoughnessTexture`,z.sheenRoughnessTexture,(f=>{f.name=`${w.name} (Sheen Roughness)`,w.sheen.textureRoughness=f})))),w.sheen.albedoScaling=!0,w.sheen.useRoughnessFromMainTexture=!1,Promise.all(S).then((()=>{}))}}Q(Uf),b(Uf,!0,(f=>new mf(f)));const rf="KHR_materials_specular";class of{constructor(f){this.name=rf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(rf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadSpecularPropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadSpecularPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const S=new Array;return void 0!==z.specularFactor&&(w.metallicF0Factor=z.specularFactor),void 0!==z.specularColorFactor&&(w.metallicReflectanceColor=E.d.ck(z.specularColorFactor)),z.specularTexture&&(z.specularTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync(`${f}/specularTexture`,z.specularTexture,(f=>{f.name=`${w.name} (Specular)`,w.metallicReflectanceTexture=f,w.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),z.specularColorTexture&&S.push(this._loader.loadTextureInfoAsync(`${f}/specularColorTexture`,z.specularColorTexture,(f=>{f.name=`${w.name} (Specular Color)`,w.reflectanceTexture=f}))),Promise.all(S).then((()=>{}))}}Q(rf),b(rf,!0,(f=>new of(f)));const pf="KHR_materials_ior";class Yf{constructor(f){this.name=pf,this.order=180,this._loader=f,this.enabled=this._loader.isExtensionUsed(pf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadIorPropertiesAsync(S,C,w)),Promise.all(E).then((()=>{}))}))}_loadIorPropertiesAsync(f,z,w){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);return void 0!==z.ior?w.indexOfRefraction=z.ior:w.indexOfRefraction=Yf._DEFAULT_IOR,Promise.resolve()}}Yf._DEFAULT_IOR=1.5,Q(pf),b(pf,!0,(f=>new Yf(f)));const tf="KHR_materials_variants";class Zf{constructor(f){this.name=tf,this._loader=f,this.enabled=this._loader.isExtensionUsed(tf)}dispose(){this._loader=null}static GetAvailableVariants(f){const z=this._GetExtensionMetadata(f);return z?Object.keys(z.variants):[]}getAvailableVariants(f){return Zf.GetAvailableVariants(f)}static SelectVariant(f,z){const w=this._GetExtensionMetadata(f);if(!w)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${tf} extension`);const S=f=>{const z=w.variants[f];if(z)for(const w of z)w.mesh.material=w.material};if(z instanceof Array)for(const C of z)S(C);else S(z);w.lastSelected=z}selectVariant(f,z){Zf.SelectVariant(f,z)}static Reset(f){const z=this._GetExtensionMetadata(f);if(!z)throw new Error(`Cannot reset on a glTF mesh that does not have the ${tf} extension`);for(const w of z.original)w.mesh.material=w.material;z.lastSelected=null}reset(f){Zf.Reset(f)}static GetLastSelectedVariant(f){const z=this._GetExtensionMetadata(f);if(!z)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tf} extension`);return z.lastSelected}getLastSelectedVariant(f){return Zf.GetLastSelectedVariant(f)}static _GetExtensionMetadata(f){var z,w;return(null===f||void 0===f||null===(z=f._internalMetadata)||void 0===z||null===(w=z.tl)||void 0===w?void 0:w[tf])||null}onLoading(){const f=this._loader.tl.extensions;if(f&&f[this.name]){const z=f[this.name];this._variants=z.variants}}_loadMeshPrimitiveAsync(f,z,w,S,C,E){return j.LoadExtensionAsync(f,C,this.name,((F,J)=>{const x=new Array;return x.push(this._loader._loadMeshPrimitiveAsync(f,z,w,S,C,(z=>{if(E(z),z instanceof q.b){const w=j._GetDrawMode(f,C.mode),S=this._loader.rootBabylonMesh,E=S?S._internalMetadata=S._internalMetadata||{}:{},u=E.tl=E.tl||{},h=u[tf]=u[tf]||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:z,material:z.material});for(let f=0;f<J.mappings.length;++f){const C=J.mappings[f],E=k.Get(`${F}/mappings/${f}/material`,this._loader.tl.materials,C.material);x.push(this._loader._loadMaterialAsync(`#/materials/${C.material}`,E,z,w,(f=>{for(let w=0;w<C.variants.length;++w){const E=C.variants[w],F=k.Get(`/extensions/${tf}/variants/${E}`,this._variants,E);h.variants[F.name]=h.variants[F.name]||[],h.variants[F.name].push({mesh:z,material:f}),z.onClonedObservable.add((f=>{const w=f;let C=null,E=w;do{if(E=E.parent,!E)return;C=Zf._GetExtensionMetadata(E)}while(null===C);if(S&&C===Zf._GetExtensionMetadata(S)){E._internalMetadata={};for(const f in S._internalMetadata)E._internalMetadata[f]=S._internalMetadata[f];E._internalMetadata.tl=[];for(const f in S._internalMetadata.tl)E._internalMetadata.tl[f]=S._internalMetadata.tl[f];E._internalMetadata.tl[tf]={lastSelected:null,original:[],variants:{}};for(const f of C.original)E._internalMetadata.tl[tf].original.push({mesh:f.mesh,material:f.material});for(const f in C.variants)if(Object.prototype.hasOwnProperty.call(C.variants,f)){E._internalMetadata.tl[tf].variants[f]=[];for(const z of C.variants[f])E._internalMetadata.tl[tf].variants[f].push({mesh:z.mesh,material:z.material})}C=E._internalMetadata.tl[tf]}for(const S of C.original)S.mesh===z&&(S.mesh=w);for(const S of C.variants[F.name])S.mesh===z&&(S.mesh=w)}))}})))}}}))),Promise.all(x).then((f=>{let[z]=f;return z}))}))}}Q(tf),b(tf,!0,(f=>new Zf(f)));var bf=w(2332);class Qf{}Qf.AUTOSAMPLERSUFFIX="Sampler",Qf.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Qf.ALPHA_DISABLE=0,Qf.ALPHA_ADD=1,Qf.ALPHA_COMBINE=2,Qf.ALPHA_SUBTRACT=3,Qf.ALPHA_MULTIPLY=4,Qf.ALPHA_MAXIMIZED=5,Qf.ALPHA_ONEONE=6,Qf.ALPHA_PREMULTIPLIED=7,Qf.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Qf.ALPHA_INTERPOLATE=9,Qf.ALPHA_SCREENMODE=10,Qf.ALPHA_ONEONE_ONEONE=11,Qf.ALPHA_ALPHATOCOLOR=12,Qf.ALPHA_REVERSEONEMINUS=13,Qf.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Qf.ALPHA_ONEONE_ONEZERO=15,Qf.ALPHA_EXCLUSION=16,Qf.ALPHA_LAYER_ACCUMULATE=17,Qf.ALPHA_EQUATION_ADD=0,Qf.ALPHA_EQUATION_SUBSTRACT=1,Qf.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Qf.ALPHA_EQUATION_MAX=3,Qf.ALPHA_EQUATION_MIN=4,Qf.ALPHA_EQUATION_DARKEN=5,Qf.DELAYLOADSTATE_NONE=0,Qf.DELAYLOADSTATE_LOADED=1,Qf.DELAYLOADSTATE_LOADING=2,Qf.DELAYLOADSTATE_NOTLOADED=4,Qf.NEVER=512,Qf.ALWAYS=519,Qf.LESS=513,Qf.EQUAL=514,Qf.LEQUAL=515,Qf.GREATER=516,Qf.GEQUAL=518,Qf.NOTEQUAL=517,Qf.KEEP=7680,Qf.ZERO=0,Qf.REPLACE=7681,Qf.INCR=7682,Qf.DECR=7683,Qf.INVERT=5386,Qf.INCR_WRAP=34055,Qf.DECR_WRAP=34056,Qf.TEXTURE_CLAMP_ADDRESSMODE=0,Qf.TEXTURE_WRAP_ADDRESSMODE=1,Qf.TEXTURE_MIRROR_ADDRESSMODE=2,Qf.TEXTURE_CREATIONFLAG_STORAGE=1,Qf.TEXTUREFORMAT_ALPHA=0,Qf.TEXTUREFORMAT_LUMINANCE=1,Qf.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Qf.TEXTUREFORMAT_RGB=4,Qf.TEXTUREFORMAT_RGBA=5,Qf.TEXTUREFORMAT_RED=6,Qf.TEXTUREFORMAT_R=6,Qf.TEXTUREFORMAT_RG=7,Qf.TEXTUREFORMAT_RED_INTEGER=8,Qf.TEXTUREFORMAT_R_INTEGER=8,Qf.TEXTUREFORMAT_RG_INTEGER=9,Qf.TEXTUREFORMAT_RGB_INTEGER=10,Qf.TEXTUREFORMAT_RGBA_INTEGER=11,Qf.TEXTUREFORMAT_BGRA=12,Qf.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Qf.TEXTUREFORMAT_DEPTH32_FLOAT=14,Qf.TEXTUREFORMAT_DEPTH16=15,Qf.TEXTUREFORMAT_DEPTH24=16,Qf.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Qf.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Qf.TEXTUREFORMAT_STENCIL8=19,Qf.TEXTUREFORMAT_UNDEFINED=4294967295,Qf.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Qf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Qf.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Qf.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Qf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Qf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Qf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Qf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Qf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Qf.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Qf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Qf.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Qf.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Qf.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Qf.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Qf.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Qf.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Qf.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Qf.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Qf.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Qf.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Qf.TEXTURETYPE_UNSIGNED_BYTE=0,Qf.TEXTURETYPE_UNSIGNED_INT=0,Qf.TEXTURETYPE_FLOAT=1,Qf.TEXTURETYPE_HALF_FLOAT=2,Qf.TEXTURETYPE_BYTE=3,Qf.TEXTURETYPE_SHORT=4,Qf.TEXTURETYPE_UNSIGNED_SHORT=5,Qf.TEXTURETYPE_INT=6,Qf.TEXTURETYPE_UNSIGNED_INTEGER=7,Qf.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Qf.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Qf.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Qf.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Qf.TEXTURETYPE_UNSIGNED_INT_24_8=12,Qf.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Qf.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Qf.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Qf.TEXTURETYPE_UNDEFINED=16,Qf.TEXTURE_2D=3553,Qf.TEXTURE_2D_ARRAY=35866,Qf.TEXTURE_CUBE_MAP=34067,Qf.TEXTURE_CUBE_MAP_ARRAY=3735928559,Qf.TEXTURE_3D=32879,Qf.TEXTURE_NEAREST_SAMPLINGMODE=1,Qf.TEXTURE_NEAREST_NEAREST=1,Qf.TEXTURE_BILINEAR_SAMPLINGMODE=2,Qf.TEXTURE_LINEAR_LINEAR=2,Qf.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Qf.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Qf.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Qf.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Qf.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Qf.TEXTURE_NEAREST_LINEAR=7,Qf.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Qf.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Qf.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Qf.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Qf.TEXTURE_LINEAR_NEAREST=12,Qf.TEXTURE_EXPLICIT_MODE=0,Qf.TEXTURE_SPHERICAL_MODE=1,Qf.TEXTURE_PLANAR_MODE=2,Qf.TEXTURE_CUBIC_MODE=3,Qf.TEXTURE_PROJECTION_MODE=4,Qf.TEXTURE_SKYBOX_MODE=5,Qf.TEXTURE_INVCUBIC_MODE=6,Qf.TEXTURE_EQUIRECTANGULAR_MODE=7,Qf.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Qf.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Qf.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Qf.TEXTURE_FILTERING_QUALITY_HIGH=64,Qf.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Qf.TEXTURE_FILTERING_QUALITY_LOW=8,Qf.SCALEMODE_FLOOR=1,Qf.SCALEMODE_NEAREST=2,Qf.SCALEMODE_CEILING=3,Qf.MATERIAL_TextureDirtyFlag=1,Qf.MATERIAL_LightDirtyFlag=2,Qf.MATERIAL_FresnelDirtyFlag=4,Qf.MATERIAL_AttributesDirtyFlag=8,Qf.MATERIAL_MiscDirtyFlag=16,Qf.MATERIAL_PrePassDirtyFlag=32,Qf.MATERIAL_AllDirtyFlag=63,Qf.MATERIAL_TriangleFillMode=0,Qf.MATERIAL_WireFrameFillMode=1,Qf.MATERIAL_PointFillMode=2,Qf.MATERIAL_PointListDrawMode=3,Qf.MATERIAL_LineListDrawMode=4,Qf.MATERIAL_LineLoopDrawMode=5,Qf.MATERIAL_LineStripDrawMode=6,Qf.MATERIAL_TriangleStripDrawMode=7,Qf.MATERIAL_TriangleFanDrawMode=8,Qf.MATERIAL_ClockWiseSideOrientation=0,Qf.MATERIAL_CounterClockWiseSideOrientation=1,Qf.ACTION_NothingTrigger=0,Qf.ACTION_OnPickTrigger=1,Qf.ACTION_OnLeftPickTrigger=2,Qf.ACTION_OnRightPickTrigger=3,Qf.ACTION_OnCenterPickTrigger=4,Qf.ACTION_OnPickDownTrigger=5,Qf.ACTION_OnDoublePickTrigger=6,Qf.ACTION_OnPickUpTrigger=7,Qf.ACTION_OnPickOutTrigger=16,Qf.ACTION_OnLongPressTrigger=8,Qf.ACTION_OnPointerOverTrigger=9,Qf.ACTION_OnPointerOutTrigger=10,Qf.ACTION_OnEveryFrameTrigger=11,Qf.ACTION_OnIntersectionEnterTrigger=12,Qf.ACTION_OnIntersectionExitTrigger=13,Qf.ACTION_OnKeyDownTrigger=14,Qf.ACTION_OnKeyUpTrigger=15,Qf.PARTICLES_BILLBOARDMODE_Y=2,Qf.PARTICLES_BILLBOARDMODE_ALL=7,Qf.PARTICLES_BILLBOARDMODE_STRETCHED=8,Qf.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Qf.MESHES_CULLINGSTRATEGY_STANDARD=0,Qf.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Qf.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Qf.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Qf.SCENELOADER_NO_LOGGING=0,Qf.SCENELOADER_MINIMAL_LOGGING=1,Qf.SCENELOADER_SUMMARY_LOGGING=2,Qf.SCENELOADER_DETAILED_LOGGING=3,Qf.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Qf.PREPASS_POSITION_TEXTURE_TYPE=1,Qf.PREPASS_VELOCITY_TEXTURE_TYPE=2,Qf.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Qf.PREPASS_COLOR_TEXTURE_TYPE=4,Qf.PREPASS_DEPTH_TEXTURE_TYPE=5,Qf.PREPASS_NORMAL_TEXTURE_TYPE=6,Qf.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Qf.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Qf.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Qf.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Qf.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Qf.PREPASS_ALBEDO_TEXTURE_TYPE=12,Qf.BUFFER_CREATIONFLAG_READ=1,Qf.BUFFER_CREATIONFLAG_WRITE=2,Qf.BUFFER_CREATIONFLAG_READWRITE=3,Qf.BUFFER_CREATIONFLAG_UNIFORM=4,Qf.BUFFER_CREATIONFLAG_VERTEX=8,Qf.BUFFER_CREATIONFLAG_INDEX=16,Qf.BUFFER_CREATIONFLAG_STORAGE=32,Qf.BUFFER_CREATIONFLAG_INDIRECT=64,Qf.RENDERPASS_MAIN=0,Qf.INPUT_ALT_KEY=18,Qf.INPUT_CTRL_KEY=17,Qf.INPUT_META_KEY1=91,Qf.INPUT_META_KEY2=92,Qf.INPUT_META_KEY3=93,Qf.INPUT_SHIFT_KEY=16,Qf.SNAPSHOTRENDERING_STANDARD=0,Qf.SNAPSHOTRENDERING_FAST=1,Qf.PERSPECTIVE_CAMERA=0,Qf.ORTHOGRAPHIC_CAMERA=1,Qf.FOVMODE_VERTICAL_FIXED=0,Qf.FOVMODE_HORIZONTAL_FIXED=1,Qf.RIG_MODE_NONE=0,Qf.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Qf.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Qf.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Qf.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Qf.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Qf.RIG_MODE_VR=20,Qf.RIG_MODE_CUSTOM=22,Qf.MAX_SUPPORTED_UV_SETS=6,Qf.GL_ALPHA_EQUATION_ADD=32774,Qf.GL_ALPHA_EQUATION_MIN=32775,Qf.GL_ALPHA_EQUATION_MAX=32776,Qf.GL_ALPHA_EQUATION_SUBTRACT=32778,Qf.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Qf.GL_ALPHA_FUNCTION_SRC=768,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Qf.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Qf.GL_ALPHA_FUNCTION_DST_ALPHA=772,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Qf.GL_ALPHA_FUNCTION_DST_COLOR=774,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Qf.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Qf.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Qf.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Qf.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Qf.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Qf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Qf.SnippetUrl="https://snippet.babylonjs.com",Qf.FOGMODE_NONE=0,Qf.FOGMODE_EXP=1,Qf.FOGMODE_EXP2=2,Qf.FOGMODE_LINEAR=3,Qf.BYTE=5120,Qf.UNSIGNED_BYTE=5121,Qf.SHORT=5122,Qf.UNSIGNED_SHORT=5123,Qf.INT=5124,Qf.UNSIGNED_INT=5125,Qf.FLOAT=5126,Qf.PositionKind="position",Qf.NormalKind="lk",Qf.TangentKind="tangent",Qf.UVKind="uv",Qf.UV2Kind="uv2",Qf.UV3Kind="uv3",Qf.UV4Kind="uv4",Qf.UV5Kind="uv5",Qf.UV6Kind="uv6",Qf.ColorKind="color",Qf.ColorInstanceKind="instanceColor",Qf.MatricesIndicesKind="matricesIndices",Qf.MatricesWeightsKind="matricesWeights",Qf.MatricesIndicesExtraKind="matricesIndicesExtra",Qf.MatricesWeightsExtraKind="matricesWeightsExtra";class gf{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Qf.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(f,z){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...gf._GetDefaultOptions(),...f},this._scene=z,this._scene._transmissionHelper=this,this.onErrorObservable=new h.c,this._scene.ik.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(f){if(!Object.keys(f).filter((z=>this._options[z]!==f[z])).length)return;const z={...this._options,...f},w=this._options;this._options=z,z.renderSize===w.renderSize&&z.renderTargetTextureType===w.renderTargetTextureType&&z.generateMipmaps===w.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=z.samples,this._opaqueRenderTarget.lodGenerationScale=z.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=z.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(f){return!!f&&!!(f instanceof M&&f.subSurface.isRefractionEnabled)}_addMesh(f){this._materialObservers[f.uniqueId]=f.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),F.h.SetImmediate((()=>{this._shouldRenderAsTransmission(f.material)?(f.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(f)&&this._transparentMeshesCache.push(f)):-1===this._opaqueMeshesCache.indexOf(f)&&this._opaqueMeshesCache.push(f)}))}_removeMesh(f){f.onMaterialChangedObservable.remove(this._materialObservers[f.uniqueId]),delete this._materialObservers[f.uniqueId];let z=this._transparentMeshesCache.indexOf(f);-1!==z&&this._transparentMeshesCache.splice(z,1),z=this._opaqueMeshesCache.indexOf(f),-1!==z&&this._opaqueMeshesCache.splice(z,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(f){const z=this._transparentMeshesCache.indexOf(f),w=this._opaqueMeshesCache.indexOf(f);this._shouldRenderAsTransmission(f.material)?(f.material instanceof M&&(f.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==w?(this._opaqueMeshesCache.splice(w,1),this._transparentMeshesCache.push(f)):-1===z&&this._transparentMeshesCache.push(f)):-1!==z?(this._transparentMeshesCache.splice(z,1),this._opaqueMeshesCache.push(f)):-1===w&&this._opaqueMeshesCache.push(f)}_isRenderTargetValid(){var f;return null!==(null===(f=this._opaqueRenderTarget)||void 0===f?void 0:f.getInternalTexture())}_setupRenderTargets(){var f;let z,w;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new bf.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(f=this._options.clearColor)||void 0===f?void 0:f.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((f=>{w=this._scene.environmentIntensity,this._scene.environmentIntensity=1,z=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?f.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(f.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=w,this._scene.imageProcessingConfiguration._applyByPostProcess=z})),this._transparentMeshesCache.forEach((f=>{this._shouldRenderAsTransmission(f.material)&&(f.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kf="KHR_materials_transmission";class jf{constructor(f){this.name=kf,this.order=175,this._loader=f,this.enabled=this._loader.isExtensionUsed(kf),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadTransparentPropertiesAsync(S,z,w,C)),Promise.all(E).then((()=>{}))}))}_loadTransparentPropertiesAsync(f,z,w,S){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const C=w;if(C.subSurface.isRefractionEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.useAlbedoToTintRefraction=!0,void 0===S.transmissionFactor)return C.subSurface.refractionIntensity=0,C.subSurface.isRefractionEnabled=!1,Promise.resolve();{var E;C.subSurface.refractionIntensity=S.transmissionFactor;const f=C.va();if(C.subSurface.refractionIntensity&&!f._transmissionHelper)new gf({},C.va());else if(C.subSurface.refractionIntensity&&(null===(E=f._transmissionHelper)||void 0===E||!E._isRenderTargetValid())){var F;null===(F=f._transmissionHelper)||void 0===F||F._setupRenderTargets()}}return C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,S.transmissionTexture?(S.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/transmissionTexture`,S.transmissionTexture,void 0).then((f=>{f.name=`${w.name} (Transmission)`,C.subSurface.refractionIntensityTexture=f,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Q(kf),b(kf,!0,(f=>new jf(f)));const lf="KHR_materials_diffuse_transmission";class Nf{constructor(f){this.name=lf,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(lf),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadTranslucentPropertiesAsync(S,z,w,C)),Promise.all(E).then((()=>{}))}))}_loadTranslucentPropertiesAsync(f,z,w,S){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);const C=w;if(C.subSurface.isTranslucencyEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,C.subSurface.useAlbedoToTintTranslucency=!1,void 0===S.diffuseTransmissionFactor)return C.subSurface.translucencyIntensity=0,C.subSurface.isTranslucencyEnabled=!1,Promise.resolve();C.subSurface.translucencyIntensity=S.diffuseTransmissionFactor;const F=new Array;return C.subSurface.useGltfStyleTextures=!0,S.diffuseTransmissionTexture&&(S.diffuseTransmissionTexture.nonColorData=!0,F.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionTexture`,S.diffuseTransmissionTexture).then((f=>{f.name=`${w.name} (Diffuse Transmission)`,C.subSurface.translucencyIntensityTexture=f})))),void 0!==S.diffuseTransmissionColorFactor?C.subSurface.translucencyColor=E.d.ck(S.diffuseTransmissionColorFactor):C.subSurface.translucencyColor=E.d.White(),S.diffuseTransmissionColorTexture&&F.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionColorTexture`,S.diffuseTransmissionColorTexture).then((f=>{f.name=`${w.name} (Diffuse Transmission Color)`,C.subSurface.translucencyColorTexture=f}))),Promise.all(F).then((()=>{}))}}Q(lf),b(lf,!0,(f=>new Nf(f)));const fz="KHR_materials_volume";class zz{constructor(f){this.name=fz,this.order=173,this._loader=f,this.enabled=this._loader.isExtensionUsed(fz),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadVolumePropertiesAsync(S,z,w,C)),Promise.all(E).then((()=>{}))}))}_loadVolumePropertiesAsync(f,z,w,S){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);if(!w.subSurface.isRefractionEnabled&&!w.subSurface.isTranslucencyEnabled||!S.thicknessFactor)return Promise.resolve();w.subSurface.volumeIndexOfRefraction=w.indexOfRefraction;const C=void 0!==S.attenuationDistance?S.attenuationDistance:Number.MAX_VALUE;return w.subSurface.tintColorAtDistance=C,void 0!==S.attenuationColor&&3==S.attenuationColor.length&&w.subSurface.tintColor.Gd(S.attenuationColor[0],S.attenuationColor[1],S.attenuationColor[2]),w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=S.thicknessFactor,w.subSurface.useThicknessAsDepth=!0,S.thicknessTexture?(S.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/thicknessTexture`,S.thicknessTexture).then((f=>{f.name=`${w.name} (Thickness)`,w.subSurface.thicknessTexture=f,w.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}Q(fz),b(fz,!0,(f=>new zz(f)));const wz="KHR_materials_dispersion";class Sz{constructor(f){this.name=wz,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(wz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(f,z,w)),E.push(this._loadDispersionPropertiesAsync(S,z,w,C)),Promise.all(E).then((()=>{}))}))}_loadDispersionPropertiesAsync(f,z,w,S){if(!(w instanceof M))throw new Error(`${f}: Material type not supported`);return w.subSurface.isRefractionEnabled&&S.dispersion?(w.subSurface.isDispersionEnabled=!0,w.subSurface.dispersion=S.dispersion,Promise.resolve()):Promise.resolve()}}Q(wz),b(wz,!0,(f=>new Sz(f)));const Cz="KHR_mesh_quantization";class Ez{constructor(f){this.name=Cz,this.enabled=f.isExtensionUsed(Cz)}dispose(){}}Q(Cz),b(Cz,!0,(f=>new Ez(f)));const Fz="KHR_texture_basisu";class Jz{constructor(f){this.name=Fz,this._loader=f,this.enabled=f.isExtensionUsed(Fz)}dispose(){this._loader=null}_loadTextureAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>{const E=void 0==z.sampler?j.DefaultSampler:k.Get(`${f}/sampler`,this._loader.tl.samplers,z.sampler),F=k.Get(`${S}/source`,this._loader.tl.images,C.source);return this._loader._createTextureAsync(f,E,F,(f=>{w(f)}),z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!z._textureInfo.nonColorData)}))}}Q(Fz),b(Fz,!0,(f=>new Jz(f)));const xz="KHR_texture_transform";class uz{constructor(f){this.name=xz,this._loader=f,this.enabled=this._loader.isExtensionUsed(xz)}dispose(){this._loader=null}loadTextureInfoAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((S,C)=>this._loader.loadTextureInfoAsync(f,z,(f=>{if(!(f instanceof G.b))throw new Error(`${S}: Texture type not supported`);C.offset&&(f.uOffset=C.offset[0],f.vOffset=C.offset[1]),f.uRotationCenter=0,f.vRotationCenter=0,C.rotation&&(f.wAng=-C.rotation),C.scale&&(f.uScale=C.scale[0],f.vScale=C.scale[1]),void 0!=C.texCoord&&(f.coordinatesIndex=C.texCoord),w(f)}))))}}Q(xz),b(xz,!0,(f=>new uz(f)));const hz="KHR_xmp_json_ld";class Xz{constructor(f){this.name=hz,this.order=100,this._loader=f,this.enabled=this._loader.isExtensionUsed(hz)}dispose(){this._loader=null}onLoading(){var f,z,w;if(null===this._loader.rootBabylonMesh)return;const S=null===(f=this._loader.tl.extensions)||void 0===f?void 0:f.KHR_xmp_json_ld,C=null===(z=this._loader.tl.asset)||void 0===z||null===(w=z.extensions)||void 0===w?void 0:w.KHR_xmp_json_ld;if(S&&C){const f=+C.packet;S.packets&&f<S.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=S.packets[f])}}}function Kz(f,z,w,S){return E.d.ck(z,w).scale(S)}function cz(f,z,w,S){return z[w]*S}function yz(f,z,w,S){return-z[w]*S}function ez(f,z,w,S){return z[w+1]*S}function Oz(f,z,w,S){return z[w]*S*2}function dz(f){return{scale:[new Vz(K.c.ANIMATIONTYPE_FLOAT,`${f}.uScale`,cz,(()=>2)),new Vz(K.c.ANIMATIONTYPE_FLOAT,`${f}.vScale`,ez,(()=>2))],offset:[new Vz(K.c.ANIMATIONTYPE_FLOAT,`${f}.uOffset`,cz,(()=>2)),new Vz(K.c.ANIMATIONTYPE_FLOAT,`${f}.vOffset`,ez,(()=>2))],rotation:[new Vz(K.c.ANIMATIONTYPE_FLOAT,`${f}.wAng`,yz,(()=>1))]}}Q(hz),b(hz,!0,(f=>new Xz(f)));class Bz extends o{buildAnimations(f,z,w,S,C){C(f._babylonCamera,this._buildAnimation(z,w,S))}}class Vz extends o{buildAnimations(f,z,w,S,C){for(const E in f._data)C(f._data[E].babylonMaterial,this._buildAnimation(z,w,S))}}class Wz extends o{buildAnimations(f,z,w,S,C){C(f._babylonLight,this._buildAnimation(z,w,S))}}const Tz={__array__:{__target__:!0,...Y}},vz={__array__:{__target__:!0,orthographic:{xmag:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"orthoLeft",yz,(()=>1)),new Bz(K.c.ANIMATIONTYPE_FLOAT,"orthoRight",ez,(()=>1))],ymag:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"orthoBottom",yz,(()=>1)),new Bz(K.c.ANIMATIONTYPE_FLOAT,"orthoTop",ez,(()=>1))],zfar:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"maxZ",cz,(()=>1))],znear:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"Zj",cz,(()=>1))]},perspective:{yfov:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"fov",cz,(()=>1))],zfar:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"maxZ",cz,(()=>1))],znear:[new Bz(K.c.ANIMATIONTYPE_FLOAT,"Zj",cz,(()=>1))]}}},Dz={nodes:Tz,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"albedoColor",Kz,(()=>4)),new Vz(K.c.ANIMATIONTYPE_FLOAT,"alpha",(function(f,z,w,S){return z[w+3]*S}),(()=>4))],metallicFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"metallic",cz,(()=>1))],roughnessFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"roughness",cz,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:dz("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:dz("metallicTexture")}}},emissiveFactor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Kz,(()=>3))],normalTexture:{scale:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cz,(()=>1))],extensions:{KHR_texture_transform:dz("bumpTexture")}},occlusionTexture:{strength:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cz,(()=>1))],extensions:{KHR_texture_transform:dz("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:dz("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cz,(()=>1))],anisotropyRotation:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cz,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:dz("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cz,(()=>1))],clearcoatRoughnessFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cz,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:dz("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cz,(()=>1))],extensions:{KHR_texture_transform:dz("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:dz("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cz,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cz,(()=>1))]},KHR_materials_ior:{ior:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cz,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cz,(()=>1))],iridescenceIor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cz,(()=>1))],iridescenceThicknessMinimum:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cz,(()=>1))],iridescenceThicknessMaximum:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cz,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:dz("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:dz("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"sheen.color",Kz,(()=>3))],sheenRoughnessFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",cz,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:dz("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:dz("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cz,(()=>1))],specularColorFactor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Kz,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:dz("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:dz("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cz,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:dz("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Kz,(()=>3))],attenuationDistance:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cz,(()=>1))],thicknessFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cz,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:dz("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Vz(K.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cz,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:dz("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Vz(K.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Kz,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:dz("subSurface.translucencyColorTexture")}}}}}},cameras:vz,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Wz(K.c.ANIMATIONTYPE_COLOR3,"diffuse",Kz,(()=>3))],Dl:[new Wz(K.c.ANIMATIONTYPE_FLOAT,"intensity",cz,(()=>1))],range:[new Wz(K.c.ANIMATIONTYPE_FLOAT,"range",cz,(()=>1))],spot:{innerConeAngle:[new Wz(K.c.ANIMATIONTYPE_FLOAT,"innerAngle",Oz,(()=>1))],outerConeAngle:[new Wz(K.c.ANIMATIONTYPE_FLOAT,"angle",Oz,(()=>1))]}}}}}};class Az{constructor(f,z){this._gltf=f,this._infoTree=z}convert(f){let z,w=this._gltf,S=this._infoTree;if(!f.startsWith("/"))throw new Error("Path must start with a /");const C=f.split("/");C.shift();for(const E of C){if(S.__array__)S=S.__array__;else if(S=S[E],!S)throw new Error(`Path ${f} is invalid`);if(void 0===w)throw new Error(`Path ${f} is invalid`);w=w[E],S.__target__&&(z=w)}return{object:z,info:S}}}const Mz="KHR_animation_pointer";class Gz extends Az{constructor(f){super(f,Dz)}}class Iz{constructor(f){this.name=Mz,this._loader=f,this._pathToObjectConverter=new Gz(this._loader.tl)}get enabled(){return this._loader.isExtensionUsed(Mz)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(f,z,w,S,C){var E;const F=null===(E=S.target.extensions)||void 0===E?void 0:E.KHR_animation_pointer;if(!F||!this._pathToObjectConverter)return null;"pointer"!==S.target.path&&e.b.Warn(`${f}/target/path: Value (${S.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=S.target.node&&e.b.Warn(`${f}/target/node: Value (${S.target.node}) must not be present when using the ${this.name} extension`);const J=`${f}/extensions/${this.name}`,x=F.pointer;if(!x)throw new Error(`${J}: Pointer is missing`);try{const E=this._pathToObjectConverter.convert(x);return this._loader._loadAnimationChannelFromTargetInfoAsync(f,z,w,S,E,C)}catch(u){return e.b.Warn(`${J}/pointer: Invalid pointer (${x}) skipped`),null}}}Q(Mz),b(Mz,!0,(f=>new Iz(f)));class nz{constructor(f,z,w){this.frame=f,this.action=z,this.onlyOnce=w,this.isDone=!1}_clone(){return new nz(this.frame,this.action,this.onlyOnce)}}var Pz=w(568),Rz=w(616);class qz{get loop(){return this._loop}set loop(f){f!==this._loop&&(this._loop=f,this.updateOptions({loop:f}))}get currentTime(){var f;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.audioContext&&(this.isPlaying||this.isPaused)){const f=this.isPaused?0:Rz.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+f}return 0}get spatialSound(){return this._spatialSound}set spatialSound(f){if(f==this._spatialSound)return;const z=this.isPlaying;this.pause(),f?(this._spatialSound=f,this._updateSpatialParameters()):this._disableSpatialSound(),z&&this.play()}constructor(f,z,w){var S;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new h.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=C.n.Zero(),this._localDirection=new C.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=f,w=w||y.c.LastCreatedScene)if(this._scene=w,qz._SceneComponentInitialization(w),this._readyToPlayCallback=E,this._customAttenuationFunction=(f,z,w,S,C)=>z<w?f*(1-z/w):0,J&&(this.autoplay=J.autoplay||!1,this._loop=J.loop||!1,void 0!==J.volume&&(this._volume=J.volume),this._spatialSound=J.spatialSound??!1,this.maxDistance=J.maxDistance??100,this.useCustomAttenuation=J.useCustomAttenuation??!1,this.rolloffFactor=J.rolloffFactor||1,this.refDistance=J.refDistance||1,this.distanceModel=J.distanceModel||"linear",this._playbackRate=J.playbackRate||1,this._streaming=J.streaming??!1,this._length=J.length,this._offset=J.offset),null!==(S=Rz.e.audioEngine)&&void 0!==S&&S.canUseWebAudio&&Rz.e.audioEngine.audioContext){this._soundGain=Rz.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let f=!0;if(z)try{"string"===typeof z?(this._urlType="String",this._url=z):z instanceof ArrayBuffer?this._urlType="ArrayBuffer":z instanceof HTMLMediaElement?this._urlType="MediaElement":z instanceof MediaStream?this._urlType="MediaStream":z instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(z)&&(this._urlType="Array");let w=[],S=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Rz.e.audioEngine.audioContext.createMediaElementSource(z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Rz.e.audioEngine.audioContext.createMediaStreamSource(z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":z.byteLength>0&&(S=!0,this._soundLoaded(z));break;case"AudioBuffer":this._audioBufferLoaded(z);break;case"String":w.push(z);case"Array":0===w.length&&(w=z);for(let f=0;f<w.length;f++){const z=w[f];if(S=J&&J.skipCodecCheck||-1!==z.indexOf(".mp3",z.length-4)&&Rz.e.audioEngine.isMP3supported||-1!==z.indexOf(".ogg",z.length-4)&&Rz.e.audioEngine.isOGGsupported||-1!==z.indexOf(".wav",z.length-4)||-1!==z.indexOf(".m4a",z.length-4)||-1!==z.indexOf(".mp4",z.length-4)||-1!==z.indexOf("blob:"),S){this._streaming?(this._htmlAudioElement=new Audio(z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,F.h.SetCorsBehavior(z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(z,(f=>{this._soundLoaded(f)}),void 0,!0,!0,(f=>{f&&e.b.Error("XHR "+f.status+" error on: "+z+"."),e.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:f=!1}f?S||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):e.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(x){e.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Rz.e.audioEngine&&!Rz.e.audioEngine.WarnedWebAudioUnsupported&&(e.b.Error("Web Audio is not supported by your browser."),Rz.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var f;null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(f){var z;null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.audioContext&&(this._audioBuffer=f,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(f){var z;null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.audioContext&&Rz.e.audioEngine.audioContext.decodeAudioData(f,(f=>{this._audioBufferLoaded(f)}),(f=>{e.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+f)}))}setAudioBuffer(f){var z;null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&(this._audioBuffer=f,this._isReadyToPlay=!0)}updateOptions(f){f&&(this.loop=f.loop??this.loop,this.maxDistance=f.maxDistance??this.maxDistance,this.useCustomAttenuation=f.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=f.rolloffFactor??this.rolloffFactor,this.refDistance=f.refDistance??this.refDistance,this.distanceModel=f.distanceModel??this.distanceModel,this._playbackRate=f.playbackRate??this._playbackRate,this._length=f.length??void 0,this.spatialSound=f.spatialSound??this._spatialSound,this._setOffset(f.offset??void 0),this.setVolume(f.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var f;null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&Rz.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Rz.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var f;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(f=this._soundPanner)||void 0===f||f.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var f;null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(f){var z;null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(f),this._isOutputConnected=!0)}setDirectionalCone(f,z,w){z<f?e.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=f,this._coneOuterAngle=z,this._coneOuterGain=w,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!=this._coneInnerAngle){var z;if(this._coneOuterAngle<f)return void e.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f,null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!=this._coneOuterAngle){var z;if(f<this._coneInnerAngle)return void e.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f,null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(f){var z;f.equals(this._position)||(this._position.p(f),null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(f){var z;this._localDirection=f,null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const f=this._connectedTransformNode.getWorldMatrix(),z=C.n.TransformNormal(this._localDirection,f);z.normalize(),this._soundPanner.orientationX.value=z.x,this._soundPanner.orientationY.value=z.y,this._soundPanner.orientationZ.value=z.z}updateDistanceFromListener(){var f;if(null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const f=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.te(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,f,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(f){this._customAttenuationFunction=f}play(f,z,w){var S;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(S=Rz.e.audioEngine)&&void 0!==S&&S.audioContext)try{var C,E;this._clearTimeoutsAndObservers();let S=f?(null===(C=Rz.e.audioEngine)||void 0===C?void 0:C.audioContext.currentTime)+f:null===(E=Rz.e.audioEngine)||void 0===E?void 0:E.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Rz.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const f=()=>{var w;if(null!==(w=Rz.e.audioEngine)&&void 0!==w&&w.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=z??0;const w=this._htmlAudioElement.play();void 0!==w&&w.catch((()=>{var z,w;(null===(z=Rz.e.audioEngine)||void 0===z||z.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(w=Rz.e.audioEngine)||void 0===w?void 0:w.onAudioUnlockedObservable.addOnce((()=>{f()})))}))}else{var S;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(S=Rz.e.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{f()}))}};f()}}else{var F;const C=()=>{var C;if(null!==(C=Rz.e.audioEngine)&&void 0!==C&&C.audioContext){var E;if(w=w||this._length,void 0!==z&&this._setOffset(z),this._soundSource){const f=this._soundSource;f.onended=()=>{f.disconnect()}}if(this._soundSource=null===(E=Rz.e.audioEngine)||void 0===E?void 0:E.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var F;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==z&&(this._soundSource.loopStart=z),void 0!==w&&(this._soundSource.loopEnd=(0|z)+w),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},S=f?(null===(F=Rz.e.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+f:Rz.e.audioEngine.audioContext.currentTime;const C=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(S,C,this.loop?void 0:w)}}};"suspended"===(null===(F=Rz.e.audioEngine)||void 0===F?void 0:F.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var f;"suspended"===(null===(f=Rz.e.audioEngine)||void 0===f?void 0:f.audioContext.state)?(Rz.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Rz.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{C()})))):C()}),500):C()}this._startTime=S,this.isPlaying=!0,this.isPaused=!1}catch(J){e.b.Error("Error while trying to play audio: "+this.name+", "+J.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(f){var z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var w;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(w=this._streamingSource)||void 0===w||w.disconnect();this.isPlaying=!1}else if(null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.audioContext&&this._soundSource){const z=f?Rz.e.audioEngine.audioContext.currentTime+f:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(z)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var z;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(z=this._streamingSource)||void 0===z||z.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Rz.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(f,z){var w;null!==(w=Rz.e.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._soundGain&&(z&&Rz.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Rz.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Rz.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(f,Rz.e.audioEngine.audioContext.currentTime+z)):this._soundGain.gain.value=f),this._volume=f}setPlaybackRate(f){this._playbackRate=f,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(f){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=f,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=f=>this._onRegisterAfterWorldMatrixUpdate(f),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(f){var z;if(f.getBoundingInfo){const z=f.getBoundingInfo();this.setPosition(z.boundingSphere.centerWorld)}else this.setPosition(f.absolutePosition);null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const f=()=>{this._isReadyToPlay?(w._audioBuffer=this.getAudioBuffer(),w._isReadyToPlay=!0,w.autoplay&&w.play(0,this._offset,this._length)):setTimeout(f,300)},z={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},w=new qz(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,z);return this.useCustomAttenuation&&w.setAttenuationFunction(this._customAttenuationFunction),w.setPosition(this._position),w.setPlaybackRate(this._playbackRate),f(),w}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const f={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(f.connectedMeshId=this._connectedTransformNode.id),f.position=this._position.kk(),f.refDistance=this.refDistance,f.distanceModel=this.distanceModel,f.isDirectional=this._isDirectional,f.localDirectionToMesh=this._localDirection.kk(),f.coneInnerAngle=this._coneInnerAngle,f.coneOuterAngle=this._coneOuterAngle,f.coneOuterGain=this._coneOuterGain),f}static Parse(f,z,w,S){const E=f.name;let F;F=f.url?w+f.url:w+E;const J={autoplay:f.autoplay,loop:f.loop,volume:f.volume,spatialSound:f.spatialSound,maxDistance:f.maxDistance,rolloffFactor:f.rolloffFactor,refDistance:f.refDistance,distanceModel:f.distanceModel,playbackRate:f.playbackRate};let x;if(S){const f=()=>{S._isReadyToPlay?(x._audioBuffer=S.getAudioBuffer(),x._isReadyToPlay=!0,x.autoplay&&x.play(0,x._offset,x._length)):setTimeout(f,300)};x=new qz(E,new ArrayBuffer(0),z,null,J),f()}else x=new qz(E,F,z,(()=>{z.removePendingData(x)}),J),z.addPendingData(x);if(f.position){const z=C.n.ck(f.position);x.setPosition(z)}if(f.isDirectional&&(x.setDirectionalCone(f.coneInnerAngle||360,f.coneOuterAngle||360,f.coneOuterGain||0),f.localDirectionToMesh)){const z=C.n.ck(f.localDirectionToMesh);x.setLocalDirectionToMesh(z)}if(f.connectedMeshId){const w=z.getMeshById(f.connectedMeshId);w&&x.attachToMesh(w)}return f.metadata&&(x.metadata=f.metadata),x}_setOffset(f){this._offset!==f&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=f)}_clearTimeoutsAndObservers(){var f;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(f=Rz.e.audioEngine)||void 0===f||f.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}qz._SceneComponentInitialization=f=>{throw(0,Pz.d)("AudioSceneComponent")},(0,D.f)("BABYLON.Sound",qz);class az{constructor(f,z,w){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],z.length!==w.length)throw new Error("Sounds length does not equal weights length");this.loop=f,this._weights=w;let S=0;for(const E of w)S+=E;const C=S>0?1/S:0;for(let E=0;E<this._weights.length;E++)this._weights[E]*=C;this._sounds=z;for(const E of this._sounds)E.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!==this._coneInnerAngle){if(this._coneOuterAngle<f)return void e.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f;for(const z of this._sounds)z.directionalConeInnerAngle=f}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!==this._coneOuterAngle){if(f<this._coneInnerAngle)return void e.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f;for(const z of this._sounds)z.directionalConeOuterAngle=f}}get volume(){return this._volume}set volume(f){if(f!==this._volume)for(const z of this._sounds)z.setVolume(f)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(f){if(!this.isPaused){this.stop();const f=Math.random();let z=0;for(let w=0;w<this._weights.length;w++)if(z+=this._weights[w],f<=z){this._currentIndex=w;break}}const z=this._sounds[this._currentIndex??0];z.isReady()?z.play(0,this.isPaused?void 0:f):z.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class sz{constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(f=f||y.c.LastCreatedScene)&&(this._scene=f,this.soundCollection=[],this._options=z,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var f;null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio&&Rz.e.audioEngine.audioContext&&(this._outputAudioNode=Rz.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Rz.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Rz.e.audioEngine&&Rz.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(f){var z;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&f.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==f.soundTrackId&&(-1===f.soundTrackId?this._scene.mainSoundTrack.removeSound(f):this._scene.soundTracks&&this._scene.soundTracks[f.soundTrackId].removeSound(f)),this.soundCollection.push(f),f.soundTrackId=this.id}removeSound(f){const z=this.soundCollection.indexOf(f);-1!==z&&this.soundCollection.splice(z,1)}setVolume(f){var z;null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=f)}switchPanningModelToHRTF(){var f;if(null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let z=0;z<this.soundCollection.length;z++)this.soundCollection[z].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var f;if(null!==(f=Rz.e.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let z=0;z<this.soundCollection.length;z++)this.soundCollection[z].switchPanningModelToEqualPower()}connectToAnalyser(f){var z;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=f,null!==(z=Rz.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Rz.e.audioEngine.masterGain))}}var Hz=w(914),Lz=w(2386),Uz=(w(12238),w(560));(0,w(12311).g)(Hz.d.NAME_AUDIO,((f,z,w,S)=>{let C,E=[];if(w.gm=w.gm||[],void 0!==f.gm&&null!==f.gm)for(let J=0,x=f.gm.length;J<x;J++){var F;const x=f.gm[J];null!==(F=Rz.e.audioEngine)&&void 0!==F&&F.canUseWebAudio?(x.url||(x.url=x.name),E[x.url]?w.gm.push(qz.Parse(x,z,S,E[x.url])):(C=qz.Parse(x,z,S),E[x.url]=C,w.gm.push(C))):w.gm.push(new qz(x.name,null,z))}E=[]})),Object.defineProperty(Lz.c.prototype,"mainSoundTrack",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),this._mainSoundTrack||(this._mainSoundTrack=new sz(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Lz.c.prototype.getSoundByName=function(f){let z;for(z=0;z<this.mainSoundTrack.soundCollection.length;z++)if(this.mainSoundTrack.soundCollection[z].name===f)return this.mainSoundTrack.soundCollection[z];if(this.soundTracks)for(let w=0;w<this.soundTracks.length;w++)for(z=0;z<this.soundTracks[w].soundCollection.length;z++)if(this.soundTracks[w].soundCollection[z].name===f)return this.soundTracks[w].soundCollection[z];return null},Object.defineProperty(Lz.c.prototype,"audioEnabled",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),f.audioEnabled},set:function(f){let z=this._getComponent(Hz.d.NAME_AUDIO);z||(z=new iz(this),this.o(z)),f?z.enableAudio():z.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Lz.c.prototype,"headphone",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),f.headphone},set:function(f){let z=this._getComponent(Hz.d.NAME_AUDIO);z||(z=new iz(this),this.o(z)),f?z.switchAudioModeForHeadphones():z.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Lz.c.prototype,"audioListenerPositionProvider",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),f.audioListenerPositionProvider},set:function(f){let z=this._getComponent(Hz.d.NAME_AUDIO);if(z||(z=new iz(this),this.o(z)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");z.audioListenerPositionProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(Lz.c.prototype,"audioListenerRotationProvider",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),f.audioListenerRotationProvider},set:function(f){let z=this._getComponent(Hz.d.NAME_AUDIO);if(z||(z=new iz(this),this.o(z)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");z.audioListenerRotationProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(Lz.c.prototype,"audioPositioningRefreshRate",{get:function(){let f=this._getComponent(Hz.d.NAME_AUDIO);return f||(f=new iz(this),this.o(f)),f.audioPositioningRefreshRate},set:function(f){let z=this._getComponent(Hz.d.NAME_AUDIO);z||(z=new iz(this),this.o(z)),z.audioPositioningRefreshRate=f},enumerable:!0,configurable:!0});class iz{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(f){this.name=Hz.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new C.n,this._cachedCameraPosition=new C.n,this._lastCheck=0,this._invertMatrixTemp=new C.b,this._cameraDirectionTemp=new C.n,(f=f||y.c.LastCreatedScene)&&(this.Rc=f,f.soundTracks=[],f.gm=[])}register(){this.Rc._afterRenderStage.registerStep(Hz.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(f){if(f.gm=[],this.Rc.soundTracks)for(let z=0;z<this.Rc.soundTracks.length;z++){const w=this.Rc.soundTracks[z];for(let z=0;z<w.soundCollection.length;z++)f.gm.push(w.soundCollection[z].serialize())}}addFromContainer(f){f.gm&&f.gm.forEach((f=>{f.play(),f.autoplay=!0,this.Rc.mainSoundTrack.addSound(f)}))}removeFromContainer(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f.gm&&f.gm.forEach((f=>{f.stop(),f.autoplay=!1,this.Rc.mainSoundTrack.removeSound(f),z&&f.dispose()}))}dispose(){const f=this.Rc;if(f._mainSoundTrack&&f.mainSoundTrack.dispose(),f.soundTracks)for(let z=0;z<f.soundTracks.length;z++)f.soundTracks[z].dispose()}disableAudio(){const f=this.Rc;let z;for(this._audioEnabled=!1,Rz.e.audioEngine&&Rz.e.audioEngine.audioContext&&Rz.e.audioEngine.audioContext.suspend(),z=0;z<f.mainSoundTrack.soundCollection.length;z++)f.mainSoundTrack.soundCollection[z].pause();if(f.soundTracks)for(z=0;z<f.soundTracks.length;z++)for(let w=0;w<f.soundTracks[z].soundCollection.length;w++)f.soundTracks[z].soundCollection[w].pause()}enableAudio(){const f=this.Rc;let z;for(this._audioEnabled=!0,Rz.e.audioEngine&&Rz.e.audioEngine.audioContext&&Rz.e.audioEngine.audioContext.resume(),z=0;z<f.mainSoundTrack.soundCollection.length;z++)f.mainSoundTrack.soundCollection[z].isPaused&&f.mainSoundTrack.soundCollection[z].play();if(f.soundTracks)for(z=0;z<f.soundTracks.length;z++)for(let w=0;w<f.soundTracks[z].soundCollection.length;w++)f.soundTracks[z].soundCollection[w].isPaused&&f.soundTracks[z].soundCollection[w].play()}switchAudioModeForHeadphones(){const f=this.Rc;if(this._headphone=!0,f.mainSoundTrack.switchPanningModelToHRTF(),f.soundTracks)for(let z=0;z<f.soundTracks.length;z++)f.soundTracks[z].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const f=this.Rc;if(this._headphone=!1,f.mainSoundTrack.switchPanningModelToEqualPower(),f.soundTracks)for(let z=0;z<f.soundTracks.length;z++)f.soundTracks[z].switchPanningModelToEqualPower()}_afterRender(){const f=Uz.d.Now;if(this._lastCheck&&f-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=f;const z=this.Rc;if(!this._audioEnabled||!z._mainSoundTrack||!z.soundTracks||0===z._mainSoundTrack.soundCollection.length&&1===z.soundTracks.length)return;const w=Rz.e.audioEngine;if(w&&w.audioContext){let f,S=z.activeCamera;if(z.activeCameras&&z.activeCameras.length>0&&(S=z.activeCameras[0]),this.audioListenerPositionProvider){const f=this.audioListenerPositionProvider();w.audioContext.listener.setPosition(f.x||0,f.y||0,f.z||0)}else S?this._cachedCameraPosition.equals(S.globalPosition)||(this._cachedCameraPosition.p(S.globalPosition),w.audioContext.listener.setPosition(S.globalPosition.x,S.globalPosition.y,S.globalPosition.z)):w.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const f=this.audioListenerRotationProvider();w.audioContext.listener.setOrientation(f.x||0,f.y||0,f.z||0,0,1,0)}else S?(S.rigCameras&&S.rigCameras.length>0&&(S=S.rigCameras[0]),S.getViewMatrix().invertToRef(this._invertMatrixTemp),C.n.TransformNormalToRef(iz._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),w.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):w.audioContext.listener.setOrientation(0,0,0,0,1,0);for(f=0;f<z.mainSoundTrack.soundCollection.length;f++){const w=z.mainSoundTrack.soundCollection[f];w.useCustomAttenuation&&w.updateDistanceFromListener()}if(z.soundTracks)for(f=0;f<z.soundTracks.length;f++)for(let w=0;w<z.soundTracks[f].soundCollection.length;w++){const S=z.soundTracks[f].soundCollection[w];S.useCustomAttenuation&&S.updateDistanceFromListener()}}}}iz._CameraDirection=new C.n(0,0,-1),qz._SceneComponentInitialization=f=>{let z=f._getComponent(Hz.d.NAME_AUDIO);z||(z=new iz(f),f.o(z))};const mz="MSFT_audio_emitter";class rz{constructor(f){this.name=mz,this._loader=f,this.enabled=this._loader.isExtensionUsed(mz)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const f=this._loader.tl.extensions;if(f&&f[this.name]){const z=f[this.name];this._clips=z.clips,this._emitters=z.emitters,k.Assign(this._clips),k.Assign(this._emitters)}}loadSceneAsync(f,z){return j.LoadExtensionAsync(f,z,this.name,((w,S)=>{const C=new Array;C.push(this._loader.loadSceneAsync(f,z));for(const f of S.emitters){const z=k.Get(`${w}/emitters`,this._emitters,f);if(void 0!=z.refDistance||void 0!=z.maxDistance||void 0!=z.rolloffFactor||void 0!=z.distanceModel||void 0!=z.innerAngle||void 0!=z.outerAngle)throw new Error(`${w}: Direction or Distance properties are not allowed on emitters attached to a scene`);C.push(this._loadEmitterAsync(`${w}/emitters/${z.index}`,z))}return Promise.all(C).then((()=>{}))}))}loadNodeAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((f,S)=>{const E=new Array;return this._loader.loadNodeAsync(f,z,(z=>{for(const w of S.emitters){const S=k.Get(`${f}/emitters`,this._emitters,w);E.push(this._loadEmitterAsync(`${f}/emitters/${S.index}`,S).then((()=>{for(const f of S._babylonSounds)f.attachToMesh(z),void 0==S.innerAngle&&void 0==S.outerAngle||(f.setLocalDirectionToMesh(C.n.Forward()),f.setDirectionalCone(2*F.h.ToDegrees(void 0==S.innerAngle?Math.PI:S.innerAngle),2*F.h.ToDegrees(void 0==S.outerAngle?Math.PI:S.outerAngle),0))})))}w(z)})).then((f=>Promise.all(E).then((()=>f))))}))}loadAnimationAsync(f,z){return j.LoadExtensionAsync(f,z,this.name,((w,S)=>this._loader.loadAnimationAsync(f,z).then((C=>{const E=new Array;k.Assign(S.events);for(const F of S.events)E.push(this._loadAnimationEventAsync(`${w}/events/${F.index}`,f,z,F,C));return Promise.all(E).then((()=>C))}))))}_loadClipAsync(f,z){if(z._objectURL)return z._objectURL;let w;if(z.uri)w=this._loader.loadUriAsync(f,z,z.uri);else{const S=k.Get(`${f}/bufferView`,this._loader.tl.bufferViews,z.bufferView);w=this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return z._objectURL=w.then((f=>URL.createObjectURL(new Blob([f],{type:z.mimeType})))),z._objectURL}_loadEmitterAsync(f,z){if(z._babylonSounds=z._babylonSounds||[],!z._babylonData){const f=new Array,w=z.name||`emitter${z.index}`,S={loop:!1,autoplay:!1,volume:void 0==z.volume?1:z.volume};for(let E=0;E<z.clips.length;E++){const C=`/extensions/${this.name}/clips`,F=k.Get(C,this._clips,z.clips[E].clip);f.push(this._loadClipAsync(`${C}/${z.clips[E].clip}`,F).then((f=>{const C=z._babylonSounds[E]=new qz(w,f,this._loader.babylonScene,null,S);C.refDistance=z.refDistance||1,C.maxDistance=z.maxDistance||256,C.rolloffFactor=z.rolloffFactor||1,C.distanceModel=z.distanceModel||"exponential"})))}const C=Promise.all(f).then((()=>{const f=z.clips.map((f=>f.weight||1)),w=new az(z.loop||!1,z._babylonSounds,f);z.innerAngle&&(w.directionalConeInnerAngle=2*F.h.ToDegrees(z.innerAngle)),z.outerAngle&&(w.directionalConeOuterAngle=2*F.h.ToDegrees(z.outerAngle)),z.volume&&(w.volume=z.volume),z._babylonData.sound=w}));z._babylonData={loaded:C}}return z._babylonData.loaded}_getEventAction(f,z,w,S,C){switch(w){case"play":return f=>{const w=(C||0)+(f-S);z.play(w)};case"stop":return()=>{z.stop()};case"pause":return()=>{z.pause()};default:throw new Error(`${f}: Unsupported action ${w}`)}}_loadAnimationEventAsync(f,z,w,S,C){if(0==C.targetedAnimations.length)return Promise.resolve();const E=C.targetedAnimations[0],F=S.j,J=k.Get(`/extensions/${this.name}/emitters`,this._emitters,F);return this._loadEmitterAsync(f,J).then((()=>{const z=J._babylonData.sound;if(z){const w=new nz(S.time,this._getEventAction(f,z,S.action,S.time,S.startOffset));E.animation.addEvent(w),C.onAnimationGroupEndObservable.add((()=>{z.stop()})),C.onAnimationGroupPauseObservable.add((()=>{z.pause()}))}}))}}Q(mz),b(mz,!0,(f=>new rz(f)));const oz="MSFT_lod";class pz{constructor(f){var z;this.name=oz,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new h.c,this.onMaterialLODsLoadedObservable=new h.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=f,this.maxLODsToLoad=(null===(z=this._loader.parent.extensionOptions[oz])||void 0===z?void 0:z.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(oz)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let f=0;f<this._nodePromiseLODs.length;f++){const z=Promise.all(this._nodePromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Node LOD ${f}`),this._loader.log(`Loaded node LOD ${f}`)),this.onNodeLODsLoadedObservable.notifyObservers(f),f!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${f+1}`),this._loadBufferLOD(this._nodeBufferLODs,f+1),this._nodeSignalLODs[f]&&this._nodeSignalLODs[f].resolve())}));this._loader._completePromises.push(z)}for(let f=0;f<this._materialPromiseLODs.length;f++){const z=Promise.all(this._materialPromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Material LOD ${f}`),this._loader.log(`Loaded material LOD ${f}`)),this.onMaterialLODsLoadedObservable.notifyObservers(f),f!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${f+1}`),this._loadBufferLOD(this._materialBufferLODs,f+1),this._materialSignalLODs[f]&&this._materialSignalLODs[f].resolve())}));this._loader._completePromises.push(z)}}loadSceneAsync(f,z){const w=this._loader.loadSceneAsync(f,z);return this._loadBufferLOD(this._bufferLODs,0),w}loadNodeAsync(f,z,w){return j.LoadExtensionAsync(f,z,this.name,((f,C)=>{let E;const F=this._getLODs(f,z,this._loader.tl.nodes,C.ids);this._loader.logOpen(`${f}`);for(let z=0;z<F.length;z++){const f=F[z];0!==z&&(this._nodeIndexLOD=z,this._nodeSignalLODs[z]=this._nodeSignalLODs[z]||new S);const C=f=>{w(f),f.Cb(!1)},J=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,C).then((f=>{if(0!==z){const f=F[z-1];f._babylonTransformNode&&(this._disposeTransformNode(f._babylonTransformNode),delete f._babylonTransformNode)}return f.Cb(!0),f}));this._nodePromiseLODs[z]=this._nodePromiseLODs[z]||[],0===z?E=J:(this._nodeIndexLOD=null,this._nodePromiseLODs[z].push(J))}return this._loader.logClose(),E}))}_loadMaterialAsync(f,z,w,S,C){return this._nodeIndexLOD?null:j.LoadExtensionAsync(f,z,this.name,((f,E)=>{let F;const J=this._getLODs(f,z,this._loader.tl.materials,E.ids);this._loader.logOpen(`${f}`);for(let z=0;z<J.length;z++){const f=J[z];0!==z&&(this._materialIndexLOD=z);const E=this._loader._loadMaterialAsync(`/materials/${f.index}`,f,w,S,(f=>{0===z&&C(f)})).then((f=>{if(0!==z){C(f);const w=J[z-1]._data;w[S]&&(this._disposeMaterials([w[S].babylonMaterial]),delete w[S])}return f}));this._materialPromiseLODs[z]=this._materialPromiseLODs[z]||[],0===z?F=E:(this._materialIndexLOD=null,this._materialPromiseLODs[z].push(E))}return this._loader.logClose(),F}))}_loadUriAsync(f,z,w){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const C=this._nodeIndexLOD-1;return this._nodeSignalLODs[C]=this._nodeSignalLODs[C]||new S,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(f,z,w)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const C=this._materialIndexLOD-1;return this._materialSignalLODs[C]=this._materialSignalLODs[C]||new S,this._materialSignalLODs[C].promise.then((()=>this._loader.loadUriAsync(f,z,w)))}return null}loadBufferAsync(f,z,w,C){if(this._loader.parent.useRangeRequests&&!z.uri){if(!this._loader.bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);const z=(f,z)=>{const E=w,F=E+C-1;let J=f[z];return J?(J.start=Math.min(J.start,E),J.end=Math.max(J.end,F)):(J={start:E,end:F,loaded:new S},f[z]=J),J.loaded.promise.then((f=>new Uint8Array(f.buffer,f.byteOffset+w-J.start,C)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?z(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?z(this._materialBufferLODs,this._materialIndexLOD):z(this._bufferLODs,0)}return null}_loadBufferLOD(f,z){const w=f[z];w&&(this._loader.log(`Loading buffer range [${w.start}-${w.end}]`),this._loader.bin.readAsync(w.start,w.end-w.start+1).then((f=>{w.loaded.resolve(f)}),(f=>{w.loaded.reject(f)})))}_getLODs(f,z,w,S){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const C=[];for(let E=S.length-1;E>=0;E--)if(C.push(k.Get(`${f}/ids/${S[E]}`,w,S[E])),C.length===this.maxLODsToLoad)return C;return C.push(z),C}_disposeTransformNode(f){const z=[],w=f.material;w&&z.push(w);for(const C of f.getChildMeshes())C.material&&z.push(C.material);f.dispose();const S=z.filter((f=>this._loader.babylonScene.meshes.every((z=>z.material!=f))));this._disposeMaterials(S)}_disposeMaterials(f){const z={};for(const w of f){for(const f of w.getActiveTextures())z[f.uniqueId]=f;w.dispose()}for(const w in z)for(const f of this._loader.babylonScene.materials)f.hasTexture(z[w])&&delete z[w];for(const w in z)z[w].dispose()}}Q(oz),b(oz,!0,(f=>new pz(f)));const Yz="MSFT_minecraftMesh";class tz{constructor(f){this.name=Yz,this._loader=f,this.enabled=this._loader.isExtensionUsed(Yz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtraAsync(f,z,this.name,((S,C)=>{if(C){if(!(w instanceof M))throw new Error(`${S}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(f,z,w);return w.needAlphaBlending()&&(w.forceDepthWrite=!0,w.separateCullingPass=!0),w.mk=w.forceDepthWrite,w.twoSidedLighting=!0,C}return null}))}}Q(Yz),b(Yz,!0,(f=>new tz(f)));const Zz="MSFT_sRGBFactors";class bz{constructor(f){this.name=Zz,this._loader=f,this.enabled=this._loader.isExtensionUsed(Zz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,z,w){return j.LoadExtraAsync(f,z,this.name,((S,C)=>{if(C){if(!(w instanceof M))throw new Error(`${S}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(f,z,w),E=w.va().getEngine().useExactSrgbConversions;return w.albedoTexture||w.albedoColor.toLinearSpaceToRef(w.albedoColor,E),w.reflectivityTexture||w.reflectivityColor.toLinearSpaceToRef(w.reflectivityColor,E),C}return null}))}}Q(Zz),b(Zz,!0,(f=>new bz(f)));var Qz,gz=w(668);!function(f){f[f.Input=0]="Input",f[f.Output=1]="Output"}(Qz||(Qz={}));class kz{constructor(f,z,w){this._ownerBlock=w,this._connectedPoint=[],this.uniqueId=(0,gz.d)(),this.connectedPointIds=[],this.name=f,this._connectionType=z}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(f){if(this._connectionType===f._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||f._isSingularConnection()&&f._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(f),f._connectedPoint.push(this)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.uniqueId=this.uniqueId,f.name=this.name,f._connectionType=this._connectionType,f.connectedPointIds=[],f.className=this.getClassName();for(const z of this._connectedPoint)f.connectedPointIds.push(z.uniqueId)}getClassName(){return"FGConnection"}deserialize(f){this.uniqueId=f.uniqueId,this.name=f.name,this._connectionType=f._connectionType,this.connectedPointIds=f.connectedPointIds}static Parse(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1?arguments[1]:void 0;const w=new(F.h.Instantiate(f.className))(f.name,f._connectionType,z);return w.deserialize(f),w}}class jz{constructor(f){this.value=this._toInt(f)}_toInt(f){return 0|f}add(f){return new jz(this.value+f.value)}te(f){return new jz(this.value-f.value)}multiply(f){return new jz(Math.imul(this.value,f.value))}divide(f){return new jz(this.value/f.value)}getClassName(){return jz.ClassName}equals(f){return this.value===f.value}static Parse(f){return new jz(f.value)}}jz.ClassName="FlowGraphInteger",(0,D.f)("FlowGraphInteger",jz);class lz{constructor(f,z){this.typeName=f,this.defaultValue=z}serialize(f){f.typeName=this.typeName,f.defaultValue=this.defaultValue}static Parse(f){return new lz(f.typeName,f.defaultValue)}}const Nz=new lz("any",void 0),fw=(new lz("string",""),new lz("number",0)),zw=new lz("boolean",!1),ww=new lz("Vector2",C.l.Zero()),Sw=new lz("ek",C.n.Zero()),Cw=(new lz("Vector4",C.p.Zero()),new lz("Matrix",C.b.Identity())),Ew=(new lz("uk",E.d.Black()),new lz("vk",new E.f(0,0,0,0)),new lz("Quaternion",C.f.Identity()),new lz("FlowGraphInteger",new jz(0)));class Fw extends kz{constructor(f,z,w,S){super(f,z,w),this.richType=S}_isSingularConnection(){return 0===this.connectionType}setValue(f,z){z._setConnectionValue(this,f)}connectTo(f){super.connectTo(f)}_getValueOrDefault(f){return f._hasConnectionValue(this)?f._getConnectionValue(this):this.richType.defaultValue}getValue(f){return 1===this.connectionType?(f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(f),this._getValueOrDefault(f)):this.isConnected()?this._connectedPoint[0].getValue(f):this._getValueOrDefault(f)}getClassName(){return"FGDataConnection"}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.richType={},this.richType.serialize(f.richType)}static Parse(f,z){const w=kz.Parse(f,z);return w.richType=lz.Parse(f.richType),w}}function Jw(f){return"Mesh"===f||"AbstractMesh"===f||"GroundMesh"===f||"InstanceMesh"===f||"LinesMesh"===f||"GoldbergMesh"===f||"GreasedLineMesh"===f||"TrailMesh"===f}function xw(f){return"Vector2"===f||"ek"===f||"Vector4"===f||"Quaternion"===f||"uk"===f||"vk"===f}function uw(f,z,w){var S;const C=(null===z||void 0===z||null===(S=z.getClassName)||void 0===S?void 0:S.call(z))??"";Jw(C)?w[f]={name:z.name,className:C}:xw(C)?w[f]={value:z.kk(),className:C}:w[f]=z}function hw(f,z,w){const S=z[f];let F;const J=null===S||void 0===S?void 0:S.className;return F=Jw(J)?w.getMeshByName(S.name):xw(J)?function(f,z){if("Vector2"===f)return C.l.ck(z);if("ek"===f)return C.n.ck(z);if("Vector4"===f)return C.p.ck(z);if("Quaternion"===f)return C.f.ck(z);if("uk"===f)return new E.d(z[0],z[1],z[2]);if("vk"===f)return new E.f(z[0],z[1],z[2],z[3]);throw new Error(`Unknown vector class name ${f}`)}(J,S.value):"Matrix"===J?C.b.ck(S.value):J===jz.ClassName?jz.Parse(S):S&&void 0!==S.value?S.value:S,F}(0,D.f)("FGDataConnection",Fw);class Xw{constructor(f){var z;this.config=f,this.uniqueId=(0,gz.d)(),this.name=(null===(z=this.config)||void 0===z?void 0:z.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(f){}registerDataInput(f,z){const w=new Fw(f,0,this,z);return this.dataInputs.push(w),w}registerDataOutput(f,z){const w=new Fw(f,1,this,z);return this.dataOutputs.push(w),w}getDataInput(f){return this.dataInputs.find((z=>z.name===f))}getDataOutput(f){return this.dataOutputs.find((z=>z.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.uniqueId=this.uniqueId,f.config={},this.config&&(f.config.name=this.config.name),f.dataInputs=[],f.dataOutputs=[],f.className=this.getClassName();for(const z of this.dataInputs){const w={};z.serialize(w),f.dataInputs.push(w)}for(const z of this.dataOutputs){const w={};z.serialize(w),f.dataOutputs.push(w)}}getClassName(){return"FGBlock"}static Parse(f,z){const w=F.h.Instantiate(f.className),S={},C=z.valueParseFunction??hw;if(f.config)for(const F in f.config)S[F]=C(F,f.config,z.Rc);var E;("FGSetPropertyBlock"===(E=f.className)||"FGGetPropertyBlock"===E||"FGPlayAnimationBlock"===E||"FGMeshPickEventBlock"===E)&&(S.pathConverter=z.pathConverter);const J=new w(S);J.uniqueId=f.uniqueId;for(let F=0;F<f.dataInputs.length;F++){const z=J.getDataInput(f.dataInputs[F].name);if(!z)throw new Error("Could not find data input with name "+f.dataInputs[F].name+" in block "+f.className);z.deserialize(f.dataInputs[F])}for(let F=0;F<f.dataOutputs.length;F++){const z=J.getDataOutput(f.dataOutputs[F].name);if(!z)throw new Error("Could not find data output with name "+f.dataOutputs[F].name+" in block "+f.className);z.deserialize(f.dataOutputs[F])}return J.metadata=f.metadata,J.deserialize&&J.deserialize(f),J}}class Kw extends kz{_isSingularConnection(){return 1===this.connectionType}_activateSignal(f){var z;0===this.connectionType?(f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(f,this),f._increaseExecutionId()):null===(z=this._connectedPoint[0])||void 0===z||z._activateSignal(f)}}(0,D.f)("FlowGraphSignalConnection",Kw);class cw extends Xw{constructor(f){super(f),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(f){const z=new Kw(f,0,this);return this.signalInputs.push(z),z}_registerSignalOutput(f){const z=new Kw(f,1,this);return this.signalOutputs.push(z),z}getSignalInput(f){return this.signalInputs.find((z=>z.name===f))}getSignalOutput(f){return this.signalOutputs.find((z=>z.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.signalInputs=[],f.signalOutputs=[];for(const z of this.signalInputs){const w={};z.serialize(w),f.signalInputs.push(w)}for(const z of this.signalOutputs){const w={};z.serialize(w),f.signalOutputs.push(w)}}deserialize(f){for(let z=0;z<f.signalInputs.length;z++){const w=this.getSignalInput(f.signalInputs[z].name);if(!w)throw new Error("Could not find signal input with name "+f.signalInputs[z].name+" in block "+f.className);w.deserialize(f.signalInputs[z])}for(let z=0;z<f.signalOutputs.length;z++){const w=this.getSignalOutput(f.signalOutputs[z].name);if(!w)throw new Error("Could not find signal output with name "+f.signalOutputs[z].name+" in block "+f.className);w.deserialize(f.signalOutputs[z])}}getClassName(){return"FGExecutionBlock"}}class yw extends cw{constructor(f){super(f),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(f){this._preparePendingTasks(f),f._addPendingBlock(this)}}class ew extends yw{_execute(f){f._notifyExecuteNode(this),this.out._activateSignal(f)}}class Ow{constructor(f){this.uniqueId=(0,gz.d)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new h.c,this._configuration=f}hasVariable(f){return f in this._userVariables}setVariable(f,z){this._userVariables[f]=z}getVariable(f){return this._userVariables[f]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(f,z){return`${f.uniqueId}_${z}`}_setExecutionVariable(f,z,w){this._executionVariables[this._getUniqueIdPrefixedName(f,z)]=w}_getExecutionVariable(f,z,w){return this._hasExecutionVariable(f,z)?this._executionVariables[this._getUniqueIdPrefixedName(f,z)]:w}_deleteExecutionVariable(f,z){delete this._executionVariables[this._getUniqueIdPrefixedName(f,z)]}_hasExecutionVariable(f,z){return this._getUniqueIdPrefixedName(f,z)in this._executionVariables}_hasConnectionValue(f){return f.uniqueId in this._connectionValues}_setConnectionValue(f,z){this._connectionValues[f.uniqueId]=z}_getConnectionValue(f){return this._connectionValues[f.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(f){this._pendingBlocks.push(f)}_removePendingBlock(f){const z=this._pendingBlocks.indexOf(f);-1!==z&&this._pendingBlocks.splice(z,1)}_clearPendingBlocks(){for(const f of this._pendingBlocks)f._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(f){this.onNodeExecutedObservable.notifyObservers(f)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uw;f.uniqueId=this.uniqueId,f._userVariables={};for(const w in this._userVariables)z(w,this._userVariables[w],f._userVariables);f._connectionValues={};for(const w in this._connectionValues)z(w,this._connectionValues[w],f._connectionValues)}getClassName(){return"FGContext"}static Parse(f,z){const w=z.graph.createContext(),S=z.valueParseFunction??hw;w.uniqueId=f.uniqueId;for(const C in f._userVariables){const z=S(C,f._userVariables,w._configuration.Rc);w._userVariables[C]=z}for(const C in f._connectionValues){const z=S(C,f._connectionValues,w._configuration.Rc);w._connectionValues[C]=z}return w}}(0,V.b)([(0,W.O)()],Ow.prototype,"uniqueId",void 0);var dw,Bw,Vw=w(2412);function Ww(f,z){return!(!f.parent||f.parent!==z&&!Ww(f.parent,z))}class Tw extends ew{constructor(f){super(f),this.config=f}_getReferencedMesh(){const f=this.config.pathConverter.convert(this.config.path),z=f.info.getObject(f.object);if(!z||!(z instanceof R.c))throw new Error("Mesh pick event block requires a valid mesh");return z}_preparePendingTasks(f){let z=f._getExecutionVariable(this,"meshPickObserver");if(!z){const w=this._getReferencedMesh();f._setExecutionVariable(this,"mesh",w),z=w.va().onPointerObservable.add((z=>{var S,C,E;z.type===Vw.e.POINTERPICK&&null!==(S=z.pickInfo)&&void 0!==S&&S.pickedMesh&&((null===(C=z.pickInfo)||void 0===C?void 0:C.pickedMesh)===w||Ww(null===(E=z.pickInfo)||void 0===E?void 0:E.pickedMesh,w))&&this._execute(f)}));const S=w.ik.add((()=>this._onDispose));f._setExecutionVariable(this,"meshPickObserver",z),f._setExecutionVariable(this,"meshDisposeObserver",S)}}_onDispose(f){this._cancelPendingTasks(f),f._removePendingBlock(this)}_cancelPendingTasks(f){const z=f._getExecutionVariable(this,"mesh"),w=f._getExecutionVariable(this,"meshPickObserver"),S=f._getExecutionVariable(this,"meshDisposeObserver");z.va().onPointerObservable.remove(w),z.ik.remove(S),f._deleteExecutionVariable(this,"mesh"),f._deleteExecutionVariable(this,"meshPickObserver"),f._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Tw.ClassName}serialize(f){super.serialize(f),f.config.path=this.config.path}}Tw.ClassName="FGMeshPickEventBlock",(0,D.f)(Tw.ClassName,Tw),function(f){f[f.Stopped=0]="Stopped",f[f.Started=1]="Started"}(dw||(dw={}));class vw{constructor(f){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=f.Rc,this._coordinator=f.coordinator,this._sceneDisposeObserver=this._scene.ik.add((()=>this.dispose()))}createContext(){const f=new Ow({Rc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(f),f}getContext(f){return this._executionContexts[f]}addEventBlock(f){this._eventBlocks.push(f)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const f of this._executionContexts){const z=this._getContextualOrder();for(const w of z)w._startPendingTasks(f)}}}_getContextualOrder(){const f=[];for(const z of this._eventBlocks)if(z.getClassName()===Tw.ClassName){const w=z._getReferencedMesh();let S=0;for(;S<f.length;S++){const z=f[S]._getReferencedMesh();if(w&&z&&Ww(w,z))break}f.splice(S,0,z)}else f.push(z);return f}dispose(){if(0!==this.state){this.state=0;for(const f of this._executionContexts)f._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.ik.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(f){const z=[],w=new Set;for(const S of this._eventBlocks)z.push(S),w.add(S.uniqueId);for(;z.length>0;){const S=z.pop();f(S);for(const f of S.dataInputs)for(const S of f._connectedPoint)w.has(S._ownerBlock.uniqueId)||(z.push(S._ownerBlock),w.add(S._ownerBlock.uniqueId));if(S instanceof cw)for(const f of S.signalOutputs)for(const S of f._connectedPoint)w.has(S._ownerBlock.uniqueId)||(z.push(S._ownerBlock),w.add(S._ownerBlock.uniqueId))}}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1?arguments[1]:void 0;f.allBlocks=[],this.visitAllBlocks((z=>{const w={};z.serialize(w),f.allBlocks.push(w)})),f.executionContexts=[];for(const w of this._executionContexts){const S={};w.serialize(S,z),f.executionContexts.push(S)}}static GetDataOutConnectionByUniqueId(f,z){for(const w of f)for(const f of w.dataOutputs)if(f.uniqueId===z)return f;throw new Error("Could not find data out connection with unique id "+z)}static GetSignalInConnectionByUniqueId(f,z){for(const w of f)if(w instanceof cw)for(const f of w.signalInputs)if(f.uniqueId===z)return f;throw new Error("Could not find signal in connection with unique id "+z)}static Parse(f,z){const w=z.coordinator.createGraph(),S=[],C=z.valueParseFunction??hw;for(const E of f.allBlocks){const f=Xw.Parse(E,{Rc:z.coordinator.config.Rc,pathConverter:z.pathConverter,valueParseFunction:C});S.push(f),f instanceof ew&&w.addEventBlock(f)}for(const E of S){for(const f of E.dataInputs)for(const z of f.connectedPointIds){const w=vw.GetDataOutConnectionByUniqueId(S,z);f.connectTo(w)}if(E instanceof cw)for(const f of E.signalOutputs)for(const z of f.connectedPointIds){const w=vw.GetSignalInConnectionByUniqueId(S,z);f.connectTo(w)}}for(const E of f.executionContexts)Ow.Parse(E,{graph:w,valueParseFunction:C});return w}}class Dw{constructor(f){this.config=f,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Rc.ik.add((()=>{this.dispose()}));(Dw.SceneCoordinators.get(this.config.Rc)??[]).push(this)}createGraph(){const f=new vw({Rc:this.config.Rc,coordinator:this});return this._flowGraphs.push(f),f}removeGraph(f){const z=this._flowGraphs.indexOf(f);-1!==z&&(f.dispose(),this._flowGraphs.splice(z,1))}start(){this._flowGraphs.forEach((f=>f.start()))}dispose(){this._flowGraphs.forEach((f=>f.dispose())),this._flowGraphs.length=0;const f=Dw.SceneCoordinators.get(this.config.Rc)??[],z=f.indexOf(this);-1!==z&&f.splice(z,1)}serialize(f,z){f._flowGraphs=[],this._flowGraphs.forEach((w=>{const S={};w.serialize(S,z),f._flowGraphs.push(S)}))}static Parse(f,z){var w;const S=z.valueParseFunction??hw,C=new Dw({Rc:z.Rc});return null===(w=f._flowGraphs)||void 0===w||w.forEach((f=>{vw.Parse(f,{coordinator:C,valueParseFunction:S,pathConverter:z.pathConverter})})),C}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(f){let z=this._customEventsMap.get(f);return z||(z=new h.c,this._customEventsMap.set(f,z)),z}notifyCustomEvent(f,z){const w=this._customEventsMap.get(f);w&&w.notifyObservers(z)}}Dw.SceneCoordinators=new Map;class Aw extends ew{_preparePendingTasks(f){if(!f._getExecutionVariable(this,"sceneReadyObserver")){const z=f.configuration.Rc.onReadyObservable.add((()=>{this._execute(f)}));f._setExecutionVariable(this,"sceneReadyObserver",z)}}_cancelPendingTasks(f){const z=f._getExecutionVariable(this,"sceneReadyObserver");f.configuration.Rc.onReadyObservable.remove(z),f._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Aw.ClassName}}Aw.ClassName="FGSceneReadyEventBlock",(0,D.f)("FGSceneReadyEventBlock",Aw);class Mw extends ew{_preparePendingTasks(f){if(!f._getExecutionVariable(this,"sceneBeforeRender")){const z=f.configuration.Rc.onBeforeRenderObservable.add((()=>{this._execute(f)}));f._setExecutionVariable(this,"sceneBeforeRender",z)}}_cancelPendingTasks(f){const z=f._getExecutionVariable(this,"sceneBeforeRender");f.configuration.Rc.onBeforeRenderObservable.remove(z),f._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return Mw.ClassName}}Mw.ClassName="FGSceneTickEventBlock",(0,D.f)(Mw.ClassName,Mw);class Gw extends cw{constructor(f){super(f),this.out=this._registerSignalOutput("out")}}class Iw extends Gw{constructor(f){super(f),this.message=this.registerDataInput("message",Nz)}_execute(f){const z=this.message.getValue(f);e.b.Log(z),this.out._activateSignal(f)}getClassName(){return Iw.ClassName}}Iw.ClassName="FGConsoleLogBlock",(0,D.f)(Iw.ClassName,Iw),function(f){f[f.INIT=0]="INIT",f[f.STARTED=1]="STARTED",f[f.ENDED=2]="ENDED"}(Bw||(Bw={}));class nw{constructor(f){this.onEachCountObservable=new h.c,this.onTimerAbortedObservable=new h.c,this.onTimerEndedObservable=new h.c,this.onStateChangedObservable=new h.c,this._observer=null,this._breakOnNextTick=!1,this._tick=f=>{const z=Date.now();this._timer=z-this._startTime;const w={startTime:this._startTime,currentTime:z,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:f},S=this._breakOnNextTick||this._breakCondition(w);S||this._timer>=this._timeToEnd?this._stop(w,S):this.onEachCountObservable.notifyObservers(w)},this._setState(0),this._contextObservable=f.contextObservable,this._observableParameters=f.observableParameters??{},this._breakCondition=f.breakCondition??(()=>!1),this._timeToEnd=f.timeout,f.onEnded&&this.onTimerEndedObservable.add(f.onEnded),f.Uk&&this.onEachCountObservable.add(f.Uk),f.onAborted&&this.onTimerAbortedObservable.add(f.onAborted)}set breakCondition(f){this._breakCondition=f}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=f,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(f){this._state=f,this.onStateChangedObservable.notifyObservers(this._state)}_stop(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),z?this.onTimerAbortedObservable.notifyObservers(f):this.onTimerEndedObservable.notifyObservers(f)}}class Pw extends yw{constructor(f){super(f),this.timeout=this.registerDataInput("timeout",fw)}_preparePendingTasks(f){const z=this.timeout.getValue(f);if(void 0!==z&&z>=0){const w=f._getExecutionVariable(this,"runningTimers")||[],S=f.configuration.Rc,C=new nw({timeout:z,contextObservable:S.onBeforeRenderObservable,onEnded:()=>this._onEnded(C,f)});C.start(),w.push(C),f._setExecutionVariable(this,"runningTimers",w)}}_execute(f){this._startPendingTasks(f),this.out._activateSignal(f)}_onEnded(f,z){const w=z._getExecutionVariable(this,"runningTimers")||[],S=w.indexOf(f);-1!==S?w.splice(S,1):F.h.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),z._removePendingBlock(this),this.done._activateSignal(z)}_cancelPendingTasks(f){const z=f._getExecutionVariable(this,"runningTimers")||[];for(const w of z)w.dispose();f._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Pw.ClassName}}Pw.ClassName="FGTimerBlock",(0,D.f)("FGTimerBlock",Pw);class Rw extends Gw{constructor(f){super(f),this.config=f;for(let z=0;z<this.config.eventData.length;z++){const f=this.config.eventData[z];this.registerDataInput(f,Nz)}}_execute(f){const z=this.config.eventId,w=this.dataInputs.map((z=>z.getValue(f)));f.configuration.coordinator.notifyCustomEvent(z,w),this.out._activateSignal(f)}getClassName(){return Rw.ClassName}}Rw.ClassName="FGSendCustomEventBlock",(0,D.f)("FGSendCustomEventBlock",Rw);class qw extends ew{constructor(f){super(f),this.config=f;for(let z=0;z<this.config.eventData.length;z++){const f=this.config.eventData[z];this.registerDataOutput(f,Nz)}}_preparePendingTasks(f){const z=f.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=z.add((z=>{for(let w=0;w<z.length;w++)this.dataOutputs[w].setValue(z[w],f);this._execute(f)}))}_cancelPendingTasks(f){const z=f.configuration.coordinator.getCustomEventObservable(this.config.eventId);z?z.remove(this._eventObserver):F.h.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return qw.ClassName}serialize(f){super.serialize(f),f.eventId=this.config.eventId,f.eventData=this.config.eventData}}qw.ClassName="FGReceiveCustomEventBlock",(0,D.f)(qw.ClassName,qw);class aw extends cw{constructor(f){super(f),this.config=f,this.outFlows=[];for(let z=0;z<this.config.numberOutputFlows;z++)this.outFlows.push(this._registerSignalOutput(`${z}`))}_execute(f){for(let z=0;z<this.config.numberOutputFlows;z++)this.outFlows[z]._activateSignal(f)}getClassName(){return aw.ClassName}}aw.ClassName="FGSequenceBlock",(0,D.f)(aw.ClassName,aw);const sw=new RegExp(/\{(\w+)\}/g);class Hw{constructor(f,z){this.path=f,this.ownerBlock=z,this.templatedInputs=[];let w=sw.exec(f);for(;w;){const[,S]=w;this.templatedInputs.push(z.registerDataInput(S,Ew)),w=sw.exec(f)}}getAccessor(f,z){let w=this.path;for(const S of this.templatedInputs){const f=S.getValue(z).value;w=w.replace(`{${S.name}}`,f.toString())}return f.convert(w)}}class Lw extends Xw{constructor(f){super(f),this.config=f,this.value=this.registerDataOutput("value",Nz),this.templateComponent=new Hw(f.path,this)}_updateOutputs(f){const z=this.templateComponent.getAccessor(this.config.pathConverter,f),w=z.info.get(z.object);this.value.setValue(w,f)}getClassName(){return Lw.ClassName}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.config.path=this.config.path}}Lw.ClassName="FGGetPropertyBlock",(0,D.f)(Lw.ClassName,Lw);class Uw extends Gw{constructor(f){super(f),this.config=f,this.a=this.registerDataInput("a",Nz),this.templateComponent=new Hw(f.path,this)}_execute(f){const z=this.a.getValue(f),w=this.templateComponent.getAccessor(this.config.pathConverter,f);w.info.set(z,w.object),this.out._activateSignal(f)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.config.path=this.config.path}getClassName(){return Uw.ClassName}}Uw.ClassName="FGSetPropertyBlock",(0,D.f)("FGSetPropertyBlock",Uw);const iw="cachedOperationValue",mw="cachedExecutionId";class rw extends Xw{constructor(f,z){super(z),this.value=this.registerDataOutput("value",f)}_updateOutputs(f){const z=f._getExecutionVariable(this,mw),w=f._getExecutionVariable(this,iw);if(void 0!==w&&z===f.executionId)this.value.setValue(w,f);else{const z=this._doOperation(f);f._setExecutionVariable(this,iw,z),f._setExecutionVariable(this,mw,f.executionId),this.value.setValue(z,f)}}}class ow extends rw{constructor(f,z,w,S,C,E){super(w,E),this._operation=S,this._className=C,this.a=this.registerDataInput("a",f),this.b=this.registerDataInput("b",z)}_doOperation(f){return this._operation(this.a.getValue(f),this.b.getValue(f))}getClassName(){return this._className}}class pw extends rw{constructor(f,z,w,S){super(f,S),this._operation=z,this._className=w}_doOperation(f){return this._operation()}getClassName(){return this._className}}class Yw extends rw{constructor(f,z,w,S,C){super(z,C),this._operation=w,this._className=S,this.a=this.registerDataInput("a",f)}_doOperation(f){return this._operation(this.a.getValue(f))}getClassName(){return this._className}}class tw extends rw{constructor(f,z,w,S,C,E,F){super(S,F),this._operation=C,this._className=E,this.a=this.registerDataInput("a",f),this.b=this.registerDataInput("b",z),this.c=this.registerDataInput("c",w)}_doOperation(f){return this._operation(this.a.getValue(f),this.b.getValue(f),this.c.getValue(f))}getClassName(){return this._className}}function Zw(f){return f.getClassName?f.getClassName():""}function bw(f,z){return"Vector2"===f&&"Vector2"===z||"ek"===f&&"ek"===z||"Vector4"===f&&"Vector4"===z}function Qw(f,z){return"Matrix"===f&&"Matrix"===z}function gw(f,z){return"FlowGraphInteger"===f&&"FlowGraphInteger"===z}class kw extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicAdd(f,z)),kw.ClassName,f)}_polymorphicAdd(f,z){const w=Zw(f),S=Zw(z);return bw(w,S)||Qw(w,S)||gw(w,S)?f.add(z):f+z}}kw.ClassName="FGAddBlock",(0,D.f)(kw.ClassName,kw);class jw extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicAdd(f,z)),jw.ClassName,f)}_polymorphicAdd(f,z){const w=Zw(f),S=Zw(z);return bw(w,S)||gw(w,S)?f.te(z):Qw(w,S)?f.add(z.scale(-1)):f-z}}jw.ClassName="FGSubBlock",(0,D.f)(jw.ClassName,jw);class lw extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicMultiply(f,z)),lw.ClassName,f)}_polymorphicMultiply(f,z){const w=Zw(f),S=Zw(z);return bw(w,S)||gw(w,S)?f.multiply(z):Qw(w,S)?C.b.FromValues(f.m[0]*z.m[0],f.m[4]*z.m[4],f.m[8]*z.m[8],f.m[12]*z.m[12],f.m[1]*z.m[1],f.m[5]*z.m[5],f.m[9]*z.m[9],f.m[13]*z.m[13],f.m[2]*z.m[2],f.m[6]*z.m[6],f.m[10]*z.m[10],f.m[14]*z.m[14],f.m[3]*z.m[3],f.m[7]*z.m[7],f.m[11]*z.m[11],f.m[15]*z.m[15]):f*z}}lw.ClassName="FGMultiplyBlock",(0,D.f)(lw.ClassName,lw);class Nw extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicDivide(f,z)),Nw.ClassName,f)}_polymorphicDivide(f,z){const w=Zw(f),S=Zw(z);return bw(w,S)||gw(w,S)?f.divide(z):Qw(w,S)?C.b.FromValues(f.m[0]/z.m[0],f.m[4]/z.m[4],f.m[8]/z.m[8],f.m[12]/z.m[12],f.m[1]/z.m[1],f.m[5]/z.m[5],f.m[9]/z.m[9],f.m[13]/z.m[13],f.m[2]/z.m[2],f.m[6]/z.m[6],f.m[10]/z.m[10],f.m[14]/z.m[14],f.m[3]/z.m[3],f.m[7]/z.m[7],f.m[11]/z.m[11],f.m[15]/z.m[15]):f/z}}Nw.ClassName="FGDivideBlock",(0,D.f)(Nw.ClassName,Nw);class fS extends pw{constructor(f){super(fw,(()=>Math.random()),fS.ClassName,f)}}fS.ClassName="FGRandomBlock",(0,D.f)(fS.ClassName,fS);class zS extends ow{constructor(f){super(Nz,Nz,fw,((f,z)=>this._polymorphicDot(f,z)),zS.ClassName,f)}_polymorphicDot(f,z){switch(Zw(f)){case"Vector2":return C.l.Dot(f,z);case"ek":return C.n.Dot(f,z);case"Vector4":return C.p.Dot(f,z);default:throw new Error(`Cannot get dot product of ${f} and ${z}`)}}}zS.ClassName="FGDotBlock",(0,D.f)(zS.ClassName,zS);class wS extends pw{constructor(f){super(fw,(()=>Math.E),wS.ClassName,f)}}wS.ClassName="FGEBlock",(0,D.f)(wS.ClassName,wS);class SS extends pw{constructor(f){super(fw,(()=>Math.PI),SS.ClassName,f)}}SS.ClassName="FGPIBlock",(0,D.f)(SS.ClassName,SS);class CS extends pw{constructor(f){super(fw,(()=>Number.POSITIVE_INFINITY),CS.ClassName,f)}}CS.ClassName="FGInfBlock",(0,D.f)(CS.ClassName,CS);class ES extends pw{constructor(f){super(fw,(()=>Number.NaN),ES.ClassName,f)}}function FS(f,z){switch(Zw(f)){case"FlowGraphInteger":return new jz(z(f.value));case"Vector2":return new C.l(z(f.x),z(f.y));case"ek":return new C.n(z(f.x),z(f.y),z(f.z));case"Vector4":return new C.p(z(f.x),z(f.y),z(f.z),z(f.w));case"Matrix":return C.b.FromValues(z(f.m[0]),z(f.m[4]),z(f.m[8]),z(f.m[12]),z(f.m[1]),z(f.m[5]),z(f.m[9]),z(f.m[13]),z(f.m[2]),z(f.m[6]),z(f.m[10]),z(f.m[14]),z(f.m[3]),z(f.m[7]),z(f.m[11]),z(f.m[15]));default:return z(f)}}ES.ClassName="FGNaNBlock",(0,D.f)(ES.ClassName,ES);class JS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicAbs(f)),JS.ClassName,f)}_polymorphicAbs(f){return FS(f,Math.abs)}}JS.ClassName="FGAbsBlock",(0,D.f)(JS.ClassName,JS);class xS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicSign(f)),xS.ClassName,f)}_polymorphicSign(f){return FS(f,Math.sign)}}xS.ClassName="FGSignBlock",(0,D.f)(xS.ClassName,xS);class uS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicTrunc(f)),uS.ClassName,f)}_polymorphicTrunc(f){return FS(f,Math.trunc)}}uS.ClassName="FGTruncBlock",(0,D.f)(uS.ClassName,uS);class hS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicFloor(f)),hS.ClassName,f)}_polymorphicFloor(f){return FS(f,Math.floor)}}hS.ClassName="FGFloorBlock",(0,D.f)(hS.ClassName,hS);class XS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicCeiling(f)),XS.ClassName,f)}_polymorphicCeiling(f){return FS(f,Math.ceil)}}XS.ClassName="FGCeilBlock",(0,D.f)(XS.ClassName,XS);class KS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicFract(f)),KS.ClassName,f)}_polymorphicFract(f){return FS(f,(f=>f-Math.floor(f)))}}KS.ClassName="FGFractBlock",(0,D.f)(KS.ClassName,KS);class cS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicNeg(f)),cS.ClassName,f)}_polymorphicNeg(f){return FS(f,(f=>-f))}}function yS(f,z,w){switch(Zw(f)){case"FlowGraphInteger":return new jz(w(f.value,z.value));case"Vector2":return new C.l(w(f.x,z.x),w(f.y,z.y));case"ek":return new C.n(w(f.x,z.x),w(f.y,z.y),w(f.z,z.z));case"Vector4":return new C.p(w(f.x,z.x),w(f.y,z.y),w(f.z,z.z),w(f.w,z.w));case"Matrix":return C.b.FromValues(w(f.m[0],z.m[0]),w(f.m[4],z.m[4]),w(f.m[8],z.m[8]),w(f.m[12],z.m[12]),w(f.m[1],z.m[1]),w(f.m[5],z.m[5]),w(f.m[9],z.m[9]),w(f.m[13],z.m[13]),w(f.m[2],z.m[2]),w(f.m[6],z.m[6]),w(f.m[10],z.m[10]),w(f.m[14],z.m[14]),w(f.m[3],z.m[3]),w(f.m[7],z.m[7]),w(f.m[11],z.m[11]),w(f.m[15],z.m[15]));default:return w(f,z)}}cS.ClassName="FGNegBlock",(0,D.f)(cS.ClassName,cS);class eS extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicRemainder(f,z)),eS.ClassName,f)}_polymorphicRemainder(f,z){return yS(f,z,((f,z)=>f%z))}}eS.ClassName="FGRemainderBlock",(0,D.f)(eS.ClassName,eS);class OS extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicMin(f,z)),OS.ClassName,f)}_polymorphicMin(f,z){return yS(f,z,Math.min)}}OS.ClassName="FGMinBlock",(0,D.f)(OS.ClassName,OS);class dS extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicMax(f,z)),dS.ClassName,f)}_polymorphicMax(f,z){return yS(f,z,Math.max)}}function BS(f,z,w){return Math.min(Math.max(f,Math.min(z,w)),Math.max(z,w))}function VS(f,z,w,S){switch(Zw(f)){case"FlowGraphInteger":return new jz(S(f.value,z.value,w.value));case"Vector2":return new C.l(S(f.x,z.x,w.x),S(f.y,z.y,w.y));case"ek":return new C.n(S(f.x,z.x,w.x),S(f.y,z.y,w.y),S(f.z,z.z,w.z));case"Vector4":return new C.p(S(f.x,z.x,w.x),S(f.y,z.y,w.y),S(f.z,z.z,w.z),S(f.w,z.w,w.w));case"Matrix":return C.b.FromValues(S(f.m[0],z.m[0],w.m[0]),S(f.m[4],z.m[4],w.m[4]),S(f.m[8],z.m[8],w.m[8]),S(f.m[12],z.m[12],w.m[12]),S(f.m[1],z.m[1],w.m[1]),S(f.m[5],z.m[5],w.m[5]),S(f.m[9],z.m[9],w.m[9]),S(f.m[13],z.m[13],w.m[13]),S(f.m[2],z.m[2],w.m[2]),S(f.m[6],z.m[6],w.m[6]),S(f.m[10],z.m[10],w.m[10]),S(f.m[14],z.m[14],w.m[14]),S(f.m[3],z.m[3],w.m[3]),S(f.m[7],z.m[7],w.m[7]),S(f.m[11],z.m[11],w.m[11]),S(f.m[15],z.m[15],w.m[15]));default:return S(f,z,w)}}dS.ClassName="FGMaxBlock",(0,D.f)(dS.ClassName,dS);class WS extends tw{constructor(f){super(Nz,Nz,Nz,Nz,((f,z,w)=>this._polymorphicClamp(f,z,w)),WS.ClassName,f)}_polymorphicClamp(f,z,w){return VS(f,z,w,BS)}}function TS(f){return Math.min(Math.max(f,0),1)}WS.ClassName="FGClampBlock",(0,D.f)(WS.ClassName,WS);class vS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicSaturate(f)),vS.ClassName,f)}_polymorphicSaturate(f){return FS(f,TS)}}vS.ClassName="FGSaturateBlock",(0,D.f)(vS.ClassName,vS);class DS extends tw{constructor(f){super(Nz,Nz,Nz,Nz,((f,z,w)=>this._polymorphicInterpolate(f,z,w)),DS.ClassName,f)}_interpolate(f,z,w){return(1-w)*f+w*z}_polymorphicInterpolate(f,z,w){return VS(f,z,w,this._interpolate)}}DS.ClassName="FGInterpolateBlock",(0,D.f)(DS.ClassName,DS);class AS extends ow{constructor(f){super(Nz,Nz,zw,((f,z)=>this._polymorphicEq(f,z)),AS.ClassName,f)}_polymorphicEq(f,z){const w=Zw(f),S=Zw(z);return bw(w,S)||Qw(w,S)||gw(w,S)?f.equals(z):f===z}}function MS(f,z,w){const S=Zw(f);if(S===Zw(z)){if(""===S)return w(f,z);if("FlowGraphInteger"===S)return w(f.value,z.value);throw new Error(`Cannot compare ${f} and ${z}`)}throw new Error(`${f} and ${z} are of different types.`)}AS.ClassName="FGEqBlock",(0,D.f)(AS.ClassName,AS);class GS extends ow{constructor(f){super(Nz,Nz,zw,((f,z)=>this._polymorphicLessThan(f,z)),GS.ClassName,f)}_polymorphicLessThan(f,z){return MS(f,z,((f,z)=>f<z))}}GS.ClassName="FGLessThanBlock",(0,D.f)(GS.ClassName,GS);class IS extends ow{constructor(f){super(Nz,Nz,zw,((f,z)=>this._polymorphicLessThanOrEqual(f,z)),IS.ClassName,f)}_polymorphicLessThanOrEqual(f,z){return MS(f,z,((f,z)=>f<=z))}}IS.ClassName="FGLessThanOrEqualBlock";class nS extends ow{constructor(f){super(Nz,Nz,zw,((f,z)=>this._polymorphicGreaterThan(f,z)),nS.ClassName,f)}_polymorphicGreaterThan(f,z){return MS(f,z,((f,z)=>f>z))}}nS.ClassName="FGGreaterThanBlock",(0,D.f)(nS.ClassName,nS);class PS extends ow{constructor(f){super(Nz,Nz,zw,((f,z)=>this._polymorphicGreaterThanOrEqual(f,z)),PS.ClassName,f)}_polymorphicGreaterThanOrEqual(f,z){return MS(f,z,((f,z)=>f>=z))}}PS.ClassName="FGGreaterThanOrEqualBlock",(0,D.f)(PS.ClassName,PS);class RS extends Yw{constructor(f){super(Nz,zw,(f=>this._polymorphicIsNan(f)),RS.ClassName,f)}_polymorphicIsNan(f){const z=Zw(f);if(""===z)return isNaN(f);if("FlowGraphInteger"===z)return isNaN(f.value);throw new Error(`Cannot get NaN of ${f}`)}}RS.ClassName="FGIsNanBlock",(0,D.f)(RS.ClassName,RS);class qS extends Yw{constructor(f){super(Nz,zw,(f=>this._polymorphicIsInf(f)),qS.ClassName,f)}_polymorphicIsInf(f){const z=Zw(f);if(""===z)return!isFinite(f);if("FlowGraphInteger"===z)return!isFinite(f.value);throw new Error(`Cannot get isInf of ${f}`)}}qS.ClassName="FGIsInfBlock";class aS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicDegToRad(f)),aS.ClassName,f)}_degToRad(f){return f*Math.PI/180}_polymorphicDegToRad(f){return FS(f,this._degToRad)}}aS.ClassName="FGDegToRadBlock",(0,D.f)(aS.ClassName,aS);class sS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicRadToDeg(f)),sS.ClassName,f)}_radToDeg(f){return 180*f/Math.PI}_polymorphicRadToDeg(f){return FS(f,this._radToDeg)}}sS.ClassName="FGRadToDegBlock",(0,D.f)(sS.ClassName,sS);class HS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicSin(f)),HS.ClassName,f)}_polymorphicSin(f){return FS(f,Math.sin)}}HS.ClassName="FGSinBlock",(0,D.f)(HS.ClassName,HS);class LS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicCos(f)),LS.ClassName,f)}_polymorphicCos(f){return FS(f,Math.cos)}}LS.ClassName="FGCosBlock",(0,D.f)(LS.ClassName,LS);class US extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicTan(f)),US.ClassName,f)}_polymorphicTan(f){return FS(f,Math.tan)}}US.ClassName="FGTanBlock",(0,D.f)(US.ClassName,US);class iS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicAsin(f)),iS.ClassName,f)}_polymorphicAsin(f){return FS(f,Math.asin)}}iS.ClassName="FGAsinBlock",(0,D.f)(iS.ClassName,iS);class mS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicAcos(f)),mS.ClassName,f)}_polymorphicAcos(f){return FS(f,Math.acos)}}mS.ClassName="FGAcosBlock",(0,D.f)(mS.ClassName,mS);class rS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicAtan(f)),rS.ClassName,f)}_polymorphicAtan(f){return FS(f,Math.atan)}}rS.ClassName="FGAtanBlock",(0,D.f)(rS.ClassName,rS);class oS extends ow{constructor(f){super(Nz,Nz,Nz,((f,z)=>this._polymorphicAtan2(f,z)),oS.ClassName,f)}_polymorphicAtan2(f,z){return yS(f,z,Math.atan2)}}oS.ClassName="FGAtan2Block",(0,D.f)(oS.ClassName,oS);class pS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicSinh(f)),pS.ClassName,f)}_polymorphicSinh(f){return FS(f,Math.sinh)}}pS.ClassName="FGSinhBlock",(0,D.f)(pS.ClassName,pS);class YS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicCosh(f)),YS.ClassName,f)}_polymorphicCosh(f){return FS(f,Math.cosh)}}YS.ClassName="FGCoshBlock",(0,D.f)(YS.ClassName,YS);class tS extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicTanh(f)),tS.ClassName,f)}_polymorphicTanh(f){return FS(f,Math.tanh)}}tS.ClassName="FGTanhBlock",(0,D.f)(tS.ClassName,tS);class ZS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicAsinh(f)),ZS.ClassName,f)}_polymorphicAsinh(f){return FS(f,Math.asinh)}}ZS.ClassName="FGAsinhBlock",(0,D.f)(ZS.ClassName,ZS);class bS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicAcosh(f)),bS.ClassName,f)}_polymorphicAcosh(f){return FS(f,Math.acosh)}}bS.ClassName="FGAcoshBlock",(0,D.f)(bS.ClassName,bS);class QS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicAtanh(f)),QS.ClassName,f)}_polymorphicAtanh(f){return FS(f,Math.atanh)}}QS.ClassName="FGAtanhBlock",(0,D.f)(QS.ClassName,QS);class gS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicExp(f)),gS.ClassName,f)}_polymorphicExp(f){return FS(f,Math.exp)}}gS.ClassName="FGExpBlock",(0,D.f)(gS.ClassName,gS);class kS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicLog(f)),kS.ClassName,f)}_polymorphicLog(f){return FS(f,Math.log)}}kS.ClassName="FGLogBlock",(0,D.f)(kS.ClassName,kS);class jS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicLog2(f)),jS.ClassName,f)}_polymorphicLog2(f){return FS(f,Math.log2)}}jS.ClassName="FGLog2Block",(0,D.f)(jS.ClassName,jS);class lS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicLog10(f)),lS.ClassName,f)}_polymorphicLog10(f){return FS(f,Math.log10)}}lS.ClassName="FGLog10Block",(0,D.f)(lS.ClassName,lS);class NS extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicSqrt(f)),NS.ClassName,f)}_polymorphicSqrt(f){return FS(f,Math.sqrt)}}NS.ClassName="FGSqrtBlock",(0,D.f)(NS.ClassName,NS);class fC extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicCubeRoot(f)),fC.ClassName,f)}_polymorphicCubeRoot(f){return FS(f,Math.cbrt)}}fC.ClassName="FGCubeRootBlock",(0,D.f)(fC.ClassName,fC);class zC extends ow{constructor(f){super(Nz,fw,fw,((f,z)=>this._polymorphicPow(f,z)),zC.ClassName,f)}_polymorphicPow(f,z){return yS(f,z,Math.pow)}}zC.ClassName="FGPowBlock",(0,D.f)(zC.ClassName,zC);class wC extends Yw{constructor(f){super(Nz,fw,(f=>this._polymorphicLength(f)),wC.ClassName,f)}_polymorphicLength(f){switch(Zw(f)){case"Vector2":case"ek":case"Vector4":return f.length();default:throw new Error(`Cannot compute length of value ${f}`)}}}wC.ClassName="FGLengthBlock",(0,D.f)(wC.ClassName,wC);class SC extends Yw{constructor(f){super(Nz,Nz,(f=>this._polymorphicNormalize(f)),SC.ClassName,f)}_polymorphicNormalize(f){switch(Zw(f)){case"Vector2":case"ek":case"Vector4":return f.normalize();default:throw new Error(`Cannot normalize value ${f}`)}}}SC.ClassName="FGNormalizeBlock",(0,D.f)(SC.ClassName,SC);class CC extends ow{constructor(f){super(Sw,Sw,Sw,((f,z)=>C.n.Cross(f,z)),CC.ClassName,f)}}CC.ClassName="FGCrossBlock",(0,D.f)(CC.ClassName,CC);class EC extends ow{constructor(f){super(ww,fw,ww,((f,z)=>C.l.Transform(f,C.b.RotationZ(z))),EC.ClassName,f)}}EC.ClassName="FGRotate2DBlock",(0,D.f)(EC.ClassName,EC);class FC extends tw{constructor(f){super(Sw,Sw,fw,Sw,((f,z,w)=>C.n.TransformCoordinates(f,C.b.RotationAxis(z,w))),FC.ClassName,f)}}FC.ClassName="FGRotate3DBlock",(0,D.f)(FC.ClassName,FC);class JC extends Yw{constructor(f){super(Cw,Cw,(f=>C.b.Transpose(f)),JC.ClassName,f)}}JC.ClassName="FGTransposeBlock",(0,D.f)(JC.ClassName,JC);class xC extends Yw{constructor(f){super(Cw,fw,(f=>f.determinant()),xC.ClassName,f)}}xC.ClassName="FGDeterminantBlock",(0,D.f)(xC.ClassName,xC);class uC extends Yw{constructor(f){super(Cw,Cw,(f=>C.b.Invert(f)),uC.ClassName,f)}}uC.ClassName="FGInvertMatrixBlock",(0,D.f)(uC.ClassName,uC);class hC extends ow{constructor(f){super(Cw,Cw,Cw,((f,z)=>z.multiply(f)),hC.ClassName,f)}}hC.ClassName="FGMatMulBlock",(0,D.f)(hC.ClassName,hC);class XC extends Yw{constructor(f){super(Ew,Ew,(f=>new jz(~f.value)),XC.ClassName,f)}}XC.ClassName="FGBitwiseNotBlock",(0,D.f)(XC.ClassName,XC);class KC extends ow{constructor(f){super(Ew,Ew,Ew,((f,z)=>new jz(f.value&z.value)),KC.ClassName,f)}}KC.ClassName="FGBitwiseAndBlock",(0,D.f)(KC.ClassName,KC);class cC extends ow{constructor(f){super(Ew,Ew,Ew,((f,z)=>new jz(f.value|z.value)),cC.ClassName,f)}}cC.ClassName="FGBitwiseOrBlock",(0,D.f)(cC.ClassName,cC);class yC extends ow{constructor(f){super(Ew,Ew,Ew,((f,z)=>new jz(f.value^z.value)),yC.ClassName,f)}}yC.ClassName="FGBitwiseXorBlock",(0,D.f)(yC.ClassName,yC);class eC extends ow{constructor(f){super(Ew,Ew,Ew,((f,z)=>new jz(f.value<<z.value)),eC.ClassName,f)}}eC.ClassName="FGBitwiseLeftShiftBlock",(0,D.f)(eC.ClassName,eC);class OC extends ow{constructor(f){super(Ew,Ew,Ew,((f,z)=>new jz(f.value>>z.value)),OC.ClassName,f)}}OC.ClassName="FGBitwiseRightShiftBlock",(0,D.f)(OC.ClassName,OC);class dC extends Yw{constructor(f){super(Ew,Ew,(f=>new jz(Math.clz32(f.value))),dC.ClassName,f)}}dC.ClassName="FGCountLeadingZerosBlock",(0,D.f)(dC.ClassName,dC);class BC extends Yw{constructor(f){super(Ew,Ew,(f=>new jz(f.value?31-Math.clz32(f.value&-f.value):32)),BC.ClassName,f)}}BC.ClassName="FGCountTrailingZerosBlock",(0,D.f)(BC.ClassName,BC);class VC extends Yw{constructor(f){super(Ew,Ew,(f=>new jz(function(f){let z=0;for(;f;)z+=1&f,f>>=1;return z}(f.value))),VC.ClassName,f)}}VC.ClassName="FGCountOneBitsBlock",(0,D.f)(VC.ClassName,VC);class WC extends Gw{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new jz(0)};super(f),this.config=f,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Ew),this.value=this.registerDataOutput("value",Ew)}_execute(f,z){if(z===this.reset)this.value.setValue(this.config.startIndex,f);else{const z=this.value.getValue(f);z.value<this.n.getValue(f).value&&(this.value.setValue(new jz(z.value+1),f),this.out._activateSignal(f))}}getClassName(){return WC.ClassName}}WC.ClassName="FGDoNBlock",(0,D.f)(WC.ClassName,WC);class TC extends Xw{constructor(f){super(f),this.config=f,this.output=this.registerDataOutput(f.variableName,Nz)}_updateOutputs(f){const z=this.config.variableName;f.hasVariable(z)&&this.output.setValue(f.getVariable(z),f)}getClassName(){return TC.ClassName}serialize(f){super.serialize(f),f.config.variableName=this.config.variableName}}TC.ClassName="FGGetVariableBlock",(0,D.f)(TC.ClassName,TC);class vC extends Gw{constructor(f){super(f),this.config=f,this.input=this.registerDataInput(f.variableName,Nz)}_execute(f){const z=this.config.variableName,w=this.input.getValue(f);f.setVariable(z,w),this.out._activateSignal(f)}getClassName(){return vC.ClassName}}vC.ClassName="FGSetVariableBlock",(0,D.f)(vC.ClassName,vC);class DC extends Gw{constructor(f){super(f),this.config=f,this.condition=this.registerDataInput("condition",zw),this.loopBody=this._registerSignalOutput("loopBody")}_execute(f,z){var w;let S=this.condition.getValue(f);for(null!==(w=this.config)&&void 0!==w&&w.isDo&&!S&&this.loopBody._activateSignal(f);S;)this.loopBody._activateSignal(f),S=this.condition.getValue(f);this.out._activateSignal(f)}getClassName(){return DC.ClassName}serialize(f){var z;super.serialize(f),f.isDo=null===(z=this.config)||void 0===z?void 0:z.isDo}}DC.ClassName="FGWhileLoopBlock",(0,D.f)(DC.ClassName,DC);const AC={"lifecycle/onStart":Aw.ClassName,"lifecycle/onTick":Mw.ClassName,log:Iw.ClassName,"flow/delay":Pw.ClassName,"customEvent/send":Rw.ClassName,"customEvent/receive":qw.ClassName,"flow/sequence":aw.ClassName,"world/get":Lw.ClassName,"world/set":Uw.ClassName,"flow/doN":WC.ClassName,"variable/get":TC.ClassName,"variable/set":vC.ClassName,"flow/whileLoop":DC.ClassName,"math/random":fS.ClassName,"math/e":wS.ClassName,"math/pi":SS.ClassName,"math/inf":CS.ClassName,"math/nan":ES.ClassName,"math/abs":JS.ClassName,"math/sign":xS.ClassName,"math/trunc":uS.ClassName,"math/floor":hS.ClassName,"math/ceil":XS.ClassName,"math/fract":KS.ClassName,"math/neg":cS.ClassName,"math/add":kw.ClassName,"math/sub":jw.ClassName,"math/mul":lw.ClassName,"math/div":Nw.ClassName,"math/rem":eS.ClassName,"math/min":OS.ClassName,"math/max":dS.ClassName,"math/clamp":WS.ClassName,"math/saturate":vS.ClassName,"math/mix":DS.ClassName,"math/eq":AS.ClassName,"math/lt":GS.ClassName,"math/le":IS.ClassName,"math/gt":nS.ClassName,"math/ge":PS.ClassName,"math/isnan":RS.ClassName,"math/isinf":qS.ClassName,"math/rad":aS.ClassName,"math/deg":sS.ClassName,"math/sin":HS.ClassName,"math/cos":LS.ClassName,"math/tan":US.ClassName,"math/asin":iS.ClassName,"math/acos":mS.ClassName,"math/atan":rS.ClassName,"math/atan2":oS.ClassName,"math/sinh":pS.ClassName,"math/cosh":YS.ClassName,"math/tanh":tS.ClassName,"math/asinh":ZS.ClassName,"math/acosh":bS.ClassName,"math/atanh":QS.ClassName,"math/exp":gS.ClassName,"math/log":kS.ClassName,"math/log2":jS.ClassName,"math/log10":lS.ClassName,"math/sqrt":NS.ClassName,"math/cbrt":fC.ClassName,"math/pow":zC.ClassName,"math/length":wC.ClassName,"math/normalize":SC.ClassName,"math/dot":zS.ClassName,"math/cross":CC.ClassName,"math/rotate2d":EC.ClassName,"math/rotate3d":FC.ClassName,"math/transpose":JC.ClassName,"math/determinant":xC.ClassName,"math/inverse":uC.ClassName,"math/matmul":hC.ClassName,"math/not":XC.ClassName,"math/and":KC.ClassName,"math/or":cC.ClassName,"math/xor":yC.ClassName,"math/asr":OC.ClassName,"math/lsl":eC.ClassName,"math/clz":dC.ClassName,"math/ctz":BC.ClassName,"math/popcnt":VC.ClassName},MC={float2:"Vector2",float3:"ek",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function GC(f,z,w){if(void 0!==f.type){const S=z.types&&z.types[f.type];if(!S)throw new Error(`${w}: Unknown type: ${f.type}`);const C=S.signature;if(!C)throw new Error(`${w}: Type ${f.type} has no signature`);const E=MC[C];return{value:f.value,className:E}}return f.value}function IC(f,z,w){const S=AC[z.type];if(!S)throw new Error(`/extensions/KHR_interactivity/nodes/${f}: Unknown block type: ${z.type}`);const C=f.toString(),E=function(f,z,w){const S={},C=f.configuration??[];for(const E of C)if("customEvent"===E.id){const f=z.customEvents&&z.customEvents[E.value];if(!f)throw new Error(`/extensions/KHR_interactivity/nodes/${w}: Unknown custom event: ${E.value}`);S.eventId=f.id,S.eventData=f.values.map((f=>f.id))}else if("variable"===E.id){const f=z.variables&&z.variables[E.value];if(!f)throw new Error(`/extensions/KHR_interactivity/nodes/${w}: Unknown variable: ${E.value}`);S.variableName=f.id}else if("path"===E.id){const f=E.value;S.path=f}else S[E.id]=GC(E,z,`/extensions/KHR_interactivity/nodes/${w}`);return S}(z,w,C);return{className:S,config:E,uniqueId:C,metadata:z.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class nC extends Az{constructor(f){super(f,RC)}}const PC={__array__:{__target__:!0,translation:{type:"ek",get:f=>f._babylonTransformNode.position,set:(f,z)=>{z._babylonTransformNode.position=f},getObject:f=>f._babylonTransformNode}}},RC={nodes:PC},qC="KHR_interactivity";class aC{constructor(f){this._loader=f,this.name=qC,this.enabled=this._loader.isExtensionUsed(qC),this._pathConverter=new nC(this._loader.tl)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var f;if(!this._loader.babylonScene||!this._pathConverter)return;const z=this._loader.babylonScene,w=function(f){const z={uniqueId:(0,gz.d)(),_userVariables:{},_connectionValues:{}},w=[z],S=[];for(let E=0;E<f.nodes.length;E++){const z=IC(E,f.nodes[E],f);S.push(z)}for(let E=0;E<f.nodes.length;E++){const w=f.nodes[E],C=S[E],F=w.flows??[];for(const f of F){const z=f.id,w={uniqueId:(0,gz.d)(),name:z,_connectionType:1,connectedPointIds:[]};C.signalOutputs.push(w);const F=f.node,J=f.socket,x=S[F];if(!x)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Could not find node with id ${F} that connects its input with with node ${E}'s output ${z}`);let u=x.signalInputs.find((f=>f.name===J));u||(u={uniqueId:(0,gz.d)(),name:J,_connectionType:0,connectedPointIds:[]},x.signalInputs.push(u)),u.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(u.uniqueId)}const J=w.values??[];for(const x of J){const w=x.id,F={uniqueId:(0,gz.d)(),name:w,_connectionType:0,connectedPointIds:[]};if(C.dataInputs.push(F),void 0!==x.value){const w=GC(x,f,`/extensions/KHR_interactivity/nodes/${E}`);z._connectionValues[F.uniqueId]=w}else{if(void 0===x.node||void 0===x.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Invalid socket ${w} in node ${E}`);{const f=x.node,z=x.socket,C=S[f];if(!C)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Could not find node with id ${f} that connects its output with node${E}'s input ${w}`);let J=C.dataOutputs.find((f=>f.name===z));J||(J={uniqueId:(0,gz.d)(),name:z,_connectionType:1,connectedPointIds:[]},C.dataOutputs.push(J)),F.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(F.uniqueId)}}}}const C=f.variables??[];for(let E=0;E<C.length;E++){const w=C[E],S=w.id;z._userVariables[S]=GC(w,f,`/extensions/KHR_interactivity/variables/${E}`)}return{allBlocks:S,executionContexts:w}}(null===(f=this._loader.tl.extensions)||void 0===f?void 0:f.KHR_interactivity),S=new Dw({Rc:z});vw.Parse(w,{coordinator:S,pathConverter:this._pathConverter}),S.start()}}Q(qC),b(qC,!0,(f=>new aC(f)));const sC="KHR_node_visibility";class HC{constructor(f){this.name=sC,this._loader=f,this.enabled=f.isExtensionUsed(sC)}async onReady(){var f;null===(f=this._loader.tl.nodes)||void 0===f||f.forEach((f=>{var z,w,S,C;(null===(z=f._primitiveBabylonMeshes)||void 0===z||z.forEach((f=>{f.inheritVisibility=!0})),null!==(w=f.extensions)&&void 0!==w&&w.KHR_node_visibility)&&(!1===(null===(S=f.extensions)||void 0===S?void 0:S.KHR_node_visibility.visible)&&(f._babylonTransformNode&&(f._babylonTransformNode.isVisible=!1),null===(C=f._primitiveBabylonMeshes)||void 0===C||C.forEach((f=>{f.isVisible=!1}))))}))}dispose(){this._loader=null}}Q(sC),b(sC,!0,(f=>new HC(f)));const LC="ExtrasAsMetadata";class UC{_assignExtras(f,z){if(z.extras&&Object.keys(z.extras).length>0){const w=f.metadata=f.metadata||{};(w.tl=w.tl||{}).extras=z.extras}}constructor(f){this.name=LC,this.enabled=!0,this._loader=f}dispose(){this._loader=null}loadNodeAsync(f,z,w){return this._loader.loadNodeAsync(f,z,(f=>{this._assignExtras(f,z),w(f)}))}loadCameraAsync(f,z,w){return this._loader.loadCameraAsync(f,z,(f=>{this._assignExtras(f,z),w(f)}))}createMaterial(f,z,w){const S=this._loader.createMaterial(f,z,w);return this._assignExtras(S,z),S}}Q(LC),b(LC,!1,(f=>new UC(f)))},12674:(f,z,w)=>{"use strict";w.d(z,{d:()=>R,e:()=>A,h:()=>D,k:()=>M});var S=w(527),C=w(535),E=w(12143),F=w(525),J=w(862),x=w(853),u=w(548),h=w(580),X=w(12678),K=w(12686),c=w(689);class y{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.zk=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.gm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(f){this._environmentTexture=f}getNodes(){let f=[];return f=f.concat(this.meshes),f=f.concat(this.lights),f=f.concat(this.cameras),f=f.concat(this.transformNodes),this.skeletons.forEach((z=>f=f.concat(z.bones))),f}}class e extends y{}class O{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((f=>{f.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((f=>{f.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((f=>{f.dispose()})),this.animationGroups.length=0}}class d extends y{constructor(f){super(),this._wasAddedToScene=!1,(f=f||h.c.LastCreatedScene)&&(this.Rc=f,this.proceduralTextures=[],f.ik.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=f.getEngine().onContextRestoredObservable.add((()=>{for(const f of this.geometries)f._rebuild();for(const f of this.meshes)f._rebuild();for(const f of this.zk)f.rebuild();for(const f of this.textures)f._rebuild()})))}_topologicalSort(f){const z=new Map;for(const F of f)z.set(F.uniqueId,F);const w={dependsOn:new Map,dependedBy:new Map};for(const F of f){const f=F.uniqueId;w.dependsOn.set(f,new Set),w.dependedBy.set(f,new Set)}for(const F of f){const f=F.uniqueId,S=w.dependsOn.get(f);if(F instanceof X.d){const C=F.sourceMesh;z.has(C.uniqueId)&&(S.add(C.uniqueId),w.dependedBy.get(C.uniqueId).add(f))}const C=w.dependedBy.get(f);for(const E of F.getDescendants()){const S=E.uniqueId;if(z.has(S)){C.add(S);w.dependsOn.get(S).add(f)}}}const S=[],C=[];for(const F of f){const f=F.uniqueId;0===w.dependsOn.get(f).size&&(C.push(F),z.delete(f))}const E=C;for(;E.length>0;){const f=E.shift();S.push(f);const C=w.dependedBy.get(f.uniqueId);for(const S of Array.from(C.values())){const C=w.dependsOn.get(S);C.delete(f.uniqueId),0===C.size&&z.get(S)&&(E.push(z.get(S)),z.delete(S))}}return z.size>0&&(u.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),z.forEach((f=>u.b.Error(f.name)))),S}_addNodeAndDescendantsToList(f,z,w,S){if(w&&(!S||S(w))&&!z.has(w.uniqueId)){f.push(w),z.add(w.uniqueId);for(const C of w.getDescendants(!0))this._addNodeAndDescendantsToList(f,z,C,S)}}_isNodeInContainer(f){return f instanceof x.c&&-1!==this.meshes.indexOf(f)||(f instanceof J.e&&-1!==this.transformNodes.indexOf(f)||(f instanceof K.b&&-1!==this.lights.indexOf(f)||f instanceof c.e&&-1!==this.cameras.indexOf(f)))}_isValidHierarchy(){for(const f of this.meshes)if(f.parent&&!this._isNodeInContainer(f.parent))return u.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.transformNodes)if(f.parent&&!this._isNodeInContainer(f.parent))return u.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.lights)if(f.parent&&!this._isNodeInContainer(f.parent))return u.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.cameras)if(f.parent&&!this._isNodeInContainer(f.parent))return u.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||C.h.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const S={},E={},J=new O,x=[],u=[],h={doNotInstantiate:!0,...w},X=[],K=new Set;for(const C of this.transformNodes)null===C.parent&&this._addNodeAndDescendantsToList(X,K,C,h.predicate);for(const C of this.meshes)null===C.parent&&this._addNodeAndDescendantsToList(X,K,C,h.predicate);const c=this._topologicalSort(X),y=(w,C)=>{if(((z,w)=>{if(S[z.uniqueId]=w.uniqueId,E[w.uniqueId]=w,f&&(w.name=f(z.name)),w instanceof F.b){const f=w;if(f.morphTargetManager){const w=z.morphTargetManager;f.morphTargetManager=w.clone();for(let z=0;z<w.numTargets;z++){const C=w.getTarget(z),F=f.morphTargetManager.getTarget(z);S[C.uniqueId]=F.uniqueId,E[F.uniqueId]=F}}}})(w,C),w.parent){const f=S[w.parent.uniqueId],z=E[f];C.parent=z||w.parent}if(C.position&&w.position&&C.position.p(w.position),C.rotationQuaternion&&w.rotationQuaternion&&C.rotationQuaternion.p(w.rotationQuaternion),C.rotation&&w.rotation&&C.rotation.p(w.rotation),C.Id&&w.Id&&C.Id.p(w.Id),C.material){const F=C;if(F.material)if(z){const z=w.material;if(-1===u.indexOf(z)){let w=z.clone(f?f(z.name):"Clone of "+z.name);if(u.push(z),S[z.uniqueId]=w.uniqueId,E[w.uniqueId]=w,"MultiMaterial"===z.getClassName()){const C=z;for(const z of C.tk)z&&(w=z.clone(f?f(z.name):"Clone of "+z.name),u.push(z),S[z.uniqueId]=w.uniqueId,E[w.uniqueId]=w);C.tk=C.tk.map((f=>f&&E[S[f.uniqueId]]))}}"InstancedMesh"!==F.getClassName()&&(F.material=E[S[z.uniqueId]])}else"MultiMaterial"===F.material.getClassName()?-1===this.Rc.multiMaterials.indexOf(F.material)&&this.Rc.addMultiMaterial(F.material):-1===this.Rc.materials.indexOf(F.material)&&this.Rc.addMaterial(F.material)}null===C.parent&&J.rootNodes.push(C)};return c.forEach((f=>{if("InstancedMesh"===f.getClassName()){const z=f,w=z.sourceMesh,C=S[w.uniqueId],F=("number"===typeof C?E[C]:w).createInstance(z.name);y(z,F)}else{let z=!0;"Jk"===f.getClassName()||"Node"===f.getClassName()||f.skeleton||!f.getTotalVertices||0===f.getTotalVertices()?z=!1:h.doNotInstantiate&&(z="function"===typeof h.doNotInstantiate?!h.doNotInstantiate(f):!h.doNotInstantiate);const w=z?f.createInstance(`instance of ${f.name}`):f.clone(`Clone of ${f.name}`,null,!0);if(!w)throw new Error(`Could not clone or instantiate node on Asset Container ${f.name}`);y(f,w)}})),this.skeletons.forEach((z=>{if(h.predicate&&!h.predicate(z))return;const w=z.clone(f?f(z.name):"Clone of "+z.name);for(const f of this.meshes)if(f.skeleton===z&&!f.isAnInstance){const z=E[S[f.uniqueId]];if(!z||z.isAnInstance)continue;if(z.skeleton=w,-1!==x.indexOf(w))continue;x.push(w);for(const f of w.bones)f._linkedTransformNode&&(f._linkedTransformNode=E[S[f._linkedTransformNode.uniqueId]])}J.skeletons.push(w)})),this.animationGroups.forEach((z=>{if(h.predicate&&!h.predicate(z))return;const w=z.clone(f?f(z.name):"Clone of "+z.name,(f=>E[S[f.uniqueId]]||f));J.animationGroups.push(w)})),J}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||C.h.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Rc.environmentTexture=this.environmentTexture);for(const f of this.Rc._serializableComponents)f.addFromContainer(this);this.Rc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const z=[];this.cameras.forEach((w=>{f&&!f(w)||(this.Rc.addCamera(w),z.push(w))})),this.lights.forEach((w=>{f&&!f(w)||(this.Rc.addLight(w),z.push(w))})),this.meshes.forEach((w=>{f&&!f(w)||(this.Rc.yk(w),z.push(w))})),this.skeletons.forEach((z=>{f&&!f(z)||this.Rc.addSkeleton(z)})),this.animations.forEach((z=>{f&&!f(z)||this.Rc.addAnimation(z)})),this.animationGroups.forEach((z=>{f&&!f(z)||this.Rc.addAnimationGroup(z)})),this.multiMaterials.forEach((z=>{f&&!f(z)||this.Rc.addMultiMaterial(z)})),this.materials.forEach((z=>{f&&!f(z)||this.Rc.addMaterial(z)})),this.morphTargetManagers.forEach((z=>{f&&!f(z)||this.Rc.addMorphTargetManager(z)})),this.geometries.forEach((z=>{f&&!f(z)||this.Rc.addGeometry(z)})),this.transformNodes.forEach((w=>{f&&!f(w)||(this.Rc.addTransformNode(w),z.push(w))})),this.actionManagers.forEach((z=>{f&&!f(z)||this.Rc.addActionManager(z)})),this.textures.forEach((z=>{f&&!f(z)||this.Rc.addTexture(z)})),this.reflectionProbes.forEach((z=>{f&&!f(z)||this.Rc.addReflectionProbe(z)}));for(const w of z)w.parent&&-1===this.Rc.getNodes().indexOf(w.parent)&&(w.setParent?w.setParent(null):w.parent=null)}removeAllFromScene(){this._isValidHierarchy()||C.h.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Rc.environmentTexture&&(this.Rc.environmentTexture=null);for(const f of this.Rc._serializableComponents)f.removeFromContainer(this)}removeFromScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((z=>{f&&!f(z)||this.Rc.removeCamera(z)})),this.lights.forEach((z=>{f&&!f(z)||this.Rc.removeLight(z)})),this.meshes.forEach((z=>{f&&!f(z)||this.Rc.Nc(z,!0)})),this.skeletons.forEach((z=>{f&&!f(z)||this.Rc.removeSkeleton(z)})),this.animations.forEach((z=>{f&&!f(z)||this.Rc.removeAnimation(z)})),this.animationGroups.forEach((z=>{f&&!f(z)||this.Rc.removeAnimationGroup(z)})),this.multiMaterials.forEach((z=>{f&&!f(z)||this.Rc.removeMultiMaterial(z)})),this.materials.forEach((z=>{f&&!f(z)||this.Rc.removeMaterial(z)})),this.morphTargetManagers.forEach((z=>{f&&!f(z)||this.Rc.removeMorphTargetManager(z)})),this.geometries.forEach((z=>{f&&!f(z)||this.Rc.removeGeometry(z)})),this.transformNodes.forEach((z=>{f&&!f(z)||this.Rc.removeTransformNode(z)})),this.actionManagers.forEach((z=>{f&&!f(z)||this.Rc.removeActionManager(z)})),this.textures.forEach((z=>{f&&!f(z)||this.Rc.removeTexture(z)})),this.reflectionProbes.forEach((z=>{f&&!f(z)||this.Rc.removeReflectionProbe(z)}))}dispose(){this.cameras.slice(0).forEach((f=>{f.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((f=>{f.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((f=>{f.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((f=>{f.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((f=>{f.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((f=>{f.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((f=>{f.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((f=>{f.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((f=>{f.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((f=>{f.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((f=>{f.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((f=>{f.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((f=>{f.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const f of this.Rc._serializableComponents)f.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Rc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(f,z,w){if(f&&z)for(const S of f){let f=!0;if(w)for(const z of w)if(S===z){f=!1;break}f&&(z.push(S),S._parentContainer=this)}}moveAllFromScene(f){this._wasAddedToScene=!1,void 0===f&&(f=new e);for(const z in this)Object.prototype.hasOwnProperty.call(this,z)&&(this[z]=this[z]||("_environmentTexture"===z?null:[]),this._moveAssets(this.Rc[z],this[z],f[z]));this.environmentTexture=this.Rc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const f=new F.b("assetContainerRootMesh",this.Rc);return this.meshes.forEach((z=>{z.parent||f.addChild(z)})),this.meshes.unshift(f),f}mergeAnimationsTo(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.c.LastCreatedScene,z=arguments.length>1?arguments[1]:void 0,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!f)return u.b.Error("No scene available to merge animations to"),[];const S=w||(z=>{let w=null;const S=z.animations.length?z.animations[0].targetProperty:"",C=z.name.split(".").join("").split("_primitive")[0];switch(S){case"position":case"rotationQuaternion":w=f.getTransformNodeByName(z.name)||f.getTransformNodeByName(C);break;case"influence":w=f.getMorphTargetByName(z.name)||f.getMorphTargetByName(C);break;default:w=f.getNodeByName(z.name)||f.getNodeByName(C)}return w});this.getNodes().forEach((f=>{const z=S(f);if(null!==z){for(const w of f.animations){const f=z.animations.filter((f=>f.targetProperty===w.targetProperty));for(const w of f){const f=z.animations.indexOf(w,0);f>-1&&z.animations.splice(f,1)}}z.animations=z.animations.concat(f.animations)}}));const C=[];return this.animationGroups.slice().forEach((f=>{C.push(f.clone(f.name,S)),f.animatables.forEach((f=>{f.stop()}))})),z.forEach((z=>{const w=S(z.target);w&&(f.beginAnimation(w,z.fromFrame,z.toFrame,z.loopAnimation,z.speedRatio,z.onAnimationEnd?z.onAnimationEnd:void 0,void 0,!0,void 0,z.onAnimationLoop?z.onAnimationLoop:void 0),f.stopAnimation(z.target))})),C}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.transformNodes.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.lights.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.cameras.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)}))}addAllAssetsToContainer(f){if(!f)return;const z=[],w=new Set;for(z.push(f);z.length>0;){const f=z.pop();if(f instanceof F.b?(f.qk&&-1===this.geometries.indexOf(f.qk)&&this.geometries.push(f.qk),this.meshes.push(f)):f instanceof J.e?this.transformNodes.push(f):f instanceof K.b?this.lights.push(f):f instanceof c.e&&this.cameras.push(f),f instanceof x.c){if(f.material&&-1===this.materials.indexOf(f.material)){this.materials.push(f.material);for(const z of f.material.getActiveTextures())-1===this.textures.indexOf(z)&&this.textures.push(z)}f.skeleton&&-1===this.skeletons.indexOf(f.skeleton)&&this.skeletons.push(f.skeleton),f.morphTargetManager&&-1===this.morphTargetManagers.indexOf(f.morphTargetManager)&&this.morphTargetManagers.push(f.morphTargetManager)}for(const S of f.getChildren())w.has(S)||z.push(S);w.add(f)}this.populateRootNodes()}}var B=w(592);class V{constructor(f){this.byteOffset=0,this.buffer=f}loadAsync(f){return this.buffer.readAsync(this.byteOffset,f).then((f=>{this._dataView=new DataView(f.buffer,f.byteOffset,f.byteLength),this._dataByteOffset=0}))}readUint32(){const f=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,f}readUint8Array(f){const z=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,f);return this._dataByteOffset+=f,this.byteOffset+=f,z}readString(f){return(0,B.g)(this.readUint8Array(f))}skipBytes(f){this._dataByteOffset+=f,this.byteOffset+=f}}var W=w(12690);const T="Z2xURg",v={name:"tl",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:f=>-1!==f.indexOf("asset")&&-1!==f.indexOf("version")||f.startsWith("data:base64,"+T)||f.startsWith("data:;base64,"+T)||f.startsWith("data:application/octet-stream;base64,"+T)||f.startsWith("data:model/gltf-binary;base64,"+T)};var D,A,M,G=w(583),I=w(586);function n(f,z,w){try{return Promise.resolve(new Uint8Array(f,z,w))}catch(S){return Promise.reject(S)}}!function(f){f[f.AUTO=0]="AUTO",f[f.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(D||(D={})),function(f){f[f.NONE=0]="NONE",f[f.FIRST=1]="FIRST",f[f.ALL=2]="ALL"}(A||(A={})),function(f){f[f.LOADING=0]="LOADING",f[f.READY=1]="READY",f[f.COMPLETE=2]="COMPLETE"}(M||(M={}));class P{constructor(){this.coordinateSystemMode=D.AUTO,this.animationStartMode=A.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=f=>Promise.resolve(f),this.extensionOptions={}}p(f){f&&(this.onParsed=f.onParsed,this.coordinateSystemMode=f.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=f.animationStartMode??this.animationStartMode,this.loadNodeAnimations=f.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=f.loadSkins??this.loadSkins,this.loadMorphTargets=f.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=f.compileMaterials??this.compileMaterials,this.useClipPlane=f.useClipPlane??this.useClipPlane,this.compileShadowGenerators=f.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=f.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=f.useRangeRequests??this.useRangeRequests,this.createInstances=f.createInstances??this.createInstances,this.alwaysComputeBoundingBox=f.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=f.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=f.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=f.skipMaterials??this.skipMaterials,this.useSRGBBuffers=f.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=f.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=f.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=f.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=f.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=f.customRootNode,this.onMeshLoaded=f.onMeshLoaded,this.onSkinLoaded=f.onSkinLoaded,this.onTextureLoaded=f.onTextureLoaded,this.onMaterialLoaded=f.onMaterialLoaded,this.onCameraLoaded=f.onCameraLoaded,this.extensionOptions=f.extensionOptions??this.extensionOptions)}}class R extends P{constructor(f){super(),this.onParsedObservable=new S.c,this.onMeshLoadedObservable=new S.c,this.onSkinLoadedObservable=new S.c,this.onTextureLoadedObservable=new S.c,this.onMaterialLoadedObservable=new S.c,this.onCameraLoadedObservable=new S.c,this.onCompleteObservable=new S.c,this.onErrorObservable=new S.c,this.ik=new S.c,this.onExtensionLoadedObservable=new S.c,this.validate=!1,this.onValidatedObservable=new S.c,this._loader=null,this._state=null,this._requests=new Array,this.name=v.name,this.extensions=v.extensions,this.onLoaderStateChangedObservable=new S.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(f)}set onParsed(f){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),f&&(this._onParsedObserver=this.onParsedObservable.add(f))}set onMeshLoaded(f){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),f&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(f))}set onSkinLoaded(f){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),f&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((z=>f(z.node,z.skinnedNode))))}set onTextureLoaded(f){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),f&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(f))}set onMaterialLoaded(f){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),f&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(f))}set onCameraLoaded(f){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),f&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(f))}set onComplete(f){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(f)}set onError(f){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(f)}set onDispose(f){this._onDisposeObserver&&this.ik.remove(this._onDisposeObserver),this._onDisposeObserver=this.ik.add(f)}set onExtensionLoaded(f){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(f)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(f){this._loggingEnabled!==f&&(this._loggingEnabled=f,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(f){this._capturePerformanceCounters!==f&&(this._capturePerformanceCounters=f,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(f){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(f)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const f of this._requests)f.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=f=>Promise.resolve(f),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ik.notifyObservers(void 0),this.ik.clear()}loadFile(f,z,w,E,F,J,x,h){if(ArrayBuffer.isView(z))return this._loadBinary(f,z,w,E,x,h),null;this._progressCallback=F;const X=z.name||C.h.GetFilename(z);if(J){if(this.useRangeRequests){this.validate&&u.b.Warn("glTF validation is not supported when range requests are enabled");const w={abort:()=>{},onCompleteObservable:new S.c},C={readAsync:(w,S)=>new Promise(((C,E)=>{this._loadFile(f,z,(f=>{C(new Uint8Array(f))}),!0,(f=>{E(f)}),(f=>{f.setRequestHeader("Range",`bytes=${w}-${w+S-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new V(C)).then((f=>{w.onCompleteObservable.notifyObservers(w),E(f)}),x?f=>x(void 0,f):void 0),w}return this._loadFile(f,z,(z=>{this._validate(f,new Uint8Array(z,0,z.byteLength),w,X),this._unpackBinaryAsync(new V({readAsync:(f,w)=>n(z,f,w),byteLength:z.byteLength})).then((f=>{E(f)}),x?f=>x(void 0,f):void 0)}),!0,x)}return this._loadFile(f,z,(z=>{try{this._validate(f,z,w,X),E({json:this._parseJson(z)})}catch{x&&x()}}),!1,x)}_loadBinary(f,z,w,S,C,E){this._validate(f,new Uint8Array(z.buffer,z.byteOffset,z.byteLength),w,E),this._unpackBinaryAsync(new V({readAsync:(f,w)=>function(f,z,w){try{if(z<0||z>=f.byteLength)throw new RangeError("Offset is out of range.");if(z+w>f.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(f.buffer,f.byteOffset+z,w))}catch(S){return Promise.reject(S)}}(z,f,w),byteLength:z.byteLength})).then((f=>{S(f)}),C?f=>C(void 0,f):void 0)}importMeshAsync(f,z,w,S,C,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(w),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(w),this._loader.importMeshAsync(f,z,null,w,S,C,E))))}loadAsync(f,z,w,S,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(z),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(z),this._loader.loadAsync(f,z,w,S,C))))}loadAssetContainerAsync(f,z,w,S,C){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(z),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(z);const E=new d(f),F=[];this.onMaterialLoadedObservable.add((f=>{F.push(f)}));const J=[];this.onTextureLoadedObservable.add((f=>{J.push(f)}));const x=[];this.onCameraLoadedObservable.add((f=>{x.push(f)}));const u=[];return this.onMeshLoadedObservable.add((f=>{f.morphTargetManager&&u.push(f.morphTargetManager)})),this._loader.importMeshAsync(null,f,E,z,w,S,C).then((f=>(Array.prototype.push.apply(E.geometries,f.geometries),Array.prototype.push.apply(E.meshes,f.meshes),Array.prototype.push.apply(E.zk,f.zk),Array.prototype.push.apply(E.skeletons,f.skeletons),Array.prototype.push.apply(E.animationGroups,f.animationGroups),Array.prototype.push.apply(E.materials,F),Array.prototype.push.apply(E.textures,J),Array.prototype.push.apply(E.lights,f.lights),Array.prototype.push.apply(E.transformNodes,f.transformNodes),Array.prototype.push.apply(E.cameras,x),Array.prototype.push.apply(E.morphTargetManagers,u),E)))}))}canDirectLoad(f){return v.canDirectLoad(f)}directLoad(f,z){if(z.startsWith("base64,"+T)||z.startsWith(";base64,"+T)||z.startsWith("application/octet-stream;base64,"+T)||z.startsWith("model/gltf-binary;base64,"+T)){const w=(0,G.b)(z);return this._validate(f,new Uint8Array(w,0,w.byteLength)),this._unpackBinaryAsync(new V({readAsync:(f,z)=>n(w,f,z),byteLength:w.byteLength}))}return this._validate(f,z),Promise.resolve({json:this._parseJson(z)})}createPlugin(f){return new R(f[v.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((f,z)=>{this.onCompleteObservable.addOnce((()=>{f()})),this.onErrorObservable.addOnce((f=>{z(f)}))}))}_setState(f){this._state!==f&&(this._state=f,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(M[this._state]))}_loadFile(f,z,w,S,C,E){const F=f._loadFile(z,w,(f=>{this._onProgress(f,F)}),!0,S,C,E);return F.onCompleteObservable.add((()=>{F._lengthComputable=!0,F._total=F._loaded})),this._requests.push(F),F}_onProgress(f,z){if(!this._progressCallback)return;z._lengthComputable=f.lengthComputable,z._loaded=f.loaded,z._total=f.total;let w=!0,S=0,C=0;for(const E of this._requests){if(void 0===E._lengthComputable||void 0===E._loaded||void 0===E._total)return;w=w&&E._lengthComputable,S+=E._loaded,C+=E._total}this._progressCallback({lengthComputable:w,loaded:S,total:w?C:0})}_validate(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),W.b.ValidateAsync(z,w,S,(z=>this.preprocessUrlAsync(w+z).then((z=>f._loadFileAsync(z,void 0,!0,!0).then((f=>new Uint8Array(f,0,f.byteLength))))))).then((f=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(f),this.onValidatedObservable.clear()}),(f=>{this._endPerformanceCounter("Validate JSON"),C.h.Warn(`Failed to validate: ${f.message}`),this.onValidatedObservable.clear()})))}_getLoader(f){const z=f.json.asset||{};this._log(`Asset version: ${z.version}`),z.minVersion&&this._log(`Asset minimum version: ${z.minVersion}`),z.generator&&this._log(`Asset generator: ${z.generator}`);const w=R._parseVersion(z.version);if(!w)throw new Error("Invalid version: "+z.version);if(void 0!==z.minVersion){const f=R._parseVersion(z.minVersion);if(!f)throw new Error("Invalid minimum version: "+z.minVersion);if(R._compareVersion(f,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+z.minVersion)}const S={1:R._CreateGLTF1Loader,2:R._CreateGLTF2Loader}[w.major];if(!S)throw new Error("Unsupported version: "+z.version);return S(this)}_parseJson(f){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${f.length}`);const z=JSON.parse(f);return this._endPerformanceCounter("Parse JSON"),z}_unpackBinaryAsync(f){return this._startPerformanceCounter("Unpack Binary"),f.loadAsync(20).then((()=>{const z=f.readUint32();if(1179937895!==z)throw new I.g("Unexpected magic: "+z,I.f.GLTFLoaderUnexpectedMagicError);const w=f.readUint32();this.loggingEnabled&&this._log(`Binary version: ${w}`);const S=f.readUint32();let C;switch(this.useRangeRequests||S===f.buffer.byteLength||u.b.Warn(`Length in header does not match actual data length: ${S} != ${f.buffer.byteLength}`),w){case 1:C=this._unpackBinaryV1Async(f,S);break;case 2:C=this._unpackBinaryV2Async(f,S);break;default:throw new Error("Unsupported version: "+w)}return this._endPerformanceCounter("Unpack Binary"),C}))}_unpackBinaryV1Async(f,z){const w=f.readUint32(),S=f.readUint32();if(0!==S)throw new Error(`Unexpected content format: ${S}`);const C=z-f.byteOffset,E={json:this._parseJson(f.readString(w)),bin:null};if(0!==C){const z=f.byteOffset;E.bin={readAsync:(w,S)=>f.buffer.readAsync(z+w,S),byteLength:C}}return Promise.resolve(E)}_unpackBinaryV2Async(f,z){const w=1313821514,S=5130562,C=f.readUint32();if(f.readUint32()!==w)throw new Error("First chunk format is not JSON");return f.byteOffset+C===z?f.loadAsync(C).then((()=>({json:this._parseJson(f.readString(C)),bin:null}))):f.loadAsync(C+8).then((()=>{const E={json:this._parseJson(f.readString(C)),bin:null},F=()=>{const C=f.readUint32();switch(f.readUint32()){case w:throw new Error("Unexpected JSON chunk");case S:{const z=f.byteOffset;E.bin={readAsync:(w,S)=>f.buffer.readAsync(z+w,S),byteLength:C},f.skipBytes(C);break}default:f.skipBytes(C)}return f.byteOffset!==z?f.loadAsync(8).then(F):Promise.resolve(E)};return F()}))}static _parseVersion(f){if("1.0"===f||"1.0.1"===f)return{major:1,minor:0};const z=(f+"").match(/^(\d+)\.(\d+)/);return z?{major:parseInt(z[1]),minor:parseInt(z[2])}:null}static _compareVersion(f,z){return f.major>z.major?1:f.major<z.major?-1:f.minor>z.minor?1:f.minor<z.minor?-1:0}_logOpen(f){this._log(f),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(f){const z=R._logSpaces.substring(0,2*this._logIndentLevel);u.b.Log(`${z}${f}`)}_logDisabled(f){}_startPerformanceCounterEnabled(f){C.h.StartPerformanceCounter(f)}_startPerformanceCounterDisabled(f){}_endPerformanceCounterEnabled(f){C.h.EndPerformanceCounter(f)}_endPerformanceCounterDisabled(f){}}R.IncrementalLoading=!0,R.HomogeneousCoordinates=!1,R._logSpaces="                                ",(0,E.e)(new R)},12690:(f,z,w)=>{"use strict";w.d(z,{b:()=>F});var S=w(535);function C(f,z,w,S){const C={externalResourceFunction:S};return w&&(C.uri="file:"===z?w:z+w),ArrayBuffer.isView(f)?GLTFValidator.validateBytes(f,C):GLTFValidator.validateString(f,C)}function E(){const f=[];onmessage=z=>{const w=z.data;switch(w.id){case"init":importScripts(w.url);break;case"validate":C(w.data,w.rootUrl,w.fileName,(z=>new Promise(((w,S)=>{const C=f.length;f.push({resolve:w,reject:S}),postMessage({id:"getExternalResource",index:C,uri:z})})))).then((f=>{postMessage({id:"validate.resolve",value:f})}),(f=>{postMessage({id:"validate.reject",reason:f})}));break;case"getExternalResource.resolve":f[w.index].resolve(w.value);break;case"getExternalResource.reject":f[w.index].reject(w.reason)}}}class F{static ValidateAsync(f,z,w,F){return"function"===typeof Worker?new Promise(((J,x)=>{const u=`${C}(${E})()`,h=URL.createObjectURL(new Blob([u],{type:"application/javascript"})),X=new Worker(h),K=f=>{X.removeEventListener("error",K),X.removeEventListener("message",c),x(f)},c=f=>{const z=f.data;switch(z.id){case"getExternalResource":F(z.uri).then((f=>{X.postMessage({id:"getExternalResource.resolve",index:z.index,value:f},[f.buffer])}),(f=>{X.postMessage({id:"getExternalResource.reject",index:z.index,reason:f})}));break;case"validate.resolve":X.removeEventListener("error",K),X.removeEventListener("message",c),J(z.value),X.terminate();break;case"validate.reject":X.removeEventListener("error",K),X.removeEventListener("message",c),x(z.reason),X.terminate()}};if(X.addEventListener("error",K),X.addEventListener("message",c),X.postMessage({id:"init",url:S.h.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(f)){const S=f.slice();X.postMessage({id:"validate",data:S,rootUrl:z,fileName:w},[S.buffer])}else X.postMessage({id:"validate",data:f,rootUrl:z,fileName:w})})):(this._LoadScriptPromise||(this._LoadScriptPromise=S.h.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>C(f,z,w,F))))}}F.Configuration={url:`${S.h._DefaultCdnUrl}/gltf_validator.js`}},12900:(f,z,w)=>{"use strict";w.d(z,{e:()=>D});var S=w(692),C=w(699),E=w(753),F=w(720),J=w(12064),x=w(12067),u=w(789),h=w(2386),X=w(665),K=w(628);w(12336),w(12246),w(12266),w(12253),w(12270),w(12273),w(12279);const c="imageProcessingCompatibility",y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";K.d.IncludesShadersStore[c]=y;const e="skyPixelShader",O="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";K.d.ShadersStore[e]=O;w(12344),w(12283),w(12287),w(12296),w(12294);const d="skyVertexShader",B="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";K.d.ShadersStore[d]=B;var V=w(12078),W=w(901),T=w(885);class v extends J.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends x.c{constructor(f,z){super(f,z),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new F.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=F.n.Zero(),this.up=F.n.Up(),this.dithering=!1,this._cameraPosition=F.n.Zero(),this._skyOrientation=new F.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(f,z){const w=z._drawWrapper;if(this.isFrozen&&w.effect&&w._wasPreviouslyReady)return!0;z.materialDefines||(z.materialDefines=new v);const S=z.materialDefines,C=this.va();if(this._isReadyForSubMesh(z))return!0;if((0,T.N)(f,C,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,S),(0,T.D)(f,S,!0,!1),S.IMAGEPROCESSINGPOSTPROCESS!==C.imageProcessingConfiguration.applyByPostProcess&&S.markAsMiscDirty(),S.DITHER!==this.dithering&&S.markAsMiscDirty(),S.isDirty){S.markAsProcessed(),C.resetCachedMaterial();const f=new V.e;S.FOG&&f.addFallback(1,"FOG"),S.IMAGEPROCESSINGPOSTPROCESS=C.imageProcessingConfiguration.applyByPostProcess,S.DITHER=this.dithering;const w=[u.f.PositionKind];S.VERTEXCOLOR&&w.push(u.f.ColorKind);const E="sky",F=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,W.c)(F);const J=S.toString();z.setEffect(C.getEngine().createEffect(E,w,F,[],J,f,this.onCompiled,this.onError),S,this._materialContext)}return!(!z.effect||!z.effect.isReady())&&(S._renderId=C.getRenderId(),w._wasPreviouslyReady=!0,!0)}bindForSubMesh(f,z,w){const S=this.va(),C=w.materialDefines;if(!C)return;const E=w.effect;if(!E)return;this._activeEffect=E,this.bindOnlyWorldMatrix(f),this._activeEffect.setMatrix("viewProjection",S.getTransformMatrix()),this._mustRebind(S,E,w)&&((0,W.g)(E,this,S),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,T.h)(C,E,S)),S.fogEnabled&&z.applyFog&&S.fogMode!==h.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",S.getViewMatrix()),(0,T.d)(S,z,this._activeEffect);const J=S.activeCamera;if(J){const f=J.getWorldMatrix();this._cameraPosition.x=f.m[12],this._cameraPosition.y=f.m[13],this._cameraPosition.z=f.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const f=Math.PI*(this.inclination-.5),z=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(z)*Math.cos(f),this.sunPosition.y=this.distance*Math.sin(-f),this.sunPosition.z=this.distance*Math.sin(z)*Math.cos(f),F.f.FromUnitVectorsToRef(F.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(z,this._activeEffect,w)}getAnimatables(){return[]}dispose(f){super.dispose(f)}clone(f){return E.b.Clone((()=>new D(f,this.va())),this)}serialize(){const f=super.serialize();return f.customType="BABYLON.SkyMaterial",f}getClassName(){return"SkyMaterial"}static Parse(f,z,w){return E.b.Parse((()=>new D(f.name,z)),f,z,w)}}(0,S.b)([(0,C.O)()],D.prototype,"luminance",void 0),(0,S.b)([(0,C.O)()],D.prototype,"turbidity",void 0),(0,S.b)([(0,C.O)()],D.prototype,"rayleigh",void 0),(0,S.b)([(0,C.O)()],D.prototype,"mieCoefficient",void 0),(0,S.b)([(0,C.O)()],D.prototype,"mieDirectionalG",void 0),(0,S.b)([(0,C.O)()],D.prototype,"distance",void 0),(0,S.b)([(0,C.O)()],D.prototype,"inclination",void 0),(0,S.b)([(0,C.O)()],D.prototype,"azimuth",void 0),(0,S.b)([(0,C.K)()],D.prototype,"sunPosition",void 0),(0,S.b)([(0,C.O)()],D.prototype,"useSunPosition",void 0),(0,S.b)([(0,C.K)()],D.prototype,"cameraOffset",void 0),(0,S.b)([(0,C.K)()],D.prototype,"up",void 0),(0,S.b)([(0,C.O)()],D.prototype,"dithering",void 0),(0,X.f)("BABYLON.SkyMaterial",D)},11823:(f,z,w)=>{"use strict";function S(f,z){z.headers=f.headers||{},z.statusMessage=f.statusText,z.statusCode=f.status,z.data=f.response}function C(f,z,w){return new Promise((function(C,E){w=w||{};var F,J,x,u=new XMLHttpRequest,h=w.body,X=w.headers||{};for(F in w.timeout&&(u.timeout=w.timeout),u.ontimeout=u.onerror=function(f){f.timeout="timeout"==f.type,E(f)},u.open(f,z.href||z),u.onload=function(){for(x=u.getAllResponseHeaders().trim().split(/[\r\n]+/),S(u,u);J=x.shift();)J=J.split(": "),u.headers[J.shift().toLowerCase()]=J.join(": ");if((J=u.headers["content-type"])&&~J.indexOf("application/json"))try{u.data=JSON.parse(u.data,w.reviver)}catch(f){return S(u,f),E(f)}(u.status>=400?E:C)(u)},typeof FormData<"u"&&h instanceof FormData||h&&"object"==typeof h&&(X["content-type"]="application/json",h=JSON.stringify(h)),u.withCredentials=!!w.withCredentials,X)u.setRequestHeader(F,X[F]);u.send(h)}))}w.r(z),w.d(z,{del:()=>x,get:()=>E,patch:()=>J,post:()=>F,put:()=>u,send:()=>C});var E=C.bind(C,"GET"),F=C.bind(C,"POST"),J=C.bind(C,"PATCH"),x=C.bind(C,"DELETE"),u=C.bind(C,"PUT")},13007:(f,z,w)=>{"use strict";w.d(z,{c:()=>X});const S=.5*(Math.sqrt(3)-1),C=(3-Math.sqrt(3))/6,E=1/3,F=1/6,J=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,u=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),h=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const X=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const z="function"==typeof f?f:function(f){let z=0,w=0,S=0,C=1;const E=function(){let f=4022871197;return function(z){z=z.toString();for(let w=0;w<z.length;w++){f+=z.charCodeAt(w);let S=.02519603282416938*f;f=S>>>0,S-=f,S*=f,f=S>>>0,S-=f,f+=4294967296*S}return 2.3283064365386963e-10*(f>>>0)}}();z=E(" "),w=E(" "),S=E(" "),z-=E(f),z<0&&(z+=1);w-=E(f),w<0&&(w+=1);S-=E(f),S<0&&(S+=1);return function(){const f=2091639*z+2.3283064365386963e-10*C;return z=w,w=S,S=f-(C=0|f)}}(f);this.p=function(f){const z=new Uint8Array(256);for(let w=0;w<256;w++)z[w]=w;for(let w=0;w<255;w++){const S=w+~~(f()*(256-w)),C=z[w];z[w]=z[S],z[S]=C}return z}(z),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let w=0;w<512;w++)this.perm[w]=this.p[255&w],this.permMod12[w]=this.perm[w]%12}noise2D(f,z){const w=this.permMod12,E=this.perm;let F=0,J=0,x=0;const h=(f+z)*S,X=Math.floor(f+h),K=Math.floor(z+h),c=(X+K)*C,y=f-(X-c),e=z-(K-c);let O,d;y>e?(O=1,d=0):(O=0,d=1);const B=y-O+C,V=e-d+C,W=y-1+2*C,T=e-1+2*C,v=255&X,D=255&K;let A=.5-y*y-e*e;if(A>=0){const f=3*w[v+E[D]];A*=A,F=A*A*(u[f]*y+u[f+1]*e)}let M=.5-B*B-V*V;if(M>=0){const f=3*w[v+O+E[D+d]];M*=M,J=M*M*(u[f]*B+u[f+1]*V)}let G=.5-W*W-T*T;if(G>=0){const f=3*w[v+1+E[D+1]];G*=G,x=G*G*(u[f]*W+u[f+1]*T)}return 70*(F+J+x)}noise3D(f,z,w){const S=this.permMod12,C=this.perm;let J,x,h,X;const K=(f+z+w)*E,c=Math.floor(f+K),y=Math.floor(z+K),e=Math.floor(w+K),O=(c+y+e)*F,d=f-(c-O),B=z-(y-O),V=w-(e-O);let W,T,v,D,A,M;d>=B?B>=V?(W=1,T=0,v=0,D=1,A=1,M=0):d>=V?(W=1,T=0,v=0,D=1,A=0,M=1):(W=0,T=0,v=1,D=1,A=0,M=1):B<V?(W=0,T=0,v=1,D=0,A=1,M=1):d<V?(W=0,T=1,v=0,D=0,A=1,M=1):(W=0,T=1,v=0,D=1,A=1,M=0);const G=d-W+F,I=B-T+F,n=V-v+F,P=d-D+2*F,R=B-A+2*F,q=V-M+2*F,a=d-1+.5,s=B-1+.5,H=V-1+.5,L=255&c,U=255&y,i=255&e;let m=.6-d*d-B*B-V*V;if(m<0)J=0;else{const f=3*S[L+C[U+C[i]]];m*=m,J=m*m*(u[f]*d+u[f+1]*B+u[f+2]*V)}let r=.6-G*G-I*I-n*n;if(r<0)x=0;else{const f=3*S[L+W+C[U+T+C[i+v]]];r*=r,x=r*r*(u[f]*G+u[f+1]*I+u[f+2]*n)}let o=.6-P*P-R*R-q*q;if(o<0)h=0;else{const f=3*S[L+D+C[U+A+C[i+M]]];o*=o,h=o*o*(u[f]*P+u[f+1]*R+u[f+2]*q)}let p=.6-a*a-s*s-H*H;if(p<0)X=0;else{const f=3*S[L+1+C[U+1+C[i+1]]];p*=p,X=p*p*(u[f]*a+u[f+1]*s+u[f+2]*H)}return 32*(J+x+h+X)}noise4D(f,z,w,S){const C=this.perm;let E,F,u,X,K;const c=(f+z+w+S)*J,y=Math.floor(f+c),e=Math.floor(z+c),O=Math.floor(w+c),d=Math.floor(S+c),B=(y+e+O+d)*x,V=f-(y-B),W=z-(e-B),T=w-(O-B),v=S-(d-B);let D=0,A=0,M=0,G=0;V>W?D++:A++,V>T?D++:M++,V>v?D++:G++,W>T?A++:M++,W>v?A++:G++,T>v?M++:G++;const I=D>=3?1:0,n=A>=3?1:0,P=M>=3?1:0,R=G>=3?1:0,q=D>=2?1:0,a=A>=2?1:0,s=M>=2?1:0,H=G>=2?1:0,L=D>=1?1:0,U=A>=1?1:0,i=M>=1?1:0,m=G>=1?1:0,r=V-I+x,o=W-n+x,p=T-P+x,Y=v-R+x,t=V-q+2*x,Z=W-a+2*x,b=T-s+2*x,Q=v-H+2*x,g=V-L+3*x,k=W-U+3*x,j=T-i+3*x,l=v-m+3*x,N=V-1+4*x,ff=W-1+4*x,zf=T-1+4*x,wf=v-1+4*x,Sf=255&y,Cf=255&e,Ef=255&O,Ff=255&d;let Jf=.6-V*V-W*W-T*T-v*v;if(Jf<0)E=0;else{const f=C[Sf+C[Cf+C[Ef+C[Ff]]]]%32*4;Jf*=Jf,E=Jf*Jf*(h[f]*V+h[f+1]*W+h[f+2]*T+h[f+3]*v)}let xf=.6-r*r-o*o-p*p-Y*Y;if(xf<0)F=0;else{const f=C[Sf+I+C[Cf+n+C[Ef+P+C[Ff+R]]]]%32*4;xf*=xf,F=xf*xf*(h[f]*r+h[f+1]*o+h[f+2]*p+h[f+3]*Y)}let uf=.6-t*t-Z*Z-b*b-Q*Q;if(uf<0)u=0;else{const f=C[Sf+q+C[Cf+a+C[Ef+s+C[Ff+H]]]]%32*4;uf*=uf,u=uf*uf*(h[f]*t+h[f+1]*Z+h[f+2]*b+h[f+3]*Q)}let hf=.6-g*g-k*k-j*j-l*l;if(hf<0)X=0;else{const f=C[Sf+L+C[Cf+U+C[Ef+i+C[Ff+m]]]]%32*4;hf*=hf,X=hf*hf*(h[f]*g+h[f+1]*k+h[f+2]*j+h[f+3]*l)}let Xf=.6-N*N-ff*ff-zf*zf-wf*wf;if(Xf<0)K=0;else{const f=C[Sf+1+C[Cf+1+C[Ef+1+C[Ff+1]]]]%32*4;Xf*=Xf,K=Xf*Xf*(h[f]*N+h[f+1]*ff+h[f+2]*zf+h[f+3]*wf)}return 27*(E+F+u+X+K)}}}}]);