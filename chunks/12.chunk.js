"use strict";(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[12,20],{13110:(h,R,l)=>{l.r(R),l.d(R,{Dispose:()=>J,DumpData:()=>c,DumpDataAsync:()=>u,DumpFramebuffer:()=>mh,DumpTools:()=>q});var j=l(13005),a=l(12689),D=l(12917),U=l(12749);let F,w=null;async function mh(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const F=await l.readPixels(0,0,h,R);c(h,R,new Uint8Array(F.buffer),j,a,D,!0,void 0,U)}async function u(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{c(h,R,l,(h=>w(h)),j,a,D,U,F)}))}function c(h,R,mh,u){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((h,R)=>{let a,D=null;const w={o:!0,depth:!1,uF:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,13026)).then((mh=>{let{ThinEngine:u}=mh;const c=U.b.Instances.length;try{a=new OffscreenCanvas(100,100),D=new u(a,!1,w)}catch(Y){var q;c<U.b.Instances.length&&(null===(q=U.b.Instances.pop())||void 0===q||q.dispose()),a=document.createElement("canvas"),D=new u(a,!1,w)}U.b.Instances.pop(),U.b.OnEnginesDisposedObservable.add((h=>{D&&h!==D&&!D.mh&&0===U.b.Instances.length&&J()})),D.getCaps().parallelShaderCompile=void 0;const Q=new j.c(D);l.e(52).then(l.bind(l,15412)).then((l=>{let{passPixelShader:U}=l;if(!D)return void R("Engine is not defined");const w=new j.g({sR:D,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});F={canvas:a,sR:D,renderer:Q,wrapper:w},h(F)}))})).catch(R)}))),await w})().then((l=>{if(l.sR.setSize(h,R,!0),mh instanceof Float32Array){const h=new Uint8Array(mh.length);let R=mh.length;for(;R--;){const l=mh[R];h[R]=Math.round(255*(0,D.Clamp)(l))}mh=h}const j=l.sR.createRawTexture(mh,h,R,5,!1,!Q,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",j),l.renderer.draw(),Y?a.Tools.ToBlob(l.canvas,(h=>{const R=new FileReader;R.onload=h=>{const R=h.target.result;u&&u(R)},R.readAsArrayBuffer(h)}),c,s):a.Tools.EncodeScreenshotCanvasData(l.canvas,u,c,q,s),j.dispose()}))}function J(){var h;F?(F.wrapper.dispose(),F.renderer.dispose(),F.sR.dispose()):null===(h=w)||void 0===h||h.then((h=>{h.wrapper.dispose(),h.renderer.dispose(),h.sR.dispose()}));w=null,F=null}const q={DumpData:c,DumpDataAsync:u,DumpFramebuffer:mh,Dispose:J};a.Tools.DumpData=c,a.Tools.DumpDataAsync=u,a.Tools.DumpFramebuffer=mh},12865:(h,R,l)=>{l.r(R),l.d(R,{CreateScreenshot:()=>T,CreateScreenshotAsync:()=>E,CreateScreenshotUsingRenderTarget:()=>G,CreateScreenshotUsingRenderTargetAsync:()=>p,CreateScreenshotWithResizeAsync:()=>x,ScreenshotTools:()=>y});var j=l(12874),a=l(12974),D=l(13002),U=l(12852),F=l(12942),w=l(13005),mh=l(13022),u=l(12900);class c extends w.g{static _GetDefines(h){if(!h)return null;return h.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(h,R){h?(this._webGPUReady=!0,R.push(Promise.all([l.e(54).then(l.bind(l,15426)),l.e(55).then(l.bind(l,15432))]))):R.push(Promise.all([l.e(56).then(l.bind(l,15439)),l.e(57).then(l.bind(l,15443))]))}constructor(h){const R={...arguments.length>2?arguments[2]:void 0,name:h,sR:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||mh.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:c.VertexUrl,fragmentShader:c.FragmentUrl,uniforms:c.Uniforms};super({...R,defines:c._GetDefines(R.sR)}),this.texelSize=new u.Vector2(0,0)}bind(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(h),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}c.VertexUrl="fxaa",c.FragmentUrl="fxaa",c.Uniforms=["texelSize"];class J extends D.e{getClassName(){return"FxaaPostProcess"}constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const w={uniforms:c.Uniforms,size:"number"===typeof R?R:void 0,camera:l,samplingMode:a||j.b.BILINEAR_SAMPLINGMODE,sR:D,reusable:U,textureType:F,...R};super(h,c.FragmentUrl,{effectWrapper:"number"!==typeof R&&R.effectWrapper?void 0:new c(h,D,w),...w}),this.onApplyObservable.add((h=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(h,R,l,j){return F.c.Parse((()=>new J(h.name,h.options,R,h.renderTargetSamplingMode,l.getEngine(),h.reusable)),h,l,j)}}(0,U.f)("BABYLON.FxaaPostProcess",J);var q=l(12711),Q=l(12689),Y=l(13110),s=l(13112),t=l(12790);let f=null;function T(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:w,width:mh}=O(h,R,l);if(!w||!mh)return void q.c.Error("Invalid 'size' parameter !");R.yh().activeCamera===R?h.onEndFrameObservable.addOnce((()=>{f||(f=document.createElement("canvas")),f.width=mh,f.height=w;const R=f.getContext("2d"),l=h.getRenderingCanvas();if(!R||!l)return void q.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const u=l.width,c=l.height,J=f.width,Y=f.height,s=J/u,t=Y/c,T=F?Math.max(s,t):Math.min(s,t),E=u*T,x=c*T,G=(J-E)/2,p=(Y-x)/2;R.drawImage(l,0,0,u,c,G,p,E,x),D?(Q.Tools.EncodeScreenshotCanvasData(f,void 0,a,void 0,U),j&&j("")):Q.Tools.EncodeScreenshotCanvasData(f,j,a,void 0,U)})):G(h,R,l,(h=>{if(D){const R=new Blob([h]);Q.Tools.DownloadBlob(R),j&&j("")}else j&&j(h)}),a,1,h.getCreationOptions().antialias,void 0,void 0,void 0,void 0,U)}async function E(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((U,F)=>{T(h,R,l,(h=>{"undefined"!==typeof h?U(h):F(new Error("Data is undefined"))}),j,void 0,a,D)}))}async function x(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((F=>{T(h,R,{width:l,height:j},(()=>{F()}),a,!0,D,U)}))}function G(h,R,D,U){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,mh=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]&&arguments[9],f=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],T=arguments.length>11?arguments[11]:void 0,E=arguments.length>12?arguments[12]:void 0,x=arguments.length>13?arguments[13]:void 0;const{height:G,width:p,finalWidth:y,finalHeight:v}=O(h,R,D),b={width:p,height:G};if(!G||!p)return void q.c.Error("Invalid 'size' parameter !");h.skipFrameRender=!0;const I=h.getRenderWidth,L=h.getRenderHeight;h.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&h._currentRenderTarget?h._currentRenderTarget.width:p},h.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&h._currentRenderTarget?h._currentRenderTarget.height:G},h.onResizeObservable.hasObservers()&&h.onResizeObservable.notifyObservers(h);const n=R.yh(),r=new a.c("screenShot",b,n,!1,!1,0,!1,j.b.BILINEAR_SAMPLINGMODE,void 0,Q,void 0,void 0,void 0,w);r.renderList=n.meshes.slice(),r.samples=w,r.renderSprites=c,r.activeCamera=R,r.forceLayerMaskCheck=f,null===E||void 0===E||E(r);const P=x||Y.DumpData,z=()=>{n.incrementRenderId(),n.resetCachedMaterial(),(0,t.c)((()=>r.isReadyForRendering()&&R.isReady(!0)),(()=>{h.onEndFrameObservable.addOnce((()=>{y===p&&v===G?r.readPixels(void 0,void 0,void 0,!1).then((h=>{P(p,G,h,U,F,u,!0,void 0,T),r.dispose()})):(h.isWebGPU?l.e(51).then(l.bind(l,15406)):l.e(52).then(l.bind(l,15412))).then((async()=>await(0,s.b)("pass",r.getInternalTexture(),n,void 0,void 0,void 0,y,v).then((R=>{h._readTexturePixels(R,y,v,-1,0,null,!0,!1,0,0).then((h=>{P(y,v,h,U,F,u,!0,void 0,T),R.dispose()}))}))))})),n.incrementRenderId(),n.resetCachedMaterial();const j=n.activeCamera,a=n.activeCameras,D=R.outputRenderTarget,w=n.spritesEnabled;n.activeCamera=R,n.activeCameras=null,R.outputRenderTarget=r,n.spritesEnabled=c;const mh=n.meshes;n.meshes=r.renderList||n.meshes;try{n.render()}finally{n.activeCamera=j,n.activeCameras=a,R.outputRenderTarget=D,n.spritesEnabled=w,n.meshes=mh,h.getRenderWidth=I,h.getRenderHeight=L,h.onResizeObservable.hasObservers()&&h.onResizeObservable.notifyObservers(h),R.getProjectionMatrix(!0),h.skipFrameRender=!1}}),(()=>{h.skipFrameRender=!1,h.getRenderWidth=I,h.getRenderHeight=L}))};if(mh){const h=new J("antialiasing",1,n.activeCamera);r.addPostProcess(h),h.QF=!0,h.onEffectCreatedObservable.addOnce((h=>{h.isReady()?z():h.onCompiled=()=>{z()}}))}else z()}async function p(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8&&void 0!==arguments[8]&&arguments[8],mh=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],u=arguments.length>10?arguments[10]:void 0,c=arguments.length>11?arguments[11]:void 0,J=arguments.length>12?arguments[12]:void 0;return await new Promise(((q,Q)=>{G(h,R,l,(h=>{"undefined"!==typeof h?q(h):Q(new Error("Data is undefined"))}),j,a,D,U,F,w,mh,u,c,J)}))}function O(h,R,l){let j=0,a=0,D=0,U=0;if("object"===typeof l){const F=l.precision?Math.abs(l.precision):1;l.width&&l.height?(j=l.height*F,a=l.width*F):l.width&&!l.height?(a=l.width*F,j=Math.round(a/h.getAspectRatio(R))):l.height&&!l.width?(j=l.height*F,a=Math.round(j*h.getAspectRatio(R))):(a=Math.round(h.getRenderWidth()*F),j=Math.round(a/h.getAspectRatio(R))),l.finalWidth&&l.finalHeight?(U=l.finalHeight,D=l.finalWidth):l.finalWidth&&!l.finalHeight?(D=l.finalWidth,U=Math.round(D/h.getAspectRatio(R))):l.finalHeight&&!l.finalWidth?(U=l.finalHeight,D=Math.round(U*h.getAspectRatio(R))):(D=a,U=j)}else isNaN(l)||(j=l,a=l,D=l,U=l);return a&&(a=Math.floor(a)),j&&(j=Math.floor(j)),D&&(D=Math.floor(D)),U&&(U=Math.floor(U)),{height:0|j,width:0|a,finalWidth:0|D,finalHeight:0|U}}const y={CreateScreenshot:T,CreateScreenshotAsync:E,CreateScreenshotWithResizeAsync:x,CreateScreenshotUsingRenderTarget:G,CreateScreenshotUsingRenderTargetAsync:p};Q.Tools.CreateScreenshot=T,Q.Tools.CreateScreenshotAsync=E,Q.Tools.CreateScreenshotUsingRenderTarget=G,Q.Tools.CreateScreenshotUsingRenderTargetAsync=p}}]);