"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[12,20],{13027:(a,c,o)=>{o.r(c),o.d(c,{Dispose:()=>L,DumpData:()=>j,DumpDataAsync:()=>C,DumpFramebuffer:()=>T,DumpTools:()=>e});var s=o(12910),q=o(12637),t=o(12824),i=o(12680);let p,G=null;async function T(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const p=await o.readPixels(0,0,a,c);j(a,c,new Uint8Array(p.buffer),s,q,t,!0,void 0,i)}async function C(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;return await new Promise((G=>{j(a,c,o,(a=>G(a)),s,q,t,i,p)}))}function j(a,c,T,C){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],N=arguments.length>8?arguments[8]:void 0;(async function(){return G||(G=new Promise(((a,c)=>{let q,t=null;const G={fc:!0,depth:!1,Nc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,12945)).then((T=>{let{ThinEngine:C}=T;const j=i.b.Instances.length;try{q=new OffscreenCanvas(100,100),t=new C(q,!1,G)}catch(M){var e;j<i.b.Instances.length&&(null===(e=i.b.Instances.pop())||void 0===e||e.dispose()),q=document.createElement("canvas"),t=new C(q,!1,G)}i.b.Instances.pop(),i.b.OnEnginesDisposedObservable.add((a=>{t&&a!==t&&!t.L&&0===i.b.Instances.length&&L()})),t.getCaps().parallelShaderCompile=void 0;const g=new s.d(t);o.e(52).then(o.bind(o,15260)).then((o=>{let{passPixelShader:i}=o;if(!t)return void c("Engine is not defined");const G=new s.h({mo:t,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});p={canvas:q,mo:t,renderer:g,wrapper:G},a(p)}))})).catch(c)}))),await G})().then((o=>{if(o.mo.setSize(a,c,!0),T instanceof Float32Array){const a=new Uint8Array(T.length);let c=T.length;for(;c--;){const o=T[c];a[c]=Math.round(255*(0,t.Clamp)(o))}T=a}const s=o.mo.createRawTexture(T,a,c,5,!1,!g,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",s),o.renderer.draw(),M?q.Tools.ToBlob(o.canvas,(a=>{const c=new FileReader;c.onload=a=>{const c=a.target.result;C&&C(c)},c.readAsArrayBuffer(a)}),j,N):q.Tools.EncodeScreenshotCanvasData(o.canvas,C,j,e,N),s.dispose()}))}function L(){var a;p?(p.wrapper.dispose(),p.renderer.dispose(),p.mo.dispose()):null===(a=G)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.mo.dispose()}));G=null,p=null}const e={DumpData:j,DumpDataAsync:C,DumpFramebuffer:T,Dispose:L};q.Tools.DumpData=j,q.Tools.DumpDataAsync=C,q.Tools.DumpFramebuffer=T},12793:(a,c,o)=>{o.r(c),o.d(c,{CreateScreenshot:()=>n,CreateScreenshotAsync:()=>f,CreateScreenshotUsingRenderTarget:()=>w,CreateScreenshotUsingRenderTargetAsync:()=>Z,CreateScreenshotWithResizeAsync:()=>J,ScreenshotTools:()=>U});var s=o(12796),q=o(12870),t=o(12904),i=o(12776),p=o(12845),G=o(12910),T=o(12936),C=o(12810);class j extends G.h{static _GetDefines(a){if(!a)return null;return a.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(a,c){a?(this._webGPUReady=!0,c.push(Promise.all([o.e(54).then(o.bind(o,15270)),o.e(55).then(o.bind(o,15273))]))):c.push(Promise.all([o.e(56).then(o.bind(o,15277)),o.e(57).then(o.bind(o,15281))]))}constructor(a){const c={...arguments.length>2?arguments[2]:void 0,name:a,mo:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||T.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:j.VertexUrl,fragmentShader:j.FragmentUrl,uniforms:j.Uniforms};super({...c,defines:j._GetDefines(c.mo)}),this.texelSize=new C.Vector2(0,0)}bind(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(a),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}j.VertexUrl="fxaa",j.FragmentUrl="fxaa",j.Uniforms=["texelSize"];class L extends t.c{getClassName(){return"FxaaPostProcess"}constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const G={uniforms:j.Uniforms,size:"number"===typeof c?c:void 0,camera:o,samplingMode:q||s.e.BILINEAR_SAMPLINGMODE,mo:t,reusable:i,textureType:p,...c};super(a,j.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new j(a,t,G),...G}),this.onApplyObservable.add((a=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(a,c,o,s){return p.d.Parse((()=>new L(a.name,a.options,c,a.renderTargetSamplingMode,o.getEngine(),a.reusable)),a,o,s)}}(0,i.d)("BABYLON.FxaaPostProcess",L);var e=o(12649),g=o(12637),M=o(13027),N=o(13035),y=o(12712);let k=null;function n(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0,p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:G,width:T}=h(a,c,o);if(!G||!T)return void e.c.Error("Invalid 'size' parameter !");c.Za().activeCamera===c?a.onEndFrameObservable.addOnce((()=>{k||(k=document.createElement("canvas")),k.width=T,k.height=G;const c=k.getContext("2d"),o=a.getRenderingCanvas();if(!c||!o)return void e.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const C=o.width,j=o.height,L=k.width,M=k.height,N=L/C,y=M/j,n=p?Math.max(N,y):Math.min(N,y),f=C*n,J=j*n,w=(L-f)/2,Z=(M-J)/2;c.drawImage(o,0,0,C,j,w,Z,f,J),t?(g.Tools.EncodeScreenshotCanvasData(k,void 0,q,void 0,i),s&&s("")):g.Tools.EncodeScreenshotCanvasData(k,s,q,void 0,i)})):w(a,c,o,(a=>{if(t){const c=new Blob([a]);g.Tools.DownloadBlob(c),s&&s("")}else s&&s(a)}),q,1,a.getCreationOptions().antialias,void 0,void 0,void 0,void 0,i)}async function f(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((i,p)=>{n(a,c,o,(a=>{"undefined"!==typeof a?i(a):p(new Error("Data is undefined"))}),s,void 0,q,t)}))}async function J(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((p=>{n(a,c,{width:o,height:s},(()=>{p()}),q,!0,t,i)}))}function w(a,c,t,i){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],g=arguments.length>9&&void 0!==arguments[9]&&arguments[9],k=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],n=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,J=arguments.length>13?arguments[13]:void 0;const{height:w,width:Z,finalWidth:U,finalHeight:S}=h(a,c,t),r={width:Z,height:w};if(!w||!Z)return void e.c.Error("Invalid 'size' parameter !");a.skipFrameRender=!0;const x=a.getRenderWidth,R=a.getRenderHeight;a.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&a._currentRenderTarget?a._currentRenderTarget.width:Z},a.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&a._currentRenderTarget?a._currentRenderTarget.height:w},a.onResizeObservable.hasObservers()&&a.onResizeObservable.notifyObservers(a);const d=c.Za(),X=new q.d("screenShot",r,d,!1,!1,0,!1,s.e.BILINEAR_SAMPLINGMODE,void 0,g,void 0,void 0,void 0,G);X.renderList=d.meshes.slice(),X.samples=G,X.renderSprites=j,X.activeCamera=c,X.forceLayerMaskCheck=k,null===f||void 0===f||f(X);const W=J||M.DumpData,F=()=>{d.incrementRenderId(),d.resetCachedMaterial(),(0,y.h)((()=>X.isReadyForRendering()&&c.isReady(!0)),(()=>{a.onEndFrameObservable.addOnce((()=>{U===Z&&S===w?X.readPixels(void 0,void 0,void 0,!1).then((a=>{W(Z,w,a,i,p,C,!0,void 0,n),X.dispose()})):(a.isWebGPU?o.e(51).then(o.bind(o,15253)):o.e(52).then(o.bind(o,15260))).then((async()=>await(0,N.c)("pass",X.getInternalTexture(),d,void 0,void 0,void 0,U,S).then((c=>{a._readTexturePixels(c,U,S,-1,0,null,!0,!1,0,0).then((a=>{W(U,S,a,i,p,C,!0,void 0,n),c.dispose()}))}))))})),d.incrementRenderId(),d.resetCachedMaterial();const s=d.activeCamera,q=d.activeCameras,t=c.outputRenderTarget,G=d.spritesEnabled;d.activeCamera=c,d.activeCameras=null,c.outputRenderTarget=X,d.spritesEnabled=j;const T=d.meshes;d.meshes=X.renderList||d.meshes;try{d.render()}finally{d.activeCamera=s,d.activeCameras=q,c.outputRenderTarget=t,d.spritesEnabled=G,d.meshes=T,a.getRenderWidth=x,a.getRenderHeight=R,a.onResizeObservable.hasObservers()&&a.onResizeObservable.notifyObservers(a),c.getProjectionMatrix(!0),a.skipFrameRender=!1}}),(()=>{a.skipFrameRender=!1,a.getRenderWidth=x,a.getRenderHeight=R}))};if(T){const a=new L("antialiasing",1,d.activeCamera);X.addPostProcess(a),a.Jc=!0,a.onEffectCreatedObservable.addOnce((a=>{a.isReady()?F():a.onCompiled=()=>{F()}}))}else F()}async function Z(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0,p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],T=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],C=arguments.length>10?arguments[10]:void 0,j=arguments.length>11?arguments[11]:void 0,L=arguments.length>12?arguments[12]:void 0;return await new Promise(((e,g)=>{w(a,c,o,(a=>{"undefined"!==typeof a?e(a):g(new Error("Data is undefined"))}),s,q,t,i,p,G,T,C,j,L)}))}function h(a,c,o){let s=0,q=0,t=0,i=0;if("object"===typeof o){const p=o.precision?Math.abs(o.precision):1;o.width&&o.height?(s=o.height*p,q=o.width*p):o.width&&!o.height?(q=o.width*p,s=Math.round(q/a.getAspectRatio(c))):o.height&&!o.width?(s=o.height*p,q=Math.round(s*a.getAspectRatio(c))):(q=Math.round(a.getRenderWidth()*p),s=Math.round(q/a.getAspectRatio(c))),o.finalWidth&&o.finalHeight?(i=o.finalHeight,t=o.finalWidth):o.finalWidth&&!o.finalHeight?(t=o.finalWidth,i=Math.round(t/a.getAspectRatio(c))):o.finalHeight&&!o.finalWidth?(i=o.finalHeight,t=Math.round(i*a.getAspectRatio(c))):(t=q,i=s)}else isNaN(o)||(s=o,q=o,t=o,i=o);return q&&(q=Math.floor(q)),s&&(s=Math.floor(s)),t&&(t=Math.floor(t)),i&&(i=Math.floor(i)),{height:0|s,width:0|q,finalWidth:0|t,finalHeight:0|i}}const U={CreateScreenshot:n,CreateScreenshotAsync:f,CreateScreenshotWithResizeAsync:J,CreateScreenshotUsingRenderTarget:w,CreateScreenshotUsingRenderTargetAsync:Z};g.Tools.CreateScreenshot=n,g.Tools.CreateScreenshotAsync=f,g.Tools.CreateScreenshotUsingRenderTarget=w,g.Tools.CreateScreenshotUsingRenderTargetAsync=Z}}]);