"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[12,20],{12791:(r,O,W)=>{W.r(O),W.d(O,{Dispose:()=>g,DumpData:()=>v,DumpDataAsync:()=>d,DumpFramebuffer:()=>mr,DumpTools:()=>K});var q=W(12691),Q=W(12428),C=W(12602),T=W(12484);let h,J=null;async function mr(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0;const h=await W.readPixels(0,0,r,O);v(r,O,new Uint8Array(h.buffer),q,Q,C,!0,void 0,T)}async function d(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0;return await new Promise((J=>{v(r,O,W,(r=>J(r)),q,Q,C,T,h)}))}function v(r,O,mr,d){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",K=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8?arguments[8]:void 0;(async function(){return J||(J=new Promise(((r,O)=>{let Q,C=null;const J={Ph:!0,depth:!1,dh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(W.bind(W,12718)).then((mr=>{let{ThinEngine:d}=mr;const v=T.d.Instances.length;try{Q=new OffscreenCanvas(100,100),C=new d(Q,!1,J)}catch(P){var K;v<T.d.Instances.length&&(null===(K=T.d.Instances.pop())||void 0===K||K.dispose()),Q=document.createElement("canvas"),C=new d(Q,!1,J)}T.d.Instances.pop(),T.d.OnEnginesDisposedObservable.add((r=>{C&&r!==C&&!C.J&&0===T.d.Instances.length&&g()})),C.getCaps().parallelShaderCompile=void 0;const U=new q.e(C);W.e(52).then(W.bind(W,15104)).then((W=>{let{passPixelShader:T}=W;if(!C)return void O("Engine is not defined");const J=new q.g({bO:C,name:T.name,fragmentShader:T.shader,samplerNames:["textureSampler"]});h={canvas:Q,bO:C,renderer:U,wrapper:J},r(h)}))})).catch(O)}))),await J})().then((W=>{if(W.bO.setSize(r,O,!0),mr instanceof Float32Array){const r=new Uint8Array(mr.length);let O=mr.length;for(;O--;){const W=mr[O];r[O]=Math.round(255*(0,C.Clamp)(W))}mr=r}const q=W.bO.createRawTexture(mr,r,O,5,!1,!U,1);W.renderer.setViewport(),W.renderer.applyEffectWrapper(W.wrapper),W.wrapper.effect._bindTexture("textureSampler",q),W.renderer.draw(),P?Q.Tools.ToBlob(W.canvas,(r=>{const O=new FileReader;O.onload=r=>{const O=r.target.result;d&&d(O)},O.readAsArrayBuffer(r)}),v,b):Q.Tools.EncodeScreenshotCanvasData(W.canvas,d,v,K,b),q.dispose()}))}function g(){var r;h?(h.wrapper.dispose(),h.renderer.dispose(),h.bO.dispose()):null===(r=J)||void 0===r||r.then((r=>{r.wrapper.dispose(),r.renderer.dispose(),r.bO.dispose()}));J=null,h=null}const K={DumpData:v,DumpDataAsync:d,DumpFramebuffer:mr,Dispose:g};Q.Tools.DumpData=v,Q.Tools.DumpDataAsync=d,Q.Tools.DumpFramebuffer=mr},12572:(r,O,W)=>{W.r(O),W.d(O,{CreateScreenshot:()=>G,CreateScreenshotAsync:()=>X,CreateScreenshotUsingRenderTarget:()=>o,CreateScreenshotUsingRenderTargetAsync:()=>N,CreateScreenshotWithResizeAsync:()=>S,ScreenshotTools:()=>p});var q=W(12575),Q=W(12654),C=W(12686),T=W(12560),h=W(12617),J=W(12691),mr=W(12715),d=W(12591);class v extends J.g{static _GetDefines(r){if(!r)return null;return r.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(r,O){r?(this._webGPUReady=!0,O.push(Promise.all([W.e(54).then(W.bind(W,15114)),W.e(55).then(W.bind(W,15120))]))):O.push(Promise.all([W.e(56).then(W.bind(W,15128)),W.e(57).then(W.bind(W,15135))]))}constructor(r){const O={...arguments.length>2?arguments[2]:void 0,name:r,bO:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||mr.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:v.VertexUrl,fragmentShader:v.FragmentUrl,uniforms:v.Uniforms};super({...O,defines:v._GetDefines(O.bO)}),this.texelSize=new d.Vector2(0,0)}bind(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(r),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}v.VertexUrl="fxaa",v.FragmentUrl="fxaa",v.Uniforms=["texelSize"];class g extends C.d{getClassName(){return"FxaaPostProcess"}constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const J={uniforms:v.Uniforms,size:"number"===typeof O?O:void 0,camera:W,samplingMode:Q||q.e.BILINEAR_SAMPLINGMODE,bO:C,reusable:T,textureType:h,...O};super(r,v.FragmentUrl,{effectWrapper:"number"!==typeof O&&O.effectWrapper?void 0:new v(r,C,J),...J}),this.onApplyObservable.add((r=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(r,O,W,q){return h.b.Parse((()=>new g(r.name,r.options,O,r.renderTargetSamplingMode,W.getEngine(),r.reusable)),r,W,q)}}(0,T.e)("BABYLON.FxaaPostProcess",g);var K=W(12453),U=W(12428),P=W(12791),b=W(12796),e=W(12509);let Y=null;function G(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:J,width:mr}=D(r,O,W);if(!J||!mr)return void K.b.Error("Invalid 'size' parameter !");O.Dr().activeCamera===O?r.onEndFrameObservable.addOnce((()=>{Y||(Y=document.createElement("canvas")),Y.width=mr,Y.height=J;const O=Y.getContext("2d"),W=r.getRenderingCanvas();if(!O||!W)return void K.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const d=W.width,v=W.height,g=Y.width,P=Y.height,b=g/d,e=P/v,G=h?Math.max(b,e):Math.min(b,e),X=d*G,S=v*G,o=(g-X)/2,N=(P-S)/2;O.drawImage(W,0,0,d,v,o,N,X,S),C?(U.Tools.EncodeScreenshotCanvasData(Y,void 0,Q,void 0,T),q&&q("")):U.Tools.EncodeScreenshotCanvasData(Y,q,Q,void 0,T)})):o(r,O,W,(r=>{if(C){const O=new Blob([r]);U.Tools.DownloadBlob(O),q&&q("")}else q&&q(r)}),Q,1,r.getCreationOptions().antialias,void 0,void 0,void 0,void 0,T)}async function X(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((T,h)=>{G(r,O,W,(r=>{"undefined"!==typeof r?T(r):h(new Error("Data is undefined"))}),q,void 0,Q,C)}))}async function S(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((h=>{G(r,O,{width:W,height:q},(()=>{h()}),Q,!0,C,T)}))}function o(r,O,C,T){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,mr=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0,v=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Y=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],G=arguments.length>11?arguments[11]:void 0,X=arguments.length>12?arguments[12]:void 0,S=arguments.length>13?arguments[13]:void 0;const{height:o,width:N,finalWidth:p,finalHeight:z}=D(r,O,C),L={width:N,height:o};if(!o||!N)return void K.b.Error("Invalid 'size' parameter !");r.skipFrameRender=!0;const M=r.getRenderWidth,k=r.getRenderHeight;r.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&r._currentRenderTarget?r._currentRenderTarget.width:N},r.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&r._currentRenderTarget?r._currentRenderTarget.height:o},r.onResizeObservable.hasObservers()&&r.onResizeObservable.notifyObservers(r);const s=O.Dr(),B=new Q.b("screenShot",L,s,!1,!1,0,!1,q.e.BILINEAR_SAMPLINGMODE,void 0,U,void 0,void 0,void 0,J);B.renderList=s.meshes.slice(),B.samples=J,B.renderSprites=v,B.activeCamera=O,B.forceLayerMaskCheck=Y,null===X||void 0===X||X(B);const Z=S||P.DumpData,E=()=>{s.incrementRenderId(),s.resetCachedMaterial(),(0,e.d)((()=>B.isReadyForRendering()&&O.isReady(!0)),(()=>{r.onEndFrameObservable.addOnce((()=>{p===N&&z===o?B.readPixels(void 0,void 0,void 0,!1).then((r=>{Z(N,o,r,T,h,d,!0,void 0,G),B.dispose()})):(r.isWebGPU?W.e(51).then(W.bind(W,15098)):W.e(52).then(W.bind(W,15104))).then((async()=>await(0,b.b)("pass",B.getInternalTexture(),s,void 0,void 0,void 0,p,z).then((O=>{r._readTexturePixels(O,p,z,-1,0,null,!0,!1,0,0).then((r=>{Z(p,z,r,T,h,d,!0,void 0,G),O.dispose()}))}))))})),s.incrementRenderId(),s.resetCachedMaterial();const q=s.activeCamera,Q=s.activeCameras,C=O.outputRenderTarget,J=s.spritesEnabled;s.activeCamera=O,s.activeCameras=null,O.outputRenderTarget=B,s.spritesEnabled=v;const mr=s.meshes;s.meshes=B.renderList||s.meshes;try{s.render()}finally{s.activeCamera=q,s.activeCameras=Q,O.outputRenderTarget=C,s.spritesEnabled=J,s.meshes=mr,r.getRenderWidth=M,r.getRenderHeight=k,r.onResizeObservable.hasObservers()&&r.onResizeObservable.notifyObservers(r),O.getProjectionMatrix(!0),r.skipFrameRender=!1}}),(()=>{r.skipFrameRender=!1,r.getRenderWidth=M,r.getRenderHeight=k}))};if(mr){const r=new g("antialiasing",1,s.activeCamera);B.addPostProcess(r),r.bh=!0,r.onEffectCreatedObservable.addOnce((r=>{r.isReady()?E():r.onCompiled=()=>{E()}}))}else E()}async function N(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]&&arguments[8],mr=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=arguments.length>10?arguments[10]:void 0,v=arguments.length>11?arguments[11]:void 0,g=arguments.length>12?arguments[12]:void 0;return await new Promise(((K,U)=>{o(r,O,W,(r=>{"undefined"!==typeof r?K(r):U(new Error("Data is undefined"))}),q,Q,C,T,h,J,mr,d,v,g)}))}function D(r,O,W){let q=0,Q=0,C=0,T=0;if("object"===typeof W){const h=W.precision?Math.abs(W.precision):1;W.width&&W.height?(q=W.height*h,Q=W.width*h):W.width&&!W.height?(Q=W.width*h,q=Math.round(Q/r.getAspectRatio(O))):W.height&&!W.width?(q=W.height*h,Q=Math.round(q*r.getAspectRatio(O))):(Q=Math.round(r.getRenderWidth()*h),q=Math.round(Q/r.getAspectRatio(O))),W.finalWidth&&W.finalHeight?(T=W.finalHeight,C=W.finalWidth):W.finalWidth&&!W.finalHeight?(C=W.finalWidth,T=Math.round(C/r.getAspectRatio(O))):W.finalHeight&&!W.finalWidth?(T=W.finalHeight,C=Math.round(T*r.getAspectRatio(O))):(C=Q,T=q)}else isNaN(W)||(q=W,Q=W,C=W,T=W);return Q&&(Q=Math.floor(Q)),q&&(q=Math.floor(q)),C&&(C=Math.floor(C)),T&&(T=Math.floor(T)),{height:0|q,width:0|Q,finalWidth:0|C,finalHeight:0|T}}const p={CreateScreenshot:G,CreateScreenshotAsync:X,CreateScreenshotWithResizeAsync:S,CreateScreenshotUsingRenderTarget:o,CreateScreenshotUsingRenderTargetAsync:N};U.Tools.CreateScreenshot=G,U.Tools.CreateScreenshotAsync=X,U.Tools.CreateScreenshotUsingRenderTarget=o,U.Tools.CreateScreenshotUsingRenderTargetAsync=N}}]);