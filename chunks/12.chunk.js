"use strict";(self.k9ivgwsw3f=self.k9ivgwsw3f||[]).push([[12,20],{13053:(Y,b,C)=>{C.r(b),C.d(b,{Dispose:()=>y,DumpData:()=>F,DumpDataAsync:()=>O,DumpFramebuffer:()=>r,DumpTools:()=>S});var R=C(12929),q=C(12645),A=C(12852),E=C(12702);let B,g=null;async function r(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",A=arguments.length>5?arguments[5]:void 0,E=arguments.length>6?arguments[6]:void 0;const B=await C.readPixels(0,0,Y,b);F(Y,b,new Uint8Array(B.buffer),R,q,A,!0,void 0,E)}async function O(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0;return await new Promise((g=>{F(Y,b,C,(Y=>g(Y)),R,q,A,E,B)}))}function F(Y,b,r,O){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",S=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return g||(g=new Promise(((Y,b)=>{let q,A=null;const g={pb:!0,depth:!1,nb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12963)).then((r=>{let{ThinEngine:O}=r;const F=E.d.Instances.length;try{q=new OffscreenCanvas(100,100),A=new O(q,!1,g)}catch(t){var S;F<E.d.Instances.length&&(null===(S=E.d.Instances.pop())||void 0===S||S.dispose()),q=document.createElement("canvas"),A=new O(q,!1,g)}E.d.Instances.pop(),E.d.OnEnginesDisposedObservable.add((Y=>{A&&Y!==A&&!A.O&&0===E.d.Instances.length&&y()})),A.getCaps().parallelShaderCompile=void 0;const n=new R.e(A);C.e(52).then(C.bind(C,15407)).then((C=>{let{passPixelShader:E}=C;if(!A)return void b("Engine is not defined");const g=new R.h({qC:A,name:E.name,fragmentShader:E.shader,samplerNames:["textureSampler"]});B={canvas:q,qC:A,renderer:n,wrapper:g},Y(B)}))})).catch(b)}))),await g})().then((C=>{if(C.qC.setSize(Y,b,!0),r instanceof Float32Array){const Y=new Uint8Array(r.length);let b=r.length;for(;b--;){const C=r[b];Y[b]=Math.round(255*(0,A.Clamp)(C))}r=Y}const R=C.qC.createRawTexture(r,Y,b,5,!1,!n,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",R),C.renderer.draw(),t?q.Tools.ToBlob(C.canvas,(Y=>{const b=new FileReader;b.onload=Y=>{const b=Y.target.result;O&&O(b)},b.readAsArrayBuffer(Y)}),F,I):q.Tools.EncodeScreenshotCanvasData(C.canvas,O,F,S,I),R.dispose()}))}function y(){var Y;B?(B.wrapper.dispose(),B.renderer.dispose(),B.qC.dispose()):null===(Y=g)||void 0===Y||Y.then((Y=>{Y.wrapper.dispose(),Y.renderer.dispose(),Y.qC.dispose()}));g=null,B=null}const S={DumpData:F,DumpDataAsync:O,DumpFramebuffer:r,Dispose:y};q.Tools.DumpData=F,q.Tools.DumpDataAsync=O,q.Tools.DumpFramebuffer=r},12808:(Y,b,C)=>{C.r(b),C.d(b,{CreateScreenshot:()=>N,CreateScreenshotAsync:()=>p,CreateScreenshotUsingRenderTarget:()=>L,CreateScreenshotUsingRenderTargetAsync:()=>u,CreateScreenshotWithResizeAsync:()=>mY,ScreenshotTools:()=>l});var R=C(12814),q=C(12897),A=C(12924),E=C(12790),B=C(12870),g=C(12929),r=C(12957),O=C(12831);class F extends g.h{static _GetDefines(Y){if(!Y)return null;return Y.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(Y,b){Y?(this._webGPUReady=!0,b.push(Promise.all([C.e(54).then(C.bind(C,15421)),C.e(55).then(C.bind(C,15424))]))):b.push(Promise.all([C.e(56).then(C.bind(C,15429)),C.e(57).then(C.bind(C,15432))]))}constructor(Y){const b={...arguments.length>2?arguments[2]:void 0,name:Y,qC:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||r.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:F.VertexUrl,fragmentShader:F.FragmentUrl,uniforms:F.Uniforms};super({...b,defines:F._GetDefines(b.qC)}),this.texelSize=new O.Vector2(0,0)}bind(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(Y),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}F.VertexUrl="fxaa",F.FragmentUrl="fxaa",F.Uniforms=["texelSize"];class y extends A.b{getClassName(){return"FxaaPostProcess"}constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const g={uniforms:F.Uniforms,size:"number"===typeof b?b:void 0,camera:C,samplingMode:q||R.b.BILINEAR_SAMPLINGMODE,qC:A,reusable:E,textureType:B,...b};super(Y,F.FragmentUrl,{effectWrapper:"number"!==typeof b&&b.effectWrapper?void 0:new F(Y,A,g),...g}),this.onApplyObservable.add((Y=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(Y,b,C,R){return B.e.Parse((()=>new y(Y.name,Y.options,b,Y.renderTargetSamplingMode,C.getEngine(),Y.reusable)),Y,C,R)}}(0,E.g)("BABYLON.FxaaPostProcess",y);var S=C(12669),n=C(12645),t=C(13053),I=C(13062),w=C(12726);let Q=null;function N(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6?arguments[6]:void 0,B=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:g,width:r}=c(Y,b,C);if(!g||!r)return void S.e.Error("Invalid 'size' parameter !");b.uY().activeCamera===b?Y.onEndFrameObservable.addOnce((()=>{Q||(Q=document.createElement("canvas")),Q.width=r,Q.height=g;const b=Q.getContext("2d"),C=Y.getRenderingCanvas();if(!b||!C)return void S.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const O=C.width,F=C.height,y=Q.width,t=Q.height,I=y/O,w=t/F,N=B?Math.max(I,w):Math.min(I,w),p=O*N,mY=F*N,L=(y-p)/2,u=(t-mY)/2;b.drawImage(C,0,0,O,F,L,u,p,mY),A?(n.Tools.EncodeScreenshotCanvasData(Q,void 0,q,void 0,E),R&&R("")):n.Tools.EncodeScreenshotCanvasData(Q,R,q,void 0,E)})):L(Y,b,C,(Y=>{if(A){const b=new Blob([Y]);n.Tools.DownloadBlob(b),R&&R("")}else R&&R(Y)}),q,1,Y.getCreationOptions().antialias,void 0,void 0,void 0,void 0,E)}async function p(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((E,B)=>{N(Y,b,C,(Y=>{"undefined"!==typeof Y?E(Y):B(new Error("Data is undefined"))}),R,void 0,q,A)}))}async function mY(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",A=arguments.length>5?arguments[5]:void 0,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((B=>{N(Y,b,{width:C,height:R},(()=>{B()}),q,!0,A,E)}))}function L(Y,b,A,E){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],n=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Q=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],N=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0,mY=arguments.length>13?arguments[13]:void 0;const{height:L,width:u,finalWidth:l,finalHeight:X}=c(Y,b,A),j={width:u,height:L};if(!L||!u)return void S.e.Error("Invalid 'size' parameter !");Y.skipFrameRender=!0;const T=Y.getRenderWidth,P=Y.getRenderHeight;Y.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Y._currentRenderTarget?Y._currentRenderTarget.width:u},Y.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Y._currentRenderTarget?Y._currentRenderTarget.height:L},Y.onResizeObservable.hasObservers()&&Y.onResizeObservable.notifyObservers(Y);const v=b.uY(),z=new q.d("screenShot",j,v,!1,!1,0,!1,R.b.BILINEAR_SAMPLINGMODE,void 0,n,void 0,void 0,void 0,g);z.renderList=v.meshes.slice(),z.samples=g,z.renderSprites=F,z.activeCamera=b,z.forceLayerMaskCheck=Q,null===p||void 0===p||p(z);const J=mY||t.DumpData,U=()=>{v.incrementRenderId(),v.resetCachedMaterial(),(0,w.g)((()=>z.isReadyForRendering()&&b.isReady(!0)),(()=>{Y.onEndFrameObservable.addOnce((()=>{l===u&&X===L?z.readPixels(void 0,void 0,void 0,!1).then((Y=>{J(u,L,Y,E,B,O,!0,void 0,N),z.dispose()})):(Y.isWebGPU?C.e(51).then(C.bind(C,15405)):C.e(52).then(C.bind(C,15407))).then((async()=>await(0,I.e)("pass",z.getInternalTexture(),v,void 0,void 0,void 0,l,X).then((b=>{Y._readTexturePixels(b,l,X,-1,0,null,!0,!1,0,0).then((Y=>{J(l,X,Y,E,B,O,!0,void 0,N),b.dispose()}))}))))})),v.incrementRenderId(),v.resetCachedMaterial();const R=v.activeCamera,q=v.activeCameras,A=b.outputRenderTarget,g=v.spritesEnabled;v.activeCamera=b,v.activeCameras=null,b.outputRenderTarget=z,v.spritesEnabled=F;const r=v.meshes;v.meshes=z.renderList||v.meshes;try{v.render()}finally{v.activeCamera=R,v.activeCameras=q,b.outputRenderTarget=A,v.spritesEnabled=g,v.meshes=r,Y.getRenderWidth=T,Y.getRenderHeight=P,Y.onResizeObservable.hasObservers()&&Y.onResizeObservable.notifyObservers(Y),b.getProjectionMatrix(!0),Y.skipFrameRender=!1}}),(()=>{Y.skipFrameRender=!1,Y.getRenderWidth=T,Y.getRenderHeight=P}))};if(r){const Y=new y("antialiasing",1,v.activeCamera);z.addPostProcess(Y),Y.Lb=!0,Y.onEffectCreatedObservable.addOnce((Y=>{Y.isReady()?U():Y.onCompiled=()=>{U()}}))}else U()}async function u(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6?arguments[6]:void 0,B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],O=arguments.length>10?arguments[10]:void 0,F=arguments.length>11?arguments[11]:void 0,y=arguments.length>12?arguments[12]:void 0;return await new Promise(((S,n)=>{L(Y,b,C,(Y=>{"undefined"!==typeof Y?S(Y):n(new Error("Data is undefined"))}),R,q,A,E,B,g,r,O,F,y)}))}function c(Y,b,C){let R=0,q=0,A=0,E=0;if("object"===typeof C){const B=C.precision?Math.abs(C.precision):1;C.width&&C.height?(R=C.height*B,q=C.width*B):C.width&&!C.height?(q=C.width*B,R=Math.round(q/Y.getAspectRatio(b))):C.height&&!C.width?(R=C.height*B,q=Math.round(R*Y.getAspectRatio(b))):(q=Math.round(Y.getRenderWidth()*B),R=Math.round(q/Y.getAspectRatio(b))),C.finalWidth&&C.finalHeight?(E=C.finalHeight,A=C.finalWidth):C.finalWidth&&!C.finalHeight?(A=C.finalWidth,E=Math.round(A/Y.getAspectRatio(b))):C.finalHeight&&!C.finalWidth?(E=C.finalHeight,A=Math.round(E*Y.getAspectRatio(b))):(A=q,E=R)}else isNaN(C)||(R=C,q=C,A=C,E=C);return q&&(q=Math.floor(q)),R&&(R=Math.floor(R)),A&&(A=Math.floor(A)),E&&(E=Math.floor(E)),{height:0|R,width:0|q,finalWidth:0|A,finalHeight:0|E}}const l={CreateScreenshot:N,CreateScreenshotAsync:p,CreateScreenshotWithResizeAsync:mY,CreateScreenshotUsingRenderTarget:L,CreateScreenshotUsingRenderTargetAsync:u};n.Tools.CreateScreenshot=N,n.Tools.CreateScreenshotAsync=p,n.Tools.CreateScreenshotUsingRenderTarget=L,n.Tools.CreateScreenshotUsingRenderTargetAsync=u}}]);