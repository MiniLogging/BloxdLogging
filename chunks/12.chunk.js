"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12,20],{11433:(Z,x,F)=>{F.r(x),F.d(x,{Dispose:()=>s,DumpData:()=>c,DumpDataAsync:()=>o,DumpFramebuffer:()=>t,DumpTools:()=>J});var u=F(11292),G=F(10994),f=F(11194),Y=F(11037);let j,d=null;async function t(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const j=await F.readPixels(0,0,Z,x);c(Z,x,new Uint8Array(j.buffer),u,G,f,!0,void 0,Y)}async function o(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0;return await new Promise((d=>{c(Z,x,F,(Z=>d(Z)),u,G,f,Y,j)}))}function c(Z,x,t,o){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],k=arguments.length>8?arguments[8]:void 0;(async function(){return d||(d=new Promise(((Z,x)=>{let G,f=null;const d={Kf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(F.bind(F,11325)).then((t=>{let{ThinEngine:o}=t;const c=Y.c.Instances.length;try{G=new OffscreenCanvas(100,100),f=new o(G,!1,d)}catch(U){var J;c<Y.c.Instances.length&&(null===(J=Y.c.Instances.pop())||void 0===J||J.dispose()),G=document.createElement("canvas"),f=new o(G,!1,d)}Y.c.Instances.pop(),Y.c.OnEnginesDisposedObservable.add((Z=>{f&&Z!==f&&!f.J&&0===Y.c.Instances.length&&s()})),f.getCaps().parallelShaderCompile=void 0;const p=new u.c(f);F.e(52).then(F.bind(F,13746)).then((F=>{let{passPixelShader:Y}=F;if(!f)return void x("Engine is not defined");const d=new u.f({Ux:f,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});j={canvas:G,Ux:f,renderer:p,wrapper:d},Z(j)}))})).catch(x)}))),await d})().then((F=>{if(F.Ux.setSize(Z,x,!0),t instanceof Float32Array){const Z=new Uint8Array(t.length);let x=t.length;for(;x--;){const F=t[x];Z[x]=Math.round(255*(0,f.Clamp)(F))}t=Z}const u=F.Ux.createRawTexture(t,Z,x,5,!1,!p,1);F.renderer.setViewport(),F.renderer.applyEffectWrapper(F.wrapper),F.wrapper.effect._bindTexture("textureSampler",u),F.renderer.draw(),U?G.Tools.ToBlob(F.canvas,(Z=>{const x=new FileReader;x.onload=Z=>{const x=Z.target.result;o&&o(x)},x.readAsArrayBuffer(Z)}),c,k):G.Tools.EncodeScreenshotCanvasData(F.canvas,o,c,J,k),u.dispose()}))}function s(){var Z;j?(j.wrapper.dispose(),j.renderer.dispose(),j.Ux.dispose()):null===(Z=d)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.Ux.dispose()}));d=null,j=null}const J={DumpData:c,DumpDataAsync:o,DumpFramebuffer:t,Dispose:s};G.Tools.DumpData=c,G.Tools.DumpDataAsync=o,G.Tools.DumpFramebuffer=t},11150:(Z,x,F)=>{F.r(x),F.d(x,{CreateScreenshot:()=>C,CreateScreenshotAsync:()=>L,CreateScreenshotUsingRenderTarget:()=>S,CreateScreenshotUsingRenderTargetAsync:()=>K,CreateScreenshotWithResizeAsync:()=>H,ScreenshotTools:()=>q});var u=F(11157),G=F(11249),f=F(11289),Y=F(11136),j=F(11213),d=F(11292),t=F(11319),o=F(11179);class c extends d.f{static _GetDefines(Z){if(!Z)return null;return Z.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(Z,x){Z?(this._webGPUReady=!0,x.push(Promise.all([F.e(54).then(F.bind(F,13762)),F.e(55).then(F.bind(F,13767))]))):x.push(Promise.all([F.e(56).then(F.bind(F,13770)),F.e(57).then(F.bind(F,13777))]))}constructor(Z){const x={...arguments.length>2?arguments[2]:void 0,name:Z,Ux:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||t.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:c.VertexUrl,fragmentShader:c.FragmentUrl,uniforms:c.Uniforms};super({...x,defines:c._GetDefines(x.Ux)}),this.texelSize=new o.Vector2(0,0)}bind(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(Z),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}c.VertexUrl="fxaa",c.FragmentUrl="fxaa",c.Uniforms=["texelSize"];class s extends f.c{getClassName(){return"FxaaPostProcess"}constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const d={uniforms:c.Uniforms,size:"number"===typeof x?x:void 0,camera:F,samplingMode:G||u.c.BILINEAR_SAMPLINGMODE,Ux:f,reusable:Y,textureType:j,...x};super(Z,c.FragmentUrl,{effectWrapper:"number"!==typeof x&&x.effectWrapper?void 0:new c(Z,f,d),...d}),this.onApplyObservable.add((Z=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(Z,x,F,u){return j.c.Parse((()=>new s(Z.name,Z.options,x,Z.renderTargetSamplingMode,F.getEngine(),Z.reusable)),Z,F,u)}}(0,Y.g)("BABYLON.FxaaPostProcess",s);var J=F(11012),p=F(10994),U=F(11433),k=F(11442),M=F(11072);let m=null;function C(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:d,width:t}=y(Z,x,F);if(!d||!t)return void J.d.Error("Invalid 'size' parameter !");x.KZ().activeCamera===x?Z.onEndFrameObservable.addOnce((()=>{m||(m=document.createElement("canvas")),m.width=t,m.height=d;const x=m.getContext("2d"),F=Z.getRenderingCanvas();if(!x||!F)return void J.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const o=F.width,c=F.height,s=m.width,U=m.height,k=s/o,M=U/c,C=j?Math.max(k,M):Math.min(k,M),L=o*C,H=c*C,S=(s-L)/2,K=(U-H)/2;x.drawImage(F,0,0,o,c,S,K,L,H),f?(p.Tools.EncodeScreenshotCanvasData(m,void 0,G,void 0,Y),u&&u("")):p.Tools.EncodeScreenshotCanvasData(m,u,G,void 0,Y)})):S(Z,x,F,(Z=>{if(f){const x=new Blob([Z]);p.Tools.DownloadBlob(x),u&&u("")}else u&&u(Z)}),G,1,Z.getCreationOptions().antialias,void 0,void 0,void 0,void 0,Y)}async function L(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((Y,j)=>{C(Z,x,F,(Z=>{"undefined"!==typeof Z?Y(Z):j(new Error("Data is undefined"))}),u,void 0,G,f)}))}async function H(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((j=>{C(Z,x,{width:F,height:u},(()=>{j()}),G,!0,f,Y)}))}function S(Z,x,f,Y){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],m=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],C=arguments.length>11?arguments[11]:void 0,L=arguments.length>12?arguments[12]:void 0,H=arguments.length>13?arguments[13]:void 0;const{height:S,width:K,finalWidth:q,finalHeight:R}=y(Z,x,f),B={width:K,height:S};if(!S||!K)return void J.d.Error("Invalid 'size' parameter !");Z.skipFrameRender=!0;const v=Z.getRenderWidth,l=Z.getRenderHeight;Z.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.width:K},Z.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Z._currentRenderTarget?Z._currentRenderTarget.height:S},Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z);const i=x.KZ(),e=new G.d("screenShot",B,i,!1,!1,0,!1,u.c.BILINEAR_SAMPLINGMODE,void 0,p,void 0,void 0,void 0,d);e.renderList=i.meshes.slice(),e.samples=d,e.renderSprites=c,e.activeCamera=x,e.forceLayerMaskCheck=m,null===L||void 0===L||L(e);const b=H||U.DumpData,E=()=>{i.incrementRenderId(),i.resetCachedMaterial(),(0,M.h)((()=>e.isReadyForRendering()&&x.isReady(!0)),(()=>{Z.onEndFrameObservable.addOnce((()=>{q===K&&R===S?e.readPixels(void 0,void 0,void 0,!1).then((Z=>{b(K,S,Z,Y,j,o,!0,void 0,C),e.dispose()})):(Z.isWebGPU?F.e(51).then(F.bind(F,13737)):F.e(52).then(F.bind(F,13746))).then((async()=>await(0,k.b)("pass",e.getInternalTexture(),i,void 0,void 0,void 0,q,R).then((x=>{Z._readTexturePixels(x,q,R,-1,0,null,!0,!1,0,0).then((Z=>{b(q,R,Z,Y,j,o,!0,void 0,C),x.dispose()}))}))))})),i.incrementRenderId(),i.resetCachedMaterial();const u=i.activeCamera,G=i.activeCameras,f=x.outputRenderTarget,d=i.spritesEnabled;i.activeCamera=x,i.activeCameras=null,x.outputRenderTarget=e,i.spritesEnabled=c;const t=i.meshes;i.meshes=e.renderList||i.meshes;try{i.render()}finally{i.activeCamera=u,i.activeCameras=G,x.outputRenderTarget=f,i.spritesEnabled=d,i.meshes=t,Z.getRenderWidth=v,Z.getRenderHeight=l,Z.onResizeObservable.hasObservers()&&Z.onResizeObservable.notifyObservers(Z),x.getProjectionMatrix(!0),Z.skipFrameRender=!1}}),(()=>{Z.skipFrameRender=!1,Z.getRenderWidth=v,Z.getRenderHeight=l}))};if(t){const Z=new s("antialiasing",1,i.activeCamera);e.addPostProcess(Z),Z.ef=!0,Z.onEffectCreatedObservable.addOnce((Z=>{Z.isReady()?E():Z.onCompiled=()=>{E()}}))}else E()}async function K(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],o=arguments.length>10?arguments[10]:void 0,c=arguments.length>11?arguments[11]:void 0,s=arguments.length>12?arguments[12]:void 0;return await new Promise(((J,p)=>{S(Z,x,F,(Z=>{"undefined"!==typeof Z?J(Z):p(new Error("Data is undefined"))}),u,G,f,Y,j,d,t,o,c,s)}))}function y(Z,x,F){let u=0,G=0,f=0,Y=0;if("object"===typeof F){const j=F.precision?Math.abs(F.precision):1;F.width&&F.height?(u=F.height*j,G=F.width*j):F.width&&!F.height?(G=F.width*j,u=Math.round(G/Z.getAspectRatio(x))):F.height&&!F.width?(u=F.height*j,G=Math.round(u*Z.getAspectRatio(x))):(G=Math.round(Z.getRenderWidth()*j),u=Math.round(G/Z.getAspectRatio(x))),F.finalWidth&&F.finalHeight?(Y=F.finalHeight,f=F.finalWidth):F.finalWidth&&!F.finalHeight?(f=F.finalWidth,Y=Math.round(f/Z.getAspectRatio(x))):F.finalHeight&&!F.finalWidth?(Y=F.finalHeight,f=Math.round(Y*Z.getAspectRatio(x))):(f=G,Y=u)}else isNaN(F)||(u=F,G=F,f=F,Y=F);return G&&(G=Math.floor(G)),u&&(u=Math.floor(u)),f&&(f=Math.floor(f)),Y&&(Y=Math.floor(Y)),{height:0|u,width:0|G,finalWidth:0|f,finalHeight:0|Y}}const q={CreateScreenshot:C,CreateScreenshotAsync:L,CreateScreenshotWithResizeAsync:H,CreateScreenshotUsingRenderTarget:S,CreateScreenshotUsingRenderTargetAsync:K};p.Tools.CreateScreenshot=C,p.Tools.CreateScreenshotAsync=L,p.Tools.CreateScreenshotUsingRenderTarget=S,p.Tools.CreateScreenshotUsingRenderTargetAsync=K}}]);