"use strict";(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[12,20],{11951:(K,O,F)=>{F.r(O),F.d(O,{Dispose:()=>j,DumpData:()=>t,DumpDataAsync:()=>M,DumpFramebuffer:()=>E,DumpTools:()=>X});var f=F(11831),r=F(11517),l=F(11734),q=F(11559);let J,c=null;async function E(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const J=await F.readPixels(0,0,K,O);t(K,O,new Uint8Array(J.buffer),f,r,l,!0,void 0,q)}async function M(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((c=>{t(K,O,F,(K=>c(K)),f,r,l,q,J)}))}function t(K,O,E,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],o=arguments.length>8?arguments[8]:void 0;(async function(){return c||(c=new Promise(((K,O)=>{let r,l=null;const c={vf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(F.bind(F,11861)).then((E=>{let{ThinEngine:M}=E;const t=q.e.Instances.length;try{r=new OffscreenCanvas(100,100),l=new M(r,!1,c)}catch(T){var X;t<q.e.Instances.length&&(null===(X=q.e.Instances.pop())||void 0===X||X.dispose()),r=document.createElement("canvas"),l=new M(r,!1,c)}q.e.Instances.pop(),q.e.OnEnginesDisposedObservable.add((K=>{l&&K!==l&&!l.M&&0===q.e.Instances.length&&j()})),l.getCaps().parallelShaderCompile=void 0;const u=new f.c(l);F.e(52).then(F.bind(F,14215)).then((F=>{let{passPixelShader:q}=F;if(!l)return void O("Engine is not defined");const c=new f.e({uO:l,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});J={canvas:r,uO:l,renderer:u,wrapper:c},K(J)}))})).catch(O)}))),await c})().then((F=>{if(F.uO.setSize(K,O,!0),E instanceof Float32Array){const K=new Uint8Array(E.length);let O=E.length;for(;O--;){const F=E[O];K[O]=Math.round(255*(0,l.Clamp)(F))}E=K}const f=F.uO.createRawTexture(E,K,O,5,!1,!u,1);F.renderer.setViewport(),F.renderer.applyEffectWrapper(F.wrapper),F.wrapper.effect._bindTexture("textureSampler",f),F.renderer.draw(),T?r.Tools.ToBlob(F.canvas,(K=>{const O=new FileReader;O.onload=K=>{const O=K.target.result;M&&M(O)},O.readAsArrayBuffer(K)}),t,o):r.Tools.EncodeScreenshotCanvasData(F.canvas,M,t,X,o),f.dispose()}))}function j(){var K;J?(J.wrapper.dispose(),J.renderer.dispose(),J.uO.dispose()):null===(K=c)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.uO.dispose()}));c=null,J=null}const X={DumpData:t,DumpDataAsync:M,DumpFramebuffer:E,Dispose:j};r.Tools.DumpData=t,r.Tools.DumpDataAsync=M,r.Tools.DumpFramebuffer=E},11682:(K,O,F)=>{F.r(O),F.d(O,{CreateScreenshot:()=>Z,CreateScreenshotAsync:()=>L,CreateScreenshotUsingRenderTarget:()=>a,CreateScreenshotUsingRenderTargetAsync:()=>g,CreateScreenshotWithResizeAsync:()=>d,ScreenshotTools:()=>e});var f=F(11688),r=F(11781),l=F(11825),q=F(11661),J=F(11753),c=F(11831),E=F(11859),M=F(11713);class t extends c.e{static _GetDefines(K){if(!K)return null;return K.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(K,O){K?(this._webGPUReady=!0,O.push(Promise.all([F.e(54).then(F.bind(F,14233)),F.e(55).then(F.bind(F,14235))]))):O.push(Promise.all([F.e(56).then(F.bind(F,14244)),F.e(57).then(F.bind(F,14247))]))}constructor(K){const O={...arguments.length>2?arguments[2]:void 0,name:K,uO:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||E.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:t.VertexUrl,fragmentShader:t.FragmentUrl,uniforms:t.Uniforms};super({...O,defines:t._GetDefines(O.uO)}),this.texelSize=new M.Vector2(0,0)}bind(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(K),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}t.VertexUrl="fxaa",t.FragmentUrl="fxaa",t.Uniforms=["texelSize"];class j extends l.e{getClassName(){return"FxaaPostProcess"}constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const c={uniforms:t.Uniforms,size:"number"===typeof O?O:void 0,camera:F,samplingMode:r||f.b.BILINEAR_SAMPLINGMODE,uO:l,reusable:q,textureType:J,...O};super(K,t.FragmentUrl,{effectWrapper:"number"!==typeof O&&O.effectWrapper?void 0:new t(K,l,c),...c}),this.onApplyObservable.add((K=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(K,O,F,f){return J.e.Parse((()=>new j(K.name,K.options,O,K.renderTargetSamplingMode,F.getEngine(),K.reusable)),K,F,f)}}(0,q.g)("BABYLON.FxaaPostProcess",j);var X=F(11534),u=F(11517),T=F(11951),o=F(11959),k=F(11588);let N=null;function Z(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:c,width:E}=H(K,O,F);if(!c||!E)return void X.c.Error("Invalid 'size' parameter !");O.HK().activeCamera===O?K.onEndFrameObservable.addOnce((()=>{N||(N=document.createElement("canvas")),N.width=E,N.height=c;const O=N.getContext("2d"),F=K.getRenderingCanvas();if(!O||!F)return void X.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const M=F.width,t=F.height,j=N.width,T=N.height,o=j/M,k=T/t,Z=J?Math.max(o,k):Math.min(o,k),L=M*Z,d=t*Z,a=(j-L)/2,g=(T-d)/2;O.drawImage(F,0,0,M,t,a,g,L,d),l?(u.Tools.EncodeScreenshotCanvasData(N,void 0,r,void 0,q),f&&f("")):u.Tools.EncodeScreenshotCanvasData(N,f,r,void 0,q)})):a(K,O,F,(K=>{if(l){const O=new Blob([K]);u.Tools.DownloadBlob(O),f&&f("")}else f&&f(K)}),r,1,K.getCreationOptions().antialias,void 0,void 0,void 0,void 0,q)}async function L(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((q,J)=>{Z(K,O,F,(K=>{"undefined"!==typeof K?q(K):J(new Error("Data is undefined"))}),f,void 0,r,l)}))}async function d(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((J=>{Z(K,O,{width:F,height:f},(()=>{J()}),r,!0,l,q)}))}function a(K,O,l,q){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7?arguments[7]:void 0,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=arguments.length>9&&void 0!==arguments[9]&&arguments[9],N=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],Z=arguments.length>11?arguments[11]:void 0,L=arguments.length>12?arguments[12]:void 0,d=arguments.length>13?arguments[13]:void 0;const{height:a,width:g,finalWidth:e,finalHeight:W}=H(K,O,l),p={width:g,height:a};if(!a||!g)return void X.c.Error("Invalid 'size' parameter !");K.skipFrameRender=!0;const y=K.getRenderWidth,A=K.getRenderHeight;K.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&K._currentRenderTarget?K._currentRenderTarget.width:g},K.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&K._currentRenderTarget?K._currentRenderTarget.height:a},K.onResizeObservable.hasObservers()&&K.onResizeObservable.notifyObservers(K);const Q=O.HK(),R=new r.b("screenShot",p,Q,!1,!1,0,!1,f.b.BILINEAR_SAMPLINGMODE,void 0,u,void 0,void 0,void 0,c);R.renderList=Q.meshes.slice(),R.samples=c,R.renderSprites=t,R.activeCamera=O,R.forceLayerMaskCheck=N,null===L||void 0===L||L(R);const G=d||T.DumpData,z=()=>{Q.incrementRenderId(),Q.resetCachedMaterial(),(0,k.g)((()=>R.isReadyForRendering()&&O.isReady(!0)),(()=>{K.onEndFrameObservable.addOnce((()=>{e===g&&W===a?R.readPixels(void 0,void 0,void 0,!1).then((K=>{G(g,a,K,q,J,M,!0,void 0,Z),R.dispose()})):(K.isWebGPU?F.e(51).then(F.bind(F,14207)):F.e(52).then(F.bind(F,14215))).then((async()=>await(0,o.b)("pass",R.getInternalTexture(),Q,void 0,void 0,void 0,e,W).then((O=>{K._readTexturePixels(O,e,W,-1,0,null,!0,!1,0,0).then((K=>{G(e,W,K,q,J,M,!0,void 0,Z),O.dispose()}))}))))})),Q.incrementRenderId(),Q.resetCachedMaterial();const f=Q.activeCamera,r=Q.activeCameras,l=O.outputRenderTarget,c=Q.spritesEnabled;Q.activeCamera=O,Q.activeCameras=null,O.outputRenderTarget=R,Q.spritesEnabled=t;const E=Q.meshes;Q.meshes=R.renderList||Q.meshes;try{Q.render()}finally{Q.activeCamera=f,Q.activeCameras=r,O.outputRenderTarget=l,Q.spritesEnabled=c,Q.meshes=E,K.getRenderWidth=y,K.getRenderHeight=A,K.onResizeObservable.hasObservers()&&K.onResizeObservable.notifyObservers(K),O.getProjectionMatrix(!0),K.skipFrameRender=!1}}),(()=>{K.skipFrameRender=!1,K.getRenderWidth=y,K.getRenderHeight=A}))};if(E){const K=new j("antialiasing",1,Q.activeCamera);R.addPostProcess(K),K.Cf=!0,K.onEffectCreatedObservable.addOnce((K=>{K.isReady()?z():K.onCompiled=()=>{z()}}))}else z()}async function g(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],M=arguments.length>10?arguments[10]:void 0,t=arguments.length>11?arguments[11]:void 0,j=arguments.length>12?arguments[12]:void 0;return await new Promise(((X,u)=>{a(K,O,F,(K=>{"undefined"!==typeof K?X(K):u(new Error("Data is undefined"))}),f,r,l,q,J,c,E,M,t,j)}))}function H(K,O,F){let f=0,r=0,l=0,q=0;if("object"===typeof F){const J=F.precision?Math.abs(F.precision):1;F.width&&F.height?(f=F.height*J,r=F.width*J):F.width&&!F.height?(r=F.width*J,f=Math.round(r/K.getAspectRatio(O))):F.height&&!F.width?(f=F.height*J,r=Math.round(f*K.getAspectRatio(O))):(r=Math.round(K.getRenderWidth()*J),f=Math.round(r/K.getAspectRatio(O))),F.finalWidth&&F.finalHeight?(q=F.finalHeight,l=F.finalWidth):F.finalWidth&&!F.finalHeight?(l=F.finalWidth,q=Math.round(l/K.getAspectRatio(O))):F.finalHeight&&!F.finalWidth?(q=F.finalHeight,l=Math.round(q*K.getAspectRatio(O))):(l=r,q=f)}else isNaN(F)||(f=F,r=F,l=F,q=F);return r&&(r=Math.floor(r)),f&&(f=Math.floor(f)),l&&(l=Math.floor(l)),q&&(q=Math.floor(q)),{height:0|f,width:0|r,finalWidth:0|l,finalHeight:0|q}}const e={CreateScreenshot:Z,CreateScreenshotAsync:L,CreateScreenshotWithResizeAsync:d,CreateScreenshotUsingRenderTarget:a,CreateScreenshotUsingRenderTargetAsync:g};u.Tools.CreateScreenshot=Z,u.Tools.CreateScreenshotAsync=L,u.Tools.CreateScreenshotUsingRenderTarget=a,u.Tools.CreateScreenshotUsingRenderTargetAsync=g}}]);