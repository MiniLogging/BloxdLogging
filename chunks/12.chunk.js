"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[12,20],{13144:(z,u,U)=>{U.r(u),U.d(u,{Dispose:()=>mz,DumpData:()=>d,DumpDataAsync:()=>S,DumpFramebuffer:()=>R,DumpTools:()=>Z});var J=U(13023),v=U(12748),f=U(12935),g=U(12797);let w,P=null;async function R(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const w=await U.readPixels(0,0,z,u);d(z,u,new Uint8Array(w.buffer),J,v,f,!0,void 0,g)}async function S(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return await new Promise((P=>{d(z,u,U,(z=>P(z)),J,v,f,g,w)}))}function d(z,u,R,S){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8?arguments[8]:void 0;(async function(){return P||(P=new Promise(((z,u)=>{let v,f=null;const P={Yf:!0,depth:!1,tf:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(U.bind(U,13054)).then((R=>{let{ThinEngine:S}=R;const d=g.e.Instances.length;try{v=new OffscreenCanvas(100,100),f=new S(v,!1,P)}catch(E){var Z;d<g.e.Instances.length&&(null===(Z=g.e.Instances.pop())||void 0===Z||Z.dispose()),v=document.createElement("canvas"),f=new S(v,!1,P)}g.e.Instances.pop(),g.e.OnEnginesDisposedObservable.add((z=>{f&&z!==f&&!f.S&&0===g.e.Instances.length&&mz()})),f.getCaps().parallelShaderCompile=void 0;const A=new J.b(f);U.e(52).then(U.bind(U,15034)).then((U=>{let{passPixelShader:g}=U;if(!f)return void u("Engine is not defined");const P=new J.e({Au:f,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});w={canvas:v,Au:f,renderer:A,wrapper:P},z(w)}))})).catch(u)}))),await P})().then((U=>{if(U.Au.setSize(z,u,!0),R instanceof Float32Array){const z=new Uint8Array(R.length);let u=R.length;for(;u--;){const U=R[u];z[u]=Math.round(255*(0,f.Clamp)(U))}R=z}const J=U.Au.createRawTexture(R,z,u,5,!1,!A,1);U.renderer.setViewport(),U.renderer.applyEffectWrapper(U.wrapper),U.wrapper.effect._bindTexture("textureSampler",J),U.renderer.draw(),E?v.Tools.ToBlob(U.canvas,(z=>{const u=new FileReader;u.onload=z=>{const u=z.target.result;S&&S(u)},u.readAsArrayBuffer(z)}),d,C):v.Tools.EncodeScreenshotCanvasData(U.canvas,S,d,Z,C),J.dispose()}))}function mz(){var z;w?(w.wrapper.dispose(),w.renderer.dispose(),w.Au.dispose()):null===(z=P)||void 0===z||z.then((z=>{z.wrapper.dispose(),z.renderer.dispose(),z.Au.dispose()}));P=null,w=null}const Z={DumpData:d,DumpDataAsync:S,DumpFramebuffer:R,Dispose:mz};v.Tools.DumpData=d,v.Tools.DumpDataAsync=S,v.Tools.DumpFramebuffer=R},12889:(z,u,U)=>{U.r(u),U.d(u,{CreateScreenshot:()=>X,CreateScreenshotAsync:()=>h,CreateScreenshotUsingRenderTarget:()=>V,CreateScreenshotUsingRenderTargetAsync:()=>L,CreateScreenshotWithResizeAsync:()=>t,ScreenshotTools:()=>x});var J=U(12894),v=U(12986),f=U(21),g=U(13017),w=U(12875),P=U(12955),R=U(13023),S=U(13050),d=U(12914);class mz extends R.e{static _GetDefines(z){if(!z)return null;return z.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(z,u){z?(this._webGPUReady=!0,u.push(Promise.all([U.e(54).then(U.bind(U,15043)),U.e(55).then(U.bind(U,15047))]))):u.push(Promise.all([U.e(56).then(U.bind(U,15051)),U.e(57).then(U.bind(U,15055))]))}constructor(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;const J=(0,f.e)((0,f.e)({},U),{},{name:z,Au:u||S.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:mz.VertexUrl,fragmentShader:mz.FragmentUrl,uniforms:mz.Uniforms});super((0,f.e)((0,f.e)({},J),{},{defines:mz._GetDefines(J.Au)})),this.texelSize=new d.Vector2(0,0)}bind(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(z),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}mz.VertexUrl="fxaa",mz.FragmentUrl="fxaa",mz.Uniforms=["texelSize"];class Z extends g.c{getClassName(){return"FxaaPostProcess"}constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const R=(0,f.e)({uniforms:mz.Uniforms,size:"number"===typeof u?u:void 0,camera:U,samplingMode:v||J.e.BILINEAR_SAMPLINGMODE,Au:g,reusable:w,textureType:P},u);super(z,mz.FragmentUrl,(0,f.e)({effectWrapper:"number"!==typeof u&&u.effectWrapper?void 0:new mz(z,g,R)},R)),this.onApplyObservable.add((z=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(z,u,U,J){return P.b.Parse((()=>new Z(z.name,z.options,u,z.renderTargetSamplingMode,U.getEngine(),z.reusable)),z,U,J)}}(0,w.f)("BABYLON.FxaaPostProcess",Z);var A=U(12760),E=U(12748),C=U(13144),r=U(13148),M=U(12825);let T=null;function X(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0,w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:P,width:R}=O(z,u,U);if(!P||!R)return void A.d.Error("Invalid 'size' parameter !");u.Vz().activeCamera===u?z.onEndFrameObservable.addOnce((()=>{T||(T=document.createElement("canvas")),T.width=R,T.height=P;const u=T.getContext("2d"),U=z.getRenderingCanvas();if(!u||!U)return void A.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const S=U.width,d=U.height,mz=T.width,Z=T.height,C=mz/S,r=Z/d,M=w?Math.max(C,r):Math.min(C,r),X=S*M,h=d*M,t=(mz-X)/2,V=(Z-h)/2;u.drawImage(U,0,0,S,d,t,V,X,h),f?(E.Tools.EncodeScreenshotCanvasData(T,void 0,v,void 0,g),J&&J("")):E.Tools.EncodeScreenshotCanvasData(T,J,v,void 0,g)})):V(z,u,U,(z=>{if(f){const u=new Blob([z]);E.Tools.DownloadBlob(u),J&&J("")}else J&&J(z)}),v,1,z.getCreationOptions().antialias,void 0,void 0,void 0,void 0,g)}async function h(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((g,w)=>{X(z,u,U,(z=>{"undefined"!==typeof z?g(z):w(new Error("Data is undefined"))}),J,void 0,v,f)}))}async function t(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((w=>{X(z,u,{width:U,height:J},(()=>{w()}),v,!0,f,g)}))}function V(z,u,f,g){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],mz=arguments.length>9&&void 0!==arguments[9]&&arguments[9],E=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],T=arguments.length>11?arguments[11]:void 0,X=arguments.length>12?arguments[12]:void 0,h=arguments.length>13?arguments[13]:void 0;const{height:t,width:V,finalWidth:L,finalHeight:x}=O(z,u,f),Q={width:V,height:t};if(!t||!V)return void A.d.Error("Invalid 'size' parameter !");z.skipFrameRender=!0;const K=z.getRenderWidth,Y=z.getRenderHeight;z.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&z._currentRenderTarget?z._currentRenderTarget.width:V},z.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&z._currentRenderTarget?z._currentRenderTarget.height:t},z.onResizeObservable.hasObservers()&&z.onResizeObservable.notifyObservers(z);const p=u.Vz(),N=new v.c("screenShot",Q,p,!1,!1,0,!1,J.e.BILINEAR_SAMPLINGMODE,void 0,mz,void 0,void 0,void 0,P);N.renderList=p.meshes.slice(),N.samples=P,N.renderSprites=d,N.activeCamera=u,N.forceLayerMaskCheck=E,null===X||void 0===X||X(N);const D=h||C.DumpData,c=()=>{p.incrementRenderId(),p.resetCachedMaterial(),(0,M.e)((()=>N.isReadyForRendering()&&u.isReady(!0)),(()=>{z.onEndFrameObservable.addOnce((()=>{L===V&&x===t?N.readPixels(void 0,void 0,void 0,!1).then((z=>{D(V,t,z,g,w,S,!0,void 0,T),N.dispose()})):(z.isWebGPU?U.e(51).then(U.bind(U,15032)):U.e(52).then(U.bind(U,15034))).then((async()=>await(0,r.b)("pass",N.getInternalTexture(),p,void 0,void 0,void 0,L,x).then((u=>{z._readTexturePixels(u,L,x,-1,0,null,!0,!1,0,0).then((z=>{D(L,x,z,g,w,S,!0,void 0,T),u.dispose()}))}))))})),p.incrementRenderId(),p.resetCachedMaterial();const J=p.activeCamera,v=p.activeCameras,f=u.outputRenderTarget,P=p.spritesEnabled;p.activeCamera=u,p.activeCameras=null,u.outputRenderTarget=N,p.spritesEnabled=d;const R=p.meshes;p.meshes=N.renderList||p.meshes;try{p.render()}finally{p.activeCamera=J,p.activeCameras=v,u.outputRenderTarget=f,p.spritesEnabled=P,p.meshes=R,z.getRenderWidth=K,z.getRenderHeight=Y,z.onResizeObservable.hasObservers()&&z.onResizeObservable.notifyObservers(z),u.getProjectionMatrix(!0),z.skipFrameRender=!1}}),(()=>{z.skipFrameRender=!1,z.getRenderWidth=K,z.getRenderHeight=Y}))};if(R){const z=new Z("antialiasing",1,p.activeCamera);N.addPostProcess(z),z.Df=!0,z.onEffectCreatedObservable.addOnce((z=>{z.isReady()?c():z.onCompiled=()=>{c()}}))}else c()}async function L(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0,w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],S=arguments.length>10?arguments[10]:void 0,d=arguments.length>11?arguments[11]:void 0,mz=arguments.length>12?arguments[12]:void 0;return await new Promise(((Z,A)=>{V(z,u,U,(z=>{"undefined"!==typeof z?Z(z):A(new Error("Data is undefined"))}),J,v,f,g,w,P,R,S,d,mz)}))}function O(z,u,U){let J=0,v=0,f=0,g=0;if("object"===typeof U){const w=U.precision?Math.abs(U.precision):1;U.width&&U.height?(J=U.height*w,v=U.width*w):U.width&&!U.height?(v=U.width*w,J=Math.round(v/z.getAspectRatio(u))):U.height&&!U.width?(J=U.height*w,v=Math.round(J*z.getAspectRatio(u))):(v=Math.round(z.getRenderWidth()*w),J=Math.round(v/z.getAspectRatio(u))),U.finalWidth&&U.finalHeight?(g=U.finalHeight,f=U.finalWidth):U.finalWidth&&!U.finalHeight?(f=U.finalWidth,g=Math.round(f/z.getAspectRatio(u))):U.finalHeight&&!U.finalWidth?(g=U.finalHeight,f=Math.round(g*z.getAspectRatio(u))):(f=v,g=J)}else isNaN(U)||(J=U,v=U,f=U,g=U);return v&&(v=Math.floor(v)),J&&(J=Math.floor(J)),f&&(f=Math.floor(f)),g&&(g=Math.floor(g)),{height:0|J,width:0|v,finalWidth:0|f,finalHeight:0|g}}const x={CreateScreenshot:X,CreateScreenshotAsync:h,CreateScreenshotWithResizeAsync:t,CreateScreenshotUsingRenderTarget:V,CreateScreenshotUsingRenderTargetAsync:L};E.Tools.CreateScreenshot=X,E.Tools.CreateScreenshotAsync=h,E.Tools.CreateScreenshotUsingRenderTarget=V,E.Tools.CreateScreenshotUsingRenderTargetAsync=L}}]);