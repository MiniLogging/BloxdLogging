"use strict";(self.ksd6jhs1yr=self.ksd6jhs1yr||[]).push([[12,20],{12622:(C,c,d)=>{d.r(c),d.d(c,{Dispose:()=>Z,DumpData:()=>k,DumpDataAsync:()=>g,DumpFramebuffer:()=>j,DumpTools:()=>U});var b=d(12508),X=d(12219),P=d(12418),V=d(12255);let R,p=null;async function j(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,V=arguments.length>6?arguments[6]:void 0;const R=await d.readPixels(0,0,C,c);k(C,c,new Uint8Array(R.buffer),b,X,P,!0,void 0,V)}async function g(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7?arguments[7]:void 0;return await new Promise((p=>{k(C,c,d,(C=>p(C)),b,X,P,V,R)}))}function k(C,c,j,g){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],q=arguments.length>8?arguments[8]:void 0;(async function(){return p||(p=new Promise(((C,c)=>{let X,P=null;const p={nc:!0,depth:!1,uc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(d.bind(d,12538)).then((j=>{let{ThinEngine:g}=j;const k=V.c.Instances.length;try{X=new OffscreenCanvas(100,100),P=new g(X,!1,p)}catch(u){var U;k<V.c.Instances.length&&(null===(U=V.c.Instances.pop())||void 0===U||U.dispose()),X=document.createElement("canvas"),P=new g(X,!1,p)}V.c.Instances.pop(),V.c.OnEnginesDisposedObservable.add((C=>{P&&C!==P&&!P.Z&&0===V.c.Instances.length&&Z()})),P.getCaps().parallelShaderCompile=void 0;const A=new b.d(P);d.e(52).then(d.bind(d,14923)).then((d=>{let{passPixelShader:V}=d;if(!P)return void c("Engine is not defined");const p=new b.e({Gc:P,name:V.name,fragmentShader:V.shader,samplerNames:["textureSampler"]});R={canvas:X,Gc:P,renderer:A,wrapper:p},C(R)}))})).catch(c)}))),await p})().then((d=>{if(d.Gc.setSize(C,c,!0),j instanceof Float32Array){const C=new Uint8Array(j.length);let c=j.length;for(;c--;){const d=j[c];C[c]=Math.round(255*(0,P.Clamp)(d))}j=C}const b=d.Gc.createRawTexture(j,C,c,5,!1,!A,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",b),d.renderer.draw(),u?X.Tools.ToBlob(d.canvas,(C=>{const c=new FileReader;c.onload=C=>{const c=C.target.result;g&&g(c)},c.readAsArrayBuffer(C)}),k,q):X.Tools.EncodeScreenshotCanvasData(d.canvas,g,k,U,q),b.dispose()}))}function Z(){var C;R?(R.wrapper.dispose(),R.renderer.dispose(),R.Gc.dispose()):null===(C=p)||void 0===C||C.then((C=>{C.wrapper.dispose(),C.renderer.dispose(),C.Gc.dispose()}));p=null,R=null}const U={DumpData:k,DumpDataAsync:g,DumpFramebuffer:j,Dispose:Z};X.Tools.DumpData=k,X.Tools.DumpDataAsync=g,X.Tools.DumpFramebuffer=j},12369:(C,c,d)=>{d.r(c),d.d(c,{CreateScreenshot:()=>e,CreateScreenshotAsync:()=>n,CreateScreenshotUsingRenderTarget:()=>E,CreateScreenshotUsingRenderTargetAsync:()=>N,CreateScreenshotWithResizeAsync:()=>W,ScreenshotTools:()=>M});var b=d(12375),X=d(12456),P=d(12499),V=d(12345),R=d(12431),p=d(12508),j=d(12529),g=d(12403);class k extends p.e{static _GetDefines(C){if(!C)return null;return C.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(C,c){C?(this._webGPUReady=!0,c.push(Promise.all([d.e(54).then(d.bind(d,14933)),d.e(55).then(d.bind(d,14937))]))):c.push(Promise.all([d.e(56).then(d.bind(d,14939)),d.e(57).then(d.bind(d,14941))]))}constructor(C){const c={...arguments.length>2?arguments[2]:void 0,name:C,Gc:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||j.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:k.VertexUrl,fragmentShader:k.FragmentUrl,uniforms:k.Uniforms};super({...c,defines:k._GetDefines(c.Gc)}),this.texelSize=new g.Vector2(0,0)}bind(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(C),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}k.VertexUrl="fxaa",k.FragmentUrl="fxaa",k.Uniforms=["texelSize"];class Z extends P.d{getClassName(){return"FxaaPostProcess"}constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3?arguments[3]:void 0,P=arguments.length>4?arguments[4]:void 0,V=arguments.length>5?arguments[5]:void 0,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const p={uniforms:k.Uniforms,size:"number"===typeof c?c:void 0,camera:d,samplingMode:X||b.b.BILINEAR_SAMPLINGMODE,Gc:P,reusable:V,textureType:R,...c};super(C,k.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new k(C,P,p),...p}),this.onApplyObservable.add((C=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(C,c,d,b){return R.e.Parse((()=>new Z(C.name,C.options,c,C.renderTargetSamplingMode,d.getEngine(),C.reusable)),C,d,b)}}(0,V.e)("BABYLON.FxaaPostProcess",Z);var U=d(12233),A=d(12219),u=d(12622),q=d(12628),B=d(12281);let t=null;function e(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6?arguments[6]:void 0,R=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:p,width:j}=r(C,c,d);if(!p||!j)return void U.d.Error("Invalid 'size' parameter !");c.NC().activeCamera===c?C.onEndFrameObservable.addOnce((()=>{t||(t=document.createElement("canvas")),t.width=j,t.height=p;const c=t.getContext("2d"),d=C.getRenderingCanvas();if(!c||!d)return void U.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const g=d.width,k=d.height,Z=t.width,u=t.height,q=Z/g,B=u/k,e=R?Math.max(q,B):Math.min(q,B),n=g*e,W=k*e,E=(Z-n)/2,N=(u-W)/2;c.drawImage(d,0,0,g,k,E,N,n,W),P?(A.Tools.EncodeScreenshotCanvasData(t,void 0,X,void 0,V),b&&b("")):A.Tools.EncodeScreenshotCanvasData(t,b,X,void 0,V)})):E(C,c,d,(C=>{if(P){const c=new Blob([C]);A.Tools.DownloadBlob(c),b&&b("")}else b&&b(C)}),X,1,C.getCreationOptions().antialias,void 0,void 0,void 0,void 0,V)}async function n(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((V,R)=>{e(C,c,d,(C=>{"undefined"!==typeof C?V(C):R(new Error("Data is undefined"))}),b,void 0,X,P)}))}async function W(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((R=>{e(C,c,{width:d,height:b},(()=>{R()}),X,!0,P,V)}))}function E(C,c,P,V){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],A=arguments.length>9&&void 0!==arguments[9]&&arguments[9],t=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],e=arguments.length>11?arguments[11]:void 0,n=arguments.length>12?arguments[12]:void 0,W=arguments.length>13?arguments[13]:void 0;const{height:E,width:N,finalWidth:M,finalHeight:K}=r(C,c,P),i={width:N,height:E};if(!E||!N)return void U.d.Error("Invalid 'size' parameter !");C.skipFrameRender=!0;const h=C.getRenderWidth,L=C.getRenderHeight;C.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&C._currentRenderTarget?C._currentRenderTarget.width:N},C.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&C._currentRenderTarget?C._currentRenderTarget.height:E},C.onResizeObservable.hasObservers()&&C.onResizeObservable.notifyObservers(C);const f=c.NC(),T=new X.c("screenShot",i,f,!1,!1,0,!1,b.b.BILINEAR_SAMPLINGMODE,void 0,A,void 0,void 0,void 0,p);T.renderList=f.meshes.slice(),T.samples=p,T.renderSprites=k,T.activeCamera=c,T.forceLayerMaskCheck=t,null===n||void 0===n||n(T);const z=W||u.DumpData,w=()=>{f.incrementRenderId(),f.resetCachedMaterial(),(0,B.f)((()=>T.isReadyForRendering()&&c.isReady(!0)),(()=>{C.onEndFrameObservable.addOnce((()=>{M===N&&K===E?T.readPixels(void 0,void 0,void 0,!1).then((C=>{z(N,E,C,V,R,g,!0,void 0,e),T.dispose()})):(C.isWebGPU?d.e(51).then(d.bind(d,14919)):d.e(52).then(d.bind(d,14923))).then((async()=>await(0,q.c)("pass",T.getInternalTexture(),f,void 0,void 0,void 0,M,K).then((c=>{C._readTexturePixels(c,M,K,-1,0,null,!0,!1,0,0).then((C=>{z(M,K,C,V,R,g,!0,void 0,e),c.dispose()}))}))))})),f.incrementRenderId(),f.resetCachedMaterial();const b=f.activeCamera,X=f.activeCameras,P=c.outputRenderTarget,p=f.spritesEnabled;f.activeCamera=c,f.activeCameras=null,c.outputRenderTarget=T,f.spritesEnabled=k;const j=f.meshes;f.meshes=T.renderList||f.meshes;try{f.render()}finally{f.activeCamera=b,f.activeCameras=X,c.outputRenderTarget=P,f.spritesEnabled=p,f.meshes=j,C.getRenderWidth=h,C.getRenderHeight=L,C.onResizeObservable.hasObservers()&&C.onResizeObservable.notifyObservers(C),c.getProjectionMatrix(!0),C.skipFrameRender=!1}}),(()=>{C.skipFrameRender=!1,C.getRenderWidth=h,C.getRenderHeight=L}))};if(j){const C=new Z("antialiasing",1,f.activeCamera);T.addPostProcess(C),C.Wc=!0,C.onEffectCreatedObservable.addOnce((C=>{C.isReady()?w():C.onCompiled=()=>{w()}}))}else w()}async function N(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6?arguments[6]:void 0,R=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],g=arguments.length>10?arguments[10]:void 0,k=arguments.length>11?arguments[11]:void 0,Z=arguments.length>12?arguments[12]:void 0;return await new Promise(((U,A)=>{E(C,c,d,(C=>{"undefined"!==typeof C?U(C):A(new Error("Data is undefined"))}),b,X,P,V,R,p,j,g,k,Z)}))}function r(C,c,d){let b=0,X=0,P=0,V=0;if("object"===typeof d){const R=d.precision?Math.abs(d.precision):1;d.width&&d.height?(b=d.height*R,X=d.width*R):d.width&&!d.height?(X=d.width*R,b=Math.round(X/C.getAspectRatio(c))):d.height&&!d.width?(b=d.height*R,X=Math.round(b*C.getAspectRatio(c))):(X=Math.round(C.getRenderWidth()*R),b=Math.round(X/C.getAspectRatio(c))),d.finalWidth&&d.finalHeight?(V=d.finalHeight,P=d.finalWidth):d.finalWidth&&!d.finalHeight?(P=d.finalWidth,V=Math.round(P/C.getAspectRatio(c))):d.finalHeight&&!d.finalWidth?(V=d.finalHeight,P=Math.round(V*C.getAspectRatio(c))):(P=X,V=b)}else isNaN(d)||(b=d,X=d,P=d,V=d);return X&&(X=Math.floor(X)),b&&(b=Math.floor(b)),P&&(P=Math.floor(P)),V&&(V=Math.floor(V)),{height:0|b,width:0|X,finalWidth:0|P,finalHeight:0|V}}const M={CreateScreenshot:e,CreateScreenshotAsync:n,CreateScreenshotWithResizeAsync:W,CreateScreenshotUsingRenderTarget:E,CreateScreenshotUsingRenderTargetAsync:N};A.Tools.CreateScreenshot=e,A.Tools.CreateScreenshotAsync=n,A.Tools.CreateScreenshotUsingRenderTarget=E,A.Tools.CreateScreenshotUsingRenderTargetAsync=N}}]);