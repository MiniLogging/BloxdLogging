"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12,20],{11381:(g,w,q)=>{q.r(w),q.d(w,{Dispose:()=>e,DumpData:()=>m,DumpDataAsync:()=>t,DumpFramebuffer:()=>z,DumpTools:()=>y});var R=q(11276),o=q(10991),r=q(11195),S=q(11034);let i,T=null;async function z(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;const i=await q.readPixels(0,0,g,w);m(g,w,new Uint8Array(i.buffer),R,o,r,!0,void 0,S)}async function t(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7?arguments[7]:void 0;return await new Promise((T=>{m(g,w,q,(g=>T(g)),R,o,r,S,i)}))}function m(g,w,z,t){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;(async function(){return T||(T=new Promise(((g,w)=>{let o,r=null;const T={kS:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(q.bind(q,11294)).then((z=>{let{ThinEngine:t}=z;const m=S.c.Instances.length;try{o=new OffscreenCanvas(100,100),r=new t(o,!1,T)}catch(A){var y;m<S.c.Instances.length&&(null===(y=S.c.Instances.pop())||void 0===y||y.dispose()),o=document.createElement("canvas"),r=new t(o,!1,T)}S.c.Instances.pop(),S.c.OnEnginesDisposedObservable.add((g=>{r&&g!==r&&!r.L&&0===S.c.Instances.length&&e()})),r.getCaps().parallelShaderCompile=void 0;const L=new R.b(r);q.e(52).then(q.bind(q,13605)).then((q=>{let{passPixelShader:S}=q;if(!r)return void w("Engine is not defined");const T=new R.d({mw:r,name:S.name,fragmentShader:S.shader,samplerNames:["textureSampler"]});i={canvas:o,mw:r,renderer:L,wrapper:T},g(i)}))})).catch(w)}))),await T})().then((q=>{if(q.mw.setSize(g,w,!0),z instanceof Float32Array){const g=new Uint8Array(z.length);let w=z.length;for(;w--;){const q=z[w];g[w]=Math.round(255*(0,r.Clamp)(q))}z=g}const R=q.mw.createRawTexture(z,g,w,5,!1,!L,1);q.renderer.setViewport(),q.renderer.applyEffectWrapper(q.wrapper),q.wrapper.effect._bindTexture("textureSampler",R),q.renderer.draw(),A?o.Tools.ToBlob(q.canvas,(g=>{const w=new FileReader;w.onload=g=>{const w=g.target.result;t&&t(w)},w.readAsArrayBuffer(g)}),m,l):o.Tools.EncodeScreenshotCanvasData(q.canvas,t,m,y,l),R.dispose()}))}function e(){var g;i?(i.wrapper.dispose(),i.renderer.dispose(),i.mw.dispose()):null===(g=T)||void 0===g||g.then((g=>{g.wrapper.dispose(),g.renderer.dispose(),g.mw.dispose()}));T=null,i=null}const y={DumpData:m,DumpDataAsync:t,DumpFramebuffer:z,Dispose:e};o.Tools.DumpData=m,o.Tools.DumpDataAsync=t,o.Tools.DumpFramebuffer=z},11144:(g,w,q)=>{q.r(w),q.d(w,{CreateScreenshot:()=>G,CreateScreenshotAsync:()=>d,CreateScreenshotUsingRenderTarget:()=>U,CreateScreenshotUsingRenderTargetAsync:()=>N,CreateScreenshotWithResizeAsync:()=>D,ScreenshotTools:()=>H});var R=q(11152),o=q(11244),r=q(11272),S=q(11128),i=q(11218),T=q(11276),z=q(11291),t=q(11180);class m extends T.d{static _GetDefines(g){if(!g)return null;return g.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(g,w){g?(this._webGPUReady=!0,w.push(Promise.all([q.e(54).then(q.bind(q,13621)),q.e(55).then(q.bind(q,13623))]))):w.push(Promise.all([q.e(56).then(q.bind(q,13625)),q.e(57).then(q.bind(q,13633))]))}constructor(g){const w={...arguments.length>2?arguments[2]:void 0,name:g,mw:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||z.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:m.VertexUrl,fragmentShader:m.FragmentUrl,uniforms:m.Uniforms};super({...w,defines:m._GetDefines(w.mw)}),this.texelSize=new t.Vector2(0,0)}bind(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(g),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}m.VertexUrl="fxaa",m.FragmentUrl="fxaa",m.Uniforms=["texelSize"];class e extends r.c{getClassName(){return"FxaaPostProcess"}constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const T={uniforms:m.Uniforms,size:"number"===typeof w?w:void 0,camera:q,samplingMode:o||R.e.BILINEAR_SAMPLINGMODE,mw:r,reusable:S,textureType:i,...w};super(g,m.FragmentUrl,{effectWrapper:"number"!==typeof w&&w.effectWrapper?void 0:new m(g,r,T),...T}),this.onApplyObservable.add((g=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(g,w,q,R){return i.c.Parse((()=>new e(g.name,g.options,w,g.renderTargetSamplingMode,q.getEngine(),g.reusable)),g,q,R)}}(0,S.g)("BABYLON.FxaaPostProcess",e);var y=q(11011),L=q(10991),A=q(11381),l=q(11383),J=q(11071);let x=null;function G(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:T,width:z}=a(g,w,q);if(!T||!z)return void y.d.Error("Invalid 'size' parameter !");w.Ng().activeCamera===w?g.onEndFrameObservable.addOnce((()=>{x||(x=document.createElement("canvas")),x.width=z,x.height=T;const w=x.getContext("2d"),q=g.getRenderingCanvas();if(!w||!q)return void y.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const t=q.width,m=q.height,e=x.width,A=x.height,l=e/t,J=A/m,G=i?Math.max(l,J):Math.min(l,J),d=t*G,D=m*G,U=(e-d)/2,N=(A-D)/2;w.drawImage(q,0,0,t,m,U,N,d,D),r?(L.Tools.EncodeScreenshotCanvasData(x,void 0,o,void 0,S),R&&R("")):L.Tools.EncodeScreenshotCanvasData(x,R,o,void 0,S)})):U(g,w,q,(g=>{if(r){const w=new Blob([g]);L.Tools.DownloadBlob(w),R&&R("")}else R&&R(g)}),o,1,g.getCreationOptions().antialias,void 0,void 0,void 0,void 0,S)}async function d(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((S,i)=>{G(g,w,q,(g=>{"undefined"!==typeof g?S(g):i(new Error("Data is undefined"))}),R,void 0,o,r)}))}async function D(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((i=>{G(g,w,{width:q,height:R},(()=>{i()}),o,!0,r,S)}))}function U(g,w,r,S){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0,m=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]&&arguments[9],x=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],G=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0,D=arguments.length>13?arguments[13]:void 0;const{height:U,width:N,finalWidth:H,finalHeight:C}=a(g,w,r),c={width:N,height:U};if(!U||!N)return void y.d.Error("Invalid 'size' parameter !");g.skipFrameRender=!0;const P=g.getRenderWidth,j=g.getRenderHeight;g.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&g._currentRenderTarget?g._currentRenderTarget.width:N},g.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&g._currentRenderTarget?g._currentRenderTarget.height:U},g.onResizeObservable.hasObservers()&&g.onResizeObservable.notifyObservers(g);const M=w.Ng(),V=new o.d("screenShot",c,M,!1,!1,0,!1,R.e.BILINEAR_SAMPLINGMODE,void 0,L,void 0,void 0,void 0,T);V.renderList=M.meshes.slice(),V.samples=T,V.renderSprites=m,V.activeCamera=w,V.forceLayerMaskCheck=x,null===d||void 0===d||d(V);const s=D||A.DumpData,h=()=>{M.incrementRenderId(),M.resetCachedMaterial(),(0,J.h)((()=>V.isReadyForRendering()&&w.isReady(!0)),(()=>{g.onEndFrameObservable.addOnce((()=>{H===N&&C===U?V.readPixels(void 0,void 0,void 0,!1).then((g=>{s(N,U,g,S,i,t,!0,void 0,G),V.dispose()})):(g.isWebGPU?q.e(51).then(q.bind(q,13598)):q.e(52).then(q.bind(q,13605))).then((async()=>await(0,l.b)("pass",V.getInternalTexture(),M,void 0,void 0,void 0,H,C).then((w=>{g._readTexturePixels(w,H,C,-1,0,null,!0,!1,0,0).then((g=>{s(H,C,g,S,i,t,!0,void 0,G),w.dispose()}))}))))})),M.incrementRenderId(),M.resetCachedMaterial();const R=M.activeCamera,o=M.activeCameras,r=w.outputRenderTarget,T=M.spritesEnabled;M.activeCamera=w,M.activeCameras=null,w.outputRenderTarget=V,M.spritesEnabled=m;const z=M.meshes;M.meshes=V.renderList||M.meshes;try{M.render()}finally{M.activeCamera=R,M.activeCameras=o,w.outputRenderTarget=r,M.spritesEnabled=T,M.meshes=z,g.getRenderWidth=P,g.getRenderHeight=j,g.onResizeObservable.hasObservers()&&g.onResizeObservable.notifyObservers(g),w.getProjectionMatrix(!0),g.skipFrameRender=!1}}),(()=>{g.skipFrameRender=!1,g.getRenderWidth=P,g.getRenderHeight=j}))};if(z){const g=new e("antialiasing",1,M.activeCamera);V.addPostProcess(g),g.gi=!0,g.onEffectCreatedObservable.addOnce((g=>{g.isReady()?h():g.onCompiled=()=>{h()}}))}else h()}async function N(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],t=arguments.length>10?arguments[10]:void 0,m=arguments.length>11?arguments[11]:void 0,e=arguments.length>12?arguments[12]:void 0;return await new Promise(((y,L)=>{U(g,w,q,(g=>{"undefined"!==typeof g?y(g):L(new Error("Data is undefined"))}),R,o,r,S,i,T,z,t,m,e)}))}function a(g,w,q){let R=0,o=0,r=0,S=0;if("object"===typeof q){const i=q.precision?Math.abs(q.precision):1;q.width&&q.height?(R=q.height*i,o=q.width*i):q.width&&!q.height?(o=q.width*i,R=Math.round(o/g.getAspectRatio(w))):q.height&&!q.width?(R=q.height*i,o=Math.round(R*g.getAspectRatio(w))):(o=Math.round(g.getRenderWidth()*i),R=Math.round(o/g.getAspectRatio(w))),q.finalWidth&&q.finalHeight?(S=q.finalHeight,r=q.finalWidth):q.finalWidth&&!q.finalHeight?(r=q.finalWidth,S=Math.round(r/g.getAspectRatio(w))):q.finalHeight&&!q.finalWidth?(S=q.finalHeight,r=Math.round(S*g.getAspectRatio(w))):(r=o,S=R)}else isNaN(q)||(R=q,o=q,r=q,S=q);return o&&(o=Math.floor(o)),R&&(R=Math.floor(R)),r&&(r=Math.floor(r)),S&&(S=Math.floor(S)),{height:0|R,width:0|o,finalWidth:0|r,finalHeight:0|S}}const H={CreateScreenshot:G,CreateScreenshotAsync:d,CreateScreenshotWithResizeAsync:D,CreateScreenshotUsingRenderTarget:U,CreateScreenshotUsingRenderTargetAsync:N};L.Tools.CreateScreenshot=G,L.Tools.CreateScreenshotAsync=d,L.Tools.CreateScreenshotUsingRenderTarget=U,L.Tools.CreateScreenshotUsingRenderTargetAsync=N}}]);