"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[12,20],{12681:(g,i,a)=>{a.r(i),a.d(i,{Dispose:()=>j,DumpData:()=>I,DumpDataAsync:()=>F,DumpFramebuffer:()=>N,DumpTools:()=>y});var n=a(12550),L=a(12277),d=a(12466),b=a(12316);let k,e=null;async function N(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0;const k=await a.readPixels(0,0,g,i);I(g,i,new Uint8Array(k.buffer),n,L,d,!0,void 0,b)}async function F(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0;return await new Promise((e=>{I(g,i,a,(g=>e(g)),n,L,d,b,k)}))}function I(g,i,N,F){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8?arguments[8]:void 0;(async function(){return e||(e=new Promise(((g,i)=>{let L,d=null;const e={vd:!0,depth:!1,bd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(a.bind(a,12578)).then((N=>{let{ThinEngine:F}=N;const I=b.c.Instances.length;try{L=new OffscreenCanvas(100,100),d=new F(L,!1,e)}catch(c){var y;I<b.c.Instances.length&&(null===(y=b.c.Instances.pop())||void 0===y||y.dispose()),L=document.createElement("canvas"),d=new F(L,!1,e)}b.c.Instances.pop(),b.c.OnEnginesDisposedObservable.add((g=>{d&&g!==d&&!d.p&&0===b.c.Instances.length&&j()})),d.getCaps().parallelShaderCompile=void 0;const B=new n.e(d);a.e(52).then(a.bind(a,15022)).then((a=>{let{passPixelShader:b}=a;if(!d)return void i("Engine is not defined");const e=new n.f({yi:d,name:b.name,fragmentShader:b.shader,samplerNames:["textureSampler"]});k={canvas:L,yi:d,renderer:B,wrapper:e},g(k)}))})).catch(i)}))),await e})().then((a=>{if(a.yi.setSize(g,i,!0),N instanceof Float32Array){const g=new Uint8Array(N.length);let i=N.length;for(;i--;){const a=N[i];g[i]=Math.round(255*(0,d.Clamp)(a))}N=g}const n=a.yi.createRawTexture(N,g,i,5,!1,!B,1);a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",n),a.renderer.draw(),c?L.Tools.ToBlob(a.canvas,(g=>{const i=new FileReader;i.onload=g=>{const i=g.target.result;F&&F(i)},i.readAsArrayBuffer(g)}),I,D):L.Tools.EncodeScreenshotCanvasData(a.canvas,F,I,y,D),n.dispose()}))}function j(){var g;k?(k.wrapper.dispose(),k.renderer.dispose(),k.yi.dispose()):null===(g=e)||void 0===g||g.then((g=>{g.wrapper.dispose(),g.renderer.dispose(),g.yi.dispose()}));e=null,k=null}const y={DumpData:I,DumpDataAsync:F,DumpFramebuffer:N,Dispose:j};L.Tools.DumpData=I,L.Tools.DumpDataAsync=F,L.Tools.DumpFramebuffer=N},12432:(g,i,a)=>{a.r(i),a.d(i,{CreateScreenshot:()=>x,CreateScreenshotAsync:()=>E,CreateScreenshotUsingRenderTarget:()=>v,CreateScreenshotUsingRenderTargetAsync:()=>P,CreateScreenshotWithResizeAsync:()=>X,ScreenshotTools:()=>f});var n=a(12436),L=a(12508),d=a(12548),b=a(12415),k=a(12484),e=a(12550),N=a(12571),F=a(12452);class I extends e.f{static _GetDefines(g){if(!g)return null;return g.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(g,i){g?(this._webGPUReady=!0,i.push(Promise.all([a.e(54).then(a.bind(a,15039)),a.e(55).then(a.bind(a,15046))]))):i.push(Promise.all([a.e(56).then(a.bind(a,15048)),a.e(57).then(a.bind(a,15056))]))}constructor(g){const i={...arguments.length>2?arguments[2]:void 0,name:g,yi:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||N.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:I.VertexUrl,fragmentShader:I.FragmentUrl,uniforms:I.Uniforms};super({...i,defines:I._GetDefines(i.yi)}),this.texelSize=new F.Vector2(0,0)}bind(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(g),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}I.VertexUrl="fxaa",I.FragmentUrl="fxaa",I.Uniforms=["texelSize"];class j extends d.e{getClassName(){return"FxaaPostProcess"}constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const e={uniforms:I.Uniforms,size:"number"===typeof i?i:void 0,camera:a,samplingMode:L||n.c.BILINEAR_SAMPLINGMODE,yi:d,reusable:b,textureType:k,...i};super(g,I.FragmentUrl,{effectWrapper:"number"!==typeof i&&i.effectWrapper?void 0:new I(g,d,e),...e}),this.onApplyObservable.add((g=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(g,i,a,n){return k.c.Parse((()=>new j(g.name,g.options,i,g.renderTargetSamplingMode,a.getEngine(),g.reusable)),g,a,n)}}(0,b.e)("BABYLON.FxaaPostProcess",j);var y=a(12292),B=a(12277),c=a(12681),D=a(12684),p=a(12352);let R=null;function x(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:e,width:N}=Y(g,i,a);if(!e||!N)return void y.b.Error("Invalid 'size' parameter !");i.Pg().activeCamera===i?g.onEndFrameObservable.addOnce((()=>{R||(R=document.createElement("canvas")),R.width=N,R.height=e;const i=R.getContext("2d"),a=g.getRenderingCanvas();if(!i||!a)return void y.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const F=a.width,I=a.height,j=R.width,c=R.height,D=j/F,p=c/I,x=k?Math.max(D,p):Math.min(D,p),E=F*x,X=I*x,v=(j-E)/2,P=(c-X)/2;i.drawImage(a,0,0,F,I,v,P,E,X),d?(B.Tools.EncodeScreenshotCanvasData(R,void 0,L,void 0,b),n&&n("")):B.Tools.EncodeScreenshotCanvasData(R,n,L,void 0,b)})):v(g,i,a,(g=>{if(d){const i=new Blob([g]);B.Tools.DownloadBlob(i),n&&n("")}else n&&n(g)}),L,1,g.getCreationOptions().antialias,void 0,void 0,void 0,void 0,b)}async function E(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((b,k)=>{x(g,i,a,(g=>{"undefined"!==typeof g?b(g):k(new Error("Data is undefined"))}),n,void 0,L,d)}))}async function X(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((k=>{x(g,i,{width:a,height:n},(()=>{k()}),L,!0,d,b)}))}function v(g,i,d,b){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]&&arguments[8],B=arguments.length>9&&void 0!==arguments[9]&&arguments[9],R=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],x=arguments.length>11?arguments[11]:void 0,E=arguments.length>12?arguments[12]:void 0,X=arguments.length>13?arguments[13]:void 0;const{height:v,width:P,finalWidth:f,finalHeight:C}=Y(g,i,d),U={width:P,height:v};if(!v||!P)return void y.b.Error("Invalid 'size' parameter !");g.skipFrameRender=!0;const S=g.getRenderWidth,V=g.getRenderHeight;g.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&g._currentRenderTarget?g._currentRenderTarget.width:P},g.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&g._currentRenderTarget?g._currentRenderTarget.height:v},g.onResizeObservable.hasObservers()&&g.onResizeObservable.notifyObservers(g);const K=i.Pg(),T=new L.c("screenShot",U,K,!1,!1,0,!1,n.c.BILINEAR_SAMPLINGMODE,void 0,B,void 0,void 0,void 0,e);T.renderList=K.meshes.slice(),T.samples=e,T.renderSprites=I,T.activeCamera=i,T.forceLayerMaskCheck=R,null===E||void 0===E||E(T);const l=X||c.DumpData,Z=()=>{K.incrementRenderId(),K.resetCachedMaterial(),(0,p.f)((()=>T.isReadyForRendering()&&i.isReady(!0)),(()=>{g.onEndFrameObservable.addOnce((()=>{f===P&&C===v?T.readPixels(void 0,void 0,void 0,!1).then((g=>{l(P,v,g,b,k,F,!0,void 0,x),T.dispose()})):(g.isWebGPU?a.e(51).then(a.bind(a,15018)):a.e(52).then(a.bind(a,15022))).then((async()=>await(0,D.d)("pass",T.getInternalTexture(),K,void 0,void 0,void 0,f,C).then((i=>{g._readTexturePixels(i,f,C,-1,0,null,!0,!1,0,0).then((g=>{l(f,C,g,b,k,F,!0,void 0,x),i.dispose()}))}))))})),K.incrementRenderId(),K.resetCachedMaterial();const n=K.activeCamera,L=K.activeCameras,d=i.outputRenderTarget,e=K.spritesEnabled;K.activeCamera=i,K.activeCameras=null,i.outputRenderTarget=T,K.spritesEnabled=I;const N=K.meshes;K.meshes=T.renderList||K.meshes;try{K.render()}finally{K.activeCamera=n,K.activeCameras=L,i.outputRenderTarget=d,K.spritesEnabled=e,K.meshes=N,g.getRenderWidth=S,g.getRenderHeight=V,g.onResizeObservable.hasObservers()&&g.onResizeObservable.notifyObservers(g),i.getProjectionMatrix(!0),g.skipFrameRender=!1}}),(()=>{g.skipFrameRender=!1,g.getRenderWidth=S,g.getRenderHeight=V}))};if(N){const g=new j("antialiasing",1,K.activeCamera);T.addPostProcess(g),g.Pd=!0,g.onEffectCreatedObservable.addOnce((g=>{g.isReady()?Z():g.onCompiled=()=>{Z()}}))}else Z()}async function P(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],F=arguments.length>10?arguments[10]:void 0,I=arguments.length>11?arguments[11]:void 0,j=arguments.length>12?arguments[12]:void 0;return await new Promise(((y,B)=>{v(g,i,a,(g=>{"undefined"!==typeof g?y(g):B(new Error("Data is undefined"))}),n,L,d,b,k,e,N,F,I,j)}))}function Y(g,i,a){let n=0,L=0,d=0,b=0;if("object"===typeof a){const k=a.precision?Math.abs(a.precision):1;a.width&&a.height?(n=a.height*k,L=a.width*k):a.width&&!a.height?(L=a.width*k,n=Math.round(L/g.getAspectRatio(i))):a.height&&!a.width?(n=a.height*k,L=Math.round(n*g.getAspectRatio(i))):(L=Math.round(g.getRenderWidth()*k),n=Math.round(L/g.getAspectRatio(i))),a.finalWidth&&a.finalHeight?(b=a.finalHeight,d=a.finalWidth):a.finalWidth&&!a.finalHeight?(d=a.finalWidth,b=Math.round(d/g.getAspectRatio(i))):a.finalHeight&&!a.finalWidth?(b=a.finalHeight,d=Math.round(b*g.getAspectRatio(i))):(d=L,b=n)}else isNaN(a)||(n=a,L=a,d=a,b=a);return L&&(L=Math.floor(L)),n&&(n=Math.floor(n)),d&&(d=Math.floor(d)),b&&(b=Math.floor(b)),{height:0|n,width:0|L,finalWidth:0|d,finalHeight:0|b}}const f={CreateScreenshot:x,CreateScreenshotAsync:E,CreateScreenshotWithResizeAsync:X,CreateScreenshotUsingRenderTarget:v,CreateScreenshotUsingRenderTargetAsync:P};B.Tools.CreateScreenshot=x,B.Tools.CreateScreenshotAsync=E,B.Tools.CreateScreenshotUsingRenderTarget=v,B.Tools.CreateScreenshotUsingRenderTargetAsync=P}}]);