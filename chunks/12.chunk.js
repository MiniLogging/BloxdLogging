"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[12],{2239:(U,W,l)=>{l.r(W),l.d(W,{Dispose:()=>j,DumpData:()=>y,DumpDataAsync:()=>q,DumpFramebuffer:()=>A,DumpTools:()=>s});var M=l(2075),t=l(503),L=l(722),p=l(543);let B,k=null;async function A(U,W,l,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;const B=await l.readPixels(0,0,U,W);y(U,W,new Uint8Array(B.buffer),M,t,L,!0,void 0,p)}async function q(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0;return await new Promise((k=>{y(U,W,l,(U=>k(U)),M,t,L,p,B)}))}function y(U,W,A,q){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",s=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8?arguments[8]:void 0;(async function(){return k||(k=new Promise(((U,W)=>{let t,L=null;const k={Sg:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,2091)).then((A=>{let{ThinEngine:q}=A;const y=p.d.Instances.length;try{t=new OffscreenCanvas(100,100),L=new q(t,!1,k)}catch(K){var s;y<p.d.Instances.length&&(null===(s=p.d.Instances.pop())||void 0===s||s.dispose()),t=document.createElement("canvas"),L=new q(t,!1,k)}p.d.Instances.pop(),p.d.OnEnginesDisposedObservable.add((U=>{L&&U!==L&&!L.u&&0===p.d.Instances.length&&j()})),L.getCaps().parallelShaderCompile=void 0;const w=new M.e(L);l.e(46).then(l.bind(l,13285)).then((l=>{let{passPixelShader:p}=l;if(!L)return void W("Engine is not defined");const k=new M.g({Zj:L,name:p.name,fragmentShader:p.shader,samplerNames:["textureSampler"]});B={canvas:t,Zj:L,renderer:w,wrapper:k},U(B)}))})).catch(W)}))),await k})().then((l=>{if(l.Zj.setSize(U,W,!0),A instanceof Float32Array){const U=new Uint8Array(A.length);let W=A.length;for(;W--;){const l=A[W];U[W]=Math.round(255*(0,L.Clamp)(l))}A=U}const M=l.Zj.createRawTexture(A,U,W,5,!1,!w,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",M),l.renderer.draw(),K?t.h.ToBlob(l.canvas,(U=>{const W=new FileReader;W.onload=U=>{const W=U.target.result;q&&q(W)},W.readAsArrayBuffer(U)}),y,r):t.h.EncodeScreenshotCanvasData(l.canvas,q,y,s,r),M.dispose()}))}function j(){var U;B?(B.wrapper.dispose(),B.renderer.dispose(),B.Zj.dispose()):null===(U=k)||void 0===U||U.then((U=>{U.wrapper.dispose(),U.renderer.dispose(),U.Zj.dispose()}));k=null,B=null}const s={DumpData:y,DumpDataAsync:q,DumpFramebuffer:A,Dispose:j};t.h.DumpData=y,t.h.DumpDataAsync=q,t.h.DumpFramebuffer=A}}]);