"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[12,20],{12439:(i,x,e)=>{e.r(x),e.d(x,{Dispose:()=>K,DumpData:()=>A,DumpDataAsync:()=>g,DumpFramebuffer:()=>b,DumpTools:()=>L});var j=e(12346),E=e(12061),a=e(12264),Y=e(12108);let J,u=null;async function b(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const J=await e.readPixels(0,0,i,x);A(i,x,new Uint8Array(J.buffer),j,E,a,!0,void 0,Y)}async function g(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((u=>{A(i,x,e,(i=>u(i)),j,E,a,Y,J)}))}function A(i,x,b,g){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8?arguments[8]:void 0;(async function(){return u||(u=new Promise(((i,x)=>{let E,a=null;const u={o:!0,depth:!1,Ve:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,12367)).then((b=>{let{ThinEngine:g}=b;const A=Y.e.Instances.length;try{E=new OffscreenCanvas(100,100),a=new g(E,!1,u)}catch(M){var L;A<Y.e.Instances.length&&(null===(L=Y.e.Instances.pop())||void 0===L||L.dispose()),E=document.createElement("canvas"),a=new g(E,!1,u)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((i=>{a&&i!==a&&!a.M&&0===Y.e.Instances.length&&K()})),a.getCaps().parallelShaderCompile=void 0;const o=new j.c(a);e.e(52).then(e.bind(e,14656)).then((e=>{let{passPixelShader:Y}=e;if(!a)return void x("Engine is not defined");const u=new j.e({tx:a,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});J={canvas:E,tx:a,renderer:o,wrapper:u},i(J)}))})).catch(x)}))),await u})().then((e=>{if(e.tx.setSize(i,x,!0),b instanceof Float32Array){const i=new Uint8Array(b.length);let x=b.length;for(;x--;){const e=b[x];i[x]=Math.round(255*(0,a.Clamp)(e))}b=i}const j=e.tx.createRawTexture(b,i,x,5,!1,!o,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",j),e.renderer.draw(),M?E.Tools.ToBlob(e.canvas,(i=>{const x=new FileReader;x.onload=i=>{const x=i.target.result;g&&g(x)},x.readAsArrayBuffer(i)}),A,z):E.Tools.EncodeScreenshotCanvasData(e.canvas,g,A,L,z),j.dispose()}))}function K(){var i;J?(J.wrapper.dispose(),J.renderer.dispose(),J.tx.dispose()):null===(i=u)||void 0===i||i.then((i=>{i.wrapper.dispose(),i.renderer.dispose(),i.tx.dispose()}));u=null,J=null}const L={DumpData:A,DumpDataAsync:g,DumpFramebuffer:b,Dispose:K};E.Tools.DumpData=A,E.Tools.DumpDataAsync=g,E.Tools.DumpFramebuffer=b},12222:(i,x,e)=>{e.r(x),e.d(x,{CreateScreenshot:()=>t,CreateScreenshotAsync:()=>V,CreateScreenshotUsingRenderTarget:()=>f,CreateScreenshotUsingRenderTargetAsync:()=>w,CreateScreenshotWithResizeAsync:()=>S,ScreenshotTools:()=>l});var j=e(12227),E=e(12306),a=e(12342),Y=e(12204),J=e(12278),u=e(12346),b=e(12363),g=e(12250);class A extends u.e{static _GetDefines(i){if(!i)return null;return i.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(i,x){i?(this._webGPUReady=!0,x.push(Promise.all([e.e(54).then(e.bind(e,14669)),e.e(55).then(e.bind(e,14675))]))):x.push(Promise.all([e.e(56).then(e.bind(e,14677)),e.e(57).then(e.bind(e,14686))]))}constructor(i){const x={...arguments.length>2?arguments[2]:void 0,name:i,tx:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||b.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:A.VertexUrl,fragmentShader:A.FragmentUrl,uniforms:A.Uniforms};super({...x,defines:A._GetDefines(x.tx)}),this.texelSize=new g.Vector2(0,0)}bind(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(i),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}A.VertexUrl="fxaa",A.FragmentUrl="fxaa",A.Uniforms=["texelSize"];class K extends a.e{getClassName(){return"FxaaPostProcess"}constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const u={uniforms:A.Uniforms,size:"number"===typeof x?x:void 0,camera:e,samplingMode:E||j.d.BILINEAR_SAMPLINGMODE,tx:a,reusable:Y,textureType:J,...x};super(i,A.FragmentUrl,{effectWrapper:"number"!==typeof x&&x.effectWrapper?void 0:new A(i,a,u),...u}),this.onApplyObservable.add((i=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(i,x,e,j){return J.b.Parse((()=>new K(i.name,i.options,x,i.renderTargetSamplingMode,e.getEngine(),i.reusable)),i,e,j)}}(0,Y.f)("BABYLON.FxaaPostProcess",K);var L=e(12072),o=e(12061),M=e(12439),z=e(12442),T=e(12142);let Q=null;function t(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:u,width:b}=O(i,x,e);if(!u||!b)return void L.c.Error("Invalid 'size' parameter !");x.wi().activeCamera===x?i.onEndFrameObservable.addOnce((()=>{Q||(Q=document.createElement("canvas")),Q.width=b,Q.height=u;const x=Q.getContext("2d"),e=i.getRenderingCanvas();if(!x||!e)return void L.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const g=e.width,A=e.height,K=Q.width,M=Q.height,z=K/g,T=M/A,t=J?Math.max(z,T):Math.min(z,T),V=g*t,S=A*t,f=(K-V)/2,w=(M-S)/2;x.drawImage(e,0,0,g,A,f,w,V,S),a?(o.Tools.EncodeScreenshotCanvasData(Q,void 0,E,void 0,Y),j&&j("")):o.Tools.EncodeScreenshotCanvasData(Q,j,E,void 0,Y)})):f(i,x,e,(i=>{if(a){const x=new Blob([i]);o.Tools.DownloadBlob(x),j&&j("")}else j&&j(i)}),E,1,i.getCreationOptions().antialias,void 0,void 0,void 0,void 0,Y)}async function V(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((Y,J)=>{t(i,x,e,(i=>{"undefined"!==typeof i?Y(i):J(new Error("Data is undefined"))}),j,void 0,E,a)}))}async function S(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((J=>{t(i,x,{width:e,height:j},(()=>{J()}),E,!0,a,Y)}))}function f(i,x,a,Y){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],o=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Q=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],t=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0,S=arguments.length>13?arguments[13]:void 0;const{height:f,width:w,finalWidth:l,finalHeight:Z}=O(i,x,a),B={width:w,height:f};if(!f||!w)return void L.c.Error("Invalid 'size' parameter !");i.skipFrameRender=!0;const k=i.getRenderWidth,N=i.getRenderHeight;i.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&i._currentRenderTarget?i._currentRenderTarget.width:w},i.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&i._currentRenderTarget?i._currentRenderTarget.height:f},i.onResizeObservable.hasObservers()&&i.onResizeObservable.notifyObservers(i);const mi=x.wi(),X=new E.d("screenShot",B,mi,!1,!1,0,!1,j.d.BILINEAR_SAMPLINGMODE,void 0,o,void 0,void 0,void 0,u);X.renderList=mi.meshes.slice(),X.samples=u,X.renderSprites=A,X.activeCamera=x,X.forceLayerMaskCheck=Q,null===V||void 0===V||V(X);const C=S||M.DumpData,n=()=>{mi.incrementRenderId(),mi.resetCachedMaterial(),(0,T.d)((()=>X.isReadyForRendering()&&x.isReady(!0)),(()=>{i.onEndFrameObservable.addOnce((()=>{l===w&&Z===f?X.readPixels(void 0,void 0,void 0,!1).then((i=>{C(w,f,i,Y,J,g,!0,void 0,t),X.dispose()})):(i.isWebGPU?e.e(51).then(e.bind(e,14652)):e.e(52).then(e.bind(e,14656))).then((async()=>await(0,z.b)("pass",X.getInternalTexture(),mi,void 0,void 0,void 0,l,Z).then((x=>{i._readTexturePixels(x,l,Z,-1,0,null,!0,!1,0,0).then((i=>{C(l,Z,i,Y,J,g,!0,void 0,t),x.dispose()}))}))))})),mi.incrementRenderId(),mi.resetCachedMaterial();const j=mi.activeCamera,E=mi.activeCameras,a=x.outputRenderTarget,u=mi.spritesEnabled;mi.activeCamera=x,mi.activeCameras=null,x.outputRenderTarget=X,mi.spritesEnabled=A;const b=mi.meshes;mi.meshes=X.renderList||mi.meshes;try{mi.render()}finally{mi.activeCamera=j,mi.activeCameras=E,x.outputRenderTarget=a,mi.spritesEnabled=u,mi.meshes=b,i.getRenderWidth=k,i.getRenderHeight=N,i.onResizeObservable.hasObservers()&&i.onResizeObservable.notifyObservers(i),x.getProjectionMatrix(!0),i.skipFrameRender=!1}}),(()=>{i.skipFrameRender=!1,i.getRenderWidth=k,i.getRenderHeight=N}))};if(b){const i=new K("antialiasing",1,mi.activeCamera);X.addPostProcess(i),i.Xe=!0,i.onEffectCreatedObservable.addOnce((i=>{i.isReady()?n():i.onCompiled=()=>{n()}}))}else n()}async function w(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],g=arguments.length>10?arguments[10]:void 0,A=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0;return await new Promise(((L,o)=>{f(i,x,e,(i=>{"undefined"!==typeof i?L(i):o(new Error("Data is undefined"))}),j,E,a,Y,J,u,b,g,A,K)}))}function O(i,x,e){let j=0,E=0,a=0,Y=0;if("object"===typeof e){const J=e.precision?Math.abs(e.precision):1;e.width&&e.height?(j=e.height*J,E=e.width*J):e.width&&!e.height?(E=e.width*J,j=Math.round(E/i.getAspectRatio(x))):e.height&&!e.width?(j=e.height*J,E=Math.round(j*i.getAspectRatio(x))):(E=Math.round(i.getRenderWidth()*J),j=Math.round(E/i.getAspectRatio(x))),e.finalWidth&&e.finalHeight?(Y=e.finalHeight,a=e.finalWidth):e.finalWidth&&!e.finalHeight?(a=e.finalWidth,Y=Math.round(a/i.getAspectRatio(x))):e.finalHeight&&!e.finalWidth?(Y=e.finalHeight,a=Math.round(Y*i.getAspectRatio(x))):(a=E,Y=j)}else isNaN(e)||(j=e,E=e,a=e,Y=e);return E&&(E=Math.floor(E)),j&&(j=Math.floor(j)),a&&(a=Math.floor(a)),Y&&(Y=Math.floor(Y)),{height:0|j,width:0|E,finalWidth:0|a,finalHeight:0|Y}}const l={CreateScreenshot:t,CreateScreenshotAsync:V,CreateScreenshotWithResizeAsync:S,CreateScreenshotUsingRenderTarget:f,CreateScreenshotUsingRenderTargetAsync:w};o.Tools.CreateScreenshot=t,o.Tools.CreateScreenshotAsync=V,o.Tools.CreateScreenshotUsingRenderTarget=f,o.Tools.CreateScreenshotUsingRenderTargetAsync=w}}]);