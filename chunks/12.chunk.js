"use strict";(self.uji65st81d=self.uji65st81d||[]).push([[12,20],{12625:(V,h,mV)=>{mV.r(h),mV.d(h,{Dispose:()=>q,DumpData:()=>n,DumpDataAsync:()=>o,DumpFramebuffer:()=>K,DumpTools:()=>x});var t=mV(12518),L=mV(12253),N=mV(12435),A=mV(12300);let k,C=null;async function K(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0;const k=await mV.readPixels(0,0,V,h);n(V,h,new Uint8Array(k.buffer),t,L,N,!0,void 0,A)}async function o(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{n(V,h,mV,(V=>C(V)),t,L,N,A,k)}))}function n(V,h,K,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((V,h)=>{let L,N=null;const C={xk:!0,depth:!1,Ck:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(mV.bind(mV,12553)).then((K=>{let{ThinEngine:o}=K;const n=A.b.Instances.length;try{L=new OffscreenCanvas(100,100),N=new o(L,!1,C)}catch(d){var x;n<A.b.Instances.length&&(null===(x=A.b.Instances.pop())||void 0===x||x.dispose()),L=document.createElement("canvas"),N=new o(L,!1,C)}A.b.Instances.pop(),A.b.OnEnginesDisposedObservable.add((V=>{N&&V!==N&&!N.A&&0===A.b.Instances.length&&q()})),N.getCaps().parallelShaderCompile=void 0;const R=new t.e(N);mV.e(52).then(mV.bind(mV,14862)).then((mV=>{let{passPixelShader:A}=mV;if(!N)return void h("Engine is not defined");const C=new t.h({dh:N,name:A.name,fragmentShader:A.shader,samplerNames:["textureSampler"]});k={canvas:L,dh:N,renderer:R,wrapper:C},V(k)}))})).catch(h)}))),await C})().then((mV=>{if(mV.dh.setSize(V,h,!0),K instanceof Float32Array){const V=new Uint8Array(K.length);let h=K.length;for(;h--;){const mV=K[h];V[h]=Math.round(255*(0,N.Clamp)(mV))}K=V}const t=mV.dh.createRawTexture(K,V,h,5,!1,!R,1);mV.renderer.setViewport(),mV.renderer.applyEffectWrapper(mV.wrapper),mV.wrapper.effect._bindTexture("textureSampler",t),mV.renderer.draw(),d?L.Tools.ToBlob(mV.canvas,(V=>{const h=new FileReader;h.onload=V=>{const h=V.target.result;o&&o(h)},h.readAsArrayBuffer(V)}),n,s):L.Tools.EncodeScreenshotCanvasData(mV.canvas,o,n,x,s),t.dispose()}))}function q(){var V;k?(k.wrapper.dispose(),k.renderer.dispose(),k.dh.dispose()):null===(V=C)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.dh.dispose()}));C=null,k=null}const x={DumpData:n,DumpDataAsync:o,DumpFramebuffer:K,Dispose:q};L.Tools.DumpData=n,L.Tools.DumpDataAsync=o,L.Tools.DumpFramebuffer=K},12403:(V,h,mV)=>{mV.r(h),mV.d(h,{CreateScreenshot:()=>z,CreateScreenshotAsync:()=>Q,CreateScreenshotUsingRenderTarget:()=>v,CreateScreenshotUsingRenderTargetAsync:()=>D,CreateScreenshotWithResizeAsync:()=>J,ScreenshotTools:()=>j});var t=mV(12406),L=mV(12469),N=mV(12516),A=mV(12388),k=mV(12448),C=mV(12518),K=mV(12544),o=mV(12422);class n extends C.h{static _GetDefines(V){if(!V)return null;return V.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(V,h){V?(this._webGPUReady=!0,h.push(Promise.all([mV.e(54).then(mV.bind(mV,14876)),mV.e(55).then(mV.bind(mV,14884))]))):h.push(Promise.all([mV.e(56).then(mV.bind(mV,14891)),mV.e(57).then(mV.bind(mV,14897))]))}constructor(V){const h={...arguments.length>2?arguments[2]:void 0,name:V,dh:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||K.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:n.VertexUrl,fragmentShader:n.FragmentUrl,uniforms:n.Uniforms};super({...h,defines:n._GetDefines(h.dh)}),this.texelSize=new o.Vector2(0,0)}bind(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(V),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}n.VertexUrl="fxaa",n.FragmentUrl="fxaa",n.Uniforms=["texelSize"];class q extends N.c{getClassName(){return"FxaaPostProcess"}constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const C={uniforms:n.Uniforms,size:"number"===typeof h?h:void 0,camera:mV,samplingMode:L||t.d.BILINEAR_SAMPLINGMODE,dh:N,reusable:A,textureType:k,...h};super(V,n.FragmentUrl,{effectWrapper:"number"!==typeof h&&h.effectWrapper?void 0:new n(V,N,C),...C}),this.onApplyObservable.add((V=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(V,h,mV,t){return k.e.Parse((()=>new q(V.name,V.options,h,V.renderTargetSamplingMode,mV.getEngine(),V.reusable)),V,mV,t)}}(0,A.i)("BABYLON.FxaaPostProcess",q);var x=mV(12264),R=mV(12253),d=mV(12625),s=mV(12632),M=mV(12322);let c=null;function z(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:C,width:K}=H(V,h,mV);if(!C||!K)return void x.e.Error("Invalid 'size' parameter !");h.DV().activeCamera===h?V.onEndFrameObservable.addOnce((()=>{c||(c=document.createElement("canvas")),c.width=K,c.height=C;const h=c.getContext("2d"),mV=V.getRenderingCanvas();if(!h||!mV)return void x.e.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const o=mV.width,n=mV.height,q=c.width,d=c.height,s=q/o,M=d/n,z=k?Math.max(s,M):Math.min(s,M),Q=o*z,J=n*z,v=(q-Q)/2,D=(d-J)/2;h.drawImage(mV,0,0,o,n,v,D,Q,J),N?(R.Tools.EncodeScreenshotCanvasData(c,void 0,L,void 0,A),t&&t("")):R.Tools.EncodeScreenshotCanvasData(c,t,L,void 0,A)})):v(V,h,mV,(V=>{if(N){const h=new Blob([V]);R.Tools.DownloadBlob(h),t&&t("")}else t&&t(V)}),L,1,V.getCreationOptions().antialias,void 0,void 0,void 0,void 0,A)}async function Q(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((A,k)=>{z(V,h,mV,(V=>{"undefined"!==typeof V?A(V):k(new Error("Data is undefined"))}),t,void 0,L,N)}))}async function J(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((k=>{z(V,h,{width:mV,height:t},(()=>{k()}),L,!0,N,A)}))}function v(V,h,N,A){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=arguments.length>9&&void 0!==arguments[9]&&arguments[9],c=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],z=arguments.length>11?arguments[11]:void 0,Q=arguments.length>12?arguments[12]:void 0,J=arguments.length>13?arguments[13]:void 0;const{height:v,width:D,finalWidth:j,finalHeight:l}=H(V,h,N),G={width:D,height:v};if(!v||!D)return void x.e.Error("Invalid 'size' parameter !");V.skipFrameRender=!0;const y=V.getRenderWidth,O=V.getRenderHeight;V.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&V._currentRenderTarget?V._currentRenderTarget.width:D},V.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&V._currentRenderTarget?V._currentRenderTarget.height:v},V.onResizeObservable.hasObservers()&&V.onResizeObservable.notifyObservers(V);const I=h.DV(),r=new L.c("screenShot",G,I,!1,!1,0,!1,t.d.BILINEAR_SAMPLINGMODE,void 0,R,void 0,void 0,void 0,C);r.renderList=I.meshes.slice(),r.samples=C,r.renderSprites=n,r.activeCamera=h,r.forceLayerMaskCheck=c,null===Q||void 0===Q||Q(r);const T=J||d.DumpData,F=()=>{I.incrementRenderId(),I.resetCachedMaterial(),(0,M.f)((()=>r.isReadyForRendering()&&h.isReady(!0)),(()=>{V.onEndFrameObservable.addOnce((()=>{j===D&&l===v?r.readPixels(void 0,void 0,void 0,!1).then((V=>{T(D,v,V,A,k,o,!0,void 0,z),r.dispose()})):(V.isWebGPU?mV.e(51).then(mV.bind(mV,14854)):mV.e(52).then(mV.bind(mV,14862))).then((async()=>await(0,s.d)("pass",r.getInternalTexture(),I,void 0,void 0,void 0,j,l).then((h=>{V._readTexturePixels(h,j,l,-1,0,null,!0,!1,0,0).then((V=>{T(j,l,V,A,k,o,!0,void 0,z),h.dispose()}))}))))})),I.incrementRenderId(),I.resetCachedMaterial();const t=I.activeCamera,L=I.activeCameras,N=h.outputRenderTarget,C=I.spritesEnabled;I.activeCamera=h,I.activeCameras=null,h.outputRenderTarget=r,I.spritesEnabled=n;const K=I.meshes;I.meshes=r.renderList||I.meshes;try{I.render()}finally{I.activeCamera=t,I.activeCameras=L,h.outputRenderTarget=N,I.spritesEnabled=C,I.meshes=K,V.getRenderWidth=y,V.getRenderHeight=O,V.onResizeObservable.hasObservers()&&V.onResizeObservable.notifyObservers(V),h.getProjectionMatrix(!0),V.skipFrameRender=!1}}),(()=>{V.skipFrameRender=!1,V.getRenderWidth=y,V.getRenderHeight=O}))};if(K){const V=new q("antialiasing",1,I.activeCamera);r.addPostProcess(V),V.Rk=!0,V.onEffectCreatedObservable.addOnce((V=>{V.isReady()?F():V.onCompiled=()=>{F()}}))}else F()}async function D(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],o=arguments.length>10?arguments[10]:void 0,n=arguments.length>11?arguments[11]:void 0,q=arguments.length>12?arguments[12]:void 0;return await new Promise(((x,R)=>{v(V,h,mV,(V=>{"undefined"!==typeof V?x(V):R(new Error("Data is undefined"))}),t,L,N,A,k,C,K,o,n,q)}))}function H(V,h,mV){let t=0,L=0,N=0,A=0;if("object"===typeof mV){const k=mV.precision?Math.abs(mV.precision):1;mV.width&&mV.height?(t=mV.height*k,L=mV.width*k):mV.width&&!mV.height?(L=mV.width*k,t=Math.round(L/V.getAspectRatio(h))):mV.height&&!mV.width?(t=mV.height*k,L=Math.round(t*V.getAspectRatio(h))):(L=Math.round(V.getRenderWidth()*k),t=Math.round(L/V.getAspectRatio(h))),mV.finalWidth&&mV.finalHeight?(A=mV.finalHeight,N=mV.finalWidth):mV.finalWidth&&!mV.finalHeight?(N=mV.finalWidth,A=Math.round(N/V.getAspectRatio(h))):mV.finalHeight&&!mV.finalWidth?(A=mV.finalHeight,N=Math.round(A*V.getAspectRatio(h))):(N=L,A=t)}else isNaN(mV)||(t=mV,L=mV,N=mV,A=mV);return L&&(L=Math.floor(L)),t&&(t=Math.floor(t)),N&&(N=Math.floor(N)),A&&(A=Math.floor(A)),{height:0|t,width:0|L,finalWidth:0|N,finalHeight:0|A}}const j={CreateScreenshot:z,CreateScreenshotAsync:Q,CreateScreenshotWithResizeAsync:J,CreateScreenshotUsingRenderTarget:v,CreateScreenshotUsingRenderTargetAsync:D};R.Tools.CreateScreenshot=z,R.Tools.CreateScreenshotAsync=Q,R.Tools.CreateScreenshotUsingRenderTarget=v,R.Tools.CreateScreenshotUsingRenderTargetAsync=D}}]);