"use strict";(self.ra6kpa9z1sg=self.ra6kpa9z1sg||[]).push([[12,20],{12997:(p,b,M)=>{M.r(b),M.d(b,{Dispose:()=>S,DumpData:()=>x,DumpDataAsync:()=>z,DumpFramebuffer:()=>t,DumpTools:()=>X});var h=M(12876),Q=M(12608),mp=M(12789),y=M(12652);let P,w=null;async function t(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mp=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const P=await M.readPixels(0,0,p,b);x(p,b,new Uint8Array(P.buffer),h,Q,mp,!0,void 0,y)}async function z(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{x(p,b,M,(p=>w(p)),h,Q,mp,y,P)}))}function x(p,b,t,z){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((p,b)=>{let Q,mp=null;const w={Yb:!0,depth:!1,cb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(M.bind(M,12905)).then((t=>{let{ThinEngine:z}=t;const x=y.c.Instances.length;try{Q=new OffscreenCanvas(100,100),mp=new z(Q,!1,w)}catch(J){var X;x<y.c.Instances.length&&(null===(X=y.c.Instances.pop())||void 0===X||X.dispose()),Q=document.createElement("canvas"),mp=new z(Q,!1,w)}y.c.Instances.pop(),y.c.OnEnginesDisposedObservable.add((p=>{mp&&p!==mp&&!mp.S&&0===y.c.Instances.length&&S()})),mp.getCaps().parallelShaderCompile=void 0;const c=new h.e(mp);M.e(52).then(M.bind(M,15268)).then((M=>{let{passPixelShader:y}=M;if(!mp)return void b("Engine is not defined");const w=new h.h({hM:mp,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});P={canvas:Q,hM:mp,renderer:c,wrapper:w},p(P)}))})).catch(b)}))),await w})().then((M=>{if(M.hM.setSize(p,b,!0),t instanceof Float32Array){const p=new Uint8Array(t.length);let b=t.length;for(;b--;){const M=t[b];p[b]=Math.round(255*(0,mp.Clamp)(M))}t=p}const h=M.hM.createRawTexture(t,p,b,5,!1,!c,1);M.renderer.setViewport(),M.renderer.applyEffectWrapper(M.wrapper),M.wrapper.effect._bindTexture("textureSampler",h),M.renderer.draw(),J?Q.Tools.ToBlob(M.canvas,(p=>{const b=new FileReader;b.onload=p=>{const b=p.target.result;z&&z(b)},b.readAsArrayBuffer(p)}),x,g):Q.Tools.EncodeScreenshotCanvasData(M.canvas,z,x,X,g),h.dispose()}))}function S(){var p;P?(P.wrapper.dispose(),P.renderer.dispose(),P.hM.dispose()):null===(p=w)||void 0===p||p.then((p=>{p.wrapper.dispose(),p.renderer.dispose(),p.hM.dispose()}));w=null,P=null}const X={DumpData:x,DumpDataAsync:z,DumpFramebuffer:t,Dispose:S};Q.Tools.DumpData=x,Q.Tools.DumpDataAsync=z,Q.Tools.DumpFramebuffer=t},12748:(p,b,M)=>{M.r(b),M.d(b,{CreateScreenshot:()=>a,CreateScreenshotAsync:()=>o,CreateScreenshotUsingRenderTarget:()=>L,CreateScreenshotUsingRenderTargetAsync:()=>u,CreateScreenshotWithResizeAsync:()=>l,ScreenshotTools:()=>d});var h=M(12753),Q=M(12837),mp=M(12870),y=M(12730),P=M(12812),w=M(12876),t=M(12897),z=M(12777);class x extends w.h{static _GetDefines(p){if(!p)return null;return p.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(p,b){p?(this._webGPUReady=!0,b.push(Promise.all([M.e(54).then(M.bind(M,15278)),M.e(55).then(M.bind(M,15285))]))):b.push(Promise.all([M.e(56).then(M.bind(M,15289)),M.e(57).then(M.bind(M,15291))]))}constructor(p){const b={...arguments.length>2?arguments[2]:void 0,name:p,hM:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||t.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:x.VertexUrl,fragmentShader:x.FragmentUrl,uniforms:x.Uniforms};super({...b,defines:x._GetDefines(b.hM)}),this.texelSize=new z.Vector2(0,0)}bind(){let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(p),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}x.VertexUrl="fxaa",x.FragmentUrl="fxaa",x.Uniforms=["texelSize"];class S extends mp.d{getClassName(){return"FxaaPostProcess"}constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3?arguments[3]:void 0,mp=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const w={uniforms:x.Uniforms,size:"number"===typeof b?b:void 0,camera:M,samplingMode:Q||h.c.BILINEAR_SAMPLINGMODE,hM:mp,reusable:y,textureType:P,...b};super(p,x.FragmentUrl,{effectWrapper:"number"!==typeof b&&b.effectWrapper?void 0:new x(p,mp,w),...w}),this.onApplyObservable.add((p=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(p,b,M,h){return P.e.Parse((()=>new S(p.name,p.options,b,p.renderTargetSamplingMode,M.getEngine(),p.reusable)),p,M,h)}}(0,y.c)("BABYLON.FxaaPostProcess",S);var X=M(12622),c=M(12608),J=M(12997),g=M(13001),f=M(12680);let Y=null;function a(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,P=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:w,width:t}=e(p,b,M);if(!w||!t)return void X.d.Error("Invalid 'size' parameter !");b.upp().activeCamera===b?p.onEndFrameObservable.addOnce((()=>{Y||(Y=document.createElement("canvas")),Y.width=t,Y.height=w;const b=Y.getContext("2d"),M=p.getRenderingCanvas();if(!b||!M)return void X.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const z=M.width,x=M.height,S=Y.width,J=Y.height,g=S/z,f=J/x,a=P?Math.max(g,f):Math.min(g,f),o=z*a,l=x*a,L=(S-o)/2,u=(J-l)/2;b.drawImage(M,0,0,z,x,L,u,o,l),mp?(c.Tools.EncodeScreenshotCanvasData(Y,void 0,Q,void 0,y),h&&h("")):c.Tools.EncodeScreenshotCanvasData(Y,h,Q,void 0,y)})):L(p,b,M,(p=>{if(mp){const b=new Blob([p]);c.Tools.DownloadBlob(b),h&&h("")}else h&&h(p)}),Q,1,p.getCreationOptions().antialias,void 0,void 0,void 0,void 0,y)}async function o(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((y,P)=>{a(p,b,M,(p=>{"undefined"!==typeof p?y(p):P(new Error("Data is undefined"))}),h,void 0,Q,mp)}))}async function l(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mp=arguments.length>5?arguments[5]:void 0,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((P=>{a(p,b,{width:M,height:h},(()=>{P()}),Q,!0,mp,y)}))}function L(p,b,mp,y){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Y=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],a=arguments.length>11?arguments[11]:void 0,o=arguments.length>12?arguments[12]:void 0,l=arguments.length>13?arguments[13]:void 0;const{height:L,width:u,finalWidth:d,finalHeight:I}=e(p,b,mp),G={width:u,height:L};if(!L||!u)return void X.d.Error("Invalid 'size' parameter !");p.skipFrameRender=!0;const v=p.getRenderWidth,Z=p.getRenderHeight;p.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&p._currentRenderTarget?p._currentRenderTarget.width:u},p.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&p._currentRenderTarget?p._currentRenderTarget.height:L},p.onResizeObservable.hasObservers()&&p.onResizeObservable.notifyObservers(p);const U=b.upp(),q=new Q.b("screenShot",G,U,!1,!1,0,!1,h.c.BILINEAR_SAMPLINGMODE,void 0,c,void 0,void 0,void 0,w);q.renderList=U.meshes.slice(),q.samples=w,q.renderSprites=x,q.activeCamera=b,q.forceLayerMaskCheck=Y,null===o||void 0===o||o(q);const B=l||J.DumpData,s=()=>{U.incrementRenderId(),U.resetCachedMaterial(),(0,f.g)((()=>q.isReadyForRendering()&&b.isReady(!0)),(()=>{p.onEndFrameObservable.addOnce((()=>{d===u&&I===L?q.readPixels(void 0,void 0,void 0,!1).then((p=>{B(u,L,p,y,P,z,!0,void 0,a),q.dispose()})):(p.isWebGPU?M.e(51).then(M.bind(M,15259)):M.e(52).then(M.bind(M,15268))).then((async()=>await(0,g.b)("pass",q.getInternalTexture(),U,void 0,void 0,void 0,d,I).then((b=>{p._readTexturePixels(b,d,I,-1,0,null,!0,!1,0,0).then((p=>{B(d,I,p,y,P,z,!0,void 0,a),b.dispose()}))}))))})),U.incrementRenderId(),U.resetCachedMaterial();const h=U.activeCamera,Q=U.activeCameras,mp=b.outputRenderTarget,w=U.spritesEnabled;U.activeCamera=b,U.activeCameras=null,b.outputRenderTarget=q,U.spritesEnabled=x;const t=U.meshes;U.meshes=q.renderList||U.meshes;try{U.render()}finally{U.activeCamera=h,U.activeCameras=Q,b.outputRenderTarget=mp,U.spritesEnabled=w,U.meshes=t,p.getRenderWidth=v,p.getRenderHeight=Z,p.onResizeObservable.hasObservers()&&p.onResizeObservable.notifyObservers(p),b.getProjectionMatrix(!0),p.skipFrameRender=!1}}),(()=>{p.skipFrameRender=!1,p.getRenderWidth=v,p.getRenderHeight=Z}))};if(t){const p=new S("antialiasing",1,U.activeCamera);q.addPostProcess(p),p.ab=!0,p.onEffectCreatedObservable.addOnce((p=>{p.isReady()?s():p.onCompiled=()=>{s()}}))}else s()}async function u(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0,P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],z=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0,S=arguments.length>12?arguments[12]:void 0;return await new Promise(((X,c)=>{L(p,b,M,(p=>{"undefined"!==typeof p?X(p):c(new Error("Data is undefined"))}),h,Q,mp,y,P,w,t,z,x,S)}))}function e(p,b,M){let h=0,Q=0,mp=0,y=0;if("object"===typeof M){const P=M.precision?Math.abs(M.precision):1;M.width&&M.height?(h=M.height*P,Q=M.width*P):M.width&&!M.height?(Q=M.width*P,h=Math.round(Q/p.getAspectRatio(b))):M.height&&!M.width?(h=M.height*P,Q=Math.round(h*p.getAspectRatio(b))):(Q=Math.round(p.getRenderWidth()*P),h=Math.round(Q/p.getAspectRatio(b))),M.finalWidth&&M.finalHeight?(y=M.finalHeight,mp=M.finalWidth):M.finalWidth&&!M.finalHeight?(mp=M.finalWidth,y=Math.round(mp/p.getAspectRatio(b))):M.finalHeight&&!M.finalWidth?(y=M.finalHeight,mp=Math.round(y*p.getAspectRatio(b))):(mp=Q,y=h)}else isNaN(M)||(h=M,Q=M,mp=M,y=M);return Q&&(Q=Math.floor(Q)),h&&(h=Math.floor(h)),mp&&(mp=Math.floor(mp)),y&&(y=Math.floor(y)),{height:0|h,width:0|Q,finalWidth:0|mp,finalHeight:0|y}}const d={CreateScreenshot:a,CreateScreenshotAsync:o,CreateScreenshotWithResizeAsync:l,CreateScreenshotUsingRenderTarget:L,CreateScreenshotUsingRenderTargetAsync:u};c.Tools.CreateScreenshot=a,c.Tools.CreateScreenshotAsync=o,c.Tools.CreateScreenshotUsingRenderTarget=L,c.Tools.CreateScreenshotUsingRenderTargetAsync=u}}]);