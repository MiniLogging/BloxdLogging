"use strict";(self.z22hkk7o33f=self.z22hkk7o33f||[]).push([[12,20],{13089:(U,G,C)=>{C.r(G),C.d(G,{Dispose:()=>D,DumpData:()=>T,DumpDataAsync:()=>O,DumpFramebuffer:()=>P,DumpTools:()=>y});var L=C(12989),X=C(12718),l=C(12911),t=C(12763);let E,K=null;async function P(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0;const E=await C.readPixels(0,0,U,G);T(U,G,new Uint8Array(E.buffer),L,X,l,!0,void 0,t)}async function O(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;return await new Promise((K=>{T(U,G,C,(U=>K(U)),L,X,l,t,E)}))}function T(U,G,P,O){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return K||(K=new Promise(((U,G)=>{let X,l=null;const K={BE:!0,depth:!1,kE:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,13016)).then((P=>{let{ThinEngine:O}=P;const T=t.d.Instances.length;try{X=new OffscreenCanvas(100,100),l=new O(X,!1,K)}catch(p){var y;T<t.d.Instances.length&&(null===(y=t.d.Instances.pop())||void 0===y||y.dispose()),X=document.createElement("canvas"),l=new O(X,!1,K)}t.d.Instances.pop(),t.d.OnEnginesDisposedObservable.add((U=>{l&&U!==l&&!l.t&&0===t.d.Instances.length&&D()})),l.getCaps().parallelShaderCompile=void 0;const V=new L.e(l);C.e(52).then(C.bind(C,14949)).then((C=>{let{passPixelShader:t}=C;if(!l)return void G("Engine is not defined");const K=new L.h({VG:l,name:t.name,fragmentShader:t.shader,samplerNames:["textureSampler"]});E={canvas:X,VG:l,renderer:V,wrapper:K},U(E)}))})).catch(G)}))),await K})().then((C=>{if(C.VG.setSize(U,G,!0),P instanceof Float32Array){const U=new Uint8Array(P.length);let G=P.length;for(;G--;){const C=P[G];U[G]=Math.round(255*(0,l.Clamp)(C))}P=U}const L=C.VG.createRawTexture(P,U,G,5,!1,!V,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",L),C.renderer.draw(),p?X.Tools.ToBlob(C.canvas,(U=>{const G=new FileReader;G.onload=U=>{const G=U.target.result;O&&O(G)},G.readAsArrayBuffer(U)}),T,I):X.Tools.EncodeScreenshotCanvasData(C.canvas,O,T,y,I),L.dispose()}))}function D(){var U;E?(E.wrapper.dispose(),E.renderer.dispose(),E.VG.dispose()):null===(U=K)||void 0===U||U.then((U=>{U.wrapper.dispose(),U.renderer.dispose(),U.VG.dispose()}));K=null,E=null}const y={DumpData:T,DumpDataAsync:O,DumpFramebuffer:P,Dispose:D};X.Tools.DumpData=T,X.Tools.DumpDataAsync=O,X.Tools.DumpFramebuffer=P},12869:(U,G,C)=>{C.r(G),C.d(G,{CreateScreenshot:()=>N,CreateScreenshotAsync:()=>b,CreateScreenshotUsingRenderTarget:()=>w,CreateScreenshotUsingRenderTargetAsync:()=>S,CreateScreenshotWithResizeAsync:()=>o,ScreenshotTools:()=>u});var L=C(12873),X=C(12949),l=C(26),t=C(12985),E=C(12850),K=C(12928),P=C(12989),O=C(13014),T=C(12896);class D extends P.h{static _GetDefines(U){if(!U)return null;return U.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(U,G){U?(this._webGPUReady=!0,G.push(Promise.all([C.e(54).then(C.bind(C,14959)),C.e(55).then(C.bind(C,14966))]))):G.push(Promise.all([C.e(56).then(C.bind(C,14970)),C.e(57).then(C.bind(C,14979))]))}constructor(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const L=(0,l.b)((0,l.b)({},C),{},{name:U,VG:G||O.d.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:D.VertexUrl,fragmentShader:D.FragmentUrl,uniforms:D.Uniforms});super((0,l.b)((0,l.b)({},L),{},{defines:D._GetDefines(L.VG)})),this.texelSize=new T.Vector2(0,0)}bind(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(U),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}D.VertexUrl="fxaa",D.FragmentUrl="fxaa",D.Uniforms=["texelSize"];class y extends t.e{getClassName(){return"FxaaPostProcess"}constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const P=(0,l.b)({uniforms:D.Uniforms,size:"number"===typeof G?G:void 0,camera:C,samplingMode:X||L.c.BILINEAR_SAMPLINGMODE,VG:t,reusable:E,textureType:K},G);super(U,D.FragmentUrl,(0,l.b)({effectWrapper:"number"!==typeof G&&G.effectWrapper?void 0:new D(U,t,P)},P)),this.onApplyObservable.add((U=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(U,G,C,L){return K.c.Parse((()=>new y(U.name,U.options,G,U.renderTargetSamplingMode,C.getEngine(),U.reusable)),U,C,L)}}(0,E.e)("BABYLON.FxaaPostProcess",y);var V=C(12731),p=C(12718),I=C(13089),H=C(13092),x=C(12794);let h=null;function N(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6?arguments[6]:void 0,E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:K,width:P}=v(U,G,C);if(!K||!P)return void V.d.Error("Invalid 'size' parameter !");G.wU().activeCamera===G?U.onEndFrameObservable.addOnce((()=>{h||(h=document.createElement("canvas")),h.width=P,h.height=K;const G=h.getContext("2d"),C=U.getRenderingCanvas();if(!G||!C)return void V.d.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const O=C.width,T=C.height,D=h.width,y=h.height,I=D/O,H=y/T,x=E?Math.max(I,H):Math.min(I,H),N=O*x,b=T*x,o=(D-N)/2,w=(y-b)/2;G.drawImage(C,0,0,O,T,o,w,N,b),l?(p.Tools.EncodeScreenshotCanvasData(h,void 0,X,void 0,t),L&&L("")):p.Tools.EncodeScreenshotCanvasData(h,L,X,void 0,t)})):w(U,G,C,(U=>{if(l){const G=new Blob([U]);p.Tools.DownloadBlob(G),L&&L("")}else L&&L(U)}),X,1,U.getCreationOptions().antialias,void 0,void 0,void 0,void 0,t)}async function b(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((t,E)=>{N(U,G,C,(U=>{"undefined"!==typeof U?t(U):E(new Error("Data is undefined"))}),L,void 0,X,l)}))}async function o(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((E=>{N(U,G,{width:C,height:L},(()=>{E()}),X,!0,l,t)}))}function w(U,G,l,t){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0,T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],D=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],h=arguments.length>11?arguments[11]:void 0,N=arguments.length>12?arguments[12]:void 0,b=arguments.length>13?arguments[13]:void 0;const{height:o,width:w,finalWidth:S,finalHeight:u}=v(U,G,l),d={width:w,height:o};if(!o||!w)return void V.d.Error("Invalid 'size' parameter !");U.skipFrameRender=!0;const g=U.getRenderWidth,Z=U.getRenderHeight;U.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&U._currentRenderTarget?U._currentRenderTarget.width:w},U.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&U._currentRenderTarget?U._currentRenderTarget.height:o},U.onResizeObservable.hasObservers()&&U.onResizeObservable.notifyObservers(U);const F=G.wU(),q=new X.d("screenShot",d,F,!1,!1,0,!1,L.c.BILINEAR_SAMPLINGMODE,void 0,D,void 0,void 0,void 0,K);q.renderList=F.meshes.slice(),q.samples=K,q.renderSprites=T,q.activeCamera=G,q.forceLayerMaskCheck=p,null===N||void 0===N||N(q);const a=b||I.DumpData,k=()=>{F.incrementRenderId(),F.resetCachedMaterial(),(0,x.f)((()=>q.isReadyForRendering()&&G.isReady(!0)),(()=>{U.onEndFrameObservable.addOnce((()=>{S===w&&u===o?q.readPixels(void 0,void 0,void 0,!1).then((U=>{a(w,o,U,t,E,O,!0,void 0,h),q.dispose()})):(U.isWebGPU?C.e(51).then(C.bind(C,14943)):C.e(52).then(C.bind(C,14949))).then((async()=>await(0,H.c)("pass",q.getInternalTexture(),F,void 0,void 0,void 0,S,u).then((G=>{U._readTexturePixels(G,S,u,-1,0,null,!0,!1,0,0).then((U=>{a(S,u,U,t,E,O,!0,void 0,h),G.dispose()}))}))))})),F.incrementRenderId(),F.resetCachedMaterial();const L=F.activeCamera,X=F.activeCameras,l=G.outputRenderTarget,K=F.spritesEnabled;F.activeCamera=G,F.activeCameras=null,G.outputRenderTarget=q,F.spritesEnabled=T;const P=F.meshes;F.meshes=q.renderList||F.meshes;try{F.render()}finally{F.activeCamera=L,F.activeCameras=X,G.outputRenderTarget=l,F.spritesEnabled=K,F.meshes=P,U.getRenderWidth=g,U.getRenderHeight=Z,U.onResizeObservable.hasObservers()&&U.onResizeObservable.notifyObservers(U),G.getProjectionMatrix(!0),U.skipFrameRender=!1}}),(()=>{U.skipFrameRender=!1,U.getRenderWidth=g,U.getRenderHeight=Z}))};if(P){const U=new y("antialiasing",1,F.activeCamera);q.addPostProcess(U),U.ME=!0,U.onEffectCreatedObservable.addOnce((U=>{U.isReady()?k():U.onCompiled=()=>{k()}}))}else k()}async function S(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6?arguments[6]:void 0,E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],P=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],O=arguments.length>10?arguments[10]:void 0,T=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0;return await new Promise(((y,V)=>{w(U,G,C,(U=>{"undefined"!==typeof U?y(U):V(new Error("Data is undefined"))}),L,X,l,t,E,K,P,O,T,D)}))}function v(U,G,C){let L=0,X=0,l=0,t=0;if("object"===typeof C){const E=C.precision?Math.abs(C.precision):1;C.width&&C.height?(L=C.height*E,X=C.width*E):C.width&&!C.height?(X=C.width*E,L=Math.round(X/U.getAspectRatio(G))):C.height&&!C.width?(L=C.height*E,X=Math.round(L*U.getAspectRatio(G))):(X=Math.round(U.getRenderWidth()*E),L=Math.round(X/U.getAspectRatio(G))),C.finalWidth&&C.finalHeight?(t=C.finalHeight,l=C.finalWidth):C.finalWidth&&!C.finalHeight?(l=C.finalWidth,t=Math.round(l/U.getAspectRatio(G))):C.finalHeight&&!C.finalWidth?(t=C.finalHeight,l=Math.round(t*U.getAspectRatio(G))):(l=X,t=L)}else isNaN(C)||(L=C,X=C,l=C,t=C);return X&&(X=Math.floor(X)),L&&(L=Math.floor(L)),l&&(l=Math.floor(l)),t&&(t=Math.floor(t)),{height:0|L,width:0|X,finalWidth:0|l,finalHeight:0|t}}const u={CreateScreenshot:N,CreateScreenshotAsync:b,CreateScreenshotWithResizeAsync:o,CreateScreenshotUsingRenderTarget:w,CreateScreenshotUsingRenderTargetAsync:S};p.Tools.CreateScreenshot=N,p.Tools.CreateScreenshotAsync=b,p.Tools.CreateScreenshotUsingRenderTarget=w,p.Tools.CreateScreenshotUsingRenderTargetAsync=S}}]);