"use strict";(self.agop5zpabxv=self.agop5zpabxv||[]).push([[12,20],{12546:(H,u,J)=>{J.r(u),J.d(u,{Dispose:()=>P,DumpData:()=>G,DumpDataAsync:()=>d,DumpFramebuffer:()=>b,DumpTools:()=>mH});var O=J(12439),U=J(12171),h=J(12349),w=J(12203);let g,B=null;async function b(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0;const g=await J.readPixels(0,0,H,u);G(H,u,new Uint8Array(g.buffer),O,U,h,!0,void 0,w)}async function d(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0;return await new Promise((B=>{G(H,u,J,(H=>B(H)),O,U,h,w,g)}))}function G(H,u,b,d){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mH=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8?arguments[8]:void 0;(async function(){return B||(B=new Promise(((H,u)=>{let U,h=null;const B={Nh:!0,depth:!1,Rh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(J.bind(J,12457)).then((b=>{let{ThinEngine:d}=b;const G=w.e.Instances.length;try{U=new OffscreenCanvas(100,100),h=new d(U,!1,B)}catch(r){var mH;G<w.e.Instances.length&&(null===(mH=w.e.Instances.pop())||void 0===mH||mH.dispose()),U=document.createElement("canvas"),h=new d(U,!1,B)}w.e.Instances.pop(),w.e.OnEnginesDisposedObservable.add((H=>{h&&H!==h&&!h.B&&0===w.e.Instances.length&&P()})),h.getCaps().parallelShaderCompile=void 0;const l=new O.e(h);J.e(52).then(J.bind(J,14792)).then((J=>{let{passPixelShader:w}=J;if(!h)return void u("Engine is not defined");const B=new O.g({mJ:h,name:w.name,fragmentShader:w.shader,samplerNames:["textureSampler"]});g={canvas:U,mJ:h,renderer:l,wrapper:B},H(g)}))})).catch(u)}))),await B})().then((J=>{if(J.mJ.setSize(H,u,!0),b instanceof Float32Array){const H=new Uint8Array(b.length);let u=b.length;for(;u--;){const J=b[u];H[u]=Math.round(255*(0,h.Clamp)(J))}b=H}const O=J.mJ.createRawTexture(b,H,u,5,!1,!l,1);J.renderer.setViewport(),J.renderer.applyEffectWrapper(J.wrapper),J.wrapper.effect._bindTexture("textureSampler",O),J.renderer.draw(),r?U.Tools.ToBlob(J.canvas,(H=>{const u=new FileReader;u.onload=H=>{const u=H.target.result;d&&d(u)},u.readAsArrayBuffer(H)}),G,p):U.Tools.EncodeScreenshotCanvasData(J.canvas,d,G,mH,p),O.dispose()}))}function P(){var H;g?(g.wrapper.dispose(),g.renderer.dispose(),g.mJ.dispose()):null===(H=B)||void 0===H||H.then((H=>{H.wrapper.dispose(),H.renderer.dispose(),H.mJ.dispose()}));B=null,g=null}const mH={DumpData:G,DumpDataAsync:d,DumpFramebuffer:b,Dispose:P};U.Tools.DumpData=G,U.Tools.DumpDataAsync=d,U.Tools.DumpFramebuffer=b},12312:(H,u,J)=>{J.r(u),J.d(u,{CreateScreenshot:()=>C,CreateScreenshotAsync:()=>j,CreateScreenshotUsingRenderTarget:()=>L,CreateScreenshotUsingRenderTargetAsync:()=>Z,CreateScreenshotWithResizeAsync:()=>M,ScreenshotTools:()=>F});var O=J(12321),U=J(12399),h=J(12434),w=J(12304),g=J(12365),B=J(12439),b=J(12452),d=J(12338);class G extends B.g{static _GetDefines(H){if(!H)return null;return H.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(H,u){H?(this._webGPUReady=!0,u.push(Promise.all([J.e(54).then(J.bind(J,14806)),J.e(55).then(J.bind(J,14815))]))):u.push(Promise.all([J.e(56).then(J.bind(J,14823)),J.e(57).then(J.bind(J,14825))]))}constructor(H){const u={...arguments.length>2?arguments[2]:void 0,name:H,mJ:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||b.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:G.VertexUrl,fragmentShader:G.FragmentUrl,uniforms:G.Uniforms};super({...u,defines:G._GetDefines(u.mJ)}),this.texelSize=new d.Vector2(0,0)}bind(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(H),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}G.VertexUrl="fxaa",G.FragmentUrl="fxaa",G.Uniforms=["texelSize"];class P extends h.e{getClassName(){return"FxaaPostProcess"}constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const B={uniforms:G.Uniforms,size:"number"===typeof u?u:void 0,camera:J,samplingMode:U||O.b.BILINEAR_SAMPLINGMODE,mJ:h,reusable:w,textureType:g,...u};super(H,G.FragmentUrl,{effectWrapper:"number"!==typeof u&&u.effectWrapper?void 0:new G(H,h,B),...B}),this.onApplyObservable.add((H=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(H,u,J,O){return g.d.Parse((()=>new P(H.name,H.options,u,H.renderTargetSamplingMode,J.getEngine(),H.reusable)),H,J,O)}}(0,w.f)("BABYLON.FxaaPostProcess",P);var mH=J(12185),l=J(12171),r=J(12546),p=J(12555),a=J(12240);let k=null;function C(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:B,width:b}=Y(H,u,J);if(!B||!b)return void mH.b.Error("Invalid 'size' parameter !");u.ZH().activeCamera===u?H.onEndFrameObservable.addOnce((()=>{k||(k=document.createElement("canvas")),k.width=b,k.height=B;const u=k.getContext("2d"),J=H.getRenderingCanvas();if(!u||!J)return void mH.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const d=J.width,G=J.height,P=k.width,r=k.height,p=P/d,a=r/G,C=g?Math.max(p,a):Math.min(p,a),j=d*C,M=G*C,L=(P-j)/2,Z=(r-M)/2;u.drawImage(J,0,0,d,G,L,Z,j,M),h?(l.Tools.EncodeScreenshotCanvasData(k,void 0,U,void 0,w),O&&O("")):l.Tools.EncodeScreenshotCanvasData(k,O,U,void 0,w)})):L(H,u,J,(H=>{if(h){const u=new Blob([H]);l.Tools.DownloadBlob(u),O&&O("")}else O&&O(H)}),U,1,H.getCreationOptions().antialias,void 0,void 0,void 0,void 0,w)}async function j(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((w,g)=>{C(H,u,J,(H=>{"undefined"!==typeof H?w(H):g(new Error("Data is undefined"))}),O,void 0,U,h)}))}async function M(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((g=>{C(H,u,{width:J,height:O},(()=>{g()}),U,!0,h,w)}))}function L(H,u,h,w){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]&&arguments[9],k=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],C=arguments.length>11?arguments[11]:void 0,j=arguments.length>12?arguments[12]:void 0,M=arguments.length>13?arguments[13]:void 0;const{height:L,width:Z,finalWidth:F,finalHeight:s}=Y(H,u,h),A={width:Z,height:L};if(!L||!Z)return void mH.b.Error("Invalid 'size' parameter !");H.skipFrameRender=!0;const t=H.getRenderWidth,e=H.getRenderHeight;H.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&H._currentRenderTarget?H._currentRenderTarget.width:Z},H.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&H._currentRenderTarget?H._currentRenderTarget.height:L},H.onResizeObservable.hasObservers()&&H.onResizeObservable.notifyObservers(H);const c=u.ZH(),n=new U.d("screenShot",A,c,!1,!1,0,!1,O.b.BILINEAR_SAMPLINGMODE,void 0,l,void 0,void 0,void 0,B);n.renderList=c.meshes.slice(),n.samples=B,n.renderSprites=G,n.activeCamera=u,n.forceLayerMaskCheck=k,null===j||void 0===j||j(n);const V=M||r.DumpData,T=()=>{c.incrementRenderId(),c.resetCachedMaterial(),(0,a.c)((()=>n.isReadyForRendering()&&u.isReady(!0)),(()=>{H.onEndFrameObservable.addOnce((()=>{F===Z&&s===L?n.readPixels(void 0,void 0,void 0,!1).then((H=>{V(Z,L,H,w,g,d,!0,void 0,C),n.dispose()})):(H.isWebGPU?J.e(51).then(J.bind(J,14784)):J.e(52).then(J.bind(J,14792))).then((async()=>await(0,p.e)("pass",n.getInternalTexture(),c,void 0,void 0,void 0,F,s).then((u=>{H._readTexturePixels(u,F,s,-1,0,null,!0,!1,0,0).then((H=>{V(F,s,H,w,g,d,!0,void 0,C),u.dispose()}))}))))})),c.incrementRenderId(),c.resetCachedMaterial();const O=c.activeCamera,U=c.activeCameras,h=u.outputRenderTarget,B=c.spritesEnabled;c.activeCamera=u,c.activeCameras=null,u.outputRenderTarget=n,c.spritesEnabled=G;const b=c.meshes;c.meshes=n.renderList||c.meshes;try{c.render()}finally{c.activeCamera=O,c.activeCameras=U,u.outputRenderTarget=h,c.spritesEnabled=B,c.meshes=b,H.getRenderWidth=t,H.getRenderHeight=e,H.onResizeObservable.hasObservers()&&H.onResizeObservable.notifyObservers(H),u.getProjectionMatrix(!0),H.skipFrameRender=!1}}),(()=>{H.skipFrameRender=!1,H.getRenderWidth=t,H.getRenderHeight=e}))};if(b){const H=new P("antialiasing",1,c.activeCamera);n.addPostProcess(H),H.Eh=!0,H.onEffectCreatedObservable.addOnce((H=>{H.isReady()?T():H.onCompiled=()=>{T()}}))}else T()}async function Z(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],B=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=arguments.length>10?arguments[10]:void 0,G=arguments.length>11?arguments[11]:void 0,P=arguments.length>12?arguments[12]:void 0;return await new Promise(((mH,l)=>{L(H,u,J,(H=>{"undefined"!==typeof H?mH(H):l(new Error("Data is undefined"))}),O,U,h,w,g,B,b,d,G,P)}))}function Y(H,u,J){let O=0,U=0,h=0,w=0;if("object"===typeof J){const g=J.precision?Math.abs(J.precision):1;J.width&&J.height?(O=J.height*g,U=J.width*g):J.width&&!J.height?(U=J.width*g,O=Math.round(U/H.getAspectRatio(u))):J.height&&!J.width?(O=J.height*g,U=Math.round(O*H.getAspectRatio(u))):(U=Math.round(H.getRenderWidth()*g),O=Math.round(U/H.getAspectRatio(u))),J.finalWidth&&J.finalHeight?(w=J.finalHeight,h=J.finalWidth):J.finalWidth&&!J.finalHeight?(h=J.finalWidth,w=Math.round(h/H.getAspectRatio(u))):J.finalHeight&&!J.finalWidth?(w=J.finalHeight,h=Math.round(w*H.getAspectRatio(u))):(h=U,w=O)}else isNaN(J)||(O=J,U=J,h=J,w=J);return U&&(U=Math.floor(U)),O&&(O=Math.floor(O)),h&&(h=Math.floor(h)),w&&(w=Math.floor(w)),{height:0|O,width:0|U,finalWidth:0|h,finalHeight:0|w}}const F={CreateScreenshot:C,CreateScreenshotAsync:j,CreateScreenshotWithResizeAsync:M,CreateScreenshotUsingRenderTarget:L,CreateScreenshotUsingRenderTargetAsync:Z};l.Tools.CreateScreenshot=C,l.Tools.CreateScreenshotAsync=j,l.Tools.CreateScreenshotUsingRenderTarget=L,l.Tools.CreateScreenshotUsingRenderTargetAsync=Z}}]);