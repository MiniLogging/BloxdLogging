"use strict";(self["9jl1vn4ei5r"]=self["9jl1vn4ei5r"]||[]).push([[12,20],{12016:(M,p,b)=>{b.r(p),b.d(p,{Dispose:()=>o,DumpData:()=>F,DumpDataAsync:()=>H,DumpFramebuffer:()=>O,DumpTools:()=>W});var Q=b(11888),q=b(11621),B=b(11806),k=b(11664);let u,T=null;async function O(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const u=await b.readPixels(0,0,M,p);F(M,p,new Uint8Array(u.buffer),Q,q,B,!0,void 0,k)}async function H(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0;return await new Promise((T=>{F(M,p,b,(M=>T(M)),Q,q,B,k,u)}))}function F(M,p,O,H){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8?arguments[8]:void 0;(async function(){return T||(T=new Promise(((M,p)=>{let q,B=null;const T={kb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,11919)).then((O=>{let{ThinEngine:H}=O;const F=k.c.Instances.length;try{q=new OffscreenCanvas(100,100),B=new H(q,!1,T)}catch(A){var W;F<k.c.Instances.length&&(null===(W=k.c.Instances.pop())||void 0===W||W.dispose()),q=document.createElement("canvas"),B=new H(q,!1,T)}k.c.Instances.pop(),k.c.OnEnginesDisposedObservable.add((M=>{B&&M!==B&&!B.O&&0===k.c.Instances.length&&o()})),B.getCaps().parallelShaderCompile=void 0;const i=new Q.e(B);b.e(52).then(b.bind(b,14201)).then((b=>{let{passPixelShader:k}=b;if(!B)return void p("Engine is not defined");const T=new Q.g({Wp:B,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});u={canvas:q,Wp:B,renderer:i,wrapper:T},M(u)}))})).catch(p)}))),await T})().then((b=>{if(b.Wp.setSize(M,p,!0),O instanceof Float32Array){const M=new Uint8Array(O.length);let p=O.length;for(;p--;){const b=O[p];M[p]=Math.round(255*(0,B.Clamp)(b))}O=M}const Q=b.Wp.createRawTexture(O,M,p,5,!1,!i,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",Q),b.renderer.draw(),A?q.Tools.ToBlob(b.canvas,(M=>{const p=new FileReader;p.onload=M=>{const p=M.target.result;H&&H(p)},p.readAsArrayBuffer(M)}),F,j):q.Tools.EncodeScreenshotCanvasData(b.canvas,H,F,W,j),Q.dispose()}))}function o(){var M;u?(u.wrapper.dispose(),u.renderer.dispose(),u.Wp.dispose()):null===(M=T)||void 0===M||M.then((M=>{M.wrapper.dispose(),M.renderer.dispose(),M.Wp.dispose()}));T=null,u=null}const W={DumpData:F,DumpDataAsync:H,DumpFramebuffer:O,Dispose:o};q.Tools.DumpData=F,q.Tools.DumpDataAsync=H,q.Tools.DumpFramebuffer=O},11772:(M,p,b)=>{b.r(p),b.d(p,{CreateScreenshot:()=>a,CreateScreenshotAsync:()=>s,CreateScreenshotUsingRenderTarget:()=>f,CreateScreenshotUsingRenderTargetAsync:()=>R,CreateScreenshotWithResizeAsync:()=>S,ScreenshotTools:()=>x});var Q=b(11780),q=b(11851),B=b(11882),k=b(11757),u=b(11823),T=b(11888),O=b(11911),H=b(11796);class F extends T.g{static _GetDefines(M){if(!M)return null;return M.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(M,p){M?(this._webGPUReady=!0,p.push(Promise.all([b.e(54).then(b.bind(b,14210)),b.e(55).then(b.bind(b,14213))]))):p.push(Promise.all([b.e(56).then(b.bind(b,14222)),b.e(57).then(b.bind(b,14225))]))}constructor(M){const p={...arguments.length>2?arguments[2]:void 0,name:M,Wp:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||O.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:F.VertexUrl,fragmentShader:F.FragmentUrl,uniforms:F.Uniforms};super({...p,defines:F._GetDefines(p.Wp)}),this.texelSize=new H.Vector2(0,0)}bind(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(M),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}F.VertexUrl="fxaa",F.FragmentUrl="fxaa",F.Uniforms=["texelSize"];class o extends B.b{getClassName(){return"FxaaPostProcess"}constructor(M,p){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const T={uniforms:F.Uniforms,size:"number"===typeof p?p:void 0,camera:b,samplingMode:q||Q.b.BILINEAR_SAMPLINGMODE,Wp:B,reusable:k,textureType:u,...p};super(M,F.FragmentUrl,{effectWrapper:"number"!==typeof p&&p.effectWrapper?void 0:new F(M,B,T),...T}),this.onApplyObservable.add((M=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(M,p,b,Q){return u.b.Parse((()=>new o(M.name,M.options,p,M.renderTargetSamplingMode,b.getEngine(),M.reusable)),M,b,Q)}}(0,k.g)("BABYLON.FxaaPostProcess",o);var W=b(11637),i=b(11621),A=b(12016),j=b(12022),K=b(11693);let D=null;function a(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:T,width:O}=y(M,p,b);if(!T||!O)return void W.c.Error("Invalid 'size' parameter !");p.RM().activeCamera===p?M.onEndFrameObservable.addOnce((()=>{D||(D=document.createElement("canvas")),D.width=O,D.height=T;const p=D.getContext("2d"),b=M.getRenderingCanvas();if(!p||!b)return void W.c.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const H=b.width,F=b.height,o=D.width,A=D.height,j=o/H,K=A/F,a=u?Math.max(j,K):Math.min(j,K),s=H*a,S=F*a,f=(o-s)/2,R=(A-S)/2;p.drawImage(b,0,0,H,F,f,R,s,S),B?(i.Tools.EncodeScreenshotCanvasData(D,void 0,q,void 0,k),Q&&Q("")):i.Tools.EncodeScreenshotCanvasData(D,Q,q,void 0,k)})):f(M,p,b,(M=>{if(B){const p=new Blob([M]);i.Tools.DownloadBlob(p),Q&&Q("")}else Q&&Q(M)}),q,1,M.getCreationOptions().antialias,void 0,void 0,void 0,void 0,k)}async function s(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((k,u)=>{a(M,p,b,(M=>{"undefined"!==typeof M?k(M):u(new Error("Data is undefined"))}),Q,void 0,q,B)}))}async function S(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((u=>{a(M,p,{width:b,height:Q},(()=>{u()}),q,!0,B,k)}))}function f(M,p,B,k){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],i=arguments.length>9&&void 0!==arguments[9]&&arguments[9],D=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],a=arguments.length>11?arguments[11]:void 0,s=arguments.length>12?arguments[12]:void 0,S=arguments.length>13?arguments[13]:void 0;const{height:f,width:R,finalWidth:x,finalHeight:P}=y(M,p,B),L={width:R,height:f};if(!f||!R)return void W.c.Error("Invalid 'size' parameter !");M.skipFrameRender=!0;const N=M.getRenderWidth,r=M.getRenderHeight;M.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&M._currentRenderTarget?M._currentRenderTarget.width:R},M.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&M._currentRenderTarget?M._currentRenderTarget.height:f},M.onResizeObservable.hasObservers()&&M.onResizeObservable.notifyObservers(M);const Y=p.RM(),w=new q.c("screenShot",L,Y,!1,!1,0,!1,Q.b.BILINEAR_SAMPLINGMODE,void 0,i,void 0,void 0,void 0,T);w.renderList=Y.meshes.slice(),w.samples=T,w.renderSprites=F,w.activeCamera=p,w.forceLayerMaskCheck=D,null===s||void 0===s||s(w);const E=S||A.DumpData,n=()=>{Y.incrementRenderId(),Y.resetCachedMaterial(),(0,K.i)((()=>w.isReadyForRendering()&&p.isReady(!0)),(()=>{M.onEndFrameObservable.addOnce((()=>{x===R&&P===f?w.readPixels(void 0,void 0,void 0,!1).then((M=>{E(R,f,M,k,u,H,!0,void 0,a),w.dispose()})):(M.isWebGPU?b.e(51).then(b.bind(b,14197)):b.e(52).then(b.bind(b,14201))).then((async()=>await(0,j.e)("pass",w.getInternalTexture(),Y,void 0,void 0,void 0,x,P).then((p=>{M._readTexturePixels(p,x,P,-1,0,null,!0,!1,0,0).then((M=>{E(x,P,M,k,u,H,!0,void 0,a),p.dispose()}))}))))})),Y.incrementRenderId(),Y.resetCachedMaterial();const Q=Y.activeCamera,q=Y.activeCameras,B=p.outputRenderTarget,T=Y.spritesEnabled;Y.activeCamera=p,Y.activeCameras=null,p.outputRenderTarget=w,Y.spritesEnabled=F;const O=Y.meshes;Y.meshes=w.renderList||Y.meshes;try{Y.render()}finally{Y.activeCamera=Q,Y.activeCameras=q,p.outputRenderTarget=B,Y.spritesEnabled=T,Y.meshes=O,M.getRenderWidth=N,M.getRenderHeight=r,M.onResizeObservable.hasObservers()&&M.onResizeObservable.notifyObservers(M),p.getProjectionMatrix(!0),M.skipFrameRender=!1}}),(()=>{M.skipFrameRender=!1,M.getRenderWidth=N,M.getRenderHeight=r}))};if(O){const M=new o("antialiasing",1,Y.activeCamera);w.addPostProcess(M),M.ub=!0,M.onEffectCreatedObservable.addOnce((M=>{M.isReady()?n():M.onCompiled=()=>{n()}}))}else n()}async function R(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],O=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],H=arguments.length>10?arguments[10]:void 0,F=arguments.length>11?arguments[11]:void 0,o=arguments.length>12?arguments[12]:void 0;return await new Promise(((W,i)=>{f(M,p,b,(M=>{"undefined"!==typeof M?W(M):i(new Error("Data is undefined"))}),Q,q,B,k,u,T,O,H,F,o)}))}function y(M,p,b){let Q=0,q=0,B=0,k=0;if("object"===typeof b){const u=b.precision?Math.abs(b.precision):1;b.width&&b.height?(Q=b.height*u,q=b.width*u):b.width&&!b.height?(q=b.width*u,Q=Math.round(q/M.getAspectRatio(p))):b.height&&!b.width?(Q=b.height*u,q=Math.round(Q*M.getAspectRatio(p))):(q=Math.round(M.getRenderWidth()*u),Q=Math.round(q/M.getAspectRatio(p))),b.finalWidth&&b.finalHeight?(k=b.finalHeight,B=b.finalWidth):b.finalWidth&&!b.finalHeight?(B=b.finalWidth,k=Math.round(B/M.getAspectRatio(p))):b.finalHeight&&!b.finalWidth?(k=b.finalHeight,B=Math.round(k*M.getAspectRatio(p))):(B=q,k=Q)}else isNaN(b)||(Q=b,q=b,B=b,k=b);return q&&(q=Math.floor(q)),Q&&(Q=Math.floor(Q)),B&&(B=Math.floor(B)),k&&(k=Math.floor(k)),{height:0|Q,width:0|q,finalWidth:0|B,finalHeight:0|k}}const x={CreateScreenshot:a,CreateScreenshotAsync:s,CreateScreenshotWithResizeAsync:S,CreateScreenshotUsingRenderTarget:f,CreateScreenshotUsingRenderTargetAsync:R};i.Tools.CreateScreenshot=a,i.Tools.CreateScreenshotAsync=s,i.Tools.CreateScreenshotUsingRenderTarget=f,i.Tools.CreateScreenshotUsingRenderTargetAsync=R}}]);