"use strict";(self.ex92n20nlz8=self.ex92n20nlz8||[]).push([[12,20],{12796:(I,g,b)=>{b.r(g),b.d(g,{Dispose:()=>p,DumpData:()=>D,DumpDataAsync:()=>G,DumpFramebuffer:()=>n,DumpTools:()=>x});var e=b(12697),c=b(12409),z=b(12610),M=b(12449);let J,o=null;async function n(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,M=arguments.length>6?arguments[6]:void 0;const J=await b.readPixels(0,0,I,g);D(I,g,new Uint8Array(J.buffer),e,c,z,!0,void 0,M)}async function G(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((o=>{D(I,g,b,(I=>o(I)),e,c,z,M,J)}))}function D(I,g,n,G){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8?arguments[8]:void 0;(async function(){return o||(o=new Promise(((I,g)=>{let c,z=null;const o={o:!0,depth:!1,ig:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,12726)).then((n=>{let{ThinEngine:G}=n;const D=M.b.Instances.length;try{c=new OffscreenCanvas(100,100),z=new G(c,!1,o)}catch(k){var x;D<M.b.Instances.length&&(null===(x=M.b.Instances.pop())||void 0===x||x.dispose()),c=document.createElement("canvas"),z=new G(c,!1,o)}M.b.Instances.pop(),M.b.OnEnginesDisposedObservable.add((I=>{z&&I!==z&&!z.Z&&0===M.b.Instances.length&&p()})),z.getCaps().parallelShaderCompile=void 0;const Z=new e.d(z);b.e(52).then(b.bind(b,15040)).then((b=>{let{passPixelShader:M}=b;if(!z)return void g("Engine is not defined");const o=new e.g({kg:z,name:M.name,fragmentShader:M.shader,samplerNames:["textureSampler"]});J={canvas:c,kg:z,renderer:Z,wrapper:o},I(J)}))})).catch(g)}))),await o})().then((b=>{if(b.kg.setSize(I,g,!0),n instanceof Float32Array){const I=new Uint8Array(n.length);let g=n.length;for(;g--;){const b=n[g];I[g]=Math.round(255*(0,z.Clamp)(b))}n=I}const e=b.kg.createRawTexture(n,I,g,5,!1,!Z,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",e),b.renderer.draw(),k?c.Tools.ToBlob(b.canvas,(I=>{const g=new FileReader;g.onload=I=>{const g=I.target.result;G&&G(g)},g.readAsArrayBuffer(I)}),D,S):c.Tools.EncodeScreenshotCanvasData(b.canvas,G,D,x,S),e.dispose()}))}function p(){var I;J?(J.wrapper.dispose(),J.renderer.dispose(),J.kg.dispose()):null===(I=o)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.kg.dispose()}));o=null,J=null}const x={DumpData:D,DumpDataAsync:G,DumpFramebuffer:n,Dispose:p};c.Tools.DumpData=D,c.Tools.DumpDataAsync=G,c.Tools.DumpFramebuffer=n},12569:(I,g,b)=>{b.r(g),b.d(g,{CreateScreenshot:()=>a,CreateScreenshotAsync:()=>v,CreateScreenshotUsingRenderTarget:()=>R,CreateScreenshotUsingRenderTargetAsync:()=>E,CreateScreenshotWithResizeAsync:()=>X,ScreenshotTools:()=>s});var e=b(12572),c=b(12650),z=b(12690),M=b(12558),J=b(12622),o=b(12697),n=b(12718),G=b(12590);class D extends o.g{static _GetDefines(I){if(!I)return null;return I.extractDriverInfo().toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null}_gatherImports(I,g){I?(this._webGPUReady=!0,g.push(Promise.all([b.e(54).then(b.bind(b,15052)),b.e(55).then(b.bind(b,15055))]))):g.push(Promise.all([b.e(56).then(b.bind(b,15063)),b.e(57).then(b.bind(b,15072))]))}constructor(I){const g={...arguments.length>2?arguments[2]:void 0,name:I,kg:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||n.c.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,vertexShader:D.VertexUrl,fragmentShader:D.FragmentUrl,uniforms:D.Uniforms};super({...g,defines:D._GetDefines(g.kg)}),this.texelSize=new G.Vector2(0,0)}bind(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.bind(I),this._drawWrapper.effect.setFloat2("texelSize",this.texelSize.x,this.texelSize.y)}}D.VertexUrl="fxaa",D.FragmentUrl="fxaa",D.Uniforms=["texelSize"];class p extends z.d{getClassName(){return"FxaaPostProcess"}constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const o={uniforms:D.Uniforms,size:"number"===typeof g?g:void 0,camera:b,samplingMode:c||e.b.BILINEAR_SAMPLINGMODE,kg:z,reusable:M,textureType:J,...g};super(I,D.FragmentUrl,{effectWrapper:"number"!==typeof g&&g.effectWrapper?void 0:new D(I,z,o),...o}),this.onApplyObservable.add((I=>{this._effectWrapper.texelSize=this.texelSize}))}static _Parse(I,g,b,e){return J.b.Parse((()=>new p(I.name,I.options,g,I.renderTargetSamplingMode,b.getEngine(),I.reusable)),I,b,e)}}(0,M.g)("BABYLON.FxaaPostProcess",p);var x=b(12420),Z=b(12409),k=b(12796),S=b(12803),f=b(12488);let V=null;function a(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const{height:o,width:n}=mI(I,g,b);if(!o||!n)return void x.b.Error("Invalid 'size' parameter !");g.EI().activeCamera===g?I.onEndFrameObservable.addOnce((()=>{V||(V=document.createElement("canvas")),V.width=n,V.height=o;const g=V.getContext("2d"),b=I.getRenderingCanvas();if(!g||!b)return void x.b.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");const G=b.width,D=b.height,p=V.width,k=V.height,S=p/G,f=k/D,a=J?Math.max(S,f):Math.min(S,f),v=G*a,X=D*a,R=(p-v)/2,E=(k-X)/2;g.drawImage(b,0,0,G,D,R,E,v,X),z?(Z.Tools.EncodeScreenshotCanvasData(V,void 0,c,void 0,M),e&&e("")):Z.Tools.EncodeScreenshotCanvasData(V,e,c,void 0,M)})):R(I,g,b,(I=>{if(z){const g=new Blob([I]);Z.Tools.DownloadBlob(g),e&&e("")}else e&&e(I)}),c,1,I.getCreationOptions().antialias,void 0,void 0,void 0,void 0,M)}async function v(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return await new Promise(((M,J)=>{a(I,g,b,(I=>{"undefined"!==typeof I?M(I):J(new Error("Data is undefined"))}),e,void 0,c,z)}))}async function X(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,M=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return await new Promise((J=>{a(I,g,{width:b,height:e},(()=>{J()}),c,!0,z,M)}))}function R(I,g,z,M){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]&&arguments[9],V=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],a=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0,X=arguments.length>13?arguments[13]:void 0;const{height:R,width:E,finalWidth:s,finalHeight:F}=mI(I,g,z),Y={width:E,height:R};if(!R||!E)return void x.b.Error("Invalid 'size' parameter !");I.skipFrameRender=!0;const d=I.getRenderWidth,C=I.getRenderHeight;I.getRenderWidth=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&I._currentRenderTarget?I._currentRenderTarget.width:E},I.getRenderHeight=function(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&I._currentRenderTarget?I._currentRenderTarget.height:R},I.onResizeObservable.hasObservers()&&I.onResizeObservable.notifyObservers(I);const r=g.EI(),O=new c.d("screenShot",Y,r,!1,!1,0,!1,e.b.BILINEAR_SAMPLINGMODE,void 0,Z,void 0,void 0,void 0,o);O.renderList=r.meshes.slice(),O.samples=o,O.renderSprites=D,O.activeCamera=g,O.forceLayerMaskCheck=V,null===v||void 0===v||v(O);const H=X||k.DumpData,i=()=>{r.incrementRenderId(),r.resetCachedMaterial(),(0,f.e)((()=>O.isReadyForRendering()&&g.isReady(!0)),(()=>{I.onEndFrameObservable.addOnce((()=>{s===E&&F===R?O.readPixels(void 0,void 0,void 0,!1).then((I=>{H(E,R,I,M,J,G,!0,void 0,a),O.dispose()})):(I.isWebGPU?b.e(51).then(b.bind(b,15035)):b.e(52).then(b.bind(b,15040))).then((async()=>await(0,S.c)("pass",O.getInternalTexture(),r,void 0,void 0,void 0,s,F).then((g=>{I._readTexturePixels(g,s,F,-1,0,null,!0,!1,0,0).then((I=>{H(s,F,I,M,J,G,!0,void 0,a),g.dispose()}))}))))})),r.incrementRenderId(),r.resetCachedMaterial();const e=r.activeCamera,c=r.activeCameras,z=g.outputRenderTarget,o=r.spritesEnabled;r.activeCamera=g,r.activeCameras=null,g.outputRenderTarget=O,r.spritesEnabled=D;const n=r.meshes;r.meshes=O.renderList||r.meshes;try{r.render()}finally{r.activeCamera=e,r.activeCameras=c,g.outputRenderTarget=z,r.spritesEnabled=o,r.meshes=n,I.getRenderWidth=d,I.getRenderHeight=C,I.onResizeObservable.hasObservers()&&I.onResizeObservable.notifyObservers(I),g.getProjectionMatrix(!0),I.skipFrameRender=!1}}),(()=>{I.skipFrameRender=!1,I.getRenderWidth=d,I.getRenderHeight=C}))};if(n){const I=new p("antialiasing",1,r.activeCamera);O.addPostProcess(I),I.Wg=!0,I.onEffectCreatedObservable.addOnce((I=>{I.isReady()?i():I.onCompiled=()=>{i()}}))}else i()}async function E(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6?arguments[6]:void 0,J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],o=arguments.length>8&&void 0!==arguments[8]&&arguments[8],n=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],G=arguments.length>10?arguments[10]:void 0,D=arguments.length>11?arguments[11]:void 0,p=arguments.length>12?arguments[12]:void 0;return await new Promise(((x,Z)=>{R(I,g,b,(I=>{"undefined"!==typeof I?x(I):Z(new Error("Data is undefined"))}),e,c,z,M,J,o,n,G,D,p)}))}function mI(I,g,b){let e=0,c=0,z=0,M=0;if("object"===typeof b){const J=b.precision?Math.abs(b.precision):1;b.width&&b.height?(e=b.height*J,c=b.width*J):b.width&&!b.height?(c=b.width*J,e=Math.round(c/I.getAspectRatio(g))):b.height&&!b.width?(e=b.height*J,c=Math.round(e*I.getAspectRatio(g))):(c=Math.round(I.getRenderWidth()*J),e=Math.round(c/I.getAspectRatio(g))),b.finalWidth&&b.finalHeight?(M=b.finalHeight,z=b.finalWidth):b.finalWidth&&!b.finalHeight?(z=b.finalWidth,M=Math.round(z/I.getAspectRatio(g))):b.finalHeight&&!b.finalWidth?(M=b.finalHeight,z=Math.round(M*I.getAspectRatio(g))):(z=c,M=e)}else isNaN(b)||(e=b,c=b,z=b,M=b);return c&&(c=Math.floor(c)),e&&(e=Math.floor(e)),z&&(z=Math.floor(z)),M&&(M=Math.floor(M)),{height:0|e,width:0|c,finalWidth:0|z,finalHeight:0|M}}const s={CreateScreenshot:a,CreateScreenshotAsync:v,CreateScreenshotWithResizeAsync:X,CreateScreenshotUsingRenderTarget:R,CreateScreenshotUsingRenderTargetAsync:E};Z.Tools.CreateScreenshot=a,Z.Tools.CreateScreenshotAsync=v,Z.Tools.CreateScreenshotUsingRenderTarget=R,Z.Tools.CreateScreenshotUsingRenderTargetAsync=E}}]);