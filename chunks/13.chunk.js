"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[13],{2244:(c,b,A)=>{A.r(b),A.d(b,{_HDRTextureLoader:()=>J});var o=A(688);class t{static ConvertPanoramaToCubemap(c,b,A,o){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!c)throw"ConvertPanoramaToCubemap: input cannot be null";if(c.length!=b*A*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(o,this.FACE_FRONT,c,b,A,t),back:this.CreateCubemapTexture(o,this.FACE_BACK,c,b,A,t),left:this.CreateCubemapTexture(o,this.FACE_LEFT,c,b,A,t),right:this.CreateCubemapTexture(o,this.FACE_RIGHT,c,b,A,t),up:this.CreateCubemapTexture(o,this.FACE_UP,c,b,A,t),down:this.CreateCubemapTexture(o,this.FACE_DOWN,c,b,A,t),size:o,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(c,b,A,o,t){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=new ArrayBuffer(c*c*4*3),s=new Float32Array(h),L=n?Math.max(1,Math.round(o/4/c)):1,C=1/L,J=C*C,X=b[1].Xd(b[0]).scale(C/c),R=b[3].Xd(b[2]).scale(C/c),N=1/c;let k=0;for(let E=0;E<c;E++)for(let n=0;n<L;n++){let n=b[0],h=b[2];for(let b=0;b<c;b++)for(let C=0;C<L;C++){const L=h.Xd(n).scale(k).add(n);L.normalize();const C=this.CalcProjectionSpherical(L,A,o,t);s[E*c*3+3*b+0]+=C.r*J,s[E*c*3+3*b+1]+=C.g*J,s[E*c*3+3*b+2]+=C.b*J,n=n.add(X),h=h.add(R)}k+=N*C}return s}static CalcProjectionSpherical(c,b,A,o){let t=Math.atan2(c.z,c.x);const n=Math.acos(c.y);for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;let h=t/Math.PI;const s=n/Math.PI;h=.5*h+.5;let L=Math.round(h*A);L<0?L=0:L>=A&&(L=A-1);let C=Math.round(s*o);C<0?C=0:C>=o&&(C=o-1);const J=o-C-1;return{r:b[J*A*3+3*L+0],g:b[J*A*3+3*L+1],b:b[J*A*3+3*L+2]}}}function n(c,b,A,o,t,n){t>0?(t=function(c,b){return b>1023?c*Math.pow(2,1023)*Math.pow(2,b-1023):b<-1074?c*Math.pow(2,-1074)*Math.pow(2,b+1074):c*Math.pow(2,b)}(1,t-136),c[n+0]=b*t,c[n+1]=A*t,c[n+2]=o*t):(c[n+0]=0,c[n+1]=0,c[n+2]=0)}function h(c,b){let A="",o="";for(let t=b;t<c.length-b&&(o=String.fromCharCode(c[t]),"\n"!=o);t++)A+=o;return A}function s(c){let b=0,A=0,o=h(c,0);if("#"!=o[0]||"?"!=o[1])throw"Bad HDR Format.";let t=!1,n=!1,s=0;do{s+=o.length+1,o=h(c,s),"FORMAT=32-bit_rle_rgbe"==o?n=!0:0==o.length&&(t=!0)}while(!t);if(!n)throw"HDR Bad header format, unsupported FORMAT";s+=o.length+1,o=h(c,s);const L=/^-Y (.*) \+X (.*)$/g.exec(o);if(!L||L.length<3)throw"HDR Bad header format, no size";if(A=parseInt(L[2]),b=parseInt(L[1]),A<8||A>32767)throw"HDR Bad header format, unsupported size";return s+=o.length+1,{height:b,width:A,dataPosition:s}}function L(c,b){return function(c,b){let A=b.height;const o=b.width;let t,h,s,L,J,X=b.dataPosition,R=0,N=0,k=0;const E=new ArrayBuffer(4*o),V=new Uint8Array(E),y=new ArrayBuffer(b.width*b.height*4*3),j=new Float32Array(y);for(;A>0;){if(t=c[X++],h=c[X++],s=c[X++],L=c[X++],2!=t||2!=h||128&s||b.width<8||b.width>32767)return C(c,b);if((s<<8|L)!=o)throw"HDR Bad header format, wrong scan line width";for(R=0,k=0;k<4;k++)for(N=(k+1)*o;R<N;)if(t=c[X++],h=c[X++],t>128){if(J=t-128,0==J||J>N-R)throw"HDR Bad Format, bad scanline data (run)";for(;J-- >0;)V[R++]=h}else{if(J=t,0==J||J>N-R)throw"HDR Bad Format, bad scanline data (non-run)";if(V[R++]=h,--J>0)for(let b=0;b<J;b++)V[R++]=c[X++]}for(k=0;k<o;k++)t=V[k],h=V[k+o],s=V[k+2*o],L=V[k+3*o],n(j,t,h,s,L,(b.height-A)*o*3+3*k);A--}return j}(c,b)}function C(c,b){let A=b.height;const o=b.width;let t,h,s,L,C,J=b.dataPosition;const X=new ArrayBuffer(b.width*b.height*4*3),R=new Float32Array(X);for(;A>0;){for(C=0;C<b.width;C++)t=c[J++],h=c[J++],s=c[J++],L=c[J++],n(R,t,h,s,L,(b.height-A)*o*3+3*C);A--}return R}t.FACE_LEFT=[new o.k(-1,-1,-1),new o.k(1,-1,-1),new o.k(-1,1,-1),new o.k(1,1,-1)],t.FACE_RIGHT=[new o.k(1,-1,1),new o.k(-1,-1,1),new o.k(1,1,1),new o.k(-1,1,1)],t.FACE_FRONT=[new o.k(1,-1,-1),new o.k(1,-1,1),new o.k(1,1,-1),new o.k(1,1,1)],t.FACE_BACK=[new o.k(-1,-1,1),new o.k(-1,-1,-1),new o.k(-1,1,1),new o.k(-1,1,-1)],t.FACE_DOWN=[new o.k(1,1,-1),new o.k(1,1,1),new o.k(-1,1,-1),new o.k(-1,1,1)],t.FACE_UP=[new o.k(-1,-1,-1),new o.k(-1,-1,1),new o.k(1,-1,-1),new o.k(1,-1,1)];class J{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(c,b,A){const o=new Uint8Array(c.buffer,c.byteOffset,c.byteLength),t=s(o),n=L(o,t),h=t.width*t.height,C=new Float32Array(4*h);for(let s=0;s<h;s+=1)C[4*s]=n[3*s],C[4*s+1]=n[3*s+1],C[4*s+2]=n[3*s+2],C[4*s+3]=1;A(t.width,t.height,b.generateMipMaps,!1,(()=>{const c=b.getEngine();b.type=1,b.format=5,b._gammaSpace=!1,c._uploadDataToTextureDirectly(b,C)}))}}}}]);