"use strict";(self.fyqbdzs5tyo=self.fyqbdzs5tyo||[]).push([[79],{14305:(V,I,A)=>{A.r(I),A.d(I,{FlowGraphPlayAnimationBlock:()=>H});var B=A(13003),F=A(12954),E=A(11189),Y=A(14303);class H extends B.c{constructor(V){super(V,["animationLoop","animationEnd","animationGroupLoop"]),this.config=V,this.speed=this.registerDataInput("speed",F.v),this.loop=this.registerDataInput("loop",F.g),this.from=this.registerDataInput("from",F.v,0),this.to=this.registerDataInput("to",F.v),this.currentFrame=this.registerDataOutput("currentFrame",F.v),this.currentTime=this.registerDataOutput("currentTime",F.v),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",F.e),this.animationGroup=this.registerDataInput("animationGroup",F.e,null===V||void 0===V?void 0:V.animationGroup),this.animation=this.registerDataInput("animation",F.e),this.object=this.registerDataInput("object",F.e)}_preparePendingTasks(V){const I=this.animationGroup.getValue(V),A=this.animation.getValue(V);if(!I&&!A)return this._reportError(V,"No animation or animation group provided");{const F=this.currentAnimationGroup.getValue(V);F&&F!==I&&F.dispose();let E=I;if(A&&!E){const I=this.object.getValue(V);if(!I)return this._reportError(V,"No target object provided");const B=Array.isArray(A)?A:[A],F=B[0].name;E=new Y.AnimationGroup("flowGraphAnimationGroup-"+F+"-"+I.name,V.configuration.WI);let H=!1;const c=V._getGlobalContextVariable("interpolationAnimations",[]);for(const V of B)E.addTargetedAnimation(V,I),-1!==c.indexOf(V.uniqueId)&&(H=!0);H&&this._checkInterpolationDuplications(V,B,I)}const H=this.speed.getValue(V)||1,c=this.from.getValue(V)??0,b=this.to.getValue(V)||E.to,X=!isFinite(b)||this.loop.getValue(V);this.currentAnimationGroup.setValue(E,V);const P=V._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==P.indexOf(E.uniqueId)&&E.stop();try{E.start(X,H,c,b),E.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(V))),E.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(V))),E.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(V))),E.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(V))),P.push(E.uniqueId),V._setGlobalContextVariable("currentlyRunningAnimationGroups",P)}catch(B){this._reportError(V,B)}}}_reportError(V,I){super._reportError(V,I),this.currentFrame.setValue(-1,V),this.currentTime.setValue(-1,V)}_executeOnTick(V){const I=this.currentAnimationGroup.getValue(V);var A;I&&(this.currentFrame.setValue(I.getCurrentFrame(),V),this.currentTime.setValue((null===(A=I.animatables[0])||void 0===A?void 0:A.elapsedTime)??0,V))}_execute(V){this._startPendingTasks(V)}_onAnimationGroupEnd(V){this._removeFromCurrentlyRunning(V,this.currentAnimationGroup.getValue(V)),this._resetAfterCanceled(V),this.done._activateSignal(V)}_checkInterpolationDuplications(V,I,A){const B=V._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const F of B){const B=V.assetsContext.animationGroups.find((V=>V.uniqueId===F));if(B)for(const F of B.targetedAnimations)for(const E of I)F.animation.targetProperty===E.targetProperty&&F.target===A&&this._stopAnimationGroup(V,B)}}_stopAnimationGroup(V,I){I.stop(!0),I.dispose(),this._removeFromCurrentlyRunning(V,I)}_removeFromCurrentlyRunning(V,I){const A=V._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),B=A.indexOf(I.uniqueId);-1!==B&&(A.splice(B,1),V._setGlobalContextVariable("currentlyRunningAnimationGroups",A))}_cancelPendingTasks(V){const I=this.currentAnimationGroup.getValue(V);I&&this._stopAnimationGroup(V,I)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,E.e)("FlowGraphPlayAnimationBlock",H)}}]);