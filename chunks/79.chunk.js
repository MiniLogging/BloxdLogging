"use strict";(self.wy695la1oic=self.wy695la1oic||[]).push([[79],{14578:(S,v,D)=>{D.r(v),D.d(v,{FlowGraphPlayAnimationBlock:()=>B});var z=D(13146),e=D(13108),N=D(11329),m=D(14571);class B extends z.e{constructor(S){super(S,["animationLoop","animationEnd","animationGroupLoop"]),this.config=S,this.speed=this.registerDataInput("speed",e.q),this.loop=this.registerDataInput("loop",e.e),this.from=this.registerDataInput("from",e.q,0),this.to=this.registerDataInput("to",e.q),this.currentFrame=this.registerDataOutput("currentFrame",e.q),this.currentTime=this.registerDataOutput("currentTime",e.q),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",e.d),this.animationGroup=this.registerDataInput("animationGroup",e.d,null===S||void 0===S?void 0:S.animationGroup),this.animation=this.registerDataInput("animation",e.d),this.object=this.registerDataInput("object",e.d)}_preparePendingTasks(S){const v=this.animationGroup.getValue(S),D=this.animation.getValue(S);if(!v&&!D)return this._reportError(S,"No animation or animation group provided");{const e=this.currentAnimationGroup.getValue(S);e&&e!==v&&e.dispose();let N=v;if(D&&!N){const v=this.object.getValue(S);if(!v)return this._reportError(S,"No target object provided");const z=Array.isArray(D)?D:[D],e=z[0].name;N=new m.AnimationGroup("flowGraphAnimationGroup-"+e+"-"+v.name,S.configuration.Iv);let B=!1;const g=S._getGlobalContextVariable("interpolationAnimations",[]);for(const S of z)N.addTargetedAnimation(S,v),-1!==g.indexOf(S.uniqueId)&&(B=!0);B&&this._checkInterpolationDuplications(S,z,v)}const B=this.speed.getValue(S)||1,g=this.from.getValue(S)??0,E=this.to.getValue(S)||N.to,h=!isFinite(E)||this.loop.getValue(S);this.currentAnimationGroup.setValue(N,S);const A=S._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==A.indexOf(N.uniqueId)&&N.stop();try{N.start(h,B,g,E),N.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(S))),N.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(S))),N.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(S))),N.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(S))),A.push(N.uniqueId),S._setGlobalContextVariable("currentlyRunningAnimationGroups",A)}catch(z){this._reportError(S,z)}}}_reportError(S,v){super._reportError(S,v),this.currentFrame.setValue(-1,S),this.currentTime.setValue(-1,S)}_executeOnTick(S){const v=this.currentAnimationGroup.getValue(S);var D;v&&(this.currentFrame.setValue(v.getCurrentFrame(),S),this.currentTime.setValue((null===(D=v.animatables[0])||void 0===D?void 0:D.elapsedTime)??0,S))}_execute(S){this._startPendingTasks(S)}_onAnimationGroupEnd(S){this._removeFromCurrentlyRunning(S,this.currentAnimationGroup.getValue(S)),this._resetAfterCanceled(S),this.done._activateSignal(S)}_checkInterpolationDuplications(S,v,D){const z=S._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const e of z){const z=S.assetsContext.animationGroups.find((S=>S.uniqueId===e));if(z)for(const e of z.targetedAnimations)for(const N of v)e.animation.targetProperty===N.targetProperty&&e.target===D&&this._stopAnimationGroup(S,z)}}_stopAnimationGroup(S,v){v.stop(!0),v.dispose(),this._removeFromCurrentlyRunning(S,v)}_removeFromCurrentlyRunning(S,v){const D=S._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),z=D.indexOf(v.uniqueId);-1!==z&&(D.splice(z,1),S._setGlobalContextVariable("currentlyRunningAnimationGroups",D))}_cancelPendingTasks(S){const v=this.currentAnimationGroup.getValue(S);v&&this._stopAnimationGroup(S,v)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,N.f)("FlowGraphPlayAnimationBlock",B)}}]);