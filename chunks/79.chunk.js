"use strict";(self.bbj0x35f849=self.bbj0x35f849||[]).push([[79],{14266:(N,q,C)=>{C.r(q),C.d(q,{FlowGraphPlayAnimationBlock:()=>F});var d=C(12872),U=C(12831),W=C(11076),a=C(14264);class F extends d.e{constructor(N){super(N,["animationLoop","animationEnd","animationGroupLoop"]),this.config=N,this.speed=this.registerDataInput("speed",U.r),this.loop=this.registerDataInput("loop",U.e),this.from=this.registerDataInput("from",U.r,0),this.to=this.registerDataInput("to",U.r),this.currentFrame=this.registerDataOutput("currentFrame",U.r),this.currentTime=this.registerDataOutput("currentTime",U.r),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",U.b),this.animationGroup=this.registerDataInput("animationGroup",U.b,null===N||void 0===N?void 0:N.animationGroup),this.animation=this.registerDataInput("animation",U.b),this.object=this.registerDataInput("object",U.b)}_preparePendingTasks(N){const q=this.animationGroup.getValue(N),C=this.animation.getValue(N);if(!q&&!C)return this._reportError(N,"No animation or animation group provided");{const U=this.currentAnimationGroup.getValue(N);U&&U!==q&&U.dispose();let W=q;if(C&&!W){const q=this.object.getValue(N);if(!q)return this._reportError(N,"No target object provided");const d=Array.isArray(C)?C:[C],U=d[0].name;W=new a.AnimationGroup("flowGraphAnimationGroup-"+U+"-"+q.name,N.configuration.vq);let F=!1;const w=N._getGlobalContextVariable("interpolationAnimations",[]);for(const N of d)W.addTargetedAnimation(N,q),-1!==w.indexOf(N.uniqueId)&&(F=!0);F&&this._checkInterpolationDuplications(N,d,q)}const F=this.speed.getValue(N)||1,w=this.from.getValue(N)??0,A=this.to.getValue(N)||W.to,n=!isFinite(A)||this.loop.getValue(N);this.currentAnimationGroup.setValue(W,N);const t=N._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==t.indexOf(W.uniqueId)&&W.stop();try{W.start(n,F,w,A),W.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(N))),W.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(N))),W.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(N))),W.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(N))),t.push(W.uniqueId),N._setGlobalContextVariable("currentlyRunningAnimationGroups",t)}catch(d){this._reportError(N,d)}}}_reportError(N,q){super._reportError(N,q),this.currentFrame.setValue(-1,N),this.currentTime.setValue(-1,N)}_executeOnTick(N){const q=this.currentAnimationGroup.getValue(N);var C;q&&(this.currentFrame.setValue(q.getCurrentFrame(),N),this.currentTime.setValue((null===(C=q.animatables[0])||void 0===C?void 0:C.elapsedTime)??0,N))}_execute(N){this._startPendingTasks(N)}_onAnimationGroupEnd(N){this._removeFromCurrentlyRunning(N,this.currentAnimationGroup.getValue(N)),this._resetAfterCanceled(N),this.done._activateSignal(N)}_checkInterpolationDuplications(N,q,C){const d=N._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const U of d){const d=N.assetsContext.animationGroups.find((N=>N.uniqueId===U));if(d)for(const U of d.targetedAnimations)for(const W of q)U.animation.targetProperty===W.targetProperty&&U.target===C&&this._stopAnimationGroup(N,d)}}_stopAnimationGroup(N,q){q.stop(!0),q.dispose(),this._removeFromCurrentlyRunning(N,q)}_removeFromCurrentlyRunning(N,q){const C=N._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),d=C.indexOf(q.uniqueId);-1!==d&&(C.splice(d,1),N._setGlobalContextVariable("currentlyRunningAnimationGroups",C))}_cancelPendingTasks(N){const q=this.currentAnimationGroup.getValue(N);q&&this._stopAnimationGroup(N,q)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,W.h)("FlowGraphPlayAnimationBlock",F)}}]);