"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[79],{14884:(c,r,D)=>{D.r(r),D.d(r,{FlowGraphPlayAnimationBlock:()=>a});var W=D(13429),B=D(13392),t=D(11637),u=D(14880);class a extends W.e{constructor(c){super(c,["animationLoop","animationEnd","animationGroupLoop"]),this.config=c,this.speed=this.registerDataInput("speed",B.u),this.loop=this.registerDataInput("loop",B.e),this.from=this.registerDataInput("from",B.u,0),this.to=this.registerDataInput("to",B.u),this.currentFrame=this.registerDataOutput("currentFrame",B.u),this.currentTime=this.registerDataOutput("currentTime",B.u),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",B.c),this.animationGroup=this.registerDataInput("animationGroup",B.c,null===c||void 0===c?void 0:c.animationGroup),this.animation=this.registerDataInput("animation",B.c),this.object=this.registerDataInput("object",B.c)}_preparePendingTasks(c){const r=this.animationGroup.getValue(c),D=this.animation.getValue(c);if(!r&&!D)return this._reportError(c,"No animation or animation group provided");{const B=this.currentAnimationGroup.getValue(c);B&&B!==r&&B.dispose();let t=r;if(D&&!t){const r=this.object.getValue(c);if(!r)return this._reportError(c,"No target object provided");const W=Array.isArray(D)?D:[D],B=W[0].name;t=new u.AnimationGroup("flowGraphAnimationGroup-"+B+"-"+r.name,c.configuration.qr);let a=!1;const H=c._getGlobalContextVariable("interpolationAnimations",[]);for(const c of W)t.addTargetedAnimation(c,r),-1!==H.indexOf(c.uniqueId)&&(a=!0);a&&this._checkInterpolationDuplications(c,W,r)}const a=this.speed.getValue(c)||1,H=this.from.getValue(c)??0,x=this.to.getValue(c)||t.to,M=!isFinite(x)||this.loop.getValue(c);this.currentAnimationGroup.setValue(t,c);const E=c._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==E.indexOf(t.uniqueId)&&t.stop();try{t.start(M,a,H,x),t.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(c))),t.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(c))),t.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(c))),t.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(c))),E.push(t.uniqueId),c._setGlobalContextVariable("currentlyRunningAnimationGroups",E)}catch(W){this._reportError(c,W)}}}_reportError(c,r){super._reportError(c,r),this.currentFrame.setValue(-1,c),this.currentTime.setValue(-1,c)}_executeOnTick(c){const r=this.currentAnimationGroup.getValue(c);var D;r&&(this.currentFrame.setValue(r.getCurrentFrame(),c),this.currentTime.setValue((null===(D=r.animatables[0])||void 0===D?void 0:D.elapsedTime)??0,c))}_execute(c){this._startPendingTasks(c)}_onAnimationGroupEnd(c){this._removeFromCurrentlyRunning(c,this.currentAnimationGroup.getValue(c)),this._resetAfterCanceled(c),this.done._activateSignal(c)}_checkInterpolationDuplications(c,r,D){const W=c._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const B of W){const W=c.assetsContext.animationGroups.find((c=>c.uniqueId===B));if(W)for(const B of W.targetedAnimations)for(const t of r)B.animation.targetProperty===t.targetProperty&&B.target===D&&this._stopAnimationGroup(c,W)}}_stopAnimationGroup(c,r){r.stop(!0),r.dispose(),this._removeFromCurrentlyRunning(c,r)}_removeFromCurrentlyRunning(c,r){const D=c._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),W=D.indexOf(r.uniqueId);-1!==W&&(D.splice(W,1),c._setGlobalContextVariable("currentlyRunningAnimationGroups",D))}_cancelPendingTasks(c){const r=this.currentAnimationGroup.getValue(c);r&&this._stopAnimationGroup(c,r)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,t.e)("FlowGraphPlayAnimationBlock",a)}}]);