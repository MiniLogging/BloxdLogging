"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[79],{15659:(z,u,U)=>{U.r(u),U.d(u,{FlowGraphPlayAnimationBlock:()=>w});var J=U(14245),v=U(14196),f=U(12875),g=U(15654);class w extends J.e{constructor(z){super(z,["animationLoop","animationEnd","animationGroupLoop"]),this.config=z,this.speed=this.registerDataInput("speed",v.x),this.loop=this.registerDataInput("loop",v.h),this.from=this.registerDataInput("from",v.x,0),this.to=this.registerDataInput("to",v.x),this.currentFrame=this.registerDataOutput("currentFrame",v.x),this.currentTime=this.registerDataOutput("currentTime",v.x),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",v.e),this.animationGroup=this.registerDataInput("animationGroup",v.e,null===z||void 0===z?void 0:z.animationGroup),this.animation=this.registerDataInput("animation",v.e),this.object=this.registerDataInput("object",v.e)}_preparePendingTasks(z){const u=this.animationGroup.getValue(z),U=this.animation.getValue(z);if(!u&&!U)return this._reportError(z,"No animation or animation group provided");{var J;const f=this.currentAnimationGroup.getValue(z);f&&f!==u&&f.dispose();let w=u;if(U&&!w){const u=this.object.getValue(z);if(!u)return this._reportError(z,"No target object provided");const J=Array.isArray(U)?U:[U],v=J[0].name;w=new g.AnimationGroup("flowGraphAnimationGroup-"+v+"-"+u.name,z.configuration.ru);let f=!1;const P=z._getGlobalContextVariable("interpolationAnimations",[]);for(const z of J)w.addTargetedAnimation(z,u),-1!==P.indexOf(z.uniqueId)&&(f=!0);f&&this._checkInterpolationDuplications(z,J,u)}const P=this.speed.getValue(z)||1,R=null!==(J=this.from.getValue(z))&&void 0!==J?J:0,S=this.to.getValue(z)||w.to,d=!isFinite(S)||this.loop.getValue(z);this.currentAnimationGroup.setValue(w,z);const mz=z._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==mz.indexOf(w.uniqueId)&&w.stop();try{w.start(d,P,R,S),w.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(z))),w.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(z))),w.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(z))),w.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(z))),mz.push(w.uniqueId),z._setGlobalContextVariable("currentlyRunningAnimationGroups",mz)}catch(v){this._reportError(z,v)}}}_reportError(z,u){super._reportError(z,u),this.currentFrame.setValue(-1,z),this.currentTime.setValue(-1,z)}_executeOnTick(z){const u=this.currentAnimationGroup.getValue(z);var U,J;u&&(this.currentFrame.setValue(u.getCurrentFrame(),z),this.currentTime.setValue(null!==(U=null===(J=u.animatables[0])||void 0===J?void 0:J.elapsedTime)&&void 0!==U?U:0,z))}_execute(z){this._startPendingTasks(z)}_onAnimationGroupEnd(z){this._removeFromCurrentlyRunning(z,this.currentAnimationGroup.getValue(z)),this._resetAfterCanceled(z),this.done._activateSignal(z)}_checkInterpolationDuplications(z,u,U){const J=z._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const v of J){const J=z.assetsContext.animationGroups.find((z=>z.uniqueId===v));if(J)for(const v of J.targetedAnimations)for(const f of u)v.animation.targetProperty===f.targetProperty&&v.target===U&&this._stopAnimationGroup(z,J)}}_stopAnimationGroup(z,u){u.stop(!0),u.dispose(),this._removeFromCurrentlyRunning(z,u)}_removeFromCurrentlyRunning(z,u){const U=z._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),J=U.indexOf(u.uniqueId);-1!==J&&(U.splice(J,1),z._setGlobalContextVariable("currentlyRunningAnimationGroups",U))}_cancelPendingTasks(z){const u=this.currentAnimationGroup.getValue(z);u&&this._stopAnimationGroup(z,u)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,f.f)("FlowGraphPlayAnimationBlock",w)}}]);