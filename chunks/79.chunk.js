"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[79],{15957:(a,c,o)=>{o.r(c),o.d(c,{FlowGraphPlayAnimationBlock:()=>p});var s=o(14439),q=o(14394),t=o(12776),i=o(15949);class p extends s.e{constructor(a){super(a,["animationLoop","animationEnd","animationGroupLoop"]),this.config=a,this.speed=this.registerDataInput("speed",q.o),this.loop=this.registerDataInput("loop",q.f),this.from=this.registerDataInput("from",q.o,0),this.to=this.registerDataInput("to",q.o),this.currentFrame=this.registerDataOutput("currentFrame",q.o),this.currentTime=this.registerDataOutput("currentTime",q.o),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",q.c),this.animationGroup=this.registerDataInput("animationGroup",q.c,null===a||void 0===a?void 0:a.animationGroup),this.animation=this.registerDataInput("animation",q.c),this.object=this.registerDataInput("object",q.c)}_preparePendingTasks(a){const c=this.animationGroup.getValue(a),o=this.animation.getValue(a);if(!c&&!o)return this._reportError(a,"No animation or animation group provided");{const q=this.currentAnimationGroup.getValue(a);q&&q!==c&&q.dispose();let t=c;if(o&&!t){const c=this.object.getValue(a);if(!c)return this._reportError(a,"No target object provided");const s=Array.isArray(o)?o:[o],q=s[0].name;t=new i.AnimationGroup("flowGraphAnimationGroup-"+q+"-"+c.name,a.configuration.ao);let p=!1;const G=a._getGlobalContextVariable("interpolationAnimations",[]);for(const a of s)t.addTargetedAnimation(a,c),-1!==G.indexOf(a.uniqueId)&&(p=!0);p&&this._checkInterpolationDuplications(a,s,c)}const p=this.speed.getValue(a)||1,G=this.from.getValue(a)??0,T=this.to.getValue(a)||t.to,C=!isFinite(T)||this.loop.getValue(a);this.currentAnimationGroup.setValue(t,a);const j=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==j.indexOf(t.uniqueId)&&t.stop();try{t.start(C,p,G,T),t.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(a))),t.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(a))),t.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(a))),t.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(a))),j.push(t.uniqueId),a._setGlobalContextVariable("currentlyRunningAnimationGroups",j)}catch(s){this._reportError(a,s)}}}_reportError(a,c){super._reportError(a,c),this.currentFrame.setValue(-1,a),this.currentTime.setValue(-1,a)}_executeOnTick(a){const c=this.currentAnimationGroup.getValue(a);var o;c&&(this.currentFrame.setValue(c.getCurrentFrame(),a),this.currentTime.setValue((null===(o=c.animatables[0])||void 0===o?void 0:o.elapsedTime)??0,a))}_execute(a){this._startPendingTasks(a)}_onAnimationGroupEnd(a){this._removeFromCurrentlyRunning(a,this.currentAnimationGroup.getValue(a)),this._resetAfterCanceled(a),this.done._activateSignal(a)}_checkInterpolationDuplications(a,c,o){const s=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const q of s){const s=a.assetsContext.animationGroups.find((a=>a.uniqueId===q));if(s)for(const q of s.targetedAnimations)for(const t of c)q.animation.targetProperty===t.targetProperty&&q.target===o&&this._stopAnimationGroup(a,s)}}_stopAnimationGroup(a,c){c.stop(!0),c.dispose(),this._removeFromCurrentlyRunning(a,c)}_removeFromCurrentlyRunning(a,c){const o=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),s=o.indexOf(c.uniqueId);-1!==s&&(o.splice(s,1),a._setGlobalContextVariable("currentlyRunningAnimationGroups",o))}_cancelPendingTasks(a){const c=this.currentAnimationGroup.getValue(a);c&&this._stopAnimationGroup(a,c)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,t.d)("FlowGraphPlayAnimationBlock",p)}}]);