"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[79],{14990:(w,o,H)=>{H.r(o),H.d(o,{FlowGraphPlayAnimationBlock:()=>t});var h=H(13500),E=H(13455),e=H(11666),D=H(14986);class t extends h.d{constructor(w){super(w,["animationLoop","animationEnd","animationGroupLoop"]),this.config=w,this.speed=this.registerDataInput("speed",E.p),this.loop=this.registerDataInput("loop",E.f),this.from=this.registerDataInput("from",E.p,0),this.to=this.registerDataInput("to",E.p),this.currentFrame=this.registerDataOutput("currentFrame",E.p),this.currentTime=this.registerDataOutput("currentTime",E.p),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",E.e),this.animationGroup=this.registerDataInput("animationGroup",E.e,null===w||void 0===w?void 0:w.animationGroup),this.animation=this.registerDataInput("animation",E.e),this.object=this.registerDataInput("object",E.e)}_preparePendingTasks(w){const o=this.animationGroup.getValue(w),H=this.animation.getValue(w);if(!o&&!H)return this._reportError(w,"No animation or animation group provided");{const E=this.currentAnimationGroup.getValue(w);E&&E!==o&&E.dispose();let e=o;if(H&&!e){const o=this.object.getValue(w);if(!o)return this._reportError(w,"No target object provided");const h=Array.isArray(H)?H:[H],E=h[0].name;e=new D.AnimationGroup("flowGraphAnimationGroup-"+E+"-"+o.name,w.configuration.Vo);let t=!1;const X=w._getGlobalContextVariable("interpolationAnimations",[]);for(const w of h)e.addTargetedAnimation(w,o),-1!==X.indexOf(w.uniqueId)&&(t=!0);t&&this._checkInterpolationDuplications(w,h,o)}const t=this.speed.getValue(w)||1,X=this.from.getValue(w)??0,L=this.to.getValue(w)||e.to,A=!isFinite(L)||this.loop.getValue(w);this.currentAnimationGroup.setValue(e,w);const y=w._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==y.indexOf(e.uniqueId)&&e.stop();try{e.start(A,t,X,L),e.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(w))),e.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(w))),e.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(w))),e.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(w))),y.push(e.uniqueId),w._setGlobalContextVariable("currentlyRunningAnimationGroups",y)}catch(h){this._reportError(w,h)}}}_reportError(w,o){super._reportError(w,o),this.currentFrame.setValue(-1,w),this.currentTime.setValue(-1,w)}_executeOnTick(w){const o=this.currentAnimationGroup.getValue(w);var H;o&&(this.currentFrame.setValue(o.getCurrentFrame(),w),this.currentTime.setValue((null===(H=o.animatables[0])||void 0===H?void 0:H.elapsedTime)??0,w))}_execute(w){this._startPendingTasks(w)}_onAnimationGroupEnd(w){this._removeFromCurrentlyRunning(w,this.currentAnimationGroup.getValue(w)),this._resetAfterCanceled(w),this.done._activateSignal(w)}_checkInterpolationDuplications(w,o,H){const h=w._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const E of h){const h=w.assetsContext.animationGroups.find((w=>w.uniqueId===E));if(h)for(const E of h.targetedAnimations)for(const e of o)E.animation.targetProperty===e.targetProperty&&E.target===H&&this._stopAnimationGroup(w,h)}}_stopAnimationGroup(w,o){o.stop(!0),o.dispose(),this._removeFromCurrentlyRunning(w,o)}_removeFromCurrentlyRunning(w,o){const H=w._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),h=H.indexOf(o.uniqueId);-1!==h&&(H.splice(h,1),w._setGlobalContextVariable("currentlyRunningAnimationGroups",H))}_cancelPendingTasks(w){const o=this.currentAnimationGroup.getValue(w);o&&this._stopAnimationGroup(w,o)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,e.g)("FlowGraphPlayAnimationBlock",t)}}]);