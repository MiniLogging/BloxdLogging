"use strict";(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[79],{14292:(I,E,j)=>{j.r(E),j.d(E,{FlowGraphPlayAnimationBlock:()=>t});var e=j(12852),w=j(12819),z=j(11073),h=j(14289);class t extends e.c{constructor(I){super(I,["animationLoop","animationEnd","animationGroupLoop"]),this.config=I,this.speed=this.registerDataInput("speed",w.t),this.loop=this.registerDataInput("loop",w.g),this.from=this.registerDataInput("from",w.t,0),this.to=this.registerDataInput("to",w.t),this.currentFrame=this.registerDataOutput("currentFrame",w.t),this.currentTime=this.registerDataOutput("currentTime",w.t),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",w.e),this.animationGroup=this.registerDataInput("animationGroup",w.e,null===I||void 0===I?void 0:I.animationGroup),this.animation=this.registerDataInput("animation",w.e),this.object=this.registerDataInput("object",w.e)}_preparePendingTasks(I){const E=this.animationGroup.getValue(I),j=this.animation.getValue(I);if(!E&&!j)return this._reportError(I,"No animation or animation group provided");{const w=this.currentAnimationGroup.getValue(I);w&&w!==E&&w.dispose();let z=E;if(j&&!z){const E=this.object.getValue(I);if(!E)return this._reportError(I,"No target object provided");const e=Array.isArray(j)?j:[j],w=e[0].name;z=new h.AnimationGroup("flowGraphAnimationGroup-"+w+"-"+E.name,I.configuration.CE);let t=!1;const U=I._getGlobalContextVariable("interpolationAnimations",[]);for(const I of e)z.addTargetedAnimation(I,E),-1!==U.indexOf(I.uniqueId)&&(t=!0);t&&this._checkInterpolationDuplications(I,e,E)}const t=this.speed.getValue(I)||1,U=this.from.getValue(I)??0,R=this.to.getValue(I)||z.to,P=!isFinite(R)||this.loop.getValue(I);this.currentAnimationGroup.setValue(z,I);const o=I._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==o.indexOf(z.uniqueId)&&z.stop();try{z.start(P,t,U,R),z.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(I))),z.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(I))),z.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(I))),z.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(I))),o.push(z.uniqueId),I._setGlobalContextVariable("currentlyRunningAnimationGroups",o)}catch(e){this._reportError(I,e)}}}_reportError(I,E){super._reportError(I,E),this.currentFrame.setValue(-1,I),this.currentTime.setValue(-1,I)}_executeOnTick(I){const E=this.currentAnimationGroup.getValue(I);var j;E&&(this.currentFrame.setValue(E.getCurrentFrame(),I),this.currentTime.setValue((null===(j=E.animatables[0])||void 0===j?void 0:j.elapsedTime)??0,I))}_execute(I){this._startPendingTasks(I)}_onAnimationGroupEnd(I){this._removeFromCurrentlyRunning(I,this.currentAnimationGroup.getValue(I)),this._resetAfterCanceled(I),this.done._activateSignal(I)}_checkInterpolationDuplications(I,E,j){const e=I._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const w of e){const e=I.assetsContext.animationGroups.find((I=>I.uniqueId===w));if(e)for(const w of e.targetedAnimations)for(const z of E)w.animation.targetProperty===z.targetProperty&&w.target===j&&this._stopAnimationGroup(I,e)}}_stopAnimationGroup(I,E){E.stop(!0),E.dispose(),this._removeFromCurrentlyRunning(I,E)}_removeFromCurrentlyRunning(I,E){const j=I._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),e=j.indexOf(E.uniqueId);-1!==e&&(j.splice(e,1),I._setGlobalContextVariable("currentlyRunningAnimationGroups",j))}_cancelPendingTasks(I){const E=this.currentAnimationGroup.getValue(I);E&&this._stopAnimationGroup(I,E)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,z.h)("FlowGraphPlayAnimationBlock",t)}}]);