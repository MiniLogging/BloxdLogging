"use strict";(self.ozi0exxand9=self.ozi0exxand9||[]).push([[79],{14521:(f,v,Z)=>{Z.r(v),Z.d(v,{FlowGraphPlayAnimationBlock:()=>e});var V=Z(13169),h=Z(13123),J=Z(11372),l=Z(14513);class e extends V.e{constructor(f){super(f,["animationLoop","animationEnd","animationGroupLoop"]),this.config=f,this.speed=this.registerDataInput("speed",h.v),this.loop=this.registerDataInput("loop",h.g),this.from=this.registerDataInput("from",h.v,0),this.to=this.registerDataInput("to",h.v),this.currentFrame=this.registerDataOutput("currentFrame",h.v),this.currentTime=this.registerDataOutput("currentTime",h.v),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",h.d),this.animationGroup=this.registerDataInput("animationGroup",h.d,null===f||void 0===f?void 0:f.animationGroup),this.animation=this.registerDataInput("animation",h.d),this.object=this.registerDataInput("object",h.d)}_preparePendingTasks(f){const v=this.animationGroup.getValue(f),Z=this.animation.getValue(f);if(!v&&!Z)return this._reportError(f,"No animation or animation group provided");{const h=this.currentAnimationGroup.getValue(f);h&&h!==v&&h.dispose();let J=v;if(Z&&!J){const v=this.object.getValue(f);if(!v)return this._reportError(f,"No target object provided");const V=Array.isArray(Z)?Z:[Z],h=V[0].name;J=new l.AnimationGroup("flowGraphAnimationGroup-"+h+"-"+v.name,f.configuration.Uv);let e=!1;const C=f._getGlobalContextVariable("interpolationAnimations",[]);for(const f of V)J.addTargetedAnimation(f,v),-1!==C.indexOf(f.uniqueId)&&(e=!0);e&&this._checkInterpolationDuplications(f,V,v)}const e=this.speed.getValue(f)||1,C=this.from.getValue(f)??0,H=this.to.getValue(f)||J.to,O=!isFinite(H)||this.loop.getValue(f);this.currentAnimationGroup.setValue(J,f);const u=f._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==u.indexOf(J.uniqueId)&&J.stop();try{J.start(O,e,C,H),J.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(f))),J.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(f))),J.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(f))),J.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(f))),u.push(J.uniqueId),f._setGlobalContextVariable("currentlyRunningAnimationGroups",u)}catch(V){this._reportError(f,V)}}}_reportError(f,v){super._reportError(f,v),this.currentFrame.setValue(-1,f),this.currentTime.setValue(-1,f)}_executeOnTick(f){const v=this.currentAnimationGroup.getValue(f);var Z;v&&(this.currentFrame.setValue(v.getCurrentFrame(),f),this.currentTime.setValue((null===(Z=v.animatables[0])||void 0===Z?void 0:Z.elapsedTime)??0,f))}_execute(f){this._startPendingTasks(f)}_onAnimationGroupEnd(f){this._removeFromCurrentlyRunning(f,this.currentAnimationGroup.getValue(f)),this._resetAfterCanceled(f),this.done._activateSignal(f)}_checkInterpolationDuplications(f,v,Z){const V=f._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const h of V){const V=f.assetsContext.animationGroups.find((f=>f.uniqueId===h));if(V)for(const h of V.targetedAnimations)for(const J of v)h.animation.targetProperty===J.targetProperty&&h.target===Z&&this._stopAnimationGroup(f,V)}}_stopAnimationGroup(f,v){v.stop(!0),v.dispose(),this._removeFromCurrentlyRunning(f,v)}_removeFromCurrentlyRunning(f,v){const Z=f._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),V=Z.indexOf(v.uniqueId);-1!==V&&(Z.splice(V,1),f._setGlobalContextVariable("currentlyRunningAnimationGroups",Z))}_cancelPendingTasks(f){const v=this.currentAnimationGroup.getValue(f);v&&this._stopAnimationGroup(f,v)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,J.h)("FlowGraphPlayAnimationBlock",e)}}]);