"use strict";(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[79],{16155:(Y,c,h)=>{h.r(c),h.d(c,{FlowGraphPlayAnimationBlock:()=>b});var C=h(14499),E=h(14459),N=h(12825),Q=h(16150);class b extends C.d{constructor(Y){super(Y,["animationLoop","animationEnd","animationGroupLoop"]),this.config=Y,this.speed=this.registerDataInput("speed",E.n),this.loop=this.registerDataInput("loop",E.d),this.from=this.registerDataInput("from",E.n,0),this.to=this.registerDataInput("to",E.n),this.currentFrame=this.registerDataOutput("currentFrame",E.n),this.currentTime=this.registerDataOutput("currentTime",E.n),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",E.c),this.animationGroup=this.registerDataInput("animationGroup",E.c,null===Y||void 0===Y?void 0:Y.animationGroup),this.animation=this.registerDataInput("animation",E.c),this.object=this.registerDataInput("object",E.c)}_preparePendingTasks(Y){const c=this.animationGroup.getValue(Y),h=this.animation.getValue(Y);if(!c&&!h)return this._reportError(Y,"No animation or animation group provided");{const E=this.currentAnimationGroup.getValue(Y);E&&E!==c&&E.dispose();let N=c;if(h&&!N){const c=this.object.getValue(Y);if(!c)return this._reportError(Y,"No target object provided");const C=Array.isArray(h)?h:[h],E=C[0].name;N=new Q.AnimationGroup("flowGraphAnimationGroup-"+E+"-"+c.name,Y.configuration.wh);let b=!1;const H=Y._getGlobalContextVariable("interpolationAnimations",[]);for(const Y of C)N.addTargetedAnimation(Y,c),-1!==H.indexOf(Y.uniqueId)&&(b=!0);b&&this._checkInterpolationDuplications(Y,C,c)}const b=this.speed.getValue(Y)||1,H=this.from.getValue(Y)??0,w=this.to.getValue(Y)||N.to,W=!isFinite(w)||this.loop.getValue(Y);this.currentAnimationGroup.setValue(N,Y);const q=Y._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==q.indexOf(N.uniqueId)&&N.stop();try{N.start(W,b,H,w),N.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(Y))),N.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(Y))),N.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(Y))),N.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(Y))),q.push(N.uniqueId),Y._setGlobalContextVariable("currentlyRunningAnimationGroups",q)}catch(C){this._reportError(Y,C)}}}_reportError(Y,c){super._reportError(Y,c),this.currentFrame.setValue(-1,Y),this.currentTime.setValue(-1,Y)}_executeOnTick(Y){const c=this.currentAnimationGroup.getValue(Y);var h;c&&(this.currentFrame.setValue(c.getCurrentFrame(),Y),this.currentTime.setValue((null===(h=c.animatables[0])||void 0===h?void 0:h.elapsedTime)??0,Y))}_execute(Y){this._startPendingTasks(Y)}_onAnimationGroupEnd(Y){this._removeFromCurrentlyRunning(Y,this.currentAnimationGroup.getValue(Y)),this._resetAfterCanceled(Y),this.done._activateSignal(Y)}_checkInterpolationDuplications(Y,c,h){const C=Y._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const E of C){const C=Y.assetsContext.animationGroups.find((Y=>Y.uniqueId===E));if(C)for(const E of C.targetedAnimations)for(const N of c)E.animation.targetProperty===N.targetProperty&&E.target===h&&this._stopAnimationGroup(Y,C)}}_stopAnimationGroup(Y,c){c.stop(!0),c.dispose(),this._removeFromCurrentlyRunning(Y,c)}_removeFromCurrentlyRunning(Y,c){const h=Y._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),C=h.indexOf(c.uniqueId);-1!==C&&(h.splice(C,1),Y._setGlobalContextVariable("currentlyRunningAnimationGroups",h))}_cancelPendingTasks(Y){const c=this.currentAnimationGroup.getValue(Y);c&&this._stopAnimationGroup(Y,c)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,N.e)("FlowGraphPlayAnimationBlock",b)}}]);