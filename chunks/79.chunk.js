"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[79],{15936:(q,I,l)=>{l.r(I),l.d(I,{FlowGraphPlayAnimationBlock:()=>a});var w=l(14486),t=l(14441),O=l(12711),c=l(15931);class a extends w.c{constructor(q){super(q,["animationLoop","animationEnd","animationGroupLoop"]),this.config=q,this.speed=this.registerDataInput("speed",t.v),this.loop=this.registerDataInput("loop",t.g),this.from=this.registerDataInput("from",t.v,0),this.to=this.registerDataInput("to",t.v),this.currentFrame=this.registerDataOutput("currentFrame",t.v),this.currentTime=this.registerDataOutput("currentTime",t.v),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",t.e),this.animationGroup=this.registerDataInput("animationGroup",t.e,null===q||void 0===q?void 0:q.animationGroup),this.animation=this.registerDataInput("animation",t.e),this.object=this.registerDataInput("object",t.e)}_preparePendingTasks(q){const I=this.animationGroup.getValue(q),l=this.animation.getValue(q);if(!I&&!l)return this._reportError(q,"No animation or animation group provided");{const t=this.currentAnimationGroup.getValue(q);t&&t!==I&&t.dispose();let O=I;if(l&&!O){const I=this.object.getValue(q);if(!I)return this._reportError(q,"No target object provided");const w=Array.isArray(l)?l:[l],t=w[0].name;O=new c.AnimationGroup("flowGraphAnimationGroup-"+t+"-"+I.name,q.configuration.VI);let a=!1;const F=q._getGlobalContextVariable("interpolationAnimations",[]);for(const q of w)O.addTargetedAnimation(q,I),-1!==F.indexOf(q.uniqueId)&&(a=!0);a&&this._checkInterpolationDuplications(q,w,I)}const a=this.speed.getValue(q)||1,F=this.from.getValue(q)??0,s=this.to.getValue(q)||O.to,Z=!isFinite(s)||this.loop.getValue(q);this.currentAnimationGroup.setValue(O,q);const r=q._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==r.indexOf(O.uniqueId)&&O.stop();try{O.start(Z,a,F,s),O.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(q))),O.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(q))),O.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(q))),O.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(q))),r.push(O.uniqueId),q._setGlobalContextVariable("currentlyRunningAnimationGroups",r)}catch(w){this._reportError(q,w)}}}_reportError(q,I){super._reportError(q,I),this.currentFrame.setValue(-1,q),this.currentTime.setValue(-1,q)}_executeOnTick(q){const I=this.currentAnimationGroup.getValue(q);var l;I&&(this.currentFrame.setValue(I.getCurrentFrame(),q),this.currentTime.setValue((null===(l=I.animatables[0])||void 0===l?void 0:l.elapsedTime)??0,q))}_execute(q){this._startPendingTasks(q)}_onAnimationGroupEnd(q){this._removeFromCurrentlyRunning(q,this.currentAnimationGroup.getValue(q)),this._resetAfterCanceled(q),this.done._activateSignal(q)}_checkInterpolationDuplications(q,I,l){const w=q._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const t of w){const w=q.assetsContext.animationGroups.find((q=>q.uniqueId===t));if(w)for(const t of w.targetedAnimations)for(const O of I)t.animation.targetProperty===O.targetProperty&&t.target===l&&this._stopAnimationGroup(q,w)}}_stopAnimationGroup(q,I){I.stop(!0),I.dispose(),this._removeFromCurrentlyRunning(q,I)}_removeFromCurrentlyRunning(q,I){const l=q._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),w=l.indexOf(I.uniqueId);-1!==w&&(l.splice(w,1),q._setGlobalContextVariable("currentlyRunningAnimationGroups",l))}_cancelPendingTasks(q){const I=this.currentAnimationGroup.getValue(q);I&&this._stopAnimationGroup(q,I)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,O.e)("FlowGraphPlayAnimationBlock",a)}}]);