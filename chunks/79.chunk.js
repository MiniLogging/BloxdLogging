"use strict";(self.uw9p3pwwsje=self.uw9p3pwwsje||[]).push([[79],{15841:(D,h,o)=>{o.r(h),o.d(h,{FlowGraphPlayAnimationBlock:()=>R});var H=o(14410),g=o(14362),j=o(12793),M=o(15837);class R extends H.c{constructor(D){super(D,["animationLoop","animationEnd","animationGroupLoop"]),this.config=D,this.speed=this.registerDataInput("speed",g.q),this.loop=this.registerDataInput("loop",g.f),this.from=this.registerDataInput("from",g.q,0),this.to=this.registerDataInput("to",g.q),this.currentFrame=this.registerDataOutput("currentFrame",g.q),this.currentTime=this.registerDataOutput("currentTime",g.q),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",g.c),this.animationGroup=this.registerDataInput("animationGroup",g.c,null===D||void 0===D?void 0:D.animationGroup),this.animation=this.registerDataInput("animation",g.c),this.object=this.registerDataInput("object",g.c)}_preparePendingTasks(D){const h=this.animationGroup.getValue(D),o=this.animation.getValue(D);if(!h&&!o)return this._reportError(D,"No animation or animation group provided");{const g=this.currentAnimationGroup.getValue(D);g&&g!==h&&g.dispose();let j=h;if(o&&!j){const h=this.object.getValue(D);if(!h)return this._reportError(D,"No target object provided");const H=Array.isArray(o)?o:[o],g=H[0].name;j=new M.AnimationGroup("flowGraphAnimationGroup-"+g+"-"+h.name,D.configuration.Th);let R=!1;const t=D._getGlobalContextVariable("interpolationAnimations",[]);for(const D of H)j.addTargetedAnimation(D,h),-1!==t.indexOf(D.uniqueId)&&(R=!0);R&&this._checkInterpolationDuplications(D,H,h)}const R=this.speed.getValue(D)||1,t=this.from.getValue(D)??0,S=this.to.getValue(D)||j.to,k=!isFinite(S)||this.loop.getValue(D);this.currentAnimationGroup.setValue(j,D);const K=D._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==K.indexOf(j.uniqueId)&&j.stop();try{j.start(k,R,t,S),j.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(D))),j.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(D))),j.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(D))),j.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(D))),K.push(j.uniqueId),D._setGlobalContextVariable("currentlyRunningAnimationGroups",K)}catch(H){this._reportError(D,H)}}}_reportError(D,h){super._reportError(D,h),this.currentFrame.setValue(-1,D),this.currentTime.setValue(-1,D)}_executeOnTick(D){const h=this.currentAnimationGroup.getValue(D);var o;h&&(this.currentFrame.setValue(h.getCurrentFrame(),D),this.currentTime.setValue((null===(o=h.animatables[0])||void 0===o?void 0:o.elapsedTime)??0,D))}_execute(D){this._startPendingTasks(D)}_onAnimationGroupEnd(D){this._removeFromCurrentlyRunning(D,this.currentAnimationGroup.getValue(D)),this._resetAfterCanceled(D),this.done._activateSignal(D)}_checkInterpolationDuplications(D,h,o){const H=D._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const g of H){const H=D.assetsContext.animationGroups.find((D=>D.uniqueId===g));if(H)for(const g of H.targetedAnimations)for(const j of h)g.animation.targetProperty===j.targetProperty&&g.target===o&&this._stopAnimationGroup(D,H)}}_stopAnimationGroup(D,h){h.stop(!0),h.dispose(),this._removeFromCurrentlyRunning(D,h)}_removeFromCurrentlyRunning(D,h){const o=D._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),H=o.indexOf(h.uniqueId);-1!==H&&(o.splice(H,1),D._setGlobalContextVariable("currentlyRunningAnimationGroups",o))}_cancelPendingTasks(D){const h=this.currentAnimationGroup.getValue(D);h&&this._stopAnimationGroup(D,h)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,j.g)("FlowGraphPlayAnimationBlock",R)}}]);