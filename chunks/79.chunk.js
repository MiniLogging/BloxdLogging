"use strict";(self.wj3aziuz228=self.wj3aziuz228||[]).push([[79],{15631:(u,R,I)=>{I.r(R),I.d(R,{FlowGraphPlayAnimationBlock:()=>D});var B=I(14209),U=I(14160),K=I(12433),C=I(15629);class D extends B.b{constructor(u){super(u,["animationLoop","animationEnd","animationGroupLoop"]),this.config=u,this.speed=this.registerDataInput("speed",U.u),this.loop=this.registerDataInput("loop",U.g),this.from=this.registerDataInput("from",U.u,0),this.to=this.registerDataInput("to",U.u),this.currentFrame=this.registerDataOutput("currentFrame",U.u),this.currentTime=this.registerDataOutput("currentTime",U.u),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",U.c),this.animationGroup=this.registerDataInput("animationGroup",U.c,null===u||void 0===u?void 0:u.animationGroup),this.animation=this.registerDataInput("animation",U.c),this.object=this.registerDataInput("object",U.c)}_preparePendingTasks(u){const R=this.animationGroup.getValue(u),I=this.animation.getValue(u);if(!R&&!I)return this._reportError(u,"No animation or animation group provided");{const U=this.currentAnimationGroup.getValue(u);U&&U!==R&&U.dispose();let K=R;if(I&&!K){const R=this.object.getValue(u);if(!R)return this._reportError(u,"No target object provided");const B=Array.isArray(I)?I:[I],U=B[0].name;K=new C.AnimationGroup("flowGraphAnimationGroup-"+U+"-"+R.name,u.configuration.ER);let D=!1;const s=u._getGlobalContextVariable("interpolationAnimations",[]);for(const u of B)K.addTargetedAnimation(u,R),-1!==s.indexOf(u.uniqueId)&&(D=!0);D&&this._checkInterpolationDuplications(u,B,R)}const D=this.speed.getValue(u)||1,s=this.from.getValue(u)??0,t=this.to.getValue(u)||K.to,G=!isFinite(t)||this.loop.getValue(u);this.currentAnimationGroup.setValue(K,u);const S=u._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==S.indexOf(K.uniqueId)&&K.stop();try{K.start(G,D,s,t),K.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(u))),K.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(u))),K.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(u))),K.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(u))),S.push(K.uniqueId),u._setGlobalContextVariable("currentlyRunningAnimationGroups",S)}catch(B){this._reportError(u,B)}}}_reportError(u,R){super._reportError(u,R),this.currentFrame.setValue(-1,u),this.currentTime.setValue(-1,u)}_executeOnTick(u){const R=this.currentAnimationGroup.getValue(u);var I;R&&(this.currentFrame.setValue(R.getCurrentFrame(),u),this.currentTime.setValue((null===(I=R.animatables[0])||void 0===I?void 0:I.elapsedTime)??0,u))}_execute(u){this._startPendingTasks(u)}_onAnimationGroupEnd(u){this._removeFromCurrentlyRunning(u,this.currentAnimationGroup.getValue(u)),this._resetAfterCanceled(u),this.done._activateSignal(u)}_checkInterpolationDuplications(u,R,I){const B=u._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const U of B){const B=u.assetsContext.animationGroups.find((u=>u.uniqueId===U));if(B)for(const U of B.targetedAnimations)for(const K of R)U.animation.targetProperty===K.targetProperty&&U.target===I&&this._stopAnimationGroup(u,B)}}_stopAnimationGroup(u,R){R.stop(!0),R.dispose(),this._removeFromCurrentlyRunning(u,R)}_removeFromCurrentlyRunning(u,R){const I=u._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),B=I.indexOf(R.uniqueId);-1!==B&&(I.splice(B,1),u._setGlobalContextVariable("currentlyRunningAnimationGroups",I))}_cancelPendingTasks(u){const R=this.currentAnimationGroup.getValue(u);R&&this._stopAnimationGroup(u,R)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,K.e)("FlowGraphPlayAnimationBlock",D)}}]);