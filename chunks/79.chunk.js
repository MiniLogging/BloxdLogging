"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[79],{14834:(b,d,P)=>{P.r(d),P.d(d,{FlowGraphPlayAnimationBlock:()=>C});var G=P(13401),W=P(13365),i=P(11639),q=P(14826);class C extends G.d{constructor(b){super(b,["animationLoop","animationEnd","animationGroupLoop"]),this.config=b,this.speed=this.registerDataInput("speed",W.p),this.loop=this.registerDataInput("loop",W.c),this.from=this.registerDataInput("from",W.p,0),this.to=this.registerDataInput("to",W.p),this.currentFrame=this.registerDataOutput("currentFrame",W.p),this.currentTime=this.registerDataOutput("currentTime",W.p),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",W.b),this.animationGroup=this.registerDataInput("animationGroup",W.b,null===b||void 0===b?void 0:b.animationGroup),this.animation=this.registerDataInput("animation",W.b),this.object=this.registerDataInput("object",W.b)}_preparePendingTasks(b){const d=this.animationGroup.getValue(b),P=this.animation.getValue(b);if(!d&&!P)return this._reportError(b,"No animation or animation group provided");{const W=this.currentAnimationGroup.getValue(b);W&&W!==d&&W.dispose();let i=d;if(P&&!i){const d=this.object.getValue(b);if(!d)return this._reportError(b,"No target object provided");const G=Array.isArray(P)?P:[P],W=G[0].name;i=new q.AnimationGroup("flowGraphAnimationGroup-"+W+"-"+d.name,b.configuration.Hd);let C=!1;const J=b._getGlobalContextVariable("interpolationAnimations",[]);for(const b of G)i.addTargetedAnimation(b,d),-1!==J.indexOf(b.uniqueId)&&(C=!0);C&&this._checkInterpolationDuplications(b,G,d)}const C=this.speed.getValue(b)||1,J=this.from.getValue(b)??0,L=this.to.getValue(b)||i.to,x=!isFinite(L)||this.loop.getValue(b);this.currentAnimationGroup.setValue(i,b);const Y=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==Y.indexOf(i.uniqueId)&&i.stop();try{i.start(x,C,J,L),i.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(b))),i.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(b))),i.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(b))),i.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(b))),Y.push(i.uniqueId),b._setGlobalContextVariable("currentlyRunningAnimationGroups",Y)}catch(G){this._reportError(b,G)}}}_reportError(b,d){super._reportError(b,d),this.currentFrame.setValue(-1,b),this.currentTime.setValue(-1,b)}_executeOnTick(b){const d=this.currentAnimationGroup.getValue(b);var P;d&&(this.currentFrame.setValue(d.getCurrentFrame(),b),this.currentTime.setValue((null===(P=d.animatables[0])||void 0===P?void 0:P.elapsedTime)??0,b))}_execute(b){this._startPendingTasks(b)}_onAnimationGroupEnd(b){this._removeFromCurrentlyRunning(b,this.currentAnimationGroup.getValue(b)),this._resetAfterCanceled(b),this.done._activateSignal(b)}_checkInterpolationDuplications(b,d,P){const G=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const W of G){const G=b.assetsContext.animationGroups.find((b=>b.uniqueId===W));if(G)for(const W of G.targetedAnimations)for(const i of d)W.animation.targetProperty===i.targetProperty&&W.target===P&&this._stopAnimationGroup(b,G)}}_stopAnimationGroup(b,d){d.stop(!0),d.dispose(),this._removeFromCurrentlyRunning(b,d)}_removeFromCurrentlyRunning(b,d){const P=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),G=P.indexOf(d.uniqueId);-1!==G&&(P.splice(G,1),b._setGlobalContextVariable("currentlyRunningAnimationGroups",P))}_cancelPendingTasks(b){const d=this.currentAnimationGroup.getValue(b);d&&this._stopAnimationGroup(b,d)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,i.f)("FlowGraphPlayAnimationBlock",C)}}]);