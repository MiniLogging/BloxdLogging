"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[79],{15603:(l,a,N)=>{N.r(a),N.d(a,{FlowGraphPlayAnimationBlock:()=>w});var U=N(14192),c=N(14145),K=N(12394),Z=N(15594);class w extends U.b{constructor(l){super(l,["animationLoop","animationEnd","animationGroupLoop"]),this.config=l,this.speed=this.registerDataInput("speed",c.t),this.loop=this.registerDataInput("loop",c.h),this.from=this.registerDataInput("from",c.t,0),this.to=this.registerDataInput("to",c.t),this.currentFrame=this.registerDataOutput("currentFrame",c.t),this.currentTime=this.registerDataOutput("currentTime",c.t),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",c.d),this.animationGroup=this.registerDataInput("animationGroup",c.d,null===l||void 0===l?void 0:l.animationGroup),this.animation=this.registerDataInput("animation",c.d),this.object=this.registerDataInput("object",c.d)}_preparePendingTasks(l){const a=this.animationGroup.getValue(l),N=this.animation.getValue(l);if(!a&&!N)return this._reportError(l,"No animation or animation group provided");{const c=this.currentAnimationGroup.getValue(l);c&&c!==a&&c.dispose();let K=a;if(N&&!K){const a=this.object.getValue(l);if(!a)return this._reportError(l,"No target object provided");const U=Array.isArray(N)?N:[N],c=U[0].name;K=new Z.AnimationGroup("flowGraphAnimationGroup-"+c+"-"+a.name,l.configuration.Ba);let w=!1;const S=l._getGlobalContextVariable("interpolationAnimations",[]);for(const l of U)K.addTargetedAnimation(l,a),-1!==S.indexOf(l.uniqueId)&&(w=!0);w&&this._checkInterpolationDuplications(l,U,a)}const w=this.speed.getValue(l)||1,S=this.from.getValue(l)??0,T=this.to.getValue(l)||K.to,J=!isFinite(T)||this.loop.getValue(l);this.currentAnimationGroup.setValue(K,l);const n=l._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==n.indexOf(K.uniqueId)&&K.stop();try{K.start(J,w,S,T),K.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(l))),K.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(l))),K.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(l))),K.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(l))),n.push(K.uniqueId),l._setGlobalContextVariable("currentlyRunningAnimationGroups",n)}catch(U){this._reportError(l,U)}}}_reportError(l,a){super._reportError(l,a),this.currentFrame.setValue(-1,l),this.currentTime.setValue(-1,l)}_executeOnTick(l){const a=this.currentAnimationGroup.getValue(l);var N;a&&(this.currentFrame.setValue(a.getCurrentFrame(),l),this.currentTime.setValue((null===(N=a.animatables[0])||void 0===N?void 0:N.elapsedTime)??0,l))}_execute(l){this._startPendingTasks(l)}_onAnimationGroupEnd(l){this._removeFromCurrentlyRunning(l,this.currentAnimationGroup.getValue(l)),this._resetAfterCanceled(l),this.done._activateSignal(l)}_checkInterpolationDuplications(l,a,N){const U=l._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const c of U){const U=l.assetsContext.animationGroups.find((l=>l.uniqueId===c));if(U)for(const c of U.targetedAnimations)for(const K of a)c.animation.targetProperty===K.targetProperty&&c.target===N&&this._stopAnimationGroup(l,U)}}_stopAnimationGroup(l,a){a.stop(!0),a.dispose(),this._removeFromCurrentlyRunning(l,a)}_removeFromCurrentlyRunning(l,a){const N=l._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),U=N.indexOf(a.uniqueId);-1!==U&&(N.splice(U,1),l._setGlobalContextVariable("currentlyRunningAnimationGroups",N))}_cancelPendingTasks(l){const a=this.currentAnimationGroup.getValue(l);a&&this._stopAnimationGroup(l,a)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,K.g)("FlowGraphPlayAnimationBlock",w)}}]);