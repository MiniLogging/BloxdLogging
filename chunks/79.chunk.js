"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[79],{15031:(b,n,i)=>{i.r(n),i.d(n,{FlowGraphPlayAnimationBlock:()=>Y});var e=i(13574),V=i(13522),Q=i(11734),U=i(15023);class Y extends e.c{constructor(b){super(b,["animationLoop","animationEnd","animationGroupLoop"]),this.config=b,this.speed=this.registerDataInput("speed",V.q),this.loop=this.registerDataInput("loop",V.f),this.from=this.registerDataInput("from",V.q,0),this.to=this.registerDataInput("to",V.q),this.currentFrame=this.registerDataOutput("currentFrame",V.q),this.currentTime=this.registerDataOutput("currentTime",V.q),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",V.c),this.animationGroup=this.registerDataInput("animationGroup",V.c,null===b||void 0===b?void 0:b.animationGroup),this.animation=this.registerDataInput("animation",V.c),this.object=this.registerDataInput("object",V.c)}_preparePendingTasks(b){const n=this.animationGroup.getValue(b),i=this.animation.getValue(b);if(!n&&!i)return this._reportError(b,"No animation or animation group provided");{const V=this.currentAnimationGroup.getValue(b);V&&V!==n&&V.dispose();let Q=n;if(i&&!Q){const n=this.object.getValue(b);if(!n)return this._reportError(b,"No target object provided");const e=Array.isArray(i)?i:[i],V=e[0].name;Q=new U.AnimationGroup("flowGraphAnimationGroup-"+V+"-"+n.name,b.configuration.dn);let Y=!1;const L=b._getGlobalContextVariable("interpolationAnimations",[]);for(const b of e)Q.addTargetedAnimation(b,n),-1!==L.indexOf(b.uniqueId)&&(Y=!0);Y&&this._checkInterpolationDuplications(b,e,n)}const Y=this.speed.getValue(b)||1,L=this.from.getValue(b)??0,B=this.to.getValue(b)||Q.to,mb=!isFinite(B)||this.loop.getValue(b);this.currentAnimationGroup.setValue(Q,b);const N=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==N.indexOf(Q.uniqueId)&&Q.stop();try{Q.start(mb,Y,L,B),Q.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(b))),Q.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(b))),Q.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(b))),Q.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(b))),N.push(Q.uniqueId),b._setGlobalContextVariable("currentlyRunningAnimationGroups",N)}catch(e){this._reportError(b,e)}}}_reportError(b,n){super._reportError(b,n),this.currentFrame.setValue(-1,b),this.currentTime.setValue(-1,b)}_executeOnTick(b){const n=this.currentAnimationGroup.getValue(b);var i;n&&(this.currentFrame.setValue(n.getCurrentFrame(),b),this.currentTime.setValue((null===(i=n.animatables[0])||void 0===i?void 0:i.elapsedTime)??0,b))}_execute(b){this._startPendingTasks(b)}_onAnimationGroupEnd(b){this._removeFromCurrentlyRunning(b,this.currentAnimationGroup.getValue(b)),this._resetAfterCanceled(b),this.done._activateSignal(b)}_checkInterpolationDuplications(b,n,i){const e=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const V of e){const e=b.assetsContext.animationGroups.find((b=>b.uniqueId===V));if(e)for(const V of e.targetedAnimations)for(const Q of n)V.animation.targetProperty===Q.targetProperty&&V.target===i&&this._stopAnimationGroup(b,e)}}_stopAnimationGroup(b,n){n.stop(!0),n.dispose(),this._removeFromCurrentlyRunning(b,n)}_removeFromCurrentlyRunning(b,n){const i=b._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),e=i.indexOf(n.uniqueId);-1!==e&&(i.splice(e,1),b._setGlobalContextVariable("currentlyRunningAnimationGroups",i))}_cancelPendingTasks(b){const n=this.currentAnimationGroup.getValue(b);n&&this._stopAnimationGroup(b,n)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,Q.i)("FlowGraphPlayAnimationBlock",Y)}}]);