"use strict";(self.wx5iyvo7rvn=self.wx5iyvo7rvn||[]).push([[79],{14230:(P,e,n)=>{n.r(e),n.d(e,{FlowGraphPlayAnimationBlock:()=>m});var H=n(12857),S=n(12819),p=n(11096),k=n(14226);class m extends H.b{constructor(P){super(P,["animationLoop","animationEnd","animationGroupLoop"]),this.config=P,this.speed=this.registerDataInput("speed",S.r),this.loop=this.registerDataInput("loop",S.d),this.from=this.registerDataInput("from",S.r,0),this.to=this.registerDataInput("to",S.r),this.currentFrame=this.registerDataOutput("currentFrame",S.r),this.currentTime=this.registerDataOutput("currentTime",S.r),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",S.b),this.animationGroup=this.registerDataInput("animationGroup",S.b,null===P||void 0===P?void 0:P.animationGroup),this.animation=this.registerDataInput("animation",S.b),this.object=this.registerDataInput("object",S.b)}_preparePendingTasks(P){const e=this.animationGroup.getValue(P),n=this.animation.getValue(P);if(!e&&!n)return this._reportError(P,"No animation or animation group provided");{const S=this.currentAnimationGroup.getValue(P);S&&S!==e&&S.dispose();let p=e;if(n&&!p){const e=this.object.getValue(P);if(!e)return this._reportError(P,"No target object provided");const H=Array.isArray(n)?n:[n],S=H[0].name;p=new k.AnimationGroup("flowGraphAnimationGroup-"+S+"-"+e.name,P.configuration.Te);let m=!1;const t=P._getGlobalContextVariable("interpolationAnimations",[]);for(const P of H)p.addTargetedAnimation(P,e),-1!==t.indexOf(P.uniqueId)&&(m=!0);m&&this._checkInterpolationDuplications(P,H,e)}const m=this.speed.getValue(P)||1,t=this.from.getValue(P)??0,C=this.to.getValue(P)||p.to,R=!isFinite(C)||this.loop.getValue(P);this.currentAnimationGroup.setValue(p,P);const q=P._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==q.indexOf(p.uniqueId)&&p.stop();try{p.start(R,m,t,C),p.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(P))),p.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(P))),p.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(P))),p.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(P))),q.push(p.uniqueId),P._setGlobalContextVariable("currentlyRunningAnimationGroups",q)}catch(H){this._reportError(P,H)}}}_reportError(P,e){super._reportError(P,e),this.currentFrame.setValue(-1,P),this.currentTime.setValue(-1,P)}_executeOnTick(P){const e=this.currentAnimationGroup.getValue(P);var n;e&&(this.currentFrame.setValue(e.getCurrentFrame(),P),this.currentTime.setValue((null===(n=e.animatables[0])||void 0===n?void 0:n.elapsedTime)??0,P))}_execute(P){this._startPendingTasks(P)}_onAnimationGroupEnd(P){this._removeFromCurrentlyRunning(P,this.currentAnimationGroup.getValue(P)),this._resetAfterCanceled(P),this.done._activateSignal(P)}_checkInterpolationDuplications(P,e,n){const H=P._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const S of H){const H=P.assetsContext.animationGroups.find((P=>P.uniqueId===S));if(H)for(const S of H.targetedAnimations)for(const p of e)S.animation.targetProperty===p.targetProperty&&S.target===n&&this._stopAnimationGroup(P,H)}}_stopAnimationGroup(P,e){e.stop(!0),e.dispose(),this._removeFromCurrentlyRunning(P,e)}_removeFromCurrentlyRunning(P,e){const n=P._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),H=n.indexOf(e.uniqueId);-1!==H&&(n.splice(H,1),P._setGlobalContextVariable("currentlyRunningAnimationGroups",n))}_cancelPendingTasks(P){const e=this.currentAnimationGroup.getValue(P);e&&this._stopAnimationGroup(P,e)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,p.h)("FlowGraphPlayAnimationBlock",m)}}]);