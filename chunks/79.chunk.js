"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[79],{15577:(a,O,i)=>{i.r(O),i.d(O,{FlowGraphPlayAnimationBlock:()=>Q});var H=i(14159),b=i(14124),G=i(12346),q=i(15571);class Q extends H.c{constructor(a){super(a,["animationLoop","animationEnd","animationGroupLoop"]),this.config=a,this.speed=this.registerDataInput("speed",b.t),this.loop=this.registerDataInput("loop",b.h),this.from=this.registerDataInput("from",b.t,0),this.to=this.registerDataInput("to",b.t),this.currentFrame=this.registerDataOutput("currentFrame",b.t),this.currentTime=this.registerDataOutput("currentTime",b.t),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",b.e),this.animationGroup=this.registerDataInput("animationGroup",b.e,null===a||void 0===a?void 0:a.animationGroup),this.animation=this.registerDataInput("animation",b.e),this.object=this.registerDataInput("object",b.e)}_preparePendingTasks(a){const O=this.animationGroup.getValue(a),i=this.animation.getValue(a);if(!O&&!i)return this._reportError(a,"No animation or animation group provided");{const b=this.currentAnimationGroup.getValue(a);b&&b!==O&&b.dispose();let G=O;if(i&&!G){const O=this.object.getValue(a);if(!O)return this._reportError(a,"No target object provided");const H=Array.isArray(i)?i:[i],b=H[0].name;G=new q.AnimationGroup("flowGraphAnimationGroup-"+b+"-"+O.name,a.configuration.rO);let Q=!1;const k=a._getGlobalContextVariable("interpolationAnimations",[]);for(const a of H)G.addTargetedAnimation(a,O),-1!==k.indexOf(a.uniqueId)&&(Q=!0);Q&&this._checkInterpolationDuplications(a,H,O)}const Q=this.speed.getValue(a)||1,k=this.from.getValue(a)??0,I=this.to.getValue(a)||G.to,P=!isFinite(I)||this.loop.getValue(a);this.currentAnimationGroup.setValue(G,a);const e=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==e.indexOf(G.uniqueId)&&G.stop();try{G.start(P,Q,k,I),G.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(a))),G.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(a))),G.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(a))),G.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(a))),e.push(G.uniqueId),a._setGlobalContextVariable("currentlyRunningAnimationGroups",e)}catch(H){this._reportError(a,H)}}}_reportError(a,O){super._reportError(a,O),this.currentFrame.setValue(-1,a),this.currentTime.setValue(-1,a)}_executeOnTick(a){const O=this.currentAnimationGroup.getValue(a);var i;O&&(this.currentFrame.setValue(O.getCurrentFrame(),a),this.currentTime.setValue((null===(i=O.animatables[0])||void 0===i?void 0:i.elapsedTime)??0,a))}_execute(a){this._startPendingTasks(a)}_onAnimationGroupEnd(a){this._removeFromCurrentlyRunning(a,this.currentAnimationGroup.getValue(a)),this._resetAfterCanceled(a),this.done._activateSignal(a)}_checkInterpolationDuplications(a,O,i){const H=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const b of H){const H=a.assetsContext.animationGroups.find((a=>a.uniqueId===b));if(H)for(const b of H.targetedAnimations)for(const G of O)b.animation.targetProperty===G.targetProperty&&b.target===i&&this._stopAnimationGroup(a,H)}}_stopAnimationGroup(a,O){O.stop(!0),O.dispose(),this._removeFromCurrentlyRunning(a,O)}_removeFromCurrentlyRunning(a,O){const i=a._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),H=i.indexOf(O.uniqueId);-1!==H&&(i.splice(H,1),a._setGlobalContextVariable("currentlyRunningAnimationGroups",i))}_cancelPendingTasks(a){const O=this.currentAnimationGroup.getValue(a);O&&this._stopAnimationGroup(a,O)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,G.h)("FlowGraphPlayAnimationBlock",Q)}}]);