"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[79],{15674:(o,v,V)=>{V.r(v),V.d(v,{FlowGraphPlayAnimationBlock:()=>U});var g=V(14281),E=V(14241),I=V(12449),Q=V(15670);class U extends g.e{constructor(o){super(o,["animationLoop","animationEnd","animationGroupLoop"]),this.config=o,this.speed=this.registerDataInput("speed",E.t),this.loop=this.registerDataInput("loop",E.f),this.from=this.registerDataInput("from",E.t,0),this.to=this.registerDataInput("to",E.t),this.currentFrame=this.registerDataOutput("currentFrame",E.t),this.currentTime=this.registerDataOutput("currentTime",E.t),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",E.e),this.animationGroup=this.registerDataInput("animationGroup",E.e,null===o||void 0===o?void 0:o.animationGroup),this.animation=this.registerDataInput("animation",E.e),this.object=this.registerDataInput("object",E.e)}_preparePendingTasks(o){const v=this.animationGroup.getValue(o),V=this.animation.getValue(o);if(!v&&!V)return this._reportError(o,"No animation or animation group provided");{const E=this.currentAnimationGroup.getValue(o);E&&E!==v&&E.dispose();let I=v;if(V&&!I){const v=this.object.getValue(o);if(!v)return this._reportError(o,"No target object provided");const g=Array.isArray(V)?V:[V],E=g[0].name;I=new Q.AnimationGroup("flowGraphAnimationGroup-"+E+"-"+v.name,o.configuration.jv);let U=!1;const n=o._getGlobalContextVariable("interpolationAnimations",[]);for(const o of g)I.addTargetedAnimation(o,v),-1!==n.indexOf(o.uniqueId)&&(U=!0);U&&this._checkInterpolationDuplications(o,g,v)}const U=this.speed.getValue(o)||1,n=this.from.getValue(o)??0,O=this.to.getValue(o)||I.to,h=!isFinite(O)||this.loop.getValue(o);this.currentAnimationGroup.setValue(I,o);const x=o._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==x.indexOf(I.uniqueId)&&I.stop();try{I.start(h,U,n,O),I.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(o))),I.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(o))),I.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(o))),I.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(o))),x.push(I.uniqueId),o._setGlobalContextVariable("currentlyRunningAnimationGroups",x)}catch(g){this._reportError(o,g)}}}_reportError(o,v){super._reportError(o,v),this.currentFrame.setValue(-1,o),this.currentTime.setValue(-1,o)}_executeOnTick(o){const v=this.currentAnimationGroup.getValue(o);var V;v&&(this.currentFrame.setValue(v.getCurrentFrame(),o),this.currentTime.setValue((null===(V=v.animatables[0])||void 0===V?void 0:V.elapsedTime)??0,o))}_execute(o){this._startPendingTasks(o)}_onAnimationGroupEnd(o){this._removeFromCurrentlyRunning(o,this.currentAnimationGroup.getValue(o)),this._resetAfterCanceled(o),this.done._activateSignal(o)}_checkInterpolationDuplications(o,v,V){const g=o._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const E of g){const g=o.assetsContext.animationGroups.find((o=>o.uniqueId===E));if(g)for(const E of g.targetedAnimations)for(const I of v)E.animation.targetProperty===I.targetProperty&&E.target===V&&this._stopAnimationGroup(o,g)}}_stopAnimationGroup(o,v){v.stop(!0),v.dispose(),this._removeFromCurrentlyRunning(o,v)}_removeFromCurrentlyRunning(o,v){const V=o._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),g=V.indexOf(v.uniqueId);-1!==g&&(V.splice(g,1),o._setGlobalContextVariable("currentlyRunningAnimationGroups",V))}_cancelPendingTasks(o){const v=this.currentAnimationGroup.getValue(o);v&&this._stopAnimationGroup(o,v)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,I.h)("FlowGraphPlayAnimationBlock",U)}}]);