"use strict";(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[79],{14517:(B,E,v)=>{v.r(E),v.d(E,{FlowGraphPlayAnimationBlock:()=>S});var z=v(13137),o=v(13102),q=v(11345),c=v(14509);class S extends z.c{constructor(B){super(B,["animationLoop","animationEnd","animationGroupLoop"]),this.config=B,this.speed=this.registerDataInput("speed",o.v),this.loop=this.registerDataInput("loop",o.f),this.from=this.registerDataInput("from",o.v,0),this.to=this.registerDataInput("to",o.v),this.currentFrame=this.registerDataOutput("currentFrame",o.v),this.currentTime=this.registerDataOutput("currentTime",o.v),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",o.c),this.animationGroup=this.registerDataInput("animationGroup",o.c,null===B||void 0===B?void 0:B.animationGroup),this.animation=this.registerDataInput("animation",o.c),this.object=this.registerDataInput("object",o.c)}_preparePendingTasks(B){const E=this.animationGroup.getValue(B),v=this.animation.getValue(B);if(!E&&!v)return this._reportError(B,"No animation or animation group provided");{const o=this.currentAnimationGroup.getValue(B);o&&o!==E&&o.dispose();let q=E;if(v&&!q){const E=this.object.getValue(B);if(!E)return this._reportError(B,"No target object provided");const z=Array.isArray(v)?v:[v],o=z[0].name;q=new c.AnimationGroup("flowGraphAnimationGroup-"+o+"-"+E.name,B.configuration.aE);let S=!1;const x=B._getGlobalContextVariable("interpolationAnimations",[]);for(const B of z)q.addTargetedAnimation(B,E),-1!==x.indexOf(B.uniqueId)&&(S=!0);S&&this._checkInterpolationDuplications(B,z,E)}const S=this.speed.getValue(B)||1,x=this.from.getValue(B)??0,D=this.to.getValue(B)||q.to,h=!isFinite(D)||this.loop.getValue(B);this.currentAnimationGroup.setValue(q,B);const y=B._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==y.indexOf(q.uniqueId)&&q.stop();try{q.start(h,S,x,D),q.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(B))),q.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(B))),q.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(B))),q.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(B))),y.push(q.uniqueId),B._setGlobalContextVariable("currentlyRunningAnimationGroups",y)}catch(z){this._reportError(B,z)}}}_reportError(B,E){super._reportError(B,E),this.currentFrame.setValue(-1,B),this.currentTime.setValue(-1,B)}_executeOnTick(B){const E=this.currentAnimationGroup.getValue(B);var v;E&&(this.currentFrame.setValue(E.getCurrentFrame(),B),this.currentTime.setValue((null===(v=E.animatables[0])||void 0===v?void 0:v.elapsedTime)??0,B))}_execute(B){this._startPendingTasks(B)}_onAnimationGroupEnd(B){this._removeFromCurrentlyRunning(B,this.currentAnimationGroup.getValue(B)),this._resetAfterCanceled(B),this.done._activateSignal(B)}_checkInterpolationDuplications(B,E,v){const z=B._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const o of z){const z=B.assetsContext.animationGroups.find((B=>B.uniqueId===o));if(z)for(const o of z.targetedAnimations)for(const q of E)o.animation.targetProperty===q.targetProperty&&o.target===v&&this._stopAnimationGroup(B,z)}}_stopAnimationGroup(B,E){E.stop(!0),E.dispose(),this._removeFromCurrentlyRunning(B,E)}_removeFromCurrentlyRunning(B,E){const v=B._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),z=v.indexOf(E.uniqueId);-1!==z&&(v.splice(z,1),B._setGlobalContextVariable("currentlyRunningAnimationGroups",v))}_cancelPendingTasks(B){const E=this.currentAnimationGroup.getValue(B);E&&this._stopAnimationGroup(B,E)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,q.f)("FlowGraphPlayAnimationBlock",S)}}]);