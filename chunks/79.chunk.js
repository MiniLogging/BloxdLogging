"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[79],{15704:(g,i,a)=>{a.r(i),a.d(i,{FlowGraphPlayAnimationBlock:()=>k});var n=a(14265),L=a(14214),d=a(12415),b=a(15696);class k extends n.d{constructor(g){super(g,["animationLoop","animationEnd","animationGroupLoop"]),this.config=g,this.speed=this.registerDataInput("speed",L.q),this.loop=this.registerDataInput("loop",L.e),this.from=this.registerDataInput("from",L.q,0),this.to=this.registerDataInput("to",L.q),this.currentFrame=this.registerDataOutput("currentFrame",L.q),this.currentTime=this.registerDataOutput("currentTime",L.q),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",L.d),this.animationGroup=this.registerDataInput("animationGroup",L.d,null===g||void 0===g?void 0:g.animationGroup),this.animation=this.registerDataInput("animation",L.d),this.object=this.registerDataInput("object",L.d)}_preparePendingTasks(g){const i=this.animationGroup.getValue(g),a=this.animation.getValue(g);if(!i&&!a)return this._reportError(g,"No animation or animation group provided");{const L=this.currentAnimationGroup.getValue(g);L&&L!==i&&L.dispose();let d=i;if(a&&!d){const i=this.object.getValue(g);if(!i)return this._reportError(g,"No target object provided");const n=Array.isArray(a)?a:[a],L=n[0].name;d=new b.AnimationGroup("flowGraphAnimationGroup-"+L+"-"+i.name,g.configuration.Di);let k=!1;const e=g._getGlobalContextVariable("interpolationAnimations",[]);for(const g of n)d.addTargetedAnimation(g,i),-1!==e.indexOf(g.uniqueId)&&(k=!0);k&&this._checkInterpolationDuplications(g,n,i)}const k=this.speed.getValue(g)||1,e=this.from.getValue(g)??0,N=this.to.getValue(g)||d.to,F=!isFinite(N)||this.loop.getValue(g);this.currentAnimationGroup.setValue(d,g);const I=g._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==I.indexOf(d.uniqueId)&&d.stop();try{d.start(F,k,e,N),d.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(g))),d.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(g))),d.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(g))),d.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(g))),I.push(d.uniqueId),g._setGlobalContextVariable("currentlyRunningAnimationGroups",I)}catch(n){this._reportError(g,n)}}}_reportError(g,i){super._reportError(g,i),this.currentFrame.setValue(-1,g),this.currentTime.setValue(-1,g)}_executeOnTick(g){const i=this.currentAnimationGroup.getValue(g);var a;i&&(this.currentFrame.setValue(i.getCurrentFrame(),g),this.currentTime.setValue((null===(a=i.animatables[0])||void 0===a?void 0:a.elapsedTime)??0,g))}_execute(g){this._startPendingTasks(g)}_onAnimationGroupEnd(g){this._removeFromCurrentlyRunning(g,this.currentAnimationGroup.getValue(g)),this._resetAfterCanceled(g),this.done._activateSignal(g)}_checkInterpolationDuplications(g,i,a){const n=g._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const L of n){const n=g.assetsContext.animationGroups.find((g=>g.uniqueId===L));if(n)for(const L of n.targetedAnimations)for(const d of i)L.animation.targetProperty===d.targetProperty&&L.target===a&&this._stopAnimationGroup(g,n)}}_stopAnimationGroup(g,i){i.stop(!0),i.dispose(),this._removeFromCurrentlyRunning(g,i)}_removeFromCurrentlyRunning(g,i){const a=g._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),n=a.indexOf(i.uniqueId);-1!==n&&(a.splice(n,1),g._setGlobalContextVariable("currentlyRunningAnimationGroups",a))}_cancelPendingTasks(g){const i=this.currentAnimationGroup.getValue(g);i&&this._stopAnimationGroup(g,i)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,d.e)("FlowGraphPlayAnimationBlock",k)}}]);