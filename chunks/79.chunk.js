"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[79],{15606:(e,d,v)=>{v.r(d),v.d(d,{FlowGraphPlayAnimationBlock:()=>X});var P=v(14216),p=v(14181),L=v(12381),B=v(15598);class X extends P.d{constructor(e){super(e,["animationLoop","animationEnd","animationGroupLoop"]),this.config=e,this.speed=this.registerDataInput("speed",p.n),this.loop=this.registerDataInput("loop",p.d),this.from=this.registerDataInput("from",p.n,0),this.to=this.registerDataInput("to",p.n),this.currentFrame=this.registerDataOutput("currentFrame",p.n),this.currentTime=this.registerDataOutput("currentTime",p.n),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",p.b),this.animationGroup=this.registerDataInput("animationGroup",p.b,null===e||void 0===e?void 0:e.animationGroup),this.animation=this.registerDataInput("animation",p.b),this.object=this.registerDataInput("object",p.b)}_preparePendingTasks(e){const d=this.animationGroup.getValue(e),v=this.animation.getValue(e);if(!d&&!v)return this._reportError(e,"No animation or animation group provided");{const p=this.currentAnimationGroup.getValue(e);p&&p!==d&&p.dispose();let L=d;if(v&&!L){const d=this.object.getValue(e);if(!d)return this._reportError(e,"No target object provided");const P=Array.isArray(v)?v:[v],p=P[0].name;L=new B.AnimationGroup("flowGraphAnimationGroup-"+p+"-"+d.name,e.configuration.fd);let X=!1;const z=e._getGlobalContextVariable("interpolationAnimations",[]);for(const e of P)L.addTargetedAnimation(e,d),-1!==z.indexOf(e.uniqueId)&&(X=!0);X&&this._checkInterpolationDuplications(e,P,d)}const X=this.speed.getValue(e)||1,z=this.from.getValue(e)??0,W=this.to.getValue(e)||L.to,V=!isFinite(W)||this.loop.getValue(e);this.currentAnimationGroup.setValue(L,e);const k=e._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==k.indexOf(L.uniqueId)&&L.stop();try{L.start(V,X,z,W),L.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(e))),L.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(e))),L.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(e))),L.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(e))),k.push(L.uniqueId),e._setGlobalContextVariable("currentlyRunningAnimationGroups",k)}catch(P){this._reportError(e,P)}}}_reportError(e,d){super._reportError(e,d),this.currentFrame.setValue(-1,e),this.currentTime.setValue(-1,e)}_executeOnTick(e){const d=this.currentAnimationGroup.getValue(e);var v;d&&(this.currentFrame.setValue(d.getCurrentFrame(),e),this.currentTime.setValue((null===(v=d.animatables[0])||void 0===v?void 0:v.elapsedTime)??0,e))}_execute(e){this._startPendingTasks(e)}_onAnimationGroupEnd(e){this._removeFromCurrentlyRunning(e,this.currentAnimationGroup.getValue(e)),this._resetAfterCanceled(e),this.done._activateSignal(e)}_checkInterpolationDuplications(e,d,v){const P=e._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const p of P){const P=e.assetsContext.animationGroups.find((e=>e.uniqueId===p));if(P)for(const p of P.targetedAnimations)for(const L of d)p.animation.targetProperty===L.targetProperty&&p.target===v&&this._stopAnimationGroup(e,P)}}_stopAnimationGroup(e,d){d.stop(!0),d.dispose(),this._removeFromCurrentlyRunning(e,d)}_removeFromCurrentlyRunning(e,d){const v=e._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),P=v.indexOf(d.uniqueId);-1!==P&&(v.splice(P,1),e._setGlobalContextVariable("currentlyRunningAnimationGroups",v))}_cancelPendingTasks(e){const d=this.currentAnimationGroup.getValue(e);d&&this._stopAnimationGroup(e,d)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,L.h)("FlowGraphPlayAnimationBlock",X)}}]);