"use strict";(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[79],{14548:(n,y,H)=>{H.r(y),H.d(y,{FlowGraphPlayAnimationBlock:()=>i});var o=H(13160),G=H(13117),h=H(11248),k=H(14546);class i extends o.d{constructor(n){super(n,["animationLoop","animationEnd","animationGroupLoop"]),this.config=n,this.speed=this.registerDataInput("speed",G.p),this.loop=this.registerDataInput("loop",G.e),this.from=this.registerDataInput("from",G.p,0),this.to=this.registerDataInput("to",G.p),this.currentFrame=this.registerDataOutput("currentFrame",G.p),this.currentTime=this.registerDataOutput("currentTime",G.p),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",G.c),this.animationGroup=this.registerDataInput("animationGroup",G.c,null===n||void 0===n?void 0:n.animationGroup),this.animation=this.registerDataInput("animation",G.c),this.object=this.registerDataInput("object",G.c)}_preparePendingTasks(n){const y=this.animationGroup.getValue(n),H=this.animation.getValue(n);if(!y&&!H)return this._reportError(n,"No animation or animation group provided");{const G=this.currentAnimationGroup.getValue(n);G&&G!==y&&G.dispose();let h=y;if(H&&!h){const y=this.object.getValue(n);if(!y)return this._reportError(n,"No target object provided");const o=Array.isArray(H)?H:[H],G=o[0].name;h=new k.AnimationGroup("flowGraphAnimationGroup-"+G+"-"+y.name,n.configuration.ly);let i=!1;const B=n._getGlobalContextVariable("interpolationAnimations",[]);for(const n of o)h.addTargetedAnimation(n,y),-1!==B.indexOf(n.uniqueId)&&(i=!0);i&&this._checkInterpolationDuplications(n,o,y)}const i=this.speed.getValue(n)||1,B=this.from.getValue(n)??0,V=this.to.getValue(n)||h.to,q=!isFinite(V)||this.loop.getValue(n);this.currentAnimationGroup.setValue(h,n);const b=n._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==b.indexOf(h.uniqueId)&&h.stop();try{h.start(q,i,B,V),h.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(n))),h.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(n))),h.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(n))),h.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(n))),b.push(h.uniqueId),n._setGlobalContextVariable("currentlyRunningAnimationGroups",b)}catch(o){this._reportError(n,o)}}}_reportError(n,y){super._reportError(n,y),this.currentFrame.setValue(-1,n),this.currentTime.setValue(-1,n)}_executeOnTick(n){const y=this.currentAnimationGroup.getValue(n);var H;y&&(this.currentFrame.setValue(y.getCurrentFrame(),n),this.currentTime.setValue((null===(H=y.animatables[0])||void 0===H?void 0:H.elapsedTime)??0,n))}_execute(n){this._startPendingTasks(n)}_onAnimationGroupEnd(n){this._removeFromCurrentlyRunning(n,this.currentAnimationGroup.getValue(n)),this._resetAfterCanceled(n),this.done._activateSignal(n)}_checkInterpolationDuplications(n,y,H){const o=n._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const G of o){const o=n.assetsContext.animationGroups.find((n=>n.uniqueId===G));if(o)for(const G of o.targetedAnimations)for(const h of y)G.animation.targetProperty===h.targetProperty&&G.target===H&&this._stopAnimationGroup(n,o)}}_stopAnimationGroup(n,y){y.stop(!0),y.dispose(),this._removeFromCurrentlyRunning(n,y)}_removeFromCurrentlyRunning(n,y){const H=n._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),o=H.indexOf(y.uniqueId);-1!==o&&(H.splice(o,1),n._setGlobalContextVariable("currentlyRunningAnimationGroups",H))}_cancelPendingTasks(n){const y=this.currentAnimationGroup.getValue(n);y&&this._stopAnimationGroup(n,y)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,h.h)("FlowGraphPlayAnimationBlock",i)}}]);