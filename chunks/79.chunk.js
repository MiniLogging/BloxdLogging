"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[79],{15319:(i,x,e)=>{e.r(x),e.d(x,{FlowGraphPlayAnimationBlock:()=>J});var j=e(13924),E=e(13874),a=e(12204),Y=e(15311);class J extends j.b{constructor(i){super(i,["animationLoop","animationEnd","animationGroupLoop"]),this.config=i,this.speed=this.registerDataInput("speed",E.q),this.loop=this.registerDataInput("loop",E.g),this.from=this.registerDataInput("from",E.q,0),this.to=this.registerDataInput("to",E.q),this.currentFrame=this.registerDataOutput("currentFrame",E.q),this.currentTime=this.registerDataOutput("currentTime",E.q),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",E.c),this.animationGroup=this.registerDataInput("animationGroup",E.c,null===i||void 0===i?void 0:i.animationGroup),this.animation=this.registerDataInput("animation",E.c),this.object=this.registerDataInput("object",E.c)}_preparePendingTasks(i){const x=this.animationGroup.getValue(i),e=this.animation.getValue(i);if(!x&&!e)return this._reportError(i,"No animation or animation group provided");{const E=this.currentAnimationGroup.getValue(i);E&&E!==x&&E.dispose();let a=x;if(e&&!a){const x=this.object.getValue(i);if(!x)return this._reportError(i,"No target object provided");const j=Array.isArray(e)?e:[e],E=j[0].name;a=new Y.AnimationGroup("flowGraphAnimationGroup-"+E+"-"+x.name,i.configuration.LJ);let J=!1;const u=i._getGlobalContextVariable("interpolationAnimations",[]);for(const i of j)a.addTargetedAnimation(i,x),-1!==u.indexOf(i.uniqueId)&&(J=!0);J&&this._checkInterpolationDuplications(i,j,x)}const J=this.speed.getValue(i)||1,u=this.from.getValue(i)??0,b=this.to.getValue(i)||a.to,g=!isFinite(b)||this.loop.getValue(i);this.currentAnimationGroup.setValue(a,i);const A=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==A.indexOf(a.uniqueId)&&a.stop();try{a.start(g,J,u,b),a.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(i))),a.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(i))),a.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(i))),a.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(i))),A.push(a.uniqueId),i._setGlobalContextVariable("currentlyRunningAnimationGroups",A)}catch(j){this._reportError(i,j)}}}_reportError(i,x){super._reportError(i,x),this.currentFrame.setValue(-1,i),this.currentTime.setValue(-1,i)}_executeOnTick(i){const x=this.currentAnimationGroup.getValue(i);var e;x&&(this.currentFrame.setValue(x.getCurrentFrame(),i),this.currentTime.setValue((null===(e=x.animatables[0])||void 0===e?void 0:e.elapsedTime)??0,i))}_execute(i){this._startPendingTasks(i)}_onAnimationGroupEnd(i){this._removeFromCurrentlyRunning(i,this.currentAnimationGroup.getValue(i)),this._resetAfterCanceled(i),this.done._activateSignal(i)}_checkInterpolationDuplications(i,x,e){const j=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const E of j){const j=i.assetsContext.animationGroups.find((i=>i.uniqueId===E));if(j)for(const E of j.targetedAnimations)for(const a of x)E.animation.targetProperty===a.targetProperty&&E.target===e&&this._stopAnimationGroup(i,j)}}_stopAnimationGroup(i,x){x.stop(!0),x.dispose(),this._removeFromCurrentlyRunning(i,x)}_removeFromCurrentlyRunning(i,x){const e=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),j=e.indexOf(x.uniqueId);-1!==j&&(e.splice(j,1),i._setGlobalContextVariable("currentlyRunningAnimationGroups",e))}_cancelPendingTasks(i){const x=this.currentAnimationGroup.getValue(i);x&&this._stopAnimationGroup(i,x)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,a.f)("FlowGraphPlayAnimationBlock",J)}}]);