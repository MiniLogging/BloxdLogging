"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[24],{12013:(b,d,P)=>{P.d(d,{b:()=>G});class G{constructor(b,d,P){this.bu=b,this.bv=d,this.distance=P,this.faceId=0,this.subMeshId=0}}},12026:(b,d,P)=>{P.d(d,{d:()=>q});var G=P(11691),W=P(11681),i=P(11688);class q{constructor(b,d,P){this.vectors=(0,G.b)(8,W.ed.Zero),this.center=W.ed.Zero(),this.centerWorld=W.ed.Zero(),this.extendSize=W.ed.Zero(),this.extendSizeWorld=W.ed.Zero(),this.directions=(0,G.b)(3,W.ed.Zero),this.vectorsWorld=(0,G.b)(8,W.ed.Zero),this.minimumWorld=W.ed.Zero(),this.maximumWorld=W.ed.Zero(),this.minimum=W.ed.Zero(),this.maximum=W.ed.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(b,d,P)}reConstruct(b,d,P){const G=b.x,i=b.y,q=b.z,C=d.x,J=d.y,L=d.z,x=this.vectors;this.minimum.Fd(G,i,q),this.maximum.Fd(C,J,L),x[0].Fd(G,i,q),x[1].Fd(C,J,L),x[2].Fd(C,i,q),x[3].Fd(G,J,q),x[4].Fd(G,i,L),x[5].Fd(C,J,q),x[6].Fd(G,J,L),x[7].Fd(C,i,L),d.addToRef(b,this.center).scaleInPlace(.5),d.subtractToRef(b,this.extendSize).scaleInPlace(.5),this._worldMatrix=P||W.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(b){const d=q._TmpVector3,P=this.maximum.subtractToRef(this.minimum,d[0]),G=P.length();P.normalizeFromLength(G);const W=G*b,i=P.scaleInPlace(.5*W),C=this.center.subtractToRef(i,d[1]),J=this.center.addToRef(i,d[2]);return this.reConstruct(C,J,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(b){const d=this.minimumWorld,P=this.maximumWorld,G=this.directions,i=this.vectorsWorld,q=this.vectors;if(b.isIdentity()){d.q(this.minimum),P.q(this.maximum);for(let b=0;b<8;++b)i[b].q(q[b]);this.extendSizeWorld.q(this.extendSize),this.centerWorld.q(this.center)}else{d.kd(Number.MAX_VALUE),P.kd(-Number.MAX_VALUE);for(let G=0;G<8;++G){const C=i[G];W.ed.TransformCoordinatesToRef(q[G],b,C),d.minimizeInPlace(C),P.maximizeInPlace(C)}P.subtractToRef(d,this.extendSizeWorld).scaleInPlace(.5),P.addToRef(d,this.centerWorld).scaleInPlace(.5)}W.ed.FromArrayToRef(b.m,0,G[0]),W.ed.FromArrayToRef(b.m,4,G[1]),W.ed.FromArrayToRef(b.m,8,G[2]),this._worldMatrix=b}isInFrustum(b){return q.IsInFrustum(this.vectorsWorld,b)}isCompletelyInFrustum(b){return q.IsCompletelyInFrustum(this.vectorsWorld,b)}intersectsPoint(b){const d=this.minimumWorld,P=this.maximumWorld,G=d.x,W=d.y,q=d.z,C=P.x,J=P.y,L=P.z,x=b.x,Y=b.y,s=b.z,E=-i.c;return!(C-x<E||E>x-G)&&(!(J-Y<E||E>Y-W)&&!(L-s<E||E>s-q))}intersectsSphere(b){return q.IntersectsSphere(this.minimumWorld,this.maximumWorld,b.centerWorld,b.radiusWorld)}intersectsMinMax(b,d){const P=this.minimumWorld,G=this.maximumWorld,W=P.x,i=P.y,q=P.z,C=G.x,J=G.y,L=G.z,x=b.x,Y=b.y,s=b.z,E=d.x,w=d.y,t=d.z;return!(C<x||W>E)&&(!(J<Y||i>w)&&!(L<s||q>t))}dispose(){var b,d;null===(b=this._drawWrapperFront)||void 0===b||b.dispose(),null===(d=this._drawWrapperBack)||void 0===d||d.dispose()}static Intersects(b,d){return b.intersectsMinMax(d.minimumWorld,d.maximumWorld)}static IntersectsSphere(b,d,P,G){const i=q._TmpVector3[0];W.ed.ClampToRef(P,b,d,i);return W.ed.DistanceSquared(P,i)<=G*G}static IsCompletelyInFrustum(b,d){for(let P=0;P<6;++P){const G=d[P];for(let d=0;d<8;++d)if(G.dotCoordinate(b[d])<0)return!1}return!0}static IsInFrustum(b,d){for(let P=0;P<6;++P){let G=!0;const W=d[P];for(let d=0;d<8;++d)if(W.dotCoordinate(b[d])>=0){G=!1;break}if(G)return!1}return!0}}q._TmpVector3=(0,G.b)(3,W.ed.Zero)},12018:(b,d,P)=>{P.d(d,{d:()=>Y});var G=P(11691),W=P(11681),i=P(12026),q=P(12033);const C={min:0,max:0},J={min:0,max:0},L=(b,d,P)=>{const G=W.ed.Dot(d.centerWorld,b),i=Math.abs(W.ed.Dot(d.directions[0],b))*d.extendSize.x+Math.abs(W.ed.Dot(d.directions[1],b))*d.extendSize.y+Math.abs(W.ed.Dot(d.directions[2],b))*d.extendSize.z;P.min=G-i,P.max=G+i},x=(b,d,P)=>(L(b,d,C),L(b,P,J),!(C.min>J.max||J.min>C.max));class Y{constructor(b,d,P){this._isLocked=!1,this.boundingBox=new i.d(b,d,P),this.boundingSphere=new q.e(b,d,P)}reConstruct(b,d,P){this.boundingBox.reConstruct(b,d,P),this.boundingSphere.reConstruct(b,d,P)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(b){this._isLocked=b}update(b){this._isLocked||(this.boundingBox._update(b),this.boundingSphere._update(b))}centerOn(b,d){const P=Y._TmpVector3[0].q(b).GY(d),G=Y._TmpVector3[1].q(b).addInPlace(d);return this.boundingBox.reConstruct(P,G,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(P,G,this.boundingBox.getWorldMatrix()),this}encapsulate(b){const d=W.ed.Minimize(this.minimum,b),P=W.ed.Maximize(this.maximum,b);return this.reConstruct(d,P,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(b){const d=W.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(d);const P=W.TmpVectors.ed[0];return W.ed.TransformCoordinatesToRef(b.boundingBox.minimumWorld,d,P),this.encapsulate(P),W.ed.TransformCoordinatesToRef(b.boundingBox.maximumWorld,d,P),this.encapsulate(P),this}scale(b){return this.boundingBox.scale(b),this.boundingSphere.scale(b),this}isInFrustum(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===d||3===d)&&this.boundingSphere.isCenterInFrustum(b))return!0;if(!this.boundingSphere.isInFrustum(b))return!1;return!(1!==d&&3!==d)||this.boundingBox.isInFrustum(b)}get diagonalLength(){const b=this.boundingBox;return b.maximumWorld.subtractToRef(b.minimumWorld,Y._TmpVector3[0]).length()}isCompletelyInFrustum(b){return this.boundingBox.isCompletelyInFrustum(b)}_checkCollision(b){return b._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(b){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(b)&&!!this.boundingBox.intersectsPoint(b))}intersects(b,d){if(!q.e.Intersects(this.boundingSphere,b.boundingSphere))return!1;if(!i.d.Intersects(this.boundingBox,b.boundingBox))return!1;if(!d)return!0;const P=this.boundingBox,G=b.boundingBox;return!!x(P.directions[0],P,G)&&(!!x(P.directions[1],P,G)&&(!!x(P.directions[2],P,G)&&(!!x(G.directions[0],P,G)&&(!!x(G.directions[1],P,G)&&(!!x(G.directions[2],P,G)&&(!!x(W.ed.Cross(P.directions[0],G.directions[0]),P,G)&&(!!x(W.ed.Cross(P.directions[0],G.directions[1]),P,G)&&(!!x(W.ed.Cross(P.directions[0],G.directions[2]),P,G)&&(!!x(W.ed.Cross(P.directions[1],G.directions[0]),P,G)&&(!!x(W.ed.Cross(P.directions[1],G.directions[1]),P,G)&&(!!x(W.ed.Cross(P.directions[1],G.directions[2]),P,G)&&(!!x(W.ed.Cross(P.directions[2],G.directions[0]),P,G)&&(!!x(W.ed.Cross(P.directions[2],G.directions[1]),P,G)&&!!x(W.ed.Cross(P.directions[2],G.directions[2]),P,G))))))))))))))}}Y._TmpVector3=(0,G.b)(2,W.ed.Zero)},12033:(b,d,P)=>{P.d(d,{e:()=>i});var G=P(11691),W=P(11681);class i{constructor(b,d,P){this.center=W.ed.Zero(),this.centerWorld=W.ed.Zero(),this.minimum=W.ed.Zero(),this.maximum=W.ed.Zero(),this.reConstruct(b,d,P)}reConstruct(b,d,P){this.minimum.q(b),this.maximum.q(d);const G=W.ed.Distance(b,d);d.addToRef(b,this.center).scaleInPlace(.5),this.radius=.5*G,this._update(P||W.Matrix.IdentityReadOnly)}scale(b){const d=this.radius*b,P=i._TmpVector3,G=P[0].kd(d),W=this.center.subtractToRef(G,P[1]),q=this.center.addToRef(G,P[2]);return this.reConstruct(W,q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(b){if(b.isIdentity())this.centerWorld.q(this.center),this.radiusWorld=this.radius;else{W.ed.TransformCoordinatesToRef(this.center,b,this.centerWorld);const d=i._TmpVector3[0];W.ed.TransformNormalFromFloatsToRef(1,1,1,b,d),this.radiusWorld=Math.max(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z))*this.radius}}isInFrustum(b){const d=this.centerWorld,P=this.radiusWorld;for(let G=0;G<6;G++)if(b[G].dotCoordinate(d)<=-P)return!1;return!0}isCenterInFrustum(b){const d=this.centerWorld;for(let P=0;P<6;P++)if(b[P].dotCoordinate(d)<0)return!1;return!0}intersectsPoint(b){const d=W.ed.DistanceSquared(this.centerWorld,b);return!(this.radiusWorld*this.radiusWorld<d)}static Intersects(b,d){const P=W.ed.DistanceSquared(b.centerWorld,d.centerWorld),G=b.radiusWorld+d.radiusWorld;return!(G*G<P)}static CreateFromCenterAndRadius(b,d,P){this._TmpVector3[0].q(b),this._TmpVector3[1].Fd(0,0,d),this._TmpVector3[2].q(b),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].GY(this._TmpVector3[1]);const G=new i(this._TmpVector3[0],this._TmpVector3[2]);return G._worldMatrix=P||W.Matrix.Identity(),G}}i._TmpVector3=(0,G.b)(3,W.ed.Zero)},12049:(b,d,P)=>{function G(b){-1===b.indexOf("vClipPlane")&&b.push("vClipPlane"),-1===b.indexOf("vClipPlane2")&&b.push("vClipPlane2"),-1===b.indexOf("vClipPlane3")&&b.push("vClipPlane3"),-1===b.indexOf("vClipPlane4")&&b.push("vClipPlane4"),-1===b.indexOf("vClipPlane5")&&b.push("vClipPlane5"),-1===b.indexOf("vClipPlane6")&&b.push("vClipPlane6")}function W(b,d,P){const G=!!(b.clipPlane??d.clipPlane),W=!!(b.clipPlane2??d.clipPlane2),i=!!(b.clipPlane3??d.clipPlane3),q=!!(b.clipPlane4??d.clipPlane4),C=!!(b.clipPlane5??d.clipPlane5),J=!!(b.clipPlane6??d.clipPlane6);G&&P.push("#define CLIPPLANE"),W&&P.push("#define CLIPPLANE2"),i&&P.push("#define CLIPPLANE3"),q&&P.push("#define CLIPPLANE4"),C&&P.push("#define CLIPPLANE5"),J&&P.push("#define CLIPPLANE6")}function i(b,d,P){let G=!1;const W=!!(b.clipPlane??d.clipPlane),i=!!(b.clipPlane2??d.clipPlane2),q=!!(b.clipPlane3??d.clipPlane3),C=!!(b.clipPlane4??d.clipPlane4),J=!!(b.clipPlane5??d.clipPlane5),L=!!(b.clipPlane6??d.clipPlane6);return P.CLIPPLANE!==W&&(P.CLIPPLANE=W,G=!0),P.CLIPPLANE2!==i&&(P.CLIPPLANE2=i,G=!0),P.CLIPPLANE3!==q&&(P.CLIPPLANE3=q,G=!0),P.CLIPPLANE4!==C&&(P.CLIPPLANE4=C,G=!0),P.CLIPPLANE5!==J&&(P.CLIPPLANE5=J,G=!0),P.CLIPPLANE6!==L&&(P.CLIPPLANE6=L,G=!0),G}function q(b,d,P){let G=d.clipPlane??P.clipPlane;C(b,"vClipPlane",G),G=d.clipPlane2??P.clipPlane2,C(b,"vClipPlane2",G),G=d.clipPlane3??P.clipPlane3,C(b,"vClipPlane3",G),G=d.clipPlane4??P.clipPlane4,C(b,"vClipPlane4",G),G=d.clipPlane5??P.clipPlane5,C(b,"vClipPlane5",G),G=d.clipPlane6??P.clipPlane6,C(b,"vClipPlane6",G)}function C(b,d,P){P&&b.setFloat4(d,P.normal.x,P.normal.y,P.normal.z,P.d)}P.d(d,{c:()=>G,f:()=>q,g:()=>i,k:()=>W})},11984:(b,d,P)=>{P.d(d,{d:()=>G});class G{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(b,d){this._defines[b]||(b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b),this._defines[b]=new Array),this._defines[b].push(d)}addCPUSkinningFallback(b,d){this._mesh=d,b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(b,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,b=b.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;const P=this._mesh.Xb();for(let b=0;b<P.meshes.length;b++){const G=P.meshes[b];if(G.material){if(G.computeBonesUsingShaders&&0!==G.numBoneInfluencers)if(G.material.getEffect()===d)G.computeBonesUsingShaders=!1;else if(G.ld)for(const b of G.ld){if(b.effect===d){G.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&G.computeBonesUsingShaders&&G.numBoneInfluencers>0&&(G.computeBonesUsingShaders=!1)}}else{const d=this._defines[this._currentRank];if(d)for(let P=0;P<d.length;P++)b=b.replace("#define "+d[P],"");this._currentRank++}return b}}},11999:(b,d,P)=>{P.d(d,{e:()=>r});var G=P(11663),W=P(11670),i=P(11484),q=P(11487),C=P(11535),J=P(12007),L=P(11935),x=P(11504),Y=P(11733),s=P(11798),E=P(11716);class w{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(b){this._func=b}get funcRef(){return this._funcRef}set funcRef(b){this._funcRef=b}get funcMask(){return this._funcMask}set funcMask(b){this._funcMask=b}get opStencilFail(){return this._opStencilFail}set opStencilFail(b){this._opStencilFail=b}get opDepthFail(){return this._opDepthFail}set opDepthFail(b){this._opDepthFail=b}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(b){this._opStencilDepthPass=b}get mask(){return this._mask}set mask(b){this._mask=b}get enabled(){return this._enabled}set enabled(b){this._enabled=b}getClassName(){return"MaterialStencilState"}copyTo(b){E.c.Clone((()=>b),this)}serialize(){return E.c.Serialize(this)}parse(b,d,P){E.c.Parse((()=>this),b,d,P)}}(0,G.d)([(0,W.G)()],w.prototype,"func",null),(0,G.d)([(0,W.G)()],w.prototype,"funcRef",null),(0,G.d)([(0,W.G)()],w.prototype,"funcMask",null),(0,G.d)([(0,W.G)()],w.prototype,"opStencilFail",null),(0,G.d)([(0,W.G)()],w.prototype,"opDepthFail",null),(0,G.d)([(0,W.G)()],w.prototype,"opStencilDepthPass",null),(0,G.d)([(0,W.G)()],w.prototype,"mask",null),(0,G.d)([(0,W.G)()],w.prototype,"enabled",null);var t=P(12045);class r{get _supportGlowLayer(){return!1}set _glowModeEnabled(b){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(b){if(this._alpha===b)return;const d=this._alpha;this._alpha=b,1!==d&&1!==b||this.aL(r.MiscDirtyFlag+r.PrePassDirtyFlag)}get alpha(){return this._alpha}set md(b){this._backFaceCulling!==b&&(this._backFaceCulling=b,this.aL(r.TextureDirtyFlag))}get md(){return this._backFaceCulling}set cullBackFaces(b){this._cullBackFaces!==b&&(this._cullBackFaces=b,this.aL(r.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(b){this._blockDirtyMechanism!==b&&(this._blockDirtyMechanism=b,b||this.zY())}atomicMaterialsUpdate(b){this.blockDirtyMechanism=!0;try{b(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(b){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(b)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q.d),this._onBindObservable}set onBind(b){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(b)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new q.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new q.d),this._onEffectCreatedObservable}set alphaMode(b){this._alphaMode!==b&&(this._alphaMode=b,this.aL(r.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(b){this._needDepthPrePass!==b&&(this._needDepthPrePass=b,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(b){this._fogEnabled!==b&&(this._fogEnabled=b,this.aL(r.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(b){this.fillMode=b?r.WireFrameFillMode:r.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(b){this.fillMode=b?r.PointFillMode:r.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(b){this._fillMode!==b&&(this._fillMode=b,this.aL(r.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(b){const d=this.Xb().getEngine().getCaps().fragmentDepthSupported;b&&!d&&x.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=b&&d,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(b){this._drawWrapper=b}constructor(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Zd=new q.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new w,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=b;const W=d||C.e.LastCreatedScene;W&&(this._scene=W,this._dirtyCallbacks={},this._forceGLSL=G,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=b||i.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new s.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new L.e(this._scene.getEngine(),void 0,void 0,b),this._useUBO=this.Xb().getEngine().supportsUniformBuffers,this._createUniformBuffer(),P||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),r.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var b;const d=this.Xb().getEngine();null===(b=this._uniformBuffer)||void 0===b||b.dispose(),d.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new L.e(d,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new L.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(b){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.zY(),this.checkReadyOnlyOnce=!0}unfreeze(){this.zY(),this.checkReadyOnlyOnce=!1}isReady(b,d){return!0}isReadyForSubMesh(b,d,P){const G=d.materialDefines;return!!G&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=G,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Xb(){return this._scene}_getEffectiveOrientation(b){return null!==this.sideOrientation?this.sideOrientation:b.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(b){this._transparencyMode!==b&&(this._transparencyMode=b,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===r.MATERIAL_ALPHABLEND||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===r.MATERIAL_ALPHATEST||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===r.MATERIAL_OPAQUE||this._transparencyMode===r.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(b){return this._hasTransparencyMode?this._transparencyModeIsBlend:b.visibility<1||!this._disableAlphaBlending&&(b.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(b){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(b)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}zY(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this.Xb().meshes;for(const P of d)if(P.ld)for(const d of P.ld)if(d.ab()===this)for(const P of d._drawWrappers)P&&this._materialContext===P.materialContext&&(P._wasPreviouslyReady=!1,P._wasPreviouslyUsingInstances=null,P._forceRebindOnNextCall=b);b&&this.aL(r.AllDirtyFlag)}_preBind(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this._scene.getEngine(),G=(null==d?this.sideOrientation:d)===r.ClockWiseSideOrientation;return P.enableEffect(b||this._getDrawWrapper()),P.setState(this.md,this.zOffset,!1,G,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),G}bind(b,d){}buildUniformLayout(){const b=this._uniformBuffer;this._eventInfo.ubo=b,this._callbackPluginEventGeneric(8,this._eventInfo),b.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(b,d,P){const G=P._drawWrapper;this._eventInfo.subMesh=P,this._callbackPluginEventBindForSubMesh(this._eventInfo),G._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(b){}bindView(b){this._useUBO?this._needToBindSceneUbo=!0:b.setMatrix("view",this.Xb().getViewMatrix())}bindViewProjection(b){this._useUBO?this._needToBindSceneUbo=!0:(b.setMatrix("viewProjection",this.Xb().getTransformMatrix()),b.setMatrix("projection",this.Xb().getProjectionMatrix()))}bindEyePosition(b,d){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(b,d)}_afterBind(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&d&&(this._needToBindSceneUbo=!1,(0,t.g)(d,this.Xb().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=b?b.visibility:1,this._onBindObservable&&b&&this._onBindObservable.notifyObservers(b),this.disableDepthWrite){const b=this._scene.getEngine();this._cachedDepthWriteState=b.getDepthWrite(),b.setDepthWrite(!1)}if(this.disableColorWrite){const b=this._scene.getEngine();this._cachedColorWriteState=b.getColorWrite(),b.setColorWrite(!1)}if(0!==this.depthFunction){const b=this._scene.getEngine();this._cachedDepthFunctionState=b.getDepthFunction()||0,b.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(b){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=b,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(b){return null}_clonePlugins(b,d){const P={};if(this._serializePlugins(P),r._ParsePlugins(P,b,this._scene,d),this.pluginManager)for(const G of this.pluginManager._plugins){const d=b.pluginManager.getPlugin(G.name);d&&G.copyTo(d)}}getBindedMeshes(){if(this.meshMap){const b=[];for(const d in this.meshMap){const P=this.meshMap[d];P&&b.push(P)}return b}return this._scene.meshes.filter((b=>b.material===this))}forceCompilation(b,d,P,G){const W={clipPlane:!1,useInstances:!1,...P},i=this.Xb(),q=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const C=()=>{if(!this._scene||!this._scene.getEngine())return;const P=i.clipPlane;if(W.clipPlane&&(i.clipPlane=new Y.d(0,0,0,1)),this._storeEffectOnSubMeshes){let P=!0,i=null;if(b.ld){const d=new J.c(0,0,0,0,0,b,void 0,!1,!1);d.materialDefines&&(d.materialDefines._renderId=-1),this.isReadyForSubMesh(b,d,W.useInstances)||(d.effect&&d.effect.getCompilationError()&&d.effect.allFallbacksProcessed()?i=d.effect.getCompilationError():(P=!1,setTimeout(C,16)))}P&&(this.allowShaderHotSwapping=q,i&&G&&G(i),d&&d(this))}else this.isReady()?(this.allowShaderHotSwapping=q,d&&d(this)):setTimeout(C,16);W.clipPlane&&(i.clipPlane=P)};C()}async forceCompilationAsync(b,d){return await new Promise(((P,G)=>{this.forceCompilation(b,(()=>{P()}),d,(b=>{G(b)}))}))}aL(b){this.Xb().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(r._DirtyCallbackArray.length=0,b&r.ImageProcessingDirtyFlag&&r._DirtyCallbackArray.push(r._ImageProcessingDirtyCallBack),b&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),b&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),b&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),b&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),b&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),b&r.PrePassDirtyFlag&&r._DirtyCallbackArray.push(r._PrePassDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.Xb().resetCachedMaterial())}resetDrawCache(){const b=this.Xb().meshes;for(const d of b)if(d.ld)for(const b of d.ld)b.ab()===this&&b.resetDrawCache()}_markAllSubMeshesAsDirty(b){const d=this.Xb();if(d.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const P=d.meshes;for(const G of P)if(G.ld)for(const P of G.ld){if((P.ab()||(d._hasDefaultMaterial?d.defaultMaterial:null))===this)for(const d of P._drawWrappers)d&&d.defines&&d.defines.markAllAsDirty&&this._materialContext===d.materialContext&&b(d.defines)}}_markScenePrePassDirty(){if(this.Xb().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const b=this.Xb().enablePrePassRenderer();b&&b.aL()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(r._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(r._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const b=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Zd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(b)}))}}setPrePassRenderer(b){return!1}dispose(b,d,P){const G=this.Xb();if(G.stopAnimation(this),G.freeProcessedMaterials(),G.removeMaterial(this),this._eventInfo.forceDisposeTextures=d,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const b=this._parentContainer.materials.indexOf(this);b>-1&&this._parentContainer.materials.splice(b,1),this._parentContainer=null}if(!0!==P)if(this.meshMap)for(const W in this.meshMap){const b=this.meshMap[W];this._disposeMeshResources(b)}else{const b=G.meshes;for(const d of b)this._disposeMeshResources(d)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Zd.notifyObservers(this),this.Zd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(b){if(!b)return;const d=b.Qd,P=b._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(b.ld&&P)for(const W of b.ld){const b=W._drawWrappers;for(let i=0;i<b.length;i++){var G;const q=null===(G=b[i])||void 0===G?void 0:G.effect;if(!q)continue;P[i]===this&&(null===d||void 0===d||d._releaseVertexArrayObject(q),W._removeDrawWrapper(i,!0,!0))}}}else null===d||void 0===d||d._releaseVertexArrayObject(this._drawWrapper.effect);b.material!==this||b.sourceMesh||(b.material=null)}serialize(){const b=E.c.Serialize(this);return b.stencil=this.stencil.serialize(),b.uniqueId=this.uniqueId,this._serializePlugins(b),b}_serializePlugins(b){if(b.plugins={},this.pluginManager)for(const d of this.pluginManager._plugins)d.doNotSerialize||(b.plugins[d.getClassName()]=d.serialize())}static Parse(b,d,P){if(b.customType){if("BABYLON.PBRMaterial"===b.customType&&b.overloadedAlbedo&&(b.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return x.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else b.customType="BABYLON.StandardMaterial";const G=i.Tools.Instantiate(b.customType).Parse(b,d,P);return G._loadedUniqueId=b.uniqueId,G}static _ParsePlugins(b,d,P,G){if(b.plugins)for(const C in b.plugins){var W,q;const J=b.plugins[C];let L=null===(W=d.pluginManager)||void 0===W?void 0:W.getPlugin(J.name);if(!L){const b=i.Tools.Instantiate("BABYLON."+C);b&&(L=new b(d))}null===(q=L)||void 0===q||q.parse(J,P,G)}}}r.TriangleFillMode=0,r.WireFrameFillMode=1,r.PointFillMode=2,r.PointListDrawMode=3,r.LineListDrawMode=4,r.LineLoopDrawMode=5,r.LineStripDrawMode=6,r.TriangleStripDrawMode=7,r.TriangleFanDrawMode=8,r.ClockWiseSideOrientation=0,r.CounterClockWiseSideOrientation=1,r.ImageProcessingDirtyFlag=64,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.PrePassDirtyFlag=32,r.AllDirtyFlag=127,r.MATERIAL_OPAQUE=0,r.MATERIAL_ALPHATEST=1,r.MATERIAL_ALPHABLEND=2,r.MATERIAL_ALPHATESTANDBLEND=3,r.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,r.MATERIAL_NORMALBLENDMETHOD_RNM=1,r.OnEventObservable=new q.d,r._AllDirtyCallBack=b=>b.markAllAsDirty(),r._ImageProcessingDirtyCallBack=b=>b.markAsImageProcessingDirty(),r._TextureDirtyCallBack=b=>b.markAsTexturesDirty(),r._FresnelDirtyCallBack=b=>b.markAsFresnelDirty(),r._MiscDirtyCallBack=b=>b.markAsMiscDirty(),r._PrePassDirtyCallBack=b=>b.markAsPrePassDirty(),r._LightsDirtyCallBack=b=>b.markAsLightDirty(),r._AttributeDirtyCallBack=b=>b.markAsAttributesDirty(),r._FresnelAndMiscDirtyCallBack=b=>{r._FresnelDirtyCallBack(b),r._MiscDirtyCallBack(b)},r._TextureAndMiscDirtyCallBack=b=>{r._TextureDirtyCallBack(b),r._MiscDirtyCallBack(b)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=b=>{for(const d of r._DirtyCallbackArray)d(b)},(0,G.d)([(0,W.G)()],r.prototype,"id",void 0),(0,G.d)([(0,W.G)()],r.prototype,"uniqueId",void 0),(0,G.d)([(0,W.G)()],r.prototype,"name",void 0),(0,G.d)([(0,W.G)()],r.prototype,"metadata",void 0),(0,G.d)([(0,W.G)()],r.prototype,"checkReadyOnEveryCall",void 0),(0,G.d)([(0,W.G)()],r.prototype,"checkReadyOnlyOnce",void 0),(0,G.d)([(0,W.G)()],r.prototype,"state",void 0),(0,G.d)([(0,W.G)("alpha")],r.prototype,"_alpha",void 0),(0,G.d)([(0,W.G)("md")],r.prototype,"_backFaceCulling",void 0),(0,G.d)([(0,W.G)("cullBackFaces")],r.prototype,"_cullBackFaces",void 0),(0,G.d)([(0,W.G)()],r.prototype,"sideOrientation",void 0),(0,G.d)([(0,W.G)("alphaMode")],r.prototype,"_alphaMode",void 0),(0,G.d)([(0,W.G)()],r.prototype,"_needDepthPrePass",void 0),(0,G.d)([(0,W.G)()],r.prototype,"disableDepthWrite",void 0),(0,G.d)([(0,W.G)()],r.prototype,"disableColorWrite",void 0),(0,G.d)([(0,W.G)()],r.prototype,"forceDepthWrite",void 0),(0,G.d)([(0,W.G)()],r.prototype,"depthFunction",void 0),(0,G.d)([(0,W.G)()],r.prototype,"separateCullingPass",void 0),(0,G.d)([(0,W.G)("fogEnabled")],r.prototype,"_fogEnabled",void 0),(0,G.d)([(0,W.G)()],r.prototype,"pointSize",void 0),(0,G.d)([(0,W.G)()],r.prototype,"zOffset",void 0),(0,G.d)([(0,W.G)()],r.prototype,"zOffsetUnits",void 0),(0,G.d)([(0,W.G)()],r.prototype,"pointsCloud",null),(0,G.d)([(0,W.G)()],r.prototype,"fillMode",null),(0,G.d)([(0,W.G)()],r.prototype,"useLogarithmicDepth",null),(0,G.d)([(0,W.G)()],r.prototype,"transparencyMode",null)},12045:(b,d,P)=>{P.d(d,{C:()=>U,D:()=>e,F:()=>B,J:()=>M,L:()=>p,N:()=>S,P:()=>l,R:()=>j,T:()=>w,b:()=>o,c:()=>Y,d:()=>f,e:()=>x,f:()=>t,g:()=>r,h:()=>n,j:()=>u,l:()=>Z,p:()=>g,t:()=>X,v:()=>E,x:()=>s,z:()=>H});var G=P(11504),W=P(11725),i=P(11535),q=P(11980),C=P(12049);const J=W.Nd.Black(),L={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function x(b,d,P){if(!b||b.LOGARITHMICDEPTH||b.indexOf&&b.indexOf("LOGARITHMICDEPTH")>=0){const b=P.activeCamera;1===b.mode&&G.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),d.setFloat("logarithmicDepthConstant",2/(Math.log(b.maxZ+1)/Math.LN2))}}function Y(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];P&&b.fogEnabled&&(!d||d.applyFog)&&0!==b.fogMode&&(P.setFloat4("vFogInfos",b.fogMode,b.fogStart,b.fogEnd,b.fogDensity),G?(b.fogColor.toLinearSpaceToRef(J,b.getEngine().useExactSrgbConversions),P.setColor3("vFogColor",J)):P.setColor3("vFogColor",b.fogColor))}function s(b,d,P,G,W,i,q,C,J,x){const Y=b.numMaxInfluencers||b.numInfluencers;return Y<=0?0:(d.push("#define MORPHTARGETS"),b.hasPositions&&d.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),b.hasNormals&&d.push("#define MORPHTARGETTEXTURE_HASNORMALS"),b.hasTangents&&d.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),b.hasUVs&&d.push("#define MORPHTARGETTEXTURE_HASUVS"),b.hasUV2s&&d.push("#define MORPHTARGETTEXTURE_HASUV2S"),b.hasColors&&d.push("#define MORPHTARGETTEXTURE_HASCOLORS"),b.supportsPositions&&W&&d.push("#define MORPHTARGETS_POSITION"),b.supportsNormals&&i&&d.push("#define MORPHTARGETS_NORMAL"),b.supportsTangents&&q&&d.push("#define MORPHTARGETS_TANGENT"),b.supportsUVs&&C&&d.push("#define MORPHTARGETS_UV"),b.supportsUV2s&&J&&d.push("#define MORPHTARGETS_UV2"),b.supportsColors&&x&&d.push("#define MORPHTARGETS_COLOR"),d.push("#define NUM_MORPH_INFLUENCERS "+Y),b.isUsingTextureForTargets&&d.push("#define MORPHTARGETS_TEXTURE"),L.NUM_MORPH_INFLUENCERS=Y,L.NORMAL=i,L.TANGENT=q,L.UV=C,L.UV2=J,L.COLOR=x,E(P,G,L,W),Y)}function E(b,d,P){let W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=P.NUM_MORPH_INFLUENCERS;if(q>0&&i.e.LastCreatedEngine){const C=i.e.LastCreatedEngine.getCaps().maxVertexAttribs,J=d.morphTargetManager;if(null!==J&&void 0!==J&&J.isUsingTextureForTargets)return;const L=J&&J.supportsPositions&&W,x=J&&J.supportsNormals&&P.NORMAL,Y=J&&J.supportsTangents&&P.TANGENT,s=J&&J.supportsUVs&&P.UV1,E=J&&J.supportsUV2s&&P.UV2,w=J&&J.supportsColors&&P.VERTEXCOLOR;for(let P=0;P<q;P++)L&&b.push("position"+P),x&&b.push("normal"+P),Y&&b.push("tangent"+P),s&&b.push("uv_"+P),E&&b.push("uv2_"+P),w&&b.push("color"+P),b.length>C&&G.e.Error("Cannot add more vertex attributes for mesh "+d.name)}}function w(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b.push("world0"),b.push("world1"),b.push("world2"),b.push("world3"),d&&(b.push("previousWorld0"),b.push("previousWorld1"),b.push("previousWorld2"),b.push("previousWorld3"))}function t(b,d){const P=b.morphTargetManager;b&&P&&d.setFloatArray("morphTargetInfluences",P.influences)}function r(b,d){d.bindToEffect(b,"Scene")}function B(b,d,P){d._needUVs=!0,d[P]=!0,b.optimizeUVAllocation&&b.getTextureMatrix().isIdentityAs3x2()?(d[P+"DIRECTUV"]=b.coordinatesIndex+1,d["MAINUV"+(b.coordinatesIndex+1)]=!0):d[P+"DIRECTUV"]=0}function n(b,d,P){const G=b.getTextureMatrix();d.yd(P+"Matrix",G)}function Z(b,d,P){P.BAKED_VERTEX_ANIMATION_TEXTURE&&P.INSTANCES&&b.push("bakedVertexAnimationSettingsInstanced")}function o(b,d,P){var G;if(d&&b&&(b.computeBonesUsingShaders&&d._bonesComputationForcedToCPU&&(b.computeBonesUsingShaders=!1),b.useBones&&b.computeBonesUsingShaders&&b.skeleton)){const W=b.skeleton;if(W.isUsingTextureForMatrices&&d.getUniformIndex("boneTextureWidth")>-1){const P=W.getTransformMatrixTexture(b);d.setTexture("boneSampler",P),d.setFloat("boneTextureWidth",4*(W.bones.length+1))}else{const i=W.getTransformMatrices(b);i&&(d.setMatrices("mBones",i),P&&b.Xb().prePassRenderer&&b.Xb().prePassRenderer.getIndex(2)&&(P.previousBones[b.uniqueId]||(P.previousBones[b.uniqueId]=i.slice()),d.setMatrices("mPreviousBones",P.previousBones[b.uniqueId]),G=i,P.previousBones[b.uniqueId].set(G)))}}}function A(b,d,P,G,W){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];b._bindLight(d,P,G,W,i)}function f(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const i=Math.min(d.lightSources.length,W);for(let q=0;q<i;q++){A(d.lightSources[q],q,b,P,"boolean"===typeof G?G:G.SPECULARTERM,d.receiveShadows)}}function g(b,d,P,G){P.NUM_BONE_INFLUENCERS>0&&(G.addCPUSkinningFallback(0,d),b.push("matricesIndices"),b.push("matricesWeights"),P.NUM_BONE_INFLUENCERS>4&&(b.push("matricesIndicesExtra"),b.push("matricesWeightsExtra")))}function X(b,d){(d.INSTANCES||d.THIN_INSTANCES)&&w(b,!!d.PREPASS_VELOCITY),d.INSTANCESCOLOR&&b.push("instanceColor")}function u(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,W=0;for(let i=0;i<P&&b["LIGHT"+i];i++)i>0&&(W=G+i,d.addFallback(W,"LIGHT"+i)),b.SHADOWS||(b["SHADOW"+i]&&d.addFallback(G,"SHADOW"+i),b["SHADOWPCF"+i]&&d.addFallback(G,"SHADOWPCF"+i),b["SHADOWPCSS"+i]&&d.addFallback(G,"SHADOWPCSS"+i),b["SHADOWPOISSON"+i]&&d.addFallback(G,"SHADOWPOISSON"+i),b["SHADOWESM"+i]&&d.addFallback(G,"SHADOWESM"+i),b["SHADOWCLOSEESM"+i]&&d.addFallback(G,"SHADOWCLOSEESM"+i));return W++}function M(b,d,P,G,W,i,q){let C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];q._areMiscDirty&&(q.LOGARITHMICDEPTH=P,q.POINTSIZE=G,q.FOG=W&&function(b,d){return d.fogEnabled&&b.applyFog&&0!==d.fogMode}(b,d),q.NONUNIFORMSCALING=b.nonUniformScaling,q.ALPHATEST=i,q.DECAL_AFTER_DETAIL=C)}function e(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!P._areLightsDirty)return P._needNormals;let q=0;const C={needNormals:P._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(b.lightsEnabled&&!i)for(const L of d.lightSources)if(R(b,d,L,q,P,G,C),q++,q===W)break;P.SPECULARTERM=C.specularEnabled,P.SHADOWS=C.shadowEnabled;for(let L=q;L<W;L++)void 0!==P["LIGHT"+L]&&(P["LIGHT"+L]=!1,P["HEMILIGHT"+L]=!1,P["POINTLIGHT"+L]=!1,P["DIRLIGHT"+L]=!1,P["SPOTLIGHT"+L]=!1,P["AREALIGHT"+L]=!1,P["SHADOW"+L]=!1,P["SHADOWCSM"+L]=!1,P["SHADOWCSMDEBUG"+L]=!1,P["SHADOWCSMNUM_CASCADES"+L]=!1,P["SHADOWCSMUSESHADOWMAXZ"+L]=!1,P["SHADOWCSMNOBLEND"+L]=!1,P["SHADOWCSM_RIGHTHANDED"+L]=!1,P["SHADOWPCF"+L]=!1,P["SHADOWPCSS"+L]=!1,P["SHADOWPOISSON"+L]=!1,P["SHADOWESM"+L]=!1,P["SHADOWCLOSEESM"+L]=!1,P["SHADOWCUBE"+L]=!1,P["SHADOWLOWQUALITY"+L]=!1,P["SHADOWMEDIUMQUALITY"+L]=!1);const J=b.getEngine().getCaps();return void 0===P.SHADOWFLOAT&&(C.needRebuild=!0),P.SHADOWFLOAT=C.shadowEnabled&&(J.textureFloatRender&&J.textureFloatLinearFiltering||J.textureHalfFloatRender&&J.textureHalfFloatLinearFiltering),P.LIGHTMAPEXCLUDED=C.lightmapMode,C.needRebuild&&P.rebuild(),C.needNormals}function R(b,d,P,G,W,i,C){switch(C.needNormals=!0,void 0===W["LIGHT"+G]&&(C.needRebuild=!0),W["LIGHT"+G]=!0,W["SPOTLIGHT"+G]=!1,W["HEMILIGHT"+G]=!1,W["POINTLIGHT"+G]=!1,W["DIRLIGHT"+G]=!1,W["AREALIGHT"+G]=!1,P.prepareLightSpecificDefines(W,G),W["LIGHT_FALLOFF_PHYSICAL"+G]=!1,W["LIGHT_FALLOFF_GLTF"+G]=!1,W["LIGHT_FALLOFF_STANDARD"+G]=!1,P.falloffType){case q.d.FALLOFF_GLTF:W["LIGHT_FALLOFF_GLTF"+G]=!0;break;case q.d.FALLOFF_PHYSICAL:W["LIGHT_FALLOFF_PHYSICAL"+G]=!0;break;case q.d.FALLOFF_STANDARD:W["LIGHT_FALLOFF_STANDARD"+G]=!0}if(i&&!P.Cx.equalsFloats(0,0,0)&&(C.specularEnabled=!0),W["SHADOW"+G]=!1,W["SHADOWCSM"+G]=!1,W["SHADOWCSMDEBUG"+G]=!1,W["SHADOWCSMNUM_CASCADES"+G]=!1,W["SHADOWCSMUSESHADOWMAXZ"+G]=!1,W["SHADOWCSMNOBLEND"+G]=!1,W["SHADOWCSM_RIGHTHANDED"+G]=!1,W["SHADOWPCF"+G]=!1,W["SHADOWPCSS"+G]=!1,W["SHADOWPOISSON"+G]=!1,W["SHADOWESM"+G]=!1,W["SHADOWCLOSEESM"+G]=!1,W["SHADOWCUBE"+G]=!1,W["SHADOWLOWQUALITY"+G]=!1,W["SHADOWMEDIUMQUALITY"+G]=!1,d&&d.receiveShadows&&b.shadowsEnabled&&P.shadowEnabled){const d=P.getShadowGenerator(b.activeCamera)??P.getShadowGenerator();if(d){const b=d.getShadowMap();b&&b.renderList&&b.renderList.length>0&&(C.shadowEnabled=!0,d.prepareDefines(W,G))}}P.lightmapMode!=q.d.LIGHTMAP_DEFAULT?(C.lightmapMode=!0,W["LIGHTMAPEXCLUDED"+G]=!0,W["LIGHTMAPNOSPECULAR"+G]=P.lightmapMode==q.d.LIGHTMAP_SHADOWSONLY):(W["LIGHTMAPEXCLUDED"+G]=!1,W["LIGHTMAPNOSPECULAR"+G]=!1)}function U(b,d,P,G,W){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=function(b,d){let P=!1;if(b.activeCamera){const G=d.CAMERA_ORTHOGRAPHIC?1:0,W=d.CAMERA_PERSPECTIVE?1:0,i=1===b.activeCamera.mode?1:0,q=0===b.activeCamera.mode?1:0;(G^i||W^q)&&(d.CAMERA_ORTHOGRAPHIC=1===i,d.CAMERA_PERSPECTIVE=1===q,P=!0)}return P}(b,G);!1!==i&&(J=(0,C.g)(P,b,G)),G.DEPTHPREPASS!==!d.getColorWrite()&&(G.DEPTHPREPASS=!G.DEPTHPREPASS,J=!0),G.INSTANCES!==W&&(G.INSTANCES=W,J=!0),G.THIN_INSTANCES!==q&&(G.THIN_INSTANCES=q,J=!0),J&&G.markAsUnprocessed()}function H(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!d._areAttributesDirty&&d._needNormals===d._normals&&d._needUVs===d._uvs)return!1;d._normals=d._needNormals,d._uvs=d._needUVs,d.NORMAL=d._needNormals&&b.isVerticesDataPresent("normal"),d._needNormals&&b.isVerticesDataPresent("tangent")&&(d.TANGENT=!0);for(let C=1;C<=6;++C)d["UV"+C]=!!d._needUVs&&b.isVerticesDataPresent(`uv${1===C?"":C}`);if(P){const P=b.useVertexColors&&b.isVerticesDataPresent("color");d.VERTEXCOLOR=P,d.VERTEXALPHA=b.hasVertexAlpha&&P&&i}return b.isVerticesDataPresent("instanceColor")&&(b.hasInstances||b.hasThinInstances)&&(d.INSTANCESCOLOR=!0),G&&function(b,d){if(b.useBones&&b.computeBonesUsingShaders&&b.skeleton){d.NUM_BONE_INFLUENCERS=b.numBoneInfluencers;const P=void 0!==d.BONETEXTURE;if(b.skeleton.isUsingTextureForMatrices&&P)d.BONETEXTURE=!0;else{d.BonesPerMesh=b.skeleton.bones.length+1,d.BONETEXTURE=!P&&void 0;const G=b.Xb().prePassRenderer;if(G&&G.enabled){const P=-1===G.excludedSkinnedMesh.indexOf(b);d.BONES_VELOCITY_ENABLED=P}}}else d.NUM_BONE_INFLUENCERS=0,d.BonesPerMesh=0,void 0!==d.BONETEXTURE&&(d.BONETEXTURE=!1)}(b,d),W&&function(b,d){const P=b.morphTargetManager;P?(d.MORPHTARGETS_UV=P.supportsUVs&&d.UV1,d.MORPHTARGETS_UV2=P.supportsUV2s&&d.UV2,d.MORPHTARGETS_TANGENT=P.supportsTangents&&d.TANGENT,d.MORPHTARGETS_NORMAL=P.supportsNormals&&d.NORMAL,d.MORPHTARGETS_POSITION=P.supportsPositions,d.MORPHTARGETS_COLOR=P.supportsColors,d.MORPHTARGETTEXTURE_HASUVS=P.hasUVs,d.MORPHTARGETTEXTURE_HASUV2S=P.hasUV2s,d.MORPHTARGETTEXTURE_HASTANGENTS=P.hasTangents,d.MORPHTARGETTEXTURE_HASNORMALS=P.hasNormals,d.MORPHTARGETTEXTURE_HASPOSITIONS=P.hasPositions,d.MORPHTARGETTEXTURE_HASCOLORS=P.hasColors,d.NUM_MORPH_INFLUENCERS=P.numMaxInfluencers||P.numInfluencers,d.MORPHTARGETS=d.NUM_MORPH_INFLUENCERS>0,d.MORPHTARGETS_TEXTURE=P.isUsingTextureForTargets):(d.MORPHTARGETS_UV=!1,d.MORPHTARGETS_UV2=!1,d.MORPHTARGETS_TANGENT=!1,d.MORPHTARGETS_NORMAL=!1,d.MORPHTARGETS_POSITION=!1,d.MORPHTARGETS_COLOR=!1,d.MORPHTARGETTEXTURE_HASUVS=!1,d.MORPHTARGETTEXTURE_HASUV2S=!1,d.MORPHTARGETTEXTURE_HASTANGENTS=!1,d.MORPHTARGETTEXTURE_HASNORMALS=!1,d.MORPHTARGETTEXTURE_HASPOSITIONS=!1,d.MORPHTARGETTEXTURE_HAS_COLORS=!1,d.MORPHTARGETS=!1,d.NUM_MORPH_INFLUENCERS=0)}(b,d),q&&function(b,d){const P=b.bakedVertexAnimationManager;d.BAKED_VERTEX_ANIMATION_TEXTURE=!(!P||!P.isEnabled)}(b,d),!0}function p(b,d){if(b.activeCamera){const P=d.MULTIVIEW;d.MULTIVIEW=null!==b.activeCamera.outputRenderTarget&&b.activeCamera.outputRenderTarget.getViewCount()>1,d.MULTIVIEW!=P&&d.markAsUnprocessed()}}function S(b,d,P){const G=d.ORDER_INDEPENDENT_TRANSPARENCY,W=d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;d.ORDER_INDEPENDENT_TRANSPARENCY=b.useOrderIndependentTransparency&&P,d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!b.getEngine().getCaps().textureFloatLinearFiltering,G===d.ORDER_INDEPENDENT_TRANSPARENCY&&W===d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||d.markAsUnprocessed()}function l(b,d,P){const G=d.PREPASS;if(!d._arePrePassDirty)return;const W=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(b.prePassRenderer&&b.prePassRenderer.enabled&&P){d.PREPASS=!0,d.SCENE_MRT_COUNT=b.prePassRenderer.mrtCount,d.PREPASS_NORMAL_WORLDSPACE=b.prePassRenderer.generateNormalsInWorldSpace,d.PREPASS_COLOR=!0,d.PREPASS_COLOR_INDEX=0;for(let P=0;P<W.length;P++){const G=b.prePassRenderer.getIndex(W[P].type);-1!==G?(d[W[P].define]=!0,d[W[P].index]=G):d[W[P].define]=!1}}else{d.PREPASS=!1;for(let b=0;b<W.length;b++)d[W[b].define]=!1}d.PREPASS!=G&&(d.markAsUnprocessed(),d.markAsImageProcessingDirty())}function N(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];W&&W.push("Light"+b),i||(d.push("vLightData"+b,"vLightDiffuse"+b,"vLightSpecular"+b,"vLightDirection"+b,"vLightWidth"+b,"vLightHeight"+b,"vLightFalloff"+b,"vLightGround"+b,"lightMatrix"+b,"shadowsInfo"+b,"depthValues"+b),P.push("shadowTexture"+b),P.push("depthTexture"+b),d.push("viewFrustumZ"+b,"cascadeBlendFactor"+b,"lightSizeUVCorrection"+b,"depthCorrection"+b,"penumbraDarkness"+b,"frustumLengths"+b),G&&(P.push("projectionLightTexture"+b),d.push("textureProjectionMatrix"+b)),q&&P.push("iesLightTexture"+b))}function j(b,d,P){let G,W,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(b.uniformsNames){const q=b;G=q.uniformsNames,W=q.uniformBuffersNames,d=q.samplers,P=q.defines,i=q.maxSimultaneousLights||0}else G=b,d||(d=[]);for(let q=0;q<i&&P["LIGHT"+q];q++)N(q,G,d,P["PROJECTEDLIGHTTEXTURE"+q],W,!1,P["IESLIGHTTEXTURE"+q]);P.NUM_MORPH_INFLUENCERS&&(G.push("morphTargetInfluences"),G.push("morphTargetCount")),P.BAKED_VERTEX_ANIMATION_TEXTURE&&(G.push("bakedVertexAnimationSettings"),G.push("bakedVertexAnimationTextureSizeInverted"),G.push("bakedVertexAnimationTime"),d.push("bakedVertexAnimationTexture"))}},11990:(b,d,P)=>{P.d(d,{c:()=>i});var G=P(11681),W=P(11999);class i extends W.e{constructor(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(b,d,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new G.Matrix,this._storeEffectOnSubMeshes=P}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(b,d){return!!b&&(!this._storeEffectOnSubMeshes||(!b.ld||0===b.ld.length||this.isReadyForSubMesh(b,b.ld[0],d)))}_isReadyForSubMesh(b){const d=b.materialDefines;return!(this.checkReadyOnEveryCall||!b.effect||!d||d._renderId!==this.Xb().getRenderId())}bindOnlyWorldMatrix(b){this._activeEffect.setMatrix("world",b)}bindOnlyNormalMatrix(b){this._activeEffect.setMatrix("normalMatrix",b)}bind(b,d){d&&this.bindForSubMesh(b,d,d.ld[0])}_afterBind(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;super._afterBind(b,d,P),this.Xb()._cachedEffect=d,P?P._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return P._drawWrapper._forceRebindOnNextCall||b.isCachedMaterialInvalid(this,d,G)}dispose(b,d,P){this._activeEffect=void 0,super.dispose(b,d,P)}}},12040:(b,d,P)=>{P.d(d,{d:()=>C,e:()=>J});var G=P(11663),W=P(11681),i=P(11670);class q{static extractMinAndMaxIndexed(b,d,P,G,W,i){for(let q=P;q<P+G;q++){const P=3*d[q],G=b[P],C=b[P+1],J=b[P+2];W.minimizeInPlaceFromFloats(G,C,J),i.maximizeInPlaceFromFloats(G,C,J)}}static extractMinAndMax(b,d,P,G,W,i){for(let q=d,C=d*G;q<d+P;q++,C+=G){const d=b[C],P=b[C+1],G=b[C+2];W.minimizeInPlaceFromFloats(d,P,G),i.maximizeInPlaceFromFloats(d,P,G)}}}function C(b,d,P,G){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const C=new W.ed(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new W.ed(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return q.extractMinAndMaxIndexed(b,d,P,G,C,J),i&&(C.x-=C.x*i.x+i.y,C.y-=C.y*i.x+i.y,C.z-=C.z*i.x+i.y,J.x+=J.x*i.x+i.y,J.y+=J.y*i.x+i.y,J.z+=J.z*i.x+i.y),{minimum:C,maximum:J}}function J(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;const C=new W.ed(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new W.ed(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return i||(i=3),q.extractMinAndMax(b,d,P,i,C,J),G&&(C.x-=C.x*G.x+G.y,C.y-=C.y*G.x+G.y,C.z-=C.z*G.x+G.y,J.x+=J.x*G.x+G.y,J.y+=J.y*G.x+G.y,J.z+=J.z*G.x+G.y),{minimum:C,maximum:J}}(0,G.d)([i.h.filter((function(){for(var b=arguments.length,d=new Array(b),P=0;P<b;P++)d[P]=arguments[P];let[G,W]=d;return!Array.isArray(G)&&!Array.isArray(W)}))],q,"extractMinAndMaxIndexed",null),(0,G.d)([i.h.filter((function(){for(var b=arguments.length,d=new Array(b),P=0;P<b;P++)d[P]=arguments[P];let[G]=d;return!Array.isArray(G)}))],q,"extractMinAndMax",null)},12007:(b,d,P)=>{P.d(d,{c:()=>J});var G=P(11752),W=P(12013),i=P(12018),q=P(12040),C=P(11798);class J{get materialDefines(){var b;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(b=this._getDrawWrapper())||void 0===b?void 0:b.defines}set materialDefines(b){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=b}_getDrawWrapper(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b=b??this._engine.currentRenderPassId;let P=this._drawWrappers[b];return!P&&d&&(this._drawWrappers[b]=P=new C.b(this._mesh.Xb().getEngine())),P}_removeDrawWrapper(b){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var P;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(P=this._drawWrappers[b])||void 0===P||P.dispose(d));this._drawWrappers[b]=void 0}get effect(){var b;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(b=this._getDrawWrapper())||void 0===b?void 0:b.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(b){this._mainDrawWrapperOverride=b}setEffect(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const W=this._drawWrapper;W.setEffect(b,d,G),void 0!==P&&(W.materialContext=P),b||(W.defines=null,W.materialContext=void 0)}resetDrawCache(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==b)return void this._removeDrawWrapper(b,!0,d);for(const b of this._drawWrappers)null===b||void 0===b||b.dispose(d)}this._drawWrappers=[]}static AddToMesh(b,d,P,G,W,i,q){return new J(b,d,P,G,W,i,q,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(b,d,P,G,W,i,q){let C=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],J=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=b,this.verticesStart=d,this.verticesCount=P,this.indexStart=G,this.indexCount=W,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=i,this._renderingMesh=q||i,J&&i.ld.push(this),this._engine=this._mesh.Xb().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=i.ld.length-1,C&&(this.refreshBoundingInfo(),i.zd(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(b){return this._boundingInfo=b,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const b=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return b||this._renderingMesh}ab(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!d)return b&&this._mesh.Xb()._hasDefaultMaterial?this._mesh.Xb().defaultMaterial:null;if(this._isMultiMaterial(d)){const b=d.getSubMaterial(this.materialIndex);return this._currentMaterial!==b&&(this._currentMaterial=b,this.resetDrawCache()),b}return d}_isMultiMaterial(b){return void 0!==b.getSubMaterial}refreshBoundingInfo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Qd)return this;if(b||(b=this._renderingMesh.getVerticesData(G.c.PositionKind)),!b)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const d=this._renderingMesh.Id();let P;if(0===this.indexStart&&this.indexCount===d.length){const b=this._renderingMesh.getBoundingInfo();P={minimum:b.minimum.clone(),maximum:b.maximum.clone()}}else P=(0,q.d)(b,d,this.indexStart,this.indexCount,this._renderingMesh.Qd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(P.minimum,P.maximum):this._boundingInfo=new i.d(P.minimum,P.maximum),this}_checkCollision(b){return this.getBoundingInfo()._checkCollision(b)}updateBoundingInfo(b){let d=this.getBoundingInfo();return d||(this.refreshBoundingInfo(),d=this.getBoundingInfo()),d&&d.update(b),this}isInFrustum(b){const d=this.getBoundingInfo();return!!d&&d.isInFrustum(b,this._mesh.rY)}isCompletelyInFrustum(b){const d=this.getBoundingInfo();return!!d&&d.isCompletelyInFrustum(b)}render(b){return this._renderingMesh.render(this,b,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(b,d){if(!this._linesIndexBuffer){const P=6*Math.floor(this.indexCount/3),G=this.verticesStart+this.verticesCount>65535?new Uint32Array(P):new Uint16Array(P);let W=0;if(0===b.length)for(let b=this.indexStart;b<this.indexStart+this.indexCount;b+=3)G[W++]=b,G[W++]=b+1,G[W++]=b+1,G[W++]=b+2,G[W++]=b+2,G[W++]=b;else for(let d=this.indexStart;d<this.indexStart+this.indexCount;d+=3)G[W++]=b[d],G[W++]=b[d+1],G[W++]=b[d+1],G[W++]=b[d+2],G[W++]=b[d+2],G[W++]=b[d];this._linesIndexBuffer=d.createIndexBuffer(G),this._linesIndexCount=G.length}return this._linesIndexBuffer}canIntersects(b){const d=this.getBoundingInfo();return!!d&&b.intersectsBox(d.boundingBox)}intersects(b,d,P,G,W){const i=this.ab();if(!i)return null;let q=3,C=!1;switch(i.fillMode){case 3:case 5:case 6:case 8:return null;case 7:q=1,C=!0}return 4===i.fillMode?P.length?this._intersectLines(b,d,P,this._mesh.intersectionThreshold,G):this._intersectUnIndexedLines(b,d,P,this._mesh.intersectionThreshold,G):!P.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(b,d,P,G,W):this._intersectTriangles(b,d,P,q,C,G,W)}_intersectLines(b,d,P,G,i){let q=null;for(let C=this.indexStart;C<this.indexStart+this.indexCount;C+=2){const J=d[P[C]],L=d[P[C+1]],x=b.intersectionSegment(J,L,G);if(!(x<0)&&((i||!q||x<q.distance)&&(q=new W.b(null,null,x),q.faceId=C/2,i)))break}return q}_intersectUnIndexedLines(b,d,P,G,i){let q=null;for(let C=this.verticesStart;C<this.verticesStart+this.verticesCount;C+=2){const P=d[C],J=d[C+1],L=b.intersectionSegment(P,J,G);if(!(L<0)&&((i||!q||L<q.distance)&&(q=new W.b(null,null,L),q.faceId=C/2,i)))break}return q}_intersectTriangles(b,d,P,G,W,i,q){let C=null,J=-1;for(let L=this.indexStart;L<this.indexStart+this.indexCount-(3-G);L+=G){J++;const G=P[L],x=P[L+1],Y=P[L+2];if(W&&4294967295===Y){L+=2;continue}const s=d[G],E=d[x],w=d[Y];if(!s||!E||!w)continue;if(q&&!q(s,E,w,b,G,x,Y))continue;const t=b.intersectsTriangle(s,E,w);if(t){if(t.distance<0)continue;if((i||!C||t.distance<C.distance)&&(C=t,C.faceId=J,i))break}}return C}_intersectUnIndexedTriangles(b,d,P,G,W){let i=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=3){const P=d[q],C=d[q+1],J=d[q+2];if(W&&!W(P,C,J,b,-1,-1,-1))continue;const L=b.intersectsTriangle(P,C,J);if(L){if(L.distance<0)continue;if((G||!i||L.distance<i.distance)&&(i=L,i.faceId=q/3,G))break}}return i}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(b,d){const P=new J(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,b,d,!1);if(!this.IsGlobal){const b=this.getBoundingInfo();if(!b)return P;P._boundingInfo=new i.d(b.minimum,b.maximum)}return P}dispose(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Xb().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const d=this._mesh.ld.indexOf(this);this._mesh.ld.splice(d,1),this.resetDrawCache(void 0,b)}getClassName(){return"SubMesh"}static CreateFromIndices(b,d,P,G,W){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=Number.MAX_VALUE,C=-Number.MAX_VALUE;const L=(W||G).Id();for(let J=d;J<d+P;J++){const b=L[J];b<q&&(q=b),b>C&&(C=b)}return new J(b,q,C-q+1,d,P,G,W,i)}}}}]);