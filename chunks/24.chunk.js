"use strict";(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[24],{12647:(y,c,A)=>{A.d(c,{b:()=>l});class l{constructor(y,c,A){this.bu=y,this.bv=c,this.distance=A,this.faceId=0,this.subMeshId=0}}},12660:(y,c,A)=>{A.d(c,{b:()=>p});var l=A(12337),w=A(12325),N=A(12330);class p{constructor(y,c,A){this.vectors=(0,l.d)(8,w.gc.Zero),this.center=w.gc.Zero(),this.centerWorld=w.gc.Zero(),this.extendSize=w.gc.Zero(),this.extendSizeWorld=w.gc.Zero(),this.directions=(0,l.d)(3,w.gc.Zero),this.vectorsWorld=(0,l.d)(8,w.gc.Zero),this.minimumWorld=w.gc.Zero(),this.maximumWorld=w.gc.Zero(),this.minimum=w.gc.Zero(),this.maximum=w.gc.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(y,c,A)}reConstruct(y,c,A){const l=y.x,N=y.y,p=y.z,W=c.x,h=c.y,I=c.z,q=this.vectors;this.minimum.Ec(l,N,p),this.maximum.Ec(W,h,I),q[0].Ec(l,N,p),q[1].Ec(W,h,I),q[2].Ec(W,N,p),q[3].Ec(l,h,p),q[4].Ec(l,N,I),q[5].Ec(W,h,p),q[6].Ec(l,h,I),q[7].Ec(W,N,I),c.addToRef(y,this.center).scaleInPlace(.5),c.subtractToRef(y,this.extendSize).scaleInPlace(.5),this._worldMatrix=A||w.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(y){const c=p._TmpVector3,A=this.maximum.subtractToRef(this.minimum,c[0]),l=A.length();A.normalizeFromLength(l);const w=l*y,N=A.scaleInPlace(.5*w),W=this.center.subtractToRef(N,c[1]),h=this.center.addToRef(N,c[2]);return this.reConstruct(W,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(y){const c=this.minimumWorld,A=this.maximumWorld,l=this.directions,N=this.vectorsWorld,p=this.vectors;if(y.isIdentity()){c.p(this.minimum),A.p(this.maximum);for(let y=0;y<8;++y)N[y].p(p[y]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{c.vc(Number.MAX_VALUE),A.vc(-Number.MAX_VALUE);for(let l=0;l<8;++l){const W=N[l];w.gc.TransformCoordinatesToRef(p[l],y,W),c.minimizeInPlace(W),A.maximizeInPlace(W)}A.subtractToRef(c,this.extendSizeWorld).scaleInPlace(.5),A.addToRef(c,this.centerWorld).scaleInPlace(.5)}w.gc.FromArrayToRef(y.m,0,l[0]),w.gc.FromArrayToRef(y.m,4,l[1]),w.gc.FromArrayToRef(y.m,8,l[2]),this._worldMatrix=y}isInFrustum(y){return p.IsInFrustum(this.vectorsWorld,y)}isCompletelyInFrustum(y){return p.IsCompletelyInFrustum(this.vectorsWorld,y)}intersectsPoint(y){const c=this.minimumWorld,A=this.maximumWorld,l=c.x,w=c.y,p=c.z,W=A.x,h=A.y,I=A.z,q=y.x,o=y.y,O=y.z,L=-N.b;return!(W-q<L||L>q-l)&&(!(h-o<L||L>o-w)&&!(I-O<L||L>O-p))}intersectsSphere(y){return p.IntersectsSphere(this.minimumWorld,this.maximumWorld,y.centerWorld,y.radiusWorld)}intersectsMinMax(y,c){const A=this.minimumWorld,l=this.maximumWorld,w=A.x,N=A.y,p=A.z,W=l.x,h=l.y,I=l.z,q=y.x,o=y.y,O=y.z,L=c.x,i=c.y,H=c.z;return!(W<q||w>L)&&(!(h<o||N>i)&&!(I<O||p>H))}dispose(){var y,c;null===(y=this._drawWrapperFront)||void 0===y||y.dispose(),null===(c=this._drawWrapperBack)||void 0===c||c.dispose()}static Intersects(y,c){return y.intersectsMinMax(c.minimumWorld,c.maximumWorld)}static IntersectsSphere(y,c,A,l){const N=p._TmpVector3[0];w.gc.ClampToRef(A,y,c,N);return w.gc.DistanceSquared(A,N)<=l*l}static IsCompletelyInFrustum(y,c){for(let A=0;A<6;++A){const l=c[A];for(let c=0;c<8;++c)if(l.dotCoordinate(y[c])<0)return!1}return!0}static IsInFrustum(y,c){for(let A=0;A<6;++A){let l=!0;const w=c[A];for(let c=0;c<8;++c)if(w.dotCoordinate(y[c])>=0){l=!1;break}if(l)return!1}return!0}}p._TmpVector3=(0,l.d)(3,w.gc.Zero)},12654:(y,c,A)=>{A.d(c,{d:()=>o});var l=A(12337),w=A(12325),N=A(12660),p=A(12667);const W={min:0,max:0},h={min:0,max:0},I=(y,c,A)=>{const l=w.gc.Dot(c.centerWorld,y),N=Math.abs(w.gc.Dot(c.directions[0],y))*c.extendSize.x+Math.abs(w.gc.Dot(c.directions[1],y))*c.extendSize.y+Math.abs(w.gc.Dot(c.directions[2],y))*c.extendSize.z;A.min=l-N,A.max=l+N},q=(y,c,A)=>(I(y,c,W),I(y,A,h),!(W.min>h.max||h.min>W.max));class o{constructor(y,c,A){this._isLocked=!1,this.boundingBox=new N.b(y,c,A),this.boundingSphere=new p.e(y,c,A)}reConstruct(y,c,A){this.boundingBox.reConstruct(y,c,A),this.boundingSphere.reConstruct(y,c,A)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(y){this._isLocked=y}update(y){this._isLocked||(this.boundingBox._update(y),this.boundingSphere._update(y))}centerOn(y,c){const A=o._TmpVector3[0].p(y).uo(c),l=o._TmpVector3[1].p(y).addInPlace(c);return this.boundingBox.reConstruct(A,l,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(A,l,this.boundingBox.getWorldMatrix()),this}encapsulate(y){const c=w.gc.Minimize(this.minimum,y),A=w.gc.Maximize(this.maximum,y);return this.reConstruct(c,A,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(y){const c=w.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(c);const A=w.TmpVectors.gc[0];return w.gc.TransformCoordinatesToRef(y.boundingBox.minimumWorld,c,A),this.encapsulate(A),w.gc.TransformCoordinatesToRef(y.boundingBox.maximumWorld,c,A),this.encapsulate(A),this}scale(y){return this.boundingBox.scale(y),this.boundingSphere.scale(y),this}isInFrustum(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===c||3===c)&&this.boundingSphere.isCenterInFrustum(y))return!0;if(!this.boundingSphere.isInFrustum(y))return!1;return!(1!==c&&3!==c)||this.boundingBox.isInFrustum(y)}get diagonalLength(){const y=this.boundingBox;return y.maximumWorld.subtractToRef(y.minimumWorld,o._TmpVector3[0]).length()}isCompletelyInFrustum(y){return this.boundingBox.isCompletelyInFrustum(y)}_checkCollision(y){return y._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(y){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(y)&&!!this.boundingBox.intersectsPoint(y))}intersects(y,c){if(!p.e.Intersects(this.boundingSphere,y.boundingSphere))return!1;if(!N.b.Intersects(this.boundingBox,y.boundingBox))return!1;if(!c)return!0;const A=this.boundingBox,l=y.boundingBox;return!!q(A.directions[0],A,l)&&(!!q(A.directions[1],A,l)&&(!!q(A.directions[2],A,l)&&(!!q(l.directions[0],A,l)&&(!!q(l.directions[1],A,l)&&(!!q(l.directions[2],A,l)&&(!!q(w.gc.Cross(A.directions[0],l.directions[0]),A,l)&&(!!q(w.gc.Cross(A.directions[0],l.directions[1]),A,l)&&(!!q(w.gc.Cross(A.directions[0],l.directions[2]),A,l)&&(!!q(w.gc.Cross(A.directions[1],l.directions[0]),A,l)&&(!!q(w.gc.Cross(A.directions[1],l.directions[1]),A,l)&&(!!q(w.gc.Cross(A.directions[1],l.directions[2]),A,l)&&(!!q(w.gc.Cross(A.directions[2],l.directions[0]),A,l)&&(!!q(w.gc.Cross(A.directions[2],l.directions[1]),A,l)&&!!q(w.gc.Cross(A.directions[2],l.directions[2]),A,l))))))))))))))}}o._TmpVector3=(0,l.d)(2,w.gc.Zero)},12667:(y,c,A)=>{A.d(c,{e:()=>N});var l=A(12337),w=A(12325);class N{constructor(y,c,A){this.center=w.gc.Zero(),this.centerWorld=w.gc.Zero(),this.minimum=w.gc.Zero(),this.maximum=w.gc.Zero(),this.reConstruct(y,c,A)}reConstruct(y,c,A){this.minimum.p(y),this.maximum.p(c);const l=w.gc.Distance(y,c);c.addToRef(y,this.center).scaleInPlace(.5),this.radius=.5*l,this._update(A||w.Matrix.IdentityReadOnly)}scale(y){const c=this.radius*y,A=N._TmpVector3,l=A[0].vc(c),w=this.center.subtractToRef(l,A[1]),p=this.center.addToRef(l,A[2]);return this.reConstruct(w,p,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(y){if(y.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{w.gc.TransformCoordinatesToRef(this.center,y,this.centerWorld);const c=N._TmpVector3[0];w.gc.TransformNormalFromFloatsToRef(1,1,1,y,c),this.radiusWorld=Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))*this.radius}}isInFrustum(y){const c=this.centerWorld,A=this.radiusWorld;for(let l=0;l<6;l++)if(y[l].dotCoordinate(c)<=-A)return!1;return!0}isCenterInFrustum(y){const c=this.centerWorld;for(let A=0;A<6;A++)if(y[A].dotCoordinate(c)<0)return!1;return!0}intersectsPoint(y){const c=w.gc.DistanceSquared(this.centerWorld,y);return!(this.radiusWorld*this.radiusWorld<c)}static Intersects(y,c){const A=w.gc.DistanceSquared(y.centerWorld,c.centerWorld),l=y.radiusWorld+c.radiusWorld;return!(l*l<A)}static CreateFromCenterAndRadius(y,c,A){this._TmpVector3[0].p(y),this._TmpVector3[1].Ec(0,0,c),this._TmpVector3[2].p(y),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].uo(this._TmpVector3[1]);const l=new N(this._TmpVector3[0],this._TmpVector3[2]);return l._worldMatrix=A||w.Matrix.Identity(),l}}N._TmpVector3=(0,l.d)(3,w.gc.Zero)},12692:(y,c,A)=>{function l(y){-1===y.indexOf("vClipPlane")&&y.push("vClipPlane"),-1===y.indexOf("vClipPlane2")&&y.push("vClipPlane2"),-1===y.indexOf("vClipPlane3")&&y.push("vClipPlane3"),-1===y.indexOf("vClipPlane4")&&y.push("vClipPlane4"),-1===y.indexOf("vClipPlane5")&&y.push("vClipPlane5"),-1===y.indexOf("vClipPlane6")&&y.push("vClipPlane6")}function w(y,c,A){const l=!!(y.clipPlane??c.clipPlane),w=!!(y.clipPlane2??c.clipPlane2),N=!!(y.clipPlane3??c.clipPlane3),p=!!(y.clipPlane4??c.clipPlane4),W=!!(y.clipPlane5??c.clipPlane5),h=!!(y.clipPlane6??c.clipPlane6);l&&A.push("#define CLIPPLANE"),w&&A.push("#define CLIPPLANE2"),N&&A.push("#define CLIPPLANE3"),p&&A.push("#define CLIPPLANE4"),W&&A.push("#define CLIPPLANE5"),h&&A.push("#define CLIPPLANE6")}function N(y,c,A){let l=!1;const w=!!(y.clipPlane??c.clipPlane),N=!!(y.clipPlane2??c.clipPlane2),p=!!(y.clipPlane3??c.clipPlane3),W=!!(y.clipPlane4??c.clipPlane4),h=!!(y.clipPlane5??c.clipPlane5),I=!!(y.clipPlane6??c.clipPlane6);return A.CLIPPLANE!==w&&(A.CLIPPLANE=w,l=!0),A.CLIPPLANE2!==N&&(A.CLIPPLANE2=N,l=!0),A.CLIPPLANE3!==p&&(A.CLIPPLANE3=p,l=!0),A.CLIPPLANE4!==W&&(A.CLIPPLANE4=W,l=!0),A.CLIPPLANE5!==h&&(A.CLIPPLANE5=h,l=!0),A.CLIPPLANE6!==I&&(A.CLIPPLANE6=I,l=!0),l}function p(y,c,A){let l=c.clipPlane??A.clipPlane;W(y,"vClipPlane",l),l=c.clipPlane2??A.clipPlane2,W(y,"vClipPlane2",l),l=c.clipPlane3??A.clipPlane3,W(y,"vClipPlane3",l),l=c.clipPlane4??A.clipPlane4,W(y,"vClipPlane4",l),l=c.clipPlane5??A.clipPlane5,W(y,"vClipPlane5",l),l=c.clipPlane6??A.clipPlane6,W(y,"vClipPlane6",l)}function W(y,c,A){A&&y.setFloat4(c,A.normal.x,A.normal.y,A.normal.z,A.d)}A.d(c,{d:()=>l,g:()=>p,i:()=>N,l:()=>w})},12619:(y,c,A)=>{A.d(c,{c:()=>l});class l{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(y,c){this._defines[y]||(y<this._currentRank&&(this._currentRank=y),y>this._maxRank&&(this._maxRank=y),this._defines[y]=new Array),this._defines[y].push(c)}addCPUSkinningFallback(y,c){this._mesh=c,y<this._currentRank&&(this._currentRank=y),y>this._maxRank&&(this._maxRank=y)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(y,c){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,y=y.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c._bonesComputationForcedToCPU=!0;const A=this._mesh.mc();for(let y=0;y<A.meshes.length;y++){const l=A.meshes[y];if(l.material){if(l.computeBonesUsingShaders&&0!==l.numBoneInfluencers)if(l.material.getEffect()===c)l.computeBonesUsingShaders=!1;else if(l.jc)for(const y of l.jc){if(y.effect===c){l.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&l.computeBonesUsingShaders&&l.numBoneInfluencers>0&&(l.computeBonesUsingShaders=!1)}}else{const c=this._defines[this._currentRank];if(c)for(let A=0;A<c.length;A++)y=y.replace("#define "+c[A],"");this._currentRank++}return y}}},12632:(y,c,A)=>{A.d(c,{c:()=>P});var l=A(12307),w=A(12310),N=A(12144),p=A(12153),W=A(12184),h=A(12640),I=A(12570),q=A(12161),o=A(12384),O=A(12448),L=A(12363);class i{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(y){this._func=y}get funcRef(){return this._funcRef}set funcRef(y){this._funcRef=y}get funcMask(){return this._funcMask}set funcMask(y){this._funcMask=y}get opStencilFail(){return this._opStencilFail}set opStencilFail(y){this._opStencilFail=y}get opDepthFail(){return this._opDepthFail}set opDepthFail(y){this._opDepthFail=y}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(y){this._opStencilDepthPass=y}get mask(){return this._mask}set mask(y){this._mask=y}get enabled(){return this._enabled}set enabled(y){this._enabled=y}getClassName(){return"MaterialStencilState"}copyTo(y){L.d.Clone((()=>y),this)}serialize(){return L.d.Serialize(this)}parse(y,c,A){L.d.Parse((()=>this),y,c,A)}}(0,l.b)([(0,w.P)()],i.prototype,"func",null),(0,l.b)([(0,w.P)()],i.prototype,"funcRef",null),(0,l.b)([(0,w.P)()],i.prototype,"funcMask",null),(0,l.b)([(0,w.P)()],i.prototype,"opStencilFail",null),(0,l.b)([(0,w.P)()],i.prototype,"opDepthFail",null),(0,l.b)([(0,w.P)()],i.prototype,"opStencilDepthPass",null),(0,l.b)([(0,w.P)()],i.prototype,"mask",null),(0,l.b)([(0,w.P)()],i.prototype,"enabled",null);var H=A(12683);class P{get _supportGlowLayer(){return!1}set _glowModeEnabled(y){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(y){if(this._alpha===y)return;const c=this._alpha;this._alpha=y,1!==c&&1!==y||this.Bq(P.MiscDirtyFlag+P.PrePassDirtyFlag)}get alpha(){return this._alpha}set nc(y){this._backFaceCulling!==y&&(this._backFaceCulling=y,this.Bq(P.TextureDirtyFlag))}get nc(){return this._backFaceCulling}set cullBackFaces(y){this._cullBackFaces!==y&&(this._cullBackFaces=y,this.Bq(P.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(y){this._blockDirtyMechanism!==y&&(this._blockDirtyMechanism=y,y||this.sO())}atomicMaterialsUpdate(y){this.blockDirtyMechanism=!0;try{y(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(y){this._onDisposeObserver&&this.zc.remove(this._onDisposeObserver),this._onDisposeObserver=this.zc.add(y)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new p.d),this._onBindObservable}set onBind(y){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(y)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new p.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new p.d),this._onEffectCreatedObservable}set alphaMode(y){this._alphaMode!==y&&(this._alphaMode=y,this.Bq(P.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(y){this._needDepthPrePass!==y&&(this._needDepthPrePass=y,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(y){this._fogEnabled!==y&&(this._fogEnabled=y,this.Bq(P.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case P.WireFrameFillMode:case P.LineListDrawMode:case P.LineLoopDrawMode:case P.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(y){this.fillMode=y?P.WireFrameFillMode:P.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case P.PointFillMode:case P.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(y){this.fillMode=y?P.PointFillMode:P.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(y){this._fillMode!==y&&(this._fillMode=y,this.Bq(P.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(y){const c=this.mc().getEngine().getCaps().fragmentDepthSupported;y&&!c&&q.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=y&&c,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(y){this._drawWrapper=y}constructor(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.zc=new p.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Sc=new i,this._useUBO=!1,this._fillMode=P.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=y;const w=c||W.c.LastCreatedScene;w&&(this._scene=w,this._dirtyCallbacks={},this._forceGLSL=l,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=y||N.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new O.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new I.c(this._scene.getEngine(),void 0,void 0,y),this._useUBO=this.mc().getEngine().supportsUniformBuffers,this._createUniformBuffer(),A||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),P.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var y;const c=this.mc().getEngine();null===(y=this._uniformBuffer)||void 0===y||y.dispose(),c.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new I.c(c,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new I.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(y){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.sO(),this.checkReadyOnlyOnce=!0}unfreeze(){this.sO(),this.checkReadyOnlyOnce=!1}isReady(y,c){return!0}isReadyForSubMesh(y,c,A){const l=c.materialDefines;return!!l&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=l,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}mc(){return this._scene}_getEffectiveOrientation(y){return null!==this.sideOrientation?this.sideOrientation:y.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(y){this._transparencyMode!==y&&(this._transparencyMode=y,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===P.MATERIAL_ALPHABLEND||this._transparencyMode===P.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===P.MATERIAL_ALPHATEST||this._transparencyMode===P.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===P.MATERIAL_OPAQUE||this._transparencyMode===P.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(y){return this._hasTransparencyMode?this._transparencyModeIsBlend:y.visibility<1||!this._disableAlphaBlending&&(y.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(y){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(y)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}sO(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.mc().meshes;for(const A of c)if(A.jc)for(const c of A.jc)if(c.ey()===this)for(const A of c._drawWrappers)A&&this._materialContext===A.materialContext&&(A._wasPreviouslyReady=!1,A._wasPreviouslyUsingInstances=null,A._forceRebindOnNextCall=y);y&&this.Bq(P.AllDirtyFlag)}_preBind(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this._scene.getEngine(),l=(null==c?this.sideOrientation:c)===P.ClockWiseSideOrientation;return A.enableEffect(y||this._getDrawWrapper()),A.setState(this.nc,this.zOffset,!1,l,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Sc,this.zOffsetUnits),l}bind(y,c){}buildUniformLayout(){const y=this._uniformBuffer;this._eventInfo.ubo=y,this._callbackPluginEventGeneric(8,this._eventInfo),y.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(y,c,A){const l=A._drawWrapper;this._eventInfo.subMesh=A,this._callbackPluginEventBindForSubMesh(this._eventInfo),l._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(y){}bindView(y){this._useUBO?this._needToBindSceneUbo=!0:y.setMatrix("view",this.mc().getViewMatrix())}bindViewProjection(y){this._useUBO?this._needToBindSceneUbo=!0:(y.setMatrix("viewProjection",this.mc().getTransformMatrix()),y.setMatrix("projection",this.mc().getProjectionMatrix()))}bindEyePosition(y,c){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(y,c)}_afterBind(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&c&&(this._needToBindSceneUbo=!1,(0,H.o)(c,this.mc().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=y?y.visibility:1,this._onBindObservable&&y&&this._onBindObservable.notifyObservers(y),this.disableDepthWrite){const y=this._scene.getEngine();this._cachedDepthWriteState=y.getDepthWrite(),y.setDepthWrite(!1)}if(this.disableColorWrite){const y=this._scene.getEngine();this._cachedColorWriteState=y.getColorWrite(),y.setColorWrite(!1)}if(0!==this.depthFunction){const y=this._scene.getEngine();this._cachedDepthFunctionState=y.getDepthFunction()||0,y.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(y){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=y,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(y){return null}_clonePlugins(y,c){const A={};if(this._serializePlugins(A),P._ParsePlugins(A,y,this._scene,c),this.pluginManager)for(const l of this.pluginManager._plugins){const c=y.pluginManager.getPlugin(l.name);c&&l.copyTo(c)}}getBindedMeshes(){if(this.meshMap){const y=[];for(const c in this.meshMap){const A=this.meshMap[c];A&&y.push(A)}return y}return this._scene.meshes.filter((y=>y.material===this))}forceCompilation(y,c,A,l){const w={clipPlane:!1,useInstances:!1,...A},N=this.mc(),p=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const W=()=>{if(!this._scene||!this._scene.getEngine())return;const A=N.clipPlane;if(w.clipPlane&&(N.clipPlane=new o.c(0,0,0,1)),this._storeEffectOnSubMeshes){let A=!0,N=null;if(y.jc){const c=new h.c(0,0,0,0,0,y,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),this.isReadyForSubMesh(y,c,w.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?N=c.effect.getCompilationError():(A=!1,setTimeout(W,16)))}A&&(this.allowShaderHotSwapping=p,N&&l&&l(N),c&&c(this))}else this.isReady()?(this.allowShaderHotSwapping=p,c&&c(this)):setTimeout(W,16);w.clipPlane&&(N.clipPlane=A)};W()}async forceCompilationAsync(y,c){return await new Promise(((A,l)=>{this.forceCompilation(y,(()=>{A()}),c,(y=>{l(y)}))}))}Bq(y){this.mc().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(P._DirtyCallbackArray.length=0,y&P.ImageProcessingDirtyFlag&&P._DirtyCallbackArray.push(P._ImageProcessingDirtyCallBack),y&P.TextureDirtyFlag&&P._DirtyCallbackArray.push(P._TextureDirtyCallBack),y&P.LightDirtyFlag&&P._DirtyCallbackArray.push(P._LightsDirtyCallBack),y&P.FresnelDirtyFlag&&P._DirtyCallbackArray.push(P._FresnelDirtyCallBack),y&P.AttributesDirtyFlag&&P._DirtyCallbackArray.push(P._AttributeDirtyCallBack),y&P.MiscDirtyFlag&&P._DirtyCallbackArray.push(P._MiscDirtyCallBack),y&P.PrePassDirtyFlag&&P._DirtyCallbackArray.push(P._PrePassDirtyCallBack),P._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(P._RunDirtyCallBacks),this.mc().resetCachedMaterial())}resetDrawCache(){const y=this.mc().meshes;for(const c of y)if(c.jc)for(const y of c.jc)y.ey()===this&&y.resetDrawCache()}_markAllSubMeshesAsDirty(y){const c=this.mc();if(c.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const A=c.meshes;for(const l of A)if(l.jc)for(const A of l.jc){if((A.ey()||(c._hasDefaultMaterial?c.defaultMaterial:null))===this)for(const c of A._drawWrappers)c&&c.defines&&c.defines.markAllAsDirty&&this._materialContext===c.materialContext&&y(c.defines)}}_markScenePrePassDirty(){if(this.mc().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const y=this.mc().enablePrePassRenderer();y&&y.Bq()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(P._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(P._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(P._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(P._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(P._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(P._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(P._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(P._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(P._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(P._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const y=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.zc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(y)}))}}setPrePassRenderer(y){return!1}dispose(y,c,A){const l=this.mc();if(l.stopAnimation(this),l.freeProcessedMaterials(),l.removeMaterial(this),this._eventInfo.forceDisposeTextures=c,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const y=this._parentContainer.materials.indexOf(this);y>-1&&this._parentContainer.materials.splice(y,1),this._parentContainer=null}if(!0!==A)if(this.meshMap)for(const w in this.meshMap){const y=this.meshMap[w];this._disposeMeshResources(y)}else{const y=l.meshes;for(const c of y)this._disposeMeshResources(c)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.zc.notifyObservers(this),this.zc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(y){if(!y)return;const c=y.Rc,A=y._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(y.jc&&A)for(const w of y.jc){const y=w._drawWrappers;for(let N=0;N<y.length;N++){var l;const p=null===(l=y[N])||void 0===l?void 0:l.effect;if(!p)continue;A[N]===this&&(null===c||void 0===c||c._releaseVertexArrayObject(p),w._removeDrawWrapper(N,!0,!0))}}}else null===c||void 0===c||c._releaseVertexArrayObject(this._drawWrapper.effect);y.material!==this||y.sourceMesh||(y.material=null)}serialize(){const y=L.d.Serialize(this);return y.Sc=this.Sc.serialize(),y.uniqueId=this.uniqueId,this._serializePlugins(y),y}_serializePlugins(y){if(y.plugins={},this.pluginManager)for(const c of this.pluginManager._plugins)c.doNotSerialize||(y.plugins[c.getClassName()]=c.serialize())}static Parse(y,c,A){if(y.customType){if("BABYLON.PBRMaterial"===y.customType&&y.overloadedAlbedo&&(y.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return q.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else y.customType="BABYLON.StandardMaterial";const l=N.Tools.Instantiate(y.customType).Parse(y,c,A);return l._loadedUniqueId=y.uniqueId,l}static _ParsePlugins(y,c,A,l){if(y.plugins)for(const W in y.plugins){var w,p;const h=y.plugins[W];let I=null===(w=c.pluginManager)||void 0===w?void 0:w.getPlugin(h.name);if(!I){const y=N.Tools.Instantiate("BABYLON."+W);y&&(I=new y(c))}null===(p=I)||void 0===p||p.parse(h,A,l)}}}P.TriangleFillMode=0,P.WireFrameFillMode=1,P.PointFillMode=2,P.PointListDrawMode=3,P.LineListDrawMode=4,P.LineLoopDrawMode=5,P.LineStripDrawMode=6,P.TriangleStripDrawMode=7,P.TriangleFanDrawMode=8,P.ClockWiseSideOrientation=0,P.CounterClockWiseSideOrientation=1,P.ImageProcessingDirtyFlag=64,P.TextureDirtyFlag=1,P.LightDirtyFlag=2,P.FresnelDirtyFlag=4,P.AttributesDirtyFlag=8,P.MiscDirtyFlag=16,P.PrePassDirtyFlag=32,P.AllDirtyFlag=127,P.MATERIAL_OPAQUE=0,P.MATERIAL_ALPHATEST=1,P.MATERIAL_ALPHABLEND=2,P.MATERIAL_ALPHATESTANDBLEND=3,P.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,P.MATERIAL_NORMALBLENDMETHOD_RNM=1,P.OnEventObservable=new p.d,P._AllDirtyCallBack=y=>y.markAllAsDirty(),P._ImageProcessingDirtyCallBack=y=>y.markAsImageProcessingDirty(),P._TextureDirtyCallBack=y=>y.markAsTexturesDirty(),P._FresnelDirtyCallBack=y=>y.markAsFresnelDirty(),P._MiscDirtyCallBack=y=>y.markAsMiscDirty(),P._PrePassDirtyCallBack=y=>y.markAsPrePassDirty(),P._LightsDirtyCallBack=y=>y.markAsLightDirty(),P._AttributeDirtyCallBack=y=>y.markAsAttributesDirty(),P._FresnelAndMiscDirtyCallBack=y=>{P._FresnelDirtyCallBack(y),P._MiscDirtyCallBack(y)},P._TextureAndMiscDirtyCallBack=y=>{P._TextureDirtyCallBack(y),P._MiscDirtyCallBack(y)},P._DirtyCallbackArray=[],P._RunDirtyCallBacks=y=>{for(const c of P._DirtyCallbackArray)c(y)},(0,l.b)([(0,w.P)()],P.prototype,"id",void 0),(0,l.b)([(0,w.P)()],P.prototype,"uniqueId",void 0),(0,l.b)([(0,w.P)()],P.prototype,"name",void 0),(0,l.b)([(0,w.P)()],P.prototype,"metadata",void 0),(0,l.b)([(0,w.P)()],P.prototype,"checkReadyOnEveryCall",void 0),(0,l.b)([(0,w.P)()],P.prototype,"checkReadyOnlyOnce",void 0),(0,l.b)([(0,w.P)()],P.prototype,"state",void 0),(0,l.b)([(0,w.P)("alpha")],P.prototype,"_alpha",void 0),(0,l.b)([(0,w.P)("nc")],P.prototype,"_backFaceCulling",void 0),(0,l.b)([(0,w.P)("cullBackFaces")],P.prototype,"_cullBackFaces",void 0),(0,l.b)([(0,w.P)()],P.prototype,"sideOrientation",void 0),(0,l.b)([(0,w.P)("alphaMode")],P.prototype,"_alphaMode",void 0),(0,l.b)([(0,w.P)()],P.prototype,"_needDepthPrePass",void 0),(0,l.b)([(0,w.P)()],P.prototype,"disableDepthWrite",void 0),(0,l.b)([(0,w.P)()],P.prototype,"disableColorWrite",void 0),(0,l.b)([(0,w.P)()],P.prototype,"forceDepthWrite",void 0),(0,l.b)([(0,w.P)()],P.prototype,"depthFunction",void 0),(0,l.b)([(0,w.P)()],P.prototype,"separateCullingPass",void 0),(0,l.b)([(0,w.P)("fogEnabled")],P.prototype,"_fogEnabled",void 0),(0,l.b)([(0,w.P)()],P.prototype,"pointSize",void 0),(0,l.b)([(0,w.P)()],P.prototype,"zOffset",void 0),(0,l.b)([(0,w.P)()],P.prototype,"zOffsetUnits",void 0),(0,l.b)([(0,w.P)()],P.prototype,"pointsCloud",null),(0,l.b)([(0,w.P)()],P.prototype,"fillMode",null),(0,l.b)([(0,w.P)()],P.prototype,"useLogarithmicDepth",null),(0,l.b)([(0,w.P)()],P.prototype,"transparencyMode",null)},12683:(y,c,A)=>{A.d(c,{A:()=>my,E:()=>L,I:()=>O,L:()=>a,O:()=>k,R:()=>S,T:()=>D,U:()=>z,W:()=>u,Y:()=>G,_:()=>j,ab:()=>V,e:()=>B,eb:()=>i,f:()=>o,i:()=>C,l:()=>q,m:()=>H,o:()=>P,q:()=>t,u:()=>T,x:()=>s,z:()=>K});var l=A(12161),w=A(12375),N=A(12184),p=A(12617),W=A(12692);const h=w.dc.Black(),I={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function q(y,c,A){if(!y||y.LOGARITHMICDEPTH||y.indexOf&&y.indexOf("LOGARITHMICDEPTH")>=0){const y=A.activeCamera;1===y.mode&&l.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),c.setFloat("logarithmicDepthConstant",2/(Math.log(y.maxZ+1)/Math.LN2))}}function o(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];A&&y.fogEnabled&&(!c||c.applyFog)&&0!==y.fogMode&&(A.setFloat4("vFogInfos",y.fogMode,y.fogStart,y.fogEnd,y.fogDensity),l?(y.fogColor.toLinearSpaceToRef(h,y.getEngine().useExactSrgbConversions),A.setColor3("vFogColor",h)):A.setColor3("vFogColor",y.fogColor))}function O(y,c,A,l,w,N,p,W,h,q){const o=y.numMaxInfluencers||y.numInfluencers;return o<=0?0:(c.push("#define MORPHTARGETS"),y.hasPositions&&c.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),y.hasNormals&&c.push("#define MORPHTARGETTEXTURE_HASNORMALS"),y.hasTangents&&c.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),y.hasUVs&&c.push("#define MORPHTARGETTEXTURE_HASUVS"),y.hasUV2s&&c.push("#define MORPHTARGETTEXTURE_HASUV2S"),y.hasColors&&c.push("#define MORPHTARGETTEXTURE_HASCOLORS"),y.supportsPositions&&w&&c.push("#define MORPHTARGETS_POSITION"),y.supportsNormals&&N&&c.push("#define MORPHTARGETS_NORMAL"),y.supportsTangents&&p&&c.push("#define MORPHTARGETS_TANGENT"),y.supportsUVs&&W&&c.push("#define MORPHTARGETS_UV"),y.supportsUV2s&&h&&c.push("#define MORPHTARGETS_UV2"),y.supportsColors&&q&&c.push("#define MORPHTARGETS_COLOR"),c.push("#define NUM_MORPH_INFLUENCERS "+o),y.isUsingTextureForTargets&&c.push("#define MORPHTARGETS_TEXTURE"),I.NUM_MORPH_INFLUENCERS=o,I.NORMAL=N,I.TANGENT=p,I.UV=W,I.UV2=h,I.COLOR=q,L(A,l,I,w),o)}function L(y,c,A){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=A.NUM_MORPH_INFLUENCERS;if(p>0&&N.c.LastCreatedEngine){const W=N.c.LastCreatedEngine.getCaps().maxVertexAttribs,h=c.morphTargetManager;if(null!==h&&void 0!==h&&h.isUsingTextureForTargets)return;const I=h&&h.supportsPositions&&w,q=h&&h.supportsNormals&&A.NORMAL,o=h&&h.supportsTangents&&A.TANGENT,O=h&&h.supportsUVs&&A.UV1,L=h&&h.supportsUV2s&&A.UV2,i=h&&h.supportsColors&&A.VERTEXCOLOR;for(let A=0;A<p;A++)I&&y.push("position"+A),q&&y.push("normal"+A),o&&y.push("tangent"+A),O&&y.push("uv_"+A),L&&y.push("uv2_"+A),i&&y.push("color"+A),y.length>W&&l.c.Error("Cannot add more vertex attributes for mesh "+c.name)}}function i(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y.push("world0"),y.push("world1"),y.push("world2"),y.push("world3"),c&&(y.push("previousWorld0"),y.push("previousWorld1"),y.push("previousWorld2"),y.push("previousWorld3"))}function H(y,c){const A=y.morphTargetManager;y&&A&&c.setFloatArray("morphTargetInfluences",A.influences)}function P(y,c){c.bindToEffect(y,"Scene")}function D(y,c,A){c._needUVs=!0,c[A]=!0,y.optimizeUVAllocation&&y.getTextureMatrix().isIdentityAs3x2()?(c[A+"DIRECTUV"]=y.coordinatesIndex+1,c["MAINUV"+(y.coordinatesIndex+1)]=!0):c[A+"DIRECTUV"]=0}function t(y,c,A){const l=y.getTextureMatrix();c.Qc(A+"Matrix",l)}function s(y,c,A){A.BAKED_VERTEX_ANIMATION_TEXTURE&&A.INSTANCES&&y.push("bakedVertexAnimationSettingsInstanced")}function B(y,c,A){var l;if(c&&y&&(y.computeBonesUsingShaders&&c._bonesComputationForcedToCPU&&(y.computeBonesUsingShaders=!1),y.useBones&&y.computeBonesUsingShaders&&y.skeleton)){const w=y.skeleton;if(w.isUsingTextureForMatrices&&c.getUniformIndex("boneTextureWidth")>-1){const A=w.getTransformMatrixTexture(y);c.setTexture("boneSampler",A),c.setFloat("boneTextureWidth",4*(w.bones.length+1))}else{const N=w.getTransformMatrices(y);N&&(c.setMatrices("mBones",N),A&&y.mc().prePassRenderer&&y.mc().prePassRenderer.getIndex(2)&&(A.previousBones[y.uniqueId]||(A.previousBones[y.uniqueId]=N.slice()),c.setMatrices("mPreviousBones",A.previousBones[y.uniqueId]),l=N,A.previousBones[y.uniqueId].set(l)))}}}function X(y,c,A,l,w){let N=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];y._bindLight(c,A,l,w,N)}function C(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const N=Math.min(c.lightSources.length,w);for(let p=0;p<N;p++){X(c.lightSources[p],p,y,A,"boolean"===typeof l?l:l.SPECULARTERM,c.receiveShadows)}}function K(y,c,A,l){A.NUM_BONE_INFLUENCERS>0&&(l.addCPUSkinningFallback(0,c),y.push("matricesIndices"),y.push("matricesWeights"),A.NUM_BONE_INFLUENCERS>4&&(y.push("matricesIndicesExtra"),y.push("matricesWeightsExtra")))}function my(y,c){(c.INSTANCES||c.THIN_INSTANCES)&&i(y,!!c.PREPASS_VELOCITY),c.INSTANCESCOLOR&&y.push("instanceColor")}function T(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=0;for(let N=0;N<A&&y["LIGHT"+N];N++)N>0&&(w=l+N,c.addFallback(w,"LIGHT"+N)),y.SHADOWS||(y["SHADOW"+N]&&c.addFallback(l,"SHADOW"+N),y["SHADOWPCF"+N]&&c.addFallback(l,"SHADOWPCF"+N),y["SHADOWPCSS"+N]&&c.addFallback(l,"SHADOWPCSS"+N),y["SHADOWPOISSON"+N]&&c.addFallback(l,"SHADOWPOISSON"+N),y["SHADOWESM"+N]&&c.addFallback(l,"SHADOWESM"+N),y["SHADOWCLOSEESM"+N]&&c.addFallback(l,"SHADOWCLOSEESM"+N));return w++}function z(y,c,A,l,w,N,p){let W=arguments.length>7&&void 0!==arguments[7]&&arguments[7];p._areMiscDirty&&(p.LOGARITHMICDEPTH=A,p.POINTSIZE=l,p.FOG=w&&function(y,c){return c.fogEnabled&&y.applyFog&&0!==c.fogMode}(y,c),p.NONUNIFORMSCALING=y.nonUniformScaling,p.ALPHATEST=N,p.DECAL_AFTER_DETAIL=W)}function S(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!A._areLightsDirty)return A._needNormals;let p=0;const W={needNormals:A._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(y.lightsEnabled&&!N)for(const I of c.lightSources)if(M(y,c,I,p,A,l,W),p++,p===w)break;A.SPECULARTERM=W.specularEnabled,A.SHADOWS=W.shadowEnabled;for(let I=p;I<w;I++)void 0!==A["LIGHT"+I]&&(A["LIGHT"+I]=!1,A["HEMILIGHT"+I]=!1,A["POINTLIGHT"+I]=!1,A["DIRLIGHT"+I]=!1,A["SPOTLIGHT"+I]=!1,A["AREALIGHT"+I]=!1,A["SHADOW"+I]=!1,A["SHADOWCSM"+I]=!1,A["SHADOWCSMDEBUG"+I]=!1,A["SHADOWCSMNUM_CASCADES"+I]=!1,A["SHADOWCSMUSESHADOWMAXZ"+I]=!1,A["SHADOWCSMNOBLEND"+I]=!1,A["SHADOWCSM_RIGHTHANDED"+I]=!1,A["SHADOWPCF"+I]=!1,A["SHADOWPCSS"+I]=!1,A["SHADOWPOISSON"+I]=!1,A["SHADOWESM"+I]=!1,A["SHADOWCLOSEESM"+I]=!1,A["SHADOWCUBE"+I]=!1,A["SHADOWLOWQUALITY"+I]=!1,A["SHADOWMEDIUMQUALITY"+I]=!1);const h=y.getEngine().getCaps();return void 0===A.SHADOWFLOAT&&(W.needRebuild=!0),A.SHADOWFLOAT=W.shadowEnabled&&(h.textureFloatRender&&h.textureFloatLinearFiltering||h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering),A.LIGHTMAPEXCLUDED=W.lightmapMode,W.needRebuild&&A.rebuild(),W.needNormals}function M(y,c,A,l,w,N,W){switch(W.needNormals=!0,void 0===w["LIGHT"+l]&&(W.needRebuild=!0),w["LIGHT"+l]=!0,w["SPOTLIGHT"+l]=!1,w["HEMILIGHT"+l]=!1,w["POINTLIGHT"+l]=!1,w["DIRLIGHT"+l]=!1,w["AREALIGHT"+l]=!1,A.prepareLightSpecificDefines(w,l),w["LIGHT_FALLOFF_PHYSICAL"+l]=!1,w["LIGHT_FALLOFF_GLTF"+l]=!1,w["LIGHT_FALLOFF_STANDARD"+l]=!1,A.falloffType){case p.d.FALLOFF_GLTF:w["LIGHT_FALLOFF_GLTF"+l]=!0;break;case p.d.FALLOFF_PHYSICAL:w["LIGHT_FALLOFF_PHYSICAL"+l]=!0;break;case p.d.FALLOFF_STANDARD:w["LIGHT_FALLOFF_STANDARD"+l]=!0}if(N&&!A.gq.equalsFloats(0,0,0)&&(W.specularEnabled=!0),w["SHADOW"+l]=!1,w["SHADOWCSM"+l]=!1,w["SHADOWCSMDEBUG"+l]=!1,w["SHADOWCSMNUM_CASCADES"+l]=!1,w["SHADOWCSMUSESHADOWMAXZ"+l]=!1,w["SHADOWCSMNOBLEND"+l]=!1,w["SHADOWCSM_RIGHTHANDED"+l]=!1,w["SHADOWPCF"+l]=!1,w["SHADOWPCSS"+l]=!1,w["SHADOWPOISSON"+l]=!1,w["SHADOWESM"+l]=!1,w["SHADOWCLOSEESM"+l]=!1,w["SHADOWCUBE"+l]=!1,w["SHADOWLOWQUALITY"+l]=!1,w["SHADOWMEDIUMQUALITY"+l]=!1,c&&c.receiveShadows&&y.shadowsEnabled&&A.shadowEnabled){const c=A.getShadowGenerator(y.activeCamera)??A.getShadowGenerator();if(c){const y=c.getShadowMap();y&&y.renderList&&y.renderList.length>0&&(W.shadowEnabled=!0,c.prepareDefines(w,l))}}A.lightmapMode!=p.d.LIGHTMAP_DEFAULT?(W.lightmapMode=!0,w["LIGHTMAPEXCLUDED"+l]=!0,w["LIGHTMAPNOSPECULAR"+l]=A.lightmapMode==p.d.LIGHTMAP_SHADOWSONLY):(w["LIGHTMAPEXCLUDED"+l]=!1,w["LIGHTMAPNOSPECULAR"+l]=!1)}function k(y,c,A,l,w){let N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=function(y,c){let A=!1;if(y.activeCamera){const l=c.CAMERA_ORTHOGRAPHIC?1:0,w=c.CAMERA_PERSPECTIVE?1:0,N=1===y.activeCamera.mode?1:0,p=0===y.activeCamera.mode?1:0;(l^N||w^p)&&(c.CAMERA_ORTHOGRAPHIC=1===N,c.CAMERA_PERSPECTIVE=1===p,A=!0)}return A}(y,l);!1!==N&&(h=(0,W.i)(A,y,l)),l.DEPTHPREPASS!==!c.getColorWrite()&&(l.DEPTHPREPASS=!l.DEPTHPREPASS,h=!0),l.INSTANCES!==w&&(l.INSTANCES=w,h=!0),l.THIN_INSTANCES!==p&&(l.THIN_INSTANCES=p,h=!0),h&&l.markAsUnprocessed()}function a(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],N=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!c._areAttributesDirty&&c._needNormals===c._normals&&c._needUVs===c._uvs)return!1;c._normals=c._needNormals,c._uvs=c._needUVs,c.NORMAL=c._needNormals&&y.isVerticesDataPresent("normal"),c._needNormals&&y.isVerticesDataPresent("tangent")&&(c.TANGENT=!0);for(let W=1;W<=6;++W)c["UV"+W]=!!c._needUVs&&y.isVerticesDataPresent(`uv${1===W?"":W}`);if(A){const A=y.useVertexColors&&y.isVerticesDataPresent("color");c.VERTEXCOLOR=A,c.VERTEXALPHA=y.hasVertexAlpha&&A&&N}return y.isVerticesDataPresent("instanceColor")&&(y.hasInstances||y.hasThinInstances)&&(c.INSTANCESCOLOR=!0),l&&function(y,c){if(y.useBones&&y.computeBonesUsingShaders&&y.skeleton){c.NUM_BONE_INFLUENCERS=y.numBoneInfluencers;const A=void 0!==c.BONETEXTURE;if(y.skeleton.isUsingTextureForMatrices&&A)c.BONETEXTURE=!0;else{c.BonesPerMesh=y.skeleton.bones.length+1,c.BONETEXTURE=!A&&void 0;const l=y.mc().prePassRenderer;if(l&&l.enabled){const A=-1===l.excludedSkinnedMesh.indexOf(y);c.BONES_VELOCITY_ENABLED=A}}}else c.NUM_BONE_INFLUENCERS=0,c.BonesPerMesh=0,void 0!==c.BONETEXTURE&&(c.BONETEXTURE=!1)}(y,c),w&&function(y,c){const A=y.morphTargetManager;A?(c.MORPHTARGETS_UV=A.supportsUVs&&c.UV1,c.MORPHTARGETS_UV2=A.supportsUV2s&&c.UV2,c.MORPHTARGETS_TANGENT=A.supportsTangents&&c.TANGENT,c.MORPHTARGETS_NORMAL=A.supportsNormals&&c.NORMAL,c.MORPHTARGETS_POSITION=A.supportsPositions,c.MORPHTARGETS_COLOR=A.supportsColors,c.MORPHTARGETTEXTURE_HASUVS=A.hasUVs,c.MORPHTARGETTEXTURE_HASUV2S=A.hasUV2s,c.MORPHTARGETTEXTURE_HASTANGENTS=A.hasTangents,c.MORPHTARGETTEXTURE_HASNORMALS=A.hasNormals,c.MORPHTARGETTEXTURE_HASPOSITIONS=A.hasPositions,c.MORPHTARGETTEXTURE_HASCOLORS=A.hasColors,c.NUM_MORPH_INFLUENCERS=A.numMaxInfluencers||A.numInfluencers,c.MORPHTARGETS=c.NUM_MORPH_INFLUENCERS>0,c.MORPHTARGETS_TEXTURE=A.isUsingTextureForTargets):(c.MORPHTARGETS_UV=!1,c.MORPHTARGETS_UV2=!1,c.MORPHTARGETS_TANGENT=!1,c.MORPHTARGETS_NORMAL=!1,c.MORPHTARGETS_POSITION=!1,c.MORPHTARGETS_COLOR=!1,c.MORPHTARGETTEXTURE_HASUVS=!1,c.MORPHTARGETTEXTURE_HASUV2S=!1,c.MORPHTARGETTEXTURE_HASTANGENTS=!1,c.MORPHTARGETTEXTURE_HASNORMALS=!1,c.MORPHTARGETTEXTURE_HASPOSITIONS=!1,c.MORPHTARGETTEXTURE_HAS_COLORS=!1,c.MORPHTARGETS=!1,c.NUM_MORPH_INFLUENCERS=0)}(y,c),p&&function(y,c){const A=y.bakedVertexAnimationManager;c.BAKED_VERTEX_ANIMATION_TEXTURE=!(!A||!A.isEnabled)}(y,c),!0}function u(y,c){if(y.activeCamera){const A=c.MULTIVIEW;c.MULTIVIEW=null!==y.activeCamera.outputRenderTarget&&y.activeCamera.outputRenderTarget.getViewCount()>1,c.MULTIVIEW!=A&&c.markAsUnprocessed()}}function G(y,c,A){const l=c.ORDER_INDEPENDENT_TRANSPARENCY,w=c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;c.ORDER_INDEPENDENT_TRANSPARENCY=y.useOrderIndependentTransparency&&A,c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!y.getEngine().getCaps().textureFloatLinearFiltering,l===c.ORDER_INDEPENDENT_TRANSPARENCY&&w===c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||c.markAsUnprocessed()}function j(y,c,A){const l=c.PREPASS;if(!c._arePrePassDirty)return;const w=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(y.prePassRenderer&&y.prePassRenderer.enabled&&A){c.PREPASS=!0,c.SCENE_MRT_COUNT=y.prePassRenderer.mrtCount,c.PREPASS_NORMAL_WORLDSPACE=y.prePassRenderer.generateNormalsInWorldSpace,c.PREPASS_COLOR=!0,c.PREPASS_COLOR_INDEX=0;for(let A=0;A<w.length;A++){const l=y.prePassRenderer.getIndex(w[A].type);-1!==l?(c[w[A].define]=!0,c[w[A].index]=l):c[w[A].define]=!1}}else{c.PREPASS=!1;for(let y=0;y<w.length;y++)c[w[y].define]=!1}c.PREPASS!=l&&(c.markAsUnprocessed(),c.markAsImageProcessingDirty())}function f(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];w&&w.push("Light"+y),N||(c.push("vLightData"+y,"vLightDiffuse"+y,"vLightSpecular"+y,"vLightDirection"+y,"vLightWidth"+y,"vLightHeight"+y,"vLightFalloff"+y,"vLightGround"+y,"lightMatrix"+y,"shadowsInfo"+y,"depthValues"+y),A.push("shadowTexture"+y),A.push("depthTexture"+y),c.push("viewFrustumZ"+y,"cascadeBlendFactor"+y,"lightSizeUVCorrection"+y,"depthCorrection"+y,"penumbraDarkness"+y,"frustumLengths"+y),l&&(A.push("projectionLightTexture"+y),c.push("textureProjectionMatrix"+y)),p&&A.push("iesLightTexture"+y))}function V(y,c,A){let l,w,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(y.uniformsNames){const p=y;l=p.uniformsNames,w=p.uniformBuffersNames,c=p.samplers,A=p.defines,N=p.maxSimultaneousLights||0}else l=y,c||(c=[]);for(let p=0;p<N&&A["LIGHT"+p];p++)f(p,l,c,A["PROJECTEDLIGHTTEXTURE"+p],w,!1,A["IESLIGHTTEXTURE"+p]);A.NUM_MORPH_INFLUENCERS&&(l.push("morphTargetInfluences"),l.push("morphTargetCount")),A.BAKED_VERTEX_ANIMATION_TEXTURE&&(l.push("bakedVertexAnimationSettings"),l.push("bakedVertexAnimationTextureSizeInverted"),l.push("bakedVertexAnimationTime"),c.push("bakedVertexAnimationTexture"))}},12625:(y,c,A)=>{A.d(c,{b:()=>N});var l=A(12325),w=A(12632);class N extends w.c{constructor(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(y,c,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new l.Matrix,this._storeEffectOnSubMeshes=A}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(y,c){return!!y&&(!this._storeEffectOnSubMeshes||(!y.jc||0===y.jc.length||this.isReadyForSubMesh(y,y.jc[0],c)))}_isReadyForSubMesh(y){const c=y.materialDefines;return!(this.checkReadyOnEveryCall||!y.effect||!c||c._renderId!==this.mc().getRenderId())}bindOnlyWorldMatrix(y){this._activeEffect.setMatrix("world",y)}bindOnlyNormalMatrix(y){this._activeEffect.setMatrix("normalMatrix",y)}bind(y,c){c&&this.bindForSubMesh(y,c,c.jc[0])}_afterBind(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;super._afterBind(y,c,A),this.mc()._cachedEffect=c,A?A._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return A._drawWrapper._forceRebindOnNextCall||y.isCachedMaterialInvalid(this,c,l)}dispose(y,c,A){this._activeEffect=void 0,super.dispose(y,c,A)}}},12676:(y,c,A)=>{A.d(c,{d:()=>W,f:()=>h});var l=A(12307),w=A(12325),N=A(12310);class p{static extractMinAndMaxIndexed(y,c,A,l,w,N){for(let p=A;p<A+l;p++){const A=3*c[p],l=y[A],W=y[A+1],h=y[A+2];w.minimizeInPlaceFromFloats(l,W,h),N.maximizeInPlaceFromFloats(l,W,h)}}static extractMinAndMax(y,c,A,l,w,N){for(let p=c,W=c*l;p<c+A;p++,W+=l){const c=y[W],A=y[W+1],l=y[W+2];w.minimizeInPlaceFromFloats(c,A,l),N.maximizeInPlaceFromFloats(c,A,l)}}}function W(y,c,A,l){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const W=new w.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new w.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p.extractMinAndMaxIndexed(y,c,A,l,W,h),N&&(W.x-=W.x*N.x+N.y,W.y-=W.y*N.x+N.y,W.z-=W.z*N.x+N.y,h.x+=h.x*N.x+N.y,h.y+=h.y*N.x+N.y,h.z+=h.z*N.x+N.y),{minimum:W,maximum:h}}function h(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4?arguments[4]:void 0;const W=new w.gc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new w.gc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return N||(N=3),p.extractMinAndMax(y,c,A,N,W,h),l&&(W.x-=W.x*l.x+l.y,W.y-=W.y*l.x+l.y,W.z-=W.z*l.x+l.y,h.x+=h.x*l.x+l.y,h.y+=h.y*l.x+l.y,h.z+=h.z*l.x+l.y),{minimum:W,maximum:h}}(0,l.b)([N.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l,w]=c;return!Array.isArray(l)&&!Array.isArray(w)}))],p,"extractMinAndMaxIndexed",null),(0,l.b)([N.h.filter((function(){for(var y=arguments.length,c=new Array(y),A=0;A<y;A++)c[A]=arguments[A];let[l]=c;return!Array.isArray(l)}))],p,"extractMinAndMax",null)},12640:(y,c,A)=>{A.d(c,{c:()=>h});var l=A(12400),w=A(12647),N=A(12654),p=A(12676),W=A(12448);class h{get materialDefines(){var y;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(y=this._getDrawWrapper())||void 0===y?void 0:y.defines}set materialDefines(y){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=y}_getDrawWrapper(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y=y??this._engine.currentRenderPassId;let A=this._drawWrappers[y];return!A&&c&&(this._drawWrappers[y]=A=new W.d(this._mesh.mc().getEngine())),A}_removeDrawWrapper(y){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var A;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(A=this._drawWrappers[y])||void 0===A||A.dispose(c));this._drawWrappers[y]=void 0}get effect(){var y;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(y=this._getDrawWrapper())||void 0===y?void 0:y.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(y){this._mainDrawWrapperOverride=y}setEffect(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=this._drawWrapper;w.setEffect(y,c,l),void 0!==A&&(w.materialContext=A),y||(w.defines=null,w.materialContext=void 0)}resetDrawCache(y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==y)return void this._removeDrawWrapper(y,!0,c);for(const y of this._drawWrappers)null===y||void 0===y||y.dispose(c)}this._drawWrappers=[]}static AddToMesh(y,c,A,l,w,N,p){return new h(y,c,A,l,w,N,p,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(y,c,A,l,w,N,p){let W=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],h=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=y,this.verticesStart=c,this.verticesCount=A,this.indexStart=l,this.indexCount=w,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=N,this._renderingMesh=p||N,h&&N.jc.push(this),this._engine=this._mesh.mc().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=N.jc.length-1,W&&(this.refreshBoundingInfo(),N.Yc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(y){return this._boundingInfo=y,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const y=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return y||this._renderingMesh}ey(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!c)return y&&this._mesh.mc()._hasDefaultMaterial?this._mesh.mc().defaultMaterial:null;if(this._isMultiMaterial(c)){const y=c.getSubMaterial(this.materialIndex);return this._currentMaterial!==y&&(this._currentMaterial=y,this.resetDrawCache()),y}return c}_isMultiMaterial(y){return void 0!==y.getSubMaterial}refreshBoundingInfo(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Rc)return this;if(y||(y=this._renderingMesh.getVerticesData(l.e.PositionKind)),!y)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const c=this._renderingMesh.rc();let A;if(0===this.indexStart&&this.indexCount===c.length){const y=this._renderingMesh.getBoundingInfo();A={minimum:y.minimum.clone(),maximum:y.maximum.clone()}}else A=(0,p.d)(y,c,this.indexStart,this.indexCount,this._renderingMesh.Rc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(A.minimum,A.maximum):this._boundingInfo=new N.d(A.minimum,A.maximum),this}_checkCollision(y){return this.getBoundingInfo()._checkCollision(y)}updateBoundingInfo(y){let c=this.getBoundingInfo();return c||(this.refreshBoundingInfo(),c=this.getBoundingInfo()),c&&c.update(y),this}isInFrustum(y){const c=this.getBoundingInfo();return!!c&&c.isInFrustum(y,this._mesh.ro)}isCompletelyInFrustum(y){const c=this.getBoundingInfo();return!!c&&c.isCompletelyInFrustum(y)}render(y){return this._renderingMesh.render(this,y,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(y,c){if(!this._linesIndexBuffer){const A=6*Math.floor(this.indexCount/3),l=this.verticesStart+this.verticesCount>65535?new Uint32Array(A):new Uint16Array(A);let w=0;if(0===y.length)for(let y=this.indexStart;y<this.indexStart+this.indexCount;y+=3)l[w++]=y,l[w++]=y+1,l[w++]=y+1,l[w++]=y+2,l[w++]=y+2,l[w++]=y;else for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)l[w++]=y[c],l[w++]=y[c+1],l[w++]=y[c+1],l[w++]=y[c+2],l[w++]=y[c+2],l[w++]=y[c];this._linesIndexBuffer=c.createIndexBuffer(l),this._linesIndexCount=l.length}return this._linesIndexBuffer}canIntersects(y){const c=this.getBoundingInfo();return!!c&&y.intersectsBox(c.boundingBox)}intersects(y,c,A,l,w){const N=this.ey();if(!N)return null;let p=3,W=!1;switch(N.fillMode){case 3:case 5:case 6:case 8:return null;case 7:p=1,W=!0}return 4===N.fillMode?A.length?this._intersectLines(y,c,A,this._mesh.intersectionThreshold,l):this._intersectUnIndexedLines(y,c,A,this._mesh.intersectionThreshold,l):!A.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(y,c,A,l,w):this._intersectTriangles(y,c,A,p,W,l,w)}_intersectLines(y,c,A,l,N){let p=null;for(let W=this.indexStart;W<this.indexStart+this.indexCount;W+=2){const h=c[A[W]],I=c[A[W+1]],q=y.intersectionSegment(h,I,l);if(!(q<0)&&((N||!p||q<p.distance)&&(p=new w.b(null,null,q),p.faceId=W/2,N)))break}return p}_intersectUnIndexedLines(y,c,A,l,N){let p=null;for(let W=this.verticesStart;W<this.verticesStart+this.verticesCount;W+=2){const A=c[W],h=c[W+1],I=y.intersectionSegment(A,h,l);if(!(I<0)&&((N||!p||I<p.distance)&&(p=new w.b(null,null,I),p.faceId=W/2,N)))break}return p}_intersectTriangles(y,c,A,l,w,N,p){let W=null,h=-1;for(let I=this.indexStart;I<this.indexStart+this.indexCount-(3-l);I+=l){h++;const l=A[I],q=A[I+1],o=A[I+2];if(w&&4294967295===o){I+=2;continue}const O=c[l],L=c[q],i=c[o];if(!O||!L||!i)continue;if(p&&!p(O,L,i,y,l,q,o))continue;const H=y.intersectsTriangle(O,L,i);if(H){if(H.distance<0)continue;if((N||!W||H.distance<W.distance)&&(W=H,W.faceId=h,N))break}}return W}_intersectUnIndexedTriangles(y,c,A,l,w){let N=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=3){const A=c[p],W=c[p+1],h=c[p+2];if(w&&!w(A,W,h,y,-1,-1,-1))continue;const I=y.intersectsTriangle(A,W,h);if(I){if(I.distance<0)continue;if((l||!N||I.distance<N.distance)&&(N=I,N.faceId=p/3,l))break}}return N}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(y,c){const A=new h(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,y,c,!1);if(!this.IsGlobal){const y=this.getBoundingInfo();if(!y)return A;A._boundingInfo=new N.d(y.minimum,y.maximum)}return A}dispose(){let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.mc().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const c=this._mesh.jc.indexOf(this);this._mesh.jc.splice(c,1),this.resetDrawCache(void 0,y)}getClassName(){return"SubMesh"}static CreateFromIndices(y,c,A,l,w){let N=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=Number.MAX_VALUE,W=-Number.MAX_VALUE;const I=(w||l).rc();for(let h=c;h<c+A;h++){const y=I[h];y<p&&(p=y),y>W&&(W=y)}return new h(y,p,W-p+1,c,A,l,w,N)}}}}]);