"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[24],{13135:(a,c,o)=>{o.d(c,{e:()=>s});class s{constructor(a,c,o){this.bu=a,this.bv=c,this.distance=o,this.faceId=0,this.subMeshId=0}}},13142:(a,c,o)=>{o.d(c,{c:()=>i});var s=o(12820),q=o(12810),t=o(12812);class i{constructor(a,c,o){this.vectors=(0,s.b)(8,q.Hc.Zero),this.center=q.Hc.Zero(),this.centerWorld=q.Hc.Zero(),this.extendSize=q.Hc.Zero(),this.extendSizeWorld=q.Hc.Zero(),this.directions=(0,s.b)(3,q.Hc.Zero),this.vectorsWorld=(0,s.b)(8,q.Hc.Zero),this.minimumWorld=q.Hc.Zero(),this.maximumWorld=q.Hc.Zero(),this.minimum=q.Hc.Zero(),this.maximum=q.Hc.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(a,c,o)}reConstruct(a,c,o){const s=a.x,t=a.y,i=a.z,p=c.x,G=c.y,T=c.z,C=this.vectors;this.minimum.Bc(s,t,i),this.maximum.Bc(p,G,T),C[0].Bc(s,t,i),C[1].Bc(p,G,T),C[2].Bc(p,t,i),C[3].Bc(s,G,i),C[4].Bc(s,t,T),C[5].Bc(p,G,i),C[6].Bc(s,G,T),C[7].Bc(p,t,T),c.addToRef(a,this.center).scaleInPlace(.5),c.subtractToRef(a,this.extendSize).scaleInPlace(.5),this._worldMatrix=o||q.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(a){const c=i._TmpVector3,o=this.maximum.subtractToRef(this.minimum,c[0]),s=o.length();o.normalizeFromLength(s);const q=s*a,t=o.scaleInPlace(.5*q),p=this.center.subtractToRef(t,c[1]),G=this.center.addToRef(t,c[2]);return this.reConstruct(p,G,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){const c=this.minimumWorld,o=this.maximumWorld,s=this.directions,t=this.vectorsWorld,i=this.vectors;if(a.isIdentity()){c.G(this.minimum),o.G(this.maximum);for(let a=0;a<8;++a)t[a].G(i[a]);this.extendSizeWorld.G(this.extendSize),this.centerWorld.G(this.center)}else{c.Dc(Number.MAX_VALUE),o.Dc(-Number.MAX_VALUE);for(let s=0;s<8;++s){const p=t[s];q.Hc.TransformCoordinatesToRef(i[s],a,p),c.minimizeInPlace(p),o.maximizeInPlace(p)}o.subtractToRef(c,this.extendSizeWorld).scaleInPlace(.5),o.addToRef(c,this.centerWorld).scaleInPlace(.5)}q.Hc.FromArrayToRef(a.m,0,s[0]),q.Hc.FromArrayToRef(a.m,4,s[1]),q.Hc.FromArrayToRef(a.m,8,s[2]),this._worldMatrix=a}isInFrustum(a){return i.IsInFrustum(this.vectorsWorld,a)}isCompletelyInFrustum(a){return i.IsCompletelyInFrustum(this.vectorsWorld,a)}intersectsPoint(a){const c=this.minimumWorld,o=this.maximumWorld,s=c.x,q=c.y,i=c.z,p=o.x,G=o.y,T=o.z,C=a.x,j=a.y,L=a.z,e=-t.b;return!(p-C<e||e>C-s)&&(!(G-j<e||e>j-q)&&!(T-L<e||e>L-i))}intersectsSphere(a){return i.IntersectsSphere(this.minimumWorld,this.maximumWorld,a.centerWorld,a.radiusWorld)}intersectsMinMax(a,c){const o=this.minimumWorld,s=this.maximumWorld,q=o.x,t=o.y,i=o.z,p=s.x,G=s.y,T=s.z,C=a.x,j=a.y,L=a.z,e=c.x,g=c.y,M=c.z;return!(p<C||q>e)&&(!(G<j||t>g)&&!(T<L||i>M))}dispose(){var a,c;null===(a=this._drawWrapperFront)||void 0===a||a.dispose(),null===(c=this._drawWrapperBack)||void 0===c||c.dispose()}static Intersects(a,c){return a.intersectsMinMax(c.minimumWorld,c.maximumWorld)}static IntersectsSphere(a,c,o,s){const t=i._TmpVector3[0];q.Hc.ClampToRef(o,a,c,t);return q.Hc.DistanceSquared(o,t)<=s*s}static IsCompletelyInFrustum(a,c){for(let o=0;o<6;++o){const s=c[o];for(let c=0;c<8;++c)if(s.dotCoordinate(a[c])<0)return!1}return!0}static IsInFrustum(a,c){for(let o=0;o<6;++o){let s=!0;const q=c[o];for(let c=0;c<8;++c)if(q.dotCoordinate(a[c])>=0){s=!1;break}if(s)return!1}return!0}}i._TmpVector3=(0,s.b)(3,q.Hc.Zero)},13140:(a,c,o)=>{o.d(c,{b:()=>j});var s=o(12820),q=o(12810),t=o(13142),i=o(13147);const p={min:0,max:0},G={min:0,max:0},T=(a,c,o)=>{const s=q.Hc.Dot(c.centerWorld,a),t=Math.abs(q.Hc.Dot(c.directions[0],a))*c.extendSize.x+Math.abs(q.Hc.Dot(c.directions[1],a))*c.extendSize.y+Math.abs(q.Hc.Dot(c.directions[2],a))*c.extendSize.z;o.min=s-t,o.max=s+t},C=(a,c,o)=>(T(a,c,p),T(a,o,G),!(p.min>G.max||G.min>p.max));class j{constructor(a,c,o){this._isLocked=!1,this.boundingBox=new t.c(a,c,o),this.boundingSphere=new i.b(a,c,o)}reConstruct(a,c,o){this.boundingBox.reConstruct(a,c,o),this.boundingSphere.reConstruct(a,c,o)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(a){this._isLocked=a}update(a){this._isLocked||(this.boundingBox._update(a),this.boundingSphere._update(a))}centerOn(a,c){const o=j._TmpVector3[0].G(a).Vj(c),s=j._TmpVector3[1].G(a).addInPlace(c);return this.boundingBox.reConstruct(o,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,s,this.boundingBox.getWorldMatrix()),this}encapsulate(a){const c=q.Hc.Minimize(this.minimum,a),o=q.Hc.Maximize(this.maximum,a);return this.reConstruct(c,o,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(a){const c=q.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(c);const o=q.TmpVectors.Hc[0];return q.Hc.TransformCoordinatesToRef(a.boundingBox.minimumWorld,c,o),this.encapsulate(o),q.Hc.TransformCoordinatesToRef(a.boundingBox.maximumWorld,c,o),this.encapsulate(o),this}scale(a){return this.boundingBox.scale(a),this.boundingSphere.scale(a),this}isInFrustum(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===c||3===c)&&this.boundingSphere.isCenterInFrustum(a))return!0;if(!this.boundingSphere.isInFrustum(a))return!1;return!(1!==c&&3!==c)||this.boundingBox.isInFrustum(a)}get diagonalLength(){const a=this.boundingBox;return a.maximumWorld.subtractToRef(a.minimumWorld,j._TmpVector3[0]).length()}isCompletelyInFrustum(a){return this.boundingBox.isCompletelyInFrustum(a)}_checkCollision(a){return a._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(a){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(a)&&!!this.boundingBox.intersectsPoint(a))}intersects(a,c){if(!i.b.Intersects(this.boundingSphere,a.boundingSphere))return!1;if(!t.c.Intersects(this.boundingBox,a.boundingBox))return!1;if(!c)return!0;const o=this.boundingBox,s=a.boundingBox;return!!C(o.directions[0],o,s)&&(!!C(o.directions[1],o,s)&&(!!C(o.directions[2],o,s)&&(!!C(s.directions[0],o,s)&&(!!C(s.directions[1],o,s)&&(!!C(s.directions[2],o,s)&&(!!C(q.Hc.Cross(o.directions[0],s.directions[0]),o,s)&&(!!C(q.Hc.Cross(o.directions[0],s.directions[1]),o,s)&&(!!C(q.Hc.Cross(o.directions[0],s.directions[2]),o,s)&&(!!C(q.Hc.Cross(o.directions[1],s.directions[0]),o,s)&&(!!C(q.Hc.Cross(o.directions[1],s.directions[1]),o,s)&&(!!C(q.Hc.Cross(o.directions[1],s.directions[2]),o,s)&&(!!C(q.Hc.Cross(o.directions[2],s.directions[0]),o,s)&&(!!C(q.Hc.Cross(o.directions[2],s.directions[1]),o,s)&&!!C(q.Hc.Cross(o.directions[2],s.directions[2]),o,s))))))))))))))}}j._TmpVector3=(0,s.b)(2,q.Hc.Zero)},13147:(a,c,o)=>{o.d(c,{b:()=>t});var s=o(12820),q=o(12810);class t{constructor(a,c,o){this.center=q.Hc.Zero(),this.centerWorld=q.Hc.Zero(),this.minimum=q.Hc.Zero(),this.maximum=q.Hc.Zero(),this.reConstruct(a,c,o)}reConstruct(a,c,o){this.minimum.G(a),this.maximum.G(c);const s=q.Hc.Distance(a,c);c.addToRef(a,this.center).scaleInPlace(.5),this.radius=.5*s,this._update(o||q.Matrix.IdentityReadOnly)}scale(a){const c=this.radius*a,o=t._TmpVector3,s=o[0].Dc(c),q=this.center.subtractToRef(s,o[1]),i=this.center.addToRef(s,o[2]);return this.reConstruct(q,i,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){if(a.isIdentity())this.centerWorld.G(this.center),this.radiusWorld=this.radius;else{q.Hc.TransformCoordinatesToRef(this.center,a,this.centerWorld);const c=t._TmpVector3[0];q.Hc.TransformNormalFromFloatsToRef(1,1,1,a,c),this.radiusWorld=Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))*this.radius}}isInFrustum(a){const c=this.centerWorld,o=this.radiusWorld;for(let s=0;s<6;s++)if(a[s].dotCoordinate(c)<=-o)return!1;return!0}isCenterInFrustum(a){const c=this.centerWorld;for(let o=0;o<6;o++)if(a[o].dotCoordinate(c)<0)return!1;return!0}intersectsPoint(a){const c=q.Hc.DistanceSquared(this.centerWorld,a);return!(this.radiusWorld*this.radiusWorld<c)}static Intersects(a,c){const o=q.Hc.DistanceSquared(a.centerWorld,c.centerWorld),s=a.radiusWorld+c.radiusWorld;return!(s*s<o)}static CreateFromCenterAndRadius(a,c,o){this._TmpVector3[0].G(a),this._TmpVector3[1].Bc(0,0,c),this._TmpVector3[2].G(a),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Vj(this._TmpVector3[1]);const s=new t(this._TmpVector3[0],this._TmpVector3[2]);return s._worldMatrix=o||q.Matrix.Identity(),s}}t._TmpVector3=(0,s.b)(3,q.Hc.Zero)},13164:(a,c,o)=>{function s(a){-1===a.indexOf("vClipPlane")&&a.push("vClipPlane"),-1===a.indexOf("vClipPlane2")&&a.push("vClipPlane2"),-1===a.indexOf("vClipPlane3")&&a.push("vClipPlane3"),-1===a.indexOf("vClipPlane4")&&a.push("vClipPlane4"),-1===a.indexOf("vClipPlane5")&&a.push("vClipPlane5"),-1===a.indexOf("vClipPlane6")&&a.push("vClipPlane6")}function q(a,c,o){const s=!!(a.clipPlane??c.clipPlane),q=!!(a.clipPlane2??c.clipPlane2),t=!!(a.clipPlane3??c.clipPlane3),i=!!(a.clipPlane4??c.clipPlane4),p=!!(a.clipPlane5??c.clipPlane5),G=!!(a.clipPlane6??c.clipPlane6);s&&o.push("#define CLIPPLANE"),q&&o.push("#define CLIPPLANE2"),t&&o.push("#define CLIPPLANE3"),i&&o.push("#define CLIPPLANE4"),p&&o.push("#define CLIPPLANE5"),G&&o.push("#define CLIPPLANE6")}function t(a,c,o){let s=!1;const q=!!(a.clipPlane??c.clipPlane),t=!!(a.clipPlane2??c.clipPlane2),i=!!(a.clipPlane3??c.clipPlane3),p=!!(a.clipPlane4??c.clipPlane4),G=!!(a.clipPlane5??c.clipPlane5),T=!!(a.clipPlane6??c.clipPlane6);return o.CLIPPLANE!==q&&(o.CLIPPLANE=q,s=!0),o.CLIPPLANE2!==t&&(o.CLIPPLANE2=t,s=!0),o.CLIPPLANE3!==i&&(o.CLIPPLANE3=i,s=!0),o.CLIPPLANE4!==p&&(o.CLIPPLANE4=p,s=!0),o.CLIPPLANE5!==G&&(o.CLIPPLANE5=G,s=!0),o.CLIPPLANE6!==T&&(o.CLIPPLANE6=T,s=!0),s}function i(a,c,o){let s=c.clipPlane??o.clipPlane;p(a,"vClipPlane",s),s=c.clipPlane2??o.clipPlane2,p(a,"vClipPlane2",s),s=c.clipPlane3??o.clipPlane3,p(a,"vClipPlane3",s),s=c.clipPlane4??o.clipPlane4,p(a,"vClipPlane4",s),s=c.clipPlane5??o.clipPlane5,p(a,"vClipPlane5",s),s=c.clipPlane6??o.clipPlane6,p(a,"vClipPlane6",s)}function p(a,c,o){o&&a.setFloat4(c,o.normal.x,o.normal.y,o.normal.z,o.d)}o.d(c,{e:()=>s,i:()=>i,l:()=>t,o:()=>q})},13118:(a,c,o)=>{o.d(c,{e:()=>s});class s{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(a,c){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=new Array),this._defines[a].push(c)}addCPUSkinningFallback(a,c){this._mesh=c,a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(a,c){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,a=a.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c._bonesComputationForcedToCPU=!0;const o=this._mesh.Za();for(let a=0;a<o.meshes.length;a++){const s=o.meshes[a];if(s.material){if(s.computeBonesUsingShaders&&0!==s.numBoneInfluencers)if(s.material.getEffect()===c)s.computeBonesUsingShaders=!1;else if(s.wc)for(const a of s.wc){if(a.effect===c){s.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&s.computeBonesUsingShaders&&s.numBoneInfluencers>0&&(s.computeBonesUsingShaders=!1)}}else{const c=this._defines[this._currentRank];if(c)for(let o=0;o<c.length;o++)a=a.replace("#define "+c[o],"");this._currentRank++}return a}}},13127:(a,c,o)=>{o.d(c,{b:()=>N});var s=o(12798),q=o(12800),t=o(12637),i=o(12639),p=o(12680),G=o(13130),T=o(13071),C=o(12649),j=o(12862),L=o(12925),e=o(12845);class g{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(a){this._func=a}get funcRef(){return this._funcRef}set funcRef(a){this._funcRef=a}get funcMask(){return this._funcMask}set funcMask(a){this._funcMask=a}get opStencilFail(){return this._opStencilFail}set opStencilFail(a){this._opStencilFail=a}get opDepthFail(){return this._opDepthFail}set opDepthFail(a){this._opDepthFail=a}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(a){this._opStencilDepthPass=a}get mask(){return this._mask}set mask(a){this._mask=a}get enabled(){return this._enabled}set enabled(a){this._enabled=a}getClassName(){return"MaterialStencilState"}copyTo(a){e.d.Clone((()=>a),this)}serialize(){return e.d.Serialize(this)}parse(a,c,o){e.d.Parse((()=>this),a,c,o)}}(0,s.d)([(0,q.E)()],g.prototype,"func",null),(0,s.d)([(0,q.E)()],g.prototype,"funcRef",null),(0,s.d)([(0,q.E)()],g.prototype,"funcMask",null),(0,s.d)([(0,q.E)()],g.prototype,"opStencilFail",null),(0,s.d)([(0,q.E)()],g.prototype,"opDepthFail",null),(0,s.d)([(0,q.E)()],g.prototype,"opStencilDepthPass",null),(0,s.d)([(0,q.E)()],g.prototype,"mask",null),(0,s.d)([(0,q.E)()],g.prototype,"enabled",null);var M=o(13155);class N{get _supportGlowLayer(){return!1}set _glowModeEnabled(a){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(a){if(this._alpha===a)return;const c=this._alpha;this._alpha=a,1!==c&&1!==a||this.FC(N.MiscDirtyFlag+N.PrePassDirtyFlag)}get alpha(){return this._alpha}set Fc(a){this._backFaceCulling!==a&&(this._backFaceCulling=a,this.FC(N.TextureDirtyFlag))}get Fc(){return this._backFaceCulling}set cullBackFaces(a){this._cullBackFaces!==a&&(this._cullBackFaces=a,this.FC(N.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(a){this._blockDirtyMechanism!==a&&(this._blockDirtyMechanism=a,a||this.dL())}atomicMaterialsUpdate(a){this.blockDirtyMechanism=!0;try{a(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(a){this._onDisposeObserver&&this.gc.remove(this._onDisposeObserver),this._onDisposeObserver=this.gc.add(a)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new i.d),this._onBindObservable}set onBind(a){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(a)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new i.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new i.d),this._onEffectCreatedObservable}set alphaMode(a){this._alphaMode!==a&&(this._alphaMode=a,this.FC(N.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(a){this._needDepthPrePass!==a&&(this._needDepthPrePass=a,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(a){this._fogEnabled!==a&&(this._fogEnabled=a,this.FC(N.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case N.WireFrameFillMode:case N.LineListDrawMode:case N.LineLoopDrawMode:case N.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(a){this.fillMode=a?N.WireFrameFillMode:N.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case N.PointFillMode:case N.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(a){this.fillMode=a?N.PointFillMode:N.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(a){this._fillMode!==a&&(this._fillMode=a,this.FC(N.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){const c=this.Za().getEngine().getCaps().fragmentDepthSupported;a&&!c&&C.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=a&&c,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(a){this._drawWrapper=a}constructor(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.gc=new i.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Nc=new g,this._useUBO=!1,this._fillMode=N.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=a;const q=c||p.b.LastCreatedScene;q&&(this._scene=q,this._dirtyCallbacks={},this._forceGLSL=s,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=a||t.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new L.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new T.c(this._scene.getEngine(),void 0,void 0,a),this._useUBO=this.Za().getEngine().supportsUniformBuffers,this._createUniformBuffer(),o||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),N.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var a;const c=this.Za().getEngine();null===(a=this._uniformBuffer)||void 0===a||a.dispose(),c.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new T.c(c,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new T.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(a){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.dL(),this.checkReadyOnlyOnce=!0}unfreeze(){this.dL(),this.checkReadyOnlyOnce=!1}isReady(a,c){return!0}isReadyForSubMesh(a,c,o){const s=c.materialDefines;return!!s&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Za(){return this._scene}_getEffectiveOrientation(a){return null!==this.sideOrientation?this.sideOrientation:a.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(a){this._transparencyMode!==a&&(this._transparencyMode=a,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===N.MATERIAL_ALPHABLEND||this._transparencyMode===N.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===N.MATERIAL_ALPHATEST||this._transparencyMode===N.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===N.MATERIAL_OPAQUE||this._transparencyMode===N.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(a){return this._hasTransparencyMode?this._transparencyModeIsBlend:a.visibility<1||!this._disableAlphaBlending&&(a.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(a){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(a)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}dL(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.Za().meshes;for(const o of c)if(o.wc)for(const c of o.wc)if(c.Ba()===this)for(const o of c._drawWrappers)o&&this._materialContext===o.materialContext&&(o._wasPreviouslyReady=!1,o._wasPreviouslyUsingInstances=null,o._forceRebindOnNextCall=a);a&&this.FC(N.AllDirtyFlag)}_preBind(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this._scene.getEngine(),s=(null==c?this.sideOrientation:c)===N.ClockWiseSideOrientation;return o.enableEffect(a||this._getDrawWrapper()),o.setState(this.Fc,this.zOffset,!1,s,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Nc,this.zOffsetUnits),s}bind(a,c){}buildUniformLayout(){const a=this._uniformBuffer;this._eventInfo.ubo=a,this._callbackPluginEventGeneric(8,this._eventInfo),a.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(a,c,o){const s=o._drawWrapper;this._eventInfo.subMesh=o,this._callbackPluginEventBindForSubMesh(this._eventInfo),s._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(a){}bindView(a){this._useUBO?this._needToBindSceneUbo=!0:a.setMatrix("view",this.Za().getViewMatrix())}bindViewProjection(a){this._useUBO?this._needToBindSceneUbo=!0:(a.setMatrix("viewProjection",this.Za().getTransformMatrix()),a.setMatrix("projection",this.Za().getProjectionMatrix()))}bindEyePosition(a,c){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(a,c)}_afterBind(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&c&&(this._needToBindSceneUbo=!1,(0,M.v)(c,this.Za().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=a?a.visibility:1,this._onBindObservable&&a&&this._onBindObservable.notifyObservers(a),this.disableDepthWrite){const a=this._scene.getEngine();this._cachedDepthWriteState=a.getDepthWrite(),a.setDepthWrite(!1)}if(this.disableColorWrite){const a=this._scene.getEngine();this._cachedColorWriteState=a.getColorWrite(),a.setColorWrite(!1)}if(0!==this.depthFunction){const a=this._scene.getEngine();this._cachedDepthFunctionState=a.getDepthFunction()||0,a.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(a){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=a,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(a){return null}_clonePlugins(a,c){const o={};if(this._serializePlugins(o),N._ParsePlugins(o,a,this._scene,c),this.pluginManager)for(const s of this.pluginManager._plugins){const c=a.pluginManager.getPlugin(s.name);c&&s.copyTo(c)}}getBindedMeshes(){if(this.meshMap){const a=[];for(const c in this.meshMap){const o=this.meshMap[c];o&&a.push(o)}return a}return this._scene.meshes.filter((a=>a.material===this))}forceCompilation(a,c,o,s){const q={clipPlane:!1,useInstances:!1,...o},t=this.Za(),i=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const p=()=>{if(!this._scene||!this._scene.getEngine())return;const o=t.clipPlane;if(q.clipPlane&&(t.clipPlane=new j.e(0,0,0,1)),this._storeEffectOnSubMeshes){let o=!0,t=null;if(a.wc){const c=new G.c(0,0,0,0,0,a,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),this.isReadyForSubMesh(a,c,q.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?t=c.effect.getCompilationError():(o=!1,setTimeout(p,16)))}o&&(this.allowShaderHotSwapping=i,t&&s&&s(t),c&&c(this))}else this.isReady()?(this.allowShaderHotSwapping=i,c&&c(this)):setTimeout(p,16);q.clipPlane&&(t.clipPlane=o)};p()}async forceCompilationAsync(a,c){return await new Promise(((o,s)=>{this.forceCompilation(a,(()=>{o()}),c,(a=>{s(a)}))}))}FC(a){this.Za().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(N._DirtyCallbackArray.length=0,a&N.ImageProcessingDirtyFlag&&N._DirtyCallbackArray.push(N._ImageProcessingDirtyCallBack),a&N.TextureDirtyFlag&&N._DirtyCallbackArray.push(N._TextureDirtyCallBack),a&N.LightDirtyFlag&&N._DirtyCallbackArray.push(N._LightsDirtyCallBack),a&N.FresnelDirtyFlag&&N._DirtyCallbackArray.push(N._FresnelDirtyCallBack),a&N.AttributesDirtyFlag&&N._DirtyCallbackArray.push(N._AttributeDirtyCallBack),a&N.MiscDirtyFlag&&N._DirtyCallbackArray.push(N._MiscDirtyCallBack),a&N.PrePassDirtyFlag&&N._DirtyCallbackArray.push(N._PrePassDirtyCallBack),N._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(N._RunDirtyCallBacks),this.Za().resetCachedMaterial())}resetDrawCache(){const a=this.Za().meshes;for(const c of a)if(c.wc)for(const a of c.wc)a.Ba()===this&&a.resetDrawCache()}_markAllSubMeshesAsDirty(a){const c=this.Za();if(c.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const o=c.meshes;for(const s of o)if(s.wc)for(const o of s.wc){if((o.Ba()||(c._hasDefaultMaterial?c.defaultMaterial:null))===this)for(const c of o._drawWrappers)c&&c.defines&&c.defines.markAllAsDirty&&this._materialContext===c.materialContext&&a(c.defines)}}_markScenePrePassDirty(){if(this.Za().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const a=this.Za().enablePrePassRenderer();a&&a.FC()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(N._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(N._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(N._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(N._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(N._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(N._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(N._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(N._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(N._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(N._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const a=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.gc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(a)}))}}setPrePassRenderer(a){return!1}dispose(a,c,o){const s=this.Za();if(s.stopAnimation(this),s.freeProcessedMaterials(),s.removeMaterial(this),this._eventInfo.forceDisposeTextures=c,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const a=this._parentContainer.materials.indexOf(this);a>-1&&this._parentContainer.materials.splice(a,1),this._parentContainer=null}if(!0!==o)if(this.meshMap)for(const q in this.meshMap){const a=this.meshMap[q];this._disposeMeshResources(a)}else{const a=s.meshes;for(const c of a)this._disposeMeshResources(c)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.gc.notifyObservers(this),this.gc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(a){if(!a)return;const c=a.dc,o=a._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(a.wc&&o)for(const q of a.wc){const a=q._drawWrappers;for(let t=0;t<a.length;t++){var s;const i=null===(s=a[t])||void 0===s?void 0:s.effect;if(!i)continue;o[t]===this&&(null===c||void 0===c||c._releaseVertexArrayObject(i),q._removeDrawWrapper(t,!0,!0))}}}else null===c||void 0===c||c._releaseVertexArrayObject(this._drawWrapper.effect);a.material!==this||a.sourceMesh||(a.material=null)}serialize(){const a=e.d.Serialize(this);return a.Nc=this.Nc.serialize(),a.uniqueId=this.uniqueId,this._serializePlugins(a),a}_serializePlugins(a){if(a.plugins={},this.pluginManager)for(const c of this.pluginManager._plugins)c.doNotSerialize||(a.plugins[c.getClassName()]=c.serialize())}static Parse(a,c,o){if(a.customType){if("BABYLON.PBRMaterial"===a.customType&&a.overloadedAlbedo&&(a.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return C.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else a.customType="BABYLON.StandardMaterial";const s=t.Tools.Instantiate(a.customType).Parse(a,c,o);return s._loadedUniqueId=a.uniqueId,s}static _ParsePlugins(a,c,o,s){if(a.plugins)for(const p in a.plugins){var q,i;const G=a.plugins[p];let T=null===(q=c.pluginManager)||void 0===q?void 0:q.getPlugin(G.name);if(!T){const a=t.Tools.Instantiate("BABYLON."+p);a&&(T=new a(c))}null===(i=T)||void 0===i||i.parse(G,o,s)}}}N.TriangleFillMode=0,N.WireFrameFillMode=1,N.PointFillMode=2,N.PointListDrawMode=3,N.LineListDrawMode=4,N.LineLoopDrawMode=5,N.LineStripDrawMode=6,N.TriangleStripDrawMode=7,N.TriangleFanDrawMode=8,N.ClockWiseSideOrientation=0,N.CounterClockWiseSideOrientation=1,N.ImageProcessingDirtyFlag=64,N.TextureDirtyFlag=1,N.LightDirtyFlag=2,N.FresnelDirtyFlag=4,N.AttributesDirtyFlag=8,N.MiscDirtyFlag=16,N.PrePassDirtyFlag=32,N.AllDirtyFlag=127,N.MATERIAL_OPAQUE=0,N.MATERIAL_ALPHATEST=1,N.MATERIAL_ALPHABLEND=2,N.MATERIAL_ALPHATESTANDBLEND=3,N.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,N.MATERIAL_NORMALBLENDMETHOD_RNM=1,N.OnEventObservable=new i.d,N._AllDirtyCallBack=a=>a.markAllAsDirty(),N._ImageProcessingDirtyCallBack=a=>a.markAsImageProcessingDirty(),N._TextureDirtyCallBack=a=>a.markAsTexturesDirty(),N._FresnelDirtyCallBack=a=>a.markAsFresnelDirty(),N._MiscDirtyCallBack=a=>a.markAsMiscDirty(),N._PrePassDirtyCallBack=a=>a.markAsPrePassDirty(),N._LightsDirtyCallBack=a=>a.markAsLightDirty(),N._AttributeDirtyCallBack=a=>a.markAsAttributesDirty(),N._FresnelAndMiscDirtyCallBack=a=>{N._FresnelDirtyCallBack(a),N._MiscDirtyCallBack(a)},N._TextureAndMiscDirtyCallBack=a=>{N._TextureDirtyCallBack(a),N._MiscDirtyCallBack(a)},N._DirtyCallbackArray=[],N._RunDirtyCallBacks=a=>{for(const c of N._DirtyCallbackArray)c(a)},(0,s.d)([(0,q.E)()],N.prototype,"id",void 0),(0,s.d)([(0,q.E)()],N.prototype,"uniqueId",void 0),(0,s.d)([(0,q.E)()],N.prototype,"name",void 0),(0,s.d)([(0,q.E)()],N.prototype,"metadata",void 0),(0,s.d)([(0,q.E)()],N.prototype,"checkReadyOnEveryCall",void 0),(0,s.d)([(0,q.E)()],N.prototype,"checkReadyOnlyOnce",void 0),(0,s.d)([(0,q.E)()],N.prototype,"state",void 0),(0,s.d)([(0,q.E)("alpha")],N.prototype,"_alpha",void 0),(0,s.d)([(0,q.E)("Fc")],N.prototype,"_backFaceCulling",void 0),(0,s.d)([(0,q.E)("cullBackFaces")],N.prototype,"_cullBackFaces",void 0),(0,s.d)([(0,q.E)()],N.prototype,"sideOrientation",void 0),(0,s.d)([(0,q.E)("alphaMode")],N.prototype,"_alphaMode",void 0),(0,s.d)([(0,q.E)()],N.prototype,"_needDepthPrePass",void 0),(0,s.d)([(0,q.E)()],N.prototype,"disableDepthWrite",void 0),(0,s.d)([(0,q.E)()],N.prototype,"disableColorWrite",void 0),(0,s.d)([(0,q.E)()],N.prototype,"forceDepthWrite",void 0),(0,s.d)([(0,q.E)()],N.prototype,"depthFunction",void 0),(0,s.d)([(0,q.E)()],N.prototype,"separateCullingPass",void 0),(0,s.d)([(0,q.E)("fogEnabled")],N.prototype,"_fogEnabled",void 0),(0,s.d)([(0,q.E)()],N.prototype,"pointSize",void 0),(0,s.d)([(0,q.E)()],N.prototype,"zOffset",void 0),(0,s.d)([(0,q.E)()],N.prototype,"zOffsetUnits",void 0),(0,s.d)([(0,q.E)()],N.prototype,"pointsCloud",null),(0,s.d)([(0,q.E)()],N.prototype,"fillMode",null),(0,s.d)([(0,q.E)()],N.prototype,"useLogarithmicDepth",null),(0,s.d)([(0,q.E)()],N.prototype,"transparencyMode",null)},13155:(a,c,o)=>{o.d(c,{C:()=>U,E:()=>n,F:()=>Z,J:()=>h,K:()=>e,N:()=>L,P:()=>d,S:()=>R,U:()=>r,Y:()=>y,ab:()=>S,bb:()=>X,e:()=>f,eb:()=>W,gb:()=>F,h:()=>j,kb:()=>B,l:()=>w,lb:()=>g,n:()=>C,r:()=>M,v:()=>N,y:()=>k});var s=o(12649),q=o(12858),t=o(12680),i=o(13110),p=o(13164);const G=q.oo.Black(),T={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function C(a,c,o){if(!a||a.LOGARITHMICDEPTH||a.indexOf&&a.indexOf("LOGARITHMICDEPTH")>=0){const a=o.activeCamera;1===a.mode&&s.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),c.setFloat("logarithmicDepthConstant",2/(Math.log(a.maxZ+1)/Math.LN2))}}function j(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];o&&a.fogEnabled&&(!c||c.applyFog)&&0!==a.fogMode&&(o.setFloat4("vFogInfos",a.fogMode,a.fogStart,a.fogEnd,a.fogDensity),s?(a.fogColor.toLinearSpaceToRef(G,a.getEngine().useExactSrgbConversions),o.setColor3("vFogColor",G)):o.setColor3("vFogColor",a.fogColor))}function L(a,c,o,s,q,t,i,p,G,C){const j=a.numMaxInfluencers||a.numInfluencers;return j<=0?0:(c.push("#define MORPHTARGETS"),a.hasPositions&&c.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),a.hasNormals&&c.push("#define MORPHTARGETTEXTURE_HASNORMALS"),a.hasTangents&&c.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),a.hasUVs&&c.push("#define MORPHTARGETTEXTURE_HASUVS"),a.hasUV2s&&c.push("#define MORPHTARGETTEXTURE_HASUV2S"),a.hasColors&&c.push("#define MORPHTARGETTEXTURE_HASCOLORS"),a.supportsPositions&&q&&c.push("#define MORPHTARGETS_POSITION"),a.supportsNormals&&t&&c.push("#define MORPHTARGETS_NORMAL"),a.supportsTangents&&i&&c.push("#define MORPHTARGETS_TANGENT"),a.supportsUVs&&p&&c.push("#define MORPHTARGETS_UV"),a.supportsUV2s&&G&&c.push("#define MORPHTARGETS_UV2"),a.supportsColors&&C&&c.push("#define MORPHTARGETS_COLOR"),c.push("#define NUM_MORPH_INFLUENCERS "+j),a.isUsingTextureForTargets&&c.push("#define MORPHTARGETS_TEXTURE"),T.NUM_MORPH_INFLUENCERS=j,T.NORMAL=t,T.TANGENT=i,T.UV=p,T.UV2=G,T.COLOR=C,e(o,s,T,q),j)}function e(a,c,o){let q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=o.NUM_MORPH_INFLUENCERS;if(i>0&&t.b.LastCreatedEngine){const p=t.b.LastCreatedEngine.getCaps().maxVertexAttribs,G=c.morphTargetManager;if(null!==G&&void 0!==G&&G.isUsingTextureForTargets)return;const T=G&&G.supportsPositions&&q,C=G&&G.supportsNormals&&o.NORMAL,j=G&&G.supportsTangents&&o.TANGENT,L=G&&G.supportsUVs&&o.UV1,e=G&&G.supportsUV2s&&o.UV2,g=G&&G.supportsColors&&o.VERTEXCOLOR;for(let o=0;o<i;o++)T&&a.push("position"+o),C&&a.push("normal"+o),j&&a.push("tangent"+o),L&&a.push("uv_"+o),e&&a.push("uv2_"+o),g&&a.push("color"+o),a.length>p&&s.c.Error("Cannot add more vertex attributes for mesh "+c.name)}}function g(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"),c&&(a.push("previousWorld0"),a.push("previousWorld1"),a.push("previousWorld2"),a.push("previousWorld3"))}function M(a,c){const o=a.morphTargetManager;a&&o&&c.setFloatArray("morphTargetInfluences",o.influences)}function N(a,c){c.bindToEffect(a,"Scene")}function y(a,c,o){c._needUVs=!0,c[o]=!0,a.optimizeUVAllocation&&a.getTextureMatrix().isIdentityAs3x2()?(c[o+"DIRECTUV"]=a.coordinatesIndex+1,c["MAINUV"+(a.coordinatesIndex+1)]=!0):c[o+"DIRECTUV"]=0}function k(a,c,o){const s=a.getTextureMatrix();c.xc(o+"Matrix",s)}function n(a,c,o){o.BAKED_VERTEX_ANIMATION_TEXTURE&&o.INSTANCES&&a.push("bakedVertexAnimationSettingsInstanced")}function f(a,c,o){var s;if(c&&a&&(a.computeBonesUsingShaders&&c._bonesComputationForcedToCPU&&(a.computeBonesUsingShaders=!1),a.useBones&&a.computeBonesUsingShaders&&a.skeleton)){const q=a.skeleton;if(q.isUsingTextureForMatrices&&c.getUniformIndex("boneTextureWidth")>-1){const o=q.getTransformMatrixTexture(a);c.setTexture("boneSampler",o),c.setFloat("boneTextureWidth",4*(q.bones.length+1))}else{const t=q.getTransformMatrices(a);t&&(c.setMatrices("mBones",t),o&&a.Za().prePassRenderer&&a.Za().prePassRenderer.getIndex(2)&&(o.previousBones[a.uniqueId]||(o.previousBones[a.uniqueId]=t.slice()),c.setMatrices("mPreviousBones",o.previousBones[a.uniqueId]),s=t,o.previousBones[a.uniqueId].set(s)))}}}function J(a,c,o,s,q){let t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];a._bindLight(c,o,s,q,t)}function w(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const t=Math.min(c.lightSources.length,q);for(let i=0;i<t;i++){J(c.lightSources[i],i,a,o,"boolean"===typeof s?s:s.SPECULARTERM,c.receiveShadows)}}function Z(a,c,o,s){o.NUM_BONE_INFLUENCERS>0&&(s.addCPUSkinningFallback(0,c),a.push("matricesIndices"),a.push("matricesWeights"),o.NUM_BONE_INFLUENCERS>4&&(a.push("matricesIndicesExtra"),a.push("matricesWeightsExtra")))}function h(a,c){(c.INSTANCES||c.THIN_INSTANCES)&&g(a,!!c.PREPASS_VELOCITY),c.INSTANCESCOLOR&&a.push("instanceColor")}function U(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=0;for(let t=0;t<o&&a["LIGHT"+t];t++)t>0&&(q=s+t,c.addFallback(q,"LIGHT"+t)),a.SHADOWS||(a["SHADOW"+t]&&c.addFallback(s,"SHADOW"+t),a["SHADOWPCF"+t]&&c.addFallback(s,"SHADOWPCF"+t),a["SHADOWPCSS"+t]&&c.addFallback(s,"SHADOWPCSS"+t),a["SHADOWPOISSON"+t]&&c.addFallback(s,"SHADOWPOISSON"+t),a["SHADOWESM"+t]&&c.addFallback(s,"SHADOWESM"+t),a["SHADOWCLOSEESM"+t]&&c.addFallback(s,"SHADOWCLOSEESM"+t));return q++}function S(a,c,o,s,q,t,i){let p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];i._areMiscDirty&&(i.LOGARITHMICDEPTH=o,i.POINTSIZE=s,i.FOG=q&&function(a,c){return c.fogEnabled&&a.applyFog&&0!==c.fogMode}(a,c),i.NONUNIFORMSCALING=a.nonUniformScaling,i.ALPHATEST=t,i.DECAL_AFTER_DETAIL=p)}function r(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!o._areLightsDirty)return o._needNormals;let i=0;const p={needNormals:o._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(a.lightsEnabled&&!t)for(const T of c.lightSources)if(x(a,c,T,i,o,s,p),i++,i===q)break;o.SPECULARTERM=p.specularEnabled,o.SHADOWS=p.shadowEnabled;for(let T=i;T<q;T++)void 0!==o["LIGHT"+T]&&(o["LIGHT"+T]=!1,o["HEMILIGHT"+T]=!1,o["POINTLIGHT"+T]=!1,o["DIRLIGHT"+T]=!1,o["SPOTLIGHT"+T]=!1,o["AREALIGHT"+T]=!1,o["SHADOW"+T]=!1,o["SHADOWCSM"+T]=!1,o["SHADOWCSMDEBUG"+T]=!1,o["SHADOWCSMNUM_CASCADES"+T]=!1,o["SHADOWCSMUSESHADOWMAXZ"+T]=!1,o["SHADOWCSMNOBLEND"+T]=!1,o["SHADOWCSM_RIGHTHANDED"+T]=!1,o["SHADOWPCF"+T]=!1,o["SHADOWPCSS"+T]=!1,o["SHADOWPOISSON"+T]=!1,o["SHADOWESM"+T]=!1,o["SHADOWCLOSEESM"+T]=!1,o["SHADOWCUBE"+T]=!1,o["SHADOWLOWQUALITY"+T]=!1,o["SHADOWMEDIUMQUALITY"+T]=!1);const G=a.getEngine().getCaps();return void 0===o.SHADOWFLOAT&&(p.needRebuild=!0),o.SHADOWFLOAT=p.shadowEnabled&&(G.textureFloatRender&&G.textureFloatLinearFiltering||G.textureHalfFloatRender&&G.textureHalfFloatLinearFiltering),o.LIGHTMAPEXCLUDED=p.lightmapMode,p.needRebuild&&o.rebuild(),p.needNormals}function x(a,c,o,s,q,t,p){switch(p.needNormals=!0,void 0===q["LIGHT"+s]&&(p.needRebuild=!0),q["LIGHT"+s]=!0,q["SPOTLIGHT"+s]=!1,q["HEMILIGHT"+s]=!1,q["POINTLIGHT"+s]=!1,q["DIRLIGHT"+s]=!1,q["AREALIGHT"+s]=!1,o.prepareLightSpecificDefines(q,s),q["LIGHT_FALLOFF_PHYSICAL"+s]=!1,q["LIGHT_FALLOFF_GLTF"+s]=!1,q["LIGHT_FALLOFF_STANDARD"+s]=!1,o.falloffType){case i.e.FALLOFF_GLTF:q["LIGHT_FALLOFF_GLTF"+s]=!0;break;case i.e.FALLOFF_PHYSICAL:q["LIGHT_FALLOFF_PHYSICAL"+s]=!0;break;case i.e.FALLOFF_STANDARD:q["LIGHT_FALLOFF_STANDARD"+s]=!0}if(t&&!o.ij.equalsFloats(0,0,0)&&(p.specularEnabled=!0),q["SHADOW"+s]=!1,q["SHADOWCSM"+s]=!1,q["SHADOWCSMDEBUG"+s]=!1,q["SHADOWCSMNUM_CASCADES"+s]=!1,q["SHADOWCSMUSESHADOWMAXZ"+s]=!1,q["SHADOWCSMNOBLEND"+s]=!1,q["SHADOWCSM_RIGHTHANDED"+s]=!1,q["SHADOWPCF"+s]=!1,q["SHADOWPCSS"+s]=!1,q["SHADOWPOISSON"+s]=!1,q["SHADOWESM"+s]=!1,q["SHADOWCLOSEESM"+s]=!1,q["SHADOWCUBE"+s]=!1,q["SHADOWLOWQUALITY"+s]=!1,q["SHADOWMEDIUMQUALITY"+s]=!1,c&&c.receiveShadows&&a.shadowsEnabled&&o.shadowEnabled){const c=o.getShadowGenerator(a.activeCamera)??o.getShadowGenerator();if(c){const a=c.getShadowMap();a&&a.renderList&&a.renderList.length>0&&(p.shadowEnabled=!0,c.prepareDefines(q,s))}}o.lightmapMode!=i.e.LIGHTMAP_DEFAULT?(p.lightmapMode=!0,q["LIGHTMAPEXCLUDED"+s]=!0,q["LIGHTMAPNOSPECULAR"+s]=o.lightmapMode==i.e.LIGHTMAP_SHADOWSONLY):(q["LIGHTMAPEXCLUDED"+s]=!1,q["LIGHTMAPNOSPECULAR"+s]=!1)}function R(a,c,o,s,q){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=function(a,c){let o=!1;if(a.activeCamera){const s=c.CAMERA_ORTHOGRAPHIC?1:0,q=c.CAMERA_PERSPECTIVE?1:0,t=1===a.activeCamera.mode?1:0,i=0===a.activeCamera.mode?1:0;(s^t||q^i)&&(c.CAMERA_ORTHOGRAPHIC=1===t,c.CAMERA_PERSPECTIVE=1===i,o=!0)}return o}(a,s);!1!==t&&(G=(0,p.l)(o,a,s)),s.DEPTHPREPASS!==!c.getColorWrite()&&(s.DEPTHPREPASS=!s.DEPTHPREPASS,G=!0),s.INSTANCES!==q&&(s.INSTANCES=q,G=!0),s.THIN_INSTANCES!==i&&(s.THIN_INSTANCES=i,G=!0),G&&s.markAsUnprocessed()}function d(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!c._areAttributesDirty&&c._needNormals===c._normals&&c._needUVs===c._uvs)return!1;c._normals=c._needNormals,c._uvs=c._needUVs,c.NORMAL=c._needNormals&&a.isVerticesDataPresent("normal"),c._needNormals&&a.isVerticesDataPresent("tangent")&&(c.TANGENT=!0);for(let p=1;p<=6;++p)c["UV"+p]=!!c._needUVs&&a.isVerticesDataPresent(`uv${1===p?"":p}`);if(o){const o=a.useVertexColors&&a.isVerticesDataPresent("color");c.VERTEXCOLOR=o,c.VERTEXALPHA=a.hasVertexAlpha&&o&&t}return a.isVerticesDataPresent("instanceColor")&&(a.hasInstances||a.hasThinInstances)&&(c.INSTANCESCOLOR=!0),s&&function(a,c){if(a.useBones&&a.computeBonesUsingShaders&&a.skeleton){c.NUM_BONE_INFLUENCERS=a.numBoneInfluencers;const o=void 0!==c.BONETEXTURE;if(a.skeleton.isUsingTextureForMatrices&&o)c.BONETEXTURE=!0;else{c.BonesPerMesh=a.skeleton.bones.length+1,c.BONETEXTURE=!o&&void 0;const s=a.Za().prePassRenderer;if(s&&s.enabled){const o=-1===s.excludedSkinnedMesh.indexOf(a);c.BONES_VELOCITY_ENABLED=o}}}else c.NUM_BONE_INFLUENCERS=0,c.BonesPerMesh=0,void 0!==c.BONETEXTURE&&(c.BONETEXTURE=!1)}(a,c),q&&function(a,c){const o=a.morphTargetManager;o?(c.MORPHTARGETS_UV=o.supportsUVs&&c.UV1,c.MORPHTARGETS_UV2=o.supportsUV2s&&c.UV2,c.MORPHTARGETS_TANGENT=o.supportsTangents&&c.TANGENT,c.MORPHTARGETS_NORMAL=o.supportsNormals&&c.NORMAL,c.MORPHTARGETS_POSITION=o.supportsPositions,c.MORPHTARGETS_COLOR=o.supportsColors,c.MORPHTARGETTEXTURE_HASUVS=o.hasUVs,c.MORPHTARGETTEXTURE_HASUV2S=o.hasUV2s,c.MORPHTARGETTEXTURE_HASTANGENTS=o.hasTangents,c.MORPHTARGETTEXTURE_HASNORMALS=o.hasNormals,c.MORPHTARGETTEXTURE_HASPOSITIONS=o.hasPositions,c.MORPHTARGETTEXTURE_HASCOLORS=o.hasColors,c.NUM_MORPH_INFLUENCERS=o.numMaxInfluencers||o.numInfluencers,c.MORPHTARGETS=c.NUM_MORPH_INFLUENCERS>0,c.MORPHTARGETS_TEXTURE=o.isUsingTextureForTargets):(c.MORPHTARGETS_UV=!1,c.MORPHTARGETS_UV2=!1,c.MORPHTARGETS_TANGENT=!1,c.MORPHTARGETS_NORMAL=!1,c.MORPHTARGETS_POSITION=!1,c.MORPHTARGETS_COLOR=!1,c.MORPHTARGETTEXTURE_HASUVS=!1,c.MORPHTARGETTEXTURE_HASUV2S=!1,c.MORPHTARGETTEXTURE_HASTANGENTS=!1,c.MORPHTARGETTEXTURE_HASNORMALS=!1,c.MORPHTARGETTEXTURE_HASPOSITIONS=!1,c.MORPHTARGETTEXTURE_HAS_COLORS=!1,c.MORPHTARGETS=!1,c.NUM_MORPH_INFLUENCERS=0)}(a,c),i&&function(a,c){const o=a.bakedVertexAnimationManager;c.BAKED_VERTEX_ANIMATION_TEXTURE=!(!o||!o.isEnabled)}(a,c),!0}function X(a,c){if(a.activeCamera){const o=c.MULTIVIEW;c.MULTIVIEW=null!==a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1,c.MULTIVIEW!=o&&c.markAsUnprocessed()}}function W(a,c,o){const s=c.ORDER_INDEPENDENT_TRANSPARENCY,q=c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;c.ORDER_INDEPENDENT_TRANSPARENCY=a.useOrderIndependentTransparency&&o,c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!a.getEngine().getCaps().textureFloatLinearFiltering,s===c.ORDER_INDEPENDENT_TRANSPARENCY&&q===c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||c.markAsUnprocessed()}function F(a,c,o){const s=c.PREPASS;if(!c._arePrePassDirty)return;const q=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(a.prePassRenderer&&a.prePassRenderer.enabled&&o){c.PREPASS=!0,c.SCENE_MRT_COUNT=a.prePassRenderer.mrtCount,c.PREPASS_NORMAL_WORLDSPACE=a.prePassRenderer.generateNormalsInWorldSpace,c.PREPASS_COLOR=!0,c.PREPASS_COLOR_INDEX=0;for(let o=0;o<q.length;o++){const s=a.prePassRenderer.getIndex(q[o].type);-1!==s?(c[q[o].define]=!0,c[q[o].index]=s):c[q[o].define]=!1}}else{c.PREPASS=!1;for(let a=0;a<q.length;a++)c[q[a].define]=!1}c.PREPASS!=s&&(c.markAsUnprocessed(),c.markAsImageProcessingDirty())}function O(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];q&&q.push("Light"+a),t||(c.push("vLightData"+a,"vLightDiffuse"+a,"vLightSpecular"+a,"vLightDirection"+a,"vLightWidth"+a,"vLightHeight"+a,"vLightFalloff"+a,"vLightGround"+a,"lightMatrix"+a,"shadowsInfo"+a,"depthValues"+a),o.push("shadowTexture"+a),o.push("depthTexture"+a),c.push("viewFrustumZ"+a,"cascadeBlendFactor"+a,"lightSizeUVCorrection"+a,"depthCorrection"+a,"penumbraDarkness"+a,"frustumLengths"+a),s&&(o.push("projectionLightTexture"+a),c.push("textureProjectionMatrix"+a)),i&&o.push("iesLightTexture"+a))}function B(a,c,o){let s,q,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(a.uniformsNames){const i=a;s=i.uniformsNames,q=i.uniformBuffersNames,c=i.samplers,o=i.defines,t=i.maxSimultaneousLights||0}else s=a,c||(c=[]);for(let i=0;i<t&&o["LIGHT"+i];i++)O(i,s,c,o["PROJECTEDLIGHTTEXTURE"+i],q,!1,o["IESLIGHTTEXTURE"+i]);o.NUM_MORPH_INFLUENCERS&&(s.push("morphTargetInfluences"),s.push("morphTargetCount")),o.BAKED_VERTEX_ANIMATION_TEXTURE&&(s.push("bakedVertexAnimationSettings"),s.push("bakedVertexAnimationTextureSizeInverted"),s.push("bakedVertexAnimationTime"),c.push("bakedVertexAnimationTexture"))}},13123:(a,c,o)=>{o.d(c,{c:()=>t});var s=o(12810),q=o(13127);class t extends q.b{constructor(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(a,c,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new s.Matrix,this._storeEffectOnSubMeshes=o}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(a,c){return!!a&&(!this._storeEffectOnSubMeshes||(!a.wc||0===a.wc.length||this.isReadyForSubMesh(a,a.wc[0],c)))}_isReadyForSubMesh(a){const c=a.materialDefines;return!(this.checkReadyOnEveryCall||!a.effect||!c||c._renderId!==this.Za().getRenderId())}bindOnlyWorldMatrix(a){this._activeEffect.setMatrix("world",a)}bindOnlyNormalMatrix(a){this._activeEffect.setMatrix("normalMatrix",a)}bind(a,c){c&&this.bindForSubMesh(a,c,c.wc[0])}_afterBind(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;super._afterBind(a,c,o),this.Za()._cachedEffect=c,o?o._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return o._drawWrapper._forceRebindOnNextCall||a.isCachedMaterialInvalid(this,c,s)}dispose(a,c,o){this._activeEffect=void 0,super.dispose(a,c,o)}}},13149:(a,c,o)=>{o.d(c,{d:()=>p,f:()=>G});var s=o(12798),q=o(12810),t=o(12800);class i{static extractMinAndMaxIndexed(a,c,o,s,q,t){for(let i=o;i<o+s;i++){const o=3*c[i],s=a[o],p=a[o+1],G=a[o+2];q.minimizeInPlaceFromFloats(s,p,G),t.maximizeInPlaceFromFloats(s,p,G)}}static extractMinAndMax(a,c,o,s,q,t){for(let i=c,p=c*s;i<c+o;i++,p+=s){const c=a[p],o=a[p+1],s=a[p+2];q.minimizeInPlaceFromFloats(c,o,s),t.maximizeInPlaceFromFloats(c,o,s)}}}function p(a,c,o,s){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const p=new q.Hc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new q.Hc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return i.extractMinAndMaxIndexed(a,c,o,s,p,G),t&&(p.x-=p.x*t.x+t.y,p.y-=p.y*t.x+t.y,p.z-=p.z*t.x+t.y,G.x+=G.x*t.x+t.y,G.y+=G.y*t.x+t.y,G.z+=G.z*t.x+t.y),{minimum:p,maximum:G}}function G(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0;const p=new q.Hc(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new q.Hc(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t||(t=3),i.extractMinAndMax(a,c,o,t,p,G),s&&(p.x-=p.x*s.x+s.y,p.y-=p.y*s.x+s.y,p.z-=p.z*s.x+s.y,G.x+=G.x*s.x+s.y,G.y+=G.y*s.x+s.y,G.z+=G.z*s.x+s.y),{minimum:p,maximum:G}}(0,s.d)([t.g.filter((function(){for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];let[s,q]=c;return!Array.isArray(s)&&!Array.isArray(q)}))],i,"extractMinAndMaxIndexed",null),(0,s.d)([t.g.filter((function(){for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];let[s]=c;return!Array.isArray(s)}))],i,"extractMinAndMax",null)},13130:(a,c,o)=>{o.d(c,{c:()=>G});var s=o(12882),q=o(13135),t=o(13140),i=o(13149),p=o(12925);class G{get materialDefines(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(a=this._getDrawWrapper())||void 0===a?void 0:a.defines}set materialDefines(a){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=a}_getDrawWrapper(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a??this._engine.currentRenderPassId;let o=this._drawWrappers[a];return!o&&c&&(this._drawWrappers[a]=o=new p.e(this._mesh.Za().getEngine())),o}_removeDrawWrapper(a){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var o;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(o=this._drawWrappers[a])||void 0===o||o.dispose(c));this._drawWrappers[a]=void 0}get effect(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(a=this._getDrawWrapper())||void 0===a?void 0:a.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(a){this._mainDrawWrapperOverride=a}setEffect(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=this._drawWrapper;q.setEffect(a,c,s),void 0!==o&&(q.materialContext=o),a||(q.defines=null,q.materialContext=void 0)}resetDrawCache(a){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==a)return void this._removeDrawWrapper(a,!0,c);for(const a of this._drawWrappers)null===a||void 0===a||a.dispose(c)}this._drawWrappers=[]}static AddToMesh(a,c,o,s,q,t,i){return new G(a,c,o,s,q,t,i,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(a,c,o,s,q,t,i){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],G=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=a,this.verticesStart=c,this.verticesCount=o,this.indexStart=s,this.indexCount=q,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=t,this._renderingMesh=i||t,G&&t.wc.push(this),this._engine=this._mesh.Za().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=t.wc.length-1,p&&(this.refreshBoundingInfo(),t.Rc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(a){return this._boundingInfo=a,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const a=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return a||this._renderingMesh}Ba(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!c)return a&&this._mesh.Za()._hasDefaultMaterial?this._mesh.Za().defaultMaterial:null;if(this._isMultiMaterial(c)){const a=c.getSubMaterial(this.materialIndex);return this._currentMaterial!==a&&(this._currentMaterial=a,this.resetDrawCache()),a}return c}_isMultiMaterial(a){return void 0!==a.getSubMaterial}refreshBoundingInfo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.dc)return this;if(a||(a=this._renderingMesh.getVerticesData(s.g.PositionKind)),!a)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const c=this._renderingMesh.Wc();let o;if(0===this.indexStart&&this.indexCount===c.length){const a=this._renderingMesh.getBoundingInfo();o={minimum:a.minimum.clone(),maximum:a.maximum.clone()}}else o=(0,i.d)(a,c,this.indexStart,this.indexCount,this._renderingMesh.dc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(o.minimum,o.maximum):this._boundingInfo=new t.b(o.minimum,o.maximum),this}_checkCollision(a){return this.getBoundingInfo()._checkCollision(a)}updateBoundingInfo(a){let c=this.getBoundingInfo();return c||(this.refreshBoundingInfo(),c=this.getBoundingInfo()),c&&c.update(a),this}isInFrustum(a){const c=this.getBoundingInfo();return!!c&&c.isInFrustum(a,this._mesh.qL)}isCompletelyInFrustum(a){const c=this.getBoundingInfo();return!!c&&c.isCompletelyInFrustum(a)}render(a){return this._renderingMesh.render(this,a,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(a,c){if(!this._linesIndexBuffer){const o=6*Math.floor(this.indexCount/3),s=this.verticesStart+this.verticesCount>65535?new Uint32Array(o):new Uint16Array(o);let q=0;if(0===a.length)for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)s[q++]=a,s[q++]=a+1,s[q++]=a+1,s[q++]=a+2,s[q++]=a+2,s[q++]=a;else for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)s[q++]=a[c],s[q++]=a[c+1],s[q++]=a[c+1],s[q++]=a[c+2],s[q++]=a[c+2],s[q++]=a[c];this._linesIndexBuffer=c.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer}canIntersects(a){const c=this.getBoundingInfo();return!!c&&a.intersectsBox(c.boundingBox)}intersects(a,c,o,s,q){const t=this.Ba();if(!t)return null;let i=3,p=!1;switch(t.fillMode){case 3:case 5:case 6:case 8:return null;case 7:i=1,p=!0}return 4===t.fillMode?o.length?this._intersectLines(a,c,o,this._mesh.intersectionThreshold,s):this._intersectUnIndexedLines(a,c,o,this._mesh.intersectionThreshold,s):!o.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(a,c,o,s,q):this._intersectTriangles(a,c,o,i,p,s,q)}_intersectLines(a,c,o,s,t){let i=null;for(let p=this.indexStart;p<this.indexStart+this.indexCount;p+=2){const G=c[o[p]],T=c[o[p+1]],C=a.intersectionSegment(G,T,s);if(!(C<0)&&((t||!i||C<i.distance)&&(i=new q.e(null,null,C),i.faceId=p/2,t)))break}return i}_intersectUnIndexedLines(a,c,o,s,t){let i=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=2){const o=c[p],G=c[p+1],T=a.intersectionSegment(o,G,s);if(!(T<0)&&((t||!i||T<i.distance)&&(i=new q.e(null,null,T),i.faceId=p/2,t)))break}return i}_intersectTriangles(a,c,o,s,q,t,i){let p=null,G=-1;for(let T=this.indexStart;T<this.indexStart+this.indexCount-(3-s);T+=s){G++;const s=o[T],C=o[T+1],j=o[T+2];if(q&&4294967295===j){T+=2;continue}const L=c[s],e=c[C],g=c[j];if(!L||!e||!g)continue;if(i&&!i(L,e,g,a,s,C,j))continue;const M=a.intersectsTriangle(L,e,g);if(M){if(M.distance<0)continue;if((t||!p||M.distance<p.distance)&&(p=M,p.faceId=G,t))break}}return p}_intersectUnIndexedTriangles(a,c,o,s,q){let t=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=3){const o=c[i],p=c[i+1],G=c[i+2];if(q&&!q(o,p,G,a,-1,-1,-1))continue;const T=a.intersectsTriangle(o,p,G);if(T){if(T.distance<0)continue;if((s||!t||T.distance<t.distance)&&(t=T,t.faceId=i/3,s))break}}return t}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(a,c){const o=new G(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,a,c,!1);if(!this.IsGlobal){const a=this.getBoundingInfo();if(!a)return o;o._boundingInfo=new t.b(a.minimum,a.maximum)}return o}dispose(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Za().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const c=this._mesh.wc.indexOf(this);this._mesh.wc.splice(c,1),this.resetDrawCache(void 0,a)}getClassName(){return"SubMesh"}static CreateFromIndices(a,c,o,s,q){let t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Number.MAX_VALUE,p=-Number.MAX_VALUE;const T=(q||s).Wc();for(let G=c;G<c+o;G++){const a=T[G];a<i&&(i=a),a>p&&(p=a)}return new G(a,i,p-i+1,c,o,s,q,t)}}}}]);