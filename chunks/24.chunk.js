"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[24],{12744:(e,d,v)=>{v.d(d,{e:()=>P});class P{constructor(e,d,v){this.bu=e,this.bv=d,this.distance=v,this.faceId=0,this.subMeshId=0}}},12758:(e,d,v)=>{v.d(d,{c:()=>B});var P=v(12433),p=v(12420),L=v(12429);class B{constructor(e,d,v){this.vectors=(0,P.e)(8,p.mv.Zero),this.center=p.mv.Zero(),this.centerWorld=p.mv.Zero(),this.extendSize=p.mv.Zero(),this.extendSizeWorld=p.mv.Zero(),this.directions=(0,P.e)(3,p.mv.Zero),this.vectorsWorld=(0,P.e)(8,p.mv.Zero),this.minimumWorld=p.mv.Zero(),this.maximumWorld=p.mv.Zero(),this.minimum=p.mv.Zero(),this.maximum=p.mv.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,d,v)}reConstruct(e,d,v){const P=e.x,L=e.y,B=e.z,X=d.x,z=d.y,W=d.z,V=this.vectors;this.minimum.Ed(P,L,B),this.maximum.Ed(X,z,W),V[0].Ed(P,L,B),V[1].Ed(X,z,W),V[2].Ed(X,L,B),V[3].Ed(P,z,B),V[4].Ed(P,L,W),V[5].Ed(X,z,B),V[6].Ed(P,z,W),V[7].Ed(X,L,W),d.addToRef(e,this.center).scaleInPlace(.5),d.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=v||p.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const d=B._TmpVector3,v=this.maximum.subtractToRef(this.minimum,d[0]),P=v.length();v.normalizeFromLength(P);const p=P*e,L=v.scaleInPlace(.5*p),X=this.center.subtractToRef(L,d[1]),z=this.center.addToRef(L,d[2]);return this.reConstruct(X,z,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const d=this.minimumWorld,v=this.maximumWorld,P=this.directions,L=this.vectorsWorld,B=this.vectors;if(e.isIdentity()){d.L(this.minimum),v.L(this.maximum);for(let e=0;e<8;++e)L[e].L(B[e]);this.extendSizeWorld.L(this.extendSize),this.centerWorld.L(this.center)}else{d.dp(Number.MAX_VALUE),v.dp(-Number.MAX_VALUE);for(let P=0;P<8;++P){const X=L[P];p.mv.TransformCoordinatesToRef(B[P],e,X),d.minimizeInPlace(X),v.maximizeInPlace(X)}v.subtractToRef(d,this.extendSizeWorld).scaleInPlace(.5),v.addToRef(d,this.centerWorld).scaleInPlace(.5)}p.mv.FromArrayToRef(e.m,0,P[0]),p.mv.FromArrayToRef(e.m,4,P[1]),p.mv.FromArrayToRef(e.m,8,P[2]),this._worldMatrix=e}isInFrustum(e){return B.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return B.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const d=this.minimumWorld,v=this.maximumWorld,P=d.x,p=d.y,B=d.z,X=v.x,z=v.y,W=v.z,V=e.x,k=e.y,g=e.z,F=-L.e;return!(X-V<F||F>V-P)&&(!(z-k<F||F>k-p)&&!(W-g<F||F>g-B))}intersectsSphere(e){return B.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,d){const v=this.minimumWorld,P=this.maximumWorld,p=v.x,L=v.y,B=v.z,X=P.x,z=P.y,W=P.z,V=e.x,k=e.y,g=e.z,F=d.x,w=d.y,G=d.z;return!(X<V||p>F)&&(!(z<k||L>w)&&!(W<g||B>G))}dispose(){var e,d;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(d=this._drawWrapperBack)||void 0===d||d.dispose()}static Intersects(e,d){return e.intersectsMinMax(d.minimumWorld,d.maximumWorld)}static IntersectsSphere(e,d,v,P){const L=B._TmpVector3[0];p.mv.ClampToRef(v,e,d,L);return p.mv.DistanceSquared(v,L)<=P*P}static IsCompletelyInFrustum(e,d){for(let v=0;v<6;++v){const P=d[v];for(let d=0;d<8;++d)if(P.dotCoordinate(e[d])<0)return!1}return!0}static IsInFrustum(e,d){for(let v=0;v<6;++v){let P=!0;const p=d[v];for(let d=0;d<8;++d)if(p.dotCoordinate(e[d])>=0){P=!1;break}if(P)return!1}return!0}}B._TmpVector3=(0,P.e)(3,p.mv.Zero)},12752:(e,d,v)=>{v.d(d,{b:()=>k});var P=v(12433),p=v(12420),L=v(12758),B=v(12760);const X={min:0,max:0},z={min:0,max:0},W=(e,d,v)=>{const P=p.mv.Dot(d.centerWorld,e),L=Math.abs(p.mv.Dot(d.directions[0],e))*d.extendSize.x+Math.abs(p.mv.Dot(d.directions[1],e))*d.extendSize.y+Math.abs(p.mv.Dot(d.directions[2],e))*d.extendSize.z;v.min=P-L,v.max=P+L},V=(e,d,v)=>(W(e,d,X),W(e,v,z),!(X.min>z.max||z.min>X.max));class k{constructor(e,d,v){this._isLocked=!1,this.boundingBox=new L.c(e,d,v),this.boundingSphere=new B.d(e,d,v)}reConstruct(e,d,v){this.boundingBox.reConstruct(e,d,v),this.boundingSphere.reConstruct(e,d,v)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,d){const v=k._TmpVector3[0].L(e).JV(d),P=k._TmpVector3[1].L(e).addInPlace(d);return this.boundingBox.reConstruct(v,P,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(v,P,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const d=p.mv.Minimize(this.minimum,e),v=p.mv.Maximize(this.maximum,e);return this.reConstruct(d,v,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const d=p.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(d);const v=p.TmpVectors.mv[0];return p.mv.TransformCoordinatesToRef(e.boundingBox.minimumWorld,d,v),this.encapsulate(v),p.mv.TransformCoordinatesToRef(e.boundingBox.maximumWorld,d,v),this.encapsulate(v),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===d||3===d)&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;return!(1!==d&&3!==d)||this.boundingBox.isInFrustum(e)}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,k._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}intersects(e,d){if(!B.d.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!L.c.Intersects(this.boundingBox,e.boundingBox))return!1;if(!d)return!0;const v=this.boundingBox,P=e.boundingBox;return!!V(v.directions[0],v,P)&&(!!V(v.directions[1],v,P)&&(!!V(v.directions[2],v,P)&&(!!V(P.directions[0],v,P)&&(!!V(P.directions[1],v,P)&&(!!V(P.directions[2],v,P)&&(!!V(p.mv.Cross(v.directions[0],P.directions[0]),v,P)&&(!!V(p.mv.Cross(v.directions[0],P.directions[1]),v,P)&&(!!V(p.mv.Cross(v.directions[0],P.directions[2]),v,P)&&(!!V(p.mv.Cross(v.directions[1],P.directions[0]),v,P)&&(!!V(p.mv.Cross(v.directions[1],P.directions[1]),v,P)&&(!!V(p.mv.Cross(v.directions[1],P.directions[2]),v,P)&&(!!V(p.mv.Cross(v.directions[2],P.directions[0]),v,P)&&(!!V(p.mv.Cross(v.directions[2],P.directions[1]),v,P)&&!!V(p.mv.Cross(v.directions[2],P.directions[2]),v,P))))))))))))))}}k._TmpVector3=(0,P.e)(2,p.mv.Zero)},12760:(e,d,v)=>{v.d(d,{d:()=>L});var P=v(12433),p=v(12420);class L{constructor(e,d,v){this.center=p.mv.Zero(),this.centerWorld=p.mv.Zero(),this.minimum=p.mv.Zero(),this.maximum=p.mv.Zero(),this.reConstruct(e,d,v)}reConstruct(e,d,v){this.minimum.L(e),this.maximum.L(d);const P=p.mv.Distance(e,d);d.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*P,this._update(v||p.Matrix.IdentityReadOnly)}scale(e){const d=this.radius*e,v=L._TmpVector3,P=v[0].dp(d),p=this.center.subtractToRef(P,v[1]),B=this.center.addToRef(P,v[2]);return this.reConstruct(p,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.L(this.center),this.radiusWorld=this.radius;else{p.mv.TransformCoordinatesToRef(this.center,e,this.centerWorld);const d=L._TmpVector3[0];p.mv.TransformNormalFromFloatsToRef(1,1,1,e,d),this.radiusWorld=Math.max(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z))*this.radius}}isInFrustum(e){const d=this.centerWorld,v=this.radiusWorld;for(let P=0;P<6;P++)if(e[P].dotCoordinate(d)<=-v)return!1;return!0}isCenterInFrustum(e){const d=this.centerWorld;for(let v=0;v<6;v++)if(e[v].dotCoordinate(d)<0)return!1;return!0}intersectsPoint(e){const d=p.mv.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<d)}static Intersects(e,d){const v=p.mv.DistanceSquared(e.centerWorld,d.centerWorld),P=e.radiusWorld+d.radiusWorld;return!(P*P<v)}static CreateFromCenterAndRadius(e,d,v){this._TmpVector3[0].L(e),this._TmpVector3[1].Ed(0,0,d),this._TmpVector3[2].L(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].JV(this._TmpVector3[1]);const P=new L(this._TmpVector3[0],this._TmpVector3[2]);return P._worldMatrix=v||p.Matrix.Identity(),P}}L._TmpVector3=(0,P.e)(3,p.mv.Zero)},12775:(e,d,v)=>{function P(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function p(e,d,v){const P=!!(e.clipPlane??d.clipPlane),p=!!(e.clipPlane2??d.clipPlane2),L=!!(e.clipPlane3??d.clipPlane3),B=!!(e.clipPlane4??d.clipPlane4),X=!!(e.clipPlane5??d.clipPlane5),z=!!(e.clipPlane6??d.clipPlane6);P&&v.push("#define CLIPPLANE"),p&&v.push("#define CLIPPLANE2"),L&&v.push("#define CLIPPLANE3"),B&&v.push("#define CLIPPLANE4"),X&&v.push("#define CLIPPLANE5"),z&&v.push("#define CLIPPLANE6")}function L(e,d,v){let P=!1;const p=!!(e.clipPlane??d.clipPlane),L=!!(e.clipPlane2??d.clipPlane2),B=!!(e.clipPlane3??d.clipPlane3),X=!!(e.clipPlane4??d.clipPlane4),z=!!(e.clipPlane5??d.clipPlane5),W=!!(e.clipPlane6??d.clipPlane6);return v.CLIPPLANE!==p&&(v.CLIPPLANE=p,P=!0),v.CLIPPLANE2!==L&&(v.CLIPPLANE2=L,P=!0),v.CLIPPLANE3!==B&&(v.CLIPPLANE3=B,P=!0),v.CLIPPLANE4!==X&&(v.CLIPPLANE4=X,P=!0),v.CLIPPLANE5!==z&&(v.CLIPPLANE5=z,P=!0),v.CLIPPLANE6!==W&&(v.CLIPPLANE6=W,P=!0),P}function B(e,d,v){let P=d.clipPlane??v.clipPlane;X(e,"vClipPlane",P),P=d.clipPlane2??v.clipPlane2,X(e,"vClipPlane2",P),P=d.clipPlane3??v.clipPlane3,X(e,"vClipPlane3",P),P=d.clipPlane4??v.clipPlane4,X(e,"vClipPlane4",P),P=d.clipPlane5??v.clipPlane5,X(e,"vClipPlane5",P),P=d.clipPlane6??v.clipPlane6,X(e,"vClipPlane6",P)}function X(e,d,v){v&&e.setFloat4(d,v.normal.x,v.normal.y,v.normal.z,v.d)}v.d(d,{c:()=>P,d:()=>B,g:()=>L,j:()=>p})},12722:(e,d,v)=>{v.d(d,{d:()=>P});class P{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,d){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(d)}addCPUSkinningFallback(e,d){this._mesh=d,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;const v=this._mesh.Ae();for(let e=0;e<v.meshes.length;e++){const P=v.meshes[e];if(P.material){if(P.computeBonesUsingShaders&&0!==P.numBoneInfluencers)if(P.material.getEffect()===d)P.computeBonesUsingShaders=!1;else if(P.Qd)for(const e of P.Qd){if(e.effect===d){P.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&P.computeBonesUsingShaders&&P.numBoneInfluencers>0&&(P.computeBonesUsingShaders=!1)}}else{const d=this._defines[this._currentRank];if(d)for(let v=0;v<d.length;v++)e=e.replace("#define "+d[v],"");this._currentRank++}return e}}},12734:(e,d,v)=>{v.d(d,{b:()=>U});var P=v(12403),p=v(12409),L=v(12240),B=v(12248),X=v(12281),z=v(12742),W=v(12674),V=v(12253),k=v(12465),g=v(12540),F=v(12453);class w{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){F.c.Clone((()=>e),this)}serialize(){return F.c.Serialize(this)}parse(e,d,v){F.c.Parse((()=>this),e,d,v)}}(0,P.e)([(0,p.M)()],w.prototype,"func",null),(0,P.e)([(0,p.M)()],w.prototype,"funcRef",null),(0,P.e)([(0,p.M)()],w.prototype,"funcMask",null),(0,P.e)([(0,p.M)()],w.prototype,"opStencilFail",null),(0,P.e)([(0,p.M)()],w.prototype,"opDepthFail",null),(0,P.e)([(0,p.M)()],w.prototype,"opStencilDepthPass",null),(0,P.e)([(0,p.M)()],w.prototype,"mask",null),(0,P.e)([(0,p.M)()],w.prototype,"enabled",null);var G=v(12767);class U{get _supportGlowLayer(){return!1}set _glowModeEnabled(e){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const d=this._alpha;this._alpha=e,1!==d&&1!==e||this.HW(U.MiscDirtyFlag+U.PrePassDirtyFlag)}get alpha(){return this._alpha}set Jd(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.HW(U.TextureDirtyFlag))}get Jd(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.HW(U.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.Rk())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.d),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new B.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new B.d),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.HW(U.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.HW(U.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case U.WireFrameFillMode:case U.LineListDrawMode:case U.LineLoopDrawMode:case U.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?U.WireFrameFillMode:U.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case U.PointFillMode:case U.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?U.PointFillMode:U.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.HW(U.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const d=this.Ae().getEngine().getCaps().fragmentDepthSupported;e&&!d&&V.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&d,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Fd=new B.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.hd=new w,this._useUBO=!1,this._fillMode=U.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=e;const p=d||X.c.LastCreatedScene;p&&(this._scene=p,this._dirtyCallbacks={},this._forceGLSL=P,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||L.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new g.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new W.c(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.Ae().getEngine().supportsUniformBuffers,this._createUniformBuffer(),v||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),U.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var e;const d=this.Ae().getEngine();null===(e=this._uniformBuffer)||void 0===e||e.dispose(),d.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new W.c(d,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new W.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Rk(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Rk(),this.checkReadyOnlyOnce=!1}isReady(e,d){return!0}isReadyForSubMesh(e,d,v){const P=d.materialDefines;return!!P&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=P,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Ae(){return this._scene}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===U.MATERIAL_ALPHABLEND||this._transparencyMode===U.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===U.MATERIAL_ALPHATEST||this._transparencyMode===U.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===U.MATERIAL_OPAQUE||this._transparencyMode===U.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsBlend:e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Rk(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this.Ae().meshes;for(const v of d)if(v.Qd)for(const d of v.Qd)if(d.Ne()===this)for(const v of d._drawWrappers)v&&this._materialContext===v.materialContext&&(v._wasPreviouslyReady=!1,v._wasPreviouslyUsingInstances=null,v._forceRebindOnNextCall=e);e&&this.HW(U.AllDirtyFlag)}_preBind(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this._scene.getEngine(),P=(null==d?this.sideOrientation:d)===U.ClockWiseSideOrientation;return v.enableEffect(e||this._getDrawWrapper()),v.setState(this.Jd,this.zOffset,!1,P,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.hd,this.zOffsetUnits),P}bind(e,d){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,d,v){const P=v._drawWrapper;this._eventInfo.subMesh=v,this._callbackPluginEventBindForSubMesh(this._eventInfo),P._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.Ae().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.Ae().getTransformMatrix()),e.setMatrix("projection",this.Ae().getProjectionMatrix()))}bindEyePosition(e,d){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,d)}_afterBind(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&d&&(this._needToBindSceneUbo=!1,(0,G.o)(d,this.Ae().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,d){const v={};if(this._serializePlugins(v),U._ParsePlugins(v,e,this._scene,d),this.pluginManager)for(const P of this.pluginManager._plugins){const d=e.pluginManager.getPlugin(P.name);d&&P.copyTo(d)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const d in this.meshMap){const v=this.meshMap[d];v&&e.push(v)}return e}return this._scene.meshes.filter((e=>e.material===this))}forceCompilation(e,d,v,P){const p={clipPlane:!1,useInstances:!1,...v},L=this.Ae(),B=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const X=()=>{if(!this._scene||!this._scene.getEngine())return;const v=L.clipPlane;if(p.clipPlane&&(L.clipPlane=new k.d(0,0,0,1)),this._storeEffectOnSubMeshes){let v=!0,L=null;if(e.Qd){const d=new z.b(0,0,0,0,0,e,void 0,!1,!1);d.materialDefines&&(d.materialDefines._renderId=-1),this.isReadyForSubMesh(e,d,p.useInstances)||(d.effect&&d.effect.getCompilationError()&&d.effect.allFallbacksProcessed()?L=d.effect.getCompilationError():(v=!1,setTimeout(X,16)))}v&&(this.allowShaderHotSwapping=B,L&&P&&P(L),d&&d(this))}else this.isReady()?(this.allowShaderHotSwapping=B,d&&d(this)):setTimeout(X,16);p.clipPlane&&(L.clipPlane=v)};X()}async forceCompilationAsync(e,d){return await new Promise(((v,P)=>{this.forceCompilation(e,(()=>{v()}),d,(e=>{P(e)}))}))}HW(e){this.Ae().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(U._DirtyCallbackArray.length=0,e&U.ImageProcessingDirtyFlag&&U._DirtyCallbackArray.push(U._ImageProcessingDirtyCallBack),e&U.TextureDirtyFlag&&U._DirtyCallbackArray.push(U._TextureDirtyCallBack),e&U.LightDirtyFlag&&U._DirtyCallbackArray.push(U._LightsDirtyCallBack),e&U.FresnelDirtyFlag&&U._DirtyCallbackArray.push(U._FresnelDirtyCallBack),e&U.AttributesDirtyFlag&&U._DirtyCallbackArray.push(U._AttributeDirtyCallBack),e&U.MiscDirtyFlag&&U._DirtyCallbackArray.push(U._MiscDirtyCallBack),e&U.PrePassDirtyFlag&&U._DirtyCallbackArray.push(U._PrePassDirtyCallBack),U._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(U._RunDirtyCallBacks),this.Ae().resetCachedMaterial())}resetDrawCache(){const e=this.Ae().meshes;for(const d of e)if(d.Qd)for(const e of d.Qd)e.Ne()===this&&e.resetDrawCache()}_markAllSubMeshesAsDirty(e){const d=this.Ae();if(d.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const v=d.meshes;for(const P of v)if(P.Qd)for(const v of P.Qd){if((v.Ne()||(d._hasDefaultMaterial?d.defaultMaterial:null))===this)for(const d of v._drawWrappers)d&&d.defines&&d.defines.markAllAsDirty&&this._materialContext===d.materialContext&&e(d.defines)}}_markScenePrePassDirty(){if(this.Ae().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.Ae().enablePrePassRenderer();e&&e.HW()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(U._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(U._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(U._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(U._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(U._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(U._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(U._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(U._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(U._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(U._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Fd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}setPrePassRenderer(e){return!1}dispose(e,d,v){const P=this.Ae();if(P.stopAnimation(this),P.freeProcessedMaterials(),P.removeMaterial(this),this._eventInfo.forceDisposeTextures=d,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==v)if(this.meshMap)for(const p in this.meshMap){const e=this.meshMap[p];this._disposeMeshResources(e)}else{const e=P.meshes;for(const d of e)this._disposeMeshResources(d)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Fd.notifyObservers(this),this.Fd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(e){if(!e)return;const d=e.sd,v=e._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(e.Qd&&v)for(const p of e.Qd){const e=p._drawWrappers;for(let L=0;L<e.length;L++){var P;const B=null===(P=e[L])||void 0===P?void 0:P.effect;if(!B)continue;v[L]===this&&(null===d||void 0===d||d._releaseVertexArrayObject(B),p._removeDrawWrapper(L,!0,!0))}}}else null===d||void 0===d||d._releaseVertexArrayObject(this._drawWrapper.effect);e.material!==this||e.sourceMesh||(e.material=null)}serialize(){const e=F.c.Serialize(this);return e.hd=this.hd.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const d of this.pluginManager._plugins)d.doNotSerialize||(e.plugins[d.getClassName()]=d.serialize())}static Parse(e,d,v){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return V.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const P=L.Tools.Instantiate(e.customType).Parse(e,d,v);return P._loadedUniqueId=e.uniqueId,P}static _ParsePlugins(e,d,v,P){if(e.plugins)for(const X in e.plugins){var p,B;const z=e.plugins[X];let W=null===(p=d.pluginManager)||void 0===p?void 0:p.getPlugin(z.name);if(!W){const e=L.Tools.Instantiate("BABYLON."+X);e&&(W=new e(d))}null===(B=W)||void 0===B||B.parse(z,v,P)}}}U.TriangleFillMode=0,U.WireFrameFillMode=1,U.PointFillMode=2,U.PointListDrawMode=3,U.LineListDrawMode=4,U.LineLoopDrawMode=5,U.LineStripDrawMode=6,U.TriangleStripDrawMode=7,U.TriangleFanDrawMode=8,U.ClockWiseSideOrientation=0,U.CounterClockWiseSideOrientation=1,U.ImageProcessingDirtyFlag=64,U.TextureDirtyFlag=1,U.LightDirtyFlag=2,U.FresnelDirtyFlag=4,U.AttributesDirtyFlag=8,U.MiscDirtyFlag=16,U.PrePassDirtyFlag=32,U.AllDirtyFlag=127,U.MATERIAL_OPAQUE=0,U.MATERIAL_ALPHATEST=1,U.MATERIAL_ALPHABLEND=2,U.MATERIAL_ALPHATESTANDBLEND=3,U.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,U.MATERIAL_NORMALBLENDMETHOD_RNM=1,U.OnEventObservable=new B.d,U._AllDirtyCallBack=e=>e.markAllAsDirty(),U._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),U._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),U._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),U._MiscDirtyCallBack=e=>e.markAsMiscDirty(),U._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),U._LightsDirtyCallBack=e=>e.markAsLightDirty(),U._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),U._FresnelAndMiscDirtyCallBack=e=>{U._FresnelDirtyCallBack(e),U._MiscDirtyCallBack(e)},U._TextureAndMiscDirtyCallBack=e=>{U._TextureDirtyCallBack(e),U._MiscDirtyCallBack(e)},U._DirtyCallbackArray=[],U._RunDirtyCallBacks=e=>{for(const d of U._DirtyCallbackArray)d(e)},(0,P.e)([(0,p.M)()],U.prototype,"id",void 0),(0,P.e)([(0,p.M)()],U.prototype,"uniqueId",void 0),(0,P.e)([(0,p.M)()],U.prototype,"name",void 0),(0,P.e)([(0,p.M)()],U.prototype,"metadata",void 0),(0,P.e)([(0,p.M)()],U.prototype,"checkReadyOnEveryCall",void 0),(0,P.e)([(0,p.M)()],U.prototype,"checkReadyOnlyOnce",void 0),(0,P.e)([(0,p.M)()],U.prototype,"state",void 0),(0,P.e)([(0,p.M)("alpha")],U.prototype,"_alpha",void 0),(0,P.e)([(0,p.M)("Jd")],U.prototype,"_backFaceCulling",void 0),(0,P.e)([(0,p.M)("cullBackFaces")],U.prototype,"_cullBackFaces",void 0),(0,P.e)([(0,p.M)()],U.prototype,"sideOrientation",void 0),(0,P.e)([(0,p.M)("alphaMode")],U.prototype,"_alphaMode",void 0),(0,P.e)([(0,p.M)()],U.prototype,"_needDepthPrePass",void 0),(0,P.e)([(0,p.M)()],U.prototype,"disableDepthWrite",void 0),(0,P.e)([(0,p.M)()],U.prototype,"disableColorWrite",void 0),(0,P.e)([(0,p.M)()],U.prototype,"forceDepthWrite",void 0),(0,P.e)([(0,p.M)()],U.prototype,"depthFunction",void 0),(0,P.e)([(0,p.M)()],U.prototype,"separateCullingPass",void 0),(0,P.e)([(0,p.M)("fogEnabled")],U.prototype,"_fogEnabled",void 0),(0,P.e)([(0,p.M)()],U.prototype,"pointSize",void 0),(0,P.e)([(0,p.M)()],U.prototype,"zOffset",void 0),(0,P.e)([(0,p.M)()],U.prototype,"zOffsetUnits",void 0),(0,P.e)([(0,p.M)()],U.prototype,"pointsCloud",null),(0,P.e)([(0,p.M)()],U.prototype,"fillMode",null),(0,P.e)([(0,p.M)()],U.prototype,"useLogarithmicDepth",null),(0,P.e)([(0,p.M)()],U.prototype,"transparencyMode",null)},12767:(e,d,v)=>{v.d(d,{B:()=>A,F:()=>x,J:()=>F,L:()=>g,M:()=>T,P:()=>f,S:()=>r,T:()=>D,V:()=>me,Z:()=>S,ab:()=>o,b:()=>h,bb:()=>K,e:()=>k,fb:()=>N,g:()=>n,i:()=>V,jb:()=>w,m:()=>G,o:()=>U,r:()=>C,v:()=>i,z:()=>q});var P=v(12253),p=v(12463),L=v(12281),B=v(12713),X=v(12775);const z=p.Kd.Black(),W={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function V(e,d,v){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=v.activeCamera;1===e.mode&&P.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),d.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function k(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v&&e.fogEnabled&&(!d||d.applyFog)&&0!==e.fogMode&&(v.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),P?(e.fogColor.toLinearSpaceToRef(z,e.getEngine().useExactSrgbConversions),v.setColor3("vFogColor",z)):v.setColor3("vFogColor",e.fogColor))}function g(e,d,v,P,p,L,B,X,z,V){const k=e.numMaxInfluencers||e.numInfluencers;return k<=0?0:(d.push("#define MORPHTARGETS"),e.hasPositions&&d.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),e.hasNormals&&d.push("#define MORPHTARGETTEXTURE_HASNORMALS"),e.hasTangents&&d.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),e.hasUVs&&d.push("#define MORPHTARGETTEXTURE_HASUVS"),e.hasUV2s&&d.push("#define MORPHTARGETTEXTURE_HASUV2S"),e.hasColors&&d.push("#define MORPHTARGETTEXTURE_HASCOLORS"),e.supportsPositions&&p&&d.push("#define MORPHTARGETS_POSITION"),e.supportsNormals&&L&&d.push("#define MORPHTARGETS_NORMAL"),e.supportsTangents&&B&&d.push("#define MORPHTARGETS_TANGENT"),e.supportsUVs&&X&&d.push("#define MORPHTARGETS_UV"),e.supportsUV2s&&z&&d.push("#define MORPHTARGETS_UV2"),e.supportsColors&&V&&d.push("#define MORPHTARGETS_COLOR"),d.push("#define NUM_MORPH_INFLUENCERS "+k),e.isUsingTextureForTargets&&d.push("#define MORPHTARGETS_TEXTURE"),W.NUM_MORPH_INFLUENCERS=k,W.NORMAL=L,W.TANGENT=B,W.UV=X,W.UV2=z,W.COLOR=V,F(v,P,W,p),k)}function F(e,d,v){let p=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=v.NUM_MORPH_INFLUENCERS;if(B>0&&L.c.LastCreatedEngine){const X=L.c.LastCreatedEngine.getCaps().maxVertexAttribs,z=d.morphTargetManager;if(null!==z&&void 0!==z&&z.isUsingTextureForTargets)return;const W=z&&z.supportsPositions&&p,V=z&&z.supportsNormals&&v.NORMAL,k=z&&z.supportsTangents&&v.TANGENT,g=z&&z.supportsUVs&&v.UV1,F=z&&z.supportsUV2s&&v.UV2,w=z&&z.supportsColors&&v.VERTEXCOLOR;for(let v=0;v<B;v++)W&&e.push("position"+v),V&&e.push("normal"+v),k&&e.push("tangent"+v),g&&e.push("uv_"+v),F&&e.push("uv2_"+v),w&&e.push("color"+v),e.length>X&&P.c.Error("Cannot add more vertex attributes for mesh "+d.name)}}function w(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),d&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function G(e,d){const v=e.morphTargetManager;e&&v&&d.setFloatArray("morphTargetInfluences",v.influences)}function U(e,d){d.bindToEffect(e,"Scene")}function D(e,d,v){d._needUVs=!0,d[v]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(d[v+"DIRECTUV"]=e.coordinatesIndex+1,d["MAINUV"+(e.coordinatesIndex+1)]=!0):d[v+"DIRECTUV"]=0}function C(e,d,v){const P=e.getTextureMatrix();d.bd(v+"Matrix",P)}function q(e,d,v){v.BAKED_VERTEX_ANIMATION_TEXTURE&&v.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function h(e,d,v){var P;if(d&&e&&(e.computeBonesUsingShaders&&d._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const p=e.skeleton;if(p.isUsingTextureForMatrices&&d.getUniformIndex("boneTextureWidth")>-1){const v=p.getTransformMatrixTexture(e);d.setTexture("boneSampler",v),d.setFloat("boneTextureWidth",4*(p.bones.length+1))}else{const L=p.getTransformMatrices(e);L&&(d.setMatrices("mBones",L),v&&e.Ae().prePassRenderer&&e.Ae().prePassRenderer.getIndex(2)&&(v.previousBones[e.uniqueId]||(v.previousBones[e.uniqueId]=L.slice()),d.setMatrices("mPreviousBones",v.previousBones[e.uniqueId]),P=L,v.previousBones[e.uniqueId].set(P)))}}}function l(e,d,v,P,p){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e._bindLight(d,v,P,p,L)}function n(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const L=Math.min(d.lightSources.length,p);for(let B=0;B<L;B++){l(d.lightSources[B],B,e,v,"boolean"===typeof P?P:P.SPECULARTERM,d.receiveShadows)}}function A(e,d,v,P){v.NUM_BONE_INFLUENCERS>0&&(P.addCPUSkinningFallback(0,d),e.push("matricesIndices"),e.push("matricesWeights"),v.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function x(e,d){(d.INSTANCES||d.THIN_INSTANCES)&&w(e,!!d.PREPASS_VELOCITY),d.INSTANCESCOLOR&&e.push("instanceColor")}function i(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=0;for(let L=0;L<v&&e["LIGHT"+L];L++)L>0&&(p=P+L,d.addFallback(p,"LIGHT"+L)),e.SHADOWS||(e["SHADOW"+L]&&d.addFallback(P,"SHADOW"+L),e["SHADOWPCF"+L]&&d.addFallback(P,"SHADOWPCF"+L),e["SHADOWPCSS"+L]&&d.addFallback(P,"SHADOWPCSS"+L),e["SHADOWPOISSON"+L]&&d.addFallback(P,"SHADOWPOISSON"+L),e["SHADOWESM"+L]&&d.addFallback(P,"SHADOWESM"+L),e["SHADOWCLOSEESM"+L]&&d.addFallback(P,"SHADOWCLOSEESM"+L));return p++}function me(e,d,v,P,p,L,B){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];B._areMiscDirty&&(B.LOGARITHMICDEPTH=v,B.POINTSIZE=P,B.FOG=p&&function(e,d){return d.fogEnabled&&e.applyFog&&0!==d.fogMode}(e,d),B.NONUNIFORMSCALING=e.nonUniformScaling,B.ALPHATEST=L,B.DECAL_AFTER_DETAIL=X)}function r(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!v._areLightsDirty)return v._needNormals;let B=0;const X={needNormals:v._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!L)for(const W of d.lightSources)if(Z(e,d,W,B,v,P,X),B++,B===p)break;v.SPECULARTERM=X.specularEnabled,v.SHADOWS=X.shadowEnabled;for(let W=B;W<p;W++)void 0!==v["LIGHT"+W]&&(v["LIGHT"+W]=!1,v["HEMILIGHT"+W]=!1,v["POINTLIGHT"+W]=!1,v["DIRLIGHT"+W]=!1,v["SPOTLIGHT"+W]=!1,v["AREALIGHT"+W]=!1,v["SHADOW"+W]=!1,v["SHADOWCSM"+W]=!1,v["SHADOWCSMDEBUG"+W]=!1,v["SHADOWCSMNUM_CASCADES"+W]=!1,v["SHADOWCSMUSESHADOWMAXZ"+W]=!1,v["SHADOWCSMNOBLEND"+W]=!1,v["SHADOWCSM_RIGHTHANDED"+W]=!1,v["SHADOWPCF"+W]=!1,v["SHADOWPCSS"+W]=!1,v["SHADOWPOISSON"+W]=!1,v["SHADOWESM"+W]=!1,v["SHADOWCLOSEESM"+W]=!1,v["SHADOWCUBE"+W]=!1,v["SHADOWLOWQUALITY"+W]=!1,v["SHADOWMEDIUMQUALITY"+W]=!1);const z=e.getEngine().getCaps();return void 0===v.SHADOWFLOAT&&(X.needRebuild=!0),v.SHADOWFLOAT=X.shadowEnabled&&(z.textureFloatRender&&z.textureFloatLinearFiltering||z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering),v.LIGHTMAPEXCLUDED=X.lightmapMode,X.needRebuild&&v.rebuild(),X.needNormals}function Z(e,d,v,P,p,L,X){switch(X.needNormals=!0,void 0===p["LIGHT"+P]&&(X.needRebuild=!0),p["LIGHT"+P]=!0,p["SPOTLIGHT"+P]=!1,p["HEMILIGHT"+P]=!1,p["POINTLIGHT"+P]=!1,p["DIRLIGHT"+P]=!1,p["AREALIGHT"+P]=!1,v.prepareLightSpecificDefines(p,P),p["LIGHT_FALLOFF_PHYSICAL"+P]=!1,p["LIGHT_FALLOFF_GLTF"+P]=!1,p["LIGHT_FALLOFF_STANDARD"+P]=!1,v.falloffType){case B.c.FALLOFF_GLTF:p["LIGHT_FALLOFF_GLTF"+P]=!0;break;case B.c.FALLOFF_PHYSICAL:p["LIGHT_FALLOFF_PHYSICAL"+P]=!0;break;case B.c.FALLOFF_STANDARD:p["LIGHT_FALLOFF_STANDARD"+P]=!0}if(L&&!v.VV.equalsFloats(0,0,0)&&(X.specularEnabled=!0),p["SHADOW"+P]=!1,p["SHADOWCSM"+P]=!1,p["SHADOWCSMDEBUG"+P]=!1,p["SHADOWCSMNUM_CASCADES"+P]=!1,p["SHADOWCSMUSESHADOWMAXZ"+P]=!1,p["SHADOWCSMNOBLEND"+P]=!1,p["SHADOWCSM_RIGHTHANDED"+P]=!1,p["SHADOWPCF"+P]=!1,p["SHADOWPCSS"+P]=!1,p["SHADOWPOISSON"+P]=!1,p["SHADOWESM"+P]=!1,p["SHADOWCLOSEESM"+P]=!1,p["SHADOWCUBE"+P]=!1,p["SHADOWLOWQUALITY"+P]=!1,p["SHADOWMEDIUMQUALITY"+P]=!1,d&&d.receiveShadows&&e.shadowsEnabled&&v.shadowEnabled){const d=v.getShadowGenerator(e.activeCamera)??v.getShadowGenerator();if(d){const e=d.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(X.shadowEnabled=!0,d.prepareDefines(p,P))}}v.lightmapMode!=B.c.LIGHTMAP_DEFAULT?(X.lightmapMode=!0,p["LIGHTMAPEXCLUDED"+P]=!0,p["LIGHTMAPNOSPECULAR"+P]=v.lightmapMode==B.c.LIGHTMAP_SHADOWSONLY):(p["LIGHTMAPEXCLUDED"+P]=!1,p["LIGHTMAPNOSPECULAR"+P]=!1)}function f(e,d,v,P,p){let L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=function(e,d){let v=!1;if(e.activeCamera){const P=d.CAMERA_ORTHOGRAPHIC?1:0,p=d.CAMERA_PERSPECTIVE?1:0,L=1===e.activeCamera.mode?1:0,B=0===e.activeCamera.mode?1:0;(P^L||p^B)&&(d.CAMERA_ORTHOGRAPHIC=1===L,d.CAMERA_PERSPECTIVE=1===B,v=!0)}return v}(e,P);!1!==L&&(z=(0,X.g)(v,e,P)),P.DEPTHPREPASS!==!d.getColorWrite()&&(P.DEPTHPREPASS=!P.DEPTHPREPASS,z=!0),P.INSTANCES!==p&&(P.INSTANCES=p,z=!0),P.THIN_INSTANCES!==B&&(P.THIN_INSTANCES=B,z=!0),z&&P.markAsUnprocessed()}function T(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!d._areAttributesDirty&&d._needNormals===d._normals&&d._needUVs===d._uvs)return!1;d._normals=d._needNormals,d._uvs=d._needUVs,d.NORMAL=d._needNormals&&e.isVerticesDataPresent("normal"),d._needNormals&&e.isVerticesDataPresent("tangent")&&(d.TANGENT=!0);for(let X=1;X<=6;++X)d["UV"+X]=!!d._needUVs&&e.isVerticesDataPresent(`uv${1===X?"":X}`);if(v){const v=e.useVertexColors&&e.isVerticesDataPresent("color");d.VERTEXCOLOR=v,d.VERTEXALPHA=e.hasVertexAlpha&&v&&L}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(d.INSTANCESCOLOR=!0),P&&function(e,d){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){d.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const v=void 0!==d.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&v)d.BONETEXTURE=!0;else{d.BonesPerMesh=e.skeleton.bones.length+1,d.BONETEXTURE=!v&&void 0;const P=e.Ae().prePassRenderer;if(P&&P.enabled){const v=-1===P.excludedSkinnedMesh.indexOf(e);d.BONES_VELOCITY_ENABLED=v}}}else d.NUM_BONE_INFLUENCERS=0,d.BonesPerMesh=0,void 0!==d.BONETEXTURE&&(d.BONETEXTURE=!1)}(e,d),p&&function(e,d){const v=e.morphTargetManager;v?(d.MORPHTARGETS_UV=v.supportsUVs&&d.UV1,d.MORPHTARGETS_UV2=v.supportsUV2s&&d.UV2,d.MORPHTARGETS_TANGENT=v.supportsTangents&&d.TANGENT,d.MORPHTARGETS_NORMAL=v.supportsNormals&&d.NORMAL,d.MORPHTARGETS_POSITION=v.supportsPositions,d.MORPHTARGETS_COLOR=v.supportsColors,d.MORPHTARGETTEXTURE_HASUVS=v.hasUVs,d.MORPHTARGETTEXTURE_HASUV2S=v.hasUV2s,d.MORPHTARGETTEXTURE_HASTANGENTS=v.hasTangents,d.MORPHTARGETTEXTURE_HASNORMALS=v.hasNormals,d.MORPHTARGETTEXTURE_HASPOSITIONS=v.hasPositions,d.MORPHTARGETTEXTURE_HASCOLORS=v.hasColors,d.NUM_MORPH_INFLUENCERS=v.numMaxInfluencers||v.numInfluencers,d.MORPHTARGETS=d.NUM_MORPH_INFLUENCERS>0,d.MORPHTARGETS_TEXTURE=v.isUsingTextureForTargets):(d.MORPHTARGETS_UV=!1,d.MORPHTARGETS_UV2=!1,d.MORPHTARGETS_TANGENT=!1,d.MORPHTARGETS_NORMAL=!1,d.MORPHTARGETS_POSITION=!1,d.MORPHTARGETS_COLOR=!1,d.MORPHTARGETTEXTURE_HASUVS=!1,d.MORPHTARGETTEXTURE_HASUV2S=!1,d.MORPHTARGETTEXTURE_HASTANGENTS=!1,d.MORPHTARGETTEXTURE_HASNORMALS=!1,d.MORPHTARGETTEXTURE_HASPOSITIONS=!1,d.MORPHTARGETTEXTURE_HAS_COLORS=!1,d.MORPHTARGETS=!1,d.NUM_MORPH_INFLUENCERS=0)}(e,d),B&&function(e,d){const v=e.bakedVertexAnimationManager;d.BAKED_VERTEX_ANIMATION_TEXTURE=!(!v||!v.isEnabled)}(e,d),!0}function S(e,d){if(e.activeCamera){const v=d.MULTIVIEW;d.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,d.MULTIVIEW!=v&&d.markAsUnprocessed()}}function o(e,d,v){const P=d.ORDER_INDEPENDENT_TRANSPARENCY,p=d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;d.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&v,d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,P===d.ORDER_INDEPENDENT_TRANSPARENCY&&p===d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||d.markAsUnprocessed()}function K(e,d,v){const P=d.PREPASS;if(!d._arePrePassDirty)return;const p=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&v){d.PREPASS=!0,d.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,d.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace,d.PREPASS_COLOR=!0,d.PREPASS_COLOR_INDEX=0;for(let v=0;v<p.length;v++){const P=e.prePassRenderer.getIndex(p[v].type);-1!==P?(d[p[v].define]=!0,d[p[v].index]=P):d[p[v].define]=!1}}else{d.PREPASS=!1;for(let e=0;e<p.length;e++)d[p[e].define]=!1}d.PREPASS!=P&&(d.markAsUnprocessed(),d.markAsImageProcessingDirty())}function Q(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];p&&p.push("Light"+e),L||(d.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightWidth"+e,"vLightHeight"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),v.push("shadowTexture"+e),v.push("depthTexture"+e),d.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),P&&(v.push("projectionLightTexture"+e),d.push("textureProjectionMatrix"+e)),B&&v.push("iesLightTexture"+e))}function N(e,d,v){let P,p,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(e.uniformsNames){const B=e;P=B.uniformsNames,p=B.uniformBuffersNames,d=B.samplers,v=B.defines,L=B.maxSimultaneousLights||0}else P=e,d||(d=[]);for(let B=0;B<L&&v["LIGHT"+B];B++)Q(B,P,d,v["PROJECTEDLIGHTTEXTURE"+B],p,!1,v["IESLIGHTTEXTURE"+B]);v.NUM_MORPH_INFLUENCERS&&(P.push("morphTargetInfluences"),P.push("morphTargetCount")),v.BAKED_VERTEX_ANIMATION_TEXTURE&&(P.push("bakedVertexAnimationSettings"),P.push("bakedVertexAnimationTextureSizeInverted"),P.push("bakedVertexAnimationTime"),d.push("bakedVertexAnimationTexture"))}},12731:(e,d,v)=>{v.d(d,{c:()=>L});var P=v(12420),p=v(12734);class L extends p.b{constructor(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,d,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new P.Matrix,this._storeEffectOnSubMeshes=v}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,d){return!!e&&(!this._storeEffectOnSubMeshes||(!e.Qd||0===e.Qd.length||this.isReadyForSubMesh(e,e.Qd[0],d)))}_isReadyForSubMesh(e){const d=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!d||d._renderId!==this.Ae().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,d){d&&this.bindForSubMesh(e,d,d.Qd[0])}_afterBind(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;super._afterBind(e,d,v),this.Ae()._cachedEffect=d,v?v._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return v._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,d,P)}dispose(e,d,v){this._activeEffect=void 0,super.dispose(e,d,v)}}},12762:(e,d,v)=>{v.d(d,{d:()=>X,e:()=>z});var P=v(12403),p=v(12420),L=v(12409);class B{static extractMinAndMaxIndexed(e,d,v,P,p,L){for(let B=v;B<v+P;B++){const v=3*d[B],P=e[v],X=e[v+1],z=e[v+2];p.minimizeInPlaceFromFloats(P,X,z),L.maximizeInPlaceFromFloats(P,X,z)}}static extractMinAndMax(e,d,v,P,p,L){for(let B=d,X=d*P;B<d+v;B++,X+=P){const d=e[X],v=e[X+1],P=e[X+2];p.minimizeInPlaceFromFloats(d,v,P),L.maximizeInPlaceFromFloats(d,v,P)}}}function X(e,d,v,P){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=new p.mv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new p.mv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B.extractMinAndMaxIndexed(e,d,v,P,X,z),L&&(X.x-=X.x*L.x+L.y,X.y-=X.y*L.x+L.y,X.z-=X.z*L.x+L.y,z.x+=z.x*L.x+L.y,z.y+=z.y*L.x+L.y,z.z+=z.z*L.x+L.y),{minimum:X,maximum:z}}function z(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4?arguments[4]:void 0;const X=new p.mv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new p.mv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return L||(L=3),B.extractMinAndMax(e,d,v,L,X,z),P&&(X.x-=X.x*P.x+P.y,X.y-=X.y*P.x+P.y,X.z-=X.z*P.x+P.y,z.x+=z.x*P.x+P.y,z.y+=z.y*P.x+P.y,z.z+=z.z*P.x+P.y),{minimum:X,maximum:z}}(0,P.e)([L.e.filter((function(){for(var e=arguments.length,d=new Array(e),v=0;v<e;v++)d[v]=arguments[v];let[P,p]=d;return!Array.isArray(P)&&!Array.isArray(p)}))],B,"extractMinAndMaxIndexed",null),(0,P.e)([L.e.filter((function(){for(var e=arguments.length,d=new Array(e),v=0;v<e;v++)d[v]=arguments[v];let[P]=d;return!Array.isArray(P)}))],B,"extractMinAndMax",null)},12742:(e,d,v)=>{v.d(d,{b:()=>z});var P=v(12490),p=v(12744),L=v(12752),B=v(12762),X=v(12540);class z{get materialDefines(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e??this._engine.currentRenderPassId;let v=this._drawWrappers[e];return!v&&d&&(this._drawWrappers[e]=v=new X.b(this._mesh.Ae().getEngine())),v}_removeDrawWrapper(e){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var v;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(v=this._drawWrappers[e])||void 0===v||v.dispose(d));this._drawWrappers[e]=void 0}get effect(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(e=this._getDrawWrapper())||void 0===e?void 0:e.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=this._drawWrapper;p.setEffect(e,d,P),void 0!==v&&(p.materialContext=v),e||(p.defines=null,p.materialContext=void 0)}resetDrawCache(e){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e,!0,d);for(const e of this._drawWrappers)null===e||void 0===e||e.dispose(d)}this._drawWrappers=[]}static AddToMesh(e,d,v,P,p,L,B){return new z(e,d,v,P,p,L,B,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(e,d,v,P,p,L,B){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],z=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=e,this.verticesStart=d,this.verticesCount=v,this.indexStart=P,this.indexCount=p,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=L,this._renderingMesh=B||L,z&&L.Qd.push(this),this._engine=this._mesh.Ae().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=L.Qd.length-1,X&&(this.refreshBoundingInfo(),L.Md(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}Ne(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!d)return e&&this._mesh.Ae()._hasDefaultMaterial?this._mesh.Ae().defaultMaterial:null;if(this._isMultiMaterial(d)){const e=d.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return d}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.sd)return this;if(e||(e=this._renderingMesh.getVerticesData(P.i.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const d=this._renderingMesh.yd();let v;if(0===this.indexStart&&this.indexCount===d.length){const e=this._renderingMesh.getBoundingInfo();v={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else v=(0,B.d)(e,d,this.indexStart,this.indexCount,this._renderingMesh.sd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(v.minimum,v.maximum):this._boundingInfo=new L.b(v.minimum,v.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let d=this.getBoundingInfo();return d||(this.refreshBoundingInfo(),d=this.getBoundingInfo()),d&&d.update(e),this}isInFrustum(e){const d=this.getBoundingInfo();return!!d&&d.isInFrustum(e,this._mesh.kk)}isCompletelyInFrustum(e){const d=this.getBoundingInfo();return!!d&&d.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,d){if(!this._linesIndexBuffer){const v=6*Math.floor(this.indexCount/3),P=this.verticesStart+this.verticesCount>65535?new Uint32Array(v):new Uint16Array(v);let p=0;if(0===e.length)for(let e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)P[p++]=e,P[p++]=e+1,P[p++]=e+1,P[p++]=e+2,P[p++]=e+2,P[p++]=e;else for(let d=this.indexStart;d<this.indexStart+this.indexCount;d+=3)P[p++]=e[d],P[p++]=e[d+1],P[p++]=e[d+1],P[p++]=e[d+2],P[p++]=e[d+2],P[p++]=e[d];this._linesIndexBuffer=d.createIndexBuffer(P),this._linesIndexCount=P.length}return this._linesIndexBuffer}canIntersects(e){const d=this.getBoundingInfo();return!!d&&e.intersectsBox(d.boundingBox)}intersects(e,d,v,P,p){const L=this.Ne();if(!L)return null;let B=3,X=!1;switch(L.fillMode){case 3:case 5:case 6:case 8:return null;case 7:B=1,X=!0}return 4===L.fillMode?v.length?this._intersectLines(e,d,v,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(e,d,v,this._mesh.intersectionThreshold,P):!v.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,d,v,P,p):this._intersectTriangles(e,d,v,B,X,P,p)}_intersectLines(e,d,v,P,L){let B=null;for(let X=this.indexStart;X<this.indexStart+this.indexCount;X+=2){const z=d[v[X]],W=d[v[X+1]],V=e.intersectionSegment(z,W,P);if(!(V<0)&&((L||!B||V<B.distance)&&(B=new p.e(null,null,V),B.faceId=X/2,L)))break}return B}_intersectUnIndexedLines(e,d,v,P,L){let B=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=2){const v=d[X],z=d[X+1],W=e.intersectionSegment(v,z,P);if(!(W<0)&&((L||!B||W<B.distance)&&(B=new p.e(null,null,W),B.faceId=X/2,L)))break}return B}_intersectTriangles(e,d,v,P,p,L,B){let X=null,z=-1;for(let W=this.indexStart;W<this.indexStart+this.indexCount-(3-P);W+=P){z++;const P=v[W],V=v[W+1],k=v[W+2];if(p&&4294967295===k){W+=2;continue}const g=d[P],F=d[V],w=d[k];if(!g||!F||!w)continue;if(B&&!B(g,F,w,e,P,V,k))continue;const G=e.intersectsTriangle(g,F,w);if(G){if(G.distance<0)continue;if((L||!X||G.distance<X.distance)&&(X=G,X.faceId=z,L))break}}return X}_intersectUnIndexedTriangles(e,d,v,P,p){let L=null;for(let B=this.verticesStart;B<this.verticesStart+this.verticesCount;B+=3){const v=d[B],X=d[B+1],z=d[B+2];if(p&&!p(v,X,z,e,-1,-1,-1))continue;const W=e.intersectsTriangle(v,X,z);if(W){if(W.distance<0)continue;if((P||!L||W.distance<L.distance)&&(L=W,L.faceId=B/3,P))break}}return L}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,d){const v=new z(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,d,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return v;v._boundingInfo=new L.b(e.minimum,e.maximum)}return v}dispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Ae().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const d=this._mesh.Qd.indexOf(this);this._mesh.Qd.splice(d,1),this.resetDrawCache(void 0,e)}getClassName(){return"SubMesh"}static CreateFromIndices(e,d,v,P,p){let L=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=Number.MAX_VALUE,X=-Number.MAX_VALUE;const W=(p||P).yd();for(let z=d;z<d+v;z++){const e=W[z];e<B&&(B=e),e>X&&(X=e)}return new z(e,B,X-B+1,d,v,P,p,L)}}}}]);