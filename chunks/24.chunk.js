"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[24],{12546:(i,x,e)=>{e.d(x,{d:()=>j});class j{constructor(i,x,e){this.bu=i,this.bv=x,this.distance=e,this.faceId=0,this.subMeshId=0}}},12557:(i,x,e)=>{e.d(x,{b:()=>Y});var j=e(12259),E=e(12250),a=e(12253);class Y{constructor(i,x,e){this.vectors=(0,j.d)(8,E.KJ.Zero),this.center=E.KJ.Zero(),this.centerWorld=E.KJ.Zero(),this.extendSize=E.KJ.Zero(),this.extendSizeWorld=E.KJ.Zero(),this.directions=(0,j.d)(3,E.KJ.Zero),this.vectorsWorld=(0,j.d)(8,E.KJ.Zero),this.minimumWorld=E.KJ.Zero(),this.maximumWorld=E.KJ.Zero(),this.minimum=E.KJ.Zero(),this.maximum=E.KJ.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(i,x,e)}reConstruct(i,x,e){const j=i.x,a=i.y,Y=i.z,J=x.x,u=x.y,b=x.z,g=this.vectors;this.minimum.fJ(j,a,Y),this.maximum.fJ(J,u,b),g[0].fJ(j,a,Y),g[1].fJ(J,u,b),g[2].fJ(J,a,Y),g[3].fJ(j,u,Y),g[4].fJ(j,a,b),g[5].fJ(J,u,Y),g[6].fJ(j,u,b),g[7].fJ(J,a,b),x.addToRef(i,this.center).scaleInPlace(.5),x.subtractToRef(i,this.extendSize).scaleInPlace(.5),this._worldMatrix=e||E.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(i){const x=Y._TmpVector3,e=this.maximum.subtractToRef(this.minimum,x[0]),j=e.length();e.normalizeFromLength(j);const E=j*i,a=e.scaleInPlace(.5*E),J=this.center.subtractToRef(a,x[1]),u=this.center.addToRef(a,x[2]);return this.reConstruct(J,u,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(i){const x=this.minimumWorld,e=this.maximumWorld,j=this.directions,a=this.vectorsWorld,Y=this.vectors;if(i.isIdentity()){x.A(this.minimum),e.A(this.maximum);for(let i=0;i<8;++i)a[i].A(Y[i]);this.extendSizeWorld.A(this.extendSize),this.centerWorld.A(this.center)}else{x.OJ(Number.MAX_VALUE),e.OJ(-Number.MAX_VALUE);for(let j=0;j<8;++j){const J=a[j];E.KJ.TransformCoordinatesToRef(Y[j],i,J),x.minimizeInPlace(J),e.maximizeInPlace(J)}e.subtractToRef(x,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(x,this.centerWorld).scaleInPlace(.5)}E.KJ.FromArrayToRef(i.m,0,j[0]),E.KJ.FromArrayToRef(i.m,4,j[1]),E.KJ.FromArrayToRef(i.m,8,j[2]),this._worldMatrix=i}isInFrustum(i){return Y.IsInFrustum(this.vectorsWorld,i)}isCompletelyInFrustum(i){return Y.IsCompletelyInFrustum(this.vectorsWorld,i)}intersectsPoint(i){const x=this.minimumWorld,e=this.maximumWorld,j=x.x,E=x.y,Y=x.z,J=e.x,u=e.y,b=e.z,g=i.x,A=i.y,K=i.z,L=-a.e;return!(J-g<L||L>g-j)&&(!(u-A<L||L>A-E)&&!(b-K<L||L>K-Y))}intersectsSphere(i){return Y.IntersectsSphere(this.minimumWorld,this.maximumWorld,i.centerWorld,i.radiusWorld)}intersectsMinMax(i,x){const e=this.minimumWorld,j=this.maximumWorld,E=e.x,a=e.y,Y=e.z,J=j.x,u=j.y,b=j.z,g=i.x,A=i.y,K=i.z,L=x.x,o=x.y,M=x.z;return!(J<g||E>L)&&(!(u<A||a>o)&&!(b<K||Y>M))}dispose(){var i,x;null===(i=this._drawWrapperFront)||void 0===i||i.dispose(),null===(x=this._drawWrapperBack)||void 0===x||x.dispose()}static Intersects(i,x){return i.intersectsMinMax(x.minimumWorld,x.maximumWorld)}static IntersectsSphere(i,x,e,j){const a=Y._TmpVector3[0];E.KJ.ClampToRef(e,i,x,a);return E.KJ.DistanceSquared(e,a)<=j*j}static IsCompletelyInFrustum(i,x){for(let e=0;e<6;++e){const j=x[e];for(let x=0;x<8;++x)if(j.dotCoordinate(i[x])<0)return!1}return!0}static IsInFrustum(i,x){for(let e=0;e<6;++e){let j=!0;const E=x[e];for(let x=0;x<8;++x)if(E.dotCoordinate(i[x])>=0){j=!1;break}if(j)return!1}return!0}}Y._TmpVector3=(0,j.d)(3,E.KJ.Zero)},12551:(i,x,e)=>{e.d(x,{b:()=>A});var j=e(12259),E=e(12250),a=e(12557),Y=e(12565);const J={min:0,max:0},u={min:0,max:0},b=(i,x,e)=>{const j=E.KJ.Dot(x.centerWorld,i),a=Math.abs(E.KJ.Dot(x.directions[0],i))*x.extendSize.x+Math.abs(E.KJ.Dot(x.directions[1],i))*x.extendSize.y+Math.abs(E.KJ.Dot(x.directions[2],i))*x.extendSize.z;e.min=j-a,e.max=j+a},g=(i,x,e)=>(b(i,x,J),b(i,e,u),!(J.min>u.max||u.min>J.max));class A{constructor(i,x,e){this._isLocked=!1,this.boundingBox=new a.b(i,x,e),this.boundingSphere=new Y.c(i,x,e)}reConstruct(i,x,e){this.boundingBox.reConstruct(i,x,e),this.boundingSphere.reConstruct(i,x,e)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(i){this._isLocked=i}update(i){this._isLocked||(this.boundingBox._update(i),this.boundingSphere._update(i))}centerOn(i,x){const e=A._TmpVector3[0].A(i).jK(x),j=A._TmpVector3[1].A(i).addInPlace(x);return this.boundingBox.reConstruct(e,j,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(e,j,this.boundingBox.getWorldMatrix()),this}encapsulate(i){const x=E.KJ.Minimize(this.minimum,i),e=E.KJ.Maximize(this.maximum,i);return this.reConstruct(x,e,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(i){const x=E.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(x);const e=E.TmpVectors.KJ[0];return E.KJ.TransformCoordinatesToRef(i.boundingBox.minimumWorld,x,e),this.encapsulate(e),E.KJ.TransformCoordinatesToRef(i.boundingBox.maximumWorld,x,e),this.encapsulate(e),this}scale(i){return this.boundingBox.scale(i),this.boundingSphere.scale(i),this}isInFrustum(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===x||3===x)&&this.boundingSphere.isCenterInFrustum(i))return!0;if(!this.boundingSphere.isInFrustum(i))return!1;return!(1!==x&&3!==x)||this.boundingBox.isInFrustum(i)}get diagonalLength(){const i=this.boundingBox;return i.maximumWorld.subtractToRef(i.minimumWorld,A._TmpVector3[0]).length()}isCompletelyInFrustum(i){return this.boundingBox.isCompletelyInFrustum(i)}_checkCollision(i){return i._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(i){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(i)&&!!this.boundingBox.intersectsPoint(i))}intersects(i,x){if(!Y.c.Intersects(this.boundingSphere,i.boundingSphere))return!1;if(!a.b.Intersects(this.boundingBox,i.boundingBox))return!1;if(!x)return!0;const e=this.boundingBox,j=i.boundingBox;return!!g(e.directions[0],e,j)&&(!!g(e.directions[1],e,j)&&(!!g(e.directions[2],e,j)&&(!!g(j.directions[0],e,j)&&(!!g(j.directions[1],e,j)&&(!!g(j.directions[2],e,j)&&(!!g(E.KJ.Cross(e.directions[0],j.directions[0]),e,j)&&(!!g(E.KJ.Cross(e.directions[0],j.directions[1]),e,j)&&(!!g(E.KJ.Cross(e.directions[0],j.directions[2]),e,j)&&(!!g(E.KJ.Cross(e.directions[1],j.directions[0]),e,j)&&(!!g(E.KJ.Cross(e.directions[1],j.directions[1]),e,j)&&(!!g(E.KJ.Cross(e.directions[1],j.directions[2]),e,j)&&(!!g(E.KJ.Cross(e.directions[2],j.directions[0]),e,j)&&(!!g(E.KJ.Cross(e.directions[2],j.directions[1]),e,j)&&!!g(E.KJ.Cross(e.directions[2],j.directions[2]),e,j))))))))))))))}}A._TmpVector3=(0,j.d)(2,E.KJ.Zero)},12565:(i,x,e)=>{e.d(x,{c:()=>a});var j=e(12259),E=e(12250);class a{constructor(i,x,e){this.center=E.KJ.Zero(),this.centerWorld=E.KJ.Zero(),this.minimum=E.KJ.Zero(),this.maximum=E.KJ.Zero(),this.reConstruct(i,x,e)}reConstruct(i,x,e){this.minimum.A(i),this.maximum.A(x);const j=E.KJ.Distance(i,x);x.addToRef(i,this.center).scaleInPlace(.5),this.radius=.5*j,this._update(e||E.Matrix.IdentityReadOnly)}scale(i){const x=this.radius*i,e=a._TmpVector3,j=e[0].OJ(x),E=this.center.subtractToRef(j,e[1]),Y=this.center.addToRef(j,e[2]);return this.reConstruct(E,Y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(i){if(i.isIdentity())this.centerWorld.A(this.center),this.radiusWorld=this.radius;else{E.KJ.TransformCoordinatesToRef(this.center,i,this.centerWorld);const x=a._TmpVector3[0];E.KJ.TransformNormalFromFloatsToRef(1,1,1,i,x),this.radiusWorld=Math.max(Math.abs(x.x),Math.abs(x.y),Math.abs(x.z))*this.radius}}isInFrustum(i){const x=this.centerWorld,e=this.radiusWorld;for(let j=0;j<6;j++)if(i[j].dotCoordinate(x)<=-e)return!1;return!0}isCenterInFrustum(i){const x=this.centerWorld;for(let e=0;e<6;e++)if(i[e].dotCoordinate(x)<0)return!1;return!0}intersectsPoint(i){const x=E.KJ.DistanceSquared(this.centerWorld,i);return!(this.radiusWorld*this.radiusWorld<x)}static Intersects(i,x){const e=E.KJ.DistanceSquared(i.centerWorld,x.centerWorld),j=i.radiusWorld+x.radiusWorld;return!(j*j<e)}static CreateFromCenterAndRadius(i,x,e){this._TmpVector3[0].A(i),this._TmpVector3[1].fJ(0,0,x),this._TmpVector3[2].A(i),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].jK(this._TmpVector3[1]);const j=new a(this._TmpVector3[0],this._TmpVector3[2]);return j._worldMatrix=e||E.Matrix.Identity(),j}}a._TmpVector3=(0,j.d)(3,E.KJ.Zero)},12580:(i,x,e)=>{function j(i){-1===i.indexOf("vClipPlane")&&i.push("vClipPlane"),-1===i.indexOf("vClipPlane2")&&i.push("vClipPlane2"),-1===i.indexOf("vClipPlane3")&&i.push("vClipPlane3"),-1===i.indexOf("vClipPlane4")&&i.push("vClipPlane4"),-1===i.indexOf("vClipPlane5")&&i.push("vClipPlane5"),-1===i.indexOf("vClipPlane6")&&i.push("vClipPlane6")}function E(i,x,e){const j=!!(i.clipPlane??x.clipPlane),E=!!(i.clipPlane2??x.clipPlane2),a=!!(i.clipPlane3??x.clipPlane3),Y=!!(i.clipPlane4??x.clipPlane4),J=!!(i.clipPlane5??x.clipPlane5),u=!!(i.clipPlane6??x.clipPlane6);j&&e.push("#define CLIPPLANE"),E&&e.push("#define CLIPPLANE2"),a&&e.push("#define CLIPPLANE3"),Y&&e.push("#define CLIPPLANE4"),J&&e.push("#define CLIPPLANE5"),u&&e.push("#define CLIPPLANE6")}function a(i,x,e){let j=!1;const E=!!(i.clipPlane??x.clipPlane),a=!!(i.clipPlane2??x.clipPlane2),Y=!!(i.clipPlane3??x.clipPlane3),J=!!(i.clipPlane4??x.clipPlane4),u=!!(i.clipPlane5??x.clipPlane5),b=!!(i.clipPlane6??x.clipPlane6);return e.CLIPPLANE!==E&&(e.CLIPPLANE=E,j=!0),e.CLIPPLANE2!==a&&(e.CLIPPLANE2=a,j=!0),e.CLIPPLANE3!==Y&&(e.CLIPPLANE3=Y,j=!0),e.CLIPPLANE4!==J&&(e.CLIPPLANE4=J,j=!0),e.CLIPPLANE5!==u&&(e.CLIPPLANE5=u,j=!0),e.CLIPPLANE6!==b&&(e.CLIPPLANE6=b,j=!0),j}function Y(i,x,e){let j=x.clipPlane??e.clipPlane;J(i,"vClipPlane",j),j=x.clipPlane2??e.clipPlane2,J(i,"vClipPlane2",j),j=x.clipPlane3??e.clipPlane3,J(i,"vClipPlane3",j),j=x.clipPlane4??e.clipPlane4,J(i,"vClipPlane4",j),j=x.clipPlane5??e.clipPlane5,J(i,"vClipPlane5",j),j=x.clipPlane6??e.clipPlane6,J(i,"vClipPlane6",j)}function J(i,x,e){e&&i.setFloat4(x,e.normal.x,e.normal.y,e.normal.z,e.d)}e.d(x,{b:()=>j,d:()=>Y,h:()=>a,i:()=>E})},12530:(i,x,e)=>{e.d(x,{b:()=>j});class j{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(i,x){this._defines[i]||(i<this._currentRank&&(this._currentRank=i),i>this._maxRank&&(this._maxRank=i),this._defines[i]=new Array),this._defines[i].push(x)}addCPUSkinningFallback(i,x){this._mesh=x,i<this._currentRank&&(this._currentRank=i),i>this._maxRank&&(this._maxRank=i)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(i,x){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,i=i.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),x._bonesComputationForcedToCPU=!0;const e=this._mesh.wi();for(let i=0;i<e.meshes.length;i++){const j=e.meshes[i];if(j.material){if(j.computeBonesUsingShaders&&0!==j.numBoneInfluencers)if(j.material.getEffect()===x)j.computeBonesUsingShaders=!1;else if(j.ne)for(const i of j.ne){if(i.effect===x){j.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&j.computeBonesUsingShaders&&j.numBoneInfluencers>0&&(j.computeBonesUsingShaders=!1)}}else{const x=this._defines[this._currentRank];if(x)for(let e=0;e<x.length;e++)i=i.replace("#define "+x[e],"");this._currentRank++}return i}}},12539:(i,x,e)=>{e.d(x,{e:()=>z});var j=e(12234),E=e(12236),a=e(12061),Y=e(12065),J=e(12108),u=e(12543),b=e(12470),g=e(12072),A=e(12295),K=e(12353),L=e(12278);class o{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(i){this._func=i}get funcRef(){return this._funcRef}set funcRef(i){this._funcRef=i}get funcMask(){return this._funcMask}set funcMask(i){this._funcMask=i}get opStencilFail(){return this._opStencilFail}set opStencilFail(i){this._opStencilFail=i}get opDepthFail(){return this._opDepthFail}set opDepthFail(i){this._opDepthFail=i}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(i){this._opStencilDepthPass=i}get mask(){return this._mask}set mask(i){this._mask=i}get enabled(){return this._enabled}set enabled(i){this._enabled=i}getClassName(){return"MaterialStencilState"}copyTo(i){L.b.Clone((()=>i),this)}serialize(){return L.b.Serialize(this)}parse(i,x,e){L.b.Parse((()=>this),i,x,e)}}(0,j.e)([(0,E.O)()],o.prototype,"func",null),(0,j.e)([(0,E.O)()],o.prototype,"funcRef",null),(0,j.e)([(0,E.O)()],o.prototype,"funcMask",null),(0,j.e)([(0,E.O)()],o.prototype,"opStencilFail",null),(0,j.e)([(0,E.O)()],o.prototype,"opDepthFail",null),(0,j.e)([(0,E.O)()],o.prototype,"opStencilDepthPass",null),(0,j.e)([(0,E.O)()],o.prototype,"mask",null),(0,j.e)([(0,E.O)()],o.prototype,"enabled",null);var M=e(12571);class z{get _supportGlowLayer(){return!1}set _glowModeEnabled(i){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(i){if(this._alpha===i)return;const x=this._alpha;this._alpha=i,1!==x&&1!==i||this.rg(z.MiscDirtyFlag+z.PrePassDirtyFlag)}get alpha(){return this._alpha}set qe(i){this._backFaceCulling!==i&&(this._backFaceCulling=i,this.rg(z.TextureDirtyFlag))}get qe(){return this._backFaceCulling}set cullBackFaces(i){this._cullBackFaces!==i&&(this._cullBackFaces=i,this.rg(z.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(i){this._blockDirtyMechanism!==i&&(this._blockDirtyMechanism=i,i||this.yK())}atomicMaterialsUpdate(i){this.blockDirtyMechanism=!0;try{i(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(i){this._onDisposeObserver&&this.te.remove(this._onDisposeObserver),this._onDisposeObserver=this.te.add(i)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Y.b),this._onBindObservable}set onBind(i){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(i)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Y.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Y.b),this._onEffectCreatedObservable}set alphaMode(i){this._alphaMode!==i&&(this._alphaMode=i,this.rg(z.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(i){this._needDepthPrePass!==i&&(this._needDepthPrePass=i,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(i){this._fogEnabled!==i&&(this._fogEnabled=i,this.rg(z.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case z.WireFrameFillMode:case z.LineListDrawMode:case z.LineLoopDrawMode:case z.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(i){this.fillMode=i?z.WireFrameFillMode:z.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case z.PointFillMode:case z.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(i){this.fillMode=i?z.PointFillMode:z.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(i){this._fillMode!==i&&(this._fillMode=i,this.rg(z.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(i){const x=this.wi().getEngine().getCaps().fragmentDepthSupported;i&&!x&&g.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=i&&x,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(i){this._drawWrapper=i}constructor(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.te=new Y.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Ve=new o,this._useUBO=!1,this._fillMode=z.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=i;const E=x||J.e.LastCreatedScene;E&&(this._scene=E,this._dirtyCallbacks={},this._forceGLSL=j,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=i||a.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new K.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new b.c(this._scene.getEngine(),void 0,void 0,i),this._useUBO=this.wi().getEngine().supportsUniformBuffers,this._createUniformBuffer(),e||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),z.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var i;const x=this.wi().getEngine();null===(i=this._uniformBuffer)||void 0===i||i.dispose(),x.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new b.c(x,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new b.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(i){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.yK(),this.checkReadyOnlyOnce=!0}unfreeze(){this.yK(),this.checkReadyOnlyOnce=!1}isReady(i,x){return!0}isReadyForSubMesh(i,x,e){const j=x.materialDefines;return!!j&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=j,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}wi(){return this._scene}_getEffectiveOrientation(i){return null!==this.sideOrientation?this.sideOrientation:i.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(i){this._transparencyMode!==i&&(this._transparencyMode=i,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===z.MATERIAL_ALPHABLEND||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===z.MATERIAL_ALPHATEST||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===z.MATERIAL_OPAQUE||this._transparencyMode===z.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(i){return this._hasTransparencyMode?this._transparencyModeIsBlend:i.visibility<1||!this._disableAlphaBlending&&(i.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(i){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(i)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}yK(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x=this.wi().meshes;for(const e of x)if(e.ne)for(const x of e.ne)if(x.di()===this)for(const e of x._drawWrappers)e&&this._materialContext===e.materialContext&&(e._wasPreviouslyReady=!1,e._wasPreviouslyUsingInstances=null,e._forceRebindOnNextCall=i);i&&this.rg(z.AllDirtyFlag)}_preBind(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.getEngine(),j=(null==x?this.sideOrientation:x)===z.ClockWiseSideOrientation;return e.enableEffect(i||this._getDrawWrapper()),e.setState(this.qe,this.zOffset,!1,j,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Ve,this.zOffsetUnits),j}bind(i,x){}buildUniformLayout(){const i=this._uniformBuffer;this._eventInfo.ubo=i,this._callbackPluginEventGeneric(8,this._eventInfo),i.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(i,x,e){const j=e._drawWrapper;this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),j._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(i){}bindView(i){this._useUBO?this._needToBindSceneUbo=!0:i.setMatrix("view",this.wi().getViewMatrix())}bindViewProjection(i){this._useUBO?this._needToBindSceneUbo=!0:(i.setMatrix("viewProjection",this.wi().getTransformMatrix()),i.setMatrix("projection",this.wi().getProjectionMatrix()))}bindEyePosition(i,x){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(i,x)}_afterBind(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&x&&(this._needToBindSceneUbo=!1,(0,M.p)(x,this.wi().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=i?i.visibility:1,this._onBindObservable&&i&&this._onBindObservable.notifyObservers(i),this.disableDepthWrite){const i=this._scene.getEngine();this._cachedDepthWriteState=i.getDepthWrite(),i.setDepthWrite(!1)}if(this.disableColorWrite){const i=this._scene.getEngine();this._cachedColorWriteState=i.getColorWrite(),i.setColorWrite(!1)}if(0!==this.depthFunction){const i=this._scene.getEngine();this._cachedDepthFunctionState=i.getDepthFunction()||0,i.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(i){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=i,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(i){return null}_clonePlugins(i,x){const e={};if(this._serializePlugins(e),z._ParsePlugins(e,i,this._scene,x),this.pluginManager)for(const j of this.pluginManager._plugins){const x=i.pluginManager.getPlugin(j.name);x&&j.copyTo(x)}}getBindedMeshes(){if(this.meshMap){const i=[];for(const x in this.meshMap){const e=this.meshMap[x];e&&i.push(e)}return i}return this._scene.meshes.filter((i=>i.material===this))}forceCompilation(i,x,e,j){const E={clipPlane:!1,useInstances:!1,...e},a=this.wi(),Y=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const J=()=>{if(!this._scene||!this._scene.getEngine())return;const e=a.clipPlane;if(E.clipPlane&&(a.clipPlane=new A.e(0,0,0,1)),this._storeEffectOnSubMeshes){let e=!0,a=null;if(i.ne){const x=new u.c(0,0,0,0,0,i,void 0,!1,!1);x.materialDefines&&(x.materialDefines._renderId=-1),this.isReadyForSubMesh(i,x,E.useInstances)||(x.effect&&x.effect.getCompilationError()&&x.effect.allFallbacksProcessed()?a=x.effect.getCompilationError():(e=!1,setTimeout(J,16)))}e&&(this.allowShaderHotSwapping=Y,a&&j&&j(a),x&&x(this))}else this.isReady()?(this.allowShaderHotSwapping=Y,x&&x(this)):setTimeout(J,16);E.clipPlane&&(a.clipPlane=e)};J()}async forceCompilationAsync(i,x){return await new Promise(((e,j)=>{this.forceCompilation(i,(()=>{e()}),x,(i=>{j(i)}))}))}rg(i){this.wi().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(z._DirtyCallbackArray.length=0,i&z.ImageProcessingDirtyFlag&&z._DirtyCallbackArray.push(z._ImageProcessingDirtyCallBack),i&z.TextureDirtyFlag&&z._DirtyCallbackArray.push(z._TextureDirtyCallBack),i&z.LightDirtyFlag&&z._DirtyCallbackArray.push(z._LightsDirtyCallBack),i&z.FresnelDirtyFlag&&z._DirtyCallbackArray.push(z._FresnelDirtyCallBack),i&z.AttributesDirtyFlag&&z._DirtyCallbackArray.push(z._AttributeDirtyCallBack),i&z.MiscDirtyFlag&&z._DirtyCallbackArray.push(z._MiscDirtyCallBack),i&z.PrePassDirtyFlag&&z._DirtyCallbackArray.push(z._PrePassDirtyCallBack),z._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(z._RunDirtyCallBacks),this.wi().resetCachedMaterial())}resetDrawCache(){const i=this.wi().meshes;for(const x of i)if(x.ne)for(const i of x.ne)i.di()===this&&i.resetDrawCache()}_markAllSubMeshesAsDirty(i){const x=this.wi();if(x.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=x.meshes;for(const j of e)if(j.ne)for(const e of j.ne){if((e.di()||(x._hasDefaultMaterial?x.defaultMaterial:null))===this)for(const x of e._drawWrappers)x&&x.defines&&x.defines.markAllAsDirty&&this._materialContext===x.materialContext&&i(x.defines)}}_markScenePrePassDirty(){if(this.wi().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=this.wi().enablePrePassRenderer();i&&i.rg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(z._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(z._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(z._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(z._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(z._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(z._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(z._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(z._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(z._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(z._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const i=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.te.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(i)}))}}setPrePassRenderer(i){return!1}dispose(i,x,e){const j=this.wi();if(j.stopAnimation(this),j.freeProcessedMaterials(),j.removeMaterial(this),this._eventInfo.forceDisposeTextures=x,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const i=this._parentContainer.materials.indexOf(this);i>-1&&this._parentContainer.materials.splice(i,1),this._parentContainer=null}if(!0!==e)if(this.meshMap)for(const E in this.meshMap){const i=this.meshMap[E];this._disposeMeshResources(i)}else{const i=j.meshes;for(const x of i)this._disposeMeshResources(x)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.te.notifyObservers(this),this.te.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(i){if(!i)return;const x=i.ye,e=i._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(i.ne&&e)for(const E of i.ne){const i=E._drawWrappers;for(let a=0;a<i.length;a++){var j;const Y=null===(j=i[a])||void 0===j?void 0:j.effect;if(!Y)continue;e[a]===this&&(null===x||void 0===x||x._releaseVertexArrayObject(Y),E._removeDrawWrapper(a,!0,!0))}}}else null===x||void 0===x||x._releaseVertexArrayObject(this._drawWrapper.effect);i.material!==this||i.sourceMesh||(i.material=null)}serialize(){const i=L.b.Serialize(this);return i.Ve=this.Ve.serialize(),i.uniqueId=this.uniqueId,this._serializePlugins(i),i}_serializePlugins(i){if(i.plugins={},this.pluginManager)for(const x of this.pluginManager._plugins)x.doNotSerialize||(i.plugins[x.getClassName()]=x.serialize())}static Parse(i,x,e){if(i.customType){if("BABYLON.PBRMaterial"===i.customType&&i.overloadedAlbedo&&(i.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return g.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else i.customType="BABYLON.StandardMaterial";const j=a.Tools.Instantiate(i.customType).Parse(i,x,e);return j._loadedUniqueId=i.uniqueId,j}static _ParsePlugins(i,x,e,j){if(i.plugins)for(const J in i.plugins){var E,Y;const u=i.plugins[J];let b=null===(E=x.pluginManager)||void 0===E?void 0:E.getPlugin(u.name);if(!b){const i=a.Tools.Instantiate("BABYLON."+J);i&&(b=new i(x))}null===(Y=b)||void 0===Y||Y.parse(u,e,j)}}}z.TriangleFillMode=0,z.WireFrameFillMode=1,z.PointFillMode=2,z.PointListDrawMode=3,z.LineListDrawMode=4,z.LineLoopDrawMode=5,z.LineStripDrawMode=6,z.TriangleStripDrawMode=7,z.TriangleFanDrawMode=8,z.ClockWiseSideOrientation=0,z.CounterClockWiseSideOrientation=1,z.ImageProcessingDirtyFlag=64,z.TextureDirtyFlag=1,z.LightDirtyFlag=2,z.FresnelDirtyFlag=4,z.AttributesDirtyFlag=8,z.MiscDirtyFlag=16,z.PrePassDirtyFlag=32,z.AllDirtyFlag=127,z.MATERIAL_OPAQUE=0,z.MATERIAL_ALPHATEST=1,z.MATERIAL_ALPHABLEND=2,z.MATERIAL_ALPHATESTANDBLEND=3,z.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,z.MATERIAL_NORMALBLENDMETHOD_RNM=1,z.OnEventObservable=new Y.b,z._AllDirtyCallBack=i=>i.markAllAsDirty(),z._ImageProcessingDirtyCallBack=i=>i.markAsImageProcessingDirty(),z._TextureDirtyCallBack=i=>i.markAsTexturesDirty(),z._FresnelDirtyCallBack=i=>i.markAsFresnelDirty(),z._MiscDirtyCallBack=i=>i.markAsMiscDirty(),z._PrePassDirtyCallBack=i=>i.markAsPrePassDirty(),z._LightsDirtyCallBack=i=>i.markAsLightDirty(),z._AttributeDirtyCallBack=i=>i.markAsAttributesDirty(),z._FresnelAndMiscDirtyCallBack=i=>{z._FresnelDirtyCallBack(i),z._MiscDirtyCallBack(i)},z._TextureAndMiscDirtyCallBack=i=>{z._TextureDirtyCallBack(i),z._MiscDirtyCallBack(i)},z._DirtyCallbackArray=[],z._RunDirtyCallBacks=i=>{for(const x of z._DirtyCallbackArray)x(i)},(0,j.e)([(0,E.O)()],z.prototype,"id",void 0),(0,j.e)([(0,E.O)()],z.prototype,"uniqueId",void 0),(0,j.e)([(0,E.O)()],z.prototype,"name",void 0),(0,j.e)([(0,E.O)()],z.prototype,"metadata",void 0),(0,j.e)([(0,E.O)()],z.prototype,"checkReadyOnEveryCall",void 0),(0,j.e)([(0,E.O)()],z.prototype,"checkReadyOnlyOnce",void 0),(0,j.e)([(0,E.O)()],z.prototype,"state",void 0),(0,j.e)([(0,E.O)("alpha")],z.prototype,"_alpha",void 0),(0,j.e)([(0,E.O)("qe")],z.prototype,"_backFaceCulling",void 0),(0,j.e)([(0,E.O)("cullBackFaces")],z.prototype,"_cullBackFaces",void 0),(0,j.e)([(0,E.O)()],z.prototype,"sideOrientation",void 0),(0,j.e)([(0,E.O)("alphaMode")],z.prototype,"_alphaMode",void 0),(0,j.e)([(0,E.O)()],z.prototype,"_needDepthPrePass",void 0),(0,j.e)([(0,E.O)()],z.prototype,"disableDepthWrite",void 0),(0,j.e)([(0,E.O)()],z.prototype,"disableColorWrite",void 0),(0,j.e)([(0,E.O)()],z.prototype,"forceDepthWrite",void 0),(0,j.e)([(0,E.O)()],z.prototype,"depthFunction",void 0),(0,j.e)([(0,E.O)()],z.prototype,"separateCullingPass",void 0),(0,j.e)([(0,E.O)("fogEnabled")],z.prototype,"_fogEnabled",void 0),(0,j.e)([(0,E.O)()],z.prototype,"pointSize",void 0),(0,j.e)([(0,E.O)()],z.prototype,"zOffset",void 0),(0,j.e)([(0,E.O)()],z.prototype,"zOffsetUnits",void 0),(0,j.e)([(0,E.O)()],z.prototype,"pointsCloud",null),(0,j.e)([(0,E.O)()],z.prototype,"fillMode",null),(0,j.e)([(0,E.O)()],z.prototype,"useLogarithmicDepth",null),(0,j.e)([(0,E.O)()],z.prototype,"transparencyMode",null)},12571:(i,x,e)=>{e.d(x,{$:()=>o,B:()=>L,C:()=>K,E:()=>mi,G:()=>N,H:()=>B,J:()=>T,M:()=>Z,P:()=>X,S:()=>C,V:()=>n,X:()=>d,b:()=>V,d:()=>A,h:()=>f,j:()=>g,m:()=>M,p:()=>z,q:()=>Q,r:()=>l,s:()=>t,u:()=>w,y:()=>O});var j=e(12072),E=e(12286),a=e(12108),Y=e(12521),J=e(12580);const u=E.MJ.Black(),b={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function g(i,x,e){if(!i||i.LOGARITHMICDEPTH||i.indexOf&&i.indexOf("LOGARITHMICDEPTH")>=0){const i=e.activeCamera;1===i.mode&&j.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),x.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}}function A(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&i.fogEnabled&&(!x||x.applyFog)&&0!==i.fogMode&&(e.setFloat4("vFogInfos",i.fogMode,i.fogStart,i.fogEnd,i.fogDensity),j?(i.fogColor.toLinearSpaceToRef(u,i.getEngine().useExactSrgbConversions),e.setColor3("vFogColor",u)):e.setColor3("vFogColor",i.fogColor))}function K(i,x,e,j,E,a,Y,J,u,g){const A=i.numMaxInfluencers||i.numInfluencers;return A<=0?0:(x.push("#define MORPHTARGETS"),i.hasPositions&&x.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),i.hasNormals&&x.push("#define MORPHTARGETTEXTURE_HASNORMALS"),i.hasTangents&&x.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),i.hasUVs&&x.push("#define MORPHTARGETTEXTURE_HASUVS"),i.hasUV2s&&x.push("#define MORPHTARGETTEXTURE_HASUV2S"),i.hasColors&&x.push("#define MORPHTARGETTEXTURE_HASCOLORS"),i.supportsPositions&&E&&x.push("#define MORPHTARGETS_POSITION"),i.supportsNormals&&a&&x.push("#define MORPHTARGETS_NORMAL"),i.supportsTangents&&Y&&x.push("#define MORPHTARGETS_TANGENT"),i.supportsUVs&&J&&x.push("#define MORPHTARGETS_UV"),i.supportsUV2s&&u&&x.push("#define MORPHTARGETS_UV2"),i.supportsColors&&g&&x.push("#define MORPHTARGETS_COLOR"),x.push("#define NUM_MORPH_INFLUENCERS "+A),i.isUsingTextureForTargets&&x.push("#define MORPHTARGETS_TEXTURE"),b.NUM_MORPH_INFLUENCERS=A,b.NORMAL=a,b.TANGENT=Y,b.UV=J,b.UV2=u,b.COLOR=g,L(e,j,b,E),A)}function L(i,x,e){let E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Y=e.NUM_MORPH_INFLUENCERS;if(Y>0&&a.e.LastCreatedEngine){const J=a.e.LastCreatedEngine.getCaps().maxVertexAttribs,u=x.morphTargetManager;if(null!==u&&void 0!==u&&u.isUsingTextureForTargets)return;const b=u&&u.supportsPositions&&E,g=u&&u.supportsNormals&&e.NORMAL,A=u&&u.supportsTangents&&e.TANGENT,K=u&&u.supportsUVs&&e.UV1,L=u&&u.supportsUV2s&&e.UV2,o=u&&u.supportsColors&&e.VERTEXCOLOR;for(let e=0;e<Y;e++)b&&i.push("position"+e),g&&i.push("normal"+e),A&&i.push("tangent"+e),K&&i.push("uv_"+e),L&&i.push("uv2_"+e),o&&i.push("color"+e),i.length>J&&j.c.Error("Cannot add more vertex attributes for mesh "+x.name)}}function o(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"),x&&(i.push("previousWorld0"),i.push("previousWorld1"),i.push("previousWorld2"),i.push("previousWorld3"))}function M(i,x){const e=i.morphTargetManager;i&&e&&x.setFloatArray("morphTargetInfluences",e.influences)}function z(i,x){x.bindToEffect(i,"Scene")}function T(i,x,e){x._needUVs=!0,x[e]=!0,i.optimizeUVAllocation&&i.getTextureMatrix().isIdentityAs3x2()?(x[e+"DIRECTUV"]=i.coordinatesIndex+1,x["MAINUV"+(i.coordinatesIndex+1)]=!0):x[e+"DIRECTUV"]=0}function Q(i,x,e){const j=i.getTextureMatrix();x.he(e+"Matrix",j)}function t(i,x,e){e.BAKED_VERTEX_ANIMATION_TEXTURE&&e.INSTANCES&&i.push("bakedVertexAnimationSettingsInstanced")}function V(i,x,e){var j;if(x&&i&&(i.computeBonesUsingShaders&&x._bonesComputationForcedToCPU&&(i.computeBonesUsingShaders=!1),i.useBones&&i.computeBonesUsingShaders&&i.skeleton)){const E=i.skeleton;if(E.isUsingTextureForMatrices&&x.getUniformIndex("boneTextureWidth")>-1){const e=E.getTransformMatrixTexture(i);x.setTexture("boneSampler",e),x.setFloat("boneTextureWidth",4*(E.bones.length+1))}else{const a=E.getTransformMatrices(i);a&&(x.setMatrices("mBones",a),e&&i.wi().prePassRenderer&&i.wi().prePassRenderer.getIndex(2)&&(e.previousBones[i.uniqueId]||(e.previousBones[i.uniqueId]=a.slice()),x.setMatrices("mPreviousBones",e.previousBones[i.uniqueId]),j=a,e.previousBones[i.uniqueId].set(j)))}}}function S(i,x,e,j,E){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];i._bindLight(x,e,j,E,a)}function f(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const a=Math.min(x.lightSources.length,E);for(let Y=0;Y<a;Y++){S(x.lightSources[Y],Y,i,e,"boolean"===typeof j?j:j.SPECULARTERM,x.receiveShadows)}}function w(i,x,e,j){e.NUM_BONE_INFLUENCERS>0&&(j.addCPUSkinningFallback(0,x),i.push("matricesIndices"),i.push("matricesWeights"),e.NUM_BONE_INFLUENCERS>4&&(i.push("matricesIndicesExtra"),i.push("matricesWeightsExtra")))}function O(i,x){(x.INSTANCES||x.THIN_INSTANCES)&&o(i,!!x.PREPASS_VELOCITY),x.INSTANCESCOLOR&&i.push("instanceColor")}function l(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=0;for(let a=0;a<e&&i["LIGHT"+a];a++)a>0&&(E=j+a,x.addFallback(E,"LIGHT"+a)),i.SHADOWS||(i["SHADOW"+a]&&x.addFallback(j,"SHADOW"+a),i["SHADOWPCF"+a]&&x.addFallback(j,"SHADOWPCF"+a),i["SHADOWPCSS"+a]&&x.addFallback(j,"SHADOWPCSS"+a),i["SHADOWPOISSON"+a]&&x.addFallback(j,"SHADOWPOISSON"+a),i["SHADOWESM"+a]&&x.addFallback(j,"SHADOWESM"+a),i["SHADOWCLOSEESM"+a]&&x.addFallback(j,"SHADOWCLOSEESM"+a));return E++}function Z(i,x,e,j,E,a,Y){let J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Y._areMiscDirty&&(Y.LOGARITHMICDEPTH=e,Y.POINTSIZE=j,Y.FOG=E&&function(i,x){return x.fogEnabled&&i.applyFog&&0!==x.fogMode}(i,x),Y.NONUNIFORMSCALING=i.nonUniformScaling,Y.ALPHATEST=a,Y.DECAL_AFTER_DETAIL=J)}function B(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e._areLightsDirty)return e._needNormals;let Y=0;const J={needNormals:e._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(i.lightsEnabled&&!a)for(const b of x.lightSources)if(k(i,x,b,Y,e,j,J),Y++,Y===E)break;e.SPECULARTERM=J.specularEnabled,e.SHADOWS=J.shadowEnabled;for(let b=Y;b<E;b++)void 0!==e["LIGHT"+b]&&(e["LIGHT"+b]=!1,e["HEMILIGHT"+b]=!1,e["POINTLIGHT"+b]=!1,e["DIRLIGHT"+b]=!1,e["SPOTLIGHT"+b]=!1,e["AREALIGHT"+b]=!1,e["SHADOW"+b]=!1,e["SHADOWCSM"+b]=!1,e["SHADOWCSMDEBUG"+b]=!1,e["SHADOWCSMNUM_CASCADES"+b]=!1,e["SHADOWCSMUSESHADOWMAXZ"+b]=!1,e["SHADOWCSMNOBLEND"+b]=!1,e["SHADOWCSM_RIGHTHANDED"+b]=!1,e["SHADOWPCF"+b]=!1,e["SHADOWPCSS"+b]=!1,e["SHADOWPOISSON"+b]=!1,e["SHADOWESM"+b]=!1,e["SHADOWCLOSEESM"+b]=!1,e["SHADOWCUBE"+b]=!1,e["SHADOWLOWQUALITY"+b]=!1,e["SHADOWMEDIUMQUALITY"+b]=!1);const u=i.getEngine().getCaps();return void 0===e.SHADOWFLOAT&&(J.needRebuild=!0),e.SHADOWFLOAT=J.shadowEnabled&&(u.textureFloatRender&&u.textureFloatLinearFiltering||u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering),e.LIGHTMAPEXCLUDED=J.lightmapMode,J.needRebuild&&e.rebuild(),J.needNormals}function k(i,x,e,j,E,a,J){switch(J.needNormals=!0,void 0===E["LIGHT"+j]&&(J.needRebuild=!0),E["LIGHT"+j]=!0,E["SPOTLIGHT"+j]=!1,E["HEMILIGHT"+j]=!1,E["POINTLIGHT"+j]=!1,E["DIRLIGHT"+j]=!1,E["AREALIGHT"+j]=!1,e.prepareLightSpecificDefines(E,j),E["LIGHT_FALLOFF_PHYSICAL"+j]=!1,E["LIGHT_FALLOFF_GLTF"+j]=!1,E["LIGHT_FALLOFF_STANDARD"+j]=!1,e.falloffType){case Y.e.FALLOFF_GLTF:E["LIGHT_FALLOFF_GLTF"+j]=!0;break;case Y.e.FALLOFF_PHYSICAL:E["LIGHT_FALLOFF_PHYSICAL"+j]=!0;break;case Y.e.FALLOFF_STANDARD:E["LIGHT_FALLOFF_STANDARD"+j]=!0}if(a&&!e.MA.equalsFloats(0,0,0)&&(J.specularEnabled=!0),E["SHADOW"+j]=!1,E["SHADOWCSM"+j]=!1,E["SHADOWCSMDEBUG"+j]=!1,E["SHADOWCSMNUM_CASCADES"+j]=!1,E["SHADOWCSMUSESHADOWMAXZ"+j]=!1,E["SHADOWCSMNOBLEND"+j]=!1,E["SHADOWCSM_RIGHTHANDED"+j]=!1,E["SHADOWPCF"+j]=!1,E["SHADOWPCSS"+j]=!1,E["SHADOWPOISSON"+j]=!1,E["SHADOWESM"+j]=!1,E["SHADOWCLOSEESM"+j]=!1,E["SHADOWCUBE"+j]=!1,E["SHADOWLOWQUALITY"+j]=!1,E["SHADOWMEDIUMQUALITY"+j]=!1,x&&x.receiveShadows&&i.shadowsEnabled&&e.shadowEnabled){const x=e.getShadowGenerator(i.activeCamera)??e.getShadowGenerator();if(x){const i=x.getShadowMap();i&&i.renderList&&i.renderList.length>0&&(J.shadowEnabled=!0,x.prepareDefines(E,j))}}e.lightmapMode!=Y.e.LIGHTMAP_DEFAULT?(J.lightmapMode=!0,E["LIGHTMAPEXCLUDED"+j]=!0,E["LIGHTMAPNOSPECULAR"+j]=e.lightmapMode==Y.e.LIGHTMAP_SHADOWSONLY):(E["LIGHTMAPEXCLUDED"+j]=!1,E["LIGHTMAPNOSPECULAR"+j]=!1)}function N(i,x,e,j,E){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=function(i,x){let e=!1;if(i.activeCamera){const j=x.CAMERA_ORTHOGRAPHIC?1:0,E=x.CAMERA_PERSPECTIVE?1:0,a=1===i.activeCamera.mode?1:0,Y=0===i.activeCamera.mode?1:0;(j^a||E^Y)&&(x.CAMERA_ORTHOGRAPHIC=1===a,x.CAMERA_PERSPECTIVE=1===Y,e=!0)}return e}(i,j);!1!==a&&(u=(0,J.h)(e,i,j)),j.DEPTHPREPASS!==!x.getColorWrite()&&(j.DEPTHPREPASS=!j.DEPTHPREPASS,u=!0),j.INSTANCES!==E&&(j.INSTANCES=E,u=!0),j.THIN_INSTANCES!==Y&&(j.THIN_INSTANCES=Y,u=!0),u&&j.markAsUnprocessed()}function mi(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!x._areAttributesDirty&&x._needNormals===x._normals&&x._needUVs===x._uvs)return!1;x._normals=x._needNormals,x._uvs=x._needUVs,x.NORMAL=x._needNormals&&i.isVerticesDataPresent("normal"),x._needNormals&&i.isVerticesDataPresent("tangent")&&(x.TANGENT=!0);for(let J=1;J<=6;++J)x["UV"+J]=!!x._needUVs&&i.isVerticesDataPresent(`uv${1===J?"":J}`);if(e){const e=i.useVertexColors&&i.isVerticesDataPresent("color");x.VERTEXCOLOR=e,x.VERTEXALPHA=i.hasVertexAlpha&&e&&a}return i.isVerticesDataPresent("instanceColor")&&(i.hasInstances||i.hasThinInstances)&&(x.INSTANCESCOLOR=!0),j&&function(i,x){if(i.useBones&&i.computeBonesUsingShaders&&i.skeleton){x.NUM_BONE_INFLUENCERS=i.numBoneInfluencers;const e=void 0!==x.BONETEXTURE;if(i.skeleton.isUsingTextureForMatrices&&e)x.BONETEXTURE=!0;else{x.BonesPerMesh=i.skeleton.bones.length+1,x.BONETEXTURE=!e&&void 0;const j=i.wi().prePassRenderer;if(j&&j.enabled){const e=-1===j.excludedSkinnedMesh.indexOf(i);x.BONES_VELOCITY_ENABLED=e}}}else x.NUM_BONE_INFLUENCERS=0,x.BonesPerMesh=0,void 0!==x.BONETEXTURE&&(x.BONETEXTURE=!1)}(i,x),E&&function(i,x){const e=i.morphTargetManager;e?(x.MORPHTARGETS_UV=e.supportsUVs&&x.UV1,x.MORPHTARGETS_UV2=e.supportsUV2s&&x.UV2,x.MORPHTARGETS_TANGENT=e.supportsTangents&&x.TANGENT,x.MORPHTARGETS_NORMAL=e.supportsNormals&&x.NORMAL,x.MORPHTARGETS_POSITION=e.supportsPositions,x.MORPHTARGETS_COLOR=e.supportsColors,x.MORPHTARGETTEXTURE_HASUVS=e.hasUVs,x.MORPHTARGETTEXTURE_HASUV2S=e.hasUV2s,x.MORPHTARGETTEXTURE_HASTANGENTS=e.hasTangents,x.MORPHTARGETTEXTURE_HASNORMALS=e.hasNormals,x.MORPHTARGETTEXTURE_HASPOSITIONS=e.hasPositions,x.MORPHTARGETTEXTURE_HASCOLORS=e.hasColors,x.NUM_MORPH_INFLUENCERS=e.numMaxInfluencers||e.numInfluencers,x.MORPHTARGETS=x.NUM_MORPH_INFLUENCERS>0,x.MORPHTARGETS_TEXTURE=e.isUsingTextureForTargets):(x.MORPHTARGETS_UV=!1,x.MORPHTARGETS_UV2=!1,x.MORPHTARGETS_TANGENT=!1,x.MORPHTARGETS_NORMAL=!1,x.MORPHTARGETS_POSITION=!1,x.MORPHTARGETS_COLOR=!1,x.MORPHTARGETTEXTURE_HASUVS=!1,x.MORPHTARGETTEXTURE_HASUV2S=!1,x.MORPHTARGETTEXTURE_HASTANGENTS=!1,x.MORPHTARGETTEXTURE_HASNORMALS=!1,x.MORPHTARGETTEXTURE_HASPOSITIONS=!1,x.MORPHTARGETTEXTURE_HAS_COLORS=!1,x.MORPHTARGETS=!1,x.NUM_MORPH_INFLUENCERS=0)}(i,x),Y&&function(i,x){const e=i.bakedVertexAnimationManager;x.BAKED_VERTEX_ANIMATION_TEXTURE=!(!e||!e.isEnabled)}(i,x),!0}function X(i,x){if(i.activeCamera){const e=x.MULTIVIEW;x.MULTIVIEW=null!==i.activeCamera.outputRenderTarget&&i.activeCamera.outputRenderTarget.getViewCount()>1,x.MULTIVIEW!=e&&x.markAsUnprocessed()}}function C(i,x,e){const j=x.ORDER_INDEPENDENT_TRANSPARENCY,E=x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;x.ORDER_INDEPENDENT_TRANSPARENCY=i.useOrderIndependentTransparency&&e,x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!i.getEngine().getCaps().textureFloatLinearFiltering,j===x.ORDER_INDEPENDENT_TRANSPARENCY&&E===x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||x.markAsUnprocessed()}function n(i,x,e){const j=x.PREPASS;if(!x._arePrePassDirty)return;const E=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(i.prePassRenderer&&i.prePassRenderer.enabled&&e){x.PREPASS=!0,x.SCENE_MRT_COUNT=i.prePassRenderer.mrtCount,x.PREPASS_NORMAL_WORLDSPACE=i.prePassRenderer.generateNormalsInWorldSpace,x.PREPASS_COLOR=!0,x.PREPASS_COLOR_INDEX=0;for(let e=0;e<E.length;e++){const j=i.prePassRenderer.getIndex(E[e].type);-1!==j?(x[E[e].define]=!0,x[E[e].index]=j):x[E[e].define]=!1}}else{x.PREPASS=!1;for(let i=0;i<E.length;i++)x[E[i].define]=!1}x.PREPASS!=j&&(x.markAsUnprocessed(),x.markAsImageProcessingDirty())}function I(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];E&&E.push("Light"+i),a||(x.push("vLightData"+i,"vLightDiffuse"+i,"vLightSpecular"+i,"vLightDirection"+i,"vLightWidth"+i,"vLightHeight"+i,"vLightFalloff"+i,"vLightGround"+i,"lightMatrix"+i,"shadowsInfo"+i,"depthValues"+i),e.push("shadowTexture"+i),e.push("depthTexture"+i),x.push("viewFrustumZ"+i,"cascadeBlendFactor"+i,"lightSizeUVCorrection"+i,"depthCorrection"+i,"penumbraDarkness"+i,"frustumLengths"+i),j&&(e.push("projectionLightTexture"+i),x.push("textureProjectionMatrix"+i)),Y&&e.push("iesLightTexture"+i))}function d(i,x,e){let j,E,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(i.uniformsNames){const Y=i;j=Y.uniformsNames,E=Y.uniformBuffersNames,x=Y.samplers,e=Y.defines,a=Y.maxSimultaneousLights||0}else j=i,x||(x=[]);for(let Y=0;Y<a&&e["LIGHT"+Y];Y++)I(Y,j,x,e["PROJECTEDLIGHTTEXTURE"+Y],E,!1,e["IESLIGHTTEXTURE"+Y]);e.NUM_MORPH_INFLUENCERS&&(j.push("morphTargetInfluences"),j.push("morphTargetCount")),e.BAKED_VERTEX_ANIMATION_TEXTURE&&(j.push("bakedVertexAnimationSettings"),j.push("bakedVertexAnimationTextureSizeInverted"),j.push("bakedVertexAnimationTime"),x.push("bakedVertexAnimationTexture"))}},12537:(i,x,e)=>{e.d(x,{d:()=>a});var j=e(12250),E=e(12539);class a extends E.e{constructor(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(i,x,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new j.Matrix,this._storeEffectOnSubMeshes=e}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(i,x){return!!i&&(!this._storeEffectOnSubMeshes||(!i.ne||0===i.ne.length||this.isReadyForSubMesh(i,i.ne[0],x)))}_isReadyForSubMesh(i){const x=i.materialDefines;return!(this.checkReadyOnEveryCall||!i.effect||!x||x._renderId!==this.wi().getRenderId())}bindOnlyWorldMatrix(i){this._activeEffect.setMatrix("world",i)}bindOnlyNormalMatrix(i){this._activeEffect.setMatrix("normalMatrix",i)}bind(i,x){x&&this.bindForSubMesh(i,x,x.ne[0])}_afterBind(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;super._afterBind(i,x,e),this.wi()._cachedEffect=x,e?e._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e._drawWrapper._forceRebindOnNextCall||i.isCachedMaterialInvalid(this,x,j)}dispose(i,x,e){this._activeEffect=void 0,super.dispose(i,x,e)}}},12568:(i,x,e)=>{e.d(x,{b:()=>J,d:()=>u});var j=e(12234),E=e(12250),a=e(12236);class Y{static extractMinAndMaxIndexed(i,x,e,j,E,a){for(let Y=e;Y<e+j;Y++){const e=3*x[Y],j=i[e],J=i[e+1],u=i[e+2];E.minimizeInPlaceFromFloats(j,J,u),a.maximizeInPlaceFromFloats(j,J,u)}}static extractMinAndMax(i,x,e,j,E,a){for(let Y=x,J=x*j;Y<x+e;Y++,J+=j){const x=i[J],e=i[J+1],j=i[J+2];E.minimizeInPlaceFromFloats(x,e,j),a.maximizeInPlaceFromFloats(x,e,j)}}}function J(i,x,e,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const J=new E.KJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new E.KJ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Y.extractMinAndMaxIndexed(i,x,e,j,J,u),a&&(J.x-=J.x*a.x+a.y,J.y-=J.y*a.x+a.y,J.z-=J.z*a.x+a.y,u.x+=u.x*a.x+a.y,u.y+=u.y*a.x+a.y,u.z+=u.z*a.x+a.y),{minimum:J,maximum:u}}function u(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;const J=new E.KJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new E.KJ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a||(a=3),Y.extractMinAndMax(i,x,e,a,J,u),j&&(J.x-=J.x*j.x+j.y,J.y-=J.y*j.x+j.y,J.z-=J.z*j.x+j.y,u.x+=u.x*j.x+j.y,u.y+=u.y*j.x+j.y,u.z+=u.z*j.x+j.y),{minimum:J,maximum:u}}(0,j.e)([a.f.filter((function(){for(var i=arguments.length,x=new Array(i),e=0;e<i;e++)x[e]=arguments[e];let[j,E]=x;return!Array.isArray(j)&&!Array.isArray(E)}))],Y,"extractMinAndMaxIndexed",null),(0,j.e)([a.f.filter((function(){for(var i=arguments.length,x=new Array(i),e=0;e<i;e++)x[e]=arguments[e];let[j]=x;return!Array.isArray(j)}))],Y,"extractMinAndMax",null)},12543:(i,x,e)=>{e.d(x,{c:()=>u});var j=e(12314),E=e(12546),a=e(12551),Y=e(12568),J=e(12353);class u{get materialDefines(){var i;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(i=this._getDrawWrapper())||void 0===i?void 0:i.defines}set materialDefines(i){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=i}_getDrawWrapper(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i=i??this._engine.currentRenderPassId;let e=this._drawWrappers[i];return!e&&x&&(this._drawWrappers[i]=e=new J.e(this._mesh.wi().getEngine())),e}_removeDrawWrapper(i){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var e;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(e=this._drawWrappers[i])||void 0===e||e.dispose(x));this._drawWrappers[i]=void 0}get effect(){var i;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(i=this._getDrawWrapper())||void 0===i?void 0:i.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(i){this._mainDrawWrapperOverride=i}setEffect(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this._drawWrapper;E.setEffect(i,x,j),void 0!==e&&(E.materialContext=e),i||(E.defines=null,E.materialContext=void 0)}resetDrawCache(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==i)return void this._removeDrawWrapper(i,!0,x);for(const i of this._drawWrappers)null===i||void 0===i||i.dispose(x)}this._drawWrappers=[]}static AddToMesh(i,x,e,j,E,a,Y){return new u(i,x,e,j,E,a,Y,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(i,x,e,j,E,a,Y){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=i,this.verticesStart=x,this.verticesCount=e,this.indexStart=j,this.indexCount=E,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=a,this._renderingMesh=Y||a,u&&a.ne.push(this),this._engine=this._mesh.wi().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=a.ne.length-1,J&&(this.refreshBoundingInfo(),a.Re(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(i){return this._boundingInfo=i,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const i=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return i||this._renderingMesh}di(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const x=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!x)return i&&this._mesh.wi()._hasDefaultMaterial?this._mesh.wi().defaultMaterial:null;if(this._isMultiMaterial(x)){const i=x.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}return x}_isMultiMaterial(i){return void 0!==i.getSubMaterial}refreshBoundingInfo(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.ye)return this;if(i||(i=this._renderingMesh.getVerticesData(j.f.PositionKind)),!i)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const x=this._renderingMesh.Pe();let e;if(0===this.indexStart&&this.indexCount===x.length){const i=this._renderingMesh.getBoundingInfo();e={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else e=(0,Y.b)(i,x,this.indexStart,this.indexCount,this._renderingMesh.ye.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new a.b(e.minimum,e.maximum),this}_checkCollision(i){return this.getBoundingInfo()._checkCollision(i)}updateBoundingInfo(i){let x=this.getBoundingInfo();return x||(this.refreshBoundingInfo(),x=this.getBoundingInfo()),x&&x.update(i),this}isInFrustum(i){const x=this.getBoundingInfo();return!!x&&x.isInFrustum(i,this._mesh.zK)}isCompletelyInFrustum(i){const x=this.getBoundingInfo();return!!x&&x.isCompletelyInFrustum(i)}render(i){return this._renderingMesh.render(this,i,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(i,x){if(!this._linesIndexBuffer){const e=6*Math.floor(this.indexCount/3),j=this.verticesStart+this.verticesCount>65535?new Uint32Array(e):new Uint16Array(e);let E=0;if(0===i.length)for(let i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)j[E++]=i,j[E++]=i+1,j[E++]=i+1,j[E++]=i+2,j[E++]=i+2,j[E++]=i;else for(let x=this.indexStart;x<this.indexStart+this.indexCount;x+=3)j[E++]=i[x],j[E++]=i[x+1],j[E++]=i[x+1],j[E++]=i[x+2],j[E++]=i[x+2],j[E++]=i[x];this._linesIndexBuffer=x.createIndexBuffer(j),this._linesIndexCount=j.length}return this._linesIndexBuffer}canIntersects(i){const x=this.getBoundingInfo();return!!x&&i.intersectsBox(x.boundingBox)}intersects(i,x,e,j,E){const a=this.di();if(!a)return null;let Y=3,J=!1;switch(a.fillMode){case 3:case 5:case 6:case 8:return null;case 7:Y=1,J=!0}return 4===a.fillMode?e.length?this._intersectLines(i,x,e,this._mesh.intersectionThreshold,j):this._intersectUnIndexedLines(i,x,e,this._mesh.intersectionThreshold,j):!e.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(i,x,e,j,E):this._intersectTriangles(i,x,e,Y,J,j,E)}_intersectLines(i,x,e,j,a){let Y=null;for(let J=this.indexStart;J<this.indexStart+this.indexCount;J+=2){const u=x[e[J]],b=x[e[J+1]],g=i.intersectionSegment(u,b,j);if(!(g<0)&&((a||!Y||g<Y.distance)&&(Y=new E.d(null,null,g),Y.faceId=J/2,a)))break}return Y}_intersectUnIndexedLines(i,x,e,j,a){let Y=null;for(let J=this.verticesStart;J<this.verticesStart+this.verticesCount;J+=2){const e=x[J],u=x[J+1],b=i.intersectionSegment(e,u,j);if(!(b<0)&&((a||!Y||b<Y.distance)&&(Y=new E.d(null,null,b),Y.faceId=J/2,a)))break}return Y}_intersectTriangles(i,x,e,j,E,a,Y){let J=null,u=-1;for(let b=this.indexStart;b<this.indexStart+this.indexCount-(3-j);b+=j){u++;const j=e[b],g=e[b+1],A=e[b+2];if(E&&4294967295===A){b+=2;continue}const K=x[j],L=x[g],o=x[A];if(!K||!L||!o)continue;if(Y&&!Y(K,L,o,i,j,g,A))continue;const M=i.intersectsTriangle(K,L,o);if(M){if(M.distance<0)continue;if((a||!J||M.distance<J.distance)&&(J=M,J.faceId=u,a))break}}return J}_intersectUnIndexedTriangles(i,x,e,j,E){let a=null;for(let Y=this.verticesStart;Y<this.verticesStart+this.verticesCount;Y+=3){const e=x[Y],J=x[Y+1],u=x[Y+2];if(E&&!E(e,J,u,i,-1,-1,-1))continue;const b=i.intersectsTriangle(e,J,u);if(b){if(b.distance<0)continue;if((j||!a||b.distance<a.distance)&&(a=b,a.faceId=Y/3,j))break}}return a}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(i,x){const e=new u(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,i,x,!1);if(!this.IsGlobal){const i=this.getBoundingInfo();if(!i)return e;e._boundingInfo=new a.b(i.minimum,i.maximum)}return e}dispose(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.wi().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const x=this._mesh.ne.indexOf(this);this._mesh.ne.splice(x,1),this.resetDrawCache(void 0,i)}getClassName(){return"SubMesh"}static CreateFromIndices(i,x,e,j,E){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=Number.MAX_VALUE,J=-Number.MAX_VALUE;const b=(E||j).Pe();for(let u=x;u<x+e;u++){const i=b[u];i<Y&&(Y=i),i>J&&(J=i)}return new u(i,Y,J-Y+1,x,e,j,E,a)}}}}]);