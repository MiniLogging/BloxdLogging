"use strict";(self["6xhfpmwgjr5"]=self["6xhfpmwgjr5"]||[]).push([[24],{12730:(P,a,R)=>{R.d(a,{b:()=>S});class S{constructor(P,a,R){this.bu=P,this.bv=a,this.distance=R,this.faceId=0,this.subMeshId=0}}},12735:(P,a,R)=>{R.d(a,{d:()=>V});var S=R(12423),A=R(12415),Z=R(12418);class p{constructor(P,a,R){this.vectors=(0,S.e)(8,A.Oa.Zero),this.center=A.Oa.Zero(),this.centerWorld=A.Oa.Zero(),this.extendSize=A.Oa.Zero(),this.extendSizeWorld=A.Oa.Zero(),this.directions=(0,S.e)(3,A.Oa.Zero),this.vectorsWorld=(0,S.e)(8,A.Oa.Zero),this.minimumWorld=A.Oa.Zero(),this.maximumWorld=A.Oa.Zero(),this.minimum=A.Oa.Zero(),this.maximum=A.Oa.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(P,a,R)}reConstruct(P,a,R){const S=P.x,Z=P.y,p=P.z,j=a.x,U=a.y,Q=a.z,h=this.vectors;this.minimum.Oj(S,Z,p),this.maximum.Oj(j,U,Q),h[0].Oj(S,Z,p),h[1].Oj(j,U,Q),h[2].Oj(j,Z,p),h[3].Oj(S,U,p),h[4].Oj(S,Z,Q),h[5].Oj(j,U,p),h[6].Oj(S,U,Q),h[7].Oj(j,Z,Q),a.addToRef(P,this.center).scaleInPlace(.5),a.subtractToRef(P,this.extendSize).scaleInPlace(.5),this._worldMatrix=R||A.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(P){const a=p._TmpVector3,R=this.maximum.subtractToRef(this.minimum,a[0]),S=R.length();R.normalizeFromLength(S);const A=S*P,Z=R.scaleInPlace(.5*A),j=this.center.subtractToRef(Z,a[1]),U=this.center.addToRef(Z,a[2]);return this.reConstruct(j,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){const a=this.minimumWorld,R=this.maximumWorld,S=this.directions,Z=this.vectorsWorld,p=this.vectors;if(P.isIdentity()){a.A(this.minimum),R.A(this.maximum);for(let P=0;P<8;++P)Z[P].A(p[P]);this.extendSizeWorld.A(this.extendSize),this.centerWorld.A(this.center)}else{a.yj(Number.MAX_VALUE),R.yj(-Number.MAX_VALUE);for(let S=0;S<8;++S){const j=Z[S];A.Oa.TransformCoordinatesToRef(p[S],P,j),a.minimizeInPlace(j),R.maximizeInPlace(j)}R.subtractToRef(a,this.extendSizeWorld).scaleInPlace(.5),R.addToRef(a,this.centerWorld).scaleInPlace(.5)}A.Oa.FromArrayToRef(P.m,0,S[0]),A.Oa.FromArrayToRef(P.m,4,S[1]),A.Oa.FromArrayToRef(P.m,8,S[2]),this._worldMatrix=P}isInFrustum(P){return p.IsInFrustum(this.vectorsWorld,P)}isCompletelyInFrustum(P){return p.IsCompletelyInFrustum(this.vectorsWorld,P)}intersectsPoint(P){const a=this.minimumWorld,R=this.maximumWorld,S=a.x,A=a.y,p=a.z,j=R.x,U=R.y,Q=R.z,h=P.x,l=P.y,V=P.z,f=-Z.c;return!(j-h<f||f>h-S)&&(!(U-l<f||f>l-A)&&!(Q-V<f||f>V-p))}intersectsSphere(P){return p.IntersectsSphere(this.minimumWorld,this.maximumWorld,P.centerWorld,P.radiusWorld)}intersectsMinMax(P,a){const R=this.minimumWorld,S=this.maximumWorld,A=R.x,Z=R.y,p=R.z,j=S.x,U=S.y,Q=S.z,h=P.x,l=P.y,V=P.z,f=a.x,O=a.y,q=a.z;return!(j<h||A>f)&&(!(U<l||Z>O)&&!(Q<V||p>q))}dispose(){var P,a;null===(P=this._drawWrapperFront)||void 0===P||P.dispose(),null===(a=this._drawWrapperBack)||void 0===a||a.dispose()}static Intersects(P,a){return P.intersectsMinMax(a.minimumWorld,a.maximumWorld)}static IntersectsSphere(P,a,R,S){const Z=p._TmpVector3[0];A.Oa.ClampToRef(R,P,a,Z);return A.Oa.DistanceSquared(R,Z)<=S*S}static IsCompletelyInFrustum(P,a){for(let R=0;R<6;++R){const S=a[R];for(let a=0;a<8;++a)if(S.dotCoordinate(P[a])<0)return!1}return!0}static IsInFrustum(P,a){for(let R=0;R<6;++R){let S=!0;const A=a[R];for(let a=0;a<8;++a)if(A.dotCoordinate(P[a])>=0){S=!1;break}if(S)return!1}return!0}}p._TmpVector3=(0,S.e)(3,A.Oa.Zero);var j=R(12743);const U={min:0,max:0},Q={min:0,max:0},h=(P,a,R)=>{const S=A.Oa.Dot(a.centerWorld,P),Z=Math.abs(A.Oa.Dot(a.directions[0],P))*a.extendSize.x+Math.abs(A.Oa.Dot(a.directions[1],P))*a.extendSize.y+Math.abs(A.Oa.Dot(a.directions[2],P))*a.extendSize.z;R.min=S-Z,R.max=S+Z},l=(P,a,R)=>(h(P,a,U),h(P,R,Q),!(U.min>Q.max||Q.min>U.max));class V{constructor(P,a,R){this._isLocked=!1,this.boundingBox=new p(P,a,R),this.boundingSphere=new j.c(P,a,R)}reConstruct(P,a,R){this.boundingBox.reConstruct(P,a,R),this.boundingSphere.reConstruct(P,a,R)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(P){this._isLocked=P}update(P){this._isLocked||(this.boundingBox._update(P),this.boundingSphere._update(P))}centerOn(P,a){const R=V._TmpVector3[0].A(P).Ul(a),S=V._TmpVector3[1].A(P).addInPlace(a);return this.boundingBox.reConstruct(R,S,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(R,S,this.boundingBox.getWorldMatrix()),this}encapsulate(P){const a=A.Oa.Minimize(this.minimum,P),R=A.Oa.Maximize(this.maximum,P);return this.reConstruct(a,R,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(P){const a=A.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(a);const R=A.TmpVectors.Oa[0];return A.Oa.TransformCoordinatesToRef(P.boundingBox.minimumWorld,a,R),this.encapsulate(R),A.Oa.TransformCoordinatesToRef(P.boundingBox.maximumWorld,a,R),this.encapsulate(R),this}scale(P){return this.boundingBox.scale(P),this.boundingSphere.scale(P),this}isInFrustum(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===a||3===a)&&this.boundingSphere.isCenterInFrustum(P))return!0;if(!this.boundingSphere.isInFrustum(P))return!1;return!(1!==a&&3!==a)||this.boundingBox.isInFrustum(P)}get diagonalLength(){const P=this.boundingBox;return P.maximumWorld.subtractToRef(P.minimumWorld,V._TmpVector3[0]).length()}isCompletelyInFrustum(P){return this.boundingBox.isCompletelyInFrustum(P)}_checkCollision(P){return P._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(P){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(P)&&!!this.boundingBox.intersectsPoint(P))}intersects(P,a){if(!j.c.Intersects(this.boundingSphere,P.boundingSphere))return!1;if(!p.Intersects(this.boundingBox,P.boundingBox))return!1;if(!a)return!0;const R=this.boundingBox,S=P.boundingBox;return!!l(R.directions[0],R,S)&&(!!l(R.directions[1],R,S)&&(!!l(R.directions[2],R,S)&&(!!l(S.directions[0],R,S)&&(!!l(S.directions[1],R,S)&&(!!l(S.directions[2],R,S)&&(!!l(A.Oa.Cross(R.directions[0],S.directions[0]),R,S)&&(!!l(A.Oa.Cross(R.directions[0],S.directions[1]),R,S)&&(!!l(A.Oa.Cross(R.directions[0],S.directions[2]),R,S)&&(!!l(A.Oa.Cross(R.directions[1],S.directions[0]),R,S)&&(!!l(A.Oa.Cross(R.directions[1],S.directions[1]),R,S)&&(!!l(A.Oa.Cross(R.directions[1],S.directions[2]),R,S)&&(!!l(A.Oa.Cross(R.directions[2],S.directions[0]),R,S)&&(!!l(A.Oa.Cross(R.directions[2],S.directions[1]),R,S)&&!!l(A.Oa.Cross(R.directions[2],S.directions[2]),R,S))))))))))))))}}V._TmpVector3=(0,S.e)(2,A.Oa.Zero)},12743:(P,a,R)=>{R.d(a,{c:()=>Z});var S=R(12423),A=R(12415);class Z{constructor(P,a,R){this.center=A.Oa.Zero(),this.centerWorld=A.Oa.Zero(),this.minimum=A.Oa.Zero(),this.maximum=A.Oa.Zero(),this.reConstruct(P,a,R)}reConstruct(P,a,R){this.minimum.A(P),this.maximum.A(a);const S=A.Oa.Distance(P,a);a.addToRef(P,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(R||A.Matrix.IdentityReadOnly)}scale(P){const a=this.radius*P,R=Z._TmpVector3,S=R[0].yj(a),A=this.center.subtractToRef(S,R[1]),p=this.center.addToRef(S,R[2]);return this.reConstruct(A,p,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){if(P.isIdentity())this.centerWorld.A(this.center),this.radiusWorld=this.radius;else{A.Oa.TransformCoordinatesToRef(this.center,P,this.centerWorld);const a=Z._TmpVector3[0];A.Oa.TransformNormalFromFloatsToRef(1,1,1,P,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius}}isInFrustum(P){const a=this.centerWorld,R=this.radiusWorld;for(let S=0;S<6;S++)if(P[S].dotCoordinate(a)<=-R)return!1;return!0}isCenterInFrustum(P){const a=this.centerWorld;for(let R=0;R<6;R++)if(P[R].dotCoordinate(a)<0)return!1;return!0}intersectsPoint(P){const a=A.Oa.DistanceSquared(this.centerWorld,P);return!(this.radiusWorld*this.radiusWorld<a)}static Intersects(P,a){const R=A.Oa.DistanceSquared(P.centerWorld,a.centerWorld),S=P.radiusWorld+a.radiusWorld;return!(S*S<R)}static CreateFromCenterAndRadius(P,a,R){this._TmpVector3[0].A(P),this._TmpVector3[1].Oj(0,0,a),this._TmpVector3[2].A(P),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Ul(this._TmpVector3[1]);const S=new Z(this._TmpVector3[0],this._TmpVector3[2]);return S._worldMatrix=R||A.Matrix.Identity(),S}}Z._TmpVector3=(0,S.e)(3,A.Oa.Zero)},12760:(P,a,R)=>{function S(P){-1===P.indexOf("vClipPlane")&&P.push("vClipPlane"),-1===P.indexOf("vClipPlane2")&&P.push("vClipPlane2"),-1===P.indexOf("vClipPlane3")&&P.push("vClipPlane3"),-1===P.indexOf("vClipPlane4")&&P.push("vClipPlane4"),-1===P.indexOf("vClipPlane5")&&P.push("vClipPlane5"),-1===P.indexOf("vClipPlane6")&&P.push("vClipPlane6")}function A(P,a,R){const S=!!(P.clipPlane??a.clipPlane),A=!!(P.clipPlane2??a.clipPlane2),Z=!!(P.clipPlane3??a.clipPlane3),p=!!(P.clipPlane4??a.clipPlane4),j=!!(P.clipPlane5??a.clipPlane5),U=!!(P.clipPlane6??a.clipPlane6);S&&R.push("#define CLIPPLANE"),A&&R.push("#define CLIPPLANE2"),Z&&R.push("#define CLIPPLANE3"),p&&R.push("#define CLIPPLANE4"),j&&R.push("#define CLIPPLANE5"),U&&R.push("#define CLIPPLANE6")}function Z(P,a,R){let S=!1;const A=!!(P.clipPlane??a.clipPlane),Z=!!(P.clipPlane2??a.clipPlane2),p=!!(P.clipPlane3??a.clipPlane3),j=!!(P.clipPlane4??a.clipPlane4),U=!!(P.clipPlane5??a.clipPlane5),Q=!!(P.clipPlane6??a.clipPlane6);return R.CLIPPLANE!==A&&(R.CLIPPLANE=A,S=!0),R.CLIPPLANE2!==Z&&(R.CLIPPLANE2=Z,S=!0),R.CLIPPLANE3!==p&&(R.CLIPPLANE3=p,S=!0),R.CLIPPLANE4!==j&&(R.CLIPPLANE4=j,S=!0),R.CLIPPLANE5!==U&&(R.CLIPPLANE5=U,S=!0),R.CLIPPLANE6!==Q&&(R.CLIPPLANE6=Q,S=!0),S}function p(P,a,R){let S=a.clipPlane??R.clipPlane;j(P,"vClipPlane",S),S=a.clipPlane2??R.clipPlane2,j(P,"vClipPlane2",S),S=a.clipPlane3??R.clipPlane3,j(P,"vClipPlane3",S),S=a.clipPlane4??R.clipPlane4,j(P,"vClipPlane4",S),S=a.clipPlane5??R.clipPlane5,j(P,"vClipPlane5",S),S=a.clipPlane6??R.clipPlane6,j(P,"vClipPlane6",S)}function j(P,a,R){R&&P.setFloat4(a,R.normal.x,R.normal.y,R.normal.z,R.d)}R.d(a,{c:()=>S,f:()=>p,g:()=>Z,h:()=>A})},12712:(P,a,R)=>{R.d(a,{d:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(P,a){this._defines[P]||(P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P),this._defines[P]=new Array),this._defines[P].push(a)}addCPUSkinningFallback(P,a){this._mesh=a,P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(P,a){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,P=P.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),a._bonesComputationForcedToCPU=!0;const R=this._mesh.GP();for(let P=0;P<R.meshes.length;P++){const S=R.meshes[P];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===a)S.computeBonesUsingShaders=!1;else if(S.Zj)for(const P of S.Zj){if(P.effect===a){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const a=this._defines[this._currentRank];if(a)for(let R=0;R<a.length;R++)P=P.replace("#define "+a[R],"");this._currentRank++}return P}}},12726:(P,a,R)=>{R.d(a,{e:()=>y});var S=R(12401),A=R(12408),Z=R(12225),p=R(12232),j=R(12277),U=R(12728),Q=R(12664),h=R(12248),l=R(12465),V=R(12538),f=R(12447);class O{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(P){this._func=P}get funcRef(){return this._funcRef}set funcRef(P){this._funcRef=P}get funcMask(){return this._funcMask}set funcMask(P){this._funcMask=P}get opStencilFail(){return this._opStencilFail}set opStencilFail(P){this._opStencilFail=P}get opDepthFail(){return this._opDepthFail}set opDepthFail(P){this._opDepthFail=P}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(P){this._opStencilDepthPass=P}get mask(){return this._mask}set mask(P){this._mask=P}get enabled(){return this._enabled}set enabled(P){this._enabled=P}getClassName(){return"MaterialStencilState"}copyTo(P){f.e.Clone((()=>P),this)}serialize(){return f.e.Serialize(this)}parse(P,a,R){f.e.Parse((()=>this),P,a,R)}}(0,S.d)([(0,A.x)()],O.prototype,"func",null),(0,S.d)([(0,A.x)()],O.prototype,"funcRef",null),(0,S.d)([(0,A.x)()],O.prototype,"funcMask",null),(0,S.d)([(0,A.x)()],O.prototype,"opStencilFail",null),(0,S.d)([(0,A.x)()],O.prototype,"opDepthFail",null),(0,S.d)([(0,A.x)()],O.prototype,"opStencilDepthPass",null),(0,S.d)([(0,A.x)()],O.prototype,"mask",null),(0,S.d)([(0,A.x)()],O.prototype,"enabled",null);var q=R(12757);class y{get _supportGlowLayer(){return!1}set _glowModeEnabled(P){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(P){if(this._alpha===P)return;const a=this._alpha;this._alpha=P,1!==a&&1!==P||this.BQ(y.MiscDirtyFlag+y.PrePassDirtyFlag)}get alpha(){return this._alpha}set fj(P){this._backFaceCulling!==P&&(this._backFaceCulling=P,this.BQ(y.TextureDirtyFlag))}get fj(){return this._backFaceCulling}set cullBackFaces(P){this._cullBackFaces!==P&&(this._cullBackFaces=P,this.BQ(y.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(P){this._blockDirtyMechanism!==P&&(this._blockDirtyMechanism=P,P||this.zl())}atomicMaterialsUpdate(P){this.blockDirtyMechanism=!0;try{P(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(P){this._onDisposeObserver&&this.Fp.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fp.add(P)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new p.b),this._onBindObservable}set onBind(P){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(P)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new p.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new p.b),this._onEffectCreatedObservable}set alphaMode(P){this._alphaMode!==P&&(this._alphaMode=P,this.BQ(y.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(P){this._needDepthPrePass!==P&&(this._needDepthPrePass=P,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(P){this._fogEnabled!==P&&(this._fogEnabled=P,this.BQ(y.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case y.WireFrameFillMode:case y.LineListDrawMode:case y.LineLoopDrawMode:case y.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(P){this.fillMode=P?y.WireFrameFillMode:y.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case y.PointFillMode:case y.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(P){this.fillMode=P?y.PointFillMode:y.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(P){this._fillMode!==P&&(this._fillMode=P,this.BQ(y.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){const a=this.GP().getEngine().getCaps().fragmentDepthSupported;P&&!a&&h.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=P&&a,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(P){this._drawWrapper=P}constructor(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Fp=new p.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.gp=new O,this._useUBO=!1,this._fillMode=y.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=P;const A=a||j.e.LastCreatedScene;A&&(this._scene=A,this._dirtyCallbacks={},this._forceGLSL=S,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=P||Z.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new V.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new Q.e(this._scene.getEngine(),void 0,void 0,P),this._useUBO=this.GP().getEngine().supportsUniformBuffers,this._createUniformBuffer(),R||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),y.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var P;const a=this.GP().getEngine();null===(P=this._uniformBuffer)||void 0===P||P.dispose(),a.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new Q.e(a,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new Q.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(P){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.zl(),this.checkReadyOnlyOnce=!0}unfreeze(){this.zl(),this.checkReadyOnlyOnce=!1}isReady(P,a){return!0}isReadyForSubMesh(P,a,R){const S=a.materialDefines;return!!S&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}GP(){return this._scene}_getEffectiveOrientation(P){return null!==this.sideOrientation?this.sideOrientation:P.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(P){this._transparencyMode!==P&&(this._transparencyMode=P,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===y.MATERIAL_ALPHABLEND||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===y.MATERIAL_ALPHATEST||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===y.MATERIAL_OPAQUE||this._transparencyMode===y.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsBlend:P.visibility<1||!this._disableAlphaBlending&&(P.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(P)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}zl(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.GP().meshes;for(const R of a)if(R.Zj)for(const a of R.Zj)if(a.BP()===this)for(const R of a._drawWrappers)R&&this._materialContext===R.materialContext&&(R._wasPreviouslyReady=!1,R._wasPreviouslyUsingInstances=null,R._forceRebindOnNextCall=P);P&&this.BQ(y.AllDirtyFlag)}_preBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.getEngine(),S=(null==a?this.sideOrientation:a)===y.ClockWiseSideOrientation;return R.enableEffect(P||this._getDrawWrapper()),R.setState(this.fj,this.zOffset,!1,S,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.gp,this.zOffsetUnits),S}bind(P,a){}buildUniformLayout(){const P=this._uniformBuffer;this._eventInfo.ubo=P,this._callbackPluginEventGeneric(8,this._eventInfo),P.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(P,a,R){const S=R._drawWrapper;this._eventInfo.subMesh=R,this._callbackPluginEventBindForSubMesh(this._eventInfo),S._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(P){}bindView(P){this._useUBO?this._needToBindSceneUbo=!0:P.setMatrix("view",this.GP().getViewMatrix())}bindViewProjection(P){this._useUBO?this._needToBindSceneUbo=!0:(P.setMatrix("viewProjection",this.GP().getTransformMatrix()),P.setMatrix("projection",this.GP().getProjectionMatrix()))}bindEyePosition(P,a){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(P,a)}_afterBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&a&&(this._needToBindSceneUbo=!1,(0,q.r)(a,this.GP().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=P?P.visibility:1,this._onBindObservable&&P&&this._onBindObservable.notifyObservers(P),this.disableDepthWrite){const P=this._scene.getEngine();this._cachedDepthWriteState=P.getDepthWrite(),P.setDepthWrite(!1)}if(this.disableColorWrite){const P=this._scene.getEngine();this._cachedColorWriteState=P.getColorWrite(),P.setColorWrite(!1)}if(0!==this.depthFunction){const P=this._scene.getEngine();this._cachedDepthFunctionState=P.getDepthFunction()||0,P.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(P){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=P,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(P){return null}_clonePlugins(P,a){const R={};if(this._serializePlugins(R),y._ParsePlugins(R,P,this._scene,a),this.pluginManager)for(const S of this.pluginManager._plugins){const a=P.pluginManager.getPlugin(S.name);a&&S.copyTo(a)}}getBindedMeshes(){if(this.meshMap){const P=[];for(const a in this.meshMap){const R=this.meshMap[a];R&&P.push(R)}return P}return this._scene.meshes.filter((P=>P.material===this))}forceCompilation(P,a,R,S){const A={clipPlane:!1,useInstances:!1,...R},Z=this.GP(),p=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const j=()=>{if(!this._scene||!this._scene.getEngine())return;const R=Z.clipPlane;if(A.clipPlane&&(Z.clipPlane=new l.d(0,0,0,1)),this._storeEffectOnSubMeshes){let R=!0,Z=null;if(P.Zj){const a=new U.b(0,0,0,0,0,P,void 0,!1,!1);a.materialDefines&&(a.materialDefines._renderId=-1),this.isReadyForSubMesh(P,a,A.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?Z=a.effect.getCompilationError():(R=!1,setTimeout(j,16)))}R&&(this.allowShaderHotSwapping=p,Z&&S&&S(Z),a&&a(this))}else this.isReady()?(this.allowShaderHotSwapping=p,a&&a(this)):setTimeout(j,16);A.clipPlane&&(Z.clipPlane=R)};j()}async forceCompilationAsync(P,a){return await new Promise(((R,S)=>{this.forceCompilation(P,(()=>{R()}),a,(P=>{S(P)}))}))}BQ(P){this.GP().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(y._DirtyCallbackArray.length=0,P&y.ImageProcessingDirtyFlag&&y._DirtyCallbackArray.push(y._ImageProcessingDirtyCallBack),P&y.TextureDirtyFlag&&y._DirtyCallbackArray.push(y._TextureDirtyCallBack),P&y.LightDirtyFlag&&y._DirtyCallbackArray.push(y._LightsDirtyCallBack),P&y.FresnelDirtyFlag&&y._DirtyCallbackArray.push(y._FresnelDirtyCallBack),P&y.AttributesDirtyFlag&&y._DirtyCallbackArray.push(y._AttributeDirtyCallBack),P&y.MiscDirtyFlag&&y._DirtyCallbackArray.push(y._MiscDirtyCallBack),P&y.PrePassDirtyFlag&&y._DirtyCallbackArray.push(y._PrePassDirtyCallBack),y._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(y._RunDirtyCallBacks),this.GP().resetCachedMaterial())}resetDrawCache(){const P=this.GP().meshes;for(const a of P)if(a.Zj)for(const P of a.Zj)P.BP()===this&&P.resetDrawCache()}_markAllSubMeshesAsDirty(P){const a=this.GP();if(a.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const R=a.meshes;for(const S of R)if(S.Zj)for(const R of S.Zj){if((R.BP()||(a._hasDefaultMaterial?a.defaultMaterial:null))===this)for(const a of R._drawWrappers)a&&a.defines&&a.defines.markAllAsDirty&&this._materialContext===a.materialContext&&P(a.defines)}}_markScenePrePassDirty(){if(this.GP().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const P=this.GP().enablePrePassRenderer();P&&P.BQ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(y._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(y._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(y._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(y._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(y._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(y._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(y._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(y._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(y._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(y._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const P=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Fp.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(P)}))}}setPrePassRenderer(P){return!1}dispose(P,a,R){const S=this.GP();if(S.stopAnimation(this),S.freeProcessedMaterials(),S.removeMaterial(this),this._eventInfo.forceDisposeTextures=a,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const P=this._parentContainer.materials.indexOf(this);P>-1&&this._parentContainer.materials.splice(P,1),this._parentContainer=null}if(!0!==R)if(this.meshMap)for(const A in this.meshMap){const P=this.meshMap[A];this._disposeMeshResources(P)}else{const P=S.meshes;for(const a of P)this._disposeMeshResources(a)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Fp.notifyObservers(this),this.Fp.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(P){if(!P)return;const a=P.lj,R=P._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(P.Zj&&R)for(const A of P.Zj){const P=A._drawWrappers;for(let Z=0;Z<P.length;Z++){var S;const p=null===(S=P[Z])||void 0===S?void 0:S.effect;if(!p)continue;R[Z]===this&&(null===a||void 0===a||a._releaseVertexArrayObject(p),A._removeDrawWrapper(Z,!0,!0))}}}else null===a||void 0===a||a._releaseVertexArrayObject(this._drawWrapper.effect);P.material!==this||P.sourceMesh||(P.material=null)}serialize(){const P=f.e.Serialize(this);return P.gp=this.gp.serialize(),P.uniqueId=this.uniqueId,this._serializePlugins(P),P}_serializePlugins(P){if(P.plugins={},this.pluginManager)for(const a of this.pluginManager._plugins)a.doNotSerialize||(P.plugins[a.getClassName()]=a.serialize())}static Parse(P,a,R){if(P.customType){if("BABYLON.PBRMaterial"===P.customType&&P.overloadedAlbedo&&(P.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else P.customType="BABYLON.StandardMaterial";const S=Z.Tools.Instantiate(P.customType).Parse(P,a,R);return S._loadedUniqueId=P.uniqueId,S}static _ParsePlugins(P,a,R,S){if(P.plugins)for(const j in P.plugins){var A,p;const U=P.plugins[j];let Q=null===(A=a.pluginManager)||void 0===A?void 0:A.getPlugin(U.name);if(!Q){const P=Z.Tools.Instantiate("BABYLON."+j);P&&(Q=new P(a))}null===(p=Q)||void 0===p||p.parse(U,R,S)}}}y.TriangleFillMode=0,y.WireFrameFillMode=1,y.PointFillMode=2,y.PointListDrawMode=3,y.LineListDrawMode=4,y.LineLoopDrawMode=5,y.LineStripDrawMode=6,y.TriangleStripDrawMode=7,y.TriangleFanDrawMode=8,y.ClockWiseSideOrientation=0,y.CounterClockWiseSideOrientation=1,y.ImageProcessingDirtyFlag=64,y.TextureDirtyFlag=1,y.LightDirtyFlag=2,y.FresnelDirtyFlag=4,y.AttributesDirtyFlag=8,y.MiscDirtyFlag=16,y.PrePassDirtyFlag=32,y.AllDirtyFlag=127,y.MATERIAL_OPAQUE=0,y.MATERIAL_ALPHATEST=1,y.MATERIAL_ALPHABLEND=2,y.MATERIAL_ALPHATESTANDBLEND=3,y.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,y.MATERIAL_NORMALBLENDMETHOD_RNM=1,y.OnEventObservable=new p.b,y._AllDirtyCallBack=P=>P.markAllAsDirty(),y._ImageProcessingDirtyCallBack=P=>P.markAsImageProcessingDirty(),y._TextureDirtyCallBack=P=>P.markAsTexturesDirty(),y._FresnelDirtyCallBack=P=>P.markAsFresnelDirty(),y._MiscDirtyCallBack=P=>P.markAsMiscDirty(),y._PrePassDirtyCallBack=P=>P.markAsPrePassDirty(),y._LightsDirtyCallBack=P=>P.markAsLightDirty(),y._AttributeDirtyCallBack=P=>P.markAsAttributesDirty(),y._FresnelAndMiscDirtyCallBack=P=>{y._FresnelDirtyCallBack(P),y._MiscDirtyCallBack(P)},y._TextureAndMiscDirtyCallBack=P=>{y._TextureDirtyCallBack(P),y._MiscDirtyCallBack(P)},y._DirtyCallbackArray=[],y._RunDirtyCallBacks=P=>{for(const a of y._DirtyCallbackArray)a(P)},(0,S.d)([(0,A.x)()],y.prototype,"id",void 0),(0,S.d)([(0,A.x)()],y.prototype,"uniqueId",void 0),(0,S.d)([(0,A.x)()],y.prototype,"name",void 0),(0,S.d)([(0,A.x)()],y.prototype,"metadata",void 0),(0,S.d)([(0,A.x)()],y.prototype,"checkReadyOnEveryCall",void 0),(0,S.d)([(0,A.x)()],y.prototype,"checkReadyOnlyOnce",void 0),(0,S.d)([(0,A.x)()],y.prototype,"state",void 0),(0,S.d)([(0,A.x)("alpha")],y.prototype,"_alpha",void 0),(0,S.d)([(0,A.x)("fj")],y.prototype,"_backFaceCulling",void 0),(0,S.d)([(0,A.x)("cullBackFaces")],y.prototype,"_cullBackFaces",void 0),(0,S.d)([(0,A.x)()],y.prototype,"sideOrientation",void 0),(0,S.d)([(0,A.x)("alphaMode")],y.prototype,"_alphaMode",void 0),(0,S.d)([(0,A.x)()],y.prototype,"_needDepthPrePass",void 0),(0,S.d)([(0,A.x)()],y.prototype,"disableDepthWrite",void 0),(0,S.d)([(0,A.x)()],y.prototype,"disableColorWrite",void 0),(0,S.d)([(0,A.x)()],y.prototype,"forceDepthWrite",void 0),(0,S.d)([(0,A.x)()],y.prototype,"depthFunction",void 0),(0,S.d)([(0,A.x)()],y.prototype,"separateCullingPass",void 0),(0,S.d)([(0,A.x)("fogEnabled")],y.prototype,"_fogEnabled",void 0),(0,S.d)([(0,A.x)()],y.prototype,"pointSize",void 0),(0,S.d)([(0,A.x)()],y.prototype,"zOffset",void 0),(0,S.d)([(0,A.x)()],y.prototype,"zOffsetUnits",void 0),(0,S.d)([(0,A.x)()],y.prototype,"pointsCloud",null),(0,S.d)([(0,A.x)()],y.prototype,"fillMode",null),(0,S.d)([(0,A.x)()],y.prototype,"useLogarithmicDepth",null),(0,S.d)([(0,A.x)()],y.prototype,"transparencyMode",null)},12757:(P,a,R)=>{R.d(a,{B:()=>G,C:()=>H,E:()=>f,I:()=>V,M:()=>u,N:()=>c,R:()=>D,V:()=>t,X:()=>N,Z:()=>Y,_:()=>J,bb:()=>n,cb:()=>B,d:()=>x,db:()=>O,h:()=>l,j:()=>d,m:()=>h,q:()=>q,r:()=>y,v:()=>W,x:()=>mP,y:()=>k});var S=R(12248),A=R(12456),Z=R(12277),p=R(12706),j=R(12760);const U=A.Wa.Black(),Q={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function h(P,a,R){if(!P||P.LOGARITHMICDEPTH||P.indexOf&&P.indexOf("LOGARITHMICDEPTH")>=0){const P=R.activeCamera;1===P.mode&&S.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),a.setFloat("logarithmicDepthConstant",2/(Math.log(P.maxZ+1)/Math.LN2))}}function l(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];R&&P.fogEnabled&&(!a||a.applyFog)&&0!==P.fogMode&&(R.setFloat4("vFogInfos",P.fogMode,P.fogStart,P.fogEnd,P.fogDensity),S?(P.fogColor.toLinearSpaceToRef(U,P.getEngine().useExactSrgbConversions),R.setColor3("vFogColor",U)):R.setColor3("vFogColor",P.fogColor))}function V(P,a,R,S,A,Z,p,j,U,h){const l=P.numMaxInfluencers||P.numInfluencers;return l<=0?0:(a.push("#define MORPHTARGETS"),P.hasPositions&&a.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),P.hasNormals&&a.push("#define MORPHTARGETTEXTURE_HASNORMALS"),P.hasTangents&&a.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),P.hasUVs&&a.push("#define MORPHTARGETTEXTURE_HASUVS"),P.hasUV2s&&a.push("#define MORPHTARGETTEXTURE_HASUV2S"),P.hasColors&&a.push("#define MORPHTARGETTEXTURE_HASCOLORS"),P.supportsPositions&&A&&a.push("#define MORPHTARGETS_POSITION"),P.supportsNormals&&Z&&a.push("#define MORPHTARGETS_NORMAL"),P.supportsTangents&&p&&a.push("#define MORPHTARGETS_TANGENT"),P.supportsUVs&&j&&a.push("#define MORPHTARGETS_UV"),P.supportsUV2s&&U&&a.push("#define MORPHTARGETS_UV2"),P.supportsColors&&h&&a.push("#define MORPHTARGETS_COLOR"),a.push("#define NUM_MORPH_INFLUENCERS "+l),P.isUsingTextureForTargets&&a.push("#define MORPHTARGETS_TEXTURE"),Q.NUM_MORPH_INFLUENCERS=l,Q.NORMAL=Z,Q.TANGENT=p,Q.UV=j,Q.UV2=U,Q.COLOR=h,f(R,S,Q,A),l)}function f(P,a,R){let A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=R.NUM_MORPH_INFLUENCERS;if(p>0&&Z.e.LastCreatedEngine){const j=Z.e.LastCreatedEngine.getCaps().maxVertexAttribs,U=a.morphTargetManager;if(null!==U&&void 0!==U&&U.isUsingTextureForTargets)return;const Q=U&&U.supportsPositions&&A,h=U&&U.supportsNormals&&R.NORMAL,l=U&&U.supportsTangents&&R.TANGENT,V=U&&U.supportsUVs&&R.UV1,f=U&&U.supportsUV2s&&R.UV2,O=U&&U.supportsColors&&R.VERTEXCOLOR;for(let R=0;R<p;R++)Q&&P.push("position"+R),h&&P.push("normal"+R),l&&P.push("tangent"+R),V&&P.push("uv_"+R),f&&P.push("uv2_"+R),O&&P.push("color"+R),P.length>j&&S.c.Error("Cannot add more vertex attributes for mesh "+a.name)}}function O(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P.push("world0"),P.push("world1"),P.push("world2"),P.push("world3"),a&&(P.push("previousWorld0"),P.push("previousWorld1"),P.push("previousWorld2"),P.push("previousWorld3"))}function q(P,a){const R=P.morphTargetManager;P&&R&&a.setFloatArray("morphTargetInfluences",R.influences)}function y(P,a){a.bindToEffect(P,"Scene")}function t(P,a,R){a._needUVs=!0,a[R]=!0,P.optimizeUVAllocation&&P.getTextureMatrix().isIdentityAs3x2()?(a[R+"DIRECTUV"]=P.coordinatesIndex+1,a["MAINUV"+(P.coordinatesIndex+1)]=!0):a[R+"DIRECTUV"]=0}function W(P,a,R){const S=P.getTextureMatrix();a.Qj(R+"Matrix",S)}function k(P,a,R){R.BAKED_VERTEX_ANIMATION_TEXTURE&&R.INSTANCES&&P.push("bakedVertexAnimationSettingsInstanced")}function x(P,a,R){var S;if(a&&P&&(P.computeBonesUsingShaders&&a._bonesComputationForcedToCPU&&(P.computeBonesUsingShaders=!1),P.useBones&&P.computeBonesUsingShaders&&P.skeleton)){const A=P.skeleton;if(A.isUsingTextureForMatrices&&a.getUniformIndex("boneTextureWidth")>-1){const R=A.getTransformMatrixTexture(P);a.setTexture("boneSampler",R),a.setFloat("boneTextureWidth",4*(A.bones.length+1))}else{const Z=A.getTransformMatrices(P);Z&&(a.setMatrices("mBones",Z),R&&P.GP().prePassRenderer&&P.GP().prePassRenderer.getIndex(2)&&(R.previousBones[P.uniqueId]||(R.previousBones[P.uniqueId]=Z.slice()),a.setMatrices("mPreviousBones",R.previousBones[P.uniqueId]),S=Z,R.previousBones[P.uniqueId].set(S)))}}}function s(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];P._bindLight(a,R,S,A,Z)}function d(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Z=Math.min(a.lightSources.length,A);for(let p=0;p<Z;p++){s(a.lightSources[p],p,P,R,"boolean"===typeof S?S:S.SPECULARTERM,a.receiveShadows)}}function G(P,a,R,S){R.NUM_BONE_INFLUENCERS>0&&(S.addCPUSkinningFallback(0,a),P.push("matricesIndices"),P.push("matricesWeights"),R.NUM_BONE_INFLUENCERS>4&&(P.push("matricesIndicesExtra"),P.push("matricesWeightsExtra")))}function H(P,a){(a.INSTANCES||a.THIN_INSTANCES)&&O(P,!!a.PREPASS_VELOCITY),a.INSTANCESCOLOR&&P.push("instanceColor")}function mP(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=0;for(let Z=0;Z<R&&P["LIGHT"+Z];Z++)Z>0&&(A=S+Z,a.addFallback(A,"LIGHT"+Z)),P.SHADOWS||(P["SHADOW"+Z]&&a.addFallback(S,"SHADOW"+Z),P["SHADOWPCF"+Z]&&a.addFallback(S,"SHADOWPCF"+Z),P["SHADOWPCSS"+Z]&&a.addFallback(S,"SHADOWPCSS"+Z),P["SHADOWPOISSON"+Z]&&a.addFallback(S,"SHADOWPOISSON"+Z),P["SHADOWESM"+Z]&&a.addFallback(S,"SHADOWESM"+Z),P["SHADOWCLOSEESM"+Z]&&a.addFallback(S,"SHADOWCLOSEESM"+Z));return A++}function N(P,a,R,S,A,Z,p){let j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];p._areMiscDirty&&(p.LOGARITHMICDEPTH=R,p.POINTSIZE=S,p.FOG=A&&function(P,a){return a.fogEnabled&&P.applyFog&&0!==a.fogMode}(P,a),p.NONUNIFORMSCALING=P.nonUniformScaling,p.ALPHATEST=Z,p.DECAL_AFTER_DETAIL=j)}function D(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R._areLightsDirty)return R._needNormals;let p=0;const j={needNormals:R._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(P.lightsEnabled&&!Z)for(const Q of a.lightSources)if(L(P,a,Q,p,R,S,j),p++,p===A)break;R.SPECULARTERM=j.specularEnabled,R.SHADOWS=j.shadowEnabled;for(let Q=p;Q<A;Q++)void 0!==R["LIGHT"+Q]&&(R["LIGHT"+Q]=!1,R["HEMILIGHT"+Q]=!1,R["POINTLIGHT"+Q]=!1,R["DIRLIGHT"+Q]=!1,R["SPOTLIGHT"+Q]=!1,R["AREALIGHT"+Q]=!1,R["SHADOW"+Q]=!1,R["SHADOWCSM"+Q]=!1,R["SHADOWCSMDEBUG"+Q]=!1,R["SHADOWCSMNUM_CASCADES"+Q]=!1,R["SHADOWCSMUSESHADOWMAXZ"+Q]=!1,R["SHADOWCSMNOBLEND"+Q]=!1,R["SHADOWCSM_RIGHTHANDED"+Q]=!1,R["SHADOWPCF"+Q]=!1,R["SHADOWPCSS"+Q]=!1,R["SHADOWPOISSON"+Q]=!1,R["SHADOWESM"+Q]=!1,R["SHADOWCLOSEESM"+Q]=!1,R["SHADOWCUBE"+Q]=!1,R["SHADOWLOWQUALITY"+Q]=!1,R["SHADOWMEDIUMQUALITY"+Q]=!1);const U=P.getEngine().getCaps();return void 0===R.SHADOWFLOAT&&(j.needRebuild=!0),R.SHADOWFLOAT=j.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),R.LIGHTMAPEXCLUDED=j.lightmapMode,j.needRebuild&&R.rebuild(),j.needNormals}function L(P,a,R,S,A,Z,j){switch(j.needNormals=!0,void 0===A["LIGHT"+S]&&(j.needRebuild=!0),A["LIGHT"+S]=!0,A["SPOTLIGHT"+S]=!1,A["HEMILIGHT"+S]=!1,A["POINTLIGHT"+S]=!1,A["DIRLIGHT"+S]=!1,A["AREALIGHT"+S]=!1,R.prepareLightSpecificDefines(A,S),A["LIGHT_FALLOFF_PHYSICAL"+S]=!1,A["LIGHT_FALLOFF_GLTF"+S]=!1,A["LIGHT_FALLOFF_STANDARD"+S]=!1,R.falloffType){case p.d.FALLOFF_GLTF:A["LIGHT_FALLOFF_GLTF"+S]=!0;break;case p.d.FALLOFF_PHYSICAL:A["LIGHT_FALLOFF_PHYSICAL"+S]=!0;break;case p.d.FALLOFF_STANDARD:A["LIGHT_FALLOFF_STANDARD"+S]=!0}if(Z&&!R.Zh.equalsFloats(0,0,0)&&(j.specularEnabled=!0),A["SHADOW"+S]=!1,A["SHADOWCSM"+S]=!1,A["SHADOWCSMDEBUG"+S]=!1,A["SHADOWCSMNUM_CASCADES"+S]=!1,A["SHADOWCSMUSESHADOWMAXZ"+S]=!1,A["SHADOWCSMNOBLEND"+S]=!1,A["SHADOWCSM_RIGHTHANDED"+S]=!1,A["SHADOWPCF"+S]=!1,A["SHADOWPCSS"+S]=!1,A["SHADOWPOISSON"+S]=!1,A["SHADOWESM"+S]=!1,A["SHADOWCLOSEESM"+S]=!1,A["SHADOWCUBE"+S]=!1,A["SHADOWLOWQUALITY"+S]=!1,A["SHADOWMEDIUMQUALITY"+S]=!1,a&&a.receiveShadows&&P.shadowsEnabled&&R.shadowEnabled){const a=R.getShadowGenerator(P.activeCamera)??R.getShadowGenerator();if(a){const P=a.getShadowMap();P&&P.renderList&&P.renderList.length>0&&(j.shadowEnabled=!0,a.prepareDefines(A,S))}}R.lightmapMode!=p.d.LIGHTMAP_DEFAULT?(j.lightmapMode=!0,A["LIGHTMAPEXCLUDED"+S]=!0,A["LIGHTMAPNOSPECULAR"+S]=R.lightmapMode==p.d.LIGHTMAP_SHADOWSONLY):(A["LIGHTMAPEXCLUDED"+S]=!1,A["LIGHTMAPNOSPECULAR"+S]=!1)}function c(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(P,a){let R=!1;if(P.activeCamera){const S=a.CAMERA_ORTHOGRAPHIC?1:0,A=a.CAMERA_PERSPECTIVE?1:0,Z=1===P.activeCamera.mode?1:0,p=0===P.activeCamera.mode?1:0;(S^Z||A^p)&&(a.CAMERA_ORTHOGRAPHIC=1===Z,a.CAMERA_PERSPECTIVE=1===p,R=!0)}return R}(P,S);!1!==Z&&(U=(0,j.g)(R,P,S)),S.DEPTHPREPASS!==!a.getColorWrite()&&(S.DEPTHPREPASS=!S.DEPTHPREPASS,U=!0),S.INSTANCES!==A&&(S.INSTANCES=A,U=!0),S.THIN_INSTANCES!==p&&(S.THIN_INSTANCES=p,U=!0),U&&S.markAsUnprocessed()}function u(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!a._areAttributesDirty&&a._needNormals===a._normals&&a._needUVs===a._uvs)return!1;a._normals=a._needNormals,a._uvs=a._needUVs,a.NORMAL=a._needNormals&&P.isVerticesDataPresent("normal"),a._needNormals&&P.isVerticesDataPresent("tangent")&&(a.TANGENT=!0);for(let j=1;j<=6;++j)a["UV"+j]=!!a._needUVs&&P.isVerticesDataPresent(`uv${1===j?"":j}`);if(R){const R=P.useVertexColors&&P.isVerticesDataPresent("color");a.VERTEXCOLOR=R,a.VERTEXALPHA=P.hasVertexAlpha&&R&&Z}return P.isVerticesDataPresent("instanceColor")&&(P.hasInstances||P.hasThinInstances)&&(a.INSTANCESCOLOR=!0),S&&function(P,a){if(P.useBones&&P.computeBonesUsingShaders&&P.skeleton){a.NUM_BONE_INFLUENCERS=P.numBoneInfluencers;const R=void 0!==a.BONETEXTURE;if(P.skeleton.isUsingTextureForMatrices&&R)a.BONETEXTURE=!0;else{a.BonesPerMesh=P.skeleton.bones.length+1,a.BONETEXTURE=!R&&void 0;const S=P.GP().prePassRenderer;if(S&&S.enabled){const R=-1===S.excludedSkinnedMesh.indexOf(P);a.BONES_VELOCITY_ENABLED=R}}}else a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,void 0!==a.BONETEXTURE&&(a.BONETEXTURE=!1)}(P,a),A&&function(P,a){const R=P.morphTargetManager;R?(a.MORPHTARGETS_UV=R.supportsUVs&&a.UV1,a.MORPHTARGETS_UV2=R.supportsUV2s&&a.UV2,a.MORPHTARGETS_TANGENT=R.supportsTangents&&a.TANGENT,a.MORPHTARGETS_NORMAL=R.supportsNormals&&a.NORMAL,a.MORPHTARGETS_POSITION=R.supportsPositions,a.MORPHTARGETS_COLOR=R.supportsColors,a.MORPHTARGETTEXTURE_HASUVS=R.hasUVs,a.MORPHTARGETTEXTURE_HASUV2S=R.hasUV2s,a.MORPHTARGETTEXTURE_HASTANGENTS=R.hasTangents,a.MORPHTARGETTEXTURE_HASNORMALS=R.hasNormals,a.MORPHTARGETTEXTURE_HASPOSITIONS=R.hasPositions,a.MORPHTARGETTEXTURE_HASCOLORS=R.hasColors,a.NUM_MORPH_INFLUENCERS=R.numMaxInfluencers||R.numInfluencers,a.MORPHTARGETS=a.NUM_MORPH_INFLUENCERS>0,a.MORPHTARGETS_TEXTURE=R.isUsingTextureForTargets):(a.MORPHTARGETS_UV=!1,a.MORPHTARGETS_UV2=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_POSITION=!1,a.MORPHTARGETS_COLOR=!1,a.MORPHTARGETTEXTURE_HASUVS=!1,a.MORPHTARGETTEXTURE_HASUV2S=!1,a.MORPHTARGETTEXTURE_HASTANGENTS=!1,a.MORPHTARGETTEXTURE_HASNORMALS=!1,a.MORPHTARGETTEXTURE_HASPOSITIONS=!1,a.MORPHTARGETTEXTURE_HAS_COLORS=!1,a.MORPHTARGETS=!1,a.NUM_MORPH_INFLUENCERS=0)}(P,a),p&&function(P,a){const R=P.bakedVertexAnimationManager;a.BAKED_VERTEX_ANIMATION_TEXTURE=!(!R||!R.isEnabled)}(P,a),!0}function Y(P,a){if(P.activeCamera){const R=a.MULTIVIEW;a.MULTIVIEW=null!==P.activeCamera.outputRenderTarget&&P.activeCamera.outputRenderTarget.getViewCount()>1,a.MULTIVIEW!=R&&a.markAsUnprocessed()}}function J(P,a,R){const S=a.ORDER_INDEPENDENT_TRANSPARENCY,A=a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;a.ORDER_INDEPENDENT_TRANSPARENCY=P.useOrderIndependentTransparency&&R,a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!P.getEngine().getCaps().textureFloatLinearFiltering,S===a.ORDER_INDEPENDENT_TRANSPARENCY&&A===a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||a.markAsUnprocessed()}function n(P,a,R){const S=a.PREPASS;if(!a._arePrePassDirty)return;const A=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(P.prePassRenderer&&P.prePassRenderer.enabled&&R){a.PREPASS=!0,a.SCENE_MRT_COUNT=P.prePassRenderer.mrtCount,a.PREPASS_NORMAL_WORLDSPACE=P.prePassRenderer.generateNormalsInWorldSpace,a.PREPASS_COLOR=!0,a.PREPASS_COLOR_INDEX=0;for(let R=0;R<A.length;R++){const S=P.prePassRenderer.getIndex(A[R].type);-1!==S?(a[A[R].define]=!0,a[A[R].index]=S):a[A[R].define]=!1}}else{a.PREPASS=!1;for(let P=0;P<A.length;P++)a[A[P].define]=!1}a.PREPASS!=S&&(a.markAsUnprocessed(),a.markAsImageProcessingDirty())}function b(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];A&&A.push("Light"+P),Z||(a.push("vLightData"+P,"vLightDiffuse"+P,"vLightSpecular"+P,"vLightDirection"+P,"vLightWidth"+P,"vLightHeight"+P,"vLightFalloff"+P,"vLightGround"+P,"lightMatrix"+P,"shadowsInfo"+P,"depthValues"+P),R.push("shadowTexture"+P),R.push("depthTexture"+P),a.push("viewFrustumZ"+P,"cascadeBlendFactor"+P,"lightSizeUVCorrection"+P,"depthCorrection"+P,"penumbraDarkness"+P,"frustumLengths"+P),S&&(R.push("projectionLightTexture"+P),a.push("textureProjectionMatrix"+P)),p&&R.push("iesLightTexture"+P))}function B(P,a,R){let S,A,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(P.uniformsNames){const p=P;S=p.uniformsNames,A=p.uniformBuffersNames,a=p.samplers,R=p.defines,Z=p.maxSimultaneousLights||0}else S=P,a||(a=[]);for(let p=0;p<Z&&R["LIGHT"+p];p++)b(p,S,a,R["PROJECTEDLIGHTTEXTURE"+p],A,!1,R["IESLIGHTTEXTURE"+p]);R.NUM_MORPH_INFLUENCERS&&(S.push("morphTargetInfluences"),S.push("morphTargetCount")),R.BAKED_VERTEX_ANIMATION_TEXTURE&&(S.push("bakedVertexAnimationSettings"),S.push("bakedVertexAnimationTextureSizeInverted"),S.push("bakedVertexAnimationTime"),a.push("bakedVertexAnimationTexture"))}},12720:(P,a,R)=>{R.d(a,{e:()=>Z});var S=R(12415),A=R(12726);class Z extends A.e{constructor(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(P,a,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.Matrix,this._storeEffectOnSubMeshes=R}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(P,a){return!!P&&(!this._storeEffectOnSubMeshes||(!P.Zj||0===P.Zj.length||this.isReadyForSubMesh(P,P.Zj[0],a)))}_isReadyForSubMesh(P){const a=P.materialDefines;return!(this.checkReadyOnEveryCall||!P.effect||!a||a._renderId!==this.GP().getRenderId())}bindOnlyWorldMatrix(P){this._activeEffect.setMatrix("world",P)}bindOnlyNormalMatrix(P){this._activeEffect.setMatrix("normalMatrix",P)}bind(P,a){a&&this.bindForSubMesh(P,a,a.Zj[0])}_afterBind(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0;super._afterBind(P,a,R),this.GP()._cachedEffect=a,R?R._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return R._drawWrapper._forceRebindOnNextCall||P.isCachedMaterialInvalid(this,a,S)}dispose(P,a,R){this._activeEffect=void 0,super.dispose(P,a,R)}}},12748:(P,a,R)=>{R.d(a,{c:()=>j,g:()=>U});var S=R(12401),A=R(12415),Z=R(12408);class p{static extractMinAndMaxIndexed(P,a,R,S,A,Z){for(let p=R;p<R+S;p++){const R=3*a[p],S=P[R],j=P[R+1],U=P[R+2];A.minimizeInPlaceFromFloats(S,j,U),Z.maximizeInPlaceFromFloats(S,j,U)}}static extractMinAndMax(P,a,R,S,A,Z){for(let p=a,j=a*S;p<a+R;p++,j+=S){const a=P[j],R=P[j+1],S=P[j+2];A.minimizeInPlaceFromFloats(a,R,S),Z.maximizeInPlaceFromFloats(a,R,S)}}}function j(P,a,R,S){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=new A.Oa(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new A.Oa(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p.extractMinAndMaxIndexed(P,a,R,S,j,U),Z&&(j.x-=j.x*Z.x+Z.y,j.y-=j.y*Z.x+Z.y,j.z-=j.z*Z.x+Z.y,U.x+=U.x*Z.x+Z.y,U.y+=U.y*Z.x+Z.y,U.z+=U.z*Z.x+Z.y),{minimum:j,maximum:U}}function U(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0;const j=new A.Oa(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new A.Oa(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Z||(Z=3),p.extractMinAndMax(P,a,R,Z,j,U),S&&(j.x-=j.x*S.x+S.y,j.y-=j.y*S.x+S.y,j.z-=j.z*S.x+S.y,U.x+=U.x*S.x+S.y,U.y+=U.y*S.x+S.y,U.z+=U.z*S.x+S.y),{minimum:j,maximum:U}}(0,S.d)([Z.d.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S,A]=a;return!Array.isArray(S)&&!Array.isArray(A)}))],p,"extractMinAndMaxIndexed",null),(0,S.d)([Z.d.filter((function(){for(var P=arguments.length,a=new Array(P),R=0;R<P;R++)a[R]=arguments[R];let[S]=a;return!Array.isArray(S)}))],p,"extractMinAndMax",null)},12728:(P,a,R)=>{R.d(a,{b:()=>U});var S=R(12489),A=R(12730),Z=R(12735),p=R(12748),j=R(12538);class U{get materialDefines(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(P=this._getDrawWrapper())||void 0===P?void 0:P.defines}set materialDefines(P){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=P}_getDrawWrapper(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P=P??this._engine.currentRenderPassId;let R=this._drawWrappers[P];return!R&&a&&(this._drawWrappers[P]=R=new j.d(this._mesh.GP().getEngine())),R}_removeDrawWrapper(P){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var R;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(R=this._drawWrappers[P])||void 0===R||R.dispose(a));this._drawWrappers[P]=void 0}get effect(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(P=this._getDrawWrapper())||void 0===P?void 0:P.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(P){this._mainDrawWrapperOverride=P}setEffect(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this._drawWrapper;A.setEffect(P,a,S),void 0!==R&&(A.materialContext=R),P||(A.defines=null,A.materialContext=void 0)}resetDrawCache(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==P)return void this._removeDrawWrapper(P,!0,a);for(const P of this._drawWrappers)null===P||void 0===P||P.dispose(a)}this._drawWrappers=[]}static AddToMesh(P,a,R,S,A,Z,p){return new U(P,a,R,S,A,Z,p,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(P,a,R,S,A,Z,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=P,this.verticesStart=a,this.verticesCount=R,this.indexStart=S,this.indexCount=A,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Z,this._renderingMesh=p||Z,U&&Z.Zj.push(this),this._engine=this._mesh.GP().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Z.Zj.length-1,j&&(this.refreshBoundingInfo(),Z.hj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(P){return this._boundingInfo=P,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const P=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return P||this._renderingMesh}BP(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!a)return P&&this._mesh.GP()._hasDefaultMaterial?this._mesh.GP().defaultMaterial:null;if(this._isMultiMaterial(a)){const P=a.getSubMaterial(this.materialIndex);return this._currentMaterial!==P&&(this._currentMaterial=P,this.resetDrawCache()),P}return a}_isMultiMaterial(P){return void 0!==P.getSubMaterial}refreshBoundingInfo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.lj)return this;if(P||(P=this._renderingMesh.getVerticesData(S.i.PositionKind)),!P)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const a=this._renderingMesh.Vj();let R;if(0===this.indexStart&&this.indexCount===a.length){const P=this._renderingMesh.getBoundingInfo();R={minimum:P.minimum.clone(),maximum:P.maximum.clone()}}else R=(0,p.c)(P,a,this.indexStart,this.indexCount,this._renderingMesh.lj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new Z.d(R.minimum,R.maximum),this}_checkCollision(P){return this.getBoundingInfo()._checkCollision(P)}updateBoundingInfo(P){let a=this.getBoundingInfo();return a||(this.refreshBoundingInfo(),a=this.getBoundingInfo()),a&&a.update(P),this}isInFrustum(P){const a=this.getBoundingInfo();return!!a&&a.isInFrustum(P,this._mesh.sl)}isCompletelyInFrustum(P){const a=this.getBoundingInfo();return!!a&&a.isCompletelyInFrustum(P)}render(P){return this._renderingMesh.render(this,P,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(P,a){if(!this._linesIndexBuffer){const R=6*Math.floor(this.indexCount/3),S=this.verticesStart+this.verticesCount>65535?new Uint32Array(R):new Uint16Array(R);let A=0;if(0===P.length)for(let P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)S[A++]=P,S[A++]=P+1,S[A++]=P+1,S[A++]=P+2,S[A++]=P+2,S[A++]=P;else for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)S[A++]=P[a],S[A++]=P[a+1],S[A++]=P[a+1],S[A++]=P[a+2],S[A++]=P[a+2],S[A++]=P[a];this._linesIndexBuffer=a.createIndexBuffer(S),this._linesIndexCount=S.length}return this._linesIndexBuffer}canIntersects(P){const a=this.getBoundingInfo();return!!a&&P.intersectsBox(a.boundingBox)}intersects(P,a,R,S,A){const Z=this.BP();if(!Z)return null;let p=3,j=!1;switch(Z.fillMode){case 3:case 5:case 6:case 8:return null;case 7:p=1,j=!0}return 4===Z.fillMode?R.length?this._intersectLines(P,a,R,this._mesh.intersectionThreshold,S):this._intersectUnIndexedLines(P,a,R,this._mesh.intersectionThreshold,S):!R.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(P,a,R,S,A):this._intersectTriangles(P,a,R,p,j,S,A)}_intersectLines(P,a,R,S,Z){let p=null;for(let j=this.indexStart;j<this.indexStart+this.indexCount;j+=2){const U=a[R[j]],Q=a[R[j+1]],h=P.intersectionSegment(U,Q,S);if(!(h<0)&&((Z||!p||h<p.distance)&&(p=new A.b(null,null,h),p.faceId=j/2,Z)))break}return p}_intersectUnIndexedLines(P,a,R,S,Z){let p=null;for(let j=this.verticesStart;j<this.verticesStart+this.verticesCount;j+=2){const R=a[j],U=a[j+1],Q=P.intersectionSegment(R,U,S);if(!(Q<0)&&((Z||!p||Q<p.distance)&&(p=new A.b(null,null,Q),p.faceId=j/2,Z)))break}return p}_intersectTriangles(P,a,R,S,A,Z,p){let j=null,U=-1;for(let Q=this.indexStart;Q<this.indexStart+this.indexCount-(3-S);Q+=S){U++;const S=R[Q],h=R[Q+1],l=R[Q+2];if(A&&4294967295===l){Q+=2;continue}const V=a[S],f=a[h],O=a[l];if(!V||!f||!O)continue;if(p&&!p(V,f,O,P,S,h,l))continue;const q=P.intersectsTriangle(V,f,O);if(q){if(q.distance<0)continue;if((Z||!j||q.distance<j.distance)&&(j=q,j.faceId=U,Z))break}}return j}_intersectUnIndexedTriangles(P,a,R,S,A){let Z=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=3){const R=a[p],j=a[p+1],U=a[p+2];if(A&&!A(R,j,U,P,-1,-1,-1))continue;const Q=P.intersectsTriangle(R,j,U);if(Q){if(Q.distance<0)continue;if((S||!Z||Q.distance<Z.distance)&&(Z=Q,Z.faceId=p/3,S))break}}return Z}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(P,a){const R=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,P,a,!1);if(!this.IsGlobal){const P=this.getBoundingInfo();if(!P)return R;R._boundingInfo=new Z.d(P.minimum,P.maximum)}return R}dispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.GP().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const a=this._mesh.Zj.indexOf(this);this._mesh.Zj.splice(a,1),this.resetDrawCache(void 0,P)}getClassName(){return"SubMesh"}static CreateFromIndices(P,a,R,S,A){let Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=Number.MAX_VALUE,j=-Number.MAX_VALUE;const Q=(A||S).Vj();for(let U=a;U<a+R;U++){const P=Q[U];P<p&&(p=P),P>j&&(j=P)}return new U(P,p,j-p+1,a,R,S,A,Z)}}}}]);