"use strict";(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[24],{11443:(I,E,j)=>{j.d(E,{d:()=>e});class e{constructor(I,E,j){this.bu=I,this.bv=E,this.distance=j,this.faceId=0,this.subMeshId=0}}},11455:(I,E,j)=>{j.d(E,{d:()=>h});var e=j(11127),w=j(11117),z=j(11120);class h{constructor(I,E,j){this.vectors=(0,e.d)(8,w.LE.Zero),this.center=w.LE.Zero(),this.centerWorld=w.LE.Zero(),this.extendSize=w.LE.Zero(),this.extendSizeWorld=w.LE.Zero(),this.directions=(0,e.d)(3,w.LE.Zero),this.vectorsWorld=(0,e.d)(8,w.LE.Zero),this.minimumWorld=w.LE.Zero(),this.maximumWorld=w.LE.Zero(),this.minimum=w.LE.Zero(),this.maximum=w.LE.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(I,E,j)}reConstruct(I,E,j){const e=I.x,z=I.y,h=I.z,t=E.x,U=E.y,R=E.z,P=this.vectors;this.minimum.nz(e,z,h),this.maximum.nz(t,U,R),P[0].nz(e,z,h),P[1].nz(t,U,R),P[2].nz(t,z,h),P[3].nz(e,U,h),P[4].nz(e,z,R),P[5].nz(t,U,h),P[6].nz(e,U,R),P[7].nz(t,z,R),E.addToRef(I,this.center).scaleInPlace(.5),E.subtractToRef(I,this.extendSize).scaleInPlace(.5),this._worldMatrix=j||w.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(I){const E=h._TmpVector3,j=this.maximum.subtractToRef(this.minimum,E[0]),e=j.length();j.normalizeFromLength(e);const w=e*I,z=j.scaleInPlace(.5*w),t=this.center.subtractToRef(z,E[1]),U=this.center.addToRef(z,E[2]);return this.reConstruct(t,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(I){const E=this.minimumWorld,j=this.maximumWorld,e=this.directions,z=this.vectorsWorld,h=this.vectors;if(I.isIdentity()){E.U(this.minimum),j.U(this.maximum);for(let I=0;I<8;++I)z[I].U(h[I]);this.extendSizeWorld.U(this.extendSize),this.centerWorld.U(this.center)}else{E.mz(Number.MAX_VALUE),j.mz(-Number.MAX_VALUE);for(let e=0;e<8;++e){const t=z[e];w.LE.TransformCoordinatesToRef(h[e],I,t),E.minimizeInPlace(t),j.maximizeInPlace(t)}j.subtractToRef(E,this.extendSizeWorld).scaleInPlace(.5),j.addToRef(E,this.centerWorld).scaleInPlace(.5)}w.LE.FromArrayToRef(I.m,0,e[0]),w.LE.FromArrayToRef(I.m,4,e[1]),w.LE.FromArrayToRef(I.m,8,e[2]),this._worldMatrix=I}isInFrustum(I){return h.IsInFrustum(this.vectorsWorld,I)}isCompletelyInFrustum(I){return h.IsCompletelyInFrustum(this.vectorsWorld,I)}intersectsPoint(I){const E=this.minimumWorld,j=this.maximumWorld,e=E.x,w=E.y,h=E.z,t=j.x,U=j.y,R=j.z,P=I.x,o=I.y,Z=I.z,c=-z.b;return!(t-P<c||c>P-e)&&(!(U-o<c||c>o-w)&&!(R-Z<c||c>Z-h))}intersectsSphere(I){return h.IntersectsSphere(this.minimumWorld,this.maximumWorld,I.centerWorld,I.radiusWorld)}intersectsMinMax(I,E){const j=this.minimumWorld,e=this.maximumWorld,w=j.x,z=j.y,h=j.z,t=e.x,U=e.y,R=e.z,P=I.x,o=I.y,Z=I.z,c=E.x,K=E.y,L=E.z;return!(t<P||w>c)&&(!(U<o||z>K)&&!(R<Z||h>L))}dispose(){var I,E;null===(I=this._drawWrapperFront)||void 0===I||I.dispose(),null===(E=this._drawWrapperBack)||void 0===E||E.dispose()}static Intersects(I,E){return I.intersectsMinMax(E.minimumWorld,E.maximumWorld)}static IntersectsSphere(I,E,j,e){const z=h._TmpVector3[0];w.LE.ClampToRef(j,I,E,z);return w.LE.DistanceSquared(j,z)<=e*e}static IsCompletelyInFrustum(I,E){for(let j=0;j<6;++j){const e=E[j];for(let E=0;E<8;++E)if(e.dotCoordinate(I[E])<0)return!1}return!0}static IsInFrustum(I,E){for(let j=0;j<6;++j){let e=!0;const w=E[j];for(let E=0;E<8;++E)if(w.dotCoordinate(I[E])>=0){e=!1;break}if(e)return!1}return!0}}h._TmpVector3=(0,e.d)(3,w.LE.Zero)},11446:(I,E,j)=>{j.d(E,{b:()=>o});var e=j(11127),w=j(11117),z=j(11455),h=j(11462);const t={min:0,max:0},U={min:0,max:0},R=(I,E,j)=>{const e=w.LE.Dot(E.centerWorld,I),z=Math.abs(w.LE.Dot(E.directions[0],I))*E.extendSize.x+Math.abs(w.LE.Dot(E.directions[1],I))*E.extendSize.y+Math.abs(w.LE.Dot(E.directions[2],I))*E.extendSize.z;j.min=e-z,j.max=e+z},P=(I,E,j)=>(R(I,E,t),R(I,j,U),!(t.min>U.max||U.min>t.max));class o{constructor(I,E,j){this._isLocked=!1,this.boundingBox=new z.d(I,E,j),this.boundingSphere=new h.b(I,E,j)}reConstruct(I,E,j){this.boundingBox.reConstruct(I,E,j),this.boundingSphere.reConstruct(I,E,j)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(I){this._isLocked=I}update(I){this._isLocked||(this.boundingBox._update(I),this.boundingSphere._update(I))}centerOn(I,E){const j=o._TmpVector3[0].U(I).Uo(E),e=o._TmpVector3[1].U(I).addInPlace(E);return this.boundingBox.reConstruct(j,e,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(j,e,this.boundingBox.getWorldMatrix()),this}encapsulate(I){const E=w.LE.Minimize(this.minimum,I),j=w.LE.Maximize(this.maximum,I);return this.reConstruct(E,j,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(I){const E=w.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(E);const j=w.TmpVectors.LE[0];return w.LE.TransformCoordinatesToRef(I.boundingBox.minimumWorld,E,j),this.encapsulate(j),w.LE.TransformCoordinatesToRef(I.boundingBox.maximumWorld,E,j),this.encapsulate(j),this}scale(I){return this.boundingBox.scale(I),this.boundingSphere.scale(I),this}isInFrustum(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===E||3===E)&&this.boundingSphere.isCenterInFrustum(I))return!0;if(!this.boundingSphere.isInFrustum(I))return!1;return!(1!==E&&3!==E)||this.boundingBox.isInFrustum(I)}get diagonalLength(){const I=this.boundingBox;return I.maximumWorld.subtractToRef(I.minimumWorld,o._TmpVector3[0]).length()}isCompletelyInFrustum(I){return this.boundingBox.isCompletelyInFrustum(I)}_checkCollision(I){return I._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(I){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(I)&&!!this.boundingBox.intersectsPoint(I))}intersects(I,E){if(!h.b.Intersects(this.boundingSphere,I.boundingSphere))return!1;if(!z.d.Intersects(this.boundingBox,I.boundingBox))return!1;if(!E)return!0;const j=this.boundingBox,e=I.boundingBox;return!!P(j.directions[0],j,e)&&(!!P(j.directions[1],j,e)&&(!!P(j.directions[2],j,e)&&(!!P(e.directions[0],j,e)&&(!!P(e.directions[1],j,e)&&(!!P(e.directions[2],j,e)&&(!!P(w.LE.Cross(j.directions[0],e.directions[0]),j,e)&&(!!P(w.LE.Cross(j.directions[0],e.directions[1]),j,e)&&(!!P(w.LE.Cross(j.directions[0],e.directions[2]),j,e)&&(!!P(w.LE.Cross(j.directions[1],e.directions[0]),j,e)&&(!!P(w.LE.Cross(j.directions[1],e.directions[1]),j,e)&&(!!P(w.LE.Cross(j.directions[1],e.directions[2]),j,e)&&(!!P(w.LE.Cross(j.directions[2],e.directions[0]),j,e)&&(!!P(w.LE.Cross(j.directions[2],e.directions[1]),j,e)&&!!P(w.LE.Cross(j.directions[2],e.directions[2]),j,e))))))))))))))}}o._TmpVector3=(0,e.d)(2,w.LE.Zero)},11462:(I,E,j)=>{j.d(E,{b:()=>z});var e=j(11127),w=j(11117);class z{constructor(I,E,j){this.center=w.LE.Zero(),this.centerWorld=w.LE.Zero(),this.minimum=w.LE.Zero(),this.maximum=w.LE.Zero(),this.reConstruct(I,E,j)}reConstruct(I,E,j){this.minimum.U(I),this.maximum.U(E);const e=w.LE.Distance(I,E);E.addToRef(I,this.center).scaleInPlace(.5),this.radius=.5*e,this._update(j||w.Matrix.IdentityReadOnly)}scale(I){const E=this.radius*I,j=z._TmpVector3,e=j[0].mz(E),w=this.center.subtractToRef(e,j[1]),h=this.center.addToRef(e,j[2]);return this.reConstruct(w,h,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(I){if(I.isIdentity())this.centerWorld.U(this.center),this.radiusWorld=this.radius;else{w.LE.TransformCoordinatesToRef(this.center,I,this.centerWorld);const E=z._TmpVector3[0];w.LE.TransformNormalFromFloatsToRef(1,1,1,I,E),this.radiusWorld=Math.max(Math.abs(E.x),Math.abs(E.y),Math.abs(E.z))*this.radius}}isInFrustum(I){const E=this.centerWorld,j=this.radiusWorld;for(let e=0;e<6;e++)if(I[e].dotCoordinate(E)<=-j)return!1;return!0}isCenterInFrustum(I){const E=this.centerWorld;for(let j=0;j<6;j++)if(I[j].dotCoordinate(E)<0)return!1;return!0}intersectsPoint(I){const E=w.LE.DistanceSquared(this.centerWorld,I);return!(this.radiusWorld*this.radiusWorld<E)}static Intersects(I,E){const j=w.LE.DistanceSquared(I.centerWorld,E.centerWorld),e=I.radiusWorld+E.radiusWorld;return!(e*e<j)}static CreateFromCenterAndRadius(I,E,j){this._TmpVector3[0].U(I),this._TmpVector3[1].nz(0,0,E),this._TmpVector3[2].U(I),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Uo(this._TmpVector3[1]);const e=new z(this._TmpVector3[0],this._TmpVector3[2]);return e._worldMatrix=j||w.Matrix.Identity(),e}}z._TmpVector3=(0,e.d)(3,w.LE.Zero)},11477:(I,E,j)=>{function e(I){-1===I.indexOf("vClipPlane")&&I.push("vClipPlane"),-1===I.indexOf("vClipPlane2")&&I.push("vClipPlane2"),-1===I.indexOf("vClipPlane3")&&I.push("vClipPlane3"),-1===I.indexOf("vClipPlane4")&&I.push("vClipPlane4"),-1===I.indexOf("vClipPlane5")&&I.push("vClipPlane5"),-1===I.indexOf("vClipPlane6")&&I.push("vClipPlane6")}function w(I,E,j){const e=!!(I.clipPlane??E.clipPlane),w=!!(I.clipPlane2??E.clipPlane2),z=!!(I.clipPlane3??E.clipPlane3),h=!!(I.clipPlane4??E.clipPlane4),t=!!(I.clipPlane5??E.clipPlane5),U=!!(I.clipPlane6??E.clipPlane6);e&&j.push("#define CLIPPLANE"),w&&j.push("#define CLIPPLANE2"),z&&j.push("#define CLIPPLANE3"),h&&j.push("#define CLIPPLANE4"),t&&j.push("#define CLIPPLANE5"),U&&j.push("#define CLIPPLANE6")}function z(I,E,j){let e=!1;const w=!!(I.clipPlane??E.clipPlane),z=!!(I.clipPlane2??E.clipPlane2),h=!!(I.clipPlane3??E.clipPlane3),t=!!(I.clipPlane4??E.clipPlane4),U=!!(I.clipPlane5??E.clipPlane5),R=!!(I.clipPlane6??E.clipPlane6);return j.CLIPPLANE!==w&&(j.CLIPPLANE=w,e=!0),j.CLIPPLANE2!==z&&(j.CLIPPLANE2=z,e=!0),j.CLIPPLANE3!==h&&(j.CLIPPLANE3=h,e=!0),j.CLIPPLANE4!==t&&(j.CLIPPLANE4=t,e=!0),j.CLIPPLANE5!==U&&(j.CLIPPLANE5=U,e=!0),j.CLIPPLANE6!==R&&(j.CLIPPLANE6=R,e=!0),e}function h(I,E,j){let e=E.clipPlane??j.clipPlane;t(I,"vClipPlane",e),e=E.clipPlane2??j.clipPlane2,t(I,"vClipPlane2",e),e=E.clipPlane3??j.clipPlane3,t(I,"vClipPlane3",e),e=E.clipPlane4??j.clipPlane4,t(I,"vClipPlane4",e),e=E.clipPlane5??j.clipPlane5,t(I,"vClipPlane5",e),e=E.clipPlane6??j.clipPlane6,t(I,"vClipPlane6",e)}function t(I,E,j){j&&I.setFloat4(E,j.normal.x,j.normal.y,j.normal.z,j.d)}j.d(E,{d:()=>e,f:()=>h,h:()=>z,l:()=>w})},11422:(I,E,j)=>{j.d(E,{e:()=>e});class e{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(I,E){this._defines[I]||(I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I),this._defines[I]=new Array),this._defines[I].push(E)}addCPUSkinningFallback(I,E){this._mesh=E,I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(I,E){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,I=I.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),E._bonesComputationForcedToCPU=!0;const j=this._mesh.GI();for(let I=0;I<j.meshes.length;I++){const e=j.meshes[I];if(e.material){if(e.computeBonesUsingShaders&&0!==e.numBoneInfluencers)if(e.material.getEffect()===E)e.computeBonesUsingShaders=!1;else if(e.ie)for(const I of e.ie){if(I.effect===E){e.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&e.computeBonesUsingShaders&&e.numBoneInfluencers>0&&(e.computeBonesUsingShaders=!1)}}else{const E=this._defines[this._currentRank];if(E)for(let j=0;j<E.length;j++)I=I.replace("#define "+E[j],"");this._currentRank++}return I}}},11436:(I,E,j)=>{j.d(E,{c:()=>F});var e=j(11101),w=j(11106),z=j(10953),h=j(10960),t=j(10993),U=j(11438),R=j(11378),P=j(10974),o=j(11167),Z=j(11246),c=j(11149);class K{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(I){this._func=I}get funcRef(){return this._funcRef}set funcRef(I){this._funcRef=I}get funcMask(){return this._funcMask}set funcMask(I){this._funcMask=I}get opStencilFail(){return this._opStencilFail}set opStencilFail(I){this._opStencilFail=I}get opDepthFail(){return this._opDepthFail}set opDepthFail(I){this._opDepthFail=I}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(I){this._opStencilDepthPass=I}get mask(){return this._mask}set mask(I){this._mask=I}get enabled(){return this._enabled}set enabled(I){this._enabled=I}getClassName(){return"MaterialStencilState"}copyTo(I){c.e.Clone((()=>I),this)}serialize(){return c.e.Serialize(this)}parse(I,E,j){c.e.Parse((()=>this),I,E,j)}}(0,e.b)([(0,w.N)()],K.prototype,"func",null),(0,e.b)([(0,w.N)()],K.prototype,"funcRef",null),(0,e.b)([(0,w.N)()],K.prototype,"funcMask",null),(0,e.b)([(0,w.N)()],K.prototype,"opStencilFail",null),(0,e.b)([(0,w.N)()],K.prototype,"opDepthFail",null),(0,e.b)([(0,w.N)()],K.prototype,"opStencilDepthPass",null),(0,e.b)([(0,w.N)()],K.prototype,"mask",null),(0,e.b)([(0,w.N)()],K.prototype,"enabled",null);var L=j(11470);class F{get _supportGlowLayer(){return!1}set _glowModeEnabled(I){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(I){if(this._alpha===I)return;const E=this._alpha;this._alpha=I,1!==E&&1!==I||this.JR(F.MiscDirtyFlag+F.PrePassDirtyFlag)}get alpha(){return this._alpha}set tz(I){this._backFaceCulling!==I&&(this._backFaceCulling=I,this.JR(F.TextureDirtyFlag))}get tz(){return this._backFaceCulling}set cullBackFaces(I){this._cullBackFaces!==I&&(this._cullBackFaces=I,this.JR(F.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(I){this._blockDirtyMechanism!==I&&(this._blockDirtyMechanism=I,I||this.Jo())}atomicMaterialsUpdate(I){this.blockDirtyMechanism=!0;try{I(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(I){this._onDisposeObserver&&this.Le.remove(this._onDisposeObserver),this._onDisposeObserver=this.Le.add(I)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new h.e),this._onBindObservable}set onBind(I){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(I)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new h.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new h.e),this._onEffectCreatedObservable}set alphaMode(I){this._alphaMode!==I&&(this._alphaMode=I,this.JR(F.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(I){this._needDepthPrePass!==I&&(this._needDepthPrePass=I,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(I){this._fogEnabled!==I&&(this._fogEnabled=I,this.JR(F.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case F.WireFrameFillMode:case F.LineListDrawMode:case F.LineLoopDrawMode:case F.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(I){this.fillMode=I?F.WireFrameFillMode:F.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case F.PointFillMode:case F.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(I){this.fillMode=I?F.PointFillMode:F.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(I){this._fillMode!==I&&(this._fillMode=I,this.JR(F.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){const E=this.GI().getEngine().getCaps().fragmentDepthSupported;I&&!E&&P.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=I&&E,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(I){this._drawWrapper=I}constructor(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Le=new h.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new K,this._useUBO=!1,this._fillMode=F.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=I;const w=E||t.d.LastCreatedScene;w&&(this._scene=w,this._dirtyCallbacks={},this._forceGLSL=e,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=I||z.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Z.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new R.b(this._scene.getEngine(),void 0,void 0,I),this._useUBO=this.GI().getEngine().supportsUniformBuffers,this._createUniformBuffer(),j||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),F.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var I;const E=this.GI().getEngine();null===(I=this._uniformBuffer)||void 0===I||I.dispose(),E.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new R.b(E,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new R.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(I){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Jo(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Jo(),this.checkReadyOnlyOnce=!1}isReady(I,E){return!0}isReadyForSubMesh(I,E,j){const e=E.materialDefines;return!!e&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=e,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}GI(){return this._scene}_getEffectiveOrientation(I){return null!==this.sideOrientation?this.sideOrientation:I.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(I){this._transparencyMode!==I&&(this._transparencyMode=I,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===F.MATERIAL_ALPHABLEND||this._transparencyMode===F.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===F.MATERIAL_ALPHATEST||this._transparencyMode===F.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===F.MATERIAL_OPAQUE||this._transparencyMode===F.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(I){return this._hasTransparencyMode?this._transparencyModeIsBlend:I.visibility<1||!this._disableAlphaBlending&&(I.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(I){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(I)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Jo(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=this.GI().meshes;for(const j of E)if(j.ie)for(const E of j.ie)if(E.TI()===this)for(const j of E._drawWrappers)j&&this._materialContext===j.materialContext&&(j._wasPreviouslyReady=!1,j._wasPreviouslyUsingInstances=null,j._forceRebindOnNextCall=I);I&&this.JR(F.AllDirtyFlag)}_preBind(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.getEngine(),e=(null==E?this.sideOrientation:E)===F.ClockWiseSideOrientation;return j.enableEffect(I||this._getDrawWrapper()),j.setState(this.tz,this.zOffset,!1,e,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),e}bind(I,E){}buildUniformLayout(){const I=this._uniformBuffer;this._eventInfo.ubo=I,this._callbackPluginEventGeneric(8,this._eventInfo),I.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(I,E,j){const e=j._drawWrapper;this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),e._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(I){}bindView(I){this._useUBO?this._needToBindSceneUbo=!0:I.setMatrix("view",this.GI().getViewMatrix())}bindViewProjection(I){this._useUBO?this._needToBindSceneUbo=!0:(I.setMatrix("viewProjection",this.GI().getTransformMatrix()),I.setMatrix("projection",this.GI().getProjectionMatrix()))}bindEyePosition(I,E){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(I,E)}_afterBind(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&E&&(this._needToBindSceneUbo=!1,(0,L.l)(E,this.GI().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=I?I.visibility:1,this._onBindObservable&&I&&this._onBindObservable.notifyObservers(I),this.disableDepthWrite){const I=this._scene.getEngine();this._cachedDepthWriteState=I.getDepthWrite(),I.setDepthWrite(!1)}if(this.disableColorWrite){const I=this._scene.getEngine();this._cachedColorWriteState=I.getColorWrite(),I.setColorWrite(!1)}if(0!==this.depthFunction){const I=this._scene.getEngine();this._cachedDepthFunctionState=I.getDepthFunction()||0,I.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(I){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=I,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(I){return null}_clonePlugins(I,E){const j={};if(this._serializePlugins(j),F._ParsePlugins(j,I,this._scene,E),this.pluginManager)for(const e of this.pluginManager._plugins){const E=I.pluginManager.getPlugin(e.name);E&&e.copyTo(E)}}getBindedMeshes(){if(this.meshMap){const I=[];for(const E in this.meshMap){const j=this.meshMap[E];j&&I.push(j)}return I}return this._scene.meshes.filter((I=>I.material===this))}forceCompilation(I,E,j,e){const w={clipPlane:!1,useInstances:!1,...j},z=this.GI(),h=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const t=()=>{if(!this._scene||!this._scene.getEngine())return;const j=z.clipPlane;if(w.clipPlane&&(z.clipPlane=new o.b(0,0,0,1)),this._storeEffectOnSubMeshes){let j=!0,z=null;if(I.ie){const E=new U.e(0,0,0,0,0,I,void 0,!1,!1);E.materialDefines&&(E.materialDefines._renderId=-1),this.isReadyForSubMesh(I,E,w.useInstances)||(E.effect&&E.effect.getCompilationError()&&E.effect.allFallbacksProcessed()?z=E.effect.getCompilationError():(j=!1,setTimeout(t,16)))}j&&(this.allowShaderHotSwapping=h,z&&e&&e(z),E&&E(this))}else this.isReady()?(this.allowShaderHotSwapping=h,E&&E(this)):setTimeout(t,16);w.clipPlane&&(z.clipPlane=j)};t()}async forceCompilationAsync(I,E){return await new Promise(((j,e)=>{this.forceCompilation(I,(()=>{j()}),E,(I=>{e(I)}))}))}JR(I){this.GI().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(F._DirtyCallbackArray.length=0,I&F.ImageProcessingDirtyFlag&&F._DirtyCallbackArray.push(F._ImageProcessingDirtyCallBack),I&F.TextureDirtyFlag&&F._DirtyCallbackArray.push(F._TextureDirtyCallBack),I&F.LightDirtyFlag&&F._DirtyCallbackArray.push(F._LightsDirtyCallBack),I&F.FresnelDirtyFlag&&F._DirtyCallbackArray.push(F._FresnelDirtyCallBack),I&F.AttributesDirtyFlag&&F._DirtyCallbackArray.push(F._AttributeDirtyCallBack),I&F.MiscDirtyFlag&&F._DirtyCallbackArray.push(F._MiscDirtyCallBack),I&F.PrePassDirtyFlag&&F._DirtyCallbackArray.push(F._PrePassDirtyCallBack),F._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(F._RunDirtyCallBacks),this.GI().resetCachedMaterial())}resetDrawCache(){const I=this.GI().meshes;for(const E of I)if(E.ie)for(const I of E.ie)I.TI()===this&&I.resetDrawCache()}_markAllSubMeshesAsDirty(I){const E=this.GI();if(E.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const j=E.meshes;for(const e of j)if(e.ie)for(const j of e.ie){if((j.TI()||(E._hasDefaultMaterial?E.defaultMaterial:null))===this)for(const E of j._drawWrappers)E&&E.defines&&E.defines.markAllAsDirty&&this._materialContext===E.materialContext&&I(E.defines)}}_markScenePrePassDirty(){if(this.GI().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const I=this.GI().enablePrePassRenderer();I&&I.JR()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(F._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(F._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(F._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(F._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(F._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(F._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(F._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(F._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(F._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(F._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const I=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Le.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(I)}))}}setPrePassRenderer(I){return!1}dispose(I,E,j){const e=this.GI();if(e.stopAnimation(this),e.freeProcessedMaterials(),e.removeMaterial(this),this._eventInfo.forceDisposeTextures=E,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const I=this._parentContainer.materials.indexOf(this);I>-1&&this._parentContainer.materials.splice(I,1),this._parentContainer=null}if(!0!==j)if(this.meshMap)for(const w in this.meshMap){const I=this.meshMap[w];this._disposeMeshResources(I)}else{const I=e.meshes;for(const E of I)this._disposeMeshResources(E)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Le.notifyObservers(this),this.Le.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(I){if(!I)return;const E=I.Je,j=I._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(I.ie&&j)for(const w of I.ie){const I=w._drawWrappers;for(let z=0;z<I.length;z++){var e;const h=null===(e=I[z])||void 0===e?void 0:e.effect;if(!h)continue;j[z]===this&&(null===E||void 0===E||E._releaseVertexArrayObject(h),w._removeDrawWrapper(z,!0,!0))}}}else null===E||void 0===E||E._releaseVertexArrayObject(this._drawWrapper.effect);I.material!==this||I.sourceMesh||(I.material=null)}serialize(){const I=c.e.Serialize(this);return I.stencil=this.stencil.serialize(),I.uniqueId=this.uniqueId,this._serializePlugins(I),I}_serializePlugins(I){if(I.plugins={},this.pluginManager)for(const E of this.pluginManager._plugins)E.doNotSerialize||(I.plugins[E.getClassName()]=E.serialize())}static Parse(I,E,j){if(I.customType){if("BABYLON.PBRMaterial"===I.customType&&I.overloadedAlbedo&&(I.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return P.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else I.customType="BABYLON.StandardMaterial";const e=z.Tools.Instantiate(I.customType).Parse(I,E,j);return e._loadedUniqueId=I.uniqueId,e}static _ParsePlugins(I,E,j,e){if(I.plugins)for(const t in I.plugins){var w,h;const U=I.plugins[t];let R=null===(w=E.pluginManager)||void 0===w?void 0:w.getPlugin(U.name);if(!R){const I=z.Tools.Instantiate("BABYLON."+t);I&&(R=new I(E))}null===(h=R)||void 0===h||h.parse(U,j,e)}}}F.TriangleFillMode=0,F.WireFrameFillMode=1,F.PointFillMode=2,F.PointListDrawMode=3,F.LineListDrawMode=4,F.LineLoopDrawMode=5,F.LineStripDrawMode=6,F.TriangleStripDrawMode=7,F.TriangleFanDrawMode=8,F.ClockWiseSideOrientation=0,F.CounterClockWiseSideOrientation=1,F.ImageProcessingDirtyFlag=64,F.TextureDirtyFlag=1,F.LightDirtyFlag=2,F.FresnelDirtyFlag=4,F.AttributesDirtyFlag=8,F.MiscDirtyFlag=16,F.PrePassDirtyFlag=32,F.AllDirtyFlag=127,F.MATERIAL_OPAQUE=0,F.MATERIAL_ALPHATEST=1,F.MATERIAL_ALPHABLEND=2,F.MATERIAL_ALPHATESTANDBLEND=3,F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,F.MATERIAL_NORMALBLENDMETHOD_RNM=1,F.OnEventObservable=new h.e,F._AllDirtyCallBack=I=>I.markAllAsDirty(),F._ImageProcessingDirtyCallBack=I=>I.markAsImageProcessingDirty(),F._TextureDirtyCallBack=I=>I.markAsTexturesDirty(),F._FresnelDirtyCallBack=I=>I.markAsFresnelDirty(),F._MiscDirtyCallBack=I=>I.markAsMiscDirty(),F._PrePassDirtyCallBack=I=>I.markAsPrePassDirty(),F._LightsDirtyCallBack=I=>I.markAsLightDirty(),F._AttributeDirtyCallBack=I=>I.markAsAttributesDirty(),F._FresnelAndMiscDirtyCallBack=I=>{F._FresnelDirtyCallBack(I),F._MiscDirtyCallBack(I)},F._TextureAndMiscDirtyCallBack=I=>{F._TextureDirtyCallBack(I),F._MiscDirtyCallBack(I)},F._DirtyCallbackArray=[],F._RunDirtyCallBacks=I=>{for(const E of F._DirtyCallbackArray)E(I)},(0,e.b)([(0,w.N)()],F.prototype,"id",void 0),(0,e.b)([(0,w.N)()],F.prototype,"uniqueId",void 0),(0,e.b)([(0,w.N)()],F.prototype,"name",void 0),(0,e.b)([(0,w.N)()],F.prototype,"metadata",void 0),(0,e.b)([(0,w.N)()],F.prototype,"checkReadyOnEveryCall",void 0),(0,e.b)([(0,w.N)()],F.prototype,"checkReadyOnlyOnce",void 0),(0,e.b)([(0,w.N)()],F.prototype,"state",void 0),(0,e.b)([(0,w.N)("alpha")],F.prototype,"_alpha",void 0),(0,e.b)([(0,w.N)("tz")],F.prototype,"_backFaceCulling",void 0),(0,e.b)([(0,w.N)("cullBackFaces")],F.prototype,"_cullBackFaces",void 0),(0,e.b)([(0,w.N)()],F.prototype,"sideOrientation",void 0),(0,e.b)([(0,w.N)("alphaMode")],F.prototype,"_alphaMode",void 0),(0,e.b)([(0,w.N)()],F.prototype,"_needDepthPrePass",void 0),(0,e.b)([(0,w.N)()],F.prototype,"disableDepthWrite",void 0),(0,e.b)([(0,w.N)()],F.prototype,"disableColorWrite",void 0),(0,e.b)([(0,w.N)()],F.prototype,"forceDepthWrite",void 0),(0,e.b)([(0,w.N)()],F.prototype,"depthFunction",void 0),(0,e.b)([(0,w.N)()],F.prototype,"separateCullingPass",void 0),(0,e.b)([(0,w.N)("fogEnabled")],F.prototype,"_fogEnabled",void 0),(0,e.b)([(0,w.N)()],F.prototype,"pointSize",void 0),(0,e.b)([(0,w.N)()],F.prototype,"zOffset",void 0),(0,e.b)([(0,w.N)()],F.prototype,"zOffsetUnits",void 0),(0,e.b)([(0,w.N)()],F.prototype,"pointsCloud",null),(0,e.b)([(0,w.N)()],F.prototype,"fillMode",null),(0,e.b)([(0,w.N)()],F.prototype,"useLogarithmicDepth",null),(0,e.b)([(0,w.N)()],F.prototype,"transparencyMode",null)},11470:(I,E,j)=>{j.d(E,{$:()=>K,A:()=>c,B:()=>Z,C:()=>r,E:()=>i,H:()=>a,K:()=>C,L:()=>d,O:()=>n,S:()=>H,W:()=>g,Y:()=>A,c:()=>x,d:()=>o,e:()=>b,g:()=>P,j:()=>L,l:()=>F,o:()=>X,r:()=>y,s:()=>q,u:()=>Q,x:()=>G});var e=j(10974),w=j(11165),z=j(10993),h=j(11414),t=j(11477);const U=w.qE.Black(),R={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function P(I,E,j){if(!I||I.LOGARITHMICDEPTH||I.indexOf&&I.indexOf("LOGARITHMICDEPTH")>=0){const I=j.activeCamera;1===I.mode&&e.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),E.setFloat("logarithmicDepthConstant",2/(Math.log(I.maxZ+1)/Math.LN2))}}function o(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];j&&I.fogEnabled&&(!E||E.applyFog)&&0!==I.fogMode&&(j.setFloat4("vFogInfos",I.fogMode,I.fogStart,I.fogEnd,I.fogDensity),e?(I.fogColor.toLinearSpaceToRef(U,I.getEngine().useExactSrgbConversions),j.setColor3("vFogColor",U)):j.setColor3("vFogColor",I.fogColor))}function Z(I,E,j,e,w,z,h,t,U,P){const o=I.numMaxInfluencers||I.numInfluencers;return o<=0?0:(E.push("#define MORPHTARGETS"),I.hasPositions&&E.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),I.hasNormals&&E.push("#define MORPHTARGETTEXTURE_HASNORMALS"),I.hasTangents&&E.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),I.hasUVs&&E.push("#define MORPHTARGETTEXTURE_HASUVS"),I.hasUV2s&&E.push("#define MORPHTARGETTEXTURE_HASUV2S"),I.hasColors&&E.push("#define MORPHTARGETTEXTURE_HASCOLORS"),I.supportsPositions&&w&&E.push("#define MORPHTARGETS_POSITION"),I.supportsNormals&&z&&E.push("#define MORPHTARGETS_NORMAL"),I.supportsTangents&&h&&E.push("#define MORPHTARGETS_TANGENT"),I.supportsUVs&&t&&E.push("#define MORPHTARGETS_UV"),I.supportsUV2s&&U&&E.push("#define MORPHTARGETS_UV2"),I.supportsColors&&P&&E.push("#define MORPHTARGETS_COLOR"),E.push("#define NUM_MORPH_INFLUENCERS "+o),I.isUsingTextureForTargets&&E.push("#define MORPHTARGETS_TEXTURE"),R.NUM_MORPH_INFLUENCERS=o,R.NORMAL=z,R.TANGENT=h,R.UV=t,R.UV2=U,R.COLOR=P,c(j,e,R,w),o)}function c(I,E,j){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=j.NUM_MORPH_INFLUENCERS;if(h>0&&z.d.LastCreatedEngine){const t=z.d.LastCreatedEngine.getCaps().maxVertexAttribs,U=E.morphTargetManager;if(null!==U&&void 0!==U&&U.isUsingTextureForTargets)return;const R=U&&U.supportsPositions&&w,P=U&&U.supportsNormals&&j.NORMAL,o=U&&U.supportsTangents&&j.TANGENT,Z=U&&U.supportsUVs&&j.UV1,c=U&&U.supportsUV2s&&j.UV2,K=U&&U.supportsColors&&j.VERTEXCOLOR;for(let j=0;j<h;j++)R&&I.push("position"+j),P&&I.push("normal"+j),o&&I.push("tangent"+j),Z&&I.push("uv_"+j),c&&I.push("uv2_"+j),K&&I.push("color"+j),I.length>t&&e.b.Error("Cannot add more vertex attributes for mesh "+E.name)}}function K(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I.push("world0"),I.push("world1"),I.push("world2"),I.push("world3"),E&&(I.push("previousWorld0"),I.push("previousWorld1"),I.push("previousWorld2"),I.push("previousWorld3"))}function L(I,E){const j=I.morphTargetManager;I&&j&&E.setFloatArray("morphTargetInfluences",j.influences)}function F(I,E){E.bindToEffect(I,"Scene")}function C(I,E,j){E._needUVs=!0,E[j]=!0,I.optimizeUVAllocation&&I.getTextureMatrix().isIdentityAs3x2()?(E[j+"DIRECTUV"]=I.coordinatesIndex+1,E["MAINUV"+(I.coordinatesIndex+1)]=!0):E[j+"DIRECTUV"]=0}function X(I,E,j){const e=I.getTextureMatrix();E.ve(j+"Matrix",e)}function q(I,E,j){j.BAKED_VERTEX_ANIMATION_TEXTURE&&j.INSTANCES&&I.push("bakedVertexAnimationSettingsInstanced")}function x(I,E,j){var e;if(E&&I&&(I.computeBonesUsingShaders&&E._bonesComputationForcedToCPU&&(I.computeBonesUsingShaders=!1),I.useBones&&I.computeBonesUsingShaders&&I.skeleton)){const w=I.skeleton;if(w.isUsingTextureForMatrices&&E.getUniformIndex("boneTextureWidth")>-1){const j=w.getTransformMatrixTexture(I);E.setTexture("boneSampler",j),E.setFloat("boneTextureWidth",4*(w.bones.length+1))}else{const z=w.getTransformMatrices(I);z&&(E.setMatrices("mBones",z),j&&I.GI().prePassRenderer&&I.GI().prePassRenderer.getIndex(2)&&(j.previousBones[I.uniqueId]||(j.previousBones[I.uniqueId]=z.slice()),E.setMatrices("mPreviousBones",j.previousBones[I.uniqueId]),e=z,j.previousBones[I.uniqueId].set(e)))}}}function u(I,E,j,e,w){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];I._bindLight(E,j,e,w,z)}function b(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const z=Math.min(E.lightSources.length,w);for(let h=0;h<z;h++){u(E.lightSources[h],h,I,j,"boolean"===typeof e?e:e.SPECULARTERM,E.receiveShadows)}}function Q(I,E,j,e){j.NUM_BONE_INFLUENCERS>0&&(e.addCPUSkinningFallback(0,E),I.push("matricesIndices"),I.push("matricesWeights"),j.NUM_BONE_INFLUENCERS>4&&(I.push("matricesIndicesExtra"),I.push("matricesWeightsExtra")))}function G(I,E){(E.INSTANCES||E.THIN_INSTANCES)&&K(I,!!E.PREPASS_VELOCITY),E.INSTANCESCOLOR&&I.push("instanceColor")}function y(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=0;for(let z=0;z<j&&I["LIGHT"+z];z++)z>0&&(w=e+z,E.addFallback(w,"LIGHT"+z)),I.SHADOWS||(I["SHADOW"+z]&&E.addFallback(e,"SHADOW"+z),I["SHADOWPCF"+z]&&E.addFallback(e,"SHADOWPCF"+z),I["SHADOWPCSS"+z]&&E.addFallback(e,"SHADOWPCSS"+z),I["SHADOWPOISSON"+z]&&E.addFallback(e,"SHADOWPOISSON"+z),I["SHADOWESM"+z]&&E.addFallback(e,"SHADOWESM"+z),I["SHADOWCLOSEESM"+z]&&E.addFallback(e,"SHADOWCLOSEESM"+z));return w++}function d(I,E,j,e,w,z,h){let t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];h._areMiscDirty&&(h.LOGARITHMICDEPTH=j,h.POINTSIZE=e,h.FOG=w&&function(I,E){return E.fogEnabled&&I.applyFog&&0!==E.fogMode}(I,E),h.NONUNIFORMSCALING=I.nonUniformScaling,h.ALPHATEST=z,h.DECAL_AFTER_DETAIL=t)}function a(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!j._areLightsDirty)return j._needNormals;let h=0;const t={needNormals:j._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(I.lightsEnabled&&!z)for(const R of E.lightSources)if(l(I,E,R,h,j,e,t),h++,h===w)break;j.SPECULARTERM=t.specularEnabled,j.SHADOWS=t.shadowEnabled;for(let R=h;R<w;R++)void 0!==j["LIGHT"+R]&&(j["LIGHT"+R]=!1,j["HEMILIGHT"+R]=!1,j["POINTLIGHT"+R]=!1,j["DIRLIGHT"+R]=!1,j["SPOTLIGHT"+R]=!1,j["AREALIGHT"+R]=!1,j["SHADOW"+R]=!1,j["SHADOWCSM"+R]=!1,j["SHADOWCSMDEBUG"+R]=!1,j["SHADOWCSMNUM_CASCADES"+R]=!1,j["SHADOWCSMUSESHADOWMAXZ"+R]=!1,j["SHADOWCSMNOBLEND"+R]=!1,j["SHADOWCSM_RIGHTHANDED"+R]=!1,j["SHADOWPCF"+R]=!1,j["SHADOWPCSS"+R]=!1,j["SHADOWPOISSON"+R]=!1,j["SHADOWESM"+R]=!1,j["SHADOWCLOSEESM"+R]=!1,j["SHADOWCUBE"+R]=!1,j["SHADOWLOWQUALITY"+R]=!1,j["SHADOWMEDIUMQUALITY"+R]=!1);const U=I.getEngine().getCaps();return void 0===j.SHADOWFLOAT&&(t.needRebuild=!0),j.SHADOWFLOAT=t.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),j.LIGHTMAPEXCLUDED=t.lightmapMode,t.needRebuild&&j.rebuild(),t.needNormals}function l(I,E,j,e,w,z,t){switch(t.needNormals=!0,void 0===w["LIGHT"+e]&&(t.needRebuild=!0),w["LIGHT"+e]=!0,w["SPOTLIGHT"+e]=!1,w["HEMILIGHT"+e]=!1,w["POINTLIGHT"+e]=!1,w["DIRLIGHT"+e]=!1,w["AREALIGHT"+e]=!1,j.prepareLightSpecificDefines(w,e),w["LIGHT_FALLOFF_PHYSICAL"+e]=!1,w["LIGHT_FALLOFF_GLTF"+e]=!1,w["LIGHT_FALLOFF_STANDARD"+e]=!1,j.falloffType){case h.d.FALLOFF_GLTF:w["LIGHT_FALLOFF_GLTF"+e]=!0;break;case h.d.FALLOFF_PHYSICAL:w["LIGHT_FALLOFF_PHYSICAL"+e]=!0;break;case h.d.FALLOFF_STANDARD:w["LIGHT_FALLOFF_STANDARD"+e]=!0}if(z&&!j.qP.equalsFloats(0,0,0)&&(t.specularEnabled=!0),w["SHADOW"+e]=!1,w["SHADOWCSM"+e]=!1,w["SHADOWCSMDEBUG"+e]=!1,w["SHADOWCSMNUM_CASCADES"+e]=!1,w["SHADOWCSMUSESHADOWMAXZ"+e]=!1,w["SHADOWCSMNOBLEND"+e]=!1,w["SHADOWCSM_RIGHTHANDED"+e]=!1,w["SHADOWPCF"+e]=!1,w["SHADOWPCSS"+e]=!1,w["SHADOWPOISSON"+e]=!1,w["SHADOWESM"+e]=!1,w["SHADOWCLOSEESM"+e]=!1,w["SHADOWCUBE"+e]=!1,w["SHADOWLOWQUALITY"+e]=!1,w["SHADOWMEDIUMQUALITY"+e]=!1,E&&E.receiveShadows&&I.shadowsEnabled&&j.shadowEnabled){const E=j.getShadowGenerator(I.activeCamera)??j.getShadowGenerator();if(E){const I=E.getShadowMap();I&&I.renderList&&I.renderList.length>0&&(t.shadowEnabled=!0,E.prepareDefines(w,e))}}j.lightmapMode!=h.d.LIGHTMAP_DEFAULT?(t.lightmapMode=!0,w["LIGHTMAPEXCLUDED"+e]=!0,w["LIGHTMAPNOSPECULAR"+e]=j.lightmapMode==h.d.LIGHTMAP_SHADOWSONLY):(w["LIGHTMAPEXCLUDED"+e]=!1,w["LIGHTMAPNOSPECULAR"+e]=!1)}function i(I,E,j,e,w){let z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(I,E){let j=!1;if(I.activeCamera){const e=E.CAMERA_ORTHOGRAPHIC?1:0,w=E.CAMERA_PERSPECTIVE?1:0,z=1===I.activeCamera.mode?1:0,h=0===I.activeCamera.mode?1:0;(e^z||w^h)&&(E.CAMERA_ORTHOGRAPHIC=1===z,E.CAMERA_PERSPECTIVE=1===h,j=!0)}return j}(I,e);!1!==z&&(U=(0,t.h)(j,I,e)),e.DEPTHPREPASS!==!E.getColorWrite()&&(e.DEPTHPREPASS=!e.DEPTHPREPASS,U=!0),e.INSTANCES!==w&&(e.INSTANCES=w,U=!0),e.THIN_INSTANCES!==h&&(e.THIN_INSTANCES=h,U=!0),U&&e.markAsUnprocessed()}function r(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!E._areAttributesDirty&&E._needNormals===E._normals&&E._needUVs===E._uvs)return!1;E._normals=E._needNormals,E._uvs=E._needUVs,E.NORMAL=E._needNormals&&I.isVerticesDataPresent("normal"),E._needNormals&&I.isVerticesDataPresent("tangent")&&(E.TANGENT=!0);for(let t=1;t<=6;++t)E["UV"+t]=!!E._needUVs&&I.isVerticesDataPresent(`uv${1===t?"":t}`);if(j){const j=I.useVertexColors&&I.isVerticesDataPresent("color");E.VERTEXCOLOR=j,E.VERTEXALPHA=I.hasVertexAlpha&&j&&z}return I.isVerticesDataPresent("instanceColor")&&(I.hasInstances||I.hasThinInstances)&&(E.INSTANCESCOLOR=!0),e&&function(I,E){if(I.useBones&&I.computeBonesUsingShaders&&I.skeleton){E.NUM_BONE_INFLUENCERS=I.numBoneInfluencers;const j=void 0!==E.BONETEXTURE;if(I.skeleton.isUsingTextureForMatrices&&j)E.BONETEXTURE=!0;else{E.BonesPerMesh=I.skeleton.bones.length+1,E.BONETEXTURE=!j&&void 0;const e=I.GI().prePassRenderer;if(e&&e.enabled){const j=-1===e.excludedSkinnedMesh.indexOf(I);E.BONES_VELOCITY_ENABLED=j}}}else E.NUM_BONE_INFLUENCERS=0,E.BonesPerMesh=0,void 0!==E.BONETEXTURE&&(E.BONETEXTURE=!1)}(I,E),w&&function(I,E){const j=I.morphTargetManager;j?(E.MORPHTARGETS_UV=j.supportsUVs&&E.UV1,E.MORPHTARGETS_UV2=j.supportsUV2s&&E.UV2,E.MORPHTARGETS_TANGENT=j.supportsTangents&&E.TANGENT,E.MORPHTARGETS_NORMAL=j.supportsNormals&&E.NORMAL,E.MORPHTARGETS_POSITION=j.supportsPositions,E.MORPHTARGETS_COLOR=j.supportsColors,E.MORPHTARGETTEXTURE_HASUVS=j.hasUVs,E.MORPHTARGETTEXTURE_HASUV2S=j.hasUV2s,E.MORPHTARGETTEXTURE_HASTANGENTS=j.hasTangents,E.MORPHTARGETTEXTURE_HASNORMALS=j.hasNormals,E.MORPHTARGETTEXTURE_HASPOSITIONS=j.hasPositions,E.MORPHTARGETTEXTURE_HASCOLORS=j.hasColors,E.NUM_MORPH_INFLUENCERS=j.numMaxInfluencers||j.numInfluencers,E.MORPHTARGETS=E.NUM_MORPH_INFLUENCERS>0,E.MORPHTARGETS_TEXTURE=j.isUsingTextureForTargets):(E.MORPHTARGETS_UV=!1,E.MORPHTARGETS_UV2=!1,E.MORPHTARGETS_TANGENT=!1,E.MORPHTARGETS_NORMAL=!1,E.MORPHTARGETS_POSITION=!1,E.MORPHTARGETS_COLOR=!1,E.MORPHTARGETTEXTURE_HASUVS=!1,E.MORPHTARGETTEXTURE_HASUV2S=!1,E.MORPHTARGETTEXTURE_HASTANGENTS=!1,E.MORPHTARGETTEXTURE_HASNORMALS=!1,E.MORPHTARGETTEXTURE_HASPOSITIONS=!1,E.MORPHTARGETTEXTURE_HAS_COLORS=!1,E.MORPHTARGETS=!1,E.NUM_MORPH_INFLUENCERS=0)}(I,E),h&&function(I,E){const j=I.bakedVertexAnimationManager;E.BAKED_VERTEX_ANIMATION_TEXTURE=!(!j||!j.isEnabled)}(I,E),!0}function n(I,E){if(I.activeCamera){const j=E.MULTIVIEW;E.MULTIVIEW=null!==I.activeCamera.outputRenderTarget&&I.activeCamera.outputRenderTarget.getViewCount()>1,E.MULTIVIEW!=j&&E.markAsUnprocessed()}}function H(I,E,j){const e=E.ORDER_INDEPENDENT_TRANSPARENCY,w=E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;E.ORDER_INDEPENDENT_TRANSPARENCY=I.useOrderIndependentTransparency&&j,E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!I.getEngine().getCaps().textureFloatLinearFiltering,e===E.ORDER_INDEPENDENT_TRANSPARENCY&&w===E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||E.markAsUnprocessed()}function g(I,E,j){const e=E.PREPASS;if(!E._arePrePassDirty)return;const w=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(I.prePassRenderer&&I.prePassRenderer.enabled&&j){E.PREPASS=!0,E.SCENE_MRT_COUNT=I.prePassRenderer.mrtCount,E.PREPASS_NORMAL_WORLDSPACE=I.prePassRenderer.generateNormalsInWorldSpace,E.PREPASS_COLOR=!0,E.PREPASS_COLOR_INDEX=0;for(let j=0;j<w.length;j++){const e=I.prePassRenderer.getIndex(w[j].type);-1!==e?(E[w[j].define]=!0,E[w[j].index]=e):E[w[j].define]=!1}}else{E.PREPASS=!1;for(let I=0;I<w.length;I++)E[w[I].define]=!1}E.PREPASS!=e&&(E.markAsUnprocessed(),E.markAsImageProcessingDirty())}function Y(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6];w&&w.push("Light"+I),z||(E.push("vLightData"+I,"vLightDiffuse"+I,"vLightSpecular"+I,"vLightDirection"+I,"vLightWidth"+I,"vLightHeight"+I,"vLightFalloff"+I,"vLightGround"+I,"lightMatrix"+I,"shadowsInfo"+I,"depthValues"+I),j.push("shadowTexture"+I),j.push("depthTexture"+I),E.push("viewFrustumZ"+I,"cascadeBlendFactor"+I,"lightSizeUVCorrection"+I,"depthCorrection"+I,"penumbraDarkness"+I,"frustumLengths"+I),e&&(j.push("projectionLightTexture"+I),E.push("textureProjectionMatrix"+I)),h&&j.push("iesLightTexture"+I))}function A(I,E,j){let e,w,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(I.uniformsNames){const h=I;e=h.uniformsNames,w=h.uniformBuffersNames,E=h.samplers,j=h.defines,z=h.maxSimultaneousLights||0}else e=I,E||(E=[]);for(let h=0;h<z&&j["LIGHT"+h];h++)Y(h,e,E,j["PROJECTEDLIGHTTEXTURE"+h],w,!1,j["IESLIGHTTEXTURE"+h]);j.NUM_MORPH_INFLUENCERS&&(e.push("morphTargetInfluences"),e.push("morphTargetCount")),j.BAKED_VERTEX_ANIMATION_TEXTURE&&(e.push("bakedVertexAnimationSettings"),e.push("bakedVertexAnimationTextureSizeInverted"),e.push("bakedVertexAnimationTime"),E.push("bakedVertexAnimationTexture"))}},11427:(I,E,j)=>{j.d(E,{e:()=>z});var e=j(11117),w=j(11436);class z extends w.c{constructor(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(I,E,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new e.Matrix,this._storeEffectOnSubMeshes=j}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(I,E){return!!I&&(!this._storeEffectOnSubMeshes||(!I.ie||0===I.ie.length||this.isReadyForSubMesh(I,I.ie[0],E)))}_isReadyForSubMesh(I){const E=I.materialDefines;return!(this.checkReadyOnEveryCall||!I.effect||!E||E._renderId!==this.GI().getRenderId())}bindOnlyWorldMatrix(I){this._activeEffect.setMatrix("world",I)}bindOnlyNormalMatrix(I){this._activeEffect.setMatrix("normalMatrix",I)}bind(I,E){E&&this.bindForSubMesh(I,E,E.ie[0])}_afterBind(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;super._afterBind(I,E,j),this.GI()._cachedEffect=E,j?j._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return j._drawWrapper._forceRebindOnNextCall||I.isCachedMaterialInvalid(this,E,e)}dispose(I,E,j){this._activeEffect=void 0,super.dispose(I,E,j)}}},11467:(I,E,j)=>{j.d(E,{c:()=>t,d:()=>U});var e=j(11101),w=j(11117),z=j(11106);class h{static extractMinAndMaxIndexed(I,E,j,e,w,z){for(let h=j;h<j+e;h++){const j=3*E[h],e=I[j],t=I[j+1],U=I[j+2];w.minimizeInPlaceFromFloats(e,t,U),z.maximizeInPlaceFromFloats(e,t,U)}}static extractMinAndMax(I,E,j,e,w,z){for(let h=E,t=E*e;h<E+j;h++,t+=e){const E=I[t],j=I[t+1],e=I[t+2];w.minimizeInPlaceFromFloats(E,j,e),z.maximizeInPlaceFromFloats(E,j,e)}}}function t(I,E,j,e){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const t=new w.LE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new w.LE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h.extractMinAndMaxIndexed(I,E,j,e,t,U),z&&(t.x-=t.x*z.x+z.y,t.y-=t.y*z.x+z.y,t.z-=t.z*z.x+z.y,U.x+=U.x*z.x+z.y,U.y+=U.y*z.x+z.y,U.z+=U.z*z.x+z.y),{minimum:t,maximum:U}}function U(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;const t=new w.LE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new w.LE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return z||(z=3),h.extractMinAndMax(I,E,j,z,t,U),e&&(t.x-=t.x*e.x+e.y,t.y-=t.y*e.x+e.y,t.z-=t.z*e.x+e.y,U.x+=U.x*e.x+e.y,U.y+=U.y*e.x+e.y,U.z+=U.z*e.x+e.y),{minimum:t,maximum:U}}(0,e.b)([z.e.filter((function(){for(var I=arguments.length,E=new Array(I),j=0;j<I;j++)E[j]=arguments[j];let[e,w]=E;return!Array.isArray(e)&&!Array.isArray(w)}))],h,"extractMinAndMaxIndexed",null),(0,e.b)([z.e.filter((function(){for(var I=arguments.length,E=new Array(I),j=0;j<I;j++)E[j]=arguments[j];let[e]=E;return!Array.isArray(e)}))],h,"extractMinAndMax",null)},11438:(I,E,j)=>{j.d(E,{e:()=>U});var e=j(11197),w=j(11443),z=j(11446),h=j(11467),t=j(11246);class U{get materialDefines(){var I;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(I=this._getDrawWrapper())||void 0===I?void 0:I.defines}set materialDefines(I){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=I}_getDrawWrapper(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I??this._engine.currentRenderPassId;let j=this._drawWrappers[I];return!j&&E&&(this._drawWrappers[I]=j=new t.e(this._mesh.GI().getEngine())),j}_removeDrawWrapper(I){let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var j;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(j=this._drawWrappers[I])||void 0===j||j.dispose(E));this._drawWrappers[I]=void 0}get effect(){var I;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(I=this._getDrawWrapper())||void 0===I?void 0:I.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(I){this._mainDrawWrapperOverride=I}setEffect(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=this._drawWrapper;w.setEffect(I,E,e),void 0!==j&&(w.materialContext=j),I||(w.defines=null,w.materialContext=void 0)}resetDrawCache(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==I)return void this._removeDrawWrapper(I,!0,E);for(const I of this._drawWrappers)null===I||void 0===I||I.dispose(E)}this._drawWrappers=[]}static AddToMesh(I,E,j,e,w,z,h){return new U(I,E,j,e,w,z,h,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(I,E,j,e,w,z,h){let t=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=I,this.verticesStart=E,this.verticesCount=j,this.indexStart=e,this.indexCount=w,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=z,this._renderingMesh=h||z,U&&z.ie.push(this),this._engine=this._mesh.GI().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=z.ie.length-1,t&&(this.refreshBoundingInfo(),z.Be(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(I){return this._boundingInfo=I,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const I=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return I||this._renderingMesh}TI(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!E)return I&&this._mesh.GI()._hasDefaultMaterial?this._mesh.GI().defaultMaterial:null;if(this._isMultiMaterial(E)){const I=E.getSubMaterial(this.materialIndex);return this._currentMaterial!==I&&(this._currentMaterial=I,this.resetDrawCache()),I}return E}_isMultiMaterial(I){return void 0!==I.getSubMaterial}refreshBoundingInfo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Je)return this;if(I||(I=this._renderingMesh.getVerticesData(e.e.PositionKind)),!I)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const E=this._renderingMesh.me();let j;if(0===this.indexStart&&this.indexCount===E.length){const I=this._renderingMesh.getBoundingInfo();j={minimum:I.minimum.clone(),maximum:I.maximum.clone()}}else j=(0,h.c)(I,E,this.indexStart,this.indexCount,this._renderingMesh.Je.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(j.minimum,j.maximum):this._boundingInfo=new z.b(j.minimum,j.maximum),this}_checkCollision(I){return this.getBoundingInfo()._checkCollision(I)}updateBoundingInfo(I){let E=this.getBoundingInfo();return E||(this.refreshBoundingInfo(),E=this.getBoundingInfo()),E&&E.update(I),this}isInFrustum(I){const E=this.getBoundingInfo();return!!E&&E.isInFrustum(I,this._mesh.uo)}isCompletelyInFrustum(I){const E=this.getBoundingInfo();return!!E&&E.isCompletelyInFrustum(I)}render(I){return this._renderingMesh.render(this,I,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(I,E){if(!this._linesIndexBuffer){const j=6*Math.floor(this.indexCount/3),e=this.verticesStart+this.verticesCount>65535?new Uint32Array(j):new Uint16Array(j);let w=0;if(0===I.length)for(let I=this.indexStart;I<this.indexStart+this.indexCount;I+=3)e[w++]=I,e[w++]=I+1,e[w++]=I+1,e[w++]=I+2,e[w++]=I+2,e[w++]=I;else for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)e[w++]=I[E],e[w++]=I[E+1],e[w++]=I[E+1],e[w++]=I[E+2],e[w++]=I[E+2],e[w++]=I[E];this._linesIndexBuffer=E.createIndexBuffer(e),this._linesIndexCount=e.length}return this._linesIndexBuffer}canIntersects(I){const E=this.getBoundingInfo();return!!E&&I.intersectsBox(E.boundingBox)}intersects(I,E,j,e,w){const z=this.TI();if(!z)return null;let h=3,t=!1;switch(z.fillMode){case 3:case 5:case 6:case 8:return null;case 7:h=1,t=!0}return 4===z.fillMode?j.length?this._intersectLines(I,E,j,this._mesh.intersectionThreshold,e):this._intersectUnIndexedLines(I,E,j,this._mesh.intersectionThreshold,e):!j.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(I,E,j,e,w):this._intersectTriangles(I,E,j,h,t,e,w)}_intersectLines(I,E,j,e,z){let h=null;for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=2){const U=E[j[t]],R=E[j[t+1]],P=I.intersectionSegment(U,R,e);if(!(P<0)&&((z||!h||P<h.distance)&&(h=new w.d(null,null,P),h.faceId=t/2,z)))break}return h}_intersectUnIndexedLines(I,E,j,e,z){let h=null;for(let t=this.verticesStart;t<this.verticesStart+this.verticesCount;t+=2){const j=E[t],U=E[t+1],R=I.intersectionSegment(j,U,e);if(!(R<0)&&((z||!h||R<h.distance)&&(h=new w.d(null,null,R),h.faceId=t/2,z)))break}return h}_intersectTriangles(I,E,j,e,w,z,h){let t=null,U=-1;for(let R=this.indexStart;R<this.indexStart+this.indexCount-(3-e);R+=e){U++;const e=j[R],P=j[R+1],o=j[R+2];if(w&&4294967295===o){R+=2;continue}const Z=E[e],c=E[P],K=E[o];if(!Z||!c||!K)continue;if(h&&!h(Z,c,K,I,e,P,o))continue;const L=I.intersectsTriangle(Z,c,K);if(L){if(L.distance<0)continue;if((z||!t||L.distance<t.distance)&&(t=L,t.faceId=U,z))break}}return t}_intersectUnIndexedTriangles(I,E,j,e,w){let z=null;for(let h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=3){const j=E[h],t=E[h+1],U=E[h+2];if(w&&!w(j,t,U,I,-1,-1,-1))continue;const R=I.intersectsTriangle(j,t,U);if(R){if(R.distance<0)continue;if((e||!z||R.distance<z.distance)&&(z=R,z.faceId=h/3,e))break}}return z}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(I,E){const j=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,I,E,!1);if(!this.IsGlobal){const I=this.getBoundingInfo();if(!I)return j;j._boundingInfo=new z.b(I.minimum,I.maximum)}return j}dispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.GI().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const E=this._mesh.ie.indexOf(this);this._mesh.ie.splice(E,1),this.resetDrawCache(void 0,I)}getClassName(){return"SubMesh"}static CreateFromIndices(I,E,j,e,w){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],h=Number.MAX_VALUE,t=-Number.MAX_VALUE;const R=(w||e).me();for(let U=E;U<E+j;U++){const I=R[U];I<h&&(h=I),I>t&&(t=I)}return new U(I,h,t-h+1,E,j,e,w,z)}}}}]);