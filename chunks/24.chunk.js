"use strict";(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[24],{11672:(n,y,H)=>{H.d(y,{b:()=>o});class o{constructor(n,y,H){this.bu=n,this.bv=y,this.distance=H,this.faceId=0,this.subMeshId=0}}},11682:(n,y,H)=>{H.d(y,{b:()=>k});var o=H(11300),G=H(11288),h=H(11297);class k{constructor(n,y,H){this.vectors=(0,o.c)(8,G.zy.Zero),this.center=G.zy.Zero(),this.centerWorld=G.zy.Zero(),this.extendSize=G.zy.Zero(),this.extendSizeWorld=G.zy.Zero(),this.directions=(0,o.c)(3,G.zy.Zero),this.vectorsWorld=(0,o.c)(8,G.zy.Zero),this.minimumWorld=G.zy.Zero(),this.maximumWorld=G.zy.Zero(),this.minimum=G.zy.Zero(),this.maximum=G.zy.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(n,y,H)}reConstruct(n,y,H){const o=n.x,h=n.y,k=n.z,i=y.x,B=y.y,V=y.z,q=this.vectors;this.minimum.Mi(o,h,k),this.maximum.Mi(i,B,V),q[0].Mi(o,h,k),q[1].Mi(i,B,V),q[2].Mi(i,h,k),q[3].Mi(o,B,k),q[4].Mi(o,h,V),q[5].Mi(i,B,k),q[6].Mi(o,B,V),q[7].Mi(i,h,V),y.addToRef(n,this.center).scaleInPlace(.5),y.subtractToRef(n,this.extendSize).scaleInPlace(.5),this._worldMatrix=H||G.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(n){const y=k._TmpVector3,H=this.maximum.subtractToRef(this.minimum,y[0]),o=H.length();H.normalizeFromLength(o);const G=o*n,h=H.scaleInPlace(.5*G),i=this.center.subtractToRef(h,y[1]),B=this.center.addToRef(h,y[2]);return this.reConstruct(i,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(n){const y=this.minimumWorld,H=this.maximumWorld,o=this.directions,h=this.vectorsWorld,k=this.vectors;if(n.isIdentity()){y.B(this.minimum),H.B(this.maximum);for(let n=0;n<8;++n)h[n].B(k[n]);this.extendSizeWorld.B(this.extendSize),this.centerWorld.B(this.center)}else{y.ci(Number.MAX_VALUE),H.ci(-Number.MAX_VALUE);for(let o=0;o<8;++o){const i=h[o];G.zy.TransformCoordinatesToRef(k[o],n,i),y.minimizeInPlace(i),H.maximizeInPlace(i)}H.subtractToRef(y,this.extendSizeWorld).scaleInPlace(.5),H.addToRef(y,this.centerWorld).scaleInPlace(.5)}G.zy.FromArrayToRef(n.m,0,o[0]),G.zy.FromArrayToRef(n.m,4,o[1]),G.zy.FromArrayToRef(n.m,8,o[2]),this._worldMatrix=n}isInFrustum(n){return k.IsInFrustum(this.vectorsWorld,n)}isCompletelyInFrustum(n){return k.IsCompletelyInFrustum(this.vectorsWorld,n)}intersectsPoint(n){const y=this.minimumWorld,H=this.maximumWorld,o=y.x,G=y.y,k=y.z,i=H.x,B=H.y,V=H.z,q=n.x,b=n.y,A=n.z,U=-h.e;return!(i-q<U||U>q-o)&&(!(B-b<U||U>b-G)&&!(V-A<U||U>A-k))}intersectsSphere(n){return k.IntersectsSphere(this.minimumWorld,this.maximumWorld,n.centerWorld,n.radiusWorld)}intersectsMinMax(n,y){const H=this.minimumWorld,o=this.maximumWorld,G=H.x,h=H.y,k=H.z,i=o.x,B=o.y,V=o.z,q=n.x,b=n.y,A=n.z,U=y.x,T=y.y,W=y.z;return!(i<q||G>U)&&(!(B<b||h>T)&&!(V<A||k>W))}dispose(){var n,y;null===(n=this._drawWrapperFront)||void 0===n||n.dispose(),null===(y=this._drawWrapperBack)||void 0===y||y.dispose()}static Intersects(n,y){return n.intersectsMinMax(y.minimumWorld,y.maximumWorld)}static IntersectsSphere(n,y,H,o){const h=k._TmpVector3[0];G.zy.ClampToRef(H,n,y,h);return G.zy.DistanceSquared(H,h)<=o*o}static IsCompletelyInFrustum(n,y){for(let H=0;H<6;++H){const o=y[H];for(let y=0;y<8;++y)if(o.dotCoordinate(n[y])<0)return!1}return!0}static IsInFrustum(n,y){for(let H=0;H<6;++H){let o=!0;const G=y[H];for(let y=0;y<8;++y)if(G.dotCoordinate(n[y])>=0){o=!1;break}if(o)return!1}return!0}}k._TmpVector3=(0,o.c)(3,G.zy.Zero)},11680:(n,y,H)=>{H.d(y,{c:()=>b});var o=H(11300),G=H(11288),h=H(11682),k=H(11691);const i={min:0,max:0},B={min:0,max:0},V=(n,y,H)=>{const o=G.zy.Dot(y.centerWorld,n),h=Math.abs(G.zy.Dot(y.directions[0],n))*y.extendSize.x+Math.abs(G.zy.Dot(y.directions[1],n))*y.extendSize.y+Math.abs(G.zy.Dot(y.directions[2],n))*y.extendSize.z;H.min=o-h,H.max=o+h},q=(n,y,H)=>(V(n,y,i),V(n,H,B),!(i.min>B.max||B.min>i.max));class b{constructor(n,y,H){this._isLocked=!1,this.boundingBox=new h.b(n,y,H),this.boundingSphere=new k.c(n,y,H)}reConstruct(n,y,H){this.boundingBox.reConstruct(n,y,H),this.boundingSphere.reConstruct(n,y,H)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(n){this._isLocked=n}update(n){this._isLocked||(this.boundingBox._update(n),this.boundingSphere._update(n))}centerOn(n,y){const H=b._TmpVector3[0].B(n).kb(y),o=b._TmpVector3[1].B(n).addInPlace(y);return this.boundingBox.reConstruct(H,o,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(H,o,this.boundingBox.getWorldMatrix()),this}encapsulate(n){const y=G.zy.Minimize(this.minimum,n),H=G.zy.Maximize(this.maximum,n);return this.reConstruct(y,H,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(n){const y=G.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(y);const H=G.TmpVectors.zy[0];return G.zy.TransformCoordinatesToRef(n.boundingBox.minimumWorld,y,H),this.encapsulate(H),G.zy.TransformCoordinatesToRef(n.boundingBox.maximumWorld,y,H),this.encapsulate(H),this}scale(n){return this.boundingBox.scale(n),this.boundingSphere.scale(n),this}isInFrustum(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===y||3===y)&&this.boundingSphere.isCenterInFrustum(n))return!0;if(!this.boundingSphere.isInFrustum(n))return!1;return!(1!==y&&3!==y)||this.boundingBox.isInFrustum(n)}get diagonalLength(){const n=this.boundingBox;return n.maximumWorld.subtractToRef(n.minimumWorld,b._TmpVector3[0]).length()}isCompletelyInFrustum(n){return this.boundingBox.isCompletelyInFrustum(n)}_checkCollision(n){return n._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(n){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(n)&&!!this.boundingBox.intersectsPoint(n))}intersects(n,y){if(!k.c.Intersects(this.boundingSphere,n.boundingSphere))return!1;if(!h.b.Intersects(this.boundingBox,n.boundingBox))return!1;if(!y)return!0;const H=this.boundingBox,o=n.boundingBox;return!!q(H.directions[0],H,o)&&(!!q(H.directions[1],H,o)&&(!!q(H.directions[2],H,o)&&(!!q(o.directions[0],H,o)&&(!!q(o.directions[1],H,o)&&(!!q(o.directions[2],H,o)&&(!!q(G.zy.Cross(H.directions[0],o.directions[0]),H,o)&&(!!q(G.zy.Cross(H.directions[0],o.directions[1]),H,o)&&(!!q(G.zy.Cross(H.directions[0],o.directions[2]),H,o)&&(!!q(G.zy.Cross(H.directions[1],o.directions[0]),H,o)&&(!!q(G.zy.Cross(H.directions[1],o.directions[1]),H,o)&&(!!q(G.zy.Cross(H.directions[1],o.directions[2]),H,o)&&(!!q(G.zy.Cross(H.directions[2],o.directions[0]),H,o)&&(!!q(G.zy.Cross(H.directions[2],o.directions[1]),H,o)&&!!q(G.zy.Cross(H.directions[2],o.directions[2]),H,o))))))))))))))}}b._TmpVector3=(0,o.c)(2,G.zy.Zero)},11691:(n,y,H)=>{H.d(y,{c:()=>h});var o=H(11300),G=H(11288);class h{constructor(n,y,H){this.center=G.zy.Zero(),this.centerWorld=G.zy.Zero(),this.minimum=G.zy.Zero(),this.maximum=G.zy.Zero(),this.reConstruct(n,y,H)}reConstruct(n,y,H){this.minimum.B(n),this.maximum.B(y);const o=G.zy.Distance(n,y);y.addToRef(n,this.center).scaleInPlace(.5),this.radius=.5*o,this._update(H||G.Matrix.IdentityReadOnly)}scale(n){const y=this.radius*n,H=h._TmpVector3,o=H[0].ci(y),G=this.center.subtractToRef(o,H[1]),k=this.center.addToRef(o,H[2]);return this.reConstruct(G,k,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(n){if(n.isIdentity())this.centerWorld.B(this.center),this.radiusWorld=this.radius;else{G.zy.TransformCoordinatesToRef(this.center,n,this.centerWorld);const y=h._TmpVector3[0];G.zy.TransformNormalFromFloatsToRef(1,1,1,n,y),this.radiusWorld=Math.max(Math.abs(y.x),Math.abs(y.y),Math.abs(y.z))*this.radius}}isInFrustum(n){const y=this.centerWorld,H=this.radiusWorld;for(let o=0;o<6;o++)if(n[o].dotCoordinate(y)<=-H)return!1;return!0}isCenterInFrustum(n){const y=this.centerWorld;for(let H=0;H<6;H++)if(n[H].dotCoordinate(y)<0)return!1;return!0}intersectsPoint(n){const y=G.zy.DistanceSquared(this.centerWorld,n);return!(this.radiusWorld*this.radiusWorld<y)}static Intersects(n,y){const H=G.zy.DistanceSquared(n.centerWorld,y.centerWorld),o=n.radiusWorld+y.radiusWorld;return!(o*o<H)}static CreateFromCenterAndRadius(n,y,H){this._TmpVector3[0].B(n),this._TmpVector3[1].Mi(0,0,y),this._TmpVector3[2].B(n),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].kb(this._TmpVector3[1]);const o=new h(this._TmpVector3[0],this._TmpVector3[2]);return o._worldMatrix=H||G.Matrix.Identity(),o}}h._TmpVector3=(0,o.c)(3,G.zy.Zero)},11710:(n,y,H)=>{function o(n){-1===n.indexOf("vClipPlane")&&n.push("vClipPlane"),-1===n.indexOf("vClipPlane2")&&n.push("vClipPlane2"),-1===n.indexOf("vClipPlane3")&&n.push("vClipPlane3"),-1===n.indexOf("vClipPlane4")&&n.push("vClipPlane4"),-1===n.indexOf("vClipPlane5")&&n.push("vClipPlane5"),-1===n.indexOf("vClipPlane6")&&n.push("vClipPlane6")}function G(n,y,H){const o=!!(n.clipPlane??y.clipPlane),G=!!(n.clipPlane2??y.clipPlane2),h=!!(n.clipPlane3??y.clipPlane3),k=!!(n.clipPlane4??y.clipPlane4),i=!!(n.clipPlane5??y.clipPlane5),B=!!(n.clipPlane6??y.clipPlane6);o&&H.push("#define CLIPPLANE"),G&&H.push("#define CLIPPLANE2"),h&&H.push("#define CLIPPLANE3"),k&&H.push("#define CLIPPLANE4"),i&&H.push("#define CLIPPLANE5"),B&&H.push("#define CLIPPLANE6")}function h(n,y,H){let o=!1;const G=!!(n.clipPlane??y.clipPlane),h=!!(n.clipPlane2??y.clipPlane2),k=!!(n.clipPlane3??y.clipPlane3),i=!!(n.clipPlane4??y.clipPlane4),B=!!(n.clipPlane5??y.clipPlane5),V=!!(n.clipPlane6??y.clipPlane6);return H.CLIPPLANE!==G&&(H.CLIPPLANE=G,o=!0),H.CLIPPLANE2!==h&&(H.CLIPPLANE2=h,o=!0),H.CLIPPLANE3!==k&&(H.CLIPPLANE3=k,o=!0),H.CLIPPLANE4!==i&&(H.CLIPPLANE4=i,o=!0),H.CLIPPLANE5!==B&&(H.CLIPPLANE5=B,o=!0),H.CLIPPLANE6!==V&&(H.CLIPPLANE6=V,o=!0),o}function k(n,y,H){let o=y.clipPlane??H.clipPlane;i(n,"vClipPlane",o),o=y.clipPlane2??H.clipPlane2,i(n,"vClipPlane2",o),o=y.clipPlane3??H.clipPlane3,i(n,"vClipPlane3",o),o=y.clipPlane4??H.clipPlane4,i(n,"vClipPlane4",o),o=y.clipPlane5??H.clipPlane5,i(n,"vClipPlane5",o),o=y.clipPlane6??H.clipPlane6,i(n,"vClipPlane6",o)}function i(n,y,H){H&&n.setFloat4(y,H.normal.x,H.normal.y,H.normal.z,H.d)}H.d(y,{d:()=>o,h:()=>k,l:()=>h,o:()=>G})},11642:(n,y,H)=>{H.d(y,{b:()=>o});class o{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(n,y){this._defines[n]||(n<this._currentRank&&(this._currentRank=n),n>this._maxRank&&(this._maxRank=n),this._defines[n]=new Array),this._defines[n].push(y)}addCPUSkinningFallback(n,y){this._mesh=y,n<this._currentRank&&(this._currentRank=n),n>this._maxRank&&(this._maxRank=n)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(n,y){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,n=n.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),y._bonesComputationForcedToCPU=!0;const H=this._mesh.pn();for(let n=0;n<H.meshes.length;n++){const o=H.meshes[n];if(o.material){if(o.computeBonesUsingShaders&&0!==o.numBoneInfluencers)if(o.material.getEffect()===y)o.computeBonesUsingShaders=!1;else if(o.Lh)for(const n of o.Lh){if(n.effect===y){o.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&o.computeBonesUsingShaders&&o.numBoneInfluencers>0&&(o.computeBonesUsingShaders=!1)}}else{const y=this._defines[this._currentRank];if(y)for(let H=0;H<y.length;H++)n=n.replace("#define "+y[H],"");this._currentRank++}return n}}},11658:(n,y,H)=>{H.d(y,{e:()=>z});var o=H(11278),G=H(11280),h=H(11094),k=H(11099),i=H(11149),B=H(11667),V=H(11582),q=H(11114),b=H(11342),A=H(11425),U=H(11325);class T{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(n){this._func=n}get funcRef(){return this._funcRef}set funcRef(n){this._funcRef=n}get funcMask(){return this._funcMask}set funcMask(n){this._funcMask=n}get opStencilFail(){return this._opStencilFail}set opStencilFail(n){this._opStencilFail=n}get opDepthFail(){return this._opDepthFail}set opDepthFail(n){this._opDepthFail=n}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(n){this._opStencilDepthPass=n}get mask(){return this._mask}set mask(n){this._mask=n}get enabled(){return this._enabled}set enabled(n){this._enabled=n}getClassName(){return"MaterialStencilState"}copyTo(n){U.c.Clone((()=>n),this)}serialize(){return U.c.Serialize(this)}parse(n,y,H){U.c.Parse((()=>this),n,y,H)}}(0,o.e)([(0,G.J)()],T.prototype,"func",null),(0,o.e)([(0,G.J)()],T.prototype,"funcRef",null),(0,o.e)([(0,G.J)()],T.prototype,"funcMask",null),(0,o.e)([(0,G.J)()],T.prototype,"opStencilFail",null),(0,o.e)([(0,G.J)()],T.prototype,"opDepthFail",null),(0,o.e)([(0,G.J)()],T.prototype,"opStencilDepthPass",null),(0,o.e)([(0,G.J)()],T.prototype,"mask",null),(0,o.e)([(0,G.J)()],T.prototype,"enabled",null);var W=H(11705);class z{get _supportGlowLayer(){return!1}set _glowModeEnabled(n){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(n){if(this._alpha===n)return;const y=this._alpha;this._alpha=n,1!==y&&1!==n||this.ZV(z.MiscDirtyFlag+z.PrePassDirtyFlag)}get alpha(){return this._alpha}set gi(n){this._backFaceCulling!==n&&(this._backFaceCulling=n,this.ZV(z.TextureDirtyFlag))}get gi(){return this._backFaceCulling}set cullBackFaces(n){this._cullBackFaces!==n&&(this._cullBackFaces=n,this.ZV(z.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(n){this._blockDirtyMechanism!==n&&(this._blockDirtyMechanism=n,n||this.aA())}atomicMaterialsUpdate(n){this.blockDirtyMechanism=!0;try{n(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(n){this._onDisposeObserver&&this.ah.remove(this._onDisposeObserver),this._onDisposeObserver=this.ah.add(n)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new k.c),this._onBindObservable}set onBind(n){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(n)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new k.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new k.c),this._onEffectCreatedObservable}set alphaMode(n){this._alphaMode!==n&&(this._alphaMode=n,this.ZV(z.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(n){this._needDepthPrePass!==n&&(this._needDepthPrePass=n,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(n){this._fogEnabled!==n&&(this._fogEnabled=n,this.ZV(z.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case z.WireFrameFillMode:case z.LineListDrawMode:case z.LineLoopDrawMode:case z.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(n){this.fillMode=n?z.WireFrameFillMode:z.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case z.PointFillMode:case z.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(n){this.fillMode=n?z.PointFillMode:z.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(n){this._fillMode!==n&&(this._fillMode=n,this.ZV(z.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(n){const y=this.pn().getEngine().getCaps().fragmentDepthSupported;n&&!y&&q.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=n&&y,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(n){this._drawWrapper=n}constructor(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.ah=new k.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new T,this._useUBO=!1,this._fillMode=z.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=n;const G=y||i.c.LastCreatedScene;G&&(this._scene=G,this._dirtyCallbacks={},this._forceGLSL=o,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=n||h.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new A.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new V.d(this._scene.getEngine(),void 0,void 0,n),this._useUBO=this.pn().getEngine().supportsUniformBuffers,this._createUniformBuffer(),H||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),z.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var n;const y=this.pn().getEngine();null===(n=this._uniformBuffer)||void 0===n||n.dispose(),y.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new V.d(y,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new V.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(n){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.aA(),this.checkReadyOnlyOnce=!0}unfreeze(){this.aA(),this.checkReadyOnlyOnce=!1}isReady(n,y){return!0}isReadyForSubMesh(n,y,H){const o=y.materialDefines;return!!o&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}pn(){return this._scene}_getEffectiveOrientation(n){return null!==this.sideOrientation?this.sideOrientation:n.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(n){this._transparencyMode!==n&&(this._transparencyMode=n,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===z.MATERIAL_ALPHABLEND||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===z.MATERIAL_ALPHATEST||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===z.MATERIAL_OPAQUE||this._transparencyMode===z.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(n){return this._hasTransparencyMode?this._transparencyModeIsBlend:n.visibility<1||!this._disableAlphaBlending&&(n.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(n){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(n)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}aA(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=this.pn().meshes;for(const H of y)if(H.Lh)for(const y of H.Lh)if(y.Sn()===this)for(const H of y._drawWrappers)H&&this._materialContext===H.materialContext&&(H._wasPreviouslyReady=!1,H._wasPreviouslyUsingInstances=null,H._forceRebindOnNextCall=n);n&&this.ZV(z.AllDirtyFlag)}_preBind(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.getEngine(),o=(null==y?this.sideOrientation:y)===z.ClockWiseSideOrientation;return H.enableEffect(n||this._getDrawWrapper()),H.setState(this.gi,this.zOffset,!1,o,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),o}bind(n,y){}buildUniformLayout(){const n=this._uniformBuffer;this._eventInfo.ubo=n,this._callbackPluginEventGeneric(8,this._eventInfo),n.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(n,y,H){const o=H._drawWrapper;this._eventInfo.subMesh=H,this._callbackPluginEventBindForSubMesh(this._eventInfo),o._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(n){}bindView(n){this._useUBO?this._needToBindSceneUbo=!0:n.setMatrix("view",this.pn().getViewMatrix())}bindViewProjection(n){this._useUBO?this._needToBindSceneUbo=!0:(n.setMatrix("viewProjection",this.pn().getTransformMatrix()),n.setMatrix("projection",this.pn().getProjectionMatrix()))}bindEyePosition(n,y){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(n,y)}_afterBind(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&y&&(this._needToBindSceneUbo=!1,(0,W.o)(y,this.pn().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=n?n.visibility:1,this._onBindObservable&&n&&this._onBindObservable.notifyObservers(n),this.disableDepthWrite){const n=this._scene.getEngine();this._cachedDepthWriteState=n.getDepthWrite(),n.setDepthWrite(!1)}if(this.disableColorWrite){const n=this._scene.getEngine();this._cachedColorWriteState=n.getColorWrite(),n.setColorWrite(!1)}if(0!==this.depthFunction){const n=this._scene.getEngine();this._cachedDepthFunctionState=n.getDepthFunction()||0,n.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(n){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=n,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(n){return null}_clonePlugins(n,y){const H={};if(this._serializePlugins(H),z._ParsePlugins(H,n,this._scene,y),this.pluginManager)for(const o of this.pluginManager._plugins){const y=n.pluginManager.getPlugin(o.name);y&&o.copyTo(y)}}getBindedMeshes(){if(this.meshMap){const n=[];for(const y in this.meshMap){const H=this.meshMap[y];H&&n.push(H)}return n}return this._scene.meshes.filter((n=>n.material===this))}forceCompilation(n,y,H,o){const G={clipPlane:!1,useInstances:!1,...H},h=this.pn(),k=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const i=()=>{if(!this._scene||!this._scene.getEngine())return;const H=h.clipPlane;if(G.clipPlane&&(h.clipPlane=new b.b(0,0,0,1)),this._storeEffectOnSubMeshes){let H=!0,h=null;if(n.Lh){const y=new B.c(0,0,0,0,0,n,void 0,!1,!1);y.materialDefines&&(y.materialDefines._renderId=-1),this.isReadyForSubMesh(n,y,G.useInstances)||(y.effect&&y.effect.getCompilationError()&&y.effect.allFallbacksProcessed()?h=y.effect.getCompilationError():(H=!1,setTimeout(i,16)))}H&&(this.allowShaderHotSwapping=k,h&&o&&o(h),y&&y(this))}else this.isReady()?(this.allowShaderHotSwapping=k,y&&y(this)):setTimeout(i,16);G.clipPlane&&(h.clipPlane=H)};i()}async forceCompilationAsync(n,y){return await new Promise(((H,o)=>{this.forceCompilation(n,(()=>{H()}),y,(n=>{o(n)}))}))}ZV(n){this.pn().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(z._DirtyCallbackArray.length=0,n&z.ImageProcessingDirtyFlag&&z._DirtyCallbackArray.push(z._ImageProcessingDirtyCallBack),n&z.TextureDirtyFlag&&z._DirtyCallbackArray.push(z._TextureDirtyCallBack),n&z.LightDirtyFlag&&z._DirtyCallbackArray.push(z._LightsDirtyCallBack),n&z.FresnelDirtyFlag&&z._DirtyCallbackArray.push(z._FresnelDirtyCallBack),n&z.AttributesDirtyFlag&&z._DirtyCallbackArray.push(z._AttributeDirtyCallBack),n&z.MiscDirtyFlag&&z._DirtyCallbackArray.push(z._MiscDirtyCallBack),n&z.PrePassDirtyFlag&&z._DirtyCallbackArray.push(z._PrePassDirtyCallBack),z._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(z._RunDirtyCallBacks),this.pn().resetCachedMaterial())}resetDrawCache(){const n=this.pn().meshes;for(const y of n)if(y.Lh)for(const n of y.Lh)n.Sn()===this&&n.resetDrawCache()}_markAllSubMeshesAsDirty(n){const y=this.pn();if(y.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const H=y.meshes;for(const o of H)if(o.Lh)for(const H of o.Lh){if((H.Sn()||(y._hasDefaultMaterial?y.defaultMaterial:null))===this)for(const y of H._drawWrappers)y&&y.defines&&y.defines.markAllAsDirty&&this._materialContext===y.materialContext&&n(y.defines)}}_markScenePrePassDirty(){if(this.pn().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const n=this.pn().enablePrePassRenderer();n&&n.ZV()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(z._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(z._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(z._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(z._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(z._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(z._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(z._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(z._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(z._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(z._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const n=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.ah.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(n)}))}}setPrePassRenderer(n){return!1}dispose(n,y,H){const o=this.pn();if(o.stopAnimation(this),o.freeProcessedMaterials(),o.removeMaterial(this),this._eventInfo.forceDisposeTextures=y,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const n=this._parentContainer.materials.indexOf(this);n>-1&&this._parentContainer.materials.splice(n,1),this._parentContainer=null}if(!0!==H)if(this.meshMap)for(const G in this.meshMap){const n=this.meshMap[G];this._disposeMeshResources(n)}else{const n=o.meshes;for(const y of n)this._disposeMeshResources(y)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.ah.notifyObservers(this),this.ah.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(n){if(!n)return;const y=n.li,H=n._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(n.Lh&&H)for(const G of n.Lh){const n=G._drawWrappers;for(let h=0;h<n.length;h++){var o;const k=null===(o=n[h])||void 0===o?void 0:o.effect;if(!k)continue;H[h]===this&&(null===y||void 0===y||y._releaseVertexArrayObject(k),G._removeDrawWrapper(h,!0,!0))}}}else null===y||void 0===y||y._releaseVertexArrayObject(this._drawWrapper.effect);n.material!==this||n.sourceMesh||(n.material=null)}serialize(){const n=U.c.Serialize(this);return n.stencil=this.stencil.serialize(),n.uniqueId=this.uniqueId,this._serializePlugins(n),n}_serializePlugins(n){if(n.plugins={},this.pluginManager)for(const y of this.pluginManager._plugins)y.doNotSerialize||(n.plugins[y.getClassName()]=y.serialize())}static Parse(n,y,H){if(n.customType){if("BABYLON.PBRMaterial"===n.customType&&n.overloadedAlbedo&&(n.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return q.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else n.customType="BABYLON.StandardMaterial";const o=h.Tools.Instantiate(n.customType).Parse(n,y,H);return o._loadedUniqueId=n.uniqueId,o}static _ParsePlugins(n,y,H,o){if(n.plugins)for(const i in n.plugins){var G,k;const B=n.plugins[i];let V=null===(G=y.pluginManager)||void 0===G?void 0:G.getPlugin(B.name);if(!V){const n=h.Tools.Instantiate("BABYLON."+i);n&&(V=new n(y))}null===(k=V)||void 0===k||k.parse(B,H,o)}}}z.TriangleFillMode=0,z.WireFrameFillMode=1,z.PointFillMode=2,z.PointListDrawMode=3,z.LineListDrawMode=4,z.LineLoopDrawMode=5,z.LineStripDrawMode=6,z.TriangleStripDrawMode=7,z.TriangleFanDrawMode=8,z.ClockWiseSideOrientation=0,z.CounterClockWiseSideOrientation=1,z.ImageProcessingDirtyFlag=64,z.TextureDirtyFlag=1,z.LightDirtyFlag=2,z.FresnelDirtyFlag=4,z.AttributesDirtyFlag=8,z.MiscDirtyFlag=16,z.PrePassDirtyFlag=32,z.AllDirtyFlag=127,z.MATERIAL_OPAQUE=0,z.MATERIAL_ALPHATEST=1,z.MATERIAL_ALPHABLEND=2,z.MATERIAL_ALPHATESTANDBLEND=3,z.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,z.MATERIAL_NORMALBLENDMETHOD_RNM=1,z.OnEventObservable=new k.c,z._AllDirtyCallBack=n=>n.markAllAsDirty(),z._ImageProcessingDirtyCallBack=n=>n.markAsImageProcessingDirty(),z._TextureDirtyCallBack=n=>n.markAsTexturesDirty(),z._FresnelDirtyCallBack=n=>n.markAsFresnelDirty(),z._MiscDirtyCallBack=n=>n.markAsMiscDirty(),z._PrePassDirtyCallBack=n=>n.markAsPrePassDirty(),z._LightsDirtyCallBack=n=>n.markAsLightDirty(),z._AttributeDirtyCallBack=n=>n.markAsAttributesDirty(),z._FresnelAndMiscDirtyCallBack=n=>{z._FresnelDirtyCallBack(n),z._MiscDirtyCallBack(n)},z._TextureAndMiscDirtyCallBack=n=>{z._TextureDirtyCallBack(n),z._MiscDirtyCallBack(n)},z._DirtyCallbackArray=[],z._RunDirtyCallBacks=n=>{for(const y of z._DirtyCallbackArray)y(n)},(0,o.e)([(0,G.J)()],z.prototype,"id",void 0),(0,o.e)([(0,G.J)()],z.prototype,"uniqueId",void 0),(0,o.e)([(0,G.J)()],z.prototype,"name",void 0),(0,o.e)([(0,G.J)()],z.prototype,"metadata",void 0),(0,o.e)([(0,G.J)()],z.prototype,"checkReadyOnEveryCall",void 0),(0,o.e)([(0,G.J)()],z.prototype,"checkReadyOnlyOnce",void 0),(0,o.e)([(0,G.J)()],z.prototype,"state",void 0),(0,o.e)([(0,G.J)("alpha")],z.prototype,"_alpha",void 0),(0,o.e)([(0,G.J)("gi")],z.prototype,"_backFaceCulling",void 0),(0,o.e)([(0,G.J)("cullBackFaces")],z.prototype,"_cullBackFaces",void 0),(0,o.e)([(0,G.J)()],z.prototype,"sideOrientation",void 0),(0,o.e)([(0,G.J)("alphaMode")],z.prototype,"_alphaMode",void 0),(0,o.e)([(0,G.J)()],z.prototype,"_needDepthPrePass",void 0),(0,o.e)([(0,G.J)()],z.prototype,"disableDepthWrite",void 0),(0,o.e)([(0,G.J)()],z.prototype,"disableColorWrite",void 0),(0,o.e)([(0,G.J)()],z.prototype,"forceDepthWrite",void 0),(0,o.e)([(0,G.J)()],z.prototype,"depthFunction",void 0),(0,o.e)([(0,G.J)()],z.prototype,"separateCullingPass",void 0),(0,o.e)([(0,G.J)("fogEnabled")],z.prototype,"_fogEnabled",void 0),(0,o.e)([(0,G.J)()],z.prototype,"pointSize",void 0),(0,o.e)([(0,G.J)()],z.prototype,"zOffset",void 0),(0,o.e)([(0,G.J)()],z.prototype,"zOffsetUnits",void 0),(0,o.e)([(0,G.J)()],z.prototype,"pointsCloud",null),(0,o.e)([(0,G.J)()],z.prototype,"fillMode",null),(0,o.e)([(0,G.J)()],z.prototype,"useLogarithmicDepth",null),(0,o.e)([(0,G.J)()],z.prototype,"transparencyMode",null)},11705:(n,y,H)=>{H.d(y,{$:()=>j,A:()=>f,B:()=>c,E:()=>U,I:()=>A,K:()=>O,O:()=>a,S:()=>X,U:()=>Q,V:()=>E,X:()=>e,Y:()=>w,bb:()=>R,c:()=>F,cb:()=>T,g:()=>b,k:()=>M,m:()=>q,n:()=>W,o:()=>z,r:()=>l,u:()=>p,x:()=>v});var o=H(11114),G=H(11335),h=H(11149),k=H(11640),i=H(11710);const B=G.Fy.Black(),V={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function q(n,y,H){if(!n||n.LOGARITHMICDEPTH||n.indexOf&&n.indexOf("LOGARITHMICDEPTH")>=0){const n=H.activeCamera;1===n.mode&&o.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),y.setFloat("logarithmicDepthConstant",2/(Math.log(n.maxZ+1)/Math.LN2))}}function b(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];H&&n.fogEnabled&&(!y||y.applyFog)&&0!==n.fogMode&&(H.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),o?(n.fogColor.toLinearSpaceToRef(B,n.getEngine().useExactSrgbConversions),H.setColor3("vFogColor",B)):H.setColor3("vFogColor",n.fogColor))}function A(n,y,H,o,G,h,k,i,B,q){const b=n.numMaxInfluencers||n.numInfluencers;return b<=0?0:(y.push("#define MORPHTARGETS"),n.hasPositions&&y.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),n.hasNormals&&y.push("#define MORPHTARGETTEXTURE_HASNORMALS"),n.hasTangents&&y.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),n.hasUVs&&y.push("#define MORPHTARGETTEXTURE_HASUVS"),n.hasUV2s&&y.push("#define MORPHTARGETTEXTURE_HASUV2S"),n.hasColors&&y.push("#define MORPHTARGETTEXTURE_HASCOLORS"),n.supportsPositions&&G&&y.push("#define MORPHTARGETS_POSITION"),n.supportsNormals&&h&&y.push("#define MORPHTARGETS_NORMAL"),n.supportsTangents&&k&&y.push("#define MORPHTARGETS_TANGENT"),n.supportsUVs&&i&&y.push("#define MORPHTARGETS_UV"),n.supportsUV2s&&B&&y.push("#define MORPHTARGETS_UV2"),n.supportsColors&&q&&y.push("#define MORPHTARGETS_COLOR"),y.push("#define NUM_MORPH_INFLUENCERS "+b),n.isUsingTextureForTargets&&y.push("#define MORPHTARGETS_TEXTURE"),V.NUM_MORPH_INFLUENCERS=b,V.NORMAL=h,V.TANGENT=k,V.UV=i,V.UV2=B,V.COLOR=q,U(H,o,V,G),b)}function U(n,y,H){let G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=H.NUM_MORPH_INFLUENCERS;if(k>0&&h.c.LastCreatedEngine){const i=h.c.LastCreatedEngine.getCaps().maxVertexAttribs,B=y.morphTargetManager;if(null!==B&&void 0!==B&&B.isUsingTextureForTargets)return;const V=B&&B.supportsPositions&&G,q=B&&B.supportsNormals&&H.NORMAL,b=B&&B.supportsTangents&&H.TANGENT,A=B&&B.supportsUVs&&H.UV1,U=B&&B.supportsUV2s&&H.UV2,T=B&&B.supportsColors&&H.VERTEXCOLOR;for(let H=0;H<k;H++)V&&n.push("position"+H),q&&n.push("normal"+H),b&&n.push("tangent"+H),A&&n.push("uv_"+H),U&&n.push("uv2_"+H),T&&n.push("color"+H),n.length>i&&o.d.Error("Cannot add more vertex attributes for mesh "+y.name)}}function T(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"),y&&(n.push("previousWorld0"),n.push("previousWorld1"),n.push("previousWorld2"),n.push("previousWorld3"))}function W(n,y){const H=n.morphTargetManager;n&&H&&y.setFloatArray("morphTargetInfluences",H.influences)}function z(n,y){y.bindToEffect(n,"Scene")}function Q(n,y,H){y._needUVs=!0,y[H]=!0,n.optimizeUVAllocation&&n.getTextureMatrix().isIdentityAs3x2()?(y[H+"DIRECTUV"]=n.coordinatesIndex+1,y["MAINUV"+(n.coordinatesIndex+1)]=!0):y[H+"DIRECTUV"]=0}function l(n,y,H){const o=n.getTextureMatrix();y.zi(H+"Matrix",o)}function v(n,y,H){H.BAKED_VERTEX_ANIMATION_TEXTURE&&H.INSTANCES&&n.push("bakedVertexAnimationSettingsInstanced")}function F(n,y,H){var o;if(y&&n&&(n.computeBonesUsingShaders&&y._bonesComputationForcedToCPU&&(n.computeBonesUsingShaders=!1),n.useBones&&n.computeBonesUsingShaders&&n.skeleton)){const G=n.skeleton;if(G.isUsingTextureForMatrices&&y.getUniformIndex("boneTextureWidth")>-1){const H=G.getTransformMatrixTexture(n);y.setTexture("boneSampler",H),y.setFloat("boneTextureWidth",4*(G.bones.length+1))}else{const h=G.getTransformMatrices(n);h&&(y.setMatrices("mBones",h),H&&n.pn().prePassRenderer&&n.pn().prePassRenderer.getIndex(2)&&(H.previousBones[n.uniqueId]||(H.previousBones[n.uniqueId]=h.slice()),y.setMatrices("mPreviousBones",H.previousBones[n.uniqueId]),o=h,H.previousBones[n.uniqueId].set(o)))}}}function g(n,y,H,o,G){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];n._bindLight(y,H,o,G,h)}function M(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const h=Math.min(y.lightSources.length,G);for(let k=0;k<h;k++){g(y.lightSources[k],k,n,H,"boolean"===typeof o?o:o.SPECULARTERM,y.receiveShadows)}}function f(n,y,H,o){H.NUM_BONE_INFLUENCERS>0&&(o.addCPUSkinningFallback(0,y),n.push("matricesIndices"),n.push("matricesWeights"),H.NUM_BONE_INFLUENCERS>4&&(n.push("matricesIndicesExtra"),n.push("matricesWeightsExtra")))}function c(n,y){(y.INSTANCES||y.THIN_INSTANCES)&&T(n,!!y.PREPASS_VELOCITY),y.INSTANCESCOLOR&&n.push("instanceColor")}function p(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=0;for(let h=0;h<H&&n["LIGHT"+h];h++)h>0&&(G=o+h,y.addFallback(G,"LIGHT"+h)),n.SHADOWS||(n["SHADOW"+h]&&y.addFallback(o,"SHADOW"+h),n["SHADOWPCF"+h]&&y.addFallback(o,"SHADOWPCF"+h),n["SHADOWPCSS"+h]&&y.addFallback(o,"SHADOWPCSS"+h),n["SHADOWPOISSON"+h]&&y.addFallback(o,"SHADOWPOISSON"+h),n["SHADOWESM"+h]&&y.addFallback(o,"SHADOWESM"+h),n["SHADOWCLOSEESM"+h]&&y.addFallback(o,"SHADOWCLOSEESM"+h));return G++}function E(n,y,H,o,G,h,k){let i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];k._areMiscDirty&&(k.LOGARITHMICDEPTH=H,k.POINTSIZE=o,k.FOG=G&&function(n,y){return y.fogEnabled&&n.applyFog&&0!==y.fogMode}(n,y),k.NONUNIFORMSCALING=n.nonUniformScaling,k.ALPHATEST=h,k.DECAL_AFTER_DETAIL=i)}function X(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H._areLightsDirty)return H._needNormals;let k=0;const i={needNormals:H._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(n.lightsEnabled&&!h)for(const V of y.lightSources)if(d(n,y,V,k,H,o,i),k++,k===G)break;H.SPECULARTERM=i.specularEnabled,H.SHADOWS=i.shadowEnabled;for(let V=k;V<G;V++)void 0!==H["LIGHT"+V]&&(H["LIGHT"+V]=!1,H["HEMILIGHT"+V]=!1,H["POINTLIGHT"+V]=!1,H["DIRLIGHT"+V]=!1,H["SPOTLIGHT"+V]=!1,H["AREALIGHT"+V]=!1,H["SHADOW"+V]=!1,H["SHADOWCSM"+V]=!1,H["SHADOWCSMDEBUG"+V]=!1,H["SHADOWCSMNUM_CASCADES"+V]=!1,H["SHADOWCSMUSESHADOWMAXZ"+V]=!1,H["SHADOWCSMNOBLEND"+V]=!1,H["SHADOWCSM_RIGHTHANDED"+V]=!1,H["SHADOWPCF"+V]=!1,H["SHADOWPCSS"+V]=!1,H["SHADOWPOISSON"+V]=!1,H["SHADOWESM"+V]=!1,H["SHADOWCLOSEESM"+V]=!1,H["SHADOWCUBE"+V]=!1,H["SHADOWLOWQUALITY"+V]=!1,H["SHADOWMEDIUMQUALITY"+V]=!1);const B=n.getEngine().getCaps();return void 0===H.SHADOWFLOAT&&(i.needRebuild=!0),H.SHADOWFLOAT=i.shadowEnabled&&(B.textureFloatRender&&B.textureFloatLinearFiltering||B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering),H.LIGHTMAPEXCLUDED=i.lightmapMode,i.needRebuild&&H.rebuild(),i.needNormals}function d(n,y,H,o,G,h,i){switch(i.needNormals=!0,void 0===G["LIGHT"+o]&&(i.needRebuild=!0),G["LIGHT"+o]=!0,G["SPOTLIGHT"+o]=!1,G["HEMILIGHT"+o]=!1,G["POINTLIGHT"+o]=!1,G["DIRLIGHT"+o]=!1,G["AREALIGHT"+o]=!1,H.prepareLightSpecificDefines(G,o),G["LIGHT_FALLOFF_PHYSICAL"+o]=!1,G["LIGHT_FALLOFF_GLTF"+o]=!1,G["LIGHT_FALLOFF_STANDARD"+o]=!1,H.falloffType){case k.c.FALLOFF_GLTF:G["LIGHT_FALLOFF_GLTF"+o]=!0;break;case k.c.FALLOFF_PHYSICAL:G["LIGHT_FALLOFF_PHYSICAL"+o]=!0;break;case k.c.FALLOFF_STANDARD:G["LIGHT_FALLOFF_STANDARD"+o]=!0}if(h&&!H.Uq.equalsFloats(0,0,0)&&(i.specularEnabled=!0),G["SHADOW"+o]=!1,G["SHADOWCSM"+o]=!1,G["SHADOWCSMDEBUG"+o]=!1,G["SHADOWCSMNUM_CASCADES"+o]=!1,G["SHADOWCSMUSESHADOWMAXZ"+o]=!1,G["SHADOWCSMNOBLEND"+o]=!1,G["SHADOWCSM_RIGHTHANDED"+o]=!1,G["SHADOWPCF"+o]=!1,G["SHADOWPCSS"+o]=!1,G["SHADOWPOISSON"+o]=!1,G["SHADOWESM"+o]=!1,G["SHADOWCLOSEESM"+o]=!1,G["SHADOWCUBE"+o]=!1,G["SHADOWLOWQUALITY"+o]=!1,G["SHADOWMEDIUMQUALITY"+o]=!1,y&&y.receiveShadows&&n.shadowsEnabled&&H.shadowEnabled){const y=H.getShadowGenerator(n.activeCamera)??H.getShadowGenerator();if(y){const n=y.getShadowMap();n&&n.renderList&&n.renderList.length>0&&(i.shadowEnabled=!0,y.prepareDefines(G,o))}}H.lightmapMode!=k.c.LIGHTMAP_DEFAULT?(i.lightmapMode=!0,G["LIGHTMAPEXCLUDED"+o]=!0,G["LIGHTMAPNOSPECULAR"+o]=H.lightmapMode==k.c.LIGHTMAP_SHADOWSONLY):(G["LIGHTMAPEXCLUDED"+o]=!1,G["LIGHTMAPNOSPECULAR"+o]=!1)}function a(n,y,H,o,G){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=function(n,y){let H=!1;if(n.activeCamera){const o=y.CAMERA_ORTHOGRAPHIC?1:0,G=y.CAMERA_PERSPECTIVE?1:0,h=1===n.activeCamera.mode?1:0,k=0===n.activeCamera.mode?1:0;(o^h||G^k)&&(y.CAMERA_ORTHOGRAPHIC=1===h,y.CAMERA_PERSPECTIVE=1===k,H=!0)}return H}(n,o);!1!==h&&(B=(0,i.l)(H,n,o)),o.DEPTHPREPASS!==!y.getColorWrite()&&(o.DEPTHPREPASS=!o.DEPTHPREPASS,B=!0),o.INSTANCES!==G&&(o.INSTANCES=G,B=!0),o.THIN_INSTANCES!==k&&(o.THIN_INSTANCES=k,B=!0),B&&o.markAsUnprocessed()}function O(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!y._areAttributesDirty&&y._needNormals===y._normals&&y._needUVs===y._uvs)return!1;y._normals=y._needNormals,y._uvs=y._needUVs,y.NORMAL=y._needNormals&&n.isVerticesDataPresent("normal"),y._needNormals&&n.isVerticesDataPresent("tangent")&&(y.TANGENT=!0);for(let i=1;i<=6;++i)y["UV"+i]=!!y._needUVs&&n.isVerticesDataPresent(`uv${1===i?"":i}`);if(H){const H=n.useVertexColors&&n.isVerticesDataPresent("color");y.VERTEXCOLOR=H,y.VERTEXALPHA=n.hasVertexAlpha&&H&&h}return n.isVerticesDataPresent("instanceColor")&&(n.hasInstances||n.hasThinInstances)&&(y.INSTANCESCOLOR=!0),o&&function(n,y){if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){y.NUM_BONE_INFLUENCERS=n.numBoneInfluencers;const H=void 0!==y.BONETEXTURE;if(n.skeleton.isUsingTextureForMatrices&&H)y.BONETEXTURE=!0;else{y.BonesPerMesh=n.skeleton.bones.length+1,y.BONETEXTURE=!H&&void 0;const o=n.pn().prePassRenderer;if(o&&o.enabled){const H=-1===o.excludedSkinnedMesh.indexOf(n);y.BONES_VELOCITY_ENABLED=H}}}else y.NUM_BONE_INFLUENCERS=0,y.BonesPerMesh=0,void 0!==y.BONETEXTURE&&(y.BONETEXTURE=!1)}(n,y),G&&function(n,y){const H=n.morphTargetManager;H?(y.MORPHTARGETS_UV=H.supportsUVs&&y.UV1,y.MORPHTARGETS_UV2=H.supportsUV2s&&y.UV2,y.MORPHTARGETS_TANGENT=H.supportsTangents&&y.TANGENT,y.MORPHTARGETS_NORMAL=H.supportsNormals&&y.NORMAL,y.MORPHTARGETS_POSITION=H.supportsPositions,y.MORPHTARGETS_COLOR=H.supportsColors,y.MORPHTARGETTEXTURE_HASUVS=H.hasUVs,y.MORPHTARGETTEXTURE_HASUV2S=H.hasUV2s,y.MORPHTARGETTEXTURE_HASTANGENTS=H.hasTangents,y.MORPHTARGETTEXTURE_HASNORMALS=H.hasNormals,y.MORPHTARGETTEXTURE_HASPOSITIONS=H.hasPositions,y.MORPHTARGETTEXTURE_HASCOLORS=H.hasColors,y.NUM_MORPH_INFLUENCERS=H.numMaxInfluencers||H.numInfluencers,y.MORPHTARGETS=y.NUM_MORPH_INFLUENCERS>0,y.MORPHTARGETS_TEXTURE=H.isUsingTextureForTargets):(y.MORPHTARGETS_UV=!1,y.MORPHTARGETS_UV2=!1,y.MORPHTARGETS_TANGENT=!1,y.MORPHTARGETS_NORMAL=!1,y.MORPHTARGETS_POSITION=!1,y.MORPHTARGETS_COLOR=!1,y.MORPHTARGETTEXTURE_HASUVS=!1,y.MORPHTARGETTEXTURE_HASUV2S=!1,y.MORPHTARGETTEXTURE_HASTANGENTS=!1,y.MORPHTARGETTEXTURE_HASNORMALS=!1,y.MORPHTARGETTEXTURE_HASPOSITIONS=!1,y.MORPHTARGETTEXTURE_HAS_COLORS=!1,y.MORPHTARGETS=!1,y.NUM_MORPH_INFLUENCERS=0)}(n,y),k&&function(n,y){const H=n.bakedVertexAnimationManager;y.BAKED_VERTEX_ANIMATION_TEXTURE=!(!H||!H.isEnabled)}(n,y),!0}function e(n,y){if(n.activeCamera){const H=y.MULTIVIEW;y.MULTIVIEW=null!==n.activeCamera.outputRenderTarget&&n.activeCamera.outputRenderTarget.getViewCount()>1,y.MULTIVIEW!=H&&y.markAsUnprocessed()}}function w(n,y,H){const o=y.ORDER_INDEPENDENT_TRANSPARENCY,G=y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;y.ORDER_INDEPENDENT_TRANSPARENCY=n.useOrderIndependentTransparency&&H,y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!n.getEngine().getCaps().textureFloatLinearFiltering,o===y.ORDER_INDEPENDENT_TRANSPARENCY&&G===y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||y.markAsUnprocessed()}function j(n,y,H){const o=y.PREPASS;if(!y._arePrePassDirty)return;const G=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(n.prePassRenderer&&n.prePassRenderer.enabled&&H){y.PREPASS=!0,y.SCENE_MRT_COUNT=n.prePassRenderer.mrtCount,y.PREPASS_NORMAL_WORLDSPACE=n.prePassRenderer.generateNormalsInWorldSpace,y.PREPASS_COLOR=!0,y.PREPASS_COLOR_INDEX=0;for(let H=0;H<G.length;H++){const o=n.prePassRenderer.getIndex(G[H].type);-1!==o?(y[G[H].define]=!0,y[G[H].index]=o):y[G[H].define]=!1}}else{y.PREPASS=!1;for(let n=0;n<G.length;n++)y[G[n].define]=!1}y.PREPASS!=o&&(y.markAsUnprocessed(),y.markAsImageProcessingDirty())}function I(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];G&&G.push("Light"+n),h||(y.push("vLightData"+n,"vLightDiffuse"+n,"vLightSpecular"+n,"vLightDirection"+n,"vLightWidth"+n,"vLightHeight"+n,"vLightFalloff"+n,"vLightGround"+n,"lightMatrix"+n,"shadowsInfo"+n,"depthValues"+n),H.push("shadowTexture"+n),H.push("depthTexture"+n),y.push("viewFrustumZ"+n,"cascadeBlendFactor"+n,"lightSizeUVCorrection"+n,"depthCorrection"+n,"penumbraDarkness"+n,"frustumLengths"+n),o&&(H.push("projectionLightTexture"+n),y.push("textureProjectionMatrix"+n)),k&&H.push("iesLightTexture"+n))}function R(n,y,H){let o,G,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(n.uniformsNames){const k=n;o=k.uniformsNames,G=k.uniformBuffersNames,y=k.samplers,H=k.defines,h=k.maxSimultaneousLights||0}else o=n,y||(y=[]);for(let k=0;k<h&&H["LIGHT"+k];k++)I(k,o,y,H["PROJECTEDLIGHTTEXTURE"+k],G,!1,H["IESLIGHTTEXTURE"+k]);H.NUM_MORPH_INFLUENCERS&&(o.push("morphTargetInfluences"),o.push("morphTargetCount")),H.BAKED_VERTEX_ANIMATION_TEXTURE&&(o.push("bakedVertexAnimationSettings"),o.push("bakedVertexAnimationTextureSizeInverted"),o.push("bakedVertexAnimationTime"),y.push("bakedVertexAnimationTexture"))}},11649:(n,y,H)=>{H.d(y,{d:()=>h});var o=H(11288),G=H(11658);class h extends G.e{constructor(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(n,y,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new o.Matrix,this._storeEffectOnSubMeshes=H}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(n,y){return!!n&&(!this._storeEffectOnSubMeshes||(!n.Lh||0===n.Lh.length||this.isReadyForSubMesh(n,n.Lh[0],y)))}_isReadyForSubMesh(n){const y=n.materialDefines;return!(this.checkReadyOnEveryCall||!n.effect||!y||y._renderId!==this.pn().getRenderId())}bindOnlyWorldMatrix(n){this._activeEffect.setMatrix("world",n)}bindOnlyNormalMatrix(n){this._activeEffect.setMatrix("normalMatrix",n)}bind(n,y){y&&this.bindForSubMesh(n,y,y.Lh[0])}_afterBind(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;super._afterBind(n,y,H),this.pn()._cachedEffect=y,H?H._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return H._drawWrapper._forceRebindOnNextCall||n.isCachedMaterialInvalid(this,y,o)}dispose(n,y,H){this._activeEffect=void 0,super.dispose(n,y,H)}}},11700:(n,y,H)=>{H.d(y,{e:()=>i,i:()=>B});var o=H(11278),G=H(11288),h=H(11280);class k{static extractMinAndMaxIndexed(n,y,H,o,G,h){for(let k=H;k<H+o;k++){const H=3*y[k],o=n[H],i=n[H+1],B=n[H+2];G.minimizeInPlaceFromFloats(o,i,B),h.maximizeInPlaceFromFloats(o,i,B)}}static extractMinAndMax(n,y,H,o,G,h){for(let k=y,i=y*o;k<y+H;k++,i+=o){const y=n[i],H=n[i+1],o=n[i+2];G.minimizeInPlaceFromFloats(y,H,o),h.maximizeInPlaceFromFloats(y,H,o)}}}function i(n,y,H,o){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const i=new G.zy(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new G.zy(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return k.extractMinAndMaxIndexed(n,y,H,o,i,B),h&&(i.x-=i.x*h.x+h.y,i.y-=i.y*h.x+h.y,i.z-=i.z*h.x+h.y,B.x+=B.x*h.x+h.y,B.y+=B.y*h.x+h.y,B.z+=B.z*h.x+h.y),{minimum:i,maximum:B}}function B(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;const i=new G.zy(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new G.zy(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h||(h=3),k.extractMinAndMax(n,y,H,h,i,B),o&&(i.x-=i.x*o.x+o.y,i.y-=i.y*o.x+o.y,i.z-=i.z*o.x+o.y,B.x+=B.x*o.x+o.y,B.y+=B.y*o.x+o.y,B.z+=B.z*o.x+o.y),{minimum:i,maximum:B}}(0,o.e)([h.e.filter((function(){for(var n=arguments.length,y=new Array(n),H=0;H<n;H++)y[H]=arguments[H];let[o,G]=y;return!Array.isArray(o)&&!Array.isArray(G)}))],k,"extractMinAndMaxIndexed",null),(0,o.e)([h.e.filter((function(){for(var n=arguments.length,y=new Array(n),H=0;H<n;H++)y[H]=arguments[H];let[o]=y;return!Array.isArray(o)}))],k,"extractMinAndMax",null)},11667:(n,y,H)=>{H.d(y,{c:()=>B});var o=H(11360),G=H(11672),h=H(11680),k=H(11700),i=H(11425);class B{get materialDefines(){var n;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(n=this._getDrawWrapper())||void 0===n?void 0:n.defines}set materialDefines(n){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=n}_getDrawWrapper(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n??this._engine.currentRenderPassId;let H=this._drawWrappers[n];return!H&&y&&(this._drawWrappers[n]=H=new i.b(this._mesh.pn().getEngine())),H}_removeDrawWrapper(n){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var H;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(H=this._drawWrappers[n])||void 0===H||H.dispose(y));this._drawWrappers[n]=void 0}get effect(){var n;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(n=this._getDrawWrapper())||void 0===n?void 0:n.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(n){this._mainDrawWrapperOverride=n}setEffect(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=this._drawWrapper;G.setEffect(n,y,o),void 0!==H&&(G.materialContext=H),n||(G.defines=null,G.materialContext=void 0)}resetDrawCache(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==n)return void this._removeDrawWrapper(n,!0,y);for(const n of this._drawWrappers)null===n||void 0===n||n.dispose(y)}this._drawWrappers=[]}static AddToMesh(n,y,H,o,G,h,k){return new B(n,y,H,o,G,h,k,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(n,y,H,o,G,h,k){let i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],B=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=n,this.verticesStart=y,this.verticesCount=H,this.indexStart=o,this.indexCount=G,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=k||h,B&&h.Lh.push(this),this._engine=this._mesh.pn().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=h.Lh.length-1,i&&(this.refreshBoundingInfo(),h.Qi(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(n){return this._boundingInfo=n,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const n=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return n||this._renderingMesh}Sn(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const y=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!y)return n&&this._mesh.pn()._hasDefaultMaterial?this._mesh.pn().defaultMaterial:null;if(this._isMultiMaterial(y)){const n=y.getSubMaterial(this.materialIndex);return this._currentMaterial!==n&&(this._currentMaterial=n,this.resetDrawCache()),n}return y}_isMultiMaterial(n){return void 0!==n.getSubMaterial}refreshBoundingInfo(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.li)return this;if(n||(n=this._renderingMesh.getVerticesData(o.g.PositionKind)),!n)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const y=this._renderingMesh.Fi();let H;if(0===this.indexStart&&this.indexCount===y.length){const n=this._renderingMesh.getBoundingInfo();H={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else H=(0,k.e)(n,y,this.indexStart,this.indexCount,this._renderingMesh.li.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(H.minimum,H.maximum):this._boundingInfo=new h.c(H.minimum,H.maximum),this}_checkCollision(n){return this.getBoundingInfo()._checkCollision(n)}updateBoundingInfo(n){let y=this.getBoundingInfo();return y||(this.refreshBoundingInfo(),y=this.getBoundingInfo()),y&&y.update(n),this}isInFrustum(n){const y=this.getBoundingInfo();return!!y&&y.isInFrustum(n,this._mesh.oA)}isCompletelyInFrustum(n){const y=this.getBoundingInfo();return!!y&&y.isCompletelyInFrustum(n)}render(n){return this._renderingMesh.render(this,n,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(n,y){if(!this._linesIndexBuffer){const H=6*Math.floor(this.indexCount/3),o=this.verticesStart+this.verticesCount>65535?new Uint32Array(H):new Uint16Array(H);let G=0;if(0===n.length)for(let n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)o[G++]=n,o[G++]=n+1,o[G++]=n+1,o[G++]=n+2,o[G++]=n+2,o[G++]=n;else for(let y=this.indexStart;y<this.indexStart+this.indexCount;y+=3)o[G++]=n[y],o[G++]=n[y+1],o[G++]=n[y+1],o[G++]=n[y+2],o[G++]=n[y+2],o[G++]=n[y];this._linesIndexBuffer=y.createIndexBuffer(o),this._linesIndexCount=o.length}return this._linesIndexBuffer}canIntersects(n){const y=this.getBoundingInfo();return!!y&&n.intersectsBox(y.boundingBox)}intersects(n,y,H,o,G){const h=this.Sn();if(!h)return null;let k=3,i=!1;switch(h.fillMode){case 3:case 5:case 6:case 8:return null;case 7:k=1,i=!0}return 4===h.fillMode?H.length?this._intersectLines(n,y,H,this._mesh.intersectionThreshold,o):this._intersectUnIndexedLines(n,y,H,this._mesh.intersectionThreshold,o):!H.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(n,y,H,o,G):this._intersectTriangles(n,y,H,k,i,o,G)}_intersectLines(n,y,H,o,h){let k=null;for(let i=this.indexStart;i<this.indexStart+this.indexCount;i+=2){const B=y[H[i]],V=y[H[i+1]],q=n.intersectionSegment(B,V,o);if(!(q<0)&&((h||!k||q<k.distance)&&(k=new G.b(null,null,q),k.faceId=i/2,h)))break}return k}_intersectUnIndexedLines(n,y,H,o,h){let k=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){const H=y[i],B=y[i+1],V=n.intersectionSegment(H,B,o);if(!(V<0)&&((h||!k||V<k.distance)&&(k=new G.b(null,null,V),k.faceId=i/2,h)))break}return k}_intersectTriangles(n,y,H,o,G,h,k){let i=null,B=-1;for(let V=this.indexStart;V<this.indexStart+this.indexCount-(3-o);V+=o){B++;const o=H[V],q=H[V+1],b=H[V+2];if(G&&4294967295===b){V+=2;continue}const A=y[o],U=y[q],T=y[b];if(!A||!U||!T)continue;if(k&&!k(A,U,T,n,o,q,b))continue;const W=n.intersectsTriangle(A,U,T);if(W){if(W.distance<0)continue;if((h||!i||W.distance<i.distance)&&(i=W,i.faceId=B,h))break}}return i}_intersectUnIndexedTriangles(n,y,H,o,G){let h=null;for(let k=this.verticesStart;k<this.verticesStart+this.verticesCount;k+=3){const H=y[k],i=y[k+1],B=y[k+2];if(G&&!G(H,i,B,n,-1,-1,-1))continue;const V=n.intersectsTriangle(H,i,B);if(V){if(V.distance<0)continue;if((o||!h||V.distance<h.distance)&&(h=V,h.faceId=k/3,o))break}}return h}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(n,y){const H=new B(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,n,y,!1);if(!this.IsGlobal){const n=this.getBoundingInfo();if(!n)return H;H._boundingInfo=new h.c(n.minimum,n.maximum)}return H}dispose(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.pn().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const y=this._mesh.Lh.indexOf(this);this._mesh.Lh.splice(y,1),this.resetDrawCache(void 0,n)}getClassName(){return"SubMesh"}static CreateFromIndices(n,y,H,o,G){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=Number.MAX_VALUE,i=-Number.MAX_VALUE;const V=(G||o).Fi();for(let B=y;B<y+H;B++){const n=V[B];n<k&&(k=n),n>i&&(i=n)}return new B(n,k,i-k+1,y,H,o,G,h)}}}}]);