"use strict";(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[24],{12066:(K,O,F)=>{F.d(O,{c:()=>f});class f{constructor(K,O,F){this.bu=K,this.bv=O,this.distance=F,this.faceId=0,this.subMeshId=0}}},12079:(K,O,F)=>{F.d(O,{b:()=>q});var f=F(11729),r=F(11713),l=F(11721);class q{constructor(K,O,F){this.vectors=(0,f.c)(8,r.TO.Zero),this.center=r.TO.Zero(),this.centerWorld=r.TO.Zero(),this.extendSize=r.TO.Zero(),this.extendSizeWorld=r.TO.Zero(),this.directions=(0,f.c)(3,r.TO.Zero),this.vectorsWorld=(0,f.c)(8,r.TO.Zero),this.minimumWorld=r.TO.Zero(),this.maximumWorld=r.TO.Zero(),this.minimum=r.TO.Zero(),this.maximum=r.TO.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(K,O,F)}reConstruct(K,O,F){const f=K.x,l=K.y,q=K.z,J=O.x,c=O.y,E=O.z,M=this.vectors;this.minimum.eq(f,l,q),this.maximum.eq(J,c,E),M[0].eq(f,l,q),M[1].eq(J,c,E),M[2].eq(J,l,q),M[3].eq(f,c,q),M[4].eq(f,l,E),M[5].eq(J,c,q),M[6].eq(f,c,E),M[7].eq(J,l,E),O.addToRef(K,this.center).scaleInPlace(.5),O.subtractToRef(K,this.extendSize).scaleInPlace(.5),this._worldMatrix=F||r.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(K){const O=q._TmpVector3,F=this.maximum.subtractToRef(this.minimum,O[0]),f=F.length();F.normalizeFromLength(f);const r=f*K,l=F.scaleInPlace(.5*r),J=this.center.subtractToRef(l,O[1]),c=this.center.addToRef(l,O[2]);return this.reConstruct(J,c,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){const O=this.minimumWorld,F=this.maximumWorld,f=this.directions,l=this.vectorsWorld,q=this.vectors;if(K.isIdentity()){O.l(this.minimum),F.l(this.maximum);for(let K=0;K<8;++K)l[K].l(q[K]);this.extendSizeWorld.l(this.extendSize),this.centerWorld.l(this.center)}else{O.oJ(Number.MAX_VALUE),F.oJ(-Number.MAX_VALUE);for(let f=0;f<8;++f){const J=l[f];r.TO.TransformCoordinatesToRef(q[f],K,J),O.minimizeInPlace(J),F.maximizeInPlace(J)}F.subtractToRef(O,this.extendSizeWorld).scaleInPlace(.5),F.addToRef(O,this.centerWorld).scaleInPlace(.5)}r.TO.FromArrayToRef(K.m,0,f[0]),r.TO.FromArrayToRef(K.m,4,f[1]),r.TO.FromArrayToRef(K.m,8,f[2]),this._worldMatrix=K}isInFrustum(K){return q.IsInFrustum(this.vectorsWorld,K)}isCompletelyInFrustum(K){return q.IsCompletelyInFrustum(this.vectorsWorld,K)}intersectsPoint(K){const O=this.minimumWorld,F=this.maximumWorld,f=O.x,r=O.y,q=O.z,J=F.x,c=F.y,E=F.z,M=K.x,t=K.y,j=K.z,X=-l.e;return!(J-M<X||X>M-f)&&(!(c-t<X||X>t-r)&&!(E-j<X||X>j-q))}intersectsSphere(K){return q.IntersectsSphere(this.minimumWorld,this.maximumWorld,K.centerWorld,K.radiusWorld)}intersectsMinMax(K,O){const F=this.minimumWorld,f=this.maximumWorld,r=F.x,l=F.y,q=F.z,J=f.x,c=f.y,E=f.z,M=K.x,t=K.y,j=K.z,X=O.x,u=O.y,T=O.z;return!(J<M||r>X)&&(!(c<t||l>u)&&!(E<j||q>T))}dispose(){var K,O;null===(K=this._drawWrapperFront)||void 0===K||K.dispose(),null===(O=this._drawWrapperBack)||void 0===O||O.dispose()}static Intersects(K,O){return K.intersectsMinMax(O.minimumWorld,O.maximumWorld)}static IntersectsSphere(K,O,F,f){const l=q._TmpVector3[0];r.TO.ClampToRef(F,K,O,l);return r.TO.DistanceSquared(F,l)<=f*f}static IsCompletelyInFrustum(K,O){for(let F=0;F<6;++F){const f=O[F];for(let O=0;O<8;++O)if(f.dotCoordinate(K[O])<0)return!1}return!0}static IsInFrustum(K,O){for(let F=0;F<6;++F){let f=!0;const r=O[F];for(let O=0;O<8;++O)if(r.dotCoordinate(K[O])>=0){f=!1;break}if(f)return!1}return!0}}q._TmpVector3=(0,f.c)(3,r.TO.Zero)},12072:(K,O,F)=>{F.d(O,{d:()=>t});var f=F(11729),r=F(11713),l=F(12079),q=F(12086);const J={min:0,max:0},c={min:0,max:0},E=(K,O,F)=>{const f=r.TO.Dot(O.centerWorld,K),l=Math.abs(r.TO.Dot(O.directions[0],K))*O.extendSize.x+Math.abs(r.TO.Dot(O.directions[1],K))*O.extendSize.y+Math.abs(r.TO.Dot(O.directions[2],K))*O.extendSize.z;F.min=f-l,F.max=f+l},M=(K,O,F)=>(E(K,O,J),E(K,F,c),!(J.min>c.max||c.min>J.max));class t{constructor(K,O,F){this._isLocked=!1,this.boundingBox=new l.b(K,O,F),this.boundingSphere=new q.b(K,O,F)}reConstruct(K,O,F){this.boundingBox.reConstruct(K,O,F),this.boundingSphere.reConstruct(K,O,F)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(K){this._isLocked=K}update(K){this._isLocked||(this.boundingBox._update(K),this.boundingSphere._update(K))}centerOn(K,O){const F=t._TmpVector3[0].l(K).Qt(O),f=t._TmpVector3[1].l(K).addInPlace(O);return this.boundingBox.reConstruct(F,f,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(F,f,this.boundingBox.getWorldMatrix()),this}encapsulate(K){const O=r.TO.Minimize(this.minimum,K),F=r.TO.Maximize(this.maximum,K);return this.reConstruct(O,F,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(K){const O=r.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(O);const F=r.TmpVectors.TO[0];return r.TO.TransformCoordinatesToRef(K.boundingBox.minimumWorld,O,F),this.encapsulate(F),r.TO.TransformCoordinatesToRef(K.boundingBox.maximumWorld,O,F),this.encapsulate(F),this}scale(K){return this.boundingBox.scale(K),this.boundingSphere.scale(K),this}isInFrustum(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===O||3===O)&&this.boundingSphere.isCenterInFrustum(K))return!0;if(!this.boundingSphere.isInFrustum(K))return!1;return!(1!==O&&3!==O)||this.boundingBox.isInFrustum(K)}get diagonalLength(){const K=this.boundingBox;return K.maximumWorld.subtractToRef(K.minimumWorld,t._TmpVector3[0]).length()}isCompletelyInFrustum(K){return this.boundingBox.isCompletelyInFrustum(K)}_checkCollision(K){return K._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(K){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(K)&&!!this.boundingBox.intersectsPoint(K))}intersects(K,O){if(!q.b.Intersects(this.boundingSphere,K.boundingSphere))return!1;if(!l.b.Intersects(this.boundingBox,K.boundingBox))return!1;if(!O)return!0;const F=this.boundingBox,f=K.boundingBox;return!!M(F.directions[0],F,f)&&(!!M(F.directions[1],F,f)&&(!!M(F.directions[2],F,f)&&(!!M(f.directions[0],F,f)&&(!!M(f.directions[1],F,f)&&(!!M(f.directions[2],F,f)&&(!!M(r.TO.Cross(F.directions[0],f.directions[0]),F,f)&&(!!M(r.TO.Cross(F.directions[0],f.directions[1]),F,f)&&(!!M(r.TO.Cross(F.directions[0],f.directions[2]),F,f)&&(!!M(r.TO.Cross(F.directions[1],f.directions[0]),F,f)&&(!!M(r.TO.Cross(F.directions[1],f.directions[1]),F,f)&&(!!M(r.TO.Cross(F.directions[1],f.directions[2]),F,f)&&(!!M(r.TO.Cross(F.directions[2],f.directions[0]),F,f)&&(!!M(r.TO.Cross(F.directions[2],f.directions[1]),F,f)&&!!M(r.TO.Cross(F.directions[2],f.directions[2]),F,f))))))))))))))}}t._TmpVector3=(0,f.c)(2,r.TO.Zero)},12086:(K,O,F)=>{F.d(O,{b:()=>l});var f=F(11729),r=F(11713);class l{constructor(K,O,F){this.center=r.TO.Zero(),this.centerWorld=r.TO.Zero(),this.minimum=r.TO.Zero(),this.maximum=r.TO.Zero(),this.reConstruct(K,O,F)}reConstruct(K,O,F){this.minimum.l(K),this.maximum.l(O);const f=r.TO.Distance(K,O);O.addToRef(K,this.center).scaleInPlace(.5),this.radius=.5*f,this._update(F||r.Matrix.IdentityReadOnly)}scale(K){const O=this.radius*K,F=l._TmpVector3,f=F[0].oJ(O),r=this.center.subtractToRef(f,F[1]),q=this.center.addToRef(f,F[2]);return this.reConstruct(r,q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){if(K.isIdentity())this.centerWorld.l(this.center),this.radiusWorld=this.radius;else{r.TO.TransformCoordinatesToRef(this.center,K,this.centerWorld);const O=l._TmpVector3[0];r.TO.TransformNormalFromFloatsToRef(1,1,1,K,O),this.radiusWorld=Math.max(Math.abs(O.x),Math.abs(O.y),Math.abs(O.z))*this.radius}}isInFrustum(K){const O=this.centerWorld,F=this.radiusWorld;for(let f=0;f<6;f++)if(K[f].dotCoordinate(O)<=-F)return!1;return!0}isCenterInFrustum(K){const O=this.centerWorld;for(let F=0;F<6;F++)if(K[F].dotCoordinate(O)<0)return!1;return!0}intersectsPoint(K){const O=r.TO.DistanceSquared(this.centerWorld,K);return!(this.radiusWorld*this.radiusWorld<O)}static Intersects(K,O){const F=r.TO.DistanceSquared(K.centerWorld,O.centerWorld),f=K.radiusWorld+O.radiusWorld;return!(f*f<F)}static CreateFromCenterAndRadius(K,O,F){this._TmpVector3[0].l(K),this._TmpVector3[1].eq(0,0,O),this._TmpVector3[2].l(K),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Qt(this._TmpVector3[1]);const f=new l(this._TmpVector3[0],this._TmpVector3[2]);return f._worldMatrix=F||r.Matrix.Identity(),f}}l._TmpVector3=(0,f.c)(3,r.TO.Zero)},12099:(K,O,F)=>{function f(K){-1===K.indexOf("vClipPlane")&&K.push("vClipPlane"),-1===K.indexOf("vClipPlane2")&&K.push("vClipPlane2"),-1===K.indexOf("vClipPlane3")&&K.push("vClipPlane3"),-1===K.indexOf("vClipPlane4")&&K.push("vClipPlane4"),-1===K.indexOf("vClipPlane5")&&K.push("vClipPlane5"),-1===K.indexOf("vClipPlane6")&&K.push("vClipPlane6")}function r(K,O,F){const f=!!(K.clipPlane??O.clipPlane),r=!!(K.clipPlane2??O.clipPlane2),l=!!(K.clipPlane3??O.clipPlane3),q=!!(K.clipPlane4??O.clipPlane4),J=!!(K.clipPlane5??O.clipPlane5),c=!!(K.clipPlane6??O.clipPlane6);f&&F.push("#define CLIPPLANE"),r&&F.push("#define CLIPPLANE2"),l&&F.push("#define CLIPPLANE3"),q&&F.push("#define CLIPPLANE4"),J&&F.push("#define CLIPPLANE5"),c&&F.push("#define CLIPPLANE6")}function l(K,O,F){let f=!1;const r=!!(K.clipPlane??O.clipPlane),l=!!(K.clipPlane2??O.clipPlane2),q=!!(K.clipPlane3??O.clipPlane3),J=!!(K.clipPlane4??O.clipPlane4),c=!!(K.clipPlane5??O.clipPlane5),E=!!(K.clipPlane6??O.clipPlane6);return F.CLIPPLANE!==r&&(F.CLIPPLANE=r,f=!0),F.CLIPPLANE2!==l&&(F.CLIPPLANE2=l,f=!0),F.CLIPPLANE3!==q&&(F.CLIPPLANE3=q,f=!0),F.CLIPPLANE4!==J&&(F.CLIPPLANE4=J,f=!0),F.CLIPPLANE5!==c&&(F.CLIPPLANE5=c,f=!0),F.CLIPPLANE6!==E&&(F.CLIPPLANE6=E,f=!0),f}function q(K,O,F){let f=O.clipPlane??F.clipPlane;J(K,"vClipPlane",f),f=O.clipPlane2??F.clipPlane2,J(K,"vClipPlane2",f),f=O.clipPlane3??F.clipPlane3,J(K,"vClipPlane3",f),f=O.clipPlane4??F.clipPlane4,J(K,"vClipPlane4",f),f=O.clipPlane5??F.clipPlane5,J(K,"vClipPlane5",f),f=O.clipPlane6??F.clipPlane6,J(K,"vClipPlane6",f)}function J(K,O,F){F&&K.setFloat4(O,F.normal.x,F.normal.y,F.normal.z,F.d)}F.d(O,{e:()=>f,g:()=>q,h:()=>l,i:()=>r})},12043:(K,O,F)=>{F.d(O,{b:()=>f});class f{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(K,O){this._defines[K]||(K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K),this._defines[K]=new Array),this._defines[K].push(O)}addCPUSkinningFallback(K,O){this._mesh=O,K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(K,O){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,K=K.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),O._bonesComputationForcedToCPU=!0;const F=this._mesh.HK();for(let K=0;K<F.meshes.length;K++){const f=F.meshes[K];if(f.material){if(f.computeBonesUsingShaders&&0!==f.numBoneInfluencers)if(f.material.getEffect()===O)f.computeBonesUsingShaders=!1;else if(f.Df)for(const K of f.Df){if(K.effect===O){f.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&f.computeBonesUsingShaders&&f.numBoneInfluencers>0&&(f.computeBonesUsingShaders=!1)}}else{const O=this._defines[this._currentRank];if(O)for(let F=0;F<O.length;F++)K=K.replace("#define "+O[F],"");this._currentRank++}return K}}},12053:(K,O,F)=>{F.d(O,{e:()=>o});var f=F(11693),r=F(11698),l=F(11517),q=F(11523),J=F(11559),c=F(12062),E=F(11988),M=F(11534),t=F(11773),j=F(11846),X=F(11753);class u{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(K){this._func=K}get funcRef(){return this._funcRef}set funcRef(K){this._funcRef=K}get funcMask(){return this._funcMask}set funcMask(K){this._funcMask=K}get opStencilFail(){return this._opStencilFail}set opStencilFail(K){this._opStencilFail=K}get opDepthFail(){return this._opDepthFail}set opDepthFail(K){this._opDepthFail=K}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(K){this._opStencilDepthPass=K}get mask(){return this._mask}set mask(K){this._mask=K}get enabled(){return this._enabled}set enabled(K){this._enabled=K}getClassName(){return"MaterialStencilState"}copyTo(K){X.e.Clone((()=>K),this)}serialize(){return X.e.Serialize(this)}parse(K,O,F){X.e.Parse((()=>this),K,O,F)}}(0,f.c)([(0,r.N)()],u.prototype,"func",null),(0,f.c)([(0,r.N)()],u.prototype,"funcRef",null),(0,f.c)([(0,r.N)()],u.prototype,"funcMask",null),(0,f.c)([(0,r.N)()],u.prototype,"opStencilFail",null),(0,f.c)([(0,r.N)()],u.prototype,"opDepthFail",null),(0,f.c)([(0,r.N)()],u.prototype,"opStencilDepthPass",null),(0,f.c)([(0,r.N)()],u.prototype,"mask",null),(0,f.c)([(0,r.N)()],u.prototype,"enabled",null);var T=F(12092);class o{get _supportGlowLayer(){return!1}set _glowModeEnabled(K){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(K){if(this._alpha===K)return;const O=this._alpha;this._alpha=K,1!==O&&1!==K||this.NM(o.MiscDirtyFlag+o.PrePassDirtyFlag)}get alpha(){return this._alpha}set qq(K){this._backFaceCulling!==K&&(this._backFaceCulling=K,this.NM(o.TextureDirtyFlag))}get qq(){return this._backFaceCulling}set cullBackFaces(K){this._cullBackFaces!==K&&(this._cullBackFaces=K,this.NM(o.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(K){this._blockDirtyMechanism!==K&&(this._blockDirtyMechanism=K,K||this.Nj())}atomicMaterialsUpdate(K){this.blockDirtyMechanism=!0;try{K(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(K){this._onDisposeObserver&&this.Wf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wf.add(K)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q.c),this._onBindObservable}set onBind(K){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(K)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new q.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new q.c),this._onEffectCreatedObservable}set alphaMode(K){this._alphaMode!==K&&(this._alphaMode=K,this.NM(o.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(K){this._needDepthPrePass!==K&&(this._needDepthPrePass=K,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(K){this._fogEnabled!==K&&(this._fogEnabled=K,this.NM(o.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case o.WireFrameFillMode:case o.LineListDrawMode:case o.LineLoopDrawMode:case o.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(K){this.fillMode=K?o.WireFrameFillMode:o.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case o.PointFillMode:case o.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(K){this.fillMode=K?o.PointFillMode:o.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(K){this._fillMode!==K&&(this._fillMode=K,this.NM(o.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){const O=this.HK().getEngine().getCaps().fragmentDepthSupported;K&&!O&&M.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=K&&O,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(K){this._drawWrapper=K}constructor(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Wf=new q.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new u,this._useUBO=!1,this._fillMode=o.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=K;const r=O||J.e.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._forceGLSL=f,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=K||l.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new j.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new E.e(this._scene.getEngine(),void 0,void 0,K),this._useUBO=this.HK().getEngine().supportsUniformBuffers,this._createUniformBuffer(),F||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),o.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var K;const O=this.HK().getEngine();null===(K=this._uniformBuffer)||void 0===K||K.dispose(),O.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new E.e(O,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new E.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(K){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Nj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Nj(),this.checkReadyOnlyOnce=!1}isReady(K,O){return!0}isReadyForSubMesh(K,O,F){const f=O.materialDefines;return!!f&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=f,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}HK(){return this._scene}_getEffectiveOrientation(K){return null!==this.sideOrientation?this.sideOrientation:K.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(K){this._transparencyMode!==K&&(this._transparencyMode=K,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===o.MATERIAL_ALPHABLEND||this._transparencyMode===o.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===o.MATERIAL_ALPHATEST||this._transparencyMode===o.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===o.MATERIAL_OPAQUE||this._transparencyMode===o.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(K){return this._hasTransparencyMode?this._transparencyModeIsBlend:K.visibility<1||!this._disableAlphaBlending&&(K.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(K){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(K)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Nj(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.HK().meshes;for(const F of O)if(F.Df)for(const O of F.Df)if(O.VK()===this)for(const F of O._drawWrappers)F&&this._materialContext===F.materialContext&&(F._wasPreviouslyReady=!1,F._wasPreviouslyUsingInstances=null,F._forceRebindOnNextCall=K);K&&this.NM(o.AllDirtyFlag)}_preBind(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this._scene.getEngine(),f=(null==O?this.sideOrientation:O)===o.ClockWiseSideOrientation;return F.enableEffect(K||this._getDrawWrapper()),F.setState(this.qq,this.zOffset,!1,f,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),f}bind(K,O){}buildUniformLayout(){const K=this._uniformBuffer;this._eventInfo.ubo=K,this._callbackPluginEventGeneric(8,this._eventInfo),K.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(K,O,F){const f=F._drawWrapper;this._eventInfo.subMesh=F,this._callbackPluginEventBindForSubMesh(this._eventInfo),f._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(K){}bindView(K){this._useUBO?this._needToBindSceneUbo=!0:K.setMatrix("view",this.HK().getViewMatrix())}bindViewProjection(K){this._useUBO?this._needToBindSceneUbo=!0:(K.setMatrix("viewProjection",this.HK().getTransformMatrix()),K.setMatrix("projection",this.HK().getProjectionMatrix()))}bindEyePosition(K,O){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(K,O)}_afterBind(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&O&&(this._needToBindSceneUbo=!1,(0,T.p)(O,this.HK().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=K?K.visibility:1,this._onBindObservable&&K&&this._onBindObservable.notifyObservers(K),this.disableDepthWrite){const K=this._scene.getEngine();this._cachedDepthWriteState=K.getDepthWrite(),K.setDepthWrite(!1)}if(this.disableColorWrite){const K=this._scene.getEngine();this._cachedColorWriteState=K.getColorWrite(),K.setColorWrite(!1)}if(0!==this.depthFunction){const K=this._scene.getEngine();this._cachedDepthFunctionState=K.getDepthFunction()||0,K.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(K){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=K,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(K){return null}_clonePlugins(K,O){const F={};if(this._serializePlugins(F),o._ParsePlugins(F,K,this._scene,O),this.pluginManager)for(const f of this.pluginManager._plugins){const O=K.pluginManager.getPlugin(f.name);O&&f.copyTo(O)}}getBindedMeshes(){if(this.meshMap){const K=[];for(const O in this.meshMap){const F=this.meshMap[O];F&&K.push(F)}return K}return this._scene.meshes.filter((K=>K.material===this))}forceCompilation(K,O,F,f){const r={clipPlane:!1,useInstances:!1,...F},l=this.HK(),q=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const J=()=>{if(!this._scene||!this._scene.getEngine())return;const F=l.clipPlane;if(r.clipPlane&&(l.clipPlane=new t.b(0,0,0,1)),this._storeEffectOnSubMeshes){let F=!0,l=null;if(K.Df){const O=new c.d(0,0,0,0,0,K,void 0,!1,!1);O.materialDefines&&(O.materialDefines._renderId=-1),this.isReadyForSubMesh(K,O,r.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?l=O.effect.getCompilationError():(F=!1,setTimeout(J,16)))}F&&(this.allowShaderHotSwapping=q,l&&f&&f(l),O&&O(this))}else this.isReady()?(this.allowShaderHotSwapping=q,O&&O(this)):setTimeout(J,16);r.clipPlane&&(l.clipPlane=F)};J()}async forceCompilationAsync(K,O){return await new Promise(((F,f)=>{this.forceCompilation(K,(()=>{F()}),O,(K=>{f(K)}))}))}NM(K){this.HK().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(o._DirtyCallbackArray.length=0,K&o.ImageProcessingDirtyFlag&&o._DirtyCallbackArray.push(o._ImageProcessingDirtyCallBack),K&o.TextureDirtyFlag&&o._DirtyCallbackArray.push(o._TextureDirtyCallBack),K&o.LightDirtyFlag&&o._DirtyCallbackArray.push(o._LightsDirtyCallBack),K&o.FresnelDirtyFlag&&o._DirtyCallbackArray.push(o._FresnelDirtyCallBack),K&o.AttributesDirtyFlag&&o._DirtyCallbackArray.push(o._AttributeDirtyCallBack),K&o.MiscDirtyFlag&&o._DirtyCallbackArray.push(o._MiscDirtyCallBack),K&o.PrePassDirtyFlag&&o._DirtyCallbackArray.push(o._PrePassDirtyCallBack),o._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(o._RunDirtyCallBacks),this.HK().resetCachedMaterial())}resetDrawCache(){const K=this.HK().meshes;for(const O of K)if(O.Df)for(const K of O.Df)K.VK()===this&&K.resetDrawCache()}_markAllSubMeshesAsDirty(K){const O=this.HK();if(O.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const F=O.meshes;for(const f of F)if(f.Df)for(const F of f.Df){if((F.VK()||(O._hasDefaultMaterial?O.defaultMaterial:null))===this)for(const O of F._drawWrappers)O&&O.defines&&O.defines.markAllAsDirty&&this._materialContext===O.materialContext&&K(O.defines)}}_markScenePrePassDirty(){if(this.HK().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const K=this.HK().enablePrePassRenderer();K&&K.NM()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(o._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(o._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(o._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(o._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(o._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(o._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(o._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(o._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(o._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(o._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const K=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Wf.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(K)}))}}setPrePassRenderer(K){return!1}dispose(K,O,F){const f=this.HK();if(f.stopAnimation(this),f.freeProcessedMaterials(),f.removeMaterial(this),this._eventInfo.forceDisposeTextures=O,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const K=this._parentContainer.materials.indexOf(this);K>-1&&this._parentContainer.materials.splice(K,1),this._parentContainer=null}if(!0!==F)if(this.meshMap)for(const r in this.meshMap){const K=this.meshMap[r];this._disposeMeshResources(K)}else{const K=f.meshes;for(const O of K)this._disposeMeshResources(O)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Wf.notifyObservers(this),this.Wf.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(K){if(!K)return;const O=K.hr,F=K._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(K.Df&&F)for(const r of K.Df){const K=r._drawWrappers;for(let l=0;l<K.length;l++){var f;const q=null===(f=K[l])||void 0===f?void 0:f.effect;if(!q)continue;F[l]===this&&(null===O||void 0===O||O._releaseVertexArrayObject(q),r._removeDrawWrapper(l,!0,!0))}}}else null===O||void 0===O||O._releaseVertexArrayObject(this._drawWrapper.effect);K.material!==this||K.sourceMesh||(K.material=null)}serialize(){const K=X.e.Serialize(this);return K.stencil=this.stencil.serialize(),K.uniqueId=this.uniqueId,this._serializePlugins(K),K}_serializePlugins(K){if(K.plugins={},this.pluginManager)for(const O of this.pluginManager._plugins)O.doNotSerialize||(K.plugins[O.getClassName()]=O.serialize())}static Parse(K,O,F){if(K.customType){if("BABYLON.PBRMaterial"===K.customType&&K.overloadedAlbedo&&(K.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return M.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else K.customType="BABYLON.StandardMaterial";const f=l.Tools.Instantiate(K.customType).Parse(K,O,F);return f._loadedUniqueId=K.uniqueId,f}static _ParsePlugins(K,O,F,f){if(K.plugins)for(const J in K.plugins){var r,q;const c=K.plugins[J];let E=null===(r=O.pluginManager)||void 0===r?void 0:r.getPlugin(c.name);if(!E){const K=l.Tools.Instantiate("BABYLON."+J);K&&(E=new K(O))}null===(q=E)||void 0===q||q.parse(c,F,f)}}}o.TriangleFillMode=0,o.WireFrameFillMode=1,o.PointFillMode=2,o.PointListDrawMode=3,o.LineListDrawMode=4,o.LineLoopDrawMode=5,o.LineStripDrawMode=6,o.TriangleStripDrawMode=7,o.TriangleFanDrawMode=8,o.ClockWiseSideOrientation=0,o.CounterClockWiseSideOrientation=1,o.ImageProcessingDirtyFlag=64,o.TextureDirtyFlag=1,o.LightDirtyFlag=2,o.FresnelDirtyFlag=4,o.AttributesDirtyFlag=8,o.MiscDirtyFlag=16,o.PrePassDirtyFlag=32,o.AllDirtyFlag=127,o.MATERIAL_OPAQUE=0,o.MATERIAL_ALPHATEST=1,o.MATERIAL_ALPHABLEND=2,o.MATERIAL_ALPHATESTANDBLEND=3,o.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,o.MATERIAL_NORMALBLENDMETHOD_RNM=1,o.OnEventObservable=new q.c,o._AllDirtyCallBack=K=>K.markAllAsDirty(),o._ImageProcessingDirtyCallBack=K=>K.markAsImageProcessingDirty(),o._TextureDirtyCallBack=K=>K.markAsTexturesDirty(),o._FresnelDirtyCallBack=K=>K.markAsFresnelDirty(),o._MiscDirtyCallBack=K=>K.markAsMiscDirty(),o._PrePassDirtyCallBack=K=>K.markAsPrePassDirty(),o._LightsDirtyCallBack=K=>K.markAsLightDirty(),o._AttributeDirtyCallBack=K=>K.markAsAttributesDirty(),o._FresnelAndMiscDirtyCallBack=K=>{o._FresnelDirtyCallBack(K),o._MiscDirtyCallBack(K)},o._TextureAndMiscDirtyCallBack=K=>{o._TextureDirtyCallBack(K),o._MiscDirtyCallBack(K)},o._DirtyCallbackArray=[],o._RunDirtyCallBacks=K=>{for(const O of o._DirtyCallbackArray)O(K)},(0,f.c)([(0,r.N)()],o.prototype,"id",void 0),(0,f.c)([(0,r.N)()],o.prototype,"uniqueId",void 0),(0,f.c)([(0,r.N)()],o.prototype,"name",void 0),(0,f.c)([(0,r.N)()],o.prototype,"metadata",void 0),(0,f.c)([(0,r.N)()],o.prototype,"checkReadyOnEveryCall",void 0),(0,f.c)([(0,r.N)()],o.prototype,"checkReadyOnlyOnce",void 0),(0,f.c)([(0,r.N)()],o.prototype,"state",void 0),(0,f.c)([(0,r.N)("alpha")],o.prototype,"_alpha",void 0),(0,f.c)([(0,r.N)("qq")],o.prototype,"_backFaceCulling",void 0),(0,f.c)([(0,r.N)("cullBackFaces")],o.prototype,"_cullBackFaces",void 0),(0,f.c)([(0,r.N)()],o.prototype,"sideOrientation",void 0),(0,f.c)([(0,r.N)("alphaMode")],o.prototype,"_alphaMode",void 0),(0,f.c)([(0,r.N)()],o.prototype,"_needDepthPrePass",void 0),(0,f.c)([(0,r.N)()],o.prototype,"disableDepthWrite",void 0),(0,f.c)([(0,r.N)()],o.prototype,"disableColorWrite",void 0),(0,f.c)([(0,r.N)()],o.prototype,"forceDepthWrite",void 0),(0,f.c)([(0,r.N)()],o.prototype,"depthFunction",void 0),(0,f.c)([(0,r.N)()],o.prototype,"separateCullingPass",void 0),(0,f.c)([(0,r.N)("fogEnabled")],o.prototype,"_fogEnabled",void 0),(0,f.c)([(0,r.N)()],o.prototype,"pointSize",void 0),(0,f.c)([(0,r.N)()],o.prototype,"zOffset",void 0),(0,f.c)([(0,r.N)()],o.prototype,"zOffsetUnits",void 0),(0,f.c)([(0,r.N)()],o.prototype,"pointsCloud",null),(0,f.c)([(0,r.N)()],o.prototype,"fillMode",null),(0,f.c)([(0,r.N)()],o.prototype,"useLogarithmicDepth",null),(0,f.c)([(0,r.N)()],o.prototype,"transparencyMode",null)},12092:(K,O,F)=>{F.d(O,{$:()=>G,A:()=>Z,C:()=>g,G:()=>H,H:()=>X,I:()=>j,M:()=>Q,Q:()=>A,T:()=>p,V:()=>k,X:()=>W,Y:()=>R,bb:()=>z,c:()=>L,f:()=>t,fb:()=>x,gb:()=>u,i:()=>a,j:()=>M,m:()=>T,p:()=>o,t:()=>N,x:()=>e});var f=F(11534),r=F(11764),l=F(11559),q=F(12037),J=F(12099);const c=r.ZO.Black(),E={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function M(K,O,F){if(!K||K.LOGARITHMICDEPTH||K.indexOf&&K.indexOf("LOGARITHMICDEPTH")>=0){const K=F.activeCamera;1===K.mode&&f.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),O.setFloat("logarithmicDepthConstant",2/(Math.log(K.maxZ+1)/Math.LN2))}}function t(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];F&&K.fogEnabled&&(!O||O.applyFog)&&0!==K.fogMode&&(F.setFloat4("vFogInfos",K.fogMode,K.fogStart,K.fogEnd,K.fogDensity),f?(K.fogColor.toLinearSpaceToRef(c,K.getEngine().useExactSrgbConversions),F.setColor3("vFogColor",c)):F.setColor3("vFogColor",K.fogColor))}function j(K,O,F,f,r,l,q,J,c,M){const t=K.numMaxInfluencers||K.numInfluencers;return t<=0?0:(O.push("#define MORPHTARGETS"),K.hasPositions&&O.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),K.hasNormals&&O.push("#define MORPHTARGETTEXTURE_HASNORMALS"),K.hasTangents&&O.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),K.hasUVs&&O.push("#define MORPHTARGETTEXTURE_HASUVS"),K.hasUV2s&&O.push("#define MORPHTARGETTEXTURE_HASUV2S"),K.hasColors&&O.push("#define MORPHTARGETTEXTURE_HASCOLORS"),K.supportsPositions&&r&&O.push("#define MORPHTARGETS_POSITION"),K.supportsNormals&&l&&O.push("#define MORPHTARGETS_NORMAL"),K.supportsTangents&&q&&O.push("#define MORPHTARGETS_TANGENT"),K.supportsUVs&&J&&O.push("#define MORPHTARGETS_UV"),K.supportsUV2s&&c&&O.push("#define MORPHTARGETS_UV2"),K.supportsColors&&M&&O.push("#define MORPHTARGETS_COLOR"),O.push("#define NUM_MORPH_INFLUENCERS "+t),K.isUsingTextureForTargets&&O.push("#define MORPHTARGETS_TEXTURE"),E.NUM_MORPH_INFLUENCERS=t,E.NORMAL=l,E.TANGENT=q,E.UV=J,E.UV2=c,E.COLOR=M,X(F,f,E,r),t)}function X(K,O,F){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=F.NUM_MORPH_INFLUENCERS;if(q>0&&l.e.LastCreatedEngine){const J=l.e.LastCreatedEngine.getCaps().maxVertexAttribs,c=O.morphTargetManager;if(null!==c&&void 0!==c&&c.isUsingTextureForTargets)return;const E=c&&c.supportsPositions&&r,M=c&&c.supportsNormals&&F.NORMAL,t=c&&c.supportsTangents&&F.TANGENT,j=c&&c.supportsUVs&&F.UV1,X=c&&c.supportsUV2s&&F.UV2,u=c&&c.supportsColors&&F.VERTEXCOLOR;for(let F=0;F<q;F++)E&&K.push("position"+F),M&&K.push("normal"+F),t&&K.push("tangent"+F),j&&K.push("uv_"+F),X&&K.push("uv2_"+F),u&&K.push("color"+F),K.length>J&&f.c.Error("Cannot add more vertex attributes for mesh "+O.name)}}function u(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K.push("world0"),K.push("world1"),K.push("world2"),K.push("world3"),O&&(K.push("previousWorld0"),K.push("previousWorld1"),K.push("previousWorld2"),K.push("previousWorld3"))}function T(K,O){const F=K.morphTargetManager;K&&F&&O.setFloatArray("morphTargetInfluences",F.influences)}function o(K,O){O.bindToEffect(K,"Scene")}function k(K,O,F){O._needUVs=!0,O[F]=!0,K.optimizeUVAllocation&&K.getTextureMatrix().isIdentityAs3x2()?(O[F+"DIRECTUV"]=K.coordinatesIndex+1,O["MAINUV"+(K.coordinatesIndex+1)]=!0):O[F+"DIRECTUV"]=0}function N(K,O,F){const f=K.getTextureMatrix();O.sf(F+"Matrix",f)}function Z(K,O,F){F.BAKED_VERTEX_ANIMATION_TEXTURE&&F.INSTANCES&&K.push("bakedVertexAnimationSettingsInstanced")}function L(K,O,F){var f;if(O&&K&&(K.computeBonesUsingShaders&&O._bonesComputationForcedToCPU&&(K.computeBonesUsingShaders=!1),K.useBones&&K.computeBonesUsingShaders&&K.skeleton)){const r=K.skeleton;if(r.isUsingTextureForMatrices&&O.getUniformIndex("boneTextureWidth")>-1){const F=r.getTransformMatrixTexture(K);O.setTexture("boneSampler",F),O.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{const l=r.getTransformMatrices(K);l&&(O.setMatrices("mBones",l),F&&K.HK().prePassRenderer&&K.HK().prePassRenderer.getIndex(2)&&(F.previousBones[K.uniqueId]||(F.previousBones[K.uniqueId]=l.slice()),O.setMatrices("mPreviousBones",F.previousBones[K.uniqueId]),f=l,F.previousBones[K.uniqueId].set(f)))}}}function d(K,O,F,f,r){let l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];K._bindLight(O,F,f,r,l)}function a(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const l=Math.min(O.lightSources.length,r);for(let q=0;q<l;q++){d(O.lightSources[q],q,K,F,"boolean"===typeof f?f:f.SPECULARTERM,O.receiveShadows)}}function g(K,O,F,f){F.NUM_BONE_INFLUENCERS>0&&(f.addCPUSkinningFallback(0,O),K.push("matricesIndices"),K.push("matricesWeights"),F.NUM_BONE_INFLUENCERS>4&&(K.push("matricesIndicesExtra"),K.push("matricesWeightsExtra")))}function H(K,O){(O.INSTANCES||O.THIN_INSTANCES)&&u(K,!!O.PREPASS_VELOCITY),O.INSTANCESCOLOR&&K.push("instanceColor")}function e(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=0;for(let l=0;l<F&&K["LIGHT"+l];l++)l>0&&(r=f+l,O.addFallback(r,"LIGHT"+l)),K.SHADOWS||(K["SHADOW"+l]&&O.addFallback(f,"SHADOW"+l),K["SHADOWPCF"+l]&&O.addFallback(f,"SHADOWPCF"+l),K["SHADOWPCSS"+l]&&O.addFallback(f,"SHADOWPCSS"+l),K["SHADOWPOISSON"+l]&&O.addFallback(f,"SHADOWPOISSON"+l),K["SHADOWESM"+l]&&O.addFallback(f,"SHADOWESM"+l),K["SHADOWCLOSEESM"+l]&&O.addFallback(f,"SHADOWCLOSEESM"+l));return r++}function W(K,O,F,f,r,l,q){let J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];q._areMiscDirty&&(q.LOGARITHMICDEPTH=F,q.POINTSIZE=f,q.FOG=r&&function(K,O){return O.fogEnabled&&K.applyFog&&0!==O.fogMode}(K,O),q.NONUNIFORMSCALING=K.nonUniformScaling,q.ALPHATEST=l,q.DECAL_AFTER_DETAIL=J)}function p(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!F._areLightsDirty)return F._needNormals;let q=0;const J={needNormals:F._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(K.lightsEnabled&&!l)for(const E of O.lightSources)if(y(K,O,E,q,F,f,J),q++,q===r)break;F.SPECULARTERM=J.specularEnabled,F.SHADOWS=J.shadowEnabled;for(let E=q;E<r;E++)void 0!==F["LIGHT"+E]&&(F["LIGHT"+E]=!1,F["HEMILIGHT"+E]=!1,F["POINTLIGHT"+E]=!1,F["DIRLIGHT"+E]=!1,F["SPOTLIGHT"+E]=!1,F["AREALIGHT"+E]=!1,F["SHADOW"+E]=!1,F["SHADOWCSM"+E]=!1,F["SHADOWCSMDEBUG"+E]=!1,F["SHADOWCSMNUM_CASCADES"+E]=!1,F["SHADOWCSMUSESHADOWMAXZ"+E]=!1,F["SHADOWCSMNOBLEND"+E]=!1,F["SHADOWCSM_RIGHTHANDED"+E]=!1,F["SHADOWPCF"+E]=!1,F["SHADOWPCSS"+E]=!1,F["SHADOWPOISSON"+E]=!1,F["SHADOWESM"+E]=!1,F["SHADOWCLOSEESM"+E]=!1,F["SHADOWCUBE"+E]=!1,F["SHADOWLOWQUALITY"+E]=!1,F["SHADOWMEDIUMQUALITY"+E]=!1);const c=K.getEngine().getCaps();return void 0===F.SHADOWFLOAT&&(J.needRebuild=!0),F.SHADOWFLOAT=J.shadowEnabled&&(c.textureFloatRender&&c.textureFloatLinearFiltering||c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering),F.LIGHTMAPEXCLUDED=J.lightmapMode,J.needRebuild&&F.rebuild(),J.needNormals}function y(K,O,F,f,r,l,J){switch(J.needNormals=!0,void 0===r["LIGHT"+f]&&(J.needRebuild=!0),r["LIGHT"+f]=!0,r["SPOTLIGHT"+f]=!1,r["HEMILIGHT"+f]=!1,r["POINTLIGHT"+f]=!1,r["DIRLIGHT"+f]=!1,r["AREALIGHT"+f]=!1,F.prepareLightSpecificDefines(r,f),r["LIGHT_FALLOFF_PHYSICAL"+f]=!1,r["LIGHT_FALLOFF_GLTF"+f]=!1,r["LIGHT_FALLOFF_STANDARD"+f]=!1,F.falloffType){case q.c.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+f]=!0;break;case q.c.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+f]=!0;break;case q.c.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+f]=!0}if(l&&!F.nM.equalsFloats(0,0,0)&&(J.specularEnabled=!0),r["SHADOW"+f]=!1,r["SHADOWCSM"+f]=!1,r["SHADOWCSMDEBUG"+f]=!1,r["SHADOWCSMNUM_CASCADES"+f]=!1,r["SHADOWCSMUSESHADOWMAXZ"+f]=!1,r["SHADOWCSMNOBLEND"+f]=!1,r["SHADOWCSM_RIGHTHANDED"+f]=!1,r["SHADOWPCF"+f]=!1,r["SHADOWPCSS"+f]=!1,r["SHADOWPOISSON"+f]=!1,r["SHADOWESM"+f]=!1,r["SHADOWCLOSEESM"+f]=!1,r["SHADOWCUBE"+f]=!1,r["SHADOWLOWQUALITY"+f]=!1,r["SHADOWMEDIUMQUALITY"+f]=!1,O&&O.receiveShadows&&K.shadowsEnabled&&F.shadowEnabled){const O=F.getShadowGenerator(K.activeCamera)??F.getShadowGenerator();if(O){const K=O.getShadowMap();K&&K.renderList&&K.renderList.length>0&&(J.shadowEnabled=!0,O.prepareDefines(r,f))}}F.lightmapMode!=q.c.LIGHTMAP_DEFAULT?(J.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+f]=!0,r["LIGHTMAPNOSPECULAR"+f]=F.lightmapMode==q.c.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+f]=!1,r["LIGHTMAPNOSPECULAR"+f]=!1)}function A(K,O,F,f,r){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=function(K,O){let F=!1;if(K.activeCamera){const f=O.CAMERA_ORTHOGRAPHIC?1:0,r=O.CAMERA_PERSPECTIVE?1:0,l=1===K.activeCamera.mode?1:0,q=0===K.activeCamera.mode?1:0;(f^l||r^q)&&(O.CAMERA_ORTHOGRAPHIC=1===l,O.CAMERA_PERSPECTIVE=1===q,F=!0)}return F}(K,f);!1!==l&&(c=(0,J.h)(F,K,f)),f.DEPTHPREPASS!==!O.getColorWrite()&&(f.DEPTHPREPASS=!f.DEPTHPREPASS,c=!0),f.INSTANCES!==r&&(f.INSTANCES=r,c=!0),f.THIN_INSTANCES!==q&&(f.THIN_INSTANCES=q,c=!0),c&&f.markAsUnprocessed()}function Q(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!O._areAttributesDirty&&O._needNormals===O._normals&&O._needUVs===O._uvs)return!1;O._normals=O._needNormals,O._uvs=O._needUVs,O.NORMAL=O._needNormals&&K.isVerticesDataPresent("normal"),O._needNormals&&K.isVerticesDataPresent("tangent")&&(O.TANGENT=!0);for(let J=1;J<=6;++J)O["UV"+J]=!!O._needUVs&&K.isVerticesDataPresent(`uv${1===J?"":J}`);if(F){const F=K.useVertexColors&&K.isVerticesDataPresent("color");O.VERTEXCOLOR=F,O.VERTEXALPHA=K.hasVertexAlpha&&F&&l}return K.isVerticesDataPresent("instanceColor")&&(K.hasInstances||K.hasThinInstances)&&(O.INSTANCESCOLOR=!0),f&&function(K,O){if(K.useBones&&K.computeBonesUsingShaders&&K.skeleton){O.NUM_BONE_INFLUENCERS=K.numBoneInfluencers;const F=void 0!==O.BONETEXTURE;if(K.skeleton.isUsingTextureForMatrices&&F)O.BONETEXTURE=!0;else{O.BonesPerMesh=K.skeleton.bones.length+1,O.BONETEXTURE=!F&&void 0;const f=K.HK().prePassRenderer;if(f&&f.enabled){const F=-1===f.excludedSkinnedMesh.indexOf(K);O.BONES_VELOCITY_ENABLED=F}}}else O.NUM_BONE_INFLUENCERS=0,O.BonesPerMesh=0,void 0!==O.BONETEXTURE&&(O.BONETEXTURE=!1)}(K,O),r&&function(K,O){const F=K.morphTargetManager;F?(O.MORPHTARGETS_UV=F.supportsUVs&&O.UV1,O.MORPHTARGETS_UV2=F.supportsUV2s&&O.UV2,O.MORPHTARGETS_TANGENT=F.supportsTangents&&O.TANGENT,O.MORPHTARGETS_NORMAL=F.supportsNormals&&O.NORMAL,O.MORPHTARGETS_POSITION=F.supportsPositions,O.MORPHTARGETS_COLOR=F.supportsColors,O.MORPHTARGETTEXTURE_HASUVS=F.hasUVs,O.MORPHTARGETTEXTURE_HASUV2S=F.hasUV2s,O.MORPHTARGETTEXTURE_HASTANGENTS=F.hasTangents,O.MORPHTARGETTEXTURE_HASNORMALS=F.hasNormals,O.MORPHTARGETTEXTURE_HASPOSITIONS=F.hasPositions,O.MORPHTARGETTEXTURE_HASCOLORS=F.hasColors,O.NUM_MORPH_INFLUENCERS=F.numMaxInfluencers||F.numInfluencers,O.MORPHTARGETS=O.NUM_MORPH_INFLUENCERS>0,O.MORPHTARGETS_TEXTURE=F.isUsingTextureForTargets):(O.MORPHTARGETS_UV=!1,O.MORPHTARGETS_UV2=!1,O.MORPHTARGETS_TANGENT=!1,O.MORPHTARGETS_NORMAL=!1,O.MORPHTARGETS_POSITION=!1,O.MORPHTARGETS_COLOR=!1,O.MORPHTARGETTEXTURE_HASUVS=!1,O.MORPHTARGETTEXTURE_HASUV2S=!1,O.MORPHTARGETTEXTURE_HASTANGENTS=!1,O.MORPHTARGETTEXTURE_HASNORMALS=!1,O.MORPHTARGETTEXTURE_HASPOSITIONS=!1,O.MORPHTARGETTEXTURE_HAS_COLORS=!1,O.MORPHTARGETS=!1,O.NUM_MORPH_INFLUENCERS=0)}(K,O),q&&function(K,O){const F=K.bakedVertexAnimationManager;O.BAKED_VERTEX_ANIMATION_TEXTURE=!(!F||!F.isEnabled)}(K,O),!0}function R(K,O){if(K.activeCamera){const F=O.MULTIVIEW;O.MULTIVIEW=null!==K.activeCamera.outputRenderTarget&&K.activeCamera.outputRenderTarget.getViewCount()>1,O.MULTIVIEW!=F&&O.markAsUnprocessed()}}function G(K,O,F){const f=O.ORDER_INDEPENDENT_TRANSPARENCY,r=O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;O.ORDER_INDEPENDENT_TRANSPARENCY=K.useOrderIndependentTransparency&&F,O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!K.getEngine().getCaps().textureFloatLinearFiltering,f===O.ORDER_INDEPENDENT_TRANSPARENCY&&r===O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||O.markAsUnprocessed()}function z(K,O,F){const f=O.PREPASS;if(!O._arePrePassDirty)return;const r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(K.prePassRenderer&&K.prePassRenderer.enabled&&F){O.PREPASS=!0,O.SCENE_MRT_COUNT=K.prePassRenderer.mrtCount,O.PREPASS_NORMAL_WORLDSPACE=K.prePassRenderer.generateNormalsInWorldSpace,O.PREPASS_COLOR=!0,O.PREPASS_COLOR_INDEX=0;for(let F=0;F<r.length;F++){const f=K.prePassRenderer.getIndex(r[F].type);-1!==f?(O[r[F].define]=!0,O[r[F].index]=f):O[r[F].define]=!1}}else{O.PREPASS=!1;for(let K=0;K<r.length;K++)O[r[K].define]=!1}O.PREPASS!=f&&(O.markAsUnprocessed(),O.markAsImageProcessingDirty())}function m(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];r&&r.push("Light"+K),l||(O.push("vLightData"+K,"vLightDiffuse"+K,"vLightSpecular"+K,"vLightDirection"+K,"vLightWidth"+K,"vLightHeight"+K,"vLightFalloff"+K,"vLightGround"+K,"lightMatrix"+K,"shadowsInfo"+K,"depthValues"+K),F.push("shadowTexture"+K),F.push("depthTexture"+K),O.push("viewFrustumZ"+K,"cascadeBlendFactor"+K,"lightSizeUVCorrection"+K,"depthCorrection"+K,"penumbraDarkness"+K,"frustumLengths"+K),f&&(F.push("projectionLightTexture"+K),O.push("textureProjectionMatrix"+K)),q&&F.push("iesLightTexture"+K))}function x(K,O,F){let f,r,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(K.uniformsNames){const q=K;f=q.uniformsNames,r=q.uniformBuffersNames,O=q.samplers,F=q.defines,l=q.maxSimultaneousLights||0}else f=K,O||(O=[]);for(let q=0;q<l&&F["LIGHT"+q];q++)m(q,f,O,F["PROJECTEDLIGHTTEXTURE"+q],r,!1,F["IESLIGHTTEXTURE"+q]);F.NUM_MORPH_INFLUENCERS&&(f.push("morphTargetInfluences"),f.push("morphTargetCount")),F.BAKED_VERTEX_ANIMATION_TEXTURE&&(f.push("bakedVertexAnimationSettings"),f.push("bakedVertexAnimationTextureSizeInverted"),f.push("bakedVertexAnimationTime"),O.push("bakedVertexAnimationTexture"))}},12050:(K,O,F)=>{F.d(O,{b:()=>l});var f=F(11713),r=F(12053);class l extends r.e{constructor(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(K,O,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new f.Matrix,this._storeEffectOnSubMeshes=F}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(K,O){return!!K&&(!this._storeEffectOnSubMeshes||(!K.Df||0===K.Df.length||this.isReadyForSubMesh(K,K.Df[0],O)))}_isReadyForSubMesh(K){const O=K.materialDefines;return!(this.checkReadyOnEveryCall||!K.effect||!O||O._renderId!==this.HK().getRenderId())}bindOnlyWorldMatrix(K){this._activeEffect.setMatrix("world",K)}bindOnlyNormalMatrix(K){this._activeEffect.setMatrix("normalMatrix",K)}bind(K,O){O&&this.bindForSubMesh(K,O,O.Df[0])}_afterBind(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;super._afterBind(K,O,F),this.HK()._cachedEffect=O,F?F._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return F._drawWrapper._forceRebindOnNextCall||K.isCachedMaterialInvalid(this,O,f)}dispose(K,O,F){this._activeEffect=void 0,super.dispose(K,O,F)}}},12090:(K,O,F)=>{F.d(O,{d:()=>J,g:()=>c});var f=F(11693),r=F(11713),l=F(11698);class q{static extractMinAndMaxIndexed(K,O,F,f,r,l){for(let q=F;q<F+f;q++){const F=3*O[q],f=K[F],J=K[F+1],c=K[F+2];r.minimizeInPlaceFromFloats(f,J,c),l.maximizeInPlaceFromFloats(f,J,c)}}static extractMinAndMax(K,O,F,f,r,l){for(let q=O,J=O*f;q<O+F;q++,J+=f){const O=K[J],F=K[J+1],f=K[J+2];r.minimizeInPlaceFromFloats(O,F,f),l.maximizeInPlaceFromFloats(O,F,f)}}}function J(K,O,F,f){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const J=new r.TO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new r.TO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return q.extractMinAndMaxIndexed(K,O,F,f,J,c),l&&(J.x-=J.x*l.x+l.y,J.y-=J.y*l.x+l.y,J.z-=J.z*l.x+l.y,c.x+=c.x*l.x+l.y,c.y+=c.y*l.x+l.y,c.z+=c.z*l.x+l.y),{minimum:J,maximum:c}}function c(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4?arguments[4]:void 0;const J=new r.TO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new r.TO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return l||(l=3),q.extractMinAndMax(K,O,F,l,J,c),f&&(J.x-=J.x*f.x+f.y,J.y-=J.y*f.x+f.y,J.z-=J.z*f.x+f.y,c.x+=c.x*f.x+f.y,c.y+=c.y*f.x+f.y,c.z+=c.z*f.x+f.y),{minimum:J,maximum:c}}(0,f.c)([l.g.filter((function(){for(var K=arguments.length,O=new Array(K),F=0;F<K;F++)O[F]=arguments[F];let[f,r]=O;return!Array.isArray(f)&&!Array.isArray(r)}))],q,"extractMinAndMaxIndexed",null),(0,f.c)([l.g.filter((function(){for(var K=arguments.length,O=new Array(K),F=0;F<K;F++)O[F]=arguments[F];let[f]=O;return!Array.isArray(f)}))],q,"extractMinAndMax",null)},12062:(K,O,F)=>{F.d(O,{d:()=>c});var f=F(11793),r=F(12066),l=F(12072),q=F(12090),J=F(11846);class c{get materialDefines(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(K=this._getDrawWrapper())||void 0===K?void 0:K.defines}set materialDefines(K){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=K}_getDrawWrapper(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K??this._engine.currentRenderPassId;let F=this._drawWrappers[K];return!F&&O&&(this._drawWrappers[K]=F=new J.c(this._mesh.HK().getEngine())),F}_removeDrawWrapper(K){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var F;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(F=this._drawWrappers[K])||void 0===F||F.dispose(O));this._drawWrappers[K]=void 0}get effect(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(K=this._getDrawWrapper())||void 0===K?void 0:K.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(K){this._mainDrawWrapperOverride=K}setEffect(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=this._drawWrapper;r.setEffect(K,O,f),void 0!==F&&(r.materialContext=F),K||(r.defines=null,r.materialContext=void 0)}resetDrawCache(K){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==K)return void this._removeDrawWrapper(K,!0,O);for(const K of this._drawWrappers)null===K||void 0===K||K.dispose(O)}this._drawWrappers=[]}static AddToMesh(K,O,F,f,r,l,q){return new c(K,O,F,f,r,l,q,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(K,O,F,f,r,l,q){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=K,this.verticesStart=O,this.verticesCount=F,this.indexStart=f,this.indexCount=r,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=l,this._renderingMesh=q||l,c&&l.Df.push(this),this._engine=this._mesh.HK().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=l.Df.length-1,J&&(this.refreshBoundingInfo(),l.Pf(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(K){return this._boundingInfo=K,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const K=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return K||this._renderingMesh}VK(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!O)return K&&this._mesh.HK()._hasDefaultMaterial?this._mesh.HK().defaultMaterial:null;if(this._isMultiMaterial(O)){const K=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==K&&(this._currentMaterial=K,this.resetDrawCache()),K}return O}_isMultiMaterial(K){return void 0!==K.getSubMaterial}refreshBoundingInfo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.hr)return this;if(K||(K=this._renderingMesh.getVerticesData(f.d.PositionKind)),!K)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const O=this._renderingMesh.br();let F;if(0===this.indexStart&&this.indexCount===O.length){const K=this._renderingMesh.getBoundingInfo();F={minimum:K.minimum.clone(),maximum:K.maximum.clone()}}else F=(0,q.d)(K,O,this.indexStart,this.indexCount,this._renderingMesh.hr.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(F.minimum,F.maximum):this._boundingInfo=new l.d(F.minimum,F.maximum),this}_checkCollision(K){return this.getBoundingInfo()._checkCollision(K)}updateBoundingInfo(K){let O=this.getBoundingInfo();return O||(this.refreshBoundingInfo(),O=this.getBoundingInfo()),O&&O.update(K),this}isInFrustum(K){const O=this.getBoundingInfo();return!!O&&O.isInFrustum(K,this._mesh.ht)}isCompletelyInFrustum(K){const O=this.getBoundingInfo();return!!O&&O.isCompletelyInFrustum(K)}render(K){return this._renderingMesh.render(this,K,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(K,O){if(!this._linesIndexBuffer){const F=6*Math.floor(this.indexCount/3),f=this.verticesStart+this.verticesCount>65535?new Uint32Array(F):new Uint16Array(F);let r=0;if(0===K.length)for(let K=this.indexStart;K<this.indexStart+this.indexCount;K+=3)f[r++]=K,f[r++]=K+1,f[r++]=K+1,f[r++]=K+2,f[r++]=K+2,f[r++]=K;else for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=3)f[r++]=K[O],f[r++]=K[O+1],f[r++]=K[O+1],f[r++]=K[O+2],f[r++]=K[O+2],f[r++]=K[O];this._linesIndexBuffer=O.createIndexBuffer(f),this._linesIndexCount=f.length}return this._linesIndexBuffer}canIntersects(K){const O=this.getBoundingInfo();return!!O&&K.intersectsBox(O.boundingBox)}intersects(K,O,F,f,r){const l=this.VK();if(!l)return null;let q=3,J=!1;switch(l.fillMode){case 3:case 5:case 6:case 8:return null;case 7:q=1,J=!0}return 4===l.fillMode?F.length?this._intersectLines(K,O,F,this._mesh.intersectionThreshold,f):this._intersectUnIndexedLines(K,O,F,this._mesh.intersectionThreshold,f):!F.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(K,O,F,f,r):this._intersectTriangles(K,O,F,q,J,f,r)}_intersectLines(K,O,F,f,l){let q=null;for(let J=this.indexStart;J<this.indexStart+this.indexCount;J+=2){const c=O[F[J]],E=O[F[J+1]],M=K.intersectionSegment(c,E,f);if(!(M<0)&&((l||!q||M<q.distance)&&(q=new r.c(null,null,M),q.faceId=J/2,l)))break}return q}_intersectUnIndexedLines(K,O,F,f,l){let q=null;for(let J=this.verticesStart;J<this.verticesStart+this.verticesCount;J+=2){const F=O[J],c=O[J+1],E=K.intersectionSegment(F,c,f);if(!(E<0)&&((l||!q||E<q.distance)&&(q=new r.c(null,null,E),q.faceId=J/2,l)))break}return q}_intersectTriangles(K,O,F,f,r,l,q){let J=null,c=-1;for(let E=this.indexStart;E<this.indexStart+this.indexCount-(3-f);E+=f){c++;const f=F[E],M=F[E+1],t=F[E+2];if(r&&4294967295===t){E+=2;continue}const j=O[f],X=O[M],u=O[t];if(!j||!X||!u)continue;if(q&&!q(j,X,u,K,f,M,t))continue;const T=K.intersectsTriangle(j,X,u);if(T){if(T.distance<0)continue;if((l||!J||T.distance<J.distance)&&(J=T,J.faceId=c,l))break}}return J}_intersectUnIndexedTriangles(K,O,F,f,r){let l=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=3){const F=O[q],J=O[q+1],c=O[q+2];if(r&&!r(F,J,c,K,-1,-1,-1))continue;const E=K.intersectsTriangle(F,J,c);if(E){if(E.distance<0)continue;if((f||!l||E.distance<l.distance)&&(l=E,l.faceId=q/3,f))break}}return l}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(K,O){const F=new c(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,K,O,!1);if(!this.IsGlobal){const K=this.getBoundingInfo();if(!K)return F;F._boundingInfo=new l.d(K.minimum,K.maximum)}return F}dispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.HK().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const O=this._mesh.Df.indexOf(this);this._mesh.Df.splice(O,1),this.resetDrawCache(void 0,K)}getClassName(){return"SubMesh"}static CreateFromIndices(K,O,F,f,r){let l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=Number.MAX_VALUE,J=-Number.MAX_VALUE;const E=(r||f).br();for(let c=O;c<O+F;c++){const K=E[c];K<q&&(q=K),K>J&&(J=K)}return new c(K,q,J-q+1,O,F,f,r,l)}}}}]);