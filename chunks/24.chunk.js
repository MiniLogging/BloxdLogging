"use strict";(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[24],{11717:(B,E,v)=>{v.d(E,{b:()=>z});class z{constructor(B,E,v){this.bu=B,this.bv=E,this.distance=v,this.faceId=0,this.subMeshId=0}}},11728:(B,E,v)=>{v.d(E,{b:()=>c});var z=v(11385),o=v(11380),q=v(11382);class c{constructor(B,E,v){this.vectors=(0,z.b)(8,o.GE.Zero),this.center=o.GE.Zero(),this.centerWorld=o.GE.Zero(),this.extendSize=o.GE.Zero(),this.extendSizeWorld=o.GE.Zero(),this.directions=(0,z.b)(3,o.GE.Zero),this.vectorsWorld=(0,z.b)(8,o.GE.Zero),this.minimumWorld=o.GE.Zero(),this.maximumWorld=o.GE.Zero(),this.minimum=o.GE.Zero(),this.maximum=o.GE.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(B,E,v)}reConstruct(B,E,v){const z=B.x,q=B.y,c=B.z,S=E.x,x=E.y,D=E.z,h=this.vectors;this.minimum.Yc(z,q,c),this.maximum.Yc(S,x,D),h[0].Yc(z,q,c),h[1].Yc(S,x,D),h[2].Yc(S,q,c),h[3].Yc(z,x,c),h[4].Yc(z,q,D),h[5].Yc(S,x,c),h[6].Yc(z,x,D),h[7].Yc(S,q,D),E.addToRef(B,this.center).scaleInPlace(.5),E.subtractToRef(B,this.extendSize).scaleInPlace(.5),this._worldMatrix=v||o.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(B){const E=c._TmpVector3,v=this.maximum.subtractToRef(this.minimum,E[0]),z=v.length();v.normalizeFromLength(z);const o=z*B,q=v.scaleInPlace(.5*o),S=this.center.subtractToRef(q,E[1]),x=this.center.addToRef(q,E[2]);return this.reConstruct(S,x,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(B){const E=this.minimumWorld,v=this.maximumWorld,z=this.directions,q=this.vectorsWorld,c=this.vectors;if(B.isIdentity()){E.S(this.minimum),v.S(this.maximum);for(let B=0;B<8;++B)q[B].S(c[B]);this.extendSizeWorld.S(this.extendSize),this.centerWorld.S(this.center)}else{E.mc(Number.MAX_VALUE),v.mc(-Number.MAX_VALUE);for(let z=0;z<8;++z){const S=q[z];o.GE.TransformCoordinatesToRef(c[z],B,S),E.minimizeInPlace(S),v.maximizeInPlace(S)}v.subtractToRef(E,this.extendSizeWorld).scaleInPlace(.5),v.addToRef(E,this.centerWorld).scaleInPlace(.5)}o.GE.FromArrayToRef(B.m,0,z[0]),o.GE.FromArrayToRef(B.m,4,z[1]),o.GE.FromArrayToRef(B.m,8,z[2]),this._worldMatrix=B}isInFrustum(B){return c.IsInFrustum(this.vectorsWorld,B)}isCompletelyInFrustum(B){return c.IsCompletelyInFrustum(this.vectorsWorld,B)}intersectsPoint(B){const E=this.minimumWorld,v=this.maximumWorld,z=E.x,o=E.y,c=E.z,S=v.x,x=v.y,D=v.z,h=B.x,y=B.y,Q=B.z,P=-q.e;return!(S-h<P||P>h-z)&&(!(x-y<P||P>y-o)&&!(D-Q<P||P>Q-c))}intersectsSphere(B){return c.IntersectsSphere(this.minimumWorld,this.maximumWorld,B.centerWorld,B.radiusWorld)}intersectsMinMax(B,E){const v=this.minimumWorld,z=this.maximumWorld,o=v.x,q=v.y,c=v.z,S=z.x,x=z.y,D=z.z,h=B.x,y=B.y,Q=B.z,P=E.x,G=E.y,Y=E.z;return!(S<h||o>P)&&(!(x<y||q>G)&&!(D<Q||c>Y))}dispose(){var B,E;null===(B=this._drawWrapperFront)||void 0===B||B.dispose(),null===(E=this._drawWrapperBack)||void 0===E||E.dispose()}static Intersects(B,E){return B.intersectsMinMax(E.minimumWorld,E.maximumWorld)}static IntersectsSphere(B,E,v,z){const q=c._TmpVector3[0];o.GE.ClampToRef(v,B,E,q);return o.GE.DistanceSquared(v,q)<=z*z}static IsCompletelyInFrustum(B,E){for(let v=0;v<6;++v){const z=E[v];for(let E=0;E<8;++E)if(z.dotCoordinate(B[E])<0)return!1}return!0}static IsInFrustum(B,E){for(let v=0;v<6;++v){let z=!0;const o=E[v];for(let E=0;E<8;++E)if(o.dotCoordinate(B[E])>=0){z=!1;break}if(z)return!1}return!0}}c._TmpVector3=(0,z.b)(3,o.GE.Zero)},11722:(B,E,v)=>{v.d(E,{c:()=>y});var z=v(11385),o=v(11380),q=v(11728),c=v(11737);const S={min:0,max:0},x={min:0,max:0},D=(B,E,v)=>{const z=o.GE.Dot(E.centerWorld,B),q=Math.abs(o.GE.Dot(E.directions[0],B))*E.extendSize.x+Math.abs(o.GE.Dot(E.directions[1],B))*E.extendSize.y+Math.abs(o.GE.Dot(E.directions[2],B))*E.extendSize.z;v.min=z-q,v.max=z+q},h=(B,E,v)=>(D(B,E,S),D(B,v,x),!(S.min>x.max||x.min>S.max));class y{constructor(B,E,v){this._isLocked=!1,this.boundingBox=new q.b(B,E,v),this.boundingSphere=new c.d(B,E,v)}reConstruct(B,E,v){this.boundingBox.reConstruct(B,E,v),this.boundingSphere.reConstruct(B,E,v)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(B){this._isLocked=B}update(B){this._isLocked||(this.boundingBox._update(B),this.boundingSphere._update(B))}centerOn(B,E){const v=y._TmpVector3[0].S(B).wy(E),z=y._TmpVector3[1].S(B).addInPlace(E);return this.boundingBox.reConstruct(v,z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(v,z,this.boundingBox.getWorldMatrix()),this}encapsulate(B){const E=o.GE.Minimize(this.minimum,B),v=o.GE.Maximize(this.maximum,B);return this.reConstruct(E,v,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(B){const E=o.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(E);const v=o.TmpVectors.GE[0];return o.GE.TransformCoordinatesToRef(B.boundingBox.minimumWorld,E,v),this.encapsulate(v),o.GE.TransformCoordinatesToRef(B.boundingBox.maximumWorld,E,v),this.encapsulate(v),this}scale(B){return this.boundingBox.scale(B),this.boundingSphere.scale(B),this}isInFrustum(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===E||3===E)&&this.boundingSphere.isCenterInFrustum(B))return!0;if(!this.boundingSphere.isInFrustum(B))return!1;return!(1!==E&&3!==E)||this.boundingBox.isInFrustum(B)}get diagonalLength(){const B=this.boundingBox;return B.maximumWorld.subtractToRef(B.minimumWorld,y._TmpVector3[0]).length()}isCompletelyInFrustum(B){return this.boundingBox.isCompletelyInFrustum(B)}_checkCollision(B){return B._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(B){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(B)&&!!this.boundingBox.intersectsPoint(B))}intersects(B,E){if(!c.d.Intersects(this.boundingSphere,B.boundingSphere))return!1;if(!q.b.Intersects(this.boundingBox,B.boundingBox))return!1;if(!E)return!0;const v=this.boundingBox,z=B.boundingBox;return!!h(v.directions[0],v,z)&&(!!h(v.directions[1],v,z)&&(!!h(v.directions[2],v,z)&&(!!h(z.directions[0],v,z)&&(!!h(z.directions[1],v,z)&&(!!h(z.directions[2],v,z)&&(!!h(o.GE.Cross(v.directions[0],z.directions[0]),v,z)&&(!!h(o.GE.Cross(v.directions[0],z.directions[1]),v,z)&&(!!h(o.GE.Cross(v.directions[0],z.directions[2]),v,z)&&(!!h(o.GE.Cross(v.directions[1],z.directions[0]),v,z)&&(!!h(o.GE.Cross(v.directions[1],z.directions[1]),v,z)&&(!!h(o.GE.Cross(v.directions[1],z.directions[2]),v,z)&&(!!h(o.GE.Cross(v.directions[2],z.directions[0]),v,z)&&(!!h(o.GE.Cross(v.directions[2],z.directions[1]),v,z)&&!!h(o.GE.Cross(v.directions[2],z.directions[2]),v,z))))))))))))))}}y._TmpVector3=(0,z.b)(2,o.GE.Zero)},11737:(B,E,v)=>{v.d(E,{d:()=>q});var z=v(11385),o=v(11380);class q{constructor(B,E,v){this.center=o.GE.Zero(),this.centerWorld=o.GE.Zero(),this.minimum=o.GE.Zero(),this.maximum=o.GE.Zero(),this.reConstruct(B,E,v)}reConstruct(B,E,v){this.minimum.S(B),this.maximum.S(E);const z=o.GE.Distance(B,E);E.addToRef(B,this.center).scaleInPlace(.5),this.radius=.5*z,this._update(v||o.Matrix.IdentityReadOnly)}scale(B){const E=this.radius*B,v=q._TmpVector3,z=v[0].mc(E),o=this.center.subtractToRef(z,v[1]),c=this.center.addToRef(z,v[2]);return this.reConstruct(o,c,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(B){if(B.isIdentity())this.centerWorld.S(this.center),this.radiusWorld=this.radius;else{o.GE.TransformCoordinatesToRef(this.center,B,this.centerWorld);const E=q._TmpVector3[0];o.GE.TransformNormalFromFloatsToRef(1,1,1,B,E),this.radiusWorld=Math.max(Math.abs(E.x),Math.abs(E.y),Math.abs(E.z))*this.radius}}isInFrustum(B){const E=this.centerWorld,v=this.radiusWorld;for(let z=0;z<6;z++)if(B[z].dotCoordinate(E)<=-v)return!1;return!0}isCenterInFrustum(B){const E=this.centerWorld;for(let v=0;v<6;v++)if(B[v].dotCoordinate(E)<0)return!1;return!0}intersectsPoint(B){const E=o.GE.DistanceSquared(this.centerWorld,B);return!(this.radiusWorld*this.radiusWorld<E)}static Intersects(B,E){const v=o.GE.DistanceSquared(B.centerWorld,E.centerWorld),z=B.radiusWorld+E.radiusWorld;return!(z*z<v)}static CreateFromCenterAndRadius(B,E,v){this._TmpVector3[0].S(B),this._TmpVector3[1].Yc(0,0,E),this._TmpVector3[2].S(B),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].wy(this._TmpVector3[1]);const z=new q(this._TmpVector3[0],this._TmpVector3[2]);return z._worldMatrix=v||o.Matrix.Identity(),z}}q._TmpVector3=(0,z.b)(3,o.GE.Zero)},11752:(B,E,v)=>{function z(B){-1===B.indexOf("vClipPlane")&&B.push("vClipPlane"),-1===B.indexOf("vClipPlane2")&&B.push("vClipPlane2"),-1===B.indexOf("vClipPlane3")&&B.push("vClipPlane3"),-1===B.indexOf("vClipPlane4")&&B.push("vClipPlane4"),-1===B.indexOf("vClipPlane5")&&B.push("vClipPlane5"),-1===B.indexOf("vClipPlane6")&&B.push("vClipPlane6")}function o(B,E,v){const z=!!(B.clipPlane??E.clipPlane),o=!!(B.clipPlane2??E.clipPlane2),q=!!(B.clipPlane3??E.clipPlane3),c=!!(B.clipPlane4??E.clipPlane4),S=!!(B.clipPlane5??E.clipPlane5),x=!!(B.clipPlane6??E.clipPlane6);z&&v.push("#define CLIPPLANE"),o&&v.push("#define CLIPPLANE2"),q&&v.push("#define CLIPPLANE3"),c&&v.push("#define CLIPPLANE4"),S&&v.push("#define CLIPPLANE5"),x&&v.push("#define CLIPPLANE6")}function q(B,E,v){let z=!1;const o=!!(B.clipPlane??E.clipPlane),q=!!(B.clipPlane2??E.clipPlane2),c=!!(B.clipPlane3??E.clipPlane3),S=!!(B.clipPlane4??E.clipPlane4),x=!!(B.clipPlane5??E.clipPlane5),D=!!(B.clipPlane6??E.clipPlane6);return v.CLIPPLANE!==o&&(v.CLIPPLANE=o,z=!0),v.CLIPPLANE2!==q&&(v.CLIPPLANE2=q,z=!0),v.CLIPPLANE3!==c&&(v.CLIPPLANE3=c,z=!0),v.CLIPPLANE4!==S&&(v.CLIPPLANE4=S,z=!0),v.CLIPPLANE5!==x&&(v.CLIPPLANE5=x,z=!0),v.CLIPPLANE6!==D&&(v.CLIPPLANE6=D,z=!0),z}function c(B,E,v){let z=E.clipPlane??v.clipPlane;S(B,"vClipPlane",z),z=E.clipPlane2??v.clipPlane2,S(B,"vClipPlane2",z),z=E.clipPlane3??v.clipPlane3,S(B,"vClipPlane3",z),z=E.clipPlane4??v.clipPlane4,S(B,"vClipPlane4",z),z=E.clipPlane5??v.clipPlane5,S(B,"vClipPlane5",z),z=E.clipPlane6??v.clipPlane6,S(B,"vClipPlane6",z)}function S(B,E,v){v&&B.setFloat4(E,v.normal.x,v.normal.y,v.normal.z,v.d)}v.d(E,{d:()=>z,f:()=>c,g:()=>q,i:()=>o})},11688:(B,E,v)=>{v.d(E,{c:()=>z});class z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(B,E){this._defines[B]||(B<this._currentRank&&(this._currentRank=B),B>this._maxRank&&(this._maxRank=B),this._defines[B]=new Array),this._defines[B].push(E)}addCPUSkinningFallback(B,E){this._mesh=E,B<this._currentRank&&(this._currentRank=B),B>this._maxRank&&(this._maxRank=B)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(B,E){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,B=B.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),E._bonesComputationForcedToCPU=!0;const v=this._mesh.rB();for(let B=0;B<v.meshes.length;B++){const z=v.meshes[B];if(z.material){if(z.computeBonesUsingShaders&&0!==z.numBoneInfluencers)if(z.material.getEffect()===E)z.computeBonesUsingShaders=!1;else if(z.qc)for(const B of z.qc){if(B.effect===E){z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&z.computeBonesUsingShaders&&z.numBoneInfluencers>0&&(z.computeBonesUsingShaders=!1)}}else{const E=this._defines[this._currentRank];if(E)for(let v=0;v<E.length;v++)B=B.replace("#define "+E[v],"");this._currentRank++}return B}}},11706:(B,E,v)=>{v.d(E,{c:()=>a});var z=v(11366),o=v(11372),q=v(11193),c=v(11202),S=v(11242),x=v(11714),D=v(11629),h=v(11213),y=v(11420),Q=v(11480),P=v(11409);class G{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(B){this._func=B}get funcRef(){return this._funcRef}set funcRef(B){this._funcRef=B}get funcMask(){return this._funcMask}set funcMask(B){this._funcMask=B}get opStencilFail(){return this._opStencilFail}set opStencilFail(B){this._opStencilFail=B}get opDepthFail(){return this._opDepthFail}set opDepthFail(B){this._opDepthFail=B}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(B){this._opStencilDepthPass=B}get mask(){return this._mask}set mask(B){this._mask=B}get enabled(){return this._enabled}set enabled(B){this._enabled=B}getClassName(){return"MaterialStencilState"}copyTo(B){P.b.Clone((()=>B),this)}serialize(){return P.b.Serialize(this)}parse(B,E,v){P.b.Parse((()=>this),B,E,v)}}(0,z.c)([(0,o.K)()],G.prototype,"func",null),(0,z.c)([(0,o.K)()],G.prototype,"funcRef",null),(0,z.c)([(0,o.K)()],G.prototype,"funcMask",null),(0,z.c)([(0,o.K)()],G.prototype,"opStencilFail",null),(0,z.c)([(0,o.K)()],G.prototype,"opDepthFail",null),(0,z.c)([(0,o.K)()],G.prototype,"opStencilDepthPass",null),(0,z.c)([(0,o.K)()],G.prototype,"mask",null),(0,z.c)([(0,o.K)()],G.prototype,"enabled",null);var Y=v(11749);class a{get _supportGlowLayer(){return!1}set _glowModeEnabled(B){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(B){if(this._alpha===B)return;const E=this._alpha;this._alpha=B,1!==E&&1!==B||this.mh(a.MiscDirtyFlag+a.PrePassDirtyFlag)}get alpha(){return this._alpha}set Gc(B){this._backFaceCulling!==B&&(this._backFaceCulling=B,this.mh(a.TextureDirtyFlag))}get Gc(){return this._backFaceCulling}set cullBackFaces(B){this._cullBackFaces!==B&&(this._cullBackFaces=B,this.mh(a.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(B){this._blockDirtyMechanism!==B&&(this._blockDirtyMechanism=B,B||this.fQ())}atomicMaterialsUpdate(B){this.blockDirtyMechanism=!0;try{B(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(B){this._onDisposeObserver&&this.eq.remove(this._onDisposeObserver),this._onDisposeObserver=this.eq.add(B)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new c.e),this._onBindObservable}set onBind(B){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(B)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new c.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new c.e),this._onEffectCreatedObservable}set alphaMode(B){this._alphaMode!==B&&(this._alphaMode=B,this.mh(a.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(B){this._needDepthPrePass!==B&&(this._needDepthPrePass=B,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(B){this._fogEnabled!==B&&(this._fogEnabled=B,this.mh(a.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case a.WireFrameFillMode:case a.LineListDrawMode:case a.LineLoopDrawMode:case a.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(B){this.fillMode=B?a.WireFrameFillMode:a.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case a.PointFillMode:case a.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(B){this.fillMode=B?a.PointFillMode:a.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(B){this._fillMode!==B&&(this._fillMode=B,this.mh(a.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(B){const E=this.rB().getEngine().getCaps().fragmentDepthSupported;B&&!E&&h.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=B&&E,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(B){this._drawWrapper=B}constructor(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.eq=new c.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new G,this._useUBO=!1,this._fillMode=a.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=B;const o=E||S.b.LastCreatedScene;o&&(this._scene=o,this._dirtyCallbacks={},this._forceGLSL=z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=B||q.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Q.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new D.c(this._scene.getEngine(),void 0,void 0,B),this._useUBO=this.rB().getEngine().supportsUniformBuffers,this._createUniformBuffer(),v||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),a.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var B;const E=this.rB().getEngine();null===(B=this._uniformBuffer)||void 0===B||B.dispose(),E.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new D.c(E,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new D.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(B){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.fQ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.fQ(),this.checkReadyOnlyOnce=!1}isReady(B,E){return!0}isReadyForSubMesh(B,E,v){const z=E.materialDefines;return!!z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}rB(){return this._scene}_getEffectiveOrientation(B){return null!==this.sideOrientation?this.sideOrientation:B.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(B){this._transparencyMode!==B&&(this._transparencyMode=B,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===a.MATERIAL_ALPHABLEND||this._transparencyMode===a.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===a.MATERIAL_ALPHATEST||this._transparencyMode===a.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===a.MATERIAL_OPAQUE||this._transparencyMode===a.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(B){return this._hasTransparencyMode?this._transparencyModeIsBlend:B.visibility<1||!this._disableAlphaBlending&&(B.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(B){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(B)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}fQ(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=this.rB().meshes;for(const v of E)if(v.qc)for(const E of v.qc)if(E.HB()===this)for(const v of E._drawWrappers)v&&this._materialContext===v.materialContext&&(v._wasPreviouslyReady=!1,v._wasPreviouslyUsingInstances=null,v._forceRebindOnNextCall=B);B&&this.mh(a.AllDirtyFlag)}_preBind(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this._scene.getEngine(),z=(null==E?this.sideOrientation:E)===a.ClockWiseSideOrientation;return v.enableEffect(B||this._getDrawWrapper()),v.setState(this.Gc,this.zOffset,!1,z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),z}bind(B,E){}buildUniformLayout(){const B=this._uniformBuffer;this._eventInfo.ubo=B,this._callbackPluginEventGeneric(8,this._eventInfo),B.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(B,E,v){const z=v._drawWrapper;this._eventInfo.subMesh=v,this._callbackPluginEventBindForSubMesh(this._eventInfo),z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(B){}bindView(B){this._useUBO?this._needToBindSceneUbo=!0:B.setMatrix("view",this.rB().getViewMatrix())}bindViewProjection(B){this._useUBO?this._needToBindSceneUbo=!0:(B.setMatrix("viewProjection",this.rB().getTransformMatrix()),B.setMatrix("projection",this.rB().getProjectionMatrix()))}bindEyePosition(B,E){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(B,E)}_afterBind(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&E&&(this._needToBindSceneUbo=!1,(0,Y.n)(E,this.rB().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=B?B.visibility:1,this._onBindObservable&&B&&this._onBindObservable.notifyObservers(B),this.disableDepthWrite){const B=this._scene.getEngine();this._cachedDepthWriteState=B.getDepthWrite(),B.setDepthWrite(!1)}if(this.disableColorWrite){const B=this._scene.getEngine();this._cachedColorWriteState=B.getColorWrite(),B.setColorWrite(!1)}if(0!==this.depthFunction){const B=this._scene.getEngine();this._cachedDepthFunctionState=B.getDepthFunction()||0,B.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(B){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=B,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(B){return null}_clonePlugins(B,E){const v={};if(this._serializePlugins(v),a._ParsePlugins(v,B,this._scene,E),this.pluginManager)for(const z of this.pluginManager._plugins){const E=B.pluginManager.getPlugin(z.name);E&&z.copyTo(E)}}getBindedMeshes(){if(this.meshMap){const B=[];for(const E in this.meshMap){const v=this.meshMap[E];v&&B.push(v)}return B}return this._scene.meshes.filter((B=>B.material===this))}forceCompilation(B,E,v,z){const o={clipPlane:!1,useInstances:!1,...v},q=this.rB(),c=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const S=()=>{if(!this._scene||!this._scene.getEngine())return;const v=q.clipPlane;if(o.clipPlane&&(q.clipPlane=new y.d(0,0,0,1)),this._storeEffectOnSubMeshes){let v=!0,q=null;if(B.qc){const E=new x.b(0,0,0,0,0,B,void 0,!1,!1);E.materialDefines&&(E.materialDefines._renderId=-1),this.isReadyForSubMesh(B,E,o.useInstances)||(E.effect&&E.effect.getCompilationError()&&E.effect.allFallbacksProcessed()?q=E.effect.getCompilationError():(v=!1,setTimeout(S,16)))}v&&(this.allowShaderHotSwapping=c,q&&z&&z(q),E&&E(this))}else this.isReady()?(this.allowShaderHotSwapping=c,E&&E(this)):setTimeout(S,16);o.clipPlane&&(q.clipPlane=v)};S()}async forceCompilationAsync(B,E){return await new Promise(((v,z)=>{this.forceCompilation(B,(()=>{v()}),E,(B=>{z(B)}))}))}mh(B){this.rB().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(a._DirtyCallbackArray.length=0,B&a.ImageProcessingDirtyFlag&&a._DirtyCallbackArray.push(a._ImageProcessingDirtyCallBack),B&a.TextureDirtyFlag&&a._DirtyCallbackArray.push(a._TextureDirtyCallBack),B&a.LightDirtyFlag&&a._DirtyCallbackArray.push(a._LightsDirtyCallBack),B&a.FresnelDirtyFlag&&a._DirtyCallbackArray.push(a._FresnelDirtyCallBack),B&a.AttributesDirtyFlag&&a._DirtyCallbackArray.push(a._AttributeDirtyCallBack),B&a.MiscDirtyFlag&&a._DirtyCallbackArray.push(a._MiscDirtyCallBack),B&a.PrePassDirtyFlag&&a._DirtyCallbackArray.push(a._PrePassDirtyCallBack),a._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(a._RunDirtyCallBacks),this.rB().resetCachedMaterial())}resetDrawCache(){const B=this.rB().meshes;for(const E of B)if(E.qc)for(const B of E.qc)B.HB()===this&&B.resetDrawCache()}_markAllSubMeshesAsDirty(B){const E=this.rB();if(E.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const v=E.meshes;for(const z of v)if(z.qc)for(const v of z.qc){if((v.HB()||(E._hasDefaultMaterial?E.defaultMaterial:null))===this)for(const E of v._drawWrappers)E&&E.defines&&E.defines.markAllAsDirty&&this._materialContext===E.materialContext&&B(E.defines)}}_markScenePrePassDirty(){if(this.rB().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const B=this.rB().enablePrePassRenderer();B&&B.mh()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(a._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(a._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(a._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(a._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(a._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(a._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(a._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(a._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(a._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(a._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const B=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.eq.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(B)}))}}setPrePassRenderer(B){return!1}dispose(B,E,v){const z=this.rB();if(z.stopAnimation(this),z.freeProcessedMaterials(),z.removeMaterial(this),this._eventInfo.forceDisposeTextures=E,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const B=this._parentContainer.materials.indexOf(this);B>-1&&this._parentContainer.materials.splice(B,1),this._parentContainer=null}if(!0!==v)if(this.meshMap)for(const o in this.meshMap){const B=this.meshMap[o];this._disposeMeshResources(B)}else{const B=z.meshes;for(const E of B)this._disposeMeshResources(E)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.eq.notifyObservers(this),this.eq.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(B){if(!B)return;const E=B.Qc,v=B._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(B.qc&&v)for(const o of B.qc){const B=o._drawWrappers;for(let q=0;q<B.length;q++){var z;const c=null===(z=B[q])||void 0===z?void 0:z.effect;if(!c)continue;v[q]===this&&(null===E||void 0===E||E._releaseVertexArrayObject(c),o._removeDrawWrapper(q,!0,!0))}}}else null===E||void 0===E||E._releaseVertexArrayObject(this._drawWrapper.effect);B.material!==this||B.sourceMesh||(B.material=null)}serialize(){const B=P.b.Serialize(this);return B.stencil=this.stencil.serialize(),B.uniqueId=this.uniqueId,this._serializePlugins(B),B}_serializePlugins(B){if(B.plugins={},this.pluginManager)for(const E of this.pluginManager._plugins)E.doNotSerialize||(B.plugins[E.getClassName()]=E.serialize())}static Parse(B,E,v){if(B.customType){if("BABYLON.PBRMaterial"===B.customType&&B.overloadedAlbedo&&(B.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else B.customType="BABYLON.StandardMaterial";const z=q.Tools.Instantiate(B.customType).Parse(B,E,v);return z._loadedUniqueId=B.uniqueId,z}static _ParsePlugins(B,E,v,z){if(B.plugins)for(const S in B.plugins){var o,c;const x=B.plugins[S];let D=null===(o=E.pluginManager)||void 0===o?void 0:o.getPlugin(x.name);if(!D){const B=q.Tools.Instantiate("BABYLON."+S);B&&(D=new B(E))}null===(c=D)||void 0===c||c.parse(x,v,z)}}}a.TriangleFillMode=0,a.WireFrameFillMode=1,a.PointFillMode=2,a.PointListDrawMode=3,a.LineListDrawMode=4,a.LineLoopDrawMode=5,a.LineStripDrawMode=6,a.TriangleStripDrawMode=7,a.TriangleFanDrawMode=8,a.ClockWiseSideOrientation=0,a.CounterClockWiseSideOrientation=1,a.ImageProcessingDirtyFlag=64,a.TextureDirtyFlag=1,a.LightDirtyFlag=2,a.FresnelDirtyFlag=4,a.AttributesDirtyFlag=8,a.MiscDirtyFlag=16,a.PrePassDirtyFlag=32,a.AllDirtyFlag=127,a.MATERIAL_OPAQUE=0,a.MATERIAL_ALPHATEST=1,a.MATERIAL_ALPHABLEND=2,a.MATERIAL_ALPHATESTANDBLEND=3,a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,a.MATERIAL_NORMALBLENDMETHOD_RNM=1,a.OnEventObservable=new c.e,a._AllDirtyCallBack=B=>B.markAllAsDirty(),a._ImageProcessingDirtyCallBack=B=>B.markAsImageProcessingDirty(),a._TextureDirtyCallBack=B=>B.markAsTexturesDirty(),a._FresnelDirtyCallBack=B=>B.markAsFresnelDirty(),a._MiscDirtyCallBack=B=>B.markAsMiscDirty(),a._PrePassDirtyCallBack=B=>B.markAsPrePassDirty(),a._LightsDirtyCallBack=B=>B.markAsLightDirty(),a._AttributeDirtyCallBack=B=>B.markAsAttributesDirty(),a._FresnelAndMiscDirtyCallBack=B=>{a._FresnelDirtyCallBack(B),a._MiscDirtyCallBack(B)},a._TextureAndMiscDirtyCallBack=B=>{a._TextureDirtyCallBack(B),a._MiscDirtyCallBack(B)},a._DirtyCallbackArray=[],a._RunDirtyCallBacks=B=>{for(const E of a._DirtyCallbackArray)E(B)},(0,z.c)([(0,o.K)()],a.prototype,"id",void 0),(0,z.c)([(0,o.K)()],a.prototype,"uniqueId",void 0),(0,z.c)([(0,o.K)()],a.prototype,"name",void 0),(0,z.c)([(0,o.K)()],a.prototype,"metadata",void 0),(0,z.c)([(0,o.K)()],a.prototype,"checkReadyOnEveryCall",void 0),(0,z.c)([(0,o.K)()],a.prototype,"checkReadyOnlyOnce",void 0),(0,z.c)([(0,o.K)()],a.prototype,"state",void 0),(0,z.c)([(0,o.K)("alpha")],a.prototype,"_alpha",void 0),(0,z.c)([(0,o.K)("Gc")],a.prototype,"_backFaceCulling",void 0),(0,z.c)([(0,o.K)("cullBackFaces")],a.prototype,"_cullBackFaces",void 0),(0,z.c)([(0,o.K)()],a.prototype,"sideOrientation",void 0),(0,z.c)([(0,o.K)("alphaMode")],a.prototype,"_alphaMode",void 0),(0,z.c)([(0,o.K)()],a.prototype,"_needDepthPrePass",void 0),(0,z.c)([(0,o.K)()],a.prototype,"disableDepthWrite",void 0),(0,z.c)([(0,o.K)()],a.prototype,"disableColorWrite",void 0),(0,z.c)([(0,o.K)()],a.prototype,"forceDepthWrite",void 0),(0,z.c)([(0,o.K)()],a.prototype,"depthFunction",void 0),(0,z.c)([(0,o.K)()],a.prototype,"separateCullingPass",void 0),(0,z.c)([(0,o.K)("fogEnabled")],a.prototype,"_fogEnabled",void 0),(0,z.c)([(0,o.K)()],a.prototype,"pointSize",void 0),(0,z.c)([(0,o.K)()],a.prototype,"zOffset",void 0),(0,z.c)([(0,o.K)()],a.prototype,"zOffsetUnits",void 0),(0,z.c)([(0,o.K)()],a.prototype,"pointsCloud",null),(0,z.c)([(0,o.K)()],a.prototype,"fillMode",null),(0,z.c)([(0,o.K)()],a.prototype,"useLogarithmicDepth",null),(0,z.c)([(0,o.K)()],a.prototype,"transparencyMode",null)},11749:(B,E,v)=>{v.d(E,{C:()=>i,E:()=>P,I:()=>Q,K:()=>A,L:()=>f,P:()=>K,T:()=>m,W:()=>I,Z:()=>l,bb:()=>d,cb:()=>t,e:()=>T,eb:()=>H,g:()=>y,gb:()=>G,j:()=>X,k:()=>h,m:()=>Y,n:()=>a,q:()=>g,u:()=>u,v:()=>V,y:()=>r});var z=v(11213),o=v(11417),q=v(11242),c=v(11679),S=v(11752);const x=o.gE.Black(),D={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function h(B,E,v){if(!B||B.LOGARITHMICDEPTH||B.indexOf&&B.indexOf("LOGARITHMICDEPTH")>=0){const B=v.activeCamera;1===B.mode&&z.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),E.setFloat("logarithmicDepthConstant",2/(Math.log(B.maxZ+1)/Math.LN2))}}function y(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v&&B.fogEnabled&&(!E||E.applyFog)&&0!==B.fogMode&&(v.setFloat4("vFogInfos",B.fogMode,B.fogStart,B.fogEnd,B.fogDensity),z?(B.fogColor.toLinearSpaceToRef(x,B.getEngine().useExactSrgbConversions),v.setColor3("vFogColor",x)):v.setColor3("vFogColor",B.fogColor))}function Q(B,E,v,z,o,q,c,S,x,h){const y=B.numMaxInfluencers||B.numInfluencers;return y<=0?0:(E.push("#define MORPHTARGETS"),B.hasPositions&&E.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),B.hasNormals&&E.push("#define MORPHTARGETTEXTURE_HASNORMALS"),B.hasTangents&&E.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),B.hasUVs&&E.push("#define MORPHTARGETTEXTURE_HASUVS"),B.hasUV2s&&E.push("#define MORPHTARGETTEXTURE_HASUV2S"),B.hasColors&&E.push("#define MORPHTARGETTEXTURE_HASCOLORS"),B.supportsPositions&&o&&E.push("#define MORPHTARGETS_POSITION"),B.supportsNormals&&q&&E.push("#define MORPHTARGETS_NORMAL"),B.supportsTangents&&c&&E.push("#define MORPHTARGETS_TANGENT"),B.supportsUVs&&S&&E.push("#define MORPHTARGETS_UV"),B.supportsUV2s&&x&&E.push("#define MORPHTARGETS_UV2"),B.supportsColors&&h&&E.push("#define MORPHTARGETS_COLOR"),E.push("#define NUM_MORPH_INFLUENCERS "+y),B.isUsingTextureForTargets&&E.push("#define MORPHTARGETS_TEXTURE"),D.NUM_MORPH_INFLUENCERS=y,D.NORMAL=q,D.TANGENT=c,D.UV=S,D.UV2=x,D.COLOR=h,P(v,z,D,o),y)}function P(B,E,v){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=v.NUM_MORPH_INFLUENCERS;if(c>0&&q.b.LastCreatedEngine){const S=q.b.LastCreatedEngine.getCaps().maxVertexAttribs,x=E.morphTargetManager;if(null!==x&&void 0!==x&&x.isUsingTextureForTargets)return;const D=x&&x.supportsPositions&&o,h=x&&x.supportsNormals&&v.NORMAL,y=x&&x.supportsTangents&&v.TANGENT,Q=x&&x.supportsUVs&&v.UV1,P=x&&x.supportsUV2s&&v.UV2,G=x&&x.supportsColors&&v.VERTEXCOLOR;for(let v=0;v<c;v++)D&&B.push("position"+v),h&&B.push("normal"+v),y&&B.push("tangent"+v),Q&&B.push("uv_"+v),P&&B.push("uv2_"+v),G&&B.push("color"+v),B.length>S&&z.c.Error("Cannot add more vertex attributes for mesh "+E.name)}}function G(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B.push("world0"),B.push("world1"),B.push("world2"),B.push("world3"),E&&(B.push("previousWorld0"),B.push("previousWorld1"),B.push("previousWorld2"),B.push("previousWorld3"))}function Y(B,E){const v=B.morphTargetManager;B&&v&&E.setFloatArray("morphTargetInfluences",v.influences)}function a(B,E){E.bindToEffect(B,"Scene")}function m(B,E,v){E._needUVs=!0,E[v]=!0,B.optimizeUVAllocation&&B.getTextureMatrix().isIdentityAs3x2()?(E[v+"DIRECTUV"]=B.coordinatesIndex+1,E["MAINUV"+(B.coordinatesIndex+1)]=!0):E[v+"DIRECTUV"]=0}function g(B,E,v){const z=B.getTextureMatrix();E.hc(v+"Matrix",z)}function V(B,E,v){v.BAKED_VERTEX_ANIMATION_TEXTURE&&v.INSTANCES&&B.push("bakedVertexAnimationSettingsInstanced")}function T(B,E,v){var z;if(E&&B&&(B.computeBonesUsingShaders&&E._bonesComputationForcedToCPU&&(B.computeBonesUsingShaders=!1),B.useBones&&B.computeBonesUsingShaders&&B.skeleton)){const o=B.skeleton;if(o.isUsingTextureForMatrices&&E.getUniformIndex("boneTextureWidth")>-1){const v=o.getTransformMatrixTexture(B);E.setTexture("boneSampler",v),E.setFloat("boneTextureWidth",4*(o.bones.length+1))}else{const q=o.getTransformMatrices(B);q&&(E.setMatrices("mBones",q),v&&B.rB().prePassRenderer&&B.rB().prePassRenderer.getIndex(2)&&(v.previousBones[B.uniqueId]||(v.previousBones[B.uniqueId]=q.slice()),E.setMatrices("mPreviousBones",v.previousBones[B.uniqueId]),z=q,v.previousBones[B.uniqueId].set(z)))}}}function N(B,E,v,z,o){let q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];B._bindLight(E,v,z,o,q)}function X(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const q=Math.min(E.lightSources.length,o);for(let c=0;c<q;c++){N(E.lightSources[c],c,B,v,"boolean"===typeof z?z:z.SPECULARTERM,E.receiveShadows)}}function r(B,E,v,z){v.NUM_BONE_INFLUENCERS>0&&(z.addCPUSkinningFallback(0,E),B.push("matricesIndices"),B.push("matricesWeights"),v.NUM_BONE_INFLUENCERS>4&&(B.push("matricesIndicesExtra"),B.push("matricesWeightsExtra")))}function i(B,E){(E.INSTANCES||E.THIN_INSTANCES)&&G(B,!!E.PREPASS_VELOCITY),E.INSTANCESCOLOR&&B.push("instanceColor")}function u(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=0;for(let q=0;q<v&&B["LIGHT"+q];q++)q>0&&(o=z+q,E.addFallback(o,"LIGHT"+q)),B.SHADOWS||(B["SHADOW"+q]&&E.addFallback(z,"SHADOW"+q),B["SHADOWPCF"+q]&&E.addFallback(z,"SHADOWPCF"+q),B["SHADOWPCSS"+q]&&E.addFallback(z,"SHADOWPCSS"+q),B["SHADOWPOISSON"+q]&&E.addFallback(z,"SHADOWPOISSON"+q),B["SHADOWESM"+q]&&E.addFallback(z,"SHADOWESM"+q),B["SHADOWCLOSEESM"+q]&&E.addFallback(z,"SHADOWCLOSEESM"+q));return o++}function I(B,E,v,z,o,q,c){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];c._areMiscDirty&&(c.LOGARITHMICDEPTH=v,c.POINTSIZE=z,c.FOG=o&&function(B,E){return E.fogEnabled&&B.applyFog&&0!==E.fogMode}(B,E),c.NONUNIFORMSCALING=B.nonUniformScaling,c.ALPHATEST=q,c.DECAL_AFTER_DETAIL=S)}function K(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!v._areLightsDirty)return v._needNormals;let c=0;const S={needNormals:v._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(B.lightsEnabled&&!q)for(const D of E.lightSources)if(C(B,E,D,c,v,z,S),c++,c===o)break;v.SPECULARTERM=S.specularEnabled,v.SHADOWS=S.shadowEnabled;for(let D=c;D<o;D++)void 0!==v["LIGHT"+D]&&(v["LIGHT"+D]=!1,v["HEMILIGHT"+D]=!1,v["POINTLIGHT"+D]=!1,v["DIRLIGHT"+D]=!1,v["SPOTLIGHT"+D]=!1,v["AREALIGHT"+D]=!1,v["SHADOW"+D]=!1,v["SHADOWCSM"+D]=!1,v["SHADOWCSMDEBUG"+D]=!1,v["SHADOWCSMNUM_CASCADES"+D]=!1,v["SHADOWCSMUSESHADOWMAXZ"+D]=!1,v["SHADOWCSMNOBLEND"+D]=!1,v["SHADOWCSM_RIGHTHANDED"+D]=!1,v["SHADOWPCF"+D]=!1,v["SHADOWPCSS"+D]=!1,v["SHADOWPOISSON"+D]=!1,v["SHADOWESM"+D]=!1,v["SHADOWCLOSEESM"+D]=!1,v["SHADOWCUBE"+D]=!1,v["SHADOWLOWQUALITY"+D]=!1,v["SHADOWMEDIUMQUALITY"+D]=!1);const x=B.getEngine().getCaps();return void 0===v.SHADOWFLOAT&&(S.needRebuild=!0),v.SHADOWFLOAT=S.shadowEnabled&&(x.textureFloatRender&&x.textureFloatLinearFiltering||x.textureHalfFloatRender&&x.textureHalfFloatLinearFiltering),v.LIGHTMAPEXCLUDED=S.lightmapMode,S.needRebuild&&v.rebuild(),S.needNormals}function C(B,E,v,z,o,q,S){switch(S.needNormals=!0,void 0===o["LIGHT"+z]&&(S.needRebuild=!0),o["LIGHT"+z]=!0,o["SPOTLIGHT"+z]=!1,o["HEMILIGHT"+z]=!1,o["POINTLIGHT"+z]=!1,o["DIRLIGHT"+z]=!1,o["AREALIGHT"+z]=!1,v.prepareLightSpecificDefines(o,z),o["LIGHT_FALLOFF_PHYSICAL"+z]=!1,o["LIGHT_FALLOFF_GLTF"+z]=!1,o["LIGHT_FALLOFF_STANDARD"+z]=!1,v.falloffType){case c.d.FALLOFF_GLTF:o["LIGHT_FALLOFF_GLTF"+z]=!0;break;case c.d.FALLOFF_PHYSICAL:o["LIGHT_FALLOFF_PHYSICAL"+z]=!0;break;case c.d.FALLOFF_STANDARD:o["LIGHT_FALLOFF_STANDARD"+z]=!0}if(q&&!v.eh.equalsFloats(0,0,0)&&(S.specularEnabled=!0),o["SHADOW"+z]=!1,o["SHADOWCSM"+z]=!1,o["SHADOWCSMDEBUG"+z]=!1,o["SHADOWCSMNUM_CASCADES"+z]=!1,o["SHADOWCSMUSESHADOWMAXZ"+z]=!1,o["SHADOWCSMNOBLEND"+z]=!1,o["SHADOWCSM_RIGHTHANDED"+z]=!1,o["SHADOWPCF"+z]=!1,o["SHADOWPCSS"+z]=!1,o["SHADOWPOISSON"+z]=!1,o["SHADOWESM"+z]=!1,o["SHADOWCLOSEESM"+z]=!1,o["SHADOWCUBE"+z]=!1,o["SHADOWLOWQUALITY"+z]=!1,o["SHADOWMEDIUMQUALITY"+z]=!1,E&&E.receiveShadows&&B.shadowsEnabled&&v.shadowEnabled){const E=v.getShadowGenerator(B.activeCamera)??v.getShadowGenerator();if(E){const B=E.getShadowMap();B&&B.renderList&&B.renderList.length>0&&(S.shadowEnabled=!0,E.prepareDefines(o,z))}}v.lightmapMode!=c.d.LIGHTMAP_DEFAULT?(S.lightmapMode=!0,o["LIGHTMAPEXCLUDED"+z]=!0,o["LIGHTMAPNOSPECULAR"+z]=v.lightmapMode==c.d.LIGHTMAP_SHADOWSONLY):(o["LIGHTMAPEXCLUDED"+z]=!1,o["LIGHTMAPNOSPECULAR"+z]=!1)}function f(B,E,v,z,o){let q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=function(B,E){let v=!1;if(B.activeCamera){const z=E.CAMERA_ORTHOGRAPHIC?1:0,o=E.CAMERA_PERSPECTIVE?1:0,q=1===B.activeCamera.mode?1:0,c=0===B.activeCamera.mode?1:0;(z^q||o^c)&&(E.CAMERA_ORTHOGRAPHIC=1===q,E.CAMERA_PERSPECTIVE=1===c,v=!0)}return v}(B,z);!1!==q&&(x=(0,S.g)(v,B,z)),z.DEPTHPREPASS!==!E.getColorWrite()&&(z.DEPTHPREPASS=!z.DEPTHPREPASS,x=!0),z.INSTANCES!==o&&(z.INSTANCES=o,x=!0),z.THIN_INSTANCES!==c&&(z.THIN_INSTANCES=c,x=!0),x&&z.markAsUnprocessed()}function A(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!E._areAttributesDirty&&E._needNormals===E._normals&&E._needUVs===E._uvs)return!1;E._normals=E._needNormals,E._uvs=E._needUVs,E.NORMAL=E._needNormals&&B.isVerticesDataPresent("normal"),E._needNormals&&B.isVerticesDataPresent("tangent")&&(E.TANGENT=!0);for(let S=1;S<=6;++S)E["UV"+S]=!!E._needUVs&&B.isVerticesDataPresent(`uv${1===S?"":S}`);if(v){const v=B.useVertexColors&&B.isVerticesDataPresent("color");E.VERTEXCOLOR=v,E.VERTEXALPHA=B.hasVertexAlpha&&v&&q}return B.isVerticesDataPresent("instanceColor")&&(B.hasInstances||B.hasThinInstances)&&(E.INSTANCESCOLOR=!0),z&&function(B,E){if(B.useBones&&B.computeBonesUsingShaders&&B.skeleton){E.NUM_BONE_INFLUENCERS=B.numBoneInfluencers;const v=void 0!==E.BONETEXTURE;if(B.skeleton.isUsingTextureForMatrices&&v)E.BONETEXTURE=!0;else{E.BonesPerMesh=B.skeleton.bones.length+1,E.BONETEXTURE=!v&&void 0;const z=B.rB().prePassRenderer;if(z&&z.enabled){const v=-1===z.excludedSkinnedMesh.indexOf(B);E.BONES_VELOCITY_ENABLED=v}}}else E.NUM_BONE_INFLUENCERS=0,E.BonesPerMesh=0,void 0!==E.BONETEXTURE&&(E.BONETEXTURE=!1)}(B,E),o&&function(B,E){const v=B.morphTargetManager;v?(E.MORPHTARGETS_UV=v.supportsUVs&&E.UV1,E.MORPHTARGETS_UV2=v.supportsUV2s&&E.UV2,E.MORPHTARGETS_TANGENT=v.supportsTangents&&E.TANGENT,E.MORPHTARGETS_NORMAL=v.supportsNormals&&E.NORMAL,E.MORPHTARGETS_POSITION=v.supportsPositions,E.MORPHTARGETS_COLOR=v.supportsColors,E.MORPHTARGETTEXTURE_HASUVS=v.hasUVs,E.MORPHTARGETTEXTURE_HASUV2S=v.hasUV2s,E.MORPHTARGETTEXTURE_HASTANGENTS=v.hasTangents,E.MORPHTARGETTEXTURE_HASNORMALS=v.hasNormals,E.MORPHTARGETTEXTURE_HASPOSITIONS=v.hasPositions,E.MORPHTARGETTEXTURE_HASCOLORS=v.hasColors,E.NUM_MORPH_INFLUENCERS=v.numMaxInfluencers||v.numInfluencers,E.MORPHTARGETS=E.NUM_MORPH_INFLUENCERS>0,E.MORPHTARGETS_TEXTURE=v.isUsingTextureForTargets):(E.MORPHTARGETS_UV=!1,E.MORPHTARGETS_UV2=!1,E.MORPHTARGETS_TANGENT=!1,E.MORPHTARGETS_NORMAL=!1,E.MORPHTARGETS_POSITION=!1,E.MORPHTARGETS_COLOR=!1,E.MORPHTARGETTEXTURE_HASUVS=!1,E.MORPHTARGETTEXTURE_HASUV2S=!1,E.MORPHTARGETTEXTURE_HASTANGENTS=!1,E.MORPHTARGETTEXTURE_HASNORMALS=!1,E.MORPHTARGETTEXTURE_HASPOSITIONS=!1,E.MORPHTARGETTEXTURE_HAS_COLORS=!1,E.MORPHTARGETS=!1,E.NUM_MORPH_INFLUENCERS=0)}(B,E),c&&function(B,E){const v=B.bakedVertexAnimationManager;E.BAKED_VERTEX_ANIMATION_TEXTURE=!(!v||!v.isEnabled)}(B,E),!0}function l(B,E){if(B.activeCamera){const v=E.MULTIVIEW;E.MULTIVIEW=null!==B.activeCamera.outputRenderTarget&&B.activeCamera.outputRenderTarget.getViewCount()>1,E.MULTIVIEW!=v&&E.markAsUnprocessed()}}function d(B,E,v){const z=E.ORDER_INDEPENDENT_TRANSPARENCY,o=E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;E.ORDER_INDEPENDENT_TRANSPARENCY=B.useOrderIndependentTransparency&&v,E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!B.getEngine().getCaps().textureFloatLinearFiltering,z===E.ORDER_INDEPENDENT_TRANSPARENCY&&o===E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||E.markAsUnprocessed()}function t(B,E,v){const z=E.PREPASS;if(!E._arePrePassDirty)return;const o=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(B.prePassRenderer&&B.prePassRenderer.enabled&&v){E.PREPASS=!0,E.SCENE_MRT_COUNT=B.prePassRenderer.mrtCount,E.PREPASS_NORMAL_WORLDSPACE=B.prePassRenderer.generateNormalsInWorldSpace,E.PREPASS_COLOR=!0,E.PREPASS_COLOR_INDEX=0;for(let v=0;v<o.length;v++){const z=B.prePassRenderer.getIndex(o[v].type);-1!==z?(E[o[v].define]=!0,E[o[v].index]=z):E[o[v].define]=!1}}else{E.PREPASS=!1;for(let B=0;B<o.length;B++)E[o[B].define]=!1}E.PREPASS!=z&&(E.markAsUnprocessed(),E.markAsImageProcessingDirty())}function p(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];o&&o.push("Light"+B),q||(E.push("vLightData"+B,"vLightDiffuse"+B,"vLightSpecular"+B,"vLightDirection"+B,"vLightWidth"+B,"vLightHeight"+B,"vLightFalloff"+B,"vLightGround"+B,"lightMatrix"+B,"shadowsInfo"+B,"depthValues"+B),v.push("shadowTexture"+B),v.push("depthTexture"+B),E.push("viewFrustumZ"+B,"cascadeBlendFactor"+B,"lightSizeUVCorrection"+B,"depthCorrection"+B,"penumbraDarkness"+B,"frustumLengths"+B),z&&(v.push("projectionLightTexture"+B),E.push("textureProjectionMatrix"+B)),c&&v.push("iesLightTexture"+B))}function H(B,E,v){let z,o,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(B.uniformsNames){const c=B;z=c.uniformsNames,o=c.uniformBuffersNames,E=c.samplers,v=c.defines,q=c.maxSimultaneousLights||0}else z=B,E||(E=[]);for(let c=0;c<q&&v["LIGHT"+c];c++)p(c,z,E,v["PROJECTEDLIGHTTEXTURE"+c],o,!1,v["IESLIGHTTEXTURE"+c]);v.NUM_MORPH_INFLUENCERS&&(z.push("morphTargetInfluences"),z.push("morphTargetCount")),v.BAKED_VERTEX_ANIMATION_TEXTURE&&(z.push("bakedVertexAnimationSettings"),z.push("bakedVertexAnimationTextureSizeInverted"),z.push("bakedVertexAnimationTime"),E.push("bakedVertexAnimationTexture"))}},11697:(B,E,v)=>{v.d(E,{e:()=>q});var z=v(11380),o=v(11706);class q extends o.c{constructor(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(B,E,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new z.Matrix,this._storeEffectOnSubMeshes=v}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(B,E){return!!B&&(!this._storeEffectOnSubMeshes||(!B.qc||0===B.qc.length||this.isReadyForSubMesh(B,B.qc[0],E)))}_isReadyForSubMesh(B){const E=B.materialDefines;return!(this.checkReadyOnEveryCall||!B.effect||!E||E._renderId!==this.rB().getRenderId())}bindOnlyWorldMatrix(B){this._activeEffect.setMatrix("world",B)}bindOnlyNormalMatrix(B){this._activeEffect.setMatrix("normalMatrix",B)}bind(B,E){E&&this.bindForSubMesh(B,E,E.qc[0])}_afterBind(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0;super._afterBind(B,E,v),this.rB()._cachedEffect=E,v?v._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return v._drawWrapper._forceRebindOnNextCall||B.isCachedMaterialInvalid(this,E,z)}dispose(B,E,v){this._activeEffect=void 0,super.dispose(B,E,v)}}},11742:(B,E,v)=>{v.d(E,{c:()=>S,d:()=>x});var z=v(11366),o=v(11380),q=v(11372);class c{static extractMinAndMaxIndexed(B,E,v,z,o,q){for(let c=v;c<v+z;c++){const v=3*E[c],z=B[v],S=B[v+1],x=B[v+2];o.minimizeInPlaceFromFloats(z,S,x),q.maximizeInPlaceFromFloats(z,S,x)}}static extractMinAndMax(B,E,v,z,o,q){for(let c=E,S=E*z;c<E+v;c++,S+=z){const E=B[S],v=B[S+1],z=B[S+2];o.minimizeInPlaceFromFloats(E,v,z),q.maximizeInPlaceFromFloats(E,v,z)}}}function S(B,E,v,z){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=new o.GE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new o.GE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return c.extractMinAndMaxIndexed(B,E,v,z,S,x),q&&(S.x-=S.x*q.x+q.y,S.y-=S.y*q.x+q.y,S.z-=S.z*q.x+q.y,x.x+=x.x*q.x+q.y,x.y+=x.y*q.x+q.y,x.z+=x.z*q.x+q.y),{minimum:S,maximum:x}}function x(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4?arguments[4]:void 0;const S=new o.GE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new o.GE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return q||(q=3),c.extractMinAndMax(B,E,v,q,S,x),z&&(S.x-=S.x*z.x+z.y,S.y-=S.y*z.x+z.y,S.z-=S.z*z.x+z.y,x.x+=x.x*z.x+z.y,x.y+=x.y*z.x+z.y,x.z+=x.z*z.x+z.y),{minimum:S,maximum:x}}(0,z.c)([q.f.filter((function(){for(var B=arguments.length,E=new Array(B),v=0;v<B;v++)E[v]=arguments[v];let[z,o]=E;return!Array.isArray(z)&&!Array.isArray(o)}))],c,"extractMinAndMaxIndexed",null),(0,z.c)([q.f.filter((function(){for(var B=arguments.length,E=new Array(B),v=0;v<B;v++)E[v]=arguments[v];let[z]=E;return!Array.isArray(z)}))],c,"extractMinAndMax",null)},11714:(B,E,v)=>{v.d(E,{b:()=>x});var z=v(11442),o=v(11717),q=v(11722),c=v(11742),S=v(11480);class x{get materialDefines(){var B;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(B=this._getDrawWrapper())||void 0===B?void 0:B.defines}set materialDefines(B){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=B}_getDrawWrapper(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B=B??this._engine.currentRenderPassId;let v=this._drawWrappers[B];return!v&&E&&(this._drawWrappers[B]=v=new S.b(this._mesh.rB().getEngine())),v}_removeDrawWrapper(B){let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var v;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(v=this._drawWrappers[B])||void 0===v||v.dispose(E));this._drawWrappers[B]=void 0}get effect(){var B;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(B=this._getDrawWrapper())||void 0===B?void 0:B.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(B){this._mainDrawWrapperOverride=B}setEffect(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=this._drawWrapper;o.setEffect(B,E,z),void 0!==v&&(o.materialContext=v),B||(o.defines=null,o.materialContext=void 0)}resetDrawCache(B){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==B)return void this._removeDrawWrapper(B,!0,E);for(const B of this._drawWrappers)null===B||void 0===B||B.dispose(E)}this._drawWrappers=[]}static AddToMesh(B,E,v,z,o,q,c){return new x(B,E,v,z,o,q,c,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(B,E,v,z,o,q,c){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],x=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=B,this.verticesStart=E,this.verticesCount=v,this.indexStart=z,this.indexCount=o,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=q,this._renderingMesh=c||q,x&&q.qc.push(this),this._engine=this._mesh.rB().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=q.qc.length-1,S&&(this.refreshBoundingInfo(),q.yc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(B){return this._boundingInfo=B,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const B=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return B||this._renderingMesh}HB(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!E)return B&&this._mesh.rB()._hasDefaultMaterial?this._mesh.rB().defaultMaterial:null;if(this._isMultiMaterial(E)){const B=E.getSubMaterial(this.materialIndex);return this._currentMaterial!==B&&(this._currentMaterial=B,this.resetDrawCache()),B}return E}_isMultiMaterial(B){return void 0!==B.getSubMaterial}refreshBoundingInfo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Qc)return this;if(B||(B=this._renderingMesh.getVerticesData(z.e.PositionKind)),!B)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const E=this._renderingMesh.Pc();let v;if(0===this.indexStart&&this.indexCount===E.length){const B=this._renderingMesh.getBoundingInfo();v={minimum:B.minimum.clone(),maximum:B.maximum.clone()}}else v=(0,c.c)(B,E,this.indexStart,this.indexCount,this._renderingMesh.Qc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(v.minimum,v.maximum):this._boundingInfo=new q.c(v.minimum,v.maximum),this}_checkCollision(B){return this.getBoundingInfo()._checkCollision(B)}updateBoundingInfo(B){let E=this.getBoundingInfo();return E||(this.refreshBoundingInfo(),E=this.getBoundingInfo()),E&&E.update(B),this}isInFrustum(B){const E=this.getBoundingInfo();return!!E&&E.isInFrustum(B,this._mesh.zQ)}isCompletelyInFrustum(B){const E=this.getBoundingInfo();return!!E&&E.isCompletelyInFrustum(B)}render(B){return this._renderingMesh.render(this,B,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(B,E){if(!this._linesIndexBuffer){const v=6*Math.floor(this.indexCount/3),z=this.verticesStart+this.verticesCount>65535?new Uint32Array(v):new Uint16Array(v);let o=0;if(0===B.length)for(let B=this.indexStart;B<this.indexStart+this.indexCount;B+=3)z[o++]=B,z[o++]=B+1,z[o++]=B+1,z[o++]=B+2,z[o++]=B+2,z[o++]=B;else for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)z[o++]=B[E],z[o++]=B[E+1],z[o++]=B[E+1],z[o++]=B[E+2],z[o++]=B[E+2],z[o++]=B[E];this._linesIndexBuffer=E.createIndexBuffer(z),this._linesIndexCount=z.length}return this._linesIndexBuffer}canIntersects(B){const E=this.getBoundingInfo();return!!E&&B.intersectsBox(E.boundingBox)}intersects(B,E,v,z,o){const q=this.HB();if(!q)return null;let c=3,S=!1;switch(q.fillMode){case 3:case 5:case 6:case 8:return null;case 7:c=1,S=!0}return 4===q.fillMode?v.length?this._intersectLines(B,E,v,this._mesh.intersectionThreshold,z):this._intersectUnIndexedLines(B,E,v,this._mesh.intersectionThreshold,z):!v.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(B,E,v,z,o):this._intersectTriangles(B,E,v,c,S,z,o)}_intersectLines(B,E,v,z,q){let c=null;for(let S=this.indexStart;S<this.indexStart+this.indexCount;S+=2){const x=E[v[S]],D=E[v[S+1]],h=B.intersectionSegment(x,D,z);if(!(h<0)&&((q||!c||h<c.distance)&&(c=new o.b(null,null,h),c.faceId=S/2,q)))break}return c}_intersectUnIndexedLines(B,E,v,z,q){let c=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=2){const v=E[S],x=E[S+1],D=B.intersectionSegment(v,x,z);if(!(D<0)&&((q||!c||D<c.distance)&&(c=new o.b(null,null,D),c.faceId=S/2,q)))break}return c}_intersectTriangles(B,E,v,z,o,q,c){let S=null,x=-1;for(let D=this.indexStart;D<this.indexStart+this.indexCount-(3-z);D+=z){x++;const z=v[D],h=v[D+1],y=v[D+2];if(o&&4294967295===y){D+=2;continue}const Q=E[z],P=E[h],G=E[y];if(!Q||!P||!G)continue;if(c&&!c(Q,P,G,B,z,h,y))continue;const Y=B.intersectsTriangle(Q,P,G);if(Y){if(Y.distance<0)continue;if((q||!S||Y.distance<S.distance)&&(S=Y,S.faceId=x,q))break}}return S}_intersectUnIndexedTriangles(B,E,v,z,o){let q=null;for(let c=this.verticesStart;c<this.verticesStart+this.verticesCount;c+=3){const v=E[c],S=E[c+1],x=E[c+2];if(o&&!o(v,S,x,B,-1,-1,-1))continue;const D=B.intersectsTriangle(v,S,x);if(D){if(D.distance<0)continue;if((z||!q||D.distance<q.distance)&&(q=D,q.faceId=c/3,z))break}}return q}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(B,E){const v=new x(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,B,E,!1);if(!this.IsGlobal){const B=this.getBoundingInfo();if(!B)return v;v._boundingInfo=new q.c(B.minimum,B.maximum)}return v}dispose(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.rB().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const E=this._mesh.qc.indexOf(this);this._mesh.qc.splice(E,1),this.resetDrawCache(void 0,B)}getClassName(){return"SubMesh"}static CreateFromIndices(B,E,v,z,o){let q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=Number.MAX_VALUE,S=-Number.MAX_VALUE;const D=(o||z).Pc();for(let x=E;x<E+v;x++){const B=D[x];B<c&&(c=B),B>S&&(S=B)}return new x(B,c,S-c+1,E,v,z,o,q)}}}}]);