"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[24],{12789:(g,i,a)=>{a.d(i,{d:()=>n});class n{constructor(g,i,a){this.bu=g,this.bv=i,this.distance=a,this.faceId=0,this.subMeshId=0}}},12800:(g,i,a)=>{a.d(i,{b:()=>b});var n=a(12462),L=a(12452),d=a(12454);class b{constructor(g,i,a){this.vectors=(0,n.d)(8,L.Bi.Zero),this.center=L.Bi.Zero(),this.centerWorld=L.Bi.Zero(),this.extendSize=L.Bi.Zero(),this.extendSizeWorld=L.Bi.Zero(),this.directions=(0,n.d)(3,L.Bi.Zero),this.vectorsWorld=(0,n.d)(8,L.Bi.Zero),this.minimumWorld=L.Bi.Zero(),this.maximumWorld=L.Bi.Zero(),this.minimum=L.Bi.Zero(),this.maximum=L.Bi.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(g,i,a)}reConstruct(g,i,a){const n=g.x,d=g.y,b=g.z,k=i.x,e=i.y,N=i.z,F=this.vectors;this.minimum.sd(n,d,b),this.maximum.sd(k,e,N),F[0].sd(n,d,b),F[1].sd(k,e,N),F[2].sd(k,d,b),F[3].sd(n,e,b),F[4].sd(n,d,N),F[5].sd(k,e,b),F[6].sd(n,e,N),F[7].sd(k,d,N),i.addToRef(g,this.center).scaleInPlace(.5),i.subtractToRef(g,this.extendSize).scaleInPlace(.5),this._worldMatrix=a||L.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(g){const i=b._TmpVector3,a=this.maximum.subtractToRef(this.minimum,i[0]),n=a.length();a.normalizeFromLength(n);const L=n*g,d=a.scaleInPlace(.5*L),k=this.center.subtractToRef(d,i[1]),e=this.center.addToRef(d,i[2]);return this.reConstruct(k,e,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(g){const i=this.minimumWorld,a=this.maximumWorld,n=this.directions,d=this.vectorsWorld,b=this.vectors;if(g.isIdentity()){i.I(this.minimum),a.I(this.maximum);for(let g=0;g<8;++g)d[g].I(b[g]);this.extendSizeWorld.I(this.extendSize),this.centerWorld.I(this.center)}else{i.Qd(Number.MAX_VALUE),a.Qd(-Number.MAX_VALUE);for(let n=0;n<8;++n){const k=d[n];L.Bi.TransformCoordinatesToRef(b[n],g,k),i.minimizeInPlace(k),a.maximizeInPlace(k)}a.subtractToRef(i,this.extendSizeWorld).scaleInPlace(.5),a.addToRef(i,this.centerWorld).scaleInPlace(.5)}L.Bi.FromArrayToRef(g.m,0,n[0]),L.Bi.FromArrayToRef(g.m,4,n[1]),L.Bi.FromArrayToRef(g.m,8,n[2]),this._worldMatrix=g}isInFrustum(g){return b.IsInFrustum(this.vectorsWorld,g)}isCompletelyInFrustum(g){return b.IsCompletelyInFrustum(this.vectorsWorld,g)}intersectsPoint(g){const i=this.minimumWorld,a=this.maximumWorld,n=i.x,L=i.y,b=i.z,k=a.x,e=a.y,N=a.z,F=g.x,I=g.y,j=g.z,y=-d.b;return!(k-F<y||y>F-n)&&(!(e-I<y||y>I-L)&&!(N-j<y||y>j-b))}intersectsSphere(g){return b.IntersectsSphere(this.minimumWorld,this.maximumWorld,g.centerWorld,g.radiusWorld)}intersectsMinMax(g,i){const a=this.minimumWorld,n=this.maximumWorld,L=a.x,d=a.y,b=a.z,k=n.x,e=n.y,N=n.z,F=g.x,I=g.y,j=g.z,y=i.x,B=i.y,c=i.z;return!(k<F||L>y)&&(!(e<I||d>B)&&!(N<j||b>c))}dispose(){var g,i;null===(g=this._drawWrapperFront)||void 0===g||g.dispose(),null===(i=this._drawWrapperBack)||void 0===i||i.dispose()}static Intersects(g,i){return g.intersectsMinMax(i.minimumWorld,i.maximumWorld)}static IntersectsSphere(g,i,a,n){const d=b._TmpVector3[0];L.Bi.ClampToRef(a,g,i,d);return L.Bi.DistanceSquared(a,d)<=n*n}static IsCompletelyInFrustum(g,i){for(let a=0;a<6;++a){const n=i[a];for(let i=0;i<8;++i)if(n.dotCoordinate(g[i])<0)return!1}return!0}static IsInFrustum(g,i){for(let a=0;a<6;++a){let n=!0;const L=i[a];for(let i=0;i<8;++i)if(L.dotCoordinate(g[i])>=0){n=!1;break}if(n)return!1}return!0}}b._TmpVector3=(0,n.d)(3,L.Bi.Zero)},12791:(g,i,a)=>{a.d(i,{c:()=>I});var n=a(12462),L=a(12452),d=a(12800),b=a(12809);const k={min:0,max:0},e={min:0,max:0},N=(g,i,a)=>{const n=L.Bi.Dot(i.centerWorld,g),d=Math.abs(L.Bi.Dot(i.directions[0],g))*i.extendSize.x+Math.abs(L.Bi.Dot(i.directions[1],g))*i.extendSize.y+Math.abs(L.Bi.Dot(i.directions[2],g))*i.extendSize.z;a.min=n-d,a.max=n+d},F=(g,i,a)=>(N(g,i,k),N(g,a,e),!(k.min>e.max||e.min>k.max));class I{constructor(g,i,a){this._isLocked=!1,this.boundingBox=new d.b(g,i,a),this.boundingSphere=new b.b(g,i,a)}reConstruct(g,i,a){this.boundingBox.reConstruct(g,i,a),this.boundingSphere.reConstruct(g,i,a)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(g){this._isLocked=g}update(g){this._isLocked||(this.boundingBox._update(g),this.boundingSphere._update(g))}centerOn(g,i){const a=I._TmpVector3[0].I(g).ij(i),n=I._TmpVector3[1].I(g).addInPlace(i);return this.boundingBox.reConstruct(a,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(a,n,this.boundingBox.getWorldMatrix()),this}encapsulate(g){const i=L.Bi.Minimize(this.minimum,g),a=L.Bi.Maximize(this.maximum,g);return this.reConstruct(i,a,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(g){const i=L.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(i);const a=L.TmpVectors.Bi[0];return L.Bi.TransformCoordinatesToRef(g.boundingBox.minimumWorld,i,a),this.encapsulate(a),L.Bi.TransformCoordinatesToRef(g.boundingBox.maximumWorld,i,a),this.encapsulate(a),this}scale(g){return this.boundingBox.scale(g),this.boundingSphere.scale(g),this}isInFrustum(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===i||3===i)&&this.boundingSphere.isCenterInFrustum(g))return!0;if(!this.boundingSphere.isInFrustum(g))return!1;return!(1!==i&&3!==i)||this.boundingBox.isInFrustum(g)}get diagonalLength(){const g=this.boundingBox;return g.maximumWorld.subtractToRef(g.minimumWorld,I._TmpVector3[0]).length()}isCompletelyInFrustum(g){return this.boundingBox.isCompletelyInFrustum(g)}_checkCollision(g){return g._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(g){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(g)&&!!this.boundingBox.intersectsPoint(g))}intersects(g,i){if(!b.b.Intersects(this.boundingSphere,g.boundingSphere))return!1;if(!d.b.Intersects(this.boundingBox,g.boundingBox))return!1;if(!i)return!0;const a=this.boundingBox,n=g.boundingBox;return!!F(a.directions[0],a,n)&&(!!F(a.directions[1],a,n)&&(!!F(a.directions[2],a,n)&&(!!F(n.directions[0],a,n)&&(!!F(n.directions[1],a,n)&&(!!F(n.directions[2],a,n)&&(!!F(L.Bi.Cross(a.directions[0],n.directions[0]),a,n)&&(!!F(L.Bi.Cross(a.directions[0],n.directions[1]),a,n)&&(!!F(L.Bi.Cross(a.directions[0],n.directions[2]),a,n)&&(!!F(L.Bi.Cross(a.directions[1],n.directions[0]),a,n)&&(!!F(L.Bi.Cross(a.directions[1],n.directions[1]),a,n)&&(!!F(L.Bi.Cross(a.directions[1],n.directions[2]),a,n)&&(!!F(L.Bi.Cross(a.directions[2],n.directions[0]),a,n)&&(!!F(L.Bi.Cross(a.directions[2],n.directions[1]),a,n)&&!!F(L.Bi.Cross(a.directions[2],n.directions[2]),a,n))))))))))))))}}I._TmpVector3=(0,n.d)(2,L.Bi.Zero)},12809:(g,i,a)=>{a.d(i,{b:()=>d});var n=a(12462),L=a(12452);class d{constructor(g,i,a){this.center=L.Bi.Zero(),this.centerWorld=L.Bi.Zero(),this.minimum=L.Bi.Zero(),this.maximum=L.Bi.Zero(),this.reConstruct(g,i,a)}reConstruct(g,i,a){this.minimum.I(g),this.maximum.I(i);const n=L.Bi.Distance(g,i);i.addToRef(g,this.center).scaleInPlace(.5),this.radius=.5*n,this._update(a||L.Matrix.IdentityReadOnly)}scale(g){const i=this.radius*g,a=d._TmpVector3,n=a[0].Qd(i),L=this.center.subtractToRef(n,a[1]),b=this.center.addToRef(n,a[2]);return this.reConstruct(L,b,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(g){if(g.isIdentity())this.centerWorld.I(this.center),this.radiusWorld=this.radius;else{L.Bi.TransformCoordinatesToRef(this.center,g,this.centerWorld);const i=d._TmpVector3[0];L.Bi.TransformNormalFromFloatsToRef(1,1,1,g,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}}isInFrustum(g){const i=this.centerWorld,a=this.radiusWorld;for(let n=0;n<6;n++)if(g[n].dotCoordinate(i)<=-a)return!1;return!0}isCenterInFrustum(g){const i=this.centerWorld;for(let a=0;a<6;a++)if(g[a].dotCoordinate(i)<0)return!1;return!0}intersectsPoint(g){const i=L.Bi.DistanceSquared(this.centerWorld,g);return!(this.radiusWorld*this.radiusWorld<i)}static Intersects(g,i){const a=L.Bi.DistanceSquared(g.centerWorld,i.centerWorld),n=g.radiusWorld+i.radiusWorld;return!(n*n<a)}static CreateFromCenterAndRadius(g,i,a){this._TmpVector3[0].I(g),this._TmpVector3[1].sd(0,0,i),this._TmpVector3[2].I(g),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ij(this._TmpVector3[1]);const n=new d(this._TmpVector3[0],this._TmpVector3[2]);return n._worldMatrix=a||L.Matrix.Identity(),n}}d._TmpVector3=(0,n.d)(3,L.Bi.Zero)},12825:(g,i,a)=>{function n(g){-1===g.indexOf("vClipPlane")&&g.push("vClipPlane"),-1===g.indexOf("vClipPlane2")&&g.push("vClipPlane2"),-1===g.indexOf("vClipPlane3")&&g.push("vClipPlane3"),-1===g.indexOf("vClipPlane4")&&g.push("vClipPlane4"),-1===g.indexOf("vClipPlane5")&&g.push("vClipPlane5"),-1===g.indexOf("vClipPlane6")&&g.push("vClipPlane6")}function L(g,i,a){const n=!!(g.clipPlane??i.clipPlane),L=!!(g.clipPlane2??i.clipPlane2),d=!!(g.clipPlane3??i.clipPlane3),b=!!(g.clipPlane4??i.clipPlane4),k=!!(g.clipPlane5??i.clipPlane5),e=!!(g.clipPlane6??i.clipPlane6);n&&a.push("#define CLIPPLANE"),L&&a.push("#define CLIPPLANE2"),d&&a.push("#define CLIPPLANE3"),b&&a.push("#define CLIPPLANE4"),k&&a.push("#define CLIPPLANE5"),e&&a.push("#define CLIPPLANE6")}function d(g,i,a){let n=!1;const L=!!(g.clipPlane??i.clipPlane),d=!!(g.clipPlane2??i.clipPlane2),b=!!(g.clipPlane3??i.clipPlane3),k=!!(g.clipPlane4??i.clipPlane4),e=!!(g.clipPlane5??i.clipPlane5),N=!!(g.clipPlane6??i.clipPlane6);return a.CLIPPLANE!==L&&(a.CLIPPLANE=L,n=!0),a.CLIPPLANE2!==d&&(a.CLIPPLANE2=d,n=!0),a.CLIPPLANE3!==b&&(a.CLIPPLANE3=b,n=!0),a.CLIPPLANE4!==k&&(a.CLIPPLANE4=k,n=!0),a.CLIPPLANE5!==e&&(a.CLIPPLANE5=e,n=!0),a.CLIPPLANE6!==N&&(a.CLIPPLANE6=N,n=!0),n}function b(g,i,a){let n=i.clipPlane??a.clipPlane;k(g,"vClipPlane",n),n=i.clipPlane2??a.clipPlane2,k(g,"vClipPlane2",n),n=i.clipPlane3??a.clipPlane3,k(g,"vClipPlane3",n),n=i.clipPlane4??a.clipPlane4,k(g,"vClipPlane4",n),n=i.clipPlane5??a.clipPlane5,k(g,"vClipPlane5",n),n=i.clipPlane6??a.clipPlane6,k(g,"vClipPlane6",n)}function k(g,i,a){a&&g.setFloat4(i,a.normal.x,a.normal.y,a.normal.z,a.d)}a.d(i,{e:()=>n,i:()=>b,k:()=>d,n:()=>L})},12770:(g,i,a)=>{a.d(i,{b:()=>n});class n{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(g,i){this._defines[g]||(g<this._currentRank&&(this._currentRank=g),g>this._maxRank&&(this._maxRank=g),this._defines[g]=new Array),this._defines[g].push(i)}addCPUSkinningFallback(g,i){this._mesh=i,g<this._currentRank&&(this._currentRank=g),g>this._maxRank&&(this._maxRank=g)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(g,i){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,g=g.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),i._bonesComputationForcedToCPU=!0;const a=this._mesh.Pg();for(let g=0;g<a.meshes.length;g++){const n=a.meshes[g];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===i)n.computeBonesUsingShaders=!1;else if(n.Yd)for(const g of n.Yd){if(g.effect===i){n.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&n.computeBonesUsingShaders&&n.numBoneInfluencers>0&&(n.computeBonesUsingShaders=!1)}}else{const i=this._defines[this._currentRank];if(i)for(let a=0;a<i.length;a++)g=g.replace("#define "+i[a],"");this._currentRank++}return g}}},12778:(g,i,a)=>{a.d(i,{c:()=>D});var n=a(12441),L=a(12447),d=a(12277),b=a(12286),k=a(12316),e=a(12784),N=a(12724),F=a(12292),I=a(12498),j=a(12564),y=a(12484);class B{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(g){this._func=g}get funcRef(){return this._funcRef}set funcRef(g){this._funcRef=g}get funcMask(){return this._funcMask}set funcMask(g){this._funcMask=g}get opStencilFail(){return this._opStencilFail}set opStencilFail(g){this._opStencilFail=g}get opDepthFail(){return this._opDepthFail}set opDepthFail(g){this._opDepthFail=g}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(g){this._opStencilDepthPass=g}get mask(){return this._mask}set mask(g){this._mask=g}get enabled(){return this._enabled}set enabled(g){this._enabled=g}getClassName(){return"MaterialStencilState"}copyTo(g){y.c.Clone((()=>g),this)}serialize(){return y.c.Serialize(this)}parse(g,i,a){y.c.Parse((()=>this),g,i,a)}}(0,n.e)([(0,L.P)()],B.prototype,"func",null),(0,n.e)([(0,L.P)()],B.prototype,"funcRef",null),(0,n.e)([(0,L.P)()],B.prototype,"funcMask",null),(0,n.e)([(0,L.P)()],B.prototype,"opStencilFail",null),(0,n.e)([(0,L.P)()],B.prototype,"opDepthFail",null),(0,n.e)([(0,L.P)()],B.prototype,"opStencilDepthPass",null),(0,n.e)([(0,L.P)()],B.prototype,"mask",null),(0,n.e)([(0,L.P)()],B.prototype,"enabled",null);var c=a(12820);class D{get _supportGlowLayer(){return!1}set _glowModeEnabled(g){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(g){if(this._alpha===g)return;const i=this._alpha;this._alpha=g,1!==i&&1!==g||this.rF(D.MiscDirtyFlag+D.PrePassDirtyFlag)}get alpha(){return this._alpha}set zd(g){this._backFaceCulling!==g&&(this._backFaceCulling=g,this.rF(D.TextureDirtyFlag))}get zd(){return this._backFaceCulling}set cullBackFaces(g){this._cullBackFaces!==g&&(this._cullBackFaces=g,this.rF(D.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(g){this._blockDirtyMechanism!==g&&(this._blockDirtyMechanism=g,g||this.sj())}atomicMaterialsUpdate(g){this.blockDirtyMechanism=!0;try{g(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(g){this._onDisposeObserver&&this.dd.remove(this._onDisposeObserver),this._onDisposeObserver=this.dd.add(g)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new b.b),this._onBindObservable}set onBind(g){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(g)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new b.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new b.b),this._onEffectCreatedObservable}set alphaMode(g){this._alphaMode!==g&&(this._alphaMode=g,this.rF(D.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(g){this._needDepthPrePass!==g&&(this._needDepthPrePass=g,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(g){this._fogEnabled!==g&&(this._fogEnabled=g,this.rF(D.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case D.WireFrameFillMode:case D.LineListDrawMode:case D.LineLoopDrawMode:case D.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(g){this.fillMode=g?D.WireFrameFillMode:D.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case D.PointFillMode:case D.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(g){this.fillMode=g?D.PointFillMode:D.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(g){this._fillMode!==g&&(this._fillMode=g,this.rF(D.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(g){const i=this.Pg().getEngine().getCaps().fragmentDepthSupported;g&&!i&&F.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=g&&i,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(g){this._drawWrapper=g}constructor(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.dd=new b.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.bd=new B,this._useUBO=!1,this._fillMode=D.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=g;const L=i||k.c.LastCreatedScene;L&&(this._scene=L,this._dirtyCallbacks={},this._forceGLSL=n,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=g||d.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new j.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new N.e(this._scene.getEngine(),void 0,void 0,g),this._useUBO=this.Pg().getEngine().supportsUniformBuffers,this._createUniformBuffer(),a||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),D.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var g;const i=this.Pg().getEngine();null===(g=this._uniformBuffer)||void 0===g||g.dispose(),i.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new N.e(i,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new N.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(g){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.sj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.sj(),this.checkReadyOnlyOnce=!1}isReady(g,i){return!0}isReadyForSubMesh(g,i,a){const n=i.materialDefines;return!!n&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Pg(){return this._scene}_getEffectiveOrientation(g){return null!==this.sideOrientation?this.sideOrientation:g.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(g){this._transparencyMode!==g&&(this._transparencyMode=g,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===D.MATERIAL_ALPHABLEND||this._transparencyMode===D.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===D.MATERIAL_ALPHATEST||this._transparencyMode===D.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===D.MATERIAL_OPAQUE||this._transparencyMode===D.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(g){return this._hasTransparencyMode?this._transparencyModeIsBlend:g.visibility<1||!this._disableAlphaBlending&&(g.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(g){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(g)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}sj(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i=this.Pg().meshes;for(const a of i)if(a.Yd)for(const i of a.Yd)if(i.wg()===this)for(const a of i._drawWrappers)a&&this._materialContext===a.materialContext&&(a._wasPreviouslyReady=!1,a._wasPreviouslyUsingInstances=null,a._forceRebindOnNextCall=g);g&&this.rF(D.AllDirtyFlag)}_preBind(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=this._scene.getEngine(),n=(null==i?this.sideOrientation:i)===D.ClockWiseSideOrientation;return a.enableEffect(g||this._getDrawWrapper()),a.setState(this.zd,this.zOffset,!1,n,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.bd,this.zOffsetUnits),n}bind(g,i){}buildUniformLayout(){const g=this._uniformBuffer;this._eventInfo.ubo=g,this._callbackPluginEventGeneric(8,this._eventInfo),g.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(g,i,a){const n=a._drawWrapper;this._eventInfo.subMesh=a,this._callbackPluginEventBindForSubMesh(this._eventInfo),n._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(g){}bindView(g){this._useUBO?this._needToBindSceneUbo=!0:g.setMatrix("view",this.Pg().getViewMatrix())}bindViewProjection(g){this._useUBO?this._needToBindSceneUbo=!0:(g.setMatrix("viewProjection",this.Pg().getTransformMatrix()),g.setMatrix("projection",this.Pg().getProjectionMatrix()))}bindEyePosition(g,i){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(g,i)}_afterBind(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&i&&(this._needToBindSceneUbo=!1,(0,c.o)(i,this.Pg().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=g?g.visibility:1,this._onBindObservable&&g&&this._onBindObservable.notifyObservers(g),this.disableDepthWrite){const g=this._scene.getEngine();this._cachedDepthWriteState=g.getDepthWrite(),g.setDepthWrite(!1)}if(this.disableColorWrite){const g=this._scene.getEngine();this._cachedColorWriteState=g.getColorWrite(),g.setColorWrite(!1)}if(0!==this.depthFunction){const g=this._scene.getEngine();this._cachedDepthFunctionState=g.getDepthFunction()||0,g.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(g){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=g,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(g){return null}_clonePlugins(g,i){const a={};if(this._serializePlugins(a),D._ParsePlugins(a,g,this._scene,i),this.pluginManager)for(const n of this.pluginManager._plugins){const i=g.pluginManager.getPlugin(n.name);i&&n.copyTo(i)}}getBindedMeshes(){if(this.meshMap){const g=[];for(const i in this.meshMap){const a=this.meshMap[i];a&&g.push(a)}return g}return this._scene.meshes.filter((g=>g.material===this))}forceCompilation(g,i,a,n){const L={clipPlane:!1,useInstances:!1,...a},d=this.Pg(),b=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const k=()=>{if(!this._scene||!this._scene.getEngine())return;const a=d.clipPlane;if(L.clipPlane&&(d.clipPlane=new I.b(0,0,0,1)),this._storeEffectOnSubMeshes){let a=!0,d=null;if(g.Yd){const i=new e.d(0,0,0,0,0,g,void 0,!1,!1);i.materialDefines&&(i.materialDefines._renderId=-1),this.isReadyForSubMesh(g,i,L.useInstances)||(i.effect&&i.effect.getCompilationError()&&i.effect.allFallbacksProcessed()?d=i.effect.getCompilationError():(a=!1,setTimeout(k,16)))}a&&(this.allowShaderHotSwapping=b,d&&n&&n(d),i&&i(this))}else this.isReady()?(this.allowShaderHotSwapping=b,i&&i(this)):setTimeout(k,16);L.clipPlane&&(d.clipPlane=a)};k()}async forceCompilationAsync(g,i){return await new Promise(((a,n)=>{this.forceCompilation(g,(()=>{a()}),i,(g=>{n(g)}))}))}rF(g){this.Pg().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(D._DirtyCallbackArray.length=0,g&D.ImageProcessingDirtyFlag&&D._DirtyCallbackArray.push(D._ImageProcessingDirtyCallBack),g&D.TextureDirtyFlag&&D._DirtyCallbackArray.push(D._TextureDirtyCallBack),g&D.LightDirtyFlag&&D._DirtyCallbackArray.push(D._LightsDirtyCallBack),g&D.FresnelDirtyFlag&&D._DirtyCallbackArray.push(D._FresnelDirtyCallBack),g&D.AttributesDirtyFlag&&D._DirtyCallbackArray.push(D._AttributeDirtyCallBack),g&D.MiscDirtyFlag&&D._DirtyCallbackArray.push(D._MiscDirtyCallBack),g&D.PrePassDirtyFlag&&D._DirtyCallbackArray.push(D._PrePassDirtyCallBack),D._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(D._RunDirtyCallBacks),this.Pg().resetCachedMaterial())}resetDrawCache(){const g=this.Pg().meshes;for(const i of g)if(i.Yd)for(const g of i.Yd)g.wg()===this&&g.resetDrawCache()}_markAllSubMeshesAsDirty(g){const i=this.Pg();if(i.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const a=i.meshes;for(const n of a)if(n.Yd)for(const a of n.Yd){if((a.wg()||(i._hasDefaultMaterial?i.defaultMaterial:null))===this)for(const i of a._drawWrappers)i&&i.defines&&i.defines.markAllAsDirty&&this._materialContext===i.materialContext&&g(i.defines)}}_markScenePrePassDirty(){if(this.Pg().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const g=this.Pg().enablePrePassRenderer();g&&g.rF()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(D._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(D._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(D._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(D._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(D._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(D._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(D._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(D._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(D._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(D._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const g=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.dd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(g)}))}}setPrePassRenderer(g){return!1}dispose(g,i,a){const n=this.Pg();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),this._eventInfo.forceDisposeTextures=i,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const g=this._parentContainer.materials.indexOf(this);g>-1&&this._parentContainer.materials.splice(g,1),this._parentContainer=null}if(!0!==a)if(this.meshMap)for(const L in this.meshMap){const g=this.meshMap[L];this._disposeMeshResources(g)}else{const g=n.meshes;for(const i of g)this._disposeMeshResources(i)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.dd.notifyObservers(this),this.dd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(g){if(!g)return;const i=g.wd,a=g._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(g.Yd&&a)for(const L of g.Yd){const g=L._drawWrappers;for(let d=0;d<g.length;d++){var n;const b=null===(n=g[d])||void 0===n?void 0:n.effect;if(!b)continue;a[d]===this&&(null===i||void 0===i||i._releaseVertexArrayObject(b),L._removeDrawWrapper(d,!0,!0))}}}else null===i||void 0===i||i._releaseVertexArrayObject(this._drawWrapper.effect);g.material!==this||g.sourceMesh||(g.material=null)}serialize(){const g=y.c.Serialize(this);return g.bd=this.bd.serialize(),g.uniqueId=this.uniqueId,this._serializePlugins(g),g}_serializePlugins(g){if(g.plugins={},this.pluginManager)for(const i of this.pluginManager._plugins)i.doNotSerialize||(g.plugins[i.getClassName()]=i.serialize())}static Parse(g,i,a){if(g.customType){if("BABYLON.PBRMaterial"===g.customType&&g.overloadedAlbedo&&(g.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return F.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else g.customType="BABYLON.StandardMaterial";const n=d.Tools.Instantiate(g.customType).Parse(g,i,a);return n._loadedUniqueId=g.uniqueId,n}static _ParsePlugins(g,i,a,n){if(g.plugins)for(const k in g.plugins){var L,b;const e=g.plugins[k];let N=null===(L=i.pluginManager)||void 0===L?void 0:L.getPlugin(e.name);if(!N){const g=d.Tools.Instantiate("BABYLON."+k);g&&(N=new g(i))}null===(b=N)||void 0===b||b.parse(e,a,n)}}}D.TriangleFillMode=0,D.WireFrameFillMode=1,D.PointFillMode=2,D.PointListDrawMode=3,D.LineListDrawMode=4,D.LineLoopDrawMode=5,D.LineStripDrawMode=6,D.TriangleStripDrawMode=7,D.TriangleFanDrawMode=8,D.ClockWiseSideOrientation=0,D.CounterClockWiseSideOrientation=1,D.ImageProcessingDirtyFlag=64,D.TextureDirtyFlag=1,D.LightDirtyFlag=2,D.FresnelDirtyFlag=4,D.AttributesDirtyFlag=8,D.MiscDirtyFlag=16,D.PrePassDirtyFlag=32,D.AllDirtyFlag=127,D.MATERIAL_OPAQUE=0,D.MATERIAL_ALPHATEST=1,D.MATERIAL_ALPHABLEND=2,D.MATERIAL_ALPHATESTANDBLEND=3,D.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,D.MATERIAL_NORMALBLENDMETHOD_RNM=1,D.OnEventObservable=new b.b,D._AllDirtyCallBack=g=>g.markAllAsDirty(),D._ImageProcessingDirtyCallBack=g=>g.markAsImageProcessingDirty(),D._TextureDirtyCallBack=g=>g.markAsTexturesDirty(),D._FresnelDirtyCallBack=g=>g.markAsFresnelDirty(),D._MiscDirtyCallBack=g=>g.markAsMiscDirty(),D._PrePassDirtyCallBack=g=>g.markAsPrePassDirty(),D._LightsDirtyCallBack=g=>g.markAsLightDirty(),D._AttributeDirtyCallBack=g=>g.markAsAttributesDirty(),D._FresnelAndMiscDirtyCallBack=g=>{D._FresnelDirtyCallBack(g),D._MiscDirtyCallBack(g)},D._TextureAndMiscDirtyCallBack=g=>{D._TextureDirtyCallBack(g),D._MiscDirtyCallBack(g)},D._DirtyCallbackArray=[],D._RunDirtyCallBacks=g=>{for(const i of D._DirtyCallbackArray)i(g)},(0,n.e)([(0,L.P)()],D.prototype,"id",void 0),(0,n.e)([(0,L.P)()],D.prototype,"uniqueId",void 0),(0,n.e)([(0,L.P)()],D.prototype,"name",void 0),(0,n.e)([(0,L.P)()],D.prototype,"metadata",void 0),(0,n.e)([(0,L.P)()],D.prototype,"checkReadyOnEveryCall",void 0),(0,n.e)([(0,L.P)()],D.prototype,"checkReadyOnlyOnce",void 0),(0,n.e)([(0,L.P)()],D.prototype,"state",void 0),(0,n.e)([(0,L.P)("alpha")],D.prototype,"_alpha",void 0),(0,n.e)([(0,L.P)("zd")],D.prototype,"_backFaceCulling",void 0),(0,n.e)([(0,L.P)("cullBackFaces")],D.prototype,"_cullBackFaces",void 0),(0,n.e)([(0,L.P)()],D.prototype,"sideOrientation",void 0),(0,n.e)([(0,L.P)("alphaMode")],D.prototype,"_alphaMode",void 0),(0,n.e)([(0,L.P)()],D.prototype,"_needDepthPrePass",void 0),(0,n.e)([(0,L.P)()],D.prototype,"disableDepthWrite",void 0),(0,n.e)([(0,L.P)()],D.prototype,"disableColorWrite",void 0),(0,n.e)([(0,L.P)()],D.prototype,"forceDepthWrite",void 0),(0,n.e)([(0,L.P)()],D.prototype,"depthFunction",void 0),(0,n.e)([(0,L.P)()],D.prototype,"separateCullingPass",void 0),(0,n.e)([(0,L.P)("fogEnabled")],D.prototype,"_fogEnabled",void 0),(0,n.e)([(0,L.P)()],D.prototype,"pointSize",void 0),(0,n.e)([(0,L.P)()],D.prototype,"zOffset",void 0),(0,n.e)([(0,L.P)()],D.prototype,"zOffsetUnits",void 0),(0,n.e)([(0,L.P)()],D.prototype,"pointsCloud",null),(0,n.e)([(0,L.P)()],D.prototype,"fillMode",null),(0,n.e)([(0,L.P)()],D.prototype,"useLogarithmicDepth",null),(0,n.e)([(0,L.P)()],D.prototype,"transparencyMode",null)},12820:(g,i,a)=>{a.d(i,{$:()=>B,B:()=>Y,E:()=>y,F:()=>j,I:()=>K,K:()=>V,L:()=>U,N:()=>p,O:()=>C,S:()=>T,U:()=>l,Y:()=>Z,Z:()=>w,c:()=>E,d:()=>I,f:()=>v,j:()=>F,m:()=>c,o:()=>D,q:()=>R,r:()=>f,v:()=>x,x:()=>P});var n=a(12292),L=a(12496),d=a(12316),b=a(12763),k=a(12825);const e=L.Ri.Black(),N={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function F(g,i,a){if(!g||g.LOGARITHMICDEPTH||g.indexOf&&g.indexOf("LOGARITHMICDEPTH")>=0){const g=a.activeCamera;1===g.mode&&n.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),i.setFloat("logarithmicDepthConstant",2/(Math.log(g.maxZ+1)/Math.LN2))}}function I(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];a&&g.fogEnabled&&(!i||i.applyFog)&&0!==g.fogMode&&(a.setFloat4("vFogInfos",g.fogMode,g.fogStart,g.fogEnd,g.fogDensity),n?(g.fogColor.toLinearSpaceToRef(e,g.getEngine().useExactSrgbConversions),a.setColor3("vFogColor",e)):a.setColor3("vFogColor",g.fogColor))}function j(g,i,a,n,L,d,b,k,e,F){const I=g.numMaxInfluencers||g.numInfluencers;return I<=0?0:(i.push("#define MORPHTARGETS"),g.hasPositions&&i.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),g.hasNormals&&i.push("#define MORPHTARGETTEXTURE_HASNORMALS"),g.hasTangents&&i.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),g.hasUVs&&i.push("#define MORPHTARGETTEXTURE_HASUVS"),g.hasUV2s&&i.push("#define MORPHTARGETTEXTURE_HASUV2S"),g.hasColors&&i.push("#define MORPHTARGETTEXTURE_HASCOLORS"),g.supportsPositions&&L&&i.push("#define MORPHTARGETS_POSITION"),g.supportsNormals&&d&&i.push("#define MORPHTARGETS_NORMAL"),g.supportsTangents&&b&&i.push("#define MORPHTARGETS_TANGENT"),g.supportsUVs&&k&&i.push("#define MORPHTARGETS_UV"),g.supportsUV2s&&e&&i.push("#define MORPHTARGETS_UV2"),g.supportsColors&&F&&i.push("#define MORPHTARGETS_COLOR"),i.push("#define NUM_MORPH_INFLUENCERS "+I),g.isUsingTextureForTargets&&i.push("#define MORPHTARGETS_TEXTURE"),N.NUM_MORPH_INFLUENCERS=I,N.NORMAL=d,N.TANGENT=b,N.UV=k,N.UV2=e,N.COLOR=F,y(a,n,N,L),I)}function y(g,i,a){let L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=a.NUM_MORPH_INFLUENCERS;if(b>0&&d.c.LastCreatedEngine){const k=d.c.LastCreatedEngine.getCaps().maxVertexAttribs,e=i.morphTargetManager;if(null!==e&&void 0!==e&&e.isUsingTextureForTargets)return;const N=e&&e.supportsPositions&&L,F=e&&e.supportsNormals&&a.NORMAL,I=e&&e.supportsTangents&&a.TANGENT,j=e&&e.supportsUVs&&a.UV1,y=e&&e.supportsUV2s&&a.UV2,B=e&&e.supportsColors&&a.VERTEXCOLOR;for(let a=0;a<b;a++)N&&g.push("position"+a),F&&g.push("normal"+a),I&&g.push("tangent"+a),j&&g.push("uv_"+a),y&&g.push("uv2_"+a),B&&g.push("color"+a),g.length>k&&n.b.Error("Cannot add more vertex attributes for mesh "+i.name)}}function B(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g.push("world0"),g.push("world1"),g.push("world2"),g.push("world3"),i&&(g.push("previousWorld0"),g.push("previousWorld1"),g.push("previousWorld2"),g.push("previousWorld3"))}function c(g,i){const a=g.morphTargetManager;g&&a&&i.setFloatArray("morphTargetInfluences",a.influences)}function D(g,i){i.bindToEffect(g,"Scene")}function p(g,i,a){i._needUVs=!0,i[a]=!0,g.optimizeUVAllocation&&g.getTextureMatrix().isIdentityAs3x2()?(i[a+"DIRECTUV"]=g.coordinatesIndex+1,i["MAINUV"+(g.coordinatesIndex+1)]=!0):i[a+"DIRECTUV"]=0}function R(g,i,a){const n=g.getTextureMatrix();i.ld(a+"Matrix",n)}function x(g,i,a){a.BAKED_VERTEX_ANIMATION_TEXTURE&&a.INSTANCES&&g.push("bakedVertexAnimationSettingsInstanced")}function E(g,i,a){var n;if(i&&g&&(g.computeBonesUsingShaders&&i._bonesComputationForcedToCPU&&(g.computeBonesUsingShaders=!1),g.useBones&&g.computeBonesUsingShaders&&g.skeleton)){const L=g.skeleton;if(L.isUsingTextureForMatrices&&i.getUniformIndex("boneTextureWidth")>-1){const a=L.getTransformMatrixTexture(g);i.setTexture("boneSampler",a),i.setFloat("boneTextureWidth",4*(L.bones.length+1))}else{const d=L.getTransformMatrices(g);d&&(i.setMatrices("mBones",d),a&&g.Pg().prePassRenderer&&g.Pg().prePassRenderer.getIndex(2)&&(a.previousBones[g.uniqueId]||(a.previousBones[g.uniqueId]=d.slice()),i.setMatrices("mPreviousBones",a.previousBones[g.uniqueId]),n=d,a.previousBones[g.uniqueId].set(n)))}}}function X(g,i,a,n,L){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];g._bindLight(i,a,n,L,d)}function v(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const d=Math.min(i.lightSources.length,L);for(let b=0;b<d;b++){X(i.lightSources[b],b,g,a,"boolean"===typeof n?n:n.SPECULARTERM,i.receiveShadows)}}function P(g,i,a,n){a.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,i),g.push("matricesIndices"),g.push("matricesWeights"),a.NUM_BONE_INFLUENCERS>4&&(g.push("matricesIndicesExtra"),g.push("matricesWeightsExtra")))}function Y(g,i){(i.INSTANCES||i.THIN_INSTANCES)&&B(g,!!i.PREPASS_VELOCITY),i.INSTANCESCOLOR&&g.push("instanceColor")}function f(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=0;for(let d=0;d<a&&g["LIGHT"+d];d++)d>0&&(L=n+d,i.addFallback(L,"LIGHT"+d)),g.SHADOWS||(g["SHADOW"+d]&&i.addFallback(n,"SHADOW"+d),g["SHADOWPCF"+d]&&i.addFallback(n,"SHADOWPCF"+d),g["SHADOWPCSS"+d]&&i.addFallback(n,"SHADOWPCSS"+d),g["SHADOWPOISSON"+d]&&i.addFallback(n,"SHADOWPOISSON"+d),g["SHADOWESM"+d]&&i.addFallback(n,"SHADOWESM"+d),g["SHADOWCLOSEESM"+d]&&i.addFallback(n,"SHADOWCLOSEESM"+d));return L++}function C(g,i,a,n,L,d,b){let k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];b._areMiscDirty&&(b.LOGARITHMICDEPTH=a,b.POINTSIZE=n,b.FOG=L&&function(g,i){return i.fogEnabled&&g.applyFog&&0!==i.fogMode}(g,i),b.NONUNIFORMSCALING=g.nonUniformScaling,b.ALPHATEST=d,b.DECAL_AFTER_DETAIL=k)}function U(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!a._areLightsDirty)return a._needNormals;let b=0;const k={needNormals:a._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(g.lightsEnabled&&!d)for(const N of i.lightSources)if(S(g,i,N,b,a,n,k),b++,b===L)break;a.SPECULARTERM=k.specularEnabled,a.SHADOWS=k.shadowEnabled;for(let N=b;N<L;N++)void 0!==a["LIGHT"+N]&&(a["LIGHT"+N]=!1,a["HEMILIGHT"+N]=!1,a["POINTLIGHT"+N]=!1,a["DIRLIGHT"+N]=!1,a["SPOTLIGHT"+N]=!1,a["AREALIGHT"+N]=!1,a["SHADOW"+N]=!1,a["SHADOWCSM"+N]=!1,a["SHADOWCSMDEBUG"+N]=!1,a["SHADOWCSMNUM_CASCADES"+N]=!1,a["SHADOWCSMUSESHADOWMAXZ"+N]=!1,a["SHADOWCSMNOBLEND"+N]=!1,a["SHADOWCSM_RIGHTHANDED"+N]=!1,a["SHADOWPCF"+N]=!1,a["SHADOWPCSS"+N]=!1,a["SHADOWPOISSON"+N]=!1,a["SHADOWESM"+N]=!1,a["SHADOWCLOSEESM"+N]=!1,a["SHADOWCUBE"+N]=!1,a["SHADOWLOWQUALITY"+N]=!1,a["SHADOWMEDIUMQUALITY"+N]=!1);const e=g.getEngine().getCaps();return void 0===a.SHADOWFLOAT&&(k.needRebuild=!0),a.SHADOWFLOAT=k.shadowEnabled&&(e.textureFloatRender&&e.textureFloatLinearFiltering||e.textureHalfFloatRender&&e.textureHalfFloatLinearFiltering),a.LIGHTMAPEXCLUDED=k.lightmapMode,k.needRebuild&&a.rebuild(),k.needNormals}function S(g,i,a,n,L,d,k){switch(k.needNormals=!0,void 0===L["LIGHT"+n]&&(k.needRebuild=!0),L["LIGHT"+n]=!0,L["SPOTLIGHT"+n]=!1,L["HEMILIGHT"+n]=!1,L["POINTLIGHT"+n]=!1,L["DIRLIGHT"+n]=!1,L["AREALIGHT"+n]=!1,a.prepareLightSpecificDefines(L,n),L["LIGHT_FALLOFF_PHYSICAL"+n]=!1,L["LIGHT_FALLOFF_GLTF"+n]=!1,L["LIGHT_FALLOFF_STANDARD"+n]=!1,a.falloffType){case b.c.FALLOFF_GLTF:L["LIGHT_FALLOFF_GLTF"+n]=!0;break;case b.c.FALLOFF_PHYSICAL:L["LIGHT_FALLOFF_PHYSICAL"+n]=!0;break;case b.c.FALLOFF_STANDARD:L["LIGHT_FALLOFF_STANDARD"+n]=!0}if(d&&!a.jI.equalsFloats(0,0,0)&&(k.specularEnabled=!0),L["SHADOW"+n]=!1,L["SHADOWCSM"+n]=!1,L["SHADOWCSMDEBUG"+n]=!1,L["SHADOWCSMNUM_CASCADES"+n]=!1,L["SHADOWCSMUSESHADOWMAXZ"+n]=!1,L["SHADOWCSMNOBLEND"+n]=!1,L["SHADOWCSM_RIGHTHANDED"+n]=!1,L["SHADOWPCF"+n]=!1,L["SHADOWPCSS"+n]=!1,L["SHADOWPOISSON"+n]=!1,L["SHADOWESM"+n]=!1,L["SHADOWCLOSEESM"+n]=!1,L["SHADOWCUBE"+n]=!1,L["SHADOWLOWQUALITY"+n]=!1,L["SHADOWMEDIUMQUALITY"+n]=!1,i&&i.receiveShadows&&g.shadowsEnabled&&a.shadowEnabled){const i=a.getShadowGenerator(g.activeCamera)??a.getShadowGenerator();if(i){const g=i.getShadowMap();g&&g.renderList&&g.renderList.length>0&&(k.shadowEnabled=!0,i.prepareDefines(L,n))}}a.lightmapMode!=b.c.LIGHTMAP_DEFAULT?(k.lightmapMode=!0,L["LIGHTMAPEXCLUDED"+n]=!0,L["LIGHTMAPNOSPECULAR"+n]=a.lightmapMode==b.c.LIGHTMAP_SHADOWSONLY):(L["LIGHTMAPEXCLUDED"+n]=!1,L["LIGHTMAPNOSPECULAR"+n]=!1)}function V(g,i,a,n,L){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=function(g,i){let a=!1;if(g.activeCamera){const n=i.CAMERA_ORTHOGRAPHIC?1:0,L=i.CAMERA_PERSPECTIVE?1:0,d=1===g.activeCamera.mode?1:0,b=0===g.activeCamera.mode?1:0;(n^d||L^b)&&(i.CAMERA_ORTHOGRAPHIC=1===d,i.CAMERA_PERSPECTIVE=1===b,a=!0)}return a}(g,n);!1!==d&&(e=(0,k.k)(a,g,n)),n.DEPTHPREPASS!==!i.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,e=!0),n.INSTANCES!==L&&(n.INSTANCES=L,e=!0),n.THIN_INSTANCES!==b&&(n.THIN_INSTANCES=b,e=!0),e&&n.markAsUnprocessed()}function K(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!i._areAttributesDirty&&i._needNormals===i._normals&&i._needUVs===i._uvs)return!1;i._normals=i._needNormals,i._uvs=i._needUVs,i.NORMAL=i._needNormals&&g.isVerticesDataPresent("normal"),i._needNormals&&g.isVerticesDataPresent("tangent")&&(i.TANGENT=!0);for(let k=1;k<=6;++k)i["UV"+k]=!!i._needUVs&&g.isVerticesDataPresent(`uv${1===k?"":k}`);if(a){const a=g.useVertexColors&&g.isVerticesDataPresent("color");i.VERTEXCOLOR=a,i.VERTEXALPHA=g.hasVertexAlpha&&a&&d}return g.isVerticesDataPresent("instanceColor")&&(g.hasInstances||g.hasThinInstances)&&(i.INSTANCESCOLOR=!0),n&&function(g,i){if(g.useBones&&g.computeBonesUsingShaders&&g.skeleton){i.NUM_BONE_INFLUENCERS=g.numBoneInfluencers;const a=void 0!==i.BONETEXTURE;if(g.skeleton.isUsingTextureForMatrices&&a)i.BONETEXTURE=!0;else{i.BonesPerMesh=g.skeleton.bones.length+1,i.BONETEXTURE=!a&&void 0;const n=g.Pg().prePassRenderer;if(n&&n.enabled){const a=-1===n.excludedSkinnedMesh.indexOf(g);i.BONES_VELOCITY_ENABLED=a}}}else i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0,void 0!==i.BONETEXTURE&&(i.BONETEXTURE=!1)}(g,i),L&&function(g,i){const a=g.morphTargetManager;a?(i.MORPHTARGETS_UV=a.supportsUVs&&i.UV1,i.MORPHTARGETS_UV2=a.supportsUV2s&&i.UV2,i.MORPHTARGETS_TANGENT=a.supportsTangents&&i.TANGENT,i.MORPHTARGETS_NORMAL=a.supportsNormals&&i.NORMAL,i.MORPHTARGETS_POSITION=a.supportsPositions,i.MORPHTARGETS_COLOR=a.supportsColors,i.MORPHTARGETTEXTURE_HASUVS=a.hasUVs,i.MORPHTARGETTEXTURE_HASUV2S=a.hasUV2s,i.MORPHTARGETTEXTURE_HASTANGENTS=a.hasTangents,i.MORPHTARGETTEXTURE_HASNORMALS=a.hasNormals,i.MORPHTARGETTEXTURE_HASPOSITIONS=a.hasPositions,i.MORPHTARGETTEXTURE_HASCOLORS=a.hasColors,i.NUM_MORPH_INFLUENCERS=a.numMaxInfluencers||a.numInfluencers,i.MORPHTARGETS=i.NUM_MORPH_INFLUENCERS>0,i.MORPHTARGETS_TEXTURE=a.isUsingTextureForTargets):(i.MORPHTARGETS_UV=!1,i.MORPHTARGETS_UV2=!1,i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS_POSITION=!1,i.MORPHTARGETS_COLOR=!1,i.MORPHTARGETTEXTURE_HASUVS=!1,i.MORPHTARGETTEXTURE_HASUV2S=!1,i.MORPHTARGETTEXTURE_HASTANGENTS=!1,i.MORPHTARGETTEXTURE_HASNORMALS=!1,i.MORPHTARGETTEXTURE_HASPOSITIONS=!1,i.MORPHTARGETTEXTURE_HAS_COLORS=!1,i.MORPHTARGETS=!1,i.NUM_MORPH_INFLUENCERS=0)}(g,i),b&&function(g,i){const a=g.bakedVertexAnimationManager;i.BAKED_VERTEX_ANIMATION_TEXTURE=!(!a||!a.isEnabled)}(g,i),!0}function T(g,i){if(g.activeCamera){const a=i.MULTIVIEW;i.MULTIVIEW=null!==g.activeCamera.outputRenderTarget&&g.activeCamera.outputRenderTarget.getViewCount()>1,i.MULTIVIEW!=a&&i.markAsUnprocessed()}}function l(g,i,a){const n=i.ORDER_INDEPENDENT_TRANSPARENCY,L=i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;i.ORDER_INDEPENDENT_TRANSPARENCY=g.useOrderIndependentTransparency&&a,i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!g.getEngine().getCaps().textureFloatLinearFiltering,n===i.ORDER_INDEPENDENT_TRANSPARENCY&&L===i.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||i.markAsUnprocessed()}function Z(g,i,a){const n=i.PREPASS;if(!i._arePrePassDirty)return;const L=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(g.prePassRenderer&&g.prePassRenderer.enabled&&a){i.PREPASS=!0,i.SCENE_MRT_COUNT=g.prePassRenderer.mrtCount,i.PREPASS_NORMAL_WORLDSPACE=g.prePassRenderer.generateNormalsInWorldSpace,i.PREPASS_COLOR=!0,i.PREPASS_COLOR_INDEX=0;for(let a=0;a<L.length;a++){const n=g.prePassRenderer.getIndex(L[a].type);-1!==n?(i[L[a].define]=!0,i[L[a].index]=n):i[L[a].define]=!1}}else{i.PREPASS=!1;for(let g=0;g<L.length;g++)i[L[g].define]=!1}i.PREPASS!=n&&(i.markAsUnprocessed(),i.markAsImageProcessingDirty())}function h(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];L&&L.push("Light"+g),d||(i.push("vLightData"+g,"vLightDiffuse"+g,"vLightSpecular"+g,"vLightDirection"+g,"vLightWidth"+g,"vLightHeight"+g,"vLightFalloff"+g,"vLightGround"+g,"lightMatrix"+g,"shadowsInfo"+g,"depthValues"+g),a.push("shadowTexture"+g),a.push("depthTexture"+g),i.push("viewFrustumZ"+g,"cascadeBlendFactor"+g,"lightSizeUVCorrection"+g,"depthCorrection"+g,"penumbraDarkness"+g,"frustumLengths"+g),n&&(a.push("projectionLightTexture"+g),i.push("textureProjectionMatrix"+g)),b&&a.push("iesLightTexture"+g))}function w(g,i,a){let n,L,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(g.uniformsNames){const b=g;n=b.uniformsNames,L=b.uniformBuffersNames,i=b.samplers,a=b.defines,d=b.maxSimultaneousLights||0}else n=g,i||(i=[]);for(let b=0;b<d&&a["LIGHT"+b];b++)h(b,n,i,a["PROJECTEDLIGHTTEXTURE"+b],L,!1,a["IESLIGHTTEXTURE"+b]);a.NUM_MORPH_INFLUENCERS&&(n.push("morphTargetInfluences"),n.push("morphTargetCount")),a.BAKED_VERTEX_ANIMATION_TEXTURE&&(n.push("bakedVertexAnimationSettings"),n.push("bakedVertexAnimationTextureSizeInverted"),n.push("bakedVertexAnimationTime"),i.push("bakedVertexAnimationTexture"))}},12773:(g,i,a)=>{a.d(i,{b:()=>d});var n=a(12452),L=a(12778);class d extends L.c{constructor(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(g,i,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new n.Matrix,this._storeEffectOnSubMeshes=a}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(g,i){return!!g&&(!this._storeEffectOnSubMeshes||(!g.Yd||0===g.Yd.length||this.isReadyForSubMesh(g,g.Yd[0],i)))}_isReadyForSubMesh(g){const i=g.materialDefines;return!(this.checkReadyOnEveryCall||!g.effect||!i||i._renderId!==this.Pg().getRenderId())}bindOnlyWorldMatrix(g){this._activeEffect.setMatrix("world",g)}bindOnlyNormalMatrix(g){this._activeEffect.setMatrix("normalMatrix",g)}bind(g,i){i&&this.bindForSubMesh(g,i,i.Yd[0])}_afterBind(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;super._afterBind(g,i,a),this.Pg()._cachedEffect=i,a?a._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return a._drawWrapper._forceRebindOnNextCall||g.isCachedMaterialInvalid(this,i,n)}dispose(g,i,a){this._activeEffect=void 0,super.dispose(g,i,a)}}},12814:(g,i,a)=>{a.d(i,{e:()=>k,h:()=>e});var n=a(12441),L=a(12452),d=a(12447);class b{static extractMinAndMaxIndexed(g,i,a,n,L,d){for(let b=a;b<a+n;b++){const a=3*i[b],n=g[a],k=g[a+1],e=g[a+2];L.minimizeInPlaceFromFloats(n,k,e),d.maximizeInPlaceFromFloats(n,k,e)}}static extractMinAndMax(g,i,a,n,L,d){for(let b=i,k=i*n;b<i+a;b++,k+=n){const i=g[k],a=g[k+1],n=g[k+2];L.minimizeInPlaceFromFloats(i,a,n),d.maximizeInPlaceFromFloats(i,a,n)}}}function k(g,i,a,n){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const k=new L.Bi(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new L.Bi(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return b.extractMinAndMaxIndexed(g,i,a,n,k,e),d&&(k.x-=k.x*d.x+d.y,k.y-=k.y*d.x+d.y,k.z-=k.z*d.x+d.y,e.x+=e.x*d.x+d.y,e.y+=e.y*d.x+d.y,e.z+=e.z*d.x+d.y),{minimum:k,maximum:e}}function e(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4?arguments[4]:void 0;const k=new L.Bi(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new L.Bi(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return d||(d=3),b.extractMinAndMax(g,i,a,d,k,e),n&&(k.x-=k.x*n.x+n.y,k.y-=k.y*n.x+n.y,k.z-=k.z*n.x+n.y,e.x+=e.x*n.x+n.y,e.y+=e.y*n.x+n.y,e.z+=e.z*n.x+n.y),{minimum:k,maximum:e}}(0,n.e)([d.i.filter((function(){for(var g=arguments.length,i=new Array(g),a=0;a<g;a++)i[a]=arguments[a];let[n,L]=i;return!Array.isArray(n)&&!Array.isArray(L)}))],b,"extractMinAndMaxIndexed",null),(0,n.e)([d.i.filter((function(){for(var g=arguments.length,i=new Array(g),a=0;a<g;a++)i[a]=arguments[a];let[n]=i;return!Array.isArray(n)}))],b,"extractMinAndMax",null)},12784:(g,i,a)=>{a.d(i,{d:()=>e});var n=a(12526),L=a(12789),d=a(12791),b=a(12814),k=a(12564);class e{get materialDefines(){var g;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(g=this._getDrawWrapper())||void 0===g?void 0:g.defines}set materialDefines(g){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=g}_getDrawWrapper(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g=g??this._engine.currentRenderPassId;let a=this._drawWrappers[g];return!a&&i&&(this._drawWrappers[g]=a=new k.c(this._mesh.Pg().getEngine())),a}_removeDrawWrapper(g){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(a=this._drawWrappers[g])||void 0===a||a.dispose(i));this._drawWrappers[g]=void 0}get effect(){var g;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(g=this._getDrawWrapper())||void 0===g?void 0:g.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(g){this._mainDrawWrapperOverride=g}setEffect(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this._drawWrapper;L.setEffect(g,i,n),void 0!==a&&(L.materialContext=a),g||(L.defines=null,L.materialContext=void 0)}resetDrawCache(g){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==g)return void this._removeDrawWrapper(g,!0,i);for(const g of this._drawWrappers)null===g||void 0===g||g.dispose(i)}this._drawWrappers=[]}static AddToMesh(g,i,a,n,L,d,b){return new e(g,i,a,n,L,d,b,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(g,i,a,n,L,d,b){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],e=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=g,this.verticesStart=i,this.verticesCount=a,this.indexStart=n,this.indexCount=L,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=d,this._renderingMesh=b||d,e&&d.Yd.push(this),this._engine=this._mesh.Pg().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=d.Yd.length-1,k&&(this.refreshBoundingInfo(),d.Zd(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(g){return this._boundingInfo=g,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const g=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return g||this._renderingMesh}wg(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!i)return g&&this._mesh.Pg()._hasDefaultMaterial?this._mesh.Pg().defaultMaterial:null;if(this._isMultiMaterial(i)){const g=i.getSubMaterial(this.materialIndex);return this._currentMaterial!==g&&(this._currentMaterial=g,this.resetDrawCache()),g}return i}_isMultiMaterial(g){return void 0!==g.getSubMaterial}refreshBoundingInfo(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wd)return this;if(g||(g=this._renderingMesh.getVerticesData(n.g.PositionKind)),!g)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const i=this._renderingMesh.Ad();let a;if(0===this.indexStart&&this.indexCount===i.length){const g=this._renderingMesh.getBoundingInfo();a={minimum:g.minimum.clone(),maximum:g.maximum.clone()}}else a=(0,b.e)(g,i,this.indexStart,this.indexCount,this._renderingMesh.wd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(a.minimum,a.maximum):this._boundingInfo=new d.c(a.minimum,a.maximum),this}_checkCollision(g){return this.getBoundingInfo()._checkCollision(g)}updateBoundingInfo(g){let i=this.getBoundingInfo();return i||(this.refreshBoundingInfo(),i=this.getBoundingInfo()),i&&i.update(g),this}isInFrustum(g){const i=this.getBoundingInfo();return!!i&&i.isInFrustum(g,this._mesh.Bj)}isCompletelyInFrustum(g){const i=this.getBoundingInfo();return!!i&&i.isCompletelyInFrustum(g)}render(g){return this._renderingMesh.render(this,g,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(g,i){if(!this._linesIndexBuffer){const a=6*Math.floor(this.indexCount/3),n=this.verticesStart+this.verticesCount>65535?new Uint32Array(a):new Uint16Array(a);let L=0;if(0===g.length)for(let g=this.indexStart;g<this.indexStart+this.indexCount;g+=3)n[L++]=g,n[L++]=g+1,n[L++]=g+1,n[L++]=g+2,n[L++]=g+2,n[L++]=g;else for(let i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n[L++]=g[i],n[L++]=g[i+1],n[L++]=g[i+1],n[L++]=g[i+2],n[L++]=g[i+2],n[L++]=g[i];this._linesIndexBuffer=i.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer}canIntersects(g){const i=this.getBoundingInfo();return!!i&&g.intersectsBox(i.boundingBox)}intersects(g,i,a,n,L){const d=this.wg();if(!d)return null;let b=3,k=!1;switch(d.fillMode){case 3:case 5:case 6:case 8:return null;case 7:b=1,k=!0}return 4===d.fillMode?a.length?this._intersectLines(g,i,a,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(g,i,a,this._mesh.intersectionThreshold,n):!a.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(g,i,a,n,L):this._intersectTriangles(g,i,a,b,k,n,L)}_intersectLines(g,i,a,n,d){let b=null;for(let k=this.indexStart;k<this.indexStart+this.indexCount;k+=2){const e=i[a[k]],N=i[a[k+1]],F=g.intersectionSegment(e,N,n);if(!(F<0)&&((d||!b||F<b.distance)&&(b=new L.d(null,null,F),b.faceId=k/2,d)))break}return b}_intersectUnIndexedLines(g,i,a,n,d){let b=null;for(let k=this.verticesStart;k<this.verticesStart+this.verticesCount;k+=2){const a=i[k],e=i[k+1],N=g.intersectionSegment(a,e,n);if(!(N<0)&&((d||!b||N<b.distance)&&(b=new L.d(null,null,N),b.faceId=k/2,d)))break}return b}_intersectTriangles(g,i,a,n,L,d,b){let k=null,e=-1;for(let N=this.indexStart;N<this.indexStart+this.indexCount-(3-n);N+=n){e++;const n=a[N],F=a[N+1],I=a[N+2];if(L&&4294967295===I){N+=2;continue}const j=i[n],y=i[F],B=i[I];if(!j||!y||!B)continue;if(b&&!b(j,y,B,g,n,F,I))continue;const c=g.intersectsTriangle(j,y,B);if(c){if(c.distance<0)continue;if((d||!k||c.distance<k.distance)&&(k=c,k.faceId=e,d))break}}return k}_intersectUnIndexedTriangles(g,i,a,n,L){let d=null;for(let b=this.verticesStart;b<this.verticesStart+this.verticesCount;b+=3){const a=i[b],k=i[b+1],e=i[b+2];if(L&&!L(a,k,e,g,-1,-1,-1))continue;const N=g.intersectsTriangle(a,k,e);if(N){if(N.distance<0)continue;if((n||!d||N.distance<d.distance)&&(d=N,d.faceId=b/3,n))break}}return d}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(g,i){const a=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,g,i,!1);if(!this.IsGlobal){const g=this.getBoundingInfo();if(!g)return a;a._boundingInfo=new d.c(g.minimum,g.maximum)}return a}dispose(){let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Pg().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const i=this._mesh.Yd.indexOf(this);this._mesh.Yd.splice(i,1),this.resetDrawCache(void 0,g)}getClassName(){return"SubMesh"}static CreateFromIndices(g,i,a,n,L){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=Number.MAX_VALUE,k=-Number.MAX_VALUE;const N=(L||n).Ad();for(let e=i;e<i+a;e++){const g=N[e];g<b&&(b=g),g>k&&(k=g)}return new e(g,b,k-b+1,i,a,n,L,d)}}}}]);