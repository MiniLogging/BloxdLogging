"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[24],{12743:(a,O,i)=>{i.d(O,{b:()=>H});class H{constructor(a,O,i){this.bu=a,this.bv=O,this.distance=i,this.faceId=0,this.subMeshId=0}}},12753:(a,O,i)=>{i.d(O,{b:()=>q});var H=i(12403),b=i(12395),G=i(12397);class q{constructor(a,O,i){this.vectors=(0,H.e)(8,b.ZO.Zero),this.center=b.ZO.Zero(),this.centerWorld=b.ZO.Zero(),this.extendSize=b.ZO.Zero(),this.extendSizeWorld=b.ZO.Zero(),this.directions=(0,H.e)(3,b.ZO.Zero),this.vectorsWorld=(0,H.e)(8,b.ZO.Zero),this.minimumWorld=b.ZO.Zero(),this.maximumWorld=b.ZO.Zero(),this.minimum=b.ZO.Zero(),this.maximum=b.ZO.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(a,O,i)}reConstruct(a,O,i){const H=a.x,G=a.y,q=a.z,Q=O.x,k=O.y,I=O.z,P=this.vectors;this.minimum.fb(H,G,q),this.maximum.fb(Q,k,I),P[0].fb(H,G,q),P[1].fb(Q,k,I),P[2].fb(Q,G,q),P[3].fb(H,k,q),P[4].fb(H,G,I),P[5].fb(Q,k,q),P[6].fb(H,k,I),P[7].fb(Q,G,I),O.addToRef(a,this.center).scaleInPlace(.5),O.subtractToRef(a,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||b.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(a){const O=q._TmpVector3,i=this.maximum.subtractToRef(this.minimum,O[0]),H=i.length();i.normalizeFromLength(H);const b=H*a,G=i.scaleInPlace(.5*b),Q=this.center.subtractToRef(G,O[1]),k=this.center.addToRef(G,O[2]);return this.reConstruct(Q,k,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){const O=this.minimumWorld,i=this.maximumWorld,H=this.directions,G=this.vectorsWorld,q=this.vectors;if(a.isIdentity()){O.q(this.minimum),i.q(this.maximum);for(let a=0;a<8;++a)G[a].q(q[a]);this.extendSizeWorld.q(this.extendSize),this.centerWorld.q(this.center)}else{O.Tb(Number.MAX_VALUE),i.Tb(-Number.MAX_VALUE);for(let H=0;H<8;++H){const Q=G[H];b.ZO.TransformCoordinatesToRef(q[H],a,Q),O.minimizeInPlace(Q),i.maximizeInPlace(Q)}i.subtractToRef(O,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(O,this.centerWorld).scaleInPlace(.5)}b.ZO.FromArrayToRef(a.m,0,H[0]),b.ZO.FromArrayToRef(a.m,4,H[1]),b.ZO.FromArrayToRef(a.m,8,H[2]),this._worldMatrix=a}isInFrustum(a){return q.IsInFrustum(this.vectorsWorld,a)}isCompletelyInFrustum(a){return q.IsCompletelyInFrustum(this.vectorsWorld,a)}intersectsPoint(a){const O=this.minimumWorld,i=this.maximumWorld,H=O.x,b=O.y,q=O.z,Q=i.x,k=i.y,I=i.z,P=a.x,e=a.y,h=a.z,j=-G.e;return!(Q-P<j||j>P-H)&&(!(k-e<j||j>e-b)&&!(I-h<j||j>h-q))}intersectsSphere(a){return q.IntersectsSphere(this.minimumWorld,this.maximumWorld,a.centerWorld,a.radiusWorld)}intersectsMinMax(a,O){const i=this.minimumWorld,H=this.maximumWorld,b=i.x,G=i.y,q=i.z,Q=H.x,k=H.y,I=H.z,P=a.x,e=a.y,h=a.z,j=O.x,Z=O.y,F=O.z;return!(Q<P||b>j)&&(!(k<e||G>Z)&&!(I<h||q>F))}dispose(){var a,O;null===(a=this._drawWrapperFront)||void 0===a||a.dispose(),null===(O=this._drawWrapperBack)||void 0===O||O.dispose()}static Intersects(a,O){return a.intersectsMinMax(O.minimumWorld,O.maximumWorld)}static IntersectsSphere(a,O,i,H){const G=q._TmpVector3[0];b.ZO.ClampToRef(i,a,O,G);return b.ZO.DistanceSquared(i,G)<=H*H}static IsCompletelyInFrustum(a,O){for(let i=0;i<6;++i){const H=O[i];for(let O=0;O<8;++O)if(H.dotCoordinate(a[O])<0)return!1}return!0}static IsInFrustum(a,O){for(let i=0;i<6;++i){let H=!0;const b=O[i];for(let O=0;O<8;++O)if(b.dotCoordinate(a[O])>=0){H=!1;break}if(H)return!1}return!0}}q._TmpVector3=(0,H.e)(3,b.ZO.Zero)},12748:(a,O,i)=>{i.d(O,{e:()=>e});var H=i(12403),b=i(12395),G=i(12753),q=i(12760);const Q={min:0,max:0},k={min:0,max:0},I=(a,O,i)=>{const H=b.ZO.Dot(O.centerWorld,a),G=Math.abs(b.ZO.Dot(O.directions[0],a))*O.extendSize.x+Math.abs(b.ZO.Dot(O.directions[1],a))*O.extendSize.y+Math.abs(b.ZO.Dot(O.directions[2],a))*O.extendSize.z;i.min=H-G,i.max=H+G},P=(a,O,i)=>(I(a,O,Q),I(a,i,k),!(Q.min>k.max||k.min>Q.max));class e{constructor(a,O,i){this._isLocked=!1,this.boundingBox=new G.b(a,O,i),this.boundingSphere=new q.c(a,O,i)}reConstruct(a,O,i){this.boundingBox.reConstruct(a,O,i),this.boundingSphere.reConstruct(a,O,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(a){this._isLocked=a}update(a){this._isLocked||(this.boundingBox._update(a),this.boundingSphere._update(a))}centerOn(a,O){const i=e._TmpVector3[0].q(a).ne(O),H=e._TmpVector3[1].q(a).addInPlace(O);return this.boundingBox.reConstruct(i,H,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,H,this.boundingBox.getWorldMatrix()),this}encapsulate(a){const O=b.ZO.Minimize(this.minimum,a),i=b.ZO.Maximize(this.maximum,a);return this.reConstruct(O,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(a){const O=b.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(O);const i=b.TmpVectors.ZO[0];return b.ZO.TransformCoordinatesToRef(a.boundingBox.minimumWorld,O,i),this.encapsulate(i),b.ZO.TransformCoordinatesToRef(a.boundingBox.maximumWorld,O,i),this.encapsulate(i),this}scale(a){return this.boundingBox.scale(a),this.boundingSphere.scale(a),this}isInFrustum(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===O||3===O)&&this.boundingSphere.isCenterInFrustum(a))return!0;if(!this.boundingSphere.isInFrustum(a))return!1;return!(1!==O&&3!==O)||this.boundingBox.isInFrustum(a)}get diagonalLength(){const a=this.boundingBox;return a.maximumWorld.subtractToRef(a.minimumWorld,e._TmpVector3[0]).length()}isCompletelyInFrustum(a){return this.boundingBox.isCompletelyInFrustum(a)}_checkCollision(a){return a._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(a){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(a)&&!!this.boundingBox.intersectsPoint(a))}intersects(a,O){if(!q.c.Intersects(this.boundingSphere,a.boundingSphere))return!1;if(!G.b.Intersects(this.boundingBox,a.boundingBox))return!1;if(!O)return!0;const i=this.boundingBox,H=a.boundingBox;return!!P(i.directions[0],i,H)&&(!!P(i.directions[1],i,H)&&(!!P(i.directions[2],i,H)&&(!!P(H.directions[0],i,H)&&(!!P(H.directions[1],i,H)&&(!!P(H.directions[2],i,H)&&(!!P(b.ZO.Cross(i.directions[0],H.directions[0]),i,H)&&(!!P(b.ZO.Cross(i.directions[0],H.directions[1]),i,H)&&(!!P(b.ZO.Cross(i.directions[0],H.directions[2]),i,H)&&(!!P(b.ZO.Cross(i.directions[1],H.directions[0]),i,H)&&(!!P(b.ZO.Cross(i.directions[1],H.directions[1]),i,H)&&(!!P(b.ZO.Cross(i.directions[1],H.directions[2]),i,H)&&(!!P(b.ZO.Cross(i.directions[2],H.directions[0]),i,H)&&(!!P(b.ZO.Cross(i.directions[2],H.directions[1]),i,H)&&!!P(b.ZO.Cross(i.directions[2],H.directions[2]),i,H))))))))))))))}}e._TmpVector3=(0,H.e)(2,b.ZO.Zero)},12760:(a,O,i)=>{i.d(O,{c:()=>G});var H=i(12403),b=i(12395);class G{constructor(a,O,i){this.center=b.ZO.Zero(),this.centerWorld=b.ZO.Zero(),this.minimum=b.ZO.Zero(),this.maximum=b.ZO.Zero(),this.reConstruct(a,O,i)}reConstruct(a,O,i){this.minimum.q(a),this.maximum.q(O);const H=b.ZO.Distance(a,O);O.addToRef(a,this.center).scaleInPlace(.5),this.radius=.5*H,this._update(i||b.Matrix.IdentityReadOnly)}scale(a){const O=this.radius*a,i=G._TmpVector3,H=i[0].Tb(O),b=this.center.subtractToRef(H,i[1]),q=this.center.addToRef(H,i[2]);return this.reConstruct(b,q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(a){if(a.isIdentity())this.centerWorld.q(this.center),this.radiusWorld=this.radius;else{b.ZO.TransformCoordinatesToRef(this.center,a,this.centerWorld);const O=G._TmpVector3[0];b.ZO.TransformNormalFromFloatsToRef(1,1,1,a,O),this.radiusWorld=Math.max(Math.abs(O.x),Math.abs(O.y),Math.abs(O.z))*this.radius}}isInFrustum(a){const O=this.centerWorld,i=this.radiusWorld;for(let H=0;H<6;H++)if(a[H].dotCoordinate(O)<=-i)return!1;return!0}isCenterInFrustum(a){const O=this.centerWorld;for(let i=0;i<6;i++)if(a[i].dotCoordinate(O)<0)return!1;return!0}intersectsPoint(a){const O=b.ZO.DistanceSquared(this.centerWorld,a);return!(this.radiusWorld*this.radiusWorld<O)}static Intersects(a,O){const i=b.ZO.DistanceSquared(a.centerWorld,O.centerWorld),H=a.radiusWorld+O.radiusWorld;return!(H*H<i)}static CreateFromCenterAndRadius(a,O,i){this._TmpVector3[0].q(a),this._TmpVector3[1].fb(0,0,O),this._TmpVector3[2].q(a),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ne(this._TmpVector3[1]);const H=new G(this._TmpVector3[0],this._TmpVector3[2]);return H._worldMatrix=i||b.Matrix.Identity(),H}}G._TmpVector3=(0,H.e)(3,b.ZO.Zero)},12773:(a,O,i)=>{function H(a){-1===a.indexOf("vClipPlane")&&a.push("vClipPlane"),-1===a.indexOf("vClipPlane2")&&a.push("vClipPlane2"),-1===a.indexOf("vClipPlane3")&&a.push("vClipPlane3"),-1===a.indexOf("vClipPlane4")&&a.push("vClipPlane4"),-1===a.indexOf("vClipPlane5")&&a.push("vClipPlane5"),-1===a.indexOf("vClipPlane6")&&a.push("vClipPlane6")}function b(a,O,i){const H=!!(a.clipPlane??O.clipPlane),b=!!(a.clipPlane2??O.clipPlane2),G=!!(a.clipPlane3??O.clipPlane3),q=!!(a.clipPlane4??O.clipPlane4),Q=!!(a.clipPlane5??O.clipPlane5),k=!!(a.clipPlane6??O.clipPlane6);H&&i.push("#define CLIPPLANE"),b&&i.push("#define CLIPPLANE2"),G&&i.push("#define CLIPPLANE3"),q&&i.push("#define CLIPPLANE4"),Q&&i.push("#define CLIPPLANE5"),k&&i.push("#define CLIPPLANE6")}function G(a,O,i){let H=!1;const b=!!(a.clipPlane??O.clipPlane),G=!!(a.clipPlane2??O.clipPlane2),q=!!(a.clipPlane3??O.clipPlane3),Q=!!(a.clipPlane4??O.clipPlane4),k=!!(a.clipPlane5??O.clipPlane5),I=!!(a.clipPlane6??O.clipPlane6);return i.CLIPPLANE!==b&&(i.CLIPPLANE=b,H=!0),i.CLIPPLANE2!==G&&(i.CLIPPLANE2=G,H=!0),i.CLIPPLANE3!==q&&(i.CLIPPLANE3=q,H=!0),i.CLIPPLANE4!==Q&&(i.CLIPPLANE4=Q,H=!0),i.CLIPPLANE5!==k&&(i.CLIPPLANE5=k,H=!0),i.CLIPPLANE6!==I&&(i.CLIPPLANE6=I,H=!0),H}function q(a,O,i){let H=O.clipPlane??i.clipPlane;Q(a,"vClipPlane",H),H=O.clipPlane2??i.clipPlane2,Q(a,"vClipPlane2",H),H=O.clipPlane3??i.clipPlane3,Q(a,"vClipPlane3",H),H=O.clipPlane4??i.clipPlane4,Q(a,"vClipPlane4",H),H=O.clipPlane5??i.clipPlane5,Q(a,"vClipPlane5",H),H=O.clipPlane6??i.clipPlane6,Q(a,"vClipPlane6",H)}function Q(a,O,i){i&&a.setFloat4(O,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(O,{d:()=>H,f:()=>q,g:()=>G,h:()=>b})},12722:(a,O,i)=>{i.d(O,{c:()=>H});class H{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(a,O){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=new Array),this._defines[a].push(O)}addCPUSkinningFallback(a,O){this._mesh=O,a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(a,O){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,a=a.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),O._bonesComputationForcedToCPU=!0;const i=this._mesh.Ua();for(let a=0;a<i.meshes.length;a++){const H=i.meshes[a];if(H.material){if(H.computeBonesUsingShaders&&0!==H.numBoneInfluencers)if(H.material.getEffect()===O)H.computeBonesUsingShaders=!1;else if(H.Mb)for(const a of H.Mb){if(a.effect===O){H.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&H.computeBonesUsingShaders&&H.numBoneInfluencers>0&&(H.computeBonesUsingShaders=!1)}}else{const O=this._defines[this._currentRank];if(O)for(let i=0;i<O.length;i++)a=a.replace("#define "+O[i],"");this._currentRank++}return a}}},12730:(a,O,i)=>{i.d(O,{b:()=>r});var H=i(12375),b=i(12384),G=i(12184),q=i(12193),Q=i(12236),k=i(12739),I=i(12674),P=i(12209),e=i(12441),h=i(12518),j=i(12427);class Z{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(a){this._func=a}get funcRef(){return this._funcRef}set funcRef(a){this._funcRef=a}get funcMask(){return this._funcMask}set funcMask(a){this._funcMask=a}get opStencilFail(){return this._opStencilFail}set opStencilFail(a){this._opStencilFail=a}get opDepthFail(){return this._opDepthFail}set opDepthFail(a){this._opDepthFail=a}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(a){this._opStencilDepthPass=a}get mask(){return this._mask}set mask(a){this._mask=a}get enabled(){return this._enabled}set enabled(a){this._enabled=a}getClassName(){return"MaterialStencilState"}copyTo(a){j.d.Clone((()=>a),this)}serialize(){return j.d.Serialize(this)}parse(a,O,i){j.d.Parse((()=>this),a,O,i)}}(0,H.c)([(0,b.G)()],Z.prototype,"func",null),(0,H.c)([(0,b.G)()],Z.prototype,"funcRef",null),(0,H.c)([(0,b.G)()],Z.prototype,"funcMask",null),(0,H.c)([(0,b.G)()],Z.prototype,"opStencilFail",null),(0,H.c)([(0,b.G)()],Z.prototype,"opDepthFail",null),(0,H.c)([(0,b.G)()],Z.prototype,"opStencilDepthPass",null),(0,H.c)([(0,b.G)()],Z.prototype,"mask",null),(0,H.c)([(0,b.G)()],Z.prototype,"enabled",null);var F=i(12771);class r{get _supportGlowLayer(){return!1}set _glowModeEnabled(a){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(a){if(this._alpha===a)return;const O=this._alpha;this._alpha=a,1!==O&&1!==a||this.aP(r.MiscDirtyFlag+r.PrePassDirtyFlag)}get alpha(){return this._alpha}set Sb(a){this._backFaceCulling!==a&&(this._backFaceCulling=a,this.aP(r.TextureDirtyFlag))}get Sb(){return this._backFaceCulling}set cullBackFaces(a){this._cullBackFaces!==a&&(this._cullBackFaces=a,this.aP(r.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(a){this._blockDirtyMechanism!==a&&(this._blockDirtyMechanism=a,a||this.mj())}atomicMaterialsUpdate(a){this.blockDirtyMechanism=!0;try{a(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(a){this._onDisposeObserver&&this.Pb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Pb.add(a)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q.e),this._onBindObservable}set onBind(a){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(a)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new q.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new q.e),this._onEffectCreatedObservable}set alphaMode(a){this._alphaMode!==a&&(this._alphaMode=a,this.aP(r.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(a){this._needDepthPrePass!==a&&(this._needDepthPrePass=a,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(a){this._fogEnabled!==a&&(this._fogEnabled=a,this.aP(r.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(a){this.fillMode=a?r.WireFrameFillMode:r.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(a){this.fillMode=a?r.PointFillMode:r.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(a){this._fillMode!==a&&(this._fillMode=a,this.aP(r.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){const O=this.Ua().getEngine().getCaps().fragmentDepthSupported;a&&!O&&P.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=a&&O,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(a){this._drawWrapper=a}constructor(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Pb=new q.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.hb=new Z,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=a;const b=O||Q.b.LastCreatedScene;b&&(this._scene=b,this._dirtyCallbacks={},this._forceGLSL=H,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=a||G.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new h.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new I.d(this._scene.getEngine(),void 0,void 0,a),this._useUBO=this.Ua().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),r.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var a;const O=this.Ua().getEngine();null===(a=this._uniformBuffer)||void 0===a||a.dispose(),O.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new I.d(O,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new I.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(a){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.mj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.mj(),this.checkReadyOnlyOnce=!1}isReady(a,O){return!0}isReadyForSubMesh(a,O,i){const H=O.materialDefines;return!!H&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=H,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Ua(){return this._scene}_getEffectiveOrientation(a){return null!==this.sideOrientation?this.sideOrientation:a.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(a){this._transparencyMode!==a&&(this._transparencyMode=a,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===r.MATERIAL_ALPHABLEND||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===r.MATERIAL_ALPHATEST||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===r.MATERIAL_OPAQUE||this._transparencyMode===r.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(a){return this._hasTransparencyMode?this._transparencyModeIsBlend:a.visibility<1||!this._disableAlphaBlending&&(a.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(a){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(a)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}mj(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.Ua().meshes;for(const i of O)if(i.Mb)for(const O of i.Mb)if(O.ua()===this)for(const i of O._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=a);a&&this.aP(r.AllDirtyFlag)}_preBind(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.getEngine(),H=(null==O?this.sideOrientation:O)===r.ClockWiseSideOrientation;return i.enableEffect(a||this._getDrawWrapper()),i.setState(this.Sb,this.zOffset,!1,H,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.hb,this.zOffsetUnits),H}bind(a,O){}buildUniformLayout(){const a=this._uniformBuffer;this._eventInfo.ubo=a,this._callbackPluginEventGeneric(8,this._eventInfo),a.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(a,O,i){const H=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),H._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(a){}bindView(a){this._useUBO?this._needToBindSceneUbo=!0:a.setMatrix("view",this.Ua().getViewMatrix())}bindViewProjection(a){this._useUBO?this._needToBindSceneUbo=!0:(a.setMatrix("viewProjection",this.Ua().getTransformMatrix()),a.setMatrix("projection",this.Ua().getProjectionMatrix()))}bindEyePosition(a,O){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(a,O)}_afterBind(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&O&&(this._needToBindSceneUbo=!1,(0,F.m)(O,this.Ua().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=a?a.visibility:1,this._onBindObservable&&a&&this._onBindObservable.notifyObservers(a),this.disableDepthWrite){const a=this._scene.getEngine();this._cachedDepthWriteState=a.getDepthWrite(),a.setDepthWrite(!1)}if(this.disableColorWrite){const a=this._scene.getEngine();this._cachedColorWriteState=a.getColorWrite(),a.setColorWrite(!1)}if(0!==this.depthFunction){const a=this._scene.getEngine();this._cachedDepthFunctionState=a.getDepthFunction()||0,a.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(a){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=a,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(a){return null}_clonePlugins(a,O){const i={};if(this._serializePlugins(i),r._ParsePlugins(i,a,this._scene,O),this.pluginManager)for(const H of this.pluginManager._plugins){const O=a.pluginManager.getPlugin(H.name);O&&H.copyTo(O)}}getBindedMeshes(){if(this.meshMap){const a=[];for(const O in this.meshMap){const i=this.meshMap[O];i&&a.push(i)}return a}return this._scene.meshes.filter((a=>a.material===this))}forceCompilation(a,O,i,H){const b={clipPlane:!1,useInstances:!1,...i},G=this.Ua(),q=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const Q=()=>{if(!this._scene||!this._scene.getEngine())return;const i=G.clipPlane;if(b.clipPlane&&(G.clipPlane=new e.c(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,G=null;if(a.Mb){const O=new k.e(0,0,0,0,0,a,void 0,!1,!1);O.materialDefines&&(O.materialDefines._renderId=-1),this.isReadyForSubMesh(a,O,b.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?G=O.effect.getCompilationError():(i=!1,setTimeout(Q,16)))}i&&(this.allowShaderHotSwapping=q,G&&H&&H(G),O&&O(this))}else this.isReady()?(this.allowShaderHotSwapping=q,O&&O(this)):setTimeout(Q,16);b.clipPlane&&(G.clipPlane=i)};Q()}async forceCompilationAsync(a,O){return await new Promise(((i,H)=>{this.forceCompilation(a,(()=>{i()}),O,(a=>{H(a)}))}))}aP(a){this.Ua().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(r._DirtyCallbackArray.length=0,a&r.ImageProcessingDirtyFlag&&r._DirtyCallbackArray.push(r._ImageProcessingDirtyCallBack),a&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),a&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),a&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),a&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),a&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),a&r.PrePassDirtyFlag&&r._DirtyCallbackArray.push(r._PrePassDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.Ua().resetCachedMaterial())}resetDrawCache(){const a=this.Ua().meshes;for(const O of a)if(O.Mb)for(const a of O.Mb)a.ua()===this&&a.resetDrawCache()}_markAllSubMeshesAsDirty(a){const O=this.Ua();if(O.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=O.meshes;for(const H of i)if(H.Mb)for(const i of H.Mb){if((i.ua()||(O._hasDefaultMaterial?O.defaultMaterial:null))===this)for(const O of i._drawWrappers)O&&O.defines&&O.defines.markAllAsDirty&&this._materialContext===O.materialContext&&a(O.defines)}}_markScenePrePassDirty(){if(this.Ua().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const a=this.Ua().enablePrePassRenderer();a&&a.aP()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(r._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(r._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const a=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Pb.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(a)}))}}setPrePassRenderer(a){return!1}dispose(a,O,i){const H=this.Ua();if(H.stopAnimation(this),H.freeProcessedMaterials(),H.removeMaterial(this),this._eventInfo.forceDisposeTextures=O,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const a=this._parentContainer.materials.indexOf(this);a>-1&&this._parentContainer.materials.splice(a,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const b in this.meshMap){const a=this.meshMap[b];this._disposeMeshResources(a)}else{const a=H.meshes;for(const O of a)this._disposeMeshResources(O)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Pb.notifyObservers(this),this.Pb.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(a){if(!a)return;const O=a.wb,i=a._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(a.Mb&&i)for(const b of a.Mb){const a=b._drawWrappers;for(let G=0;G<a.length;G++){var H;const q=null===(H=a[G])||void 0===H?void 0:H.effect;if(!q)continue;i[G]===this&&(null===O||void 0===O||O._releaseVertexArrayObject(q),b._removeDrawWrapper(G,!0,!0))}}}else null===O||void 0===O||O._releaseVertexArrayObject(this._drawWrapper.effect);a.material!==this||a.sourceMesh||(a.material=null)}serialize(){const a=j.d.Serialize(this);return a.hb=this.hb.serialize(),a.uniqueId=this.uniqueId,this._serializePlugins(a),a}_serializePlugins(a){if(a.plugins={},this.pluginManager)for(const O of this.pluginManager._plugins)O.doNotSerialize||(a.plugins[O.getClassName()]=O.serialize())}static Parse(a,O,i){if(a.customType){if("BABYLON.PBRMaterial"===a.customType&&a.overloadedAlbedo&&(a.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return P.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else a.customType="BABYLON.StandardMaterial";const H=G.Tools.Instantiate(a.customType).Parse(a,O,i);return H._loadedUniqueId=a.uniqueId,H}static _ParsePlugins(a,O,i,H){if(a.plugins)for(const Q in a.plugins){var b,q;const k=a.plugins[Q];let I=null===(b=O.pluginManager)||void 0===b?void 0:b.getPlugin(k.name);if(!I){const a=G.Tools.Instantiate("BABYLON."+Q);a&&(I=new a(O))}null===(q=I)||void 0===q||q.parse(k,i,H)}}}r.TriangleFillMode=0,r.WireFrameFillMode=1,r.PointFillMode=2,r.PointListDrawMode=3,r.LineListDrawMode=4,r.LineLoopDrawMode=5,r.LineStripDrawMode=6,r.TriangleStripDrawMode=7,r.TriangleFanDrawMode=8,r.ClockWiseSideOrientation=0,r.CounterClockWiseSideOrientation=1,r.ImageProcessingDirtyFlag=64,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.PrePassDirtyFlag=32,r.AllDirtyFlag=127,r.MATERIAL_OPAQUE=0,r.MATERIAL_ALPHATEST=1,r.MATERIAL_ALPHABLEND=2,r.MATERIAL_ALPHATESTANDBLEND=3,r.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,r.MATERIAL_NORMALBLENDMETHOD_RNM=1,r.OnEventObservable=new q.e,r._AllDirtyCallBack=a=>a.markAllAsDirty(),r._ImageProcessingDirtyCallBack=a=>a.markAsImageProcessingDirty(),r._TextureDirtyCallBack=a=>a.markAsTexturesDirty(),r._FresnelDirtyCallBack=a=>a.markAsFresnelDirty(),r._MiscDirtyCallBack=a=>a.markAsMiscDirty(),r._PrePassDirtyCallBack=a=>a.markAsPrePassDirty(),r._LightsDirtyCallBack=a=>a.markAsLightDirty(),r._AttributeDirtyCallBack=a=>a.markAsAttributesDirty(),r._FresnelAndMiscDirtyCallBack=a=>{r._FresnelDirtyCallBack(a),r._MiscDirtyCallBack(a)},r._TextureAndMiscDirtyCallBack=a=>{r._TextureDirtyCallBack(a),r._MiscDirtyCallBack(a)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=a=>{for(const O of r._DirtyCallbackArray)O(a)},(0,H.c)([(0,b.G)()],r.prototype,"id",void 0),(0,H.c)([(0,b.G)()],r.prototype,"uniqueId",void 0),(0,H.c)([(0,b.G)()],r.prototype,"name",void 0),(0,H.c)([(0,b.G)()],r.prototype,"metadata",void 0),(0,H.c)([(0,b.G)()],r.prototype,"checkReadyOnEveryCall",void 0),(0,H.c)([(0,b.G)()],r.prototype,"checkReadyOnlyOnce",void 0),(0,H.c)([(0,b.G)()],r.prototype,"state",void 0),(0,H.c)([(0,b.G)("alpha")],r.prototype,"_alpha",void 0),(0,H.c)([(0,b.G)("Sb")],r.prototype,"_backFaceCulling",void 0),(0,H.c)([(0,b.G)("cullBackFaces")],r.prototype,"_cullBackFaces",void 0),(0,H.c)([(0,b.G)()],r.prototype,"sideOrientation",void 0),(0,H.c)([(0,b.G)("alphaMode")],r.prototype,"_alphaMode",void 0),(0,H.c)([(0,b.G)()],r.prototype,"_needDepthPrePass",void 0),(0,H.c)([(0,b.G)()],r.prototype,"disableDepthWrite",void 0),(0,H.c)([(0,b.G)()],r.prototype,"disableColorWrite",void 0),(0,H.c)([(0,b.G)()],r.prototype,"forceDepthWrite",void 0),(0,H.c)([(0,b.G)()],r.prototype,"depthFunction",void 0),(0,H.c)([(0,b.G)()],r.prototype,"separateCullingPass",void 0),(0,H.c)([(0,b.G)("fogEnabled")],r.prototype,"_fogEnabled",void 0),(0,H.c)([(0,b.G)()],r.prototype,"pointSize",void 0),(0,H.c)([(0,b.G)()],r.prototype,"zOffset",void 0),(0,H.c)([(0,b.G)()],r.prototype,"zOffsetUnits",void 0),(0,H.c)([(0,b.G)()],r.prototype,"pointsCloud",null),(0,H.c)([(0,b.G)()],r.prototype,"fillMode",null),(0,H.c)([(0,b.G)()],r.prototype,"useLogarithmicDepth",null),(0,H.c)([(0,b.G)()],r.prototype,"transparencyMode",null)},12771:(a,O,i)=>{i.d(O,{A:()=>j,D:()=>h,H:()=>T,L:()=>B,N:()=>S,Q:()=>J,R:()=>K,S:()=>A,U:()=>E,V:()=>l,W:()=>u,_:()=>Z,b:()=>C,d:()=>e,g:()=>D,h:()=>P,j:()=>F,m:()=>r,o:()=>ma,s:()=>w,v:()=>M,w:()=>U,x:()=>y});var H=i(12209),b=i(12436),G=i(12236),q=i(12719),Q=i(12773);const k=b.mi.Black(),I={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function P(a,O,i){if(!a||a.LOGARITHMICDEPTH||a.indexOf&&a.indexOf("LOGARITHMICDEPTH")>=0){const a=i.activeCamera;1===a.mode&&H.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),O.setFloat("logarithmicDepthConstant",2/(Math.log(a.maxZ+1)/Math.LN2))}}function e(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&a.fogEnabled&&(!O||O.applyFog)&&0!==a.fogMode&&(i.setFloat4("vFogInfos",a.fogMode,a.fogStart,a.fogEnd,a.fogDensity),H?(a.fogColor.toLinearSpaceToRef(k,a.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",k)):i.setColor3("vFogColor",a.fogColor))}function h(a,O,i,H,b,G,q,Q,k,P){const e=a.numMaxInfluencers||a.numInfluencers;return e<=0?0:(O.push("#define MORPHTARGETS"),a.hasPositions&&O.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),a.hasNormals&&O.push("#define MORPHTARGETTEXTURE_HASNORMALS"),a.hasTangents&&O.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),a.hasUVs&&O.push("#define MORPHTARGETTEXTURE_HASUVS"),a.hasUV2s&&O.push("#define MORPHTARGETTEXTURE_HASUV2S"),a.hasColors&&O.push("#define MORPHTARGETTEXTURE_HASCOLORS"),a.supportsPositions&&b&&O.push("#define MORPHTARGETS_POSITION"),a.supportsNormals&&G&&O.push("#define MORPHTARGETS_NORMAL"),a.supportsTangents&&q&&O.push("#define MORPHTARGETS_TANGENT"),a.supportsUVs&&Q&&O.push("#define MORPHTARGETS_UV"),a.supportsUV2s&&k&&O.push("#define MORPHTARGETS_UV2"),a.supportsColors&&P&&O.push("#define MORPHTARGETS_COLOR"),O.push("#define NUM_MORPH_INFLUENCERS "+e),a.isUsingTextureForTargets&&O.push("#define MORPHTARGETS_TEXTURE"),I.NUM_MORPH_INFLUENCERS=e,I.NORMAL=G,I.TANGENT=q,I.UV=Q,I.UV2=k,I.COLOR=P,j(i,H,I,b),e)}function j(a,O,i){let b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=i.NUM_MORPH_INFLUENCERS;if(q>0&&G.b.LastCreatedEngine){const Q=G.b.LastCreatedEngine.getCaps().maxVertexAttribs,k=O.morphTargetManager;if(null!==k&&void 0!==k&&k.isUsingTextureForTargets)return;const I=k&&k.supportsPositions&&b,P=k&&k.supportsNormals&&i.NORMAL,e=k&&k.supportsTangents&&i.TANGENT,h=k&&k.supportsUVs&&i.UV1,j=k&&k.supportsUV2s&&i.UV2,Z=k&&k.supportsColors&&i.VERTEXCOLOR;for(let i=0;i<q;i++)I&&a.push("position"+i),P&&a.push("normal"+i),e&&a.push("tangent"+i),h&&a.push("uv_"+i),j&&a.push("uv2_"+i),Z&&a.push("color"+i),a.length>Q&&H.c.Error("Cannot add more vertex attributes for mesh "+O.name)}}function Z(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"),O&&(a.push("previousWorld0"),a.push("previousWorld1"),a.push("previousWorld2"),a.push("previousWorld3"))}function F(a,O){const i=a.morphTargetManager;a&&i&&O.setFloatArray("morphTargetInfluences",i.influences)}function r(a,O){O.bindToEffect(a,"Scene")}function J(a,O,i){O._needUVs=!0,O[i]=!0,a.optimizeUVAllocation&&a.getTextureMatrix().isIdentityAs3x2()?(O[i+"DIRECTUV"]=a.coordinatesIndex+1,O["MAINUV"+(a.coordinatesIndex+1)]=!0):O[i+"DIRECTUV"]=0}function ma(a,O,i){const H=a.getTextureMatrix();O.Ub(i+"Matrix",H)}function M(a,O,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&a.push("bakedVertexAnimationSettingsInstanced")}function C(a,O,i){var H;if(O&&a&&(a.computeBonesUsingShaders&&O._bonesComputationForcedToCPU&&(a.computeBonesUsingShaders=!1),a.useBones&&a.computeBonesUsingShaders&&a.skeleton)){const b=a.skeleton;if(b.isUsingTextureForMatrices&&O.getUniformIndex("boneTextureWidth")>-1){const i=b.getTransformMatrixTexture(a);O.setTexture("boneSampler",i),O.setFloat("boneTextureWidth",4*(b.bones.length+1))}else{const G=b.getTransformMatrices(a);G&&(O.setMatrices("mBones",G),i&&a.Ua().prePassRenderer&&a.Ua().prePassRenderer.getIndex(2)&&(i.previousBones[a.uniqueId]||(i.previousBones[a.uniqueId]=G.slice()),O.setMatrices("mPreviousBones",i.previousBones[a.uniqueId]),H=G,i.previousBones[a.uniqueId].set(H)))}}}function n(a,O,i,H,b){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];a._bindLight(O,i,H,b,G)}function D(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const G=Math.min(O.lightSources.length,b);for(let q=0;q<G;q++){n(O.lightSources[q],q,a,i,"boolean"===typeof H?H:H.SPECULARTERM,O.receiveShadows)}}function U(a,O,i,H){i.NUM_BONE_INFLUENCERS>0&&(H.addCPUSkinningFallback(0,O),a.push("matricesIndices"),a.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(a.push("matricesIndicesExtra"),a.push("matricesWeightsExtra")))}function y(a,O){(O.INSTANCES||O.THIN_INSTANCES)&&Z(a,!!O.PREPASS_VELOCITY),O.INSTANCESCOLOR&&a.push("instanceColor")}function w(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=0;for(let G=0;G<i&&a["LIGHT"+G];G++)G>0&&(b=H+G,O.addFallback(b,"LIGHT"+G)),a.SHADOWS||(a["SHADOW"+G]&&O.addFallback(H,"SHADOW"+G),a["SHADOWPCF"+G]&&O.addFallback(H,"SHADOWPCF"+G),a["SHADOWPCSS"+G]&&O.addFallback(H,"SHADOWPCSS"+G),a["SHADOWPOISSON"+G]&&O.addFallback(H,"SHADOWPOISSON"+G),a["SHADOWESM"+G]&&O.addFallback(H,"SHADOWESM"+G),a["SHADOWCLOSEESM"+G]&&O.addFallback(H,"SHADOWCLOSEESM"+G));return b++}function K(a,O,i,H,b,G,q){let Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];q._areMiscDirty&&(q.LOGARITHMICDEPTH=i,q.POINTSIZE=H,q.FOG=b&&function(a,O){return O.fogEnabled&&a.applyFog&&0!==O.fogMode}(a,O),q.NONUNIFORMSCALING=a.nonUniformScaling,q.ALPHATEST=G,q.DECAL_AFTER_DETAIL=Q)}function S(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i._areLightsDirty)return i._needNormals;let q=0;const Q={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(a.lightsEnabled&&!G)for(const I of O.lightSources)if(f(a,O,I,q,i,H,Q),q++,q===b)break;i.SPECULARTERM=Q.specularEnabled,i.SHADOWS=Q.shadowEnabled;for(let I=q;I<b;I++)void 0!==i["LIGHT"+I]&&(i["LIGHT"+I]=!1,i["HEMILIGHT"+I]=!1,i["POINTLIGHT"+I]=!1,i["DIRLIGHT"+I]=!1,i["SPOTLIGHT"+I]=!1,i["AREALIGHT"+I]=!1,i["SHADOW"+I]=!1,i["SHADOWCSM"+I]=!1,i["SHADOWCSMDEBUG"+I]=!1,i["SHADOWCSMNUM_CASCADES"+I]=!1,i["SHADOWCSMUSESHADOWMAXZ"+I]=!1,i["SHADOWCSMNOBLEND"+I]=!1,i["SHADOWCSM_RIGHTHANDED"+I]=!1,i["SHADOWPCF"+I]=!1,i["SHADOWPCSS"+I]=!1,i["SHADOWPOISSON"+I]=!1,i["SHADOWESM"+I]=!1,i["SHADOWCLOSEESM"+I]=!1,i["SHADOWCUBE"+I]=!1,i["SHADOWLOWQUALITY"+I]=!1,i["SHADOWMEDIUMQUALITY"+I]=!1);const k=a.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(Q.needRebuild=!0),i.SHADOWFLOAT=Q.shadowEnabled&&(k.textureFloatRender&&k.textureFloatLinearFiltering||k.textureHalfFloatRender&&k.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=Q.lightmapMode,Q.needRebuild&&i.rebuild(),Q.needNormals}function f(a,O,i,H,b,G,Q){switch(Q.needNormals=!0,void 0===b["LIGHT"+H]&&(Q.needRebuild=!0),b["LIGHT"+H]=!0,b["SPOTLIGHT"+H]=!1,b["HEMILIGHT"+H]=!1,b["POINTLIGHT"+H]=!1,b["DIRLIGHT"+H]=!1,b["AREALIGHT"+H]=!1,i.prepareLightSpecificDefines(b,H),b["LIGHT_FALLOFF_PHYSICAL"+H]=!1,b["LIGHT_FALLOFF_GLTF"+H]=!1,b["LIGHT_FALLOFF_STANDARD"+H]=!1,i.falloffType){case q.c.FALLOFF_GLTF:b["LIGHT_FALLOFF_GLTF"+H]=!0;break;case q.c.FALLOFF_PHYSICAL:b["LIGHT_FALLOFF_PHYSICAL"+H]=!0;break;case q.c.FALLOFF_STANDARD:b["LIGHT_FALLOFF_STANDARD"+H]=!0}if(G&&!i.DP.equalsFloats(0,0,0)&&(Q.specularEnabled=!0),b["SHADOW"+H]=!1,b["SHADOWCSM"+H]=!1,b["SHADOWCSMDEBUG"+H]=!1,b["SHADOWCSMNUM_CASCADES"+H]=!1,b["SHADOWCSMUSESHADOWMAXZ"+H]=!1,b["SHADOWCSMNOBLEND"+H]=!1,b["SHADOWCSM_RIGHTHANDED"+H]=!1,b["SHADOWPCF"+H]=!1,b["SHADOWPCSS"+H]=!1,b["SHADOWPOISSON"+H]=!1,b["SHADOWESM"+H]=!1,b["SHADOWCLOSEESM"+H]=!1,b["SHADOWCUBE"+H]=!1,b["SHADOWLOWQUALITY"+H]=!1,b["SHADOWMEDIUMQUALITY"+H]=!1,O&&O.receiveShadows&&a.shadowsEnabled&&i.shadowEnabled){const O=i.getShadowGenerator(a.activeCamera)??i.getShadowGenerator();if(O){const a=O.getShadowMap();a&&a.renderList&&a.renderList.length>0&&(Q.shadowEnabled=!0,O.prepareDefines(b,H))}}i.lightmapMode!=q.c.LIGHTMAP_DEFAULT?(Q.lightmapMode=!0,b["LIGHTMAPEXCLUDED"+H]=!0,b["LIGHTMAPNOSPECULAR"+H]=i.lightmapMode==q.c.LIGHTMAP_SHADOWSONLY):(b["LIGHTMAPEXCLUDED"+H]=!1,b["LIGHTMAPNOSPECULAR"+H]=!1)}function B(a,O,i,H,b){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=function(a,O){let i=!1;if(a.activeCamera){const H=O.CAMERA_ORTHOGRAPHIC?1:0,b=O.CAMERA_PERSPECTIVE?1:0,G=1===a.activeCamera.mode?1:0,q=0===a.activeCamera.mode?1:0;(H^G||b^q)&&(O.CAMERA_ORTHOGRAPHIC=1===G,O.CAMERA_PERSPECTIVE=1===q,i=!0)}return i}(a,H);!1!==G&&(k=(0,Q.g)(i,a,H)),H.DEPTHPREPASS!==!O.getColorWrite()&&(H.DEPTHPREPASS=!H.DEPTHPREPASS,k=!0),H.INSTANCES!==b&&(H.INSTANCES=b,k=!0),H.THIN_INSTANCES!==q&&(H.THIN_INSTANCES=q,k=!0),k&&H.markAsUnprocessed()}function T(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!O._areAttributesDirty&&O._needNormals===O._normals&&O._needUVs===O._uvs)return!1;O._normals=O._needNormals,O._uvs=O._needUVs,O.NORMAL=O._needNormals&&a.isVerticesDataPresent("normal"),O._needNormals&&a.isVerticesDataPresent("tangent")&&(O.TANGENT=!0);for(let Q=1;Q<=6;++Q)O["UV"+Q]=!!O._needUVs&&a.isVerticesDataPresent(`uv${1===Q?"":Q}`);if(i){const i=a.useVertexColors&&a.isVerticesDataPresent("color");O.VERTEXCOLOR=i,O.VERTEXALPHA=a.hasVertexAlpha&&i&&G}return a.isVerticesDataPresent("instanceColor")&&(a.hasInstances||a.hasThinInstances)&&(O.INSTANCESCOLOR=!0),H&&function(a,O){if(a.useBones&&a.computeBonesUsingShaders&&a.skeleton){O.NUM_BONE_INFLUENCERS=a.numBoneInfluencers;const i=void 0!==O.BONETEXTURE;if(a.skeleton.isUsingTextureForMatrices&&i)O.BONETEXTURE=!0;else{O.BonesPerMesh=a.skeleton.bones.length+1,O.BONETEXTURE=!i&&void 0;const H=a.Ua().prePassRenderer;if(H&&H.enabled){const i=-1===H.excludedSkinnedMesh.indexOf(a);O.BONES_VELOCITY_ENABLED=i}}}else O.NUM_BONE_INFLUENCERS=0,O.BonesPerMesh=0,void 0!==O.BONETEXTURE&&(O.BONETEXTURE=!1)}(a,O),b&&function(a,O){const i=a.morphTargetManager;i?(O.MORPHTARGETS_UV=i.supportsUVs&&O.UV1,O.MORPHTARGETS_UV2=i.supportsUV2s&&O.UV2,O.MORPHTARGETS_TANGENT=i.supportsTangents&&O.TANGENT,O.MORPHTARGETS_NORMAL=i.supportsNormals&&O.NORMAL,O.MORPHTARGETS_POSITION=i.supportsPositions,O.MORPHTARGETS_COLOR=i.supportsColors,O.MORPHTARGETTEXTURE_HASUVS=i.hasUVs,O.MORPHTARGETTEXTURE_HASUV2S=i.hasUV2s,O.MORPHTARGETTEXTURE_HASTANGENTS=i.hasTangents,O.MORPHTARGETTEXTURE_HASNORMALS=i.hasNormals,O.MORPHTARGETTEXTURE_HASPOSITIONS=i.hasPositions,O.MORPHTARGETTEXTURE_HASCOLORS=i.hasColors,O.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,O.MORPHTARGETS=O.NUM_MORPH_INFLUENCERS>0,O.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(O.MORPHTARGETS_UV=!1,O.MORPHTARGETS_UV2=!1,O.MORPHTARGETS_TANGENT=!1,O.MORPHTARGETS_NORMAL=!1,O.MORPHTARGETS_POSITION=!1,O.MORPHTARGETS_COLOR=!1,O.MORPHTARGETTEXTURE_HASUVS=!1,O.MORPHTARGETTEXTURE_HASUV2S=!1,O.MORPHTARGETTEXTURE_HASTANGENTS=!1,O.MORPHTARGETTEXTURE_HASNORMALS=!1,O.MORPHTARGETTEXTURE_HASPOSITIONS=!1,O.MORPHTARGETTEXTURE_HAS_COLORS=!1,O.MORPHTARGETS=!1,O.NUM_MORPH_INFLUENCERS=0)}(a,O),q&&function(a,O){const i=a.bakedVertexAnimationManager;O.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(a,O),!0}function A(a,O){if(a.activeCamera){const i=O.MULTIVIEW;O.MULTIVIEW=null!==a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1,O.MULTIVIEW!=i&&O.markAsUnprocessed()}}function E(a,O,i){const H=O.ORDER_INDEPENDENT_TRANSPARENCY,b=O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;O.ORDER_INDEPENDENT_TRANSPARENCY=a.useOrderIndependentTransparency&&i,O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!a.getEngine().getCaps().textureFloatLinearFiltering,H===O.ORDER_INDEPENDENT_TRANSPARENCY&&b===O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||O.markAsUnprocessed()}function l(a,O,i){const H=O.PREPASS;if(!O._arePrePassDirty)return;const b=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(a.prePassRenderer&&a.prePassRenderer.enabled&&i){O.PREPASS=!0,O.SCENE_MRT_COUNT=a.prePassRenderer.mrtCount,O.PREPASS_NORMAL_WORLDSPACE=a.prePassRenderer.generateNormalsInWorldSpace,O.PREPASS_COLOR=!0,O.PREPASS_COLOR_INDEX=0;for(let i=0;i<b.length;i++){const H=a.prePassRenderer.getIndex(b[i].type);-1!==H?(O[b[i].define]=!0,O[b[i].index]=H):O[b[i].define]=!1}}else{O.PREPASS=!1;for(let a=0;a<b.length;a++)O[b[a].define]=!1}O.PREPASS!=H&&(O.markAsUnprocessed(),O.markAsImageProcessingDirty())}function W(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];b&&b.push("Light"+a),G||(O.push("vLightData"+a,"vLightDiffuse"+a,"vLightSpecular"+a,"vLightDirection"+a,"vLightWidth"+a,"vLightHeight"+a,"vLightFalloff"+a,"vLightGround"+a,"lightMatrix"+a,"shadowsInfo"+a,"depthValues"+a),i.push("shadowTexture"+a),i.push("depthTexture"+a),O.push("viewFrustumZ"+a,"cascadeBlendFactor"+a,"lightSizeUVCorrection"+a,"depthCorrection"+a,"penumbraDarkness"+a,"frustumLengths"+a),H&&(i.push("projectionLightTexture"+a),O.push("textureProjectionMatrix"+a)),q&&i.push("iesLightTexture"+a))}function u(a,O,i){let H,b,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(a.uniformsNames){const q=a;H=q.uniformsNames,b=q.uniformBuffersNames,O=q.samplers,i=q.defines,G=q.maxSimultaneousLights||0}else H=a,O||(O=[]);for(let q=0;q<G&&i["LIGHT"+q];q++)W(q,H,O,i["PROJECTEDLIGHTTEXTURE"+q],b,!1,i["IESLIGHTTEXTURE"+q]);i.NUM_MORPH_INFLUENCERS&&(H.push("morphTargetInfluences"),H.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(H.push("bakedVertexAnimationSettings"),H.push("bakedVertexAnimationTextureSizeInverted"),H.push("bakedVertexAnimationTime"),O.push("bakedVertexAnimationTexture"))}},12726:(a,O,i)=>{i.d(O,{d:()=>G});var H=i(12395),b=i(12730);class G extends b.b{constructor(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(a,O,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new H.Matrix,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(a,O){return!!a&&(!this._storeEffectOnSubMeshes||(!a.Mb||0===a.Mb.length||this.isReadyForSubMesh(a,a.Mb[0],O)))}_isReadyForSubMesh(a){const O=a.materialDefines;return!(this.checkReadyOnEveryCall||!a.effect||!O||O._renderId!==this.Ua().getRenderId())}bindOnlyWorldMatrix(a){this._activeEffect.setMatrix("world",a)}bindOnlyNormalMatrix(a){this._activeEffect.setMatrix("normalMatrix",a)}bind(a,O){O&&this.bindForSubMesh(a,O,O.Mb[0])}_afterBind(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;super._afterBind(a,O,i),this.Ua()._cachedEffect=O,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i._drawWrapper._forceRebindOnNextCall||a.isCachedMaterialInvalid(this,O,H)}dispose(a,O,i){this._activeEffect=void 0,super.dispose(a,O,i)}}},12765:(a,O,i)=>{i.d(O,{d:()=>Q,e:()=>k});var H=i(12375),b=i(12395),G=i(12384);class q{static extractMinAndMaxIndexed(a,O,i,H,b,G){for(let q=i;q<i+H;q++){const i=3*O[q],H=a[i],Q=a[i+1],k=a[i+2];b.minimizeInPlaceFromFloats(H,Q,k),G.maximizeInPlaceFromFloats(H,Q,k)}}static extractMinAndMax(a,O,i,H,b,G){for(let q=O,Q=O*H;q<O+i;q++,Q+=H){const O=a[Q],i=a[Q+1],H=a[Q+2];b.minimizeInPlaceFromFloats(O,i,H),G.maximizeInPlaceFromFloats(O,i,H)}}}function Q(a,O,i,H){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Q=new b.ZO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new b.ZO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return q.extractMinAndMaxIndexed(a,O,i,H,Q,k),G&&(Q.x-=Q.x*G.x+G.y,Q.y-=Q.y*G.x+G.y,Q.z-=Q.z*G.x+G.y,k.x+=k.x*G.x+G.y,k.y+=k.y*G.x+G.y,k.z+=k.z*G.x+G.y),{minimum:Q,maximum:k}}function k(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0;const Q=new b.ZO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new b.ZO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return G||(G=3),q.extractMinAndMax(a,O,i,G,Q,k),H&&(Q.x-=Q.x*H.x+H.y,Q.y-=Q.y*H.x+H.y,Q.z-=Q.z*H.x+H.y,k.x+=k.x*H.x+H.y,k.y+=k.y*H.x+H.y,k.z+=k.z*H.x+H.y),{minimum:Q,maximum:k}}(0,H.c)([G.f.filter((function(){for(var a=arguments.length,O=new Array(a),i=0;i<a;i++)O[i]=arguments[i];let[H,b]=O;return!Array.isArray(H)&&!Array.isArray(b)}))],q,"extractMinAndMaxIndexed",null),(0,H.c)([G.f.filter((function(){for(var a=arguments.length,O=new Array(a),i=0;i<a;i++)O[i]=arguments[i];let[H]=O;return!Array.isArray(H)}))],q,"extractMinAndMax",null)},12739:(a,O,i)=>{i.d(O,{e:()=>k});var H=i(12470),b=i(12743),G=i(12748),q=i(12765),Q=i(12518);class k{get materialDefines(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(a=this._getDrawWrapper())||void 0===a?void 0:a.defines}set materialDefines(a){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=a}_getDrawWrapper(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a??this._engine.currentRenderPassId;let i=this._drawWrappers[a];return!i&&O&&(this._drawWrappers[a]=i=new Q.e(this._mesh.Ua().getEngine())),i}_removeDrawWrapper(a){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(i=this._drawWrappers[a])||void 0===i||i.dispose(O));this._drawWrappers[a]=void 0}get effect(){var a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(a=this._getDrawWrapper())||void 0===a?void 0:a.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(a){this._mainDrawWrapperOverride=a}setEffect(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=this._drawWrapper;b.setEffect(a,O,H),void 0!==i&&(b.materialContext=i),a||(b.defines=null,b.materialContext=void 0)}resetDrawCache(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==a)return void this._removeDrawWrapper(a,!0,O);for(const a of this._drawWrappers)null===a||void 0===a||a.dispose(O)}this._drawWrappers=[]}static AddToMesh(a,O,i,H,b,G,q){return new k(a,O,i,H,b,G,q,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(a,O,i,H,b,G,q){let Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],k=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=a,this.verticesStart=O,this.verticesCount=i,this.indexStart=H,this.indexCount=b,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=G,this._renderingMesh=q||G,k&&G.Mb.push(this),this._engine=this._mesh.Ua().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=G.Mb.length-1,Q&&(this.refreshBoundingInfo(),G.yb(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(a){return this._boundingInfo=a,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const a=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return a||this._renderingMesh}ua(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!O)return a&&this._mesh.Ua()._hasDefaultMaterial?this._mesh.Ua().defaultMaterial:null;if(this._isMultiMaterial(O)){const a=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==a&&(this._currentMaterial=a,this.resetDrawCache()),a}return O}_isMultiMaterial(a){return void 0!==a.getSubMaterial}refreshBoundingInfo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wb)return this;if(a||(a=this._renderingMesh.getVerticesData(H.c.PositionKind)),!a)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const O=this._renderingMesh.Kb();let i;if(0===this.indexStart&&this.indexCount===O.length){const a=this._renderingMesh.getBoundingInfo();i={minimum:a.minimum.clone(),maximum:a.maximum.clone()}}else i=(0,q.d)(a,O,this.indexStart,this.indexCount,this._renderingMesh.wb.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new G.e(i.minimum,i.maximum),this}_checkCollision(a){return this.getBoundingInfo()._checkCollision(a)}updateBoundingInfo(a){let O=this.getBoundingInfo();return O||(this.refreshBoundingInfo(),O=this.getBoundingInfo()),O&&O.update(a),this}isInFrustum(a){const O=this.getBoundingInfo();return!!O&&O.isInFrustum(a,this._mesh.ge)}isCompletelyInFrustum(a){const O=this.getBoundingInfo();return!!O&&O.isCompletelyInFrustum(a)}render(a){return this._renderingMesh.render(this,a,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(a,O){if(!this._linesIndexBuffer){const i=6*Math.floor(this.indexCount/3),H=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let b=0;if(0===a.length)for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)H[b++]=a,H[b++]=a+1,H[b++]=a+1,H[b++]=a+2,H[b++]=a+2,H[b++]=a;else for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=3)H[b++]=a[O],H[b++]=a[O+1],H[b++]=a[O+1],H[b++]=a[O+2],H[b++]=a[O+2],H[b++]=a[O];this._linesIndexBuffer=O.createIndexBuffer(H),this._linesIndexCount=H.length}return this._linesIndexBuffer}canIntersects(a){const O=this.getBoundingInfo();return!!O&&a.intersectsBox(O.boundingBox)}intersects(a,O,i,H,b){const G=this.ua();if(!G)return null;let q=3,Q=!1;switch(G.fillMode){case 3:case 5:case 6:case 8:return null;case 7:q=1,Q=!0}return 4===G.fillMode?i.length?this._intersectLines(a,O,i,this._mesh.intersectionThreshold,H):this._intersectUnIndexedLines(a,O,i,this._mesh.intersectionThreshold,H):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(a,O,i,H,b):this._intersectTriangles(a,O,i,q,Q,H,b)}_intersectLines(a,O,i,H,G){let q=null;for(let Q=this.indexStart;Q<this.indexStart+this.indexCount;Q+=2){const k=O[i[Q]],I=O[i[Q+1]],P=a.intersectionSegment(k,I,H);if(!(P<0)&&((G||!q||P<q.distance)&&(q=new b.b(null,null,P),q.faceId=Q/2,G)))break}return q}_intersectUnIndexedLines(a,O,i,H,G){let q=null;for(let Q=this.verticesStart;Q<this.verticesStart+this.verticesCount;Q+=2){const i=O[Q],k=O[Q+1],I=a.intersectionSegment(i,k,H);if(!(I<0)&&((G||!q||I<q.distance)&&(q=new b.b(null,null,I),q.faceId=Q/2,G)))break}return q}_intersectTriangles(a,O,i,H,b,G,q){let Q=null,k=-1;for(let I=this.indexStart;I<this.indexStart+this.indexCount-(3-H);I+=H){k++;const H=i[I],P=i[I+1],e=i[I+2];if(b&&4294967295===e){I+=2;continue}const h=O[H],j=O[P],Z=O[e];if(!h||!j||!Z)continue;if(q&&!q(h,j,Z,a,H,P,e))continue;const F=a.intersectsTriangle(h,j,Z);if(F){if(F.distance<0)continue;if((G||!Q||F.distance<Q.distance)&&(Q=F,Q.faceId=k,G))break}}return Q}_intersectUnIndexedTriangles(a,O,i,H,b){let G=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=3){const i=O[q],Q=O[q+1],k=O[q+2];if(b&&!b(i,Q,k,a,-1,-1,-1))continue;const I=a.intersectsTriangle(i,Q,k);if(I){if(I.distance<0)continue;if((H||!G||I.distance<G.distance)&&(G=I,G.faceId=q/3,H))break}}return G}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(a,O){const i=new k(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,a,O,!1);if(!this.IsGlobal){const a=this.getBoundingInfo();if(!a)return i;i._boundingInfo=new G.e(a.minimum,a.maximum)}return i}dispose(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Ua().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const O=this._mesh.Mb.indexOf(this);this._mesh.Mb.splice(O,1),this.resetDrawCache(void 0,a)}getClassName(){return"SubMesh"}static CreateFromIndices(a,O,i,H,b){let G=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=Number.MAX_VALUE,Q=-Number.MAX_VALUE;const I=(b||H).Kb();for(let k=O;k<O+i;k++){const a=I[k];a<q&&(q=a),a>Q&&(Q=a)}return new k(a,q,Q-q+1,O,i,H,b,G)}}}}]);