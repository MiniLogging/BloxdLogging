"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[24],{12844:(o,v,V)=>{V.d(v,{b:()=>g});class g{constructor(o,v,V){this.bu=o,this.bv=v,this.distance=V,this.faceId=0,this.subMeshId=0}}},12858:(o,v,V)=>{V.d(v,{d:()=>Q});var g=V(12503),E=V(12488),I=V(12497);class Q{constructor(o,v,V){this.vectors=(0,g.b)(8,E.cv.Zero),this.center=E.cv.Zero(),this.centerWorld=E.cv.Zero(),this.extendSize=E.cv.Zero(),this.extendSizeWorld=E.cv.Zero(),this.directions=(0,g.b)(3,E.cv.Zero),this.vectorsWorld=(0,g.b)(8,E.cv.Zero),this.minimumWorld=E.cv.Zero(),this.maximumWorld=E.cv.Zero(),this.minimum=E.cv.Zero(),this.maximum=E.cv.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(o,v,V)}reConstruct(o,v,V){const g=o.x,I=o.y,Q=o.z,U=v.x,n=v.y,O=v.z,h=this.vectors;this.minimum.RU(g,I,Q),this.maximum.RU(U,n,O),h[0].RU(g,I,Q),h[1].RU(U,n,O),h[2].RU(U,I,Q),h[3].RU(g,n,Q),h[4].RU(g,I,O),h[5].RU(U,n,Q),h[6].RU(g,n,O),h[7].RU(U,I,O),v.addToRef(o,this.center).scaleInPlace(.5),v.subtractToRef(o,this.extendSize).scaleInPlace(.5),this._worldMatrix=V||E.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(o){const v=Q._TmpVector3,V=this.maximum.subtractToRef(this.minimum,v[0]),g=V.length();V.normalizeFromLength(g);const E=g*o,I=V.scaleInPlace(.5*E),U=this.center.subtractToRef(I,v[1]),n=this.center.addToRef(I,v[2]);return this.reConstruct(U,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(o){const v=this.minimumWorld,V=this.maximumWorld,g=this.directions,I=this.vectorsWorld,Q=this.vectors;if(o.isIdentity()){v.U(this.minimum),V.U(this.maximum);for(let o=0;o<8;++o)I[o].U(Q[o]);this.extendSizeWorld.U(this.extendSize),this.centerWorld.U(this.center)}else{v.tU(Number.MAX_VALUE),V.tU(-Number.MAX_VALUE);for(let g=0;g<8;++g){const U=I[g];E.cv.TransformCoordinatesToRef(Q[g],o,U),v.minimizeInPlace(U),V.maximizeInPlace(U)}V.subtractToRef(v,this.extendSizeWorld).scaleInPlace(.5),V.addToRef(v,this.centerWorld).scaleInPlace(.5)}E.cv.FromArrayToRef(o.m,0,g[0]),E.cv.FromArrayToRef(o.m,4,g[1]),E.cv.FromArrayToRef(o.m,8,g[2]),this._worldMatrix=o}isInFrustum(o){return Q.IsInFrustum(this.vectorsWorld,o)}isCompletelyInFrustum(o){return Q.IsCompletelyInFrustum(this.vectorsWorld,o)}intersectsPoint(o){const v=this.minimumWorld,V=this.maximumWorld,g=v.x,E=v.y,Q=v.z,U=V.x,n=V.y,O=V.z,h=o.x,x=o.y,f=o.z,l=-I.d;return!(U-h<l||l>h-g)&&(!(n-x<l||l>x-E)&&!(O-f<l||l>f-Q))}intersectsSphere(o){return Q.IntersectsSphere(this.minimumWorld,this.maximumWorld,o.centerWorld,o.radiusWorld)}intersectsMinMax(o,v){const V=this.minimumWorld,g=this.maximumWorld,E=V.x,I=V.y,Q=V.z,U=g.x,n=g.y,O=g.z,h=o.x,x=o.y,f=o.z,l=v.x,S=v.y,T=v.z;return!(U<h||E>l)&&(!(n<x||I>S)&&!(O<f||Q>T))}dispose(){var o,v;null===(o=this._drawWrapperFront)||void 0===o||o.dispose(),null===(v=this._drawWrapperBack)||void 0===v||v.dispose()}static Intersects(o,v){return o.intersectsMinMax(v.minimumWorld,v.maximumWorld)}static IntersectsSphere(o,v,V,g){const I=Q._TmpVector3[0];E.cv.ClampToRef(V,o,v,I);return E.cv.DistanceSquared(V,I)<=g*g}static IsCompletelyInFrustum(o,v){for(let V=0;V<6;++V){const g=v[V];for(let v=0;v<8;++v)if(g.dotCoordinate(o[v])<0)return!1}return!0}static IsInFrustum(o,v){for(let V=0;V<6;++V){let g=!0;const E=v[V];for(let v=0;v<8;++v)if(E.dotCoordinate(o[v])>=0){g=!1;break}if(g)return!1}return!0}}Q._TmpVector3=(0,g.b)(3,E.cv.Zero)},12852:(o,v,V)=>{V.d(v,{c:()=>x});var g=V(12503),E=V(12488),I=V(12858),Q=V(12865);const U={min:0,max:0},n={min:0,max:0},O=(o,v,V)=>{const g=E.cv.Dot(v.centerWorld,o),I=Math.abs(E.cv.Dot(v.directions[0],o))*v.extendSize.x+Math.abs(E.cv.Dot(v.directions[1],o))*v.extendSize.y+Math.abs(E.cv.Dot(v.directions[2],o))*v.extendSize.z;V.min=g-I,V.max=g+I},h=(o,v,V)=>(O(o,v,U),O(o,V,n),!(U.min>n.max||n.min>U.max));class x{constructor(o,v,V){this._isLocked=!1,this.boundingBox=new I.d(o,v,V),this.boundingSphere=new Q.d(o,v,V)}reConstruct(o,v,V){this.boundingBox.reConstruct(o,v,V),this.boundingSphere.reConstruct(o,v,V)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(o){this._isLocked=o}update(o){this._isLocked||(this.boundingBox._update(o),this.boundingSphere._update(o))}centerOn(o,v){const V=x._TmpVector3[0].U(o).Lx(v),g=x._TmpVector3[1].U(o).addInPlace(v);return this.boundingBox.reConstruct(V,g,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(V,g,this.boundingBox.getWorldMatrix()),this}encapsulate(o){const v=E.cv.Minimize(this.minimum,o),V=E.cv.Maximize(this.maximum,o);return this.reConstruct(v,V,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(o){const v=E.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(v);const V=E.TmpVectors.cv[0];return E.cv.TransformCoordinatesToRef(o.boundingBox.minimumWorld,v,V),this.encapsulate(V),E.cv.TransformCoordinatesToRef(o.boundingBox.maximumWorld,v,V),this.encapsulate(V),this}scale(o){return this.boundingBox.scale(o),this.boundingSphere.scale(o),this}isInFrustum(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===v||3===v)&&this.boundingSphere.isCenterInFrustum(o))return!0;if(!this.boundingSphere.isInFrustum(o))return!1;return!(1!==v&&3!==v)||this.boundingBox.isInFrustum(o)}get diagonalLength(){const o=this.boundingBox;return o.maximumWorld.subtractToRef(o.minimumWorld,x._TmpVector3[0]).length()}isCompletelyInFrustum(o){return this.boundingBox.isCompletelyInFrustum(o)}_checkCollision(o){return o._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(o){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(o)&&!!this.boundingBox.intersectsPoint(o))}intersects(o,v){if(!Q.d.Intersects(this.boundingSphere,o.boundingSphere))return!1;if(!I.d.Intersects(this.boundingBox,o.boundingBox))return!1;if(!v)return!0;const V=this.boundingBox,g=o.boundingBox;return!!h(V.directions[0],V,g)&&(!!h(V.directions[1],V,g)&&(!!h(V.directions[2],V,g)&&(!!h(g.directions[0],V,g)&&(!!h(g.directions[1],V,g)&&(!!h(g.directions[2],V,g)&&(!!h(E.cv.Cross(V.directions[0],g.directions[0]),V,g)&&(!!h(E.cv.Cross(V.directions[0],g.directions[1]),V,g)&&(!!h(E.cv.Cross(V.directions[0],g.directions[2]),V,g)&&(!!h(E.cv.Cross(V.directions[1],g.directions[0]),V,g)&&(!!h(E.cv.Cross(V.directions[1],g.directions[1]),V,g)&&(!!h(E.cv.Cross(V.directions[1],g.directions[2]),V,g)&&(!!h(E.cv.Cross(V.directions[2],g.directions[0]),V,g)&&(!!h(E.cv.Cross(V.directions[2],g.directions[1]),V,g)&&!!h(E.cv.Cross(V.directions[2],g.directions[2]),V,g))))))))))))))}}x._TmpVector3=(0,g.b)(2,E.cv.Zero)},12865:(o,v,V)=>{V.d(v,{d:()=>I});var g=V(12503),E=V(12488);class I{constructor(o,v,V){this.center=E.cv.Zero(),this.centerWorld=E.cv.Zero(),this.minimum=E.cv.Zero(),this.maximum=E.cv.Zero(),this.reConstruct(o,v,V)}reConstruct(o,v,V){this.minimum.U(o),this.maximum.U(v);const g=E.cv.Distance(o,v);v.addToRef(o,this.center).scaleInPlace(.5),this.radius=.5*g,this._update(V||E.Matrix.IdentityReadOnly)}scale(o){const v=this.radius*o,V=I._TmpVector3,g=V[0].tU(v),E=this.center.subtractToRef(g,V[1]),Q=this.center.addToRef(g,V[2]);return this.reConstruct(E,Q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(o){if(o.isIdentity())this.centerWorld.U(this.center),this.radiusWorld=this.radius;else{E.cv.TransformCoordinatesToRef(this.center,o,this.centerWorld);const v=I._TmpVector3[0];E.cv.TransformNormalFromFloatsToRef(1,1,1,o,v),this.radiusWorld=Math.max(Math.abs(v.x),Math.abs(v.y),Math.abs(v.z))*this.radius}}isInFrustum(o){const v=this.centerWorld,V=this.radiusWorld;for(let g=0;g<6;g++)if(o[g].dotCoordinate(v)<=-V)return!1;return!0}isCenterInFrustum(o){const v=this.centerWorld;for(let V=0;V<6;V++)if(o[V].dotCoordinate(v)<0)return!1;return!0}intersectsPoint(o){const v=E.cv.DistanceSquared(this.centerWorld,o);return!(this.radiusWorld*this.radiusWorld<v)}static Intersects(o,v){const V=E.cv.DistanceSquared(o.centerWorld,v.centerWorld),g=o.radiusWorld+v.radiusWorld;return!(g*g<V)}static CreateFromCenterAndRadius(o,v,V){this._TmpVector3[0].U(o),this._TmpVector3[1].RU(0,0,v),this._TmpVector3[2].U(o),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Lx(this._TmpVector3[1]);const g=new I(this._TmpVector3[0],this._TmpVector3[2]);return g._worldMatrix=V||E.Matrix.Identity(),g}}I._TmpVector3=(0,g.b)(3,E.cv.Zero)},12884:(o,v,V)=>{function g(o){-1===o.indexOf("vClipPlane")&&o.push("vClipPlane"),-1===o.indexOf("vClipPlane2")&&o.push("vClipPlane2"),-1===o.indexOf("vClipPlane3")&&o.push("vClipPlane3"),-1===o.indexOf("vClipPlane4")&&o.push("vClipPlane4"),-1===o.indexOf("vClipPlane5")&&o.push("vClipPlane5"),-1===o.indexOf("vClipPlane6")&&o.push("vClipPlane6")}function E(o,v,V){const g=!!(o.clipPlane??v.clipPlane),E=!!(o.clipPlane2??v.clipPlane2),I=!!(o.clipPlane3??v.clipPlane3),Q=!!(o.clipPlane4??v.clipPlane4),U=!!(o.clipPlane5??v.clipPlane5),n=!!(o.clipPlane6??v.clipPlane6);g&&V.push("#define CLIPPLANE"),E&&V.push("#define CLIPPLANE2"),I&&V.push("#define CLIPPLANE3"),Q&&V.push("#define CLIPPLANE4"),U&&V.push("#define CLIPPLANE5"),n&&V.push("#define CLIPPLANE6")}function I(o,v,V){let g=!1;const E=!!(o.clipPlane??v.clipPlane),I=!!(o.clipPlane2??v.clipPlane2),Q=!!(o.clipPlane3??v.clipPlane3),U=!!(o.clipPlane4??v.clipPlane4),n=!!(o.clipPlane5??v.clipPlane5),O=!!(o.clipPlane6??v.clipPlane6);return V.CLIPPLANE!==E&&(V.CLIPPLANE=E,g=!0),V.CLIPPLANE2!==I&&(V.CLIPPLANE2=I,g=!0),V.CLIPPLANE3!==Q&&(V.CLIPPLANE3=Q,g=!0),V.CLIPPLANE4!==U&&(V.CLIPPLANE4=U,g=!0),V.CLIPPLANE5!==n&&(V.CLIPPLANE5=n,g=!0),V.CLIPPLANE6!==O&&(V.CLIPPLANE6=O,g=!0),g}function Q(o,v,V){let g=v.clipPlane??V.clipPlane;U(o,"vClipPlane",g),g=v.clipPlane2??V.clipPlane2,U(o,"vClipPlane2",g),g=v.clipPlane3??V.clipPlane3,U(o,"vClipPlane3",g),g=v.clipPlane4??V.clipPlane4,U(o,"vClipPlane4",g),g=v.clipPlane5??V.clipPlane5,U(o,"vClipPlane5",g),g=v.clipPlane6??V.clipPlane6,U(o,"vClipPlane6",g)}function U(o,v,V){V&&o.setFloat4(v,V.normal.x,V.normal.y,V.normal.z,V.d)}V.d(v,{b:()=>g,c:()=>Q,f:()=>I,g:()=>E})},12817:(o,v,V)=>{V.d(v,{d:()=>g});class g{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(o,v){this._defines[o]||(o<this._currentRank&&(this._currentRank=o),o>this._maxRank&&(this._maxRank=o),this._defines[o]=new Array),this._defines[o].push(v)}addCPUSkinningFallback(o,v){this._mesh=v,o<this._currentRank&&(this._currentRank=o),o>this._maxRank&&(this._maxRank=o)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(o,v){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,o=o.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),v._bonesComputationForcedToCPU=!0;const V=this._mesh.Fo();for(let o=0;o<V.meshes.length;o++){const g=V.meshes[o];if(g.material){if(g.computeBonesUsingShaders&&0!==g.numBoneInfluencers)if(g.material.getEffect()===v)g.computeBonesUsingShaders=!1;else if(g.wg)for(const o of g.wg){if(o.effect===v){g.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&g.computeBonesUsingShaders&&g.numBoneInfluencers>0&&(g.computeBonesUsingShaders=!1)}}else{const v=this._defines[this._currentRank];if(v)for(let V=0;V<v.length;V++)o=o.replace("#define "+v[V],"");this._currentRank++}return o}}},12829:(o,v,V)=>{V.d(v,{e:()=>c});var g=V(12473),E=V(12479),I=V(12291),Q=V(12297),U=V(12339),n=V(12835),O=V(12766),h=V(12308),x=V(12556),f=V(12615),l=V(12535);class S{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(o){this._func=o}get funcRef(){return this._funcRef}set funcRef(o){this._funcRef=o}get funcMask(){return this._funcMask}set funcMask(o){this._funcMask=o}get opStencilFail(){return this._opStencilFail}set opStencilFail(o){this._opStencilFail=o}get opDepthFail(){return this._opDepthFail}set opDepthFail(o){this._opDepthFail=o}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(o){this._opStencilDepthPass=o}get mask(){return this._mask}set mask(o){this._mask=o}get enabled(){return this._enabled}set enabled(o){this._enabled=o}getClassName(){return"MaterialStencilState"}copyTo(o){l.c.Clone((()=>o),this)}serialize(){return l.c.Serialize(this)}parse(o,v,V){l.c.Parse((()=>this),o,v,V)}}(0,g.c)([(0,E.K)()],S.prototype,"func",null),(0,g.c)([(0,E.K)()],S.prototype,"funcRef",null),(0,g.c)([(0,E.K)()],S.prototype,"funcMask",null),(0,g.c)([(0,E.K)()],S.prototype,"opStencilFail",null),(0,g.c)([(0,E.K)()],S.prototype,"opDepthFail",null),(0,g.c)([(0,E.K)()],S.prototype,"opStencilDepthPass",null),(0,g.c)([(0,E.K)()],S.prototype,"mask",null),(0,g.c)([(0,E.K)()],S.prototype,"enabled",null);var T=V(12878);class c{get _supportGlowLayer(){return!1}set _glowModeEnabled(o){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(o){if(this._alpha===o)return;const v=this._alpha;this._alpha=o,1!==v&&1!==o||this.eO(c.MiscDirtyFlag+c.PrePassDirtyFlag)}get alpha(){return this._alpha}set cU(o){this._backFaceCulling!==o&&(this._backFaceCulling=o,this.eO(c.TextureDirtyFlag))}get cU(){return this._backFaceCulling}set cullBackFaces(o){this._cullBackFaces!==o&&(this._cullBackFaces=o,this.eO(c.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(o){this._blockDirtyMechanism!==o&&(this._blockDirtyMechanism=o,o||this.ml())}atomicMaterialsUpdate(o){this.blockDirtyMechanism=!0;try{o(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(o){this._onDisposeObserver&&this.Tg.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tg.add(o)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Q.e),this._onBindObservable}set onBind(o){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(o)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Q.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Q.e),this._onEffectCreatedObservable}set alphaMode(o){this._alphaMode!==o&&(this._alphaMode=o,this.eO(c.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(o){this._needDepthPrePass!==o&&(this._needDepthPrePass=o,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(o){this._fogEnabled!==o&&(this._fogEnabled=o,this.eO(c.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(o){this.fillMode=o?c.WireFrameFillMode:c.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(o){this.fillMode=o?c.PointFillMode:c.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(o){this._fillMode!==o&&(this._fillMode=o,this.eO(c.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(o){const v=this.Fo().getEngine().getCaps().fragmentDepthSupported;o&&!v&&h.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=o&&v,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(o){this._drawWrapper=o}constructor(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Tg=new Q.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Rg=new S,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=o;const E=v||U.d.LastCreatedScene;E&&(this._scene=E,this._dirtyCallbacks={},this._forceGLSL=g,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=o||I.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new f.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new O.e(this._scene.getEngine(),void 0,void 0,o),this._useUBO=this.Fo().getEngine().supportsUniformBuffers,this._createUniformBuffer(),V||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),c.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var o;const v=this.Fo().getEngine();null===(o=this._uniformBuffer)||void 0===o||o.dispose(),v.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new O.e(v,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new O.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(o){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.ml(),this.checkReadyOnlyOnce=!0}unfreeze(){this.ml(),this.checkReadyOnlyOnce=!1}isReady(o,v){return!0}isReadyForSubMesh(o,v,V){const g=v.materialDefines;return!!g&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=g,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Fo(){return this._scene}_getEffectiveOrientation(o){return null!==this.sideOrientation?this.sideOrientation:o.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(o){this._transparencyMode!==o&&(this._transparencyMode=o,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===c.MATERIAL_ALPHABLEND||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===c.MATERIAL_ALPHATEST||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===c.MATERIAL_OPAQUE||this._transparencyMode===c.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(o){return this._hasTransparencyMode?this._transparencyModeIsBlend:o.visibility<1||!this._disableAlphaBlending&&(o.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(o){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(o)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}ml(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this.Fo().meshes;for(const V of v)if(V.wg)for(const v of V.wg)if(v.yo()===this)for(const V of v._drawWrappers)V&&this._materialContext===V.materialContext&&(V._wasPreviouslyReady=!1,V._wasPreviouslyUsingInstances=null,V._forceRebindOnNextCall=o);o&&this.eO(c.AllDirtyFlag)}_preBind(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this._scene.getEngine(),g=(null==v?this.sideOrientation:v)===c.ClockWiseSideOrientation;return V.enableEffect(o||this._getDrawWrapper()),V.setState(this.cU,this.zOffset,!1,g,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Rg,this.zOffsetUnits),g}bind(o,v){}buildUniformLayout(){const o=this._uniformBuffer;this._eventInfo.ubo=o,this._callbackPluginEventGeneric(8,this._eventInfo),o.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(o,v,V){const g=V._drawWrapper;this._eventInfo.subMesh=V,this._callbackPluginEventBindForSubMesh(this._eventInfo),g._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(o){}bindView(o){this._useUBO?this._needToBindSceneUbo=!0:o.setMatrix("view",this.Fo().getViewMatrix())}bindViewProjection(o){this._useUBO?this._needToBindSceneUbo=!0:(o.setMatrix("viewProjection",this.Fo().getTransformMatrix()),o.setMatrix("projection",this.Fo().getProjectionMatrix()))}bindEyePosition(o,v){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(o,v)}_afterBind(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&v&&(this._needToBindSceneUbo=!1,(0,T.l)(v,this.Fo().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=o?o.visibility:1,this._onBindObservable&&o&&this._onBindObservable.notifyObservers(o),this.disableDepthWrite){const o=this._scene.getEngine();this._cachedDepthWriteState=o.getDepthWrite(),o.setDepthWrite(!1)}if(this.disableColorWrite){const o=this._scene.getEngine();this._cachedColorWriteState=o.getColorWrite(),o.setColorWrite(!1)}if(0!==this.depthFunction){const o=this._scene.getEngine();this._cachedDepthFunctionState=o.getDepthFunction()||0,o.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(o){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=o,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(o){return null}_clonePlugins(o,v){const V={};if(this._serializePlugins(V),c._ParsePlugins(V,o,this._scene,v),this.pluginManager)for(const g of this.pluginManager._plugins){const v=o.pluginManager.getPlugin(g.name);v&&g.copyTo(v)}}getBindedMeshes(){if(this.meshMap){const o=[];for(const v in this.meshMap){const V=this.meshMap[v];V&&o.push(V)}return o}return this._scene.meshes.filter((o=>o.material===this))}forceCompilation(o,v,V,g){const E={clipPlane:!1,useInstances:!1,...V},I=this.Fo(),Q=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const U=()=>{if(!this._scene||!this._scene.getEngine())return;const V=I.clipPlane;if(E.clipPlane&&(I.clipPlane=new x.c(0,0,0,1)),this._storeEffectOnSubMeshes){let V=!0,I=null;if(o.wg){const v=new n.b(0,0,0,0,0,o,void 0,!1,!1);v.materialDefines&&(v.materialDefines._renderId=-1),this.isReadyForSubMesh(o,v,E.useInstances)||(v.effect&&v.effect.getCompilationError()&&v.effect.allFallbacksProcessed()?I=v.effect.getCompilationError():(V=!1,setTimeout(U,16)))}V&&(this.allowShaderHotSwapping=Q,I&&g&&g(I),v&&v(this))}else this.isReady()?(this.allowShaderHotSwapping=Q,v&&v(this)):setTimeout(U,16);E.clipPlane&&(I.clipPlane=V)};U()}async forceCompilationAsync(o,v){return await new Promise(((V,g)=>{this.forceCompilation(o,(()=>{V()}),v,(o=>{g(o)}))}))}eO(o){this.Fo().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(c._DirtyCallbackArray.length=0,o&c.ImageProcessingDirtyFlag&&c._DirtyCallbackArray.push(c._ImageProcessingDirtyCallBack),o&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),o&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),o&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),o&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),o&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),o&c.PrePassDirtyFlag&&c._DirtyCallbackArray.push(c._PrePassDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.Fo().resetCachedMaterial())}resetDrawCache(){const o=this.Fo().meshes;for(const v of o)if(v.wg)for(const o of v.wg)o.yo()===this&&o.resetDrawCache()}_markAllSubMeshesAsDirty(o){const v=this.Fo();if(v.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const V=v.meshes;for(const g of V)if(g.wg)for(const V of g.wg){if((V.yo()||(v._hasDefaultMaterial?v.defaultMaterial:null))===this)for(const v of V._drawWrappers)v&&v.defines&&v.defines.markAllAsDirty&&this._materialContext===v.materialContext&&o(v.defines)}}_markScenePrePassDirty(){if(this.Fo().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const o=this.Fo().enablePrePassRenderer();o&&o.eO()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(c._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const o=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Tg.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(o)}))}}setPrePassRenderer(o){return!1}dispose(o,v,V){const g=this.Fo();if(g.stopAnimation(this),g.freeProcessedMaterials(),g.removeMaterial(this),this._eventInfo.forceDisposeTextures=v,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const o=this._parentContainer.materials.indexOf(this);o>-1&&this._parentContainer.materials.splice(o,1),this._parentContainer=null}if(!0!==V)if(this.meshMap)for(const E in this.meshMap){const o=this.meshMap[E];this._disposeMeshResources(o)}else{const o=g.meshes;for(const v of o)this._disposeMeshResources(v)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Tg.notifyObservers(this),this.Tg.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(o){if(!o)return;const v=o.kg,V=o._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(o.wg&&V)for(const E of o.wg){const o=E._drawWrappers;for(let I=0;I<o.length;I++){var g;const Q=null===(g=o[I])||void 0===g?void 0:g.effect;if(!Q)continue;V[I]===this&&(null===v||void 0===v||v._releaseVertexArrayObject(Q),E._removeDrawWrapper(I,!0,!0))}}}else null===v||void 0===v||v._releaseVertexArrayObject(this._drawWrapper.effect);o.material!==this||o.sourceMesh||(o.material=null)}serialize(){const o=l.c.Serialize(this);return o.Rg=this.Rg.serialize(),o.uniqueId=this.uniqueId,this._serializePlugins(o),o}_serializePlugins(o){if(o.plugins={},this.pluginManager)for(const v of this.pluginManager._plugins)v.doNotSerialize||(o.plugins[v.getClassName()]=v.serialize())}static Parse(o,v,V){if(o.customType){if("BABYLON.PBRMaterial"===o.customType&&o.overloadedAlbedo&&(o.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else o.customType="BABYLON.StandardMaterial";const g=I.Tools.Instantiate(o.customType).Parse(o,v,V);return g._loadedUniqueId=o.uniqueId,g}static _ParsePlugins(o,v,V,g){if(o.plugins)for(const U in o.plugins){var E,Q;const n=o.plugins[U];let O=null===(E=v.pluginManager)||void 0===E?void 0:E.getPlugin(n.name);if(!O){const o=I.Tools.Instantiate("BABYLON."+U);o&&(O=new o(v))}null===(Q=O)||void 0===Q||Q.parse(n,V,g)}}}c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.ImageProcessingDirtyFlag=64,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.PrePassDirtyFlag=32,c.AllDirtyFlag=127,c.MATERIAL_OPAQUE=0,c.MATERIAL_ALPHATEST=1,c.MATERIAL_ALPHABLEND=2,c.MATERIAL_ALPHATESTANDBLEND=3,c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,c.MATERIAL_NORMALBLENDMETHOD_RNM=1,c.OnEventObservable=new Q.e,c._AllDirtyCallBack=o=>o.markAllAsDirty(),c._ImageProcessingDirtyCallBack=o=>o.markAsImageProcessingDirty(),c._TextureDirtyCallBack=o=>o.markAsTexturesDirty(),c._FresnelDirtyCallBack=o=>o.markAsFresnelDirty(),c._MiscDirtyCallBack=o=>o.markAsMiscDirty(),c._PrePassDirtyCallBack=o=>o.markAsPrePassDirty(),c._LightsDirtyCallBack=o=>o.markAsLightDirty(),c._AttributeDirtyCallBack=o=>o.markAsAttributesDirty(),c._FresnelAndMiscDirtyCallBack=o=>{c._FresnelDirtyCallBack(o),c._MiscDirtyCallBack(o)},c._TextureAndMiscDirtyCallBack=o=>{c._TextureDirtyCallBack(o),c._MiscDirtyCallBack(o)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=o=>{for(const v of c._DirtyCallbackArray)v(o)},(0,g.c)([(0,E.K)()],c.prototype,"id",void 0),(0,g.c)([(0,E.K)()],c.prototype,"uniqueId",void 0),(0,g.c)([(0,E.K)()],c.prototype,"name",void 0),(0,g.c)([(0,E.K)()],c.prototype,"metadata",void 0),(0,g.c)([(0,E.K)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,g.c)([(0,E.K)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,g.c)([(0,E.K)()],c.prototype,"state",void 0),(0,g.c)([(0,E.K)("alpha")],c.prototype,"_alpha",void 0),(0,g.c)([(0,E.K)("cU")],c.prototype,"_backFaceCulling",void 0),(0,g.c)([(0,E.K)("cullBackFaces")],c.prototype,"_cullBackFaces",void 0),(0,g.c)([(0,E.K)()],c.prototype,"sideOrientation",void 0),(0,g.c)([(0,E.K)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,g.c)([(0,E.K)()],c.prototype,"_needDepthPrePass",void 0),(0,g.c)([(0,E.K)()],c.prototype,"disableDepthWrite",void 0),(0,g.c)([(0,E.K)()],c.prototype,"disableColorWrite",void 0),(0,g.c)([(0,E.K)()],c.prototype,"forceDepthWrite",void 0),(0,g.c)([(0,E.K)()],c.prototype,"depthFunction",void 0),(0,g.c)([(0,E.K)()],c.prototype,"separateCullingPass",void 0),(0,g.c)([(0,E.K)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,g.c)([(0,E.K)()],c.prototype,"pointSize",void 0),(0,g.c)([(0,E.K)()],c.prototype,"zOffset",void 0),(0,g.c)([(0,E.K)()],c.prototype,"zOffsetUnits",void 0),(0,g.c)([(0,E.K)()],c.prototype,"pointsCloud",null),(0,g.c)([(0,E.K)()],c.prototype,"fillMode",null),(0,g.c)([(0,E.K)()],c.prototype,"useLogarithmicDepth",null),(0,g.c)([(0,E.K)()],c.prototype,"transparencyMode",null)},12878:(o,v,V)=>{V.d(v,{$:()=>W,C:()=>l,G:()=>f,I:()=>N,K:()=>d,N:()=>i,R:()=>R,U:()=>F,V:()=>Y,W:()=>q,X:()=>P,ab:()=>S,c:()=>s,e:()=>x,h:()=>b,j:()=>h,k:()=>T,l:()=>c,o:()=>j,q:()=>a,s:()=>t,w:()=>u,z:()=>mo});var g=V(12308),E=V(12547),I=V(12339),Q=V(12808),U=V(12884);const n=E.Lv.Black(),O={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function h(o,v,V){if(!o||o.LOGARITHMICDEPTH||o.indexOf&&o.indexOf("LOGARITHMICDEPTH")>=0){const o=V.activeCamera;1===o.mode&&g.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),v.setFloat("logarithmicDepthConstant",2/(Math.log(o.maxZ+1)/Math.LN2))}}function x(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];V&&o.fogEnabled&&(!v||v.applyFog)&&0!==o.fogMode&&(V.setFloat4("vFogInfos",o.fogMode,o.fogStart,o.fogEnd,o.fogDensity),g?(o.fogColor.toLinearSpaceToRef(n,o.getEngine().useExactSrgbConversions),V.setColor3("vFogColor",n)):V.setColor3("vFogColor",o.fogColor))}function f(o,v,V,g,E,I,Q,U,n,h){const x=o.numMaxInfluencers||o.numInfluencers;return x<=0?0:(v.push("#define MORPHTARGETS"),o.hasPositions&&v.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),o.hasNormals&&v.push("#define MORPHTARGETTEXTURE_HASNORMALS"),o.hasTangents&&v.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),o.hasUVs&&v.push("#define MORPHTARGETTEXTURE_HASUVS"),o.hasUV2s&&v.push("#define MORPHTARGETTEXTURE_HASUV2S"),o.hasColors&&v.push("#define MORPHTARGETTEXTURE_HASCOLORS"),o.supportsPositions&&E&&v.push("#define MORPHTARGETS_POSITION"),o.supportsNormals&&I&&v.push("#define MORPHTARGETS_NORMAL"),o.supportsTangents&&Q&&v.push("#define MORPHTARGETS_TANGENT"),o.supportsUVs&&U&&v.push("#define MORPHTARGETS_UV"),o.supportsUV2s&&n&&v.push("#define MORPHTARGETS_UV2"),o.supportsColors&&h&&v.push("#define MORPHTARGETS_COLOR"),v.push("#define NUM_MORPH_INFLUENCERS "+x),o.isUsingTextureForTargets&&v.push("#define MORPHTARGETS_TEXTURE"),O.NUM_MORPH_INFLUENCERS=x,O.NORMAL=I,O.TANGENT=Q,O.UV=U,O.UV2=n,O.COLOR=h,l(V,g,O,E),x)}function l(o,v,V){let E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=V.NUM_MORPH_INFLUENCERS;if(Q>0&&I.d.LastCreatedEngine){const U=I.d.LastCreatedEngine.getCaps().maxVertexAttribs,n=v.morphTargetManager;if(null!==n&&void 0!==n&&n.isUsingTextureForTargets)return;const O=n&&n.supportsPositions&&E,h=n&&n.supportsNormals&&V.NORMAL,x=n&&n.supportsTangents&&V.TANGENT,f=n&&n.supportsUVs&&V.UV1,l=n&&n.supportsUV2s&&V.UV2,S=n&&n.supportsColors&&V.VERTEXCOLOR;for(let V=0;V<Q;V++)O&&o.push("position"+V),h&&o.push("normal"+V),x&&o.push("tangent"+V),f&&o.push("uv_"+V),l&&o.push("uv2_"+V),S&&o.push("color"+V),o.length>U&&g.b.Error("Cannot add more vertex attributes for mesh "+v.name)}}function S(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"),v&&(o.push("previousWorld0"),o.push("previousWorld1"),o.push("previousWorld2"),o.push("previousWorld3"))}function T(o,v){const V=o.morphTargetManager;o&&V&&v.setFloatArray("morphTargetInfluences",V.influences)}function c(o,v){v.bindToEffect(o,"Scene")}function R(o,v,V){v._needUVs=!0,v[V]=!0,o.optimizeUVAllocation&&o.getTextureMatrix().isIdentityAs3x2()?(v[V+"DIRECTUV"]=o.coordinatesIndex+1,v["MAINUV"+(o.coordinatesIndex+1)]=!0):v[V+"DIRECTUV"]=0}function j(o,v,V){const g=o.getTextureMatrix();v.Bg(V+"Matrix",g)}function t(o,v,V){V.BAKED_VERTEX_ANIMATION_TEXTURE&&V.INSTANCES&&o.push("bakedVertexAnimationSettingsInstanced")}function s(o,v,V){var g;if(v&&o&&(o.computeBonesUsingShaders&&v._bonesComputationForcedToCPU&&(o.computeBonesUsingShaders=!1),o.useBones&&o.computeBonesUsingShaders&&o.skeleton)){const E=o.skeleton;if(E.isUsingTextureForMatrices&&v.getUniformIndex("boneTextureWidth")>-1){const V=E.getTransformMatrixTexture(o);v.setTexture("boneSampler",V),v.setFloat("boneTextureWidth",4*(E.bones.length+1))}else{const I=E.getTransformMatrices(o);I&&(v.setMatrices("mBones",I),V&&o.Fo().prePassRenderer&&o.Fo().prePassRenderer.getIndex(2)&&(V.previousBones[o.uniqueId]||(V.previousBones[o.uniqueId]=I.slice()),v.setMatrices("mPreviousBones",V.previousBones[o.uniqueId]),g=I,V.previousBones[o.uniqueId].set(g)))}}}function L(o,v,V,g,E){let I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];o._bindLight(v,V,g,E,I)}function b(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const I=Math.min(v.lightSources.length,E);for(let Q=0;Q<I;Q++){L(v.lightSources[Q],Q,o,V,"boolean"===typeof g?g:g.SPECULARTERM,v.receiveShadows)}}function u(o,v,V,g){V.NUM_BONE_INFLUENCERS>0&&(g.addCPUSkinningFallback(0,v),o.push("matricesIndices"),o.push("matricesWeights"),V.NUM_BONE_INFLUENCERS>4&&(o.push("matricesIndicesExtra"),o.push("matricesWeightsExtra")))}function mo(o,v){(v.INSTANCES||v.THIN_INSTANCES)&&S(o,!!v.PREPASS_VELOCITY),v.INSTANCESCOLOR&&o.push("instanceColor")}function a(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=0;for(let I=0;I<V&&o["LIGHT"+I];I++)I>0&&(E=g+I,v.addFallback(E,"LIGHT"+I)),o.SHADOWS||(o["SHADOW"+I]&&v.addFallback(g,"SHADOW"+I),o["SHADOWPCF"+I]&&v.addFallback(g,"SHADOWPCF"+I),o["SHADOWPCSS"+I]&&v.addFallback(g,"SHADOWPCSS"+I),o["SHADOWPOISSON"+I]&&v.addFallback(g,"SHADOWPOISSON"+I),o["SHADOWESM"+I]&&v.addFallback(g,"SHADOWESM"+I),o["SHADOWCLOSEESM"+I]&&v.addFallback(g,"SHADOWCLOSEESM"+I));return E++}function F(o,v,V,g,E,I,Q){let U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Q._areMiscDirty&&(Q.LOGARITHMICDEPTH=V,Q.POINTSIZE=g,Q.FOG=E&&function(o,v){return v.fogEnabled&&o.applyFog&&0!==v.fogMode}(o,v),Q.NONUNIFORMSCALING=o.nonUniformScaling,Q.ALPHATEST=I,Q.DECAL_AFTER_DETAIL=U)}function i(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V._areLightsDirty)return V._needNormals;let Q=0;const U={needNormals:V._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(o.lightsEnabled&&!I)for(const O of v.lightSources)if(J(o,v,O,Q,V,g,U),Q++,Q===E)break;V.SPECULARTERM=U.specularEnabled,V.SHADOWS=U.shadowEnabled;for(let O=Q;O<E;O++)void 0!==V["LIGHT"+O]&&(V["LIGHT"+O]=!1,V["HEMILIGHT"+O]=!1,V["POINTLIGHT"+O]=!1,V["DIRLIGHT"+O]=!1,V["SPOTLIGHT"+O]=!1,V["AREALIGHT"+O]=!1,V["SHADOW"+O]=!1,V["SHADOWCSM"+O]=!1,V["SHADOWCSMDEBUG"+O]=!1,V["SHADOWCSMNUM_CASCADES"+O]=!1,V["SHADOWCSMUSESHADOWMAXZ"+O]=!1,V["SHADOWCSMNOBLEND"+O]=!1,V["SHADOWCSM_RIGHTHANDED"+O]=!1,V["SHADOWPCF"+O]=!1,V["SHADOWPCSS"+O]=!1,V["SHADOWPOISSON"+O]=!1,V["SHADOWESM"+O]=!1,V["SHADOWCLOSEESM"+O]=!1,V["SHADOWCUBE"+O]=!1,V["SHADOWLOWQUALITY"+O]=!1,V["SHADOWMEDIUMQUALITY"+O]=!1);const n=o.getEngine().getCaps();return void 0===V.SHADOWFLOAT&&(U.needRebuild=!0),V.SHADOWFLOAT=U.shadowEnabled&&(n.textureFloatRender&&n.textureFloatLinearFiltering||n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering),V.LIGHTMAPEXCLUDED=U.lightmapMode,U.needRebuild&&V.rebuild(),U.needNormals}function J(o,v,V,g,E,I,U){switch(U.needNormals=!0,void 0===E["LIGHT"+g]&&(U.needRebuild=!0),E["LIGHT"+g]=!0,E["SPOTLIGHT"+g]=!1,E["HEMILIGHT"+g]=!1,E["POINTLIGHT"+g]=!1,E["DIRLIGHT"+g]=!1,E["AREALIGHT"+g]=!1,V.prepareLightSpecificDefines(E,g),E["LIGHT_FALLOFF_PHYSICAL"+g]=!1,E["LIGHT_FALLOFF_GLTF"+g]=!1,E["LIGHT_FALLOFF_STANDARD"+g]=!1,V.falloffType){case Q.b.FALLOFF_GLTF:E["LIGHT_FALLOFF_GLTF"+g]=!0;break;case Q.b.FALLOFF_PHYSICAL:E["LIGHT_FALLOFF_PHYSICAL"+g]=!0;break;case Q.b.FALLOFF_STANDARD:E["LIGHT_FALLOFF_STANDARD"+g]=!0}if(I&&!V.th.equalsFloats(0,0,0)&&(U.specularEnabled=!0),E["SHADOW"+g]=!1,E["SHADOWCSM"+g]=!1,E["SHADOWCSMDEBUG"+g]=!1,E["SHADOWCSMNUM_CASCADES"+g]=!1,E["SHADOWCSMUSESHADOWMAXZ"+g]=!1,E["SHADOWCSMNOBLEND"+g]=!1,E["SHADOWCSM_RIGHTHANDED"+g]=!1,E["SHADOWPCF"+g]=!1,E["SHADOWPCSS"+g]=!1,E["SHADOWPOISSON"+g]=!1,E["SHADOWESM"+g]=!1,E["SHADOWCLOSEESM"+g]=!1,E["SHADOWCUBE"+g]=!1,E["SHADOWLOWQUALITY"+g]=!1,E["SHADOWMEDIUMQUALITY"+g]=!1,v&&v.receiveShadows&&o.shadowsEnabled&&V.shadowEnabled){const v=V.getShadowGenerator(o.activeCamera)??V.getShadowGenerator();if(v){const o=v.getShadowMap();o&&o.renderList&&o.renderList.length>0&&(U.shadowEnabled=!0,v.prepareDefines(E,g))}}V.lightmapMode!=Q.b.LIGHTMAP_DEFAULT?(U.lightmapMode=!0,E["LIGHTMAPEXCLUDED"+g]=!0,E["LIGHTMAPNOSPECULAR"+g]=V.lightmapMode==Q.b.LIGHTMAP_SHADOWSONLY):(E["LIGHTMAPEXCLUDED"+g]=!1,E["LIGHTMAPNOSPECULAR"+g]=!1)}function d(o,v,V,g,E){let I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=function(o,v){let V=!1;if(o.activeCamera){const g=v.CAMERA_ORTHOGRAPHIC?1:0,E=v.CAMERA_PERSPECTIVE?1:0,I=1===o.activeCamera.mode?1:0,Q=0===o.activeCamera.mode?1:0;(g^I||E^Q)&&(v.CAMERA_ORTHOGRAPHIC=1===I,v.CAMERA_PERSPECTIVE=1===Q,V=!0)}return V}(o,g);!1!==I&&(n=(0,U.f)(V,o,g)),g.DEPTHPREPASS!==!v.getColorWrite()&&(g.DEPTHPREPASS=!g.DEPTHPREPASS,n=!0),g.INSTANCES!==E&&(g.INSTANCES=E,n=!0),g.THIN_INSTANCES!==Q&&(g.THIN_INSTANCES=Q,n=!0),n&&g.markAsUnprocessed()}function N(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!v._areAttributesDirty&&v._needNormals===v._normals&&v._needUVs===v._uvs)return!1;v._normals=v._needNormals,v._uvs=v._needUVs,v.NORMAL=v._needNormals&&o.isVerticesDataPresent("normal"),v._needNormals&&o.isVerticesDataPresent("tangent")&&(v.TANGENT=!0);for(let U=1;U<=6;++U)v["UV"+U]=!!v._needUVs&&o.isVerticesDataPresent(`uv${1===U?"":U}`);if(V){const V=o.useVertexColors&&o.isVerticesDataPresent("color");v.VERTEXCOLOR=V,v.VERTEXALPHA=o.hasVertexAlpha&&V&&I}return o.isVerticesDataPresent("instanceColor")&&(o.hasInstances||o.hasThinInstances)&&(v.INSTANCESCOLOR=!0),g&&function(o,v){if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){v.NUM_BONE_INFLUENCERS=o.numBoneInfluencers;const V=void 0!==v.BONETEXTURE;if(o.skeleton.isUsingTextureForMatrices&&V)v.BONETEXTURE=!0;else{v.BonesPerMesh=o.skeleton.bones.length+1,v.BONETEXTURE=!V&&void 0;const g=o.Fo().prePassRenderer;if(g&&g.enabled){const V=-1===g.excludedSkinnedMesh.indexOf(o);v.BONES_VELOCITY_ENABLED=V}}}else v.NUM_BONE_INFLUENCERS=0,v.BonesPerMesh=0,void 0!==v.BONETEXTURE&&(v.BONETEXTURE=!1)}(o,v),E&&function(o,v){const V=o.morphTargetManager;V?(v.MORPHTARGETS_UV=V.supportsUVs&&v.UV1,v.MORPHTARGETS_UV2=V.supportsUV2s&&v.UV2,v.MORPHTARGETS_TANGENT=V.supportsTangents&&v.TANGENT,v.MORPHTARGETS_NORMAL=V.supportsNormals&&v.NORMAL,v.MORPHTARGETS_POSITION=V.supportsPositions,v.MORPHTARGETS_COLOR=V.supportsColors,v.MORPHTARGETTEXTURE_HASUVS=V.hasUVs,v.MORPHTARGETTEXTURE_HASUV2S=V.hasUV2s,v.MORPHTARGETTEXTURE_HASTANGENTS=V.hasTangents,v.MORPHTARGETTEXTURE_HASNORMALS=V.hasNormals,v.MORPHTARGETTEXTURE_HASPOSITIONS=V.hasPositions,v.MORPHTARGETTEXTURE_HASCOLORS=V.hasColors,v.NUM_MORPH_INFLUENCERS=V.numMaxInfluencers||V.numInfluencers,v.MORPHTARGETS=v.NUM_MORPH_INFLUENCERS>0,v.MORPHTARGETS_TEXTURE=V.isUsingTextureForTargets):(v.MORPHTARGETS_UV=!1,v.MORPHTARGETS_UV2=!1,v.MORPHTARGETS_TANGENT=!1,v.MORPHTARGETS_NORMAL=!1,v.MORPHTARGETS_POSITION=!1,v.MORPHTARGETS_COLOR=!1,v.MORPHTARGETTEXTURE_HASUVS=!1,v.MORPHTARGETTEXTURE_HASUV2S=!1,v.MORPHTARGETTEXTURE_HASTANGENTS=!1,v.MORPHTARGETTEXTURE_HASNORMALS=!1,v.MORPHTARGETTEXTURE_HASPOSITIONS=!1,v.MORPHTARGETTEXTURE_HAS_COLORS=!1,v.MORPHTARGETS=!1,v.NUM_MORPH_INFLUENCERS=0)}(o,v),Q&&function(o,v){const V=o.bakedVertexAnimationManager;v.BAKED_VERTEX_ANIMATION_TEXTURE=!(!V||!V.isEnabled)}(o,v),!0}function Y(o,v){if(o.activeCamera){const V=v.MULTIVIEW;v.MULTIVIEW=null!==o.activeCamera.outputRenderTarget&&o.activeCamera.outputRenderTarget.getViewCount()>1,v.MULTIVIEW!=V&&v.markAsUnprocessed()}}function q(o,v,V){const g=v.ORDER_INDEPENDENT_TRANSPARENCY,E=v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;v.ORDER_INDEPENDENT_TRANSPARENCY=o.useOrderIndependentTransparency&&V,v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!o.getEngine().getCaps().textureFloatLinearFiltering,g===v.ORDER_INDEPENDENT_TRANSPARENCY&&E===v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||v.markAsUnprocessed()}function P(o,v,V){const g=v.PREPASS;if(!v._arePrePassDirty)return;const E=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(o.prePassRenderer&&o.prePassRenderer.enabled&&V){v.PREPASS=!0,v.SCENE_MRT_COUNT=o.prePassRenderer.mrtCount,v.PREPASS_NORMAL_WORLDSPACE=o.prePassRenderer.generateNormalsInWorldSpace,v.PREPASS_COLOR=!0,v.PREPASS_COLOR_INDEX=0;for(let V=0;V<E.length;V++){const g=o.prePassRenderer.getIndex(E[V].type);-1!==g?(v[E[V].define]=!0,v[E[V].index]=g):v[E[V].define]=!1}}else{v.PREPASS=!1;for(let o=0;o<E.length;o++)v[E[o].define]=!1}v.PREPASS!=g&&(v.markAsUnprocessed(),v.markAsImageProcessingDirty())}function M(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];E&&E.push("Light"+o),I||(v.push("vLightData"+o,"vLightDiffuse"+o,"vLightSpecular"+o,"vLightDirection"+o,"vLightWidth"+o,"vLightHeight"+o,"vLightFalloff"+o,"vLightGround"+o,"lightMatrix"+o,"shadowsInfo"+o,"depthValues"+o),V.push("shadowTexture"+o),V.push("depthTexture"+o),v.push("viewFrustumZ"+o,"cascadeBlendFactor"+o,"lightSizeUVCorrection"+o,"depthCorrection"+o,"penumbraDarkness"+o,"frustumLengths"+o),g&&(V.push("projectionLightTexture"+o),v.push("textureProjectionMatrix"+o)),Q&&V.push("iesLightTexture"+o))}function W(o,v,V){let g,E,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(o.uniformsNames){const Q=o;g=Q.uniformsNames,E=Q.uniformBuffersNames,v=Q.samplers,V=Q.defines,I=Q.maxSimultaneousLights||0}else g=o,v||(v=[]);for(let Q=0;Q<I&&V["LIGHT"+Q];Q++)M(Q,g,v,V["PROJECTEDLIGHTTEXTURE"+Q],E,!1,V["IESLIGHTTEXTURE"+Q]);V.NUM_MORPH_INFLUENCERS&&(g.push("morphTargetInfluences"),g.push("morphTargetCount")),V.BAKED_VERTEX_ANIMATION_TEXTURE&&(g.push("bakedVertexAnimationSettings"),g.push("bakedVertexAnimationTextureSizeInverted"),g.push("bakedVertexAnimationTime"),v.push("bakedVertexAnimationTexture"))}},12825:(o,v,V)=>{V.d(v,{c:()=>I});var g=V(12488),E=V(12829);class I extends E.e{constructor(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(o,v,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new g.Matrix,this._storeEffectOnSubMeshes=V}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(o,v){return!!o&&(!this._storeEffectOnSubMeshes||(!o.wg||0===o.wg.length||this.isReadyForSubMesh(o,o.wg[0],v)))}_isReadyForSubMesh(o){const v=o.materialDefines;return!(this.checkReadyOnEveryCall||!o.effect||!v||v._renderId!==this.Fo().getRenderId())}bindOnlyWorldMatrix(o){this._activeEffect.setMatrix("world",o)}bindOnlyNormalMatrix(o){this._activeEffect.setMatrix("normalMatrix",o)}bind(o,v){v&&this.bindForSubMesh(o,v,v.wg[0])}_afterBind(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;super._afterBind(o,v,V),this.Fo()._cachedEffect=v,V?V._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return V._drawWrapper._forceRebindOnNextCall||o.isCachedMaterialInvalid(this,v,g)}dispose(o,v,V){this._activeEffect=void 0,super.dispose(o,v,V)}}},12870:(o,v,V)=>{V.d(v,{b:()=>U,c:()=>n});var g=V(12473),E=V(12488),I=V(12479);class Q{static extractMinAndMaxIndexed(o,v,V,g,E,I){for(let Q=V;Q<V+g;Q++){const V=3*v[Q],g=o[V],U=o[V+1],n=o[V+2];E.minimizeInPlaceFromFloats(g,U,n),I.maximizeInPlaceFromFloats(g,U,n)}}static extractMinAndMax(o,v,V,g,E,I){for(let Q=v,U=v*g;Q<v+V;Q++,U+=g){const v=o[U],V=o[U+1],g=o[U+2];E.minimizeInPlaceFromFloats(v,V,g),I.maximizeInPlaceFromFloats(v,V,g)}}}function U(o,v,V,g){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const U=new E.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new E.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Q.extractMinAndMaxIndexed(o,v,V,g,U,n),I&&(U.x-=U.x*I.x+I.y,U.y-=U.y*I.x+I.y,U.z-=U.z*I.x+I.y,n.x+=n.x*I.x+I.y,n.y+=n.y*I.x+I.y,n.z+=n.z*I.x+I.y),{minimum:U,maximum:n}}function n(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4?arguments[4]:void 0;const U=new E.cv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new E.cv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return I||(I=3),Q.extractMinAndMax(o,v,V,I,U,n),g&&(U.x-=U.x*g.x+g.y,U.y-=U.y*g.x+g.y,U.z-=U.z*g.x+g.y,n.x+=n.x*g.x+g.y,n.y+=n.y*g.x+g.y,n.z+=n.z*g.x+g.y),{minimum:U,maximum:n}}(0,g.c)([I.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g,E]=v;return!Array.isArray(g)&&!Array.isArray(E)}))],Q,"extractMinAndMaxIndexed",null),(0,g.c)([I.g.filter((function(){for(var o=arguments.length,v=new Array(o),V=0;V<o;V++)v[V]=arguments[V];let[g]=v;return!Array.isArray(g)}))],Q,"extractMinAndMax",null)},12835:(o,v,V)=>{V.d(v,{b:()=>n});var g=V(12577),E=V(12844),I=V(12852),Q=V(12870),U=V(12615);class n{get materialDefines(){var o;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(o=this._getDrawWrapper())||void 0===o?void 0:o.defines}set materialDefines(o){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=o}_getDrawWrapper(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o=o??this._engine.currentRenderPassId;let V=this._drawWrappers[o];return!V&&v&&(this._drawWrappers[o]=V=new U.c(this._mesh.Fo().getEngine())),V}_removeDrawWrapper(o){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var V;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(V=this._drawWrappers[o])||void 0===V||V.dispose(v));this._drawWrappers[o]=void 0}get effect(){var o;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(o=this._getDrawWrapper())||void 0===o?void 0:o.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(o){this._mainDrawWrapperOverride=o}setEffect(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this._drawWrapper;E.setEffect(o,v,g),void 0!==V&&(E.materialContext=V),o||(E.defines=null,E.materialContext=void 0)}resetDrawCache(o){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==o)return void this._removeDrawWrapper(o,!0,v);for(const o of this._drawWrappers)null===o||void 0===o||o.dispose(v)}this._drawWrappers=[]}static AddToMesh(o,v,V,g,E,I,Q){return new n(o,v,V,g,E,I,Q,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(o,v,V,g,E,I,Q){let U=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],n=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=o,this.verticesStart=v,this.verticesCount=V,this.indexStart=g,this.indexCount=E,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=I,this._renderingMesh=Q||I,n&&I.wg.push(this),this._engine=this._mesh.Fo().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=I.wg.length-1,U&&(this.refreshBoundingInfo(),I.Ag(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(o){return this._boundingInfo=o,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const o=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return o||this._renderingMesh}yo(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!v)return o&&this._mesh.Fo()._hasDefaultMaterial?this._mesh.Fo().defaultMaterial:null;if(this._isMultiMaterial(v)){const o=v.getSubMaterial(this.materialIndex);return this._currentMaterial!==o&&(this._currentMaterial=o,this.resetDrawCache()),o}return v}_isMultiMaterial(o){return void 0!==o.getSubMaterial}refreshBoundingInfo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.kg)return this;if(o||(o=this._renderingMesh.getVerticesData(g.e.PositionKind)),!o)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const v=this._renderingMesh.QQ();let V;if(0===this.indexStart&&this.indexCount===v.length){const o=this._renderingMesh.getBoundingInfo();V={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else V=(0,Q.b)(o,v,this.indexStart,this.indexCount,this._renderingMesh.kg.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new I.c(V.minimum,V.maximum),this}_checkCollision(o){return this.getBoundingInfo()._checkCollision(o)}updateBoundingInfo(o){let v=this.getBoundingInfo();return v||(this.refreshBoundingInfo(),v=this.getBoundingInfo()),v&&v.update(o),this}isInFrustum(o){const v=this.getBoundingInfo();return!!v&&v.isInFrustum(o,this._mesh.wx)}isCompletelyInFrustum(o){const v=this.getBoundingInfo();return!!v&&v.isCompletelyInFrustum(o)}render(o){return this._renderingMesh.render(this,o,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(o,v){if(!this._linesIndexBuffer){const V=6*Math.floor(this.indexCount/3),g=this.verticesStart+this.verticesCount>65535?new Uint32Array(V):new Uint16Array(V);let E=0;if(0===o.length)for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)g[E++]=o,g[E++]=o+1,g[E++]=o+1,g[E++]=o+2,g[E++]=o+2,g[E++]=o;else for(let v=this.indexStart;v<this.indexStart+this.indexCount;v+=3)g[E++]=o[v],g[E++]=o[v+1],g[E++]=o[v+1],g[E++]=o[v+2],g[E++]=o[v+2],g[E++]=o[v];this._linesIndexBuffer=v.createIndexBuffer(g),this._linesIndexCount=g.length}return this._linesIndexBuffer}canIntersects(o){const v=this.getBoundingInfo();return!!v&&o.intersectsBox(v.boundingBox)}intersects(o,v,V,g,E){const I=this.yo();if(!I)return null;let Q=3,U=!1;switch(I.fillMode){case 3:case 5:case 6:case 8:return null;case 7:Q=1,U=!0}return 4===I.fillMode?V.length?this._intersectLines(o,v,V,this._mesh.intersectionThreshold,g):this._intersectUnIndexedLines(o,v,V,this._mesh.intersectionThreshold,g):!V.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(o,v,V,g,E):this._intersectTriangles(o,v,V,Q,U,g,E)}_intersectLines(o,v,V,g,I){let Q=null;for(let U=this.indexStart;U<this.indexStart+this.indexCount;U+=2){const n=v[V[U]],O=v[V[U+1]],h=o.intersectionSegment(n,O,g);if(!(h<0)&&((I||!Q||h<Q.distance)&&(Q=new E.b(null,null,h),Q.faceId=U/2,I)))break}return Q}_intersectUnIndexedLines(o,v,V,g,I){let Q=null;for(let U=this.verticesStart;U<this.verticesStart+this.verticesCount;U+=2){const V=v[U],n=v[U+1],O=o.intersectionSegment(V,n,g);if(!(O<0)&&((I||!Q||O<Q.distance)&&(Q=new E.b(null,null,O),Q.faceId=U/2,I)))break}return Q}_intersectTriangles(o,v,V,g,E,I,Q){let U=null,n=-1;for(let O=this.indexStart;O<this.indexStart+this.indexCount-(3-g);O+=g){n++;const g=V[O],h=V[O+1],x=V[O+2];if(E&&4294967295===x){O+=2;continue}const f=v[g],l=v[h],S=v[x];if(!f||!l||!S)continue;if(Q&&!Q(f,l,S,o,g,h,x))continue;const T=o.intersectsTriangle(f,l,S);if(T){if(T.distance<0)continue;if((I||!U||T.distance<U.distance)&&(U=T,U.faceId=n,I))break}}return U}_intersectUnIndexedTriangles(o,v,V,g,E){let I=null;for(let Q=this.verticesStart;Q<this.verticesStart+this.verticesCount;Q+=3){const V=v[Q],U=v[Q+1],n=v[Q+2];if(E&&!E(V,U,n,o,-1,-1,-1))continue;const O=o.intersectsTriangle(V,U,n);if(O){if(O.distance<0)continue;if((g||!I||O.distance<I.distance)&&(I=O,I.faceId=Q/3,g))break}}return I}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(o,v){const V=new n(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,o,v,!1);if(!this.IsGlobal){const o=this.getBoundingInfo();if(!o)return V;V._boundingInfo=new I.c(o.minimum,o.maximum)}return V}dispose(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Fo().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const v=this._mesh.wg.indexOf(this);this._mesh.wg.splice(v,1),this.resetDrawCache(void 0,o)}getClassName(){return"SubMesh"}static CreateFromIndices(o,v,V,g,E){let I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Q=Number.MAX_VALUE,U=-Number.MAX_VALUE;const O=(E||g).QQ();for(let n=v;n<v+V;n++){const o=O[n];o<Q&&(Q=o),o>U&&(U=o)}return new n(o,Q,U-Q+1,v,V,g,E,I)}}}}]);