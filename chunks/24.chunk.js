"use strict";(self.g111kvdsqxc=self.g111kvdsqxc||[]).push([[24],{11621:(K,H,M)=>{M.d(H,{d:()=>q});class q{constructor(K,H,M){this.bu=K,this.bv=H,this.distance=M,this.faceId=0,this.subMeshId=0}}},11635:(K,H,M)=>{M.d(H,{b:()=>y});var q=M(11301),w=M(11290),u=M(11297);class y{constructor(K,H,M){this.vectors=(0,q.d)(8,w.OH.Zero),this.center=w.OH.Zero(),this.centerWorld=w.OH.Zero(),this.extendSize=w.OH.Zero(),this.extendSizeWorld=w.OH.Zero(),this.directions=(0,q.d)(3,w.OH.Zero),this.vectorsWorld=(0,q.d)(8,w.OH.Zero),this.minimumWorld=w.OH.Zero(),this.maximumWorld=w.OH.Zero(),this.minimum=w.OH.Zero(),this.maximum=w.OH.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(K,H,M)}reConstruct(K,H,M){const q=K.x,u=K.y,y=K.z,h=H.x,W=H.y,I=H.z,f=this.vectors;this.minimum.Lh(q,u,y),this.maximum.Lh(h,W,I),f[0].Lh(q,u,y),f[1].Lh(h,W,I),f[2].Lh(h,u,y),f[3].Lh(q,W,y),f[4].Lh(q,u,I),f[5].Lh(h,W,y),f[6].Lh(q,W,I),f[7].Lh(h,u,I),H.addToRef(K,this.center).scaleInPlace(.5),H.subtractToRef(K,this.extendSize).scaleInPlace(.5),this._worldMatrix=M||w.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(K){const H=y._TmpVector3,M=this.maximum.subtractToRef(this.minimum,H[0]),q=M.length();M.normalizeFromLength(q);const w=q*K,u=M.scaleInPlace(.5*w),h=this.center.subtractToRef(u,H[1]),W=this.center.addToRef(u,H[2]);return this.reConstruct(h,W,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){const H=this.minimumWorld,M=this.maximumWorld,q=this.directions,u=this.vectorsWorld,y=this.vectors;if(K.isIdentity()){H.q(this.minimum),M.q(this.maximum);for(let K=0;K<8;++K)u[K].q(y[K]);this.extendSizeWorld.q(this.extendSize),this.centerWorld.q(this.center)}else{H.Bh(Number.MAX_VALUE),M.Bh(-Number.MAX_VALUE);for(let q=0;q<8;++q){const h=u[q];w.OH.TransformCoordinatesToRef(y[q],K,h),H.minimizeInPlace(h),M.maximizeInPlace(h)}M.subtractToRef(H,this.extendSizeWorld).scaleInPlace(.5),M.addToRef(H,this.centerWorld).scaleInPlace(.5)}w.OH.FromArrayToRef(K.m,0,q[0]),w.OH.FromArrayToRef(K.m,4,q[1]),w.OH.FromArrayToRef(K.m,8,q[2]),this._worldMatrix=K}isInFrustum(K){return y.IsInFrustum(this.vectorsWorld,K)}isCompletelyInFrustum(K){return y.IsCompletelyInFrustum(this.vectorsWorld,K)}intersectsPoint(K){const H=this.minimumWorld,M=this.maximumWorld,q=H.x,w=H.y,y=H.z,h=M.x,W=M.y,I=M.z,f=K.x,z=K.y,G=K.z,a=-u.d;return!(h-f<a||a>f-q)&&(!(W-z<a||a>z-w)&&!(I-G<a||a>G-y))}intersectsSphere(K){return y.IntersectsSphere(this.minimumWorld,this.maximumWorld,K.centerWorld,K.radiusWorld)}intersectsMinMax(K,H){const M=this.minimumWorld,q=this.maximumWorld,w=M.x,u=M.y,y=M.z,h=q.x,W=q.y,I=q.z,f=K.x,z=K.y,G=K.z,a=H.x,v=H.y,O=H.z;return!(h<f||w>a)&&(!(W<z||u>v)&&!(I<G||y>O))}dispose(){var K,H;null===(K=this._drawWrapperFront)||void 0===K||K.dispose(),null===(H=this._drawWrapperBack)||void 0===H||H.dispose()}static Intersects(K,H){return K.intersectsMinMax(H.minimumWorld,H.maximumWorld)}static IntersectsSphere(K,H,M,q){const u=y._TmpVector3[0];w.OH.ClampToRef(M,K,H,u);return w.OH.DistanceSquared(M,u)<=q*q}static IsCompletelyInFrustum(K,H){for(let M=0;M<6;++M){const q=H[M];for(let H=0;H<8;++H)if(q.dotCoordinate(K[H])<0)return!1}return!0}static IsInFrustum(K,H){for(let M=0;M<6;++M){let q=!0;const w=H[M];for(let H=0;H<8;++H)if(w.dotCoordinate(K[H])>=0){q=!1;break}if(q)return!1}return!0}}y._TmpVector3=(0,q.d)(3,w.OH.Zero)},11629:(K,H,M)=>{M.d(H,{d:()=>z});var q=M(11301),w=M(11290),u=M(11635),y=M(11639);const h={min:0,max:0},W={min:0,max:0},I=(K,H,M)=>{const q=w.OH.Dot(H.centerWorld,K),u=Math.abs(w.OH.Dot(H.directions[0],K))*H.extendSize.x+Math.abs(w.OH.Dot(H.directions[1],K))*H.extendSize.y+Math.abs(w.OH.Dot(H.directions[2],K))*H.extendSize.z;M.min=q-u,M.max=q+u},f=(K,H,M)=>(I(K,H,h),I(K,M,W),!(h.min>W.max||W.min>h.max));class z{constructor(K,H,M){this._isLocked=!1,this.boundingBox=new u.b(K,H,M),this.boundingSphere=new y.d(K,H,M)}reConstruct(K,H,M){this.boundingBox.reConstruct(K,H,M),this.boundingSphere.reConstruct(K,H,M)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(K){this._isLocked=K}update(K){this._isLocked||(this.boundingBox._update(K),this.boundingSphere._update(K))}centerOn(K,H){const M=z._TmpVector3[0].q(K).Zz(H),q=z._TmpVector3[1].q(K).addInPlace(H);return this.boundingBox.reConstruct(M,q,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(M,q,this.boundingBox.getWorldMatrix()),this}encapsulate(K){const H=w.OH.Minimize(this.minimum,K),M=w.OH.Maximize(this.maximum,K);return this.reConstruct(H,M,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(K){const H=w.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(H);const M=w.TmpVectors.OH[0];return w.OH.TransformCoordinatesToRef(K.boundingBox.minimumWorld,H,M),this.encapsulate(M),w.OH.TransformCoordinatesToRef(K.boundingBox.maximumWorld,H,M),this.encapsulate(M),this}scale(K){return this.boundingBox.scale(K),this.boundingSphere.scale(K),this}isInFrustum(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===H||3===H)&&this.boundingSphere.isCenterInFrustum(K))return!0;if(!this.boundingSphere.isInFrustum(K))return!1;return!(1!==H&&3!==H)||this.boundingBox.isInFrustum(K)}get diagonalLength(){const K=this.boundingBox;return K.maximumWorld.subtractToRef(K.minimumWorld,z._TmpVector3[0]).length()}isCompletelyInFrustum(K){return this.boundingBox.isCompletelyInFrustum(K)}_checkCollision(K){return K._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(K){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(K)&&!!this.boundingBox.intersectsPoint(K))}intersects(K,H){if(!y.d.Intersects(this.boundingSphere,K.boundingSphere))return!1;if(!u.b.Intersects(this.boundingBox,K.boundingBox))return!1;if(!H)return!0;const M=this.boundingBox,q=K.boundingBox;return!!f(M.directions[0],M,q)&&(!!f(M.directions[1],M,q)&&(!!f(M.directions[2],M,q)&&(!!f(q.directions[0],M,q)&&(!!f(q.directions[1],M,q)&&(!!f(q.directions[2],M,q)&&(!!f(w.OH.Cross(M.directions[0],q.directions[0]),M,q)&&(!!f(w.OH.Cross(M.directions[0],q.directions[1]),M,q)&&(!!f(w.OH.Cross(M.directions[0],q.directions[2]),M,q)&&(!!f(w.OH.Cross(M.directions[1],q.directions[0]),M,q)&&(!!f(w.OH.Cross(M.directions[1],q.directions[1]),M,q)&&(!!f(w.OH.Cross(M.directions[1],q.directions[2]),M,q)&&(!!f(w.OH.Cross(M.directions[2],q.directions[0]),M,q)&&(!!f(w.OH.Cross(M.directions[2],q.directions[1]),M,q)&&!!f(w.OH.Cross(M.directions[2],q.directions[2]),M,q))))))))))))))}}z._TmpVector3=(0,q.d)(2,w.OH.Zero)},11639:(K,H,M)=>{M.d(H,{d:()=>u});var q=M(11301),w=M(11290);class u{constructor(K,H,M){this.center=w.OH.Zero(),this.centerWorld=w.OH.Zero(),this.minimum=w.OH.Zero(),this.maximum=w.OH.Zero(),this.reConstruct(K,H,M)}reConstruct(K,H,M){this.minimum.q(K),this.maximum.q(H);const q=w.OH.Distance(K,H);H.addToRef(K,this.center).scaleInPlace(.5),this.radius=.5*q,this._update(M||w.Matrix.IdentityReadOnly)}scale(K){const H=this.radius*K,M=u._TmpVector3,q=M[0].Bh(H),w=this.center.subtractToRef(q,M[1]),y=this.center.addToRef(q,M[2]);return this.reConstruct(w,y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){if(K.isIdentity())this.centerWorld.q(this.center),this.radiusWorld=this.radius;else{w.OH.TransformCoordinatesToRef(this.center,K,this.centerWorld);const H=u._TmpVector3[0];w.OH.TransformNormalFromFloatsToRef(1,1,1,K,H),this.radiusWorld=Math.max(Math.abs(H.x),Math.abs(H.y),Math.abs(H.z))*this.radius}}isInFrustum(K){const H=this.centerWorld,M=this.radiusWorld;for(let q=0;q<6;q++)if(K[q].dotCoordinate(H)<=-M)return!1;return!0}isCenterInFrustum(K){const H=this.centerWorld;for(let M=0;M<6;M++)if(K[M].dotCoordinate(H)<0)return!1;return!0}intersectsPoint(K){const H=w.OH.DistanceSquared(this.centerWorld,K);return!(this.radiusWorld*this.radiusWorld<H)}static Intersects(K,H){const M=w.OH.DistanceSquared(K.centerWorld,H.centerWorld),q=K.radiusWorld+H.radiusWorld;return!(q*q<M)}static CreateFromCenterAndRadius(K,H,M){this._TmpVector3[0].q(K),this._TmpVector3[1].Lh(0,0,H),this._TmpVector3[2].q(K),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Zz(this._TmpVector3[1]);const q=new u(this._TmpVector3[0],this._TmpVector3[2]);return q._worldMatrix=M||w.Matrix.Identity(),q}}u._TmpVector3=(0,q.d)(3,w.OH.Zero)},11656:(K,H,M)=>{function q(K){-1===K.indexOf("vClipPlane")&&K.push("vClipPlane"),-1===K.indexOf("vClipPlane2")&&K.push("vClipPlane2"),-1===K.indexOf("vClipPlane3")&&K.push("vClipPlane3"),-1===K.indexOf("vClipPlane4")&&K.push("vClipPlane4"),-1===K.indexOf("vClipPlane5")&&K.push("vClipPlane5"),-1===K.indexOf("vClipPlane6")&&K.push("vClipPlane6")}function w(K,H,M){const q=!!(K.clipPlane??H.clipPlane),w=!!(K.clipPlane2??H.clipPlane2),u=!!(K.clipPlane3??H.clipPlane3),y=!!(K.clipPlane4??H.clipPlane4),h=!!(K.clipPlane5??H.clipPlane5),W=!!(K.clipPlane6??H.clipPlane6);q&&M.push("#define CLIPPLANE"),w&&M.push("#define CLIPPLANE2"),u&&M.push("#define CLIPPLANE3"),y&&M.push("#define CLIPPLANE4"),h&&M.push("#define CLIPPLANE5"),W&&M.push("#define CLIPPLANE6")}function u(K,H,M){let q=!1;const w=!!(K.clipPlane??H.clipPlane),u=!!(K.clipPlane2??H.clipPlane2),y=!!(K.clipPlane3??H.clipPlane3),h=!!(K.clipPlane4??H.clipPlane4),W=!!(K.clipPlane5??H.clipPlane5),I=!!(K.clipPlane6??H.clipPlane6);return M.CLIPPLANE!==w&&(M.CLIPPLANE=w,q=!0),M.CLIPPLANE2!==u&&(M.CLIPPLANE2=u,q=!0),M.CLIPPLANE3!==y&&(M.CLIPPLANE3=y,q=!0),M.CLIPPLANE4!==h&&(M.CLIPPLANE4=h,q=!0),M.CLIPPLANE5!==W&&(M.CLIPPLANE5=W,q=!0),M.CLIPPLANE6!==I&&(M.CLIPPLANE6=I,q=!0),q}function y(K,H,M){let q=H.clipPlane??M.clipPlane;h(K,"vClipPlane",q),q=H.clipPlane2??M.clipPlane2,h(K,"vClipPlane2",q),q=H.clipPlane3??M.clipPlane3,h(K,"vClipPlane3",q),q=H.clipPlane4??M.clipPlane4,h(K,"vClipPlane4",q),q=H.clipPlane5??M.clipPlane5,h(K,"vClipPlane5",q),q=H.clipPlane6??M.clipPlane6,h(K,"vClipPlane6",q)}function h(K,H,M){M&&K.setFloat4(H,M.normal.x,M.normal.y,M.normal.z,M.d)}M.d(H,{e:()=>q,g:()=>y,i:()=>u,l:()=>w})},11589:(K,H,M)=>{M.d(H,{e:()=>q});class q{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(K,H){this._defines[K]||(K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K),this._defines[K]=new Array),this._defines[K].push(H)}addCPUSkinningFallback(K,H){this._mesh=H,K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(K,H){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,K=K.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),H._bonesComputationForcedToCPU=!0;const M=this._mesh.sK();for(let K=0;K<M.meshes.length;K++){const q=M.meshes[K];if(q.material){if(q.computeBonesUsingShaders&&0!==q.numBoneInfluencers)if(q.material.getEffect()===H)q.computeBonesUsingShaders=!1;else if(q.yh)for(const K of q.yh){if(K.effect===H){q.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&q.computeBonesUsingShaders&&q.numBoneInfluencers>0&&(q.computeBonesUsingShaders=!1)}}else{const H=this._defines[this._currentRank];if(H)for(let M=0;M<H.length;M++)K=K.replace("#define "+H[M],"");this._currentRank++}return K}}},11605:(K,H,M)=>{M.d(H,{c:()=>L});var q=M(11274),w=M(11280),u=M(11100),y=M(11102),h=M(11143),W=M(11612),I=M(11546),f=M(11112),z=M(11334),G=M(11403),a=M(11325);class v{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(K){this._func=K}get funcRef(){return this._funcRef}set funcRef(K){this._funcRef=K}get funcMask(){return this._funcMask}set funcMask(K){this._funcMask=K}get opStencilFail(){return this._opStencilFail}set opStencilFail(K){this._opStencilFail=K}get opDepthFail(){return this._opDepthFail}set opDepthFail(K){this._opDepthFail=K}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(K){this._opStencilDepthPass=K}get mask(){return this._mask}set mask(K){this._mask=K}get enabled(){return this._enabled}set enabled(K){this._enabled=K}getClassName(){return"MaterialStencilState"}copyTo(K){a.c.Clone((()=>K),this)}serialize(){return a.c.Serialize(this)}parse(K,H,M){a.c.Parse((()=>this),K,H,M)}}(0,q.e)([(0,w.J)()],v.prototype,"func",null),(0,q.e)([(0,w.J)()],v.prototype,"funcRef",null),(0,q.e)([(0,w.J)()],v.prototype,"funcMask",null),(0,q.e)([(0,w.J)()],v.prototype,"opStencilFail",null),(0,q.e)([(0,w.J)()],v.prototype,"opDepthFail",null),(0,q.e)([(0,w.J)()],v.prototype,"opStencilDepthPass",null),(0,q.e)([(0,w.J)()],v.prototype,"mask",null),(0,q.e)([(0,w.J)()],v.prototype,"enabled",null);var O=M(11651);class L{get _supportGlowLayer(){return!1}set _glowModeEnabled(K){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(K){if(this._alpha===K)return;const H=this._alpha;this._alpha=K,1!==H&&1!==K||this.rI(L.MiscDirtyFlag+L.PrePassDirtyFlag)}get alpha(){return this._alpha}set Oh(K){this._backFaceCulling!==K&&(this._backFaceCulling=K,this.rI(L.TextureDirtyFlag))}get Oh(){return this._backFaceCulling}set cullBackFaces(K){this._cullBackFaces!==K&&(this._cullBackFaces=K,this.rI(L.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(K){this._blockDirtyMechanism!==K&&(this._blockDirtyMechanism=K,K||this.fG())}atomicMaterialsUpdate(K){this.blockDirtyMechanism=!0;try{K(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(K){this._onDisposeObserver&&this.Hh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Hh.add(K)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new y.d),this._onBindObservable}set onBind(K){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(K)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new y.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new y.d),this._onEffectCreatedObservable}set alphaMode(K){this._alphaMode!==K&&(this._alphaMode=K,this.rI(L.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(K){this._needDepthPrePass!==K&&(this._needDepthPrePass=K,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(K){this._fogEnabled!==K&&(this._fogEnabled=K,this.rI(L.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case L.WireFrameFillMode:case L.LineListDrawMode:case L.LineLoopDrawMode:case L.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(K){this.fillMode=K?L.WireFrameFillMode:L.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case L.PointFillMode:case L.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(K){this.fillMode=K?L.PointFillMode:L.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(K){this._fillMode!==K&&(this._fillMode=K,this.rI(L.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){const H=this.sK().getEngine().getCaps().fragmentDepthSupported;K&&!H&&f.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=K&&H,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(K){this._drawWrapper=K}constructor(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Hh=new y.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new v,this._useUBO=!1,this._fillMode=L.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=K;const w=H||h.b.LastCreatedScene;w&&(this._scene=w,this._dirtyCallbacks={},this._forceGLSL=q,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=K||u.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new G.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new I.c(this._scene.getEngine(),void 0,void 0,K),this._useUBO=this.sK().getEngine().supportsUniformBuffers,this._createUniformBuffer(),M||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),L.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var K;const H=this.sK().getEngine();null===(K=this._uniformBuffer)||void 0===K||K.dispose(),H.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new I.c(H,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new I.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(K){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.fG(),this.checkReadyOnlyOnce=!0}unfreeze(){this.fG(),this.checkReadyOnlyOnce=!1}isReady(K,H){return!0}isReadyForSubMesh(K,H,M){const q=H.materialDefines;return!!q&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}sK(){return this._scene}_getEffectiveOrientation(K){return null!==this.sideOrientation?this.sideOrientation:K.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(K){this._transparencyMode!==K&&(this._transparencyMode=K,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===L.MATERIAL_ALPHABLEND||this._transparencyMode===L.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===L.MATERIAL_ALPHATEST||this._transparencyMode===L.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===L.MATERIAL_OPAQUE||this._transparencyMode===L.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(K){return this._hasTransparencyMode?this._transparencyModeIsBlend:K.visibility<1||!this._disableAlphaBlending&&(K.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(K){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(K)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}fG(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H=this.sK().meshes;for(const M of H)if(M.yh)for(const H of M.yh)if(H.pK()===this)for(const M of H._drawWrappers)M&&this._materialContext===M.materialContext&&(M._wasPreviouslyReady=!1,M._wasPreviouslyUsingInstances=null,M._forceRebindOnNextCall=K);K&&this.rI(L.AllDirtyFlag)}_preBind(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=this._scene.getEngine(),q=(null==H?this.sideOrientation:H)===L.ClockWiseSideOrientation;return M.enableEffect(K||this._getDrawWrapper()),M.setState(this.Oh,this.zOffset,!1,q,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),q}bind(K,H){}buildUniformLayout(){const K=this._uniformBuffer;this._eventInfo.ubo=K,this._callbackPluginEventGeneric(8,this._eventInfo),K.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(K,H,M){const q=M._drawWrapper;this._eventInfo.subMesh=M,this._callbackPluginEventBindForSubMesh(this._eventInfo),q._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(K){}bindView(K){this._useUBO?this._needToBindSceneUbo=!0:K.setMatrix("view",this.sK().getViewMatrix())}bindViewProjection(K){this._useUBO?this._needToBindSceneUbo=!0:(K.setMatrix("viewProjection",this.sK().getTransformMatrix()),K.setMatrix("projection",this.sK().getProjectionMatrix()))}bindEyePosition(K,H){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(K,H)}_afterBind(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&H&&(this._needToBindSceneUbo=!1,(0,O.r)(H,this.sK().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=K?K.visibility:1,this._onBindObservable&&K&&this._onBindObservable.notifyObservers(K),this.disableDepthWrite){const K=this._scene.getEngine();this._cachedDepthWriteState=K.getDepthWrite(),K.setDepthWrite(!1)}if(this.disableColorWrite){const K=this._scene.getEngine();this._cachedColorWriteState=K.getColorWrite(),K.setColorWrite(!1)}if(0!==this.depthFunction){const K=this._scene.getEngine();this._cachedDepthFunctionState=K.getDepthFunction()||0,K.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(K){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=K,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(K){return null}_clonePlugins(K,H){const M={};if(this._serializePlugins(M),L._ParsePlugins(M,K,this._scene,H),this.pluginManager)for(const q of this.pluginManager._plugins){const H=K.pluginManager.getPlugin(q.name);H&&q.copyTo(H)}}getBindedMeshes(){if(this.meshMap){const K=[];for(const H in this.meshMap){const M=this.meshMap[H];M&&K.push(M)}return K}return this._scene.meshes.filter((K=>K.material===this))}forceCompilation(K,H,M,q){const w={clipPlane:!1,useInstances:!1,...M},u=this.sK(),y=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const h=()=>{if(!this._scene||!this._scene.getEngine())return;const M=u.clipPlane;if(w.clipPlane&&(u.clipPlane=new z.e(0,0,0,1)),this._storeEffectOnSubMeshes){let M=!0,u=null;if(K.yh){const H=new W.c(0,0,0,0,0,K,void 0,!1,!1);H.materialDefines&&(H.materialDefines._renderId=-1),this.isReadyForSubMesh(K,H,w.useInstances)||(H.effect&&H.effect.getCompilationError()&&H.effect.allFallbacksProcessed()?u=H.effect.getCompilationError():(M=!1,setTimeout(h,16)))}M&&(this.allowShaderHotSwapping=y,u&&q&&q(u),H&&H(this))}else this.isReady()?(this.allowShaderHotSwapping=y,H&&H(this)):setTimeout(h,16);w.clipPlane&&(u.clipPlane=M)};h()}async forceCompilationAsync(K,H){return await new Promise(((M,q)=>{this.forceCompilation(K,(()=>{M()}),H,(K=>{q(K)}))}))}rI(K){this.sK().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(L._DirtyCallbackArray.length=0,K&L.ImageProcessingDirtyFlag&&L._DirtyCallbackArray.push(L._ImageProcessingDirtyCallBack),K&L.TextureDirtyFlag&&L._DirtyCallbackArray.push(L._TextureDirtyCallBack),K&L.LightDirtyFlag&&L._DirtyCallbackArray.push(L._LightsDirtyCallBack),K&L.FresnelDirtyFlag&&L._DirtyCallbackArray.push(L._FresnelDirtyCallBack),K&L.AttributesDirtyFlag&&L._DirtyCallbackArray.push(L._AttributeDirtyCallBack),K&L.MiscDirtyFlag&&L._DirtyCallbackArray.push(L._MiscDirtyCallBack),K&L.PrePassDirtyFlag&&L._DirtyCallbackArray.push(L._PrePassDirtyCallBack),L._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(L._RunDirtyCallBacks),this.sK().resetCachedMaterial())}resetDrawCache(){const K=this.sK().meshes;for(const H of K)if(H.yh)for(const K of H.yh)K.pK()===this&&K.resetDrawCache()}_markAllSubMeshesAsDirty(K){const H=this.sK();if(H.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const M=H.meshes;for(const q of M)if(q.yh)for(const M of q.yh){if((M.pK()||(H._hasDefaultMaterial?H.defaultMaterial:null))===this)for(const H of M._drawWrappers)H&&H.defines&&H.defines.markAllAsDirty&&this._materialContext===H.materialContext&&K(H.defines)}}_markScenePrePassDirty(){if(this.sK().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const K=this.sK().enablePrePassRenderer();K&&K.rI()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(L._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(L._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(L._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(L._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(L._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(L._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(L._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(L._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(L._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(L._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const K=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Hh.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(K)}))}}setPrePassRenderer(K){return!1}dispose(K,H,M){const q=this.sK();if(q.stopAnimation(this),q.freeProcessedMaterials(),q.removeMaterial(this),this._eventInfo.forceDisposeTextures=H,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const K=this._parentContainer.materials.indexOf(this);K>-1&&this._parentContainer.materials.splice(K,1),this._parentContainer=null}if(!0!==M)if(this.meshMap)for(const w in this.meshMap){const K=this.meshMap[w];this._disposeMeshResources(K)}else{const K=q.meshes;for(const H of K)this._disposeMeshResources(H)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Hh.notifyObservers(this),this.Hh.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(K){if(!K)return;const H=K.Gh,M=K._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(K.yh&&M)for(const w of K.yh){const K=w._drawWrappers;for(let u=0;u<K.length;u++){var q;const y=null===(q=K[u])||void 0===q?void 0:q.effect;if(!y)continue;M[u]===this&&(null===H||void 0===H||H._releaseVertexArrayObject(y),w._removeDrawWrapper(u,!0,!0))}}}else null===H||void 0===H||H._releaseVertexArrayObject(this._drawWrapper.effect);K.material!==this||K.sourceMesh||(K.material=null)}serialize(){const K=a.c.Serialize(this);return K.stencil=this.stencil.serialize(),K.uniqueId=this.uniqueId,this._serializePlugins(K),K}_serializePlugins(K){if(K.plugins={},this.pluginManager)for(const H of this.pluginManager._plugins)H.doNotSerialize||(K.plugins[H.getClassName()]=H.serialize())}static Parse(K,H,M){if(K.customType){if("BABYLON.PBRMaterial"===K.customType&&K.overloadedAlbedo&&(K.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return f.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else K.customType="BABYLON.StandardMaterial";const q=u.Tools.Instantiate(K.customType).Parse(K,H,M);return q._loadedUniqueId=K.uniqueId,q}static _ParsePlugins(K,H,M,q){if(K.plugins)for(const h in K.plugins){var w,y;const W=K.plugins[h];let I=null===(w=H.pluginManager)||void 0===w?void 0:w.getPlugin(W.name);if(!I){const K=u.Tools.Instantiate("BABYLON."+h);K&&(I=new K(H))}null===(y=I)||void 0===y||y.parse(W,M,q)}}}L.TriangleFillMode=0,L.WireFrameFillMode=1,L.PointFillMode=2,L.PointListDrawMode=3,L.LineListDrawMode=4,L.LineLoopDrawMode=5,L.LineStripDrawMode=6,L.TriangleStripDrawMode=7,L.TriangleFanDrawMode=8,L.ClockWiseSideOrientation=0,L.CounterClockWiseSideOrientation=1,L.ImageProcessingDirtyFlag=64,L.TextureDirtyFlag=1,L.LightDirtyFlag=2,L.FresnelDirtyFlag=4,L.AttributesDirtyFlag=8,L.MiscDirtyFlag=16,L.PrePassDirtyFlag=32,L.AllDirtyFlag=127,L.MATERIAL_OPAQUE=0,L.MATERIAL_ALPHATEST=1,L.MATERIAL_ALPHABLEND=2,L.MATERIAL_ALPHATESTANDBLEND=3,L.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,L.MATERIAL_NORMALBLENDMETHOD_RNM=1,L.OnEventObservable=new y.d,L._AllDirtyCallBack=K=>K.markAllAsDirty(),L._ImageProcessingDirtyCallBack=K=>K.markAsImageProcessingDirty(),L._TextureDirtyCallBack=K=>K.markAsTexturesDirty(),L._FresnelDirtyCallBack=K=>K.markAsFresnelDirty(),L._MiscDirtyCallBack=K=>K.markAsMiscDirty(),L._PrePassDirtyCallBack=K=>K.markAsPrePassDirty(),L._LightsDirtyCallBack=K=>K.markAsLightDirty(),L._AttributeDirtyCallBack=K=>K.markAsAttributesDirty(),L._FresnelAndMiscDirtyCallBack=K=>{L._FresnelDirtyCallBack(K),L._MiscDirtyCallBack(K)},L._TextureAndMiscDirtyCallBack=K=>{L._TextureDirtyCallBack(K),L._MiscDirtyCallBack(K)},L._DirtyCallbackArray=[],L._RunDirtyCallBacks=K=>{for(const H of L._DirtyCallbackArray)H(K)},(0,q.e)([(0,w.J)()],L.prototype,"id",void 0),(0,q.e)([(0,w.J)()],L.prototype,"uniqueId",void 0),(0,q.e)([(0,w.J)()],L.prototype,"name",void 0),(0,q.e)([(0,w.J)()],L.prototype,"metadata",void 0),(0,q.e)([(0,w.J)()],L.prototype,"checkReadyOnEveryCall",void 0),(0,q.e)([(0,w.J)()],L.prototype,"checkReadyOnlyOnce",void 0),(0,q.e)([(0,w.J)()],L.prototype,"state",void 0),(0,q.e)([(0,w.J)("alpha")],L.prototype,"_alpha",void 0),(0,q.e)([(0,w.J)("Oh")],L.prototype,"_backFaceCulling",void 0),(0,q.e)([(0,w.J)("cullBackFaces")],L.prototype,"_cullBackFaces",void 0),(0,q.e)([(0,w.J)()],L.prototype,"sideOrientation",void 0),(0,q.e)([(0,w.J)("alphaMode")],L.prototype,"_alphaMode",void 0),(0,q.e)([(0,w.J)()],L.prototype,"_needDepthPrePass",void 0),(0,q.e)([(0,w.J)()],L.prototype,"disableDepthWrite",void 0),(0,q.e)([(0,w.J)()],L.prototype,"disableColorWrite",void 0),(0,q.e)([(0,w.J)()],L.prototype,"forceDepthWrite",void 0),(0,q.e)([(0,w.J)()],L.prototype,"depthFunction",void 0),(0,q.e)([(0,w.J)()],L.prototype,"separateCullingPass",void 0),(0,q.e)([(0,w.J)("fogEnabled")],L.prototype,"_fogEnabled",void 0),(0,q.e)([(0,w.J)()],L.prototype,"pointSize",void 0),(0,q.e)([(0,w.J)()],L.prototype,"zOffset",void 0),(0,q.e)([(0,w.J)()],L.prototype,"zOffsetUnits",void 0),(0,q.e)([(0,w.J)()],L.prototype,"pointsCloud",null),(0,q.e)([(0,w.J)()],L.prototype,"fillMode",null),(0,q.e)([(0,w.J)()],L.prototype,"useLogarithmicDepth",null),(0,q.e)([(0,w.J)()],L.prototype,"transparencyMode",null)},11651:(K,H,M)=>{M.d(H,{$:()=>v,A:()=>a,E:()=>G,H:()=>T,J:()=>k,K:()=>n,N:()=>S,P:()=>V,R:()=>d,S:()=>x,T:()=>Q,X:()=>N,e:()=>i,g:()=>z,h:()=>E,l:()=>f,o:()=>O,r:()=>L,s:()=>B,t:()=>D,u:()=>C,x:()=>l,y:()=>s});var q=M(11112),w=M(11329),u=M(11143),y=M(11585),h=M(11656);const W=w.CH.Black(),I={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function f(K,H,M){if(!K||K.LOGARITHMICDEPTH||K.indexOf&&K.indexOf("LOGARITHMICDEPTH")>=0){const K=M.activeCamera;1===K.mode&&q.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),H.setFloat("logarithmicDepthConstant",2/(Math.log(K.maxZ+1)/Math.LN2))}}function z(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];M&&K.fogEnabled&&(!H||H.applyFog)&&0!==K.fogMode&&(M.setFloat4("vFogInfos",K.fogMode,K.fogStart,K.fogEnd,K.fogDensity),q?(K.fogColor.toLinearSpaceToRef(W,K.getEngine().useExactSrgbConversions),M.setColor3("vFogColor",W)):M.setColor3("vFogColor",K.fogColor))}function G(K,H,M,q,w,u,y,h,W,f){const z=K.numMaxInfluencers||K.numInfluencers;return z<=0?0:(H.push("#define MORPHTARGETS"),K.hasPositions&&H.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),K.hasNormals&&H.push("#define MORPHTARGETTEXTURE_HASNORMALS"),K.hasTangents&&H.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),K.hasUVs&&H.push("#define MORPHTARGETTEXTURE_HASUVS"),K.hasUV2s&&H.push("#define MORPHTARGETTEXTURE_HASUV2S"),K.hasColors&&H.push("#define MORPHTARGETTEXTURE_HASCOLORS"),K.supportsPositions&&w&&H.push("#define MORPHTARGETS_POSITION"),K.supportsNormals&&u&&H.push("#define MORPHTARGETS_NORMAL"),K.supportsTangents&&y&&H.push("#define MORPHTARGETS_TANGENT"),K.supportsUVs&&h&&H.push("#define MORPHTARGETS_UV"),K.supportsUV2s&&W&&H.push("#define MORPHTARGETS_UV2"),K.supportsColors&&f&&H.push("#define MORPHTARGETS_COLOR"),H.push("#define NUM_MORPH_INFLUENCERS "+z),K.isUsingTextureForTargets&&H.push("#define MORPHTARGETS_TEXTURE"),I.NUM_MORPH_INFLUENCERS=z,I.NORMAL=u,I.TANGENT=y,I.UV=h,I.UV2=W,I.COLOR=f,a(M,q,I,w),z)}function a(K,H,M){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=M.NUM_MORPH_INFLUENCERS;if(y>0&&u.b.LastCreatedEngine){const h=u.b.LastCreatedEngine.getCaps().maxVertexAttribs,W=H.morphTargetManager;if(null!==W&&void 0!==W&&W.isUsingTextureForTargets)return;const I=W&&W.supportsPositions&&w,f=W&&W.supportsNormals&&M.NORMAL,z=W&&W.supportsTangents&&M.TANGENT,G=W&&W.supportsUVs&&M.UV1,a=W&&W.supportsUV2s&&M.UV2,v=W&&W.supportsColors&&M.VERTEXCOLOR;for(let M=0;M<y;M++)I&&K.push("position"+M),f&&K.push("normal"+M),z&&K.push("tangent"+M),G&&K.push("uv_"+M),a&&K.push("uv2_"+M),v&&K.push("color"+M),K.length>h&&q.e.Error("Cannot add more vertex attributes for mesh "+H.name)}}function v(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K.push("world0"),K.push("world1"),K.push("world2"),K.push("world3"),H&&(K.push("previousWorld0"),K.push("previousWorld1"),K.push("previousWorld2"),K.push("previousWorld3"))}function O(K,H){const M=K.morphTargetManager;K&&M&&H.setFloatArray("morphTargetInfluences",M.influences)}function L(K,H){H.bindToEffect(K,"Scene")}function S(K,H,M){H._needUVs=!0,H[M]=!0,K.optimizeUVAllocation&&K.getTextureMatrix().isIdentityAs3x2()?(H[M+"DIRECTUV"]=K.coordinatesIndex+1,H["MAINUV"+(K.coordinatesIndex+1)]=!0):H[M+"DIRECTUV"]=0}function B(K,H,M){const q=K.getTextureMatrix();H.fh(M+"Matrix",q)}function C(K,H,M){M.BAKED_VERTEX_ANIMATION_TEXTURE&&M.INSTANCES&&K.push("bakedVertexAnimationSettingsInstanced")}function i(K,H,M){var q;if(H&&K&&(K.computeBonesUsingShaders&&H._bonesComputationForcedToCPU&&(K.computeBonesUsingShaders=!1),K.useBones&&K.computeBonesUsingShaders&&K.skeleton)){const w=K.skeleton;if(w.isUsingTextureForMatrices&&H.getUniformIndex("boneTextureWidth")>-1){const M=w.getTransformMatrixTexture(K);H.setTexture("boneSampler",M),H.setFloat("boneTextureWidth",4*(w.bones.length+1))}else{const u=w.getTransformMatrices(K);u&&(H.setMatrices("mBones",u),M&&K.sK().prePassRenderer&&K.sK().prePassRenderer.getIndex(2)&&(M.previousBones[K.uniqueId]||(M.previousBones[K.uniqueId]=u.slice()),H.setMatrices("mPreviousBones",M.previousBones[K.uniqueId]),q=u,M.previousBones[K.uniqueId].set(q)))}}}function Z(K,H,M,q,w){let u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];K._bindLight(H,M,q,w,u)}function E(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const u=Math.min(H.lightSources.length,w);for(let y=0;y<u;y++){Z(H.lightSources[y],y,K,M,"boolean"===typeof q?q:q.SPECULARTERM,H.receiveShadows)}}function l(K,H,M,q){M.NUM_BONE_INFLUENCERS>0&&(q.addCPUSkinningFallback(0,H),K.push("matricesIndices"),K.push("matricesWeights"),M.NUM_BONE_INFLUENCERS>4&&(K.push("matricesIndicesExtra"),K.push("matricesWeightsExtra")))}function s(K,H){(H.INSTANCES||H.THIN_INSTANCES)&&v(K,!!H.PREPASS_VELOCITY),H.INSTANCESCOLOR&&K.push("instanceColor")}function D(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=0;for(let u=0;u<M&&K["LIGHT"+u];u++)u>0&&(w=q+u,H.addFallback(w,"LIGHT"+u)),K.SHADOWS||(K["SHADOW"+u]&&H.addFallback(q,"SHADOW"+u),K["SHADOWPCF"+u]&&H.addFallback(q,"SHADOWPCF"+u),K["SHADOWPCSS"+u]&&H.addFallback(q,"SHADOWPCSS"+u),K["SHADOWPOISSON"+u]&&H.addFallback(q,"SHADOWPOISSON"+u),K["SHADOWESM"+u]&&H.addFallback(q,"SHADOWESM"+u),K["SHADOWCLOSEESM"+u]&&H.addFallback(q,"SHADOWCLOSEESM"+u));return w++}function V(K,H,M,q,w,u,y){let h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];y._areMiscDirty&&(y.LOGARITHMICDEPTH=M,y.POINTSIZE=q,y.FOG=w&&function(K,H){return H.fogEnabled&&K.applyFog&&0!==H.fogMode}(K,H),y.NONUNIFORMSCALING=K.nonUniformScaling,y.ALPHATEST=u,y.DECAL_AFTER_DETAIL=h)}function n(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!M._areLightsDirty)return M._needNormals;let y=0;const h={needNormals:M._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(K.lightsEnabled&&!u)for(const I of H.lightSources)if(c(K,H,I,y,M,q,h),y++,y===w)break;M.SPECULARTERM=h.specularEnabled,M.SHADOWS=h.shadowEnabled;for(let I=y;I<w;I++)void 0!==M["LIGHT"+I]&&(M["LIGHT"+I]=!1,M["HEMILIGHT"+I]=!1,M["POINTLIGHT"+I]=!1,M["DIRLIGHT"+I]=!1,M["SPOTLIGHT"+I]=!1,M["AREALIGHT"+I]=!1,M["SHADOW"+I]=!1,M["SHADOWCSM"+I]=!1,M["SHADOWCSMDEBUG"+I]=!1,M["SHADOWCSMNUM_CASCADES"+I]=!1,M["SHADOWCSMUSESHADOWMAXZ"+I]=!1,M["SHADOWCSMNOBLEND"+I]=!1,M["SHADOWCSM_RIGHTHANDED"+I]=!1,M["SHADOWPCF"+I]=!1,M["SHADOWPCSS"+I]=!1,M["SHADOWPOISSON"+I]=!1,M["SHADOWESM"+I]=!1,M["SHADOWCLOSEESM"+I]=!1,M["SHADOWCUBE"+I]=!1,M["SHADOWLOWQUALITY"+I]=!1,M["SHADOWMEDIUMQUALITY"+I]=!1);const W=K.getEngine().getCaps();return void 0===M.SHADOWFLOAT&&(h.needRebuild=!0),M.SHADOWFLOAT=h.shadowEnabled&&(W.textureFloatRender&&W.textureFloatLinearFiltering||W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering),M.LIGHTMAPEXCLUDED=h.lightmapMode,h.needRebuild&&M.rebuild(),h.needNormals}function c(K,H,M,q,w,u,h){switch(h.needNormals=!0,void 0===w["LIGHT"+q]&&(h.needRebuild=!0),w["LIGHT"+q]=!0,w["SPOTLIGHT"+q]=!1,w["HEMILIGHT"+q]=!1,w["POINTLIGHT"+q]=!1,w["DIRLIGHT"+q]=!1,w["AREALIGHT"+q]=!1,M.prepareLightSpecificDefines(w,q),w["LIGHT_FALLOFF_PHYSICAL"+q]=!1,w["LIGHT_FALLOFF_GLTF"+q]=!1,w["LIGHT_FALLOFF_STANDARD"+q]=!1,M.falloffType){case y.c.FALLOFF_GLTF:w["LIGHT_FALLOFF_GLTF"+q]=!0;break;case y.c.FALLOFF_PHYSICAL:w["LIGHT_FALLOFF_PHYSICAL"+q]=!0;break;case y.c.FALLOFF_STANDARD:w["LIGHT_FALLOFF_STANDARD"+q]=!0}if(u&&!M.Vf.equalsFloats(0,0,0)&&(h.specularEnabled=!0),w["SHADOW"+q]=!1,w["SHADOWCSM"+q]=!1,w["SHADOWCSMDEBUG"+q]=!1,w["SHADOWCSMNUM_CASCADES"+q]=!1,w["SHADOWCSMUSESHADOWMAXZ"+q]=!1,w["SHADOWCSMNOBLEND"+q]=!1,w["SHADOWCSM_RIGHTHANDED"+q]=!1,w["SHADOWPCF"+q]=!1,w["SHADOWPCSS"+q]=!1,w["SHADOWPOISSON"+q]=!1,w["SHADOWESM"+q]=!1,w["SHADOWCLOSEESM"+q]=!1,w["SHADOWCUBE"+q]=!1,w["SHADOWLOWQUALITY"+q]=!1,w["SHADOWMEDIUMQUALITY"+q]=!1,H&&H.receiveShadows&&K.shadowsEnabled&&M.shadowEnabled){const H=M.getShadowGenerator(K.activeCamera)??M.getShadowGenerator();if(H){const K=H.getShadowMap();K&&K.renderList&&K.renderList.length>0&&(h.shadowEnabled=!0,H.prepareDefines(w,q))}}M.lightmapMode!=y.c.LIGHTMAP_DEFAULT?(h.lightmapMode=!0,w["LIGHTMAPEXCLUDED"+q]=!0,w["LIGHTMAPNOSPECULAR"+q]=M.lightmapMode==y.c.LIGHTMAP_SHADOWSONLY):(w["LIGHTMAPEXCLUDED"+q]=!1,w["LIGHTMAPNOSPECULAR"+q]=!1)}function k(K,H,M,q,w){let u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=function(K,H){let M=!1;if(K.activeCamera){const q=H.CAMERA_ORTHOGRAPHIC?1:0,w=H.CAMERA_PERSPECTIVE?1:0,u=1===K.activeCamera.mode?1:0,y=0===K.activeCamera.mode?1:0;(q^u||w^y)&&(H.CAMERA_ORTHOGRAPHIC=1===u,H.CAMERA_PERSPECTIVE=1===y,M=!0)}return M}(K,q);!1!==u&&(W=(0,h.i)(M,K,q)),q.DEPTHPREPASS!==!H.getColorWrite()&&(q.DEPTHPREPASS=!q.DEPTHPREPASS,W=!0),q.INSTANCES!==w&&(q.INSTANCES=w,W=!0),q.THIN_INSTANCES!==y&&(q.THIN_INSTANCES=y,W=!0),W&&q.markAsUnprocessed()}function T(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!H._areAttributesDirty&&H._needNormals===H._normals&&H._needUVs===H._uvs)return!1;H._normals=H._needNormals,H._uvs=H._needUVs,H.NORMAL=H._needNormals&&K.isVerticesDataPresent("normal"),H._needNormals&&K.isVerticesDataPresent("tangent")&&(H.TANGENT=!0);for(let h=1;h<=6;++h)H["UV"+h]=!!H._needUVs&&K.isVerticesDataPresent(`uv${1===h?"":h}`);if(M){const M=K.useVertexColors&&K.isVerticesDataPresent("color");H.VERTEXCOLOR=M,H.VERTEXALPHA=K.hasVertexAlpha&&M&&u}return K.isVerticesDataPresent("instanceColor")&&(K.hasInstances||K.hasThinInstances)&&(H.INSTANCESCOLOR=!0),q&&function(K,H){if(K.useBones&&K.computeBonesUsingShaders&&K.skeleton){H.NUM_BONE_INFLUENCERS=K.numBoneInfluencers;const M=void 0!==H.BONETEXTURE;if(K.skeleton.isUsingTextureForMatrices&&M)H.BONETEXTURE=!0;else{H.BonesPerMesh=K.skeleton.bones.length+1,H.BONETEXTURE=!M&&void 0;const q=K.sK().prePassRenderer;if(q&&q.enabled){const M=-1===q.excludedSkinnedMesh.indexOf(K);H.BONES_VELOCITY_ENABLED=M}}}else H.NUM_BONE_INFLUENCERS=0,H.BonesPerMesh=0,void 0!==H.BONETEXTURE&&(H.BONETEXTURE=!1)}(K,H),w&&function(K,H){const M=K.morphTargetManager;M?(H.MORPHTARGETS_UV=M.supportsUVs&&H.UV1,H.MORPHTARGETS_UV2=M.supportsUV2s&&H.UV2,H.MORPHTARGETS_TANGENT=M.supportsTangents&&H.TANGENT,H.MORPHTARGETS_NORMAL=M.supportsNormals&&H.NORMAL,H.MORPHTARGETS_POSITION=M.supportsPositions,H.MORPHTARGETS_COLOR=M.supportsColors,H.MORPHTARGETTEXTURE_HASUVS=M.hasUVs,H.MORPHTARGETTEXTURE_HASUV2S=M.hasUV2s,H.MORPHTARGETTEXTURE_HASTANGENTS=M.hasTangents,H.MORPHTARGETTEXTURE_HASNORMALS=M.hasNormals,H.MORPHTARGETTEXTURE_HASPOSITIONS=M.hasPositions,H.MORPHTARGETTEXTURE_HASCOLORS=M.hasColors,H.NUM_MORPH_INFLUENCERS=M.numMaxInfluencers||M.numInfluencers,H.MORPHTARGETS=H.NUM_MORPH_INFLUENCERS>0,H.MORPHTARGETS_TEXTURE=M.isUsingTextureForTargets):(H.MORPHTARGETS_UV=!1,H.MORPHTARGETS_UV2=!1,H.MORPHTARGETS_TANGENT=!1,H.MORPHTARGETS_NORMAL=!1,H.MORPHTARGETS_POSITION=!1,H.MORPHTARGETS_COLOR=!1,H.MORPHTARGETTEXTURE_HASUVS=!1,H.MORPHTARGETTEXTURE_HASUV2S=!1,H.MORPHTARGETTEXTURE_HASTANGENTS=!1,H.MORPHTARGETTEXTURE_HASNORMALS=!1,H.MORPHTARGETTEXTURE_HASPOSITIONS=!1,H.MORPHTARGETTEXTURE_HAS_COLORS=!1,H.MORPHTARGETS=!1,H.NUM_MORPH_INFLUENCERS=0)}(K,H),y&&function(K,H){const M=K.bakedVertexAnimationManager;H.BAKED_VERTEX_ANIMATION_TEXTURE=!(!M||!M.isEnabled)}(K,H),!0}function d(K,H){if(K.activeCamera){const M=H.MULTIVIEW;H.MULTIVIEW=null!==K.activeCamera.outputRenderTarget&&K.activeCamera.outputRenderTarget.getViewCount()>1,H.MULTIVIEW!=M&&H.markAsUnprocessed()}}function x(K,H,M){const q=H.ORDER_INDEPENDENT_TRANSPARENCY,w=H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;H.ORDER_INDEPENDENT_TRANSPARENCY=K.useOrderIndependentTransparency&&M,H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!K.getEngine().getCaps().textureFloatLinearFiltering,q===H.ORDER_INDEPENDENT_TRANSPARENCY&&w===H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||H.markAsUnprocessed()}function Q(K,H,M){const q=H.PREPASS;if(!H._arePrePassDirty)return;const w=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(K.prePassRenderer&&K.prePassRenderer.enabled&&M){H.PREPASS=!0,H.SCENE_MRT_COUNT=K.prePassRenderer.mrtCount,H.PREPASS_NORMAL_WORLDSPACE=K.prePassRenderer.generateNormalsInWorldSpace,H.PREPASS_COLOR=!0,H.PREPASS_COLOR_INDEX=0;for(let M=0;M<w.length;M++){const q=K.prePassRenderer.getIndex(w[M].type);-1!==q?(H[w[M].define]=!0,H[w[M].index]=q):H[w[M].define]=!1}}else{H.PREPASS=!1;for(let K=0;K<w.length;K++)H[w[K].define]=!1}H.PREPASS!=q&&(H.markAsUnprocessed(),H.markAsImageProcessingDirty())}function J(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];w&&w.push("Light"+K),u||(H.push("vLightData"+K,"vLightDiffuse"+K,"vLightSpecular"+K,"vLightDirection"+K,"vLightWidth"+K,"vLightHeight"+K,"vLightFalloff"+K,"vLightGround"+K,"lightMatrix"+K,"shadowsInfo"+K,"depthValues"+K),M.push("shadowTexture"+K),M.push("depthTexture"+K),H.push("viewFrustumZ"+K,"cascadeBlendFactor"+K,"lightSizeUVCorrection"+K,"depthCorrection"+K,"penumbraDarkness"+K,"frustumLengths"+K),q&&(M.push("projectionLightTexture"+K),H.push("textureProjectionMatrix"+K)),y&&M.push("iesLightTexture"+K))}function N(K,H,M){let q,w,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(K.uniformsNames){const y=K;q=y.uniformsNames,w=y.uniformBuffersNames,H=y.samplers,M=y.defines,u=y.maxSimultaneousLights||0}else q=K,H||(H=[]);for(let y=0;y<u&&M["LIGHT"+y];y++)J(y,q,H,M["PROJECTEDLIGHTTEXTURE"+y],w,!1,M["IESLIGHTTEXTURE"+y]);M.NUM_MORPH_INFLUENCERS&&(q.push("morphTargetInfluences"),q.push("morphTargetCount")),M.BAKED_VERTEX_ANIMATION_TEXTURE&&(q.push("bakedVertexAnimationSettings"),q.push("bakedVertexAnimationTextureSizeInverted"),q.push("bakedVertexAnimationTime"),H.push("bakedVertexAnimationTexture"))}},11597:(K,H,M)=>{M.d(H,{c:()=>u});var q=M(11290),w=M(11605);class u extends w.c{constructor(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(K,H,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new q.Matrix,this._storeEffectOnSubMeshes=M}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(K,H){return!!K&&(!this._storeEffectOnSubMeshes||(!K.yh||0===K.yh.length||this.isReadyForSubMesh(K,K.yh[0],H)))}_isReadyForSubMesh(K){const H=K.materialDefines;return!(this.checkReadyOnEveryCall||!K.effect||!H||H._renderId!==this.sK().getRenderId())}bindOnlyWorldMatrix(K){this._activeEffect.setMatrix("world",K)}bindOnlyNormalMatrix(K){this._activeEffect.setMatrix("normalMatrix",K)}bind(K,H){H&&this.bindForSubMesh(K,H,H.yh[0])}_afterBind(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0;super._afterBind(K,H,M),this.sK()._cachedEffect=H,M?M._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return M._drawWrapper._forceRebindOnNextCall||K.isCachedMaterialInvalid(this,H,q)}dispose(K,H,M){this._activeEffect=void 0,super.dispose(K,H,M)}}},11648:(K,H,M)=>{M.d(H,{e:()=>h,h:()=>W});var q=M(11274),w=M(11290),u=M(11280);class y{static extractMinAndMaxIndexed(K,H,M,q,w,u){for(let y=M;y<M+q;y++){const M=3*H[y],q=K[M],h=K[M+1],W=K[M+2];w.minimizeInPlaceFromFloats(q,h,W),u.maximizeInPlaceFromFloats(q,h,W)}}static extractMinAndMax(K,H,M,q,w,u){for(let y=H,h=H*q;y<H+M;y++,h+=q){const H=K[h],M=K[h+1],q=K[h+2];w.minimizeInPlaceFromFloats(H,M,q),u.maximizeInPlaceFromFloats(H,M,q)}}}function h(K,H,M,q){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=new w.OH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new w.OH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return y.extractMinAndMaxIndexed(K,H,M,q,h,W),u&&(h.x-=h.x*u.x+u.y,h.y-=h.y*u.x+u.y,h.z-=h.z*u.x+u.y,W.x+=W.x*u.x+u.y,W.y+=W.y*u.x+u.y,W.z+=W.z*u.x+u.y),{minimum:h,maximum:W}}function W(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4?arguments[4]:void 0;const h=new w.OH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new w.OH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u||(u=3),y.extractMinAndMax(K,H,M,u,h,W),q&&(h.x-=h.x*q.x+q.y,h.y-=h.y*q.x+q.y,h.z-=h.z*q.x+q.y,W.x+=W.x*q.x+q.y,W.y+=W.y*q.x+q.y,W.z+=W.z*q.x+q.y),{minimum:h,maximum:W}}(0,q.e)([u.f.filter((function(){for(var K=arguments.length,H=new Array(K),M=0;M<K;M++)H[M]=arguments[M];let[q,w]=H;return!Array.isArray(q)&&!Array.isArray(w)}))],y,"extractMinAndMaxIndexed",null),(0,q.e)([u.f.filter((function(){for(var K=arguments.length,H=new Array(K),M=0;M<K;M++)H[M]=arguments[M];let[q]=H;return!Array.isArray(q)}))],y,"extractMinAndMax",null)},11612:(K,H,M)=>{M.d(H,{c:()=>W});var q=M(11366),w=M(11621),u=M(11629),y=M(11648),h=M(11403);class W{get materialDefines(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(K=this._getDrawWrapper())||void 0===K?void 0:K.defines}set materialDefines(K){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=K}_getDrawWrapper(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K??this._engine.currentRenderPassId;let M=this._drawWrappers[K];return!M&&H&&(this._drawWrappers[K]=M=new h.c(this._mesh.sK().getEngine())),M}_removeDrawWrapper(K){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var M;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(M=this._drawWrappers[K])||void 0===M||M.dispose(H));this._drawWrappers[K]=void 0}get effect(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(K=this._getDrawWrapper())||void 0===K?void 0:K.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(K){this._mainDrawWrapperOverride=K}setEffect(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=this._drawWrapper;w.setEffect(K,H,q),void 0!==M&&(w.materialContext=M),K||(w.defines=null,w.materialContext=void 0)}resetDrawCache(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==K)return void this._removeDrawWrapper(K,!0,H);for(const K of this._drawWrappers)null===K||void 0===K||K.dispose(H)}this._drawWrappers=[]}static AddToMesh(K,H,M,q,w,u,y){return new W(K,H,M,q,w,u,y,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(K,H,M,q,w,u,y){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],W=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=K,this.verticesStart=H,this.verticesCount=M,this.indexStart=q,this.indexCount=w,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=u,this._renderingMesh=y||u,W&&u.yh.push(this),this._engine=this._mesh.sK().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=u.yh.length-1,h&&(this.refreshBoundingInfo(),u.zh(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(K){return this._boundingInfo=K,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const K=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return K||this._renderingMesh}pK(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!H)return K&&this._mesh.sK()._hasDefaultMaterial?this._mesh.sK().defaultMaterial:null;if(this._isMultiMaterial(H)){const K=H.getSubMaterial(this.materialIndex);return this._currentMaterial!==K&&(this._currentMaterial=K,this.resetDrawCache()),K}return H}_isMultiMaterial(K){return void 0!==K.getSubMaterial}refreshBoundingInfo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Gh)return this;if(K||(K=this._renderingMesh.getVerticesData(q.d.PositionKind)),!K)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const H=this._renderingMesh.ah();let M;if(0===this.indexStart&&this.indexCount===H.length){const K=this._renderingMesh.getBoundingInfo();M={minimum:K.minimum.clone(),maximum:K.maximum.clone()}}else M=(0,y.e)(K,H,this.indexStart,this.indexCount,this._renderingMesh.Gh.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(M.minimum,M.maximum):this._boundingInfo=new u.d(M.minimum,M.maximum),this}_checkCollision(K){return this.getBoundingInfo()._checkCollision(K)}updateBoundingInfo(K){let H=this.getBoundingInfo();return H||(this.refreshBoundingInfo(),H=this.getBoundingInfo()),H&&H.update(K),this}isInFrustum(K){const H=this.getBoundingInfo();return!!H&&H.isInFrustum(K,this._mesh.Nz)}isCompletelyInFrustum(K){const H=this.getBoundingInfo();return!!H&&H.isCompletelyInFrustum(K)}render(K){return this._renderingMesh.render(this,K,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(K,H){if(!this._linesIndexBuffer){const M=6*Math.floor(this.indexCount/3),q=this.verticesStart+this.verticesCount>65535?new Uint32Array(M):new Uint16Array(M);let w=0;if(0===K.length)for(let K=this.indexStart;K<this.indexStart+this.indexCount;K+=3)q[w++]=K,q[w++]=K+1,q[w++]=K+1,q[w++]=K+2,q[w++]=K+2,q[w++]=K;else for(let H=this.indexStart;H<this.indexStart+this.indexCount;H+=3)q[w++]=K[H],q[w++]=K[H+1],q[w++]=K[H+1],q[w++]=K[H+2],q[w++]=K[H+2],q[w++]=K[H];this._linesIndexBuffer=H.createIndexBuffer(q),this._linesIndexCount=q.length}return this._linesIndexBuffer}canIntersects(K){const H=this.getBoundingInfo();return!!H&&K.intersectsBox(H.boundingBox)}intersects(K,H,M,q,w){const u=this.pK();if(!u)return null;let y=3,h=!1;switch(u.fillMode){case 3:case 5:case 6:case 8:return null;case 7:y=1,h=!0}return 4===u.fillMode?M.length?this._intersectLines(K,H,M,this._mesh.intersectionThreshold,q):this._intersectUnIndexedLines(K,H,M,this._mesh.intersectionThreshold,q):!M.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(K,H,M,q,w):this._intersectTriangles(K,H,M,y,h,q,w)}_intersectLines(K,H,M,q,u){let y=null;for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=2){const W=H[M[h]],I=H[M[h+1]],f=K.intersectionSegment(W,I,q);if(!(f<0)&&((u||!y||f<y.distance)&&(y=new w.d(null,null,f),y.faceId=h/2,u)))break}return y}_intersectUnIndexedLines(K,H,M,q,u){let y=null;for(let h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=2){const M=H[h],W=H[h+1],I=K.intersectionSegment(M,W,q);if(!(I<0)&&((u||!y||I<y.distance)&&(y=new w.d(null,null,I),y.faceId=h/2,u)))break}return y}_intersectTriangles(K,H,M,q,w,u,y){let h=null,W=-1;for(let I=this.indexStart;I<this.indexStart+this.indexCount-(3-q);I+=q){W++;const q=M[I],f=M[I+1],z=M[I+2];if(w&&4294967295===z){I+=2;continue}const G=H[q],a=H[f],v=H[z];if(!G||!a||!v)continue;if(y&&!y(G,a,v,K,q,f,z))continue;const O=K.intersectsTriangle(G,a,v);if(O){if(O.distance<0)continue;if((u||!h||O.distance<h.distance)&&(h=O,h.faceId=W,u))break}}return h}_intersectUnIndexedTriangles(K,H,M,q,w){let u=null;for(let y=this.verticesStart;y<this.verticesStart+this.verticesCount;y+=3){const M=H[y],h=H[y+1],W=H[y+2];if(w&&!w(M,h,W,K,-1,-1,-1))continue;const I=K.intersectsTriangle(M,h,W);if(I){if(I.distance<0)continue;if((q||!u||I.distance<u.distance)&&(u=I,u.faceId=y/3,q))break}}return u}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(K,H){const M=new W(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,K,H,!1);if(!this.IsGlobal){const K=this.getBoundingInfo();if(!K)return M;M._boundingInfo=new u.d(K.minimum,K.maximum)}return M}dispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.sK().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const H=this._mesh.yh.indexOf(this);this._mesh.yh.splice(H,1),this.resetDrawCache(void 0,K)}getClassName(){return"SubMesh"}static CreateFromIndices(K,H,M,q,w){let u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=Number.MAX_VALUE,h=-Number.MAX_VALUE;const I=(w||q).ah();for(let W=H;W<H+M;W++){const K=I[W];K<y&&(y=K),K>h&&(h=K)}return new W(K,y,h-y+1,H,M,q,w,u)}}}}]);