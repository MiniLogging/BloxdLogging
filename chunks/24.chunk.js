"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[24],{13089:(q,I,l)=>{l.d(I,{b:()=>w});class w{constructor(q,I,l){this.bu=q,this.bv=I,this.distance=l,this.faceId=0,this.subMeshId=0}}},13098:(q,I,l)=>{l.d(I,{e:()=>c});var w=l(12757),t=l(12747),O=l(12752);class c{constructor(q,I,l){this.vectors=(0,w.d)(8,t.dI.Zero),this.center=t.dI.Zero(),this.centerWorld=t.dI.Zero(),this.extendSize=t.dI.Zero(),this.extendSizeWorld=t.dI.Zero(),this.directions=(0,w.d)(3,t.dI.Zero),this.vectorsWorld=(0,w.d)(8,t.dI.Zero),this.minimumWorld=t.dI.Zero(),this.maximumWorld=t.dI.Zero(),this.minimum=t.dI.Zero(),this.maximum=t.dI.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(q,I,l)}reConstruct(q,I,l){const w=q.x,O=q.y,c=q.z,a=I.x,F=I.y,s=I.z,Z=this.vectors;this.minimum.gc(w,O,c),this.maximum.gc(a,F,s),Z[0].gc(w,O,c),Z[1].gc(a,F,s),Z[2].gc(a,O,c),Z[3].gc(w,F,c),Z[4].gc(w,O,s),Z[5].gc(a,F,c),Z[6].gc(w,F,s),Z[7].gc(a,O,s),I.addToRef(q,this.center).scaleInPlace(.5),I.subtractToRef(q,this.extendSize).scaleInPlace(.5),this._worldMatrix=l||t.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(q){const I=c._TmpVector3,l=this.maximum.subtractToRef(this.minimum,I[0]),w=l.length();l.normalizeFromLength(w);const t=w*q,O=l.scaleInPlace(.5*t),a=this.center.subtractToRef(O,I[1]),F=this.center.addToRef(O,I[2]);return this.reConstruct(a,F,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){const I=this.minimumWorld,l=this.maximumWorld,w=this.directions,O=this.vectorsWorld,c=this.vectors;if(q.isIdentity()){I.t(this.minimum),l.t(this.maximum);for(let q=0;q<8;++q)O[q].t(c[q]);this.extendSizeWorld.t(this.extendSize),this.centerWorld.t(this.center)}else{I.Kc(Number.MAX_VALUE),l.Kc(-Number.MAX_VALUE);for(let w=0;w<8;++w){const a=O[w];t.dI.TransformCoordinatesToRef(c[w],q,a),I.minimizeInPlace(a),l.maximizeInPlace(a)}l.subtractToRef(I,this.extendSizeWorld).scaleInPlace(.5),l.addToRef(I,this.centerWorld).scaleInPlace(.5)}t.dI.FromArrayToRef(q.m,0,w[0]),t.dI.FromArrayToRef(q.m,4,w[1]),t.dI.FromArrayToRef(q.m,8,w[2]),this._worldMatrix=q}isInFrustum(q){return c.IsInFrustum(this.vectorsWorld,q)}isCompletelyInFrustum(q){return c.IsCompletelyInFrustum(this.vectorsWorld,q)}intersectsPoint(q){const I=this.minimumWorld,l=this.maximumWorld,w=I.x,t=I.y,c=I.z,a=l.x,F=l.y,s=l.z,Z=q.x,r=q.y,x=q.z,o=-O.d;return!(a-Z<o||o>Z-w)&&(!(F-r<o||o>r-t)&&!(s-x<o||o>x-c))}intersectsSphere(q){return c.IntersectsSphere(this.minimumWorld,this.maximumWorld,q.centerWorld,q.radiusWorld)}intersectsMinMax(q,I){const l=this.minimumWorld,w=this.maximumWorld,t=l.x,O=l.y,c=l.z,a=w.x,F=w.y,s=w.z,Z=q.x,r=q.y,x=q.z,o=I.x,d=I.y,T=I.z;return!(a<Z||t>o)&&(!(F<r||O>d)&&!(s<x||c>T))}dispose(){var q,I;null===(q=this._drawWrapperFront)||void 0===q||q.dispose(),null===(I=this._drawWrapperBack)||void 0===I||I.dispose()}static Intersects(q,I){return q.intersectsMinMax(I.minimumWorld,I.maximumWorld)}static IntersectsSphere(q,I,l,w){const O=c._TmpVector3[0];t.dI.ClampToRef(l,q,I,O);return t.dI.DistanceSquared(l,O)<=w*w}static IsCompletelyInFrustum(q,I){for(let l=0;l<6;++l){const w=I[l];for(let I=0;I<8;++I)if(w.dotCoordinate(q[I])<0)return!1}return!0}static IsInFrustum(q,I){for(let l=0;l<6;++l){let w=!0;const t=I[l];for(let I=0;I<8;++I)if(t.dotCoordinate(q[I])>=0){w=!1;break}if(w)return!1}return!0}}c._TmpVector3=(0,w.d)(3,t.dI.Zero)},13096:(q,I,l)=>{l.d(I,{b:()=>r});var w=l(12757),t=l(12747),O=l(13098),c=l(13103);const a={min:0,max:0},F={min:0,max:0},s=(q,I,l)=>{const w=t.dI.Dot(I.centerWorld,q),O=Math.abs(t.dI.Dot(I.directions[0],q))*I.extendSize.x+Math.abs(t.dI.Dot(I.directions[1],q))*I.extendSize.y+Math.abs(t.dI.Dot(I.directions[2],q))*I.extendSize.z;l.min=w-O,l.max=w+O},Z=(q,I,l)=>(s(q,I,a),s(q,l,F),!(a.min>F.max||F.min>a.max));class r{constructor(q,I,l){this._isLocked=!1,this.boundingBox=new O.e(q,I,l),this.boundingSphere=new c.e(q,I,l)}reConstruct(q,I,l){this.boundingBox.reConstruct(q,I,l),this.boundingSphere.reConstruct(q,I,l)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(q){this._isLocked=q}update(q){this._isLocked||(this.boundingBox._update(q),this.boundingSphere._update(q))}centerOn(q,I){const l=r._TmpVector3[0].t(q).Sr(I),w=r._TmpVector3[1].t(q).addInPlace(I);return this.boundingBox.reConstruct(l,w,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(l,w,this.boundingBox.getWorldMatrix()),this}encapsulate(q){const I=t.dI.Minimize(this.minimum,q),l=t.dI.Maximize(this.maximum,q);return this.reConstruct(I,l,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(q){const I=t.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(I);const l=t.TmpVectors.dI[0];return t.dI.TransformCoordinatesToRef(q.boundingBox.minimumWorld,I,l),this.encapsulate(l),t.dI.TransformCoordinatesToRef(q.boundingBox.maximumWorld,I,l),this.encapsulate(l),this}scale(q){return this.boundingBox.scale(q),this.boundingSphere.scale(q),this}isInFrustum(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===I||3===I)&&this.boundingSphere.isCenterInFrustum(q))return!0;if(!this.boundingSphere.isInFrustum(q))return!1;return!(1!==I&&3!==I)||this.boundingBox.isInFrustum(q)}get diagonalLength(){const q=this.boundingBox;return q.maximumWorld.subtractToRef(q.minimumWorld,r._TmpVector3[0]).length()}isCompletelyInFrustum(q){return this.boundingBox.isCompletelyInFrustum(q)}_checkCollision(q){return q._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(q){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(q)&&!!this.boundingBox.intersectsPoint(q))}intersects(q,I){if(!c.e.Intersects(this.boundingSphere,q.boundingSphere))return!1;if(!O.e.Intersects(this.boundingBox,q.boundingBox))return!1;if(!I)return!0;const l=this.boundingBox,w=q.boundingBox;return!!Z(l.directions[0],l,w)&&(!!Z(l.directions[1],l,w)&&(!!Z(l.directions[2],l,w)&&(!!Z(w.directions[0],l,w)&&(!!Z(w.directions[1],l,w)&&(!!Z(w.directions[2],l,w)&&(!!Z(t.dI.Cross(l.directions[0],w.directions[0]),l,w)&&(!!Z(t.dI.Cross(l.directions[0],w.directions[1]),l,w)&&(!!Z(t.dI.Cross(l.directions[0],w.directions[2]),l,w)&&(!!Z(t.dI.Cross(l.directions[1],w.directions[0]),l,w)&&(!!Z(t.dI.Cross(l.directions[1],w.directions[1]),l,w)&&(!!Z(t.dI.Cross(l.directions[1],w.directions[2]),l,w)&&(!!Z(t.dI.Cross(l.directions[2],w.directions[0]),l,w)&&(!!Z(t.dI.Cross(l.directions[2],w.directions[1]),l,w)&&!!Z(t.dI.Cross(l.directions[2],w.directions[2]),l,w))))))))))))))}}r._TmpVector3=(0,w.d)(2,t.dI.Zero)},13103:(q,I,l)=>{l.d(I,{e:()=>O});var w=l(12757),t=l(12747);class O{constructor(q,I,l){this.center=t.dI.Zero(),this.centerWorld=t.dI.Zero(),this.minimum=t.dI.Zero(),this.maximum=t.dI.Zero(),this.reConstruct(q,I,l)}reConstruct(q,I,l){this.minimum.t(q),this.maximum.t(I);const w=t.dI.Distance(q,I);I.addToRef(q,this.center).scaleInPlace(.5),this.radius=.5*w,this._update(l||t.Matrix.IdentityReadOnly)}scale(q){const I=this.radius*q,l=O._TmpVector3,w=l[0].Kc(I),t=this.center.subtractToRef(w,l[1]),c=this.center.addToRef(w,l[2]);return this.reConstruct(t,c,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){if(q.isIdentity())this.centerWorld.t(this.center),this.radiusWorld=this.radius;else{t.dI.TransformCoordinatesToRef(this.center,q,this.centerWorld);const I=O._TmpVector3[0];t.dI.TransformNormalFromFloatsToRef(1,1,1,q,I),this.radiusWorld=Math.max(Math.abs(I.x),Math.abs(I.y),Math.abs(I.z))*this.radius}}isInFrustum(q){const I=this.centerWorld,l=this.radiusWorld;for(let w=0;w<6;w++)if(q[w].dotCoordinate(I)<=-l)return!1;return!0}isCenterInFrustum(q){const I=this.centerWorld;for(let l=0;l<6;l++)if(q[l].dotCoordinate(I)<0)return!1;return!0}intersectsPoint(q){const I=t.dI.DistanceSquared(this.centerWorld,q);return!(this.radiusWorld*this.radiusWorld<I)}static Intersects(q,I){const l=t.dI.DistanceSquared(q.centerWorld,I.centerWorld),w=q.radiusWorld+I.radiusWorld;return!(w*w<l)}static CreateFromCenterAndRadius(q,I,l){this._TmpVector3[0].t(q),this._TmpVector3[1].gc(0,0,I),this._TmpVector3[2].t(q),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Sr(this._TmpVector3[1]);const w=new O(this._TmpVector3[0],this._TmpVector3[2]);return w._worldMatrix=l||t.Matrix.Identity(),w}}O._TmpVector3=(0,w.d)(3,t.dI.Zero)},13116:(q,I,l)=>{function w(q){-1===q.indexOf("vClipPlane")&&q.push("vClipPlane"),-1===q.indexOf("vClipPlane2")&&q.push("vClipPlane2"),-1===q.indexOf("vClipPlane3")&&q.push("vClipPlane3"),-1===q.indexOf("vClipPlane4")&&q.push("vClipPlane4"),-1===q.indexOf("vClipPlane5")&&q.push("vClipPlane5"),-1===q.indexOf("vClipPlane6")&&q.push("vClipPlane6")}function t(q,I,l){const w=!!(q.clipPlane??I.clipPlane),t=!!(q.clipPlane2??I.clipPlane2),O=!!(q.clipPlane3??I.clipPlane3),c=!!(q.clipPlane4??I.clipPlane4),a=!!(q.clipPlane5??I.clipPlane5),F=!!(q.clipPlane6??I.clipPlane6);w&&l.push("#define CLIPPLANE"),t&&l.push("#define CLIPPLANE2"),O&&l.push("#define CLIPPLANE3"),c&&l.push("#define CLIPPLANE4"),a&&l.push("#define CLIPPLANE5"),F&&l.push("#define CLIPPLANE6")}function O(q,I,l){let w=!1;const t=!!(q.clipPlane??I.clipPlane),O=!!(q.clipPlane2??I.clipPlane2),c=!!(q.clipPlane3??I.clipPlane3),a=!!(q.clipPlane4??I.clipPlane4),F=!!(q.clipPlane5??I.clipPlane5),s=!!(q.clipPlane6??I.clipPlane6);return l.CLIPPLANE!==t&&(l.CLIPPLANE=t,w=!0),l.CLIPPLANE2!==O&&(l.CLIPPLANE2=O,w=!0),l.CLIPPLANE3!==c&&(l.CLIPPLANE3=c,w=!0),l.CLIPPLANE4!==a&&(l.CLIPPLANE4=a,w=!0),l.CLIPPLANE5!==F&&(l.CLIPPLANE5=F,w=!0),l.CLIPPLANE6!==s&&(l.CLIPPLANE6=s,w=!0),w}function c(q,I,l){let w=I.clipPlane??l.clipPlane;a(q,"vClipPlane",w),w=I.clipPlane2??l.clipPlane2,a(q,"vClipPlane2",w),w=I.clipPlane3??l.clipPlane3,a(q,"vClipPlane3",w),w=I.clipPlane4??l.clipPlane4,a(q,"vClipPlane4",w),w=I.clipPlane5??l.clipPlane5,a(q,"vClipPlane5",w),w=I.clipPlane6??l.clipPlane6,a(q,"vClipPlane6",w)}function a(q,I,l){l&&q.setFloat4(I,l.normal.x,l.normal.y,l.normal.z,l.d)}l.d(I,{b:()=>w,c:()=>c,g:()=>O,k:()=>t})},13059:(q,I,l)=>{l.d(I,{b:()=>w});class w{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(q,I){this._defines[q]||(q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q),this._defines[q]=new Array),this._defines[q].push(I)}addCPUSkinningFallback(q,I){this._mesh=I,q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(q,I){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,q=q.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),I._bonesComputationForcedToCPU=!0;const l=this._mesh.Wq();for(let q=0;q<l.meshes.length;q++){const w=l.meshes[q];if(w.material){if(w.computeBonesUsingShaders&&0!==w.numBoneInfluencers)if(w.material.getEffect()===I)w.computeBonesUsingShaders=!1;else if(w.Tc)for(const q of w.Tc){if(q.effect===I){w.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&w.computeBonesUsingShaders&&w.numBoneInfluencers>0&&(w.computeBonesUsingShaders=!1)}}else{const I=this._defines[this._currentRank];if(I)for(let l=0;l<I.length;l++)q=q.replace("#define "+I[l],"");this._currentRank++}return q}}},13074:(q,I,l)=>{l.d(I,{c:()=>V});var w=l(12735),t=l(12740),O=l(12564),c=l(12573),a=l(12612),F=l(13082),s=l(13009),Z=l(12591),r=l(12794),x=l(12865),o=l(12777);class d{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(q){this._func=q}get funcRef(){return this._funcRef}set funcRef(q){this._funcRef=q}get funcMask(){return this._funcMask}set funcMask(q){this._funcMask=q}get opStencilFail(){return this._opStencilFail}set opStencilFail(q){this._opStencilFail=q}get opDepthFail(){return this._opDepthFail}set opDepthFail(q){this._opDepthFail=q}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(q){this._opStencilDepthPass=q}get mask(){return this._mask}set mask(q){this._mask=q}get enabled(){return this._enabled}set enabled(q){this._enabled=q}getClassName(){return"MaterialStencilState"}copyTo(q){o.c.Clone((()=>q),this)}serialize(){return o.c.Serialize(this)}parse(q,I,l){o.c.Parse((()=>this),q,I,l)}}(0,w.d)([(0,t.D)()],d.prototype,"func",null),(0,w.d)([(0,t.D)()],d.prototype,"funcRef",null),(0,w.d)([(0,t.D)()],d.prototype,"funcMask",null),(0,w.d)([(0,t.D)()],d.prototype,"opStencilFail",null),(0,w.d)([(0,t.D)()],d.prototype,"opDepthFail",null),(0,w.d)([(0,t.D)()],d.prototype,"opStencilDepthPass",null),(0,w.d)([(0,t.D)()],d.prototype,"mask",null),(0,w.d)([(0,t.D)()],d.prototype,"enabled",null);var T=l(13109);class V{get _supportGlowLayer(){return!1}set _glowModeEnabled(q){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(q){if(this._alpha===q)return;const I=this._alpha;this._alpha=q,1!==I&&1!==q||this.TZ(V.MiscDirtyFlag+V.PrePassDirtyFlag)}get alpha(){return this._alpha}set Sc(q){this._backFaceCulling!==q&&(this._backFaceCulling=q,this.TZ(V.TextureDirtyFlag))}get Sc(){return this._backFaceCulling}set cullBackFaces(q){this._cullBackFaces!==q&&(this._cullBackFaces=q,this.TZ(V.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(q){this._blockDirtyMechanism!==q&&(this._blockDirtyMechanism=q,q||this.vx())}atomicMaterialsUpdate(q){this.blockDirtyMechanism=!0;try{q(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(q){this._onDisposeObserver&&this.tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.tc.add(q)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new c.d),this._onBindObservable}set onBind(q){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(q)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new c.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new c.d),this._onEffectCreatedObservable}set alphaMode(q){this._alphaMode!==q&&(this._alphaMode=q,this.TZ(V.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(q){this._needDepthPrePass!==q&&(this._needDepthPrePass=q,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(q){this._fogEnabled!==q&&(this._fogEnabled=q,this.TZ(V.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case V.WireFrameFillMode:case V.LineListDrawMode:case V.LineLoopDrawMode:case V.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(q){this.fillMode=q?V.WireFrameFillMode:V.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case V.PointFillMode:case V.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(q){this.fillMode=q?V.PointFillMode:V.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(q){this._fillMode!==q&&(this._fillMode=q,this.TZ(V.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){const I=this.Wq().getEngine().getCaps().fragmentDepthSupported;q&&!I&&Z.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=q&&I,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(q){this._drawWrapper=q}constructor(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.tc=new c.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.cc=new d,this._useUBO=!1,this._fillMode=V.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=q;const t=I||a.e.LastCreatedScene;t&&(this._scene=t,this._dirtyCallbacks={},this._forceGLSL=w,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=q||O.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new x.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new s.c(this._scene.getEngine(),void 0,void 0,q),this._useUBO=this.Wq().getEngine().supportsUniformBuffers,this._createUniformBuffer(),l||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),V.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var q;const I=this.Wq().getEngine();null===(q=this._uniformBuffer)||void 0===q||q.dispose(),I.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new s.c(I,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new s.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(q){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.vx(),this.checkReadyOnlyOnce=!0}unfreeze(){this.vx(),this.checkReadyOnlyOnce=!1}isReady(q,I){return!0}isReadyForSubMesh(q,I,l){const w=I.materialDefines;return!!w&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=w,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Wq(){return this._scene}_getEffectiveOrientation(q){return null!==this.sideOrientation?this.sideOrientation:q.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(q){this._transparencyMode!==q&&(this._transparencyMode=q,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===V.MATERIAL_ALPHABLEND||this._transparencyMode===V.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===V.MATERIAL_ALPHATEST||this._transparencyMode===V.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===V.MATERIAL_OPAQUE||this._transparencyMode===V.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsBlend:q.visibility<1||!this._disableAlphaBlending&&(q.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(q)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}vx(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I=this.Wq().meshes;for(const l of I)if(l.Tc)for(const I of l.Tc)if(I.Lq()===this)for(const l of I._drawWrappers)l&&this._materialContext===l.materialContext&&(l._wasPreviouslyReady=!1,l._wasPreviouslyUsingInstances=null,l._forceRebindOnNextCall=q);q&&this.TZ(V.AllDirtyFlag)}_preBind(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this._scene.getEngine(),w=(null==I?this.sideOrientation:I)===V.ClockWiseSideOrientation;return l.enableEffect(q||this._getDrawWrapper()),l.setState(this.Sc,this.zOffset,!1,w,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.cc,this.zOffsetUnits),w}bind(q,I){}buildUniformLayout(){const q=this._uniformBuffer;this._eventInfo.ubo=q,this._callbackPluginEventGeneric(8,this._eventInfo),q.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(q,I,l){const w=l._drawWrapper;this._eventInfo.subMesh=l,this._callbackPluginEventBindForSubMesh(this._eventInfo),w._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(q){}bindView(q){this._useUBO?this._needToBindSceneUbo=!0:q.setMatrix("view",this.Wq().getViewMatrix())}bindViewProjection(q){this._useUBO?this._needToBindSceneUbo=!0:(q.setMatrix("viewProjection",this.Wq().getTransformMatrix()),q.setMatrix("projection",this.Wq().getProjectionMatrix()))}bindEyePosition(q,I){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(q,I)}_afterBind(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&I&&(this._needToBindSceneUbo=!1,(0,T.t)(I,this.Wq().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=q?q.visibility:1,this._onBindObservable&&q&&this._onBindObservable.notifyObservers(q),this.disableDepthWrite){const q=this._scene.getEngine();this._cachedDepthWriteState=q.getDepthWrite(),q.setDepthWrite(!1)}if(this.disableColorWrite){const q=this._scene.getEngine();this._cachedColorWriteState=q.getColorWrite(),q.setColorWrite(!1)}if(0!==this.depthFunction){const q=this._scene.getEngine();this._cachedDepthFunctionState=q.getDepthFunction()||0,q.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(q){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=q,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(q){return null}_clonePlugins(q,I){const l={};if(this._serializePlugins(l),V._ParsePlugins(l,q,this._scene,I),this.pluginManager)for(const w of this.pluginManager._plugins){const I=q.pluginManager.getPlugin(w.name);I&&w.copyTo(I)}}getBindedMeshes(){if(this.meshMap){const q=[];for(const I in this.meshMap){const l=this.meshMap[I];l&&q.push(l)}return q}return this._scene.meshes.filter((q=>q.material===this))}forceCompilation(q,I,l,w){const t={clipPlane:!1,useInstances:!1,...l},O=this.Wq(),c=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const a=()=>{if(!this._scene||!this._scene.getEngine())return;const l=O.clipPlane;if(t.clipPlane&&(O.clipPlane=new r.c(0,0,0,1)),this._storeEffectOnSubMeshes){let l=!0,O=null;if(q.Tc){const I=new F.e(0,0,0,0,0,q,void 0,!1,!1);I.materialDefines&&(I.materialDefines._renderId=-1),this.isReadyForSubMesh(q,I,t.useInstances)||(I.effect&&I.effect.getCompilationError()&&I.effect.allFallbacksProcessed()?O=I.effect.getCompilationError():(l=!1,setTimeout(a,16)))}l&&(this.allowShaderHotSwapping=c,O&&w&&w(O),I&&I(this))}else this.isReady()?(this.allowShaderHotSwapping=c,I&&I(this)):setTimeout(a,16);t.clipPlane&&(O.clipPlane=l)};a()}async forceCompilationAsync(q,I){return await new Promise(((l,w)=>{this.forceCompilation(q,(()=>{l()}),I,(q=>{w(q)}))}))}TZ(q){this.Wq().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(V._DirtyCallbackArray.length=0,q&V.ImageProcessingDirtyFlag&&V._DirtyCallbackArray.push(V._ImageProcessingDirtyCallBack),q&V.TextureDirtyFlag&&V._DirtyCallbackArray.push(V._TextureDirtyCallBack),q&V.LightDirtyFlag&&V._DirtyCallbackArray.push(V._LightsDirtyCallBack),q&V.FresnelDirtyFlag&&V._DirtyCallbackArray.push(V._FresnelDirtyCallBack),q&V.AttributesDirtyFlag&&V._DirtyCallbackArray.push(V._AttributeDirtyCallBack),q&V.MiscDirtyFlag&&V._DirtyCallbackArray.push(V._MiscDirtyCallBack),q&V.PrePassDirtyFlag&&V._DirtyCallbackArray.push(V._PrePassDirtyCallBack),V._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(V._RunDirtyCallBacks),this.Wq().resetCachedMaterial())}resetDrawCache(){const q=this.Wq().meshes;for(const I of q)if(I.Tc)for(const q of I.Tc)q.Lq()===this&&q.resetDrawCache()}_markAllSubMeshesAsDirty(q){const I=this.Wq();if(I.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const l=I.meshes;for(const w of l)if(w.Tc)for(const l of w.Tc){if((l.Lq()||(I._hasDefaultMaterial?I.defaultMaterial:null))===this)for(const I of l._drawWrappers)I&&I.defines&&I.defines.markAllAsDirty&&this._materialContext===I.materialContext&&q(I.defines)}}_markScenePrePassDirty(){if(this.Wq().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const q=this.Wq().enablePrePassRenderer();q&&q.TZ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(V._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(V._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(V._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(V._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(V._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(V._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(V._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(V._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(V._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(V._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const q=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.tc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(q)}))}}setPrePassRenderer(q){return!1}dispose(q,I,l){const w=this.Wq();if(w.stopAnimation(this),w.freeProcessedMaterials(),w.removeMaterial(this),this._eventInfo.forceDisposeTextures=I,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const q=this._parentContainer.materials.indexOf(this);q>-1&&this._parentContainer.materials.splice(q,1),this._parentContainer=null}if(!0!==l)if(this.meshMap)for(const t in this.meshMap){const q=this.meshMap[t];this._disposeMeshResources(q)}else{const q=w.meshes;for(const I of q)this._disposeMeshResources(I)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.tc.notifyObservers(this),this.tc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(q){if(!q)return;const I=q.Wc,l=q._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(q.Tc&&l)for(const t of q.Tc){const q=t._drawWrappers;for(let O=0;O<q.length;O++){var w;const c=null===(w=q[O])||void 0===w?void 0:w.effect;if(!c)continue;l[O]===this&&(null===I||void 0===I||I._releaseVertexArrayObject(c),t._removeDrawWrapper(O,!0,!0))}}}else null===I||void 0===I||I._releaseVertexArrayObject(this._drawWrapper.effect);q.material!==this||q.sourceMesh||(q.material=null)}serialize(){const q=o.c.Serialize(this);return q.cc=this.cc.serialize(),q.uniqueId=this.uniqueId,this._serializePlugins(q),q}_serializePlugins(q){if(q.plugins={},this.pluginManager)for(const I of this.pluginManager._plugins)I.doNotSerialize||(q.plugins[I.getClassName()]=I.serialize())}static Parse(q,I,l){if(q.customType){if("BABYLON.PBRMaterial"===q.customType&&q.overloadedAlbedo&&(q.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Z.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else q.customType="BABYLON.StandardMaterial";const w=O.Tools.Instantiate(q.customType).Parse(q,I,l);return w._loadedUniqueId=q.uniqueId,w}static _ParsePlugins(q,I,l,w){if(q.plugins)for(const a in q.plugins){var t,c;const F=q.plugins[a];let s=null===(t=I.pluginManager)||void 0===t?void 0:t.getPlugin(F.name);if(!s){const q=O.Tools.Instantiate("BABYLON."+a);q&&(s=new q(I))}null===(c=s)||void 0===c||c.parse(F,l,w)}}}V.TriangleFillMode=0,V.WireFrameFillMode=1,V.PointFillMode=2,V.PointListDrawMode=3,V.LineListDrawMode=4,V.LineLoopDrawMode=5,V.LineStripDrawMode=6,V.TriangleStripDrawMode=7,V.TriangleFanDrawMode=8,V.ClockWiseSideOrientation=0,V.CounterClockWiseSideOrientation=1,V.ImageProcessingDirtyFlag=64,V.TextureDirtyFlag=1,V.LightDirtyFlag=2,V.FresnelDirtyFlag=4,V.AttributesDirtyFlag=8,V.MiscDirtyFlag=16,V.PrePassDirtyFlag=32,V.AllDirtyFlag=127,V.MATERIAL_OPAQUE=0,V.MATERIAL_ALPHATEST=1,V.MATERIAL_ALPHABLEND=2,V.MATERIAL_ALPHATESTANDBLEND=3,V.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,V.MATERIAL_NORMALBLENDMETHOD_RNM=1,V.OnEventObservable=new c.d,V._AllDirtyCallBack=q=>q.markAllAsDirty(),V._ImageProcessingDirtyCallBack=q=>q.markAsImageProcessingDirty(),V._TextureDirtyCallBack=q=>q.markAsTexturesDirty(),V._FresnelDirtyCallBack=q=>q.markAsFresnelDirty(),V._MiscDirtyCallBack=q=>q.markAsMiscDirty(),V._PrePassDirtyCallBack=q=>q.markAsPrePassDirty(),V._LightsDirtyCallBack=q=>q.markAsLightDirty(),V._AttributeDirtyCallBack=q=>q.markAsAttributesDirty(),V._FresnelAndMiscDirtyCallBack=q=>{V._FresnelDirtyCallBack(q),V._MiscDirtyCallBack(q)},V._TextureAndMiscDirtyCallBack=q=>{V._TextureDirtyCallBack(q),V._MiscDirtyCallBack(q)},V._DirtyCallbackArray=[],V._RunDirtyCallBacks=q=>{for(const I of V._DirtyCallbackArray)I(q)},(0,w.d)([(0,t.D)()],V.prototype,"id",void 0),(0,w.d)([(0,t.D)()],V.prototype,"uniqueId",void 0),(0,w.d)([(0,t.D)()],V.prototype,"name",void 0),(0,w.d)([(0,t.D)()],V.prototype,"metadata",void 0),(0,w.d)([(0,t.D)()],V.prototype,"checkReadyOnEveryCall",void 0),(0,w.d)([(0,t.D)()],V.prototype,"checkReadyOnlyOnce",void 0),(0,w.d)([(0,t.D)()],V.prototype,"state",void 0),(0,w.d)([(0,t.D)("alpha")],V.prototype,"_alpha",void 0),(0,w.d)([(0,t.D)("Sc")],V.prototype,"_backFaceCulling",void 0),(0,w.d)([(0,t.D)("cullBackFaces")],V.prototype,"_cullBackFaces",void 0),(0,w.d)([(0,t.D)()],V.prototype,"sideOrientation",void 0),(0,w.d)([(0,t.D)("alphaMode")],V.prototype,"_alphaMode",void 0),(0,w.d)([(0,t.D)()],V.prototype,"_needDepthPrePass",void 0),(0,w.d)([(0,t.D)()],V.prototype,"disableDepthWrite",void 0),(0,w.d)([(0,t.D)()],V.prototype,"disableColorWrite",void 0),(0,w.d)([(0,t.D)()],V.prototype,"forceDepthWrite",void 0),(0,w.d)([(0,t.D)()],V.prototype,"depthFunction",void 0),(0,w.d)([(0,t.D)()],V.prototype,"separateCullingPass",void 0),(0,w.d)([(0,t.D)("fogEnabled")],V.prototype,"_fogEnabled",void 0),(0,w.d)([(0,t.D)()],V.prototype,"pointSize",void 0),(0,w.d)([(0,t.D)()],V.prototype,"zOffset",void 0),(0,w.d)([(0,t.D)()],V.prototype,"zOffsetUnits",void 0),(0,w.d)([(0,t.D)()],V.prototype,"pointsCloud",null),(0,w.d)([(0,t.D)()],V.prototype,"fillMode",null),(0,w.d)([(0,t.D)()],V.prototype,"useLogarithmicDepth",null),(0,w.d)([(0,t.D)()],V.prototype,"transparencyMode",null)},13109:(q,I,l)=>{l.d(I,{B:()=>i,E:()=>v,G:()=>W,I:()=>e,L:()=>o,P:()=>x,S:()=>K,T:()=>X,X:()=>g,Y:()=>U,_:()=>S,c:()=>k,cb:()=>D,f:()=>r,fb:()=>M,i:()=>R,jb:()=>n,kb:()=>L,l:()=>Z,ob:()=>d,p:()=>T,t:()=>V,x:()=>B});var w=l(12591),t=l(12789),O=l(12612),c=l(13056),a=l(13116);const F=t.BI.Black(),s={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function Z(q,I,l){if(!q||q.LOGARITHMICDEPTH||q.indexOf&&q.indexOf("LOGARITHMICDEPTH")>=0){const q=l.activeCamera;1===q.mode&&w.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),I.setFloat("logarithmicDepthConstant",2/(Math.log(q.maxZ+1)/Math.LN2))}}function r(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];l&&q.fogEnabled&&(!I||I.applyFog)&&0!==q.fogMode&&(l.setFloat4("vFogInfos",q.fogMode,q.fogStart,q.fogEnd,q.fogDensity),w?(q.fogColor.toLinearSpaceToRef(F,q.getEngine().useExactSrgbConversions),l.setColor3("vFogColor",F)):l.setColor3("vFogColor",q.fogColor))}function x(q,I,l,w,t,O,c,a,F,Z){const r=q.numMaxInfluencers||q.numInfluencers;return r<=0?0:(I.push("#define MORPHTARGETS"),q.hasPositions&&I.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),q.hasNormals&&I.push("#define MORPHTARGETTEXTURE_HASNORMALS"),q.hasTangents&&I.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),q.hasUVs&&I.push("#define MORPHTARGETTEXTURE_HASUVS"),q.hasUV2s&&I.push("#define MORPHTARGETTEXTURE_HASUV2S"),q.hasColors&&I.push("#define MORPHTARGETTEXTURE_HASCOLORS"),q.supportsPositions&&t&&I.push("#define MORPHTARGETS_POSITION"),q.supportsNormals&&O&&I.push("#define MORPHTARGETS_NORMAL"),q.supportsTangents&&c&&I.push("#define MORPHTARGETS_TANGENT"),q.supportsUVs&&a&&I.push("#define MORPHTARGETS_UV"),q.supportsUV2s&&F&&I.push("#define MORPHTARGETS_UV2"),q.supportsColors&&Z&&I.push("#define MORPHTARGETS_COLOR"),I.push("#define NUM_MORPH_INFLUENCERS "+r),q.isUsingTextureForTargets&&I.push("#define MORPHTARGETS_TEXTURE"),s.NUM_MORPH_INFLUENCERS=r,s.NORMAL=O,s.TANGENT=c,s.UV=a,s.UV2=F,s.COLOR=Z,o(l,w,s,t),r)}function o(q,I,l){let t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=l.NUM_MORPH_INFLUENCERS;if(c>0&&O.e.LastCreatedEngine){const a=O.e.LastCreatedEngine.getCaps().maxVertexAttribs,F=I.morphTargetManager;if(null!==F&&void 0!==F&&F.isUsingTextureForTargets)return;const s=F&&F.supportsPositions&&t,Z=F&&F.supportsNormals&&l.NORMAL,r=F&&F.supportsTangents&&l.TANGENT,x=F&&F.supportsUVs&&l.UV1,o=F&&F.supportsUV2s&&l.UV2,d=F&&F.supportsColors&&l.VERTEXCOLOR;for(let l=0;l<c;l++)s&&q.push("position"+l),Z&&q.push("normal"+l),r&&q.push("tangent"+l),x&&q.push("uv_"+l),o&&q.push("uv2_"+l),d&&q.push("color"+l),q.length>a&&w.b.Error("Cannot add more vertex attributes for mesh "+I.name)}}function d(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.push("world0"),q.push("world1"),q.push("world2"),q.push("world3"),I&&(q.push("previousWorld0"),q.push("previousWorld1"),q.push("previousWorld2"),q.push("previousWorld3"))}function T(q,I){const l=q.morphTargetManager;q&&l&&I.setFloatArray("morphTargetInfluences",l.influences)}function V(q,I){I.bindToEffect(q,"Scene")}function U(q,I,l){I._needUVs=!0,I[l]=!0,q.optimizeUVAllocation&&q.getTextureMatrix().isIdentityAs3x2()?(I[l+"DIRECTUV"]=q.coordinatesIndex+1,I["MAINUV"+(q.coordinatesIndex+1)]=!0):I[l+"DIRECTUV"]=0}function B(q,I,l){const w=q.getTextureMatrix();I.kc(l+"Matrix",w)}function v(q,I,l){l.BAKED_VERTEX_ANIMATION_TEXTURE&&l.INSTANCES&&q.push("bakedVertexAnimationSettingsInstanced")}function k(q,I,l){var w;if(I&&q&&(q.computeBonesUsingShaders&&I._bonesComputationForcedToCPU&&(q.computeBonesUsingShaders=!1),q.useBones&&q.computeBonesUsingShaders&&q.skeleton)){const t=q.skeleton;if(t.isUsingTextureForMatrices&&I.getUniformIndex("boneTextureWidth")>-1){const l=t.getTransformMatrixTexture(q);I.setTexture("boneSampler",l),I.setFloat("boneTextureWidth",4*(t.bones.length+1))}else{const O=t.getTransformMatrices(q);O&&(I.setMatrices("mBones",O),l&&q.Wq().prePassRenderer&&q.Wq().prePassRenderer.getIndex(2)&&(l.previousBones[q.uniqueId]||(l.previousBones[q.uniqueId]=O.slice()),I.setMatrices("mPreviousBones",l.previousBones[q.uniqueId]),w=O,l.previousBones[q.uniqueId].set(w)))}}}function C(q,I,l,w,t){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];q._bindLight(I,l,w,t,O)}function R(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const O=Math.min(I.lightSources.length,t);for(let c=0;c<O;c++){C(I.lightSources[c],c,q,l,"boolean"===typeof w?w:w.SPECULARTERM,I.receiveShadows)}}function W(q,I,l,w){l.NUM_BONE_INFLUENCERS>0&&(w.addCPUSkinningFallback(0,I),q.push("matricesIndices"),q.push("matricesWeights"),l.NUM_BONE_INFLUENCERS>4&&(q.push("matricesIndicesExtra"),q.push("matricesWeightsExtra")))}function e(q,I){(I.INSTANCES||I.THIN_INSTANCES)&&d(q,!!I.PREPASS_VELOCITY),I.INSTANCESCOLOR&&q.push("instanceColor")}function i(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=0;for(let O=0;O<l&&q["LIGHT"+O];O++)O>0&&(t=w+O,I.addFallback(t,"LIGHT"+O)),q.SHADOWS||(q["SHADOW"+O]&&I.addFallback(w,"SHADOW"+O),q["SHADOWPCF"+O]&&I.addFallback(w,"SHADOWPCF"+O),q["SHADOWPCSS"+O]&&I.addFallback(w,"SHADOWPCSS"+O),q["SHADOWPOISSON"+O]&&I.addFallback(w,"SHADOWPOISSON"+O),q["SHADOWESM"+O]&&I.addFallback(w,"SHADOWESM"+O),q["SHADOWCLOSEESM"+O]&&I.addFallback(w,"SHADOWCLOSEESM"+O));return t++}function S(q,I,l,w,t,O,c){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];c._areMiscDirty&&(c.LOGARITHMICDEPTH=l,c.POINTSIZE=w,c.FOG=t&&function(q,I){return I.fogEnabled&&q.applyFog&&0!==I.fogMode}(q,I),c.NONUNIFORMSCALING=q.nonUniformScaling,c.ALPHATEST=O,c.DECAL_AFTER_DETAIL=a)}function g(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!l._areLightsDirty)return l._needNormals;let c=0;const a={needNormals:l._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(q.lightsEnabled&&!O)for(const s of I.lightSources)if(p(q,I,s,c,l,w,a),c++,c===t)break;l.SPECULARTERM=a.specularEnabled,l.SHADOWS=a.shadowEnabled;for(let s=c;s<t;s++)void 0!==l["LIGHT"+s]&&(l["LIGHT"+s]=!1,l["HEMILIGHT"+s]=!1,l["POINTLIGHT"+s]=!1,l["DIRLIGHT"+s]=!1,l["SPOTLIGHT"+s]=!1,l["AREALIGHT"+s]=!1,l["SHADOW"+s]=!1,l["SHADOWCSM"+s]=!1,l["SHADOWCSMDEBUG"+s]=!1,l["SHADOWCSMNUM_CASCADES"+s]=!1,l["SHADOWCSMUSESHADOWMAXZ"+s]=!1,l["SHADOWCSMNOBLEND"+s]=!1,l["SHADOWCSM_RIGHTHANDED"+s]=!1,l["SHADOWPCF"+s]=!1,l["SHADOWPCSS"+s]=!1,l["SHADOWPOISSON"+s]=!1,l["SHADOWESM"+s]=!1,l["SHADOWCLOSEESM"+s]=!1,l["SHADOWCUBE"+s]=!1,l["SHADOWLOWQUALITY"+s]=!1,l["SHADOWMEDIUMQUALITY"+s]=!1);const F=q.getEngine().getCaps();return void 0===l.SHADOWFLOAT&&(a.needRebuild=!0),l.SHADOWFLOAT=a.shadowEnabled&&(F.textureFloatRender&&F.textureFloatLinearFiltering||F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering),l.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&l.rebuild(),a.needNormals}function p(q,I,l,w,t,O,a){switch(a.needNormals=!0,void 0===t["LIGHT"+w]&&(a.needRebuild=!0),t["LIGHT"+w]=!0,t["SPOTLIGHT"+w]=!1,t["HEMILIGHT"+w]=!1,t["POINTLIGHT"+w]=!1,t["DIRLIGHT"+w]=!1,t["AREALIGHT"+w]=!1,l.prepareLightSpecificDefines(t,w),t["LIGHT_FALLOFF_PHYSICAL"+w]=!1,t["LIGHT_FALLOFF_GLTF"+w]=!1,t["LIGHT_FALLOFF_STANDARD"+w]=!1,l.falloffType){case c.c.FALLOFF_GLTF:t["LIGHT_FALLOFF_GLTF"+w]=!0;break;case c.c.FALLOFF_PHYSICAL:t["LIGHT_FALLOFF_PHYSICAL"+w]=!0;break;case c.c.FALLOFF_STANDARD:t["LIGHT_FALLOFF_STANDARD"+w]=!0}if(O&&!l.EZ.equalsFloats(0,0,0)&&(a.specularEnabled=!0),t["SHADOW"+w]=!1,t["SHADOWCSM"+w]=!1,t["SHADOWCSMDEBUG"+w]=!1,t["SHADOWCSMNUM_CASCADES"+w]=!1,t["SHADOWCSMUSESHADOWMAXZ"+w]=!1,t["SHADOWCSMNOBLEND"+w]=!1,t["SHADOWCSM_RIGHTHANDED"+w]=!1,t["SHADOWPCF"+w]=!1,t["SHADOWPCSS"+w]=!1,t["SHADOWPOISSON"+w]=!1,t["SHADOWESM"+w]=!1,t["SHADOWCLOSEESM"+w]=!1,t["SHADOWCUBE"+w]=!1,t["SHADOWLOWQUALITY"+w]=!1,t["SHADOWMEDIUMQUALITY"+w]=!1,I&&I.receiveShadows&&q.shadowsEnabled&&l.shadowEnabled){const I=l.getShadowGenerator(q.activeCamera)??l.getShadowGenerator();if(I){const q=I.getShadowMap();q&&q.renderList&&q.renderList.length>0&&(a.shadowEnabled=!0,I.prepareDefines(t,w))}}l.lightmapMode!=c.c.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,t["LIGHTMAPEXCLUDED"+w]=!0,t["LIGHTMAPNOSPECULAR"+w]=l.lightmapMode==c.c.LIGHTMAP_SHADOWSONLY):(t["LIGHTMAPEXCLUDED"+w]=!1,t["LIGHTMAPNOSPECULAR"+w]=!1)}function X(q,I,l,w,t){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=function(q,I){let l=!1;if(q.activeCamera){const w=I.CAMERA_ORTHOGRAPHIC?1:0,t=I.CAMERA_PERSPECTIVE?1:0,O=1===q.activeCamera.mode?1:0,c=0===q.activeCamera.mode?1:0;(w^O||t^c)&&(I.CAMERA_ORTHOGRAPHIC=1===O,I.CAMERA_PERSPECTIVE=1===c,l=!0)}return l}(q,w);!1!==O&&(F=(0,a.g)(l,q,w)),w.DEPTHPREPASS!==!I.getColorWrite()&&(w.DEPTHPREPASS=!w.DEPTHPREPASS,F=!0),w.INSTANCES!==t&&(w.INSTANCES=t,F=!0),w.THIN_INSTANCES!==c&&(w.THIN_INSTANCES=c,F=!0),F&&w.markAsUnprocessed()}function K(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!I._areAttributesDirty&&I._needNormals===I._normals&&I._needUVs===I._uvs)return!1;I._normals=I._needNormals,I._uvs=I._needUVs,I.NORMAL=I._needNormals&&q.isVerticesDataPresent("normal"),I._needNormals&&q.isVerticesDataPresent("tangent")&&(I.TANGENT=!0);for(let a=1;a<=6;++a)I["UV"+a]=!!I._needUVs&&q.isVerticesDataPresent(`uv${1===a?"":a}`);if(l){const l=q.useVertexColors&&q.isVerticesDataPresent("color");I.VERTEXCOLOR=l,I.VERTEXALPHA=q.hasVertexAlpha&&l&&O}return q.isVerticesDataPresent("instanceColor")&&(q.hasInstances||q.hasThinInstances)&&(I.INSTANCESCOLOR=!0),w&&function(q,I){if(q.useBones&&q.computeBonesUsingShaders&&q.skeleton){I.NUM_BONE_INFLUENCERS=q.numBoneInfluencers;const l=void 0!==I.BONETEXTURE;if(q.skeleton.isUsingTextureForMatrices&&l)I.BONETEXTURE=!0;else{I.BonesPerMesh=q.skeleton.bones.length+1,I.BONETEXTURE=!l&&void 0;const w=q.Wq().prePassRenderer;if(w&&w.enabled){const l=-1===w.excludedSkinnedMesh.indexOf(q);I.BONES_VELOCITY_ENABLED=l}}}else I.NUM_BONE_INFLUENCERS=0,I.BonesPerMesh=0,void 0!==I.BONETEXTURE&&(I.BONETEXTURE=!1)}(q,I),t&&function(q,I){const l=q.morphTargetManager;l?(I.MORPHTARGETS_UV=l.supportsUVs&&I.UV1,I.MORPHTARGETS_UV2=l.supportsUV2s&&I.UV2,I.MORPHTARGETS_TANGENT=l.supportsTangents&&I.TANGENT,I.MORPHTARGETS_NORMAL=l.supportsNormals&&I.NORMAL,I.MORPHTARGETS_POSITION=l.supportsPositions,I.MORPHTARGETS_COLOR=l.supportsColors,I.MORPHTARGETTEXTURE_HASUVS=l.hasUVs,I.MORPHTARGETTEXTURE_HASUV2S=l.hasUV2s,I.MORPHTARGETTEXTURE_HASTANGENTS=l.hasTangents,I.MORPHTARGETTEXTURE_HASNORMALS=l.hasNormals,I.MORPHTARGETTEXTURE_HASPOSITIONS=l.hasPositions,I.MORPHTARGETTEXTURE_HASCOLORS=l.hasColors,I.NUM_MORPH_INFLUENCERS=l.numMaxInfluencers||l.numInfluencers,I.MORPHTARGETS=I.NUM_MORPH_INFLUENCERS>0,I.MORPHTARGETS_TEXTURE=l.isUsingTextureForTargets):(I.MORPHTARGETS_UV=!1,I.MORPHTARGETS_UV2=!1,I.MORPHTARGETS_TANGENT=!1,I.MORPHTARGETS_NORMAL=!1,I.MORPHTARGETS_POSITION=!1,I.MORPHTARGETS_COLOR=!1,I.MORPHTARGETTEXTURE_HASUVS=!1,I.MORPHTARGETTEXTURE_HASUV2S=!1,I.MORPHTARGETTEXTURE_HASTANGENTS=!1,I.MORPHTARGETTEXTURE_HASNORMALS=!1,I.MORPHTARGETTEXTURE_HASPOSITIONS=!1,I.MORPHTARGETTEXTURE_HAS_COLORS=!1,I.MORPHTARGETS=!1,I.NUM_MORPH_INFLUENCERS=0)}(q,I),c&&function(q,I){const l=q.bakedVertexAnimationManager;I.BAKED_VERTEX_ANIMATION_TEXTURE=!(!l||!l.isEnabled)}(q,I),!0}function D(q,I){if(q.activeCamera){const l=I.MULTIVIEW;I.MULTIVIEW=null!==q.activeCamera.outputRenderTarget&&q.activeCamera.outputRenderTarget.getViewCount()>1,I.MULTIVIEW!=l&&I.markAsUnprocessed()}}function M(q,I,l){const w=I.ORDER_INDEPENDENT_TRANSPARENCY,t=I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;I.ORDER_INDEPENDENT_TRANSPARENCY=q.useOrderIndependentTransparency&&l,I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!q.getEngine().getCaps().textureFloatLinearFiltering,w===I.ORDER_INDEPENDENT_TRANSPARENCY&&t===I.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||I.markAsUnprocessed()}function n(q,I,l){const w=I.PREPASS;if(!I._arePrePassDirty)return;const t=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(q.prePassRenderer&&q.prePassRenderer.enabled&&l){I.PREPASS=!0,I.SCENE_MRT_COUNT=q.prePassRenderer.mrtCount,I.PREPASS_NORMAL_WORLDSPACE=q.prePassRenderer.generateNormalsInWorldSpace,I.PREPASS_COLOR=!0,I.PREPASS_COLOR_INDEX=0;for(let l=0;l<t.length;l++){const w=q.prePassRenderer.getIndex(t[l].type);-1!==w?(I[t[l].define]=!0,I[t[l].index]=w):I[t[l].define]=!1}}else{I.PREPASS=!1;for(let q=0;q<t.length;q++)I[t[q].define]=!1}I.PREPASS!=w&&(I.markAsUnprocessed(),I.markAsImageProcessingDirty())}function f(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t&&t.push("Light"+q),O||(I.push("vLightData"+q,"vLightDiffuse"+q,"vLightSpecular"+q,"vLightDirection"+q,"vLightWidth"+q,"vLightHeight"+q,"vLightFalloff"+q,"vLightGround"+q,"lightMatrix"+q,"shadowsInfo"+q,"depthValues"+q),l.push("shadowTexture"+q),l.push("depthTexture"+q),I.push("viewFrustumZ"+q,"cascadeBlendFactor"+q,"lightSizeUVCorrection"+q,"depthCorrection"+q,"penumbraDarkness"+q,"frustumLengths"+q),w&&(l.push("projectionLightTexture"+q),I.push("textureProjectionMatrix"+q)),c&&l.push("iesLightTexture"+q))}function L(q,I,l){let w,t,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(q.uniformsNames){const c=q;w=c.uniformsNames,t=c.uniformBuffersNames,I=c.samplers,l=c.defines,O=c.maxSimultaneousLights||0}else w=q,I||(I=[]);for(let c=0;c<O&&l["LIGHT"+c];c++)f(c,w,I,l["PROJECTEDLIGHTTEXTURE"+c],t,!1,l["IESLIGHTTEXTURE"+c]);l.NUM_MORPH_INFLUENCERS&&(w.push("morphTargetInfluences"),w.push("morphTargetCount")),l.BAKED_VERTEX_ANIMATION_TEXTURE&&(w.push("bakedVertexAnimationSettings"),w.push("bakedVertexAnimationTextureSizeInverted"),w.push("bakedVertexAnimationTime"),I.push("bakedVertexAnimationTexture"))}},13065:(q,I,l)=>{l.d(I,{c:()=>O});var w=l(12747),t=l(13074);class O extends t.c{constructor(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,I,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new w.Matrix,this._storeEffectOnSubMeshes=l}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(q,I){return!!q&&(!this._storeEffectOnSubMeshes||(!q.Tc||0===q.Tc.length||this.isReadyForSubMesh(q,q.Tc[0],I)))}_isReadyForSubMesh(q){const I=q.materialDefines;return!(this.checkReadyOnEveryCall||!q.effect||!I||I._renderId!==this.Wq().getRenderId())}bindOnlyWorldMatrix(q){this._activeEffect.setMatrix("world",q)}bindOnlyNormalMatrix(q){this._activeEffect.setMatrix("normalMatrix",q)}bind(q,I){I&&this.bindForSubMesh(q,I,I.Tc[0])}_afterBind(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;super._afterBind(q,I,l),this.Wq()._cachedEffect=I,l?l._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return l._drawWrapper._forceRebindOnNextCall||q.isCachedMaterialInvalid(this,I,w)}dispose(q,I,l){this._activeEffect=void 0,super.dispose(q,I,l)}}},13105:(q,I,l)=>{l.d(I,{e:()=>a,f:()=>F});var w=l(12735),t=l(12747),O=l(12740);class c{static extractMinAndMaxIndexed(q,I,l,w,t,O){for(let c=l;c<l+w;c++){const l=3*I[c],w=q[l],a=q[l+1],F=q[l+2];t.minimizeInPlaceFromFloats(w,a,F),O.maximizeInPlaceFromFloats(w,a,F)}}static extractMinAndMax(q,I,l,w,t,O){for(let c=I,a=I*w;c<I+l;c++,a+=w){const I=q[a],l=q[a+1],w=q[a+2];t.minimizeInPlaceFromFloats(I,l,w),O.maximizeInPlaceFromFloats(I,l,w)}}}function a(q,I,l,w){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=new t.dI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new t.dI(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return c.extractMinAndMaxIndexed(q,I,l,w,a,F),O&&(a.x-=a.x*O.x+O.y,a.y-=a.y*O.x+O.y,a.z-=a.z*O.x+O.y,F.x+=F.x*O.x+O.y,F.y+=F.y*O.x+O.y,F.z+=F.z*O.x+O.y),{minimum:a,maximum:F}}function F(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0;const a=new t.dI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new t.dI(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O||(O=3),c.extractMinAndMax(q,I,l,O,a,F),w&&(a.x-=a.x*w.x+w.y,a.y-=a.y*w.x+w.y,a.z-=a.z*w.x+w.y,F.x+=F.x*w.x+w.y,F.y+=F.y*w.x+w.y,F.z+=F.z*w.x+w.y),{minimum:a,maximum:F}}(0,w.d)([O.h.filter((function(){for(var q=arguments.length,I=new Array(q),l=0;l<q;l++)I[l]=arguments[l];let[w,t]=I;return!Array.isArray(w)&&!Array.isArray(t)}))],c,"extractMinAndMaxIndexed",null),(0,w.d)([O.h.filter((function(){for(var q=arguments.length,I=new Array(q),l=0;l<q;l++)I[l]=arguments[l];let[w]=I;return!Array.isArray(w)}))],c,"extractMinAndMax",null)},13082:(q,I,l)=>{l.d(I,{e:()=>F});var w=l(12821),t=l(13089),O=l(13096),c=l(13105),a=l(12865);class F{get materialDefines(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(q=this._getDrawWrapper())||void 0===q?void 0:q.defines}set materialDefines(q){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=q}_getDrawWrapper(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q??this._engine.currentRenderPassId;let l=this._drawWrappers[q];return!l&&I&&(this._drawWrappers[q]=l=new a.e(this._mesh.Wq().getEngine())),l}_removeDrawWrapper(q){let I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var l;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(l=this._drawWrappers[q])||void 0===l||l.dispose(I));this._drawWrappers[q]=void 0}get effect(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(q=this._getDrawWrapper())||void 0===q?void 0:q.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(q){this._mainDrawWrapperOverride=q}setEffect(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this._drawWrapper;t.setEffect(q,I,w),void 0!==l&&(t.materialContext=l),q||(t.defines=null,t.materialContext=void 0)}resetDrawCache(q){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==q)return void this._removeDrawWrapper(q,!0,I);for(const q of this._drawWrappers)null===q||void 0===q||q.dispose(I)}this._drawWrappers=[]}static AddToMesh(q,I,l,w,t,O,c){return new F(q,I,l,w,t,O,c,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(q,I,l,w,t,O,c){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],F=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=q,this.verticesStart=I,this.verticesCount=l,this.indexStart=w,this.indexCount=t,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=O,this._renderingMesh=c||O,F&&O.Tc.push(this),this._engine=this._mesh.Wq().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=O.Tc.length-1,a&&(this.refreshBoundingInfo(),O.Cc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(q){return this._boundingInfo=q,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const q=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return q||this._renderingMesh}Lq(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!I)return q&&this._mesh.Wq()._hasDefaultMaterial?this._mesh.Wq().defaultMaterial:null;if(this._isMultiMaterial(I)){const q=I.getSubMaterial(this.materialIndex);return this._currentMaterial!==q&&(this._currentMaterial=q,this.resetDrawCache()),q}return I}_isMultiMaterial(q){return void 0!==q.getSubMaterial}refreshBoundingInfo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Wc)return this;if(q||(q=this._renderingMesh.getVerticesData(w.c.PositionKind)),!q)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const I=this._renderingMesh.ec();let l;if(0===this.indexStart&&this.indexCount===I.length){const q=this._renderingMesh.getBoundingInfo();l={minimum:q.minimum.clone(),maximum:q.maximum.clone()}}else l=(0,c.e)(q,I,this.indexStart,this.indexCount,this._renderingMesh.Wc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(l.minimum,l.maximum):this._boundingInfo=new O.b(l.minimum,l.maximum),this}_checkCollision(q){return this.getBoundingInfo()._checkCollision(q)}updateBoundingInfo(q){let I=this.getBoundingInfo();return I||(this.refreshBoundingInfo(),I=this.getBoundingInfo()),I&&I.update(q),this}isInFrustum(q){const I=this.getBoundingInfo();return!!I&&I.isInFrustum(q,this._mesh.Pr)}isCompletelyInFrustum(q){const I=this.getBoundingInfo();return!!I&&I.isCompletelyInFrustum(q)}render(q){return this._renderingMesh.render(this,q,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(q,I){if(!this._linesIndexBuffer){const l=6*Math.floor(this.indexCount/3),w=this.verticesStart+this.verticesCount>65535?new Uint32Array(l):new Uint16Array(l);let t=0;if(0===q.length)for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)w[t++]=q,w[t++]=q+1,w[t++]=q+1,w[t++]=q+2,w[t++]=q+2,w[t++]=q;else for(let I=this.indexStart;I<this.indexStart+this.indexCount;I+=3)w[t++]=q[I],w[t++]=q[I+1],w[t++]=q[I+1],w[t++]=q[I+2],w[t++]=q[I+2],w[t++]=q[I];this._linesIndexBuffer=I.createIndexBuffer(w),this._linesIndexCount=w.length}return this._linesIndexBuffer}canIntersects(q){const I=this.getBoundingInfo();return!!I&&q.intersectsBox(I.boundingBox)}intersects(q,I,l,w,t){const O=this.Lq();if(!O)return null;let c=3,a=!1;switch(O.fillMode){case 3:case 5:case 6:case 8:return null;case 7:c=1,a=!0}return 4===O.fillMode?l.length?this._intersectLines(q,I,l,this._mesh.intersectionThreshold,w):this._intersectUnIndexedLines(q,I,l,this._mesh.intersectionThreshold,w):!l.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(q,I,l,w,t):this._intersectTriangles(q,I,l,c,a,w,t)}_intersectLines(q,I,l,w,O){let c=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const F=I[l[a]],s=I[l[a+1]],Z=q.intersectionSegment(F,s,w);if(!(Z<0)&&((O||!c||Z<c.distance)&&(c=new t.b(null,null,Z),c.faceId=a/2,O)))break}return c}_intersectUnIndexedLines(q,I,l,w,O){let c=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){const l=I[a],F=I[a+1],s=q.intersectionSegment(l,F,w);if(!(s<0)&&((O||!c||s<c.distance)&&(c=new t.b(null,null,s),c.faceId=a/2,O)))break}return c}_intersectTriangles(q,I,l,w,t,O,c){let a=null,F=-1;for(let s=this.indexStart;s<this.indexStart+this.indexCount-(3-w);s+=w){F++;const w=l[s],Z=l[s+1],r=l[s+2];if(t&&4294967295===r){s+=2;continue}const x=I[w],o=I[Z],d=I[r];if(!x||!o||!d)continue;if(c&&!c(x,o,d,q,w,Z,r))continue;const T=q.intersectsTriangle(x,o,d);if(T){if(T.distance<0)continue;if((O||!a||T.distance<a.distance)&&(a=T,a.faceId=F,O))break}}return a}_intersectUnIndexedTriangles(q,I,l,w,t){let O=null;for(let c=this.verticesStart;c<this.verticesStart+this.verticesCount;c+=3){const l=I[c],a=I[c+1],F=I[c+2];if(t&&!t(l,a,F,q,-1,-1,-1))continue;const s=q.intersectsTriangle(l,a,F);if(s){if(s.distance<0)continue;if((w||!O||s.distance<O.distance)&&(O=s,O.faceId=c/3,w))break}}return O}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(q,I){const l=new F(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,q,I,!1);if(!this.IsGlobal){const q=this.getBoundingInfo();if(!q)return l;l._boundingInfo=new O.b(q.minimum,q.maximum)}return l}dispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Wq().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const I=this._mesh.Tc.indexOf(this);this._mesh.Tc.splice(I,1),this.resetDrawCache(void 0,q)}getClassName(){return"SubMesh"}static CreateFromIndices(q,I,l,w,t){let O=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=Number.MAX_VALUE,a=-Number.MAX_VALUE;const s=(t||w).ec();for(let F=I;F<I+l;F++){const q=s[F];q<c&&(c=q),q>a&&(a=q)}return new F(q,c,a-c+1,I,l,w,t,O)}}}}]);