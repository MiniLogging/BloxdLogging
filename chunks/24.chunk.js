"use strict";(self.qbp2s7qydk=self.qbp2s7qydk||[]).push([[24],{13298:(M,A,O)=>{O.d(A,{c:()=>S});class S{constructor(M,A,O){this.bu=M,this.bv=A,this.distance=O,this.faceId=0,this.subMeshId=0}}},13303:(M,A,O)=>{O.d(A,{c:()=>X});var S=O(12977),z=O(12970),Q=O(12974);class X{constructor(M,A,O){this.vectors=(0,S.b)(8,z.GA.Zero),this.center=z.GA.Zero(),this.centerWorld=z.GA.Zero(),this.extendSize=z.GA.Zero(),this.extendSizeWorld=z.GA.Zero(),this.directions=(0,S.b)(3,z.GA.Zero),this.vectorsWorld=(0,S.b)(8,z.GA.Zero),this.minimumWorld=z.GA.Zero(),this.maximumWorld=z.GA.Zero(),this.minimum=z.GA.Zero(),this.maximum=z.GA.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(M,A,O)}reConstruct(M,A,O){const S=M.x,Q=M.y,X=M.z,c=A.x,j=A.y,B=A.z,g=this.vectors;this.minimum.Yc(S,Q,X),this.maximum.Yc(c,j,B),g[0].Yc(S,Q,X),g[1].Yc(c,j,B),g[2].Yc(c,Q,X),g[3].Yc(S,j,X),g[4].Yc(S,Q,B),g[5].Yc(c,j,X),g[6].Yc(S,j,B),g[7].Yc(c,Q,B),A.addToRef(M,this.center).scaleInPlace(.5),A.subtractToRef(M,this.extendSize).scaleInPlace(.5),this._worldMatrix=O||z.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(M){const A=X._TmpVector3,O=this.maximum.subtractToRef(this.minimum,A[0]),S=O.length();O.normalizeFromLength(S);const z=S*M,Q=O.scaleInPlace(.5*z),c=this.center.subtractToRef(Q,A[1]),j=this.center.addToRef(Q,A[2]);return this.reConstruct(c,j,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(M){const A=this.minimumWorld,O=this.maximumWorld,S=this.directions,Q=this.vectorsWorld,X=this.vectors;if(M.isIdentity()){A.S(this.minimum),O.S(this.maximum);for(let M=0;M<8;++M)Q[M].S(X[M]);this.extendSizeWorld.S(this.extendSize),this.centerWorld.S(this.center)}else{A.Hc(Number.MAX_VALUE),O.Hc(-Number.MAX_VALUE);for(let S=0;S<8;++S){const c=Q[S];z.GA.TransformCoordinatesToRef(X[S],M,c),A.minimizeInPlace(c),O.maximizeInPlace(c)}O.subtractToRef(A,this.extendSizeWorld).scaleInPlace(.5),O.addToRef(A,this.centerWorld).scaleInPlace(.5)}z.GA.FromArrayToRef(M.m,0,S[0]),z.GA.FromArrayToRef(M.m,4,S[1]),z.GA.FromArrayToRef(M.m,8,S[2]),this._worldMatrix=M}isInFrustum(M){return X.IsInFrustum(this.vectorsWorld,M)}isCompletelyInFrustum(M){return X.IsCompletelyInFrustum(this.vectorsWorld,M)}intersectsPoint(M){const A=this.minimumWorld,O=this.maximumWorld,S=A.x,z=A.y,X=A.z,c=O.x,j=O.y,B=O.z,g=M.x,e=M.y,T=M.z,J=-Q.e;return!(c-g<J||J>g-S)&&(!(j-e<J||J>e-z)&&!(B-T<J||J>T-X))}intersectsSphere(M){return X.IntersectsSphere(this.minimumWorld,this.maximumWorld,M.centerWorld,M.radiusWorld)}intersectsMinMax(M,A){const O=this.minimumWorld,S=this.maximumWorld,z=O.x,Q=O.y,X=O.z,c=S.x,j=S.y,B=S.z,g=M.x,e=M.y,T=M.z,J=A.x,K=A.y,G=A.z;return!(c<g||z>J)&&(!(j<e||Q>K)&&!(B<T||X>G))}dispose(){var M,A;null===(M=this._drawWrapperFront)||void 0===M||M.dispose(),null===(A=this._drawWrapperBack)||void 0===A||A.dispose()}static Intersects(M,A){return M.intersectsMinMax(A.minimumWorld,A.maximumWorld)}static IntersectsSphere(M,A,O,S){const Q=X._TmpVector3[0];z.GA.ClampToRef(O,M,A,Q);return z.GA.DistanceSquared(O,Q)<=S*S}static IsCompletelyInFrustum(M,A){for(let O=0;O<6;++O){const S=A[O];for(let A=0;A<8;++A)if(S.dotCoordinate(M[A])<0)return!1}return!0}static IsInFrustum(M,A){for(let O=0;O<6;++O){let S=!0;const z=A[O];for(let A=0;A<8;++A)if(z.dotCoordinate(M[A])>=0){S=!1;break}if(S)return!1}return!0}}X._TmpVector3=(0,S.b)(3,z.GA.Zero)},13301:(M,A,O)=>{O.d(A,{b:()=>e});var S=O(12977),z=O(12970),Q=O(13303),X=O(13311);const c={min:0,max:0},j={min:0,max:0},B=(M,A,O)=>{const S=z.GA.Dot(A.centerWorld,M),Q=Math.abs(z.GA.Dot(A.directions[0],M))*A.extendSize.x+Math.abs(z.GA.Dot(A.directions[1],M))*A.extendSize.y+Math.abs(z.GA.Dot(A.directions[2],M))*A.extendSize.z;O.min=S-Q,O.max=S+Q},g=(M,A,O)=>(B(M,A,c),B(M,O,j),!(c.min>j.max||j.min>c.max));class e{constructor(M,A,O){this._isLocked=!1,this.boundingBox=new Q.c(M,A,O),this.boundingSphere=new X.e(M,A,O)}reConstruct(M,A,O){this.boundingBox.reConstruct(M,A,O),this.boundingSphere.reConstruct(M,A,O)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(M){this._isLocked=M}update(M){this._isLocked||(this.boundingBox._update(M),this.boundingSphere._update(M))}centerOn(M,A){const O=e._TmpVector3[0].S(M).KT(A),S=e._TmpVector3[1].S(M).addInPlace(A);return this.boundingBox.reConstruct(O,S,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(O,S,this.boundingBox.getWorldMatrix()),this}encapsulate(M){const A=z.GA.Minimize(this.minimum,M),O=z.GA.Maximize(this.maximum,M);return this.reConstruct(A,O,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(M){const A=z.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(A);const O=z.TmpVectors.GA[0];return z.GA.TransformCoordinatesToRef(M.boundingBox.minimumWorld,A,O),this.encapsulate(O),z.GA.TransformCoordinatesToRef(M.boundingBox.maximumWorld,A,O),this.encapsulate(O),this}scale(M){return this.boundingBox.scale(M),this.boundingSphere.scale(M),this}isInFrustum(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===A||3===A)&&this.boundingSphere.isCenterInFrustum(M))return!0;if(!this.boundingSphere.isInFrustum(M))return!1;return!(1!==A&&3!==A)||this.boundingBox.isInFrustum(M)}get diagonalLength(){const M=this.boundingBox;return M.maximumWorld.subtractToRef(M.minimumWorld,e._TmpVector3[0]).length()}isCompletelyInFrustum(M){return this.boundingBox.isCompletelyInFrustum(M)}_checkCollision(M){return M._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(M){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(M)&&!!this.boundingBox.intersectsPoint(M))}intersects(M,A){if(!X.e.Intersects(this.boundingSphere,M.boundingSphere))return!1;if(!Q.c.Intersects(this.boundingBox,M.boundingBox))return!1;if(!A)return!0;const O=this.boundingBox,S=M.boundingBox;return!!g(O.directions[0],O,S)&&(!!g(O.directions[1],O,S)&&(!!g(O.directions[2],O,S)&&(!!g(S.directions[0],O,S)&&(!!g(S.directions[1],O,S)&&(!!g(S.directions[2],O,S)&&(!!g(z.GA.Cross(O.directions[0],S.directions[0]),O,S)&&(!!g(z.GA.Cross(O.directions[0],S.directions[1]),O,S)&&(!!g(z.GA.Cross(O.directions[0],S.directions[2]),O,S)&&(!!g(z.GA.Cross(O.directions[1],S.directions[0]),O,S)&&(!!g(z.GA.Cross(O.directions[1],S.directions[1]),O,S)&&(!!g(z.GA.Cross(O.directions[1],S.directions[2]),O,S)&&(!!g(z.GA.Cross(O.directions[2],S.directions[0]),O,S)&&(!!g(z.GA.Cross(O.directions[2],S.directions[1]),O,S)&&!!g(z.GA.Cross(O.directions[2],S.directions[2]),O,S))))))))))))))}}e._TmpVector3=(0,S.b)(2,z.GA.Zero)},13311:(M,A,O)=>{O.d(A,{e:()=>Q});var S=O(12977),z=O(12970);class Q{constructor(M,A,O){this.center=z.GA.Zero(),this.centerWorld=z.GA.Zero(),this.minimum=z.GA.Zero(),this.maximum=z.GA.Zero(),this.reConstruct(M,A,O)}reConstruct(M,A,O){this.minimum.S(M),this.maximum.S(A);const S=z.GA.Distance(M,A);A.addToRef(M,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(O||z.Matrix.IdentityReadOnly)}scale(M){const A=this.radius*M,O=Q._TmpVector3,S=O[0].Hc(A),z=this.center.subtractToRef(S,O[1]),X=this.center.addToRef(S,O[2]);return this.reConstruct(z,X,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(M){if(M.isIdentity())this.centerWorld.S(this.center),this.radiusWorld=this.radius;else{z.GA.TransformCoordinatesToRef(this.center,M,this.centerWorld);const A=Q._TmpVector3[0];z.GA.TransformNormalFromFloatsToRef(1,1,1,M,A),this.radiusWorld=Math.max(Math.abs(A.x),Math.abs(A.y),Math.abs(A.z))*this.radius}}isInFrustum(M){const A=this.centerWorld,O=this.radiusWorld;for(let S=0;S<6;S++)if(M[S].dotCoordinate(A)<=-O)return!1;return!0}isCenterInFrustum(M){const A=this.centerWorld;for(let O=0;O<6;O++)if(M[O].dotCoordinate(A)<0)return!1;return!0}intersectsPoint(M){const A=z.GA.DistanceSquared(this.centerWorld,M);return!(this.radiusWorld*this.radiusWorld<A)}static Intersects(M,A){const O=z.GA.DistanceSquared(M.centerWorld,A.centerWorld),S=M.radiusWorld+A.radiusWorld;return!(S*S<O)}static CreateFromCenterAndRadius(M,A,O){this._TmpVector3[0].S(M),this._TmpVector3[1].Yc(0,0,A),this._TmpVector3[2].S(M),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].KT(this._TmpVector3[1]);const S=new Q(this._TmpVector3[0],this._TmpVector3[2]);return S._worldMatrix=O||z.Matrix.Identity(),S}}Q._TmpVector3=(0,S.b)(3,z.GA.Zero)},13329:(M,A,O)=>{function S(M){-1===M.indexOf("vClipPlane")&&M.push("vClipPlane"),-1===M.indexOf("vClipPlane2")&&M.push("vClipPlane2"),-1===M.indexOf("vClipPlane3")&&M.push("vClipPlane3"),-1===M.indexOf("vClipPlane4")&&M.push("vClipPlane4"),-1===M.indexOf("vClipPlane5")&&M.push("vClipPlane5"),-1===M.indexOf("vClipPlane6")&&M.push("vClipPlane6")}function z(M,A,O){var S,z,Q,X,c,j;const B=!!(null!==(S=M.clipPlane)&&void 0!==S?S:A.clipPlane),g=!!(null!==(z=M.clipPlane2)&&void 0!==z?z:A.clipPlane2),e=!!(null!==(Q=M.clipPlane3)&&void 0!==Q?Q:A.clipPlane3),T=!!(null!==(X=M.clipPlane4)&&void 0!==X?X:A.clipPlane4),J=!!(null!==(c=M.clipPlane5)&&void 0!==c?c:A.clipPlane5),K=!!(null!==(j=M.clipPlane6)&&void 0!==j?j:A.clipPlane6);B&&O.push("#define CLIPPLANE"),g&&O.push("#define CLIPPLANE2"),e&&O.push("#define CLIPPLANE3"),T&&O.push("#define CLIPPLANE4"),J&&O.push("#define CLIPPLANE5"),K&&O.push("#define CLIPPLANE6")}function Q(M,A,O){var S,z,Q,X,c,j;let B=!1;const g=!!(null!==(S=M.clipPlane)&&void 0!==S?S:A.clipPlane),e=!!(null!==(z=M.clipPlane2)&&void 0!==z?z:A.clipPlane2),T=!!(null!==(Q=M.clipPlane3)&&void 0!==Q?Q:A.clipPlane3),J=!!(null!==(X=M.clipPlane4)&&void 0!==X?X:A.clipPlane4),K=!!(null!==(c=M.clipPlane5)&&void 0!==c?c:A.clipPlane5),G=!!(null!==(j=M.clipPlane6)&&void 0!==j?j:A.clipPlane6);return O.CLIPPLANE!==g&&(O.CLIPPLANE=g,B=!0),O.CLIPPLANE2!==e&&(O.CLIPPLANE2=e,B=!0),O.CLIPPLANE3!==T&&(O.CLIPPLANE3=T,B=!0),O.CLIPPLANE4!==J&&(O.CLIPPLANE4=J,B=!0),O.CLIPPLANE5!==K&&(O.CLIPPLANE5=K,B=!0),O.CLIPPLANE6!==G&&(O.CLIPPLANE6=G,B=!0),B}function X(M,A,O){var S,z,Q,X,j,B;let g=null!==(S=A.clipPlane)&&void 0!==S?S:O.clipPlane;c(M,"vClipPlane",g),g=null!==(z=A.clipPlane2)&&void 0!==z?z:O.clipPlane2,c(M,"vClipPlane2",g),g=null!==(Q=A.clipPlane3)&&void 0!==Q?Q:O.clipPlane3,c(M,"vClipPlane3",g),g=null!==(X=A.clipPlane4)&&void 0!==X?X:O.clipPlane4,c(M,"vClipPlane4",g),g=null!==(j=A.clipPlane5)&&void 0!==j?j:O.clipPlane5,c(M,"vClipPlane5",g),g=null!==(B=A.clipPlane6)&&void 0!==B?B:O.clipPlane6,c(M,"vClipPlane6",g)}function c(M,A,O){O&&M.setFloat4(A,O.normal.x,O.normal.y,O.normal.z,O.d)}O.d(A,{b:()=>S,d:()=>X,e:()=>Q,f:()=>z})},13271:(M,A,O)=>{O.d(A,{b:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(M,A){this._defines[M]||(M<this._currentRank&&(this._currentRank=M),M>this._maxRank&&(this._maxRank=M),this._defines[M]=new Array),this._defines[M].push(A)}addCPUSkinningFallback(M,A){this._mesh=A,M<this._currentRank&&(this._currentRank=M),M>this._maxRank&&(this._maxRank=M)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(M,A){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,M=M.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),A._bonesComputationForcedToCPU=!0;const O=this._mesh.HM();for(let M=0;M<O.meshes.length;M++){const S=O.meshes[M];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===A)S.computeBonesUsingShaders=!1;else if(S.Bc)for(const M of S.Bc){if(M.effect===A){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const A=this._defines[this._currentRank];if(A)for(let O=0;O<A.length;O++)M=M.replace("#define "+A[O],"");this._currentRank++}return M}}},13286:(M,A,O)=>{O.d(A,{b:()=>w});var S=O(22),z=O(12958),Q=O(12964),X=O(12768),c=O(12776),j=O(12811),B=O(13292),g=O(13235),e=O(12783),T=O(13019),J=O(13096),K=O(12998);class G{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(M){this._func=M}get funcRef(){return this._funcRef}set funcRef(M){this._funcRef=M}get funcMask(){return this._funcMask}set funcMask(M){this._funcMask=M}get opStencilFail(){return this._opStencilFail}set opStencilFail(M){this._opStencilFail=M}get opDepthFail(){return this._opDepthFail}set opDepthFail(M){this._opDepthFail=M}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(M){this._opStencilDepthPass=M}get mask(){return this._mask}set mask(M){this._mask=M}get enabled(){return this._enabled}set enabled(M){this._enabled=M}getClassName(){return"MaterialStencilState"}copyTo(M){K.e.Clone((()=>M),this)}serialize(){return K.e.Serialize(this)}parse(M,A,O){K.e.Parse((()=>this),M,A,O)}}(0,z.d)([(0,Q.H)()],G.prototype,"func",null),(0,z.d)([(0,Q.H)()],G.prototype,"funcRef",null),(0,z.d)([(0,Q.H)()],G.prototype,"funcMask",null),(0,z.d)([(0,Q.H)()],G.prototype,"opStencilFail",null),(0,z.d)([(0,Q.H)()],G.prototype,"opDepthFail",null),(0,z.d)([(0,Q.H)()],G.prototype,"opStencilDepthPass",null),(0,z.d)([(0,Q.H)()],G.prototype,"mask",null),(0,z.d)([(0,Q.H)()],G.prototype,"enabled",null);var d=O(13322);class w{get _supportGlowLayer(){return!1}set _glowModeEnabled(M){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(M){if(this._alpha===M)return;const A=this._alpha;this._alpha=M,1!==A&&1!==M||this.ug(w.MiscDirtyFlag+w.PrePassDirtyFlag)}get alpha(){return this._alpha}set bc(M){this._backFaceCulling!==M&&(this._backFaceCulling=M,this.ug(w.TextureDirtyFlag))}get bc(){return this._backFaceCulling}set cullBackFaces(M){this._cullBackFaces!==M&&(this._cullBackFaces=M,this.ug(w.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(M){this._blockDirtyMechanism!==M&&(this._blockDirtyMechanism=M,M||this.SJ())}atomicMaterialsUpdate(M){this.blockDirtyMechanism=!0;try{M(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(M){this._onDisposeObserver&&this.Ac.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ac.add(M)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new c.c),this._onBindObservable}set onBind(M){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(M)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new c.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new c.c),this._onEffectCreatedObservable}set alphaMode(M){this._alphaMode!==M&&(this._alphaMode=M,this.ug(w.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(M){this._needDepthPrePass!==M&&(this._needDepthPrePass=M,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(M){this._fogEnabled!==M&&(this._fogEnabled=M,this.ug(w.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case w.WireFrameFillMode:case w.LineListDrawMode:case w.LineLoopDrawMode:case w.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(M){this.fillMode=M?w.WireFrameFillMode:w.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case w.PointFillMode:case w.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(M){this.fillMode=M?w.PointFillMode:w.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(M){this._fillMode!==M&&(this._fillMode=M,this.ug(w.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(M){const A=this.HM().getEngine().getCaps().fragmentDepthSupported;M&&!A&&e.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=M&&A,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(M){this._drawWrapper=M}constructor(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Ac=new c.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Sc=new G,this._useUBO=!1,this._fillMode=w.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=M;const z=A||j.d.LastCreatedScene;z&&(this._scene=z,this._dirtyCallbacks={},this._forceGLSL=S,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=M||X.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new J.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new g.b(this._scene.getEngine(),void 0,void 0,M),this._useUBO=this.HM().getEngine().supportsUniformBuffers,this._createUniformBuffer(),O||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),w.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var M;const A=this.HM().getEngine();null===(M=this._uniformBuffer)||void 0===M||M.dispose(),A.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new g.b(A,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new g.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(M){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.SJ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.SJ(),this.checkReadyOnlyOnce=!1}isReady(M,A){return!0}isReadyForSubMesh(M,A,O){const S=A.materialDefines;return!!S&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}HM(){return this._scene}_getEffectiveOrientation(M){return null!==this.sideOrientation?this.sideOrientation:M.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(M){this._transparencyMode!==M&&(this._transparencyMode=M,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===w.MATERIAL_ALPHABLEND||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===w.MATERIAL_ALPHATEST||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===w.MATERIAL_OPAQUE||this._transparencyMode===w.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(M){return this._hasTransparencyMode?this._transparencyModeIsBlend:M.visibility<1||!this._disableAlphaBlending&&(M.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(M){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(M)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}SJ(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A=this.HM().meshes;for(const O of A)if(O.Bc)for(const A of O.Bc)if(A.tM()===this)for(const O of A._drawWrappers)O&&this._materialContext===O.materialContext&&(O._wasPreviouslyReady=!1,O._wasPreviouslyUsingInstances=null,O._forceRebindOnNextCall=M);M&&this.ug(w.AllDirtyFlag)}_preBind(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=this._scene.getEngine(),S=(null==A?this.sideOrientation:A)===w.ClockWiseSideOrientation;return O.enableEffect(M||this._getDrawWrapper()),O.setState(this.bc,this.zOffset,!1,S,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Sc,this.zOffsetUnits),S}bind(M,A){}buildUniformLayout(){const M=this._uniformBuffer;this._eventInfo.ubo=M,this._callbackPluginEventGeneric(8,this._eventInfo),M.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(M,A,O){const S=O._drawWrapper;this._eventInfo.subMesh=O,this._callbackPluginEventBindForSubMesh(this._eventInfo),S._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(M){}bindView(M){this._useUBO?this._needToBindSceneUbo=!0:M.setMatrix("view",this.HM().getViewMatrix())}bindViewProjection(M){this._useUBO?this._needToBindSceneUbo=!0:(M.setMatrix("viewProjection",this.HM().getTransformMatrix()),M.setMatrix("projection",this.HM().getProjectionMatrix()))}bindEyePosition(M,A){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(M,A)}_afterBind(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&A&&(this._needToBindSceneUbo=!1,(0,d.o)(A,this.HM().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=M?M.visibility:1,this._onBindObservable&&M&&this._onBindObservable.notifyObservers(M),this.disableDepthWrite){const M=this._scene.getEngine();this._cachedDepthWriteState=M.getDepthWrite(),M.setDepthWrite(!1)}if(this.disableColorWrite){const M=this._scene.getEngine();this._cachedColorWriteState=M.getColorWrite(),M.setColorWrite(!1)}if(0!==this.depthFunction){const M=this._scene.getEngine();this._cachedDepthFunctionState=M.getDepthFunction()||0,M.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(M){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=M,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(M){return null}_clonePlugins(M,A){const O={};if(this._serializePlugins(O),w._ParsePlugins(O,M,this._scene,A),this.pluginManager)for(const S of this.pluginManager._plugins){const A=M.pluginManager.getPlugin(S.name);A&&S.copyTo(A)}}getBindedMeshes(){if(this.meshMap){const M=[];for(const A in this.meshMap){const O=this.meshMap[A];O&&M.push(O)}return M}return this._scene.meshes.filter((M=>M.material===this))}forceCompilation(M,A,O,z){const Q=(0,S.d)({clipPlane:!1,useInstances:!1},O),X=this.HM(),c=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const j=()=>{if(!this._scene||!this._scene.getEngine())return;const O=X.clipPlane;if(Q.clipPlane&&(X.clipPlane=new T.e(0,0,0,1)),this._storeEffectOnSubMeshes){let O=!0,S=null;if(M.Bc){const A=new B.e(0,0,0,0,0,M,void 0,!1,!1);A.materialDefines&&(A.materialDefines._renderId=-1),this.isReadyForSubMesh(M,A,Q.useInstances)||(A.effect&&A.effect.getCompilationError()&&A.effect.allFallbacksProcessed()?S=A.effect.getCompilationError():(O=!1,setTimeout(j,16)))}O&&(this.allowShaderHotSwapping=c,S&&z&&z(S),A&&A(this))}else this.isReady()?(this.allowShaderHotSwapping=c,A&&A(this)):setTimeout(j,16);Q.clipPlane&&(X.clipPlane=O)};j()}async forceCompilationAsync(M,A){return await new Promise(((O,S)=>{this.forceCompilation(M,(()=>{O()}),A,(M=>{S(M)}))}))}ug(M){this.HM().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(w._DirtyCallbackArray.length=0,M&w.ImageProcessingDirtyFlag&&w._DirtyCallbackArray.push(w._ImageProcessingDirtyCallBack),M&w.TextureDirtyFlag&&w._DirtyCallbackArray.push(w._TextureDirtyCallBack),M&w.LightDirtyFlag&&w._DirtyCallbackArray.push(w._LightsDirtyCallBack),M&w.FresnelDirtyFlag&&w._DirtyCallbackArray.push(w._FresnelDirtyCallBack),M&w.AttributesDirtyFlag&&w._DirtyCallbackArray.push(w._AttributeDirtyCallBack),M&w.MiscDirtyFlag&&w._DirtyCallbackArray.push(w._MiscDirtyCallBack),M&w.PrePassDirtyFlag&&w._DirtyCallbackArray.push(w._PrePassDirtyCallBack),w._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(w._RunDirtyCallBacks),this.HM().resetCachedMaterial())}resetDrawCache(){const M=this.HM().meshes;for(const A of M)if(A.Bc)for(const M of A.Bc)M.tM()===this&&M.resetDrawCache()}_markAllSubMeshesAsDirty(M){const A=this.HM();if(A.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const O=A.meshes;for(const S of O)if(S.Bc)for(const O of S.Bc){if((O.tM()||(A._hasDefaultMaterial?A.defaultMaterial:null))===this)for(const A of O._drawWrappers)A&&A.defines&&A.defines.markAllAsDirty&&this._materialContext===A.materialContext&&M(A.defines)}}_markScenePrePassDirty(){if(this.HM().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const M=this.HM().enablePrePassRenderer();M&&M.ug()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(w._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(w._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(w._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(w._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(w._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(w._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(w._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(w._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(w._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(w._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const M=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Ac.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(M)}))}}setPrePassRenderer(M){return!1}dispose(M,A,O){const S=this.HM();if(S.stopAnimation(this),S.freeProcessedMaterials(),S.removeMaterial(this),this._eventInfo.forceDisposeTextures=A,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const M=this._parentContainer.materials.indexOf(this);M>-1&&this._parentContainer.materials.splice(M,1),this._parentContainer=null}if(!0!==O)if(this.meshMap)for(const z in this.meshMap){const M=this.meshMap[z];this._disposeMeshResources(M)}else{const M=S.meshes;for(const A of M)this._disposeMeshResources(A)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Ac.notifyObservers(this),this.Ac.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(M){if(!M)return;const A=M.wc,O=M._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(M.Bc&&O)for(const z of M.Bc){const M=z._drawWrappers;for(let Q=0;Q<M.length;Q++){var S;const X=null===(S=M[Q])||void 0===S?void 0:S.effect;if(!X)continue;O[Q]===this&&(null===A||void 0===A||A._releaseVertexArrayObject(X),z._removeDrawWrapper(Q,!0,!0))}}}else null===A||void 0===A||A._releaseVertexArrayObject(this._drawWrapper.effect);M.material!==this||M.sourceMesh||(M.material=null)}serialize(){const M=K.e.Serialize(this);return M.Sc=this.Sc.serialize(),M.uniqueId=this.uniqueId,this._serializePlugins(M),M}_serializePlugins(M){if(M.plugins={},this.pluginManager)for(const A of this.pluginManager._plugins)A.doNotSerialize||(M.plugins[A.getClassName()]=A.serialize())}static Parse(M,A,O){if(M.customType){if("BABYLON.PBRMaterial"===M.customType&&M.overloadedAlbedo&&(M.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return e.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else M.customType="BABYLON.StandardMaterial";const S=X.Tools.Instantiate(M.customType).Parse(M,A,O);return S._loadedUniqueId=M.uniqueId,S}static _ParsePlugins(M,A,O,S){if(M.plugins)for(const c in M.plugins){var z,Q;const j=M.plugins[c];let B=null===(z=A.pluginManager)||void 0===z?void 0:z.getPlugin(j.name);if(!B){const M=X.Tools.Instantiate("BABYLON."+c);M&&(B=new M(A))}null===(Q=B)||void 0===Q||Q.parse(j,O,S)}}}w.TriangleFillMode=0,w.WireFrameFillMode=1,w.PointFillMode=2,w.PointListDrawMode=3,w.LineListDrawMode=4,w.LineLoopDrawMode=5,w.LineStripDrawMode=6,w.TriangleStripDrawMode=7,w.TriangleFanDrawMode=8,w.ClockWiseSideOrientation=0,w.CounterClockWiseSideOrientation=1,w.ImageProcessingDirtyFlag=64,w.TextureDirtyFlag=1,w.LightDirtyFlag=2,w.FresnelDirtyFlag=4,w.AttributesDirtyFlag=8,w.MiscDirtyFlag=16,w.PrePassDirtyFlag=32,w.AllDirtyFlag=127,w.MATERIAL_OPAQUE=0,w.MATERIAL_ALPHATEST=1,w.MATERIAL_ALPHABLEND=2,w.MATERIAL_ALPHATESTANDBLEND=3,w.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,w.MATERIAL_NORMALBLENDMETHOD_RNM=1,w.OnEventObservable=new c.c,w._AllDirtyCallBack=M=>M.markAllAsDirty(),w._ImageProcessingDirtyCallBack=M=>M.markAsImageProcessingDirty(),w._TextureDirtyCallBack=M=>M.markAsTexturesDirty(),w._FresnelDirtyCallBack=M=>M.markAsFresnelDirty(),w._MiscDirtyCallBack=M=>M.markAsMiscDirty(),w._PrePassDirtyCallBack=M=>M.markAsPrePassDirty(),w._LightsDirtyCallBack=M=>M.markAsLightDirty(),w._AttributeDirtyCallBack=M=>M.markAsAttributesDirty(),w._FresnelAndMiscDirtyCallBack=M=>{w._FresnelDirtyCallBack(M),w._MiscDirtyCallBack(M)},w._TextureAndMiscDirtyCallBack=M=>{w._TextureDirtyCallBack(M),w._MiscDirtyCallBack(M)},w._DirtyCallbackArray=[],w._RunDirtyCallBacks=M=>{for(const A of w._DirtyCallbackArray)A(M)},(0,z.d)([(0,Q.H)()],w.prototype,"id",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"uniqueId",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"name",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"metadata",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"checkReadyOnEveryCall",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"checkReadyOnlyOnce",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"state",void 0),(0,z.d)([(0,Q.H)("alpha")],w.prototype,"_alpha",void 0),(0,z.d)([(0,Q.H)("bc")],w.prototype,"_backFaceCulling",void 0),(0,z.d)([(0,Q.H)("cullBackFaces")],w.prototype,"_cullBackFaces",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"sideOrientation",void 0),(0,z.d)([(0,Q.H)("alphaMode")],w.prototype,"_alphaMode",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"_needDepthPrePass",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"disableDepthWrite",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"disableColorWrite",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"forceDepthWrite",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"depthFunction",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"separateCullingPass",void 0),(0,z.d)([(0,Q.H)("fogEnabled")],w.prototype,"_fogEnabled",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"pointSize",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"zOffset",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"zOffsetUnits",void 0),(0,z.d)([(0,Q.H)()],w.prototype,"pointsCloud",null),(0,z.d)([(0,Q.H)()],w.prototype,"fillMode",null),(0,z.d)([(0,Q.H)()],w.prototype,"useLogarithmicDepth",null),(0,z.d)([(0,Q.H)()],w.prototype,"transparencyMode",null)},13322:(M,A,O)=>{O.d(A,{$:()=>i,A:()=>H,E:()=>C,F:()=>J,G:()=>T,K:()=>h,L:()=>y,P:()=>F,S:()=>w,W:()=>D,Z:()=>u,c:()=>s,d:()=>e,db:()=>U,f:()=>E,g:()=>g,hb:()=>t,ib:()=>K,k:()=>G,o:()=>d,s:()=>I,u:()=>f,x:()=>b});var S=O(12783),z=O(13010),Q=O(12811),X=O(13263),c=O(13329);const j=z.bA.Black(),B={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function g(M,A,O){if(!M||M.LOGARITHMICDEPTH||M.indexOf&&M.indexOf("LOGARITHMICDEPTH")>=0){const M=O.activeCamera;1===M.mode&&S.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),A.setFloat("logarithmicDepthConstant",2/(Math.log(M.maxZ+1)/Math.LN2))}}function e(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];O&&M.fogEnabled&&(!A||A.applyFog)&&0!==M.fogMode&&(O.setFloat4("vFogInfos",M.fogMode,M.fogStart,M.fogEnd,M.fogDensity),S?(M.fogColor.toLinearSpaceToRef(j,M.getEngine().useExactSrgbConversions),O.setColor3("vFogColor",j)):O.setColor3("vFogColor",M.fogColor))}function T(M,A,O,S,z,Q,X,c,j,g){const e=M.numMaxInfluencers||M.numInfluencers;return e<=0?0:(A.push("#define MORPHTARGETS"),M.hasPositions&&A.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),M.hasNormals&&A.push("#define MORPHTARGETTEXTURE_HASNORMALS"),M.hasTangents&&A.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),M.hasUVs&&A.push("#define MORPHTARGETTEXTURE_HASUVS"),M.hasUV2s&&A.push("#define MORPHTARGETTEXTURE_HASUV2S"),M.hasColors&&A.push("#define MORPHTARGETTEXTURE_HASCOLORS"),M.supportsPositions&&z&&A.push("#define MORPHTARGETS_POSITION"),M.supportsNormals&&Q&&A.push("#define MORPHTARGETS_NORMAL"),M.supportsTangents&&X&&A.push("#define MORPHTARGETS_TANGENT"),M.supportsUVs&&c&&A.push("#define MORPHTARGETS_UV"),M.supportsUV2s&&j&&A.push("#define MORPHTARGETS_UV2"),M.supportsColors&&g&&A.push("#define MORPHTARGETS_COLOR"),A.push("#define NUM_MORPH_INFLUENCERS "+e),M.isUsingTextureForTargets&&A.push("#define MORPHTARGETS_TEXTURE"),B.NUM_MORPH_INFLUENCERS=e,B.NORMAL=Q,B.TANGENT=X,B.UV=c,B.UV2=j,B.COLOR=g,J(O,S,B,z),e)}function J(M,A,O){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=O.NUM_MORPH_INFLUENCERS;if(X>0&&Q.d.LastCreatedEngine){const c=Q.d.LastCreatedEngine.getCaps().maxVertexAttribs,j=A.morphTargetManager;if(null!==j&&void 0!==j&&j.isUsingTextureForTargets)return;const B=j&&j.supportsPositions&&z,g=j&&j.supportsNormals&&O.NORMAL,e=j&&j.supportsTangents&&O.TANGENT,T=j&&j.supportsUVs&&O.UV1,J=j&&j.supportsUV2s&&O.UV2,K=j&&j.supportsColors&&O.VERTEXCOLOR;for(let O=0;O<X;O++)B&&M.push("position"+O),g&&M.push("normal"+O),e&&M.push("tangent"+O),T&&M.push("uv_"+O),J&&M.push("uv2_"+O),K&&M.push("color"+O),M.length>c&&S.c.Error("Cannot add more vertex attributes for mesh "+A.name)}}function K(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M.push("world0"),M.push("world1"),M.push("world2"),M.push("world3"),A&&(M.push("previousWorld0"),M.push("previousWorld1"),M.push("previousWorld2"),M.push("previousWorld3"))}function G(M,A){const O=M.morphTargetManager;M&&O&&A.setFloatArray("morphTargetInfluences",O.influences)}function d(M,A){A.bindToEffect(M,"Scene")}function w(M,A,O){A._needUVs=!0,A[O]=!0,M.optimizeUVAllocation&&M.getTextureMatrix().isIdentityAs3x2()?(A[O+"DIRECTUV"]=M.coordinatesIndex+1,A["MAINUV"+(M.coordinatesIndex+1)]=!0):A[O+"DIRECTUV"]=0}function I(M,A,O){const S=M.getTextureMatrix();A.Kc(O+"Matrix",S)}function b(M,A,O){O.BAKED_VERTEX_ANIMATION_TEXTURE&&O.INSTANCES&&M.push("bakedVertexAnimationSettingsInstanced")}function s(M,A,O){var S;if(A&&M&&(M.computeBonesUsingShaders&&A._bonesComputationForcedToCPU&&(M.computeBonesUsingShaders=!1),M.useBones&&M.computeBonesUsingShaders&&M.skeleton)){const z=M.skeleton;if(z.isUsingTextureForMatrices&&A.getUniformIndex("boneTextureWidth")>-1){const O=z.getTransformMatrixTexture(M);A.setTexture("boneSampler",O),A.setFloat("boneTextureWidth",4*(z.bones.length+1))}else{const Q=z.getTransformMatrices(M);Q&&(A.setMatrices("mBones",Q),O&&M.HM().prePassRenderer&&M.HM().prePassRenderer.getIndex(2)&&(O.previousBones[M.uniqueId]||(O.previousBones[M.uniqueId]=Q.slice()),A.setMatrices("mPreviousBones",O.previousBones[M.uniqueId]),S=Q,O.previousBones[M.uniqueId].set(S)))}}}function Y(M,A,O,S,z){let Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];M._bindLight(A,O,S,z,Q)}function E(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Q=Math.min(A.lightSources.length,z);for(let X=0;X<Q;X++){Y(A.lightSources[X],X,M,O,"boolean"===typeof S?S:S.SPECULARTERM,A.receiveShadows)}}function H(M,A,O,S){O.NUM_BONE_INFLUENCERS>0&&(S.addCPUSkinningFallback(0,A),M.push("matricesIndices"),M.push("matricesWeights"),O.NUM_BONE_INFLUENCERS>4&&(M.push("matricesIndicesExtra"),M.push("matricesWeightsExtra")))}function C(M,A){(A.INSTANCES||A.THIN_INSTANCES)&&K(M,!!A.PREPASS_VELOCITY),A.INSTANCESCOLOR&&M.push("instanceColor")}function f(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=0;for(let Q=0;Q<O&&M["LIGHT"+Q];Q++)Q>0&&(z=S+Q,A.addFallback(z,"LIGHT"+Q)),M.SHADOWS||(M["SHADOW"+Q]&&A.addFallback(S,"SHADOW"+Q),M["SHADOWPCF"+Q]&&A.addFallback(S,"SHADOWPCF"+Q),M["SHADOWPCSS"+Q]&&A.addFallback(S,"SHADOWPCSS"+Q),M["SHADOWPOISSON"+Q]&&A.addFallback(S,"SHADOWPOISSON"+Q),M["SHADOWESM"+Q]&&A.addFallback(S,"SHADOWESM"+Q),M["SHADOWCLOSEESM"+Q]&&A.addFallback(S,"SHADOWCLOSEESM"+Q));return z++}function D(M,A,O,S,z,Q,X){let c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];X._areMiscDirty&&(X.LOGARITHMICDEPTH=O,X.POINTSIZE=S,X.FOG=z&&function(M,A){return A.fogEnabled&&M.applyFog&&0!==A.fogMode}(M,A),X.NONUNIFORMSCALING=M.nonUniformScaling,X.ALPHATEST=Q,X.DECAL_AFTER_DETAIL=c)}function F(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!O._areLightsDirty)return O._needNormals;let X=0;const c={needNormals:O._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(M.lightsEnabled&&!Q)for(const B of A.lightSources)if(N(M,A,B,X,O,S,c),X++,X===z)break;O.SPECULARTERM=c.specularEnabled,O.SHADOWS=c.shadowEnabled;for(let B=X;B<z;B++)void 0!==O["LIGHT"+B]&&(O["LIGHT"+B]=!1,O["HEMILIGHT"+B]=!1,O["POINTLIGHT"+B]=!1,O["DIRLIGHT"+B]=!1,O["SPOTLIGHT"+B]=!1,O["AREALIGHT"+B]=!1,O["SHADOW"+B]=!1,O["SHADOWCSM"+B]=!1,O["SHADOWCSMDEBUG"+B]=!1,O["SHADOWCSMNUM_CASCADES"+B]=!1,O["SHADOWCSMUSESHADOWMAXZ"+B]=!1,O["SHADOWCSMNOBLEND"+B]=!1,O["SHADOWCSM_RIGHTHANDED"+B]=!1,O["SHADOWPCF"+B]=!1,O["SHADOWPCSS"+B]=!1,O["SHADOWPOISSON"+B]=!1,O["SHADOWESM"+B]=!1,O["SHADOWCLOSEESM"+B]=!1,O["SHADOWCUBE"+B]=!1,O["SHADOWLOWQUALITY"+B]=!1,O["SHADOWMEDIUMQUALITY"+B]=!1);const j=M.getEngine().getCaps();return void 0===O.SHADOWFLOAT&&(c.needRebuild=!0),O.SHADOWFLOAT=c.shadowEnabled&&(j.textureFloatRender&&j.textureFloatLinearFiltering||j.textureHalfFloatRender&&j.textureHalfFloatLinearFiltering),O.LIGHTMAPEXCLUDED=c.lightmapMode,c.needRebuild&&O.rebuild(),c.needNormals}function N(M,A,O,S,z,Q,c){switch(c.needNormals=!0,void 0===z["LIGHT"+S]&&(c.needRebuild=!0),z["LIGHT"+S]=!0,z["SPOTLIGHT"+S]=!1,z["HEMILIGHT"+S]=!1,z["POINTLIGHT"+S]=!1,z["DIRLIGHT"+S]=!1,z["AREALIGHT"+S]=!1,O.prepareLightSpecificDefines(z,S),z["LIGHT_FALLOFF_PHYSICAL"+S]=!1,z["LIGHT_FALLOFF_GLTF"+S]=!1,z["LIGHT_FALLOFF_STANDARD"+S]=!1,O.falloffType){case X.d.FALLOFF_GLTF:z["LIGHT_FALLOFF_GLTF"+S]=!0;break;case X.d.FALLOFF_PHYSICAL:z["LIGHT_FALLOFF_PHYSICAL"+S]=!0;break;case X.d.FALLOFF_STANDARD:z["LIGHT_FALLOFF_STANDARD"+S]=!0}if(Q&&!O.se.equalsFloats(0,0,0)&&(c.specularEnabled=!0),z["SHADOW"+S]=!1,z["SHADOWCSM"+S]=!1,z["SHADOWCSMDEBUG"+S]=!1,z["SHADOWCSMNUM_CASCADES"+S]=!1,z["SHADOWCSMUSESHADOWMAXZ"+S]=!1,z["SHADOWCSMNOBLEND"+S]=!1,z["SHADOWCSM_RIGHTHANDED"+S]=!1,z["SHADOWPCF"+S]=!1,z["SHADOWPCSS"+S]=!1,z["SHADOWPOISSON"+S]=!1,z["SHADOWESM"+S]=!1,z["SHADOWCLOSEESM"+S]=!1,z["SHADOWCUBE"+S]=!1,z["SHADOWLOWQUALITY"+S]=!1,z["SHADOWMEDIUMQUALITY"+S]=!1,A&&A.receiveShadows&&M.shadowsEnabled&&O.shadowEnabled){var j;const A=null!==(j=O.getShadowGenerator(M.activeCamera))&&void 0!==j?j:O.getShadowGenerator();if(A){const M=A.getShadowMap();M&&M.renderList&&M.renderList.length>0&&(c.shadowEnabled=!0,A.prepareDefines(z,S))}}O.lightmapMode!=X.d.LIGHTMAP_DEFAULT?(c.lightmapMode=!0,z["LIGHTMAPEXCLUDED"+S]=!0,z["LIGHTMAPNOSPECULAR"+S]=O.lightmapMode==X.d.LIGHTMAP_SHADOWSONLY):(z["LIGHTMAPEXCLUDED"+S]=!1,z["LIGHTMAPNOSPECULAR"+S]=!1)}function y(M,A,O,S,z){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=function(M,A){let O=!1;if(M.activeCamera){const S=A.CAMERA_ORTHOGRAPHIC?1:0,z=A.CAMERA_PERSPECTIVE?1:0,Q=1===M.activeCamera.mode?1:0,X=0===M.activeCamera.mode?1:0;(S^Q||z^X)&&(A.CAMERA_ORTHOGRAPHIC=1===Q,A.CAMERA_PERSPECTIVE=1===X,O=!0)}return O}(M,S);!1!==Q&&(j=(0,c.e)(O,M,S)),S.DEPTHPREPASS!==!A.getColorWrite()&&(S.DEPTHPREPASS=!S.DEPTHPREPASS,j=!0),S.INSTANCES!==z&&(S.INSTANCES=z,j=!0),S.THIN_INSTANCES!==X&&(S.THIN_INSTANCES=X,j=!0),j&&S.markAsUnprocessed()}function h(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!A._areAttributesDirty&&A._needNormals===A._normals&&A._needUVs===A._uvs)return!1;A._normals=A._needNormals,A._uvs=A._needUVs,A.NORMAL=A._needNormals&&M.isVerticesDataPresent("normal"),A._needNormals&&M.isVerticesDataPresent("tangent")&&(A.TANGENT=!0);for(let c=1;c<=6;++c)A["UV"+c]=!!A._needUVs&&M.isVerticesDataPresent("uv".concat(1===c?"":c));if(O){const O=M.useVertexColors&&M.isVerticesDataPresent("color");A.VERTEXCOLOR=O,A.VERTEXALPHA=M.hasVertexAlpha&&O&&Q}return M.isVerticesDataPresent("instanceColor")&&(M.hasInstances||M.hasThinInstances)&&(A.INSTANCESCOLOR=!0),S&&function(M,A){if(M.useBones&&M.computeBonesUsingShaders&&M.skeleton){A.NUM_BONE_INFLUENCERS=M.numBoneInfluencers;const O=void 0!==A.BONETEXTURE;if(M.skeleton.isUsingTextureForMatrices&&O)A.BONETEXTURE=!0;else{A.BonesPerMesh=M.skeleton.bones.length+1,A.BONETEXTURE=!O&&void 0;const S=M.HM().prePassRenderer;if(S&&S.enabled){const O=-1===S.excludedSkinnedMesh.indexOf(M);A.BONES_VELOCITY_ENABLED=O}}}else A.NUM_BONE_INFLUENCERS=0,A.BonesPerMesh=0,void 0!==A.BONETEXTURE&&(A.BONETEXTURE=!1)}(M,A),z&&function(M,A){const O=M.morphTargetManager;O?(A.MORPHTARGETS_UV=O.supportsUVs&&A.UV1,A.MORPHTARGETS_UV2=O.supportsUV2s&&A.UV2,A.MORPHTARGETS_TANGENT=O.supportsTangents&&A.TANGENT,A.MORPHTARGETS_NORMAL=O.supportsNormals&&A.NORMAL,A.MORPHTARGETS_POSITION=O.supportsPositions,A.MORPHTARGETS_COLOR=O.supportsColors,A.MORPHTARGETTEXTURE_HASUVS=O.hasUVs,A.MORPHTARGETTEXTURE_HASUV2S=O.hasUV2s,A.MORPHTARGETTEXTURE_HASTANGENTS=O.hasTangents,A.MORPHTARGETTEXTURE_HASNORMALS=O.hasNormals,A.MORPHTARGETTEXTURE_HASPOSITIONS=O.hasPositions,A.MORPHTARGETTEXTURE_HASCOLORS=O.hasColors,A.NUM_MORPH_INFLUENCERS=O.numMaxInfluencers||O.numInfluencers,A.MORPHTARGETS=A.NUM_MORPH_INFLUENCERS>0,A.MORPHTARGETS_TEXTURE=O.isUsingTextureForTargets):(A.MORPHTARGETS_UV=!1,A.MORPHTARGETS_UV2=!1,A.MORPHTARGETS_TANGENT=!1,A.MORPHTARGETS_NORMAL=!1,A.MORPHTARGETS_POSITION=!1,A.MORPHTARGETS_COLOR=!1,A.MORPHTARGETTEXTURE_HASUVS=!1,A.MORPHTARGETTEXTURE_HASUV2S=!1,A.MORPHTARGETTEXTURE_HASTANGENTS=!1,A.MORPHTARGETTEXTURE_HASNORMALS=!1,A.MORPHTARGETTEXTURE_HASPOSITIONS=!1,A.MORPHTARGETTEXTURE_HAS_COLORS=!1,A.MORPHTARGETS=!1,A.NUM_MORPH_INFLUENCERS=0)}(M,A),X&&function(M,A){const O=M.bakedVertexAnimationManager;A.BAKED_VERTEX_ANIMATION_TEXTURE=!(!O||!O.isEnabled)}(M,A),!0}function u(M,A){if(M.activeCamera){const O=A.MULTIVIEW;A.MULTIVIEW=null!==M.activeCamera.outputRenderTarget&&M.activeCamera.outputRenderTarget.getViewCount()>1,A.MULTIVIEW!=O&&A.markAsUnprocessed()}}function i(M,A,O){const S=A.ORDER_INDEPENDENT_TRANSPARENCY,z=A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;A.ORDER_INDEPENDENT_TRANSPARENCY=M.useOrderIndependentTransparency&&O,A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!M.getEngine().getCaps().textureFloatLinearFiltering,S===A.ORDER_INDEPENDENT_TRANSPARENCY&&z===A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||A.markAsUnprocessed()}function U(M,A,O){const S=A.PREPASS;if(!A._arePrePassDirty)return;const z=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(M.prePassRenderer&&M.prePassRenderer.enabled&&O){A.PREPASS=!0,A.SCENE_MRT_COUNT=M.prePassRenderer.mrtCount,A.PREPASS_NORMAL_WORLDSPACE=M.prePassRenderer.generateNormalsInWorldSpace,A.PREPASS_COLOR=!0,A.PREPASS_COLOR_INDEX=0;for(let O=0;O<z.length;O++){const S=M.prePassRenderer.getIndex(z[O].type);-1!==S?(A[z[O].define]=!0,A[z[O].index]=S):A[z[O].define]=!1}}else{A.PREPASS=!1;for(let M=0;M<z.length;M++)A[z[M].define]=!1}A.PREPASS!=S&&(A.markAsUnprocessed(),A.markAsImageProcessingDirty())}function L(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6];z&&z.push("Light"+M),Q||(A.push("vLightData"+M,"vLightDiffuse"+M,"vLightSpecular"+M,"vLightDirection"+M,"vLightWidth"+M,"vLightHeight"+M,"vLightFalloff"+M,"vLightGround"+M,"lightMatrix"+M,"shadowsInfo"+M,"depthValues"+M),O.push("shadowTexture"+M),O.push("depthTexture"+M),A.push("viewFrustumZ"+M,"cascadeBlendFactor"+M,"lightSizeUVCorrection"+M,"depthCorrection"+M,"penumbraDarkness"+M,"frustumLengths"+M),S&&(O.push("projectionLightTexture"+M),A.push("textureProjectionMatrix"+M)),X&&O.push("iesLightTexture"+M))}function t(M,A,O){let S,z,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(M.uniformsNames){const X=M;S=X.uniformsNames,z=X.uniformBuffersNames,A=X.samplers,O=X.defines,Q=X.maxSimultaneousLights||0}else S=M,A||(A=[]);for(let X=0;X<Q&&O["LIGHT"+X];X++)L(X,S,A,O["PROJECTEDLIGHTTEXTURE"+X],z,!1,O["IESLIGHTTEXTURE"+X]);O.NUM_MORPH_INFLUENCERS&&(S.push("morphTargetInfluences"),S.push("morphTargetCount")),O.BAKED_VERTEX_ANIMATION_TEXTURE&&(S.push("bakedVertexAnimationSettings"),S.push("bakedVertexAnimationTextureSizeInverted"),S.push("bakedVertexAnimationTime"),A.push("bakedVertexAnimationTexture"))}},13278:(M,A,O)=>{O.d(A,{e:()=>Q});var S=O(12970),z=O(13286);class Q extends z.b{constructor(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(M,A,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.Matrix,this._storeEffectOnSubMeshes=O}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(M,A){return!!M&&(!this._storeEffectOnSubMeshes||(!M.Bc||0===M.Bc.length||this.isReadyForSubMesh(M,M.Bc[0],A)))}_isReadyForSubMesh(M){const A=M.materialDefines;return!(this.checkReadyOnEveryCall||!M.effect||!A||A._renderId!==this.HM().getRenderId())}bindOnlyWorldMatrix(M){this._activeEffect.setMatrix("world",M)}bindOnlyNormalMatrix(M){this._activeEffect.setMatrix("normalMatrix",M)}bind(M,A){A&&this.bindForSubMesh(M,A,A.Bc[0])}_afterBind(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;super._afterBind(M,A,O),this.HM()._cachedEffect=A,O?O._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return O._drawWrapper._forceRebindOnNextCall||M.isCachedMaterialInvalid(this,A,S)}dispose(M,A,O){this._activeEffect=void 0,super.dispose(M,A,O)}}},13313:(M,A,O)=>{O.d(A,{d:()=>c,e:()=>j});var S=O(12958),z=O(12970),Q=O(12964);class X{static extractMinAndMaxIndexed(M,A,O,S,z,Q){for(let X=O;X<O+S;X++){const O=3*A[X],S=M[O],c=M[O+1],j=M[O+2];z.minimizeInPlaceFromFloats(S,c,j),Q.maximizeInPlaceFromFloats(S,c,j)}}static extractMinAndMax(M,A,O,S,z,Q){for(let X=A,c=A*S;X<A+O;X++,c+=S){const A=M[c],O=M[c+1],S=M[c+2];z.minimizeInPlaceFromFloats(A,O,S),Q.maximizeInPlaceFromFloats(A,O,S)}}}function c(M,A,O,S){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const c=new z.GA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new z.GA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return X.extractMinAndMaxIndexed(M,A,O,S,c,j),Q&&(c.x-=c.x*Q.x+Q.y,c.y-=c.y*Q.x+Q.y,c.z-=c.z*Q.x+Q.y,j.x+=j.x*Q.x+Q.y,j.y+=j.y*Q.x+Q.y,j.z+=j.z*Q.x+Q.y),{minimum:c,maximum:j}}function j(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0;const c=new z.GA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),j=new z.GA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Q||(Q=3),X.extractMinAndMax(M,A,O,Q,c,j),S&&(c.x-=c.x*S.x+S.y,c.y-=c.y*S.x+S.y,c.z-=c.z*S.x+S.y,j.x+=j.x*S.x+S.y,j.y+=j.y*S.x+S.y,j.z+=j.z*S.x+S.y),{minimum:c,maximum:j}}(0,S.d)([Q.c.filter((function(){for(var M=arguments.length,A=new Array(M),O=0;O<M;O++)A[O]=arguments[O];let[S,z]=A;return!Array.isArray(S)&&!Array.isArray(z)}))],X,"extractMinAndMaxIndexed",null),(0,S.d)([Q.c.filter((function(){for(var M=arguments.length,A=new Array(M),O=0;O<M;O++)A[O]=arguments[O];let[S]=A;return!Array.isArray(S)}))],X,"extractMinAndMax",null)},13292:(M,A,O)=>{O.d(A,{e:()=>j});var S=O(13043),z=O(13298),Q=O(13301),X=O(13313),c=O(13096);class j{get materialDefines(){var M;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(M=this._getDrawWrapper())||void 0===M?void 0:M.defines}set materialDefines(M){var A;(null!==(A=this._mainDrawWrapperOverride)&&void 0!==A?A:this._getDrawWrapper(void 0,!0)).defines=M}_getDrawWrapper(M){var A;let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M=null!==(A=M)&&void 0!==A?A:this._engine.currentRenderPassId;let S=this._drawWrappers[M];return!S&&O&&(this._drawWrappers[M]=S=new c.c(this._mesh.HM().getEngine())),S}_removeDrawWrapper(M){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var O;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(O=this._drawWrappers[M])||void 0===O||O.dispose(A));this._drawWrappers[M]=void 0}get effect(){var M,A;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(M=null===(A=this._getDrawWrapper())||void 0===A?void 0:A.effect)&&void 0!==M?M:null}get _drawWrapper(){var M;return null!==(M=this._mainDrawWrapperOverride)&&void 0!==M?M:this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(M){this._mainDrawWrapperOverride=M}setEffect(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this._drawWrapper;z.setEffect(M,A,S),void 0!==O&&(z.materialContext=O),M||(z.defines=null,z.materialContext=void 0)}resetDrawCache(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==M)return void this._removeDrawWrapper(M,!0,A);for(const M of this._drawWrappers)null===M||void 0===M||M.dispose(A)}this._drawWrappers=[]}static AddToMesh(M,A,O,S,z,Q,X){return new j(M,A,O,S,z,Q,X,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(M,A,O,S,z,Q,X){let c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],j=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=M,this.verticesStart=A,this.verticesCount=O,this.indexStart=S,this.indexCount=z,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Q,this._renderingMesh=X||Q,j&&Q.Bc.push(this),this._engine=this._mesh.HM().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Q.Bc.length-1,c&&(this.refreshBoundingInfo(),Q.Gc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(M){return this._boundingInfo=M,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const M=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return M||this._renderingMesh}tM(){var M;let A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=null!==(M=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==M?M:this._renderingMesh.material;if(!O)return A&&this._mesh.HM()._hasDefaultMaterial?this._mesh.HM().defaultMaterial:null;if(this._isMultiMaterial(O)){const M=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==M&&(this._currentMaterial=M,this.resetDrawCache()),M}return O}_isMultiMaterial(M){return void 0!==M.getSubMaterial}refreshBoundingInfo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wc)return this;if(M||(M=this._renderingMesh.getVerticesData(S.c.PositionKind)),!M)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const A=this._renderingMesh.Ic();let O;if(0===this.indexStart&&this.indexCount===A.length){const M=this._renderingMesh.getBoundingInfo();O={minimum:M.minimum.clone(),maximum:M.maximum.clone()}}else O=(0,X.d)(M,A,this.indexStart,this.indexCount,this._renderingMesh.wc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(O.minimum,O.maximum):this._boundingInfo=new Q.b(O.minimum,O.maximum),this}_checkCollision(M){return this.getBoundingInfo()._checkCollision(M)}updateBoundingInfo(M){let A=this.getBoundingInfo();return A||(this.refreshBoundingInfo(),A=this.getBoundingInfo()),A&&A.update(M),this}isInFrustum(M){const A=this.getBoundingInfo();return!!A&&A.isInFrustum(M,this._mesh.FT)}isCompletelyInFrustum(M){const A=this.getBoundingInfo();return!!A&&A.isCompletelyInFrustum(M)}render(M){return this._renderingMesh.render(this,M,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(M,A){if(!this._linesIndexBuffer){const O=6*Math.floor(this.indexCount/3),S=this.verticesStart+this.verticesCount>65535?new Uint32Array(O):new Uint16Array(O);let z=0;if(0===M.length)for(let M=this.indexStart;M<this.indexStart+this.indexCount;M+=3)S[z++]=M,S[z++]=M+1,S[z++]=M+1,S[z++]=M+2,S[z++]=M+2,S[z++]=M;else for(let A=this.indexStart;A<this.indexStart+this.indexCount;A+=3)S[z++]=M[A],S[z++]=M[A+1],S[z++]=M[A+1],S[z++]=M[A+2],S[z++]=M[A+2],S[z++]=M[A];this._linesIndexBuffer=A.createIndexBuffer(S),this._linesIndexCount=S.length}return this._linesIndexBuffer}canIntersects(M){const A=this.getBoundingInfo();return!!A&&M.intersectsBox(A.boundingBox)}intersects(M,A,O,S,z){const Q=this.tM();if(!Q)return null;let X=3,c=!1;switch(Q.fillMode){case 3:case 5:case 6:case 8:return null;case 7:X=1,c=!0}return 4===Q.fillMode?O.length?this._intersectLines(M,A,O,this._mesh.intersectionThreshold,S):this._intersectUnIndexedLines(M,A,O,this._mesh.intersectionThreshold,S):!O.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(M,A,O,S,z):this._intersectTriangles(M,A,O,X,c,S,z)}_intersectLines(M,A,O,S,Q){let X=null;for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=2){const j=A[O[c]],B=A[O[c+1]],g=M.intersectionSegment(j,B,S);if(!(g<0)&&((Q||!X||g<X.distance)&&(X=new z.c(null,null,g),X.faceId=c/2,Q)))break}return X}_intersectUnIndexedLines(M,A,O,S,Q){let X=null;for(let c=this.verticesStart;c<this.verticesStart+this.verticesCount;c+=2){const O=A[c],j=A[c+1],B=M.intersectionSegment(O,j,S);if(!(B<0)&&((Q||!X||B<X.distance)&&(X=new z.c(null,null,B),X.faceId=c/2,Q)))break}return X}_intersectTriangles(M,A,O,S,z,Q,X){let c=null,j=-1;for(let B=this.indexStart;B<this.indexStart+this.indexCount-(3-S);B+=S){j++;const S=O[B],g=O[B+1],e=O[B+2];if(z&&4294967295===e){B+=2;continue}const T=A[S],J=A[g],K=A[e];if(!T||!J||!K)continue;if(X&&!X(T,J,K,M,S,g,e))continue;const G=M.intersectsTriangle(T,J,K);if(G){if(G.distance<0)continue;if((Q||!c||G.distance<c.distance)&&(c=G,c.faceId=j,Q))break}}return c}_intersectUnIndexedTriangles(M,A,O,S,z){let Q=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=3){const O=A[X],c=A[X+1],j=A[X+2];if(z&&!z(O,c,j,M,-1,-1,-1))continue;const B=M.intersectsTriangle(O,c,j);if(B){if(B.distance<0)continue;if((S||!Q||B.distance<Q.distance)&&(Q=B,Q.faceId=X/3,S))break}}return Q}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(M,A){const O=new j(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,M,A,!1);if(!this.IsGlobal){const M=this.getBoundingInfo();if(!M)return O;O._boundingInfo=new Q.b(M.minimum,M.maximum)}return O}dispose(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.HM().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const A=this._mesh.Bc.indexOf(this);this._mesh.Bc.splice(A,1),this.resetDrawCache(void 0,M)}getClassName(){return"SubMesh"}static CreateFromIndices(M,A,O,S,z){let Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],X=Number.MAX_VALUE,c=-Number.MAX_VALUE;const B=(z||S).Ic();for(let j=A;j<A+O;j++){const M=B[j];M<X&&(X=M),M>c&&(c=M)}return new j(M,X,c-X+1,A,O,S,z,Q)}}}}]);