"use strict";(self.bbj0x35f849=self.bbj0x35f849||[]).push([[24],{11460:(N,q,C)=>{C.d(q,{b:()=>d});class d{constructor(N,q,C){this.bu=N,this.bv=q,this.distance=C,this.faceId=0,this.subMeshId=0}}},11469:(N,q,C)=>{C.d(q,{e:()=>a});var d=C(11134),U=C(11122),W=C(11129);class a{constructor(N,q,C){this.vectors=(0,d.d)(8,U.Jq.Zero),this.center=U.Jq.Zero(),this.centerWorld=U.Jq.Zero(),this.extendSize=U.Jq.Zero(),this.extendSizeWorld=U.Jq.Zero(),this.directions=(0,d.d)(3,U.Jq.Zero),this.vectorsWorld=(0,d.d)(8,U.Jq.Zero),this.minimumWorld=U.Jq.Zero(),this.maximumWorld=U.Jq.Zero(),this.minimum=U.Jq.Zero(),this.maximum=U.Jq.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(N,q,C)}reConstruct(N,q,C){const d=N.x,W=N.y,a=N.z,F=q.x,w=q.y,A=q.z,n=this.vectors;this.minimum.hd(d,W,a),this.maximum.hd(F,w,A),n[0].hd(d,W,a),n[1].hd(F,w,A),n[2].hd(F,W,a),n[3].hd(d,w,a),n[4].hd(d,W,A),n[5].hd(F,w,a),n[6].hd(d,w,A),n[7].hd(F,W,A),q.addToRef(N,this.center).scaleInPlace(.5),q.subtractToRef(N,this.extendSize).scaleInPlace(.5),this._worldMatrix=C||U.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(N){const q=a._TmpVector3,C=this.maximum.subtractToRef(this.minimum,q[0]),d=C.length();C.normalizeFromLength(d);const U=d*N,W=C.scaleInPlace(.5*U),F=this.center.subtractToRef(W,q[1]),w=this.center.addToRef(W,q[2]);return this.reConstruct(F,w,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){const q=this.minimumWorld,C=this.maximumWorld,d=this.directions,W=this.vectorsWorld,a=this.vectors;if(N.isIdentity()){q.U(this.minimum),C.U(this.maximum);for(let N=0;N<8;++N)W[N].U(a[N]);this.extendSizeWorld.U(this.extendSize),this.centerWorld.U(this.center)}else{q.Rd(Number.MAX_VALUE),C.Rd(-Number.MAX_VALUE);for(let d=0;d<8;++d){const F=W[d];U.Jq.TransformCoordinatesToRef(a[d],N,F),q.minimizeInPlace(F),C.maximizeInPlace(F)}C.subtractToRef(q,this.extendSizeWorld).scaleInPlace(.5),C.addToRef(q,this.centerWorld).scaleInPlace(.5)}U.Jq.FromArrayToRef(N.m,0,d[0]),U.Jq.FromArrayToRef(N.m,4,d[1]),U.Jq.FromArrayToRef(N.m,8,d[2]),this._worldMatrix=N}isInFrustum(N){return a.IsInFrustum(this.vectorsWorld,N)}isCompletelyInFrustum(N){return a.IsCompletelyInFrustum(this.vectorsWorld,N)}intersectsPoint(N){const q=this.minimumWorld,C=this.maximumWorld,d=q.x,U=q.y,a=q.z,F=C.x,w=C.y,A=C.z,n=N.x,t=N.y,V=N.z,Z=-W.e;return!(F-n<Z||Z>n-d)&&(!(w-t<Z||Z>t-U)&&!(A-V<Z||Z>V-a))}intersectsSphere(N){return a.IntersectsSphere(this.minimumWorld,this.maximumWorld,N.centerWorld,N.radiusWorld)}intersectsMinMax(N,q){const C=this.minimumWorld,d=this.maximumWorld,U=C.x,W=C.y,a=C.z,F=d.x,w=d.y,A=d.z,n=N.x,t=N.y,V=N.z,Z=q.x,J=q.y,Q=q.z;return!(F<n||U>Z)&&(!(w<t||W>J)&&!(A<V||a>Q))}dispose(){var N,q;null===(N=this._drawWrapperFront)||void 0===N||N.dispose(),null===(q=this._drawWrapperBack)||void 0===q||q.dispose()}static Intersects(N,q){return N.intersectsMinMax(q.minimumWorld,q.maximumWorld)}static IntersectsSphere(N,q,C,d){const W=a._TmpVector3[0];U.Jq.ClampToRef(C,N,q,W);return U.Jq.DistanceSquared(C,W)<=d*d}static IsCompletelyInFrustum(N,q){for(let C=0;C<6;++C){const d=q[C];for(let q=0;q<8;++q)if(d.dotCoordinate(N[q])<0)return!1}return!0}static IsInFrustum(N,q){for(let C=0;C<6;++C){let d=!0;const U=q[C];for(let q=0;q<8;++q)if(U.dotCoordinate(N[q])>=0){d=!1;break}if(d)return!1}return!0}}a._TmpVector3=(0,d.d)(3,U.Jq.Zero)},11465:(N,q,C)=>{C.d(q,{c:()=>t});var d=C(11134),U=C(11122),W=C(11469),a=C(11474);const F={min:0,max:0},w={min:0,max:0},A=(N,q,C)=>{const d=U.Jq.Dot(q.centerWorld,N),W=Math.abs(U.Jq.Dot(q.directions[0],N))*q.extendSize.x+Math.abs(U.Jq.Dot(q.directions[1],N))*q.extendSize.y+Math.abs(U.Jq.Dot(q.directions[2],N))*q.extendSize.z;C.min=d-W,C.max=d+W},n=(N,q,C)=>(A(N,q,F),A(N,C,w),!(F.min>w.max||w.min>F.max));class t{constructor(N,q,C){this._isLocked=!1,this.boundingBox=new W.e(N,q,C),this.boundingSphere=new a.c(N,q,C)}reConstruct(N,q,C){this.boundingBox.reConstruct(N,q,C),this.boundingSphere.reConstruct(N,q,C)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(N){this._isLocked=N}update(N){this._isLocked||(this.boundingBox._update(N),this.boundingSphere._update(N))}centerOn(N,q){const C=t._TmpVector3[0].U(N).Rn(q),d=t._TmpVector3[1].U(N).addInPlace(q);return this.boundingBox.reConstruct(C,d,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(C,d,this.boundingBox.getWorldMatrix()),this}encapsulate(N){const q=U.Jq.Minimize(this.minimum,N),C=U.Jq.Maximize(this.maximum,N);return this.reConstruct(q,C,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(N){const q=U.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(q);const C=U.TmpVectors.Jq[0];return U.Jq.TransformCoordinatesToRef(N.boundingBox.minimumWorld,q,C),this.encapsulate(C),U.Jq.TransformCoordinatesToRef(N.boundingBox.maximumWorld,q,C),this.encapsulate(C),this}scale(N){return this.boundingBox.scale(N),this.boundingSphere.scale(N),this}isInFrustum(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===q||3===q)&&this.boundingSphere.isCenterInFrustum(N))return!0;if(!this.boundingSphere.isInFrustum(N))return!1;return!(1!==q&&3!==q)||this.boundingBox.isInFrustum(N)}get diagonalLength(){const N=this.boundingBox;return N.maximumWorld.subtractToRef(N.minimumWorld,t._TmpVector3[0]).length()}isCompletelyInFrustum(N){return this.boundingBox.isCompletelyInFrustum(N)}_checkCollision(N){return N._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(N){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(N)&&!!this.boundingBox.intersectsPoint(N))}intersects(N,q){if(!a.c.Intersects(this.boundingSphere,N.boundingSphere))return!1;if(!W.e.Intersects(this.boundingBox,N.boundingBox))return!1;if(!q)return!0;const C=this.boundingBox,d=N.boundingBox;return!!n(C.directions[0],C,d)&&(!!n(C.directions[1],C,d)&&(!!n(C.directions[2],C,d)&&(!!n(d.directions[0],C,d)&&(!!n(d.directions[1],C,d)&&(!!n(d.directions[2],C,d)&&(!!n(U.Jq.Cross(C.directions[0],d.directions[0]),C,d)&&(!!n(U.Jq.Cross(C.directions[0],d.directions[1]),C,d)&&(!!n(U.Jq.Cross(C.directions[0],d.directions[2]),C,d)&&(!!n(U.Jq.Cross(C.directions[1],d.directions[0]),C,d)&&(!!n(U.Jq.Cross(C.directions[1],d.directions[1]),C,d)&&(!!n(U.Jq.Cross(C.directions[1],d.directions[2]),C,d)&&(!!n(U.Jq.Cross(C.directions[2],d.directions[0]),C,d)&&(!!n(U.Jq.Cross(C.directions[2],d.directions[1]),C,d)&&!!n(U.Jq.Cross(C.directions[2],d.directions[2]),C,d))))))))))))))}}t._TmpVector3=(0,d.d)(2,U.Jq.Zero)},11474:(N,q,C)=>{C.d(q,{c:()=>W});var d=C(11134),U=C(11122);class W{constructor(N,q,C){this.center=U.Jq.Zero(),this.centerWorld=U.Jq.Zero(),this.minimum=U.Jq.Zero(),this.maximum=U.Jq.Zero(),this.reConstruct(N,q,C)}reConstruct(N,q,C){this.minimum.U(N),this.maximum.U(q);const d=U.Jq.Distance(N,q);q.addToRef(N,this.center).scaleInPlace(.5),this.radius=.5*d,this._update(C||U.Matrix.IdentityReadOnly)}scale(N){const q=this.radius*N,C=W._TmpVector3,d=C[0].Rd(q),U=this.center.subtractToRef(d,C[1]),a=this.center.addToRef(d,C[2]);return this.reConstruct(U,a,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){if(N.isIdentity())this.centerWorld.U(this.center),this.radiusWorld=this.radius;else{U.Jq.TransformCoordinatesToRef(this.center,N,this.centerWorld);const q=W._TmpVector3[0];U.Jq.TransformNormalFromFloatsToRef(1,1,1,N,q),this.radiusWorld=Math.max(Math.abs(q.x),Math.abs(q.y),Math.abs(q.z))*this.radius}}isInFrustum(N){const q=this.centerWorld,C=this.radiusWorld;for(let d=0;d<6;d++)if(N[d].dotCoordinate(q)<=-C)return!1;return!0}isCenterInFrustum(N){const q=this.centerWorld;for(let C=0;C<6;C++)if(N[C].dotCoordinate(q)<0)return!1;return!0}intersectsPoint(N){const q=U.Jq.DistanceSquared(this.centerWorld,N);return!(this.radiusWorld*this.radiusWorld<q)}static Intersects(N,q){const C=U.Jq.DistanceSquared(N.centerWorld,q.centerWorld),d=N.radiusWorld+q.radiusWorld;return!(d*d<C)}static CreateFromCenterAndRadius(N,q,C){this._TmpVector3[0].U(N),this._TmpVector3[1].hd(0,0,q),this._TmpVector3[2].U(N),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Rn(this._TmpVector3[1]);const d=new W(this._TmpVector3[0],this._TmpVector3[2]);return d._worldMatrix=C||U.Matrix.Identity(),d}}W._TmpVector3=(0,d.d)(3,U.Jq.Zero)},11494:(N,q,C)=>{function d(N){-1===N.indexOf("vClipPlane")&&N.push("vClipPlane"),-1===N.indexOf("vClipPlane2")&&N.push("vClipPlane2"),-1===N.indexOf("vClipPlane3")&&N.push("vClipPlane3"),-1===N.indexOf("vClipPlane4")&&N.push("vClipPlane4"),-1===N.indexOf("vClipPlane5")&&N.push("vClipPlane5"),-1===N.indexOf("vClipPlane6")&&N.push("vClipPlane6")}function U(N,q,C){const d=!!(N.clipPlane??q.clipPlane),U=!!(N.clipPlane2??q.clipPlane2),W=!!(N.clipPlane3??q.clipPlane3),a=!!(N.clipPlane4??q.clipPlane4),F=!!(N.clipPlane5??q.clipPlane5),w=!!(N.clipPlane6??q.clipPlane6);d&&C.push("#define CLIPPLANE"),U&&C.push("#define CLIPPLANE2"),W&&C.push("#define CLIPPLANE3"),a&&C.push("#define CLIPPLANE4"),F&&C.push("#define CLIPPLANE5"),w&&C.push("#define CLIPPLANE6")}function W(N,q,C){let d=!1;const U=!!(N.clipPlane??q.clipPlane),W=!!(N.clipPlane2??q.clipPlane2),a=!!(N.clipPlane3??q.clipPlane3),F=!!(N.clipPlane4??q.clipPlane4),w=!!(N.clipPlane5??q.clipPlane5),A=!!(N.clipPlane6??q.clipPlane6);return C.CLIPPLANE!==U&&(C.CLIPPLANE=U,d=!0),C.CLIPPLANE2!==W&&(C.CLIPPLANE2=W,d=!0),C.CLIPPLANE3!==a&&(C.CLIPPLANE3=a,d=!0),C.CLIPPLANE4!==F&&(C.CLIPPLANE4=F,d=!0),C.CLIPPLANE5!==w&&(C.CLIPPLANE5=w,d=!0),C.CLIPPLANE6!==A&&(C.CLIPPLANE6=A,d=!0),d}function a(N,q,C){let d=q.clipPlane??C.clipPlane;F(N,"vClipPlane",d),d=q.clipPlane2??C.clipPlane2,F(N,"vClipPlane2",d),d=q.clipPlane3??C.clipPlane3,F(N,"vClipPlane3",d),d=q.clipPlane4??C.clipPlane4,F(N,"vClipPlane4",d),d=q.clipPlane5??C.clipPlane5,F(N,"vClipPlane5",d),d=q.clipPlane6??C.clipPlane6,F(N,"vClipPlane6",d)}function F(N,q,C){C&&N.setFloat4(q,C.normal.x,C.normal.y,C.normal.z,C.d)}C.d(q,{c:()=>d,d:()=>a,h:()=>W,i:()=>U})},11437:(N,q,C)=>{C.d(q,{b:()=>d});class d{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(N,q){this._defines[N]||(N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N),this._defines[N]=new Array),this._defines[N].push(q)}addCPUSkinningFallback(N,q){this._mesh=q,N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(N,q){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,N=N.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),q._bonesComputationForcedToCPU=!0;const C=this._mesh.lN();for(let N=0;N<C.meshes.length;N++){const d=C.meshes[N];if(d.material){if(d.computeBonesUsingShaders&&0!==d.numBoneInfluencers)if(d.material.getEffect()===q)d.computeBonesUsingShaders=!1;else if(d.jd)for(const N of d.jd){if(N.effect===q){d.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&d.computeBonesUsingShaders&&d.numBoneInfluencers>0&&(d.computeBonesUsingShaders=!1)}}else{const q=this._defines[this._currentRank];if(q)for(let C=0;C<q.length;C++)N=N.replace("#define "+q[C],"");this._currentRank++}return N}}},11447:(N,q,C)=>{C.d(q,{d:()=>v});var d=C(11110),U=C(11114),W=C(10945),a=C(10949),F=C(10995),w=C(11455),A=C(11381),n=C(10962),t=C(11169),V=C(11247),Z=C(11155);class J{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(N){this._func=N}get funcRef(){return this._funcRef}set funcRef(N){this._funcRef=N}get funcMask(){return this._funcMask}set funcMask(N){this._funcMask=N}get opStencilFail(){return this._opStencilFail}set opStencilFail(N){this._opStencilFail=N}get opDepthFail(){return this._opDepthFail}set opDepthFail(N){this._opDepthFail=N}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(N){this._opStencilDepthPass=N}get mask(){return this._mask}set mask(N){this._mask=N}get enabled(){return this._enabled}set enabled(N){this._enabled=N}getClassName(){return"MaterialStencilState"}copyTo(N){Z.d.Clone((()=>N),this)}serialize(){return Z.d.Serialize(this)}parse(N,q,C){Z.d.Parse((()=>this),N,q,C)}}(0,d.d)([(0,U.O)()],J.prototype,"func",null),(0,d.d)([(0,U.O)()],J.prototype,"funcRef",null),(0,d.d)([(0,U.O)()],J.prototype,"funcMask",null),(0,d.d)([(0,U.O)()],J.prototype,"opStencilFail",null),(0,d.d)([(0,U.O)()],J.prototype,"opDepthFail",null),(0,d.d)([(0,U.O)()],J.prototype,"opStencilDepthPass",null),(0,d.d)([(0,U.O)()],J.prototype,"mask",null),(0,d.d)([(0,U.O)()],J.prototype,"enabled",null);var Q=C(11487);class v{get _supportGlowLayer(){return!1}set _glowModeEnabled(N){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(N){if(this._alpha===N)return;const q=this._alpha;this._alpha=N,1!==q&&1!==N||this.HA(v.MiscDirtyFlag+v.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ld(N){this._backFaceCulling!==N&&(this._backFaceCulling=N,this.HA(v.TextureDirtyFlag))}get Ld(){return this._backFaceCulling}set cullBackFaces(N){this._cullBackFaces!==N&&(this._cullBackFaces=N,this.HA(v.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(N){this._blockDirtyMechanism!==N&&(this._blockDirtyMechanism=N,N||this.et())}atomicMaterialsUpdate(N){this.blockDirtyMechanism=!0;try{N(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(N){this._onDisposeObserver&&this.td.remove(this._onDisposeObserver),this._onDisposeObserver=this.td.add(N)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new a.b),this._onBindObservable}set onBind(N){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(N)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new a.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new a.b),this._onEffectCreatedObservable}set alphaMode(N){this._alphaMode!==N&&(this._alphaMode=N,this.HA(v.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(N){this._needDepthPrePass!==N&&(this._needDepthPrePass=N,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(N){this._fogEnabled!==N&&(this._fogEnabled=N,this.HA(v.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case v.WireFrameFillMode:case v.LineListDrawMode:case v.LineLoopDrawMode:case v.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(N){this.fillMode=N?v.WireFrameFillMode:v.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case v.PointFillMode:case v.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(N){this.fillMode=N?v.PointFillMode:v.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(N){this._fillMode!==N&&(this._fillMode=N,this.HA(v.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){const q=this.lN().getEngine().getCaps().fragmentDepthSupported;N&&!q&&n.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=N&&q,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(N){this._drawWrapper=N}constructor(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.td=new a.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new J,this._useUBO=!1,this._fillMode=v.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=N;const U=q||F.e.LastCreatedScene;U&&(this._scene=U,this._dirtyCallbacks={},this._forceGLSL=d,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=N||W.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new V.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new A.d(this._scene.getEngine(),void 0,void 0,N),this._useUBO=this.lN().getEngine().supportsUniformBuffers,this._createUniformBuffer(),C||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),v.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var N;const q=this.lN().getEngine();null===(N=this._uniformBuffer)||void 0===N||N.dispose(),q.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new A.d(q,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new A.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(N){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.et(),this.checkReadyOnlyOnce=!0}unfreeze(){this.et(),this.checkReadyOnlyOnce=!1}isReady(N,q){return!0}isReadyForSubMesh(N,q,C){const d=q.materialDefines;return!!d&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=d,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}lN(){return this._scene}_getEffectiveOrientation(N){return null!==this.sideOrientation?this.sideOrientation:N.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(N){this._transparencyMode!==N&&(this._transparencyMode=N,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===v.MATERIAL_ALPHABLEND||this._transparencyMode===v.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===v.MATERIAL_ALPHATEST||this._transparencyMode===v.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===v.MATERIAL_OPAQUE||this._transparencyMode===v.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(N){return this._hasTransparencyMode?this._transparencyModeIsBlend:N.visibility<1||!this._disableAlphaBlending&&(N.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(N){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(N)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}et(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const q=this.lN().meshes;for(const C of q)if(C.jd)for(const q of C.jd)if(q.bN()===this)for(const C of q._drawWrappers)C&&this._materialContext===C.materialContext&&(C._wasPreviouslyReady=!1,C._wasPreviouslyUsingInstances=null,C._forceRebindOnNextCall=N);N&&this.HA(v.AllDirtyFlag)}_preBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.getEngine(),d=(null==q?this.sideOrientation:q)===v.ClockWiseSideOrientation;return C.enableEffect(N||this._getDrawWrapper()),C.setState(this.Ld,this.zOffset,!1,d,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),d}bind(N,q){}buildUniformLayout(){const N=this._uniformBuffer;this._eventInfo.ubo=N,this._callbackPluginEventGeneric(8,this._eventInfo),N.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(N,q,C){const d=C._drawWrapper;this._eventInfo.subMesh=C,this._callbackPluginEventBindForSubMesh(this._eventInfo),d._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(N){}bindView(N){this._useUBO?this._needToBindSceneUbo=!0:N.setMatrix("view",this.lN().getViewMatrix())}bindViewProjection(N){this._useUBO?this._needToBindSceneUbo=!0:(N.setMatrix("viewProjection",this.lN().getTransformMatrix()),N.setMatrix("projection",this.lN().getProjectionMatrix()))}bindEyePosition(N,q){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(N,q)}_afterBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&q&&(this._needToBindSceneUbo=!1,(0,Q.t)(q,this.lN().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=N?N.visibility:1,this._onBindObservable&&N&&this._onBindObservable.notifyObservers(N),this.disableDepthWrite){const N=this._scene.getEngine();this._cachedDepthWriteState=N.getDepthWrite(),N.setDepthWrite(!1)}if(this.disableColorWrite){const N=this._scene.getEngine();this._cachedColorWriteState=N.getColorWrite(),N.setColorWrite(!1)}if(0!==this.depthFunction){const N=this._scene.getEngine();this._cachedDepthFunctionState=N.getDepthFunction()||0,N.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(N){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=N,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(N){return null}_clonePlugins(N,q){const C={};if(this._serializePlugins(C),v._ParsePlugins(C,N,this._scene,q),this.pluginManager)for(const d of this.pluginManager._plugins){const q=N.pluginManager.getPlugin(d.name);q&&d.copyTo(q)}}getBindedMeshes(){if(this.meshMap){const N=[];for(const q in this.meshMap){const C=this.meshMap[q];C&&N.push(C)}return N}return this._scene.meshes.filter((N=>N.material===this))}forceCompilation(N,q,C,d){const U={clipPlane:!1,useInstances:!1,...C},W=this.lN(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const F=()=>{if(!this._scene||!this._scene.getEngine())return;const C=W.clipPlane;if(U.clipPlane&&(W.clipPlane=new t.b(0,0,0,1)),this._storeEffectOnSubMeshes){let C=!0,W=null;if(N.jd){const q=new w.b(0,0,0,0,0,N,void 0,!1,!1);q.materialDefines&&(q.materialDefines._renderId=-1),this.isReadyForSubMesh(N,q,U.useInstances)||(q.effect&&q.effect.getCompilationError()&&q.effect.allFallbacksProcessed()?W=q.effect.getCompilationError():(C=!1,setTimeout(F,16)))}C&&(this.allowShaderHotSwapping=a,W&&d&&d(W),q&&q(this))}else this.isReady()?(this.allowShaderHotSwapping=a,q&&q(this)):setTimeout(F,16);U.clipPlane&&(W.clipPlane=C)};F()}async forceCompilationAsync(N,q){return await new Promise(((C,d)=>{this.forceCompilation(N,(()=>{C()}),q,(N=>{d(N)}))}))}HA(N){this.lN().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(v._DirtyCallbackArray.length=0,N&v.ImageProcessingDirtyFlag&&v._DirtyCallbackArray.push(v._ImageProcessingDirtyCallBack),N&v.TextureDirtyFlag&&v._DirtyCallbackArray.push(v._TextureDirtyCallBack),N&v.LightDirtyFlag&&v._DirtyCallbackArray.push(v._LightsDirtyCallBack),N&v.FresnelDirtyFlag&&v._DirtyCallbackArray.push(v._FresnelDirtyCallBack),N&v.AttributesDirtyFlag&&v._DirtyCallbackArray.push(v._AttributeDirtyCallBack),N&v.MiscDirtyFlag&&v._DirtyCallbackArray.push(v._MiscDirtyCallBack),N&v.PrePassDirtyFlag&&v._DirtyCallbackArray.push(v._PrePassDirtyCallBack),v._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(v._RunDirtyCallBacks),this.lN().resetCachedMaterial())}resetDrawCache(){const N=this.lN().meshes;for(const q of N)if(q.jd)for(const N of q.jd)N.bN()===this&&N.resetDrawCache()}_markAllSubMeshesAsDirty(N){const q=this.lN();if(q.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const C=q.meshes;for(const d of C)if(d.jd)for(const C of d.jd){if((C.bN()||(q._hasDefaultMaterial?q.defaultMaterial:null))===this)for(const q of C._drawWrappers)q&&q.defines&&q.defines.markAllAsDirty&&this._materialContext===q.materialContext&&N(q.defines)}}_markScenePrePassDirty(){if(this.lN().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const N=this.lN().enablePrePassRenderer();N&&N.HA()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(v._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(v._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(v._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(v._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(v._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(v._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(v._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(v._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(v._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(v._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const N=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.td.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(N)}))}}setPrePassRenderer(N){return!1}dispose(N,q,C){const d=this.lN();if(d.stopAnimation(this),d.freeProcessedMaterials(),d.removeMaterial(this),this._eventInfo.forceDisposeTextures=q,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const N=this._parentContainer.materials.indexOf(this);N>-1&&this._parentContainer.materials.splice(N,1),this._parentContainer=null}if(!0!==C)if(this.meshMap)for(const U in this.meshMap){const N=this.meshMap[U];this._disposeMeshResources(N)}else{const N=d.meshes;for(const q of N)this._disposeMeshResources(q)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.td.notifyObservers(this),this.td.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(N){if(!N)return;const q=N.ed,C=N._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(N.jd&&C)for(const U of N.jd){const N=U._drawWrappers;for(let W=0;W<N.length;W++){var d;const a=null===(d=N[W])||void 0===d?void 0:d.effect;if(!a)continue;C[W]===this&&(null===q||void 0===q||q._releaseVertexArrayObject(a),U._removeDrawWrapper(W,!0,!0))}}}else null===q||void 0===q||q._releaseVertexArrayObject(this._drawWrapper.effect);N.material!==this||N.sourceMesh||(N.material=null)}serialize(){const N=Z.d.Serialize(this);return N.stencil=this.stencil.serialize(),N.uniqueId=this.uniqueId,this._serializePlugins(N),N}_serializePlugins(N){if(N.plugins={},this.pluginManager)for(const q of this.pluginManager._plugins)q.doNotSerialize||(N.plugins[q.getClassName()]=q.serialize())}static Parse(N,q,C){if(N.customType){if("BABYLON.PBRMaterial"===N.customType&&N.overloadedAlbedo&&(N.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return n.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else N.customType="BABYLON.StandardMaterial";const d=W.Tools.Instantiate(N.customType).Parse(N,q,C);return d._loadedUniqueId=N.uniqueId,d}static _ParsePlugins(N,q,C,d){if(N.plugins)for(const F in N.plugins){var U,a;const w=N.plugins[F];let A=null===(U=q.pluginManager)||void 0===U?void 0:U.getPlugin(w.name);if(!A){const N=W.Tools.Instantiate("BABYLON."+F);N&&(A=new N(q))}null===(a=A)||void 0===a||a.parse(w,C,d)}}}v.TriangleFillMode=0,v.WireFrameFillMode=1,v.PointFillMode=2,v.PointListDrawMode=3,v.LineListDrawMode=4,v.LineLoopDrawMode=5,v.LineStripDrawMode=6,v.TriangleStripDrawMode=7,v.TriangleFanDrawMode=8,v.ClockWiseSideOrientation=0,v.CounterClockWiseSideOrientation=1,v.ImageProcessingDirtyFlag=64,v.TextureDirtyFlag=1,v.LightDirtyFlag=2,v.FresnelDirtyFlag=4,v.AttributesDirtyFlag=8,v.MiscDirtyFlag=16,v.PrePassDirtyFlag=32,v.AllDirtyFlag=127,v.MATERIAL_OPAQUE=0,v.MATERIAL_ALPHATEST=1,v.MATERIAL_ALPHABLEND=2,v.MATERIAL_ALPHATESTANDBLEND=3,v.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,v.MATERIAL_NORMALBLENDMETHOD_RNM=1,v.OnEventObservable=new a.b,v._AllDirtyCallBack=N=>N.markAllAsDirty(),v._ImageProcessingDirtyCallBack=N=>N.markAsImageProcessingDirty(),v._TextureDirtyCallBack=N=>N.markAsTexturesDirty(),v._FresnelDirtyCallBack=N=>N.markAsFresnelDirty(),v._MiscDirtyCallBack=N=>N.markAsMiscDirty(),v._PrePassDirtyCallBack=N=>N.markAsPrePassDirty(),v._LightsDirtyCallBack=N=>N.markAsLightDirty(),v._AttributeDirtyCallBack=N=>N.markAsAttributesDirty(),v._FresnelAndMiscDirtyCallBack=N=>{v._FresnelDirtyCallBack(N),v._MiscDirtyCallBack(N)},v._TextureAndMiscDirtyCallBack=N=>{v._TextureDirtyCallBack(N),v._MiscDirtyCallBack(N)},v._DirtyCallbackArray=[],v._RunDirtyCallBacks=N=>{for(const q of v._DirtyCallbackArray)q(N)},(0,d.d)([(0,U.O)()],v.prototype,"id",void 0),(0,d.d)([(0,U.O)()],v.prototype,"uniqueId",void 0),(0,d.d)([(0,U.O)()],v.prototype,"name",void 0),(0,d.d)([(0,U.O)()],v.prototype,"metadata",void 0),(0,d.d)([(0,U.O)()],v.prototype,"checkReadyOnEveryCall",void 0),(0,d.d)([(0,U.O)()],v.prototype,"checkReadyOnlyOnce",void 0),(0,d.d)([(0,U.O)()],v.prototype,"state",void 0),(0,d.d)([(0,U.O)("alpha")],v.prototype,"_alpha",void 0),(0,d.d)([(0,U.O)("Ld")],v.prototype,"_backFaceCulling",void 0),(0,d.d)([(0,U.O)("cullBackFaces")],v.prototype,"_cullBackFaces",void 0),(0,d.d)([(0,U.O)()],v.prototype,"sideOrientation",void 0),(0,d.d)([(0,U.O)("alphaMode")],v.prototype,"_alphaMode",void 0),(0,d.d)([(0,U.O)()],v.prototype,"_needDepthPrePass",void 0),(0,d.d)([(0,U.O)()],v.prototype,"disableDepthWrite",void 0),(0,d.d)([(0,U.O)()],v.prototype,"disableColorWrite",void 0),(0,d.d)([(0,U.O)()],v.prototype,"forceDepthWrite",void 0),(0,d.d)([(0,U.O)()],v.prototype,"depthFunction",void 0),(0,d.d)([(0,U.O)()],v.prototype,"separateCullingPass",void 0),(0,d.d)([(0,U.O)("fogEnabled")],v.prototype,"_fogEnabled",void 0),(0,d.d)([(0,U.O)()],v.prototype,"pointSize",void 0),(0,d.d)([(0,U.O)()],v.prototype,"zOffset",void 0),(0,d.d)([(0,U.O)()],v.prototype,"zOffsetUnits",void 0),(0,d.d)([(0,U.O)()],v.prototype,"pointsCloud",null),(0,d.d)([(0,U.O)()],v.prototype,"fillMode",null),(0,d.d)([(0,U.O)()],v.prototype,"useLogarithmicDepth",null),(0,d.d)([(0,U.O)()],v.prototype,"transparencyMode",null)},11487:(N,q,C)=>{C.d(q,{A:()=>l,C:()=>T,E:()=>Z,H:()=>V,J:()=>M,L:()=>P,M:()=>s,N:()=>r,P:()=>p,T:()=>Y,X:()=>E,Z:()=>H,bb:()=>b,c:()=>i,fb:()=>J,g:()=>t,j:()=>j,n:()=>n,r:()=>Q,t:()=>v,v:()=>O,w:()=>z,x:()=>K});var d=C(10962),U=C(11167),W=C(10995),a=C(11430),F=C(11494);const w=U.Oq.Black(),A={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function n(N,q,C){if(!N||N.LOGARITHMICDEPTH||N.indexOf&&N.indexOf("LOGARITHMICDEPTH")>=0){const N=C.activeCamera;1===N.mode&&d.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),q.setFloat("logarithmicDepthConstant",2/(Math.log(N.maxZ+1)/Math.LN2))}}function t(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];C&&N.fogEnabled&&(!q||q.applyFog)&&0!==N.fogMode&&(C.setFloat4("vFogInfos",N.fogMode,N.fogStart,N.fogEnd,N.fogDensity),d?(N.fogColor.toLinearSpaceToRef(w,N.getEngine().useExactSrgbConversions),C.setColor3("vFogColor",w)):C.setColor3("vFogColor",N.fogColor))}function V(N,q,C,d,U,W,a,F,w,n){const t=N.numMaxInfluencers||N.numInfluencers;return t<=0?0:(q.push("#define MORPHTARGETS"),N.hasPositions&&q.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),N.hasNormals&&q.push("#define MORPHTARGETTEXTURE_HASNORMALS"),N.hasTangents&&q.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),N.hasUVs&&q.push("#define MORPHTARGETTEXTURE_HASUVS"),N.hasUV2s&&q.push("#define MORPHTARGETTEXTURE_HASUV2S"),N.hasColors&&q.push("#define MORPHTARGETTEXTURE_HASCOLORS"),N.supportsPositions&&U&&q.push("#define MORPHTARGETS_POSITION"),N.supportsNormals&&W&&q.push("#define MORPHTARGETS_NORMAL"),N.supportsTangents&&a&&q.push("#define MORPHTARGETS_TANGENT"),N.supportsUVs&&F&&q.push("#define MORPHTARGETS_UV"),N.supportsUV2s&&w&&q.push("#define MORPHTARGETS_UV2"),N.supportsColors&&n&&q.push("#define MORPHTARGETS_COLOR"),q.push("#define NUM_MORPH_INFLUENCERS "+t),N.isUsingTextureForTargets&&q.push("#define MORPHTARGETS_TEXTURE"),A.NUM_MORPH_INFLUENCERS=t,A.NORMAL=W,A.TANGENT=a,A.UV=F,A.UV2=w,A.COLOR=n,Z(C,d,A,U),t)}function Z(N,q,C){let U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=C.NUM_MORPH_INFLUENCERS;if(a>0&&W.e.LastCreatedEngine){const F=W.e.LastCreatedEngine.getCaps().maxVertexAttribs,w=q.morphTargetManager;if(null!==w&&void 0!==w&&w.isUsingTextureForTargets)return;const A=w&&w.supportsPositions&&U,n=w&&w.supportsNormals&&C.NORMAL,t=w&&w.supportsTangents&&C.TANGENT,V=w&&w.supportsUVs&&C.UV1,Z=w&&w.supportsUV2s&&C.UV2,J=w&&w.supportsColors&&C.VERTEXCOLOR;for(let C=0;C<a;C++)A&&N.push("position"+C),n&&N.push("normal"+C),t&&N.push("tangent"+C),V&&N.push("uv_"+C),Z&&N.push("uv2_"+C),J&&N.push("color"+C),N.length>F&&d.c.Error("Cannot add more vertex attributes for mesh "+q.name)}}function J(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N.push("world0"),N.push("world1"),N.push("world2"),N.push("world3"),q&&(N.push("previousWorld0"),N.push("previousWorld1"),N.push("previousWorld2"),N.push("previousWorld3"))}function Q(N,q){const C=N.morphTargetManager;N&&C&&q.setFloatArray("morphTargetInfluences",C.influences)}function v(N,q){q.bindToEffect(N,"Scene")}function r(N,q,C){q._needUVs=!0,q[C]=!0,N.optimizeUVAllocation&&N.getTextureMatrix().isIdentityAs3x2()?(q[C+"DIRECTUV"]=N.coordinatesIndex+1,q["MAINUV"+(N.coordinatesIndex+1)]=!0):q[C+"DIRECTUV"]=0}function O(N,q,C){const d=N.getTextureMatrix();q.Yd(C+"Matrix",d)}function K(N,q,C){C.BAKED_VERTEX_ANIMATION_TEXTURE&&C.INSTANCES&&N.push("bakedVertexAnimationSettingsInstanced")}function i(N,q,C){var d;if(q&&N&&(N.computeBonesUsingShaders&&q._bonesComputationForcedToCPU&&(N.computeBonesUsingShaders=!1),N.useBones&&N.computeBonesUsingShaders&&N.skeleton)){const U=N.skeleton;if(U.isUsingTextureForMatrices&&q.getUniformIndex("boneTextureWidth")>-1){const C=U.getTransformMatrixTexture(N);q.setTexture("boneSampler",C),q.setFloat("boneTextureWidth",4*(U.bones.length+1))}else{const W=U.getTransformMatrices(N);W&&(q.setMatrices("mBones",W),C&&N.lN().prePassRenderer&&N.lN().prePassRenderer.getIndex(2)&&(C.previousBones[N.uniqueId]||(C.previousBones[N.uniqueId]=W.slice()),q.setMatrices("mPreviousBones",C.previousBones[N.uniqueId]),d=W,C.previousBones[N.uniqueId].set(d)))}}}function I(N,q,C,d,U){let W=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];N._bindLight(q,C,d,U,W)}function j(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const W=Math.min(q.lightSources.length,U);for(let a=0;a<W;a++){I(q.lightSources[a],a,N,C,"boolean"===typeof d?d:d.SPECULARTERM,q.receiveShadows)}}function l(N,q,C,d){C.NUM_BONE_INFLUENCERS>0&&(d.addCPUSkinningFallback(0,q),N.push("matricesIndices"),N.push("matricesWeights"),C.NUM_BONE_INFLUENCERS>4&&(N.push("matricesIndicesExtra"),N.push("matricesWeightsExtra")))}function T(N,q){(q.INSTANCES||q.THIN_INSTANCES)&&J(N,!!q.PREPASS_VELOCITY),q.INSTANCESCOLOR&&N.push("instanceColor")}function z(N,q){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=0;for(let W=0;W<C&&N["LIGHT"+W];W++)W>0&&(U=d+W,q.addFallback(U,"LIGHT"+W)),N.SHADOWS||(N["SHADOW"+W]&&q.addFallback(d,"SHADOW"+W),N["SHADOWPCF"+W]&&q.addFallback(d,"SHADOWPCF"+W),N["SHADOWPCSS"+W]&&q.addFallback(d,"SHADOWPCSS"+W),N["SHADOWPOISSON"+W]&&q.addFallback(d,"SHADOWPOISSON"+W),N["SHADOWESM"+W]&&q.addFallback(d,"SHADOWESM"+W),N["SHADOWCLOSEESM"+W]&&q.addFallback(d,"SHADOWCLOSEESM"+W));return U++}function p(N,q,C,d,U,W,a){let F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];a._areMiscDirty&&(a.LOGARITHMICDEPTH=C,a.POINTSIZE=d,a.FOG=U&&function(N,q){return q.fogEnabled&&N.applyFog&&0!==q.fogMode}(N,q),a.NONUNIFORMSCALING=N.nonUniformScaling,a.ALPHATEST=W,a.DECAL_AFTER_DETAIL=F)}function s(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!C._areLightsDirty)return C._needNormals;let a=0;const F={needNormals:C._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(N.lightsEnabled&&!W)for(const A of q.lightSources)if(X(N,q,A,a,C,d,F),a++,a===U)break;C.SPECULARTERM=F.specularEnabled,C.SHADOWS=F.shadowEnabled;for(let A=a;A<U;A++)void 0!==C["LIGHT"+A]&&(C["LIGHT"+A]=!1,C["HEMILIGHT"+A]=!1,C["POINTLIGHT"+A]=!1,C["DIRLIGHT"+A]=!1,C["SPOTLIGHT"+A]=!1,C["AREALIGHT"+A]=!1,C["SHADOW"+A]=!1,C["SHADOWCSM"+A]=!1,C["SHADOWCSMDEBUG"+A]=!1,C["SHADOWCSMNUM_CASCADES"+A]=!1,C["SHADOWCSMUSESHADOWMAXZ"+A]=!1,C["SHADOWCSMNOBLEND"+A]=!1,C["SHADOWCSM_RIGHTHANDED"+A]=!1,C["SHADOWPCF"+A]=!1,C["SHADOWPCSS"+A]=!1,C["SHADOWPOISSON"+A]=!1,C["SHADOWESM"+A]=!1,C["SHADOWCLOSEESM"+A]=!1,C["SHADOWCUBE"+A]=!1,C["SHADOWLOWQUALITY"+A]=!1,C["SHADOWMEDIUMQUALITY"+A]=!1);const w=N.getEngine().getCaps();return void 0===C.SHADOWFLOAT&&(F.needRebuild=!0),C.SHADOWFLOAT=F.shadowEnabled&&(w.textureFloatRender&&w.textureFloatLinearFiltering||w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering),C.LIGHTMAPEXCLUDED=F.lightmapMode,F.needRebuild&&C.rebuild(),F.needNormals}function X(N,q,C,d,U,W,F){switch(F.needNormals=!0,void 0===U["LIGHT"+d]&&(F.needRebuild=!0),U["LIGHT"+d]=!0,U["SPOTLIGHT"+d]=!1,U["HEMILIGHT"+d]=!1,U["POINTLIGHT"+d]=!1,U["DIRLIGHT"+d]=!1,U["AREALIGHT"+d]=!1,C.prepareLightSpecificDefines(U,d),U["LIGHT_FALLOFF_PHYSICAL"+d]=!1,U["LIGHT_FALLOFF_GLTF"+d]=!1,U["LIGHT_FALLOFF_STANDARD"+d]=!1,C.falloffType){case a.e.FALLOFF_GLTF:U["LIGHT_FALLOFF_GLTF"+d]=!0;break;case a.e.FALLOFF_PHYSICAL:U["LIGHT_FALLOFF_PHYSICAL"+d]=!0;break;case a.e.FALLOFF_STANDARD:U["LIGHT_FALLOFF_STANDARD"+d]=!0}if(W&&!C.dn.equalsFloats(0,0,0)&&(F.specularEnabled=!0),U["SHADOW"+d]=!1,U["SHADOWCSM"+d]=!1,U["SHADOWCSMDEBUG"+d]=!1,U["SHADOWCSMNUM_CASCADES"+d]=!1,U["SHADOWCSMUSESHADOWMAXZ"+d]=!1,U["SHADOWCSMNOBLEND"+d]=!1,U["SHADOWCSM_RIGHTHANDED"+d]=!1,U["SHADOWPCF"+d]=!1,U["SHADOWPCSS"+d]=!1,U["SHADOWPOISSON"+d]=!1,U["SHADOWESM"+d]=!1,U["SHADOWCLOSEESM"+d]=!1,U["SHADOWCUBE"+d]=!1,U["SHADOWLOWQUALITY"+d]=!1,U["SHADOWMEDIUMQUALITY"+d]=!1,q&&q.receiveShadows&&N.shadowsEnabled&&C.shadowEnabled){const q=C.getShadowGenerator(N.activeCamera)??C.getShadowGenerator();if(q){const N=q.getShadowMap();N&&N.renderList&&N.renderList.length>0&&(F.shadowEnabled=!0,q.prepareDefines(U,d))}}C.lightmapMode!=a.e.LIGHTMAP_DEFAULT?(F.lightmapMode=!0,U["LIGHTMAPEXCLUDED"+d]=!0,U["LIGHTMAPNOSPECULAR"+d]=C.lightmapMode==a.e.LIGHTMAP_SHADOWSONLY):(U["LIGHTMAPEXCLUDED"+d]=!1,U["LIGHTMAPNOSPECULAR"+d]=!1)}function P(N,q,C,d,U){let W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=function(N,q){let C=!1;if(N.activeCamera){const d=q.CAMERA_ORTHOGRAPHIC?1:0,U=q.CAMERA_PERSPECTIVE?1:0,W=1===N.activeCamera.mode?1:0,a=0===N.activeCamera.mode?1:0;(d^W||U^a)&&(q.CAMERA_ORTHOGRAPHIC=1===W,q.CAMERA_PERSPECTIVE=1===a,C=!0)}return C}(N,d);!1!==W&&(w=(0,F.h)(C,N,d)),d.DEPTHPREPASS!==!q.getColorWrite()&&(d.DEPTHPREPASS=!d.DEPTHPREPASS,w=!0),d.INSTANCES!==U&&(d.INSTANCES=U,w=!0),d.THIN_INSTANCES!==a&&(d.THIN_INSTANCES=a,w=!0),w&&d.markAsUnprocessed()}function M(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4],W=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!q._areAttributesDirty&&q._needNormals===q._normals&&q._needUVs===q._uvs)return!1;q._normals=q._needNormals,q._uvs=q._needUVs,q.NORMAL=q._needNormals&&N.isVerticesDataPresent("normal"),q._needNormals&&N.isVerticesDataPresent("tangent")&&(q.TANGENT=!0);for(let F=1;F<=6;++F)q["UV"+F]=!!q._needUVs&&N.isVerticesDataPresent(`uv${1===F?"":F}`);if(C){const C=N.useVertexColors&&N.isVerticesDataPresent("color");q.VERTEXCOLOR=C,q.VERTEXALPHA=N.hasVertexAlpha&&C&&W}return N.isVerticesDataPresent("instanceColor")&&(N.hasInstances||N.hasThinInstances)&&(q.INSTANCESCOLOR=!0),d&&function(N,q){if(N.useBones&&N.computeBonesUsingShaders&&N.skeleton){q.NUM_BONE_INFLUENCERS=N.numBoneInfluencers;const C=void 0!==q.BONETEXTURE;if(N.skeleton.isUsingTextureForMatrices&&C)q.BONETEXTURE=!0;else{q.BonesPerMesh=N.skeleton.bones.length+1,q.BONETEXTURE=!C&&void 0;const d=N.lN().prePassRenderer;if(d&&d.enabled){const C=-1===d.excludedSkinnedMesh.indexOf(N);q.BONES_VELOCITY_ENABLED=C}}}else q.NUM_BONE_INFLUENCERS=0,q.BonesPerMesh=0,void 0!==q.BONETEXTURE&&(q.BONETEXTURE=!1)}(N,q),U&&function(N,q){const C=N.morphTargetManager;C?(q.MORPHTARGETS_UV=C.supportsUVs&&q.UV1,q.MORPHTARGETS_UV2=C.supportsUV2s&&q.UV2,q.MORPHTARGETS_TANGENT=C.supportsTangents&&q.TANGENT,q.MORPHTARGETS_NORMAL=C.supportsNormals&&q.NORMAL,q.MORPHTARGETS_POSITION=C.supportsPositions,q.MORPHTARGETS_COLOR=C.supportsColors,q.MORPHTARGETTEXTURE_HASUVS=C.hasUVs,q.MORPHTARGETTEXTURE_HASUV2S=C.hasUV2s,q.MORPHTARGETTEXTURE_HASTANGENTS=C.hasTangents,q.MORPHTARGETTEXTURE_HASNORMALS=C.hasNormals,q.MORPHTARGETTEXTURE_HASPOSITIONS=C.hasPositions,q.MORPHTARGETTEXTURE_HASCOLORS=C.hasColors,q.NUM_MORPH_INFLUENCERS=C.numMaxInfluencers||C.numInfluencers,q.MORPHTARGETS=q.NUM_MORPH_INFLUENCERS>0,q.MORPHTARGETS_TEXTURE=C.isUsingTextureForTargets):(q.MORPHTARGETS_UV=!1,q.MORPHTARGETS_UV2=!1,q.MORPHTARGETS_TANGENT=!1,q.MORPHTARGETS_NORMAL=!1,q.MORPHTARGETS_POSITION=!1,q.MORPHTARGETS_COLOR=!1,q.MORPHTARGETTEXTURE_HASUVS=!1,q.MORPHTARGETTEXTURE_HASUV2S=!1,q.MORPHTARGETTEXTURE_HASTANGENTS=!1,q.MORPHTARGETTEXTURE_HASNORMALS=!1,q.MORPHTARGETTEXTURE_HASPOSITIONS=!1,q.MORPHTARGETTEXTURE_HAS_COLORS=!1,q.MORPHTARGETS=!1,q.NUM_MORPH_INFLUENCERS=0)}(N,q),a&&function(N,q){const C=N.bakedVertexAnimationManager;q.BAKED_VERTEX_ANIMATION_TEXTURE=!(!C||!C.isEnabled)}(N,q),!0}function Y(N,q){if(N.activeCamera){const C=q.MULTIVIEW;q.MULTIVIEW=null!==N.activeCamera.outputRenderTarget&&N.activeCamera.outputRenderTarget.getViewCount()>1,q.MULTIVIEW!=C&&q.markAsUnprocessed()}}function E(N,q,C){const d=q.ORDER_INDEPENDENT_TRANSPARENCY,U=q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;q.ORDER_INDEPENDENT_TRANSPARENCY=N.useOrderIndependentTransparency&&C,q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!N.getEngine().getCaps().textureFloatLinearFiltering,d===q.ORDER_INDEPENDENT_TRANSPARENCY&&U===q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||q.markAsUnprocessed()}function H(N,q,C){const d=q.PREPASS;if(!q._arePrePassDirty)return;const U=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(N.prePassRenderer&&N.prePassRenderer.enabled&&C){q.PREPASS=!0,q.SCENE_MRT_COUNT=N.prePassRenderer.mrtCount,q.PREPASS_NORMAL_WORLDSPACE=N.prePassRenderer.generateNormalsInWorldSpace,q.PREPASS_COLOR=!0,q.PREPASS_COLOR_INDEX=0;for(let C=0;C<U.length;C++){const d=N.prePassRenderer.getIndex(U[C].type);-1!==d?(q[U[C].define]=!0,q[U[C].index]=d):q[U[C].define]=!1}}else{q.PREPASS=!1;for(let N=0;N<U.length;N++)q[U[N].define]=!1}q.PREPASS!=d&&(q.markAsUnprocessed(),q.markAsImageProcessingDirty())}function e(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];U&&U.push("Light"+N),W||(q.push("vLightData"+N,"vLightDiffuse"+N,"vLightSpecular"+N,"vLightDirection"+N,"vLightWidth"+N,"vLightHeight"+N,"vLightFalloff"+N,"vLightGround"+N,"lightMatrix"+N,"shadowsInfo"+N,"depthValues"+N),C.push("shadowTexture"+N),C.push("depthTexture"+N),q.push("viewFrustumZ"+N,"cascadeBlendFactor"+N,"lightSizeUVCorrection"+N,"depthCorrection"+N,"penumbraDarkness"+N,"frustumLengths"+N),d&&(C.push("projectionLightTexture"+N),q.push("textureProjectionMatrix"+N)),a&&C.push("iesLightTexture"+N))}function b(N,q,C){let d,U,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(N.uniformsNames){const a=N;d=a.uniformsNames,U=a.uniformBuffersNames,q=a.samplers,C=a.defines,W=a.maxSimultaneousLights||0}else d=N,q||(q=[]);for(let a=0;a<W&&C["LIGHT"+a];a++)e(a,d,q,C["PROJECTEDLIGHTTEXTURE"+a],U,!1,C["IESLIGHTTEXTURE"+a]);C.NUM_MORPH_INFLUENCERS&&(d.push("morphTargetInfluences"),d.push("morphTargetCount")),C.BAKED_VERTEX_ANIMATION_TEXTURE&&(d.push("bakedVertexAnimationSettings"),d.push("bakedVertexAnimationTextureSizeInverted"),d.push("bakedVertexAnimationTime"),q.push("bakedVertexAnimationTexture"))}},11441:(N,q,C)=>{C.d(q,{d:()=>W});var d=C(11122),U=C(11447);class W extends U.d{constructor(N,q){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(N,q,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new d.Matrix,this._storeEffectOnSubMeshes=C}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(N,q){return!!N&&(!this._storeEffectOnSubMeshes||(!N.jd||0===N.jd.length||this.isReadyForSubMesh(N,N.jd[0],q)))}_isReadyForSubMesh(N){const q=N.materialDefines;return!(this.checkReadyOnEveryCall||!N.effect||!q||q._renderId!==this.lN().getRenderId())}bindOnlyWorldMatrix(N){this._activeEffect.setMatrix("world",N)}bindOnlyNormalMatrix(N){this._activeEffect.setMatrix("normalMatrix",N)}bind(N,q){q&&this.bindForSubMesh(N,q,q.jd[0])}_afterBind(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;super._afterBind(N,q,C),this.lN()._cachedEffect=q,C?C._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return C._drawWrapper._forceRebindOnNextCall||N.isCachedMaterialInvalid(this,q,d)}dispose(N,q,C){this._activeEffect=void 0,super.dispose(N,q,C)}}},11478:(N,q,C)=>{C.d(q,{c:()=>F,g:()=>w});var d=C(11110),U=C(11122),W=C(11114);class a{static extractMinAndMaxIndexed(N,q,C,d,U,W){for(let a=C;a<C+d;a++){const C=3*q[a],d=N[C],F=N[C+1],w=N[C+2];U.minimizeInPlaceFromFloats(d,F,w),W.maximizeInPlaceFromFloats(d,F,w)}}static extractMinAndMax(N,q,C,d,U,W){for(let a=q,F=q*d;a<q+C;a++,F+=d){const q=N[F],C=N[F+1],d=N[F+2];U.minimizeInPlaceFromFloats(q,C,d),W.maximizeInPlaceFromFloats(q,C,d)}}}function F(N,q,C,d){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=new U.Jq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new U.Jq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a.extractMinAndMaxIndexed(N,q,C,d,F,w),W&&(F.x-=F.x*W.x+W.y,F.y-=F.y*W.x+W.y,F.z-=F.z*W.x+W.y,w.x+=w.x*W.x+W.y,w.y+=w.y*W.x+W.y,w.z+=w.z*W.x+W.y),{minimum:F,maximum:w}}function w(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4?arguments[4]:void 0;const F=new U.Jq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new U.Jq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return W||(W=3),a.extractMinAndMax(N,q,C,W,F,w),d&&(F.x-=F.x*d.x+d.y,F.y-=F.y*d.x+d.y,F.z-=F.z*d.x+d.y,w.x+=w.x*d.x+d.y,w.y+=w.y*d.x+d.y,w.z+=w.z*d.x+d.y),{minimum:F,maximum:w}}(0,d.d)([W.h.filter((function(){for(var N=arguments.length,q=new Array(N),C=0;C<N;C++)q[C]=arguments[C];let[d,U]=q;return!Array.isArray(d)&&!Array.isArray(U)}))],a,"extractMinAndMaxIndexed",null),(0,d.d)([W.h.filter((function(){for(var N=arguments.length,q=new Array(N),C=0;C<N;C++)q[C]=arguments[C];let[d]=q;return!Array.isArray(d)}))],a,"extractMinAndMax",null)},11455:(N,q,C)=>{C.d(q,{b:()=>w});var d=C(11199),U=C(11460),W=C(11465),a=C(11478),F=C(11247);class w{get materialDefines(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(N=this._getDrawWrapper())||void 0===N?void 0:N.defines}set materialDefines(N){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=N}_getDrawWrapper(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N??this._engine.currentRenderPassId;let C=this._drawWrappers[N];return!C&&q&&(this._drawWrappers[N]=C=new F.e(this._mesh.lN().getEngine())),C}_removeDrawWrapper(N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var C;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(C=this._drawWrappers[N])||void 0===C||C.dispose(q));this._drawWrappers[N]=void 0}get effect(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(N=this._getDrawWrapper())||void 0===N?void 0:N.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(N){this._mainDrawWrapperOverride=N}setEffect(N){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=this._drawWrapper;U.setEffect(N,q,d),void 0!==C&&(U.materialContext=C),N||(U.defines=null,U.materialContext=void 0)}resetDrawCache(N){let q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==N)return void this._removeDrawWrapper(N,!0,q);for(const N of this._drawWrappers)null===N||void 0===N||N.dispose(q)}this._drawWrappers=[]}static AddToMesh(N,q,C,d,U,W,a){return new w(N,q,C,d,U,W,a,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(N,q,C,d,U,W,a){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],w=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=N,this.verticesStart=q,this.verticesCount=C,this.indexStart=d,this.indexCount=U,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=W,this._renderingMesh=a||W,w&&W.jd.push(this),this._engine=this._mesh.lN().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=W.jd.length-1,F&&(this.refreshBoundingInfo(),W.Ed(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(N){return this._boundingInfo=N,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const N=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return N||this._renderingMesh}bN(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const q=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!q)return N&&this._mesh.lN()._hasDefaultMaterial?this._mesh.lN().defaultMaterial:null;if(this._isMultiMaterial(q)){const N=q.getSubMaterial(this.materialIndex);return this._currentMaterial!==N&&(this._currentMaterial=N,this.resetDrawCache()),N}return q}_isMultiMaterial(N){return void 0!==N.getSubMaterial}refreshBoundingInfo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.ed)return this;if(N||(N=this._renderingMesh.getVerticesData(d.g.PositionKind)),!N)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const q=this._renderingMesh.od();let C;if(0===this.indexStart&&this.indexCount===q.length){const N=this._renderingMesh.getBoundingInfo();C={minimum:N.minimum.clone(),maximum:N.maximum.clone()}}else C=(0,a.c)(N,q,this.indexStart,this.indexCount,this._renderingMesh.ed.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(C.minimum,C.maximum):this._boundingInfo=new W.c(C.minimum,C.maximum),this}_checkCollision(N){return this.getBoundingInfo()._checkCollision(N)}updateBoundingInfo(N){let q=this.getBoundingInfo();return q||(this.refreshBoundingInfo(),q=this.getBoundingInfo()),q&&q.update(N),this}isInFrustum(N){const q=this.getBoundingInfo();return!!q&&q.isInFrustum(N,this._mesh.Ft)}isCompletelyInFrustum(N){const q=this.getBoundingInfo();return!!q&&q.isCompletelyInFrustum(N)}render(N){return this._renderingMesh.render(this,N,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(N,q){if(!this._linesIndexBuffer){const C=6*Math.floor(this.indexCount/3),d=this.verticesStart+this.verticesCount>65535?new Uint32Array(C):new Uint16Array(C);let U=0;if(0===N.length)for(let N=this.indexStart;N<this.indexStart+this.indexCount;N+=3)d[U++]=N,d[U++]=N+1,d[U++]=N+1,d[U++]=N+2,d[U++]=N+2,d[U++]=N;else for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)d[U++]=N[q],d[U++]=N[q+1],d[U++]=N[q+1],d[U++]=N[q+2],d[U++]=N[q+2],d[U++]=N[q];this._linesIndexBuffer=q.createIndexBuffer(d),this._linesIndexCount=d.length}return this._linesIndexBuffer}canIntersects(N){const q=this.getBoundingInfo();return!!q&&N.intersectsBox(q.boundingBox)}intersects(N,q,C,d,U){const W=this.bN();if(!W)return null;let a=3,F=!1;switch(W.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,F=!0}return 4===W.fillMode?C.length?this._intersectLines(N,q,C,this._mesh.intersectionThreshold,d):this._intersectUnIndexedLines(N,q,C,this._mesh.intersectionThreshold,d):!C.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(N,q,C,d,U):this._intersectTriangles(N,q,C,a,F,d,U)}_intersectLines(N,q,C,d,W){let a=null;for(let F=this.indexStart;F<this.indexStart+this.indexCount;F+=2){const w=q[C[F]],A=q[C[F+1]],n=N.intersectionSegment(w,A,d);if(!(n<0)&&((W||!a||n<a.distance)&&(a=new U.b(null,null,n),a.faceId=F/2,W)))break}return a}_intersectUnIndexedLines(N,q,C,d,W){let a=null;for(let F=this.verticesStart;F<this.verticesStart+this.verticesCount;F+=2){const C=q[F],w=q[F+1],A=N.intersectionSegment(C,w,d);if(!(A<0)&&((W||!a||A<a.distance)&&(a=new U.b(null,null,A),a.faceId=F/2,W)))break}return a}_intersectTriangles(N,q,C,d,U,W,a){let F=null,w=-1;for(let A=this.indexStart;A<this.indexStart+this.indexCount-(3-d);A+=d){w++;const d=C[A],n=C[A+1],t=C[A+2];if(U&&4294967295===t){A+=2;continue}const V=q[d],Z=q[n],J=q[t];if(!V||!Z||!J)continue;if(a&&!a(V,Z,J,N,d,n,t))continue;const Q=N.intersectsTriangle(V,Z,J);if(Q){if(Q.distance<0)continue;if((W||!F||Q.distance<F.distance)&&(F=Q,F.faceId=w,W))break}}return F}_intersectUnIndexedTriangles(N,q,C,d,U){let W=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){const C=q[a],F=q[a+1],w=q[a+2];if(U&&!U(C,F,w,N,-1,-1,-1))continue;const A=N.intersectsTriangle(C,F,w);if(A){if(A.distance<0)continue;if((d||!W||A.distance<W.distance)&&(W=A,W.faceId=a/3,d))break}}return W}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(N,q){const C=new w(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,N,q,!1);if(!this.IsGlobal){const N=this.getBoundingInfo();if(!N)return C;C._boundingInfo=new W.c(N.minimum,N.maximum)}return C}dispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.lN().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const q=this._mesh.jd.indexOf(this);this._mesh.jd.splice(q,1),this.resetDrawCache(void 0,N)}getClassName(){return"SubMesh"}static CreateFromIndices(N,q,C,d,U){let W=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=Number.MAX_VALUE,F=-Number.MAX_VALUE;const A=(U||d).od();for(let w=q;w<q+C;w++){const N=A[w];N<a&&(a=N),N>F&&(F=N)}return new w(N,a,F-a+1,q,C,d,U,W)}}}}]);