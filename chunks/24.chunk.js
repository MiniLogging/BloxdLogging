"use strict";(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[24],{12685:(N,U,V)=>{V.d(U,{e:()=>A});class A{constructor(N,U,V){this.bu=N,this.bv=U,this.distance=V,this.faceId=0,this.subMeshId=0}}},12700:(N,U,V)=>{V.d(U,{d:()=>q});var A=V(12392),t=V(12383),n=V(12389);class q{constructor(N,U,V){this.vectors=(0,A.b)(8,t.CU.Zero),this.center=t.CU.Zero(),this.centerWorld=t.CU.Zero(),this.extendSize=t.CU.Zero(),this.extendSizeWorld=t.CU.Zero(),this.directions=(0,A.b)(3,t.CU.Zero),this.vectorsWorld=(0,A.b)(8,t.CU.Zero),this.minimumWorld=t.CU.Zero(),this.maximumWorld=t.CU.Zero(),this.minimum=t.CU.Zero(),this.maximum=t.CU.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(N,U,V)}reConstruct(N,U,V){const A=N.x,n=N.y,q=N.z,i=U.x,z=U.y,S=U.z,E=this.vectors;this.minimum.hi(A,n,q),this.maximum.hi(i,z,S),E[0].hi(A,n,q),E[1].hi(i,z,S),E[2].hi(i,n,q),E[3].hi(A,z,q),E[4].hi(A,n,S),E[5].hi(i,z,q),E[6].hi(A,z,S),E[7].hi(i,n,S),U.addToRef(N,this.center).scaleInPlace(.5),U.subtractToRef(N,this.extendSize).scaleInPlace(.5),this._worldMatrix=V||t.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(N){const U=q._TmpVector3,V=this.maximum.subtractToRef(this.minimum,U[0]),A=V.length();V.normalizeFromLength(A);const t=A*N,n=V.scaleInPlace(.5*t),i=this.center.subtractToRef(n,U[1]),z=this.center.addToRef(n,U[2]);return this.reConstruct(i,z,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){const U=this.minimumWorld,V=this.maximumWorld,A=this.directions,n=this.vectorsWorld,q=this.vectors;if(N.isIdentity()){U.A(this.minimum),V.A(this.maximum);for(let N=0;N<8;++N)n[N].A(q[N]);this.extendSizeWorld.A(this.extendSize),this.centerWorld.A(this.center)}else{U.Hi(Number.MAX_VALUE),V.Hi(-Number.MAX_VALUE);for(let A=0;A<8;++A){const i=n[A];t.CU.TransformCoordinatesToRef(q[A],N,i),U.minimizeInPlace(i),V.maximizeInPlace(i)}V.subtractToRef(U,this.extendSizeWorld).scaleInPlace(.5),V.addToRef(U,this.centerWorld).scaleInPlace(.5)}t.CU.FromArrayToRef(N.m,0,A[0]),t.CU.FromArrayToRef(N.m,4,A[1]),t.CU.FromArrayToRef(N.m,8,A[2]),this._worldMatrix=N}isInFrustum(N){return q.IsInFrustum(this.vectorsWorld,N)}isCompletelyInFrustum(N){return q.IsCompletelyInFrustum(this.vectorsWorld,N)}intersectsPoint(N){const U=this.minimumWorld,V=this.maximumWorld,A=U.x,t=U.y,q=U.z,i=V.x,z=V.y,S=V.z,E=N.x,p=N.y,k=N.z,B=-n.d;return!(i-E<B||B>E-A)&&(!(z-p<B||B>p-t)&&!(S-k<B||B>k-q))}intersectsSphere(N){return q.IntersectsSphere(this.minimumWorld,this.maximumWorld,N.centerWorld,N.radiusWorld)}intersectsMinMax(N,U){const V=this.minimumWorld,A=this.maximumWorld,t=V.x,n=V.y,q=V.z,i=A.x,z=A.y,S=A.z,E=N.x,p=N.y,k=N.z,B=U.x,C=U.y,x=U.z;return!(i<E||t>B)&&(!(z<p||n>C)&&!(S<k||q>x))}dispose(){var N,U;null===(N=this._drawWrapperFront)||void 0===N||N.dispose(),null===(U=this._drawWrapperBack)||void 0===U||U.dispose()}static Intersects(N,U){return N.intersectsMinMax(U.minimumWorld,U.maximumWorld)}static IntersectsSphere(N,U,V,A){const n=q._TmpVector3[0];t.CU.ClampToRef(V,N,U,n);return t.CU.DistanceSquared(V,n)<=A*A}static IsCompletelyInFrustum(N,U){for(let V=0;V<6;++V){const A=U[V];for(let U=0;U<8;++U)if(A.dotCoordinate(N[U])<0)return!1}return!0}static IsInFrustum(N,U){for(let V=0;V<6;++V){let A=!0;const t=U[V];for(let U=0;U<8;++U)if(t.dotCoordinate(N[U])>=0){A=!1;break}if(A)return!1}return!0}}q._TmpVector3=(0,A.b)(3,t.CU.Zero)},12692:(N,U,V)=>{V.d(U,{d:()=>p});var A=V(12392),t=V(12383),n=V(12700),q=V(12703);const i={min:0,max:0},z={min:0,max:0},S=(N,U,V)=>{const A=t.CU.Dot(U.centerWorld,N),n=Math.abs(t.CU.Dot(U.directions[0],N))*U.extendSize.x+Math.abs(t.CU.Dot(U.directions[1],N))*U.extendSize.y+Math.abs(t.CU.Dot(U.directions[2],N))*U.extendSize.z;V.min=A-n,V.max=A+n},E=(N,U,V)=>(S(N,U,i),S(N,V,z),!(i.min>z.max||z.min>i.max));class p{constructor(N,U,V){this._isLocked=!1,this.boundingBox=new n.d(N,U,V),this.boundingSphere=new q.b(N,U,V)}reConstruct(N,U,V){this.boundingBox.reConstruct(N,U,V),this.boundingSphere.reConstruct(N,U,V)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(N){this._isLocked=N}update(N){this._isLocked||(this.boundingBox._update(N),this.boundingSphere._update(N))}centerOn(N,U){const V=p._TmpVector3[0].A(N).Vp(U),A=p._TmpVector3[1].A(N).addInPlace(U);return this.boundingBox.reConstruct(V,A,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(V,A,this.boundingBox.getWorldMatrix()),this}encapsulate(N){const U=t.CU.Minimize(this.minimum,N),V=t.CU.Maximize(this.maximum,N);return this.reConstruct(U,V,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(N){const U=t.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(U);const V=t.TmpVectors.CU[0];return t.CU.TransformCoordinatesToRef(N.boundingBox.minimumWorld,U,V),this.encapsulate(V),t.CU.TransformCoordinatesToRef(N.boundingBox.maximumWorld,U,V),this.encapsulate(V),this}scale(N){return this.boundingBox.scale(N),this.boundingSphere.scale(N),this}isInFrustum(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===U||3===U)&&this.boundingSphere.isCenterInFrustum(N))return!0;if(!this.boundingSphere.isInFrustum(N))return!1;return!(1!==U&&3!==U)||this.boundingBox.isInFrustum(N)}get diagonalLength(){const N=this.boundingBox;return N.maximumWorld.subtractToRef(N.minimumWorld,p._TmpVector3[0]).length()}isCompletelyInFrustum(N){return this.boundingBox.isCompletelyInFrustum(N)}_checkCollision(N){return N._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(N){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(N)&&!!this.boundingBox.intersectsPoint(N))}intersects(N,U){if(!q.b.Intersects(this.boundingSphere,N.boundingSphere))return!1;if(!n.d.Intersects(this.boundingBox,N.boundingBox))return!1;if(!U)return!0;const V=this.boundingBox,A=N.boundingBox;return!!E(V.directions[0],V,A)&&(!!E(V.directions[1],V,A)&&(!!E(V.directions[2],V,A)&&(!!E(A.directions[0],V,A)&&(!!E(A.directions[1],V,A)&&(!!E(A.directions[2],V,A)&&(!!E(t.CU.Cross(V.directions[0],A.directions[0]),V,A)&&(!!E(t.CU.Cross(V.directions[0],A.directions[1]),V,A)&&(!!E(t.CU.Cross(V.directions[0],A.directions[2]),V,A)&&(!!E(t.CU.Cross(V.directions[1],A.directions[0]),V,A)&&(!!E(t.CU.Cross(V.directions[1],A.directions[1]),V,A)&&(!!E(t.CU.Cross(V.directions[1],A.directions[2]),V,A)&&(!!E(t.CU.Cross(V.directions[2],A.directions[0]),V,A)&&(!!E(t.CU.Cross(V.directions[2],A.directions[1]),V,A)&&!!E(t.CU.Cross(V.directions[2],A.directions[2]),V,A))))))))))))))}}p._TmpVector3=(0,A.b)(2,t.CU.Zero)},12703:(N,U,V)=>{V.d(U,{b:()=>n});var A=V(12392),t=V(12383);class n{constructor(N,U,V){this.center=t.CU.Zero(),this.centerWorld=t.CU.Zero(),this.minimum=t.CU.Zero(),this.maximum=t.CU.Zero(),this.reConstruct(N,U,V)}reConstruct(N,U,V){this.minimum.A(N),this.maximum.A(U);const A=t.CU.Distance(N,U);U.addToRef(N,this.center).scaleInPlace(.5),this.radius=.5*A,this._update(V||t.Matrix.IdentityReadOnly)}scale(N){const U=this.radius*N,V=n._TmpVector3,A=V[0].Hi(U),t=this.center.subtractToRef(A,V[1]),q=this.center.addToRef(A,V[2]);return this.reConstruct(t,q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(N){if(N.isIdentity())this.centerWorld.A(this.center),this.radiusWorld=this.radius;else{t.CU.TransformCoordinatesToRef(this.center,N,this.centerWorld);const U=n._TmpVector3[0];t.CU.TransformNormalFromFloatsToRef(1,1,1,N,U),this.radiusWorld=Math.max(Math.abs(U.x),Math.abs(U.y),Math.abs(U.z))*this.radius}}isInFrustum(N){const U=this.centerWorld,V=this.radiusWorld;for(let A=0;A<6;A++)if(N[A].dotCoordinate(U)<=-V)return!1;return!0}isCenterInFrustum(N){const U=this.centerWorld;for(let V=0;V<6;V++)if(N[V].dotCoordinate(U)<0)return!1;return!0}intersectsPoint(N){const U=t.CU.DistanceSquared(this.centerWorld,N);return!(this.radiusWorld*this.radiusWorld<U)}static Intersects(N,U){const V=t.CU.DistanceSquared(N.centerWorld,U.centerWorld),A=N.radiusWorld+U.radiusWorld;return!(A*A<V)}static CreateFromCenterAndRadius(N,U,V){this._TmpVector3[0].A(N),this._TmpVector3[1].hi(0,0,U),this._TmpVector3[2].A(N),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Vp(this._TmpVector3[1]);const A=new n(this._TmpVector3[0],this._TmpVector3[2]);return A._worldMatrix=V||t.Matrix.Identity(),A}}n._TmpVector3=(0,A.b)(3,t.CU.Zero)},12717:(N,U,V)=>{function A(N){-1===N.indexOf("vClipPlane")&&N.push("vClipPlane"),-1===N.indexOf("vClipPlane2")&&N.push("vClipPlane2"),-1===N.indexOf("vClipPlane3")&&N.push("vClipPlane3"),-1===N.indexOf("vClipPlane4")&&N.push("vClipPlane4"),-1===N.indexOf("vClipPlane5")&&N.push("vClipPlane5"),-1===N.indexOf("vClipPlane6")&&N.push("vClipPlane6")}function t(N,U,V){const A=!!(N.clipPlane??U.clipPlane),t=!!(N.clipPlane2??U.clipPlane2),n=!!(N.clipPlane3??U.clipPlane3),q=!!(N.clipPlane4??U.clipPlane4),i=!!(N.clipPlane5??U.clipPlane5),z=!!(N.clipPlane6??U.clipPlane6);A&&V.push("#define CLIPPLANE"),t&&V.push("#define CLIPPLANE2"),n&&V.push("#define CLIPPLANE3"),q&&V.push("#define CLIPPLANE4"),i&&V.push("#define CLIPPLANE5"),z&&V.push("#define CLIPPLANE6")}function n(N,U,V){let A=!1;const t=!!(N.clipPlane??U.clipPlane),n=!!(N.clipPlane2??U.clipPlane2),q=!!(N.clipPlane3??U.clipPlane3),i=!!(N.clipPlane4??U.clipPlane4),z=!!(N.clipPlane5??U.clipPlane5),S=!!(N.clipPlane6??U.clipPlane6);return V.CLIPPLANE!==t&&(V.CLIPPLANE=t,A=!0),V.CLIPPLANE2!==n&&(V.CLIPPLANE2=n,A=!0),V.CLIPPLANE3!==q&&(V.CLIPPLANE3=q,A=!0),V.CLIPPLANE4!==i&&(V.CLIPPLANE4=i,A=!0),V.CLIPPLANE5!==z&&(V.CLIPPLANE5=z,A=!0),V.CLIPPLANE6!==S&&(V.CLIPPLANE6=S,A=!0),A}function q(N,U,V){let A=U.clipPlane??V.clipPlane;i(N,"vClipPlane",A),A=U.clipPlane2??V.clipPlane2,i(N,"vClipPlane2",A),A=U.clipPlane3??V.clipPlane3,i(N,"vClipPlane3",A),A=U.clipPlane4??V.clipPlane4,i(N,"vClipPlane4",A),A=U.clipPlane5??V.clipPlane5,i(N,"vClipPlane5",A),A=U.clipPlane6??V.clipPlane6,i(N,"vClipPlane6",A)}function i(N,U,V){V&&N.setFloat4(U,V.normal.x,V.normal.y,V.normal.z,V.d)}V.d(U,{b:()=>A,d:()=>q,g:()=>n,k:()=>t})},12662:(N,U,V)=>{V.d(U,{e:()=>A});class A{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(N,U){this._defines[N]||(N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N),this._defines[N]=new Array),this._defines[N].push(U)}addCPUSkinningFallback(N,U){this._mesh=U,N<this._currentRank&&(this._currentRank=N),N>this._maxRank&&(this._maxRank=N)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(N,U){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,N=N.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),U._bonesComputationForcedToCPU=!0;const V=this._mesh.YN();for(let N=0;N<V.meshes.length;N++){const A=V.meshes[N];if(A.material){if(A.computeBonesUsingShaders&&0!==A.numBoneInfluencers)if(A.material.getEffect()===U)A.computeBonesUsingShaders=!1;else if(A.Ei)for(const N of A.Ei){if(N.effect===U){A.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&A.computeBonesUsingShaders&&A.numBoneInfluencers>0&&(A.computeBonesUsingShaders=!1)}}else{const U=this._defines[this._currentRank];if(U)for(let V=0;V<U.length;V++)N=N.replace("#define "+U[V],"");this._currentRank++}return N}}},12672:(N,U,V)=>{V.d(U,{d:()=>J});var A=V(12367),t=V(12369),n=V(12179),q=V(12182),i=V(12223),z=V(12679),S=V(12615),E=V(12193),p=V(12429),k=V(12500),B=V(12413);class C{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(N){this._func=N}get funcRef(){return this._funcRef}set funcRef(N){this._funcRef=N}get funcMask(){return this._funcMask}set funcMask(N){this._funcMask=N}get opStencilFail(){return this._opStencilFail}set opStencilFail(N){this._opStencilFail=N}get opDepthFail(){return this._opDepthFail}set opDepthFail(N){this._opDepthFail=N}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(N){this._opStencilDepthPass=N}get mask(){return this._mask}set mask(N){this._mask=N}get enabled(){return this._enabled}set enabled(N){this._enabled=N}getClassName(){return"MaterialStencilState"}copyTo(N){B.d.Clone((()=>N),this)}serialize(){return B.d.Serialize(this)}parse(N,U,V){B.d.Parse((()=>this),N,U,V)}}(0,A.b)([(0,t.N)()],C.prototype,"func",null),(0,A.b)([(0,t.N)()],C.prototype,"funcRef",null),(0,A.b)([(0,t.N)()],C.prototype,"funcMask",null),(0,A.b)([(0,t.N)()],C.prototype,"opStencilFail",null),(0,A.b)([(0,t.N)()],C.prototype,"opDepthFail",null),(0,A.b)([(0,t.N)()],C.prototype,"opStencilDepthPass",null),(0,A.b)([(0,t.N)()],C.prototype,"mask",null),(0,A.b)([(0,t.N)()],C.prototype,"enabled",null);var x=V(12713);class J{get _supportGlowLayer(){return!1}set _glowModeEnabled(N){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(N){if(this._alpha===N)return;const U=this._alpha;this._alpha=N,1!==U&&1!==N||this.FS(J.MiscDirtyFlag+J.PrePassDirtyFlag)}get alpha(){return this._alpha}set ri(N){this._backFaceCulling!==N&&(this._backFaceCulling=N,this.FS(J.TextureDirtyFlag))}get ri(){return this._backFaceCulling}set cullBackFaces(N){this._cullBackFaces!==N&&(this._cullBackFaces=N,this.FS(J.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(N){this._blockDirtyMechanism!==N&&(this._blockDirtyMechanism=N,N||this.Kp())}atomicMaterialsUpdate(N){this.blockDirtyMechanism=!0;try{N(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(N){this._onDisposeObserver&&this.Ai.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ai.add(N)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q.d),this._onBindObservable}set onBind(N){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(N)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new q.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new q.d),this._onEffectCreatedObservable}set alphaMode(N){this._alphaMode!==N&&(this._alphaMode=N,this.FS(J.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(N){this._needDepthPrePass!==N&&(this._needDepthPrePass=N,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(N){this._fogEnabled!==N&&(this._fogEnabled=N,this.FS(J.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case J.WireFrameFillMode:case J.LineListDrawMode:case J.LineLoopDrawMode:case J.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(N){this.fillMode=N?J.WireFrameFillMode:J.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case J.PointFillMode:case J.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(N){this.fillMode=N?J.PointFillMode:J.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(N){this._fillMode!==N&&(this._fillMode=N,this.FS(J.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){const U=this.YN().getEngine().getCaps().fragmentDepthSupported;N&&!U&&E.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=N&&U,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(N){this._drawWrapper=N}constructor(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Ai=new q.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.ti=new C,this._useUBO=!1,this._fillMode=J.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=N;const t=U||i.e.LastCreatedScene;t&&(this._scene=t,this._dirtyCallbacks={},this._forceGLSL=A,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=N||n.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new k.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new S.c(this._scene.getEngine(),void 0,void 0,N),this._useUBO=this.YN().getEngine().supportsUniformBuffers,this._createUniformBuffer(),V||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),J.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var N;const U=this.YN().getEngine();null===(N=this._uniformBuffer)||void 0===N||N.dispose(),U.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new S.c(U,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new S.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(N){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Kp(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Kp(),this.checkReadyOnlyOnce=!1}isReady(N,U){return!0}isReadyForSubMesh(N,U,V){const A=U.materialDefines;return!!A&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}YN(){return this._scene}_getEffectiveOrientation(N){return null!==this.sideOrientation?this.sideOrientation:N.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(N){this._transparencyMode!==N&&(this._transparencyMode=N,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===J.MATERIAL_ALPHABLEND||this._transparencyMode===J.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===J.MATERIAL_ALPHATEST||this._transparencyMode===J.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===J.MATERIAL_OPAQUE||this._transparencyMode===J.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(N){return this._hasTransparencyMode?this._transparencyModeIsBlend:N.visibility<1||!this._disableAlphaBlending&&(N.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(N){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(N)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Kp(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this.YN().meshes;for(const V of U)if(V.Ei)for(const U of V.Ei)if(U.IN()===this)for(const V of U._drawWrappers)V&&this._materialContext===V.materialContext&&(V._wasPreviouslyReady=!1,V._wasPreviouslyUsingInstances=null,V._forceRebindOnNextCall=N);N&&this.FS(J.AllDirtyFlag)}_preBind(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this._scene.getEngine(),A=(null==U?this.sideOrientation:U)===J.ClockWiseSideOrientation;return V.enableEffect(N||this._getDrawWrapper()),V.setState(this.ri,this.zOffset,!1,A,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.ti,this.zOffsetUnits),A}bind(N,U){}buildUniformLayout(){const N=this._uniformBuffer;this._eventInfo.ubo=N,this._callbackPluginEventGeneric(8,this._eventInfo),N.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(N,U,V){const A=V._drawWrapper;this._eventInfo.subMesh=V,this._callbackPluginEventBindForSubMesh(this._eventInfo),A._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(N){}bindView(N){this._useUBO?this._needToBindSceneUbo=!0:N.setMatrix("view",this.YN().getViewMatrix())}bindViewProjection(N){this._useUBO?this._needToBindSceneUbo=!0:(N.setMatrix("viewProjection",this.YN().getTransformMatrix()),N.setMatrix("projection",this.YN().getProjectionMatrix()))}bindEyePosition(N,U){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(N,U)}_afterBind(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&U&&(this._needToBindSceneUbo=!1,(0,x.p)(U,this.YN().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=N?N.visibility:1,this._onBindObservable&&N&&this._onBindObservable.notifyObservers(N),this.disableDepthWrite){const N=this._scene.getEngine();this._cachedDepthWriteState=N.getDepthWrite(),N.setDepthWrite(!1)}if(this.disableColorWrite){const N=this._scene.getEngine();this._cachedColorWriteState=N.getColorWrite(),N.setColorWrite(!1)}if(0!==this.depthFunction){const N=this._scene.getEngine();this._cachedDepthFunctionState=N.getDepthFunction()||0,N.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(N){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=N,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(N){return null}_clonePlugins(N,U){const V={};if(this._serializePlugins(V),J._ParsePlugins(V,N,this._scene,U),this.pluginManager)for(const A of this.pluginManager._plugins){const U=N.pluginManager.getPlugin(A.name);U&&A.copyTo(U)}}getBindedMeshes(){if(this.meshMap){const N=[];for(const U in this.meshMap){const V=this.meshMap[U];V&&N.push(V)}return N}return this._scene.meshes.filter((N=>N.material===this))}forceCompilation(N,U,V,A){const t={clipPlane:!1,useInstances:!1,...V},n=this.YN(),q=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const i=()=>{if(!this._scene||!this._scene.getEngine())return;const V=n.clipPlane;if(t.clipPlane&&(n.clipPlane=new p.d(0,0,0,1)),this._storeEffectOnSubMeshes){let V=!0,n=null;if(N.Ei){const U=new z.e(0,0,0,0,0,N,void 0,!1,!1);U.materialDefines&&(U.materialDefines._renderId=-1),this.isReadyForSubMesh(N,U,t.useInstances)||(U.effect&&U.effect.getCompilationError()&&U.effect.allFallbacksProcessed()?n=U.effect.getCompilationError():(V=!1,setTimeout(i,16)))}V&&(this.allowShaderHotSwapping=q,n&&A&&A(n),U&&U(this))}else this.isReady()?(this.allowShaderHotSwapping=q,U&&U(this)):setTimeout(i,16);t.clipPlane&&(n.clipPlane=V)};i()}async forceCompilationAsync(N,U){return await new Promise(((V,A)=>{this.forceCompilation(N,(()=>{V()}),U,(N=>{A(N)}))}))}FS(N){this.YN().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(J._DirtyCallbackArray.length=0,N&J.ImageProcessingDirtyFlag&&J._DirtyCallbackArray.push(J._ImageProcessingDirtyCallBack),N&J.TextureDirtyFlag&&J._DirtyCallbackArray.push(J._TextureDirtyCallBack),N&J.LightDirtyFlag&&J._DirtyCallbackArray.push(J._LightsDirtyCallBack),N&J.FresnelDirtyFlag&&J._DirtyCallbackArray.push(J._FresnelDirtyCallBack),N&J.AttributesDirtyFlag&&J._DirtyCallbackArray.push(J._AttributeDirtyCallBack),N&J.MiscDirtyFlag&&J._DirtyCallbackArray.push(J._MiscDirtyCallBack),N&J.PrePassDirtyFlag&&J._DirtyCallbackArray.push(J._PrePassDirtyCallBack),J._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(J._RunDirtyCallBacks),this.YN().resetCachedMaterial())}resetDrawCache(){const N=this.YN().meshes;for(const U of N)if(U.Ei)for(const N of U.Ei)N.IN()===this&&N.resetDrawCache()}_markAllSubMeshesAsDirty(N){const U=this.YN();if(U.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const V=U.meshes;for(const A of V)if(A.Ei)for(const V of A.Ei){if((V.IN()||(U._hasDefaultMaterial?U.defaultMaterial:null))===this)for(const U of V._drawWrappers)U&&U.defines&&U.defines.markAllAsDirty&&this._materialContext===U.materialContext&&N(U.defines)}}_markScenePrePassDirty(){if(this.YN().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const N=this.YN().enablePrePassRenderer();N&&N.FS()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(J._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(J._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(J._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(J._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(J._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(J._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(J._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(J._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(J._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(J._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const N=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Ai.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(N)}))}}setPrePassRenderer(N){return!1}dispose(N,U,V){const A=this.YN();if(A.stopAnimation(this),A.freeProcessedMaterials(),A.removeMaterial(this),this._eventInfo.forceDisposeTextures=U,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const N=this._parentContainer.materials.indexOf(this);N>-1&&this._parentContainer.materials.splice(N,1),this._parentContainer=null}if(!0!==V)if(this.meshMap)for(const t in this.meshMap){const N=this.meshMap[t];this._disposeMeshResources(N)}else{const N=A.meshes;for(const U of N)this._disposeMeshResources(U)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Ai.notifyObservers(this),this.Ai.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(N){if(!N)return;const U=N.Ji,V=N._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(N.Ei&&V)for(const t of N.Ei){const N=t._drawWrappers;for(let n=0;n<N.length;n++){var A;const q=null===(A=N[n])||void 0===A?void 0:A.effect;if(!q)continue;V[n]===this&&(null===U||void 0===U||U._releaseVertexArrayObject(q),t._removeDrawWrapper(n,!0,!0))}}}else null===U||void 0===U||U._releaseVertexArrayObject(this._drawWrapper.effect);N.material!==this||N.sourceMesh||(N.material=null)}serialize(){const N=B.d.Serialize(this);return N.ti=this.ti.serialize(),N.uniqueId=this.uniqueId,this._serializePlugins(N),N}_serializePlugins(N){if(N.plugins={},this.pluginManager)for(const U of this.pluginManager._plugins)U.doNotSerialize||(N.plugins[U.getClassName()]=U.serialize())}static Parse(N,U,V){if(N.customType){if("BABYLON.PBRMaterial"===N.customType&&N.overloadedAlbedo&&(N.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return E.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else N.customType="BABYLON.StandardMaterial";const A=n.Tools.Instantiate(N.customType).Parse(N,U,V);return A._loadedUniqueId=N.uniqueId,A}static _ParsePlugins(N,U,V,A){if(N.plugins)for(const i in N.plugins){var t,q;const z=N.plugins[i];let S=null===(t=U.pluginManager)||void 0===t?void 0:t.getPlugin(z.name);if(!S){const N=n.Tools.Instantiate("BABYLON."+i);N&&(S=new N(U))}null===(q=S)||void 0===q||q.parse(z,V,A)}}}J.TriangleFillMode=0,J.WireFrameFillMode=1,J.PointFillMode=2,J.PointListDrawMode=3,J.LineListDrawMode=4,J.LineLoopDrawMode=5,J.LineStripDrawMode=6,J.TriangleStripDrawMode=7,J.TriangleFanDrawMode=8,J.ClockWiseSideOrientation=0,J.CounterClockWiseSideOrientation=1,J.ImageProcessingDirtyFlag=64,J.TextureDirtyFlag=1,J.LightDirtyFlag=2,J.FresnelDirtyFlag=4,J.AttributesDirtyFlag=8,J.MiscDirtyFlag=16,J.PrePassDirtyFlag=32,J.AllDirtyFlag=127,J.MATERIAL_OPAQUE=0,J.MATERIAL_ALPHATEST=1,J.MATERIAL_ALPHABLEND=2,J.MATERIAL_ALPHATESTANDBLEND=3,J.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,J.MATERIAL_NORMALBLENDMETHOD_RNM=1,J.OnEventObservable=new q.d,J._AllDirtyCallBack=N=>N.markAllAsDirty(),J._ImageProcessingDirtyCallBack=N=>N.markAsImageProcessingDirty(),J._TextureDirtyCallBack=N=>N.markAsTexturesDirty(),J._FresnelDirtyCallBack=N=>N.markAsFresnelDirty(),J._MiscDirtyCallBack=N=>N.markAsMiscDirty(),J._PrePassDirtyCallBack=N=>N.markAsPrePassDirty(),J._LightsDirtyCallBack=N=>N.markAsLightDirty(),J._AttributeDirtyCallBack=N=>N.markAsAttributesDirty(),J._FresnelAndMiscDirtyCallBack=N=>{J._FresnelDirtyCallBack(N),J._MiscDirtyCallBack(N)},J._TextureAndMiscDirtyCallBack=N=>{J._TextureDirtyCallBack(N),J._MiscDirtyCallBack(N)},J._DirtyCallbackArray=[],J._RunDirtyCallBacks=N=>{for(const U of J._DirtyCallbackArray)U(N)},(0,A.b)([(0,t.N)()],J.prototype,"id",void 0),(0,A.b)([(0,t.N)()],J.prototype,"uniqueId",void 0),(0,A.b)([(0,t.N)()],J.prototype,"name",void 0),(0,A.b)([(0,t.N)()],J.prototype,"metadata",void 0),(0,A.b)([(0,t.N)()],J.prototype,"checkReadyOnEveryCall",void 0),(0,A.b)([(0,t.N)()],J.prototype,"checkReadyOnlyOnce",void 0),(0,A.b)([(0,t.N)()],J.prototype,"state",void 0),(0,A.b)([(0,t.N)("alpha")],J.prototype,"_alpha",void 0),(0,A.b)([(0,t.N)("ri")],J.prototype,"_backFaceCulling",void 0),(0,A.b)([(0,t.N)("cullBackFaces")],J.prototype,"_cullBackFaces",void 0),(0,A.b)([(0,t.N)()],J.prototype,"sideOrientation",void 0),(0,A.b)([(0,t.N)("alphaMode")],J.prototype,"_alphaMode",void 0),(0,A.b)([(0,t.N)()],J.prototype,"_needDepthPrePass",void 0),(0,A.b)([(0,t.N)()],J.prototype,"disableDepthWrite",void 0),(0,A.b)([(0,t.N)()],J.prototype,"disableColorWrite",void 0),(0,A.b)([(0,t.N)()],J.prototype,"forceDepthWrite",void 0),(0,A.b)([(0,t.N)()],J.prototype,"depthFunction",void 0),(0,A.b)([(0,t.N)()],J.prototype,"separateCullingPass",void 0),(0,A.b)([(0,t.N)("fogEnabled")],J.prototype,"_fogEnabled",void 0),(0,A.b)([(0,t.N)()],J.prototype,"pointSize",void 0),(0,A.b)([(0,t.N)()],J.prototype,"zOffset",void 0),(0,A.b)([(0,t.N)()],J.prototype,"zOffsetUnits",void 0),(0,A.b)([(0,t.N)()],J.prototype,"pointsCloud",null),(0,A.b)([(0,t.N)()],J.prototype,"fillMode",null),(0,A.b)([(0,t.N)()],J.prototype,"useLogarithmicDepth",null),(0,A.b)([(0,t.N)()],J.prototype,"transparencyMode",null)},12713:(N,U,V)=>{V.d(U,{C:()=>W,E:()=>B,H:()=>k,L:()=>X,N:()=>w,R:()=>a,T:()=>d,U:()=>M,W:()=>e,_:()=>Q,ab:()=>u,b:()=>h,bb:()=>I,cb:()=>C,f:()=>p,g:()=>H,k:()=>E,n:()=>x,p:()=>J,s:()=>r,w:()=>s,x:()=>v,y:()=>Y});var A=V(12193),t=V(12426),n=V(12223),q=V(12654),i=V(12717);const z=t.rU.Black(),S={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function E(N,U,V){if(!N||N.LOGARITHMICDEPTH||N.indexOf&&N.indexOf("LOGARITHMICDEPTH")>=0){const N=V.activeCamera;1===N.mode&&A.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),U.setFloat("logarithmicDepthConstant",2/(Math.log(N.maxZ+1)/Math.LN2))}}function p(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];V&&N.fogEnabled&&(!U||U.applyFog)&&0!==N.fogMode&&(V.setFloat4("vFogInfos",N.fogMode,N.fogStart,N.fogEnd,N.fogDensity),A?(N.fogColor.toLinearSpaceToRef(z,N.getEngine().useExactSrgbConversions),V.setColor3("vFogColor",z)):V.setColor3("vFogColor",N.fogColor))}function k(N,U,V,A,t,n,q,i,z,E){const p=N.numMaxInfluencers||N.numInfluencers;return p<=0?0:(U.push("#define MORPHTARGETS"),N.hasPositions&&U.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),N.hasNormals&&U.push("#define MORPHTARGETTEXTURE_HASNORMALS"),N.hasTangents&&U.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),N.hasUVs&&U.push("#define MORPHTARGETTEXTURE_HASUVS"),N.hasUV2s&&U.push("#define MORPHTARGETTEXTURE_HASUV2S"),N.hasColors&&U.push("#define MORPHTARGETTEXTURE_HASCOLORS"),N.supportsPositions&&t&&U.push("#define MORPHTARGETS_POSITION"),N.supportsNormals&&n&&U.push("#define MORPHTARGETS_NORMAL"),N.supportsTangents&&q&&U.push("#define MORPHTARGETS_TANGENT"),N.supportsUVs&&i&&U.push("#define MORPHTARGETS_UV"),N.supportsUV2s&&z&&U.push("#define MORPHTARGETS_UV2"),N.supportsColors&&E&&U.push("#define MORPHTARGETS_COLOR"),U.push("#define NUM_MORPH_INFLUENCERS "+p),N.isUsingTextureForTargets&&U.push("#define MORPHTARGETS_TEXTURE"),S.NUM_MORPH_INFLUENCERS=p,S.NORMAL=n,S.TANGENT=q,S.UV=i,S.UV2=z,S.COLOR=E,B(V,A,S,t),p)}function B(N,U,V){let t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=V.NUM_MORPH_INFLUENCERS;if(q>0&&n.e.LastCreatedEngine){const i=n.e.LastCreatedEngine.getCaps().maxVertexAttribs,z=U.morphTargetManager;if(null!==z&&void 0!==z&&z.isUsingTextureForTargets)return;const S=z&&z.supportsPositions&&t,E=z&&z.supportsNormals&&V.NORMAL,p=z&&z.supportsTangents&&V.TANGENT,k=z&&z.supportsUVs&&V.UV1,B=z&&z.supportsUV2s&&V.UV2,C=z&&z.supportsColors&&V.VERTEXCOLOR;for(let V=0;V<q;V++)S&&N.push("position"+V),E&&N.push("normal"+V),p&&N.push("tangent"+V),k&&N.push("uv_"+V),B&&N.push("uv2_"+V),C&&N.push("color"+V),N.length>i&&A.b.Error("Cannot add more vertex attributes for mesh "+U.name)}}function C(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N.push("world0"),N.push("world1"),N.push("world2"),N.push("world3"),U&&(N.push("previousWorld0"),N.push("previousWorld1"),N.push("previousWorld2"),N.push("previousWorld3"))}function x(N,U){const V=N.morphTargetManager;N&&V&&U.setFloatArray("morphTargetInfluences",V.influences)}function J(N,U){U.bindToEffect(N,"Scene")}function d(N,U,V){U._needUVs=!0,U[V]=!0,N.optimizeUVAllocation&&N.getTextureMatrix().isIdentityAs3x2()?(U[V+"DIRECTUV"]=N.coordinatesIndex+1,U["MAINUV"+(N.coordinatesIndex+1)]=!0):U[V+"DIRECTUV"]=0}function r(N,U,V){const A=N.getTextureMatrix();U.Ci(V+"Matrix",A)}function v(N,U,V){V.BAKED_VERTEX_ANIMATION_TEXTURE&&V.INSTANCES&&N.push("bakedVertexAnimationSettingsInstanced")}function h(N,U,V){var A;if(U&&N&&(N.computeBonesUsingShaders&&U._bonesComputationForcedToCPU&&(N.computeBonesUsingShaders=!1),N.useBones&&N.computeBonesUsingShaders&&N.skeleton)){const t=N.skeleton;if(t.isUsingTextureForMatrices&&U.getUniformIndex("boneTextureWidth")>-1){const V=t.getTransformMatrixTexture(N);U.setTexture("boneSampler",V),U.setFloat("boneTextureWidth",4*(t.bones.length+1))}else{const n=t.getTransformMatrices(N);n&&(U.setMatrices("mBones",n),V&&N.YN().prePassRenderer&&N.YN().prePassRenderer.getIndex(2)&&(V.previousBones[N.uniqueId]||(V.previousBones[N.uniqueId]=n.slice()),U.setMatrices("mPreviousBones",V.previousBones[N.uniqueId]),A=n,V.previousBones[N.uniqueId].set(A)))}}}function c(N,U,V,A,t){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];N._bindLight(U,V,A,t,n)}function H(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const n=Math.min(U.lightSources.length,t);for(let q=0;q<n;q++){c(U.lightSources[q],q,N,V,"boolean"===typeof A?A:A.SPECULARTERM,U.receiveShadows)}}function Y(N,U,V,A){V.NUM_BONE_INFLUENCERS>0&&(A.addCPUSkinningFallback(0,U),N.push("matricesIndices"),N.push("matricesWeights"),V.NUM_BONE_INFLUENCERS>4&&(N.push("matricesIndicesExtra"),N.push("matricesWeightsExtra")))}function W(N,U){(U.INSTANCES||U.THIN_INSTANCES)&&C(N,!!U.PREPASS_VELOCITY),U.INSTANCESCOLOR&&N.push("instanceColor")}function s(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=0;for(let n=0;n<V&&N["LIGHT"+n];n++)n>0&&(t=A+n,U.addFallback(t,"LIGHT"+n)),N.SHADOWS||(N["SHADOW"+n]&&U.addFallback(A,"SHADOW"+n),N["SHADOWPCF"+n]&&U.addFallback(A,"SHADOWPCF"+n),N["SHADOWPCSS"+n]&&U.addFallback(A,"SHADOWPCSS"+n),N["SHADOWPOISSON"+n]&&U.addFallback(A,"SHADOWPOISSON"+n),N["SHADOWESM"+n]&&U.addFallback(A,"SHADOWESM"+n),N["SHADOWCLOSEESM"+n]&&U.addFallback(A,"SHADOWCLOSEESM"+n));return t++}function M(N,U,V,A,t,n,q){let i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];q._areMiscDirty&&(q.LOGARITHMICDEPTH=V,q.POINTSIZE=A,q.FOG=t&&function(N,U){return U.fogEnabled&&N.applyFog&&0!==U.fogMode}(N,U),q.NONUNIFORMSCALING=N.nonUniformScaling,q.ALPHATEST=n,q.DECAL_AFTER_DETAIL=i)}function a(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V._areLightsDirty)return V._needNormals;let q=0;const i={needNormals:V._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(N.lightsEnabled&&!n)for(const S of U.lightSources)if(mN(N,U,S,q,V,A,i),q++,q===t)break;V.SPECULARTERM=i.specularEnabled,V.SHADOWS=i.shadowEnabled;for(let S=q;S<t;S++)void 0!==V["LIGHT"+S]&&(V["LIGHT"+S]=!1,V["HEMILIGHT"+S]=!1,V["POINTLIGHT"+S]=!1,V["DIRLIGHT"+S]=!1,V["SPOTLIGHT"+S]=!1,V["AREALIGHT"+S]=!1,V["SHADOW"+S]=!1,V["SHADOWCSM"+S]=!1,V["SHADOWCSMDEBUG"+S]=!1,V["SHADOWCSMNUM_CASCADES"+S]=!1,V["SHADOWCSMUSESHADOWMAXZ"+S]=!1,V["SHADOWCSMNOBLEND"+S]=!1,V["SHADOWCSM_RIGHTHANDED"+S]=!1,V["SHADOWPCF"+S]=!1,V["SHADOWPCSS"+S]=!1,V["SHADOWPOISSON"+S]=!1,V["SHADOWESM"+S]=!1,V["SHADOWCLOSEESM"+S]=!1,V["SHADOWCUBE"+S]=!1,V["SHADOWLOWQUALITY"+S]=!1,V["SHADOWMEDIUMQUALITY"+S]=!1);const z=N.getEngine().getCaps();return void 0===V.SHADOWFLOAT&&(i.needRebuild=!0),V.SHADOWFLOAT=i.shadowEnabled&&(z.textureFloatRender&&z.textureFloatLinearFiltering||z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering),V.LIGHTMAPEXCLUDED=i.lightmapMode,i.needRebuild&&V.rebuild(),i.needNormals}function mN(N,U,V,A,t,n,i){switch(i.needNormals=!0,void 0===t["LIGHT"+A]&&(i.needRebuild=!0),t["LIGHT"+A]=!0,t["SPOTLIGHT"+A]=!1,t["HEMILIGHT"+A]=!1,t["POINTLIGHT"+A]=!1,t["DIRLIGHT"+A]=!1,t["AREALIGHT"+A]=!1,V.prepareLightSpecificDefines(t,A),t["LIGHT_FALLOFF_PHYSICAL"+A]=!1,t["LIGHT_FALLOFF_GLTF"+A]=!1,t["LIGHT_FALLOFF_STANDARD"+A]=!1,V.falloffType){case q.d.FALLOFF_GLTF:t["LIGHT_FALLOFF_GLTF"+A]=!0;break;case q.d.FALLOFF_PHYSICAL:t["LIGHT_FALLOFF_PHYSICAL"+A]=!0;break;case q.d.FALLOFF_STANDARD:t["LIGHT_FALLOFF_STANDARD"+A]=!0}if(n&&!V.CE.equalsFloats(0,0,0)&&(i.specularEnabled=!0),t["SHADOW"+A]=!1,t["SHADOWCSM"+A]=!1,t["SHADOWCSMDEBUG"+A]=!1,t["SHADOWCSMNUM_CASCADES"+A]=!1,t["SHADOWCSMUSESHADOWMAXZ"+A]=!1,t["SHADOWCSMNOBLEND"+A]=!1,t["SHADOWCSM_RIGHTHANDED"+A]=!1,t["SHADOWPCF"+A]=!1,t["SHADOWPCSS"+A]=!1,t["SHADOWPOISSON"+A]=!1,t["SHADOWESM"+A]=!1,t["SHADOWCLOSEESM"+A]=!1,t["SHADOWCUBE"+A]=!1,t["SHADOWLOWQUALITY"+A]=!1,t["SHADOWMEDIUMQUALITY"+A]=!1,U&&U.receiveShadows&&N.shadowsEnabled&&V.shadowEnabled){const U=V.getShadowGenerator(N.activeCamera)??V.getShadowGenerator();if(U){const N=U.getShadowMap();N&&N.renderList&&N.renderList.length>0&&(i.shadowEnabled=!0,U.prepareDefines(t,A))}}V.lightmapMode!=q.d.LIGHTMAP_DEFAULT?(i.lightmapMode=!0,t["LIGHTMAPEXCLUDED"+A]=!0,t["LIGHTMAPNOSPECULAR"+A]=V.lightmapMode==q.d.LIGHTMAP_SHADOWSONLY):(t["LIGHTMAPEXCLUDED"+A]=!1,t["LIGHTMAPNOSPECULAR"+A]=!1)}function w(N,U,V,A,t){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=function(N,U){let V=!1;if(N.activeCamera){const A=U.CAMERA_ORTHOGRAPHIC?1:0,t=U.CAMERA_PERSPECTIVE?1:0,n=1===N.activeCamera.mode?1:0,q=0===N.activeCamera.mode?1:0;(A^n||t^q)&&(U.CAMERA_ORTHOGRAPHIC=1===n,U.CAMERA_PERSPECTIVE=1===q,V=!0)}return V}(N,A);!1!==n&&(z=(0,i.g)(V,N,A)),A.DEPTHPREPASS!==!U.getColorWrite()&&(A.DEPTHPREPASS=!A.DEPTHPREPASS,z=!0),A.INSTANCES!==t&&(A.INSTANCES=t,z=!0),A.THIN_INSTANCES!==q&&(A.THIN_INSTANCES=q,z=!0),z&&A.markAsUnprocessed()}function X(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!U._areAttributesDirty&&U._needNormals===U._normals&&U._needUVs===U._uvs)return!1;U._normals=U._needNormals,U._uvs=U._needUVs,U.NORMAL=U._needNormals&&N.isVerticesDataPresent("normal"),U._needNormals&&N.isVerticesDataPresent("tangent")&&(U.TANGENT=!0);for(let i=1;i<=6;++i)U["UV"+i]=!!U._needUVs&&N.isVerticesDataPresent(`uv${1===i?"":i}`);if(V){const V=N.useVertexColors&&N.isVerticesDataPresent("color");U.VERTEXCOLOR=V,U.VERTEXALPHA=N.hasVertexAlpha&&V&&n}return N.isVerticesDataPresent("instanceColor")&&(N.hasInstances||N.hasThinInstances)&&(U.INSTANCESCOLOR=!0),A&&function(N,U){if(N.useBones&&N.computeBonesUsingShaders&&N.skeleton){U.NUM_BONE_INFLUENCERS=N.numBoneInfluencers;const V=void 0!==U.BONETEXTURE;if(N.skeleton.isUsingTextureForMatrices&&V)U.BONETEXTURE=!0;else{U.BonesPerMesh=N.skeleton.bones.length+1,U.BONETEXTURE=!V&&void 0;const A=N.YN().prePassRenderer;if(A&&A.enabled){const V=-1===A.excludedSkinnedMesh.indexOf(N);U.BONES_VELOCITY_ENABLED=V}}}else U.NUM_BONE_INFLUENCERS=0,U.BonesPerMesh=0,void 0!==U.BONETEXTURE&&(U.BONETEXTURE=!1)}(N,U),t&&function(N,U){const V=N.morphTargetManager;V?(U.MORPHTARGETS_UV=V.supportsUVs&&U.UV1,U.MORPHTARGETS_UV2=V.supportsUV2s&&U.UV2,U.MORPHTARGETS_TANGENT=V.supportsTangents&&U.TANGENT,U.MORPHTARGETS_NORMAL=V.supportsNormals&&U.NORMAL,U.MORPHTARGETS_POSITION=V.supportsPositions,U.MORPHTARGETS_COLOR=V.supportsColors,U.MORPHTARGETTEXTURE_HASUVS=V.hasUVs,U.MORPHTARGETTEXTURE_HASUV2S=V.hasUV2s,U.MORPHTARGETTEXTURE_HASTANGENTS=V.hasTangents,U.MORPHTARGETTEXTURE_HASNORMALS=V.hasNormals,U.MORPHTARGETTEXTURE_HASPOSITIONS=V.hasPositions,U.MORPHTARGETTEXTURE_HASCOLORS=V.hasColors,U.NUM_MORPH_INFLUENCERS=V.numMaxInfluencers||V.numInfluencers,U.MORPHTARGETS=U.NUM_MORPH_INFLUENCERS>0,U.MORPHTARGETS_TEXTURE=V.isUsingTextureForTargets):(U.MORPHTARGETS_UV=!1,U.MORPHTARGETS_UV2=!1,U.MORPHTARGETS_TANGENT=!1,U.MORPHTARGETS_NORMAL=!1,U.MORPHTARGETS_POSITION=!1,U.MORPHTARGETS_COLOR=!1,U.MORPHTARGETTEXTURE_HASUVS=!1,U.MORPHTARGETTEXTURE_HASUV2S=!1,U.MORPHTARGETTEXTURE_HASTANGENTS=!1,U.MORPHTARGETTEXTURE_HASNORMALS=!1,U.MORPHTARGETTEXTURE_HASPOSITIONS=!1,U.MORPHTARGETTEXTURE_HAS_COLORS=!1,U.MORPHTARGETS=!1,U.NUM_MORPH_INFLUENCERS=0)}(N,U),q&&function(N,U){const V=N.bakedVertexAnimationManager;U.BAKED_VERTEX_ANIMATION_TEXTURE=!(!V||!V.isEnabled)}(N,U),!0}function e(N,U){if(N.activeCamera){const V=U.MULTIVIEW;U.MULTIVIEW=null!==N.activeCamera.outputRenderTarget&&N.activeCamera.outputRenderTarget.getViewCount()>1,U.MULTIVIEW!=V&&U.markAsUnprocessed()}}function Q(N,U,V){const A=U.ORDER_INDEPENDENT_TRANSPARENCY,t=U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;U.ORDER_INDEPENDENT_TRANSPARENCY=N.useOrderIndependentTransparency&&V,U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!N.getEngine().getCaps().textureFloatLinearFiltering,A===U.ORDER_INDEPENDENT_TRANSPARENCY&&t===U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||U.markAsUnprocessed()}function u(N,U,V){const A=U.PREPASS;if(!U._arePrePassDirty)return;const t=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(N.prePassRenderer&&N.prePassRenderer.enabled&&V){U.PREPASS=!0,U.SCENE_MRT_COUNT=N.prePassRenderer.mrtCount,U.PREPASS_NORMAL_WORLDSPACE=N.prePassRenderer.generateNormalsInWorldSpace,U.PREPASS_COLOR=!0,U.PREPASS_COLOR_INDEX=0;for(let V=0;V<t.length;V++){const A=N.prePassRenderer.getIndex(t[V].type);-1!==A?(U[t[V].define]=!0,U[t[V].index]=A):U[t[V].define]=!1}}else{U.PREPASS=!1;for(let N=0;N<t.length;N++)U[t[N].define]=!1}U.PREPASS!=A&&(U.markAsUnprocessed(),U.markAsImageProcessingDirty())}function L(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t&&t.push("Light"+N),n||(U.push("vLightData"+N,"vLightDiffuse"+N,"vLightSpecular"+N,"vLightDirection"+N,"vLightWidth"+N,"vLightHeight"+N,"vLightFalloff"+N,"vLightGround"+N,"lightMatrix"+N,"shadowsInfo"+N,"depthValues"+N),V.push("shadowTexture"+N),V.push("depthTexture"+N),U.push("viewFrustumZ"+N,"cascadeBlendFactor"+N,"lightSizeUVCorrection"+N,"depthCorrection"+N,"penumbraDarkness"+N,"frustumLengths"+N),A&&(V.push("projectionLightTexture"+N),U.push("textureProjectionMatrix"+N)),q&&V.push("iesLightTexture"+N))}function I(N,U,V){let A,t,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(N.uniformsNames){const q=N;A=q.uniformsNames,t=q.uniformBuffersNames,U=q.samplers,V=q.defines,n=q.maxSimultaneousLights||0}else A=N,U||(U=[]);for(let q=0;q<n&&V["LIGHT"+q];q++)L(q,A,U,V["PROJECTEDLIGHTTEXTURE"+q],t,!1,V["IESLIGHTTEXTURE"+q]);V.NUM_MORPH_INFLUENCERS&&(A.push("morphTargetInfluences"),A.push("morphTargetCount")),V.BAKED_VERTEX_ANIMATION_TEXTURE&&(A.push("bakedVertexAnimationSettings"),A.push("bakedVertexAnimationTextureSizeInverted"),A.push("bakedVertexAnimationTime"),U.push("bakedVertexAnimationTexture"))}},12667:(N,U,V)=>{V.d(U,{c:()=>n});var A=V(12383),t=V(12672);class n extends t.d{constructor(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(N,U,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new A.Matrix,this._storeEffectOnSubMeshes=V}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(N,U){return!!N&&(!this._storeEffectOnSubMeshes||(!N.Ei||0===N.Ei.length||this.isReadyForSubMesh(N,N.Ei[0],U)))}_isReadyForSubMesh(N){const U=N.materialDefines;return!(this.checkReadyOnEveryCall||!N.effect||!U||U._renderId!==this.YN().getRenderId())}bindOnlyWorldMatrix(N){this._activeEffect.setMatrix("world",N)}bindOnlyNormalMatrix(N){this._activeEffect.setMatrix("normalMatrix",N)}bind(N,U){U&&this.bindForSubMesh(N,U,U.Ei[0])}_afterBind(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0;super._afterBind(N,U,V),this.YN()._cachedEffect=U,V?V._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return V._drawWrapper._forceRebindOnNextCall||N.isCachedMaterialInvalid(this,U,A)}dispose(N,U,V){this._activeEffect=void 0,super.dispose(N,U,V)}}},12708:(N,U,V)=>{V.d(U,{c:()=>i,g:()=>z});var A=V(12367),t=V(12383),n=V(12369);class q{static extractMinAndMaxIndexed(N,U,V,A,t,n){for(let q=V;q<V+A;q++){const V=3*U[q],A=N[V],i=N[V+1],z=N[V+2];t.minimizeInPlaceFromFloats(A,i,z),n.maximizeInPlaceFromFloats(A,i,z)}}static extractMinAndMax(N,U,V,A,t,n){for(let q=U,i=U*A;q<U+V;q++,i+=A){const U=N[i],V=N[i+1],A=N[i+2];t.minimizeInPlaceFromFloats(U,V,A),n.maximizeInPlaceFromFloats(U,V,A)}}}function i(N,U,V,A){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const i=new t.CU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new t.CU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return q.extractMinAndMaxIndexed(N,U,V,A,i,z),n&&(i.x-=i.x*n.x+n.y,i.y-=i.y*n.x+n.y,i.z-=i.z*n.x+n.y,z.x+=z.x*n.x+n.y,z.y+=z.y*n.x+n.y,z.z+=z.z*n.x+n.y),{minimum:i,maximum:z}}function z(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4?arguments[4]:void 0;const i=new t.CU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new t.CU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),q.extractMinAndMax(N,U,V,n,i,z),A&&(i.x-=i.x*A.x+A.y,i.y-=i.y*A.x+A.y,i.z-=i.z*A.x+A.y,z.x+=z.x*A.x+A.y,z.y+=z.y*A.x+A.y,z.z+=z.z*A.x+A.y),{minimum:i,maximum:z}}(0,A.b)([n.f.filter((function(){for(var N=arguments.length,U=new Array(N),V=0;V<N;V++)U[V]=arguments[V];let[A,t]=U;return!Array.isArray(A)&&!Array.isArray(t)}))],q,"extractMinAndMaxIndexed",null),(0,A.b)([n.f.filter((function(){for(var N=arguments.length,U=new Array(N),V=0;V<N;V++)U[V]=arguments[V];let[A]=U;return!Array.isArray(A)}))],q,"extractMinAndMax",null)},12679:(N,U,V)=>{V.d(U,{e:()=>z});var A=V(12453),t=V(12685),n=V(12692),q=V(12708),i=V(12500);class z{get materialDefines(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(N=this._getDrawWrapper())||void 0===N?void 0:N.defines}set materialDefines(N){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=N}_getDrawWrapper(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N??this._engine.currentRenderPassId;let V=this._drawWrappers[N];return!V&&U&&(this._drawWrappers[N]=V=new i.b(this._mesh.YN().getEngine())),V}_removeDrawWrapper(N){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var V;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(V=this._drawWrappers[N])||void 0===V||V.dispose(U));this._drawWrappers[N]=void 0}get effect(){var N;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(N=this._getDrawWrapper())||void 0===N?void 0:N.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(N){this._mainDrawWrapperOverride=N}setEffect(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this._drawWrapper;t.setEffect(N,U,A),void 0!==V&&(t.materialContext=V),N||(t.defines=null,t.materialContext=void 0)}resetDrawCache(N){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==N)return void this._removeDrawWrapper(N,!0,U);for(const N of this._drawWrappers)null===N||void 0===N||N.dispose(U)}this._drawWrappers=[]}static AddToMesh(N,U,V,A,t,n,q){return new z(N,U,V,A,t,n,q,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(N,U,V,A,t,n,q){let i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],z=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=N,this.verticesStart=U,this.verticesCount=V,this.indexStart=A,this.indexCount=t,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=n,this._renderingMesh=q||n,z&&n.Ei.push(this),this._engine=this._mesh.YN().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=n.Ei.length-1,i&&(this.refreshBoundingInfo(),n.xi(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(N){return this._boundingInfo=N,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const N=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return N||this._renderingMesh}IN(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!U)return N&&this._mesh.YN()._hasDefaultMaterial?this._mesh.YN().defaultMaterial:null;if(this._isMultiMaterial(U)){const N=U.getSubMaterial(this.materialIndex);return this._currentMaterial!==N&&(this._currentMaterial=N,this.resetDrawCache()),N}return U}_isMultiMaterial(N){return void 0!==N.getSubMaterial}refreshBoundingInfo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Ji)return this;if(N||(N=this._renderingMesh.getVerticesData(A.f.PositionKind)),!N)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const U=this._renderingMesh.di();let V;if(0===this.indexStart&&this.indexCount===U.length){const N=this._renderingMesh.getBoundingInfo();V={minimum:N.minimum.clone(),maximum:N.maximum.clone()}}else V=(0,q.c)(N,U,this.indexStart,this.indexCount,this._renderingMesh.Ji.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new n.d(V.minimum,V.maximum),this}_checkCollision(N){return this.getBoundingInfo()._checkCollision(N)}updateBoundingInfo(N){let U=this.getBoundingInfo();return U||(this.refreshBoundingInfo(),U=this.getBoundingInfo()),U&&U.update(N),this}isInFrustum(N){const U=this.getBoundingInfo();return!!U&&U.isInFrustum(N,this._mesh.Jp)}isCompletelyInFrustum(N){const U=this.getBoundingInfo();return!!U&&U.isCompletelyInFrustum(N)}render(N){return this._renderingMesh.render(this,N,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(N,U){if(!this._linesIndexBuffer){const V=6*Math.floor(this.indexCount/3),A=this.verticesStart+this.verticesCount>65535?new Uint32Array(V):new Uint16Array(V);let t=0;if(0===N.length)for(let N=this.indexStart;N<this.indexStart+this.indexCount;N+=3)A[t++]=N,A[t++]=N+1,A[t++]=N+1,A[t++]=N+2,A[t++]=N+2,A[t++]=N;else for(let U=this.indexStart;U<this.indexStart+this.indexCount;U+=3)A[t++]=N[U],A[t++]=N[U+1],A[t++]=N[U+1],A[t++]=N[U+2],A[t++]=N[U+2],A[t++]=N[U];this._linesIndexBuffer=U.createIndexBuffer(A),this._linesIndexCount=A.length}return this._linesIndexBuffer}canIntersects(N){const U=this.getBoundingInfo();return!!U&&N.intersectsBox(U.boundingBox)}intersects(N,U,V,A,t){const n=this.IN();if(!n)return null;let q=3,i=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return null;case 7:q=1,i=!0}return 4===n.fillMode?V.length?this._intersectLines(N,U,V,this._mesh.intersectionThreshold,A):this._intersectUnIndexedLines(N,U,V,this._mesh.intersectionThreshold,A):!V.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(N,U,V,A,t):this._intersectTriangles(N,U,V,q,i,A,t)}_intersectLines(N,U,V,A,n){let q=null;for(let i=this.indexStart;i<this.indexStart+this.indexCount;i+=2){const z=U[V[i]],S=U[V[i+1]],E=N.intersectionSegment(z,S,A);if(!(E<0)&&((n||!q||E<q.distance)&&(q=new t.e(null,null,E),q.faceId=i/2,n)))break}return q}_intersectUnIndexedLines(N,U,V,A,n){let q=null;for(let i=this.verticesStart;i<this.verticesStart+this.verticesCount;i+=2){const V=U[i],z=U[i+1],S=N.intersectionSegment(V,z,A);if(!(S<0)&&((n||!q||S<q.distance)&&(q=new t.e(null,null,S),q.faceId=i/2,n)))break}return q}_intersectTriangles(N,U,V,A,t,n,q){let i=null,z=-1;for(let S=this.indexStart;S<this.indexStart+this.indexCount-(3-A);S+=A){z++;const A=V[S],E=V[S+1],p=V[S+2];if(t&&4294967295===p){S+=2;continue}const k=U[A],B=U[E],C=U[p];if(!k||!B||!C)continue;if(q&&!q(k,B,C,N,A,E,p))continue;const x=N.intersectsTriangle(k,B,C);if(x){if(x.distance<0)continue;if((n||!i||x.distance<i.distance)&&(i=x,i.faceId=z,n))break}}return i}_intersectUnIndexedTriangles(N,U,V,A,t){let n=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=3){const V=U[q],i=U[q+1],z=U[q+2];if(t&&!t(V,i,z,N,-1,-1,-1))continue;const S=N.intersectsTriangle(V,i,z);if(S){if(S.distance<0)continue;if((A||!n||S.distance<n.distance)&&(n=S,n.faceId=q/3,A))break}}return n}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(N,U){const V=new z(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,N,U,!1);if(!this.IsGlobal){const N=this.getBoundingInfo();if(!N)return V;V._boundingInfo=new n.d(N.minimum,N.maximum)}return V}dispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.YN().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const U=this._mesh.Ei.indexOf(this);this._mesh.Ei.splice(U,1),this.resetDrawCache(void 0,N)}getClassName(){return"SubMesh"}static CreateFromIndices(N,U,V,A,t){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],q=Number.MAX_VALUE,i=-Number.MAX_VALUE;const S=(t||A).di();for(let z=U;z<U+V;z++){const N=S[z];N<q&&(q=N),N>i&&(i=N)}return new z(N,q,i-q+1,U,V,A,t,n)}}}}]);