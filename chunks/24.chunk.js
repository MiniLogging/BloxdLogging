"use strict";(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[24],{13186:(h,R,l)=>{l.d(R,{b:()=>j});class j{constructor(h,R,l){this.bu=h,this.bv=R,this.distance=l,this.faceId=0,this.subMeshId=0}}},13198:(h,R,l)=>{l.d(R,{c:()=>U});var j=l(12910),a=l(12900),D=l(12902);class U{constructor(h,R,l){this.vectors=(0,j.e)(8,a.tR.Zero),this.center=a.tR.Zero(),this.centerWorld=a.tR.Zero(),this.extendSize=a.tR.Zero(),this.extendSizeWorld=a.tR.Zero(),this.directions=(0,j.e)(3,a.tR.Zero),this.vectorsWorld=(0,j.e)(8,a.tR.Zero),this.minimumWorld=a.tR.Zero(),this.maximumWorld=a.tR.Zero(),this.minimum=a.tR.Zero(),this.maximum=a.tR.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(h,R,l)}reConstruct(h,R,l){const j=h.x,D=h.y,U=h.z,F=R.x,w=R.y,mh=R.z,u=this.vectors;this.minimum.OF(j,D,U),this.maximum.OF(F,w,mh),u[0].OF(j,D,U),u[1].OF(F,w,mh),u[2].OF(F,D,U),u[3].OF(j,w,U),u[4].OF(j,D,mh),u[5].OF(F,w,U),u[6].OF(j,w,mh),u[7].OF(F,D,mh),R.addToRef(h,this.center).scaleInPlace(.5),R.subtractToRef(h,this.extendSize).scaleInPlace(.5),this._worldMatrix=l||a.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(h){const R=U._TmpVector3,l=this.maximum.subtractToRef(this.minimum,R[0]),j=l.length();l.normalizeFromLength(j);const a=j*h,D=l.scaleInPlace(.5*a),F=this.center.subtractToRef(D,R[1]),w=this.center.addToRef(D,R[2]);return this.reConstruct(F,w,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){const R=this.minimumWorld,l=this.maximumWorld,j=this.directions,D=this.vectorsWorld,U=this.vectors;if(h.isIdentity()){R.D(this.minimum),l.D(this.maximum);for(let h=0;h<8;++h)D[h].D(U[h]);this.extendSizeWorld.D(this.extendSize),this.centerWorld.D(this.center)}else{R.vF(Number.MAX_VALUE),l.vF(-Number.MAX_VALUE);for(let j=0;j<8;++j){const F=D[j];a.tR.TransformCoordinatesToRef(U[j],h,F),R.minimizeInPlace(F),l.maximizeInPlace(F)}l.subtractToRef(R,this.extendSizeWorld).scaleInPlace(.5),l.addToRef(R,this.centerWorld).scaleInPlace(.5)}a.tR.FromArrayToRef(h.m,0,j[0]),a.tR.FromArrayToRef(h.m,4,j[1]),a.tR.FromArrayToRef(h.m,8,j[2]),this._worldMatrix=h}isInFrustum(h){return U.IsInFrustum(this.vectorsWorld,h)}isCompletelyInFrustum(h){return U.IsCompletelyInFrustum(this.vectorsWorld,h)}intersectsPoint(h){const R=this.minimumWorld,l=this.maximumWorld,j=R.x,a=R.y,U=R.z,F=l.x,w=l.y,mh=l.z,u=h.x,c=h.y,J=h.z,q=-D.d;return!(F-u<q||q>u-j)&&(!(w-c<q||q>c-a)&&!(mh-J<q||q>J-U))}intersectsSphere(h){return U.IntersectsSphere(this.minimumWorld,this.maximumWorld,h.centerWorld,h.radiusWorld)}intersectsMinMax(h,R){const l=this.minimumWorld,j=this.maximumWorld,a=l.x,D=l.y,U=l.z,F=j.x,w=j.y,mh=j.z,u=h.x,c=h.y,J=h.z,q=R.x,Q=R.y,Y=R.z;return!(F<u||a>q)&&(!(w<c||D>Q)&&!(mh<J||U>Y))}dispose(){var h,R;null===(h=this._drawWrapperFront)||void 0===h||h.dispose(),null===(R=this._drawWrapperBack)||void 0===R||R.dispose()}static Intersects(h,R){return h.intersectsMinMax(R.minimumWorld,R.maximumWorld)}static IntersectsSphere(h,R,l,j){const D=U._TmpVector3[0];a.tR.ClampToRef(l,h,R,D);return a.tR.DistanceSquared(l,D)<=j*j}static IsCompletelyInFrustum(h,R){for(let l=0;l<6;++l){const j=R[l];for(let R=0;R<8;++R)if(j.dotCoordinate(h[R])<0)return!1}return!0}static IsInFrustum(h,R){for(let l=0;l<6;++l){let j=!0;const a=R[l];for(let R=0;R<8;++R)if(a.dotCoordinate(h[R])>=0){j=!1;break}if(j)return!1}return!0}}U._TmpVector3=(0,j.e)(3,a.tR.Zero)},13195:(h,R,l)=>{l.d(R,{e:()=>c});var j=l(12910),a=l(12900),D=l(13198),U=l(13206);const F={min:0,max:0},w={min:0,max:0},mh=(h,R,l)=>{const j=a.tR.Dot(R.centerWorld,h),D=Math.abs(a.tR.Dot(R.directions[0],h))*R.extendSize.x+Math.abs(a.tR.Dot(R.directions[1],h))*R.extendSize.y+Math.abs(a.tR.Dot(R.directions[2],h))*R.extendSize.z;l.min=j-D,l.max=j+D},u=(h,R,l)=>(mh(h,R,F),mh(h,l,w),!(F.min>w.max||w.min>F.max));class c{constructor(h,R,l){this._isLocked=!1,this.boundingBox=new D.c(h,R,l),this.boundingSphere=new U.b(h,R,l)}reConstruct(h,R,l){this.boundingBox.reConstruct(h,R,l),this.boundingSphere.reConstruct(h,R,l)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(h){this._isLocked=h}update(h){this._isLocked||(this.boundingBox._update(h),this.boundingSphere._update(h))}centerOn(h,R){const l=c._TmpVector3[0].D(h).Pc(R),j=c._TmpVector3[1].D(h).addInPlace(R);return this.boundingBox.reConstruct(l,j,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(l,j,this.boundingBox.getWorldMatrix()),this}encapsulate(h){const R=a.tR.Minimize(this.minimum,h),l=a.tR.Maximize(this.maximum,h);return this.reConstruct(R,l,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(h){const R=a.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(R);const l=a.TmpVectors.tR[0];return a.tR.TransformCoordinatesToRef(h.boundingBox.minimumWorld,R,l),this.encapsulate(l),a.tR.TransformCoordinatesToRef(h.boundingBox.maximumWorld,R,l),this.encapsulate(l),this}scale(h){return this.boundingBox.scale(h),this.boundingSphere.scale(h),this}isInFrustum(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===R||3===R)&&this.boundingSphere.isCenterInFrustum(h))return!0;if(!this.boundingSphere.isInFrustum(h))return!1;return!(1!==R&&3!==R)||this.boundingBox.isInFrustum(h)}get diagonalLength(){const h=this.boundingBox;return h.maximumWorld.subtractToRef(h.minimumWorld,c._TmpVector3[0]).length()}isCompletelyInFrustum(h){return this.boundingBox.isCompletelyInFrustum(h)}_checkCollision(h){return h._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(h){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(h)&&!!this.boundingBox.intersectsPoint(h))}intersects(h,R){if(!U.b.Intersects(this.boundingSphere,h.boundingSphere))return!1;if(!D.c.Intersects(this.boundingBox,h.boundingBox))return!1;if(!R)return!0;const l=this.boundingBox,j=h.boundingBox;return!!u(l.directions[0],l,j)&&(!!u(l.directions[1],l,j)&&(!!u(l.directions[2],l,j)&&(!!u(j.directions[0],l,j)&&(!!u(j.directions[1],l,j)&&(!!u(j.directions[2],l,j)&&(!!u(a.tR.Cross(l.directions[0],j.directions[0]),l,j)&&(!!u(a.tR.Cross(l.directions[0],j.directions[1]),l,j)&&(!!u(a.tR.Cross(l.directions[0],j.directions[2]),l,j)&&(!!u(a.tR.Cross(l.directions[1],j.directions[0]),l,j)&&(!!u(a.tR.Cross(l.directions[1],j.directions[1]),l,j)&&(!!u(a.tR.Cross(l.directions[1],j.directions[2]),l,j)&&(!!u(a.tR.Cross(l.directions[2],j.directions[0]),l,j)&&(!!u(a.tR.Cross(l.directions[2],j.directions[1]),l,j)&&!!u(a.tR.Cross(l.directions[2],j.directions[2]),l,j))))))))))))))}}c._TmpVector3=(0,j.e)(2,a.tR.Zero)},13206:(h,R,l)=>{l.d(R,{b:()=>D});var j=l(12910),a=l(12900);class D{constructor(h,R,l){this.center=a.tR.Zero(),this.centerWorld=a.tR.Zero(),this.minimum=a.tR.Zero(),this.maximum=a.tR.Zero(),this.reConstruct(h,R,l)}reConstruct(h,R,l){this.minimum.D(h),this.maximum.D(R);const j=a.tR.Distance(h,R);R.addToRef(h,this.center).scaleInPlace(.5),this.radius=.5*j,this._update(l||a.Matrix.IdentityReadOnly)}scale(h){const R=this.radius*h,l=D._TmpVector3,j=l[0].vF(R),a=this.center.subtractToRef(j,l[1]),U=this.center.addToRef(j,l[2]);return this.reConstruct(a,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){if(h.isIdentity())this.centerWorld.D(this.center),this.radiusWorld=this.radius;else{a.tR.TransformCoordinatesToRef(this.center,h,this.centerWorld);const R=D._TmpVector3[0];a.tR.TransformNormalFromFloatsToRef(1,1,1,h,R),this.radiusWorld=Math.max(Math.abs(R.x),Math.abs(R.y),Math.abs(R.z))*this.radius}}isInFrustum(h){const R=this.centerWorld,l=this.radiusWorld;for(let j=0;j<6;j++)if(h[j].dotCoordinate(R)<=-l)return!1;return!0}isCenterInFrustum(h){const R=this.centerWorld;for(let l=0;l<6;l++)if(h[l].dotCoordinate(R)<0)return!1;return!0}intersectsPoint(h){const R=a.tR.DistanceSquared(this.centerWorld,h);return!(this.radiusWorld*this.radiusWorld<R)}static Intersects(h,R){const l=a.tR.DistanceSquared(h.centerWorld,R.centerWorld),j=h.radiusWorld+R.radiusWorld;return!(j*j<l)}static CreateFromCenterAndRadius(h,R,l){this._TmpVector3[0].D(h),this._TmpVector3[1].OF(0,0,R),this._TmpVector3[2].D(h),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Pc(this._TmpVector3[1]);const j=new D(this._TmpVector3[0],this._TmpVector3[2]);return j._worldMatrix=l||a.Matrix.Identity(),j}}D._TmpVector3=(0,j.e)(3,a.tR.Zero)},13226:(h,R,l)=>{function j(h){-1===h.indexOf("vClipPlane")&&h.push("vClipPlane"),-1===h.indexOf("vClipPlane2")&&h.push("vClipPlane2"),-1===h.indexOf("vClipPlane3")&&h.push("vClipPlane3"),-1===h.indexOf("vClipPlane4")&&h.push("vClipPlane4"),-1===h.indexOf("vClipPlane5")&&h.push("vClipPlane5"),-1===h.indexOf("vClipPlane6")&&h.push("vClipPlane6")}function a(h,R,l){const j=!!(h.clipPlane??R.clipPlane),a=!!(h.clipPlane2??R.clipPlane2),D=!!(h.clipPlane3??R.clipPlane3),U=!!(h.clipPlane4??R.clipPlane4),F=!!(h.clipPlane5??R.clipPlane5),w=!!(h.clipPlane6??R.clipPlane6);j&&l.push("#define CLIPPLANE"),a&&l.push("#define CLIPPLANE2"),D&&l.push("#define CLIPPLANE3"),U&&l.push("#define CLIPPLANE4"),F&&l.push("#define CLIPPLANE5"),w&&l.push("#define CLIPPLANE6")}function D(h,R,l){let j=!1;const a=!!(h.clipPlane??R.clipPlane),D=!!(h.clipPlane2??R.clipPlane2),U=!!(h.clipPlane3??R.clipPlane3),F=!!(h.clipPlane4??R.clipPlane4),w=!!(h.clipPlane5??R.clipPlane5),mh=!!(h.clipPlane6??R.clipPlane6);return l.CLIPPLANE!==a&&(l.CLIPPLANE=a,j=!0),l.CLIPPLANE2!==D&&(l.CLIPPLANE2=D,j=!0),l.CLIPPLANE3!==U&&(l.CLIPPLANE3=U,j=!0),l.CLIPPLANE4!==F&&(l.CLIPPLANE4=F,j=!0),l.CLIPPLANE5!==w&&(l.CLIPPLANE5=w,j=!0),l.CLIPPLANE6!==mh&&(l.CLIPPLANE6=mh,j=!0),j}function U(h,R,l){let j=R.clipPlane??l.clipPlane;F(h,"vClipPlane",j),j=R.clipPlane2??l.clipPlane2,F(h,"vClipPlane2",j),j=R.clipPlane3??l.clipPlane3,F(h,"vClipPlane3",j),j=R.clipPlane4??l.clipPlane4,F(h,"vClipPlane4",j),j=R.clipPlane5??l.clipPlane5,F(h,"vClipPlane5",j),j=R.clipPlane6??l.clipPlane6,F(h,"vClipPlane6",j)}function F(h,R,l){l&&h.setFloat4(R,l.normal.x,l.normal.y,l.normal.z,l.d)}l.d(R,{d:()=>j,f:()=>U,j:()=>D,m:()=>a})},13175:(h,R,l)=>{l.d(R,{d:()=>j});class j{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(h,R){this._defines[h]||(h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h),this._defines[h]=new Array),this._defines[h].push(R)}addCPUSkinningFallback(h,R){this._mesh=R,h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(h,R){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,h=h.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),R._bonesComputationForcedToCPU=!0;const l=this._mesh.yh();for(let h=0;h<l.meshes.length;h++){const j=l.meshes[h];if(j.material){if(j.computeBonesUsingShaders&&0!==j.numBoneInfluencers)if(j.material.getEffect()===R)j.computeBonesUsingShaders=!1;else if(j.YF)for(const h of j.YF){if(h.effect===R){j.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&j.computeBonesUsingShaders&&j.numBoneInfluencers>0&&(j.computeBonesUsingShaders=!1)}}else{const R=this._defines[this._currentRank];if(R)for(let l=0;l<R.length;l++)h=h.replace("#define "+R[l],"");this._currentRank++}return h}}},13179:(h,R,l)=>{l.d(R,{e:()=>s});var j=l(12882),a=l(12887),D=l(12689),U=l(12696),F=l(12749),w=l(13181),mh=l(13145),u=l(12711),c=l(12960),J=l(13016),q=l(12942);class Q{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(h){this._func=h}get funcRef(){return this._funcRef}set funcRef(h){this._funcRef=h}get funcMask(){return this._funcMask}set funcMask(h){this._funcMask=h}get opStencilFail(){return this._opStencilFail}set opStencilFail(h){this._opStencilFail=h}get opDepthFail(){return this._opDepthFail}set opDepthFail(h){this._opDepthFail=h}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(h){this._opStencilDepthPass=h}get mask(){return this._mask}set mask(h){this._mask=h}get enabled(){return this._enabled}set enabled(h){this._enabled=h}getClassName(){return"MaterialStencilState"}copyTo(h){q.c.Clone((()=>h),this)}serialize(){return q.c.Serialize(this)}parse(h,R,l){q.c.Parse((()=>this),h,R,l)}}(0,j.e)([(0,a.G)()],Q.prototype,"func",null),(0,j.e)([(0,a.G)()],Q.prototype,"funcRef",null),(0,j.e)([(0,a.G)()],Q.prototype,"funcMask",null),(0,j.e)([(0,a.G)()],Q.prototype,"opStencilFail",null),(0,j.e)([(0,a.G)()],Q.prototype,"opDepthFail",null),(0,j.e)([(0,a.G)()],Q.prototype,"opStencilDepthPass",null),(0,j.e)([(0,a.G)()],Q.prototype,"mask",null),(0,j.e)([(0,a.G)()],Q.prototype,"enabled",null);var Y=l(13219);class s{get _supportGlowLayer(){return!1}set _glowModeEnabled(h){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(h){if(this._alpha===h)return;const R=this._alpha;this._alpha=h,1!==R&&1!==h||this.Vm(s.MiscDirtyFlag+s.PrePassDirtyFlag)}get alpha(){return this._alpha}set pF(h){this._backFaceCulling!==h&&(this._backFaceCulling=h,this.Vm(s.TextureDirtyFlag))}get pF(){return this._backFaceCulling}set cullBackFaces(h){this._cullBackFaces!==h&&(this._cullBackFaces=h,this.Vm(s.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(h){this._blockDirtyMechanism!==h&&(this._blockDirtyMechanism=h,h||this.oJ())}atomicMaterialsUpdate(h){this.blockDirtyMechanism=!0;try{h(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(h){this._onDisposeObserver&&this.mw.remove(this._onDisposeObserver),this._onDisposeObserver=this.mw.add(h)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new U.d),this._onBindObservable}set onBind(h){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(h)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new U.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new U.d),this._onEffectCreatedObservable}set alphaMode(h){this._alphaMode!==h&&(this._alphaMode=h,this.Vm(s.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(h){this._needDepthPrePass!==h&&(this._needDepthPrePass=h,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(h){this._fogEnabled!==h&&(this._fogEnabled=h,this.Vm(s.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case s.WireFrameFillMode:case s.LineListDrawMode:case s.LineLoopDrawMode:case s.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(h){this.fillMode=h?s.WireFrameFillMode:s.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case s.PointFillMode:case s.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(h){this.fillMode=h?s.PointFillMode:s.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(h){this._fillMode!==h&&(this._fillMode=h,this.Vm(s.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){const R=this.yh().getEngine().getCaps().fragmentDepthSupported;h&&!R&&u.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=h&&R,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(h){this._drawWrapper=h}constructor(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.mw=new U.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.uF=new Q,this._useUBO=!1,this._fillMode=s.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=h;const a=R||F.b.LastCreatedScene;a&&(this._scene=a,this._dirtyCallbacks={},this._forceGLSL=j,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=h||D.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new J.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new mh.e(this._scene.getEngine(),void 0,void 0,h),this._useUBO=this.yh().getEngine().supportsUniformBuffers,this._createUniformBuffer(),l||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),s.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var h;const R=this.yh().getEngine();null===(h=this._uniformBuffer)||void 0===h||h.dispose(),R.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new mh.e(R,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new mh.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(h){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.oJ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.oJ(),this.checkReadyOnlyOnce=!1}isReady(h,R){return!0}isReadyForSubMesh(h,R,l){const j=R.materialDefines;return!!j&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=j,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}yh(){return this._scene}_getEffectiveOrientation(h){return null!==this.sideOrientation?this.sideOrientation:h.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(h){this._transparencyMode!==h&&(this._transparencyMode=h,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===s.MATERIAL_ALPHABLEND||this._transparencyMode===s.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===s.MATERIAL_ALPHATEST||this._transparencyMode===s.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===s.MATERIAL_OPAQUE||this._transparencyMode===s.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsBlend:h.visibility<1||!this._disableAlphaBlending&&(h.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(h)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}oJ(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const R=this.yh().meshes;for(const l of R)if(l.YF)for(const R of l.YF)if(R.Hh()===this)for(const l of R._drawWrappers)l&&this._materialContext===l.materialContext&&(l._wasPreviouslyReady=!1,l._wasPreviouslyUsingInstances=null,l._forceRebindOnNextCall=h);h&&this.Vm(s.AllDirtyFlag)}_preBind(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this._scene.getEngine(),j=(null==R?this.sideOrientation:R)===s.ClockWiseSideOrientation;return l.enableEffect(h||this._getDrawWrapper()),l.setState(this.pF,this.zOffset,!1,j,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.uF,this.zOffsetUnits),j}bind(h,R){}buildUniformLayout(){const h=this._uniformBuffer;this._eventInfo.ubo=h,this._callbackPluginEventGeneric(8,this._eventInfo),h.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(h,R,l){const j=l._drawWrapper;this._eventInfo.subMesh=l,this._callbackPluginEventBindForSubMesh(this._eventInfo),j._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(h){}bindView(h){this._useUBO?this._needToBindSceneUbo=!0:h.setMatrix("view",this.yh().getViewMatrix())}bindViewProjection(h){this._useUBO?this._needToBindSceneUbo=!0:(h.setMatrix("viewProjection",this.yh().getTransformMatrix()),h.setMatrix("projection",this.yh().getProjectionMatrix()))}bindEyePosition(h,R){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(h,R)}_afterBind(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&R&&(this._needToBindSceneUbo=!1,(0,Y.r)(R,this.yh().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=h?h.visibility:1,this._onBindObservable&&h&&this._onBindObservable.notifyObservers(h),this.disableDepthWrite){const h=this._scene.getEngine();this._cachedDepthWriteState=h.getDepthWrite(),h.setDepthWrite(!1)}if(this.disableColorWrite){const h=this._scene.getEngine();this._cachedColorWriteState=h.getColorWrite(),h.setColorWrite(!1)}if(0!==this.depthFunction){const h=this._scene.getEngine();this._cachedDepthFunctionState=h.getDepthFunction()||0,h.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(h){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=h,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(h){return null}_clonePlugins(h,R){const l={};if(this._serializePlugins(l),s._ParsePlugins(l,h,this._scene,R),this.pluginManager)for(const j of this.pluginManager._plugins){const R=h.pluginManager.getPlugin(j.name);R&&j.copyTo(R)}}getBindedMeshes(){if(this.meshMap){const h=[];for(const R in this.meshMap){const l=this.meshMap[R];l&&h.push(l)}return h}return this._scene.meshes.filter((h=>h.material===this))}forceCompilation(h,R,l,j){const a={clipPlane:!1,useInstances:!1,...l},D=this.yh(),U=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const F=()=>{if(!this._scene||!this._scene.getEngine())return;const l=D.clipPlane;if(a.clipPlane&&(D.clipPlane=new c.d(0,0,0,1)),this._storeEffectOnSubMeshes){let l=!0,D=null;if(h.YF){const R=new w.d(0,0,0,0,0,h,void 0,!1,!1);R.materialDefines&&(R.materialDefines._renderId=-1),this.isReadyForSubMesh(h,R,a.useInstances)||(R.effect&&R.effect.getCompilationError()&&R.effect.allFallbacksProcessed()?D=R.effect.getCompilationError():(l=!1,setTimeout(F,16)))}l&&(this.allowShaderHotSwapping=U,D&&j&&j(D),R&&R(this))}else this.isReady()?(this.allowShaderHotSwapping=U,R&&R(this)):setTimeout(F,16);a.clipPlane&&(D.clipPlane=l)};F()}async forceCompilationAsync(h,R){return await new Promise(((l,j)=>{this.forceCompilation(h,(()=>{l()}),R,(h=>{j(h)}))}))}Vm(h){this.yh().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(s._DirtyCallbackArray.length=0,h&s.ImageProcessingDirtyFlag&&s._DirtyCallbackArray.push(s._ImageProcessingDirtyCallBack),h&s.TextureDirtyFlag&&s._DirtyCallbackArray.push(s._TextureDirtyCallBack),h&s.LightDirtyFlag&&s._DirtyCallbackArray.push(s._LightsDirtyCallBack),h&s.FresnelDirtyFlag&&s._DirtyCallbackArray.push(s._FresnelDirtyCallBack),h&s.AttributesDirtyFlag&&s._DirtyCallbackArray.push(s._AttributeDirtyCallBack),h&s.MiscDirtyFlag&&s._DirtyCallbackArray.push(s._MiscDirtyCallBack),h&s.PrePassDirtyFlag&&s._DirtyCallbackArray.push(s._PrePassDirtyCallBack),s._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(s._RunDirtyCallBacks),this.yh().resetCachedMaterial())}resetDrawCache(){const h=this.yh().meshes;for(const R of h)if(R.YF)for(const h of R.YF)h.Hh()===this&&h.resetDrawCache()}_markAllSubMeshesAsDirty(h){const R=this.yh();if(R.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const l=R.meshes;for(const j of l)if(j.YF)for(const l of j.YF){if((l.Hh()||(R._hasDefaultMaterial?R.defaultMaterial:null))===this)for(const R of l._drawWrappers)R&&R.defines&&R.defines.markAllAsDirty&&this._materialContext===R.materialContext&&h(R.defines)}}_markScenePrePassDirty(){if(this.yh().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const h=this.yh().enablePrePassRenderer();h&&h.Vm()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(s._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(s._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(s._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(s._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(s._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(s._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(s._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(s._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(s._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(s._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const h=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.mw.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(h)}))}}setPrePassRenderer(h){return!1}dispose(h,R,l){const j=this.yh();if(j.stopAnimation(this),j.freeProcessedMaterials(),j.removeMaterial(this),this._eventInfo.forceDisposeTextures=R,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const h=this._parentContainer.materials.indexOf(this);h>-1&&this._parentContainer.materials.splice(h,1),this._parentContainer=null}if(!0!==l)if(this.meshMap)for(const a in this.meshMap){const h=this.meshMap[a];this._disposeMeshResources(h)}else{const h=j.meshes;for(const R of h)this._disposeMeshResources(R)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.mw.notifyObservers(this),this.mw.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(h){if(!h)return;const R=h.xF,l=h._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(h.YF&&l)for(const a of h.YF){const h=a._drawWrappers;for(let D=0;D<h.length;D++){var j;const U=null===(j=h[D])||void 0===j?void 0:j.effect;if(!U)continue;l[D]===this&&(null===R||void 0===R||R._releaseVertexArrayObject(U),a._removeDrawWrapper(D,!0,!0))}}}else null===R||void 0===R||R._releaseVertexArrayObject(this._drawWrapper.effect);h.material!==this||h.sourceMesh||(h.material=null)}serialize(){const h=q.c.Serialize(this);return h.uF=this.uF.serialize(),h.uniqueId=this.uniqueId,this._serializePlugins(h),h}_serializePlugins(h){if(h.plugins={},this.pluginManager)for(const R of this.pluginManager._plugins)R.doNotSerialize||(h.plugins[R.getClassName()]=R.serialize())}static Parse(h,R,l){if(h.customType){if("BABYLON.PBRMaterial"===h.customType&&h.overloadedAlbedo&&(h.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return u.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else h.customType="BABYLON.StandardMaterial";const j=D.Tools.Instantiate(h.customType).Parse(h,R,l);return j._loadedUniqueId=h.uniqueId,j}static _ParsePlugins(h,R,l,j){if(h.plugins)for(const F in h.plugins){var a,U;const w=h.plugins[F];let mh=null===(a=R.pluginManager)||void 0===a?void 0:a.getPlugin(w.name);if(!mh){const h=D.Tools.Instantiate("BABYLON."+F);h&&(mh=new h(R))}null===(U=mh)||void 0===U||U.parse(w,l,j)}}}s.TriangleFillMode=0,s.WireFrameFillMode=1,s.PointFillMode=2,s.PointListDrawMode=3,s.LineListDrawMode=4,s.LineLoopDrawMode=5,s.LineStripDrawMode=6,s.TriangleStripDrawMode=7,s.TriangleFanDrawMode=8,s.ClockWiseSideOrientation=0,s.CounterClockWiseSideOrientation=1,s.ImageProcessingDirtyFlag=64,s.TextureDirtyFlag=1,s.LightDirtyFlag=2,s.FresnelDirtyFlag=4,s.AttributesDirtyFlag=8,s.MiscDirtyFlag=16,s.PrePassDirtyFlag=32,s.AllDirtyFlag=127,s.MATERIAL_OPAQUE=0,s.MATERIAL_ALPHATEST=1,s.MATERIAL_ALPHABLEND=2,s.MATERIAL_ALPHATESTANDBLEND=3,s.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,s.MATERIAL_NORMALBLENDMETHOD_RNM=1,s.OnEventObservable=new U.d,s._AllDirtyCallBack=h=>h.markAllAsDirty(),s._ImageProcessingDirtyCallBack=h=>h.markAsImageProcessingDirty(),s._TextureDirtyCallBack=h=>h.markAsTexturesDirty(),s._FresnelDirtyCallBack=h=>h.markAsFresnelDirty(),s._MiscDirtyCallBack=h=>h.markAsMiscDirty(),s._PrePassDirtyCallBack=h=>h.markAsPrePassDirty(),s._LightsDirtyCallBack=h=>h.markAsLightDirty(),s._AttributeDirtyCallBack=h=>h.markAsAttributesDirty(),s._FresnelAndMiscDirtyCallBack=h=>{s._FresnelDirtyCallBack(h),s._MiscDirtyCallBack(h)},s._TextureAndMiscDirtyCallBack=h=>{s._TextureDirtyCallBack(h),s._MiscDirtyCallBack(h)},s._DirtyCallbackArray=[],s._RunDirtyCallBacks=h=>{for(const R of s._DirtyCallbackArray)R(h)},(0,j.e)([(0,a.G)()],s.prototype,"id",void 0),(0,j.e)([(0,a.G)()],s.prototype,"uniqueId",void 0),(0,j.e)([(0,a.G)()],s.prototype,"name",void 0),(0,j.e)([(0,a.G)()],s.prototype,"metadata",void 0),(0,j.e)([(0,a.G)()],s.prototype,"checkReadyOnEveryCall",void 0),(0,j.e)([(0,a.G)()],s.prototype,"checkReadyOnlyOnce",void 0),(0,j.e)([(0,a.G)()],s.prototype,"state",void 0),(0,j.e)([(0,a.G)("alpha")],s.prototype,"_alpha",void 0),(0,j.e)([(0,a.G)("pF")],s.prototype,"_backFaceCulling",void 0),(0,j.e)([(0,a.G)("cullBackFaces")],s.prototype,"_cullBackFaces",void 0),(0,j.e)([(0,a.G)()],s.prototype,"sideOrientation",void 0),(0,j.e)([(0,a.G)("alphaMode")],s.prototype,"_alphaMode",void 0),(0,j.e)([(0,a.G)()],s.prototype,"_needDepthPrePass",void 0),(0,j.e)([(0,a.G)()],s.prototype,"disableDepthWrite",void 0),(0,j.e)([(0,a.G)()],s.prototype,"disableColorWrite",void 0),(0,j.e)([(0,a.G)()],s.prototype,"forceDepthWrite",void 0),(0,j.e)([(0,a.G)()],s.prototype,"depthFunction",void 0),(0,j.e)([(0,a.G)()],s.prototype,"separateCullingPass",void 0),(0,j.e)([(0,a.G)("fogEnabled")],s.prototype,"_fogEnabled",void 0),(0,j.e)([(0,a.G)()],s.prototype,"pointSize",void 0),(0,j.e)([(0,a.G)()],s.prototype,"zOffset",void 0),(0,j.e)([(0,a.G)()],s.prototype,"zOffsetUnits",void 0),(0,j.e)([(0,a.G)()],s.prototype,"pointsCloud",null),(0,j.e)([(0,a.G)()],s.prototype,"fillMode",null),(0,j.e)([(0,a.G)()],s.prototype,"useLogarithmicDepth",null),(0,j.e)([(0,a.G)()],s.prototype,"transparencyMode",null)},13219:(h,R,l)=>{l.d(R,{A:()=>p,B:()=>O,F:()=>q,H:()=>J,K:()=>n,L:()=>L,P:()=>b,R:()=>t,U:()=>v,X:()=>r,Z:()=>P,bb:()=>z,d:()=>E,db:()=>K,eb:()=>Q,g:()=>c,k:()=>G,m:()=>u,p:()=>Y,r:()=>s,t:()=>f,x:()=>y,z:()=>T});var j=l(12711),a=l(12952),D=l(12749),U=l(13173),F=l(13226);const w=a.xR.Black(),mh={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function u(h,R,l){if(!h||h.LOGARITHMICDEPTH||h.indexOf&&h.indexOf("LOGARITHMICDEPTH")>=0){const h=l.activeCamera;1===h.mode&&j.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),R.setFloat("logarithmicDepthConstant",2/(Math.log(h.maxZ+1)/Math.LN2))}}function c(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];l&&h.fogEnabled&&(!R||R.applyFog)&&0!==h.fogMode&&(l.setFloat4("vFogInfos",h.fogMode,h.fogStart,h.fogEnd,h.fogDensity),j?(h.fogColor.toLinearSpaceToRef(w,h.getEngine().useExactSrgbConversions),l.setColor3("vFogColor",w)):l.setColor3("vFogColor",h.fogColor))}function J(h,R,l,j,a,D,U,F,w,u){const c=h.numMaxInfluencers||h.numInfluencers;return c<=0?0:(R.push("#define MORPHTARGETS"),h.hasPositions&&R.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),h.hasNormals&&R.push("#define MORPHTARGETTEXTURE_HASNORMALS"),h.hasTangents&&R.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),h.hasUVs&&R.push("#define MORPHTARGETTEXTURE_HASUVS"),h.hasUV2s&&R.push("#define MORPHTARGETTEXTURE_HASUV2S"),h.hasColors&&R.push("#define MORPHTARGETTEXTURE_HASCOLORS"),h.supportsPositions&&a&&R.push("#define MORPHTARGETS_POSITION"),h.supportsNormals&&D&&R.push("#define MORPHTARGETS_NORMAL"),h.supportsTangents&&U&&R.push("#define MORPHTARGETS_TANGENT"),h.supportsUVs&&F&&R.push("#define MORPHTARGETS_UV"),h.supportsUV2s&&w&&R.push("#define MORPHTARGETS_UV2"),h.supportsColors&&u&&R.push("#define MORPHTARGETS_COLOR"),R.push("#define NUM_MORPH_INFLUENCERS "+c),h.isUsingTextureForTargets&&R.push("#define MORPHTARGETS_TEXTURE"),mh.NUM_MORPH_INFLUENCERS=c,mh.NORMAL=D,mh.TANGENT=U,mh.UV=F,mh.UV2=w,mh.COLOR=u,q(l,j,mh,a),c)}function q(h,R,l){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=l.NUM_MORPH_INFLUENCERS;if(U>0&&D.b.LastCreatedEngine){const F=D.b.LastCreatedEngine.getCaps().maxVertexAttribs,w=R.morphTargetManager;if(null!==w&&void 0!==w&&w.isUsingTextureForTargets)return;const mh=w&&w.supportsPositions&&a,u=w&&w.supportsNormals&&l.NORMAL,c=w&&w.supportsTangents&&l.TANGENT,J=w&&w.supportsUVs&&l.UV1,q=w&&w.supportsUV2s&&l.UV2,Q=w&&w.supportsColors&&l.VERTEXCOLOR;for(let l=0;l<U;l++)mh&&h.push("position"+l),u&&h.push("normal"+l),c&&h.push("tangent"+l),J&&h.push("uv_"+l),q&&h.push("uv2_"+l),Q&&h.push("color"+l),h.length>F&&j.c.Error("Cannot add more vertex attributes for mesh "+R.name)}}function Q(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"),R&&(h.push("previousWorld0"),h.push("previousWorld1"),h.push("previousWorld2"),h.push("previousWorld3"))}function Y(h,R){const l=h.morphTargetManager;h&&l&&R.setFloatArray("morphTargetInfluences",l.influences)}function s(h,R){R.bindToEffect(h,"Scene")}function t(h,R,l){R._needUVs=!0,R[l]=!0,h.optimizeUVAllocation&&h.getTextureMatrix().isIdentityAs3x2()?(R[l+"DIRECTUV"]=h.coordinatesIndex+1,R["MAINUV"+(h.coordinatesIndex+1)]=!0):R[l+"DIRECTUV"]=0}function f(h,R,l){const j=h.getTextureMatrix();R.TF(l+"Matrix",j)}function T(h,R,l){l.BAKED_VERTEX_ANIMATION_TEXTURE&&l.INSTANCES&&h.push("bakedVertexAnimationSettingsInstanced")}function E(h,R,l){var j;if(R&&h&&(h.computeBonesUsingShaders&&R._bonesComputationForcedToCPU&&(h.computeBonesUsingShaders=!1),h.useBones&&h.computeBonesUsingShaders&&h.skeleton)){const a=h.skeleton;if(a.isUsingTextureForMatrices&&R.getUniformIndex("boneTextureWidth")>-1){const l=a.getTransformMatrixTexture(h);R.setTexture("boneSampler",l),R.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{const D=a.getTransformMatrices(h);D&&(R.setMatrices("mBones",D),l&&h.yh().prePassRenderer&&h.yh().prePassRenderer.getIndex(2)&&(l.previousBones[h.uniqueId]||(l.previousBones[h.uniqueId]=D.slice()),R.setMatrices("mPreviousBones",l.previousBones[h.uniqueId]),j=D,l.previousBones[h.uniqueId].set(j)))}}}function x(h,R,l,j,a){let D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];h._bindLight(R,l,j,a,D)}function G(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const D=Math.min(R.lightSources.length,a);for(let U=0;U<D;U++){x(R.lightSources[U],U,h,l,"boolean"===typeof j?j:j.SPECULARTERM,R.receiveShadows)}}function p(h,R,l,j){l.NUM_BONE_INFLUENCERS>0&&(j.addCPUSkinningFallback(0,R),h.push("matricesIndices"),h.push("matricesWeights"),l.NUM_BONE_INFLUENCERS>4&&(h.push("matricesIndicesExtra"),h.push("matricesWeightsExtra")))}function O(h,R){(R.INSTANCES||R.THIN_INSTANCES)&&Q(h,!!R.PREPASS_VELOCITY),R.INSTANCESCOLOR&&h.push("instanceColor")}function y(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=0;for(let D=0;D<l&&h["LIGHT"+D];D++)D>0&&(a=j+D,R.addFallback(a,"LIGHT"+D)),h.SHADOWS||(h["SHADOW"+D]&&R.addFallback(j,"SHADOW"+D),h["SHADOWPCF"+D]&&R.addFallback(j,"SHADOWPCF"+D),h["SHADOWPCSS"+D]&&R.addFallback(j,"SHADOWPCSS"+D),h["SHADOWPOISSON"+D]&&R.addFallback(j,"SHADOWPOISSON"+D),h["SHADOWESM"+D]&&R.addFallback(j,"SHADOWESM"+D),h["SHADOWCLOSEESM"+D]&&R.addFallback(j,"SHADOWCLOSEESM"+D));return a++}function v(h,R,l,j,a,D,U){let F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];U._areMiscDirty&&(U.LOGARITHMICDEPTH=l,U.POINTSIZE=j,U.FOG=a&&function(h,R){return R.fogEnabled&&h.applyFog&&0!==R.fogMode}(h,R),U.NONUNIFORMSCALING=h.nonUniformScaling,U.ALPHATEST=D,U.DECAL_AFTER_DETAIL=F)}function b(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!l._areLightsDirty)return l._needNormals;let U=0;const F={needNormals:l._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(h.lightsEnabled&&!D)for(const mh of R.lightSources)if(I(h,R,mh,U,l,j,F),U++,U===a)break;l.SPECULARTERM=F.specularEnabled,l.SHADOWS=F.shadowEnabled;for(let mh=U;mh<a;mh++)void 0!==l["LIGHT"+mh]&&(l["LIGHT"+mh]=!1,l["HEMILIGHT"+mh]=!1,l["POINTLIGHT"+mh]=!1,l["DIRLIGHT"+mh]=!1,l["SPOTLIGHT"+mh]=!1,l["AREALIGHT"+mh]=!1,l["SHADOW"+mh]=!1,l["SHADOWCSM"+mh]=!1,l["SHADOWCSMDEBUG"+mh]=!1,l["SHADOWCSMNUM_CASCADES"+mh]=!1,l["SHADOWCSMUSESHADOWMAXZ"+mh]=!1,l["SHADOWCSMNOBLEND"+mh]=!1,l["SHADOWCSM_RIGHTHANDED"+mh]=!1,l["SHADOWPCF"+mh]=!1,l["SHADOWPCSS"+mh]=!1,l["SHADOWPOISSON"+mh]=!1,l["SHADOWESM"+mh]=!1,l["SHADOWCLOSEESM"+mh]=!1,l["SHADOWCUBE"+mh]=!1,l["SHADOWLOWQUALITY"+mh]=!1,l["SHADOWMEDIUMQUALITY"+mh]=!1);const w=h.getEngine().getCaps();return void 0===l.SHADOWFLOAT&&(F.needRebuild=!0),l.SHADOWFLOAT=F.shadowEnabled&&(w.textureFloatRender&&w.textureFloatLinearFiltering||w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering),l.LIGHTMAPEXCLUDED=F.lightmapMode,F.needRebuild&&l.rebuild(),F.needNormals}function I(h,R,l,j,a,D,F){switch(F.needNormals=!0,void 0===a["LIGHT"+j]&&(F.needRebuild=!0),a["LIGHT"+j]=!0,a["SPOTLIGHT"+j]=!1,a["HEMILIGHT"+j]=!1,a["POINTLIGHT"+j]=!1,a["DIRLIGHT"+j]=!1,a["AREALIGHT"+j]=!1,l.prepareLightSpecificDefines(a,j),a["LIGHT_FALLOFF_PHYSICAL"+j]=!1,a["LIGHT_FALLOFF_GLTF"+j]=!1,a["LIGHT_FALLOFF_STANDARD"+j]=!1,l.falloffType){case U.c.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+j]=!0;break;case U.c.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+j]=!0;break;case U.c.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+j]=!0}if(D&&!l.Tu.equalsFloats(0,0,0)&&(F.specularEnabled=!0),a["SHADOW"+j]=!1,a["SHADOWCSM"+j]=!1,a["SHADOWCSMDEBUG"+j]=!1,a["SHADOWCSMNUM_CASCADES"+j]=!1,a["SHADOWCSMUSESHADOWMAXZ"+j]=!1,a["SHADOWCSMNOBLEND"+j]=!1,a["SHADOWCSM_RIGHTHANDED"+j]=!1,a["SHADOWPCF"+j]=!1,a["SHADOWPCSS"+j]=!1,a["SHADOWPOISSON"+j]=!1,a["SHADOWESM"+j]=!1,a["SHADOWCLOSEESM"+j]=!1,a["SHADOWCUBE"+j]=!1,a["SHADOWLOWQUALITY"+j]=!1,a["SHADOWMEDIUMQUALITY"+j]=!1,R&&R.receiveShadows&&h.shadowsEnabled&&l.shadowEnabled){const R=l.getShadowGenerator(h.activeCamera)??l.getShadowGenerator();if(R){const h=R.getShadowMap();h&&h.renderList&&h.renderList.length>0&&(F.shadowEnabled=!0,R.prepareDefines(a,j))}}l.lightmapMode!=U.c.LIGHTMAP_DEFAULT?(F.lightmapMode=!0,a["LIGHTMAPEXCLUDED"+j]=!0,a["LIGHTMAPNOSPECULAR"+j]=l.lightmapMode==U.c.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+j]=!1,a["LIGHTMAPNOSPECULAR"+j]=!1)}function L(h,R,l,j,a){let D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=function(h,R){let l=!1;if(h.activeCamera){const j=R.CAMERA_ORTHOGRAPHIC?1:0,a=R.CAMERA_PERSPECTIVE?1:0,D=1===h.activeCamera.mode?1:0,U=0===h.activeCamera.mode?1:0;(j^D||a^U)&&(R.CAMERA_ORTHOGRAPHIC=1===D,R.CAMERA_PERSPECTIVE=1===U,l=!0)}return l}(h,j);!1!==D&&(w=(0,F.j)(l,h,j)),j.DEPTHPREPASS!==!R.getColorWrite()&&(j.DEPTHPREPASS=!j.DEPTHPREPASS,w=!0),j.INSTANCES!==a&&(j.INSTANCES=a,w=!0),j.THIN_INSTANCES!==U&&(j.THIN_INSTANCES=U,w=!0),w&&j.markAsUnprocessed()}function n(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],U=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!R._areAttributesDirty&&R._needNormals===R._normals&&R._needUVs===R._uvs)return!1;R._normals=R._needNormals,R._uvs=R._needUVs,R.NORMAL=R._needNormals&&h.isVerticesDataPresent("normal"),R._needNormals&&h.isVerticesDataPresent("tangent")&&(R.TANGENT=!0);for(let F=1;F<=6;++F)R["UV"+F]=!!R._needUVs&&h.isVerticesDataPresent(`uv${1===F?"":F}`);if(l){const l=h.useVertexColors&&h.isVerticesDataPresent("color");R.VERTEXCOLOR=l,R.VERTEXALPHA=h.hasVertexAlpha&&l&&D}return h.isVerticesDataPresent("instanceColor")&&(h.hasInstances||h.hasThinInstances)&&(R.INSTANCESCOLOR=!0),j&&function(h,R){if(h.useBones&&h.computeBonesUsingShaders&&h.skeleton){R.NUM_BONE_INFLUENCERS=h.numBoneInfluencers;const l=void 0!==R.BONETEXTURE;if(h.skeleton.isUsingTextureForMatrices&&l)R.BONETEXTURE=!0;else{R.BonesPerMesh=h.skeleton.bones.length+1,R.BONETEXTURE=!l&&void 0;const j=h.yh().prePassRenderer;if(j&&j.enabled){const l=-1===j.excludedSkinnedMesh.indexOf(h);R.BONES_VELOCITY_ENABLED=l}}}else R.NUM_BONE_INFLUENCERS=0,R.BonesPerMesh=0,void 0!==R.BONETEXTURE&&(R.BONETEXTURE=!1)}(h,R),a&&function(h,R){const l=h.morphTargetManager;l?(R.MORPHTARGETS_UV=l.supportsUVs&&R.UV1,R.MORPHTARGETS_UV2=l.supportsUV2s&&R.UV2,R.MORPHTARGETS_TANGENT=l.supportsTangents&&R.TANGENT,R.MORPHTARGETS_NORMAL=l.supportsNormals&&R.NORMAL,R.MORPHTARGETS_POSITION=l.supportsPositions,R.MORPHTARGETS_COLOR=l.supportsColors,R.MORPHTARGETTEXTURE_HASUVS=l.hasUVs,R.MORPHTARGETTEXTURE_HASUV2S=l.hasUV2s,R.MORPHTARGETTEXTURE_HASTANGENTS=l.hasTangents,R.MORPHTARGETTEXTURE_HASNORMALS=l.hasNormals,R.MORPHTARGETTEXTURE_HASPOSITIONS=l.hasPositions,R.MORPHTARGETTEXTURE_HASCOLORS=l.hasColors,R.NUM_MORPH_INFLUENCERS=l.numMaxInfluencers||l.numInfluencers,R.MORPHTARGETS=R.NUM_MORPH_INFLUENCERS>0,R.MORPHTARGETS_TEXTURE=l.isUsingTextureForTargets):(R.MORPHTARGETS_UV=!1,R.MORPHTARGETS_UV2=!1,R.MORPHTARGETS_TANGENT=!1,R.MORPHTARGETS_NORMAL=!1,R.MORPHTARGETS_POSITION=!1,R.MORPHTARGETS_COLOR=!1,R.MORPHTARGETTEXTURE_HASUVS=!1,R.MORPHTARGETTEXTURE_HASUV2S=!1,R.MORPHTARGETTEXTURE_HASTANGENTS=!1,R.MORPHTARGETTEXTURE_HASNORMALS=!1,R.MORPHTARGETTEXTURE_HASPOSITIONS=!1,R.MORPHTARGETTEXTURE_HAS_COLORS=!1,R.MORPHTARGETS=!1,R.NUM_MORPH_INFLUENCERS=0)}(h,R),U&&function(h,R){const l=h.bakedVertexAnimationManager;R.BAKED_VERTEX_ANIMATION_TEXTURE=!(!l||!l.isEnabled)}(h,R),!0}function r(h,R){if(h.activeCamera){const l=R.MULTIVIEW;R.MULTIVIEW=null!==h.activeCamera.outputRenderTarget&&h.activeCamera.outputRenderTarget.getViewCount()>1,R.MULTIVIEW!=l&&R.markAsUnprocessed()}}function P(h,R,l){const j=R.ORDER_INDEPENDENT_TRANSPARENCY,a=R.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;R.ORDER_INDEPENDENT_TRANSPARENCY=h.useOrderIndependentTransparency&&l,R.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!h.getEngine().getCaps().textureFloatLinearFiltering,j===R.ORDER_INDEPENDENT_TRANSPARENCY&&a===R.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||R.markAsUnprocessed()}function z(h,R,l){const j=R.PREPASS;if(!R._arePrePassDirty)return;const a=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(h.prePassRenderer&&h.prePassRenderer.enabled&&l){R.PREPASS=!0,R.SCENE_MRT_COUNT=h.prePassRenderer.mrtCount,R.PREPASS_NORMAL_WORLDSPACE=h.prePassRenderer.generateNormalsInWorldSpace,R.PREPASS_COLOR=!0,R.PREPASS_COLOR_INDEX=0;for(let l=0;l<a.length;l++){const j=h.prePassRenderer.getIndex(a[l].type);-1!==j?(R[a[l].define]=!0,R[a[l].index]=j):R[a[l].define]=!1}}else{R.PREPASS=!1;for(let h=0;h<a.length;h++)R[a[h].define]=!1}R.PREPASS!=j&&(R.markAsUnprocessed(),R.markAsImageProcessingDirty())}function o(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];a&&a.push("Light"+h),D||(R.push("vLightData"+h,"vLightDiffuse"+h,"vLightSpecular"+h,"vLightDirection"+h,"vLightWidth"+h,"vLightHeight"+h,"vLightFalloff"+h,"vLightGround"+h,"lightMatrix"+h,"shadowsInfo"+h,"depthValues"+h),l.push("shadowTexture"+h),l.push("depthTexture"+h),R.push("viewFrustumZ"+h,"cascadeBlendFactor"+h,"lightSizeUVCorrection"+h,"depthCorrection"+h,"penumbraDarkness"+h,"frustumLengths"+h),j&&(l.push("projectionLightTexture"+h),R.push("textureProjectionMatrix"+h)),U&&l.push("iesLightTexture"+h))}function K(h,R,l){let j,a,D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(h.uniformsNames){const U=h;j=U.uniformsNames,a=U.uniformBuffersNames,R=U.samplers,l=U.defines,D=U.maxSimultaneousLights||0}else j=h,R||(R=[]);for(let U=0;U<D&&l["LIGHT"+U];U++)o(U,j,R,l["PROJECTEDLIGHTTEXTURE"+U],a,!1,l["IESLIGHTTEXTURE"+U]);l.NUM_MORPH_INFLUENCERS&&(j.push("morphTargetInfluences"),j.push("morphTargetCount")),l.BAKED_VERTEX_ANIMATION_TEXTURE&&(j.push("bakedVertexAnimationSettings"),j.push("bakedVertexAnimationTextureSizeInverted"),j.push("bakedVertexAnimationTime"),R.push("bakedVertexAnimationTexture"))}},13177:(h,R,l)=>{l.d(R,{d:()=>D});var j=l(12900),a=l(13179);class D extends a.e{constructor(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(h,R,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new j.Matrix,this._storeEffectOnSubMeshes=l}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(h,R){return!!h&&(!this._storeEffectOnSubMeshes||(!h.YF||0===h.YF.length||this.isReadyForSubMesh(h,h.YF[0],R)))}_isReadyForSubMesh(h){const R=h.materialDefines;return!(this.checkReadyOnEveryCall||!h.effect||!R||R._renderId!==this.yh().getRenderId())}bindOnlyWorldMatrix(h){this._activeEffect.setMatrix("world",h)}bindOnlyNormalMatrix(h){this._activeEffect.setMatrix("normalMatrix",h)}bind(h,R){R&&this.bindForSubMesh(h,R,R.YF[0])}_afterBind(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;super._afterBind(h,R,l),this.yh()._cachedEffect=R,l?l._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return l._drawWrapper._forceRebindOnNextCall||h.isCachedMaterialInvalid(this,R,j)}dispose(h,R,l){this._activeEffect=void 0,super.dispose(h,R,l)}}},13215:(h,R,l)=>{l.d(R,{b:()=>F,c:()=>w});var j=l(12882),a=l(12900),D=l(12887);class U{static extractMinAndMaxIndexed(h,R,l,j,a,D){for(let U=l;U<l+j;U++){const l=3*R[U],j=h[l],F=h[l+1],w=h[l+2];a.minimizeInPlaceFromFloats(j,F,w),D.maximizeInPlaceFromFloats(j,F,w)}}static extractMinAndMax(h,R,l,j,a,D){for(let U=R,F=R*j;U<R+l;U++,F+=j){const R=h[F],l=h[F+1],j=h[F+2];a.minimizeInPlaceFromFloats(R,l,j),D.maximizeInPlaceFromFloats(R,l,j)}}}function F(h,R,l,j){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=new a.tR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new a.tR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return U.extractMinAndMaxIndexed(h,R,l,j,F,w),D&&(F.x-=F.x*D.x+D.y,F.y-=F.y*D.x+D.y,F.z-=F.z*D.x+D.y,w.x+=w.x*D.x+D.y,w.y+=w.y*D.x+D.y,w.z+=w.z*D.x+D.y),{minimum:F,maximum:w}}function w(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4?arguments[4]:void 0;const F=new a.tR(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new a.tR(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return D||(D=3),U.extractMinAndMax(h,R,l,D,F,w),j&&(F.x-=F.x*j.x+j.y,F.y-=F.y*j.x+j.y,F.z-=F.z*j.x+j.y,w.x+=w.x*j.x+j.y,w.y+=w.y*j.x+j.y,w.z+=w.z*j.x+j.y),{minimum:F,maximum:w}}(0,j.e)([D.d.filter((function(){for(var h=arguments.length,R=new Array(h),l=0;l<h;l++)R[l]=arguments[l];let[j,a]=R;return!Array.isArray(j)&&!Array.isArray(a)}))],U,"extractMinAndMaxIndexed",null),(0,j.e)([D.d.filter((function(){for(var h=arguments.length,R=new Array(h),l=0;l<h;l++)R[l]=arguments[l];let[j]=R;return!Array.isArray(j)}))],U,"extractMinAndMax",null)},13181:(h,R,l)=>{l.d(R,{d:()=>w});var j=l(12984),a=l(13186),D=l(13195),U=l(13215),F=l(13016);class w{get materialDefines(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(h=this._getDrawWrapper())||void 0===h?void 0:h.defines}set materialDefines(h){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=h}_getDrawWrapper(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h??this._engine.currentRenderPassId;let l=this._drawWrappers[h];return!l&&R&&(this._drawWrappers[h]=l=new F.c(this._mesh.yh().getEngine())),l}_removeDrawWrapper(h){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var l;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(l=this._drawWrappers[h])||void 0===l||l.dispose(R));this._drawWrappers[h]=void 0}get effect(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(h=this._getDrawWrapper())||void 0===h?void 0:h.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(h){this._mainDrawWrapperOverride=h}setEffect(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=this._drawWrapper;a.setEffect(h,R,j),void 0!==l&&(a.materialContext=l),h||(a.defines=null,a.materialContext=void 0)}resetDrawCache(h){let R=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==h)return void this._removeDrawWrapper(h,!0,R);for(const h of this._drawWrappers)null===h||void 0===h||h.dispose(R)}this._drawWrappers=[]}static AddToMesh(h,R,l,j,a,D,U){return new w(h,R,l,j,a,D,U,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(h,R,l,j,a,D,U){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],w=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=h,this.verticesStart=R,this.verticesCount=l,this.indexStart=j,this.indexCount=a,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=D,this._renderingMesh=U||D,w&&D.YF.push(this),this._engine=this._mesh.yh().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=D.YF.length-1,F&&(this.refreshBoundingInfo(),D.EF(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(h){return this._boundingInfo=h,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const h=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return h||this._renderingMesh}Hh(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const R=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!R)return h&&this._mesh.yh()._hasDefaultMaterial?this._mesh.yh().defaultMaterial:null;if(this._isMultiMaterial(R)){const h=R.getSubMaterial(this.materialIndex);return this._currentMaterial!==h&&(this._currentMaterial=h,this.resetDrawCache()),h}return R}_isMultiMaterial(h){return void 0!==h.getSubMaterial}refreshBoundingInfo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.xF)return this;if(h||(h=this._renderingMesh.getVerticesData(j.g.PositionKind)),!h)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const R=this._renderingMesh.GF();let l;if(0===this.indexStart&&this.indexCount===R.length){const h=this._renderingMesh.getBoundingInfo();l={minimum:h.minimum.clone(),maximum:h.maximum.clone()}}else l=(0,U.b)(h,R,this.indexStart,this.indexCount,this._renderingMesh.xF.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(l.minimum,l.maximum):this._boundingInfo=new D.e(l.minimum,l.maximum),this}_checkCollision(h){return this.getBoundingInfo()._checkCollision(h)}updateBoundingInfo(h){let R=this.getBoundingInfo();return R||(this.refreshBoundingInfo(),R=this.getBoundingInfo()),R&&R.update(h),this}isInFrustum(h){const R=this.getBoundingInfo();return!!R&&R.isInFrustum(h,this._mesh.FJ)}isCompletelyInFrustum(h){const R=this.getBoundingInfo();return!!R&&R.isCompletelyInFrustum(h)}render(h){return this._renderingMesh.render(this,h,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(h,R){if(!this._linesIndexBuffer){const l=6*Math.floor(this.indexCount/3),j=this.verticesStart+this.verticesCount>65535?new Uint32Array(l):new Uint16Array(l);let a=0;if(0===h.length)for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=3)j[a++]=h,j[a++]=h+1,j[a++]=h+1,j[a++]=h+2,j[a++]=h+2,j[a++]=h;else for(let R=this.indexStart;R<this.indexStart+this.indexCount;R+=3)j[a++]=h[R],j[a++]=h[R+1],j[a++]=h[R+1],j[a++]=h[R+2],j[a++]=h[R+2],j[a++]=h[R];this._linesIndexBuffer=R.createIndexBuffer(j),this._linesIndexCount=j.length}return this._linesIndexBuffer}canIntersects(h){const R=this.getBoundingInfo();return!!R&&h.intersectsBox(R.boundingBox)}intersects(h,R,l,j,a){const D=this.Hh();if(!D)return null;let U=3,F=!1;switch(D.fillMode){case 3:case 5:case 6:case 8:return null;case 7:U=1,F=!0}return 4===D.fillMode?l.length?this._intersectLines(h,R,l,this._mesh.intersectionThreshold,j):this._intersectUnIndexedLines(h,R,l,this._mesh.intersectionThreshold,j):!l.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(h,R,l,j,a):this._intersectTriangles(h,R,l,U,F,j,a)}_intersectLines(h,R,l,j,D){let U=null;for(let F=this.indexStart;F<this.indexStart+this.indexCount;F+=2){const w=R[l[F]],mh=R[l[F+1]],u=h.intersectionSegment(w,mh,j);if(!(u<0)&&((D||!U||u<U.distance)&&(U=new a.b(null,null,u),U.faceId=F/2,D)))break}return U}_intersectUnIndexedLines(h,R,l,j,D){let U=null;for(let F=this.verticesStart;F<this.verticesStart+this.verticesCount;F+=2){const l=R[F],w=R[F+1],mh=h.intersectionSegment(l,w,j);if(!(mh<0)&&((D||!U||mh<U.distance)&&(U=new a.b(null,null,mh),U.faceId=F/2,D)))break}return U}_intersectTriangles(h,R,l,j,a,D,U){let F=null,w=-1;for(let mh=this.indexStart;mh<this.indexStart+this.indexCount-(3-j);mh+=j){w++;const j=l[mh],u=l[mh+1],c=l[mh+2];if(a&&4294967295===c){mh+=2;continue}const J=R[j],q=R[u],Q=R[c];if(!J||!q||!Q)continue;if(U&&!U(J,q,Q,h,j,u,c))continue;const Y=h.intersectsTriangle(J,q,Q);if(Y){if(Y.distance<0)continue;if((D||!F||Y.distance<F.distance)&&(F=Y,F.faceId=w,D))break}}return F}_intersectUnIndexedTriangles(h,R,l,j,a){let D=null;for(let U=this.verticesStart;U<this.verticesStart+this.verticesCount;U+=3){const l=R[U],F=R[U+1],w=R[U+2];if(a&&!a(l,F,w,h,-1,-1,-1))continue;const mh=h.intersectsTriangle(l,F,w);if(mh){if(mh.distance<0)continue;if((j||!D||mh.distance<D.distance)&&(D=mh,D.faceId=U/3,j))break}}return D}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(h,R){const l=new w(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,h,R,!1);if(!this.IsGlobal){const h=this.getBoundingInfo();if(!h)return l;l._boundingInfo=new D.e(h.minimum,h.maximum)}return l}dispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.yh().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const R=this._mesh.YF.indexOf(this);this._mesh.YF.splice(R,1),this.resetDrawCache(void 0,h)}getClassName(){return"SubMesh"}static CreateFromIndices(h,R,l,j,a){let D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],U=Number.MAX_VALUE,F=-Number.MAX_VALUE;const mh=(a||j).GF();for(let w=R;w<R+l;w++){const h=mh[w];h<U&&(U=h),h>F&&(F=h)}return new w(h,U,F-U+1,R,l,j,a,D)}}}}]);