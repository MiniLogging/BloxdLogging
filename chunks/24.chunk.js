"use strict";(self["2fwzcez286e"]=self["2fwzcez286e"]||[]).push([[24],{13315:(B,u,F)=>{F.d(u,{e:()=>Z});class Z{constructor(B,u,F){this.bu=B,this.bv=u,this.distance=F,this.faceId=0,this.subMeshId=0}}},13325:(B,u,F)=>{F.d(u,{d:()=>G});var Z=F(12985),V=F(12979),p=F(12982);class G{constructor(B,u,F){this.vectors=(0,Z.e)(8,V.Du.Zero),this.center=V.Du.Zero(),this.centerWorld=V.Du.Zero(),this.extendSize=V.Du.Zero(),this.extendSizeWorld=V.Du.Zero(),this.directions=(0,Z.e)(3,V.Du.Zero),this.vectorsWorld=(0,Z.e)(8,V.Du.Zero),this.minimumWorld=V.Du.Zero(),this.maximumWorld=V.Du.Zero(),this.minimum=V.Du.Zero(),this.maximum=V.Du.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(B,u,F)}reConstruct(B,u,F){const Z=B.x,p=B.y,G=B.z,R=u.x,e=u.y,s=u.z,Y=this.vectors;this.minimum.UR(Z,p,G),this.maximum.UR(R,e,s),Y[0].UR(Z,p,G),Y[1].UR(R,e,s),Y[2].UR(R,p,G),Y[3].UR(Z,e,G),Y[4].UR(Z,p,s),Y[5].UR(R,e,G),Y[6].UR(Z,e,s),Y[7].UR(R,p,s),u.addToRef(B,this.center).scaleInPlace(.5),u.subtractToRef(B,this.extendSize).scaleInPlace(.5),this._worldMatrix=F||V.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(B){const u=G._TmpVector3,F=this.maximum.subtractToRef(this.minimum,u[0]),Z=F.length();F.normalizeFromLength(Z);const V=Z*B,p=F.scaleInPlace(.5*V),R=this.center.subtractToRef(p,u[1]),e=this.center.addToRef(p,u[2]);return this.reConstruct(R,e,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(B){const u=this.minimumWorld,F=this.maximumWorld,Z=this.directions,p=this.vectorsWorld,G=this.vectors;if(B.isIdentity()){u.Z(this.minimum),F.Z(this.maximum);for(let B=0;B<8;++B)p[B].Z(G[B]);this.extendSizeWorld.Z(this.extendSize),this.centerWorld.Z(this.center)}else{u.OR(Number.MAX_VALUE),F.OR(-Number.MAX_VALUE);for(let Z=0;Z<8;++Z){const R=p[Z];V.Du.TransformCoordinatesToRef(G[Z],B,R),u.minimizeInPlace(R),F.maximizeInPlace(R)}F.subtractToRef(u,this.extendSizeWorld).scaleInPlace(.5),F.addToRef(u,this.centerWorld).scaleInPlace(.5)}V.Du.FromArrayToRef(B.m,0,Z[0]),V.Du.FromArrayToRef(B.m,4,Z[1]),V.Du.FromArrayToRef(B.m,8,Z[2]),this._worldMatrix=B}isInFrustum(B){return G.IsInFrustum(this.vectorsWorld,B)}isCompletelyInFrustum(B){return G.IsCompletelyInFrustum(this.vectorsWorld,B)}intersectsPoint(B){const u=this.minimumWorld,F=this.maximumWorld,Z=u.x,V=u.y,G=u.z,R=F.x,e=F.y,s=F.z,Y=B.x,Q=B.y,t=B.z,v=-p.e;return!(R-Y<v||v>Y-Z)&&(!(e-Q<v||v>Q-V)&&!(s-t<v||v>t-G))}intersectsSphere(B){return G.IntersectsSphere(this.minimumWorld,this.maximumWorld,B.centerWorld,B.radiusWorld)}intersectsMinMax(B,u){const F=this.minimumWorld,Z=this.maximumWorld,V=F.x,p=F.y,G=F.z,R=Z.x,e=Z.y,s=Z.z,Y=B.x,Q=B.y,t=B.z,v=u.x,D=u.y,L=u.z;return!(R<Y||V>v)&&(!(e<Q||p>D)&&!(s<t||G>L))}dispose(){var B,u;null===(B=this._drawWrapperFront)||void 0===B||B.dispose(),null===(u=this._drawWrapperBack)||void 0===u||u.dispose()}static Intersects(B,u){return B.intersectsMinMax(u.minimumWorld,u.maximumWorld)}static IntersectsSphere(B,u,F,Z){const p=G._TmpVector3[0];V.Du.ClampToRef(F,B,u,p);return V.Du.DistanceSquared(F,p)<=Z*Z}static IsCompletelyInFrustum(B,u){for(let F=0;F<6;++F){const Z=u[F];for(let u=0;u<8;++u)if(Z.dotCoordinate(B[u])<0)return!1}return!0}static IsInFrustum(B,u){for(let F=0;F<6;++F){let Z=!0;const V=u[F];for(let u=0;u<8;++u)if(V.dotCoordinate(B[u])>=0){Z=!1;break}if(Z)return!1}return!0}}G._TmpVector3=(0,Z.e)(3,V.Du.Zero)},13318:(B,u,F)=>{F.d(u,{b:()=>Q});var Z=F(12985),V=F(12979),p=F(13325),G=F(13333);const R={min:0,max:0},e={min:0,max:0},s=(B,u,F)=>{const Z=V.Du.Dot(u.centerWorld,B),p=Math.abs(V.Du.Dot(u.directions[0],B))*u.extendSize.x+Math.abs(V.Du.Dot(u.directions[1],B))*u.extendSize.y+Math.abs(V.Du.Dot(u.directions[2],B))*u.extendSize.z;F.min=Z-p,F.max=Z+p},Y=(B,u,F)=>(s(B,u,R),s(B,F,e),!(R.min>e.max||e.min>R.max));class Q{constructor(B,u,F){this._isLocked=!1,this.boundingBox=new p.d(B,u,F),this.boundingSphere=new G.b(B,u,F)}reConstruct(B,u,F){this.boundingBox.reConstruct(B,u,F),this.boundingSphere.reConstruct(B,u,F)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(B){this._isLocked=B}update(B){this._isLocked||(this.boundingBox._update(B),this.boundingSphere._update(B))}centerOn(B,u){const F=Q._TmpVector3[0].Z(B).yQ(u),Z=Q._TmpVector3[1].Z(B).addInPlace(u);return this.boundingBox.reConstruct(F,Z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(F,Z,this.boundingBox.getWorldMatrix()),this}encapsulate(B){const u=V.Du.Minimize(this.minimum,B),F=V.Du.Maximize(this.maximum,B);return this.reConstruct(u,F,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(B){const u=V.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(u);const F=V.TmpVectors.Du[0];return V.Du.TransformCoordinatesToRef(B.boundingBox.minimumWorld,u,F),this.encapsulate(F),V.Du.TransformCoordinatesToRef(B.boundingBox.maximumWorld,u,F),this.encapsulate(F),this}scale(B){return this.boundingBox.scale(B),this.boundingSphere.scale(B),this}isInFrustum(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===u||3===u)&&this.boundingSphere.isCenterInFrustum(B))return!0;if(!this.boundingSphere.isInFrustum(B))return!1;return!(1!==u&&3!==u)||this.boundingBox.isInFrustum(B)}get diagonalLength(){const B=this.boundingBox;return B.maximumWorld.subtractToRef(B.minimumWorld,Q._TmpVector3[0]).length()}isCompletelyInFrustum(B){return this.boundingBox.isCompletelyInFrustum(B)}_checkCollision(B){return B._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(B){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(B)&&!!this.boundingBox.intersectsPoint(B))}intersects(B,u){if(!G.b.Intersects(this.boundingSphere,B.boundingSphere))return!1;if(!p.d.Intersects(this.boundingBox,B.boundingBox))return!1;if(!u)return!0;const F=this.boundingBox,Z=B.boundingBox;return!!Y(F.directions[0],F,Z)&&(!!Y(F.directions[1],F,Z)&&(!!Y(F.directions[2],F,Z)&&(!!Y(Z.directions[0],F,Z)&&(!!Y(Z.directions[1],F,Z)&&(!!Y(Z.directions[2],F,Z)&&(!!Y(V.Du.Cross(F.directions[0],Z.directions[0]),F,Z)&&(!!Y(V.Du.Cross(F.directions[0],Z.directions[1]),F,Z)&&(!!Y(V.Du.Cross(F.directions[0],Z.directions[2]),F,Z)&&(!!Y(V.Du.Cross(F.directions[1],Z.directions[0]),F,Z)&&(!!Y(V.Du.Cross(F.directions[1],Z.directions[1]),F,Z)&&(!!Y(V.Du.Cross(F.directions[1],Z.directions[2]),F,Z)&&(!!Y(V.Du.Cross(F.directions[2],Z.directions[0]),F,Z)&&(!!Y(V.Du.Cross(F.directions[2],Z.directions[1]),F,Z)&&!!Y(V.Du.Cross(F.directions[2],Z.directions[2]),F,Z))))))))))))))}}Q._TmpVector3=(0,Z.e)(2,V.Du.Zero)},13333:(B,u,F)=>{F.d(u,{b:()=>p});var Z=F(12985),V=F(12979);class p{constructor(B,u,F){this.center=V.Du.Zero(),this.centerWorld=V.Du.Zero(),this.minimum=V.Du.Zero(),this.maximum=V.Du.Zero(),this.reConstruct(B,u,F)}reConstruct(B,u,F){this.minimum.Z(B),this.maximum.Z(u);const Z=V.Du.Distance(B,u);u.addToRef(B,this.center).scaleInPlace(.5),this.radius=.5*Z,this._update(F||V.Matrix.IdentityReadOnly)}scale(B){const u=this.radius*B,F=p._TmpVector3,Z=F[0].OR(u),V=this.center.subtractToRef(Z,F[1]),G=this.center.addToRef(Z,F[2]);return this.reConstruct(V,G,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(B){if(B.isIdentity())this.centerWorld.Z(this.center),this.radiusWorld=this.radius;else{V.Du.TransformCoordinatesToRef(this.center,B,this.centerWorld);const u=p._TmpVector3[0];V.Du.TransformNormalFromFloatsToRef(1,1,1,B,u),this.radiusWorld=Math.max(Math.abs(u.x),Math.abs(u.y),Math.abs(u.z))*this.radius}}isInFrustum(B){const u=this.centerWorld,F=this.radiusWorld;for(let Z=0;Z<6;Z++)if(B[Z].dotCoordinate(u)<=-F)return!1;return!0}isCenterInFrustum(B){const u=this.centerWorld;for(let F=0;F<6;F++)if(B[F].dotCoordinate(u)<0)return!1;return!0}intersectsPoint(B){const u=V.Du.DistanceSquared(this.centerWorld,B);return!(this.radiusWorld*this.radiusWorld<u)}static Intersects(B,u){const F=V.Du.DistanceSquared(B.centerWorld,u.centerWorld),Z=B.radiusWorld+u.radiusWorld;return!(Z*Z<F)}static CreateFromCenterAndRadius(B,u,F){this._TmpVector3[0].Z(B),this._TmpVector3[1].UR(0,0,u),this._TmpVector3[2].Z(B),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].yQ(this._TmpVector3[1]);const Z=new p(this._TmpVector3[0],this._TmpVector3[2]);return Z._worldMatrix=F||V.Matrix.Identity(),Z}}p._TmpVector3=(0,Z.e)(3,V.Du.Zero)},13352:(B,u,F)=>{function Z(B){-1===B.indexOf("vClipPlane")&&B.push("vClipPlane"),-1===B.indexOf("vClipPlane2")&&B.push("vClipPlane2"),-1===B.indexOf("vClipPlane3")&&B.push("vClipPlane3"),-1===B.indexOf("vClipPlane4")&&B.push("vClipPlane4"),-1===B.indexOf("vClipPlane5")&&B.push("vClipPlane5"),-1===B.indexOf("vClipPlane6")&&B.push("vClipPlane6")}function V(B,u,F){const Z=!!(B.clipPlane??u.clipPlane),V=!!(B.clipPlane2??u.clipPlane2),p=!!(B.clipPlane3??u.clipPlane3),G=!!(B.clipPlane4??u.clipPlane4),R=!!(B.clipPlane5??u.clipPlane5),e=!!(B.clipPlane6??u.clipPlane6);Z&&F.push("#define CLIPPLANE"),V&&F.push("#define CLIPPLANE2"),p&&F.push("#define CLIPPLANE3"),G&&F.push("#define CLIPPLANE4"),R&&F.push("#define CLIPPLANE5"),e&&F.push("#define CLIPPLANE6")}function p(B,u,F){let Z=!1;const V=!!(B.clipPlane??u.clipPlane),p=!!(B.clipPlane2??u.clipPlane2),G=!!(B.clipPlane3??u.clipPlane3),R=!!(B.clipPlane4??u.clipPlane4),e=!!(B.clipPlane5??u.clipPlane5),s=!!(B.clipPlane6??u.clipPlane6);return F.CLIPPLANE!==V&&(F.CLIPPLANE=V,Z=!0),F.CLIPPLANE2!==p&&(F.CLIPPLANE2=p,Z=!0),F.CLIPPLANE3!==G&&(F.CLIPPLANE3=G,Z=!0),F.CLIPPLANE4!==R&&(F.CLIPPLANE4=R,Z=!0),F.CLIPPLANE5!==e&&(F.CLIPPLANE5=e,Z=!0),F.CLIPPLANE6!==s&&(F.CLIPPLANE6=s,Z=!0),Z}function G(B,u,F){let Z=u.clipPlane??F.clipPlane;R(B,"vClipPlane",Z),Z=u.clipPlane2??F.clipPlane2,R(B,"vClipPlane2",Z),Z=u.clipPlane3??F.clipPlane3,R(B,"vClipPlane3",Z),Z=u.clipPlane4??F.clipPlane4,R(B,"vClipPlane4",Z),Z=u.clipPlane5??F.clipPlane5,R(B,"vClipPlane5",Z),Z=u.clipPlane6??F.clipPlane6,R(B,"vClipPlane6",Z)}function R(B,u,F){F&&B.setFloat4(u,F.normal.x,F.normal.y,F.normal.z,F.d)}F.d(u,{c:()=>Z,g:()=>G,j:()=>p,k:()=>V})},13291:(B,u,F)=>{F.d(u,{c:()=>Z});class Z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(B,u){this._defines[B]||(B<this._currentRank&&(this._currentRank=B),B>this._maxRank&&(this._maxRank=B),this._defines[B]=new Array),this._defines[B].push(u)}addCPUSkinningFallback(B,u){this._mesh=u,B<this._currentRank&&(this._currentRank=B),B>this._maxRank&&(this._maxRank=B)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(B,u){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,B=B.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),u._bonesComputationForcedToCPU=!0;const F=this._mesh.yB();for(let B=0;B<F.meshes.length;B++){const Z=F.meshes[B];if(Z.material){if(Z.computeBonesUsingShaders&&0!==Z.numBoneInfluencers)if(Z.material.getEffect()===u)Z.computeBonesUsingShaders=!1;else if(Z.vR)for(const B of Z.vR){if(B.effect===u){Z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&Z.computeBonesUsingShaders&&Z.numBoneInfluencers>0&&(Z.computeBonesUsingShaders=!1)}}else{const u=this._defines[this._currentRank];if(u)for(let F=0;F<u.length;F++)B=B.replace("#define "+u[F],"");this._currentRank++}return B}}},13299:(B,u,F)=>{F.d(u,{c:()=>q});var Z=F(12971),V=F(12973),p=F(12802),G=F(12807),R=F(12855),e=F(13306),s=F(13243),Y=F(12822),Q=F(13029),t=F(13094),v=F(13014);class D{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(B){this._func=B}get funcRef(){return this._funcRef}set funcRef(B){this._funcRef=B}get funcMask(){return this._funcMask}set funcMask(B){this._funcMask=B}get opStencilFail(){return this._opStencilFail}set opStencilFail(B){this._opStencilFail=B}get opDepthFail(){return this._opDepthFail}set opDepthFail(B){this._opDepthFail=B}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(B){this._opStencilDepthPass=B}get mask(){return this._mask}set mask(B){this._mask=B}get enabled(){return this._enabled}set enabled(B){this._enabled=B}getClassName(){return"MaterialStencilState"}copyTo(B){v.c.Clone((()=>B),this)}serialize(){return v.c.Serialize(this)}parse(B,u,F){v.c.Parse((()=>this),B,u,F)}}(0,Z.d)([(0,V.L)()],D.prototype,"func",null),(0,Z.d)([(0,V.L)()],D.prototype,"funcRef",null),(0,Z.d)([(0,V.L)()],D.prototype,"funcMask",null),(0,Z.d)([(0,V.L)()],D.prototype,"opStencilFail",null),(0,Z.d)([(0,V.L)()],D.prototype,"opDepthFail",null),(0,Z.d)([(0,V.L)()],D.prototype,"opStencilDepthPass",null),(0,Z.d)([(0,V.L)()],D.prototype,"mask",null),(0,Z.d)([(0,V.L)()],D.prototype,"enabled",null);var L=F(13349);class q{get _supportGlowLayer(){return!1}set _glowModeEnabled(B){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(B){if(this._alpha===B)return;const u=this._alpha;this._alpha=B,1!==u&&1!==B||this.vY(q.MiscDirtyFlag+q.PrePassDirtyFlag)}get alpha(){return this._alpha}set xR(B){this._backFaceCulling!==B&&(this._backFaceCulling=B,this.vY(q.TextureDirtyFlag))}get xR(){return this._backFaceCulling}set cullBackFaces(B){this._cullBackFaces!==B&&(this._cullBackFaces=B,this.vY(q.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(B){this._blockDirtyMechanism!==B&&(this._blockDirtyMechanism=B,B||this.tt())}atomicMaterialsUpdate(B){this.blockDirtyMechanism=!0;try{B(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(B){this._onDisposeObserver&&this.GR.remove(this._onDisposeObserver),this._onDisposeObserver=this.GR.add(B)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new G.b),this._onBindObservable}set onBind(B){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(B)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new G.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new G.b),this._onEffectCreatedObservable}set alphaMode(B){this._alphaMode!==B&&(this._alphaMode=B,this.vY(q.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(B){this._needDepthPrePass!==B&&(this._needDepthPrePass=B,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(B){this._fogEnabled!==B&&(this._fogEnabled=B,this.vY(q.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case q.WireFrameFillMode:case q.LineListDrawMode:case q.LineLoopDrawMode:case q.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(B){this.fillMode=B?q.WireFrameFillMode:q.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case q.PointFillMode:case q.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(B){this.fillMode=B?q.PointFillMode:q.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(B){this._fillMode!==B&&(this._fillMode=B,this.vY(q.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(B){const u=this.yB().getEngine().getCaps().fragmentDepthSupported;B&&!u&&Y.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=B&&u,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(B){this._drawWrapper=B}constructor(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.GR=new G.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.RR=new D,this._useUBO=!1,this._fillMode=q.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=B;const V=u||R.b.LastCreatedScene;V&&(this._scene=V,this._dirtyCallbacks={},this._forceGLSL=Z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=B||p.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new t.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new s.d(this._scene.getEngine(),void 0,void 0,B),this._useUBO=this.yB().getEngine().supportsUniformBuffers,this._createUniformBuffer(),F||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),q.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var B;const u=this.yB().getEngine();null===(B=this._uniformBuffer)||void 0===B||B.dispose(),u.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new s.d(u,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new s.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(B){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.tt(),this.checkReadyOnlyOnce=!0}unfreeze(){this.tt(),this.checkReadyOnlyOnce=!1}isReady(B,u){return!0}isReadyForSubMesh(B,u,F){const Z=u.materialDefines;return!!Z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}yB(){return this._scene}_getEffectiveOrientation(B){return null!==this.sideOrientation?this.sideOrientation:B.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(B){this._transparencyMode!==B&&(this._transparencyMode=B,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===q.MATERIAL_ALPHABLEND||this._transparencyMode===q.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===q.MATERIAL_ALPHATEST||this._transparencyMode===q.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===q.MATERIAL_OPAQUE||this._transparencyMode===q.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(B){return this._hasTransparencyMode?this._transparencyModeIsBlend:B.visibility<1||!this._disableAlphaBlending&&(B.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(B){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(B)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}tt(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.yB().meshes;for(const F of u)if(F.vR)for(const u of F.vR)if(u.EB()===this)for(const F of u._drawWrappers)F&&this._materialContext===F.materialContext&&(F._wasPreviouslyReady=!1,F._wasPreviouslyUsingInstances=null,F._forceRebindOnNextCall=B);B&&this.vY(q.AllDirtyFlag)}_preBind(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this._scene.getEngine(),Z=(null==u?this.sideOrientation:u)===q.ClockWiseSideOrientation;return F.enableEffect(B||this._getDrawWrapper()),F.setState(this.xR,this.zOffset,!1,Z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.RR,this.zOffsetUnits),Z}bind(B,u){}buildUniformLayout(){const B=this._uniformBuffer;this._eventInfo.ubo=B,this._callbackPluginEventGeneric(8,this._eventInfo),B.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(B,u,F){const Z=F._drawWrapper;this._eventInfo.subMesh=F,this._callbackPluginEventBindForSubMesh(this._eventInfo),Z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(B){}bindView(B){this._useUBO?this._needToBindSceneUbo=!0:B.setMatrix("view",this.yB().getViewMatrix())}bindViewProjection(B){this._useUBO?this._needToBindSceneUbo=!0:(B.setMatrix("viewProjection",this.yB().getTransformMatrix()),B.setMatrix("projection",this.yB().getProjectionMatrix()))}bindEyePosition(B,u){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(B,u)}_afterBind(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&u&&(this._needToBindSceneUbo=!1,(0,L.l)(u,this.yB().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=B?B.visibility:1,this._onBindObservable&&B&&this._onBindObservable.notifyObservers(B),this.disableDepthWrite){const B=this._scene.getEngine();this._cachedDepthWriteState=B.getDepthWrite(),B.setDepthWrite(!1)}if(this.disableColorWrite){const B=this._scene.getEngine();this._cachedColorWriteState=B.getColorWrite(),B.setColorWrite(!1)}if(0!==this.depthFunction){const B=this._scene.getEngine();this._cachedDepthFunctionState=B.getDepthFunction()||0,B.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(B){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=B,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(B){return null}_clonePlugins(B,u){const F={};if(this._serializePlugins(F),q._ParsePlugins(F,B,this._scene,u),this.pluginManager)for(const Z of this.pluginManager._plugins){const u=B.pluginManager.getPlugin(Z.name);u&&Z.copyTo(u)}}getBindedMeshes(){if(this.meshMap){const B=[];for(const u in this.meshMap){const F=this.meshMap[u];F&&B.push(F)}return B}return this._scene.meshes.filter((B=>B.material===this))}forceCompilation(B,u,F,Z){const V={clipPlane:!1,useInstances:!1,...F},p=this.yB(),G=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const R=()=>{if(!this._scene||!this._scene.getEngine())return;const F=p.clipPlane;if(V.clipPlane&&(p.clipPlane=new Q.b(0,0,0,1)),this._storeEffectOnSubMeshes){let F=!0,p=null;if(B.vR){const u=new e.b(0,0,0,0,0,B,void 0,!1,!1);u.materialDefines&&(u.materialDefines._renderId=-1),this.isReadyForSubMesh(B,u,V.useInstances)||(u.effect&&u.effect.getCompilationError()&&u.effect.allFallbacksProcessed()?p=u.effect.getCompilationError():(F=!1,setTimeout(R,16)))}F&&(this.allowShaderHotSwapping=G,p&&Z&&Z(p),u&&u(this))}else this.isReady()?(this.allowShaderHotSwapping=G,u&&u(this)):setTimeout(R,16);V.clipPlane&&(p.clipPlane=F)};R()}async forceCompilationAsync(B,u){return await new Promise(((F,Z)=>{this.forceCompilation(B,(()=>{F()}),u,(B=>{Z(B)}))}))}vY(B){this.yB().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(q._DirtyCallbackArray.length=0,B&q.ImageProcessingDirtyFlag&&q._DirtyCallbackArray.push(q._ImageProcessingDirtyCallBack),B&q.TextureDirtyFlag&&q._DirtyCallbackArray.push(q._TextureDirtyCallBack),B&q.LightDirtyFlag&&q._DirtyCallbackArray.push(q._LightsDirtyCallBack),B&q.FresnelDirtyFlag&&q._DirtyCallbackArray.push(q._FresnelDirtyCallBack),B&q.AttributesDirtyFlag&&q._DirtyCallbackArray.push(q._AttributeDirtyCallBack),B&q.MiscDirtyFlag&&q._DirtyCallbackArray.push(q._MiscDirtyCallBack),B&q.PrePassDirtyFlag&&q._DirtyCallbackArray.push(q._PrePassDirtyCallBack),q._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(q._RunDirtyCallBacks),this.yB().resetCachedMaterial())}resetDrawCache(){const B=this.yB().meshes;for(const u of B)if(u.vR)for(const B of u.vR)B.EB()===this&&B.resetDrawCache()}_markAllSubMeshesAsDirty(B){const u=this.yB();if(u.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const F=u.meshes;for(const Z of F)if(Z.vR)for(const F of Z.vR){if((F.EB()||(u._hasDefaultMaterial?u.defaultMaterial:null))===this)for(const u of F._drawWrappers)u&&u.defines&&u.defines.markAllAsDirty&&this._materialContext===u.materialContext&&B(u.defines)}}_markScenePrePassDirty(){if(this.yB().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const B=this.yB().enablePrePassRenderer();B&&B.vY()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(q._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(q._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(q._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(q._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(q._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(q._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(q._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(q._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(q._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(q._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const B=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.GR.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(B)}))}}setPrePassRenderer(B){return!1}dispose(B,u,F){const Z=this.yB();if(Z.stopAnimation(this),Z.freeProcessedMaterials(),Z.removeMaterial(this),this._eventInfo.forceDisposeTextures=u,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const B=this._parentContainer.materials.indexOf(this);B>-1&&this._parentContainer.materials.splice(B,1),this._parentContainer=null}if(!0!==F)if(this.meshMap)for(const V in this.meshMap){const B=this.meshMap[V];this._disposeMeshResources(B)}else{const B=Z.meshes;for(const u of B)this._disposeMeshResources(u)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.GR.notifyObservers(this),this.GR.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(B){if(!B)return;const u=B.fR,F=B._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(B.vR&&F)for(const V of B.vR){const B=V._drawWrappers;for(let p=0;p<B.length;p++){var Z;const G=null===(Z=B[p])||void 0===Z?void 0:Z.effect;if(!G)continue;F[p]===this&&(null===u||void 0===u||u._releaseVertexArrayObject(G),V._removeDrawWrapper(p,!0,!0))}}}else null===u||void 0===u||u._releaseVertexArrayObject(this._drawWrapper.effect);B.material!==this||B.sourceMesh||(B.material=null)}serialize(){const B=v.c.Serialize(this);return B.RR=this.RR.serialize(),B.uniqueId=this.uniqueId,this._serializePlugins(B),B}_serializePlugins(B){if(B.plugins={},this.pluginManager)for(const u of this.pluginManager._plugins)u.doNotSerialize||(B.plugins[u.getClassName()]=u.serialize())}static Parse(B,u,F){if(B.customType){if("BABYLON.PBRMaterial"===B.customType&&B.overloadedAlbedo&&(B.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Y.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else B.customType="BABYLON.StandardMaterial";const Z=p.Tools.Instantiate(B.customType).Parse(B,u,F);return Z._loadedUniqueId=B.uniqueId,Z}static _ParsePlugins(B,u,F,Z){if(B.plugins)for(const R in B.plugins){var V,G;const e=B.plugins[R];let s=null===(V=u.pluginManager)||void 0===V?void 0:V.getPlugin(e.name);if(!s){const B=p.Tools.Instantiate("BABYLON."+R);B&&(s=new B(u))}null===(G=s)||void 0===G||G.parse(e,F,Z)}}}q.TriangleFillMode=0,q.WireFrameFillMode=1,q.PointFillMode=2,q.PointListDrawMode=3,q.LineListDrawMode=4,q.LineLoopDrawMode=5,q.LineStripDrawMode=6,q.TriangleStripDrawMode=7,q.TriangleFanDrawMode=8,q.ClockWiseSideOrientation=0,q.CounterClockWiseSideOrientation=1,q.ImageProcessingDirtyFlag=64,q.TextureDirtyFlag=1,q.LightDirtyFlag=2,q.FresnelDirtyFlag=4,q.AttributesDirtyFlag=8,q.MiscDirtyFlag=16,q.PrePassDirtyFlag=32,q.AllDirtyFlag=127,q.MATERIAL_OPAQUE=0,q.MATERIAL_ALPHATEST=1,q.MATERIAL_ALPHABLEND=2,q.MATERIAL_ALPHATESTANDBLEND=3,q.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,q.MATERIAL_NORMALBLENDMETHOD_RNM=1,q.OnEventObservable=new G.b,q._AllDirtyCallBack=B=>B.markAllAsDirty(),q._ImageProcessingDirtyCallBack=B=>B.markAsImageProcessingDirty(),q._TextureDirtyCallBack=B=>B.markAsTexturesDirty(),q._FresnelDirtyCallBack=B=>B.markAsFresnelDirty(),q._MiscDirtyCallBack=B=>B.markAsMiscDirty(),q._PrePassDirtyCallBack=B=>B.markAsPrePassDirty(),q._LightsDirtyCallBack=B=>B.markAsLightDirty(),q._AttributeDirtyCallBack=B=>B.markAsAttributesDirty(),q._FresnelAndMiscDirtyCallBack=B=>{q._FresnelDirtyCallBack(B),q._MiscDirtyCallBack(B)},q._TextureAndMiscDirtyCallBack=B=>{q._TextureDirtyCallBack(B),q._MiscDirtyCallBack(B)},q._DirtyCallbackArray=[],q._RunDirtyCallBacks=B=>{for(const u of q._DirtyCallbackArray)u(B)},(0,Z.d)([(0,V.L)()],q.prototype,"id",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"uniqueId",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"name",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"metadata",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"checkReadyOnEveryCall",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"checkReadyOnlyOnce",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"state",void 0),(0,Z.d)([(0,V.L)("alpha")],q.prototype,"_alpha",void 0),(0,Z.d)([(0,V.L)("xR")],q.prototype,"_backFaceCulling",void 0),(0,Z.d)([(0,V.L)("cullBackFaces")],q.prototype,"_cullBackFaces",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"sideOrientation",void 0),(0,Z.d)([(0,V.L)("alphaMode")],q.prototype,"_alphaMode",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"_needDepthPrePass",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"disableDepthWrite",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"disableColorWrite",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"forceDepthWrite",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"depthFunction",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"separateCullingPass",void 0),(0,Z.d)([(0,V.L)("fogEnabled")],q.prototype,"_fogEnabled",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"pointSize",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"zOffset",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"zOffsetUnits",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"pointsCloud",null),(0,Z.d)([(0,V.L)()],q.prototype,"fillMode",null),(0,Z.d)([(0,V.L)()],q.prototype,"useLogarithmicDepth",null),(0,Z.d)([(0,V.L)()],q.prototype,"transparencyMode",null)},13349:(B,u,F)=>{F.d(u,{$:()=>D,A:()=>v,D:()=>t,F:()=>M,G:()=>z,K:()=>a,M:()=>W,O:()=>J,Q:()=>j,S:()=>o,V:()=>I,Y:()=>E,c:()=>C,d:()=>Q,g:()=>U,h:()=>Y,i:()=>L,l:()=>q,p:()=>X,t:()=>g,x:()=>f,y:()=>y,z:()=>O});var Z=F(12822),V=F(13023),p=F(12855),G=F(13282),R=F(13352);const e=V.Xu.Black(),s={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function Y(B,u,F){if(!B||B.LOGARITHMICDEPTH||B.indexOf&&B.indexOf("LOGARITHMICDEPTH")>=0){const B=F.activeCamera;1===B.mode&&Z.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),u.setFloat("logarithmicDepthConstant",2/(Math.log(B.maxZ+1)/Math.LN2))}}function Q(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];F&&B.fogEnabled&&(!u||u.applyFog)&&0!==B.fogMode&&(F.setFloat4("vFogInfos",B.fogMode,B.fogStart,B.fogEnd,B.fogDensity),Z?(B.fogColor.toLinearSpaceToRef(e,B.getEngine().useExactSrgbConversions),F.setColor3("vFogColor",e)):F.setColor3("vFogColor",B.fogColor))}function t(B,u,F,Z,V,p,G,R,e,Y){const Q=B.numMaxInfluencers||B.numInfluencers;return Q<=0?0:(u.push("#define MORPHTARGETS"),B.hasPositions&&u.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),B.hasNormals&&u.push("#define MORPHTARGETTEXTURE_HASNORMALS"),B.hasTangents&&u.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),B.hasUVs&&u.push("#define MORPHTARGETTEXTURE_HASUVS"),B.hasUV2s&&u.push("#define MORPHTARGETTEXTURE_HASUV2S"),B.hasColors&&u.push("#define MORPHTARGETTEXTURE_HASCOLORS"),B.supportsPositions&&V&&u.push("#define MORPHTARGETS_POSITION"),B.supportsNormals&&p&&u.push("#define MORPHTARGETS_NORMAL"),B.supportsTangents&&G&&u.push("#define MORPHTARGETS_TANGENT"),B.supportsUVs&&R&&u.push("#define MORPHTARGETS_UV"),B.supportsUV2s&&e&&u.push("#define MORPHTARGETS_UV2"),B.supportsColors&&Y&&u.push("#define MORPHTARGETS_COLOR"),u.push("#define NUM_MORPH_INFLUENCERS "+Q),B.isUsingTextureForTargets&&u.push("#define MORPHTARGETS_TEXTURE"),s.NUM_MORPH_INFLUENCERS=Q,s.NORMAL=p,s.TANGENT=G,s.UV=R,s.UV2=e,s.COLOR=Y,v(F,Z,s,V),Q)}function v(B,u,F){let V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=F.NUM_MORPH_INFLUENCERS;if(G>0&&p.b.LastCreatedEngine){const R=p.b.LastCreatedEngine.getCaps().maxVertexAttribs,e=u.morphTargetManager;if(null!==e&&void 0!==e&&e.isUsingTextureForTargets)return;const s=e&&e.supportsPositions&&V,Y=e&&e.supportsNormals&&F.NORMAL,Q=e&&e.supportsTangents&&F.TANGENT,t=e&&e.supportsUVs&&F.UV1,v=e&&e.supportsUV2s&&F.UV2,D=e&&e.supportsColors&&F.VERTEXCOLOR;for(let F=0;F<G;F++)s&&B.push("position"+F),Y&&B.push("normal"+F),Q&&B.push("tangent"+F),t&&B.push("uv_"+F),v&&B.push("uv2_"+F),D&&B.push("color"+F),B.length>R&&Z.d.Error("Cannot add more vertex attributes for mesh "+u.name)}}function D(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B.push("world0"),B.push("world1"),B.push("world2"),B.push("world3"),u&&(B.push("previousWorld0"),B.push("previousWorld1"),B.push("previousWorld2"),B.push("previousWorld3"))}function L(B,u){const F=B.morphTargetManager;B&&F&&u.setFloatArray("morphTargetInfluences",F.influences)}function q(B,u){u.bindToEffect(B,"Scene")}function W(B,u,F){u._needUVs=!0,u[F]=!0,B.optimizeUVAllocation&&B.getTextureMatrix().isIdentityAs3x2()?(u[F+"DIRECTUV"]=B.coordinatesIndex+1,u["MAINUV"+(B.coordinatesIndex+1)]=!0):u[F+"DIRECTUV"]=0}function X(B,u,F){const Z=B.getTextureMatrix();u.WR(F+"Matrix",Z)}function f(B,u,F){F.BAKED_VERTEX_ANIMATION_TEXTURE&&F.INSTANCES&&B.push("bakedVertexAnimationSettingsInstanced")}function C(B,u,F){var Z;if(u&&B&&(B.computeBonesUsingShaders&&u._bonesComputationForcedToCPU&&(B.computeBonesUsingShaders=!1),B.useBones&&B.computeBonesUsingShaders&&B.skeleton)){const V=B.skeleton;if(V.isUsingTextureForMatrices&&u.getUniformIndex("boneTextureWidth")>-1){const F=V.getTransformMatrixTexture(B);u.setTexture("boneSampler",F),u.setFloat("boneTextureWidth",4*(V.bones.length+1))}else{const p=V.getTransformMatrices(B);p&&(u.setMatrices("mBones",p),F&&B.yB().prePassRenderer&&B.yB().prePassRenderer.getIndex(2)&&(F.previousBones[B.uniqueId]||(F.previousBones[B.uniqueId]=p.slice()),u.setMatrices("mPreviousBones",F.previousBones[B.uniqueId]),Z=p,F.previousBones[B.uniqueId].set(Z)))}}}function x(B,u,F,Z,V){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];B._bindLight(u,F,Z,V,p)}function U(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const p=Math.min(u.lightSources.length,V);for(let G=0;G<p;G++){x(u.lightSources[G],G,B,F,"boolean"===typeof Z?Z:Z.SPECULARTERM,u.receiveShadows)}}function y(B,u,F,Z){F.NUM_BONE_INFLUENCERS>0&&(Z.addCPUSkinningFallback(0,u),B.push("matricesIndices"),B.push("matricesWeights"),F.NUM_BONE_INFLUENCERS>4&&(B.push("matricesIndicesExtra"),B.push("matricesWeightsExtra")))}function O(B,u){(u.INSTANCES||u.THIN_INSTANCES)&&D(B,!!u.PREPASS_VELOCITY),u.INSTANCESCOLOR&&B.push("instanceColor")}function g(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,V=0;for(let p=0;p<F&&B["LIGHT"+p];p++)p>0&&(V=Z+p,u.addFallback(V,"LIGHT"+p)),B.SHADOWS||(B["SHADOW"+p]&&u.addFallback(Z,"SHADOW"+p),B["SHADOWPCF"+p]&&u.addFallback(Z,"SHADOWPCF"+p),B["SHADOWPCSS"+p]&&u.addFallback(Z,"SHADOWPCSS"+p),B["SHADOWPOISSON"+p]&&u.addFallback(Z,"SHADOWPOISSON"+p),B["SHADOWESM"+p]&&u.addFallback(Z,"SHADOWESM"+p),B["SHADOWCLOSEESM"+p]&&u.addFallback(Z,"SHADOWCLOSEESM"+p));return V++}function J(B,u,F,Z,V,p,G){let R=arguments.length>7&&void 0!==arguments[7]&&arguments[7];G._areMiscDirty&&(G.LOGARITHMICDEPTH=F,G.POINTSIZE=Z,G.FOG=V&&function(B,u){return u.fogEnabled&&B.applyFog&&0!==u.fogMode}(B,u),G.NONUNIFORMSCALING=B.nonUniformScaling,G.ALPHATEST=p,G.DECAL_AFTER_DETAIL=R)}function a(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!F._areLightsDirty)return F._needNormals;let G=0;const R={needNormals:F._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(B.lightsEnabled&&!p)for(const s of u.lightSources)if(T(B,u,s,G,F,Z,R),G++,G===V)break;F.SPECULARTERM=R.specularEnabled,F.SHADOWS=R.shadowEnabled;for(let s=G;s<V;s++)void 0!==F["LIGHT"+s]&&(F["LIGHT"+s]=!1,F["HEMILIGHT"+s]=!1,F["POINTLIGHT"+s]=!1,F["DIRLIGHT"+s]=!1,F["SPOTLIGHT"+s]=!1,F["AREALIGHT"+s]=!1,F["SHADOW"+s]=!1,F["SHADOWCSM"+s]=!1,F["SHADOWCSMDEBUG"+s]=!1,F["SHADOWCSMNUM_CASCADES"+s]=!1,F["SHADOWCSMUSESHADOWMAXZ"+s]=!1,F["SHADOWCSMNOBLEND"+s]=!1,F["SHADOWCSM_RIGHTHANDED"+s]=!1,F["SHADOWPCF"+s]=!1,F["SHADOWPCSS"+s]=!1,F["SHADOWPOISSON"+s]=!1,F["SHADOWESM"+s]=!1,F["SHADOWCLOSEESM"+s]=!1,F["SHADOWCUBE"+s]=!1,F["SHADOWLOWQUALITY"+s]=!1,F["SHADOWMEDIUMQUALITY"+s]=!1);const e=B.getEngine().getCaps();return void 0===F.SHADOWFLOAT&&(R.needRebuild=!0),F.SHADOWFLOAT=R.shadowEnabled&&(e.textureFloatRender&&e.textureFloatLinearFiltering||e.textureHalfFloatRender&&e.textureHalfFloatLinearFiltering),F.LIGHTMAPEXCLUDED=R.lightmapMode,R.needRebuild&&F.rebuild(),R.needNormals}function T(B,u,F,Z,V,p,R){switch(R.needNormals=!0,void 0===V["LIGHT"+Z]&&(R.needRebuild=!0),V["LIGHT"+Z]=!0,V["SPOTLIGHT"+Z]=!1,V["HEMILIGHT"+Z]=!1,V["POINTLIGHT"+Z]=!1,V["DIRLIGHT"+Z]=!1,V["AREALIGHT"+Z]=!1,F.prepareLightSpecificDefines(V,Z),V["LIGHT_FALLOFF_PHYSICAL"+Z]=!1,V["LIGHT_FALLOFF_GLTF"+Z]=!1,V["LIGHT_FALLOFF_STANDARD"+Z]=!1,F.falloffType){case G.d.FALLOFF_GLTF:V["LIGHT_FALLOFF_GLTF"+Z]=!0;break;case G.d.FALLOFF_PHYSICAL:V["LIGHT_FALLOFF_PHYSICAL"+Z]=!0;break;case G.d.FALLOFF_STANDARD:V["LIGHT_FALLOFF_STANDARD"+Z]=!0}if(p&&!F.mQ.equalsFloats(0,0,0)&&(R.specularEnabled=!0),V["SHADOW"+Z]=!1,V["SHADOWCSM"+Z]=!1,V["SHADOWCSMDEBUG"+Z]=!1,V["SHADOWCSMNUM_CASCADES"+Z]=!1,V["SHADOWCSMUSESHADOWMAXZ"+Z]=!1,V["SHADOWCSMNOBLEND"+Z]=!1,V["SHADOWCSM_RIGHTHANDED"+Z]=!1,V["SHADOWPCF"+Z]=!1,V["SHADOWPCSS"+Z]=!1,V["SHADOWPOISSON"+Z]=!1,V["SHADOWESM"+Z]=!1,V["SHADOWCLOSEESM"+Z]=!1,V["SHADOWCUBE"+Z]=!1,V["SHADOWLOWQUALITY"+Z]=!1,V["SHADOWMEDIUMQUALITY"+Z]=!1,u&&u.receiveShadows&&B.shadowsEnabled&&F.shadowEnabled){const u=F.getShadowGenerator(B.activeCamera)??F.getShadowGenerator();if(u){const B=u.getShadowMap();B&&B.renderList&&B.renderList.length>0&&(R.shadowEnabled=!0,u.prepareDefines(V,Z))}}F.lightmapMode!=G.d.LIGHTMAP_DEFAULT?(R.lightmapMode=!0,V["LIGHTMAPEXCLUDED"+Z]=!0,V["LIGHTMAPNOSPECULAR"+Z]=F.lightmapMode==G.d.LIGHTMAP_SHADOWSONLY):(V["LIGHTMAPEXCLUDED"+Z]=!1,V["LIGHTMAPNOSPECULAR"+Z]=!1)}function z(B,u,F,Z,V){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=function(B,u){let F=!1;if(B.activeCamera){const Z=u.CAMERA_ORTHOGRAPHIC?1:0,V=u.CAMERA_PERSPECTIVE?1:0,p=1===B.activeCamera.mode?1:0,G=0===B.activeCamera.mode?1:0;(Z^p||V^G)&&(u.CAMERA_ORTHOGRAPHIC=1===p,u.CAMERA_PERSPECTIVE=1===G,F=!0)}return F}(B,Z);!1!==p&&(e=(0,R.j)(F,B,Z)),Z.DEPTHPREPASS!==!u.getColorWrite()&&(Z.DEPTHPREPASS=!Z.DEPTHPREPASS,e=!0),Z.INSTANCES!==V&&(Z.INSTANCES=V,e=!0),Z.THIN_INSTANCES!==G&&(Z.THIN_INSTANCES=G,e=!0),e&&Z.markAsUnprocessed()}function M(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!u._areAttributesDirty&&u._needNormals===u._normals&&u._needUVs===u._uvs)return!1;u._normals=u._needNormals,u._uvs=u._needUVs,u.NORMAL=u._needNormals&&B.isVerticesDataPresent("normal"),u._needNormals&&B.isVerticesDataPresent("tangent")&&(u.TANGENT=!0);for(let R=1;R<=6;++R)u["UV"+R]=!!u._needUVs&&B.isVerticesDataPresent(`uv${1===R?"":R}`);if(F){const F=B.useVertexColors&&B.isVerticesDataPresent("color");u.VERTEXCOLOR=F,u.VERTEXALPHA=B.hasVertexAlpha&&F&&p}return B.isVerticesDataPresent("instanceColor")&&(B.hasInstances||B.hasThinInstances)&&(u.INSTANCESCOLOR=!0),Z&&function(B,u){if(B.useBones&&B.computeBonesUsingShaders&&B.skeleton){u.NUM_BONE_INFLUENCERS=B.numBoneInfluencers;const F=void 0!==u.BONETEXTURE;if(B.skeleton.isUsingTextureForMatrices&&F)u.BONETEXTURE=!0;else{u.BonesPerMesh=B.skeleton.bones.length+1,u.BONETEXTURE=!F&&void 0;const Z=B.yB().prePassRenderer;if(Z&&Z.enabled){const F=-1===Z.excludedSkinnedMesh.indexOf(B);u.BONES_VELOCITY_ENABLED=F}}}else u.NUM_BONE_INFLUENCERS=0,u.BonesPerMesh=0,void 0!==u.BONETEXTURE&&(u.BONETEXTURE=!1)}(B,u),V&&function(B,u){const F=B.morphTargetManager;F?(u.MORPHTARGETS_UV=F.supportsUVs&&u.UV1,u.MORPHTARGETS_UV2=F.supportsUV2s&&u.UV2,u.MORPHTARGETS_TANGENT=F.supportsTangents&&u.TANGENT,u.MORPHTARGETS_NORMAL=F.supportsNormals&&u.NORMAL,u.MORPHTARGETS_POSITION=F.supportsPositions,u.MORPHTARGETS_COLOR=F.supportsColors,u.MORPHTARGETTEXTURE_HASUVS=F.hasUVs,u.MORPHTARGETTEXTURE_HASUV2S=F.hasUV2s,u.MORPHTARGETTEXTURE_HASTANGENTS=F.hasTangents,u.MORPHTARGETTEXTURE_HASNORMALS=F.hasNormals,u.MORPHTARGETTEXTURE_HASPOSITIONS=F.hasPositions,u.MORPHTARGETTEXTURE_HASCOLORS=F.hasColors,u.NUM_MORPH_INFLUENCERS=F.numMaxInfluencers||F.numInfluencers,u.MORPHTARGETS=u.NUM_MORPH_INFLUENCERS>0,u.MORPHTARGETS_TEXTURE=F.isUsingTextureForTargets):(u.MORPHTARGETS_UV=!1,u.MORPHTARGETS_UV2=!1,u.MORPHTARGETS_TANGENT=!1,u.MORPHTARGETS_NORMAL=!1,u.MORPHTARGETS_POSITION=!1,u.MORPHTARGETS_COLOR=!1,u.MORPHTARGETTEXTURE_HASUVS=!1,u.MORPHTARGETTEXTURE_HASUV2S=!1,u.MORPHTARGETTEXTURE_HASTANGENTS=!1,u.MORPHTARGETTEXTURE_HASNORMALS=!1,u.MORPHTARGETTEXTURE_HASPOSITIONS=!1,u.MORPHTARGETTEXTURE_HAS_COLORS=!1,u.MORPHTARGETS=!1,u.NUM_MORPH_INFLUENCERS=0)}(B,u),G&&function(B,u){const F=B.bakedVertexAnimationManager;u.BAKED_VERTEX_ANIMATION_TEXTURE=!(!F||!F.isEnabled)}(B,u),!0}function j(B,u){if(B.activeCamera){const F=u.MULTIVIEW;u.MULTIVIEW=null!==B.activeCamera.outputRenderTarget&&B.activeCamera.outputRenderTarget.getViewCount()>1,u.MULTIVIEW!=F&&u.markAsUnprocessed()}}function o(B,u,F){const Z=u.ORDER_INDEPENDENT_TRANSPARENCY,V=u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;u.ORDER_INDEPENDENT_TRANSPARENCY=B.useOrderIndependentTransparency&&F,u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!B.getEngine().getCaps().textureFloatLinearFiltering,Z===u.ORDER_INDEPENDENT_TRANSPARENCY&&V===u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||u.markAsUnprocessed()}function I(B,u,F){const Z=u.PREPASS;if(!u._arePrePassDirty)return;const V=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(B.prePassRenderer&&B.prePassRenderer.enabled&&F){u.PREPASS=!0,u.SCENE_MRT_COUNT=B.prePassRenderer.mrtCount,u.PREPASS_NORMAL_WORLDSPACE=B.prePassRenderer.generateNormalsInWorldSpace,u.PREPASS_COLOR=!0,u.PREPASS_COLOR_INDEX=0;for(let F=0;F<V.length;F++){const Z=B.prePassRenderer.getIndex(V[F].type);-1!==Z?(u[V[F].define]=!0,u[V[F].index]=Z):u[V[F].define]=!1}}else{u.PREPASS=!1;for(let B=0;B<V.length;B++)u[V[B].define]=!1}u.PREPASS!=Z&&(u.markAsUnprocessed(),u.markAsImageProcessingDirty())}function mB(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6];V&&V.push("Light"+B),p||(u.push("vLightData"+B,"vLightDiffuse"+B,"vLightSpecular"+B,"vLightDirection"+B,"vLightWidth"+B,"vLightHeight"+B,"vLightFalloff"+B,"vLightGround"+B,"lightMatrix"+B,"shadowsInfo"+B,"depthValues"+B),F.push("shadowTexture"+B),F.push("depthTexture"+B),u.push("viewFrustumZ"+B,"cascadeBlendFactor"+B,"lightSizeUVCorrection"+B,"depthCorrection"+B,"penumbraDarkness"+B,"frustumLengths"+B),Z&&(F.push("projectionLightTexture"+B),u.push("textureProjectionMatrix"+B)),G&&F.push("iesLightTexture"+B))}function E(B,u,F){let Z,V,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(B.uniformsNames){const G=B;Z=G.uniformsNames,V=G.uniformBuffersNames,u=G.samplers,F=G.defines,p=G.maxSimultaneousLights||0}else Z=B,u||(u=[]);for(let G=0;G<p&&F["LIGHT"+G];G++)mB(G,Z,u,F["PROJECTEDLIGHTTEXTURE"+G],V,!1,F["IESLIGHTTEXTURE"+G]);F.NUM_MORPH_INFLUENCERS&&(Z.push("morphTargetInfluences"),Z.push("morphTargetCount")),F.BAKED_VERTEX_ANIMATION_TEXTURE&&(Z.push("bakedVertexAnimationSettings"),Z.push("bakedVertexAnimationTextureSizeInverted"),Z.push("bakedVertexAnimationTime"),u.push("bakedVertexAnimationTexture"))}},13296:(B,u,F)=>{F.d(u,{e:()=>p});var Z=F(12979),V=F(13299);class p extends V.c{constructor(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(B,u,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new Z.Matrix,this._storeEffectOnSubMeshes=F}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(B,u){return!!B&&(!this._storeEffectOnSubMeshes||(!B.vR||0===B.vR.length||this.isReadyForSubMesh(B,B.vR[0],u)))}_isReadyForSubMesh(B){const u=B.materialDefines;return!(this.checkReadyOnEveryCall||!B.effect||!u||u._renderId!==this.yB().getRenderId())}bindOnlyWorldMatrix(B){this._activeEffect.setMatrix("world",B)}bindOnlyNormalMatrix(B){this._activeEffect.setMatrix("normalMatrix",B)}bind(B,u){u&&this.bindForSubMesh(B,u,u.vR[0])}_afterBind(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;super._afterBind(B,u,F),this.yB()._cachedEffect=u,F?F._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return F._drawWrapper._forceRebindOnNextCall||B.isCachedMaterialInvalid(this,u,Z)}dispose(B,u,F){this._activeEffect=void 0,super.dispose(B,u,F)}}},13342:(B,u,F)=>{F.d(u,{d:()=>R,g:()=>e});var Z=F(12971),V=F(12979),p=F(12973);class G{static extractMinAndMaxIndexed(B,u,F,Z,V,p){for(let G=F;G<F+Z;G++){const F=3*u[G],Z=B[F],R=B[F+1],e=B[F+2];V.minimizeInPlaceFromFloats(Z,R,e),p.maximizeInPlaceFromFloats(Z,R,e)}}static extractMinAndMax(B,u,F,Z,V,p){for(let G=u,R=u*Z;G<u+F;G++,R+=Z){const u=B[R],F=B[R+1],Z=B[R+2];V.minimizeInPlaceFromFloats(u,F,Z),p.maximizeInPlaceFromFloats(u,F,Z)}}}function R(B,u,F,Z){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const R=new V.Du(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new V.Du(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return G.extractMinAndMaxIndexed(B,u,F,Z,R,e),p&&(R.x-=R.x*p.x+p.y,R.y-=R.y*p.x+p.y,R.z-=R.z*p.x+p.y,e.x+=e.x*p.x+p.y,e.y+=e.y*p.x+p.y,e.z+=e.z*p.x+p.y),{minimum:R,maximum:e}}function e(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;const R=new V.Du(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new V.Du(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p||(p=3),G.extractMinAndMax(B,u,F,p,R,e),Z&&(R.x-=R.x*Z.x+Z.y,R.y-=R.y*Z.x+Z.y,R.z-=R.z*Z.x+Z.y,e.x+=e.x*Z.x+Z.y,e.y+=e.y*Z.x+Z.y,e.z+=e.z*Z.x+Z.y),{minimum:R,maximum:e}}(0,Z.d)([p.h.filter((function(){for(var B=arguments.length,u=new Array(B),F=0;F<B;F++)u[F]=arguments[F];let[Z,V]=u;return!Array.isArray(Z)&&!Array.isArray(V)}))],G,"extractMinAndMaxIndexed",null),(0,Z.d)([p.h.filter((function(){for(var B=arguments.length,u=new Array(B),F=0;F<B;F++)u[F]=arguments[F];let[Z]=u;return!Array.isArray(Z)}))],G,"extractMinAndMax",null)},13306:(B,u,F)=>{F.d(u,{b:()=>e});var Z=F(13047),V=F(13315),p=F(13318),G=F(13342),R=F(13094);class e{get materialDefines(){var B;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(B=this._getDrawWrapper())||void 0===B?void 0:B.defines}set materialDefines(B){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=B}_getDrawWrapper(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B=B??this._engine.currentRenderPassId;let F=this._drawWrappers[B];return!F&&u&&(this._drawWrappers[B]=F=new R.b(this._mesh.yB().getEngine())),F}_removeDrawWrapper(B){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var F;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(F=this._drawWrappers[B])||void 0===F||F.dispose(u));this._drawWrappers[B]=void 0}get effect(){var B;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(B=this._getDrawWrapper())||void 0===B?void 0:B.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(B){this._mainDrawWrapperOverride=B}setEffect(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const V=this._drawWrapper;V.setEffect(B,u,Z),void 0!==F&&(V.materialContext=F),B||(V.defines=null,V.materialContext=void 0)}resetDrawCache(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==B)return void this._removeDrawWrapper(B,!0,u);for(const B of this._drawWrappers)null===B||void 0===B||B.dispose(u)}this._drawWrappers=[]}static AddToMesh(B,u,F,Z,V,p,G){return new e(B,u,F,Z,V,p,G,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(B,u,F,Z,V,p,G){let R=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],e=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=B,this.verticesStart=u,this.verticesCount=F,this.indexStart=Z,this.indexCount=V,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=p,this._renderingMesh=G||p,e&&p.vR.push(this),this._engine=this._mesh.yB().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=p.vR.length-1,R&&(this.refreshBoundingInfo(),p.XR(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(B){return this._boundingInfo=B,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const B=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return B||this._renderingMesh}EB(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!u)return B&&this._mesh.yB()._hasDefaultMaterial?this._mesh.yB().defaultMaterial:null;if(this._isMultiMaterial(u)){const B=u.getSubMaterial(this.materialIndex);return this._currentMaterial!==B&&(this._currentMaterial=B,this.resetDrawCache()),B}return u}_isMultiMaterial(B){return void 0!==B.getSubMaterial}refreshBoundingInfo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.fR)return this;if(B||(B=this._renderingMesh.getVerticesData(Z.f.PositionKind)),!B)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const u=this._renderingMesh.CR();let F;if(0===this.indexStart&&this.indexCount===u.length){const B=this._renderingMesh.getBoundingInfo();F={minimum:B.minimum.clone(),maximum:B.maximum.clone()}}else F=(0,G.d)(B,u,this.indexStart,this.indexCount,this._renderingMesh.fR.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(F.minimum,F.maximum):this._boundingInfo=new p.b(F.minimum,F.maximum),this}_checkCollision(B){return this.getBoundingInfo()._checkCollision(B)}updateBoundingInfo(B){let u=this.getBoundingInfo();return u||(this.refreshBoundingInfo(),u=this.getBoundingInfo()),u&&u.update(B),this}isInFrustum(B){const u=this.getBoundingInfo();return!!u&&u.isInFrustum(B,this._mesh.HQ)}isCompletelyInFrustum(B){const u=this.getBoundingInfo();return!!u&&u.isCompletelyInFrustum(B)}render(B){return this._renderingMesh.render(this,B,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(B,u){if(!this._linesIndexBuffer){const F=6*Math.floor(this.indexCount/3),Z=this.verticesStart+this.verticesCount>65535?new Uint32Array(F):new Uint16Array(F);let V=0;if(0===B.length)for(let B=this.indexStart;B<this.indexStart+this.indexCount;B+=3)Z[V++]=B,Z[V++]=B+1,Z[V++]=B+1,Z[V++]=B+2,Z[V++]=B+2,Z[V++]=B;else for(let u=this.indexStart;u<this.indexStart+this.indexCount;u+=3)Z[V++]=B[u],Z[V++]=B[u+1],Z[V++]=B[u+1],Z[V++]=B[u+2],Z[V++]=B[u+2],Z[V++]=B[u];this._linesIndexBuffer=u.createIndexBuffer(Z),this._linesIndexCount=Z.length}return this._linesIndexBuffer}canIntersects(B){const u=this.getBoundingInfo();return!!u&&B.intersectsBox(u.boundingBox)}intersects(B,u,F,Z,V){const p=this.EB();if(!p)return null;let G=3,R=!1;switch(p.fillMode){case 3:case 5:case 6:case 8:return null;case 7:G=1,R=!0}return 4===p.fillMode?F.length?this._intersectLines(B,u,F,this._mesh.intersectionThreshold,Z):this._intersectUnIndexedLines(B,u,F,this._mesh.intersectionThreshold,Z):!F.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(B,u,F,Z,V):this._intersectTriangles(B,u,F,G,R,Z,V)}_intersectLines(B,u,F,Z,p){let G=null;for(let R=this.indexStart;R<this.indexStart+this.indexCount;R+=2){const e=u[F[R]],s=u[F[R+1]],Y=B.intersectionSegment(e,s,Z);if(!(Y<0)&&((p||!G||Y<G.distance)&&(G=new V.e(null,null,Y),G.faceId=R/2,p)))break}return G}_intersectUnIndexedLines(B,u,F,Z,p){let G=null;for(let R=this.verticesStart;R<this.verticesStart+this.verticesCount;R+=2){const F=u[R],e=u[R+1],s=B.intersectionSegment(F,e,Z);if(!(s<0)&&((p||!G||s<G.distance)&&(G=new V.e(null,null,s),G.faceId=R/2,p)))break}return G}_intersectTriangles(B,u,F,Z,V,p,G){let R=null,e=-1;for(let s=this.indexStart;s<this.indexStart+this.indexCount-(3-Z);s+=Z){e++;const Z=F[s],Y=F[s+1],Q=F[s+2];if(V&&4294967295===Q){s+=2;continue}const t=u[Z],v=u[Y],D=u[Q];if(!t||!v||!D)continue;if(G&&!G(t,v,D,B,Z,Y,Q))continue;const L=B.intersectsTriangle(t,v,D);if(L){if(L.distance<0)continue;if((p||!R||L.distance<R.distance)&&(R=L,R.faceId=e,p))break}}return R}_intersectUnIndexedTriangles(B,u,F,Z,V){let p=null;for(let G=this.verticesStart;G<this.verticesStart+this.verticesCount;G+=3){const F=u[G],R=u[G+1],e=u[G+2];if(V&&!V(F,R,e,B,-1,-1,-1))continue;const s=B.intersectsTriangle(F,R,e);if(s){if(s.distance<0)continue;if((Z||!p||s.distance<p.distance)&&(p=s,p.faceId=G/3,Z))break}}return p}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(B,u){const F=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,B,u,!1);if(!this.IsGlobal){const B=this.getBoundingInfo();if(!B)return F;F._boundingInfo=new p.b(B.minimum,B.maximum)}return F}dispose(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.yB().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this._mesh.vR.indexOf(this);this._mesh.vR.splice(u,1),this.resetDrawCache(void 0,B)}getClassName(){return"SubMesh"}static CreateFromIndices(B,u,F,Z,V){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=Number.MAX_VALUE,R=-Number.MAX_VALUE;const s=(V||Z).CR();for(let e=u;e<u+F;e++){const B=s[e];B<G&&(G=B),B>R&&(R=B)}return new e(B,G,R-G+1,u,F,Z,V,p)}}}}]);