"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[24],{12023:(c,r,D)=>{D.d(r,{b:()=>W});class W{constructor(c,r,D){this.bu=c,this.bv=r,this.distance=D,this.faceId=0,this.subMeshId=0}}},12031:(c,r,D)=>{D.d(r,{c:()=>u});var W=D(11694),B=D(11683),t=D(11687);class u{constructor(c,r,D){this.vectors=(0,W.d)(8,B.Zr.Zero),this.center=B.Zr.Zero(),this.centerWorld=B.Zr.Zero(),this.extendSize=B.Zr.Zero(),this.extendSizeWorld=B.Zr.Zero(),this.directions=(0,W.d)(3,B.Zr.Zero),this.vectorsWorld=(0,W.d)(8,B.Zr.Zero),this.minimumWorld=B.Zr.Zero(),this.maximumWorld=B.Zr.Zero(),this.minimum=B.Zr.Zero(),this.maximum=B.Zr.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(c,r,D)}reConstruct(c,r,D){const W=c.x,t=c.y,u=c.z,a=r.x,H=r.y,x=r.z,M=this.vectors;this.minimum.Ja(W,t,u),this.maximum.Ja(a,H,x),M[0].Ja(W,t,u),M[1].Ja(a,H,x),M[2].Ja(a,t,u),M[3].Ja(W,H,u),M[4].Ja(W,t,x),M[5].Ja(a,H,u),M[6].Ja(W,H,x),M[7].Ja(a,t,x),r.addToRef(c,this.center).scaleInPlace(.5),r.subtractToRef(c,this.extendSize).scaleInPlace(.5),this._worldMatrix=D||B.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(c){const r=u._TmpVector3,D=this.maximum.subtractToRef(this.minimum,r[0]),W=D.length();D.normalizeFromLength(W);const B=W*c,t=D.scaleInPlace(.5*B),a=this.center.subtractToRef(t,r[1]),H=this.center.addToRef(t,r[2]);return this.reConstruct(a,H,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(c){const r=this.minimumWorld,D=this.maximumWorld,W=this.directions,t=this.vectorsWorld,u=this.vectors;if(c.isIdentity()){r.t(this.minimum),D.t(this.maximum);for(let c=0;c<8;++c)t[c].t(u[c]);this.extendSizeWorld.t(this.extendSize),this.centerWorld.t(this.center)}else{r.ja(Number.MAX_VALUE),D.ja(-Number.MAX_VALUE);for(let W=0;W<8;++W){const a=t[W];B.Zr.TransformCoordinatesToRef(u[W],c,a),r.minimizeInPlace(a),D.maximizeInPlace(a)}D.subtractToRef(r,this.extendSizeWorld).scaleInPlace(.5),D.addToRef(r,this.centerWorld).scaleInPlace(.5)}B.Zr.FromArrayToRef(c.m,0,W[0]),B.Zr.FromArrayToRef(c.m,4,W[1]),B.Zr.FromArrayToRef(c.m,8,W[2]),this._worldMatrix=c}isInFrustum(c){return u.IsInFrustum(this.vectorsWorld,c)}isCompletelyInFrustum(c){return u.IsCompletelyInFrustum(this.vectorsWorld,c)}intersectsPoint(c){const r=this.minimumWorld,D=this.maximumWorld,W=r.x,B=r.y,u=r.z,a=D.x,H=D.y,x=D.z,M=c.x,E=c.y,m=c.z,Y=-t.c;return!(a-M<Y||Y>M-W)&&(!(H-E<Y||Y>E-B)&&!(x-m<Y||Y>m-u))}intersectsSphere(c){return u.IntersectsSphere(this.minimumWorld,this.maximumWorld,c.centerWorld,c.radiusWorld)}intersectsMinMax(c,r){const D=this.minimumWorld,W=this.maximumWorld,B=D.x,t=D.y,u=D.z,a=W.x,H=W.y,x=W.z,M=c.x,E=c.y,m=c.z,Y=r.x,v=r.y,k=r.z;return!(a<M||B>Y)&&(!(H<E||t>v)&&!(x<m||u>k))}dispose(){var c,r;null===(c=this._drawWrapperFront)||void 0===c||c.dispose(),null===(r=this._drawWrapperBack)||void 0===r||r.dispose()}static Intersects(c,r){return c.intersectsMinMax(r.minimumWorld,r.maximumWorld)}static IntersectsSphere(c,r,D,W){const t=u._TmpVector3[0];B.Zr.ClampToRef(D,c,r,t);return B.Zr.DistanceSquared(D,t)<=W*W}static IsCompletelyInFrustum(c,r){for(let D=0;D<6;++D){const W=r[D];for(let r=0;r<8;++r)if(W.dotCoordinate(c[r])<0)return!1}return!0}static IsInFrustum(c,r){for(let D=0;D<6;++D){let W=!0;const B=r[D];for(let r=0;r<8;++r)if(B.dotCoordinate(c[r])>=0){W=!1;break}if(W)return!1}return!0}}u._TmpVector3=(0,W.d)(3,B.Zr.Zero)},12028:(c,r,D)=>{D.d(r,{b:()=>E});var W=D(11694),B=D(11683),t=D(12031),u=D(12033);const a={min:0,max:0},H={min:0,max:0},x=(c,r,D)=>{const W=B.Zr.Dot(r.centerWorld,c),t=Math.abs(B.Zr.Dot(r.directions[0],c))*r.extendSize.x+Math.abs(B.Zr.Dot(r.directions[1],c))*r.extendSize.y+Math.abs(B.Zr.Dot(r.directions[2],c))*r.extendSize.z;D.min=W-t,D.max=W+t},M=(c,r,D)=>(x(c,r,a),x(c,D,H),!(a.min>H.max||H.min>a.max));class E{constructor(c,r,D){this._isLocked=!1,this.boundingBox=new t.c(c,r,D),this.boundingSphere=new u.c(c,r,D)}reConstruct(c,r,D){this.boundingBox.reConstruct(c,r,D),this.boundingSphere.reConstruct(c,r,D)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(c){this._isLocked=c}update(c){this._isLocked||(this.boundingBox._update(c),this.boundingSphere._update(c))}centerOn(c,r){const D=E._TmpVector3[0].t(c).BE(r),W=E._TmpVector3[1].t(c).addInPlace(r);return this.boundingBox.reConstruct(D,W,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(D,W,this.boundingBox.getWorldMatrix()),this}encapsulate(c){const r=B.Zr.Minimize(this.minimum,c),D=B.Zr.Maximize(this.maximum,c);return this.reConstruct(r,D,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(c){const r=B.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(r);const D=B.TmpVectors.Zr[0];return B.Zr.TransformCoordinatesToRef(c.boundingBox.minimumWorld,r,D),this.encapsulate(D),B.Zr.TransformCoordinatesToRef(c.boundingBox.maximumWorld,r,D),this.encapsulate(D),this}scale(c){return this.boundingBox.scale(c),this.boundingSphere.scale(c),this}isInFrustum(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===r||3===r)&&this.boundingSphere.isCenterInFrustum(c))return!0;if(!this.boundingSphere.isInFrustum(c))return!1;return!(1!==r&&3!==r)||this.boundingBox.isInFrustum(c)}get diagonalLength(){const c=this.boundingBox;return c.maximumWorld.subtractToRef(c.minimumWorld,E._TmpVector3[0]).length()}isCompletelyInFrustum(c){return this.boundingBox.isCompletelyInFrustum(c)}_checkCollision(c){return c._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(c){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(c)&&!!this.boundingBox.intersectsPoint(c))}intersects(c,r){if(!u.c.Intersects(this.boundingSphere,c.boundingSphere))return!1;if(!t.c.Intersects(this.boundingBox,c.boundingBox))return!1;if(!r)return!0;const D=this.boundingBox,W=c.boundingBox;return!!M(D.directions[0],D,W)&&(!!M(D.directions[1],D,W)&&(!!M(D.directions[2],D,W)&&(!!M(W.directions[0],D,W)&&(!!M(W.directions[1],D,W)&&(!!M(W.directions[2],D,W)&&(!!M(B.Zr.Cross(D.directions[0],W.directions[0]),D,W)&&(!!M(B.Zr.Cross(D.directions[0],W.directions[1]),D,W)&&(!!M(B.Zr.Cross(D.directions[0],W.directions[2]),D,W)&&(!!M(B.Zr.Cross(D.directions[1],W.directions[0]),D,W)&&(!!M(B.Zr.Cross(D.directions[1],W.directions[1]),D,W)&&(!!M(B.Zr.Cross(D.directions[1],W.directions[2]),D,W)&&(!!M(B.Zr.Cross(D.directions[2],W.directions[0]),D,W)&&(!!M(B.Zr.Cross(D.directions[2],W.directions[1]),D,W)&&!!M(B.Zr.Cross(D.directions[2],W.directions[2]),D,W))))))))))))))}}E._TmpVector3=(0,W.d)(2,B.Zr.Zero)},12033:(c,r,D)=>{D.d(r,{c:()=>t});var W=D(11694),B=D(11683);class t{constructor(c,r,D){this.center=B.Zr.Zero(),this.centerWorld=B.Zr.Zero(),this.minimum=B.Zr.Zero(),this.maximum=B.Zr.Zero(),this.reConstruct(c,r,D)}reConstruct(c,r,D){this.minimum.t(c),this.maximum.t(r);const W=B.Zr.Distance(c,r);r.addToRef(c,this.center).scaleInPlace(.5),this.radius=.5*W,this._update(D||B.Matrix.IdentityReadOnly)}scale(c){const r=this.radius*c,D=t._TmpVector3,W=D[0].ja(r),B=this.center.subtractToRef(W,D[1]),u=this.center.addToRef(W,D[2]);return this.reConstruct(B,u,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(c){if(c.isIdentity())this.centerWorld.t(this.center),this.radiusWorld=this.radius;else{B.Zr.TransformCoordinatesToRef(this.center,c,this.centerWorld);const r=t._TmpVector3[0];B.Zr.TransformNormalFromFloatsToRef(1,1,1,c,r),this.radiusWorld=Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z))*this.radius}}isInFrustum(c){const r=this.centerWorld,D=this.radiusWorld;for(let W=0;W<6;W++)if(c[W].dotCoordinate(r)<=-D)return!1;return!0}isCenterInFrustum(c){const r=this.centerWorld;for(let D=0;D<6;D++)if(c[D].dotCoordinate(r)<0)return!1;return!0}intersectsPoint(c){const r=B.Zr.DistanceSquared(this.centerWorld,c);return!(this.radiusWorld*this.radiusWorld<r)}static Intersects(c,r){const D=B.Zr.DistanceSquared(c.centerWorld,r.centerWorld),W=c.radiusWorld+r.radiusWorld;return!(W*W<D)}static CreateFromCenterAndRadius(c,r,D){this._TmpVector3[0].t(c),this._TmpVector3[1].Ja(0,0,r),this._TmpVector3[2].t(c),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].BE(this._TmpVector3[1]);const W=new t(this._TmpVector3[0],this._TmpVector3[2]);return W._worldMatrix=D||B.Matrix.Identity(),W}}t._TmpVector3=(0,W.d)(3,B.Zr.Zero)},12050:(c,r,D)=>{function W(c){-1===c.indexOf("vClipPlane")&&c.push("vClipPlane"),-1===c.indexOf("vClipPlane2")&&c.push("vClipPlane2"),-1===c.indexOf("vClipPlane3")&&c.push("vClipPlane3"),-1===c.indexOf("vClipPlane4")&&c.push("vClipPlane4"),-1===c.indexOf("vClipPlane5")&&c.push("vClipPlane5"),-1===c.indexOf("vClipPlane6")&&c.push("vClipPlane6")}function B(c,r,D){const W=!!(c.clipPlane??r.clipPlane),B=!!(c.clipPlane2??r.clipPlane2),t=!!(c.clipPlane3??r.clipPlane3),u=!!(c.clipPlane4??r.clipPlane4),a=!!(c.clipPlane5??r.clipPlane5),H=!!(c.clipPlane6??r.clipPlane6);W&&D.push("#define CLIPPLANE"),B&&D.push("#define CLIPPLANE2"),t&&D.push("#define CLIPPLANE3"),u&&D.push("#define CLIPPLANE4"),a&&D.push("#define CLIPPLANE5"),H&&D.push("#define CLIPPLANE6")}function t(c,r,D){let W=!1;const B=!!(c.clipPlane??r.clipPlane),t=!!(c.clipPlane2??r.clipPlane2),u=!!(c.clipPlane3??r.clipPlane3),a=!!(c.clipPlane4??r.clipPlane4),H=!!(c.clipPlane5??r.clipPlane5),x=!!(c.clipPlane6??r.clipPlane6);return D.CLIPPLANE!==B&&(D.CLIPPLANE=B,W=!0),D.CLIPPLANE2!==t&&(D.CLIPPLANE2=t,W=!0),D.CLIPPLANE3!==u&&(D.CLIPPLANE3=u,W=!0),D.CLIPPLANE4!==a&&(D.CLIPPLANE4=a,W=!0),D.CLIPPLANE5!==H&&(D.CLIPPLANE5=H,W=!0),D.CLIPPLANE6!==x&&(D.CLIPPLANE6=x,W=!0),W}function u(c,r,D){let W=r.clipPlane??D.clipPlane;a(c,"vClipPlane",W),W=r.clipPlane2??D.clipPlane2,a(c,"vClipPlane2",W),W=r.clipPlane3??D.clipPlane3,a(c,"vClipPlane3",W),W=r.clipPlane4??D.clipPlane4,a(c,"vClipPlane4",W),W=r.clipPlane5??D.clipPlane5,a(c,"vClipPlane5",W),W=r.clipPlane6??D.clipPlane6,a(c,"vClipPlane6",W)}function a(c,r,D){D&&c.setFloat4(r,D.normal.x,D.normal.y,D.normal.z,D.d)}D.d(r,{c:()=>W,d:()=>u,f:()=>t,j:()=>B})},12003:(c,r,D)=>{D.d(r,{c:()=>W});class W{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(c,r){this._defines[c]||(c<this._currentRank&&(this._currentRank=c),c>this._maxRank&&(this._maxRank=c),this._defines[c]=new Array),this._defines[c].push(r)}addCPUSkinningFallback(c,r){this._mesh=r,c<this._currentRank&&(this._currentRank=c),c>this._maxRank&&(this._maxRank=c)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(c,r){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,c=c.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),r._bonesComputationForcedToCPU=!0;const D=this._mesh.yc();for(let c=0;c<D.meshes.length;c++){const W=D.meshes[c];if(W.material){if(W.computeBonesUsingShaders&&0!==W.numBoneInfluencers)if(W.material.getEffect()===r)W.computeBonesUsingShaders=!1;else if(W.xa)for(const c of W.xa){if(c.effect===r){W.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&W.computeBonesUsingShaders&&W.numBoneInfluencers>0&&(W.computeBonesUsingShaders=!1)}}else{const r=this._defines[this._currentRank];if(r)for(let D=0;D<r.length;D++)c=c.replace("#define "+r[D],"");this._currentRank++}return c}}},12010:(c,r,D)=>{D.d(r,{c:()=>w});var W=D(11664),B=D(11669),t=D(11487),u=D(11494),a=D(11538),H=D(12018),x=D(11946),M=D(11509),E=D(11729),m=D(11782),Y=D(11717);class v{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(c){this._func=c}get funcRef(){return this._funcRef}set funcRef(c){this._funcRef=c}get funcMask(){return this._funcMask}set funcMask(c){this._funcMask=c}get opStencilFail(){return this._opStencilFail}set opStencilFail(c){this._opStencilFail=c}get opDepthFail(){return this._opDepthFail}set opDepthFail(c){this._opDepthFail=c}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(c){this._opStencilDepthPass=c}get mask(){return this._mask}set mask(c){this._mask=c}get enabled(){return this._enabled}set enabled(c){this._enabled=c}getClassName(){return"MaterialStencilState"}copyTo(c){Y.d.Clone((()=>c),this)}serialize(){return Y.d.Serialize(this)}parse(c,r,D){Y.d.Parse((()=>this),c,r,D)}}(0,W.e)([(0,B.K)()],v.prototype,"func",null),(0,W.e)([(0,B.K)()],v.prototype,"funcRef",null),(0,W.e)([(0,B.K)()],v.prototype,"funcMask",null),(0,W.e)([(0,B.K)()],v.prototype,"opStencilFail",null),(0,W.e)([(0,B.K)()],v.prototype,"opDepthFail",null),(0,W.e)([(0,B.K)()],v.prototype,"opStencilDepthPass",null),(0,W.e)([(0,B.K)()],v.prototype,"mask",null),(0,W.e)([(0,B.K)()],v.prototype,"enabled",null);var k=D(12048);class w{get _supportGlowLayer(){return!1}set _glowModeEnabled(c){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(c){if(this._alpha===c)return;const r=this._alpha;this._alpha=c,1!==r&&1!==c||this.Qx(w.MiscDirtyFlag+w.PrePassDirtyFlag)}get alpha(){return this._alpha}set Za(c){this._backFaceCulling!==c&&(this._backFaceCulling=c,this.Qx(w.TextureDirtyFlag))}get Za(){return this._backFaceCulling}set cullBackFaces(c){this._cullBackFaces!==c&&(this._cullBackFaces=c,this.Qx(w.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(c){this._blockDirtyMechanism!==c&&(this._blockDirtyMechanism=c,c||this.sE())}atomicMaterialsUpdate(c){this.blockDirtyMechanism=!0;try{c(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(c){this._onDisposeObserver&&this.Wa.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wa.add(c)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new u.c),this._onBindObservable}set onBind(c){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(c)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new u.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new u.c),this._onEffectCreatedObservable}set alphaMode(c){this._alphaMode!==c&&(this._alphaMode=c,this.Qx(w.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(c){this._needDepthPrePass!==c&&(this._needDepthPrePass=c,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(c){this._fogEnabled!==c&&(this._fogEnabled=c,this.Qx(w.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case w.WireFrameFillMode:case w.LineListDrawMode:case w.LineLoopDrawMode:case w.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(c){this.fillMode=c?w.WireFrameFillMode:w.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case w.PointFillMode:case w.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(c){this.fillMode=c?w.PointFillMode:w.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(c){this._fillMode!==c&&(this._fillMode=c,this.Qx(w.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(c){const r=this.yc().getEngine().getCaps().fragmentDepthSupported;c&&!r&&M.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=c&&r,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(c){this._drawWrapper=c}constructor(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Wa=new u.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new v,this._useUBO=!1,this._fillMode=w.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=c;const B=r||a.c.LastCreatedScene;B&&(this._scene=B,this._dirtyCallbacks={},this._forceGLSL=W,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=c||t.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new m.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new x.b(this._scene.getEngine(),void 0,void 0,c),this._useUBO=this.yc().getEngine().supportsUniformBuffers,this._createUniformBuffer(),D||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),w.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var c;const r=this.yc().getEngine();null===(c=this._uniformBuffer)||void 0===c||c.dispose(),r.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new x.b(r,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new x.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(c){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.sE(),this.checkReadyOnlyOnce=!0}unfreeze(){this.sE(),this.checkReadyOnlyOnce=!1}isReady(c,r){return!0}isReadyForSubMesh(c,r,D){const W=r.materialDefines;return!!W&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=W,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}yc(){return this._scene}_getEffectiveOrientation(c){return null!==this.sideOrientation?this.sideOrientation:c.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(c){this._transparencyMode!==c&&(this._transparencyMode=c,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===w.MATERIAL_ALPHABLEND||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===w.MATERIAL_ALPHATEST||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===w.MATERIAL_OPAQUE||this._transparencyMode===w.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(c){return this._hasTransparencyMode?this._transparencyModeIsBlend:c.visibility<1||!this._disableAlphaBlending&&(c.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(c){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(c)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}sE(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=this.yc().meshes;for(const D of r)if(D.xa)for(const r of D.xa)if(r.Gc()===this)for(const D of r._drawWrappers)D&&this._materialContext===D.materialContext&&(D._wasPreviouslyReady=!1,D._wasPreviouslyUsingInstances=null,D._forceRebindOnNextCall=c);c&&this.Qx(w.AllDirtyFlag)}_preBind(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=this._scene.getEngine(),W=(null==r?this.sideOrientation:r)===w.ClockWiseSideOrientation;return D.enableEffect(c||this._getDrawWrapper()),D.setState(this.Za,this.zOffset,!1,W,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),W}bind(c,r){}buildUniformLayout(){const c=this._uniformBuffer;this._eventInfo.ubo=c,this._callbackPluginEventGeneric(8,this._eventInfo),c.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(c,r,D){const W=D._drawWrapper;this._eventInfo.subMesh=D,this._callbackPluginEventBindForSubMesh(this._eventInfo),W._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(c){}bindView(c){this._useUBO?this._needToBindSceneUbo=!0:c.setMatrix("view",this.yc().getViewMatrix())}bindViewProjection(c){this._useUBO?this._needToBindSceneUbo=!0:(c.setMatrix("viewProjection",this.yc().getTransformMatrix()),c.setMatrix("projection",this.yc().getProjectionMatrix()))}bindEyePosition(c,r){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(c,r)}_afterBind(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&r&&(this._needToBindSceneUbo=!1,(0,k.o)(r,this.yc().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=c?c.visibility:1,this._onBindObservable&&c&&this._onBindObservable.notifyObservers(c),this.disableDepthWrite){const c=this._scene.getEngine();this._cachedDepthWriteState=c.getDepthWrite(),c.setDepthWrite(!1)}if(this.disableColorWrite){const c=this._scene.getEngine();this._cachedColorWriteState=c.getColorWrite(),c.setColorWrite(!1)}if(0!==this.depthFunction){const c=this._scene.getEngine();this._cachedDepthFunctionState=c.getDepthFunction()||0,c.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(c){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=c,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(c){return null}_clonePlugins(c,r){const D={};if(this._serializePlugins(D),w._ParsePlugins(D,c,this._scene,r),this.pluginManager)for(const W of this.pluginManager._plugins){const r=c.pluginManager.getPlugin(W.name);r&&W.copyTo(r)}}getBindedMeshes(){if(this.meshMap){const c=[];for(const r in this.meshMap){const D=this.meshMap[r];D&&c.push(D)}return c}return this._scene.meshes.filter((c=>c.material===this))}forceCompilation(c,r,D,W){const B={clipPlane:!1,useInstances:!1,...D},t=this.yc(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const a=()=>{if(!this._scene||!this._scene.getEngine())return;const D=t.clipPlane;if(B.clipPlane&&(t.clipPlane=new E.d(0,0,0,1)),this._storeEffectOnSubMeshes){let D=!0,t=null;if(c.xa){const r=new H.e(0,0,0,0,0,c,void 0,!1,!1);r.materialDefines&&(r.materialDefines._renderId=-1),this.isReadyForSubMesh(c,r,B.useInstances)||(r.effect&&r.effect.getCompilationError()&&r.effect.allFallbacksProcessed()?t=r.effect.getCompilationError():(D=!1,setTimeout(a,16)))}D&&(this.allowShaderHotSwapping=u,t&&W&&W(t),r&&r(this))}else this.isReady()?(this.allowShaderHotSwapping=u,r&&r(this)):setTimeout(a,16);B.clipPlane&&(t.clipPlane=D)};a()}async forceCompilationAsync(c,r){return await new Promise(((D,W)=>{this.forceCompilation(c,(()=>{D()}),r,(c=>{W(c)}))}))}Qx(c){this.yc().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(w._DirtyCallbackArray.length=0,c&w.ImageProcessingDirtyFlag&&w._DirtyCallbackArray.push(w._ImageProcessingDirtyCallBack),c&w.TextureDirtyFlag&&w._DirtyCallbackArray.push(w._TextureDirtyCallBack),c&w.LightDirtyFlag&&w._DirtyCallbackArray.push(w._LightsDirtyCallBack),c&w.FresnelDirtyFlag&&w._DirtyCallbackArray.push(w._FresnelDirtyCallBack),c&w.AttributesDirtyFlag&&w._DirtyCallbackArray.push(w._AttributeDirtyCallBack),c&w.MiscDirtyFlag&&w._DirtyCallbackArray.push(w._MiscDirtyCallBack),c&w.PrePassDirtyFlag&&w._DirtyCallbackArray.push(w._PrePassDirtyCallBack),w._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(w._RunDirtyCallBacks),this.yc().resetCachedMaterial())}resetDrawCache(){const c=this.yc().meshes;for(const r of c)if(r.xa)for(const c of r.xa)c.Gc()===this&&c.resetDrawCache()}_markAllSubMeshesAsDirty(c){const r=this.yc();if(r.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const D=r.meshes;for(const W of D)if(W.xa)for(const D of W.xa){if((D.Gc()||(r._hasDefaultMaterial?r.defaultMaterial:null))===this)for(const r of D._drawWrappers)r&&r.defines&&r.defines.markAllAsDirty&&this._materialContext===r.materialContext&&c(r.defines)}}_markScenePrePassDirty(){if(this.yc().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const c=this.yc().enablePrePassRenderer();c&&c.Qx()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(w._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(w._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(w._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(w._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(w._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(w._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(w._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(w._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(w._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(w._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const c=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Wa.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(c)}))}}setPrePassRenderer(c){return!1}dispose(c,r,D){const W=this.yc();if(W.stopAnimation(this),W.freeProcessedMaterials(),W.removeMaterial(this),this._eventInfo.forceDisposeTextures=r,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const c=this._parentContainer.materials.indexOf(this);c>-1&&this._parentContainer.materials.splice(c,1),this._parentContainer=null}if(!0!==D)if(this.meshMap)for(const B in this.meshMap){const c=this.meshMap[B];this._disposeMeshResources(c)}else{const c=W.meshes;for(const r of c)this._disposeMeshResources(r)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Wa.notifyObservers(this),this.Wa.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(c){if(!c)return;const r=c.ka,D=c._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(c.xa&&D)for(const B of c.xa){const c=B._drawWrappers;for(let t=0;t<c.length;t++){var W;const u=null===(W=c[t])||void 0===W?void 0:W.effect;if(!u)continue;D[t]===this&&(null===r||void 0===r||r._releaseVertexArrayObject(u),B._removeDrawWrapper(t,!0,!0))}}}else null===r||void 0===r||r._releaseVertexArrayObject(this._drawWrapper.effect);c.material!==this||c.sourceMesh||(c.material=null)}serialize(){const c=Y.d.Serialize(this);return c.stencil=this.stencil.serialize(),c.uniqueId=this.uniqueId,this._serializePlugins(c),c}_serializePlugins(c){if(c.plugins={},this.pluginManager)for(const r of this.pluginManager._plugins)r.doNotSerialize||(c.plugins[r.getClassName()]=r.serialize())}static Parse(c,r,D){if(c.customType){if("BABYLON.PBRMaterial"===c.customType&&c.overloadedAlbedo&&(c.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return M.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else c.customType="BABYLON.StandardMaterial";const W=t.Tools.Instantiate(c.customType).Parse(c,r,D);return W._loadedUniqueId=c.uniqueId,W}static _ParsePlugins(c,r,D,W){if(c.plugins)for(const a in c.plugins){var B,u;const H=c.plugins[a];let x=null===(B=r.pluginManager)||void 0===B?void 0:B.getPlugin(H.name);if(!x){const c=t.Tools.Instantiate("BABYLON."+a);c&&(x=new c(r))}null===(u=x)||void 0===u||u.parse(H,D,W)}}}w.TriangleFillMode=0,w.WireFrameFillMode=1,w.PointFillMode=2,w.PointListDrawMode=3,w.LineListDrawMode=4,w.LineLoopDrawMode=5,w.LineStripDrawMode=6,w.TriangleStripDrawMode=7,w.TriangleFanDrawMode=8,w.ClockWiseSideOrientation=0,w.CounterClockWiseSideOrientation=1,w.ImageProcessingDirtyFlag=64,w.TextureDirtyFlag=1,w.LightDirtyFlag=2,w.FresnelDirtyFlag=4,w.AttributesDirtyFlag=8,w.MiscDirtyFlag=16,w.PrePassDirtyFlag=32,w.AllDirtyFlag=127,w.MATERIAL_OPAQUE=0,w.MATERIAL_ALPHATEST=1,w.MATERIAL_ALPHABLEND=2,w.MATERIAL_ALPHATESTANDBLEND=3,w.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,w.MATERIAL_NORMALBLENDMETHOD_RNM=1,w.OnEventObservable=new u.c,w._AllDirtyCallBack=c=>c.markAllAsDirty(),w._ImageProcessingDirtyCallBack=c=>c.markAsImageProcessingDirty(),w._TextureDirtyCallBack=c=>c.markAsTexturesDirty(),w._FresnelDirtyCallBack=c=>c.markAsFresnelDirty(),w._MiscDirtyCallBack=c=>c.markAsMiscDirty(),w._PrePassDirtyCallBack=c=>c.markAsPrePassDirty(),w._LightsDirtyCallBack=c=>c.markAsLightDirty(),w._AttributeDirtyCallBack=c=>c.markAsAttributesDirty(),w._FresnelAndMiscDirtyCallBack=c=>{w._FresnelDirtyCallBack(c),w._MiscDirtyCallBack(c)},w._TextureAndMiscDirtyCallBack=c=>{w._TextureDirtyCallBack(c),w._MiscDirtyCallBack(c)},w._DirtyCallbackArray=[],w._RunDirtyCallBacks=c=>{for(const r of w._DirtyCallbackArray)r(c)},(0,W.e)([(0,B.K)()],w.prototype,"id",void 0),(0,W.e)([(0,B.K)()],w.prototype,"uniqueId",void 0),(0,W.e)([(0,B.K)()],w.prototype,"name",void 0),(0,W.e)([(0,B.K)()],w.prototype,"metadata",void 0),(0,W.e)([(0,B.K)()],w.prototype,"checkReadyOnEveryCall",void 0),(0,W.e)([(0,B.K)()],w.prototype,"checkReadyOnlyOnce",void 0),(0,W.e)([(0,B.K)()],w.prototype,"state",void 0),(0,W.e)([(0,B.K)("alpha")],w.prototype,"_alpha",void 0),(0,W.e)([(0,B.K)("Za")],w.prototype,"_backFaceCulling",void 0),(0,W.e)([(0,B.K)("cullBackFaces")],w.prototype,"_cullBackFaces",void 0),(0,W.e)([(0,B.K)()],w.prototype,"sideOrientation",void 0),(0,W.e)([(0,B.K)("alphaMode")],w.prototype,"_alphaMode",void 0),(0,W.e)([(0,B.K)()],w.prototype,"_needDepthPrePass",void 0),(0,W.e)([(0,B.K)()],w.prototype,"disableDepthWrite",void 0),(0,W.e)([(0,B.K)()],w.prototype,"disableColorWrite",void 0),(0,W.e)([(0,B.K)()],w.prototype,"forceDepthWrite",void 0),(0,W.e)([(0,B.K)()],w.prototype,"depthFunction",void 0),(0,W.e)([(0,B.K)()],w.prototype,"separateCullingPass",void 0),(0,W.e)([(0,B.K)("fogEnabled")],w.prototype,"_fogEnabled",void 0),(0,W.e)([(0,B.K)()],w.prototype,"pointSize",void 0),(0,W.e)([(0,B.K)()],w.prototype,"zOffset",void 0),(0,W.e)([(0,B.K)()],w.prototype,"zOffsetUnits",void 0),(0,W.e)([(0,B.K)()],w.prototype,"pointsCloud",null),(0,W.e)([(0,B.K)()],w.prototype,"fillMode",null),(0,W.e)([(0,B.K)()],w.prototype,"useLogarithmicDepth",null),(0,W.e)([(0,B.K)()],w.prototype,"transparencyMode",null)},12048:(c,r,D)=>{D.d(r,{C:()=>Y,G:()=>m,K:()=>f,L:()=>K,M:()=>z,N:()=>Z,O:()=>g,Q:()=>A,R:()=>h,T:()=>L,U:()=>G,V:()=>v,b:()=>j,f:()=>E,i:()=>e,m:()=>M,n:()=>k,o:()=>w,p:()=>J,r:()=>N,t:()=>q,v:()=>y,z:()=>U});var W=D(11509),B=D(11722),t=D(11538),u=D(11996),a=D(12050);const H=B.Xr.Black(),x={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function M(c,r,D){if(!c||c.LOGARITHMICDEPTH||c.indexOf&&c.indexOf("LOGARITHMICDEPTH")>=0){const c=D.activeCamera;1===c.mode&&W.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),r.setFloat("logarithmicDepthConstant",2/(Math.log(c.maxZ+1)/Math.LN2))}}function E(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];D&&c.fogEnabled&&(!r||r.applyFog)&&0!==c.fogMode&&(D.setFloat4("vFogInfos",c.fogMode,c.fogStart,c.fogEnd,c.fogDensity),W?(c.fogColor.toLinearSpaceToRef(H,c.getEngine().useExactSrgbConversions),D.setColor3("vFogColor",H)):D.setColor3("vFogColor",c.fogColor))}function m(c,r,D,W,B,t,u,a,H,M){const E=c.numMaxInfluencers||c.numInfluencers;return E<=0?0:(r.push("#define MORPHTARGETS"),c.hasPositions&&r.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),c.hasNormals&&r.push("#define MORPHTARGETTEXTURE_HASNORMALS"),c.hasTangents&&r.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),c.hasUVs&&r.push("#define MORPHTARGETTEXTURE_HASUVS"),c.hasUV2s&&r.push("#define MORPHTARGETTEXTURE_HASUV2S"),c.hasColors&&r.push("#define MORPHTARGETTEXTURE_HASCOLORS"),c.supportsPositions&&B&&r.push("#define MORPHTARGETS_POSITION"),c.supportsNormals&&t&&r.push("#define MORPHTARGETS_NORMAL"),c.supportsTangents&&u&&r.push("#define MORPHTARGETS_TANGENT"),c.supportsUVs&&a&&r.push("#define MORPHTARGETS_UV"),c.supportsUV2s&&H&&r.push("#define MORPHTARGETS_UV2"),c.supportsColors&&M&&r.push("#define MORPHTARGETS_COLOR"),r.push("#define NUM_MORPH_INFLUENCERS "+E),c.isUsingTextureForTargets&&r.push("#define MORPHTARGETS_TEXTURE"),x.NUM_MORPH_INFLUENCERS=E,x.NORMAL=t,x.TANGENT=u,x.UV=a,x.UV2=H,x.COLOR=M,Y(D,W,x,B),E)}function Y(c,r,D){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=D.NUM_MORPH_INFLUENCERS;if(u>0&&t.c.LastCreatedEngine){const a=t.c.LastCreatedEngine.getCaps().maxVertexAttribs,H=r.morphTargetManager;if(null!==H&&void 0!==H&&H.isUsingTextureForTargets)return;const x=H&&H.supportsPositions&&B,M=H&&H.supportsNormals&&D.NORMAL,E=H&&H.supportsTangents&&D.TANGENT,m=H&&H.supportsUVs&&D.UV1,Y=H&&H.supportsUV2s&&D.UV2,v=H&&H.supportsColors&&D.VERTEXCOLOR;for(let D=0;D<u;D++)x&&c.push("position"+D),M&&c.push("normal"+D),E&&c.push("tangent"+D),m&&c.push("uv_"+D),Y&&c.push("uv2_"+D),v&&c.push("color"+D),c.length>a&&W.e.Error("Cannot add more vertex attributes for mesh "+r.name)}}function v(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.push("world0"),c.push("world1"),c.push("world2"),c.push("world3"),r&&(c.push("previousWorld0"),c.push("previousWorld1"),c.push("previousWorld2"),c.push("previousWorld3"))}function k(c,r){const D=c.morphTargetManager;c&&D&&r.setFloatArray("morphTargetInfluences",D.influences)}function w(c,r){r.bindToEffect(c,"Scene")}function Z(c,r,D){r._needUVs=!0,r[D]=!0,c.optimizeUVAllocation&&c.getTextureMatrix().isIdentityAs3x2()?(r[D+"DIRECTUV"]=c.coordinatesIndex+1,r["MAINUV"+(c.coordinatesIndex+1)]=!0):r[D+"DIRECTUV"]=0}function J(c,r,D){const W=c.getTextureMatrix();r.Ya(D+"Matrix",W)}function q(c,r,D){D.BAKED_VERTEX_ANIMATION_TEXTURE&&D.INSTANCES&&c.push("bakedVertexAnimationSettingsInstanced")}function j(c,r,D){var W;if(r&&c&&(c.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(c.computeBonesUsingShaders=!1),c.useBones&&c.computeBonesUsingShaders&&c.skeleton)){const B=c.skeleton;if(B.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){const D=B.getTransformMatrixTexture(c);r.setTexture("boneSampler",D),r.setFloat("boneTextureWidth",4*(B.bones.length+1))}else{const t=B.getTransformMatrices(c);t&&(r.setMatrices("mBones",t),D&&c.yc().prePassRenderer&&c.yc().prePassRenderer.getIndex(2)&&(D.previousBones[c.uniqueId]||(D.previousBones[c.uniqueId]=t.slice()),r.setMatrices("mPreviousBones",D.previousBones[c.uniqueId]),W=t,D.previousBones[c.uniqueId].set(W)))}}}function X(c,r,D,W,B){let t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];c._bindLight(r,D,W,B,t)}function e(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const t=Math.min(r.lightSources.length,B);for(let u=0;u<t;u++){X(r.lightSources[u],u,c,D,"boolean"===typeof W?W:W.SPECULARTERM,r.receiveShadows)}}function y(c,r,D,W){D.NUM_BONE_INFLUENCERS>0&&(W.addCPUSkinningFallback(0,r),c.push("matricesIndices"),c.push("matricesWeights"),D.NUM_BONE_INFLUENCERS>4&&(c.push("matricesIndicesExtra"),c.push("matricesWeightsExtra")))}function U(c,r){(r.INSTANCES||r.THIN_INSTANCES)&&v(c,!!r.PREPASS_VELOCITY),r.INSTANCESCOLOR&&c.push("instanceColor")}function N(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=0;for(let t=0;t<D&&c["LIGHT"+t];t++)t>0&&(B=W+t,r.addFallback(B,"LIGHT"+t)),c.SHADOWS||(c["SHADOW"+t]&&r.addFallback(W,"SHADOW"+t),c["SHADOWPCF"+t]&&r.addFallback(W,"SHADOWPCF"+t),c["SHADOWPCSS"+t]&&r.addFallback(W,"SHADOWPCSS"+t),c["SHADOWPOISSON"+t]&&r.addFallback(W,"SHADOWPOISSON"+t),c["SHADOWESM"+t]&&r.addFallback(W,"SHADOWESM"+t),c["SHADOWCLOSEESM"+t]&&r.addFallback(W,"SHADOWCLOSEESM"+t));return B++}function g(c,r,D,W,B,t,u){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];u._areMiscDirty&&(u.LOGARITHMICDEPTH=D,u.POINTSIZE=W,u.FOG=B&&function(c,r){return r.fogEnabled&&c.applyFog&&0!==r.fogMode}(c,r),u.NONUNIFORMSCALING=c.nonUniformScaling,u.ALPHATEST=t,u.DECAL_AFTER_DETAIL=a)}function z(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!D._areLightsDirty)return D._needNormals;let u=0;const a={needNormals:D._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(c.lightsEnabled&&!t)for(const x of r.lightSources)if(S(c,r,x,u,D,W,a),u++,u===B)break;D.SPECULARTERM=a.specularEnabled,D.SHADOWS=a.shadowEnabled;for(let x=u;x<B;x++)void 0!==D["LIGHT"+x]&&(D["LIGHT"+x]=!1,D["HEMILIGHT"+x]=!1,D["POINTLIGHT"+x]=!1,D["DIRLIGHT"+x]=!1,D["SPOTLIGHT"+x]=!1,D["AREALIGHT"+x]=!1,D["SHADOW"+x]=!1,D["SHADOWCSM"+x]=!1,D["SHADOWCSMDEBUG"+x]=!1,D["SHADOWCSMNUM_CASCADES"+x]=!1,D["SHADOWCSMUSESHADOWMAXZ"+x]=!1,D["SHADOWCSMNOBLEND"+x]=!1,D["SHADOWCSM_RIGHTHANDED"+x]=!1,D["SHADOWPCF"+x]=!1,D["SHADOWPCSS"+x]=!1,D["SHADOWPOISSON"+x]=!1,D["SHADOWESM"+x]=!1,D["SHADOWCLOSEESM"+x]=!1,D["SHADOWCUBE"+x]=!1,D["SHADOWLOWQUALITY"+x]=!1,D["SHADOWMEDIUMQUALITY"+x]=!1);const H=c.getEngine().getCaps();return void 0===D.SHADOWFLOAT&&(a.needRebuild=!0),D.SHADOWFLOAT=a.shadowEnabled&&(H.textureFloatRender&&H.textureFloatLinearFiltering||H.textureHalfFloatRender&&H.textureHalfFloatLinearFiltering),D.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&D.rebuild(),a.needNormals}function S(c,r,D,W,B,t,a){switch(a.needNormals=!0,void 0===B["LIGHT"+W]&&(a.needRebuild=!0),B["LIGHT"+W]=!0,B["SPOTLIGHT"+W]=!1,B["HEMILIGHT"+W]=!1,B["POINTLIGHT"+W]=!1,B["DIRLIGHT"+W]=!1,B["AREALIGHT"+W]=!1,D.prepareLightSpecificDefines(B,W),B["LIGHT_FALLOFF_PHYSICAL"+W]=!1,B["LIGHT_FALLOFF_GLTF"+W]=!1,B["LIGHT_FALLOFF_STANDARD"+W]=!1,D.falloffType){case u.d.FALLOFF_GLTF:B["LIGHT_FALLOFF_GLTF"+W]=!0;break;case u.d.FALLOFF_PHYSICAL:B["LIGHT_FALLOFF_PHYSICAL"+W]=!0;break;case u.d.FALLOFF_STANDARD:B["LIGHT_FALLOFF_STANDARD"+W]=!0}if(t&&!D.wM.equalsFloats(0,0,0)&&(a.specularEnabled=!0),B["SHADOW"+W]=!1,B["SHADOWCSM"+W]=!1,B["SHADOWCSMDEBUG"+W]=!1,B["SHADOWCSMNUM_CASCADES"+W]=!1,B["SHADOWCSMUSESHADOWMAXZ"+W]=!1,B["SHADOWCSMNOBLEND"+W]=!1,B["SHADOWCSM_RIGHTHANDED"+W]=!1,B["SHADOWPCF"+W]=!1,B["SHADOWPCSS"+W]=!1,B["SHADOWPOISSON"+W]=!1,B["SHADOWESM"+W]=!1,B["SHADOWCLOSEESM"+W]=!1,B["SHADOWCUBE"+W]=!1,B["SHADOWLOWQUALITY"+W]=!1,B["SHADOWMEDIUMQUALITY"+W]=!1,r&&r.receiveShadows&&c.shadowsEnabled&&D.shadowEnabled){const r=D.getShadowGenerator(c.activeCamera)??D.getShadowGenerator();if(r){const c=r.getShadowMap();c&&c.renderList&&c.renderList.length>0&&(a.shadowEnabled=!0,r.prepareDefines(B,W))}}D.lightmapMode!=u.d.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,B["LIGHTMAPEXCLUDED"+W]=!0,B["LIGHTMAPNOSPECULAR"+W]=D.lightmapMode==u.d.LIGHTMAP_SHADOWSONLY):(B["LIGHTMAPEXCLUDED"+W]=!1,B["LIGHTMAPNOSPECULAR"+W]=!1)}function K(c,r,D,W,B){let t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=function(c,r){let D=!1;if(c.activeCamera){const W=r.CAMERA_ORTHOGRAPHIC?1:0,B=r.CAMERA_PERSPECTIVE?1:0,t=1===c.activeCamera.mode?1:0,u=0===c.activeCamera.mode?1:0;(W^t||B^u)&&(r.CAMERA_ORTHOGRAPHIC=1===t,r.CAMERA_PERSPECTIVE=1===u,D=!0)}return D}(c,W);!1!==t&&(H=(0,a.f)(D,c,W)),W.DEPTHPREPASS!==!r.getColorWrite()&&(W.DEPTHPREPASS=!W.DEPTHPREPASS,H=!0),W.INSTANCES!==B&&(W.INSTANCES=B,H=!0),W.THIN_INSTANCES!==u&&(W.THIN_INSTANCES=u,H=!0),H&&W.markAsUnprocessed()}function f(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!r._areAttributesDirty&&r._needNormals===r._normals&&r._needUVs===r._uvs)return!1;r._normals=r._needNormals,r._uvs=r._needUVs,r.NORMAL=r._needNormals&&c.isVerticesDataPresent("normal"),r._needNormals&&c.isVerticesDataPresent("tangent")&&(r.TANGENT=!0);for(let a=1;a<=6;++a)r["UV"+a]=!!r._needUVs&&c.isVerticesDataPresent(`uv${1===a?"":a}`);if(D){const D=c.useVertexColors&&c.isVerticesDataPresent("color");r.VERTEXCOLOR=D,r.VERTEXALPHA=c.hasVertexAlpha&&D&&t}return c.isVerticesDataPresent("instanceColor")&&(c.hasInstances||c.hasThinInstances)&&(r.INSTANCESCOLOR=!0),W&&function(c,r){if(c.useBones&&c.computeBonesUsingShaders&&c.skeleton){r.NUM_BONE_INFLUENCERS=c.numBoneInfluencers;const D=void 0!==r.BONETEXTURE;if(c.skeleton.isUsingTextureForMatrices&&D)r.BONETEXTURE=!0;else{r.BonesPerMesh=c.skeleton.bones.length+1,r.BONETEXTURE=!D&&void 0;const W=c.yc().prePassRenderer;if(W&&W.enabled){const D=-1===W.excludedSkinnedMesh.indexOf(c);r.BONES_VELOCITY_ENABLED=D}}}else r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0,void 0!==r.BONETEXTURE&&(r.BONETEXTURE=!1)}(c,r),B&&function(c,r){const D=c.morphTargetManager;D?(r.MORPHTARGETS_UV=D.supportsUVs&&r.UV1,r.MORPHTARGETS_UV2=D.supportsUV2s&&r.UV2,r.MORPHTARGETS_TANGENT=D.supportsTangents&&r.TANGENT,r.MORPHTARGETS_NORMAL=D.supportsNormals&&r.NORMAL,r.MORPHTARGETS_POSITION=D.supportsPositions,r.MORPHTARGETS_COLOR=D.supportsColors,r.MORPHTARGETTEXTURE_HASUVS=D.hasUVs,r.MORPHTARGETTEXTURE_HASUV2S=D.hasUV2s,r.MORPHTARGETTEXTURE_HASTANGENTS=D.hasTangents,r.MORPHTARGETTEXTURE_HASNORMALS=D.hasNormals,r.MORPHTARGETTEXTURE_HASPOSITIONS=D.hasPositions,r.MORPHTARGETTEXTURE_HASCOLORS=D.hasColors,r.NUM_MORPH_INFLUENCERS=D.numMaxInfluencers||D.numInfluencers,r.MORPHTARGETS=r.NUM_MORPH_INFLUENCERS>0,r.MORPHTARGETS_TEXTURE=D.isUsingTextureForTargets):(r.MORPHTARGETS_UV=!1,r.MORPHTARGETS_UV2=!1,r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS_POSITION=!1,r.MORPHTARGETS_COLOR=!1,r.MORPHTARGETTEXTURE_HASUVS=!1,r.MORPHTARGETTEXTURE_HASUV2S=!1,r.MORPHTARGETTEXTURE_HASTANGENTS=!1,r.MORPHTARGETTEXTURE_HASNORMALS=!1,r.MORPHTARGETTEXTURE_HASPOSITIONS=!1,r.MORPHTARGETTEXTURE_HAS_COLORS=!1,r.MORPHTARGETS=!1,r.NUM_MORPH_INFLUENCERS=0)}(c,r),u&&function(c,r){const D=c.bakedVertexAnimationManager;r.BAKED_VERTEX_ANIMATION_TEXTURE=!(!D||!D.isEnabled)}(c,r),!0}function A(c,r){if(c.activeCamera){const D=r.MULTIVIEW;r.MULTIVIEW=null!==c.activeCamera.outputRenderTarget&&c.activeCamera.outputRenderTarget.getViewCount()>1,r.MULTIVIEW!=D&&r.markAsUnprocessed()}}function h(c,r,D){const W=r.ORDER_INDEPENDENT_TRANSPARENCY,B=r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;r.ORDER_INDEPENDENT_TRANSPARENCY=c.useOrderIndependentTransparency&&D,r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!c.getEngine().getCaps().textureFloatLinearFiltering,W===r.ORDER_INDEPENDENT_TRANSPARENCY&&B===r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||r.markAsUnprocessed()}function L(c,r,D){const W=r.PREPASS;if(!r._arePrePassDirty)return;const B=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(c.prePassRenderer&&c.prePassRenderer.enabled&&D){r.PREPASS=!0,r.SCENE_MRT_COUNT=c.prePassRenderer.mrtCount,r.PREPASS_NORMAL_WORLDSPACE=c.prePassRenderer.generateNormalsInWorldSpace,r.PREPASS_COLOR=!0,r.PREPASS_COLOR_INDEX=0;for(let D=0;D<B.length;D++){const W=c.prePassRenderer.getIndex(B[D].type);-1!==W?(r[B[D].define]=!0,r[B[D].index]=W):r[B[D].define]=!1}}else{r.PREPASS=!1;for(let c=0;c<B.length;c++)r[B[c].define]=!1}r.PREPASS!=W&&(r.markAsUnprocessed(),r.markAsImageProcessingDirty())}function P(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];B&&B.push("Light"+c),t||(r.push("vLightData"+c,"vLightDiffuse"+c,"vLightSpecular"+c,"vLightDirection"+c,"vLightWidth"+c,"vLightHeight"+c,"vLightFalloff"+c,"vLightGround"+c,"lightMatrix"+c,"shadowsInfo"+c,"depthValues"+c),D.push("shadowTexture"+c),D.push("depthTexture"+c),r.push("viewFrustumZ"+c,"cascadeBlendFactor"+c,"lightSizeUVCorrection"+c,"depthCorrection"+c,"penumbraDarkness"+c,"frustumLengths"+c),W&&(D.push("projectionLightTexture"+c),r.push("textureProjectionMatrix"+c)),u&&D.push("iesLightTexture"+c))}function G(c,r,D){let W,B,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(c.uniformsNames){const u=c;W=u.uniformsNames,B=u.uniformBuffersNames,r=u.samplers,D=u.defines,t=u.maxSimultaneousLights||0}else W=c,r||(r=[]);for(let u=0;u<t&&D["LIGHT"+u];u++)P(u,W,r,D["PROJECTEDLIGHTTEXTURE"+u],B,!1,D["IESLIGHTTEXTURE"+u]);D.NUM_MORPH_INFLUENCERS&&(W.push("morphTargetInfluences"),W.push("morphTargetCount")),D.BAKED_VERTEX_ANIMATION_TEXTURE&&(W.push("bakedVertexAnimationSettings"),W.push("bakedVertexAnimationTextureSizeInverted"),W.push("bakedVertexAnimationTime"),r.push("bakedVertexAnimationTexture"))}},12008:(c,r,D)=>{D.d(r,{e:()=>t});var W=D(11683),B=D(12010);class t extends B.c{constructor(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(c,r,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new W.Matrix,this._storeEffectOnSubMeshes=D}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(c,r){return!!c&&(!this._storeEffectOnSubMeshes||(!c.xa||0===c.xa.length||this.isReadyForSubMesh(c,c.xa[0],r)))}_isReadyForSubMesh(c){const r=c.materialDefines;return!(this.checkReadyOnEveryCall||!c.effect||!r||r._renderId!==this.yc().getRenderId())}bindOnlyWorldMatrix(c){this._activeEffect.setMatrix("world",c)}bindOnlyNormalMatrix(c){this._activeEffect.setMatrix("normalMatrix",c)}bind(c,r){r&&this.bindForSubMesh(c,r,r.xa[0])}_afterBind(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0;super._afterBind(c,r,D),this.yc()._cachedEffect=r,D?D._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return D._drawWrapper._forceRebindOnNextCall||c.isCachedMaterialInvalid(this,r,W)}dispose(c,r,D){this._activeEffect=void 0,super.dispose(c,r,D)}}},12041:(c,r,D)=>{D.d(r,{c:()=>a,f:()=>H});var W=D(11664),B=D(11683),t=D(11669);class u{static extractMinAndMaxIndexed(c,r,D,W,B,t){for(let u=D;u<D+W;u++){const D=3*r[u],W=c[D],a=c[D+1],H=c[D+2];B.minimizeInPlaceFromFloats(W,a,H),t.maximizeInPlaceFromFloats(W,a,H)}}static extractMinAndMax(c,r,D,W,B,t){for(let u=r,a=r*W;u<r+D;u++,a+=W){const r=c[a],D=c[a+1],W=c[a+2];B.minimizeInPlaceFromFloats(r,D,W),t.maximizeInPlaceFromFloats(r,D,W)}}}function a(c,r,D,W){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=new B.Zr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),H=new B.Zr(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u.extractMinAndMaxIndexed(c,r,D,W,a,H),t&&(a.x-=a.x*t.x+t.y,a.y-=a.y*t.x+t.y,a.z-=a.z*t.x+t.y,H.x+=H.x*t.x+t.y,H.y+=H.y*t.x+t.y,H.z+=H.z*t.x+t.y),{minimum:a,maximum:H}}function H(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0;const a=new B.Zr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),H=new B.Zr(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t||(t=3),u.extractMinAndMax(c,r,D,t,a,H),W&&(a.x-=a.x*W.x+W.y,a.y-=a.y*W.x+W.y,a.z-=a.z*W.x+W.y,H.x+=H.x*W.x+W.y,H.y+=H.y*W.x+W.y,H.z+=H.z*W.x+W.y),{minimum:a,maximum:H}}(0,W.e)([t.d.filter((function(){for(var c=arguments.length,r=new Array(c),D=0;D<c;D++)r[D]=arguments[D];let[W,B]=r;return!Array.isArray(W)&&!Array.isArray(B)}))],u,"extractMinAndMaxIndexed",null),(0,W.e)([t.d.filter((function(){for(var c=arguments.length,r=new Array(c),D=0;D<c;D++)r[D]=arguments[D];let[W]=r;return!Array.isArray(W)}))],u,"extractMinAndMax",null)},12018:(c,r,D)=>{D.d(r,{e:()=>H});var W=D(11750),B=D(12023),t=D(12028),u=D(12041),a=D(11782);class H{get materialDefines(){var c;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(c=this._getDrawWrapper())||void 0===c?void 0:c.defines}set materialDefines(c){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=c}_getDrawWrapper(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c=c??this._engine.currentRenderPassId;let D=this._drawWrappers[c];return!D&&r&&(this._drawWrappers[c]=D=new a.c(this._mesh.yc().getEngine())),D}_removeDrawWrapper(c){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var D;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(D=this._drawWrappers[c])||void 0===D||D.dispose(r));this._drawWrappers[c]=void 0}get effect(){var c;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(c=this._getDrawWrapper())||void 0===c?void 0:c.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(c){this._mainDrawWrapperOverride=c}setEffect(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=this._drawWrapper;B.setEffect(c,r,W),void 0!==D&&(B.materialContext=D),c||(B.defines=null,B.materialContext=void 0)}resetDrawCache(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==c)return void this._removeDrawWrapper(c,!0,r);for(const c of this._drawWrappers)null===c||void 0===c||c.dispose(r)}this._drawWrappers=[]}static AddToMesh(c,r,D,W,B,t,u){return new H(c,r,D,W,B,t,u,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(c,r,D,W,B,t,u){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],H=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=c,this.verticesStart=r,this.verticesCount=D,this.indexStart=W,this.indexCount=B,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=t,this._renderingMesh=u||t,H&&t.xa.push(this),this._engine=this._mesh.yc().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=t.xa.length-1,a&&(this.refreshBoundingInfo(),t.va(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(c){return this._boundingInfo=c,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const c=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return c||this._renderingMesh}Gc(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const r=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!r)return c&&this._mesh.yc()._hasDefaultMaterial?this._mesh.yc().defaultMaterial:null;if(this._isMultiMaterial(r)){const c=r.getSubMaterial(this.materialIndex);return this._currentMaterial!==c&&(this._currentMaterial=c,this.resetDrawCache()),c}return r}_isMultiMaterial(c){return void 0!==c.getSubMaterial}refreshBoundingInfo(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.ka)return this;if(c||(c=this._renderingMesh.getVerticesData(W.d.PositionKind)),!c)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const r=this._renderingMesh.wa();let D;if(0===this.indexStart&&this.indexCount===r.length){const c=this._renderingMesh.getBoundingInfo();D={minimum:c.minimum.clone(),maximum:c.maximum.clone()}}else D=(0,u.c)(c,r,this.indexStart,this.indexCount,this._renderingMesh.ka.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(D.minimum,D.maximum):this._boundingInfo=new t.b(D.minimum,D.maximum),this}_checkCollision(c){return this.getBoundingInfo()._checkCollision(c)}updateBoundingInfo(c){let r=this.getBoundingInfo();return r||(this.refreshBoundingInfo(),r=this.getBoundingInfo()),r&&r.update(c),this}isInFrustum(c){const r=this.getBoundingInfo();return!!r&&r.isInFrustum(c,this._mesh.ZE)}isCompletelyInFrustum(c){const r=this.getBoundingInfo();return!!r&&r.isCompletelyInFrustum(c)}render(c){return this._renderingMesh.render(this,c,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(c,r){if(!this._linesIndexBuffer){const D=6*Math.floor(this.indexCount/3),W=this.verticesStart+this.verticesCount>65535?new Uint32Array(D):new Uint16Array(D);let B=0;if(0===c.length)for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)W[B++]=c,W[B++]=c+1,W[B++]=c+1,W[B++]=c+2,W[B++]=c+2,W[B++]=c;else for(let r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)W[B++]=c[r],W[B++]=c[r+1],W[B++]=c[r+1],W[B++]=c[r+2],W[B++]=c[r+2],W[B++]=c[r];this._linesIndexBuffer=r.createIndexBuffer(W),this._linesIndexCount=W.length}return this._linesIndexBuffer}canIntersects(c){const r=this.getBoundingInfo();return!!r&&c.intersectsBox(r.boundingBox)}intersects(c,r,D,W,B){const t=this.Gc();if(!t)return null;let u=3,a=!1;switch(t.fillMode){case 3:case 5:case 6:case 8:return null;case 7:u=1,a=!0}return 4===t.fillMode?D.length?this._intersectLines(c,r,D,this._mesh.intersectionThreshold,W):this._intersectUnIndexedLines(c,r,D,this._mesh.intersectionThreshold,W):!D.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(c,r,D,W,B):this._intersectTriangles(c,r,D,u,a,W,B)}_intersectLines(c,r,D,W,t){let u=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const H=r[D[a]],x=r[D[a+1]],M=c.intersectionSegment(H,x,W);if(!(M<0)&&((t||!u||M<u.distance)&&(u=new B.b(null,null,M),u.faceId=a/2,t)))break}return u}_intersectUnIndexedLines(c,r,D,W,t){let u=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){const D=r[a],H=r[a+1],x=c.intersectionSegment(D,H,W);if(!(x<0)&&((t||!u||x<u.distance)&&(u=new B.b(null,null,x),u.faceId=a/2,t)))break}return u}_intersectTriangles(c,r,D,W,B,t,u){let a=null,H=-1;for(let x=this.indexStart;x<this.indexStart+this.indexCount-(3-W);x+=W){H++;const W=D[x],M=D[x+1],E=D[x+2];if(B&&4294967295===E){x+=2;continue}const m=r[W],Y=r[M],v=r[E];if(!m||!Y||!v)continue;if(u&&!u(m,Y,v,c,W,M,E))continue;const k=c.intersectsTriangle(m,Y,v);if(k){if(k.distance<0)continue;if((t||!a||k.distance<a.distance)&&(a=k,a.faceId=H,t))break}}return a}_intersectUnIndexedTriangles(c,r,D,W,B){let t=null;for(let u=this.verticesStart;u<this.verticesStart+this.verticesCount;u+=3){const D=r[u],a=r[u+1],H=r[u+2];if(B&&!B(D,a,H,c,-1,-1,-1))continue;const x=c.intersectsTriangle(D,a,H);if(x){if(x.distance<0)continue;if((W||!t||x.distance<t.distance)&&(t=x,t.faceId=u/3,W))break}}return t}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(c,r){const D=new H(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,c,r,!1);if(!this.IsGlobal){const c=this.getBoundingInfo();if(!c)return D;D._boundingInfo=new t.b(c.minimum,c.maximum)}return D}dispose(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.yc().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const r=this._mesh.xa.indexOf(this);this._mesh.xa.splice(r,1),this.resetDrawCache(void 0,c)}getClassName(){return"SubMesh"}static CreateFromIndices(c,r,D,W,B){let t=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=Number.MAX_VALUE,a=-Number.MAX_VALUE;const x=(B||W).wa();for(let H=r;H<r+D;H++){const c=x[H];c<u&&(u=c),c>a&&(a=c)}return new H(c,u,a-u+1,r,D,W,B,t)}}}}]);