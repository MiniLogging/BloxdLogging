"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[24],{11474:(h,V,i)=>{i.d(V,{d:()=>S});class S{constructor(h,V,i){this.bu=h,this.bv=V,this.distance=i,this.faceId=0,this.subMeshId=0}}},11488:(h,V,i)=>{i.d(V,{e:()=>g});var S=i(11156),l=i(11138),Y=i(11147);class g{constructor(h,V,i){this.vectors=(0,S.c)(8,l.nV.Zero),this.center=l.nV.Zero(),this.centerWorld=l.nV.Zero(),this.extendSize=l.nV.Zero(),this.extendSizeWorld=l.nV.Zero(),this.directions=(0,S.c)(3,l.nV.Zero),this.vectorsWorld=(0,S.c)(8,l.nV.Zero),this.minimumWorld=l.nV.Zero(),this.maximumWorld=l.nV.Zero(),this.minimum=l.nV.Zero(),this.maximum=l.nV.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(h,V,i)}reConstruct(h,V,i){const S=h.x,Y=h.y,g=h.z,q=V.x,B=V.y,J=V.z,I=this.vectors;this.minimum.qq(S,Y,g),this.maximum.qq(q,B,J),I[0].qq(S,Y,g),I[1].qq(q,B,J),I[2].qq(q,Y,g),I[3].qq(S,B,g),I[4].qq(S,Y,J),I[5].qq(q,B,g),I[6].qq(S,B,J),I[7].qq(q,Y,J),V.addToRef(h,this.center).scaleInPlace(.5),V.subtractToRef(h,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||l.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(h){const V=g._TmpVector3,i=this.maximum.subtractToRef(this.minimum,V[0]),S=i.length();i.normalizeFromLength(S);const l=S*h,Y=i.scaleInPlace(.5*l),q=this.center.subtractToRef(Y,V[1]),B=this.center.addToRef(Y,V[2]);return this.reConstruct(q,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){const V=this.minimumWorld,i=this.maximumWorld,S=this.directions,Y=this.vectorsWorld,g=this.vectors;if(h.isIdentity()){V.l(this.minimum),i.l(this.maximum);for(let h=0;h<8;++h)Y[h].l(g[h]);this.extendSizeWorld.l(this.extendSize),this.centerWorld.l(this.center)}else{V.Iq(Number.MAX_VALUE),i.Iq(-Number.MAX_VALUE);for(let S=0;S<8;++S){const q=Y[S];l.nV.TransformCoordinatesToRef(g[S],h,q),V.minimizeInPlace(q),i.maximizeInPlace(q)}i.subtractToRef(V,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(V,this.centerWorld).scaleInPlace(.5)}l.nV.FromArrayToRef(h.m,0,S[0]),l.nV.FromArrayToRef(h.m,4,S[1]),l.nV.FromArrayToRef(h.m,8,S[2]),this._worldMatrix=h}isInFrustum(h){return g.IsInFrustum(this.vectorsWorld,h)}isCompletelyInFrustum(h){return g.IsCompletelyInFrustum(this.vectorsWorld,h)}intersectsPoint(h){const V=this.minimumWorld,i=this.maximumWorld,S=V.x,l=V.y,g=V.z,q=i.x,B=i.y,J=i.z,I=h.x,v=h.y,s=h.z,t=-Y.c;return!(q-I<t||t>I-S)&&(!(B-v<t||t>v-l)&&!(J-s<t||t>s-g))}intersectsSphere(h){return g.IntersectsSphere(this.minimumWorld,this.maximumWorld,h.centerWorld,h.radiusWorld)}intersectsMinMax(h,V){const i=this.minimumWorld,S=this.maximumWorld,l=i.x,Y=i.y,g=i.z,q=S.x,B=S.y,J=S.z,I=h.x,v=h.y,s=h.z,t=V.x,T=V.y,e=V.z;return!(q<I||l>t)&&(!(B<v||Y>T)&&!(J<s||g>e))}dispose(){var h,V;null===(h=this._drawWrapperFront)||void 0===h||h.dispose(),null===(V=this._drawWrapperBack)||void 0===V||V.dispose()}static Intersects(h,V){return h.intersectsMinMax(V.minimumWorld,V.maximumWorld)}static IntersectsSphere(h,V,i,S){const Y=g._TmpVector3[0];l.nV.ClampToRef(i,h,V,Y);return l.nV.DistanceSquared(i,Y)<=S*S}static IsCompletelyInFrustum(h,V){for(let i=0;i<6;++i){const S=V[i];for(let V=0;V<8;++V)if(S.dotCoordinate(h[V])<0)return!1}return!0}static IsInFrustum(h,V){for(let i=0;i<6;++i){let S=!0;const l=V[i];for(let V=0;V<8;++V)if(l.dotCoordinate(h[V])>=0){S=!1;break}if(S)return!1}return!0}}g._TmpVector3=(0,S.c)(3,l.nV.Zero)},11481:(h,V,i)=>{i.d(V,{e:()=>v});var S=i(11156),l=i(11138),Y=i(11488),g=i(11491);const q={min:0,max:0},B={min:0,max:0},J=(h,V,i)=>{const S=l.nV.Dot(V.centerWorld,h),Y=Math.abs(l.nV.Dot(V.directions[0],h))*V.extendSize.x+Math.abs(l.nV.Dot(V.directions[1],h))*V.extendSize.y+Math.abs(l.nV.Dot(V.directions[2],h))*V.extendSize.z;i.min=S-Y,i.max=S+Y},I=(h,V,i)=>(J(h,V,q),J(h,i,B),!(q.min>B.max||B.min>q.max));class v{constructor(h,V,i){this._isLocked=!1,this.boundingBox=new Y.e(h,V,i),this.boundingSphere=new g.c(h,V,i)}reConstruct(h,V,i){this.boundingBox.reConstruct(h,V,i),this.boundingSphere.reConstruct(h,V,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(h){this._isLocked=h}update(h){this._isLocked||(this.boundingBox._update(h),this.boundingSphere._update(h))}centerOn(h,V){const i=v._TmpVector3[0].l(h).mI(V),S=v._TmpVector3[1].l(h).addInPlace(V);return this.boundingBox.reConstruct(i,S,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,S,this.boundingBox.getWorldMatrix()),this}encapsulate(h){const V=l.nV.Minimize(this.minimum,h),i=l.nV.Maximize(this.maximum,h);return this.reConstruct(V,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(h){const V=l.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(V);const i=l.TmpVectors.nV[0];return l.nV.TransformCoordinatesToRef(h.boundingBox.minimumWorld,V,i),this.encapsulate(i),l.nV.TransformCoordinatesToRef(h.boundingBox.maximumWorld,V,i),this.encapsulate(i),this}scale(h){return this.boundingBox.scale(h),this.boundingSphere.scale(h),this}isInFrustum(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===V||3===V)&&this.boundingSphere.isCenterInFrustum(h))return!0;if(!this.boundingSphere.isInFrustum(h))return!1;return!(1!==V&&3!==V)||this.boundingBox.isInFrustum(h)}get diagonalLength(){const h=this.boundingBox;return h.maximumWorld.subtractToRef(h.minimumWorld,v._TmpVector3[0]).length()}isCompletelyInFrustum(h){return this.boundingBox.isCompletelyInFrustum(h)}_checkCollision(h){return h._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(h){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(h)&&!!this.boundingBox.intersectsPoint(h))}intersects(h,V){if(!g.c.Intersects(this.boundingSphere,h.boundingSphere))return!1;if(!Y.e.Intersects(this.boundingBox,h.boundingBox))return!1;if(!V)return!0;const i=this.boundingBox,S=h.boundingBox;return!!I(i.directions[0],i,S)&&(!!I(i.directions[1],i,S)&&(!!I(i.directions[2],i,S)&&(!!I(S.directions[0],i,S)&&(!!I(S.directions[1],i,S)&&(!!I(S.directions[2],i,S)&&(!!I(l.nV.Cross(i.directions[0],S.directions[0]),i,S)&&(!!I(l.nV.Cross(i.directions[0],S.directions[1]),i,S)&&(!!I(l.nV.Cross(i.directions[0],S.directions[2]),i,S)&&(!!I(l.nV.Cross(i.directions[1],S.directions[0]),i,S)&&(!!I(l.nV.Cross(i.directions[1],S.directions[1]),i,S)&&(!!I(l.nV.Cross(i.directions[1],S.directions[2]),i,S)&&(!!I(l.nV.Cross(i.directions[2],S.directions[0]),i,S)&&(!!I(l.nV.Cross(i.directions[2],S.directions[1]),i,S)&&!!I(l.nV.Cross(i.directions[2],S.directions[2]),i,S))))))))))))))}}v._TmpVector3=(0,S.c)(2,l.nV.Zero)},11491:(h,V,i)=>{i.d(V,{c:()=>Y});var S=i(11156),l=i(11138);class Y{constructor(h,V,i){this.center=l.nV.Zero(),this.centerWorld=l.nV.Zero(),this.minimum=l.nV.Zero(),this.maximum=l.nV.Zero(),this.reConstruct(h,V,i)}reConstruct(h,V,i){this.minimum.l(h),this.maximum.l(V);const S=l.nV.Distance(h,V);V.addToRef(h,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(i||l.Matrix.IdentityReadOnly)}scale(h){const V=this.radius*h,i=Y._TmpVector3,S=i[0].Iq(V),l=this.center.subtractToRef(S,i[1]),g=this.center.addToRef(S,i[2]);return this.reConstruct(l,g,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){if(h.isIdentity())this.centerWorld.l(this.center),this.radiusWorld=this.radius;else{l.nV.TransformCoordinatesToRef(this.center,h,this.centerWorld);const V=Y._TmpVector3[0];l.nV.TransformNormalFromFloatsToRef(1,1,1,h,V),this.radiusWorld=Math.max(Math.abs(V.x),Math.abs(V.y),Math.abs(V.z))*this.radius}}isInFrustum(h){const V=this.centerWorld,i=this.radiusWorld;for(let S=0;S<6;S++)if(h[S].dotCoordinate(V)<=-i)return!1;return!0}isCenterInFrustum(h){const V=this.centerWorld;for(let i=0;i<6;i++)if(h[i].dotCoordinate(V)<0)return!1;return!0}intersectsPoint(h){const V=l.nV.DistanceSquared(this.centerWorld,h);return!(this.radiusWorld*this.radiusWorld<V)}static Intersects(h,V){const i=l.nV.DistanceSquared(h.centerWorld,V.centerWorld),S=h.radiusWorld+V.radiusWorld;return!(S*S<i)}static CreateFromCenterAndRadius(h,V,i){this._TmpVector3[0].l(h),this._TmpVector3[1].qq(0,0,V),this._TmpVector3[2].l(h),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].mI(this._TmpVector3[1]);const S=new Y(this._TmpVector3[0],this._TmpVector3[2]);return S._worldMatrix=i||l.Matrix.Identity(),S}}Y._TmpVector3=(0,S.c)(3,l.nV.Zero)},11504:(h,V,i)=>{function S(h){-1===h.indexOf("vClipPlane")&&h.push("vClipPlane"),-1===h.indexOf("vClipPlane2")&&h.push("vClipPlane2"),-1===h.indexOf("vClipPlane3")&&h.push("vClipPlane3"),-1===h.indexOf("vClipPlane4")&&h.push("vClipPlane4"),-1===h.indexOf("vClipPlane5")&&h.push("vClipPlane5"),-1===h.indexOf("vClipPlane6")&&h.push("vClipPlane6")}function l(h,V,i){const S=!!(h.clipPlane??V.clipPlane),l=!!(h.clipPlane2??V.clipPlane2),Y=!!(h.clipPlane3??V.clipPlane3),g=!!(h.clipPlane4??V.clipPlane4),q=!!(h.clipPlane5??V.clipPlane5),B=!!(h.clipPlane6??V.clipPlane6);S&&i.push("#define CLIPPLANE"),l&&i.push("#define CLIPPLANE2"),Y&&i.push("#define CLIPPLANE3"),g&&i.push("#define CLIPPLANE4"),q&&i.push("#define CLIPPLANE5"),B&&i.push("#define CLIPPLANE6")}function Y(h,V,i){let S=!1;const l=!!(h.clipPlane??V.clipPlane),Y=!!(h.clipPlane2??V.clipPlane2),g=!!(h.clipPlane3??V.clipPlane3),q=!!(h.clipPlane4??V.clipPlane4),B=!!(h.clipPlane5??V.clipPlane5),J=!!(h.clipPlane6??V.clipPlane6);return i.CLIPPLANE!==l&&(i.CLIPPLANE=l,S=!0),i.CLIPPLANE2!==Y&&(i.CLIPPLANE2=Y,S=!0),i.CLIPPLANE3!==g&&(i.CLIPPLANE3=g,S=!0),i.CLIPPLANE4!==q&&(i.CLIPPLANE4=q,S=!0),i.CLIPPLANE5!==B&&(i.CLIPPLANE5=B,S=!0),i.CLIPPLANE6!==J&&(i.CLIPPLANE6=J,S=!0),S}function g(h,V,i){let S=V.clipPlane??i.clipPlane;q(h,"vClipPlane",S),S=V.clipPlane2??i.clipPlane2,q(h,"vClipPlane2",S),S=V.clipPlane3??i.clipPlane3,q(h,"vClipPlane3",S),S=V.clipPlane4??i.clipPlane4,q(h,"vClipPlane4",S),S=V.clipPlane5??i.clipPlane5,q(h,"vClipPlane5",S),S=V.clipPlane6??i.clipPlane6,q(h,"vClipPlane6",S)}function q(h,V,i){i&&h.setFloat4(V,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(V,{d:()=>S,g:()=>g,k:()=>Y,o:()=>l})},11450:(h,V,i)=>{i.d(V,{d:()=>S});class S{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(h,V){this._defines[h]||(h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h),this._defines[h]=new Array),this._defines[h].push(V)}addCPUSkinningFallback(h,V){this._mesh=V,h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(h,V){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,h=h.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),V._bonesComputationForcedToCPU=!0;const i=this._mesh.Mh();for(let h=0;h<i.meshes.length;h++){const S=i.meshes[h];if(S.material){if(S.computeBonesUsingShaders&&0!==S.numBoneInfluencers)if(S.material.getEffect()===V)S.computeBonesUsingShaders=!1;else if(S.Gg)for(const h of S.Gg){if(h.effect===V){S.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&S.computeBonesUsingShaders&&S.numBoneInfluencers>0&&(S.computeBonesUsingShaders=!1)}}else{const V=this._defines[this._currentRank];if(V)for(let i=0;i<V.length;i++)h=h.replace("#define "+V[i],"");this._currentRank++}return h}}},11459:(h,V,i)=>{i.d(V,{e:()=>n});var S=i(11123),l=i(11127),Y=i(10952),g=i(10960),q=i(10988),B=i(11466),J=i(11403),I=i(10967),v=i(11198),s=i(11271),t=i(11179);class T{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(h){this._func=h}get funcRef(){return this._funcRef}set funcRef(h){this._funcRef=h}get funcMask(){return this._funcMask}set funcMask(h){this._funcMask=h}get opStencilFail(){return this._opStencilFail}set opStencilFail(h){this._opStencilFail=h}get opDepthFail(){return this._opDepthFail}set opDepthFail(h){this._opDepthFail=h}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(h){this._opStencilDepthPass=h}get mask(){return this._mask}set mask(h){this._mask=h}get enabled(){return this._enabled}set enabled(h){this._enabled=h}getClassName(){return"MaterialStencilState"}copyTo(h){t.d.Clone((()=>h),this)}serialize(){return t.d.Serialize(this)}parse(h,V,i){t.d.Parse((()=>this),h,V,i)}}(0,S.b)([(0,l.E)()],T.prototype,"func",null),(0,S.b)([(0,l.E)()],T.prototype,"funcRef",null),(0,S.b)([(0,l.E)()],T.prototype,"funcMask",null),(0,S.b)([(0,l.E)()],T.prototype,"opStencilFail",null),(0,S.b)([(0,l.E)()],T.prototype,"opDepthFail",null),(0,S.b)([(0,l.E)()],T.prototype,"opStencilDepthPass",null),(0,S.b)([(0,l.E)()],T.prototype,"mask",null),(0,S.b)([(0,l.E)()],T.prototype,"enabled",null);var e=i(11501);class n{get _supportGlowLayer(){return!1}set _glowModeEnabled(h){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(h){if(this._alpha===h)return;const V=this._alpha;this._alpha=h,1!==V&&1!==h||this.LJ(n.MiscDirtyFlag+n.PrePassDirtyFlag)}get alpha(){return this._alpha}set Kg(h){this._backFaceCulling!==h&&(this._backFaceCulling=h,this.LJ(n.TextureDirtyFlag))}get Kg(){return this._backFaceCulling}set cullBackFaces(h){this._cullBackFaces!==h&&(this._cullBackFaces=h,this.LJ(n.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(h){this._blockDirtyMechanism!==h&&(this._blockDirtyMechanism=h,h||this.fv())}atomicMaterialsUpdate(h){this.blockDirtyMechanism=!0;try{h(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(h){this._onDisposeObserver&&this.Ig.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ig.add(h)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new g.d),this._onBindObservable}set onBind(h){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(h)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new g.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new g.d),this._onEffectCreatedObservable}set alphaMode(h){this._alphaMode!==h&&(this._alphaMode=h,this.LJ(n.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(h){this._needDepthPrePass!==h&&(this._needDepthPrePass=h,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(h){this._fogEnabled!==h&&(this._fogEnabled=h,this.LJ(n.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case n.WireFrameFillMode:case n.LineListDrawMode:case n.LineLoopDrawMode:case n.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(h){this.fillMode=h?n.WireFrameFillMode:n.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case n.PointFillMode:case n.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(h){this.fillMode=h?n.PointFillMode:n.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(h){this._fillMode!==h&&(this._fillMode=h,this.LJ(n.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){const V=this.Mh().getEngine().getCaps().fragmentDepthSupported;h&&!V&&I.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=h&&V,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(h){this._drawWrapper=h}constructor(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Ig=new g.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new T,this._useUBO=!1,this._fillMode=n.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=h;const l=V||q.d.LastCreatedScene;l&&(this._scene=l,this._dirtyCallbacks={},this._forceGLSL=S,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=h||Y.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new s.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,h),this._useUBO=this.Mh().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),n.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var h;const V=this.Mh().getEngine();null===(h=this._uniformBuffer)||void 0===h||h.dispose(),V.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new J.c(V,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(h){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.fv(),this.checkReadyOnlyOnce=!0}unfreeze(){this.fv(),this.checkReadyOnlyOnce=!1}isReady(h,V){return!0}isReadyForSubMesh(h,V,i){const S=V.materialDefines;return!!S&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=S,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Mh(){return this._scene}_getEffectiveOrientation(h){return null!==this.sideOrientation?this.sideOrientation:h.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(h){this._transparencyMode!==h&&(this._transparencyMode=h,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===n.MATERIAL_ALPHABLEND||this._transparencyMode===n.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===n.MATERIAL_ALPHATEST||this._transparencyMode===n.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===n.MATERIAL_OPAQUE||this._transparencyMode===n.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsBlend:h.visibility<1||!this._disableAlphaBlending&&(h.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(h)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}fv(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const V=this.Mh().meshes;for(const i of V)if(i.Gg)for(const V of i.Gg)if(V.Zh()===this)for(const i of V._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=h);h&&this.LJ(n.AllDirtyFlag)}_preBind(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.getEngine(),S=(null==V?this.sideOrientation:V)===n.ClockWiseSideOrientation;return i.enableEffect(h||this._getDrawWrapper()),i.setState(this.Kg,this.zOffset,!1,S,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),S}bind(h,V){}buildUniformLayout(){const h=this._uniformBuffer;this._eventInfo.ubo=h,this._callbackPluginEventGeneric(8,this._eventInfo),h.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(h,V,i){const S=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),S._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(h){}bindView(h){this._useUBO?this._needToBindSceneUbo=!0:h.setMatrix("view",this.Mh().getViewMatrix())}bindViewProjection(h){this._useUBO?this._needToBindSceneUbo=!0:(h.setMatrix("viewProjection",this.Mh().getTransformMatrix()),h.setMatrix("projection",this.Mh().getProjectionMatrix()))}bindEyePosition(h,V){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(h,V)}_afterBind(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&V&&(this._needToBindSceneUbo=!1,(0,e.o)(V,this.Mh().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=h?h.visibility:1,this._onBindObservable&&h&&this._onBindObservable.notifyObservers(h),this.disableDepthWrite){const h=this._scene.getEngine();this._cachedDepthWriteState=h.getDepthWrite(),h.setDepthWrite(!1)}if(this.disableColorWrite){const h=this._scene.getEngine();this._cachedColorWriteState=h.getColorWrite(),h.setColorWrite(!1)}if(0!==this.depthFunction){const h=this._scene.getEngine();this._cachedDepthFunctionState=h.getDepthFunction()||0,h.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(h){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=h,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(h){return null}_clonePlugins(h,V){const i={};if(this._serializePlugins(i),n._ParsePlugins(i,h,this._scene,V),this.pluginManager)for(const S of this.pluginManager._plugins){const V=h.pluginManager.getPlugin(S.name);V&&S.copyTo(V)}}getBindedMeshes(){if(this.meshMap){const h=[];for(const V in this.meshMap){const i=this.meshMap[V];i&&h.push(i)}return h}return this._scene.meshes.filter((h=>h.material===this))}forceCompilation(h,V,i,S){const l={clipPlane:!1,useInstances:!1,...i},Y=this.Mh(),g=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const q=()=>{if(!this._scene||!this._scene.getEngine())return;const i=Y.clipPlane;if(l.clipPlane&&(Y.clipPlane=new v.b(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,Y=null;if(h.Gg){const V=new B.e(0,0,0,0,0,h,void 0,!1,!1);V.materialDefines&&(V.materialDefines._renderId=-1),this.isReadyForSubMesh(h,V,l.useInstances)||(V.effect&&V.effect.getCompilationError()&&V.effect.allFallbacksProcessed()?Y=V.effect.getCompilationError():(i=!1,setTimeout(q,16)))}i&&(this.allowShaderHotSwapping=g,Y&&S&&S(Y),V&&V(this))}else this.isReady()?(this.allowShaderHotSwapping=g,V&&V(this)):setTimeout(q,16);l.clipPlane&&(Y.clipPlane=i)};q()}async forceCompilationAsync(h,V){return await new Promise(((i,S)=>{this.forceCompilation(h,(()=>{i()}),V,(h=>{S(h)}))}))}LJ(h){this.Mh().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(n._DirtyCallbackArray.length=0,h&n.ImageProcessingDirtyFlag&&n._DirtyCallbackArray.push(n._ImageProcessingDirtyCallBack),h&n.TextureDirtyFlag&&n._DirtyCallbackArray.push(n._TextureDirtyCallBack),h&n.LightDirtyFlag&&n._DirtyCallbackArray.push(n._LightsDirtyCallBack),h&n.FresnelDirtyFlag&&n._DirtyCallbackArray.push(n._FresnelDirtyCallBack),h&n.AttributesDirtyFlag&&n._DirtyCallbackArray.push(n._AttributeDirtyCallBack),h&n.MiscDirtyFlag&&n._DirtyCallbackArray.push(n._MiscDirtyCallBack),h&n.PrePassDirtyFlag&&n._DirtyCallbackArray.push(n._PrePassDirtyCallBack),n._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(n._RunDirtyCallBacks),this.Mh().resetCachedMaterial())}resetDrawCache(){const h=this.Mh().meshes;for(const V of h)if(V.Gg)for(const h of V.Gg)h.Zh()===this&&h.resetDrawCache()}_markAllSubMeshesAsDirty(h){const V=this.Mh();if(V.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=V.meshes;for(const S of i)if(S.Gg)for(const i of S.Gg){if((i.Zh()||(V._hasDefaultMaterial?V.defaultMaterial:null))===this)for(const V of i._drawWrappers)V&&V.defines&&V.defines.markAllAsDirty&&this._materialContext===V.materialContext&&h(V.defines)}}_markScenePrePassDirty(){if(this.Mh().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const h=this.Mh().enablePrePassRenderer();h&&h.LJ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(n._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(n._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(n._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(n._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(n._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(n._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(n._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(n._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(n._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(n._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const h=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Ig.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(h)}))}}setPrePassRenderer(h){return!1}dispose(h,V,i){const S=this.Mh();if(S.stopAnimation(this),S.freeProcessedMaterials(),S.removeMaterial(this),this._eventInfo.forceDisposeTextures=V,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const h=this._parentContainer.materials.indexOf(this);h>-1&&this._parentContainer.materials.splice(h,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const l in this.meshMap){const h=this.meshMap[l];this._disposeMeshResources(h)}else{const h=S.meshes;for(const V of h)this._disposeMeshResources(V)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Ig.notifyObservers(this),this.Ig.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(h){if(!h)return;const V=h.bg,i=h._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(h.Gg&&i)for(const l of h.Gg){const h=l._drawWrappers;for(let Y=0;Y<h.length;Y++){var S;const g=null===(S=h[Y])||void 0===S?void 0:S.effect;if(!g)continue;i[Y]===this&&(null===V||void 0===V||V._releaseVertexArrayObject(g),l._removeDrawWrapper(Y,!0,!0))}}}else null===V||void 0===V||V._releaseVertexArrayObject(this._drawWrapper.effect);h.material!==this||h.sourceMesh||(h.material=null)}serialize(){const h=t.d.Serialize(this);return h.stencil=this.stencil.serialize(),h.uniqueId=this.uniqueId,this._serializePlugins(h),h}_serializePlugins(h){if(h.plugins={},this.pluginManager)for(const V of this.pluginManager._plugins)V.doNotSerialize||(h.plugins[V.getClassName()]=V.serialize())}static Parse(h,V,i){if(h.customType){if("BABYLON.PBRMaterial"===h.customType&&h.overloadedAlbedo&&(h.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return I.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else h.customType="BABYLON.StandardMaterial";const S=Y.Tools.Instantiate(h.customType).Parse(h,V,i);return S._loadedUniqueId=h.uniqueId,S}static _ParsePlugins(h,V,i,S){if(h.plugins)for(const q in h.plugins){var l,g;const B=h.plugins[q];let J=null===(l=V.pluginManager)||void 0===l?void 0:l.getPlugin(B.name);if(!J){const h=Y.Tools.Instantiate("BABYLON."+q);h&&(J=new h(V))}null===(g=J)||void 0===g||g.parse(B,i,S)}}}n.TriangleFillMode=0,n.WireFrameFillMode=1,n.PointFillMode=2,n.PointListDrawMode=3,n.LineListDrawMode=4,n.LineLoopDrawMode=5,n.LineStripDrawMode=6,n.TriangleStripDrawMode=7,n.TriangleFanDrawMode=8,n.ClockWiseSideOrientation=0,n.CounterClockWiseSideOrientation=1,n.ImageProcessingDirtyFlag=64,n.TextureDirtyFlag=1,n.LightDirtyFlag=2,n.FresnelDirtyFlag=4,n.AttributesDirtyFlag=8,n.MiscDirtyFlag=16,n.PrePassDirtyFlag=32,n.AllDirtyFlag=127,n.MATERIAL_OPAQUE=0,n.MATERIAL_ALPHATEST=1,n.MATERIAL_ALPHABLEND=2,n.MATERIAL_ALPHATESTANDBLEND=3,n.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,n.MATERIAL_NORMALBLENDMETHOD_RNM=1,n.OnEventObservable=new g.d,n._AllDirtyCallBack=h=>h.markAllAsDirty(),n._ImageProcessingDirtyCallBack=h=>h.markAsImageProcessingDirty(),n._TextureDirtyCallBack=h=>h.markAsTexturesDirty(),n._FresnelDirtyCallBack=h=>h.markAsFresnelDirty(),n._MiscDirtyCallBack=h=>h.markAsMiscDirty(),n._PrePassDirtyCallBack=h=>h.markAsPrePassDirty(),n._LightsDirtyCallBack=h=>h.markAsLightDirty(),n._AttributeDirtyCallBack=h=>h.markAsAttributesDirty(),n._FresnelAndMiscDirtyCallBack=h=>{n._FresnelDirtyCallBack(h),n._MiscDirtyCallBack(h)},n._TextureAndMiscDirtyCallBack=h=>{n._TextureDirtyCallBack(h),n._MiscDirtyCallBack(h)},n._DirtyCallbackArray=[],n._RunDirtyCallBacks=h=>{for(const V of n._DirtyCallbackArray)V(h)},(0,S.b)([(0,l.E)()],n.prototype,"id",void 0),(0,S.b)([(0,l.E)()],n.prototype,"uniqueId",void 0),(0,S.b)([(0,l.E)()],n.prototype,"name",void 0),(0,S.b)([(0,l.E)()],n.prototype,"metadata",void 0),(0,S.b)([(0,l.E)()],n.prototype,"checkReadyOnEveryCall",void 0),(0,S.b)([(0,l.E)()],n.prototype,"checkReadyOnlyOnce",void 0),(0,S.b)([(0,l.E)()],n.prototype,"state",void 0),(0,S.b)([(0,l.E)("alpha")],n.prototype,"_alpha",void 0),(0,S.b)([(0,l.E)("Kg")],n.prototype,"_backFaceCulling",void 0),(0,S.b)([(0,l.E)("cullBackFaces")],n.prototype,"_cullBackFaces",void 0),(0,S.b)([(0,l.E)()],n.prototype,"sideOrientation",void 0),(0,S.b)([(0,l.E)("alphaMode")],n.prototype,"_alphaMode",void 0),(0,S.b)([(0,l.E)()],n.prototype,"_needDepthPrePass",void 0),(0,S.b)([(0,l.E)()],n.prototype,"disableDepthWrite",void 0),(0,S.b)([(0,l.E)()],n.prototype,"disableColorWrite",void 0),(0,S.b)([(0,l.E)()],n.prototype,"forceDepthWrite",void 0),(0,S.b)([(0,l.E)()],n.prototype,"depthFunction",void 0),(0,S.b)([(0,l.E)()],n.prototype,"separateCullingPass",void 0),(0,S.b)([(0,l.E)("fogEnabled")],n.prototype,"_fogEnabled",void 0),(0,S.b)([(0,l.E)()],n.prototype,"pointSize",void 0),(0,S.b)([(0,l.E)()],n.prototype,"zOffset",void 0),(0,S.b)([(0,l.E)()],n.prototype,"zOffsetUnits",void 0),(0,S.b)([(0,l.E)()],n.prototype,"pointsCloud",null),(0,S.b)([(0,l.E)()],n.prototype,"fillMode",null),(0,S.b)([(0,l.E)()],n.prototype,"useLogarithmicDepth",null),(0,S.b)([(0,l.E)()],n.prototype,"transparencyMode",null)},11501:(h,V,i)=>{i.d(V,{$:()=>T,A:()=>D,B:()=>O,C:()=>t,D:()=>s,E:()=>j,I:()=>H,J:()=>F,N:()=>c,P:()=>M,S:()=>m,V:()=>G,W:()=>w,_:()=>r,b:()=>L,e:()=>v,g:()=>X,j:()=>I,n:()=>e,o:()=>n,s:()=>f,u:()=>o,y:()=>P});var S=i(10967),l=i(11189),Y=i(10988),g=i(11442),q=i(11504);const B=l.LV.Black(),J={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function I(h,V,i){if(!h||h.LOGARITHMICDEPTH||h.indexOf&&h.indexOf("LOGARITHMICDEPTH")>=0){const h=i.activeCamera;1===h.mode&&S.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),V.setFloat("logarithmicDepthConstant",2/(Math.log(h.maxZ+1)/Math.LN2))}}function v(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&h.fogEnabled&&(!V||V.applyFog)&&0!==h.fogMode&&(i.setFloat4("vFogInfos",h.fogMode,h.fogStart,h.fogEnd,h.fogDensity),S?(h.fogColor.toLinearSpaceToRef(B,h.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",B)):i.setColor3("vFogColor",h.fogColor))}function s(h,V,i,S,l,Y,g,q,B,I){const v=h.numMaxInfluencers||h.numInfluencers;return v<=0?0:(V.push("#define MORPHTARGETS"),h.hasPositions&&V.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),h.hasNormals&&V.push("#define MORPHTARGETTEXTURE_HASNORMALS"),h.hasTangents&&V.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),h.hasUVs&&V.push("#define MORPHTARGETTEXTURE_HASUVS"),h.hasUV2s&&V.push("#define MORPHTARGETTEXTURE_HASUV2S"),h.hasColors&&V.push("#define MORPHTARGETTEXTURE_HASCOLORS"),h.supportsPositions&&l&&V.push("#define MORPHTARGETS_POSITION"),h.supportsNormals&&Y&&V.push("#define MORPHTARGETS_NORMAL"),h.supportsTangents&&g&&V.push("#define MORPHTARGETS_TANGENT"),h.supportsUVs&&q&&V.push("#define MORPHTARGETS_UV"),h.supportsUV2s&&B&&V.push("#define MORPHTARGETS_UV2"),h.supportsColors&&I&&V.push("#define MORPHTARGETS_COLOR"),V.push("#define NUM_MORPH_INFLUENCERS "+v),h.isUsingTextureForTargets&&V.push("#define MORPHTARGETS_TEXTURE"),J.NUM_MORPH_INFLUENCERS=v,J.NORMAL=Y,J.TANGENT=g,J.UV=q,J.UV2=B,J.COLOR=I,t(i,S,J,l),v)}function t(h,V,i){let l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=i.NUM_MORPH_INFLUENCERS;if(g>0&&Y.d.LastCreatedEngine){const q=Y.d.LastCreatedEngine.getCaps().maxVertexAttribs,B=V.morphTargetManager;if(null!==B&&void 0!==B&&B.isUsingTextureForTargets)return;const J=B&&B.supportsPositions&&l,I=B&&B.supportsNormals&&i.NORMAL,v=B&&B.supportsTangents&&i.TANGENT,s=B&&B.supportsUVs&&i.UV1,t=B&&B.supportsUV2s&&i.UV2,T=B&&B.supportsColors&&i.VERTEXCOLOR;for(let i=0;i<g;i++)J&&h.push("position"+i),I&&h.push("normal"+i),v&&h.push("tangent"+i),s&&h.push("uv_"+i),t&&h.push("uv2_"+i),T&&h.push("color"+i),h.length>q&&S.d.Error("Cannot add more vertex attributes for mesh "+V.name)}}function T(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"),V&&(h.push("previousWorld0"),h.push("previousWorld1"),h.push("previousWorld2"),h.push("previousWorld3"))}function e(h,V){const i=h.morphTargetManager;h&&i&&V.setFloatArray("morphTargetInfluences",i.influences)}function n(h,V){V.bindToEffect(h,"Scene")}function c(h,V,i){V._needUVs=!0,V[i]=!0,h.optimizeUVAllocation&&h.getTextureMatrix().isIdentityAs3x2()?(V[i+"DIRECTUV"]=h.coordinatesIndex+1,V["MAINUV"+(h.coordinatesIndex+1)]=!0):V[i+"DIRECTUV"]=0}function f(h,V,i){const S=h.getTextureMatrix();V.xg(i+"Matrix",S)}function P(h,V,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&h.push("bakedVertexAnimationSettingsInstanced")}function L(h,V,i){var S;if(V&&h&&(h.computeBonesUsingShaders&&V._bonesComputationForcedToCPU&&(h.computeBonesUsingShaders=!1),h.useBones&&h.computeBonesUsingShaders&&h.skeleton)){const l=h.skeleton;if(l.isUsingTextureForMatrices&&V.getUniformIndex("boneTextureWidth")>-1){const i=l.getTransformMatrixTexture(h);V.setTexture("boneSampler",i),V.setFloat("boneTextureWidth",4*(l.bones.length+1))}else{const Y=l.getTransformMatrices(h);Y&&(V.setMatrices("mBones",Y),i&&h.Mh().prePassRenderer&&h.Mh().prePassRenderer.getIndex(2)&&(i.previousBones[h.uniqueId]||(i.previousBones[h.uniqueId]=Y.slice()),V.setMatrices("mPreviousBones",i.previousBones[h.uniqueId]),S=Y,i.previousBones[h.uniqueId].set(S)))}}}function U(h,V,i,S,l){let Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];h._bindLight(V,i,S,l,Y)}function X(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Y=Math.min(V.lightSources.length,l);for(let g=0;g<Y;g++){U(V.lightSources[g],g,h,i,"boolean"===typeof S?S:S.SPECULARTERM,V.receiveShadows)}}function D(h,V,i,S){i.NUM_BONE_INFLUENCERS>0&&(S.addCPUSkinningFallback(0,V),h.push("matricesIndices"),h.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(h.push("matricesIndicesExtra"),h.push("matricesWeightsExtra")))}function O(h,V){(V.INSTANCES||V.THIN_INSTANCES)&&T(h,!!V.PREPASS_VELOCITY),V.INSTANCESCOLOR&&h.push("instanceColor")}function o(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=0;for(let Y=0;Y<i&&h["LIGHT"+Y];Y++)Y>0&&(l=S+Y,V.addFallback(l,"LIGHT"+Y)),h.SHADOWS||(h["SHADOW"+Y]&&V.addFallback(S,"SHADOW"+Y),h["SHADOWPCF"+Y]&&V.addFallback(S,"SHADOWPCF"+Y),h["SHADOWPCSS"+Y]&&V.addFallback(S,"SHADOWPCSS"+Y),h["SHADOWPOISSON"+Y]&&V.addFallback(S,"SHADOWPOISSON"+Y),h["SHADOWESM"+Y]&&V.addFallback(S,"SHADOWESM"+Y),h["SHADOWCLOSEESM"+Y]&&V.addFallback(S,"SHADOWCLOSEESM"+Y));return l++}function M(h,V,i,S,l,Y,g){let q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];g._areMiscDirty&&(g.LOGARITHMICDEPTH=i,g.POINTSIZE=S,g.FOG=l&&function(h,V){return V.fogEnabled&&h.applyFog&&0!==V.fogMode}(h,V),g.NONUNIFORMSCALING=h.nonUniformScaling,g.ALPHATEST=Y,g.DECAL_AFTER_DETAIL=q)}function F(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i._areLightsDirty)return i._needNormals;let g=0;const q={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(h.lightsEnabled&&!Y)for(const J of V.lightSources)if(E(h,V,J,g,i,S,q),g++,g===l)break;i.SPECULARTERM=q.specularEnabled,i.SHADOWS=q.shadowEnabled;for(let J=g;J<l;J++)void 0!==i["LIGHT"+J]&&(i["LIGHT"+J]=!1,i["HEMILIGHT"+J]=!1,i["POINTLIGHT"+J]=!1,i["DIRLIGHT"+J]=!1,i["SPOTLIGHT"+J]=!1,i["AREALIGHT"+J]=!1,i["SHADOW"+J]=!1,i["SHADOWCSM"+J]=!1,i["SHADOWCSMDEBUG"+J]=!1,i["SHADOWCSMNUM_CASCADES"+J]=!1,i["SHADOWCSMUSESHADOWMAXZ"+J]=!1,i["SHADOWCSMNOBLEND"+J]=!1,i["SHADOWCSM_RIGHTHANDED"+J]=!1,i["SHADOWPCF"+J]=!1,i["SHADOWPCSS"+J]=!1,i["SHADOWPOISSON"+J]=!1,i["SHADOWESM"+J]=!1,i["SHADOWCLOSEESM"+J]=!1,i["SHADOWCUBE"+J]=!1,i["SHADOWLOWQUALITY"+J]=!1,i["SHADOWMEDIUMQUALITY"+J]=!1);const B=h.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(q.needRebuild=!0),i.SHADOWFLOAT=q.shadowEnabled&&(B.textureFloatRender&&B.textureFloatLinearFiltering||B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=q.lightmapMode,q.needRebuild&&i.rebuild(),q.needNormals}function E(h,V,i,S,l,Y,q){switch(q.needNormals=!0,void 0===l["LIGHT"+S]&&(q.needRebuild=!0),l["LIGHT"+S]=!0,l["SPOTLIGHT"+S]=!1,l["HEMILIGHT"+S]=!1,l["POINTLIGHT"+S]=!1,l["DIRLIGHT"+S]=!1,l["AREALIGHT"+S]=!1,i.prepareLightSpecificDefines(l,S),l["LIGHT_FALLOFF_PHYSICAL"+S]=!1,l["LIGHT_FALLOFF_GLTF"+S]=!1,l["LIGHT_FALLOFF_STANDARD"+S]=!1,i.falloffType){case g.c.FALLOFF_GLTF:l["LIGHT_FALLOFF_GLTF"+S]=!0;break;case g.c.FALLOFF_PHYSICAL:l["LIGHT_FALLOFF_PHYSICAL"+S]=!0;break;case g.c.FALLOFF_STANDARD:l["LIGHT_FALLOFF_STANDARD"+S]=!0}if(Y&&!i.yJ.equalsFloats(0,0,0)&&(q.specularEnabled=!0),l["SHADOW"+S]=!1,l["SHADOWCSM"+S]=!1,l["SHADOWCSMDEBUG"+S]=!1,l["SHADOWCSMNUM_CASCADES"+S]=!1,l["SHADOWCSMUSESHADOWMAXZ"+S]=!1,l["SHADOWCSMNOBLEND"+S]=!1,l["SHADOWCSM_RIGHTHANDED"+S]=!1,l["SHADOWPCF"+S]=!1,l["SHADOWPCSS"+S]=!1,l["SHADOWPOISSON"+S]=!1,l["SHADOWESM"+S]=!1,l["SHADOWCLOSEESM"+S]=!1,l["SHADOWCUBE"+S]=!1,l["SHADOWLOWQUALITY"+S]=!1,l["SHADOWMEDIUMQUALITY"+S]=!1,V&&V.receiveShadows&&h.shadowsEnabled&&i.shadowEnabled){const V=i.getShadowGenerator(h.activeCamera)??i.getShadowGenerator();if(V){const h=V.getShadowMap();h&&h.renderList&&h.renderList.length>0&&(q.shadowEnabled=!0,V.prepareDefines(l,S))}}i.lightmapMode!=g.c.LIGHTMAP_DEFAULT?(q.lightmapMode=!0,l["LIGHTMAPEXCLUDED"+S]=!0,l["LIGHTMAPNOSPECULAR"+S]=i.lightmapMode==g.c.LIGHTMAP_SHADOWSONLY):(l["LIGHTMAPEXCLUDED"+S]=!1,l["LIGHTMAPNOSPECULAR"+S]=!1)}function H(h,V,i,S,l){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=function(h,V){let i=!1;if(h.activeCamera){const S=V.CAMERA_ORTHOGRAPHIC?1:0,l=V.CAMERA_PERSPECTIVE?1:0,Y=1===h.activeCamera.mode?1:0,g=0===h.activeCamera.mode?1:0;(S^Y||l^g)&&(V.CAMERA_ORTHOGRAPHIC=1===Y,V.CAMERA_PERSPECTIVE=1===g,i=!0)}return i}(h,S);!1!==Y&&(B=(0,q.k)(i,h,S)),S.DEPTHPREPASS!==!V.getColorWrite()&&(S.DEPTHPREPASS=!S.DEPTHPREPASS,B=!0),S.INSTANCES!==l&&(S.INSTANCES=l,B=!0),S.THIN_INSTANCES!==g&&(S.THIN_INSTANCES=g,B=!0),B&&S.markAsUnprocessed()}function j(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!V._areAttributesDirty&&V._needNormals===V._normals&&V._needUVs===V._uvs)return!1;V._normals=V._needNormals,V._uvs=V._needUVs,V.NORMAL=V._needNormals&&h.isVerticesDataPresent("normal"),V._needNormals&&h.isVerticesDataPresent("tangent")&&(V.TANGENT=!0);for(let q=1;q<=6;++q)V["UV"+q]=!!V._needUVs&&h.isVerticesDataPresent(`uv${1===q?"":q}`);if(i){const i=h.useVertexColors&&h.isVerticesDataPresent("color");V.VERTEXCOLOR=i,V.VERTEXALPHA=h.hasVertexAlpha&&i&&Y}return h.isVerticesDataPresent("instanceColor")&&(h.hasInstances||h.hasThinInstances)&&(V.INSTANCESCOLOR=!0),S&&function(h,V){if(h.useBones&&h.computeBonesUsingShaders&&h.skeleton){V.NUM_BONE_INFLUENCERS=h.numBoneInfluencers;const i=void 0!==V.BONETEXTURE;if(h.skeleton.isUsingTextureForMatrices&&i)V.BONETEXTURE=!0;else{V.BonesPerMesh=h.skeleton.bones.length+1,V.BONETEXTURE=!i&&void 0;const S=h.Mh().prePassRenderer;if(S&&S.enabled){const i=-1===S.excludedSkinnedMesh.indexOf(h);V.BONES_VELOCITY_ENABLED=i}}}else V.NUM_BONE_INFLUENCERS=0,V.BonesPerMesh=0,void 0!==V.BONETEXTURE&&(V.BONETEXTURE=!1)}(h,V),l&&function(h,V){const i=h.morphTargetManager;i?(V.MORPHTARGETS_UV=i.supportsUVs&&V.UV1,V.MORPHTARGETS_UV2=i.supportsUV2s&&V.UV2,V.MORPHTARGETS_TANGENT=i.supportsTangents&&V.TANGENT,V.MORPHTARGETS_NORMAL=i.supportsNormals&&V.NORMAL,V.MORPHTARGETS_POSITION=i.supportsPositions,V.MORPHTARGETS_COLOR=i.supportsColors,V.MORPHTARGETTEXTURE_HASUVS=i.hasUVs,V.MORPHTARGETTEXTURE_HASUV2S=i.hasUV2s,V.MORPHTARGETTEXTURE_HASTANGENTS=i.hasTangents,V.MORPHTARGETTEXTURE_HASNORMALS=i.hasNormals,V.MORPHTARGETTEXTURE_HASPOSITIONS=i.hasPositions,V.MORPHTARGETTEXTURE_HASCOLORS=i.hasColors,V.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,V.MORPHTARGETS=V.NUM_MORPH_INFLUENCERS>0,V.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(V.MORPHTARGETS_UV=!1,V.MORPHTARGETS_UV2=!1,V.MORPHTARGETS_TANGENT=!1,V.MORPHTARGETS_NORMAL=!1,V.MORPHTARGETS_POSITION=!1,V.MORPHTARGETS_COLOR=!1,V.MORPHTARGETTEXTURE_HASUVS=!1,V.MORPHTARGETTEXTURE_HASUV2S=!1,V.MORPHTARGETTEXTURE_HASTANGENTS=!1,V.MORPHTARGETTEXTURE_HASNORMALS=!1,V.MORPHTARGETTEXTURE_HASPOSITIONS=!1,V.MORPHTARGETTEXTURE_HAS_COLORS=!1,V.MORPHTARGETS=!1,V.NUM_MORPH_INFLUENCERS=0)}(h,V),g&&function(h,V){const i=h.bakedVertexAnimationManager;V.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(h,V),!0}function m(h,V){if(h.activeCamera){const i=V.MULTIVIEW;V.MULTIVIEW=null!==h.activeCamera.outputRenderTarget&&h.activeCamera.outputRenderTarget.getViewCount()>1,V.MULTIVIEW!=i&&V.markAsUnprocessed()}}function G(h,V,i){const S=V.ORDER_INDEPENDENT_TRANSPARENCY,l=V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;V.ORDER_INDEPENDENT_TRANSPARENCY=h.useOrderIndependentTransparency&&i,V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!h.getEngine().getCaps().textureFloatLinearFiltering,S===V.ORDER_INDEPENDENT_TRANSPARENCY&&l===V.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||V.markAsUnprocessed()}function w(h,V,i){const S=V.PREPASS;if(!V._arePrePassDirty)return;const l=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(h.prePassRenderer&&h.prePassRenderer.enabled&&i){V.PREPASS=!0,V.SCENE_MRT_COUNT=h.prePassRenderer.mrtCount,V.PREPASS_NORMAL_WORLDSPACE=h.prePassRenderer.generateNormalsInWorldSpace,V.PREPASS_COLOR=!0,V.PREPASS_COLOR_INDEX=0;for(let i=0;i<l.length;i++){const S=h.prePassRenderer.getIndex(l[i].type);-1!==S?(V[l[i].define]=!0,V[l[i].index]=S):V[l[i].define]=!1}}else{V.PREPASS=!1;for(let h=0;h<l.length;h++)V[l[h].define]=!1}V.PREPASS!=S&&(V.markAsUnprocessed(),V.markAsImageProcessingDirty())}function N(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];l&&l.push("Light"+h),Y||(V.push("vLightData"+h,"vLightDiffuse"+h,"vLightSpecular"+h,"vLightDirection"+h,"vLightWidth"+h,"vLightHeight"+h,"vLightFalloff"+h,"vLightGround"+h,"lightMatrix"+h,"shadowsInfo"+h,"depthValues"+h),i.push("shadowTexture"+h),i.push("depthTexture"+h),V.push("viewFrustumZ"+h,"cascadeBlendFactor"+h,"lightSizeUVCorrection"+h,"depthCorrection"+h,"penumbraDarkness"+h,"frustumLengths"+h),S&&(i.push("projectionLightTexture"+h),V.push("textureProjectionMatrix"+h)),g&&i.push("iesLightTexture"+h))}function r(h,V,i){let S,l,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(h.uniformsNames){const g=h;S=g.uniformsNames,l=g.uniformBuffersNames,V=g.samplers,i=g.defines,Y=g.maxSimultaneousLights||0}else S=h,V||(V=[]);for(let g=0;g<Y&&i["LIGHT"+g];g++)N(g,S,V,i["PROJECTEDLIGHTTEXTURE"+g],l,!1,i["IESLIGHTTEXTURE"+g]);i.NUM_MORPH_INFLUENCERS&&(S.push("morphTargetInfluences"),S.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(S.push("bakedVertexAnimationSettings"),S.push("bakedVertexAnimationTextureSizeInverted"),S.push("bakedVertexAnimationTime"),V.push("bakedVertexAnimationTexture"))}},11453:(h,V,i)=>{i.d(V,{d:()=>Y});var S=i(11138),l=i(11459);class Y extends l.e{constructor(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(h,V,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new S.Matrix,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(h,V){return!!h&&(!this._storeEffectOnSubMeshes||(!h.Gg||0===h.Gg.length||this.isReadyForSubMesh(h,h.Gg[0],V)))}_isReadyForSubMesh(h){const V=h.materialDefines;return!(this.checkReadyOnEveryCall||!h.effect||!V||V._renderId!==this.Mh().getRenderId())}bindOnlyWorldMatrix(h){this._activeEffect.setMatrix("world",h)}bindOnlyNormalMatrix(h){this._activeEffect.setMatrix("normalMatrix",h)}bind(h,V){V&&this.bindForSubMesh(h,V,V.Gg[0])}_afterBind(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;super._afterBind(h,V,i),this.Mh()._cachedEffect=V,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i._drawWrapper._forceRebindOnNextCall||h.isCachedMaterialInvalid(this,V,S)}dispose(h,V,i){this._activeEffect=void 0,super.dispose(h,V,i)}}},11498:(h,V,i)=>{i.d(V,{b:()=>q,e:()=>B});var S=i(11123),l=i(11138),Y=i(11127);class g{static extractMinAndMaxIndexed(h,V,i,S,l,Y){for(let g=i;g<i+S;g++){const i=3*V[g],S=h[i],q=h[i+1],B=h[i+2];l.minimizeInPlaceFromFloats(S,q,B),Y.maximizeInPlaceFromFloats(S,q,B)}}static extractMinAndMax(h,V,i,S,l,Y){for(let g=V,q=V*S;g<V+i;g++,q+=S){const V=h[q],i=h[q+1],S=h[q+2];l.minimizeInPlaceFromFloats(V,i,S),Y.maximizeInPlaceFromFloats(V,i,S)}}}function q(h,V,i,S){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const q=new l.nV(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new l.nV(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g.extractMinAndMaxIndexed(h,V,i,S,q,B),Y&&(q.x-=q.x*Y.x+Y.y,q.y-=q.y*Y.x+Y.y,q.z-=q.z*Y.x+Y.y,B.x+=B.x*Y.x+Y.y,B.y+=B.y*Y.x+Y.y,B.z+=B.z*Y.x+Y.y),{minimum:q,maximum:B}}function B(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;const q=new l.nV(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new l.nV(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Y||(Y=3),g.extractMinAndMax(h,V,i,Y,q,B),S&&(q.x-=q.x*S.x+S.y,q.y-=q.y*S.x+S.y,q.z-=q.z*S.x+S.y,B.x+=B.x*S.x+S.y,B.y+=B.y*S.x+S.y,B.z+=B.z*S.x+S.y),{minimum:q,maximum:B}}(0,S.b)([Y.g.filter((function(){for(var h=arguments.length,V=new Array(h),i=0;i<h;i++)V[i]=arguments[i];let[S,l]=V;return!Array.isArray(S)&&!Array.isArray(l)}))],g,"extractMinAndMaxIndexed",null),(0,S.b)([Y.g.filter((function(){for(var h=arguments.length,V=new Array(h),i=0;i<h;i++)V[i]=arguments[i];let[S]=V;return!Array.isArray(S)}))],g,"extractMinAndMax",null)},11466:(h,V,i)=>{i.d(V,{e:()=>B});var S=i(11220),l=i(11474),Y=i(11481),g=i(11498),q=i(11271);class B{get materialDefines(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(h=this._getDrawWrapper())||void 0===h?void 0:h.defines}set materialDefines(h){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=h}_getDrawWrapper(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h??this._engine.currentRenderPassId;let i=this._drawWrappers[h];return!i&&V&&(this._drawWrappers[h]=i=new q.b(this._mesh.Mh().getEngine())),i}_removeDrawWrapper(h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(i=this._drawWrappers[h])||void 0===i||i.dispose(V));this._drawWrappers[h]=void 0}get effect(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(h=this._getDrawWrapper())||void 0===h?void 0:h.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(h){this._mainDrawWrapperOverride=h}setEffect(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=this._drawWrapper;l.setEffect(h,V,S),void 0!==i&&(l.materialContext=i),h||(l.defines=null,l.materialContext=void 0)}resetDrawCache(h){let V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==h)return void this._removeDrawWrapper(h,!0,V);for(const h of this._drawWrappers)null===h||void 0===h||h.dispose(V)}this._drawWrappers=[]}static AddToMesh(h,V,i,S,l,Y,g){return new B(h,V,i,S,l,Y,g,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(h,V,i,S,l,Y,g){let q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],B=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=h,this.verticesStart=V,this.verticesCount=i,this.indexStart=S,this.indexCount=l,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Y,this._renderingMesh=g||Y,B&&Y.Gg.push(this),this._engine=this._mesh.Mh().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Y.Gg.length-1,q&&(this.refreshBoundingInfo(),Y.Ag(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(h){return this._boundingInfo=h,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const h=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return h||this._renderingMesh}Zh(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const V=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!V)return h&&this._mesh.Mh()._hasDefaultMaterial?this._mesh.Mh().defaultMaterial:null;if(this._isMultiMaterial(V)){const h=V.getSubMaterial(this.materialIndex);return this._currentMaterial!==h&&(this._currentMaterial=h,this.resetDrawCache()),h}return V}_isMultiMaterial(h){return void 0!==h.getSubMaterial}refreshBoundingInfo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.bg)return this;if(h||(h=this._renderingMesh.getVerticesData(S.h.PositionKind)),!h)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const V=this._renderingMesh.ug();let i;if(0===this.indexStart&&this.indexCount===V.length){const h=this._renderingMesh.getBoundingInfo();i={minimum:h.minimum.clone(),maximum:h.maximum.clone()}}else i=(0,g.b)(h,V,this.indexStart,this.indexCount,this._renderingMesh.bg.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Y.e(i.minimum,i.maximum),this}_checkCollision(h){return this.getBoundingInfo()._checkCollision(h)}updateBoundingInfo(h){let V=this.getBoundingInfo();return V||(this.refreshBoundingInfo(),V=this.getBoundingInfo()),V&&V.update(h),this}isInFrustum(h){const V=this.getBoundingInfo();return!!V&&V.isInFrustum(h,this._mesh.AI)}isCompletelyInFrustum(h){const V=this.getBoundingInfo();return!!V&&V.isCompletelyInFrustum(h)}render(h){return this._renderingMesh.render(this,h,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(h,V){if(!this._linesIndexBuffer){const i=6*Math.floor(this.indexCount/3),S=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let l=0;if(0===h.length)for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=3)S[l++]=h,S[l++]=h+1,S[l++]=h+1,S[l++]=h+2,S[l++]=h+2,S[l++]=h;else for(let V=this.indexStart;V<this.indexStart+this.indexCount;V+=3)S[l++]=h[V],S[l++]=h[V+1],S[l++]=h[V+1],S[l++]=h[V+2],S[l++]=h[V+2],S[l++]=h[V];this._linesIndexBuffer=V.createIndexBuffer(S),this._linesIndexCount=S.length}return this._linesIndexBuffer}canIntersects(h){const V=this.getBoundingInfo();return!!V&&h.intersectsBox(V.boundingBox)}intersects(h,V,i,S,l){const Y=this.Zh();if(!Y)return null;let g=3,q=!1;switch(Y.fillMode){case 3:case 5:case 6:case 8:return null;case 7:g=1,q=!0}return 4===Y.fillMode?i.length?this._intersectLines(h,V,i,this._mesh.intersectionThreshold,S):this._intersectUnIndexedLines(h,V,i,this._mesh.intersectionThreshold,S):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(h,V,i,S,l):this._intersectTriangles(h,V,i,g,q,S,l)}_intersectLines(h,V,i,S,Y){let g=null;for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=2){const B=V[i[q]],J=V[i[q+1]],I=h.intersectionSegment(B,J,S);if(!(I<0)&&((Y||!g||I<g.distance)&&(g=new l.d(null,null,I),g.faceId=q/2,Y)))break}return g}_intersectUnIndexedLines(h,V,i,S,Y){let g=null;for(let q=this.verticesStart;q<this.verticesStart+this.verticesCount;q+=2){const i=V[q],B=V[q+1],J=h.intersectionSegment(i,B,S);if(!(J<0)&&((Y||!g||J<g.distance)&&(g=new l.d(null,null,J),g.faceId=q/2,Y)))break}return g}_intersectTriangles(h,V,i,S,l,Y,g){let q=null,B=-1;for(let J=this.indexStart;J<this.indexStart+this.indexCount-(3-S);J+=S){B++;const S=i[J],I=i[J+1],v=i[J+2];if(l&&4294967295===v){J+=2;continue}const s=V[S],t=V[I],T=V[v];if(!s||!t||!T)continue;if(g&&!g(s,t,T,h,S,I,v))continue;const e=h.intersectsTriangle(s,t,T);if(e){if(e.distance<0)continue;if((Y||!q||e.distance<q.distance)&&(q=e,q.faceId=B,Y))break}}return q}_intersectUnIndexedTriangles(h,V,i,S,l){let Y=null;for(let g=this.verticesStart;g<this.verticesStart+this.verticesCount;g+=3){const i=V[g],q=V[g+1],B=V[g+2];if(l&&!l(i,q,B,h,-1,-1,-1))continue;const J=h.intersectsTriangle(i,q,B);if(J){if(J.distance<0)continue;if((S||!Y||J.distance<Y.distance)&&(Y=J,Y.faceId=g/3,S))break}}return Y}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(h,V){const i=new B(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,h,V,!1);if(!this.IsGlobal){const h=this.getBoundingInfo();if(!h)return i;i._boundingInfo=new Y.e(h.minimum,h.maximum)}return i}dispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Mh().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const V=this._mesh.Gg.indexOf(this);this._mesh.Gg.splice(V,1),this.resetDrawCache(void 0,h)}getClassName(){return"SubMesh"}static CreateFromIndices(h,V,i,S,l){let Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=Number.MAX_VALUE,q=-Number.MAX_VALUE;const J=(l||S).ug();for(let B=V;B<V+i;B++){const h=J[B];h<g&&(g=h),h>q&&(q=h)}return new B(h,g,q-g+1,V,i,S,l,Y)}}}}]);