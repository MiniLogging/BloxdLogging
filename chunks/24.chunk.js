"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[24],{12764:(l,a,N)=>{N.d(a,{e:()=>U});class U{constructor(l,a,N){this.bu=l,this.bv=a,this.distance=N,this.faceId=0,this.subMeshId=0}}},12776:(l,a,N)=>{N.d(a,{e:()=>Z});var U=N(12457),c=N(12447),K=N(12452);class Z{constructor(l,a,N){this.vectors=(0,U.b)(8,c.ua.Zero),this.center=c.ua.Zero(),this.centerWorld=c.ua.Zero(),this.extendSize=c.ua.Zero(),this.extendSizeWorld=c.ua.Zero(),this.directions=(0,U.b)(3,c.ua.Zero),this.vectorsWorld=(0,U.b)(8,c.ua.Zero),this.minimumWorld=c.ua.Zero(),this.maximumWorld=c.ua.Zero(),this.minimum=c.ua.Zero(),this.maximum=c.ua.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(l,a,N)}reConstruct(l,a,N){const U=l.x,K=l.y,Z=l.z,w=a.x,S=a.y,T=a.z,J=this.vectors;this.minimum.tc(U,K,Z),this.maximum.tc(w,S,T),J[0].tc(U,K,Z),J[1].tc(w,S,T),J[2].tc(w,K,Z),J[3].tc(U,S,Z),J[4].tc(U,K,T),J[5].tc(w,S,Z),J[6].tc(U,S,T),J[7].tc(w,K,T),a.addToRef(l,this.center).scaleInPlace(.5),a.subtractToRef(l,this.extendSize).scaleInPlace(.5),this._worldMatrix=N||c.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(l){const a=Z._TmpVector3,N=this.maximum.subtractToRef(this.minimum,a[0]),U=N.length();N.normalizeFromLength(U);const c=U*l,K=N.scaleInPlace(.5*c),w=this.center.subtractToRef(K,a[1]),S=this.center.addToRef(K,a[2]);return this.reConstruct(w,S,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(l){const a=this.minimumWorld,N=this.maximumWorld,U=this.directions,K=this.vectorsWorld,Z=this.vectors;if(l.isIdentity()){a.K(this.minimum),N.K(this.maximum);for(let l=0;l<8;++l)K[l].K(Z[l]);this.extendSizeWorld.K(this.extendSize),this.centerWorld.K(this.center)}else{a.hc(Number.MAX_VALUE),N.hc(-Number.MAX_VALUE);for(let U=0;U<8;++U){const w=K[U];c.ua.TransformCoordinatesToRef(Z[U],l,w),a.minimizeInPlace(w),N.maximizeInPlace(w)}N.subtractToRef(a,this.extendSizeWorld).scaleInPlace(.5),N.addToRef(a,this.centerWorld).scaleInPlace(.5)}c.ua.FromArrayToRef(l.m,0,U[0]),c.ua.FromArrayToRef(l.m,4,U[1]),c.ua.FromArrayToRef(l.m,8,U[2]),this._worldMatrix=l}isInFrustum(l){return Z.IsInFrustum(this.vectorsWorld,l)}isCompletelyInFrustum(l){return Z.IsCompletelyInFrustum(this.vectorsWorld,l)}intersectsPoint(l){const a=this.minimumWorld,N=this.maximumWorld,U=a.x,c=a.y,Z=a.z,w=N.x,S=N.y,T=N.z,J=l.x,n=l.y,y=l.z,H=-K.d;return!(w-J<H||H>J-U)&&(!(S-n<H||H>n-c)&&!(T-y<H||H>y-Z))}intersectsSphere(l){return Z.IntersectsSphere(this.minimumWorld,this.maximumWorld,l.centerWorld,l.radiusWorld)}intersectsMinMax(l,a){const N=this.minimumWorld,U=this.maximumWorld,c=N.x,K=N.y,Z=N.z,w=U.x,S=U.y,T=U.z,J=l.x,n=l.y,y=l.z,H=a.x,u=a.y,W=a.z;return!(w<J||c>H)&&(!(S<n||K>u)&&!(T<y||Z>W))}dispose(){var l,a;null===(l=this._drawWrapperFront)||void 0===l||l.dispose(),null===(a=this._drawWrapperBack)||void 0===a||a.dispose()}static Intersects(l,a){return l.intersectsMinMax(a.minimumWorld,a.maximumWorld)}static IntersectsSphere(l,a,N,U){const K=Z._TmpVector3[0];c.ua.ClampToRef(N,l,a,K);return c.ua.DistanceSquared(N,K)<=U*U}static IsCompletelyInFrustum(l,a){for(let N=0;N<6;++N){const U=a[N];for(let a=0;a<8;++a)if(U.dotCoordinate(l[a])<0)return!1}return!0}static IsInFrustum(l,a){for(let N=0;N<6;++N){let U=!0;const c=a[N];for(let a=0;a<8;++a)if(c.dotCoordinate(l[a])>=0){U=!1;break}if(U)return!1}return!0}}Z._TmpVector3=(0,U.b)(3,c.ua.Zero)},12771:(l,a,N)=>{N.d(a,{b:()=>n});var U=N(12457),c=N(12447),K=N(12776),Z=N(12783);const w={min:0,max:0},S={min:0,max:0},T=(l,a,N)=>{const U=c.ua.Dot(a.centerWorld,l),K=Math.abs(c.ua.Dot(a.directions[0],l))*a.extendSize.x+Math.abs(c.ua.Dot(a.directions[1],l))*a.extendSize.y+Math.abs(c.ua.Dot(a.directions[2],l))*a.extendSize.z;N.min=U-K,N.max=U+K},J=(l,a,N)=>(T(l,a,w),T(l,N,S),!(w.min>S.max||S.min>w.max));class n{constructor(l,a,N){this._isLocked=!1,this.boundingBox=new K.e(l,a,N),this.boundingSphere=new Z.e(l,a,N)}reConstruct(l,a,N){this.boundingBox.reConstruct(l,a,N),this.boundingSphere.reConstruct(l,a,N)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(l){this._isLocked=l}update(l){this._isLocked||(this.boundingBox._update(l),this.boundingSphere._update(l))}centerOn(l,a){const N=n._TmpVector3[0].K(l).wn(a),U=n._TmpVector3[1].K(l).addInPlace(a);return this.boundingBox.reConstruct(N,U,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(N,U,this.boundingBox.getWorldMatrix()),this}encapsulate(l){const a=c.ua.Minimize(this.minimum,l),N=c.ua.Maximize(this.maximum,l);return this.reConstruct(a,N,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(l){const a=c.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(a);const N=c.TmpVectors.ua[0];return c.ua.TransformCoordinatesToRef(l.boundingBox.minimumWorld,a,N),this.encapsulate(N),c.ua.TransformCoordinatesToRef(l.boundingBox.maximumWorld,a,N),this.encapsulate(N),this}scale(l){return this.boundingBox.scale(l),this.boundingSphere.scale(l),this}isInFrustum(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===a||3===a)&&this.boundingSphere.isCenterInFrustum(l))return!0;if(!this.boundingSphere.isInFrustum(l))return!1;return!(1!==a&&3!==a)||this.boundingBox.isInFrustum(l)}get diagonalLength(){const l=this.boundingBox;return l.maximumWorld.subtractToRef(l.minimumWorld,n._TmpVector3[0]).length()}isCompletelyInFrustum(l){return this.boundingBox.isCompletelyInFrustum(l)}_checkCollision(l){return l._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(l){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(l)&&!!this.boundingBox.intersectsPoint(l))}intersects(l,a){if(!Z.e.Intersects(this.boundingSphere,l.boundingSphere))return!1;if(!K.e.Intersects(this.boundingBox,l.boundingBox))return!1;if(!a)return!0;const N=this.boundingBox,U=l.boundingBox;return!!J(N.directions[0],N,U)&&(!!J(N.directions[1],N,U)&&(!!J(N.directions[2],N,U)&&(!!J(U.directions[0],N,U)&&(!!J(U.directions[1],N,U)&&(!!J(U.directions[2],N,U)&&(!!J(c.ua.Cross(N.directions[0],U.directions[0]),N,U)&&(!!J(c.ua.Cross(N.directions[0],U.directions[1]),N,U)&&(!!J(c.ua.Cross(N.directions[0],U.directions[2]),N,U)&&(!!J(c.ua.Cross(N.directions[1],U.directions[0]),N,U)&&(!!J(c.ua.Cross(N.directions[1],U.directions[1]),N,U)&&(!!J(c.ua.Cross(N.directions[1],U.directions[2]),N,U)&&(!!J(c.ua.Cross(N.directions[2],U.directions[0]),N,U)&&(!!J(c.ua.Cross(N.directions[2],U.directions[1]),N,U)&&!!J(c.ua.Cross(N.directions[2],U.directions[2]),N,U))))))))))))))}}n._TmpVector3=(0,U.b)(2,c.ua.Zero)},12783:(l,a,N)=>{N.d(a,{e:()=>K});var U=N(12457),c=N(12447);class K{constructor(l,a,N){this.center=c.ua.Zero(),this.centerWorld=c.ua.Zero(),this.minimum=c.ua.Zero(),this.maximum=c.ua.Zero(),this.reConstruct(l,a,N)}reConstruct(l,a,N){this.minimum.K(l),this.maximum.K(a);const U=c.ua.Distance(l,a);a.addToRef(l,this.center).scaleInPlace(.5),this.radius=.5*U,this._update(N||c.Matrix.IdentityReadOnly)}scale(l){const a=this.radius*l,N=K._TmpVector3,U=N[0].hc(a),c=this.center.subtractToRef(U,N[1]),Z=this.center.addToRef(U,N[2]);return this.reConstruct(c,Z,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(l){if(l.isIdentity())this.centerWorld.K(this.center),this.radiusWorld=this.radius;else{c.ua.TransformCoordinatesToRef(this.center,l,this.centerWorld);const a=K._TmpVector3[0];c.ua.TransformNormalFromFloatsToRef(1,1,1,l,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius}}isInFrustum(l){const a=this.centerWorld,N=this.radiusWorld;for(let U=0;U<6;U++)if(l[U].dotCoordinate(a)<=-N)return!1;return!0}isCenterInFrustum(l){const a=this.centerWorld;for(let N=0;N<6;N++)if(l[N].dotCoordinate(a)<0)return!1;return!0}intersectsPoint(l){const a=c.ua.DistanceSquared(this.centerWorld,l);return!(this.radiusWorld*this.radiusWorld<a)}static Intersects(l,a){const N=c.ua.DistanceSquared(l.centerWorld,a.centerWorld),U=l.radiusWorld+a.radiusWorld;return!(U*U<N)}static CreateFromCenterAndRadius(l,a,N){this._TmpVector3[0].K(l),this._TmpVector3[1].tc(0,0,a),this._TmpVector3[2].K(l),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].wn(this._TmpVector3[1]);const U=new K(this._TmpVector3[0],this._TmpVector3[2]);return U._worldMatrix=N||c.Matrix.Identity(),U}}K._TmpVector3=(0,U.b)(3,c.ua.Zero)},12804:(l,a,N)=>{function U(l){-1===l.indexOf("vClipPlane")&&l.push("vClipPlane"),-1===l.indexOf("vClipPlane2")&&l.push("vClipPlane2"),-1===l.indexOf("vClipPlane3")&&l.push("vClipPlane3"),-1===l.indexOf("vClipPlane4")&&l.push("vClipPlane4"),-1===l.indexOf("vClipPlane5")&&l.push("vClipPlane5"),-1===l.indexOf("vClipPlane6")&&l.push("vClipPlane6")}function c(l,a,N){const U=!!(l.clipPlane??a.clipPlane),c=!!(l.clipPlane2??a.clipPlane2),K=!!(l.clipPlane3??a.clipPlane3),Z=!!(l.clipPlane4??a.clipPlane4),w=!!(l.clipPlane5??a.clipPlane5),S=!!(l.clipPlane6??a.clipPlane6);U&&N.push("#define CLIPPLANE"),c&&N.push("#define CLIPPLANE2"),K&&N.push("#define CLIPPLANE3"),Z&&N.push("#define CLIPPLANE4"),w&&N.push("#define CLIPPLANE5"),S&&N.push("#define CLIPPLANE6")}function K(l,a,N){let U=!1;const c=!!(l.clipPlane??a.clipPlane),K=!!(l.clipPlane2??a.clipPlane2),Z=!!(l.clipPlane3??a.clipPlane3),w=!!(l.clipPlane4??a.clipPlane4),S=!!(l.clipPlane5??a.clipPlane5),T=!!(l.clipPlane6??a.clipPlane6);return N.CLIPPLANE!==c&&(N.CLIPPLANE=c,U=!0),N.CLIPPLANE2!==K&&(N.CLIPPLANE2=K,U=!0),N.CLIPPLANE3!==Z&&(N.CLIPPLANE3=Z,U=!0),N.CLIPPLANE4!==w&&(N.CLIPPLANE4=w,U=!0),N.CLIPPLANE5!==S&&(N.CLIPPLANE5=S,U=!0),N.CLIPPLANE6!==T&&(N.CLIPPLANE6=T,U=!0),U}function Z(l,a,N){let U=a.clipPlane??N.clipPlane;w(l,"vClipPlane",U),U=a.clipPlane2??N.clipPlane2,w(l,"vClipPlane2",U),U=a.clipPlane3??N.clipPlane3,w(l,"vClipPlane3",U),U=a.clipPlane4??N.clipPlane4,w(l,"vClipPlane4",U),U=a.clipPlane5??N.clipPlane5,w(l,"vClipPlane5",U),U=a.clipPlane6??N.clipPlane6,w(l,"vClipPlane6",U)}function w(l,a,N){N&&l.setFloat4(a,N.normal.x,N.normal.y,N.normal.z,N.d)}N.d(a,{c:()=>U,d:()=>Z,f:()=>K,g:()=>c})},12737:(l,a,N)=>{N.d(a,{e:()=>U});class U{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(l,a){this._defines[l]||(l<this._currentRank&&(this._currentRank=l),l>this._maxRank&&(this._maxRank=l),this._defines[l]=new Array),this._defines[l].push(a)}addCPUSkinningFallback(l,a){this._mesh=a,l<this._currentRank&&(this._currentRank=l),l>this._maxRank&&(this._maxRank=l)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(l,a){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,l=l.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),a._bonesComputationForcedToCPU=!0;const N=this._mesh.bl();for(let l=0;l<N.meshes.length;l++){const U=N.meshes[l];if(U.material){if(U.computeBonesUsingShaders&&0!==U.numBoneInfluencers)if(U.material.getEffect()===a)U.computeBonesUsingShaders=!1;else if(U.Wc)for(const l of U.Wc){if(l.effect===a){U.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&U.computeBonesUsingShaders&&U.numBoneInfluencers>0&&(U.computeBonesUsingShaders=!1)}}else{const a=this._defines[this._currentRank];if(a)for(let N=0;N<a.length;N++)l=l.replace("#define "+a[N],"");this._currentRank++}return l}}},12753:(l,a,N)=>{N.d(a,{c:()=>B});var U=N(12429),c=N(12432),K=N(12254),Z=N(12260),w=N(12296),S=N(12757),T=N(12697),J=N(12268),n=N(12483),y=N(12548),H=N(12471);class u{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(l){this._func=l}get funcRef(){return this._funcRef}set funcRef(l){this._funcRef=l}get funcMask(){return this._funcMask}set funcMask(l){this._funcMask=l}get opStencilFail(){return this._opStencilFail}set opStencilFail(l){this._opStencilFail=l}get opDepthFail(){return this._opDepthFail}set opDepthFail(l){this._opDepthFail=l}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(l){this._opStencilDepthPass=l}get mask(){return this._mask}set mask(l){this._mask=l}get enabled(){return this._enabled}set enabled(l){this._enabled=l}getClassName(){return"MaterialStencilState"}copyTo(l){H.c.Clone((()=>l),this)}serialize(){return H.c.Serialize(this)}parse(l,a,N){H.c.Parse((()=>this),l,a,N)}}(0,U.d)([(0,c.K)()],u.prototype,"func",null),(0,U.d)([(0,c.K)()],u.prototype,"funcRef",null),(0,U.d)([(0,c.K)()],u.prototype,"funcMask",null),(0,U.d)([(0,c.K)()],u.prototype,"opStencilFail",null),(0,U.d)([(0,c.K)()],u.prototype,"opDepthFail",null),(0,U.d)([(0,c.K)()],u.prototype,"opStencilDepthPass",null),(0,U.d)([(0,c.K)()],u.prototype,"mask",null),(0,U.d)([(0,c.K)()],u.prototype,"enabled",null);var W=N(12798);class B{get _supportGlowLayer(){return!1}set _glowModeEnabled(l){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(l){if(this._alpha===l)return;const a=this._alpha;this._alpha=l,1!==a&&1!==l||this.DT(B.MiscDirtyFlag+B.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ic(l){this._backFaceCulling!==l&&(this._backFaceCulling=l,this.DT(B.TextureDirtyFlag))}get Ic(){return this._backFaceCulling}set cullBackFaces(l){this._cullBackFaces!==l&&(this._cullBackFaces=l,this.DT(B.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(l){this._blockDirtyMechanism!==l&&(this._blockDirtyMechanism=l,l||this.Vn())}atomicMaterialsUpdate(l){this.blockDirtyMechanism=!0;try{l(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(l){this._onDisposeObserver&&this.Tc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Tc.add(l)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Z.e),this._onBindObservable}set onBind(l){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(l)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new Z.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new Z.e),this._onEffectCreatedObservable}set alphaMode(l){this._alphaMode!==l&&(this._alphaMode=l,this.DT(B.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(l){this._needDepthPrePass!==l&&(this._needDepthPrePass=l,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(l){this._fogEnabled!==l&&(this._fogEnabled=l,this.DT(B.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case B.WireFrameFillMode:case B.LineListDrawMode:case B.LineLoopDrawMode:case B.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(l){this.fillMode=l?B.WireFrameFillMode:B.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case B.PointFillMode:case B.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(l){this.fillMode=l?B.PointFillMode:B.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(l){this._fillMode!==l&&(this._fillMode=l,this.DT(B.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(l){const a=this.bl().getEngine().getCaps().fragmentDepthSupported;l&&!a&&J.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=l&&a,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(l){this._drawWrapper=l}constructor(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Tc=new Z.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Jc=new u,this._useUBO=!1,this._fillMode=B.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=l;const c=a||w.e.LastCreatedScene;c&&(this._scene=c,this._dirtyCallbacks={},this._forceGLSL=U,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=l||K.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new y.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new T.c(this._scene.getEngine(),void 0,void 0,l),this._useUBO=this.bl().getEngine().supportsUniformBuffers,this._createUniformBuffer(),N||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),B.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var l;const a=this.bl().getEngine();null===(l=this._uniformBuffer)||void 0===l||l.dispose(),a.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new T.c(a,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new T.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(l){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Vn(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Vn(),this.checkReadyOnlyOnce=!1}isReady(l,a){return!0}isReadyForSubMesh(l,a,N){const U=a.materialDefines;return!!U&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=U,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}bl(){return this._scene}_getEffectiveOrientation(l){return null!==this.sideOrientation?this.sideOrientation:l.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(l){this._transparencyMode!==l&&(this._transparencyMode=l,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===B.MATERIAL_ALPHABLEND||this._transparencyMode===B.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===B.MATERIAL_ALPHATEST||this._transparencyMode===B.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===B.MATERIAL_OPAQUE||this._transparencyMode===B.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(l){return this._hasTransparencyMode?this._transparencyModeIsBlend:l.visibility<1||!this._disableAlphaBlending&&(l.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(l){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(l)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Vn(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.bl().meshes;for(const N of a)if(N.Wc)for(const a of N.Wc)if(a.Rl()===this)for(const N of a._drawWrappers)N&&this._materialContext===N.materialContext&&(N._wasPreviouslyReady=!1,N._wasPreviouslyUsingInstances=null,N._forceRebindOnNextCall=l);l&&this.DT(B.AllDirtyFlag)}_preBind(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=this._scene.getEngine(),U=(null==a?this.sideOrientation:a)===B.ClockWiseSideOrientation;return N.enableEffect(l||this._getDrawWrapper()),N.setState(this.Ic,this.zOffset,!1,U,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Jc,this.zOffsetUnits),U}bind(l,a){}buildUniformLayout(){const l=this._uniformBuffer;this._eventInfo.ubo=l,this._callbackPluginEventGeneric(8,this._eventInfo),l.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(l,a,N){const U=N._drawWrapper;this._eventInfo.subMesh=N,this._callbackPluginEventBindForSubMesh(this._eventInfo),U._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(l){}bindView(l){this._useUBO?this._needToBindSceneUbo=!0:l.setMatrix("view",this.bl().getViewMatrix())}bindViewProjection(l){this._useUBO?this._needToBindSceneUbo=!0:(l.setMatrix("viewProjection",this.bl().getTransformMatrix()),l.setMatrix("projection",this.bl().getProjectionMatrix()))}bindEyePosition(l,a){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(l,a)}_afterBind(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&a&&(this._needToBindSceneUbo=!1,(0,W.n)(a,this.bl().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=l?l.visibility:1,this._onBindObservable&&l&&this._onBindObservable.notifyObservers(l),this.disableDepthWrite){const l=this._scene.getEngine();this._cachedDepthWriteState=l.getDepthWrite(),l.setDepthWrite(!1)}if(this.disableColorWrite){const l=this._scene.getEngine();this._cachedColorWriteState=l.getColorWrite(),l.setColorWrite(!1)}if(0!==this.depthFunction){const l=this._scene.getEngine();this._cachedDepthFunctionState=l.getDepthFunction()||0,l.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(l){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=l,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(l){return null}_clonePlugins(l,a){const N={};if(this._serializePlugins(N),B._ParsePlugins(N,l,this._scene,a),this.pluginManager)for(const U of this.pluginManager._plugins){const a=l.pluginManager.getPlugin(U.name);a&&U.copyTo(a)}}getBindedMeshes(){if(this.meshMap){const l=[];for(const a in this.meshMap){const N=this.meshMap[a];N&&l.push(N)}return l}return this._scene.meshes.filter((l=>l.material===this))}forceCompilation(l,a,N,U){const c={clipPlane:!1,useInstances:!1,...N},K=this.bl(),Z=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const w=()=>{if(!this._scene||!this._scene.getEngine())return;const N=K.clipPlane;if(c.clipPlane&&(K.clipPlane=new n.e(0,0,0,1)),this._storeEffectOnSubMeshes){let N=!0,K=null;if(l.Wc){const a=new S.d(0,0,0,0,0,l,void 0,!1,!1);a.materialDefines&&(a.materialDefines._renderId=-1),this.isReadyForSubMesh(l,a,c.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?K=a.effect.getCompilationError():(N=!1,setTimeout(w,16)))}N&&(this.allowShaderHotSwapping=Z,K&&U&&U(K),a&&a(this))}else this.isReady()?(this.allowShaderHotSwapping=Z,a&&a(this)):setTimeout(w,16);c.clipPlane&&(K.clipPlane=N)};w()}async forceCompilationAsync(l,a){return await new Promise(((N,U)=>{this.forceCompilation(l,(()=>{N()}),a,(l=>{U(l)}))}))}DT(l){this.bl().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(B._DirtyCallbackArray.length=0,l&B.ImageProcessingDirtyFlag&&B._DirtyCallbackArray.push(B._ImageProcessingDirtyCallBack),l&B.TextureDirtyFlag&&B._DirtyCallbackArray.push(B._TextureDirtyCallBack),l&B.LightDirtyFlag&&B._DirtyCallbackArray.push(B._LightsDirtyCallBack),l&B.FresnelDirtyFlag&&B._DirtyCallbackArray.push(B._FresnelDirtyCallBack),l&B.AttributesDirtyFlag&&B._DirtyCallbackArray.push(B._AttributeDirtyCallBack),l&B.MiscDirtyFlag&&B._DirtyCallbackArray.push(B._MiscDirtyCallBack),l&B.PrePassDirtyFlag&&B._DirtyCallbackArray.push(B._PrePassDirtyCallBack),B._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(B._RunDirtyCallBacks),this.bl().resetCachedMaterial())}resetDrawCache(){const l=this.bl().meshes;for(const a of l)if(a.Wc)for(const l of a.Wc)l.Rl()===this&&l.resetDrawCache()}_markAllSubMeshesAsDirty(l){const a=this.bl();if(a.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const N=a.meshes;for(const U of N)if(U.Wc)for(const N of U.Wc){if((N.Rl()||(a._hasDefaultMaterial?a.defaultMaterial:null))===this)for(const a of N._drawWrappers)a&&a.defines&&a.defines.markAllAsDirty&&this._materialContext===a.materialContext&&l(a.defines)}}_markScenePrePassDirty(){if(this.bl().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const l=this.bl().enablePrePassRenderer();l&&l.DT()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(B._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(B._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(B._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(B._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(B._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(B._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(B._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(B._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(B._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(B._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const l=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Tc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(l)}))}}setPrePassRenderer(l){return!1}dispose(l,a,N){const U=this.bl();if(U.stopAnimation(this),U.freeProcessedMaterials(),U.removeMaterial(this),this._eventInfo.forceDisposeTextures=a,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const l=this._parentContainer.materials.indexOf(this);l>-1&&this._parentContainer.materials.splice(l,1),this._parentContainer=null}if(!0!==N)if(this.meshMap)for(const c in this.meshMap){const l=this.meshMap[c];this._disposeMeshResources(l)}else{const l=U.meshes;for(const a of l)this._disposeMeshResources(a)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Tc.notifyObservers(this),this.Tc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(l){if(!l)return;const a=l.bc,N=l._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(l.Wc&&N)for(const c of l.Wc){const l=c._drawWrappers;for(let K=0;K<l.length;K++){var U;const Z=null===(U=l[K])||void 0===U?void 0:U.effect;if(!Z)continue;N[K]===this&&(null===a||void 0===a||a._releaseVertexArrayObject(Z),c._removeDrawWrapper(K,!0,!0))}}}else null===a||void 0===a||a._releaseVertexArrayObject(this._drawWrapper.effect);l.material!==this||l.sourceMesh||(l.material=null)}serialize(){const l=H.c.Serialize(this);return l.Jc=this.Jc.serialize(),l.uniqueId=this.uniqueId,this._serializePlugins(l),l}_serializePlugins(l){if(l.plugins={},this.pluginManager)for(const a of this.pluginManager._plugins)a.doNotSerialize||(l.plugins[a.getClassName()]=a.serialize())}static Parse(l,a,N){if(l.customType){if("BABYLON.PBRMaterial"===l.customType&&l.overloadedAlbedo&&(l.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return J.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else l.customType="BABYLON.StandardMaterial";const U=K.Tools.Instantiate(l.customType).Parse(l,a,N);return U._loadedUniqueId=l.uniqueId,U}static _ParsePlugins(l,a,N,U){if(l.plugins)for(const w in l.plugins){var c,Z;const S=l.plugins[w];let T=null===(c=a.pluginManager)||void 0===c?void 0:c.getPlugin(S.name);if(!T){const l=K.Tools.Instantiate("BABYLON."+w);l&&(T=new l(a))}null===(Z=T)||void 0===Z||Z.parse(S,N,U)}}}B.TriangleFillMode=0,B.WireFrameFillMode=1,B.PointFillMode=2,B.PointListDrawMode=3,B.LineListDrawMode=4,B.LineLoopDrawMode=5,B.LineStripDrawMode=6,B.TriangleStripDrawMode=7,B.TriangleFanDrawMode=8,B.ClockWiseSideOrientation=0,B.CounterClockWiseSideOrientation=1,B.ImageProcessingDirtyFlag=64,B.TextureDirtyFlag=1,B.LightDirtyFlag=2,B.FresnelDirtyFlag=4,B.AttributesDirtyFlag=8,B.MiscDirtyFlag=16,B.PrePassDirtyFlag=32,B.AllDirtyFlag=127,B.MATERIAL_OPAQUE=0,B.MATERIAL_ALPHATEST=1,B.MATERIAL_ALPHABLEND=2,B.MATERIAL_ALPHATESTANDBLEND=3,B.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,B.MATERIAL_NORMALBLENDMETHOD_RNM=1,B.OnEventObservable=new Z.e,B._AllDirtyCallBack=l=>l.markAllAsDirty(),B._ImageProcessingDirtyCallBack=l=>l.markAsImageProcessingDirty(),B._TextureDirtyCallBack=l=>l.markAsTexturesDirty(),B._FresnelDirtyCallBack=l=>l.markAsFresnelDirty(),B._MiscDirtyCallBack=l=>l.markAsMiscDirty(),B._PrePassDirtyCallBack=l=>l.markAsPrePassDirty(),B._LightsDirtyCallBack=l=>l.markAsLightDirty(),B._AttributeDirtyCallBack=l=>l.markAsAttributesDirty(),B._FresnelAndMiscDirtyCallBack=l=>{B._FresnelDirtyCallBack(l),B._MiscDirtyCallBack(l)},B._TextureAndMiscDirtyCallBack=l=>{B._TextureDirtyCallBack(l),B._MiscDirtyCallBack(l)},B._DirtyCallbackArray=[],B._RunDirtyCallBacks=l=>{for(const a of B._DirtyCallbackArray)a(l)},(0,U.d)([(0,c.K)()],B.prototype,"id",void 0),(0,U.d)([(0,c.K)()],B.prototype,"uniqueId",void 0),(0,U.d)([(0,c.K)()],B.prototype,"name",void 0),(0,U.d)([(0,c.K)()],B.prototype,"metadata",void 0),(0,U.d)([(0,c.K)()],B.prototype,"checkReadyOnEveryCall",void 0),(0,U.d)([(0,c.K)()],B.prototype,"checkReadyOnlyOnce",void 0),(0,U.d)([(0,c.K)()],B.prototype,"state",void 0),(0,U.d)([(0,c.K)("alpha")],B.prototype,"_alpha",void 0),(0,U.d)([(0,c.K)("Ic")],B.prototype,"_backFaceCulling",void 0),(0,U.d)([(0,c.K)("cullBackFaces")],B.prototype,"_cullBackFaces",void 0),(0,U.d)([(0,c.K)()],B.prototype,"sideOrientation",void 0),(0,U.d)([(0,c.K)("alphaMode")],B.prototype,"_alphaMode",void 0),(0,U.d)([(0,c.K)()],B.prototype,"_needDepthPrePass",void 0),(0,U.d)([(0,c.K)()],B.prototype,"disableDepthWrite",void 0),(0,U.d)([(0,c.K)()],B.prototype,"disableColorWrite",void 0),(0,U.d)([(0,c.K)()],B.prototype,"forceDepthWrite",void 0),(0,U.d)([(0,c.K)()],B.prototype,"depthFunction",void 0),(0,U.d)([(0,c.K)()],B.prototype,"separateCullingPass",void 0),(0,U.d)([(0,c.K)("fogEnabled")],B.prototype,"_fogEnabled",void 0),(0,U.d)([(0,c.K)()],B.prototype,"pointSize",void 0),(0,U.d)([(0,c.K)()],B.prototype,"zOffset",void 0),(0,U.d)([(0,c.K)()],B.prototype,"zOffsetUnits",void 0),(0,U.d)([(0,c.K)()],B.prototype,"pointsCloud",null),(0,U.d)([(0,c.K)()],B.prototype,"fillMode",null),(0,U.d)([(0,c.K)()],B.prototype,"useLogarithmicDepth",null),(0,U.d)([(0,c.K)()],B.prototype,"transparencyMode",null)},12798:(l,a,N)=>{N.d(a,{$:()=>f,C:()=>H,F:()=>y,J:()=>k,M:()=>i,Q:()=>O,S:()=>Y,U:()=>t,W:()=>Q,_:()=>j,ab:()=>R,d:()=>A,eb:()=>u,h:()=>n,i:()=>q,k:()=>J,m:()=>W,n:()=>B,p:()=>C,q:()=>I,u:()=>M,y:()=>b,z:()=>z});var U=N(12268),c=N(12479),K=N(12296),Z=N(12734),w=N(12804);const S=c.Ca.Black(),T={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function J(l,a,N){if(!l||l.LOGARITHMICDEPTH||l.indexOf&&l.indexOf("LOGARITHMICDEPTH")>=0){const l=N.activeCamera;1===l.mode&&U.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),a.setFloat("logarithmicDepthConstant",2/(Math.log(l.maxZ+1)/Math.LN2))}}function n(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];N&&l.fogEnabled&&(!a||a.applyFog)&&0!==l.fogMode&&(N.setFloat4("vFogInfos",l.fogMode,l.fogStart,l.fogEnd,l.fogDensity),U?(l.fogColor.toLinearSpaceToRef(S,l.getEngine().useExactSrgbConversions),N.setColor3("vFogColor",S)):N.setColor3("vFogColor",l.fogColor))}function y(l,a,N,U,c,K,Z,w,S,J){const n=l.numMaxInfluencers||l.numInfluencers;return n<=0?0:(a.push("#define MORPHTARGETS"),l.hasPositions&&a.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),l.hasNormals&&a.push("#define MORPHTARGETTEXTURE_HASNORMALS"),l.hasTangents&&a.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),l.hasUVs&&a.push("#define MORPHTARGETTEXTURE_HASUVS"),l.hasUV2s&&a.push("#define MORPHTARGETTEXTURE_HASUV2S"),l.hasColors&&a.push("#define MORPHTARGETTEXTURE_HASCOLORS"),l.supportsPositions&&c&&a.push("#define MORPHTARGETS_POSITION"),l.supportsNormals&&K&&a.push("#define MORPHTARGETS_NORMAL"),l.supportsTangents&&Z&&a.push("#define MORPHTARGETS_TANGENT"),l.supportsUVs&&w&&a.push("#define MORPHTARGETS_UV"),l.supportsUV2s&&S&&a.push("#define MORPHTARGETS_UV2"),l.supportsColors&&J&&a.push("#define MORPHTARGETS_COLOR"),a.push("#define NUM_MORPH_INFLUENCERS "+n),l.isUsingTextureForTargets&&a.push("#define MORPHTARGETS_TEXTURE"),T.NUM_MORPH_INFLUENCERS=n,T.NORMAL=K,T.TANGENT=Z,T.UV=w,T.UV2=S,T.COLOR=J,H(N,U,T,c),n)}function H(l,a,N){let c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=N.NUM_MORPH_INFLUENCERS;if(Z>0&&K.e.LastCreatedEngine){const w=K.e.LastCreatedEngine.getCaps().maxVertexAttribs,S=a.morphTargetManager;if(null!==S&&void 0!==S&&S.isUsingTextureForTargets)return;const T=S&&S.supportsPositions&&c,J=S&&S.supportsNormals&&N.NORMAL,n=S&&S.supportsTangents&&N.TANGENT,y=S&&S.supportsUVs&&N.UV1,H=S&&S.supportsUV2s&&N.UV2,u=S&&S.supportsColors&&N.VERTEXCOLOR;for(let N=0;N<Z;N++)T&&l.push("position"+N),J&&l.push("normal"+N),n&&l.push("tangent"+N),y&&l.push("uv_"+N),H&&l.push("uv2_"+N),u&&l.push("color"+N),l.length>w&&U.b.Error("Cannot add more vertex attributes for mesh "+a.name)}}function u(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l.push("world0"),l.push("world1"),l.push("world2"),l.push("world3"),a&&(l.push("previousWorld0"),l.push("previousWorld1"),l.push("previousWorld2"),l.push("previousWorld3"))}function W(l,a){const N=l.morphTargetManager;l&&N&&a.setFloatArray("morphTargetInfluences",N.influences)}function B(l,a){a.bindToEffect(l,"Scene")}function Y(l,a,N){a._needUVs=!0,a[N]=!0,l.optimizeUVAllocation&&l.getTextureMatrix().isIdentityAs3x2()?(a[N+"DIRECTUV"]=l.coordinatesIndex+1,a["MAINUV"+(l.coordinatesIndex+1)]=!0):a[N+"DIRECTUV"]=0}function C(l,a,N){const U=l.getTextureMatrix();a.Ec(N+"Matrix",U)}function M(l,a,N){N.BAKED_VERTEX_ANIMATION_TEXTURE&&N.INSTANCES&&l.push("bakedVertexAnimationSettingsInstanced")}function A(l,a,N){var U;if(a&&l&&(l.computeBonesUsingShaders&&a._bonesComputationForcedToCPU&&(l.computeBonesUsingShaders=!1),l.useBones&&l.computeBonesUsingShaders&&l.skeleton)){const c=l.skeleton;if(c.isUsingTextureForMatrices&&a.getUniformIndex("boneTextureWidth")>-1){const N=c.getTransformMatrixTexture(l);a.setTexture("boneSampler",N),a.setFloat("boneTextureWidth",4*(c.bones.length+1))}else{const K=c.getTransformMatrices(l);K&&(a.setMatrices("mBones",K),N&&l.bl().prePassRenderer&&l.bl().prePassRenderer.getIndex(2)&&(N.previousBones[l.uniqueId]||(N.previousBones[l.uniqueId]=K.slice()),a.setMatrices("mPreviousBones",N.previousBones[l.uniqueId]),U=K,N.previousBones[l.uniqueId].set(U)))}}}function E(l,a,N,U,c){let K=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];l._bindLight(a,N,U,c,K)}function q(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const K=Math.min(a.lightSources.length,c);for(let Z=0;Z<K;Z++){E(a.lightSources[Z],Z,l,N,"boolean"===typeof U?U:U.SPECULARTERM,a.receiveShadows)}}function b(l,a,N,U){N.NUM_BONE_INFLUENCERS>0&&(U.addCPUSkinningFallback(0,a),l.push("matricesIndices"),l.push("matricesWeights"),N.NUM_BONE_INFLUENCERS>4&&(l.push("matricesIndicesExtra"),l.push("matricesWeightsExtra")))}function z(l,a){(a.INSTANCES||a.THIN_INSTANCES)&&u(l,!!a.PREPASS_VELOCITY),a.INSTANCESCOLOR&&l.push("instanceColor")}function I(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=0;for(let K=0;K<N&&l["LIGHT"+K];K++)K>0&&(c=U+K,a.addFallback(c,"LIGHT"+K)),l.SHADOWS||(l["SHADOW"+K]&&a.addFallback(U,"SHADOW"+K),l["SHADOWPCF"+K]&&a.addFallback(U,"SHADOWPCF"+K),l["SHADOWPCSS"+K]&&a.addFallback(U,"SHADOWPCSS"+K),l["SHADOWPOISSON"+K]&&a.addFallback(U,"SHADOWPOISSON"+K),l["SHADOWESM"+K]&&a.addFallback(U,"SHADOWESM"+K),l["SHADOWCLOSEESM"+K]&&a.addFallback(U,"SHADOWCLOSEESM"+K));return c++}function t(l,a,N,U,c,K,Z){let w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Z._areMiscDirty&&(Z.LOGARITHMICDEPTH=N,Z.POINTSIZE=U,Z.FOG=c&&function(l,a){return a.fogEnabled&&l.applyFog&&0!==a.fogMode}(l,a),Z.NONUNIFORMSCALING=l.nonUniformScaling,Z.ALPHATEST=K,Z.DECAL_AFTER_DETAIL=w)}function O(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N._areLightsDirty)return N._needNormals;let Z=0;const w={needNormals:N._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(l.lightsEnabled&&!K)for(const T of a.lightSources)if(h(l,a,T,Z,N,U,w),Z++,Z===c)break;N.SPECULARTERM=w.specularEnabled,N.SHADOWS=w.shadowEnabled;for(let T=Z;T<c;T++)void 0!==N["LIGHT"+T]&&(N["LIGHT"+T]=!1,N["HEMILIGHT"+T]=!1,N["POINTLIGHT"+T]=!1,N["DIRLIGHT"+T]=!1,N["SPOTLIGHT"+T]=!1,N["AREALIGHT"+T]=!1,N["SHADOW"+T]=!1,N["SHADOWCSM"+T]=!1,N["SHADOWCSMDEBUG"+T]=!1,N["SHADOWCSMNUM_CASCADES"+T]=!1,N["SHADOWCSMUSESHADOWMAXZ"+T]=!1,N["SHADOWCSMNOBLEND"+T]=!1,N["SHADOWCSM_RIGHTHANDED"+T]=!1,N["SHADOWPCF"+T]=!1,N["SHADOWPCSS"+T]=!1,N["SHADOWPOISSON"+T]=!1,N["SHADOWESM"+T]=!1,N["SHADOWCLOSEESM"+T]=!1,N["SHADOWCUBE"+T]=!1,N["SHADOWLOWQUALITY"+T]=!1,N["SHADOWMEDIUMQUALITY"+T]=!1);const S=l.getEngine().getCaps();return void 0===N.SHADOWFLOAT&&(w.needRebuild=!0),N.SHADOWFLOAT=w.shadowEnabled&&(S.textureFloatRender&&S.textureFloatLinearFiltering||S.textureHalfFloatRender&&S.textureHalfFloatLinearFiltering),N.LIGHTMAPEXCLUDED=w.lightmapMode,w.needRebuild&&N.rebuild(),w.needNormals}function h(l,a,N,U,c,K,w){switch(w.needNormals=!0,void 0===c["LIGHT"+U]&&(w.needRebuild=!0),c["LIGHT"+U]=!0,c["SPOTLIGHT"+U]=!1,c["HEMILIGHT"+U]=!1,c["POINTLIGHT"+U]=!1,c["DIRLIGHT"+U]=!1,c["AREALIGHT"+U]=!1,N.prepareLightSpecificDefines(c,U),c["LIGHT_FALLOFF_PHYSICAL"+U]=!1,c["LIGHT_FALLOFF_GLTF"+U]=!1,c["LIGHT_FALLOFF_STANDARD"+U]=!1,N.falloffType){case Z.d.FALLOFF_GLTF:c["LIGHT_FALLOFF_GLTF"+U]=!0;break;case Z.d.FALLOFF_PHYSICAL:c["LIGHT_FALLOFF_PHYSICAL"+U]=!0;break;case Z.d.FALLOFF_STANDARD:c["LIGHT_FALLOFF_STANDARD"+U]=!0}if(K&&!N.MJ.equalsFloats(0,0,0)&&(w.specularEnabled=!0),c["SHADOW"+U]=!1,c["SHADOWCSM"+U]=!1,c["SHADOWCSMDEBUG"+U]=!1,c["SHADOWCSMNUM_CASCADES"+U]=!1,c["SHADOWCSMUSESHADOWMAXZ"+U]=!1,c["SHADOWCSMNOBLEND"+U]=!1,c["SHADOWCSM_RIGHTHANDED"+U]=!1,c["SHADOWPCF"+U]=!1,c["SHADOWPCSS"+U]=!1,c["SHADOWPOISSON"+U]=!1,c["SHADOWESM"+U]=!1,c["SHADOWCLOSEESM"+U]=!1,c["SHADOWCUBE"+U]=!1,c["SHADOWLOWQUALITY"+U]=!1,c["SHADOWMEDIUMQUALITY"+U]=!1,a&&a.receiveShadows&&l.shadowsEnabled&&N.shadowEnabled){const a=N.getShadowGenerator(l.activeCamera)??N.getShadowGenerator();if(a){const l=a.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(w.shadowEnabled=!0,a.prepareDefines(c,U))}}N.lightmapMode!=Z.d.LIGHTMAP_DEFAULT?(w.lightmapMode=!0,c["LIGHTMAPEXCLUDED"+U]=!0,c["LIGHTMAPNOSPECULAR"+U]=N.lightmapMode==Z.d.LIGHTMAP_SHADOWSONLY):(c["LIGHTMAPEXCLUDED"+U]=!1,c["LIGHTMAPNOSPECULAR"+U]=!1)}function i(l,a,N,U,c){let K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=function(l,a){let N=!1;if(l.activeCamera){const U=a.CAMERA_ORTHOGRAPHIC?1:0,c=a.CAMERA_PERSPECTIVE?1:0,K=1===l.activeCamera.mode?1:0,Z=0===l.activeCamera.mode?1:0;(U^K||c^Z)&&(a.CAMERA_ORTHOGRAPHIC=1===K,a.CAMERA_PERSPECTIVE=1===Z,N=!0)}return N}(l,U);!1!==K&&(S=(0,w.f)(N,l,U)),U.DEPTHPREPASS!==!a.getColorWrite()&&(U.DEPTHPREPASS=!U.DEPTHPREPASS,S=!0),U.INSTANCES!==c&&(U.INSTANCES=c,S=!0),U.THIN_INSTANCES!==Z&&(U.THIN_INSTANCES=Z,S=!0),S&&U.markAsUnprocessed()}function k(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!a._areAttributesDirty&&a._needNormals===a._normals&&a._needUVs===a._uvs)return!1;a._normals=a._needNormals,a._uvs=a._needUVs,a.NORMAL=a._needNormals&&l.isVerticesDataPresent("normal"),a._needNormals&&l.isVerticesDataPresent("tangent")&&(a.TANGENT=!0);for(let w=1;w<=6;++w)a["UV"+w]=!!a._needUVs&&l.isVerticesDataPresent(`uv${1===w?"":w}`);if(N){const N=l.useVertexColors&&l.isVerticesDataPresent("color");a.VERTEXCOLOR=N,a.VERTEXALPHA=l.hasVertexAlpha&&N&&K}return l.isVerticesDataPresent("instanceColor")&&(l.hasInstances||l.hasThinInstances)&&(a.INSTANCESCOLOR=!0),U&&function(l,a){if(l.useBones&&l.computeBonesUsingShaders&&l.skeleton){a.NUM_BONE_INFLUENCERS=l.numBoneInfluencers;const N=void 0!==a.BONETEXTURE;if(l.skeleton.isUsingTextureForMatrices&&N)a.BONETEXTURE=!0;else{a.BonesPerMesh=l.skeleton.bones.length+1,a.BONETEXTURE=!N&&void 0;const U=l.bl().prePassRenderer;if(U&&U.enabled){const N=-1===U.excludedSkinnedMesh.indexOf(l);a.BONES_VELOCITY_ENABLED=N}}}else a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,void 0!==a.BONETEXTURE&&(a.BONETEXTURE=!1)}(l,a),c&&function(l,a){const N=l.morphTargetManager;N?(a.MORPHTARGETS_UV=N.supportsUVs&&a.UV1,a.MORPHTARGETS_UV2=N.supportsUV2s&&a.UV2,a.MORPHTARGETS_TANGENT=N.supportsTangents&&a.TANGENT,a.MORPHTARGETS_NORMAL=N.supportsNormals&&a.NORMAL,a.MORPHTARGETS_POSITION=N.supportsPositions,a.MORPHTARGETS_COLOR=N.supportsColors,a.MORPHTARGETTEXTURE_HASUVS=N.hasUVs,a.MORPHTARGETTEXTURE_HASUV2S=N.hasUV2s,a.MORPHTARGETTEXTURE_HASTANGENTS=N.hasTangents,a.MORPHTARGETTEXTURE_HASNORMALS=N.hasNormals,a.MORPHTARGETTEXTURE_HASPOSITIONS=N.hasPositions,a.MORPHTARGETTEXTURE_HASCOLORS=N.hasColors,a.NUM_MORPH_INFLUENCERS=N.numMaxInfluencers||N.numInfluencers,a.MORPHTARGETS=a.NUM_MORPH_INFLUENCERS>0,a.MORPHTARGETS_TEXTURE=N.isUsingTextureForTargets):(a.MORPHTARGETS_UV=!1,a.MORPHTARGETS_UV2=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_POSITION=!1,a.MORPHTARGETS_COLOR=!1,a.MORPHTARGETTEXTURE_HASUVS=!1,a.MORPHTARGETTEXTURE_HASUV2S=!1,a.MORPHTARGETTEXTURE_HASTANGENTS=!1,a.MORPHTARGETTEXTURE_HASNORMALS=!1,a.MORPHTARGETTEXTURE_HASPOSITIONS=!1,a.MORPHTARGETTEXTURE_HAS_COLORS=!1,a.MORPHTARGETS=!1,a.NUM_MORPH_INFLUENCERS=0)}(l,a),Z&&function(l,a){const N=l.bakedVertexAnimationManager;a.BAKED_VERTEX_ANIMATION_TEXTURE=!(!N||!N.isEnabled)}(l,a),!0}function Q(l,a){if(l.activeCamera){const N=a.MULTIVIEW;a.MULTIVIEW=null!==l.activeCamera.outputRenderTarget&&l.activeCamera.outputRenderTarget.getViewCount()>1,a.MULTIVIEW!=N&&a.markAsUnprocessed()}}function j(l,a,N){const U=a.ORDER_INDEPENDENT_TRANSPARENCY,c=a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;a.ORDER_INDEPENDENT_TRANSPARENCY=l.useOrderIndependentTransparency&&N,a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!l.getEngine().getCaps().textureFloatLinearFiltering,U===a.ORDER_INDEPENDENT_TRANSPARENCY&&c===a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||a.markAsUnprocessed()}function f(l,a,N){const U=a.PREPASS;if(!a._arePrePassDirty)return;const c=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(l.prePassRenderer&&l.prePassRenderer.enabled&&N){a.PREPASS=!0,a.SCENE_MRT_COUNT=l.prePassRenderer.mrtCount,a.PREPASS_NORMAL_WORLDSPACE=l.prePassRenderer.generateNormalsInWorldSpace,a.PREPASS_COLOR=!0,a.PREPASS_COLOR_INDEX=0;for(let N=0;N<c.length;N++){const U=l.prePassRenderer.getIndex(c[N].type);-1!==U?(a[c[N].define]=!0,a[c[N].index]=U):a[c[N].define]=!1}}else{a.PREPASS=!1;for(let l=0;l<c.length;l++)a[c[l].define]=!1}a.PREPASS!=U&&(a.markAsUnprocessed(),a.markAsImageProcessingDirty())}function p(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];c&&c.push("Light"+l),K||(a.push("vLightData"+l,"vLightDiffuse"+l,"vLightSpecular"+l,"vLightDirection"+l,"vLightWidth"+l,"vLightHeight"+l,"vLightFalloff"+l,"vLightGround"+l,"lightMatrix"+l,"shadowsInfo"+l,"depthValues"+l),N.push("shadowTexture"+l),N.push("depthTexture"+l),a.push("viewFrustumZ"+l,"cascadeBlendFactor"+l,"lightSizeUVCorrection"+l,"depthCorrection"+l,"penumbraDarkness"+l,"frustumLengths"+l),U&&(N.push("projectionLightTexture"+l),a.push("textureProjectionMatrix"+l)),Z&&N.push("iesLightTexture"+l))}function R(l,a,N){let U,c,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(l.uniformsNames){const Z=l;U=Z.uniformsNames,c=Z.uniformBuffersNames,a=Z.samplers,N=Z.defines,K=Z.maxSimultaneousLights||0}else U=l,a||(a=[]);for(let Z=0;Z<K&&N["LIGHT"+Z];Z++)p(Z,U,a,N["PROJECTEDLIGHTTEXTURE"+Z],c,!1,N["IESLIGHTTEXTURE"+Z]);N.NUM_MORPH_INFLUENCERS&&(U.push("morphTargetInfluences"),U.push("morphTargetCount")),N.BAKED_VERTEX_ANIMATION_TEXTURE&&(U.push("bakedVertexAnimationSettings"),U.push("bakedVertexAnimationTextureSizeInverted"),U.push("bakedVertexAnimationTime"),a.push("bakedVertexAnimationTexture"))}},12746:(l,a,N)=>{N.d(a,{e:()=>K});var U=N(12447),c=N(12753);class K extends c.c{constructor(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(l,a,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new U.Matrix,this._storeEffectOnSubMeshes=N}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(l,a){return!!l&&(!this._storeEffectOnSubMeshes||(!l.Wc||0===l.Wc.length||this.isReadyForSubMesh(l,l.Wc[0],a)))}_isReadyForSubMesh(l){const a=l.materialDefines;return!(this.checkReadyOnEveryCall||!l.effect||!a||a._renderId!==this.bl().getRenderId())}bindOnlyWorldMatrix(l){this._activeEffect.setMatrix("world",l)}bindOnlyNormalMatrix(l){this._activeEffect.setMatrix("normalMatrix",l)}bind(l,a){a&&this.bindForSubMesh(l,a,a.Wc[0])}_afterBind(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;super._afterBind(l,a,N),this.bl()._cachedEffect=a,N?N._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return N._drawWrapper._forceRebindOnNextCall||l.isCachedMaterialInvalid(this,a,U)}dispose(l,a,N){this._activeEffect=void 0,super.dispose(l,a,N)}}},12792:(l,a,N)=>{N.d(a,{e:()=>w,g:()=>S});var U=N(12429),c=N(12447),K=N(12432);class Z{static extractMinAndMaxIndexed(l,a,N,U,c,K){for(let Z=N;Z<N+U;Z++){const N=3*a[Z],U=l[N],w=l[N+1],S=l[N+2];c.minimizeInPlaceFromFloats(U,w,S),K.maximizeInPlaceFromFloats(U,w,S)}}static extractMinAndMax(l,a,N,U,c,K){for(let Z=a,w=a*U;Z<a+N;Z++,w+=U){const a=l[w],N=l[w+1],U=l[w+2];c.minimizeInPlaceFromFloats(a,N,U),K.maximizeInPlaceFromFloats(a,N,U)}}}function w(l,a,N,U){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const w=new c.ua(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=new c.ua(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Z.extractMinAndMaxIndexed(l,a,N,U,w,S),K&&(w.x-=w.x*K.x+K.y,w.y-=w.y*K.x+K.y,w.z-=w.z*K.x+K.y,S.x+=S.x*K.x+K.y,S.y+=S.y*K.x+K.y,S.z+=S.z*K.x+K.y),{minimum:w,maximum:S}}function S(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0;const w=new c.ua(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=new c.ua(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return K||(K=3),Z.extractMinAndMax(l,a,N,K,w,S),U&&(w.x-=w.x*U.x+U.y,w.y-=w.y*U.x+U.y,w.z-=w.z*U.x+U.y,S.x+=S.x*U.x+U.y,S.y+=S.y*U.x+U.y,S.z+=S.z*U.x+U.y),{minimum:w,maximum:S}}(0,U.d)([K.f.filter((function(){for(var l=arguments.length,a=new Array(l),N=0;N<l;N++)a[N]=arguments[N];let[U,c]=a;return!Array.isArray(U)&&!Array.isArray(c)}))],Z,"extractMinAndMaxIndexed",null),(0,U.d)([K.f.filter((function(){for(var l=arguments.length,a=new Array(l),N=0;N<l;N++)a[N]=arguments[N];let[U]=a;return!Array.isArray(U)}))],Z,"extractMinAndMax",null)},12757:(l,a,N)=>{N.d(a,{d:()=>S});var U=N(12506),c=N(12764),K=N(12771),Z=N(12792),w=N(12548);class S{get materialDefines(){var l;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(l=this._getDrawWrapper())||void 0===l?void 0:l.defines}set materialDefines(l){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=l}_getDrawWrapper(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l=l??this._engine.currentRenderPassId;let N=this._drawWrappers[l];return!N&&a&&(this._drawWrappers[l]=N=new w.d(this._mesh.bl().getEngine())),N}_removeDrawWrapper(l){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var N;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(N=this._drawWrappers[l])||void 0===N||N.dispose(a));this._drawWrappers[l]=void 0}get effect(){var l;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(l=this._getDrawWrapper())||void 0===l?void 0:l.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(l){this._mainDrawWrapperOverride=l}setEffect(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=this._drawWrapper;c.setEffect(l,a,U),void 0!==N&&(c.materialContext=N),l||(c.defines=null,c.materialContext=void 0)}resetDrawCache(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==l)return void this._removeDrawWrapper(l,!0,a);for(const l of this._drawWrappers)null===l||void 0===l||l.dispose(a)}this._drawWrappers=[]}static AddToMesh(l,a,N,U,c,K,Z){return new S(l,a,N,U,c,K,Z,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(l,a,N,U,c,K,Z){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],S=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=l,this.verticesStart=a,this.verticesCount=N,this.indexStart=U,this.indexCount=c,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=K,this._renderingMesh=Z||K,S&&K.Wc.push(this),this._engine=this._mesh.bl().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=K.Wc.length-1,w&&(this.refreshBoundingInfo(),K.qc(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(l){return this._boundingInfo=l,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const l=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return l||this._renderingMesh}Rl(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!a)return l&&this._mesh.bl()._hasDefaultMaterial?this._mesh.bl().defaultMaterial:null;if(this._isMultiMaterial(a)){const l=a.getSubMaterial(this.materialIndex);return this._currentMaterial!==l&&(this._currentMaterial=l,this.resetDrawCache()),l}return a}_isMultiMaterial(l){return void 0!==l.getSubMaterial}refreshBoundingInfo(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.bc)return this;if(l||(l=this._renderingMesh.getVerticesData(U.h.PositionKind)),!l)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const a=this._renderingMesh.zc();let N;if(0===this.indexStart&&this.indexCount===a.length){const l=this._renderingMesh.getBoundingInfo();N={minimum:l.minimum.clone(),maximum:l.maximum.clone()}}else N=(0,Z.e)(l,a,this.indexStart,this.indexCount,this._renderingMesh.bc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(N.minimum,N.maximum):this._boundingInfo=new K.b(N.minimum,N.maximum),this}_checkCollision(l){return this.getBoundingInfo()._checkCollision(l)}updateBoundingInfo(l){let a=this.getBoundingInfo();return a||(this.refreshBoundingInfo(),a=this.getBoundingInfo()),a&&a.update(l),this}isInFrustum(l){const a=this.getBoundingInfo();return!!a&&a.isInFrustum(l,this._mesh.An)}isCompletelyInFrustum(l){const a=this.getBoundingInfo();return!!a&&a.isCompletelyInFrustum(l)}render(l){return this._renderingMesh.render(this,l,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(l,a){if(!this._linesIndexBuffer){const N=6*Math.floor(this.indexCount/3),U=this.verticesStart+this.verticesCount>65535?new Uint32Array(N):new Uint16Array(N);let c=0;if(0===l.length)for(let l=this.indexStart;l<this.indexStart+this.indexCount;l+=3)U[c++]=l,U[c++]=l+1,U[c++]=l+1,U[c++]=l+2,U[c++]=l+2,U[c++]=l;else for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)U[c++]=l[a],U[c++]=l[a+1],U[c++]=l[a+1],U[c++]=l[a+2],U[c++]=l[a+2],U[c++]=l[a];this._linesIndexBuffer=a.createIndexBuffer(U),this._linesIndexCount=U.length}return this._linesIndexBuffer}canIntersects(l){const a=this.getBoundingInfo();return!!a&&l.intersectsBox(a.boundingBox)}intersects(l,a,N,U,c){const K=this.Rl();if(!K)return null;let Z=3,w=!1;switch(K.fillMode){case 3:case 5:case 6:case 8:return null;case 7:Z=1,w=!0}return 4===K.fillMode?N.length?this._intersectLines(l,a,N,this._mesh.intersectionThreshold,U):this._intersectUnIndexedLines(l,a,N,this._mesh.intersectionThreshold,U):!N.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(l,a,N,U,c):this._intersectTriangles(l,a,N,Z,w,U,c)}_intersectLines(l,a,N,U,K){let Z=null;for(let w=this.indexStart;w<this.indexStart+this.indexCount;w+=2){const S=a[N[w]],T=a[N[w+1]],J=l.intersectionSegment(S,T,U);if(!(J<0)&&((K||!Z||J<Z.distance)&&(Z=new c.e(null,null,J),Z.faceId=w/2,K)))break}return Z}_intersectUnIndexedLines(l,a,N,U,K){let Z=null;for(let w=this.verticesStart;w<this.verticesStart+this.verticesCount;w+=2){const N=a[w],S=a[w+1],T=l.intersectionSegment(N,S,U);if(!(T<0)&&((K||!Z||T<Z.distance)&&(Z=new c.e(null,null,T),Z.faceId=w/2,K)))break}return Z}_intersectTriangles(l,a,N,U,c,K,Z){let w=null,S=-1;for(let T=this.indexStart;T<this.indexStart+this.indexCount-(3-U);T+=U){S++;const U=N[T],J=N[T+1],n=N[T+2];if(c&&4294967295===n){T+=2;continue}const y=a[U],H=a[J],u=a[n];if(!y||!H||!u)continue;if(Z&&!Z(y,H,u,l,U,J,n))continue;const W=l.intersectsTriangle(y,H,u);if(W){if(W.distance<0)continue;if((K||!w||W.distance<w.distance)&&(w=W,w.faceId=S,K))break}}return w}_intersectUnIndexedTriangles(l,a,N,U,c){let K=null;for(let Z=this.verticesStart;Z<this.verticesStart+this.verticesCount;Z+=3){const N=a[Z],w=a[Z+1],S=a[Z+2];if(c&&!c(N,w,S,l,-1,-1,-1))continue;const T=l.intersectsTriangle(N,w,S);if(T){if(T.distance<0)continue;if((U||!K||T.distance<K.distance)&&(K=T,K.faceId=Z/3,U))break}}return K}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(l,a){const N=new S(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,l,a,!1);if(!this.IsGlobal){const l=this.getBoundingInfo();if(!l)return N;N._boundingInfo=new K.b(l.minimum,l.maximum)}return N}dispose(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.bl().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const a=this._mesh.Wc.indexOf(this);this._mesh.Wc.splice(a,1),this.resetDrawCache(void 0,l)}getClassName(){return"SubMesh"}static CreateFromIndices(l,a,N,U,c){let K=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Z=Number.MAX_VALUE,w=-Number.MAX_VALUE;const T=(c||U).zc();for(let S=a;S<a+N;S++){const l=T[S];l<Z&&(Z=l),l>w&&(w=l)}return new S(l,Z,w-Z+1,a,N,U,c,K)}}}}]);