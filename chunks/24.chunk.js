"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[24],{12108:(b,n,i)=>{i.d(n,{c:()=>e});class e{constructor(b,n,i){this.bu=b,this.bv=n,this.distance=i,this.faceId=0,this.subMeshId=0}}},12115:(b,n,i)=>{i.d(n,{d:()=>U});var e=i(11788),V=i(11778),Q=i(11786);class U{constructor(b,n,i){this.vectors=(0,e.d)(8,V.On.Zero),this.center=V.On.Zero(),this.centerWorld=V.On.Zero(),this.extendSize=V.On.Zero(),this.extendSizeWorld=V.On.Zero(),this.directions=(0,e.d)(3,V.On.Zero),this.vectorsWorld=(0,e.d)(8,V.On.Zero),this.minimumWorld=V.On.Zero(),this.maximumWorld=V.On.Zero(),this.minimum=V.On.Zero(),this.maximum=V.On.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(b,n,i)}reConstruct(b,n,i){const e=b.x,Q=b.y,U=b.z,Y=n.x,L=n.y,B=n.z,mb=this.vectors;this.minimum.re(e,Q,U),this.maximum.re(Y,L,B),mb[0].re(e,Q,U),mb[1].re(Y,L,B),mb[2].re(Y,Q,U),mb[3].re(e,L,U),mb[4].re(e,Q,B),mb[5].re(Y,L,U),mb[6].re(e,L,B),mb[7].re(Y,Q,B),n.addToRef(b,this.center).scaleInPlace(.5),n.subtractToRef(b,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||V.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(b){const n=U._TmpVector3,i=this.maximum.subtractToRef(this.minimum,n[0]),e=i.length();i.normalizeFromLength(e);const V=e*b,Q=i.scaleInPlace(.5*V),Y=this.center.subtractToRef(Q,n[1]),L=this.center.addToRef(Q,n[2]);return this.reConstruct(Y,L,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(b){const n=this.minimumWorld,i=this.maximumWorld,e=this.directions,Q=this.vectorsWorld,U=this.vectors;if(b.isIdentity()){n.L(this.minimum),i.L(this.maximum);for(let b=0;b<8;++b)Q[b].L(U[b]);this.extendSizeWorld.L(this.extendSize),this.centerWorld.L(this.center)}else{n.Fe(Number.MAX_VALUE),i.Fe(-Number.MAX_VALUE);for(let e=0;e<8;++e){const Y=Q[e];V.On.TransformCoordinatesToRef(U[e],b,Y),n.minimizeInPlace(Y),i.maximizeInPlace(Y)}i.subtractToRef(n,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(n,this.centerWorld).scaleInPlace(.5)}V.On.FromArrayToRef(b.m,0,e[0]),V.On.FromArrayToRef(b.m,4,e[1]),V.On.FromArrayToRef(b.m,8,e[2]),this._worldMatrix=b}isInFrustum(b){return U.IsInFrustum(this.vectorsWorld,b)}isCompletelyInFrustum(b){return U.IsCompletelyInFrustum(this.vectorsWorld,b)}intersectsPoint(b){const n=this.minimumWorld,i=this.maximumWorld,e=n.x,V=n.y,U=n.z,Y=i.x,L=i.y,B=i.z,mb=b.x,N=b.y,Z=b.z,T=-Q.c;return!(Y-mb<T||T>mb-e)&&(!(L-N<T||T>N-V)&&!(B-Z<T||T>Z-U))}intersectsSphere(b){return U.IntersectsSphere(this.minimumWorld,this.maximumWorld,b.centerWorld,b.radiusWorld)}intersectsMinMax(b,n){const i=this.minimumWorld,e=this.maximumWorld,V=i.x,Q=i.y,U=i.z,Y=e.x,L=e.y,B=e.z,mb=b.x,N=b.y,Z=b.z,T=n.x,z=n.y,K=n.z;return!(Y<mb||V>T)&&(!(L<N||Q>z)&&!(B<Z||U>K))}dispose(){var b,n;null===(b=this._drawWrapperFront)||void 0===b||b.dispose(),null===(n=this._drawWrapperBack)||void 0===n||n.dispose()}static Intersects(b,n){return b.intersectsMinMax(n.minimumWorld,n.maximumWorld)}static IntersectsSphere(b,n,i,e){const Q=U._TmpVector3[0];V.On.ClampToRef(i,b,n,Q);return V.On.DistanceSquared(i,Q)<=e*e}static IsCompletelyInFrustum(b,n){for(let i=0;i<6;++i){const e=n[i];for(let n=0;n<8;++n)if(e.dotCoordinate(b[n])<0)return!1}return!0}static IsInFrustum(b,n){for(let i=0;i<6;++i){let e=!0;const V=n[i];for(let n=0;n<8;++n)if(V.dotCoordinate(b[n])>=0){e=!1;break}if(e)return!1}return!0}}U._TmpVector3=(0,e.d)(3,V.On.Zero)},12112:(b,n,i)=>{i.d(n,{d:()=>N});var e=i(11788),V=i(11778),Q=i(12115),U=i(12123);const Y={min:0,max:0},L={min:0,max:0},B=(b,n,i)=>{const e=V.On.Dot(n.centerWorld,b),Q=Math.abs(V.On.Dot(n.directions[0],b))*n.extendSize.x+Math.abs(V.On.Dot(n.directions[1],b))*n.extendSize.y+Math.abs(V.On.Dot(n.directions[2],b))*n.extendSize.z;i.min=e-Q,i.max=e+Q},mb=(b,n,i)=>(B(b,n,Y),B(b,i,L),!(Y.min>L.max||L.min>Y.max));class N{constructor(b,n,i){this._isLocked=!1,this.boundingBox=new Q.d(b,n,i),this.boundingSphere=new U.b(b,n,i)}reConstruct(b,n,i){this.boundingBox.reConstruct(b,n,i),this.boundingSphere.reConstruct(b,n,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(b){this._isLocked=b}update(b){this._isLocked||(this.boundingBox._update(b),this.boundingSphere._update(b))}centerOn(b,n){const i=N._TmpVector3[0].L(b).lm(n),e=N._TmpVector3[1].L(b).addInPlace(n);return this.boundingBox.reConstruct(i,e,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,e,this.boundingBox.getWorldMatrix()),this}encapsulate(b){const n=V.On.Minimize(this.minimum,b),i=V.On.Maximize(this.maximum,b);return this.reConstruct(n,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(b){const n=V.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(n);const i=V.TmpVectors.On[0];return V.On.TransformCoordinatesToRef(b.boundingBox.minimumWorld,n,i),this.encapsulate(i),V.On.TransformCoordinatesToRef(b.boundingBox.maximumWorld,n,i),this.encapsulate(i),this}scale(b){return this.boundingBox.scale(b),this.boundingSphere.scale(b),this}isInFrustum(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===n||3===n)&&this.boundingSphere.isCenterInFrustum(b))return!0;if(!this.boundingSphere.isInFrustum(b))return!1;return!(1!==n&&3!==n)||this.boundingBox.isInFrustum(b)}get diagonalLength(){const b=this.boundingBox;return b.maximumWorld.subtractToRef(b.minimumWorld,N._TmpVector3[0]).length()}isCompletelyInFrustum(b){return this.boundingBox.isCompletelyInFrustum(b)}_checkCollision(b){return b._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(b){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(b)&&!!this.boundingBox.intersectsPoint(b))}intersects(b,n){if(!U.b.Intersects(this.boundingSphere,b.boundingSphere))return!1;if(!Q.d.Intersects(this.boundingBox,b.boundingBox))return!1;if(!n)return!0;const i=this.boundingBox,e=b.boundingBox;return!!mb(i.directions[0],i,e)&&(!!mb(i.directions[1],i,e)&&(!!mb(i.directions[2],i,e)&&(!!mb(e.directions[0],i,e)&&(!!mb(e.directions[1],i,e)&&(!!mb(e.directions[2],i,e)&&(!!mb(V.On.Cross(i.directions[0],e.directions[0]),i,e)&&(!!mb(V.On.Cross(i.directions[0],e.directions[1]),i,e)&&(!!mb(V.On.Cross(i.directions[0],e.directions[2]),i,e)&&(!!mb(V.On.Cross(i.directions[1],e.directions[0]),i,e)&&(!!mb(V.On.Cross(i.directions[1],e.directions[1]),i,e)&&(!!mb(V.On.Cross(i.directions[1],e.directions[2]),i,e)&&(!!mb(V.On.Cross(i.directions[2],e.directions[0]),i,e)&&(!!mb(V.On.Cross(i.directions[2],e.directions[1]),i,e)&&!!mb(V.On.Cross(i.directions[2],e.directions[2]),i,e))))))))))))))}}N._TmpVector3=(0,e.d)(2,V.On.Zero)},12123:(b,n,i)=>{i.d(n,{b:()=>Q});var e=i(11788),V=i(11778);class Q{constructor(b,n,i){this.center=V.On.Zero(),this.centerWorld=V.On.Zero(),this.minimum=V.On.Zero(),this.maximum=V.On.Zero(),this.reConstruct(b,n,i)}reConstruct(b,n,i){this.minimum.L(b),this.maximum.L(n);const e=V.On.Distance(b,n);n.addToRef(b,this.center).scaleInPlace(.5),this.radius=.5*e,this._update(i||V.Matrix.IdentityReadOnly)}scale(b){const n=this.radius*b,i=Q._TmpVector3,e=i[0].Fe(n),V=this.center.subtractToRef(e,i[1]),U=this.center.addToRef(e,i[2]);return this.reConstruct(V,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(b){if(b.isIdentity())this.centerWorld.L(this.center),this.radiusWorld=this.radius;else{V.On.TransformCoordinatesToRef(this.center,b,this.centerWorld);const n=Q._TmpVector3[0];V.On.TransformNormalFromFloatsToRef(1,1,1,b,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}}isInFrustum(b){const n=this.centerWorld,i=this.radiusWorld;for(let e=0;e<6;e++)if(b[e].dotCoordinate(n)<=-i)return!1;return!0}isCenterInFrustum(b){const n=this.centerWorld;for(let i=0;i<6;i++)if(b[i].dotCoordinate(n)<0)return!1;return!0}intersectsPoint(b){const n=V.On.DistanceSquared(this.centerWorld,b);return!(this.radiusWorld*this.radiusWorld<n)}static Intersects(b,n){const i=V.On.DistanceSquared(b.centerWorld,n.centerWorld),e=b.radiusWorld+n.radiusWorld;return!(e*e<i)}static CreateFromCenterAndRadius(b,n,i){this._TmpVector3[0].L(b),this._TmpVector3[1].re(0,0,n),this._TmpVector3[2].L(b),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].lm(this._TmpVector3[1]);const e=new Q(this._TmpVector3[0],this._TmpVector3[2]);return e._worldMatrix=i||V.Matrix.Identity(),e}}Q._TmpVector3=(0,e.d)(3,V.On.Zero)},12142:(b,n,i)=>{function e(b){-1===b.indexOf("vClipPlane")&&b.push("vClipPlane"),-1===b.indexOf("vClipPlane2")&&b.push("vClipPlane2"),-1===b.indexOf("vClipPlane3")&&b.push("vClipPlane3"),-1===b.indexOf("vClipPlane4")&&b.push("vClipPlane4"),-1===b.indexOf("vClipPlane5")&&b.push("vClipPlane5"),-1===b.indexOf("vClipPlane6")&&b.push("vClipPlane6")}function V(b,n,i){const e=!!(b.clipPlane??n.clipPlane),V=!!(b.clipPlane2??n.clipPlane2),Q=!!(b.clipPlane3??n.clipPlane3),U=!!(b.clipPlane4??n.clipPlane4),Y=!!(b.clipPlane5??n.clipPlane5),L=!!(b.clipPlane6??n.clipPlane6);e&&i.push("#define CLIPPLANE"),V&&i.push("#define CLIPPLANE2"),Q&&i.push("#define CLIPPLANE3"),U&&i.push("#define CLIPPLANE4"),Y&&i.push("#define CLIPPLANE5"),L&&i.push("#define CLIPPLANE6")}function Q(b,n,i){let e=!1;const V=!!(b.clipPlane??n.clipPlane),Q=!!(b.clipPlane2??n.clipPlane2),U=!!(b.clipPlane3??n.clipPlane3),Y=!!(b.clipPlane4??n.clipPlane4),L=!!(b.clipPlane5??n.clipPlane5),B=!!(b.clipPlane6??n.clipPlane6);return i.CLIPPLANE!==V&&(i.CLIPPLANE=V,e=!0),i.CLIPPLANE2!==Q&&(i.CLIPPLANE2=Q,e=!0),i.CLIPPLANE3!==U&&(i.CLIPPLANE3=U,e=!0),i.CLIPPLANE4!==Y&&(i.CLIPPLANE4=Y,e=!0),i.CLIPPLANE5!==L&&(i.CLIPPLANE5=L,e=!0),i.CLIPPLANE6!==B&&(i.CLIPPLANE6=B,e=!0),e}function U(b,n,i){let e=n.clipPlane??i.clipPlane;Y(b,"vClipPlane",e),e=n.clipPlane2??i.clipPlane2,Y(b,"vClipPlane2",e),e=n.clipPlane3??i.clipPlane3,Y(b,"vClipPlane3",e),e=n.clipPlane4??i.clipPlane4,Y(b,"vClipPlane4",e),e=n.clipPlane5??i.clipPlane5,Y(b,"vClipPlane5",e),e=n.clipPlane6??i.clipPlane6,Y(b,"vClipPlane6",e)}function Y(b,n,i){i&&b.setFloat4(n,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(n,{c:()=>e,d:()=>U,f:()=>Q,h:()=>V})},12081:(b,n,i)=>{i.d(n,{b:()=>e});class e{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(b,n){this._defines[b]||(b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b),this._defines[b]=new Array),this._defines[b].push(n)}addCPUSkinningFallback(b,n){this._mesh=n,b<this._currentRank&&(this._currentRank=b),b>this._maxRank&&(this._maxRank=b)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(b,n){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,b=b.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),n._bonesComputationForcedToCPU=!0;const i=this._mesh.ab();for(let b=0;b<i.meshes.length;b++){const e=i.meshes[b];if(e.material){if(e.computeBonesUsingShaders&&0!==e.numBoneInfluencers)if(e.material.getEffect()===n)e.computeBonesUsingShaders=!1;else if(e.xe)for(const b of e.xe){if(b.effect===n){e.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&e.computeBonesUsingShaders&&e.numBoneInfluencers>0&&(e.computeBonesUsingShaders=!1)}}else{const n=this._defines[this._currentRank];if(n)for(let i=0;i<n.length;i++)b=b.replace("#define "+n[i],"");this._currentRank++}return b}}},12095:(b,n,i)=>{i.d(n,{b:()=>I});var e=i(11756),V=i(11762),Q=i(11605),U=i(11612),Y=i(11646),L=i(12102),B=i(12022),mb=i(11621),N=i(11824),Z=i(11883),T=i(11811);class z{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(b){this._func=b}get funcRef(){return this._funcRef}set funcRef(b){this._funcRef=b}get funcMask(){return this._funcMask}set funcMask(b){this._funcMask=b}get opStencilFail(){return this._opStencilFail}set opStencilFail(b){this._opStencilFail=b}get opDepthFail(){return this._opDepthFail}set opDepthFail(b){this._opDepthFail=b}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(b){this._opStencilDepthPass=b}get mask(){return this._mask}set mask(b){this._mask=b}get enabled(){return this._enabled}set enabled(b){this._enabled=b}getClassName(){return"MaterialStencilState"}copyTo(b){T.c.Clone((()=>b),this)}serialize(){return T.c.Serialize(this)}parse(b,n,i){T.c.Parse((()=>this),b,n,i)}}(0,e.e)([(0,V.W)()],z.prototype,"func",null),(0,e.e)([(0,V.W)()],z.prototype,"funcRef",null),(0,e.e)([(0,V.W)()],z.prototype,"funcMask",null),(0,e.e)([(0,V.W)()],z.prototype,"opStencilFail",null),(0,e.e)([(0,V.W)()],z.prototype,"opDepthFail",null),(0,e.e)([(0,V.W)()],z.prototype,"opStencilDepthPass",null),(0,e.e)([(0,V.W)()],z.prototype,"mask",null),(0,e.e)([(0,V.W)()],z.prototype,"enabled",null);var K=i(12134);class I{get _supportGlowLayer(){return!1}set _glowModeEnabled(b){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(b){if(this._alpha===b)return;const n=this._alpha;this._alpha=b,1!==n&&1!==b||this.WB(I.MiscDirtyFlag+I.PrePassDirtyFlag)}get alpha(){return this._alpha}set Re(b){this._backFaceCulling!==b&&(this._backFaceCulling=b,this.WB(I.TextureDirtyFlag))}get Re(){return this._backFaceCulling}set cullBackFaces(b){this._cullBackFaces!==b&&(this._cullBackFaces=b,this.WB(I.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(b){this._blockDirtyMechanism!==b&&(this._blockDirtyMechanism=b,b||this.hN())}atomicMaterialsUpdate(b){this.blockDirtyMechanism=!0;try{b(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(b){this._onDisposeObserver&&this.Qe.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qe.add(b)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new U.e),this._onBindObservable}set onBind(b){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(b)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new U.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new U.e),this._onEffectCreatedObservable}set alphaMode(b){this._alphaMode!==b&&(this._alphaMode=b,this.WB(I.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(b){this._needDepthPrePass!==b&&(this._needDepthPrePass=b,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(b){this._fogEnabled!==b&&(this._fogEnabled=b,this.WB(I.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case I.WireFrameFillMode:case I.LineListDrawMode:case I.LineLoopDrawMode:case I.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(b){this.fillMode=b?I.WireFrameFillMode:I.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case I.PointFillMode:case I.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(b){this.fillMode=b?I.PointFillMode:I.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(b){this._fillMode!==b&&(this._fillMode=b,this.WB(I.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(b){const n=this.ab().getEngine().getCaps().fragmentDepthSupported;b&&!n&&mb.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=b&&n,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(b){this._drawWrapper=b}constructor(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Qe=new U.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new z,this._useUBO=!1,this._fillMode=I.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=b;const V=n||Y.d.LastCreatedScene;V&&(this._scene=V,this._dirtyCallbacks={},this._forceGLSL=e,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=b||Q.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Z.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new B.c(this._scene.getEngine(),void 0,void 0,b),this._useUBO=this.ab().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),I.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var b;const n=this.ab().getEngine();null===(b=this._uniformBuffer)||void 0===b||b.dispose(),n.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new B.c(n,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new B.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(b){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.hN(),this.checkReadyOnlyOnce=!0}unfreeze(){this.hN(),this.checkReadyOnlyOnce=!1}isReady(b,n){return!0}isReadyForSubMesh(b,n,i){const e=n.materialDefines;return!!e&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=e,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}ab(){return this._scene}_getEffectiveOrientation(b){return null!==this.sideOrientation?this.sideOrientation:b.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(b){this._transparencyMode!==b&&(this._transparencyMode=b,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===I.MATERIAL_ALPHABLEND||this._transparencyMode===I.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===I.MATERIAL_ALPHATEST||this._transparencyMode===I.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===I.MATERIAL_OPAQUE||this._transparencyMode===I.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(b){return this._hasTransparencyMode?this._transparencyModeIsBlend:b.visibility<1||!this._disableAlphaBlending&&(b.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(b){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(b)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}hN(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=this.ab().meshes;for(const i of n)if(i.xe)for(const n of i.xe)if(n.Jb()===this)for(const i of n._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=b);b&&this.WB(I.AllDirtyFlag)}_preBind(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.getEngine(),e=(null==n?this.sideOrientation:n)===I.ClockWiseSideOrientation;return i.enableEffect(b||this._getDrawWrapper()),i.setState(this.Re,this.zOffset,!1,e,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),e}bind(b,n){}buildUniformLayout(){const b=this._uniformBuffer;this._eventInfo.ubo=b,this._callbackPluginEventGeneric(8,this._eventInfo),b.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(b,n,i){const e=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),e._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(b){}bindView(b){this._useUBO?this._needToBindSceneUbo=!0:b.setMatrix("view",this.ab().getViewMatrix())}bindViewProjection(b){this._useUBO?this._needToBindSceneUbo=!0:(b.setMatrix("viewProjection",this.ab().getTransformMatrix()),b.setMatrix("projection",this.ab().getProjectionMatrix()))}bindEyePosition(b,n){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(b,n)}_afterBind(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&n&&(this._needToBindSceneUbo=!1,(0,K.s)(n,this.ab().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=b?b.visibility:1,this._onBindObservable&&b&&this._onBindObservable.notifyObservers(b),this.disableDepthWrite){const b=this._scene.getEngine();this._cachedDepthWriteState=b.getDepthWrite(),b.setDepthWrite(!1)}if(this.disableColorWrite){const b=this._scene.getEngine();this._cachedColorWriteState=b.getColorWrite(),b.setColorWrite(!1)}if(0!==this.depthFunction){const b=this._scene.getEngine();this._cachedDepthFunctionState=b.getDepthFunction()||0,b.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(b){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=b,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(b){return null}_clonePlugins(b,n){const i={};if(this._serializePlugins(i),I._ParsePlugins(i,b,this._scene,n),this.pluginManager)for(const e of this.pluginManager._plugins){const n=b.pluginManager.getPlugin(e.name);n&&e.copyTo(n)}}getBindedMeshes(){if(this.meshMap){const b=[];for(const n in this.meshMap){const i=this.meshMap[n];i&&b.push(i)}return b}return this._scene.meshes.filter((b=>b.material===this))}forceCompilation(b,n,i,e){const V={clipPlane:!1,useInstances:!1,...i},Q=this.ab(),U=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const Y=()=>{if(!this._scene||!this._scene.getEngine())return;const i=Q.clipPlane;if(V.clipPlane&&(Q.clipPlane=new N.c(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,Q=null;if(b.xe){const n=new L.d(0,0,0,0,0,b,void 0,!1,!1);n.materialDefines&&(n.materialDefines._renderId=-1),this.isReadyForSubMesh(b,n,V.useInstances)||(n.effect&&n.effect.getCompilationError()&&n.effect.allFallbacksProcessed()?Q=n.effect.getCompilationError():(i=!1,setTimeout(Y,16)))}i&&(this.allowShaderHotSwapping=U,Q&&e&&e(Q),n&&n(this))}else this.isReady()?(this.allowShaderHotSwapping=U,n&&n(this)):setTimeout(Y,16);V.clipPlane&&(Q.clipPlane=i)};Y()}async forceCompilationAsync(b,n){return await new Promise(((i,e)=>{this.forceCompilation(b,(()=>{i()}),n,(b=>{e(b)}))}))}WB(b){this.ab().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(I._DirtyCallbackArray.length=0,b&I.ImageProcessingDirtyFlag&&I._DirtyCallbackArray.push(I._ImageProcessingDirtyCallBack),b&I.TextureDirtyFlag&&I._DirtyCallbackArray.push(I._TextureDirtyCallBack),b&I.LightDirtyFlag&&I._DirtyCallbackArray.push(I._LightsDirtyCallBack),b&I.FresnelDirtyFlag&&I._DirtyCallbackArray.push(I._FresnelDirtyCallBack),b&I.AttributesDirtyFlag&&I._DirtyCallbackArray.push(I._AttributeDirtyCallBack),b&I.MiscDirtyFlag&&I._DirtyCallbackArray.push(I._MiscDirtyCallBack),b&I.PrePassDirtyFlag&&I._DirtyCallbackArray.push(I._PrePassDirtyCallBack),I._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(I._RunDirtyCallBacks),this.ab().resetCachedMaterial())}resetDrawCache(){const b=this.ab().meshes;for(const n of b)if(n.xe)for(const b of n.xe)b.Jb()===this&&b.resetDrawCache()}_markAllSubMeshesAsDirty(b){const n=this.ab();if(n.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=n.meshes;for(const e of i)if(e.xe)for(const i of e.xe){if((i.Jb()||(n._hasDefaultMaterial?n.defaultMaterial:null))===this)for(const n of i._drawWrappers)n&&n.defines&&n.defines.markAllAsDirty&&this._materialContext===n.materialContext&&b(n.defines)}}_markScenePrePassDirty(){if(this.ab().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const b=this.ab().enablePrePassRenderer();b&&b.WB()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(I._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(I._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(I._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(I._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(I._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(I._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(I._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(I._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(I._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(I._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const b=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Qe.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(b)}))}}setPrePassRenderer(b){return!1}dispose(b,n,i){const e=this.ab();if(e.stopAnimation(this),e.freeProcessedMaterials(),e.removeMaterial(this),this._eventInfo.forceDisposeTextures=n,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const b=this._parentContainer.materials.indexOf(this);b>-1&&this._parentContainer.materials.splice(b,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const V in this.meshMap){const b=this.meshMap[V];this._disposeMeshResources(b)}else{const b=e.meshes;for(const n of b)this._disposeMeshResources(n)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Qe.notifyObservers(this),this.Qe.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(b){if(!b)return;const n=b.We,i=b._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(b.xe&&i)for(const V of b.xe){const b=V._drawWrappers;for(let Q=0;Q<b.length;Q++){var e;const U=null===(e=b[Q])||void 0===e?void 0:e.effect;if(!U)continue;i[Q]===this&&(null===n||void 0===n||n._releaseVertexArrayObject(U),V._removeDrawWrapper(Q,!0,!0))}}}else null===n||void 0===n||n._releaseVertexArrayObject(this._drawWrapper.effect);b.material!==this||b.sourceMesh||(b.material=null)}serialize(){const b=T.c.Serialize(this);return b.stencil=this.stencil.serialize(),b.uniqueId=this.uniqueId,this._serializePlugins(b),b}_serializePlugins(b){if(b.plugins={},this.pluginManager)for(const n of this.pluginManager._plugins)n.doNotSerialize||(b.plugins[n.getClassName()]=n.serialize())}static Parse(b,n,i){if(b.customType){if("BABYLON.PBRMaterial"===b.customType&&b.overloadedAlbedo&&(b.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return mb.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else b.customType="BABYLON.StandardMaterial";const e=Q.Tools.Instantiate(b.customType).Parse(b,n,i);return e._loadedUniqueId=b.uniqueId,e}static _ParsePlugins(b,n,i,e){if(b.plugins)for(const Y in b.plugins){var V,U;const L=b.plugins[Y];let B=null===(V=n.pluginManager)||void 0===V?void 0:V.getPlugin(L.name);if(!B){const b=Q.Tools.Instantiate("BABYLON."+Y);b&&(B=new b(n))}null===(U=B)||void 0===U||U.parse(L,i,e)}}}I.TriangleFillMode=0,I.WireFrameFillMode=1,I.PointFillMode=2,I.PointListDrawMode=3,I.LineListDrawMode=4,I.LineLoopDrawMode=5,I.LineStripDrawMode=6,I.TriangleStripDrawMode=7,I.TriangleFanDrawMode=8,I.ClockWiseSideOrientation=0,I.CounterClockWiseSideOrientation=1,I.ImageProcessingDirtyFlag=64,I.TextureDirtyFlag=1,I.LightDirtyFlag=2,I.FresnelDirtyFlag=4,I.AttributesDirtyFlag=8,I.MiscDirtyFlag=16,I.PrePassDirtyFlag=32,I.AllDirtyFlag=127,I.MATERIAL_OPAQUE=0,I.MATERIAL_ALPHATEST=1,I.MATERIAL_ALPHABLEND=2,I.MATERIAL_ALPHATESTANDBLEND=3,I.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,I.MATERIAL_NORMALBLENDMETHOD_RNM=1,I.OnEventObservable=new U.e,I._AllDirtyCallBack=b=>b.markAllAsDirty(),I._ImageProcessingDirtyCallBack=b=>b.markAsImageProcessingDirty(),I._TextureDirtyCallBack=b=>b.markAsTexturesDirty(),I._FresnelDirtyCallBack=b=>b.markAsFresnelDirty(),I._MiscDirtyCallBack=b=>b.markAsMiscDirty(),I._PrePassDirtyCallBack=b=>b.markAsPrePassDirty(),I._LightsDirtyCallBack=b=>b.markAsLightDirty(),I._AttributeDirtyCallBack=b=>b.markAsAttributesDirty(),I._FresnelAndMiscDirtyCallBack=b=>{I._FresnelDirtyCallBack(b),I._MiscDirtyCallBack(b)},I._TextureAndMiscDirtyCallBack=b=>{I._TextureDirtyCallBack(b),I._MiscDirtyCallBack(b)},I._DirtyCallbackArray=[],I._RunDirtyCallBacks=b=>{for(const n of I._DirtyCallbackArray)n(b)},(0,e.e)([(0,V.W)()],I.prototype,"id",void 0),(0,e.e)([(0,V.W)()],I.prototype,"uniqueId",void 0),(0,e.e)([(0,V.W)()],I.prototype,"name",void 0),(0,e.e)([(0,V.W)()],I.prototype,"metadata",void 0),(0,e.e)([(0,V.W)()],I.prototype,"checkReadyOnEveryCall",void 0),(0,e.e)([(0,V.W)()],I.prototype,"checkReadyOnlyOnce",void 0),(0,e.e)([(0,V.W)()],I.prototype,"state",void 0),(0,e.e)([(0,V.W)("alpha")],I.prototype,"_alpha",void 0),(0,e.e)([(0,V.W)("Re")],I.prototype,"_backFaceCulling",void 0),(0,e.e)([(0,V.W)("cullBackFaces")],I.prototype,"_cullBackFaces",void 0),(0,e.e)([(0,V.W)()],I.prototype,"sideOrientation",void 0),(0,e.e)([(0,V.W)("alphaMode")],I.prototype,"_alphaMode",void 0),(0,e.e)([(0,V.W)()],I.prototype,"_needDepthPrePass",void 0),(0,e.e)([(0,V.W)()],I.prototype,"disableDepthWrite",void 0),(0,e.e)([(0,V.W)()],I.prototype,"disableColorWrite",void 0),(0,e.e)([(0,V.W)()],I.prototype,"forceDepthWrite",void 0),(0,e.e)([(0,V.W)()],I.prototype,"depthFunction",void 0),(0,e.e)([(0,V.W)()],I.prototype,"separateCullingPass",void 0),(0,e.e)([(0,V.W)("fogEnabled")],I.prototype,"_fogEnabled",void 0),(0,e.e)([(0,V.W)()],I.prototype,"pointSize",void 0),(0,e.e)([(0,V.W)()],I.prototype,"zOffset",void 0),(0,e.e)([(0,V.W)()],I.prototype,"zOffsetUnits",void 0),(0,e.e)([(0,V.W)()],I.prototype,"pointsCloud",null),(0,e.e)([(0,V.W)()],I.prototype,"fillMode",null),(0,e.e)([(0,V.W)()],I.prototype,"useLogarithmicDepth",null),(0,e.e)([(0,V.W)()],I.prototype,"transparencyMode",null)},12134:(b,n,i)=>{i.d(n,{$:()=>C,A:()=>d,D:()=>j,H:()=>a,J:()=>T,M:()=>Z,P:()=>E,T:()=>A,U:()=>y,Y:()=>O,Z:()=>x,bb:()=>t,d:()=>G,db:()=>w,e:()=>N,eb:()=>W,g:()=>M,hb:()=>z,k:()=>mb,o:()=>K,s:()=>I,v:()=>u,z:()=>D});var e=i(11621),V=i(11822),Q=i(11646),U=i(12078),Y=i(12142);const L=V.Mn.Black(),B={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function mb(b,n,i){if(!b||b.LOGARITHMICDEPTH||b.indexOf&&b.indexOf("LOGARITHMICDEPTH")>=0){const b=i.activeCamera;1===b.mode&&e.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),n.setFloat("logarithmicDepthConstant",2/(Math.log(b.maxZ+1)/Math.LN2))}}function N(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&b.fogEnabled&&(!n||n.applyFog)&&0!==b.fogMode&&(i.setFloat4("vFogInfos",b.fogMode,b.fogStart,b.fogEnd,b.fogDensity),e?(b.fogColor.toLinearSpaceToRef(L,b.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",L)):i.setColor3("vFogColor",b.fogColor))}function Z(b,n,i,e,V,Q,U,Y,L,mb){const N=b.numMaxInfluencers||b.numInfluencers;return N<=0?0:(n.push("#define MORPHTARGETS"),b.hasPositions&&n.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),b.hasNormals&&n.push("#define MORPHTARGETTEXTURE_HASNORMALS"),b.hasTangents&&n.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),b.hasUVs&&n.push("#define MORPHTARGETTEXTURE_HASUVS"),b.hasUV2s&&n.push("#define MORPHTARGETTEXTURE_HASUV2S"),b.hasColors&&n.push("#define MORPHTARGETTEXTURE_HASCOLORS"),b.supportsPositions&&V&&n.push("#define MORPHTARGETS_POSITION"),b.supportsNormals&&Q&&n.push("#define MORPHTARGETS_NORMAL"),b.supportsTangents&&U&&n.push("#define MORPHTARGETS_TANGENT"),b.supportsUVs&&Y&&n.push("#define MORPHTARGETS_UV"),b.supportsUV2s&&L&&n.push("#define MORPHTARGETS_UV2"),b.supportsColors&&mb&&n.push("#define MORPHTARGETS_COLOR"),n.push("#define NUM_MORPH_INFLUENCERS "+N),b.isUsingTextureForTargets&&n.push("#define MORPHTARGETS_TEXTURE"),B.NUM_MORPH_INFLUENCERS=N,B.NORMAL=Q,B.TANGENT=U,B.UV=Y,B.UV2=L,B.COLOR=mb,T(i,e,B,V),N)}function T(b,n,i){let V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=i.NUM_MORPH_INFLUENCERS;if(U>0&&Q.d.LastCreatedEngine){const Y=Q.d.LastCreatedEngine.getCaps().maxVertexAttribs,L=n.morphTargetManager;if(null!==L&&void 0!==L&&L.isUsingTextureForTargets)return;const B=L&&L.supportsPositions&&V,mb=L&&L.supportsNormals&&i.NORMAL,N=L&&L.supportsTangents&&i.TANGENT,Z=L&&L.supportsUVs&&i.UV1,T=L&&L.supportsUV2s&&i.UV2,z=L&&L.supportsColors&&i.VERTEXCOLOR;for(let i=0;i<U;i++)B&&b.push("position"+i),mb&&b.push("normal"+i),N&&b.push("tangent"+i),Z&&b.push("uv_"+i),T&&b.push("uv2_"+i),z&&b.push("color"+i),b.length>Y&&e.b.Error("Cannot add more vertex attributes for mesh "+n.name)}}function z(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b.push("world0"),b.push("world1"),b.push("world2"),b.push("world3"),n&&(b.push("previousWorld0"),b.push("previousWorld1"),b.push("previousWorld2"),b.push("previousWorld3"))}function K(b,n){const i=b.morphTargetManager;b&&i&&n.setFloatArray("morphTargetInfluences",i.influences)}function I(b,n){n.bindToEffect(b,"Scene")}function O(b,n,i){n._needUVs=!0,n[i]=!0,b.optimizeUVAllocation&&b.getTextureMatrix().isIdentityAs3x2()?(n[i+"DIRECTUV"]=b.coordinatesIndex+1,n["MAINUV"+(b.coordinatesIndex+1)]=!0):n[i+"DIRECTUV"]=0}function u(b,n,i){const e=b.getTextureMatrix();n.Ee(i+"Matrix",e)}function d(b,n,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&b.push("bakedVertexAnimationSettingsInstanced")}function G(b,n,i){var e;if(n&&b&&(b.computeBonesUsingShaders&&n._bonesComputationForcedToCPU&&(b.computeBonesUsingShaders=!1),b.useBones&&b.computeBonesUsingShaders&&b.skeleton)){const V=b.skeleton;if(V.isUsingTextureForMatrices&&n.getUniformIndex("boneTextureWidth")>-1){const i=V.getTransformMatrixTexture(b);n.setTexture("boneSampler",i),n.setFloat("boneTextureWidth",4*(V.bones.length+1))}else{const Q=V.getTransformMatrices(b);Q&&(n.setMatrices("mBones",Q),i&&b.ab().prePassRenderer&&b.ab().prePassRenderer.getIndex(2)&&(i.previousBones[b.uniqueId]||(i.previousBones[b.uniqueId]=Q.slice()),n.setMatrices("mPreviousBones",i.previousBones[b.uniqueId]),e=Q,i.previousBones[b.uniqueId].set(e)))}}}function o(b,n,i,e,V){let Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];b._bindLight(n,i,e,V,Q)}function M(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Q=Math.min(n.lightSources.length,V);for(let U=0;U<Q;U++){o(n.lightSources[U],U,b,i,"boolean"===typeof e?e:e.SPECULARTERM,n.receiveShadows)}}function j(b,n,i,e){i.NUM_BONE_INFLUENCERS>0&&(e.addCPUSkinningFallback(0,n),b.push("matricesIndices"),b.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(b.push("matricesIndicesExtra"),b.push("matricesWeightsExtra")))}function a(b,n){(n.INSTANCES||n.THIN_INSTANCES)&&z(b,!!n.PREPASS_VELOCITY),n.INSTANCESCOLOR&&b.push("instanceColor")}function D(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,V=0;for(let Q=0;Q<i&&b["LIGHT"+Q];Q++)Q>0&&(V=e+Q,n.addFallback(V,"LIGHT"+Q)),b.SHADOWS||(b["SHADOW"+Q]&&n.addFallback(e,"SHADOW"+Q),b["SHADOWPCF"+Q]&&n.addFallback(e,"SHADOWPCF"+Q),b["SHADOWPCSS"+Q]&&n.addFallback(e,"SHADOWPCSS"+Q),b["SHADOWPOISSON"+Q]&&n.addFallback(e,"SHADOWPOISSON"+Q),b["SHADOWESM"+Q]&&n.addFallback(e,"SHADOWESM"+Q),b["SHADOWCLOSEESM"+Q]&&n.addFallback(e,"SHADOWCLOSEESM"+Q));return V++}function x(b,n,i,e,V,Q,U){let Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];U._areMiscDirty&&(U.LOGARITHMICDEPTH=i,U.POINTSIZE=e,U.FOG=V&&function(b,n){return n.fogEnabled&&b.applyFog&&0!==n.fogMode}(b,n),U.NONUNIFORMSCALING=b.nonUniformScaling,U.ALPHATEST=Q,U.DECAL_AFTER_DETAIL=Y)}function y(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i._areLightsDirty)return i._needNormals;let U=0;const Y={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(b.lightsEnabled&&!Q)for(const B of n.lightSources)if(s(b,n,B,U,i,e,Y),U++,U===V)break;i.SPECULARTERM=Y.specularEnabled,i.SHADOWS=Y.shadowEnabled;for(let B=U;B<V;B++)void 0!==i["LIGHT"+B]&&(i["LIGHT"+B]=!1,i["HEMILIGHT"+B]=!1,i["POINTLIGHT"+B]=!1,i["DIRLIGHT"+B]=!1,i["SPOTLIGHT"+B]=!1,i["AREALIGHT"+B]=!1,i["SHADOW"+B]=!1,i["SHADOWCSM"+B]=!1,i["SHADOWCSMDEBUG"+B]=!1,i["SHADOWCSMNUM_CASCADES"+B]=!1,i["SHADOWCSMUSESHADOWMAXZ"+B]=!1,i["SHADOWCSMNOBLEND"+B]=!1,i["SHADOWCSM_RIGHTHANDED"+B]=!1,i["SHADOWPCF"+B]=!1,i["SHADOWPCSS"+B]=!1,i["SHADOWPOISSON"+B]=!1,i["SHADOWESM"+B]=!1,i["SHADOWCLOSEESM"+B]=!1,i["SHADOWCUBE"+B]=!1,i["SHADOWLOWQUALITY"+B]=!1,i["SHADOWMEDIUMQUALITY"+B]=!1);const L=b.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(Y.needRebuild=!0),i.SHADOWFLOAT=Y.shadowEnabled&&(L.textureFloatRender&&L.textureFloatLinearFiltering||L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=Y.lightmapMode,Y.needRebuild&&i.rebuild(),Y.needNormals}function s(b,n,i,e,V,Q,Y){switch(Y.needNormals=!0,void 0===V["LIGHT"+e]&&(Y.needRebuild=!0),V["LIGHT"+e]=!0,V["SPOTLIGHT"+e]=!1,V["HEMILIGHT"+e]=!1,V["POINTLIGHT"+e]=!1,V["DIRLIGHT"+e]=!1,V["AREALIGHT"+e]=!1,i.prepareLightSpecificDefines(V,e),V["LIGHT_FALLOFF_PHYSICAL"+e]=!1,V["LIGHT_FALLOFF_GLTF"+e]=!1,V["LIGHT_FALLOFF_STANDARD"+e]=!1,i.falloffType){case U.e.FALLOFF_GLTF:V["LIGHT_FALLOFF_GLTF"+e]=!0;break;case U.e.FALLOFF_PHYSICAL:V["LIGHT_FALLOFF_PHYSICAL"+e]=!0;break;case U.e.FALLOFF_STANDARD:V["LIGHT_FALLOFF_STANDARD"+e]=!0}if(Q&&!i.Um.equalsFloats(0,0,0)&&(Y.specularEnabled=!0),V["SHADOW"+e]=!1,V["SHADOWCSM"+e]=!1,V["SHADOWCSMDEBUG"+e]=!1,V["SHADOWCSMNUM_CASCADES"+e]=!1,V["SHADOWCSMUSESHADOWMAXZ"+e]=!1,V["SHADOWCSMNOBLEND"+e]=!1,V["SHADOWCSM_RIGHTHANDED"+e]=!1,V["SHADOWPCF"+e]=!1,V["SHADOWPCSS"+e]=!1,V["SHADOWPOISSON"+e]=!1,V["SHADOWESM"+e]=!1,V["SHADOWCLOSEESM"+e]=!1,V["SHADOWCUBE"+e]=!1,V["SHADOWLOWQUALITY"+e]=!1,V["SHADOWMEDIUMQUALITY"+e]=!1,n&&n.receiveShadows&&b.shadowsEnabled&&i.shadowEnabled){const n=i.getShadowGenerator(b.activeCamera)??i.getShadowGenerator();if(n){const b=n.getShadowMap();b&&b.renderList&&b.renderList.length>0&&(Y.shadowEnabled=!0,n.prepareDefines(V,e))}}i.lightmapMode!=U.e.LIGHTMAP_DEFAULT?(Y.lightmapMode=!0,V["LIGHTMAPEXCLUDED"+e]=!0,V["LIGHTMAPNOSPECULAR"+e]=i.lightmapMode==U.e.LIGHTMAP_SHADOWSONLY):(V["LIGHTMAPEXCLUDED"+e]=!1,V["LIGHTMAPNOSPECULAR"+e]=!1)}function A(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=function(b,n){let i=!1;if(b.activeCamera){const e=n.CAMERA_ORTHOGRAPHIC?1:0,V=n.CAMERA_PERSPECTIVE?1:0,Q=1===b.activeCamera.mode?1:0,U=0===b.activeCamera.mode?1:0;(e^Q||V^U)&&(n.CAMERA_ORTHOGRAPHIC=1===Q,n.CAMERA_PERSPECTIVE=1===U,i=!0)}return i}(b,e);!1!==Q&&(L=(0,Y.f)(i,b,e)),e.DEPTHPREPASS!==!n.getColorWrite()&&(e.DEPTHPREPASS=!e.DEPTHPREPASS,L=!0),e.INSTANCES!==V&&(e.INSTANCES=V,L=!0),e.THIN_INSTANCES!==U&&(e.THIN_INSTANCES=U,L=!0),L&&e.markAsUnprocessed()}function E(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],U=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!n._areAttributesDirty&&n._needNormals===n._normals&&n._needUVs===n._uvs)return!1;n._normals=n._needNormals,n._uvs=n._needUVs,n.NORMAL=n._needNormals&&b.isVerticesDataPresent("normal"),n._needNormals&&b.isVerticesDataPresent("tangent")&&(n.TANGENT=!0);for(let Y=1;Y<=6;++Y)n["UV"+Y]=!!n._needUVs&&b.isVerticesDataPresent(`uv${1===Y?"":Y}`);if(i){const i=b.useVertexColors&&b.isVerticesDataPresent("color");n.VERTEXCOLOR=i,n.VERTEXALPHA=b.hasVertexAlpha&&i&&Q}return b.isVerticesDataPresent("instanceColor")&&(b.hasInstances||b.hasThinInstances)&&(n.INSTANCESCOLOR=!0),e&&function(b,n){if(b.useBones&&b.computeBonesUsingShaders&&b.skeleton){n.NUM_BONE_INFLUENCERS=b.numBoneInfluencers;const i=void 0!==n.BONETEXTURE;if(b.skeleton.isUsingTextureForMatrices&&i)n.BONETEXTURE=!0;else{n.BonesPerMesh=b.skeleton.bones.length+1,n.BONETEXTURE=!i&&void 0;const e=b.ab().prePassRenderer;if(e&&e.enabled){const i=-1===e.excludedSkinnedMesh.indexOf(b);n.BONES_VELOCITY_ENABLED=i}}}else n.NUM_BONE_INFLUENCERS=0,n.BonesPerMesh=0,void 0!==n.BONETEXTURE&&(n.BONETEXTURE=!1)}(b,n),V&&function(b,n){const i=b.morphTargetManager;i?(n.MORPHTARGETS_UV=i.supportsUVs&&n.UV1,n.MORPHTARGETS_UV2=i.supportsUV2s&&n.UV2,n.MORPHTARGETS_TANGENT=i.supportsTangents&&n.TANGENT,n.MORPHTARGETS_NORMAL=i.supportsNormals&&n.NORMAL,n.MORPHTARGETS_POSITION=i.supportsPositions,n.MORPHTARGETS_COLOR=i.supportsColors,n.MORPHTARGETTEXTURE_HASUVS=i.hasUVs,n.MORPHTARGETTEXTURE_HASUV2S=i.hasUV2s,n.MORPHTARGETTEXTURE_HASTANGENTS=i.hasTangents,n.MORPHTARGETTEXTURE_HASNORMALS=i.hasNormals,n.MORPHTARGETTEXTURE_HASPOSITIONS=i.hasPositions,n.MORPHTARGETTEXTURE_HASCOLORS=i.hasColors,n.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,n.MORPHTARGETS=n.NUM_MORPH_INFLUENCERS>0,n.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(n.MORPHTARGETS_UV=!1,n.MORPHTARGETS_UV2=!1,n.MORPHTARGETS_TANGENT=!1,n.MORPHTARGETS_NORMAL=!1,n.MORPHTARGETS_POSITION=!1,n.MORPHTARGETS_COLOR=!1,n.MORPHTARGETTEXTURE_HASUVS=!1,n.MORPHTARGETTEXTURE_HASUV2S=!1,n.MORPHTARGETTEXTURE_HASTANGENTS=!1,n.MORPHTARGETTEXTURE_HASNORMALS=!1,n.MORPHTARGETTEXTURE_HASPOSITIONS=!1,n.MORPHTARGETTEXTURE_HAS_COLORS=!1,n.MORPHTARGETS=!1,n.NUM_MORPH_INFLUENCERS=0)}(b,n),U&&function(b,n){const i=b.bakedVertexAnimationManager;n.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(b,n),!0}function C(b,n){if(b.activeCamera){const i=n.MULTIVIEW;n.MULTIVIEW=null!==b.activeCamera.outputRenderTarget&&b.activeCamera.outputRenderTarget.getViewCount()>1,n.MULTIVIEW!=i&&n.markAsUnprocessed()}}function t(b,n,i){const e=n.ORDER_INDEPENDENT_TRANSPARENCY,V=n.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;n.ORDER_INDEPENDENT_TRANSPARENCY=b.useOrderIndependentTransparency&&i,n.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!b.getEngine().getCaps().textureFloatLinearFiltering,e===n.ORDER_INDEPENDENT_TRANSPARENCY&&V===n.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||n.markAsUnprocessed()}function w(b,n,i){const e=n.PREPASS;if(!n._arePrePassDirty)return;const V=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(b.prePassRenderer&&b.prePassRenderer.enabled&&i){n.PREPASS=!0,n.SCENE_MRT_COUNT=b.prePassRenderer.mrtCount,n.PREPASS_NORMAL_WORLDSPACE=b.prePassRenderer.generateNormalsInWorldSpace,n.PREPASS_COLOR=!0,n.PREPASS_COLOR_INDEX=0;for(let i=0;i<V.length;i++){const e=b.prePassRenderer.getIndex(V[i].type);-1!==e?(n[V[i].define]=!0,n[V[i].index]=e):n[V[i].define]=!1}}else{n.PREPASS=!1;for(let b=0;b<V.length;b++)n[V[b].define]=!1}n.PREPASS!=e&&(n.markAsUnprocessed(),n.markAsImageProcessingDirty())}function h(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];V&&V.push("Light"+b),Q||(n.push("vLightData"+b,"vLightDiffuse"+b,"vLightSpecular"+b,"vLightDirection"+b,"vLightWidth"+b,"vLightHeight"+b,"vLightFalloff"+b,"vLightGround"+b,"lightMatrix"+b,"shadowsInfo"+b,"depthValues"+b),i.push("shadowTexture"+b),i.push("depthTexture"+b),n.push("viewFrustumZ"+b,"cascadeBlendFactor"+b,"lightSizeUVCorrection"+b,"depthCorrection"+b,"penumbraDarkness"+b,"frustumLengths"+b),e&&(i.push("projectionLightTexture"+b),n.push("textureProjectionMatrix"+b)),U&&i.push("iesLightTexture"+b))}function W(b,n,i){let e,V,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(b.uniformsNames){const U=b;e=U.uniformsNames,V=U.uniformBuffersNames,n=U.samplers,i=U.defines,Q=U.maxSimultaneousLights||0}else e=b,n||(n=[]);for(let U=0;U<Q&&i["LIGHT"+U];U++)h(U,e,n,i["PROJECTEDLIGHTTEXTURE"+U],V,!1,i["IESLIGHTTEXTURE"+U]);i.NUM_MORPH_INFLUENCERS&&(e.push("morphTargetInfluences"),e.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(e.push("bakedVertexAnimationSettings"),e.push("bakedVertexAnimationTextureSizeInverted"),e.push("bakedVertexAnimationTime"),n.push("bakedVertexAnimationTexture"))}},12090:(b,n,i)=>{i.d(n,{c:()=>Q});var e=i(11778),V=i(12095);class Q extends V.b{constructor(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(b,n,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new e.Matrix,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(b,n){return!!b&&(!this._storeEffectOnSubMeshes||(!b.xe||0===b.xe.length||this.isReadyForSubMesh(b,b.xe[0],n)))}_isReadyForSubMesh(b){const n=b.materialDefines;return!(this.checkReadyOnEveryCall||!b.effect||!n||n._renderId!==this.ab().getRenderId())}bindOnlyWorldMatrix(b){this._activeEffect.setMatrix("world",b)}bindOnlyNormalMatrix(b){this._activeEffect.setMatrix("normalMatrix",b)}bind(b,n){n&&this.bindForSubMesh(b,n,n.xe[0])}_afterBind(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;super._afterBind(b,n,i),this.ab()._cachedEffect=n,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i._drawWrapper._forceRebindOnNextCall||b.isCachedMaterialInvalid(this,n,e)}dispose(b,n,i){this._activeEffect=void 0,super.dispose(b,n,i)}}},12132:(b,n,i)=>{i.d(n,{c:()=>Y,d:()=>L});var e=i(11756),V=i(11778),Q=i(11762);class U{static extractMinAndMaxIndexed(b,n,i,e,V,Q){for(let U=i;U<i+e;U++){const i=3*n[U],e=b[i],Y=b[i+1],L=b[i+2];V.minimizeInPlaceFromFloats(e,Y,L),Q.maximizeInPlaceFromFloats(e,Y,L)}}static extractMinAndMax(b,n,i,e,V,Q){for(let U=n,Y=n*e;U<n+i;U++,Y+=e){const n=b[Y],i=b[Y+1],e=b[Y+2];V.minimizeInPlaceFromFloats(n,i,e),Q.maximizeInPlaceFromFloats(n,i,e)}}}function Y(b,n,i,e){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Y=new V.On(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new V.On(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return U.extractMinAndMaxIndexed(b,n,i,e,Y,L),Q&&(Y.x-=Y.x*Q.x+Q.y,Y.y-=Y.y*Q.x+Q.y,Y.z-=Y.z*Q.x+Q.y,L.x+=L.x*Q.x+Q.y,L.y+=L.y*Q.x+Q.y,L.z+=L.z*Q.x+Q.y),{minimum:Y,maximum:L}}function L(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0;const Y=new V.On(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new V.On(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Q||(Q=3),U.extractMinAndMax(b,n,i,Q,Y,L),e&&(Y.x-=Y.x*e.x+e.y,Y.y-=Y.y*e.x+e.y,Y.z-=Y.z*e.x+e.y,L.x+=L.x*e.x+e.y,L.y+=L.y*e.x+e.y,L.z+=L.z*e.x+e.y),{minimum:Y,maximum:L}}(0,e.e)([Q.h.filter((function(){for(var b=arguments.length,n=new Array(b),i=0;i<b;i++)n[i]=arguments[i];let[e,V]=n;return!Array.isArray(e)&&!Array.isArray(V)}))],U,"extractMinAndMaxIndexed",null),(0,e.e)([Q.h.filter((function(){for(var b=arguments.length,n=new Array(b),i=0;i<b;i++)n[i]=arguments[i];let[e]=n;return!Array.isArray(e)}))],U,"extractMinAndMax",null)},12102:(b,n,i)=>{i.d(n,{d:()=>L});var e=i(11842),V=i(12108),Q=i(12112),U=i(12132),Y=i(11883);class L{get materialDefines(){var b;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(b=this._getDrawWrapper())||void 0===b?void 0:b.defines}set materialDefines(b){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=b}_getDrawWrapper(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b=b??this._engine.currentRenderPassId;let i=this._drawWrappers[b];return!i&&n&&(this._drawWrappers[b]=i=new Y.b(this._mesh.ab().getEngine())),i}_removeDrawWrapper(b){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(i=this._drawWrappers[b])||void 0===i||i.dispose(n));this._drawWrappers[b]=void 0}get effect(){var b;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(b=this._getDrawWrapper())||void 0===b?void 0:b.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(b){this._mainDrawWrapperOverride=b}setEffect(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const V=this._drawWrapper;V.setEffect(b,n,e),void 0!==i&&(V.materialContext=i),b||(V.defines=null,V.materialContext=void 0)}resetDrawCache(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==b)return void this._removeDrawWrapper(b,!0,n);for(const b of this._drawWrappers)null===b||void 0===b||b.dispose(n)}this._drawWrappers=[]}static AddToMesh(b,n,i,e,V,Q,U){return new L(b,n,i,e,V,Q,U,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(b,n,i,e,V,Q,U){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],L=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=b,this.verticesStart=n,this.verticesCount=i,this.indexStart=e,this.indexCount=V,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Q,this._renderingMesh=U||Q,L&&Q.xe.push(this),this._engine=this._mesh.ab().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Q.xe.length-1,Y&&(this.refreshBoundingInfo(),Q.we(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(b){return this._boundingInfo=b,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const b=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return b||this._renderingMesh}Jb(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!n)return b&&this._mesh.ab()._hasDefaultMaterial?this._mesh.ab().defaultMaterial:null;if(this._isMultiMaterial(n)){const b=n.getSubMaterial(this.materialIndex);return this._currentMaterial!==b&&(this._currentMaterial=b,this.resetDrawCache()),b}return n}_isMultiMaterial(b){return void 0!==b.getSubMaterial}refreshBoundingInfo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.We)return this;if(b||(b=this._renderingMesh.getVerticesData(e.g.PositionKind)),!b)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const n=this._renderingMesh.Je();let i;if(0===this.indexStart&&this.indexCount===n.length){const b=this._renderingMesh.getBoundingInfo();i={minimum:b.minimum.clone(),maximum:b.maximum.clone()}}else i=(0,U.c)(b,n,this.indexStart,this.indexCount,this._renderingMesh.We.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Q.d(i.minimum,i.maximum),this}_checkCollision(b){return this.getBoundingInfo()._checkCollision(b)}updateBoundingInfo(b){let n=this.getBoundingInfo();return n||(this.refreshBoundingInfo(),n=this.getBoundingInfo()),n&&n.update(b),this}isInFrustum(b){const n=this.getBoundingInfo();return!!n&&n.isInFrustum(b,this._mesh.LN)}isCompletelyInFrustum(b){const n=this.getBoundingInfo();return!!n&&n.isCompletelyInFrustum(b)}render(b){return this._renderingMesh.render(this,b,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(b,n){if(!this._linesIndexBuffer){const i=6*Math.floor(this.indexCount/3),e=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let V=0;if(0===b.length)for(let b=this.indexStart;b<this.indexStart+this.indexCount;b+=3)e[V++]=b,e[V++]=b+1,e[V++]=b+1,e[V++]=b+2,e[V++]=b+2,e[V++]=b;else for(let n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)e[V++]=b[n],e[V++]=b[n+1],e[V++]=b[n+1],e[V++]=b[n+2],e[V++]=b[n+2],e[V++]=b[n];this._linesIndexBuffer=n.createIndexBuffer(e),this._linesIndexCount=e.length}return this._linesIndexBuffer}canIntersects(b){const n=this.getBoundingInfo();return!!n&&b.intersectsBox(n.boundingBox)}intersects(b,n,i,e,V){const Q=this.Jb();if(!Q)return null;let U=3,Y=!1;switch(Q.fillMode){case 3:case 5:case 6:case 8:return null;case 7:U=1,Y=!0}return 4===Q.fillMode?i.length?this._intersectLines(b,n,i,this._mesh.intersectionThreshold,e):this._intersectUnIndexedLines(b,n,i,this._mesh.intersectionThreshold,e):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(b,n,i,e,V):this._intersectTriangles(b,n,i,U,Y,e,V)}_intersectLines(b,n,i,e,Q){let U=null;for(let Y=this.indexStart;Y<this.indexStart+this.indexCount;Y+=2){const L=n[i[Y]],B=n[i[Y+1]],mb=b.intersectionSegment(L,B,e);if(!(mb<0)&&((Q||!U||mb<U.distance)&&(U=new V.c(null,null,mb),U.faceId=Y/2,Q)))break}return U}_intersectUnIndexedLines(b,n,i,e,Q){let U=null;for(let Y=this.verticesStart;Y<this.verticesStart+this.verticesCount;Y+=2){const i=n[Y],L=n[Y+1],B=b.intersectionSegment(i,L,e);if(!(B<0)&&((Q||!U||B<U.distance)&&(U=new V.c(null,null,B),U.faceId=Y/2,Q)))break}return U}_intersectTriangles(b,n,i,e,V,Q,U){let Y=null,L=-1;for(let B=this.indexStart;B<this.indexStart+this.indexCount-(3-e);B+=e){L++;const e=i[B],mb=i[B+1],N=i[B+2];if(V&&4294967295===N){B+=2;continue}const Z=n[e],T=n[mb],z=n[N];if(!Z||!T||!z)continue;if(U&&!U(Z,T,z,b,e,mb,N))continue;const K=b.intersectsTriangle(Z,T,z);if(K){if(K.distance<0)continue;if((Q||!Y||K.distance<Y.distance)&&(Y=K,Y.faceId=L,Q))break}}return Y}_intersectUnIndexedTriangles(b,n,i,e,V){let Q=null;for(let U=this.verticesStart;U<this.verticesStart+this.verticesCount;U+=3){const i=n[U],Y=n[U+1],L=n[U+2];if(V&&!V(i,Y,L,b,-1,-1,-1))continue;const B=b.intersectsTriangle(i,Y,L);if(B){if(B.distance<0)continue;if((e||!Q||B.distance<Q.distance)&&(Q=B,Q.faceId=U/3,e))break}}return Q}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(b,n){const i=new L(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,b,n,!1);if(!this.IsGlobal){const b=this.getBoundingInfo();if(!b)return i;i._boundingInfo=new Q.d(b.minimum,b.maximum)}return i}dispose(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.ab().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const n=this._mesh.xe.indexOf(this);this._mesh.xe.splice(n,1),this.resetDrawCache(void 0,b)}getClassName(){return"SubMesh"}static CreateFromIndices(b,n,i,e,V){let Q=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],U=Number.MAX_VALUE,Y=-Number.MAX_VALUE;const B=(V||e).Je();for(let L=n;L<n+i;L++){const b=B[L];b<U&&(U=b),b>Y&&(Y=b)}return new L(b,U,Y-U+1,n,i,e,V,Q)}}}}]);