"use strict";(self["1kjc9ee3uyt"]=self["1kjc9ee3uyt"]||[]).push([[24],{11993:(w,E,G)=>{G.d(E,{c:()=>P});class P{constructor(w,E,G){this.bu=w,this.bv=E,this.distance=G,this.faceId=0,this.subMeshId=0}}},12003:(w,E,G)=>{G.d(E,{c:()=>y});var P=G(11684),h=G(11679),B=G(11681);class y{constructor(w,E,G){this.vectors=(0,P.d)(8,h.QE.Zero),this.center=h.QE.Zero(),this.centerWorld=h.QE.Zero(),this.extendSize=h.QE.Zero(),this.extendSizeWorld=h.QE.Zero(),this.directions=(0,P.d)(3,h.QE.Zero),this.vectorsWorld=(0,P.d)(8,h.QE.Zero),this.minimumWorld=h.QE.Zero(),this.maximumWorld=h.QE.Zero(),this.minimum=h.QE.Zero(),this.maximum=h.QE.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(w,E,G)}reConstruct(w,E,G){const P=w.x,B=w.y,y=w.z,x=E.x,U=E.y,l=E.z,i=this.vectors;this.minimum.tx(P,B,y),this.maximum.tx(x,U,l),i[0].tx(P,B,y),i[1].tx(x,U,l),i[2].tx(x,B,y),i[3].tx(P,U,y),i[4].tx(P,B,l),i[5].tx(x,U,y),i[6].tx(P,U,l),i[7].tx(x,B,l),E.addToRef(w,this.center).scaleInPlace(.5),E.subtractToRef(w,this.extendSize).scaleInPlace(.5),this._worldMatrix=G||h.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(w){const E=y._TmpVector3,G=this.maximum.subtractToRef(this.minimum,E[0]),P=G.length();G.normalizeFromLength(P);const h=P*w,B=G.scaleInPlace(.5*h),x=this.center.subtractToRef(B,E[1]),U=this.center.addToRef(B,E[2]);return this.reConstruct(x,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){const E=this.minimumWorld,G=this.maximumWorld,P=this.directions,B=this.vectorsWorld,y=this.vectors;if(w.isIdentity()){E.B(this.minimum),G.B(this.maximum);for(let w=0;w<8;++w)B[w].B(y[w]);this.extendSizeWorld.B(this.extendSize),this.centerWorld.B(this.center)}else{E.Wx(Number.MAX_VALUE),G.Wx(-Number.MAX_VALUE);for(let P=0;P<8;++P){const x=B[P];h.QE.TransformCoordinatesToRef(y[P],w,x),E.minimizeInPlace(x),G.maximizeInPlace(x)}G.subtractToRef(E,this.extendSizeWorld).scaleInPlace(.5),G.addToRef(E,this.centerWorld).scaleInPlace(.5)}h.QE.FromArrayToRef(w.m,0,P[0]),h.QE.FromArrayToRef(w.m,4,P[1]),h.QE.FromArrayToRef(w.m,8,P[2]),this._worldMatrix=w}isInFrustum(w){return y.IsInFrustum(this.vectorsWorld,w)}isCompletelyInFrustum(w){return y.IsCompletelyInFrustum(this.vectorsWorld,w)}intersectsPoint(w){const E=this.minimumWorld,G=this.maximumWorld,P=E.x,h=E.y,y=E.z,x=G.x,U=G.y,l=G.z,i=w.x,O=w.y,u=w.z,V=-B.d;return!(x-i<V||V>i-P)&&(!(U-O<V||V>O-h)&&!(l-u<V||V>u-y))}intersectsSphere(w){return y.IntersectsSphere(this.minimumWorld,this.maximumWorld,w.centerWorld,w.radiusWorld)}intersectsMinMax(w,E){const G=this.minimumWorld,P=this.maximumWorld,h=G.x,B=G.y,y=G.z,x=P.x,U=P.y,l=P.z,i=w.x,O=w.y,u=w.z,V=E.x,a=E.y,Q=E.z;return!(x<i||h>V)&&(!(U<O||B>a)&&!(l<u||y>Q))}dispose(){var w,E;null===(w=this._drawWrapperFront)||void 0===w||w.dispose(),null===(E=this._drawWrapperBack)||void 0===E||E.dispose()}static Intersects(w,E){return w.intersectsMinMax(E.minimumWorld,E.maximumWorld)}static IntersectsSphere(w,E,G,P){const B=y._TmpVector3[0];h.QE.ClampToRef(G,w,E,B);return h.QE.DistanceSquared(G,B)<=P*P}static IsCompletelyInFrustum(w,E){for(let G=0;G<6;++G){const P=E[G];for(let E=0;E<8;++E)if(P.dotCoordinate(w[E])<0)return!1}return!0}static IsInFrustum(w,E){for(let G=0;G<6;++G){let P=!0;const h=E[G];for(let E=0;E<8;++E)if(h.dotCoordinate(w[E])>=0){P=!1;break}if(P)return!1}return!0}}y._TmpVector3=(0,P.d)(3,h.QE.Zero)},11998:(w,E,G)=>{G.d(E,{c:()=>O});var P=G(11684),h=G(11679),B=G(12003),y=G(12008);const x={min:0,max:0},U={min:0,max:0},l=(w,E,G)=>{const P=h.QE.Dot(E.centerWorld,w),B=Math.abs(h.QE.Dot(E.directions[0],w))*E.extendSize.x+Math.abs(h.QE.Dot(E.directions[1],w))*E.extendSize.y+Math.abs(h.QE.Dot(E.directions[2],w))*E.extendSize.z;G.min=P-B,G.max=P+B},i=(w,E,G)=>(l(w,E,x),l(w,G,U),!(x.min>U.max||U.min>x.max));class O{constructor(w,E,G){this._isLocked=!1,this.boundingBox=new B.c(w,E,G),this.boundingSphere=new y.b(w,E,G)}reConstruct(w,E,G){this.boundingBox.reConstruct(w,E,G),this.boundingSphere.reConstruct(w,E,G)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(w){this._isLocked=w}update(w){this._isLocked||(this.boundingBox._update(w),this.boundingSphere._update(w))}centerOn(w,E){const G=O._TmpVector3[0].B(w).xO(E),P=O._TmpVector3[1].B(w).addInPlace(E);return this.boundingBox.reConstruct(G,P,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(G,P,this.boundingBox.getWorldMatrix()),this}encapsulate(w){const E=h.QE.Minimize(this.minimum,w),G=h.QE.Maximize(this.maximum,w);return this.reConstruct(E,G,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(w){const E=h.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(E);const G=h.TmpVectors.QE[0];return h.QE.TransformCoordinatesToRef(w.boundingBox.minimumWorld,E,G),this.encapsulate(G),h.QE.TransformCoordinatesToRef(w.boundingBox.maximumWorld,E,G),this.encapsulate(G),this}scale(w){return this.boundingBox.scale(w),this.boundingSphere.scale(w),this}isInFrustum(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===E||3===E)&&this.boundingSphere.isCenterInFrustum(w))return!0;if(!this.boundingSphere.isInFrustum(w))return!1;return!(1!==E&&3!==E)||this.boundingBox.isInFrustum(w)}get diagonalLength(){const w=this.boundingBox;return w.maximumWorld.subtractToRef(w.minimumWorld,O._TmpVector3[0]).length()}isCompletelyInFrustum(w){return this.boundingBox.isCompletelyInFrustum(w)}_checkCollision(w){return w._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(w){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(w)&&!!this.boundingBox.intersectsPoint(w))}intersects(w,E){if(!y.b.Intersects(this.boundingSphere,w.boundingSphere))return!1;if(!B.c.Intersects(this.boundingBox,w.boundingBox))return!1;if(!E)return!0;const G=this.boundingBox,P=w.boundingBox;return!!i(G.directions[0],G,P)&&(!!i(G.directions[1],G,P)&&(!!i(G.directions[2],G,P)&&(!!i(P.directions[0],G,P)&&(!!i(P.directions[1],G,P)&&(!!i(P.directions[2],G,P)&&(!!i(h.QE.Cross(G.directions[0],P.directions[0]),G,P)&&(!!i(h.QE.Cross(G.directions[0],P.directions[1]),G,P)&&(!!i(h.QE.Cross(G.directions[0],P.directions[2]),G,P)&&(!!i(h.QE.Cross(G.directions[1],P.directions[0]),G,P)&&(!!i(h.QE.Cross(G.directions[1],P.directions[1]),G,P)&&(!!i(h.QE.Cross(G.directions[1],P.directions[2]),G,P)&&(!!i(h.QE.Cross(G.directions[2],P.directions[0]),G,P)&&(!!i(h.QE.Cross(G.directions[2],P.directions[1]),G,P)&&!!i(h.QE.Cross(G.directions[2],P.directions[2]),G,P))))))))))))))}}O._TmpVector3=(0,P.d)(2,h.QE.Zero)},12008:(w,E,G)=>{G.d(E,{b:()=>B});var P=G(11684),h=G(11679);class B{constructor(w,E,G){this.center=h.QE.Zero(),this.centerWorld=h.QE.Zero(),this.minimum=h.QE.Zero(),this.maximum=h.QE.Zero(),this.reConstruct(w,E,G)}reConstruct(w,E,G){this.minimum.B(w),this.maximum.B(E);const P=h.QE.Distance(w,E);E.addToRef(w,this.center).scaleInPlace(.5),this.radius=.5*P,this._update(G||h.Matrix.IdentityReadOnly)}scale(w){const E=this.radius*w,G=B._TmpVector3,P=G[0].Wx(E),h=this.center.subtractToRef(P,G[1]),y=this.center.addToRef(P,G[2]);return this.reConstruct(h,y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){if(w.isIdentity())this.centerWorld.B(this.center),this.radiusWorld=this.radius;else{h.QE.TransformCoordinatesToRef(this.center,w,this.centerWorld);const E=B._TmpVector3[0];h.QE.TransformNormalFromFloatsToRef(1,1,1,w,E),this.radiusWorld=Math.max(Math.abs(E.x),Math.abs(E.y),Math.abs(E.z))*this.radius}}isInFrustum(w){const E=this.centerWorld,G=this.radiusWorld;for(let P=0;P<6;P++)if(w[P].dotCoordinate(E)<=-G)return!1;return!0}isCenterInFrustum(w){const E=this.centerWorld;for(let G=0;G<6;G++)if(w[G].dotCoordinate(E)<0)return!1;return!0}intersectsPoint(w){const E=h.QE.DistanceSquared(this.centerWorld,w);return!(this.radiusWorld*this.radiusWorld<E)}static Intersects(w,E){const G=h.QE.DistanceSquared(w.centerWorld,E.centerWorld),P=w.radiusWorld+E.radiusWorld;return!(P*P<G)}static CreateFromCenterAndRadius(w,E,G){this._TmpVector3[0].B(w),this._TmpVector3[1].tx(0,0,E),this._TmpVector3[2].B(w),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].xO(this._TmpVector3[1]);const P=new B(this._TmpVector3[0],this._TmpVector3[2]);return P._worldMatrix=G||h.Matrix.Identity(),P}}B._TmpVector3=(0,P.d)(3,h.QE.Zero)},12029:(w,E,G)=>{function P(w){-1===w.indexOf("vClipPlane")&&w.push("vClipPlane"),-1===w.indexOf("vClipPlane2")&&w.push("vClipPlane2"),-1===w.indexOf("vClipPlane3")&&w.push("vClipPlane3"),-1===w.indexOf("vClipPlane4")&&w.push("vClipPlane4"),-1===w.indexOf("vClipPlane5")&&w.push("vClipPlane5"),-1===w.indexOf("vClipPlane6")&&w.push("vClipPlane6")}function h(w,E,G){const P=!!(w.clipPlane??E.clipPlane),h=!!(w.clipPlane2??E.clipPlane2),B=!!(w.clipPlane3??E.clipPlane3),y=!!(w.clipPlane4??E.clipPlane4),x=!!(w.clipPlane5??E.clipPlane5),U=!!(w.clipPlane6??E.clipPlane6);P&&G.push("#define CLIPPLANE"),h&&G.push("#define CLIPPLANE2"),B&&G.push("#define CLIPPLANE3"),y&&G.push("#define CLIPPLANE4"),x&&G.push("#define CLIPPLANE5"),U&&G.push("#define CLIPPLANE6")}function B(w,E,G){let P=!1;const h=!!(w.clipPlane??E.clipPlane),B=!!(w.clipPlane2??E.clipPlane2),y=!!(w.clipPlane3??E.clipPlane3),x=!!(w.clipPlane4??E.clipPlane4),U=!!(w.clipPlane5??E.clipPlane5),l=!!(w.clipPlane6??E.clipPlane6);return G.CLIPPLANE!==h&&(G.CLIPPLANE=h,P=!0),G.CLIPPLANE2!==B&&(G.CLIPPLANE2=B,P=!0),G.CLIPPLANE3!==y&&(G.CLIPPLANE3=y,P=!0),G.CLIPPLANE4!==x&&(G.CLIPPLANE4=x,P=!0),G.CLIPPLANE5!==U&&(G.CLIPPLANE5=U,P=!0),G.CLIPPLANE6!==l&&(G.CLIPPLANE6=l,P=!0),P}function y(w,E,G){let P=E.clipPlane??G.clipPlane;x(w,"vClipPlane",P),P=E.clipPlane2??G.clipPlane2,x(w,"vClipPlane2",P),P=E.clipPlane3??G.clipPlane3,x(w,"vClipPlane3",P),P=E.clipPlane4??G.clipPlane4,x(w,"vClipPlane4",P),P=E.clipPlane5??G.clipPlane5,x(w,"vClipPlane5",P),P=E.clipPlane6??G.clipPlane6,x(w,"vClipPlane6",P)}function x(w,E,G){G&&w.setFloat4(E,G.normal.x,G.normal.y,G.normal.z,G.d)}G.d(E,{b:()=>P,e:()=>y,f:()=>B,g:()=>h})},11973:(w,E,G)=>{G.d(E,{e:()=>P});class P{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(w,E){this._defines[w]||(w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w),this._defines[w]=new Array),this._defines[w].push(E)}addCPUSkinningFallback(w,E){this._mesh=E,w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(w,E){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,w=w.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),E._bonesComputationForcedToCPU=!0;const G=this._mesh.Ww();for(let w=0;w<G.meshes.length;w++){const P=G.meshes[w];if(P.material){if(P.computeBonesUsingShaders&&0!==P.numBoneInfluencers)if(P.material.getEffect()===E)P.computeBonesUsingShaders=!1;else if(P.Dh)for(const w of P.Dh){if(w.effect===E){P.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&P.computeBonesUsingShaders&&P.numBoneInfluencers>0&&(P.computeBonesUsingShaders=!1)}}else{const E=this._defines[this._currentRank];if(E)for(let G=0;G<E.length;G++)w=w.replace("#define "+E[G],"");this._currentRank++}return w}}},11986:(w,E,G)=>{G.d(E,{b:()=>c});var P=G(11668),h=G(11671),B=G(11498),y=G(11504),x=G(11543),U=G(11991),l=G(11932),i=G(11518),O=G(11722),u=G(11787),V=G(11706);class a{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(w){this._func=w}get funcRef(){return this._funcRef}set funcRef(w){this._funcRef=w}get funcMask(){return this._funcMask}set funcMask(w){this._funcMask=w}get opStencilFail(){return this._opStencilFail}set opStencilFail(w){this._opStencilFail=w}get opDepthFail(){return this._opDepthFail}set opDepthFail(w){this._opDepthFail=w}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(w){this._opStencilDepthPass=w}get mask(){return this._mask}set mask(w){this._mask=w}get enabled(){return this._enabled}set enabled(w){this._enabled=w}getClassName(){return"MaterialStencilState"}copyTo(w){V.b.Clone((()=>w),this)}serialize(){return V.b.Serialize(this)}parse(w,E,G){V.b.Parse((()=>this),w,E,G)}}(0,P.c)([(0,h.F)()],a.prototype,"func",null),(0,P.c)([(0,h.F)()],a.prototype,"funcRef",null),(0,P.c)([(0,h.F)()],a.prototype,"funcMask",null),(0,P.c)([(0,h.F)()],a.prototype,"opStencilFail",null),(0,P.c)([(0,h.F)()],a.prototype,"opDepthFail",null),(0,P.c)([(0,h.F)()],a.prototype,"opStencilDepthPass",null),(0,P.c)([(0,h.F)()],a.prototype,"mask",null),(0,P.c)([(0,h.F)()],a.prototype,"enabled",null);var Q=G(12020);class c{get _supportGlowLayer(){return!1}set _glowModeEnabled(w){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(w){if(this._alpha===w)return;const E=this._alpha;this._alpha=w,1!==E&&1!==w||this.Sl(c.MiscDirtyFlag+c.PrePassDirtyFlag)}get alpha(){return this._alpha}set Kx(w){this._backFaceCulling!==w&&(this._backFaceCulling=w,this.Sl(c.TextureDirtyFlag))}get Kx(){return this._backFaceCulling}set cullBackFaces(w){this._cullBackFaces!==w&&(this._cullBackFaces=w,this.Sl(c.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(w){this._blockDirtyMechanism!==w&&(this._blockDirtyMechanism=w,w||this.rO())}atomicMaterialsUpdate(w){this.blockDirtyMechanism=!0;try{w(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(w){this._onDisposeObserver&&this.qh.remove(this._onDisposeObserver),this._onDisposeObserver=this.qh.add(w)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new y.d),this._onBindObservable}set onBind(w){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(w)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new y.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new y.d),this._onEffectCreatedObservable}set alphaMode(w){this._alphaMode!==w&&(this._alphaMode=w,this.Sl(c.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(w){this._needDepthPrePass!==w&&(this._needDepthPrePass=w,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(w){this._fogEnabled!==w&&(this._fogEnabled=w,this.Sl(c.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(w){this.fillMode=w?c.WireFrameFillMode:c.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(w){this.fillMode=w?c.PointFillMode:c.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(w){this._fillMode!==w&&(this._fillMode=w,this.Sl(c.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){const E=this.Ww().getEngine().getCaps().fragmentDepthSupported;w&&!E&&i.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=w&&E,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(w){this._drawWrapper=w}constructor(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.qh=new y.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new a,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=w;const h=E||x.e.LastCreatedScene;h&&(this._scene=h,this._dirtyCallbacks={},this._forceGLSL=P,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=w||B.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new u.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new l.c(this._scene.getEngine(),void 0,void 0,w),this._useUBO=this.Ww().getEngine().supportsUniformBuffers,this._createUniformBuffer(),G||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),c.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var w;const E=this.Ww().getEngine();null===(w=this._uniformBuffer)||void 0===w||w.dispose(),E.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new l.c(E,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new l.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(w){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.rO(),this.checkReadyOnlyOnce=!0}unfreeze(){this.rO(),this.checkReadyOnlyOnce=!1}isReady(w,E){return!0}isReadyForSubMesh(w,E,G){const P=E.materialDefines;return!!P&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=P,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Ww(){return this._scene}_getEffectiveOrientation(w){return null!==this.sideOrientation?this.sideOrientation:w.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(w){this._transparencyMode!==w&&(this._transparencyMode=w,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===c.MATERIAL_ALPHABLEND||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===c.MATERIAL_ALPHATEST||this._transparencyMode===c.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===c.MATERIAL_OPAQUE||this._transparencyMode===c.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsBlend:w.visibility<1||!this._disableAlphaBlending&&(w.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(w)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}rO(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=this.Ww().meshes;for(const G of E)if(G.Dh)for(const E of G.Dh)if(E.Mw()===this)for(const G of E._drawWrappers)G&&this._materialContext===G.materialContext&&(G._wasPreviouslyReady=!1,G._wasPreviouslyUsingInstances=null,G._forceRebindOnNextCall=w);w&&this.Sl(c.AllDirtyFlag)}_preBind(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=this._scene.getEngine(),P=(null==E?this.sideOrientation:E)===c.ClockWiseSideOrientation;return G.enableEffect(w||this._getDrawWrapper()),G.setState(this.Kx,this.zOffset,!1,P,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),P}bind(w,E){}buildUniformLayout(){const w=this._uniformBuffer;this._eventInfo.ubo=w,this._callbackPluginEventGeneric(8,this._eventInfo),w.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(w,E,G){const P=G._drawWrapper;this._eventInfo.subMesh=G,this._callbackPluginEventBindForSubMesh(this._eventInfo),P._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(w){}bindView(w){this._useUBO?this._needToBindSceneUbo=!0:w.setMatrix("view",this.Ww().getViewMatrix())}bindViewProjection(w){this._useUBO?this._needToBindSceneUbo=!0:(w.setMatrix("viewProjection",this.Ww().getTransformMatrix()),w.setMatrix("projection",this.Ww().getProjectionMatrix()))}bindEyePosition(w,E){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(w,E)}_afterBind(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&E&&(this._needToBindSceneUbo=!1,(0,Q.t)(E,this.Ww().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=w?w.visibility:1,this._onBindObservable&&w&&this._onBindObservable.notifyObservers(w),this.disableDepthWrite){const w=this._scene.getEngine();this._cachedDepthWriteState=w.getDepthWrite(),w.setDepthWrite(!1)}if(this.disableColorWrite){const w=this._scene.getEngine();this._cachedColorWriteState=w.getColorWrite(),w.setColorWrite(!1)}if(0!==this.depthFunction){const w=this._scene.getEngine();this._cachedDepthFunctionState=w.getDepthFunction()||0,w.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(w){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=w,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(w){return null}_clonePlugins(w,E){const G={};if(this._serializePlugins(G),c._ParsePlugins(G,w,this._scene,E),this.pluginManager)for(const P of this.pluginManager._plugins){const E=w.pluginManager.getPlugin(P.name);E&&P.copyTo(E)}}getBindedMeshes(){if(this.meshMap){const w=[];for(const E in this.meshMap){const G=this.meshMap[E];G&&w.push(G)}return w}return this._scene.meshes.filter((w=>w.material===this))}forceCompilation(w,E,G,P){const h={clipPlane:!1,useInstances:!1,...G},B=this.Ww(),y=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const x=()=>{if(!this._scene||!this._scene.getEngine())return;const G=B.clipPlane;if(h.clipPlane&&(B.clipPlane=new O.d(0,0,0,1)),this._storeEffectOnSubMeshes){let G=!0,B=null;if(w.Dh){const E=new U.c(0,0,0,0,0,w,void 0,!1,!1);E.materialDefines&&(E.materialDefines._renderId=-1),this.isReadyForSubMesh(w,E,h.useInstances)||(E.effect&&E.effect.getCompilationError()&&E.effect.allFallbacksProcessed()?B=E.effect.getCompilationError():(G=!1,setTimeout(x,16)))}G&&(this.allowShaderHotSwapping=y,B&&P&&P(B),E&&E(this))}else this.isReady()?(this.allowShaderHotSwapping=y,E&&E(this)):setTimeout(x,16);h.clipPlane&&(B.clipPlane=G)};x()}async forceCompilationAsync(w,E){return await new Promise(((G,P)=>{this.forceCompilation(w,(()=>{G()}),E,(w=>{P(w)}))}))}Sl(w){this.Ww().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(c._DirtyCallbackArray.length=0,w&c.ImageProcessingDirtyFlag&&c._DirtyCallbackArray.push(c._ImageProcessingDirtyCallBack),w&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),w&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),w&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),w&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),w&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),w&c.PrePassDirtyFlag&&c._DirtyCallbackArray.push(c._PrePassDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.Ww().resetCachedMaterial())}resetDrawCache(){const w=this.Ww().meshes;for(const E of w)if(E.Dh)for(const w of E.Dh)w.Mw()===this&&w.resetDrawCache()}_markAllSubMeshesAsDirty(w){const E=this.Ww();if(E.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const G=E.meshes;for(const P of G)if(P.Dh)for(const G of P.Dh){if((G.Mw()||(E._hasDefaultMaterial?E.defaultMaterial:null))===this)for(const E of G._drawWrappers)E&&E.defines&&E.defines.markAllAsDirty&&this._materialContext===E.materialContext&&w(E.defines)}}_markScenePrePassDirty(){if(this.Ww().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const w=this.Ww().enablePrePassRenderer();w&&w.Sl()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(c._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const w=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.qh.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(w)}))}}setPrePassRenderer(w){return!1}dispose(w,E,G){const P=this.Ww();if(P.stopAnimation(this),P.freeProcessedMaterials(),P.removeMaterial(this),this._eventInfo.forceDisposeTextures=E,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const w=this._parentContainer.materials.indexOf(this);w>-1&&this._parentContainer.materials.splice(w,1),this._parentContainer=null}if(!0!==G)if(this.meshMap)for(const h in this.meshMap){const w=this.meshMap[h];this._disposeMeshResources(w)}else{const w=P.meshes;for(const E of w)this._disposeMeshResources(E)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.qh.notifyObservers(this),this.qh.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(w){if(!w)return;const E=w.py,G=w._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(w.Dh&&G)for(const h of w.Dh){const w=h._drawWrappers;for(let B=0;B<w.length;B++){var P;const y=null===(P=w[B])||void 0===P?void 0:P.effect;if(!y)continue;G[B]===this&&(null===E||void 0===E||E._releaseVertexArrayObject(y),h._removeDrawWrapper(B,!0,!0))}}}else null===E||void 0===E||E._releaseVertexArrayObject(this._drawWrapper.effect);w.material!==this||w.sourceMesh||(w.material=null)}serialize(){const w=V.b.Serialize(this);return w.stencil=this.stencil.serialize(),w.uniqueId=this.uniqueId,this._serializePlugins(w),w}_serializePlugins(w){if(w.plugins={},this.pluginManager)for(const E of this.pluginManager._plugins)E.doNotSerialize||(w.plugins[E.getClassName()]=E.serialize())}static Parse(w,E,G){if(w.customType){if("BABYLON.PBRMaterial"===w.customType&&w.overloadedAlbedo&&(w.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return i.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else w.customType="BABYLON.StandardMaterial";const P=B.Tools.Instantiate(w.customType).Parse(w,E,G);return P._loadedUniqueId=w.uniqueId,P}static _ParsePlugins(w,E,G,P){if(w.plugins)for(const x in w.plugins){var h,y;const U=w.plugins[x];let l=null===(h=E.pluginManager)||void 0===h?void 0:h.getPlugin(U.name);if(!l){const w=B.Tools.Instantiate("BABYLON."+x);w&&(l=new w(E))}null===(y=l)||void 0===y||y.parse(U,G,P)}}}c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.ImageProcessingDirtyFlag=64,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.PrePassDirtyFlag=32,c.AllDirtyFlag=127,c.MATERIAL_OPAQUE=0,c.MATERIAL_ALPHATEST=1,c.MATERIAL_ALPHABLEND=2,c.MATERIAL_ALPHATESTANDBLEND=3,c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,c.MATERIAL_NORMALBLENDMETHOD_RNM=1,c.OnEventObservable=new y.d,c._AllDirtyCallBack=w=>w.markAllAsDirty(),c._ImageProcessingDirtyCallBack=w=>w.markAsImageProcessingDirty(),c._TextureDirtyCallBack=w=>w.markAsTexturesDirty(),c._FresnelDirtyCallBack=w=>w.markAsFresnelDirty(),c._MiscDirtyCallBack=w=>w.markAsMiscDirty(),c._PrePassDirtyCallBack=w=>w.markAsPrePassDirty(),c._LightsDirtyCallBack=w=>w.markAsLightDirty(),c._AttributeDirtyCallBack=w=>w.markAsAttributesDirty(),c._FresnelAndMiscDirtyCallBack=w=>{c._FresnelDirtyCallBack(w),c._MiscDirtyCallBack(w)},c._TextureAndMiscDirtyCallBack=w=>{c._TextureDirtyCallBack(w),c._MiscDirtyCallBack(w)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=w=>{for(const E of c._DirtyCallbackArray)E(w)},(0,P.c)([(0,h.F)()],c.prototype,"id",void 0),(0,P.c)([(0,h.F)()],c.prototype,"uniqueId",void 0),(0,P.c)([(0,h.F)()],c.prototype,"name",void 0),(0,P.c)([(0,h.F)()],c.prototype,"metadata",void 0),(0,P.c)([(0,h.F)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,P.c)([(0,h.F)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,P.c)([(0,h.F)()],c.prototype,"state",void 0),(0,P.c)([(0,h.F)("alpha")],c.prototype,"_alpha",void 0),(0,P.c)([(0,h.F)("Kx")],c.prototype,"_backFaceCulling",void 0),(0,P.c)([(0,h.F)("cullBackFaces")],c.prototype,"_cullBackFaces",void 0),(0,P.c)([(0,h.F)()],c.prototype,"sideOrientation",void 0),(0,P.c)([(0,h.F)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,P.c)([(0,h.F)()],c.prototype,"_needDepthPrePass",void 0),(0,P.c)([(0,h.F)()],c.prototype,"disableDepthWrite",void 0),(0,P.c)([(0,h.F)()],c.prototype,"disableColorWrite",void 0),(0,P.c)([(0,h.F)()],c.prototype,"forceDepthWrite",void 0),(0,P.c)([(0,h.F)()],c.prototype,"depthFunction",void 0),(0,P.c)([(0,h.F)()],c.prototype,"separateCullingPass",void 0),(0,P.c)([(0,h.F)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,P.c)([(0,h.F)()],c.prototype,"pointSize",void 0),(0,P.c)([(0,h.F)()],c.prototype,"zOffset",void 0),(0,P.c)([(0,h.F)()],c.prototype,"zOffsetUnits",void 0),(0,P.c)([(0,h.F)()],c.prototype,"pointsCloud",null),(0,P.c)([(0,h.F)()],c.prototype,"fillMode",null),(0,P.c)([(0,h.F)()],c.prototype,"useLogarithmicDepth",null),(0,P.c)([(0,h.F)()],c.prototype,"transparencyMode",null)},12020:(w,E,G)=>{G.d(E,{A:()=>I,E:()=>d,G:()=>W,H:()=>T,K:()=>V,L:()=>u,M:()=>k,Q:()=>f,R:()=>g,S:()=>Z,W:()=>j,X:()=>N,Y:()=>v,_:()=>C,cb:()=>F,e:()=>K,eb:()=>a,h:()=>O,k:()=>q,n:()=>i,p:()=>Q,t:()=>c,w:()=>J});var P=G(11518),h=G(11716),B=G(11543),y=G(11969),x=G(12029);const U=h.dE.Black(),l={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function i(w,E,G){if(!w||w.LOGARITHMICDEPTH||w.indexOf&&w.indexOf("LOGARITHMICDEPTH")>=0){const w=G.activeCamera;1===w.mode&&P.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),E.setFloat("logarithmicDepthConstant",2/(Math.log(w.maxZ+1)/Math.LN2))}}function O(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];G&&w.fogEnabled&&(!E||E.applyFog)&&0!==w.fogMode&&(G.setFloat4("vFogInfos",w.fogMode,w.fogStart,w.fogEnd,w.fogDensity),P?(w.fogColor.toLinearSpaceToRef(U,w.getEngine().useExactSrgbConversions),G.setColor3("vFogColor",U)):G.setColor3("vFogColor",w.fogColor))}function u(w,E,G,P,h,B,y,x,U,i){const O=w.numMaxInfluencers||w.numInfluencers;return O<=0?0:(E.push("#define MORPHTARGETS"),w.hasPositions&&E.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),w.hasNormals&&E.push("#define MORPHTARGETTEXTURE_HASNORMALS"),w.hasTangents&&E.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),w.hasUVs&&E.push("#define MORPHTARGETTEXTURE_HASUVS"),w.hasUV2s&&E.push("#define MORPHTARGETTEXTURE_HASUV2S"),w.hasColors&&E.push("#define MORPHTARGETTEXTURE_HASCOLORS"),w.supportsPositions&&h&&E.push("#define MORPHTARGETS_POSITION"),w.supportsNormals&&B&&E.push("#define MORPHTARGETS_NORMAL"),w.supportsTangents&&y&&E.push("#define MORPHTARGETS_TANGENT"),w.supportsUVs&&x&&E.push("#define MORPHTARGETS_UV"),w.supportsUV2s&&U&&E.push("#define MORPHTARGETS_UV2"),w.supportsColors&&i&&E.push("#define MORPHTARGETS_COLOR"),E.push("#define NUM_MORPH_INFLUENCERS "+O),w.isUsingTextureForTargets&&E.push("#define MORPHTARGETS_TEXTURE"),l.NUM_MORPH_INFLUENCERS=O,l.NORMAL=B,l.TANGENT=y,l.UV=x,l.UV2=U,l.COLOR=i,V(G,P,l,h),O)}function V(w,E,G){let h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=G.NUM_MORPH_INFLUENCERS;if(y>0&&B.e.LastCreatedEngine){const x=B.e.LastCreatedEngine.getCaps().maxVertexAttribs,U=E.morphTargetManager;if(null!==U&&void 0!==U&&U.isUsingTextureForTargets)return;const l=U&&U.supportsPositions&&h,i=U&&U.supportsNormals&&G.NORMAL,O=U&&U.supportsTangents&&G.TANGENT,u=U&&U.supportsUVs&&G.UV1,V=U&&U.supportsUV2s&&G.UV2,a=U&&U.supportsColors&&G.VERTEXCOLOR;for(let G=0;G<y;G++)l&&w.push("position"+G),i&&w.push("normal"+G),O&&w.push("tangent"+G),u&&w.push("uv_"+G),V&&w.push("uv2_"+G),a&&w.push("color"+G),w.length>x&&P.e.Error("Cannot add more vertex attributes for mesh "+E.name)}}function a(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w.push("world0"),w.push("world1"),w.push("world2"),w.push("world3"),E&&(w.push("previousWorld0"),w.push("previousWorld1"),w.push("previousWorld2"),w.push("previousWorld3"))}function Q(w,E){const G=w.morphTargetManager;w&&G&&E.setFloatArray("morphTargetInfluences",G.influences)}function c(w,E){E.bindToEffect(w,"Scene")}function Z(w,E,G){E._needUVs=!0,E[G]=!0,w.optimizeUVAllocation&&w.getTextureMatrix().isIdentityAs3x2()?(E[G+"DIRECTUV"]=w.coordinatesIndex+1,E["MAINUV"+(w.coordinatesIndex+1)]=!0):E[G+"DIRECTUV"]=0}function J(w,E,G){const P=w.getTextureMatrix();E.bh(G+"Matrix",P)}function d(w,E,G){G.BAKED_VERTEX_ANIMATION_TEXTURE&&G.INSTANCES&&w.push("bakedVertexAnimationSettingsInstanced")}function K(w,E,G){var P;if(E&&w&&(w.computeBonesUsingShaders&&E._bonesComputationForcedToCPU&&(w.computeBonesUsingShaders=!1),w.useBones&&w.computeBonesUsingShaders&&w.skeleton)){const h=w.skeleton;if(h.isUsingTextureForMatrices&&E.getUniformIndex("boneTextureWidth")>-1){const G=h.getTransformMatrixTexture(w);E.setTexture("boneSampler",G),E.setFloat("boneTextureWidth",4*(h.bones.length+1))}else{const B=h.getTransformMatrices(w);B&&(E.setMatrices("mBones",B),G&&w.Ww().prePassRenderer&&w.Ww().prePassRenderer.getIndex(2)&&(G.previousBones[w.uniqueId]||(G.previousBones[w.uniqueId]=B.slice()),E.setMatrices("mPreviousBones",G.previousBones[w.uniqueId]),P=B,G.previousBones[w.uniqueId].set(P)))}}}function t(w,E,G,P,h){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];w._bindLight(E,G,P,h,B)}function q(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const B=Math.min(E.lightSources.length,h);for(let y=0;y<B;y++){t(E.lightSources[y],y,w,G,"boolean"===typeof P?P:P.SPECULARTERM,E.receiveShadows)}}function W(w,E,G,P){G.NUM_BONE_INFLUENCERS>0&&(P.addCPUSkinningFallback(0,E),w.push("matricesIndices"),w.push("matricesWeights"),G.NUM_BONE_INFLUENCERS>4&&(w.push("matricesIndicesExtra"),w.push("matricesWeightsExtra")))}function T(w,E){(E.INSTANCES||E.THIN_INSTANCES)&&a(w,!!E.PREPASS_VELOCITY),E.INSTANCESCOLOR&&w.push("instanceColor")}function I(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=0;for(let B=0;B<G&&w["LIGHT"+B];B++)B>0&&(h=P+B,E.addFallback(h,"LIGHT"+B)),w.SHADOWS||(w["SHADOW"+B]&&E.addFallback(P,"SHADOW"+B),w["SHADOWPCF"+B]&&E.addFallback(P,"SHADOWPCF"+B),w["SHADOWPCSS"+B]&&E.addFallback(P,"SHADOWPCSS"+B),w["SHADOWPOISSON"+B]&&E.addFallback(P,"SHADOWPOISSON"+B),w["SHADOWESM"+B]&&E.addFallback(P,"SHADOWESM"+B),w["SHADOWCLOSEESM"+B]&&E.addFallback(P,"SHADOWCLOSEESM"+B));return h++}function j(w,E,G,P,h,B,y){let x=arguments.length>7&&void 0!==arguments[7]&&arguments[7];y._areMiscDirty&&(y.LOGARITHMICDEPTH=G,y.POINTSIZE=P,y.FOG=h&&function(w,E){return E.fogEnabled&&w.applyFog&&0!==E.fogMode}(w,E),y.NONUNIFORMSCALING=w.nonUniformScaling,y.ALPHATEST=B,y.DECAL_AFTER_DETAIL=x)}function g(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!G._areLightsDirty)return G._needNormals;let y=0;const x={needNormals:G._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(w.lightsEnabled&&!B)for(const l of E.lightSources)if(o(w,E,l,y,G,P,x),y++,y===h)break;G.SPECULARTERM=x.specularEnabled,G.SHADOWS=x.shadowEnabled;for(let l=y;l<h;l++)void 0!==G["LIGHT"+l]&&(G["LIGHT"+l]=!1,G["HEMILIGHT"+l]=!1,G["POINTLIGHT"+l]=!1,G["DIRLIGHT"+l]=!1,G["SPOTLIGHT"+l]=!1,G["AREALIGHT"+l]=!1,G["SHADOW"+l]=!1,G["SHADOWCSM"+l]=!1,G["SHADOWCSMDEBUG"+l]=!1,G["SHADOWCSMNUM_CASCADES"+l]=!1,G["SHADOWCSMUSESHADOWMAXZ"+l]=!1,G["SHADOWCSMNOBLEND"+l]=!1,G["SHADOWCSM_RIGHTHANDED"+l]=!1,G["SHADOWPCF"+l]=!1,G["SHADOWPCSS"+l]=!1,G["SHADOWPOISSON"+l]=!1,G["SHADOWESM"+l]=!1,G["SHADOWCLOSEESM"+l]=!1,G["SHADOWCUBE"+l]=!1,G["SHADOWLOWQUALITY"+l]=!1,G["SHADOWMEDIUMQUALITY"+l]=!1);const U=w.getEngine().getCaps();return void 0===G.SHADOWFLOAT&&(x.needRebuild=!0),G.SHADOWFLOAT=x.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),G.LIGHTMAPEXCLUDED=x.lightmapMode,x.needRebuild&&G.rebuild(),x.needNormals}function o(w,E,G,P,h,B,x){switch(x.needNormals=!0,void 0===h["LIGHT"+P]&&(x.needRebuild=!0),h["LIGHT"+P]=!0,h["SPOTLIGHT"+P]=!1,h["HEMILIGHT"+P]=!1,h["POINTLIGHT"+P]=!1,h["DIRLIGHT"+P]=!1,h["AREALIGHT"+P]=!1,G.prepareLightSpecificDefines(h,P),h["LIGHT_FALLOFF_PHYSICAL"+P]=!1,h["LIGHT_FALLOFF_GLTF"+P]=!1,h["LIGHT_FALLOFF_STANDARD"+P]=!1,G.falloffType){case y.e.FALLOFF_GLTF:h["LIGHT_FALLOFF_GLTF"+P]=!0;break;case y.e.FALLOFF_PHYSICAL:h["LIGHT_FALLOFF_PHYSICAL"+P]=!0;break;case y.e.FALLOFF_STANDARD:h["LIGHT_FALLOFF_STANDARD"+P]=!0}if(B&&!G.Ji.equalsFloats(0,0,0)&&(x.specularEnabled=!0),h["SHADOW"+P]=!1,h["SHADOWCSM"+P]=!1,h["SHADOWCSMDEBUG"+P]=!1,h["SHADOWCSMNUM_CASCADES"+P]=!1,h["SHADOWCSMUSESHADOWMAXZ"+P]=!1,h["SHADOWCSMNOBLEND"+P]=!1,h["SHADOWCSM_RIGHTHANDED"+P]=!1,h["SHADOWPCF"+P]=!1,h["SHADOWPCSS"+P]=!1,h["SHADOWPOISSON"+P]=!1,h["SHADOWESM"+P]=!1,h["SHADOWCLOSEESM"+P]=!1,h["SHADOWCUBE"+P]=!1,h["SHADOWLOWQUALITY"+P]=!1,h["SHADOWMEDIUMQUALITY"+P]=!1,E&&E.receiveShadows&&w.shadowsEnabled&&G.shadowEnabled){const E=G.getShadowGenerator(w.activeCamera)??G.getShadowGenerator();if(E){const w=E.getShadowMap();w&&w.renderList&&w.renderList.length>0&&(x.shadowEnabled=!0,E.prepareDefines(h,P))}}G.lightmapMode!=y.e.LIGHTMAP_DEFAULT?(x.lightmapMode=!0,h["LIGHTMAPEXCLUDED"+P]=!0,h["LIGHTMAPNOSPECULAR"+P]=G.lightmapMode==y.e.LIGHTMAP_SHADOWSONLY):(h["LIGHTMAPEXCLUDED"+P]=!1,h["LIGHTMAPNOSPECULAR"+P]=!1)}function f(w,E,G,P,h){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(w,E){let G=!1;if(w.activeCamera){const P=E.CAMERA_ORTHOGRAPHIC?1:0,h=E.CAMERA_PERSPECTIVE?1:0,B=1===w.activeCamera.mode?1:0,y=0===w.activeCamera.mode?1:0;(P^B||h^y)&&(E.CAMERA_ORTHOGRAPHIC=1===B,E.CAMERA_PERSPECTIVE=1===y,G=!0)}return G}(w,P);!1!==B&&(U=(0,x.f)(G,w,P)),P.DEPTHPREPASS!==!E.getColorWrite()&&(P.DEPTHPREPASS=!P.DEPTHPREPASS,U=!0),P.INSTANCES!==h&&(P.INSTANCES=h,U=!0),P.THIN_INSTANCES!==y&&(P.THIN_INSTANCES=y,U=!0),U&&P.markAsUnprocessed()}function k(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!E._areAttributesDirty&&E._needNormals===E._normals&&E._needUVs===E._uvs)return!1;E._normals=E._needNormals,E._uvs=E._needUVs,E.NORMAL=E._needNormals&&w.isVerticesDataPresent("normal"),E._needNormals&&w.isVerticesDataPresent("tangent")&&(E.TANGENT=!0);for(let x=1;x<=6;++x)E["UV"+x]=!!E._needUVs&&w.isVerticesDataPresent(`uv${1===x?"":x}`);if(G){const G=w.useVertexColors&&w.isVerticesDataPresent("color");E.VERTEXCOLOR=G,E.VERTEXALPHA=w.hasVertexAlpha&&G&&B}return w.isVerticesDataPresent("instanceColor")&&(w.hasInstances||w.hasThinInstances)&&(E.INSTANCESCOLOR=!0),P&&function(w,E){if(w.useBones&&w.computeBonesUsingShaders&&w.skeleton){E.NUM_BONE_INFLUENCERS=w.numBoneInfluencers;const G=void 0!==E.BONETEXTURE;if(w.skeleton.isUsingTextureForMatrices&&G)E.BONETEXTURE=!0;else{E.BonesPerMesh=w.skeleton.bones.length+1,E.BONETEXTURE=!G&&void 0;const P=w.Ww().prePassRenderer;if(P&&P.enabled){const G=-1===P.excludedSkinnedMesh.indexOf(w);E.BONES_VELOCITY_ENABLED=G}}}else E.NUM_BONE_INFLUENCERS=0,E.BonesPerMesh=0,void 0!==E.BONETEXTURE&&(E.BONETEXTURE=!1)}(w,E),h&&function(w,E){const G=w.morphTargetManager;G?(E.MORPHTARGETS_UV=G.supportsUVs&&E.UV1,E.MORPHTARGETS_UV2=G.supportsUV2s&&E.UV2,E.MORPHTARGETS_TANGENT=G.supportsTangents&&E.TANGENT,E.MORPHTARGETS_NORMAL=G.supportsNormals&&E.NORMAL,E.MORPHTARGETS_POSITION=G.supportsPositions,E.MORPHTARGETS_COLOR=G.supportsColors,E.MORPHTARGETTEXTURE_HASUVS=G.hasUVs,E.MORPHTARGETTEXTURE_HASUV2S=G.hasUV2s,E.MORPHTARGETTEXTURE_HASTANGENTS=G.hasTangents,E.MORPHTARGETTEXTURE_HASNORMALS=G.hasNormals,E.MORPHTARGETTEXTURE_HASPOSITIONS=G.hasPositions,E.MORPHTARGETTEXTURE_HASCOLORS=G.hasColors,E.NUM_MORPH_INFLUENCERS=G.numMaxInfluencers||G.numInfluencers,E.MORPHTARGETS=E.NUM_MORPH_INFLUENCERS>0,E.MORPHTARGETS_TEXTURE=G.isUsingTextureForTargets):(E.MORPHTARGETS_UV=!1,E.MORPHTARGETS_UV2=!1,E.MORPHTARGETS_TANGENT=!1,E.MORPHTARGETS_NORMAL=!1,E.MORPHTARGETS_POSITION=!1,E.MORPHTARGETS_COLOR=!1,E.MORPHTARGETTEXTURE_HASUVS=!1,E.MORPHTARGETTEXTURE_HASUV2S=!1,E.MORPHTARGETTEXTURE_HASTANGENTS=!1,E.MORPHTARGETTEXTURE_HASNORMALS=!1,E.MORPHTARGETTEXTURE_HASPOSITIONS=!1,E.MORPHTARGETTEXTURE_HAS_COLORS=!1,E.MORPHTARGETS=!1,E.NUM_MORPH_INFLUENCERS=0)}(w,E),y&&function(w,E){const G=w.bakedVertexAnimationManager;E.BAKED_VERTEX_ANIMATION_TEXTURE=!(!G||!G.isEnabled)}(w,E),!0}function N(w,E){if(w.activeCamera){const G=E.MULTIVIEW;E.MULTIVIEW=null!==w.activeCamera.outputRenderTarget&&w.activeCamera.outputRenderTarget.getViewCount()>1,E.MULTIVIEW!=G&&E.markAsUnprocessed()}}function v(w,E,G){const P=E.ORDER_INDEPENDENT_TRANSPARENCY,h=E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;E.ORDER_INDEPENDENT_TRANSPARENCY=w.useOrderIndependentTransparency&&G,E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!w.getEngine().getCaps().textureFloatLinearFiltering,P===E.ORDER_INDEPENDENT_TRANSPARENCY&&h===E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||E.markAsUnprocessed()}function C(w,E,G){const P=E.PREPASS;if(!E._arePrePassDirty)return;const h=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(w.prePassRenderer&&w.prePassRenderer.enabled&&G){E.PREPASS=!0,E.SCENE_MRT_COUNT=w.prePassRenderer.mrtCount,E.PREPASS_NORMAL_WORLDSPACE=w.prePassRenderer.generateNormalsInWorldSpace,E.PREPASS_COLOR=!0,E.PREPASS_COLOR_INDEX=0;for(let G=0;G<h.length;G++){const P=w.prePassRenderer.getIndex(h[G].type);-1!==P?(E[h[G].define]=!0,E[h[G].index]=P):E[h[G].define]=!1}}else{E.PREPASS=!1;for(let w=0;w<h.length;w++)E[h[w].define]=!1}E.PREPASS!=P&&(E.markAsUnprocessed(),E.markAsImageProcessingDirty())}function s(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];h&&h.push("Light"+w),B||(E.push("vLightData"+w,"vLightDiffuse"+w,"vLightSpecular"+w,"vLightDirection"+w,"vLightWidth"+w,"vLightHeight"+w,"vLightFalloff"+w,"vLightGround"+w,"lightMatrix"+w,"shadowsInfo"+w,"depthValues"+w),G.push("shadowTexture"+w),G.push("depthTexture"+w),E.push("viewFrustumZ"+w,"cascadeBlendFactor"+w,"lightSizeUVCorrection"+w,"depthCorrection"+w,"penumbraDarkness"+w,"frustumLengths"+w),P&&(G.push("projectionLightTexture"+w),E.push("textureProjectionMatrix"+w)),y&&G.push("iesLightTexture"+w))}function F(w,E,G){let P,h,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(w.uniformsNames){const y=w;P=y.uniformsNames,h=y.uniformBuffersNames,E=y.samplers,G=y.defines,B=y.maxSimultaneousLights||0}else P=w,E||(E=[]);for(let y=0;y<B&&G["LIGHT"+y];y++)s(y,P,E,G["PROJECTEDLIGHTTEXTURE"+y],h,!1,G["IESLIGHTTEXTURE"+y]);G.NUM_MORPH_INFLUENCERS&&(P.push("morphTargetInfluences"),P.push("morphTargetCount")),G.BAKED_VERTEX_ANIMATION_TEXTURE&&(P.push("bakedVertexAnimationSettings"),P.push("bakedVertexAnimationTextureSizeInverted"),P.push("bakedVertexAnimationTime"),E.push("bakedVertexAnimationTexture"))}},11979:(w,E,G)=>{G.d(E,{d:()=>B});var P=G(11679),h=G(11986);class B extends h.b{constructor(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(w,E,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new P.Matrix,this._storeEffectOnSubMeshes=G}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(w,E){return!!w&&(!this._storeEffectOnSubMeshes||(!w.Dh||0===w.Dh.length||this.isReadyForSubMesh(w,w.Dh[0],E)))}_isReadyForSubMesh(w){const E=w.materialDefines;return!(this.checkReadyOnEveryCall||!w.effect||!E||E._renderId!==this.Ww().getRenderId())}bindOnlyWorldMatrix(w){this._activeEffect.setMatrix("world",w)}bindOnlyNormalMatrix(w){this._activeEffect.setMatrix("normalMatrix",w)}bind(w,E){E&&this.bindForSubMesh(w,E,E.Dh[0])}_afterBind(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0;super._afterBind(w,E,G),this.Ww()._cachedEffect=E,G?G._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return G._drawWrapper._forceRebindOnNextCall||w.isCachedMaterialInvalid(this,E,P)}dispose(w,E,G){this._activeEffect=void 0,super.dispose(w,E,G)}}},12011:(w,E,G)=>{G.d(E,{d:()=>x,e:()=>U});var P=G(11668),h=G(11679),B=G(11671);class y{static extractMinAndMaxIndexed(w,E,G,P,h,B){for(let y=G;y<G+P;y++){const G=3*E[y],P=w[G],x=w[G+1],U=w[G+2];h.minimizeInPlaceFromFloats(P,x,U),B.maximizeInPlaceFromFloats(P,x,U)}}static extractMinAndMax(w,E,G,P,h,B){for(let y=E,x=E*P;y<E+G;y++,x+=P){const E=w[x],G=w[x+1],P=w[x+2];h.minimizeInPlaceFromFloats(E,G,P),B.maximizeInPlaceFromFloats(E,G,P)}}}function x(w,E,G,P){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const x=new h.QE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new h.QE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return y.extractMinAndMaxIndexed(w,E,G,P,x,U),B&&(x.x-=x.x*B.x+B.y,x.y-=x.y*B.x+B.y,x.z-=x.z*B.x+B.y,U.x+=U.x*B.x+B.y,U.y+=U.y*B.x+B.y,U.z+=U.z*B.x+B.y),{minimum:x,maximum:U}}function U(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;const x=new h.QE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new h.QE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B||(B=3),y.extractMinAndMax(w,E,G,B,x,U),P&&(x.x-=x.x*P.x+P.y,x.y-=x.y*P.x+P.y,x.z-=x.z*P.x+P.y,U.x+=U.x*P.x+P.y,U.y+=U.y*P.x+P.y,U.z+=U.z*P.x+P.y),{minimum:x,maximum:U}}(0,P.c)([B.g.filter((function(){for(var w=arguments.length,E=new Array(w),G=0;G<w;G++)E[G]=arguments[G];let[P,h]=E;return!Array.isArray(P)&&!Array.isArray(h)}))],y,"extractMinAndMaxIndexed",null),(0,P.c)([B.g.filter((function(){for(var w=arguments.length,E=new Array(w),G=0;G<w;G++)E[G]=arguments[G];let[P]=E;return!Array.isArray(P)}))],y,"extractMinAndMax",null)},11991:(w,E,G)=>{G.d(E,{c:()=>U});var P=G(11748),h=G(11993),B=G(11998),y=G(12011),x=G(11787);class U{get materialDefines(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(w=this._getDrawWrapper())||void 0===w?void 0:w.defines}set materialDefines(w){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=w}_getDrawWrapper(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w??this._engine.currentRenderPassId;let G=this._drawWrappers[w];return!G&&E&&(this._drawWrappers[w]=G=new x.c(this._mesh.Ww().getEngine())),G}_removeDrawWrapper(w){let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var G;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(G=this._drawWrappers[w])||void 0===G||G.dispose(E));this._drawWrappers[w]=void 0}get effect(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(w=this._getDrawWrapper())||void 0===w?void 0:w.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(w){this._mainDrawWrapperOverride=w}setEffect(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this._drawWrapper;h.setEffect(w,E,P),void 0!==G&&(h.materialContext=G),w||(h.defines=null,h.materialContext=void 0)}resetDrawCache(w){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==w)return void this._removeDrawWrapper(w,!0,E);for(const w of this._drawWrappers)null===w||void 0===w||w.dispose(E)}this._drawWrappers=[]}static AddToMesh(w,E,G,P,h,B,y){return new U(w,E,G,P,h,B,y,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(w,E,G,P,h,B,y){let x=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=w,this.verticesStart=E,this.verticesCount=G,this.indexStart=P,this.indexCount=h,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=B,this._renderingMesh=y||B,U&&B.Dh.push(this),this._engine=this._mesh.Ww().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=B.Dh.length-1,x&&(this.refreshBoundingInfo(),B.Ah(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(w){return this._boundingInfo=w,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const w=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return w||this._renderingMesh}Mw(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!E)return w&&this._mesh.Ww()._hasDefaultMaterial?this._mesh.Ww().defaultMaterial:null;if(this._isMultiMaterial(E)){const w=E.getSubMaterial(this.materialIndex);return this._currentMaterial!==w&&(this._currentMaterial=w,this.resetDrawCache()),w}return E}_isMultiMaterial(w){return void 0!==w.getSubMaterial}refreshBoundingInfo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.py)return this;if(w||(w=this._renderingMesh.getVerticesData(P.g.PositionKind)),!w)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const E=this._renderingMesh.ny();let G;if(0===this.indexStart&&this.indexCount===E.length){const w=this._renderingMesh.getBoundingInfo();G={minimum:w.minimum.clone(),maximum:w.maximum.clone()}}else G=(0,y.d)(w,E,this.indexStart,this.indexCount,this._renderingMesh.py.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(G.minimum,G.maximum):this._boundingInfo=new B.c(G.minimum,G.maximum),this}_checkCollision(w){return this.getBoundingInfo()._checkCollision(w)}updateBoundingInfo(w){let E=this.getBoundingInfo();return E||(this.refreshBoundingInfo(),E=this.getBoundingInfo()),E&&E.update(w),this}isInFrustum(w){const E=this.getBoundingInfo();return!!E&&E.isInFrustum(w,this._mesh.KO)}isCompletelyInFrustum(w){const E=this.getBoundingInfo();return!!E&&E.isCompletelyInFrustum(w)}render(w){return this._renderingMesh.render(this,w,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(w,E){if(!this._linesIndexBuffer){const G=6*Math.floor(this.indexCount/3),P=this.verticesStart+this.verticesCount>65535?new Uint32Array(G):new Uint16Array(G);let h=0;if(0===w.length)for(let w=this.indexStart;w<this.indexStart+this.indexCount;w+=3)P[h++]=w,P[h++]=w+1,P[h++]=w+1,P[h++]=w+2,P[h++]=w+2,P[h++]=w;else for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)P[h++]=w[E],P[h++]=w[E+1],P[h++]=w[E+1],P[h++]=w[E+2],P[h++]=w[E+2],P[h++]=w[E];this._linesIndexBuffer=E.createIndexBuffer(P),this._linesIndexCount=P.length}return this._linesIndexBuffer}canIntersects(w){const E=this.getBoundingInfo();return!!E&&w.intersectsBox(E.boundingBox)}intersects(w,E,G,P,h){const B=this.Mw();if(!B)return null;let y=3,x=!1;switch(B.fillMode){case 3:case 5:case 6:case 8:return null;case 7:y=1,x=!0}return 4===B.fillMode?G.length?this._intersectLines(w,E,G,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(w,E,G,this._mesh.intersectionThreshold,P):!G.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(w,E,G,P,h):this._intersectTriangles(w,E,G,y,x,P,h)}_intersectLines(w,E,G,P,B){let y=null;for(let x=this.indexStart;x<this.indexStart+this.indexCount;x+=2){const U=E[G[x]],l=E[G[x+1]],i=w.intersectionSegment(U,l,P);if(!(i<0)&&((B||!y||i<y.distance)&&(y=new h.c(null,null,i),y.faceId=x/2,B)))break}return y}_intersectUnIndexedLines(w,E,G,P,B){let y=null;for(let x=this.verticesStart;x<this.verticesStart+this.verticesCount;x+=2){const G=E[x],U=E[x+1],l=w.intersectionSegment(G,U,P);if(!(l<0)&&((B||!y||l<y.distance)&&(y=new h.c(null,null,l),y.faceId=x/2,B)))break}return y}_intersectTriangles(w,E,G,P,h,B,y){let x=null,U=-1;for(let l=this.indexStart;l<this.indexStart+this.indexCount-(3-P);l+=P){U++;const P=G[l],i=G[l+1],O=G[l+2];if(h&&4294967295===O){l+=2;continue}const u=E[P],V=E[i],a=E[O];if(!u||!V||!a)continue;if(y&&!y(u,V,a,w,P,i,O))continue;const Q=w.intersectsTriangle(u,V,a);if(Q){if(Q.distance<0)continue;if((B||!x||Q.distance<x.distance)&&(x=Q,x.faceId=U,B))break}}return x}_intersectUnIndexedTriangles(w,E,G,P,h){let B=null;for(let y=this.verticesStart;y<this.verticesStart+this.verticesCount;y+=3){const G=E[y],x=E[y+1],U=E[y+2];if(h&&!h(G,x,U,w,-1,-1,-1))continue;const l=w.intersectsTriangle(G,x,U);if(l){if(l.distance<0)continue;if((P||!B||l.distance<B.distance)&&(B=l,B.faceId=y/3,P))break}}return B}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(w,E){const G=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,w,E,!1);if(!this.IsGlobal){const w=this.getBoundingInfo();if(!w)return G;G._boundingInfo=new B.c(w.minimum,w.maximum)}return G}dispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Ww().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const E=this._mesh.Dh.indexOf(this);this._mesh.Dh.splice(E,1),this.resetDrawCache(void 0,w)}getClassName(){return"SubMesh"}static CreateFromIndices(w,E,G,P,h){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=Number.MAX_VALUE,x=-Number.MAX_VALUE;const l=(h||P).ny();for(let U=E;U<E+G;U++){const w=l[U];w<y&&(y=w),w>x&&(x=w)}return new U(w,y,x-y+1,E,G,P,h,B)}}}}]);