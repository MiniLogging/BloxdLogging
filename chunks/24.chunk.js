"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[24],{12751:(t,U,y)=>{y.d(U,{b:()=>I});class I{constructor(t,U,y){this.bu=t,this.bv=U,this.distance=y,this.faceId=0,this.subMeshId=0}}},12763:(t,U,y)=>{y.d(U,{d:()=>mt});var I=y(12399),r=y(12386),Y=y(12392);class mt{constructor(t,U,y){this.vectors=(0,I.d)(8,r.DU.Zero),this.center=r.DU.Zero(),this.centerWorld=r.DU.Zero(),this.extendSize=r.DU.Zero(),this.extendSizeWorld=r.DU.Zero(),this.directions=(0,I.d)(3,r.DU.Zero),this.vectorsWorld=(0,I.d)(8,r.DU.Zero),this.minimumWorld=r.DU.Zero(),this.maximumWorld=r.DU.Zero(),this.minimum=r.DU.Zero(),this.maximum=r.DU.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,U,y)}reConstruct(t,U,y){const I=t.x,Y=t.y,mt=t.z,X=U.x,P=U.y,G=U.z,M=this.vectors;this.minimum.aX(I,Y,mt),this.maximum.aX(X,P,G),M[0].aX(I,Y,mt),M[1].aX(X,P,G),M[2].aX(X,Y,mt),M[3].aX(I,P,mt),M[4].aX(I,Y,G),M[5].aX(X,P,mt),M[6].aX(I,P,G),M[7].aX(X,Y,G),U.addToRef(t,this.center).scaleInPlace(.5),U.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=y||r.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(t){const U=mt._TmpVector3,y=this.maximum.subtractToRef(this.minimum,U[0]),I=y.length();y.normalizeFromLength(I);const r=I*t,Y=y.scaleInPlace(.5*r),X=this.center.subtractToRef(Y,U[1]),P=this.center.addToRef(Y,U[2]);return this.reConstruct(X,P,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){const U=this.minimumWorld,y=this.maximumWorld,I=this.directions,Y=this.vectorsWorld,mt=this.vectors;if(t.isIdentity()){U.Y(this.minimum),y.Y(this.maximum);for(let t=0;t<8;++t)Y[t].Y(mt[t]);this.extendSizeWorld.Y(this.extendSize),this.centerWorld.Y(this.center)}else{U.qX(Number.MAX_VALUE),y.qX(-Number.MAX_VALUE);for(let I=0;I<8;++I){const X=Y[I];r.DU.TransformCoordinatesToRef(mt[I],t,X),U.minimizeInPlace(X),y.maximizeInPlace(X)}y.subtractToRef(U,this.extendSizeWorld).scaleInPlace(.5),y.addToRef(U,this.centerWorld).scaleInPlace(.5)}r.DU.FromArrayToRef(t.m,0,I[0]),r.DU.FromArrayToRef(t.m,4,I[1]),r.DU.FromArrayToRef(t.m,8,I[2]),this._worldMatrix=t}isInFrustum(t){return mt.IsInFrustum(this.vectorsWorld,t)}isCompletelyInFrustum(t){return mt.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsPoint(t){const U=this.minimumWorld,y=this.maximumWorld,I=U.x,r=U.y,mt=U.z,X=y.x,P=y.y,G=y.z,M=t.x,L=t.y,h=t.z,Q=-Y.b;return!(X-M<Q||Q>M-I)&&(!(P-L<Q||Q>L-r)&&!(G-h<Q||Q>h-mt))}intersectsSphere(t){return mt.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}intersectsMinMax(t,U){const y=this.minimumWorld,I=this.maximumWorld,r=y.x,Y=y.y,mt=y.z,X=I.x,P=I.y,G=I.z,M=t.x,L=t.y,h=t.z,Q=U.x,F=U.y,E=U.z;return!(X<M||r>Q)&&(!(P<L||Y>F)&&!(G<h||mt>E))}dispose(){var t,U;null===(t=this._drawWrapperFront)||void 0===t||t.dispose(),null===(U=this._drawWrapperBack)||void 0===U||U.dispose()}static Intersects(t,U){return t.intersectsMinMax(U.minimumWorld,U.maximumWorld)}static IntersectsSphere(t,U,y,I){const Y=mt._TmpVector3[0];r.DU.ClampToRef(y,t,U,Y);return r.DU.DistanceSquared(y,Y)<=I*I}static IsCompletelyInFrustum(t,U){for(let y=0;y<6;++y){const I=U[y];for(let U=0;U<8;++U)if(I.dotCoordinate(t[U])<0)return!1}return!0}static IsInFrustum(t,U){for(let y=0;y<6;++y){let I=!0;const r=U[y];for(let U=0;U<8;++U)if(r.dotCoordinate(t[U])>=0){I=!1;break}if(I)return!1}return!0}}mt._TmpVector3=(0,I.d)(3,r.DU.Zero)},12758:(t,U,y)=>{y.d(U,{c:()=>L});var I=y(12399),r=y(12386),Y=y(12763),mt=y(12772);const X={min:0,max:0},P={min:0,max:0},G=(t,U,y)=>{const I=r.DU.Dot(U.centerWorld,t),Y=Math.abs(r.DU.Dot(U.directions[0],t))*U.extendSize.x+Math.abs(r.DU.Dot(U.directions[1],t))*U.extendSize.y+Math.abs(r.DU.Dot(U.directions[2],t))*U.extendSize.z;y.min=I-Y,y.max=I+Y},M=(t,U,y)=>(G(t,U,X),G(t,y,P),!(X.min>P.max||P.min>X.max));class L{constructor(t,U,y){this._isLocked=!1,this.boundingBox=new Y.d(t,U,y),this.boundingSphere=new mt.e(t,U,y)}reConstruct(t,U,y){this.boundingBox.reConstruct(t,U,y),this.boundingSphere.reConstruct(t,U,y)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}update(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}centerOn(t,U){const y=L._TmpVector3[0].Y(t).GL(U),I=L._TmpVector3[1].Y(t).addInPlace(U);return this.boundingBox.reConstruct(y,I,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(y,I,this.boundingBox.getWorldMatrix()),this}encapsulate(t){const U=r.DU.Minimize(this.minimum,t),y=r.DU.Maximize(this.maximum,t);return this.reConstruct(U,y,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(t){const U=r.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(U);const y=r.TmpVectors.DU[0];return r.DU.TransformCoordinatesToRef(t.boundingBox.minimumWorld,U,y),this.encapsulate(y),r.DU.TransformCoordinatesToRef(t.boundingBox.maximumWorld,U,y),this.encapsulate(y),this}scale(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}isInFrustum(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===U||3===U)&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;return!(1!==U&&3!==U)||this.boundingBox.isInFrustum(t)}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,L._TmpVector3[0]).length()}isCompletelyInFrustum(t){return this.boundingBox.isCompletelyInFrustum(t)}_checkCollision(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))}intersects(t,U){if(!mt.e.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!Y.d.Intersects(this.boundingBox,t.boundingBox))return!1;if(!U)return!0;const y=this.boundingBox,I=t.boundingBox;return!!M(y.directions[0],y,I)&&(!!M(y.directions[1],y,I)&&(!!M(y.directions[2],y,I)&&(!!M(I.directions[0],y,I)&&(!!M(I.directions[1],y,I)&&(!!M(I.directions[2],y,I)&&(!!M(r.DU.Cross(y.directions[0],I.directions[0]),y,I)&&(!!M(r.DU.Cross(y.directions[0],I.directions[1]),y,I)&&(!!M(r.DU.Cross(y.directions[0],I.directions[2]),y,I)&&(!!M(r.DU.Cross(y.directions[1],I.directions[0]),y,I)&&(!!M(r.DU.Cross(y.directions[1],I.directions[1]),y,I)&&(!!M(r.DU.Cross(y.directions[1],I.directions[2]),y,I)&&(!!M(r.DU.Cross(y.directions[2],I.directions[0]),y,I)&&(!!M(r.DU.Cross(y.directions[2],I.directions[1]),y,I)&&!!M(r.DU.Cross(y.directions[2],I.directions[2]),y,I))))))))))))))}}L._TmpVector3=(0,I.d)(2,r.DU.Zero)},12772:(t,U,y)=>{y.d(U,{e:()=>Y});var I=y(12399),r=y(12386);class Y{constructor(t,U,y){this.center=r.DU.Zero(),this.centerWorld=r.DU.Zero(),this.minimum=r.DU.Zero(),this.maximum=r.DU.Zero(),this.reConstruct(t,U,y)}reConstruct(t,U,y){this.minimum.Y(t),this.maximum.Y(U);const I=r.DU.Distance(t,U);U.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*I,this._update(y||r.Matrix.IdentityReadOnly)}scale(t){const U=this.radius*t,y=Y._TmpVector3,I=y[0].qX(U),r=this.center.subtractToRef(I,y[1]),mt=this.center.addToRef(I,y[2]);return this.reConstruct(r,mt,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){if(t.isIdentity())this.centerWorld.Y(this.center),this.radiusWorld=this.radius;else{r.DU.TransformCoordinatesToRef(this.center,t,this.centerWorld);const U=Y._TmpVector3[0];r.DU.TransformNormalFromFloatsToRef(1,1,1,t,U),this.radiusWorld=Math.max(Math.abs(U.x),Math.abs(U.y),Math.abs(U.z))*this.radius}}isInFrustum(t){const U=this.centerWorld,y=this.radiusWorld;for(let I=0;I<6;I++)if(t[I].dotCoordinate(U)<=-y)return!1;return!0}isCenterInFrustum(t){const U=this.centerWorld;for(let y=0;y<6;y++)if(t[y].dotCoordinate(U)<0)return!1;return!0}intersectsPoint(t){const U=r.DU.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<U)}static Intersects(t,U){const y=r.DU.DistanceSquared(t.centerWorld,U.centerWorld),I=t.radiusWorld+U.radiusWorld;return!(I*I<y)}static CreateFromCenterAndRadius(t,U,y){this._TmpVector3[0].Y(t),this._TmpVector3[1].aX(0,0,U),this._TmpVector3[2].Y(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].GL(this._TmpVector3[1]);const I=new Y(this._TmpVector3[0],this._TmpVector3[2]);return I._worldMatrix=y||r.Matrix.Identity(),I}}Y._TmpVector3=(0,I.d)(3,r.DU.Zero)},12788:(t,U,y)=>{function I(t){-1===t.indexOf("vClipPlane")&&t.push("vClipPlane"),-1===t.indexOf("vClipPlane2")&&t.push("vClipPlane2"),-1===t.indexOf("vClipPlane3")&&t.push("vClipPlane3"),-1===t.indexOf("vClipPlane4")&&t.push("vClipPlane4"),-1===t.indexOf("vClipPlane5")&&t.push("vClipPlane5"),-1===t.indexOf("vClipPlane6")&&t.push("vClipPlane6")}function r(t,U,y){const I=!!(t.clipPlane??U.clipPlane),r=!!(t.clipPlane2??U.clipPlane2),Y=!!(t.clipPlane3??U.clipPlane3),mt=!!(t.clipPlane4??U.clipPlane4),X=!!(t.clipPlane5??U.clipPlane5),P=!!(t.clipPlane6??U.clipPlane6);I&&y.push("#define CLIPPLANE"),r&&y.push("#define CLIPPLANE2"),Y&&y.push("#define CLIPPLANE3"),mt&&y.push("#define CLIPPLANE4"),X&&y.push("#define CLIPPLANE5"),P&&y.push("#define CLIPPLANE6")}function Y(t,U,y){let I=!1;const r=!!(t.clipPlane??U.clipPlane),Y=!!(t.clipPlane2??U.clipPlane2),mt=!!(t.clipPlane3??U.clipPlane3),X=!!(t.clipPlane4??U.clipPlane4),P=!!(t.clipPlane5??U.clipPlane5),G=!!(t.clipPlane6??U.clipPlane6);return y.CLIPPLANE!==r&&(y.CLIPPLANE=r,I=!0),y.CLIPPLANE2!==Y&&(y.CLIPPLANE2=Y,I=!0),y.CLIPPLANE3!==mt&&(y.CLIPPLANE3=mt,I=!0),y.CLIPPLANE4!==X&&(y.CLIPPLANE4=X,I=!0),y.CLIPPLANE5!==P&&(y.CLIPPLANE5=P,I=!0),y.CLIPPLANE6!==G&&(y.CLIPPLANE6=G,I=!0),I}function mt(t,U,y){let I=U.clipPlane??y.clipPlane;X(t,"vClipPlane",I),I=U.clipPlane2??y.clipPlane2,X(t,"vClipPlane2",I),I=U.clipPlane3??y.clipPlane3,X(t,"vClipPlane3",I),I=U.clipPlane4??y.clipPlane4,X(t,"vClipPlane4",I),I=U.clipPlane5??y.clipPlane5,X(t,"vClipPlane5",I),I=U.clipPlane6??y.clipPlane6,X(t,"vClipPlane6",I)}function X(t,U,y){y&&t.setFloat4(U,y.normal.x,y.normal.y,y.normal.z,y.d)}y.d(U,{d:()=>I,e:()=>mt,i:()=>Y,k:()=>r})},12731:(t,U,y)=>{y.d(U,{b:()=>I});class I{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(t,U){this._defines[t]||(t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t),this._defines[t]=new Array),this._defines[t].push(U)}addCPUSkinningFallback(t,U){this._mesh=U,t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(t,U){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),U._bonesComputationForcedToCPU=!0;const y=this._mesh.St();for(let t=0;t<y.meshes.length;t++){const I=y.meshes[t];if(I.material){if(I.computeBonesUsingShaders&&0!==I.numBoneInfluencers)if(I.material.getEffect()===U)I.computeBonesUsingShaders=!1;else if(I.BX)for(const t of I.BX){if(t.effect===U){I.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&I.computeBonesUsingShaders&&I.numBoneInfluencers>0&&(I.computeBonesUsingShaders=!1)}}else{const U=this._defines[this._currentRank];if(U)for(let y=0;y<U.length;y++)t=t.replace("#define "+U[y],"");this._currentRank++}return t}}},12741:(t,U,y)=>{y.d(U,{e:()=>w});var I=y(12366),r=y(12375),Y=y(12198),mt=y(12204),X=y(12250),P=y(12743),G=y(12679),M=y(12221),L=y(12451),h=y(12521),Q=y(12426);class F{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(t){this._func=t}get funcRef(){return this._funcRef}set funcRef(t){this._funcRef=t}get funcMask(){return this._funcMask}set funcMask(t){this._funcMask=t}get opStencilFail(){return this._opStencilFail}set opStencilFail(t){this._opStencilFail=t}get opDepthFail(){return this._opDepthFail}set opDepthFail(t){this._opDepthFail=t}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(t){this._opStencilDepthPass=t}get mask(){return this._mask}set mask(t){this._mask=t}get enabled(){return this._enabled}set enabled(t){this._enabled=t}getClassName(){return"MaterialStencilState"}copyTo(t){Q.b.Clone((()=>t),this)}serialize(){return Q.b.Serialize(this)}parse(t,U,y){Q.b.Parse((()=>this),t,U,y)}}(0,I.b)([(0,r.I)()],F.prototype,"func",null),(0,I.b)([(0,r.I)()],F.prototype,"funcRef",null),(0,I.b)([(0,r.I)()],F.prototype,"funcMask",null),(0,I.b)([(0,r.I)()],F.prototype,"opStencilFail",null),(0,I.b)([(0,r.I)()],F.prototype,"opDepthFail",null),(0,I.b)([(0,r.I)()],F.prototype,"opStencilDepthPass",null),(0,I.b)([(0,r.I)()],F.prototype,"mask",null),(0,I.b)([(0,r.I)()],F.prototype,"enabled",null);var E=y(12785);class w{get _supportGlowLayer(){return!1}set _glowModeEnabled(t){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(t){if(this._alpha===t)return;const U=this._alpha;this._alpha=t,1!==U&&1!==t||this.TG(w.MiscDirtyFlag+w.PrePassDirtyFlag)}get alpha(){return this._alpha}set JX(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.TG(w.TextureDirtyFlag))}get JX(){return this._backFaceCulling}set cullBackFaces(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.TG(w.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(t){this._blockDirtyMechanism!==t&&(this._blockDirtyMechanism=t,t||this.RL())}atomicMaterialsUpdate(t){this.blockDirtyMechanism=!0;try{t(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(t){this._onDisposeObserver&&this.FX.remove(this._onDisposeObserver),this._onDisposeObserver=this.FX.add(t)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new mt.b),this._onBindObservable}set onBind(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new mt.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new mt.b),this._onEffectCreatedObservable}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.TG(w.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.TG(w.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case w.WireFrameFillMode:case w.LineListDrawMode:case w.LineLoopDrawMode:case w.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(t){this.fillMode=t?w.WireFrameFillMode:w.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case w.PointFillMode:case w.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(t){this.fillMode=t?w.PointFillMode:w.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(t){this._fillMode!==t&&(this._fillMode=t,this.TG(w.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){const U=this.St().getEngine().getCaps().fragmentDepthSupported;t&&!U&&M.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=t&&U,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(t){this._drawWrapper=t}constructor(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.FX=new mt.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.EX=new F,this._useUBO=!1,this._fillMode=w.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=t;const r=U||X.d.LastCreatedScene;r&&(this._scene=r,this._dirtyCallbacks={},this._forceGLSL=I,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||Y.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new h.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new G.b(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.St().getEngine().supportsUniformBuffers,this._createUniformBuffer(),y||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),w.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var t;const U=this.St().getEngine();null===(t=this._uniformBuffer)||void 0===t||t.dispose(),U.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new G.b(U,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new G.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(t){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.RL(),this.checkReadyOnlyOnce=!0}unfreeze(){this.RL(),this.checkReadyOnlyOnce=!1}isReady(t,U){return!0}isReadyForSubMesh(t,U,y){const I=U.materialDefines;return!!I&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=I,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}St(){return this._scene}_getEffectiveOrientation(t){return null!==this.sideOrientation?this.sideOrientation:t.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===w.MATERIAL_ALPHABLEND||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===w.MATERIAL_ALPHATEST||this._transparencyMode===w.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===w.MATERIAL_OPAQUE||this._transparencyMode===w.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(t){return this._hasTransparencyMode?this._transparencyModeIsBlend:t.visibility<1||!this._disableAlphaBlending&&(t.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(t){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}RL(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this.St().meshes;for(const y of U)if(y.BX)for(const U of y.BX)if(U.vt()===this)for(const y of U._drawWrappers)y&&this._materialContext===y.materialContext&&(y._wasPreviouslyReady=!1,y._wasPreviouslyUsingInstances=null,y._forceRebindOnNextCall=t);t&&this.TG(w.AllDirtyFlag)}_preBind(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.getEngine(),I=(null==U?this.sideOrientation:U)===w.ClockWiseSideOrientation;return y.enableEffect(t||this._getDrawWrapper()),y.setState(this.JX,this.zOffset,!1,I,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.EX,this.zOffsetUnits),I}bind(t,U){}buildUniformLayout(){const t=this._uniformBuffer;this._eventInfo.ubo=t,this._callbackPluginEventGeneric(8,this._eventInfo),t.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(t,U,y){const I=y._drawWrapper;this._eventInfo.subMesh=y,this._callbackPluginEventBindForSubMesh(this._eventInfo),I._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(t){}bindView(t){this._useUBO?this._needToBindSceneUbo=!0:t.setMatrix("view",this.St().getViewMatrix())}bindViewProjection(t){this._useUBO?this._needToBindSceneUbo=!0:(t.setMatrix("viewProjection",this.St().getTransformMatrix()),t.setMatrix("projection",this.St().getProjectionMatrix()))}bindEyePosition(t,U){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(t,U)}_afterBind(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&U&&(this._needToBindSceneUbo=!1,(0,E.l)(U,this.St().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=t?t.visibility:1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){const t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}if(this.disableColorWrite){const t=this._scene.getEngine();this._cachedColorWriteState=t.getColorWrite(),t.setColorWrite(!1)}if(0!==this.depthFunction){const t=this._scene.getEngine();this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(t){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=t,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(t){return null}_clonePlugins(t,U){const y={};if(this._serializePlugins(y),w._ParsePlugins(y,t,this._scene,U),this.pluginManager)for(const I of this.pluginManager._plugins){const U=t.pluginManager.getPlugin(I.name);U&&I.copyTo(U)}}getBindedMeshes(){if(this.meshMap){const t=[];for(const U in this.meshMap){const y=this.meshMap[U];y&&t.push(y)}return t}return this._scene.meshes.filter((t=>t.material===this))}forceCompilation(t,U,y,I){const r={clipPlane:!1,useInstances:!1,...y},Y=this.St(),mt=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const X=()=>{if(!this._scene||!this._scene.getEngine())return;const y=Y.clipPlane;if(r.clipPlane&&(Y.clipPlane=new L.d(0,0,0,1)),this._storeEffectOnSubMeshes){let y=!0,Y=null;if(t.BX){const U=new P.d(0,0,0,0,0,t,void 0,!1,!1);U.materialDefines&&(U.materialDefines._renderId=-1),this.isReadyForSubMesh(t,U,r.useInstances)||(U.effect&&U.effect.getCompilationError()&&U.effect.allFallbacksProcessed()?Y=U.effect.getCompilationError():(y=!1,setTimeout(X,16)))}y&&(this.allowShaderHotSwapping=mt,Y&&I&&I(Y),U&&U(this))}else this.isReady()?(this.allowShaderHotSwapping=mt,U&&U(this)):setTimeout(X,16);r.clipPlane&&(Y.clipPlane=y)};X()}async forceCompilationAsync(t,U){return await new Promise(((y,I)=>{this.forceCompilation(t,(()=>{y()}),U,(t=>{I(t)}))}))}TG(t){this.St().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(w._DirtyCallbackArray.length=0,t&w.ImageProcessingDirtyFlag&&w._DirtyCallbackArray.push(w._ImageProcessingDirtyCallBack),t&w.TextureDirtyFlag&&w._DirtyCallbackArray.push(w._TextureDirtyCallBack),t&w.LightDirtyFlag&&w._DirtyCallbackArray.push(w._LightsDirtyCallBack),t&w.FresnelDirtyFlag&&w._DirtyCallbackArray.push(w._FresnelDirtyCallBack),t&w.AttributesDirtyFlag&&w._DirtyCallbackArray.push(w._AttributeDirtyCallBack),t&w.MiscDirtyFlag&&w._DirtyCallbackArray.push(w._MiscDirtyCallBack),t&w.PrePassDirtyFlag&&w._DirtyCallbackArray.push(w._PrePassDirtyCallBack),w._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(w._RunDirtyCallBacks),this.St().resetCachedMaterial())}resetDrawCache(){const t=this.St().meshes;for(const U of t)if(U.BX)for(const t of U.BX)t.vt()===this&&t.resetDrawCache()}_markAllSubMeshesAsDirty(t){const U=this.St();if(U.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const y=U.meshes;for(const I of y)if(I.BX)for(const y of I.BX){if((y.vt()||(U._hasDefaultMaterial?U.defaultMaterial:null))===this)for(const U of y._drawWrappers)U&&U.defines&&U.defines.markAllAsDirty&&this._materialContext===U.materialContext&&t(U.defines)}}_markScenePrePassDirty(){if(this.St().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.St().enablePrePassRenderer();t&&t.TG()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(w._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(w._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(w._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(w._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(w._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(w._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(w._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(w._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(w._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(w._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const t=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.FX.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(t)}))}}setPrePassRenderer(t){return!1}dispose(t,U,y){const I=this.St();if(I.stopAnimation(this),I.freeProcessedMaterials(),I.removeMaterial(this),this._eventInfo.forceDisposeTextures=U,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const t=this._parentContainer.materials.indexOf(this);t>-1&&this._parentContainer.materials.splice(t,1),this._parentContainer=null}if(!0!==y)if(this.meshMap)for(const r in this.meshMap){const t=this.meshMap[r];this._disposeMeshResources(t)}else{const t=I.meshes;for(const U of t)this._disposeMeshResources(U)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.FX.notifyObservers(this),this.FX.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(t){if(!t)return;const U=t.NX,y=t._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(t.BX&&y)for(const r of t.BX){const t=r._drawWrappers;for(let Y=0;Y<t.length;Y++){var I;const mt=null===(I=t[Y])||void 0===I?void 0:I.effect;if(!mt)continue;y[Y]===this&&(null===U||void 0===U||U._releaseVertexArrayObject(mt),r._removeDrawWrapper(Y,!0,!0))}}}else null===U||void 0===U||U._releaseVertexArrayObject(this._drawWrapper.effect);t.material!==this||t.sourceMesh||(t.material=null)}serialize(){const t=Q.b.Serialize(this);return t.EX=this.EX.serialize(),t.uniqueId=this.uniqueId,this._serializePlugins(t),t}_serializePlugins(t){if(t.plugins={},this.pluginManager)for(const U of this.pluginManager._plugins)U.doNotSerialize||(t.plugins[U.getClassName()]=U.serialize())}static Parse(t,U,y){if(t.customType){if("BABYLON.PBRMaterial"===t.customType&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return M.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else t.customType="BABYLON.StandardMaterial";const I=Y.Tools.Instantiate(t.customType).Parse(t,U,y);return I._loadedUniqueId=t.uniqueId,I}static _ParsePlugins(t,U,y,I){if(t.plugins)for(const X in t.plugins){var r,mt;const P=t.plugins[X];let G=null===(r=U.pluginManager)||void 0===r?void 0:r.getPlugin(P.name);if(!G){const t=Y.Tools.Instantiate("BABYLON."+X);t&&(G=new t(U))}null===(mt=G)||void 0===mt||mt.parse(P,y,I)}}}w.TriangleFillMode=0,w.WireFrameFillMode=1,w.PointFillMode=2,w.PointListDrawMode=3,w.LineListDrawMode=4,w.LineLoopDrawMode=5,w.LineStripDrawMode=6,w.TriangleStripDrawMode=7,w.TriangleFanDrawMode=8,w.ClockWiseSideOrientation=0,w.CounterClockWiseSideOrientation=1,w.ImageProcessingDirtyFlag=64,w.TextureDirtyFlag=1,w.LightDirtyFlag=2,w.FresnelDirtyFlag=4,w.AttributesDirtyFlag=8,w.MiscDirtyFlag=16,w.PrePassDirtyFlag=32,w.AllDirtyFlag=127,w.MATERIAL_OPAQUE=0,w.MATERIAL_ALPHATEST=1,w.MATERIAL_ALPHABLEND=2,w.MATERIAL_ALPHATESTANDBLEND=3,w.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,w.MATERIAL_NORMALBLENDMETHOD_RNM=1,w.OnEventObservable=new mt.b,w._AllDirtyCallBack=t=>t.markAllAsDirty(),w._ImageProcessingDirtyCallBack=t=>t.markAsImageProcessingDirty(),w._TextureDirtyCallBack=t=>t.markAsTexturesDirty(),w._FresnelDirtyCallBack=t=>t.markAsFresnelDirty(),w._MiscDirtyCallBack=t=>t.markAsMiscDirty(),w._PrePassDirtyCallBack=t=>t.markAsPrePassDirty(),w._LightsDirtyCallBack=t=>t.markAsLightDirty(),w._AttributeDirtyCallBack=t=>t.markAsAttributesDirty(),w._FresnelAndMiscDirtyCallBack=t=>{w._FresnelDirtyCallBack(t),w._MiscDirtyCallBack(t)},w._TextureAndMiscDirtyCallBack=t=>{w._TextureDirtyCallBack(t),w._MiscDirtyCallBack(t)},w._DirtyCallbackArray=[],w._RunDirtyCallBacks=t=>{for(const U of w._DirtyCallbackArray)U(t)},(0,I.b)([(0,r.I)()],w.prototype,"id",void 0),(0,I.b)([(0,r.I)()],w.prototype,"uniqueId",void 0),(0,I.b)([(0,r.I)()],w.prototype,"name",void 0),(0,I.b)([(0,r.I)()],w.prototype,"metadata",void 0),(0,I.b)([(0,r.I)()],w.prototype,"checkReadyOnEveryCall",void 0),(0,I.b)([(0,r.I)()],w.prototype,"checkReadyOnlyOnce",void 0),(0,I.b)([(0,r.I)()],w.prototype,"state",void 0),(0,I.b)([(0,r.I)("alpha")],w.prototype,"_alpha",void 0),(0,I.b)([(0,r.I)("JX")],w.prototype,"_backFaceCulling",void 0),(0,I.b)([(0,r.I)("cullBackFaces")],w.prototype,"_cullBackFaces",void 0),(0,I.b)([(0,r.I)()],w.prototype,"sideOrientation",void 0),(0,I.b)([(0,r.I)("alphaMode")],w.prototype,"_alphaMode",void 0),(0,I.b)([(0,r.I)()],w.prototype,"_needDepthPrePass",void 0),(0,I.b)([(0,r.I)()],w.prototype,"disableDepthWrite",void 0),(0,I.b)([(0,r.I)()],w.prototype,"disableColorWrite",void 0),(0,I.b)([(0,r.I)()],w.prototype,"forceDepthWrite",void 0),(0,I.b)([(0,r.I)()],w.prototype,"depthFunction",void 0),(0,I.b)([(0,r.I)()],w.prototype,"separateCullingPass",void 0),(0,I.b)([(0,r.I)("fogEnabled")],w.prototype,"_fogEnabled",void 0),(0,I.b)([(0,r.I)()],w.prototype,"pointSize",void 0),(0,I.b)([(0,r.I)()],w.prototype,"zOffset",void 0),(0,I.b)([(0,r.I)()],w.prototype,"zOffsetUnits",void 0),(0,I.b)([(0,r.I)()],w.prototype,"pointsCloud",null),(0,I.b)([(0,r.I)()],w.prototype,"fillMode",null),(0,I.b)([(0,r.I)()],w.prototype,"useLogarithmicDepth",null),(0,I.b)([(0,r.I)()],w.prototype,"transparencyMode",null)},12785:(t,U,y)=>{y.d(U,{C:()=>Q,F:()=>h,G:()=>d,K:()=>a,N:()=>j,Q:()=>D,S:()=>N,T:()=>q,W:()=>H,Y:()=>e,Z:()=>V,_:()=>F,c:()=>B,e:()=>L,f:()=>p,h:()=>M,k:()=>E,l:()=>w,o:()=>l,s:()=>S,u:()=>g,y:()=>c,z:()=>f});var I=y(12221),r=y(12442),Y=y(12250),mt=y(12727),X=y(12788);const P=r.bU.Black(),G={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function M(t,U,y){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){const t=y.activeCamera;1===t.mode&&I.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),U.setFloat("logarithmicDepthConstant",2/(Math.log(t.maxZ+1)/Math.LN2))}}function L(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];y&&t.fogEnabled&&(!U||U.applyFog)&&0!==t.fogMode&&(y.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),I?(t.fogColor.toLinearSpaceToRef(P,t.getEngine().useExactSrgbConversions),y.setColor3("vFogColor",P)):y.setColor3("vFogColor",t.fogColor))}function h(t,U,y,I,r,Y,mt,X,P,M){const L=t.numMaxInfluencers||t.numInfluencers;return L<=0?0:(U.push("#define MORPHTARGETS"),t.hasPositions&&U.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),t.hasNormals&&U.push("#define MORPHTARGETTEXTURE_HASNORMALS"),t.hasTangents&&U.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),t.hasUVs&&U.push("#define MORPHTARGETTEXTURE_HASUVS"),t.hasUV2s&&U.push("#define MORPHTARGETTEXTURE_HASUV2S"),t.hasColors&&U.push("#define MORPHTARGETTEXTURE_HASCOLORS"),t.supportsPositions&&r&&U.push("#define MORPHTARGETS_POSITION"),t.supportsNormals&&Y&&U.push("#define MORPHTARGETS_NORMAL"),t.supportsTangents&&mt&&U.push("#define MORPHTARGETS_TANGENT"),t.supportsUVs&&X&&U.push("#define MORPHTARGETS_UV"),t.supportsUV2s&&P&&U.push("#define MORPHTARGETS_UV2"),t.supportsColors&&M&&U.push("#define MORPHTARGETS_COLOR"),U.push("#define NUM_MORPH_INFLUENCERS "+L),t.isUsingTextureForTargets&&U.push("#define MORPHTARGETS_TEXTURE"),G.NUM_MORPH_INFLUENCERS=L,G.NORMAL=Y,G.TANGENT=mt,G.UV=X,G.UV2=P,G.COLOR=M,Q(y,I,G,r),L)}function Q(t,U,y){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const mt=y.NUM_MORPH_INFLUENCERS;if(mt>0&&Y.d.LastCreatedEngine){const X=Y.d.LastCreatedEngine.getCaps().maxVertexAttribs,P=U.morphTargetManager;if(null!==P&&void 0!==P&&P.isUsingTextureForTargets)return;const G=P&&P.supportsPositions&&r,M=P&&P.supportsNormals&&y.NORMAL,L=P&&P.supportsTangents&&y.TANGENT,h=P&&P.supportsUVs&&y.UV1,Q=P&&P.supportsUV2s&&y.UV2,F=P&&P.supportsColors&&y.VERTEXCOLOR;for(let y=0;y<mt;y++)G&&t.push("position"+y),M&&t.push("normal"+y),L&&t.push("tangent"+y),h&&t.push("uv_"+y),Q&&t.push("uv2_"+y),F&&t.push("color"+y),t.length>X&&I.b.Error("Cannot add more vertex attributes for mesh "+U.name)}}function F(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),U&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function E(t,U){const y=t.morphTargetManager;t&&y&&U.setFloatArray("morphTargetInfluences",y.influences)}function w(t,U){U.bindToEffect(t,"Scene")}function D(t,U,y){U._needUVs=!0,U[y]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(U[y+"DIRECTUV"]=t.coordinatesIndex+1,U["MAINUV"+(t.coordinatesIndex+1)]=!0):U[y+"DIRECTUV"]=0}function l(t,U,y){const I=t.getTextureMatrix();U.fX(y+"Matrix",I)}function g(t,U,y){y.BAKED_VERTEX_ANIMATION_TEXTURE&&y.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function B(t,U,y){var I;if(U&&t&&(t.computeBonesUsingShaders&&U._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){const r=t.skeleton;if(r.isUsingTextureForMatrices&&U.getUniformIndex("boneTextureWidth")>-1){const y=r.getTransformMatrixTexture(t);U.setTexture("boneSampler",y),U.setFloat("boneTextureWidth",4*(r.bones.length+1))}else{const Y=r.getTransformMatrices(t);Y&&(U.setMatrices("mBones",Y),y&&t.St().prePassRenderer&&t.St().prePassRenderer.getIndex(2)&&(y.previousBones[t.uniqueId]||(y.previousBones[t.uniqueId]=Y.slice()),U.setMatrices("mPreviousBones",y.previousBones[t.uniqueId]),I=Y,y.previousBones[t.uniqueId].set(I)))}}}function b(t,U,y,I,r){let Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];t._bindLight(U,y,I,r,Y)}function p(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const Y=Math.min(U.lightSources.length,r);for(let mt=0;mt<Y;mt++){b(U.lightSources[mt],mt,t,y,"boolean"===typeof I?I:I.SPECULARTERM,U.receiveShadows)}}function c(t,U,y,I){y.NUM_BONE_INFLUENCERS>0&&(I.addCPUSkinningFallback(0,U),t.push("matricesIndices"),t.push("matricesWeights"),y.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function f(t,U){(U.INSTANCES||U.THIN_INSTANCES)&&F(t,!!U.PREPASS_VELOCITY),U.INSTANCESCOLOR&&t.push("instanceColor")}function S(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=0;for(let Y=0;Y<y&&t["LIGHT"+Y];Y++)Y>0&&(r=I+Y,U.addFallback(r,"LIGHT"+Y)),t.SHADOWS||(t["SHADOW"+Y]&&U.addFallback(I,"SHADOW"+Y),t["SHADOWPCF"+Y]&&U.addFallback(I,"SHADOWPCF"+Y),t["SHADOWPCSS"+Y]&&U.addFallback(I,"SHADOWPCSS"+Y),t["SHADOWPOISSON"+Y]&&U.addFallback(I,"SHADOWPOISSON"+Y),t["SHADOWESM"+Y]&&U.addFallback(I,"SHADOWESM"+Y),t["SHADOWCLOSEESM"+Y]&&U.addFallback(I,"SHADOWCLOSEESM"+Y));return r++}function N(t,U,y,I,r,Y,mt){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];mt._areMiscDirty&&(mt.LOGARITHMICDEPTH=y,mt.POINTSIZE=I,mt.FOG=r&&function(t,U){return U.fogEnabled&&t.applyFog&&0!==U.fogMode}(t,U),mt.NONUNIFORMSCALING=t.nonUniformScaling,mt.ALPHATEST=Y,mt.DECAL_AFTER_DETAIL=X)}function j(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!y._areLightsDirty)return y._needNormals;let mt=0;const X={needNormals:y._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!Y)for(const G of U.lightSources)if(J(t,U,G,mt,y,I,X),mt++,mt===r)break;y.SPECULARTERM=X.specularEnabled,y.SHADOWS=X.shadowEnabled;for(let G=mt;G<r;G++)void 0!==y["LIGHT"+G]&&(y["LIGHT"+G]=!1,y["HEMILIGHT"+G]=!1,y["POINTLIGHT"+G]=!1,y["DIRLIGHT"+G]=!1,y["SPOTLIGHT"+G]=!1,y["AREALIGHT"+G]=!1,y["SHADOW"+G]=!1,y["SHADOWCSM"+G]=!1,y["SHADOWCSMDEBUG"+G]=!1,y["SHADOWCSMNUM_CASCADES"+G]=!1,y["SHADOWCSMUSESHADOWMAXZ"+G]=!1,y["SHADOWCSMNOBLEND"+G]=!1,y["SHADOWCSM_RIGHTHANDED"+G]=!1,y["SHADOWPCF"+G]=!1,y["SHADOWPCSS"+G]=!1,y["SHADOWPOISSON"+G]=!1,y["SHADOWESM"+G]=!1,y["SHADOWCLOSEESM"+G]=!1,y["SHADOWCUBE"+G]=!1,y["SHADOWLOWQUALITY"+G]=!1,y["SHADOWMEDIUMQUALITY"+G]=!1);const P=t.getEngine().getCaps();return void 0===y.SHADOWFLOAT&&(X.needRebuild=!0),y.SHADOWFLOAT=X.shadowEnabled&&(P.textureFloatRender&&P.textureFloatLinearFiltering||P.textureHalfFloatRender&&P.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=X.lightmapMode,X.needRebuild&&y.rebuild(),X.needNormals}function J(t,U,y,I,r,Y,X){switch(X.needNormals=!0,void 0===r["LIGHT"+I]&&(X.needRebuild=!0),r["LIGHT"+I]=!0,r["SPOTLIGHT"+I]=!1,r["HEMILIGHT"+I]=!1,r["POINTLIGHT"+I]=!1,r["DIRLIGHT"+I]=!1,r["AREALIGHT"+I]=!1,y.prepareLightSpecificDefines(r,I),r["LIGHT_FALLOFF_PHYSICAL"+I]=!1,r["LIGHT_FALLOFF_GLTF"+I]=!1,r["LIGHT_FALLOFF_STANDARD"+I]=!1,y.falloffType){case mt.d.FALLOFF_GLTF:r["LIGHT_FALLOFF_GLTF"+I]=!0;break;case mt.d.FALLOFF_PHYSICAL:r["LIGHT_FALLOFF_PHYSICAL"+I]=!0;break;case mt.d.FALLOFF_STANDARD:r["LIGHT_FALLOFF_STANDARD"+I]=!0}if(Y&&!y.BM.equalsFloats(0,0,0)&&(X.specularEnabled=!0),r["SHADOW"+I]=!1,r["SHADOWCSM"+I]=!1,r["SHADOWCSMDEBUG"+I]=!1,r["SHADOWCSMNUM_CASCADES"+I]=!1,r["SHADOWCSMUSESHADOWMAXZ"+I]=!1,r["SHADOWCSMNOBLEND"+I]=!1,r["SHADOWCSM_RIGHTHANDED"+I]=!1,r["SHADOWPCF"+I]=!1,r["SHADOWPCSS"+I]=!1,r["SHADOWPOISSON"+I]=!1,r["SHADOWESM"+I]=!1,r["SHADOWCLOSEESM"+I]=!1,r["SHADOWCUBE"+I]=!1,r["SHADOWLOWQUALITY"+I]=!1,r["SHADOWMEDIUMQUALITY"+I]=!1,U&&U.receiveShadows&&t.shadowsEnabled&&y.shadowEnabled){const U=y.getShadowGenerator(t.activeCamera)??y.getShadowGenerator();if(U){const t=U.getShadowMap();t&&t.renderList&&t.renderList.length>0&&(X.shadowEnabled=!0,U.prepareDefines(r,I))}}y.lightmapMode!=mt.d.LIGHTMAP_DEFAULT?(X.lightmapMode=!0,r["LIGHTMAPEXCLUDED"+I]=!0,r["LIGHTMAPNOSPECULAR"+I]=y.lightmapMode==mt.d.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+I]=!1,r["LIGHTMAPNOSPECULAR"+I]=!1)}function a(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=function(t,U){let y=!1;if(t.activeCamera){const I=U.CAMERA_ORTHOGRAPHIC?1:0,r=U.CAMERA_PERSPECTIVE?1:0,Y=1===t.activeCamera.mode?1:0,mt=0===t.activeCamera.mode?1:0;(I^Y||r^mt)&&(U.CAMERA_ORTHOGRAPHIC=1===Y,U.CAMERA_PERSPECTIVE=1===mt,y=!0)}return y}(t,I);!1!==Y&&(P=(0,X.i)(y,t,I)),I.DEPTHPREPASS!==!U.getColorWrite()&&(I.DEPTHPREPASS=!I.DEPTHPREPASS,P=!0),I.INSTANCES!==r&&(I.INSTANCES=r,P=!0),I.THIN_INSTANCES!==mt&&(I.THIN_INSTANCES=mt,P=!0),P&&I.markAsUnprocessed()}function d(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],mt=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!U._areAttributesDirty&&U._needNormals===U._normals&&U._needUVs===U._uvs)return!1;U._normals=U._needNormals,U._uvs=U._needUVs,U.NORMAL=U._needNormals&&t.isVerticesDataPresent("normal"),U._needNormals&&t.isVerticesDataPresent("tangent")&&(U.TANGENT=!0);for(let X=1;X<=6;++X)U["UV"+X]=!!U._needUVs&&t.isVerticesDataPresent(`uv${1===X?"":X}`);if(y){const y=t.useVertexColors&&t.isVerticesDataPresent("color");U.VERTEXCOLOR=y,U.VERTEXALPHA=t.hasVertexAlpha&&y&&Y}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(U.INSTANCESCOLOR=!0),I&&function(t,U){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){U.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;const y=void 0!==U.BONETEXTURE;if(t.skeleton.isUsingTextureForMatrices&&y)U.BONETEXTURE=!0;else{U.BonesPerMesh=t.skeleton.bones.length+1,U.BONETEXTURE=!y&&void 0;const I=t.St().prePassRenderer;if(I&&I.enabled){const y=-1===I.excludedSkinnedMesh.indexOf(t);U.BONES_VELOCITY_ENABLED=y}}}else U.NUM_BONE_INFLUENCERS=0,U.BonesPerMesh=0,void 0!==U.BONETEXTURE&&(U.BONETEXTURE=!1)}(t,U),r&&function(t,U){const y=t.morphTargetManager;y?(U.MORPHTARGETS_UV=y.supportsUVs&&U.UV1,U.MORPHTARGETS_UV2=y.supportsUV2s&&U.UV2,U.MORPHTARGETS_TANGENT=y.supportsTangents&&U.TANGENT,U.MORPHTARGETS_NORMAL=y.supportsNormals&&U.NORMAL,U.MORPHTARGETS_POSITION=y.supportsPositions,U.MORPHTARGETS_COLOR=y.supportsColors,U.MORPHTARGETTEXTURE_HASUVS=y.hasUVs,U.MORPHTARGETTEXTURE_HASUV2S=y.hasUV2s,U.MORPHTARGETTEXTURE_HASTANGENTS=y.hasTangents,U.MORPHTARGETTEXTURE_HASNORMALS=y.hasNormals,U.MORPHTARGETTEXTURE_HASPOSITIONS=y.hasPositions,U.MORPHTARGETTEXTURE_HASCOLORS=y.hasColors,U.NUM_MORPH_INFLUENCERS=y.numMaxInfluencers||y.numInfluencers,U.MORPHTARGETS=U.NUM_MORPH_INFLUENCERS>0,U.MORPHTARGETS_TEXTURE=y.isUsingTextureForTargets):(U.MORPHTARGETS_UV=!1,U.MORPHTARGETS_UV2=!1,U.MORPHTARGETS_TANGENT=!1,U.MORPHTARGETS_NORMAL=!1,U.MORPHTARGETS_POSITION=!1,U.MORPHTARGETS_COLOR=!1,U.MORPHTARGETTEXTURE_HASUVS=!1,U.MORPHTARGETTEXTURE_HASUV2S=!1,U.MORPHTARGETTEXTURE_HASTANGENTS=!1,U.MORPHTARGETTEXTURE_HASNORMALS=!1,U.MORPHTARGETTEXTURE_HASPOSITIONS=!1,U.MORPHTARGETTEXTURE_HAS_COLORS=!1,U.MORPHTARGETS=!1,U.NUM_MORPH_INFLUENCERS=0)}(t,U),mt&&function(t,U){const y=t.bakedVertexAnimationManager;U.BAKED_VERTEX_ANIMATION_TEXTURE=!(!y||!y.isEnabled)}(t,U),!0}function q(t,U){if(t.activeCamera){const y=U.MULTIVIEW;U.MULTIVIEW=null!==t.activeCamera.outputRenderTarget&&t.activeCamera.outputRenderTarget.getViewCount()>1,U.MULTIVIEW!=y&&U.markAsUnprocessed()}}function H(t,U,y){const I=U.ORDER_INDEPENDENT_TRANSPARENCY,r=U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;U.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&y,U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,I===U.ORDER_INDEPENDENT_TRANSPARENCY&&r===U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||U.markAsUnprocessed()}function e(t,U,y){const I=U.PREPASS;if(!U._arePrePassDirty)return;const r=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&y){U.PREPASS=!0,U.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,U.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,U.PREPASS_COLOR=!0,U.PREPASS_COLOR_INDEX=0;for(let y=0;y<r.length;y++){const I=t.prePassRenderer.getIndex(r[y].type);-1!==I?(U[r[y].define]=!0,U[r[y].index]=I):U[r[y].define]=!1}}else{U.PREPASS=!1;for(let t=0;t<r.length;t++)U[r[t].define]=!1}U.PREPASS!=I&&(U.markAsUnprocessed(),U.markAsImageProcessingDirty())}function o(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6];r&&r.push("Light"+t),Y||(U.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightWidth"+t,"vLightHeight"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),y.push("shadowTexture"+t),y.push("depthTexture"+t),U.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),I&&(y.push("projectionLightTexture"+t),U.push("textureProjectionMatrix"+t)),mt&&y.push("iesLightTexture"+t))}function V(t,U,y){let I,r,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(t.uniformsNames){const mt=t;I=mt.uniformsNames,r=mt.uniformBuffersNames,U=mt.samplers,y=mt.defines,Y=mt.maxSimultaneousLights||0}else I=t,U||(U=[]);for(let mt=0;mt<Y&&y["LIGHT"+mt];mt++)o(mt,I,U,y["PROJECTEDLIGHTTEXTURE"+mt],r,!1,y["IESLIGHTTEXTURE"+mt]);y.NUM_MORPH_INFLUENCERS&&(I.push("morphTargetInfluences"),I.push("morphTargetCount")),y.BAKED_VERTEX_ANIMATION_TEXTURE&&(I.push("bakedVertexAnimationSettings"),I.push("bakedVertexAnimationTextureSizeInverted"),I.push("bakedVertexAnimationTime"),U.push("bakedVertexAnimationTexture"))}},12737:(t,U,y)=>{y.d(U,{e:()=>Y});var I=y(12386),r=y(12741);class Y extends r.e{constructor(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,U,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new I.Matrix,this._storeEffectOnSubMeshes=y}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(t,U){return!!t&&(!this._storeEffectOnSubMeshes||(!t.BX||0===t.BX.length||this.isReadyForSubMesh(t,t.BX[0],U)))}_isReadyForSubMesh(t){const U=t.materialDefines;return!(this.checkReadyOnEveryCall||!t.effect||!U||U._renderId!==this.St().getRenderId())}bindOnlyWorldMatrix(t){this._activeEffect.setMatrix("world",t)}bindOnlyNormalMatrix(t){this._activeEffect.setMatrix("normalMatrix",t)}bind(t,U){U&&this.bindForSubMesh(t,U,U.BX[0])}_afterBind(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;super._afterBind(t,U,y),this.St()._cachedEffect=U,y?y._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return y._drawWrapper._forceRebindOnNextCall||t.isCachedMaterialInvalid(this,U,I)}dispose(t,U,y){this._activeEffect=void 0,super.dispose(t,U,y)}}},12780:(t,U,y)=>{y.d(U,{c:()=>X,g:()=>P});var I=y(12366),r=y(12386),Y=y(12375);class mt{static extractMinAndMaxIndexed(t,U,y,I,r,Y){for(let mt=y;mt<y+I;mt++){const y=3*U[mt],I=t[y],X=t[y+1],P=t[y+2];r.minimizeInPlaceFromFloats(I,X,P),Y.maximizeInPlaceFromFloats(I,X,P)}}static extractMinAndMax(t,U,y,I,r,Y){for(let mt=U,X=U*I;mt<U+y;mt++,X+=I){const U=t[X],y=t[X+1],I=t[X+2];r.minimizeInPlaceFromFloats(U,y,I),Y.maximizeInPlaceFromFloats(U,y,I)}}}function X(t,U,y,I){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=new r.DU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P=new r.DU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return mt.extractMinAndMaxIndexed(t,U,y,I,X,P),Y&&(X.x-=X.x*Y.x+Y.y,X.y-=X.y*Y.x+Y.y,X.z-=X.z*Y.x+Y.y,P.x+=P.x*Y.x+Y.y,P.y+=P.y*Y.x+Y.y,P.z+=P.z*Y.x+Y.y),{minimum:X,maximum:P}}function P(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;const X=new r.DU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P=new r.DU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Y||(Y=3),mt.extractMinAndMax(t,U,y,Y,X,P),I&&(X.x-=X.x*I.x+I.y,X.y-=X.y*I.x+I.y,X.z-=X.z*I.x+I.y,P.x+=P.x*I.x+I.y,P.y+=P.y*I.x+I.y,P.z+=P.z*I.x+I.y),{minimum:X,maximum:P}}(0,I.b)([Y.g.filter((function(){for(var t=arguments.length,U=new Array(t),y=0;y<t;y++)U[y]=arguments[y];let[I,r]=U;return!Array.isArray(I)&&!Array.isArray(r)}))],mt,"extractMinAndMaxIndexed",null),(0,I.b)([Y.g.filter((function(){for(var t=arguments.length,U=new Array(t),y=0;y<t;y++)U[y]=arguments[y];let[I]=U;return!Array.isArray(I)}))],mt,"extractMinAndMax",null)},12743:(t,U,y)=>{y.d(U,{d:()=>P});var I=y(12480),r=y(12751),Y=y(12758),mt=y(12780),X=y(12521);class P{get materialDefines(){var t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(t=this._getDrawWrapper())||void 0===t?void 0:t.defines}set materialDefines(t){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=t}_getDrawWrapper(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t??this._engine.currentRenderPassId;let y=this._drawWrappers[t];return!y&&U&&(this._drawWrappers[t]=y=new X.e(this._mesh.St().getEngine())),y}_removeDrawWrapper(t){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var y;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(y=this._drawWrappers[t])||void 0===y||y.dispose(U));this._drawWrappers[t]=void 0}get effect(){var t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(t=this._getDrawWrapper())||void 0===t?void 0:t.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(t){this._mainDrawWrapperOverride=t}setEffect(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=this._drawWrapper;r.setEffect(t,U,I),void 0!==y&&(r.materialContext=y),t||(r.defines=null,r.materialContext=void 0)}resetDrawCache(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==t)return void this._removeDrawWrapper(t,!0,U);for(const t of this._drawWrappers)null===t||void 0===t||t.dispose(U)}this._drawWrappers=[]}static AddToMesh(t,U,y,I,r,Y,mt){return new P(t,U,y,I,r,Y,mt,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(t,U,y,I,r,Y,mt){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],P=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=t,this.verticesStart=U,this.verticesCount=y,this.indexStart=I,this.indexCount=r,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=Y,this._renderingMesh=mt||Y,P&&Y.BX.push(this),this._engine=this._mesh.St().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=Y.BX.length-1,X&&(this.refreshBoundingInfo(),Y.SX(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(t){return this._boundingInfo=t,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh}vt(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!U)return t&&this._mesh.St()._hasDefaultMaterial?this._mesh.St().defaultMaterial:null;if(this._isMultiMaterial(U)){const t=U.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this.resetDrawCache()),t}return U}_isMultiMaterial(t){return void 0!==t.getSubMaterial}refreshBoundingInfo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.NX)return this;if(t||(t=this._renderingMesh.getVerticesData(I.e.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const U=this._renderingMesh.jX();let y;if(0===this.indexStart&&this.indexCount===U.length){const t=this._renderingMesh.getBoundingInfo();y={minimum:t.minimum.clone(),maximum:t.maximum.clone()}}else y=(0,mt.c)(t,U,this.indexStart,this.indexCount,this._renderingMesh.NX.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(y.minimum,y.maximum):this._boundingInfo=new Y.c(y.minimum,y.maximum),this}_checkCollision(t){return this.getBoundingInfo()._checkCollision(t)}updateBoundingInfo(t){let U=this.getBoundingInfo();return U||(this.refreshBoundingInfo(),U=this.getBoundingInfo()),U&&U.update(t),this}isInFrustum(t){const U=this.getBoundingInfo();return!!U&&U.isInFrustum(t,this._mesh.pL)}isCompletelyInFrustum(t){const U=this.getBoundingInfo();return!!U&&U.isCompletelyInFrustum(t)}render(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(t,U){if(!this._linesIndexBuffer){const y=6*Math.floor(this.indexCount/3),I=this.verticesStart+this.verticesCount>65535?new Uint32Array(y):new Uint16Array(y);let r=0;if(0===t.length)for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)I[r++]=t,I[r++]=t+1,I[r++]=t+1,I[r++]=t+2,I[r++]=t+2,I[r++]=t;else for(let U=this.indexStart;U<this.indexStart+this.indexCount;U+=3)I[r++]=t[U],I[r++]=t[U+1],I[r++]=t[U+1],I[r++]=t[U+2],I[r++]=t[U+2],I[r++]=t[U];this._linesIndexBuffer=U.createIndexBuffer(I),this._linesIndexCount=I.length}return this._linesIndexBuffer}canIntersects(t){const U=this.getBoundingInfo();return!!U&&t.intersectsBox(U.boundingBox)}intersects(t,U,y,I,r){const Y=this.vt();if(!Y)return null;let mt=3,X=!1;switch(Y.fillMode){case 3:case 5:case 6:case 8:return null;case 7:mt=1,X=!0}return 4===Y.fillMode?y.length?this._intersectLines(t,U,y,this._mesh.intersectionThreshold,I):this._intersectUnIndexedLines(t,U,y,this._mesh.intersectionThreshold,I):!y.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,U,y,I,r):this._intersectTriangles(t,U,y,mt,X,I,r)}_intersectLines(t,U,y,I,Y){let mt=null;for(let X=this.indexStart;X<this.indexStart+this.indexCount;X+=2){const P=U[y[X]],G=U[y[X+1]],M=t.intersectionSegment(P,G,I);if(!(M<0)&&((Y||!mt||M<mt.distance)&&(mt=new r.b(null,null,M),mt.faceId=X/2,Y)))break}return mt}_intersectUnIndexedLines(t,U,y,I,Y){let mt=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=2){const y=U[X],P=U[X+1],G=t.intersectionSegment(y,P,I);if(!(G<0)&&((Y||!mt||G<mt.distance)&&(mt=new r.b(null,null,G),mt.faceId=X/2,Y)))break}return mt}_intersectTriangles(t,U,y,I,r,Y,mt){let X=null,P=-1;for(let G=this.indexStart;G<this.indexStart+this.indexCount-(3-I);G+=I){P++;const I=y[G],M=y[G+1],L=y[G+2];if(r&&4294967295===L){G+=2;continue}const h=U[I],Q=U[M],F=U[L];if(!h||!Q||!F)continue;if(mt&&!mt(h,Q,F,t,I,M,L))continue;const E=t.intersectsTriangle(h,Q,F);if(E){if(E.distance<0)continue;if((Y||!X||E.distance<X.distance)&&(X=E,X.faceId=P,Y))break}}return X}_intersectUnIndexedTriangles(t,U,y,I,r){let Y=null;for(let mt=this.verticesStart;mt<this.verticesStart+this.verticesCount;mt+=3){const y=U[mt],X=U[mt+1],P=U[mt+2];if(r&&!r(y,X,P,t,-1,-1,-1))continue;const G=t.intersectsTriangle(y,X,P);if(G){if(G.distance<0)continue;if((I||!Y||G.distance<Y.distance)&&(Y=G,Y.faceId=mt/3,I))break}}return Y}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(t,U){const y=new P(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,U,!1);if(!this.IsGlobal){const t=this.getBoundingInfo();if(!t)return y;y._boundingInfo=new Y.c(t.minimum,t.maximum)}return y}dispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.St().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const U=this._mesh.BX.indexOf(this);this._mesh.BX.splice(U,1),this.resetDrawCache(void 0,t)}getClassName(){return"SubMesh"}static CreateFromIndices(t,U,y,I,r){let Y=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],mt=Number.MAX_VALUE,X=-Number.MAX_VALUE;const G=(r||I).jX();for(let P=U;P<U+y;P++){const t=G[P];t<mt&&(mt=t),t>X&&(X=t)}return new P(t,mt,X-mt+1,U,y,I,r,Y)}}}}]);