"use strict";(self.ozi0exxand9=self.ozi0exxand9||[]).push([[24],{11738:(f,v,Z)=>{Z.d(v,{c:()=>V});class V{constructor(f,v,Z){this.bu=f,this.bv=v,this.distance=Z,this.faceId=0,this.subMeshId=0}}},11744:(f,v,Z)=>{Z.d(v,{b:()=>l});var V=Z(11437),h=Z(11421),J=Z(11428);class l{constructor(f,v,Z){this.vectors=(0,V.c)(8,h.Xv.Zero),this.center=h.Xv.Zero(),this.centerWorld=h.Xv.Zero(),this.extendSize=h.Xv.Zero(),this.extendSizeWorld=h.Xv.Zero(),this.directions=(0,V.c)(3,h.Xv.Zero),this.vectorsWorld=(0,V.c)(8,h.Xv.Zero),this.minimumWorld=h.Xv.Zero(),this.maximumWorld=h.Xv.Zero(),this.minimum=h.Xv.Zero(),this.maximum=h.Xv.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(f,v,Z)}reConstruct(f,v,Z){const V=f.x,J=f.y,l=f.z,e=v.x,C=v.y,H=v.z,O=this.vectors;this.minimum.fe(V,J,l),this.maximum.fe(e,C,H),O[0].fe(V,J,l),O[1].fe(e,C,H),O[2].fe(e,J,l),O[3].fe(V,C,l),O[4].fe(V,J,H),O[5].fe(e,C,l),O[6].fe(V,C,H),O[7].fe(e,J,H),v.addToRef(f,this.center).scaleInPlace(.5),v.subtractToRef(f,this.extendSize).scaleInPlace(.5),this._worldMatrix=Z||h.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(f){const v=l._TmpVector3,Z=this.maximum.subtractToRef(this.minimum,v[0]),V=Z.length();Z.normalizeFromLength(V);const h=V*f,J=Z.scaleInPlace(.5*h),e=this.center.subtractToRef(J,v[1]),C=this.center.addToRef(J,v[2]);return this.reConstruct(e,C,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(f){const v=this.minimumWorld,Z=this.maximumWorld,V=this.directions,J=this.vectorsWorld,l=this.vectors;if(f.isIdentity()){v.h(this.minimum),Z.h(this.maximum);for(let f=0;f<8;++f)J[f].h(l[f]);this.extendSizeWorld.h(this.extendSize),this.centerWorld.h(this.center)}else{v.Ve(Number.MAX_VALUE),Z.Ve(-Number.MAX_VALUE);for(let V=0;V<8;++V){const e=J[V];h.Xv.TransformCoordinatesToRef(l[V],f,e),v.minimizeInPlace(e),Z.maximizeInPlace(e)}Z.subtractToRef(v,this.extendSizeWorld).scaleInPlace(.5),Z.addToRef(v,this.centerWorld).scaleInPlace(.5)}h.Xv.FromArrayToRef(f.m,0,V[0]),h.Xv.FromArrayToRef(f.m,4,V[1]),h.Xv.FromArrayToRef(f.m,8,V[2]),this._worldMatrix=f}isInFrustum(f){return l.IsInFrustum(this.vectorsWorld,f)}isCompletelyInFrustum(f){return l.IsCompletelyInFrustum(this.vectorsWorld,f)}intersectsPoint(f){const v=this.minimumWorld,Z=this.maximumWorld,V=v.x,h=v.y,l=v.z,e=Z.x,C=Z.y,H=Z.z,O=f.x,u=f.y,W=f.z,a=-J.c;return!(e-O<a||a>O-V)&&(!(C-u<a||a>u-h)&&!(H-W<a||a>W-l))}intersectsSphere(f){return l.IntersectsSphere(this.minimumWorld,this.maximumWorld,f.centerWorld,f.radiusWorld)}intersectsMinMax(f,v){const Z=this.minimumWorld,V=this.maximumWorld,h=Z.x,J=Z.y,l=Z.z,e=V.x,C=V.y,H=V.z,O=f.x,u=f.y,W=f.z,a=v.x,b=v.y,X=v.z;return!(e<O||h>a)&&(!(C<u||J>b)&&!(H<W||l>X))}dispose(){var f,v;null===(f=this._drawWrapperFront)||void 0===f||f.dispose(),null===(v=this._drawWrapperBack)||void 0===v||v.dispose()}static Intersects(f,v){return f.intersectsMinMax(v.minimumWorld,v.maximumWorld)}static IntersectsSphere(f,v,Z,V){const J=l._TmpVector3[0];h.Xv.ClampToRef(Z,f,v,J);return h.Xv.DistanceSquared(Z,J)<=V*V}static IsCompletelyInFrustum(f,v){for(let Z=0;Z<6;++Z){const V=v[Z];for(let v=0;v<8;++v)if(V.dotCoordinate(f[v])<0)return!1}return!0}static IsInFrustum(f,v){for(let Z=0;Z<6;++Z){let V=!0;const h=v[Z];for(let v=0;v<8;++v)if(h.dotCoordinate(f[v])>=0){V=!1;break}if(V)return!1}return!0}}l._TmpVector3=(0,V.c)(3,h.Xv.Zero)},11741:(f,v,Z)=>{Z.d(v,{e:()=>u});var V=Z(11437),h=Z(11421),J=Z(11744),l=Z(11750);const e={min:0,max:0},C={min:0,max:0},H=(f,v,Z)=>{const V=h.Xv.Dot(v.centerWorld,f),J=Math.abs(h.Xv.Dot(v.directions[0],f))*v.extendSize.x+Math.abs(h.Xv.Dot(v.directions[1],f))*v.extendSize.y+Math.abs(h.Xv.Dot(v.directions[2],f))*v.extendSize.z;Z.min=V-J,Z.max=V+J},O=(f,v,Z)=>(H(f,v,e),H(f,Z,C),!(e.min>C.max||C.min>e.max));class u{constructor(f,v,Z){this._isLocked=!1,this.boundingBox=new J.b(f,v,Z),this.boundingSphere=new l.d(f,v,Z)}reConstruct(f,v,Z){this.boundingBox.reConstruct(f,v,Z),this.boundingSphere.reConstruct(f,v,Z)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(f){this._isLocked=f}update(f){this._isLocked||(this.boundingBox._update(f),this.boundingSphere._update(f))}centerOn(f,v){const Z=u._TmpVector3[0].h(f).hu(v),V=u._TmpVector3[1].h(f).addInPlace(v);return this.boundingBox.reConstruct(Z,V,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(Z,V,this.boundingBox.getWorldMatrix()),this}encapsulate(f){const v=h.Xv.Minimize(this.minimum,f),Z=h.Xv.Maximize(this.maximum,f);return this.reConstruct(v,Z,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(f){const v=h.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(v);const Z=h.TmpVectors.Xv[0];return h.Xv.TransformCoordinatesToRef(f.boundingBox.minimumWorld,v,Z),this.encapsulate(Z),h.Xv.TransformCoordinatesToRef(f.boundingBox.maximumWorld,v,Z),this.encapsulate(Z),this}scale(f){return this.boundingBox.scale(f),this.boundingSphere.scale(f),this}isInFrustum(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===v||3===v)&&this.boundingSphere.isCenterInFrustum(f))return!0;if(!this.boundingSphere.isInFrustum(f))return!1;return!(1!==v&&3!==v)||this.boundingBox.isInFrustum(f)}get diagonalLength(){const f=this.boundingBox;return f.maximumWorld.subtractToRef(f.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(f){return this.boundingBox.isCompletelyInFrustum(f)}_checkCollision(f){return f._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(f){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(f)&&!!this.boundingBox.intersectsPoint(f))}intersects(f,v){if(!l.d.Intersects(this.boundingSphere,f.boundingSphere))return!1;if(!J.b.Intersects(this.boundingBox,f.boundingBox))return!1;if(!v)return!0;const Z=this.boundingBox,V=f.boundingBox;return!!O(Z.directions[0],Z,V)&&(!!O(Z.directions[1],Z,V)&&(!!O(Z.directions[2],Z,V)&&(!!O(V.directions[0],Z,V)&&(!!O(V.directions[1],Z,V)&&(!!O(V.directions[2],Z,V)&&(!!O(h.Xv.Cross(Z.directions[0],V.directions[0]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[0],V.directions[1]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[0],V.directions[2]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[1],V.directions[0]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[1],V.directions[1]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[1],V.directions[2]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[2],V.directions[0]),Z,V)&&(!!O(h.Xv.Cross(Z.directions[2],V.directions[1]),Z,V)&&!!O(h.Xv.Cross(Z.directions[2],V.directions[2]),Z,V))))))))))))))}}u._TmpVector3=(0,V.c)(2,h.Xv.Zero)},11750:(f,v,Z)=>{Z.d(v,{d:()=>J});var V=Z(11437),h=Z(11421);class J{constructor(f,v,Z){this.center=h.Xv.Zero(),this.centerWorld=h.Xv.Zero(),this.minimum=h.Xv.Zero(),this.maximum=h.Xv.Zero(),this.reConstruct(f,v,Z)}reConstruct(f,v,Z){this.minimum.h(f),this.maximum.h(v);const V=h.Xv.Distance(f,v);v.addToRef(f,this.center).scaleInPlace(.5),this.radius=.5*V,this._update(Z||h.Matrix.IdentityReadOnly)}scale(f){const v=this.radius*f,Z=J._TmpVector3,V=Z[0].Ve(v),h=this.center.subtractToRef(V,Z[1]),l=this.center.addToRef(V,Z[2]);return this.reConstruct(h,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(f){if(f.isIdentity())this.centerWorld.h(this.center),this.radiusWorld=this.radius;else{h.Xv.TransformCoordinatesToRef(this.center,f,this.centerWorld);const v=J._TmpVector3[0];h.Xv.TransformNormalFromFloatsToRef(1,1,1,f,v),this.radiusWorld=Math.max(Math.abs(v.x),Math.abs(v.y),Math.abs(v.z))*this.radius}}isInFrustum(f){const v=this.centerWorld,Z=this.radiusWorld;for(let V=0;V<6;V++)if(f[V].dotCoordinate(v)<=-Z)return!1;return!0}isCenterInFrustum(f){const v=this.centerWorld;for(let Z=0;Z<6;Z++)if(f[Z].dotCoordinate(v)<0)return!1;return!0}intersectsPoint(f){const v=h.Xv.DistanceSquared(this.centerWorld,f);return!(this.radiusWorld*this.radiusWorld<v)}static Intersects(f,v){const Z=h.Xv.DistanceSquared(f.centerWorld,v.centerWorld),V=f.radiusWorld+v.radiusWorld;return!(V*V<Z)}static CreateFromCenterAndRadius(f,v,Z){this._TmpVector3[0].h(f),this._TmpVector3[1].fe(0,0,v),this._TmpVector3[2].h(f),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].hu(this._TmpVector3[1]);const V=new J(this._TmpVector3[0],this._TmpVector3[2]);return V._worldMatrix=Z||h.Matrix.Identity(),V}}J._TmpVector3=(0,V.c)(3,h.Xv.Zero)},11768:(f,v,Z)=>{function V(f){-1===f.indexOf("vClipPlane")&&f.push("vClipPlane"),-1===f.indexOf("vClipPlane2")&&f.push("vClipPlane2"),-1===f.indexOf("vClipPlane3")&&f.push("vClipPlane3"),-1===f.indexOf("vClipPlane4")&&f.push("vClipPlane4"),-1===f.indexOf("vClipPlane5")&&f.push("vClipPlane5"),-1===f.indexOf("vClipPlane6")&&f.push("vClipPlane6")}function h(f,v,Z){const V=!!(f.clipPlane??v.clipPlane),h=!!(f.clipPlane2??v.clipPlane2),J=!!(f.clipPlane3??v.clipPlane3),l=!!(f.clipPlane4??v.clipPlane4),e=!!(f.clipPlane5??v.clipPlane5),C=!!(f.clipPlane6??v.clipPlane6);V&&Z.push("#define CLIPPLANE"),h&&Z.push("#define CLIPPLANE2"),J&&Z.push("#define CLIPPLANE3"),l&&Z.push("#define CLIPPLANE4"),e&&Z.push("#define CLIPPLANE5"),C&&Z.push("#define CLIPPLANE6")}function J(f,v,Z){let V=!1;const h=!!(f.clipPlane??v.clipPlane),J=!!(f.clipPlane2??v.clipPlane2),l=!!(f.clipPlane3??v.clipPlane3),e=!!(f.clipPlane4??v.clipPlane4),C=!!(f.clipPlane5??v.clipPlane5),H=!!(f.clipPlane6??v.clipPlane6);return Z.CLIPPLANE!==h&&(Z.CLIPPLANE=h,V=!0),Z.CLIPPLANE2!==J&&(Z.CLIPPLANE2=J,V=!0),Z.CLIPPLANE3!==l&&(Z.CLIPPLANE3=l,V=!0),Z.CLIPPLANE4!==e&&(Z.CLIPPLANE4=e,V=!0),Z.CLIPPLANE5!==C&&(Z.CLIPPLANE5=C,V=!0),Z.CLIPPLANE6!==H&&(Z.CLIPPLANE6=H,V=!0),V}function l(f,v,Z){let V=v.clipPlane??Z.clipPlane;e(f,"vClipPlane",V),V=v.clipPlane2??Z.clipPlane2,e(f,"vClipPlane2",V),V=v.clipPlane3??Z.clipPlane3,e(f,"vClipPlane3",V),V=v.clipPlane4??Z.clipPlane4,e(f,"vClipPlane4",V),V=v.clipPlane5??Z.clipPlane5,e(f,"vClipPlane5",V),V=v.clipPlane6??Z.clipPlane6,e(f,"vClipPlane6",V)}function e(f,v,Z){Z&&f.setFloat4(v,Z.normal.x,Z.normal.y,Z.normal.z,Z.d)}Z.d(v,{b:()=>V,c:()=>l,e:()=>J,g:()=>h})},11713:(f,v,Z)=>{Z.d(v,{c:()=>V});class V{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(f,v){this._defines[f]||(f<this._currentRank&&(this._currentRank=f),f>this._maxRank&&(this._maxRank=f),this._defines[f]=new Array),this._defines[f].push(v)}addCPUSkinningFallback(f,v){this._mesh=v,f<this._currentRank&&(this._currentRank=f),f>this._maxRank&&(this._maxRank=f)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(f,v){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,f=f.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),v._bonesComputationForcedToCPU=!0;const Z=this._mesh.Yf();for(let f=0;f<Z.meshes.length;f++){const V=Z.meshes[f];if(V.material){if(V.computeBonesUsingShaders&&0!==V.numBoneInfluencers)if(V.material.getEffect()===v)V.computeBonesUsingShaders=!1;else if(V.Bh)for(const f of V.Bh){if(f.effect===v){V.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&V.computeBonesUsingShaders&&V.numBoneInfluencers>0&&(V.computeBonesUsingShaders=!1)}}else{const v=this._defines[this._currentRank];if(v)for(let Z=0;Z<v.length;Z++)f=f.replace("#define "+v[Z],"");this._currentRank++}return f}}},11729:(f,v,Z)=>{Z.d(v,{e:()=>F});var V=Z(11405),h=Z(11410),J=Z(11230),l=Z(11235),e=Z(11281),C=Z(11733),H=Z(11673),O=Z(11247),u=Z(11478),W=Z(11534),a=Z(11462);class b{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(f){this._func=f}get funcRef(){return this._funcRef}set funcRef(f){this._funcRef=f}get funcMask(){return this._funcMask}set funcMask(f){this._funcMask=f}get opStencilFail(){return this._opStencilFail}set opStencilFail(f){this._opStencilFail=f}get opDepthFail(){return this._opDepthFail}set opDepthFail(f){this._opDepthFail=f}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(f){this._opStencilDepthPass=f}get mask(){return this._mask}set mask(f){this._mask=f}get enabled(){return this._enabled}set enabled(f){this._enabled=f}getClassName(){return"MaterialStencilState"}copyTo(f){a.b.Clone((()=>f),this)}serialize(){return a.b.Serialize(this)}parse(f,v,Z){a.b.Parse((()=>this),f,v,Z)}}(0,V.d)([(0,h.F)()],b.prototype,"func",null),(0,V.d)([(0,h.F)()],b.prototype,"funcRef",null),(0,V.d)([(0,h.F)()],b.prototype,"funcMask",null),(0,V.d)([(0,h.F)()],b.prototype,"opStencilFail",null),(0,V.d)([(0,h.F)()],b.prototype,"opDepthFail",null),(0,V.d)([(0,h.F)()],b.prototype,"opStencilDepthPass",null),(0,V.d)([(0,h.F)()],b.prototype,"mask",null),(0,V.d)([(0,h.F)()],b.prototype,"enabled",null);var X=Z(11760);class F{get _supportGlowLayer(){return!1}set _glowModeEnabled(f){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(f){if(this._alpha===f)return;const v=this._alpha;this._alpha=f,1!==v&&1!==f||this.dH(F.MiscDirtyFlag+F.PrePassDirtyFlag)}get alpha(){return this._alpha}set nh(f){this._backFaceCulling!==f&&(this._backFaceCulling=f,this.dH(F.TextureDirtyFlag))}get nh(){return this._backFaceCulling}set cullBackFaces(f){this._cullBackFaces!==f&&(this._cullBackFaces=f,this.dH(F.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(f){this._blockDirtyMechanism!==f&&(this._blockDirtyMechanism=f,f||this.ou())}atomicMaterialsUpdate(f){this.blockDirtyMechanism=!0;try{f(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(f){this._onDisposeObserver&&this.Kh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Kh.add(f)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new l.c),this._onBindObservable}set onBind(f){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(f)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new l.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new l.c),this._onEffectCreatedObservable}set alphaMode(f){this._alphaMode!==f&&(this._alphaMode=f,this.dH(F.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(f){this._needDepthPrePass!==f&&(this._needDepthPrePass=f,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(f){this._fogEnabled!==f&&(this._fogEnabled=f,this.dH(F.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case F.WireFrameFillMode:case F.LineListDrawMode:case F.LineLoopDrawMode:case F.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(f){this.fillMode=f?F.WireFrameFillMode:F.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case F.PointFillMode:case F.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(f){this.fillMode=f?F.PointFillMode:F.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(f){this._fillMode!==f&&(this._fillMode=f,this.dH(F.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(f){const v=this.Yf().getEngine().getCaps().fragmentDepthSupported;f&&!v&&O.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=f&&v,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(f){this._drawWrapper=f}constructor(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Kh=new l.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new b,this._useUBO=!1,this._fillMode=F.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=f;const h=v||e.c.LastCreatedScene;h&&(this._scene=h,this._dirtyCallbacks={},this._forceGLSL=V,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=f||J.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new W.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new H.e(this._scene.getEngine(),void 0,void 0,f),this._useUBO=this.Yf().getEngine().supportsUniformBuffers,this._createUniformBuffer(),Z||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),F.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var f;const v=this.Yf().getEngine();null===(f=this._uniformBuffer)||void 0===f||f.dispose(),v.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new H.e(v,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new H.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(f){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.ou(),this.checkReadyOnlyOnce=!0}unfreeze(){this.ou(),this.checkReadyOnlyOnce=!1}isReady(f,v){return!0}isReadyForSubMesh(f,v,Z){const V=v.materialDefines;return!!V&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=V,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Yf(){return this._scene}_getEffectiveOrientation(f){return null!==this.sideOrientation?this.sideOrientation:f.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(f){this._transparencyMode!==f&&(this._transparencyMode=f,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===F.MATERIAL_ALPHABLEND||this._transparencyMode===F.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===F.MATERIAL_ALPHATEST||this._transparencyMode===F.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===F.MATERIAL_OPAQUE||this._transparencyMode===F.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(f){return this._hasTransparencyMode?this._transparencyModeIsBlend:f.visibility<1||!this._disableAlphaBlending&&(f.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(f){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(f)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}ou(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const v=this.Yf().meshes;for(const Z of v)if(Z.Bh)for(const v of Z.Bh)if(v.Ef()===this)for(const Z of v._drawWrappers)Z&&this._materialContext===Z.materialContext&&(Z._wasPreviouslyReady=!1,Z._wasPreviouslyUsingInstances=null,Z._forceRebindOnNextCall=f);f&&this.dH(F.AllDirtyFlag)}_preBind(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.getEngine(),V=(null==v?this.sideOrientation:v)===F.ClockWiseSideOrientation;return Z.enableEffect(f||this._getDrawWrapper()),Z.setState(this.nh,this.zOffset,!1,V,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),V}bind(f,v){}buildUniformLayout(){const f=this._uniformBuffer;this._eventInfo.ubo=f,this._callbackPluginEventGeneric(8,this._eventInfo),f.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(f,v,Z){const V=Z._drawWrapper;this._eventInfo.subMesh=Z,this._callbackPluginEventBindForSubMesh(this._eventInfo),V._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(f){}bindView(f){this._useUBO?this._needToBindSceneUbo=!0:f.setMatrix("view",this.Yf().getViewMatrix())}bindViewProjection(f){this._useUBO?this._needToBindSceneUbo=!0:(f.setMatrix("viewProjection",this.Yf().getTransformMatrix()),f.setMatrix("projection",this.Yf().getProjectionMatrix()))}bindEyePosition(f,v){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(f,v)}_afterBind(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&v&&(this._needToBindSceneUbo=!1,(0,X.n)(v,this.Yf().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=f?f.visibility:1,this._onBindObservable&&f&&this._onBindObservable.notifyObservers(f),this.disableDepthWrite){const f=this._scene.getEngine();this._cachedDepthWriteState=f.getDepthWrite(),f.setDepthWrite(!1)}if(this.disableColorWrite){const f=this._scene.getEngine();this._cachedColorWriteState=f.getColorWrite(),f.setColorWrite(!1)}if(0!==this.depthFunction){const f=this._scene.getEngine();this._cachedDepthFunctionState=f.getDepthFunction()||0,f.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(f){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=f,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(f){return null}_clonePlugins(f,v){const Z={};if(this._serializePlugins(Z),F._ParsePlugins(Z,f,this._scene,v),this.pluginManager)for(const V of this.pluginManager._plugins){const v=f.pluginManager.getPlugin(V.name);v&&V.copyTo(v)}}getBindedMeshes(){if(this.meshMap){const f=[];for(const v in this.meshMap){const Z=this.meshMap[v];Z&&f.push(Z)}return f}return this._scene.meshes.filter((f=>f.material===this))}forceCompilation(f,v,Z,V){const h={clipPlane:!1,useInstances:!1,...Z},J=this.Yf(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const e=()=>{if(!this._scene||!this._scene.getEngine())return;const Z=J.clipPlane;if(h.clipPlane&&(J.clipPlane=new u.e(0,0,0,1)),this._storeEffectOnSubMeshes){let Z=!0,J=null;if(f.Bh){const v=new C.b(0,0,0,0,0,f,void 0,!1,!1);v.materialDefines&&(v.materialDefines._renderId=-1),this.isReadyForSubMesh(f,v,h.useInstances)||(v.effect&&v.effect.getCompilationError()&&v.effect.allFallbacksProcessed()?J=v.effect.getCompilationError():(Z=!1,setTimeout(e,16)))}Z&&(this.allowShaderHotSwapping=l,J&&V&&V(J),v&&v(this))}else this.isReady()?(this.allowShaderHotSwapping=l,v&&v(this)):setTimeout(e,16);h.clipPlane&&(J.clipPlane=Z)};e()}async forceCompilationAsync(f,v){return await new Promise(((Z,V)=>{this.forceCompilation(f,(()=>{Z()}),v,(f=>{V(f)}))}))}dH(f){this.Yf().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(F._DirtyCallbackArray.length=0,f&F.ImageProcessingDirtyFlag&&F._DirtyCallbackArray.push(F._ImageProcessingDirtyCallBack),f&F.TextureDirtyFlag&&F._DirtyCallbackArray.push(F._TextureDirtyCallBack),f&F.LightDirtyFlag&&F._DirtyCallbackArray.push(F._LightsDirtyCallBack),f&F.FresnelDirtyFlag&&F._DirtyCallbackArray.push(F._FresnelDirtyCallBack),f&F.AttributesDirtyFlag&&F._DirtyCallbackArray.push(F._AttributeDirtyCallBack),f&F.MiscDirtyFlag&&F._DirtyCallbackArray.push(F._MiscDirtyCallBack),f&F.PrePassDirtyFlag&&F._DirtyCallbackArray.push(F._PrePassDirtyCallBack),F._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(F._RunDirtyCallBacks),this.Yf().resetCachedMaterial())}resetDrawCache(){const f=this.Yf().meshes;for(const v of f)if(v.Bh)for(const f of v.Bh)f.Ef()===this&&f.resetDrawCache()}_markAllSubMeshesAsDirty(f){const v=this.Yf();if(v.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const Z=v.meshes;for(const V of Z)if(V.Bh)for(const Z of V.Bh){if((Z.Ef()||(v._hasDefaultMaterial?v.defaultMaterial:null))===this)for(const v of Z._drawWrappers)v&&v.defines&&v.defines.markAllAsDirty&&this._materialContext===v.materialContext&&f(v.defines)}}_markScenePrePassDirty(){if(this.Yf().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const f=this.Yf().enablePrePassRenderer();f&&f.dH()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(F._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(F._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(F._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(F._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(F._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(F._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(F._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(F._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(F._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(F._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const f=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Kh.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(f)}))}}setPrePassRenderer(f){return!1}dispose(f,v,Z){const V=this.Yf();if(V.stopAnimation(this),V.freeProcessedMaterials(),V.removeMaterial(this),this._eventInfo.forceDisposeTextures=v,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const f=this._parentContainer.materials.indexOf(this);f>-1&&this._parentContainer.materials.splice(f,1),this._parentContainer=null}if(!0!==Z)if(this.meshMap)for(const h in this.meshMap){const f=this.meshMap[h];this._disposeMeshResources(f)}else{const f=V.meshes;for(const v of f)this._disposeMeshResources(v)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Kh.notifyObservers(this),this.Kh.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(f){if(!f)return;const v=f.qh,Z=f._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(f.Bh&&Z)for(const h of f.Bh){const f=h._drawWrappers;for(let J=0;J<f.length;J++){var V;const l=null===(V=f[J])||void 0===V?void 0:V.effect;if(!l)continue;Z[J]===this&&(null===v||void 0===v||v._releaseVertexArrayObject(l),h._removeDrawWrapper(J,!0,!0))}}}else null===v||void 0===v||v._releaseVertexArrayObject(this._drawWrapper.effect);f.material!==this||f.sourceMesh||(f.material=null)}serialize(){const f=a.b.Serialize(this);return f.stencil=this.stencil.serialize(),f.uniqueId=this.uniqueId,this._serializePlugins(f),f}_serializePlugins(f){if(f.plugins={},this.pluginManager)for(const v of this.pluginManager._plugins)v.doNotSerialize||(f.plugins[v.getClassName()]=v.serialize())}static Parse(f,v,Z){if(f.customType){if("BABYLON.PBRMaterial"===f.customType&&f.overloadedAlbedo&&(f.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return O.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else f.customType="BABYLON.StandardMaterial";const V=J.Tools.Instantiate(f.customType).Parse(f,v,Z);return V._loadedUniqueId=f.uniqueId,V}static _ParsePlugins(f,v,Z,V){if(f.plugins)for(const e in f.plugins){var h,l;const C=f.plugins[e];let H=null===(h=v.pluginManager)||void 0===h?void 0:h.getPlugin(C.name);if(!H){const f=J.Tools.Instantiate("BABYLON."+e);f&&(H=new f(v))}null===(l=H)||void 0===l||l.parse(C,Z,V)}}}F.TriangleFillMode=0,F.WireFrameFillMode=1,F.PointFillMode=2,F.PointListDrawMode=3,F.LineListDrawMode=4,F.LineLoopDrawMode=5,F.LineStripDrawMode=6,F.TriangleStripDrawMode=7,F.TriangleFanDrawMode=8,F.ClockWiseSideOrientation=0,F.CounterClockWiseSideOrientation=1,F.ImageProcessingDirtyFlag=64,F.TextureDirtyFlag=1,F.LightDirtyFlag=2,F.FresnelDirtyFlag=4,F.AttributesDirtyFlag=8,F.MiscDirtyFlag=16,F.PrePassDirtyFlag=32,F.AllDirtyFlag=127,F.MATERIAL_OPAQUE=0,F.MATERIAL_ALPHATEST=1,F.MATERIAL_ALPHABLEND=2,F.MATERIAL_ALPHATESTANDBLEND=3,F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,F.MATERIAL_NORMALBLENDMETHOD_RNM=1,F.OnEventObservable=new l.c,F._AllDirtyCallBack=f=>f.markAllAsDirty(),F._ImageProcessingDirtyCallBack=f=>f.markAsImageProcessingDirty(),F._TextureDirtyCallBack=f=>f.markAsTexturesDirty(),F._FresnelDirtyCallBack=f=>f.markAsFresnelDirty(),F._MiscDirtyCallBack=f=>f.markAsMiscDirty(),F._PrePassDirtyCallBack=f=>f.markAsPrePassDirty(),F._LightsDirtyCallBack=f=>f.markAsLightDirty(),F._AttributeDirtyCallBack=f=>f.markAsAttributesDirty(),F._FresnelAndMiscDirtyCallBack=f=>{F._FresnelDirtyCallBack(f),F._MiscDirtyCallBack(f)},F._TextureAndMiscDirtyCallBack=f=>{F._TextureDirtyCallBack(f),F._MiscDirtyCallBack(f)},F._DirtyCallbackArray=[],F._RunDirtyCallBacks=f=>{for(const v of F._DirtyCallbackArray)v(f)},(0,V.d)([(0,h.F)()],F.prototype,"id",void 0),(0,V.d)([(0,h.F)()],F.prototype,"uniqueId",void 0),(0,V.d)([(0,h.F)()],F.prototype,"name",void 0),(0,V.d)([(0,h.F)()],F.prototype,"metadata",void 0),(0,V.d)([(0,h.F)()],F.prototype,"checkReadyOnEveryCall",void 0),(0,V.d)([(0,h.F)()],F.prototype,"checkReadyOnlyOnce",void 0),(0,V.d)([(0,h.F)()],F.prototype,"state",void 0),(0,V.d)([(0,h.F)("alpha")],F.prototype,"_alpha",void 0),(0,V.d)([(0,h.F)("nh")],F.prototype,"_backFaceCulling",void 0),(0,V.d)([(0,h.F)("cullBackFaces")],F.prototype,"_cullBackFaces",void 0),(0,V.d)([(0,h.F)()],F.prototype,"sideOrientation",void 0),(0,V.d)([(0,h.F)("alphaMode")],F.prototype,"_alphaMode",void 0),(0,V.d)([(0,h.F)()],F.prototype,"_needDepthPrePass",void 0),(0,V.d)([(0,h.F)()],F.prototype,"disableDepthWrite",void 0),(0,V.d)([(0,h.F)()],F.prototype,"disableColorWrite",void 0),(0,V.d)([(0,h.F)()],F.prototype,"forceDepthWrite",void 0),(0,V.d)([(0,h.F)()],F.prototype,"depthFunction",void 0),(0,V.d)([(0,h.F)()],F.prototype,"separateCullingPass",void 0),(0,V.d)([(0,h.F)("fogEnabled")],F.prototype,"_fogEnabled",void 0),(0,V.d)([(0,h.F)()],F.prototype,"pointSize",void 0),(0,V.d)([(0,h.F)()],F.prototype,"zOffset",void 0),(0,V.d)([(0,h.F)()],F.prototype,"zOffsetUnits",void 0),(0,V.d)([(0,h.F)()],F.prototype,"pointsCloud",null),(0,V.d)([(0,h.F)()],F.prototype,"fillMode",null),(0,V.d)([(0,h.F)()],F.prototype,"useLogarithmicDepth",null),(0,V.d)([(0,h.F)()],F.prototype,"transparencyMode",null)},11760:(f,v,Z)=>{Z.d(v,{$:()=>w,C:()=>y,G:()=>a,K:()=>W,O:()=>P,Q:()=>B,T:()=>I,V:()=>U,W:()=>i,_:()=>g,b:()=>A,bb:()=>t,d:()=>u,eb:()=>E,f:()=>z,h:()=>O,ib:()=>b,l:()=>X,n:()=>F,q:()=>K,t:()=>N,x:()=>M,y:()=>Y});var V=Z(11247),h=Z(11472),J=Z(11281),l=Z(11710),e=Z(11768);const C=h.Mv.Black(),H={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function O(f,v,Z){if(!f||f.LOGARITHMICDEPTH||f.indexOf&&f.indexOf("LOGARITHMICDEPTH")>=0){const f=Z.activeCamera;1===f.mode&&V.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),v.setFloat("logarithmicDepthConstant",2/(Math.log(f.maxZ+1)/Math.LN2))}}function u(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Z&&f.fogEnabled&&(!v||v.applyFog)&&0!==f.fogMode&&(Z.setFloat4("vFogInfos",f.fogMode,f.fogStart,f.fogEnd,f.fogDensity),V?(f.fogColor.toLinearSpaceToRef(C,f.getEngine().useExactSrgbConversions),Z.setColor3("vFogColor",C)):Z.setColor3("vFogColor",f.fogColor))}function W(f,v,Z,V,h,J,l,e,C,O){const u=f.numMaxInfluencers||f.numInfluencers;return u<=0?0:(v.push("#define MORPHTARGETS"),f.hasPositions&&v.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),f.hasNormals&&v.push("#define MORPHTARGETTEXTURE_HASNORMALS"),f.hasTangents&&v.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),f.hasUVs&&v.push("#define MORPHTARGETTEXTURE_HASUVS"),f.hasUV2s&&v.push("#define MORPHTARGETTEXTURE_HASUV2S"),f.hasColors&&v.push("#define MORPHTARGETTEXTURE_HASCOLORS"),f.supportsPositions&&h&&v.push("#define MORPHTARGETS_POSITION"),f.supportsNormals&&J&&v.push("#define MORPHTARGETS_NORMAL"),f.supportsTangents&&l&&v.push("#define MORPHTARGETS_TANGENT"),f.supportsUVs&&e&&v.push("#define MORPHTARGETS_UV"),f.supportsUV2s&&C&&v.push("#define MORPHTARGETS_UV2"),f.supportsColors&&O&&v.push("#define MORPHTARGETS_COLOR"),v.push("#define NUM_MORPH_INFLUENCERS "+u),f.isUsingTextureForTargets&&v.push("#define MORPHTARGETS_TEXTURE"),H.NUM_MORPH_INFLUENCERS=u,H.NORMAL=J,H.TANGENT=l,H.UV=e,H.UV2=C,H.COLOR=O,a(Z,V,H,h),u)}function a(f,v,Z){let h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const l=Z.NUM_MORPH_INFLUENCERS;if(l>0&&J.c.LastCreatedEngine){const e=J.c.LastCreatedEngine.getCaps().maxVertexAttribs,C=v.morphTargetManager;if(null!==C&&void 0!==C&&C.isUsingTextureForTargets)return;const H=C&&C.supportsPositions&&h,O=C&&C.supportsNormals&&Z.NORMAL,u=C&&C.supportsTangents&&Z.TANGENT,W=C&&C.supportsUVs&&Z.UV1,a=C&&C.supportsUV2s&&Z.UV2,b=C&&C.supportsColors&&Z.VERTEXCOLOR;for(let Z=0;Z<l;Z++)H&&f.push("position"+Z),O&&f.push("normal"+Z),u&&f.push("tangent"+Z),W&&f.push("uv_"+Z),a&&f.push("uv2_"+Z),b&&f.push("color"+Z),f.length>e&&V.e.Error("Cannot add more vertex attributes for mesh "+v.name)}}function b(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"),v&&(f.push("previousWorld0"),f.push("previousWorld1"),f.push("previousWorld2"),f.push("previousWorld3"))}function X(f,v){const Z=f.morphTargetManager;f&&Z&&v.setFloatArray("morphTargetInfluences",Z.influences)}function F(f,v){v.bindToEffect(f,"Scene")}function U(f,v,Z){v._needUVs=!0,v[Z]=!0,f.optimizeUVAllocation&&f.getTextureMatrix().isIdentityAs3x2()?(v[Z+"DIRECTUV"]=f.coordinatesIndex+1,v["MAINUV"+(f.coordinatesIndex+1)]=!0):v[Z+"DIRECTUV"]=0}function K(f,v,Z){const V=f.getTextureMatrix();v.Eh(Z+"Matrix",V)}function M(f,v,Z){Z.BAKED_VERTEX_ANIMATION_TEXTURE&&Z.INSTANCES&&f.push("bakedVertexAnimationSettingsInstanced")}function A(f,v,Z){var V;if(v&&f&&(f.computeBonesUsingShaders&&v._bonesComputationForcedToCPU&&(f.computeBonesUsingShaders=!1),f.useBones&&f.computeBonesUsingShaders&&f.skeleton)){const h=f.skeleton;if(h.isUsingTextureForMatrices&&v.getUniformIndex("boneTextureWidth")>-1){const Z=h.getTransformMatrixTexture(f);v.setTexture("boneSampler",Z),v.setFloat("boneTextureWidth",4*(h.bones.length+1))}else{const J=h.getTransformMatrices(f);J&&(v.setMatrices("mBones",J),Z&&f.Yf().prePassRenderer&&f.Yf().prePassRenderer.getIndex(2)&&(Z.previousBones[f.uniqueId]||(Z.previousBones[f.uniqueId]=J.slice()),v.setMatrices("mPreviousBones",Z.previousBones[f.uniqueId]),V=J,Z.previousBones[f.uniqueId].set(V)))}}}function s(f,v,Z,V,h){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];f._bindLight(v,Z,V,h,J)}function z(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const J=Math.min(v.lightSources.length,h);for(let l=0;l<J;l++){s(v.lightSources[l],l,f,Z,"boolean"===typeof V?V:V.SPECULARTERM,v.receiveShadows)}}function Y(f,v,Z,V){Z.NUM_BONE_INFLUENCERS>0&&(V.addCPUSkinningFallback(0,v),f.push("matricesIndices"),f.push("matricesWeights"),Z.NUM_BONE_INFLUENCERS>4&&(f.push("matricesIndicesExtra"),f.push("matricesWeightsExtra")))}function y(f,v){(v.INSTANCES||v.THIN_INSTANCES)&&b(f,!!v.PREPASS_VELOCITY),v.INSTANCESCOLOR&&f.push("instanceColor")}function N(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=0;for(let J=0;J<Z&&f["LIGHT"+J];J++)J>0&&(h=V+J,v.addFallback(h,"LIGHT"+J)),f.SHADOWS||(f["SHADOW"+J]&&v.addFallback(V,"SHADOW"+J),f["SHADOWPCF"+J]&&v.addFallback(V,"SHADOWPCF"+J),f["SHADOWPCSS"+J]&&v.addFallback(V,"SHADOWPCSS"+J),f["SHADOWPOISSON"+J]&&v.addFallback(V,"SHADOWPOISSON"+J),f["SHADOWESM"+J]&&v.addFallback(V,"SHADOWESM"+J),f["SHADOWCLOSEESM"+J]&&v.addFallback(V,"SHADOWCLOSEESM"+J));return h++}function i(f,v,Z,V,h,J,l){let e=arguments.length>7&&void 0!==arguments[7]&&arguments[7];l._areMiscDirty&&(l.LOGARITHMICDEPTH=Z,l.POINTSIZE=V,l.FOG=h&&function(f,v){return v.fogEnabled&&f.applyFog&&0!==v.fogMode}(f,v),l.NONUNIFORMSCALING=f.nonUniformScaling,l.ALPHATEST=J,l.DECAL_AFTER_DETAIL=e)}function I(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z._areLightsDirty)return Z._needNormals;let l=0;const e={needNormals:Z._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(f.lightsEnabled&&!J)for(const H of v.lightSources)if(T(f,v,H,l,Z,V,e),l++,l===h)break;Z.SPECULARTERM=e.specularEnabled,Z.SHADOWS=e.shadowEnabled;for(let H=l;H<h;H++)void 0!==Z["LIGHT"+H]&&(Z["LIGHT"+H]=!1,Z["HEMILIGHT"+H]=!1,Z["POINTLIGHT"+H]=!1,Z["DIRLIGHT"+H]=!1,Z["SPOTLIGHT"+H]=!1,Z["AREALIGHT"+H]=!1,Z["SHADOW"+H]=!1,Z["SHADOWCSM"+H]=!1,Z["SHADOWCSMDEBUG"+H]=!1,Z["SHADOWCSMNUM_CASCADES"+H]=!1,Z["SHADOWCSMUSESHADOWMAXZ"+H]=!1,Z["SHADOWCSMNOBLEND"+H]=!1,Z["SHADOWCSM_RIGHTHANDED"+H]=!1,Z["SHADOWPCF"+H]=!1,Z["SHADOWPCSS"+H]=!1,Z["SHADOWPOISSON"+H]=!1,Z["SHADOWESM"+H]=!1,Z["SHADOWCLOSEESM"+H]=!1,Z["SHADOWCUBE"+H]=!1,Z["SHADOWLOWQUALITY"+H]=!1,Z["SHADOWMEDIUMQUALITY"+H]=!1);const C=f.getEngine().getCaps();return void 0===Z.SHADOWFLOAT&&(e.needRebuild=!0),Z.SHADOWFLOAT=e.shadowEnabled&&(C.textureFloatRender&&C.textureFloatLinearFiltering||C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering),Z.LIGHTMAPEXCLUDED=e.lightmapMode,e.needRebuild&&Z.rebuild(),e.needNormals}function T(f,v,Z,V,h,J,e){switch(e.needNormals=!0,void 0===h["LIGHT"+V]&&(e.needRebuild=!0),h["LIGHT"+V]=!0,h["SPOTLIGHT"+V]=!1,h["HEMILIGHT"+V]=!1,h["POINTLIGHT"+V]=!1,h["DIRLIGHT"+V]=!1,h["AREALIGHT"+V]=!1,Z.prepareLightSpecificDefines(h,V),h["LIGHT_FALLOFF_PHYSICAL"+V]=!1,h["LIGHT_FALLOFF_GLTF"+V]=!1,h["LIGHT_FALLOFF_STANDARD"+V]=!1,Z.falloffType){case l.c.FALLOFF_GLTF:h["LIGHT_FALLOFF_GLTF"+V]=!0;break;case l.c.FALLOFF_PHYSICAL:h["LIGHT_FALLOFF_PHYSICAL"+V]=!0;break;case l.c.FALLOFF_STANDARD:h["LIGHT_FALLOFF_STANDARD"+V]=!0}if(J&&!Z.FO.equalsFloats(0,0,0)&&(e.specularEnabled=!0),h["SHADOW"+V]=!1,h["SHADOWCSM"+V]=!1,h["SHADOWCSMDEBUG"+V]=!1,h["SHADOWCSMNUM_CASCADES"+V]=!1,h["SHADOWCSMUSESHADOWMAXZ"+V]=!1,h["SHADOWCSMNOBLEND"+V]=!1,h["SHADOWCSM_RIGHTHANDED"+V]=!1,h["SHADOWPCF"+V]=!1,h["SHADOWPCSS"+V]=!1,h["SHADOWPOISSON"+V]=!1,h["SHADOWESM"+V]=!1,h["SHADOWCLOSEESM"+V]=!1,h["SHADOWCUBE"+V]=!1,h["SHADOWLOWQUALITY"+V]=!1,h["SHADOWMEDIUMQUALITY"+V]=!1,v&&v.receiveShadows&&f.shadowsEnabled&&Z.shadowEnabled){const v=Z.getShadowGenerator(f.activeCamera)??Z.getShadowGenerator();if(v){const f=v.getShadowMap();f&&f.renderList&&f.renderList.length>0&&(e.shadowEnabled=!0,v.prepareDefines(h,V))}}Z.lightmapMode!=l.c.LIGHTMAP_DEFAULT?(e.lightmapMode=!0,h["LIGHTMAPEXCLUDED"+V]=!0,h["LIGHTMAPNOSPECULAR"+V]=Z.lightmapMode==l.c.LIGHTMAP_SHADOWSONLY):(h["LIGHTMAPEXCLUDED"+V]=!1,h["LIGHTMAPNOSPECULAR"+V]=!1)}function B(f,v,Z,V,h){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=function(f,v){let Z=!1;if(f.activeCamera){const V=v.CAMERA_ORTHOGRAPHIC?1:0,h=v.CAMERA_PERSPECTIVE?1:0,J=1===f.activeCamera.mode?1:0,l=0===f.activeCamera.mode?1:0;(V^J||h^l)&&(v.CAMERA_ORTHOGRAPHIC=1===J,v.CAMERA_PERSPECTIVE=1===l,Z=!0)}return Z}(f,V);!1!==J&&(C=(0,e.e)(Z,f,V)),V.DEPTHPREPASS!==!v.getColorWrite()&&(V.DEPTHPREPASS=!V.DEPTHPREPASS,C=!0),V.INSTANCES!==h&&(V.INSTANCES=h,C=!0),V.THIN_INSTANCES!==l&&(V.THIN_INSTANCES=l,C=!0),C&&V.markAsUnprocessed()}function P(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!v._areAttributesDirty&&v._needNormals===v._normals&&v._needUVs===v._uvs)return!1;v._normals=v._needNormals,v._uvs=v._needUVs,v.NORMAL=v._needNormals&&f.isVerticesDataPresent("normal"),v._needNormals&&f.isVerticesDataPresent("tangent")&&(v.TANGENT=!0);for(let e=1;e<=6;++e)v["UV"+e]=!!v._needUVs&&f.isVerticesDataPresent(`uv${1===e?"":e}`);if(Z){const Z=f.useVertexColors&&f.isVerticesDataPresent("color");v.VERTEXCOLOR=Z,v.VERTEXALPHA=f.hasVertexAlpha&&Z&&J}return f.isVerticesDataPresent("instanceColor")&&(f.hasInstances||f.hasThinInstances)&&(v.INSTANCESCOLOR=!0),V&&function(f,v){if(f.useBones&&f.computeBonesUsingShaders&&f.skeleton){v.NUM_BONE_INFLUENCERS=f.numBoneInfluencers;const Z=void 0!==v.BONETEXTURE;if(f.skeleton.isUsingTextureForMatrices&&Z)v.BONETEXTURE=!0;else{v.BonesPerMesh=f.skeleton.bones.length+1,v.BONETEXTURE=!Z&&void 0;const V=f.Yf().prePassRenderer;if(V&&V.enabled){const Z=-1===V.excludedSkinnedMesh.indexOf(f);v.BONES_VELOCITY_ENABLED=Z}}}else v.NUM_BONE_INFLUENCERS=0,v.BonesPerMesh=0,void 0!==v.BONETEXTURE&&(v.BONETEXTURE=!1)}(f,v),h&&function(f,v){const Z=f.morphTargetManager;Z?(v.MORPHTARGETS_UV=Z.supportsUVs&&v.UV1,v.MORPHTARGETS_UV2=Z.supportsUV2s&&v.UV2,v.MORPHTARGETS_TANGENT=Z.supportsTangents&&v.TANGENT,v.MORPHTARGETS_NORMAL=Z.supportsNormals&&v.NORMAL,v.MORPHTARGETS_POSITION=Z.supportsPositions,v.MORPHTARGETS_COLOR=Z.supportsColors,v.MORPHTARGETTEXTURE_HASUVS=Z.hasUVs,v.MORPHTARGETTEXTURE_HASUV2S=Z.hasUV2s,v.MORPHTARGETTEXTURE_HASTANGENTS=Z.hasTangents,v.MORPHTARGETTEXTURE_HASNORMALS=Z.hasNormals,v.MORPHTARGETTEXTURE_HASPOSITIONS=Z.hasPositions,v.MORPHTARGETTEXTURE_HASCOLORS=Z.hasColors,v.NUM_MORPH_INFLUENCERS=Z.numMaxInfluencers||Z.numInfluencers,v.MORPHTARGETS=v.NUM_MORPH_INFLUENCERS>0,v.MORPHTARGETS_TEXTURE=Z.isUsingTextureForTargets):(v.MORPHTARGETS_UV=!1,v.MORPHTARGETS_UV2=!1,v.MORPHTARGETS_TANGENT=!1,v.MORPHTARGETS_NORMAL=!1,v.MORPHTARGETS_POSITION=!1,v.MORPHTARGETS_COLOR=!1,v.MORPHTARGETTEXTURE_HASUVS=!1,v.MORPHTARGETTEXTURE_HASUV2S=!1,v.MORPHTARGETTEXTURE_HASTANGENTS=!1,v.MORPHTARGETTEXTURE_HASNORMALS=!1,v.MORPHTARGETTEXTURE_HASPOSITIONS=!1,v.MORPHTARGETTEXTURE_HAS_COLORS=!1,v.MORPHTARGETS=!1,v.NUM_MORPH_INFLUENCERS=0)}(f,v),l&&function(f,v){const Z=f.bakedVertexAnimationManager;v.BAKED_VERTEX_ANIMATION_TEXTURE=!(!Z||!Z.isEnabled)}(f,v),!0}function g(f,v){if(f.activeCamera){const Z=v.MULTIVIEW;v.MULTIVIEW=null!==f.activeCamera.outputRenderTarget&&f.activeCamera.outputRenderTarget.getViewCount()>1,v.MULTIVIEW!=Z&&v.markAsUnprocessed()}}function w(f,v,Z){const V=v.ORDER_INDEPENDENT_TRANSPARENCY,h=v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;v.ORDER_INDEPENDENT_TRANSPARENCY=f.useOrderIndependentTransparency&&Z,v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!f.getEngine().getCaps().textureFloatLinearFiltering,V===v.ORDER_INDEPENDENT_TRANSPARENCY&&h===v.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||v.markAsUnprocessed()}function t(f,v,Z){const V=v.PREPASS;if(!v._arePrePassDirty)return;const h=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(f.prePassRenderer&&f.prePassRenderer.enabled&&Z){v.PREPASS=!0,v.SCENE_MRT_COUNT=f.prePassRenderer.mrtCount,v.PREPASS_NORMAL_WORLDSPACE=f.prePassRenderer.generateNormalsInWorldSpace,v.PREPASS_COLOR=!0,v.PREPASS_COLOR_INDEX=0;for(let Z=0;Z<h.length;Z++){const V=f.prePassRenderer.getIndex(h[Z].type);-1!==V?(v[h[Z].define]=!0,v[h[Z].index]=V):v[h[Z].define]=!1}}else{v.PREPASS=!1;for(let f=0;f<h.length;f++)v[h[f].define]=!1}v.PREPASS!=V&&(v.markAsUnprocessed(),v.markAsImageProcessingDirty())}function L(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];h&&h.push("Light"+f),J||(v.push("vLightData"+f,"vLightDiffuse"+f,"vLightSpecular"+f,"vLightDirection"+f,"vLightWidth"+f,"vLightHeight"+f,"vLightFalloff"+f,"vLightGround"+f,"lightMatrix"+f,"shadowsInfo"+f,"depthValues"+f),Z.push("shadowTexture"+f),Z.push("depthTexture"+f),v.push("viewFrustumZ"+f,"cascadeBlendFactor"+f,"lightSizeUVCorrection"+f,"depthCorrection"+f,"penumbraDarkness"+f,"frustumLengths"+f),V&&(Z.push("projectionLightTexture"+f),v.push("textureProjectionMatrix"+f)),l&&Z.push("iesLightTexture"+f))}function E(f,v,Z){let V,h,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(f.uniformsNames){const l=f;V=l.uniformsNames,h=l.uniformBuffersNames,v=l.samplers,Z=l.defines,J=l.maxSimultaneousLights||0}else V=f,v||(v=[]);for(let l=0;l<J&&Z["LIGHT"+l];l++)L(l,V,v,Z["PROJECTEDLIGHTTEXTURE"+l],h,!1,Z["IESLIGHTTEXTURE"+l]);Z.NUM_MORPH_INFLUENCERS&&(V.push("morphTargetInfluences"),V.push("morphTargetCount")),Z.BAKED_VERTEX_ANIMATION_TEXTURE&&(V.push("bakedVertexAnimationSettings"),V.push("bakedVertexAnimationTextureSizeInverted"),V.push("bakedVertexAnimationTime"),v.push("bakedVertexAnimationTexture"))}},11722:(f,v,Z)=>{Z.d(v,{b:()=>J});var V=Z(11421),h=Z(11729);class J extends h.e{constructor(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(f,v,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new V.Matrix,this._storeEffectOnSubMeshes=Z}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(f,v){return!!f&&(!this._storeEffectOnSubMeshes||(!f.Bh||0===f.Bh.length||this.isReadyForSubMesh(f,f.Bh[0],v)))}_isReadyForSubMesh(f){const v=f.materialDefines;return!(this.checkReadyOnEveryCall||!f.effect||!v||v._renderId!==this.Yf().getRenderId())}bindOnlyWorldMatrix(f){this._activeEffect.setMatrix("world",f)}bindOnlyNormalMatrix(f){this._activeEffect.setMatrix("normalMatrix",f)}bind(f,v){v&&this.bindForSubMesh(f,v,v.Bh[0])}_afterBind(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;super._afterBind(f,v,Z),this.Yf()._cachedEffect=v,Z?Z._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Z._drawWrapper._forceRebindOnNextCall||f.isCachedMaterialInvalid(this,v,V)}dispose(f,v,Z){this._activeEffect=void 0,super.dispose(f,v,Z)}}},11756:(f,v,Z)=>{Z.d(v,{e:()=>e,i:()=>C});var V=Z(11405),h=Z(11421),J=Z(11410);class l{static extractMinAndMaxIndexed(f,v,Z,V,h,J){for(let l=Z;l<Z+V;l++){const Z=3*v[l],V=f[Z],e=f[Z+1],C=f[Z+2];h.minimizeInPlaceFromFloats(V,e,C),J.maximizeInPlaceFromFloats(V,e,C)}}static extractMinAndMax(f,v,Z,V,h,J){for(let l=v,e=v*V;l<v+Z;l++,e+=V){const v=f[e],Z=f[e+1],V=f[e+2];h.minimizeInPlaceFromFloats(v,Z,V),J.maximizeInPlaceFromFloats(v,Z,V)}}}function e(f,v,Z,V){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const e=new h.Xv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new h.Xv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return l.extractMinAndMaxIndexed(f,v,Z,V,e,C),J&&(e.x-=e.x*J.x+J.y,e.y-=e.y*J.x+J.y,e.z-=e.z*J.x+J.y,C.x+=C.x*J.x+J.y,C.y+=C.y*J.x+J.y,C.z+=C.z*J.x+J.y),{minimum:e,maximum:C}}function C(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;const e=new h.Xv(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new h.Xv(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return J||(J=3),l.extractMinAndMax(f,v,Z,J,e,C),V&&(e.x-=e.x*V.x+V.y,e.y-=e.y*V.x+V.y,e.z-=e.z*V.x+V.y,C.x+=C.x*V.x+V.y,C.y+=C.y*V.x+V.y,C.z+=C.z*V.x+V.y),{minimum:e,maximum:C}}(0,V.d)([J.d.filter((function(){for(var f=arguments.length,v=new Array(f),Z=0;Z<f;Z++)v[Z]=arguments[Z];let[V,h]=v;return!Array.isArray(V)&&!Array.isArray(h)}))],l,"extractMinAndMaxIndexed",null),(0,V.d)([J.d.filter((function(){for(var f=arguments.length,v=new Array(f),Z=0;Z<f;Z++)v[Z]=arguments[Z];let[V]=v;return!Array.isArray(V)}))],l,"extractMinAndMax",null)},11733:(f,v,Z)=>{Z.d(v,{b:()=>C});var V=Z(11494),h=Z(11738),J=Z(11741),l=Z(11756),e=Z(11534);class C{get materialDefines(){var f;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(f=this._getDrawWrapper())||void 0===f?void 0:f.defines}set materialDefines(f){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=f}_getDrawWrapper(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f=f??this._engine.currentRenderPassId;let Z=this._drawWrappers[f];return!Z&&v&&(this._drawWrappers[f]=Z=new e.d(this._mesh.Yf().getEngine())),Z}_removeDrawWrapper(f){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var Z;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(Z=this._drawWrappers[f])||void 0===Z||Z.dispose(v));this._drawWrappers[f]=void 0}get effect(){var f;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(f=this._getDrawWrapper())||void 0===f?void 0:f.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(f){this._mainDrawWrapperOverride=f}setEffect(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this._drawWrapper;h.setEffect(f,v,V),void 0!==Z&&(h.materialContext=Z),f||(h.defines=null,h.materialContext=void 0)}resetDrawCache(f){let v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==f)return void this._removeDrawWrapper(f,!0,v);for(const f of this._drawWrappers)null===f||void 0===f||f.dispose(v)}this._drawWrappers=[]}static AddToMesh(f,v,Z,V,h,J,l){return new C(f,v,Z,V,h,J,l,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(f,v,Z,V,h,J,l){let e=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],C=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=f,this.verticesStart=v,this.verticesCount=Z,this.indexStart=V,this.indexCount=h,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=J,this._renderingMesh=l||J,C&&J.Bh.push(this),this._engine=this._mesh.Yf().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=J.Bh.length-1,e&&(this.refreshBoundingInfo(),J.jh(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(f){return this._boundingInfo=f,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const f=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return f||this._renderingMesh}Ef(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const v=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!v)return f&&this._mesh.Yf()._hasDefaultMaterial?this._mesh.Yf().defaultMaterial:null;if(this._isMultiMaterial(v)){const f=v.getSubMaterial(this.materialIndex);return this._currentMaterial!==f&&(this._currentMaterial=f,this.resetDrawCache()),f}return v}_isMultiMaterial(f){return void 0!==f.getSubMaterial}refreshBoundingInfo(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.qh)return this;if(f||(f=this._renderingMesh.getVerticesData(V.g.PositionKind)),!f)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const v=this._renderingMesh.dh();let Z;if(0===this.indexStart&&this.indexCount===v.length){const f=this._renderingMesh.getBoundingInfo();Z={minimum:f.minimum.clone(),maximum:f.maximum.clone()}}else Z=(0,l.e)(f,v,this.indexStart,this.indexCount,this._renderingMesh.qh.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(Z.minimum,Z.maximum):this._boundingInfo=new J.e(Z.minimum,Z.maximum),this}_checkCollision(f){return this.getBoundingInfo()._checkCollision(f)}updateBoundingInfo(f){let v=this.getBoundingInfo();return v||(this.refreshBoundingInfo(),v=this.getBoundingInfo()),v&&v.update(f),this}isInFrustum(f){const v=this.getBoundingInfo();return!!v&&v.isInFrustum(f,this._mesh.Uu)}isCompletelyInFrustum(f){const v=this.getBoundingInfo();return!!v&&v.isCompletelyInFrustum(f)}render(f){return this._renderingMesh.render(this,f,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(f,v){if(!this._linesIndexBuffer){const Z=6*Math.floor(this.indexCount/3),V=this.verticesStart+this.verticesCount>65535?new Uint32Array(Z):new Uint16Array(Z);let h=0;if(0===f.length)for(let f=this.indexStart;f<this.indexStart+this.indexCount;f+=3)V[h++]=f,V[h++]=f+1,V[h++]=f+1,V[h++]=f+2,V[h++]=f+2,V[h++]=f;else for(let v=this.indexStart;v<this.indexStart+this.indexCount;v+=3)V[h++]=f[v],V[h++]=f[v+1],V[h++]=f[v+1],V[h++]=f[v+2],V[h++]=f[v+2],V[h++]=f[v];this._linesIndexBuffer=v.createIndexBuffer(V),this._linesIndexCount=V.length}return this._linesIndexBuffer}canIntersects(f){const v=this.getBoundingInfo();return!!v&&f.intersectsBox(v.boundingBox)}intersects(f,v,Z,V,h){const J=this.Ef();if(!J)return null;let l=3,e=!1;switch(J.fillMode){case 3:case 5:case 6:case 8:return null;case 7:l=1,e=!0}return 4===J.fillMode?Z.length?this._intersectLines(f,v,Z,this._mesh.intersectionThreshold,V):this._intersectUnIndexedLines(f,v,Z,this._mesh.intersectionThreshold,V):!Z.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(f,v,Z,V,h):this._intersectTriangles(f,v,Z,l,e,V,h)}_intersectLines(f,v,Z,V,J){let l=null;for(let e=this.indexStart;e<this.indexStart+this.indexCount;e+=2){const C=v[Z[e]],H=v[Z[e+1]],O=f.intersectionSegment(C,H,V);if(!(O<0)&&((J||!l||O<l.distance)&&(l=new h.c(null,null,O),l.faceId=e/2,J)))break}return l}_intersectUnIndexedLines(f,v,Z,V,J){let l=null;for(let e=this.verticesStart;e<this.verticesStart+this.verticesCount;e+=2){const Z=v[e],C=v[e+1],H=f.intersectionSegment(Z,C,V);if(!(H<0)&&((J||!l||H<l.distance)&&(l=new h.c(null,null,H),l.faceId=e/2,J)))break}return l}_intersectTriangles(f,v,Z,V,h,J,l){let e=null,C=-1;for(let H=this.indexStart;H<this.indexStart+this.indexCount-(3-V);H+=V){C++;const V=Z[H],O=Z[H+1],u=Z[H+2];if(h&&4294967295===u){H+=2;continue}const W=v[V],a=v[O],b=v[u];if(!W||!a||!b)continue;if(l&&!l(W,a,b,f,V,O,u))continue;const X=f.intersectsTriangle(W,a,b);if(X){if(X.distance<0)continue;if((J||!e||X.distance<e.distance)&&(e=X,e.faceId=C,J))break}}return e}_intersectUnIndexedTriangles(f,v,Z,V,h){let J=null;for(let l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=3){const Z=v[l],e=v[l+1],C=v[l+2];if(h&&!h(Z,e,C,f,-1,-1,-1))continue;const H=f.intersectsTriangle(Z,e,C);if(H){if(H.distance<0)continue;if((V||!J||H.distance<J.distance)&&(J=H,J.faceId=l/3,V))break}}return J}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(f,v){const Z=new C(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,f,v,!1);if(!this.IsGlobal){const f=this.getBoundingInfo();if(!f)return Z;Z._boundingInfo=new J.e(f.minimum,f.maximum)}return Z}dispose(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Yf().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const v=this._mesh.Bh.indexOf(this);this._mesh.Bh.splice(v,1),this.resetDrawCache(void 0,f)}getClassName(){return"SubMesh"}static CreateFromIndices(f,v,Z,V,h){let J=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=Number.MAX_VALUE,e=-Number.MAX_VALUE;const H=(h||V).dh();for(let C=v;C<v+Z;C++){const f=H[C];f<l&&(l=f),f>e&&(e=f)}return new C(f,l,e-l+1,v,Z,V,h,J)}}}}]);