"use strict";(self.n52dyox90qa=self.n52dyox90qa||[]).push([[24],{12132:(E,t,z)=>{z.d(t,{e:()=>A});class A{constructor(E,t,z){this.bu=E,this.bv=t,this.distance=z,this.faceId=0,this.subMeshId=0}}},12144:(E,t,z)=>{z.d(t,{e:()=>u});var A=z(11826),X=z(11812),R=z(11817);class u{constructor(E,t,z){this.vectors=(0,A.c)(8,X.Lt.Zero),this.center=X.Lt.Zero(),this.centerWorld=X.Lt.Zero(),this.extendSize=X.Lt.Zero(),this.extendSizeWorld=X.Lt.Zero(),this.directions=(0,A.c)(3,X.Lt.Zero),this.vectorsWorld=(0,A.c)(8,X.Lt.Zero),this.minimumWorld=X.Lt.Zero(),this.maximumWorld=X.Lt.Zero(),this.minimum=X.Lt.Zero(),this.maximum=X.Lt.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(E,t,z)}reConstruct(E,t,z){const A=E.x,R=E.y,u=E.z,p=t.x,C=t.y,Z=t.z,H=this.vectors;this.minimum.Op(A,R,u),this.maximum.Op(p,C,Z),H[0].Op(A,R,u),H[1].Op(p,C,Z),H[2].Op(p,R,u),H[3].Op(A,C,u),H[4].Op(A,R,Z),H[5].Op(p,C,u),H[6].Op(A,C,Z),H[7].Op(p,R,Z),t.addToRef(E,this.center).scaleInPlace(.5),t.subtractToRef(E,this.extendSize).scaleInPlace(.5),this._worldMatrix=z||X.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(E){const t=u._TmpVector3,z=this.maximum.subtractToRef(this.minimum,t[0]),A=z.length();z.normalizeFromLength(A);const X=A*E,R=z.scaleInPlace(.5*X),p=this.center.subtractToRef(R,t[1]),C=this.center.addToRef(R,t[2]);return this.reConstruct(p,C,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){const t=this.minimumWorld,z=this.maximumWorld,A=this.directions,R=this.vectorsWorld,u=this.vectors;if(E.isIdentity()){t.R(this.minimum),z.R(this.maximum);for(let E=0;E<8;++E)R[E].R(u[E]);this.extendSizeWorld.R(this.extendSize),this.centerWorld.R(this.center)}else{t.ap(Number.MAX_VALUE),z.ap(-Number.MAX_VALUE);for(let A=0;A<8;++A){const p=R[A];X.Lt.TransformCoordinatesToRef(u[A],E,p),t.minimizeInPlace(p),z.maximizeInPlace(p)}z.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),z.addToRef(t,this.centerWorld).scaleInPlace(.5)}X.Lt.FromArrayToRef(E.m,0,A[0]),X.Lt.FromArrayToRef(E.m,4,A[1]),X.Lt.FromArrayToRef(E.m,8,A[2]),this._worldMatrix=E}isInFrustum(E){return u.IsInFrustum(this.vectorsWorld,E)}isCompletelyInFrustum(E){return u.IsCompletelyInFrustum(this.vectorsWorld,E)}intersectsPoint(E){const t=this.minimumWorld,z=this.maximumWorld,A=t.x,X=t.y,u=t.z,p=z.x,C=z.y,Z=z.z,H=E.x,h=E.y,d=E.z,y=-R.c;return!(p-H<y||y>H-A)&&(!(C-h<y||y>h-X)&&!(Z-d<y||y>d-u))}intersectsSphere(E){return u.IntersectsSphere(this.minimumWorld,this.maximumWorld,E.centerWorld,E.radiusWorld)}intersectsMinMax(E,t){const z=this.minimumWorld,A=this.maximumWorld,X=z.x,R=z.y,u=z.z,p=A.x,C=A.y,Z=A.z,H=E.x,h=E.y,d=E.z,y=t.x,O=t.y,c=t.z;return!(p<H||X>y)&&(!(C<h||R>O)&&!(Z<d||u>c))}dispose(){var E,t;null===(E=this._drawWrapperFront)||void 0===E||E.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()}static Intersects(E,t){return E.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(E,t,z,A){const R=u._TmpVector3[0];X.Lt.ClampToRef(z,E,t,R);return X.Lt.DistanceSquared(z,R)<=A*A}static IsCompletelyInFrustum(E,t){for(let z=0;z<6;++z){const A=t[z];for(let t=0;t<8;++t)if(A.dotCoordinate(E[t])<0)return!1}return!0}static IsInFrustum(E,t){for(let z=0;z<6;++z){let A=!0;const X=t[z];for(let t=0;t<8;++t)if(X.dotCoordinate(E[t])>=0){A=!1;break}if(A)return!1}return!0}}u._TmpVector3=(0,A.c)(3,X.Lt.Zero)},12139:(E,t,z)=>{z.d(t,{c:()=>h});var A=z(11826),X=z(11812),R=z(12144),u=z(12148);const p={min:0,max:0},C={min:0,max:0},Z=(E,t,z)=>{const A=X.Lt.Dot(t.centerWorld,E),R=Math.abs(X.Lt.Dot(t.directions[0],E))*t.extendSize.x+Math.abs(X.Lt.Dot(t.directions[1],E))*t.extendSize.y+Math.abs(X.Lt.Dot(t.directions[2],E))*t.extendSize.z;z.min=A-R,z.max=A+R},H=(E,t,z)=>(Z(E,t,p),Z(E,z,C),!(p.min>C.max||C.min>p.max));class h{constructor(E,t,z){this._isLocked=!1,this.boundingBox=new R.e(E,t,z),this.boundingSphere=new u.e(E,t,z)}reConstruct(E,t,z){this.boundingBox.reConstruct(E,t,z),this.boundingSphere.reConstruct(E,t,z)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(E){this._isLocked=E}update(E){this._isLocked||(this.boundingBox._update(E),this.boundingSphere._update(E))}centerOn(E,t){const z=h._TmpVector3[0].R(E).kH(t),A=h._TmpVector3[1].R(E).addInPlace(t);return this.boundingBox.reConstruct(z,A,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(z,A,this.boundingBox.getWorldMatrix()),this}encapsulate(E){const t=X.Lt.Minimize(this.minimum,E),z=X.Lt.Maximize(this.maximum,E);return this.reConstruct(t,z,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(E){const t=X.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const z=X.TmpVectors.Lt[0];return X.Lt.TransformCoordinatesToRef(E.boundingBox.minimumWorld,t,z),this.encapsulate(z),X.Lt.TransformCoordinatesToRef(E.boundingBox.maximumWorld,t,z),this.encapsulate(z),this}scale(E){return this.boundingBox.scale(E),this.boundingSphere.scale(E),this}isInFrustum(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(E))return!0;if(!this.boundingSphere.isInFrustum(E))return!1;return!(1!==t&&3!==t)||this.boundingBox.isInFrustum(E)}get diagonalLength(){const E=this.boundingBox;return E.maximumWorld.subtractToRef(E.minimumWorld,h._TmpVector3[0]).length()}isCompletelyInFrustum(E){return this.boundingBox.isCompletelyInFrustum(E)}_checkCollision(E){return E._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(E){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(E)&&!!this.boundingBox.intersectsPoint(E))}intersects(E,t){if(!u.e.Intersects(this.boundingSphere,E.boundingSphere))return!1;if(!R.e.Intersects(this.boundingBox,E.boundingBox))return!1;if(!t)return!0;const z=this.boundingBox,A=E.boundingBox;return!!H(z.directions[0],z,A)&&(!!H(z.directions[1],z,A)&&(!!H(z.directions[2],z,A)&&(!!H(A.directions[0],z,A)&&(!!H(A.directions[1],z,A)&&(!!H(A.directions[2],z,A)&&(!!H(X.Lt.Cross(z.directions[0],A.directions[0]),z,A)&&(!!H(X.Lt.Cross(z.directions[0],A.directions[1]),z,A)&&(!!H(X.Lt.Cross(z.directions[0],A.directions[2]),z,A)&&(!!H(X.Lt.Cross(z.directions[1],A.directions[0]),z,A)&&(!!H(X.Lt.Cross(z.directions[1],A.directions[1]),z,A)&&(!!H(X.Lt.Cross(z.directions[1],A.directions[2]),z,A)&&(!!H(X.Lt.Cross(z.directions[2],A.directions[0]),z,A)&&(!!H(X.Lt.Cross(z.directions[2],A.directions[1]),z,A)&&!!H(X.Lt.Cross(z.directions[2],A.directions[2]),z,A))))))))))))))}}h._TmpVector3=(0,A.c)(2,X.Lt.Zero)},12148:(E,t,z)=>{z.d(t,{e:()=>R});var A=z(11826),X=z(11812);class R{constructor(E,t,z){this.center=X.Lt.Zero(),this.centerWorld=X.Lt.Zero(),this.minimum=X.Lt.Zero(),this.maximum=X.Lt.Zero(),this.reConstruct(E,t,z)}reConstruct(E,t,z){this.minimum.R(E),this.maximum.R(t);const A=X.Lt.Distance(E,t);t.addToRef(E,this.center).scaleInPlace(.5),this.radius=.5*A,this._update(z||X.Matrix.IdentityReadOnly)}scale(E){const t=this.radius*E,z=R._TmpVector3,A=z[0].ap(t),X=this.center.subtractToRef(A,z[1]),u=this.center.addToRef(A,z[2]);return this.reConstruct(X,u,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){if(E.isIdentity())this.centerWorld.R(this.center),this.radiusWorld=this.radius;else{X.Lt.TransformCoordinatesToRef(this.center,E,this.centerWorld);const t=R._TmpVector3[0];X.Lt.TransformNormalFromFloatsToRef(1,1,1,E,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}}isInFrustum(E){const t=this.centerWorld,z=this.radiusWorld;for(let A=0;A<6;A++)if(E[A].dotCoordinate(t)<=-z)return!1;return!0}isCenterInFrustum(E){const t=this.centerWorld;for(let z=0;z<6;z++)if(E[z].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(E){const t=X.Lt.DistanceSquared(this.centerWorld,E);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(E,t){const z=X.Lt.DistanceSquared(E.centerWorld,t.centerWorld),A=E.radiusWorld+t.radiusWorld;return!(A*A<z)}static CreateFromCenterAndRadius(E,t,z){this._TmpVector3[0].R(E),this._TmpVector3[1].Op(0,0,t),this._TmpVector3[2].R(E),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].kH(this._TmpVector3[1]);const A=new R(this._TmpVector3[0],this._TmpVector3[2]);return A._worldMatrix=z||X.Matrix.Identity(),A}}R._TmpVector3=(0,A.c)(3,X.Lt.Zero)},12168:(E,t,z)=>{function A(E){-1===E.indexOf("vClipPlane")&&E.push("vClipPlane"),-1===E.indexOf("vClipPlane2")&&E.push("vClipPlane2"),-1===E.indexOf("vClipPlane3")&&E.push("vClipPlane3"),-1===E.indexOf("vClipPlane4")&&E.push("vClipPlane4"),-1===E.indexOf("vClipPlane5")&&E.push("vClipPlane5"),-1===E.indexOf("vClipPlane6")&&E.push("vClipPlane6")}function X(E,t,z){const A=!!(E.clipPlane??t.clipPlane),X=!!(E.clipPlane2??t.clipPlane2),R=!!(E.clipPlane3??t.clipPlane3),u=!!(E.clipPlane4??t.clipPlane4),p=!!(E.clipPlane5??t.clipPlane5),C=!!(E.clipPlane6??t.clipPlane6);A&&z.push("#define CLIPPLANE"),X&&z.push("#define CLIPPLANE2"),R&&z.push("#define CLIPPLANE3"),u&&z.push("#define CLIPPLANE4"),p&&z.push("#define CLIPPLANE5"),C&&z.push("#define CLIPPLANE6")}function R(E,t,z){let A=!1;const X=!!(E.clipPlane??t.clipPlane),R=!!(E.clipPlane2??t.clipPlane2),u=!!(E.clipPlane3??t.clipPlane3),p=!!(E.clipPlane4??t.clipPlane4),C=!!(E.clipPlane5??t.clipPlane5),Z=!!(E.clipPlane6??t.clipPlane6);return z.CLIPPLANE!==X&&(z.CLIPPLANE=X,A=!0),z.CLIPPLANE2!==R&&(z.CLIPPLANE2=R,A=!0),z.CLIPPLANE3!==u&&(z.CLIPPLANE3=u,A=!0),z.CLIPPLANE4!==p&&(z.CLIPPLANE4=p,A=!0),z.CLIPPLANE5!==C&&(z.CLIPPLANE5=C,A=!0),z.CLIPPLANE6!==Z&&(z.CLIPPLANE6=Z,A=!0),A}function u(E,t,z){let A=t.clipPlane??z.clipPlane;p(E,"vClipPlane",A),A=t.clipPlane2??z.clipPlane2,p(E,"vClipPlane2",A),A=t.clipPlane3??z.clipPlane3,p(E,"vClipPlane3",A),A=t.clipPlane4??z.clipPlane4,p(E,"vClipPlane4",A),A=t.clipPlane5??z.clipPlane5,p(E,"vClipPlane5",A),A=t.clipPlane6??z.clipPlane6,p(E,"vClipPlane6",A)}function p(E,t,z){z&&E.setFloat4(t,z.normal.x,z.normal.y,z.normal.z,z.d)}z.d(t,{d:()=>A,g:()=>u,h:()=>R,k:()=>X})},12110:(E,t,z)=>{z.d(t,{d:()=>A});class A{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(E,t){this._defines[E]||(E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E),this._defines[E]=new Array),this._defines[E].push(t)}addCPUSkinningFallback(E,t){this._mesh=t,E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(E,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,E=E.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const z=this._mesh.lE();for(let E=0;E<z.meshes.length;E++){const A=z.meshes[E];if(A.material){if(A.computeBonesUsingShaders&&0!==A.numBoneInfluencers)if(A.material.getEffect()===t)A.computeBonesUsingShaders=!1;else if(A.Rp)for(const E of A.Rp){if(E.effect===t){A.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&A.computeBonesUsingShaders&&A.numBoneInfluencers>0&&(A.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let z=0;z<t.length;z++)E=E.replace("#define "+t[z],"");this._currentRank++}return E}}},12121:(E,t,z)=>{z.d(t,{b:()=>a});var A=z(11792),X=z(11801),R=z(11630),u=z(11632),p=z(11667),C=z(12128),Z=z(12073),H=z(11640),h=z(11861),d=z(11951),y=z(11849);class O{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(E){this._func=E}get funcRef(){return this._funcRef}set funcRef(E){this._funcRef=E}get funcMask(){return this._funcMask}set funcMask(E){this._funcMask=E}get opStencilFail(){return this._opStencilFail}set opStencilFail(E){this._opStencilFail=E}get opDepthFail(){return this._opDepthFail}set opDepthFail(E){this._opDepthFail=E}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(E){this._opStencilDepthPass=E}get mask(){return this._mask}set mask(E){this._mask=E}get enabled(){return this._enabled}set enabled(E){this._enabled=E}getClassName(){return"MaterialStencilState"}copyTo(E){y.b.Clone((()=>E),this)}serialize(){return y.b.Serialize(this)}parse(E,t,z){y.b.Parse((()=>this),E,t,z)}}(0,A.b)([(0,X.K)()],O.prototype,"func",null),(0,A.b)([(0,X.K)()],O.prototype,"funcRef",null),(0,A.b)([(0,X.K)()],O.prototype,"funcMask",null),(0,A.b)([(0,X.K)()],O.prototype,"opStencilFail",null),(0,A.b)([(0,X.K)()],O.prototype,"opDepthFail",null),(0,A.b)([(0,X.K)()],O.prototype,"opStencilDepthPass",null),(0,A.b)([(0,X.K)()],O.prototype,"mask",null),(0,A.b)([(0,X.K)()],O.prototype,"enabled",null);var c=z(12162);class a{get _supportGlowLayer(){return!1}set _glowModeEnabled(E){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(E){if(this._alpha===E)return;const t=this._alpha;this._alpha=E,1!==t&&1!==E||this.oZ(a.MiscDirtyFlag+a.PrePassDirtyFlag)}get alpha(){return this._alpha}set yp(E){this._backFaceCulling!==E&&(this._backFaceCulling=E,this.oZ(a.TextureDirtyFlag))}get yp(){return this._backFaceCulling}set cullBackFaces(E){this._cullBackFaces!==E&&(this._cullBackFaces=E,this.oZ(a.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(E){this._blockDirtyMechanism!==E&&(this._blockDirtyMechanism=E,E||this.Rd())}atomicMaterialsUpdate(E){this.blockDirtyMechanism=!0;try{E(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(E){this._onDisposeObserver&&this.IX.remove(this._onDisposeObserver),this._onDisposeObserver=this.IX.add(E)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new u.b),this._onBindObservable}set onBind(E){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(E)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new u.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new u.b),this._onEffectCreatedObservable}set alphaMode(E){this._alphaMode!==E&&(this._alphaMode=E,this.oZ(a.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(E){this._needDepthPrePass!==E&&(this._needDepthPrePass=E,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(E){this._fogEnabled!==E&&(this._fogEnabled=E,this.oZ(a.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case a.WireFrameFillMode:case a.LineListDrawMode:case a.LineLoopDrawMode:case a.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(E){this.fillMode=E?a.WireFrameFillMode:a.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case a.PointFillMode:case a.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(E){this.fillMode=E?a.PointFillMode:a.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(E){this._fillMode!==E&&(this._fillMode=E,this.oZ(a.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){const t=this.lE().getEngine().getCaps().fragmentDepthSupported;E&&!t&&H.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=E&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(E){this._drawWrapper=E}constructor(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.IX=new u.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new O,this._useUBO=!1,this._fillMode=a.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=E;const X=t||p.d.LastCreatedScene;X&&(this._scene=X,this._dirtyCallbacks={},this._forceGLSL=A,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=E||R.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new d.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new Z.d(this._scene.getEngine(),void 0,void 0,E),this._useUBO=this.lE().getEngine().supportsUniformBuffers,this._createUniformBuffer(),z||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),a.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var E;const t=this.lE().getEngine();null===(E=this._uniformBuffer)||void 0===E||E.dispose(),t.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new Z.d(t,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new Z.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(E){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Rd(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Rd(),this.checkReadyOnlyOnce=!1}isReady(E,t){return!0}isReadyForSubMesh(E,t,z){const A=t.materialDefines;return!!A&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}lE(){return this._scene}_getEffectiveOrientation(E){return null!==this.sideOrientation?this.sideOrientation:E.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(E){this._transparencyMode!==E&&(this._transparencyMode=E,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===a.MATERIAL_ALPHABLEND||this._transparencyMode===a.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===a.MATERIAL_ALPHATEST||this._transparencyMode===a.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===a.MATERIAL_OPAQUE||this._transparencyMode===a.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsBlend:E.visibility<1||!this._disableAlphaBlending&&(E.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(E)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Rd(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.lE().meshes;for(const z of t)if(z.Rp)for(const t of z.Rp)if(t.oE()===this)for(const z of t._drawWrappers)z&&this._materialContext===z.materialContext&&(z._wasPreviouslyReady=!1,z._wasPreviouslyUsingInstances=null,z._forceRebindOnNextCall=E);E&&this.oZ(a.AllDirtyFlag)}_preBind(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=this._scene.getEngine(),A=(null==t?this.sideOrientation:t)===a.ClockWiseSideOrientation;return z.enableEffect(E||this._getDrawWrapper()),z.setState(this.yp,this.zOffset,!1,A,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),A}bind(E,t){}buildUniformLayout(){const E=this._uniformBuffer;this._eventInfo.ubo=E,this._callbackPluginEventGeneric(8,this._eventInfo),E.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(E,t,z){const A=z._drawWrapper;this._eventInfo.subMesh=z,this._callbackPluginEventBindForSubMesh(this._eventInfo),A._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(E){}bindView(E){this._useUBO?this._needToBindSceneUbo=!0:E.setMatrix("view",this.lE().getViewMatrix())}bindViewProjection(E){this._useUBO?this._needToBindSceneUbo=!0:(E.setMatrix("viewProjection",this.lE().getTransformMatrix()),E.setMatrix("projection",this.lE().getProjectionMatrix()))}bindEyePosition(E,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(E,t)}_afterBind(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,(0,c.u)(t,this.lE().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=E?E.visibility:1,this._onBindObservable&&E&&this._onBindObservable.notifyObservers(E),this.disableDepthWrite){const E=this._scene.getEngine();this._cachedDepthWriteState=E.getDepthWrite(),E.setDepthWrite(!1)}if(this.disableColorWrite){const E=this._scene.getEngine();this._cachedColorWriteState=E.getColorWrite(),E.setColorWrite(!1)}if(0!==this.depthFunction){const E=this._scene.getEngine();this._cachedDepthFunctionState=E.getDepthFunction()||0,E.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(E){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=E,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(E){return null}_clonePlugins(E,t){const z={};if(this._serializePlugins(z),a._ParsePlugins(z,E,this._scene,t),this.pluginManager)for(const A of this.pluginManager._plugins){const t=E.pluginManager.getPlugin(A.name);t&&A.copyTo(t)}}getBindedMeshes(){if(this.meshMap){const E=[];for(const t in this.meshMap){const z=this.meshMap[t];z&&E.push(z)}return E}return this._scene.meshes.filter((E=>E.material===this))}forceCompilation(E,t,z,A){const X={clipPlane:!1,useInstances:!1,...z},R=this.lE(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const p=()=>{if(!this._scene||!this._scene.getEngine())return;const z=R.clipPlane;if(X.clipPlane&&(R.clipPlane=new h.d(0,0,0,1)),this._storeEffectOnSubMeshes){let z=!0,R=null;if(E.Rp){const t=new C.d(0,0,0,0,0,E,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(E,t,X.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?R=t.effect.getCompilationError():(z=!1,setTimeout(p,16)))}z&&(this.allowShaderHotSwapping=u,R&&A&&A(R),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=u,t&&t(this)):setTimeout(p,16);X.clipPlane&&(R.clipPlane=z)};p()}async forceCompilationAsync(E,t){return await new Promise(((z,A)=>{this.forceCompilation(E,(()=>{z()}),t,(E=>{A(E)}))}))}oZ(E){this.lE().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(a._DirtyCallbackArray.length=0,E&a.ImageProcessingDirtyFlag&&a._DirtyCallbackArray.push(a._ImageProcessingDirtyCallBack),E&a.TextureDirtyFlag&&a._DirtyCallbackArray.push(a._TextureDirtyCallBack),E&a.LightDirtyFlag&&a._DirtyCallbackArray.push(a._LightsDirtyCallBack),E&a.FresnelDirtyFlag&&a._DirtyCallbackArray.push(a._FresnelDirtyCallBack),E&a.AttributesDirtyFlag&&a._DirtyCallbackArray.push(a._AttributeDirtyCallBack),E&a.MiscDirtyFlag&&a._DirtyCallbackArray.push(a._MiscDirtyCallBack),E&a.PrePassDirtyFlag&&a._DirtyCallbackArray.push(a._PrePassDirtyCallBack),a._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(a._RunDirtyCallBacks),this.lE().resetCachedMaterial())}resetDrawCache(){const E=this.lE().meshes;for(const t of E)if(t.Rp)for(const E of t.Rp)E.oE()===this&&E.resetDrawCache()}_markAllSubMeshesAsDirty(E){const t=this.lE();if(t.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const z=t.meshes;for(const A of z)if(A.Rp)for(const z of A.Rp){if((z.oE()||(t._hasDefaultMaterial?t.defaultMaterial:null))===this)for(const t of z._drawWrappers)t&&t.defines&&t.defines.markAllAsDirty&&this._materialContext===t.materialContext&&E(t.defines)}}_markScenePrePassDirty(){if(this.lE().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const E=this.lE().enablePrePassRenderer();E&&E.oZ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(a._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(a._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(a._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(a._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(a._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(a._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(a._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(a._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(a._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(a._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const E=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.IX.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(E)}))}}setPrePassRenderer(E){return!1}dispose(E,t,z){const A=this.lE();if(A.stopAnimation(this),A.freeProcessedMaterials(),A.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const E=this._parentContainer.materials.indexOf(this);E>-1&&this._parentContainer.materials.splice(E,1),this._parentContainer=null}if(!0!==z)if(this.meshMap)for(const X in this.meshMap){const E=this.meshMap[X];this._disposeMeshResources(E)}else{const E=A.meshes;for(const t of E)this._disposeMeshResources(t)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.IX.notifyObservers(this),this.IX.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(E){if(!E)return;const t=E.hp,z=E._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(E.Rp&&z)for(const X of E.Rp){const E=X._drawWrappers;for(let R=0;R<E.length;R++){var A;const u=null===(A=E[R])||void 0===A?void 0:A.effect;if(!u)continue;z[R]===this&&(null===t||void 0===t||t._releaseVertexArrayObject(u),X._removeDrawWrapper(R,!0,!0))}}}else null===t||void 0===t||t._releaseVertexArrayObject(this._drawWrapper.effect);E.material!==this||E.sourceMesh||(E.material=null)}serialize(){const E=y.b.Serialize(this);return E.stencil=this.stencil.serialize(),E.uniqueId=this.uniqueId,this._serializePlugins(E),E}_serializePlugins(E){if(E.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)t.doNotSerialize||(E.plugins[t.getClassName()]=t.serialize())}static Parse(E,t,z){if(E.customType){if("BABYLON.PBRMaterial"===E.customType&&E.overloadedAlbedo&&(E.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return H.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else E.customType="BABYLON.StandardMaterial";const A=R.Tools.Instantiate(E.customType).Parse(E,t,z);return A._loadedUniqueId=E.uniqueId,A}static _ParsePlugins(E,t,z,A){if(E.plugins)for(const p in E.plugins){var X,u;const C=E.plugins[p];let Z=null===(X=t.pluginManager)||void 0===X?void 0:X.getPlugin(C.name);if(!Z){const E=R.Tools.Instantiate("BABYLON."+p);E&&(Z=new E(t))}null===(u=Z)||void 0===u||u.parse(C,z,A)}}}a.TriangleFillMode=0,a.WireFrameFillMode=1,a.PointFillMode=2,a.PointListDrawMode=3,a.LineListDrawMode=4,a.LineLoopDrawMode=5,a.LineStripDrawMode=6,a.TriangleStripDrawMode=7,a.TriangleFanDrawMode=8,a.ClockWiseSideOrientation=0,a.CounterClockWiseSideOrientation=1,a.ImageProcessingDirtyFlag=64,a.TextureDirtyFlag=1,a.LightDirtyFlag=2,a.FresnelDirtyFlag=4,a.AttributesDirtyFlag=8,a.MiscDirtyFlag=16,a.PrePassDirtyFlag=32,a.AllDirtyFlag=127,a.MATERIAL_OPAQUE=0,a.MATERIAL_ALPHATEST=1,a.MATERIAL_ALPHABLEND=2,a.MATERIAL_ALPHATESTANDBLEND=3,a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,a.MATERIAL_NORMALBLENDMETHOD_RNM=1,a.OnEventObservable=new u.b,a._AllDirtyCallBack=E=>E.markAllAsDirty(),a._ImageProcessingDirtyCallBack=E=>E.markAsImageProcessingDirty(),a._TextureDirtyCallBack=E=>E.markAsTexturesDirty(),a._FresnelDirtyCallBack=E=>E.markAsFresnelDirty(),a._MiscDirtyCallBack=E=>E.markAsMiscDirty(),a._PrePassDirtyCallBack=E=>E.markAsPrePassDirty(),a._LightsDirtyCallBack=E=>E.markAsLightDirty(),a._AttributeDirtyCallBack=E=>E.markAsAttributesDirty(),a._FresnelAndMiscDirtyCallBack=E=>{a._FresnelDirtyCallBack(E),a._MiscDirtyCallBack(E)},a._TextureAndMiscDirtyCallBack=E=>{a._TextureDirtyCallBack(E),a._MiscDirtyCallBack(E)},a._DirtyCallbackArray=[],a._RunDirtyCallBacks=E=>{for(const t of a._DirtyCallbackArray)t(E)},(0,A.b)([(0,X.K)()],a.prototype,"id",void 0),(0,A.b)([(0,X.K)()],a.prototype,"uniqueId",void 0),(0,A.b)([(0,X.K)()],a.prototype,"name",void 0),(0,A.b)([(0,X.K)()],a.prototype,"metadata",void 0),(0,A.b)([(0,X.K)()],a.prototype,"checkReadyOnEveryCall",void 0),(0,A.b)([(0,X.K)()],a.prototype,"checkReadyOnlyOnce",void 0),(0,A.b)([(0,X.K)()],a.prototype,"state",void 0),(0,A.b)([(0,X.K)("alpha")],a.prototype,"_alpha",void 0),(0,A.b)([(0,X.K)("yp")],a.prototype,"_backFaceCulling",void 0),(0,A.b)([(0,X.K)("cullBackFaces")],a.prototype,"_cullBackFaces",void 0),(0,A.b)([(0,X.K)()],a.prototype,"sideOrientation",void 0),(0,A.b)([(0,X.K)("alphaMode")],a.prototype,"_alphaMode",void 0),(0,A.b)([(0,X.K)()],a.prototype,"_needDepthPrePass",void 0),(0,A.b)([(0,X.K)()],a.prototype,"disableDepthWrite",void 0),(0,A.b)([(0,X.K)()],a.prototype,"disableColorWrite",void 0),(0,A.b)([(0,X.K)()],a.prototype,"forceDepthWrite",void 0),(0,A.b)([(0,X.K)()],a.prototype,"depthFunction",void 0),(0,A.b)([(0,X.K)()],a.prototype,"separateCullingPass",void 0),(0,A.b)([(0,X.K)("fogEnabled")],a.prototype,"_fogEnabled",void 0),(0,A.b)([(0,X.K)()],a.prototype,"pointSize",void 0),(0,A.b)([(0,X.K)()],a.prototype,"zOffset",void 0),(0,A.b)([(0,X.K)()],a.prototype,"zOffsetUnits",void 0),(0,A.b)([(0,X.K)()],a.prototype,"pointsCloud",null),(0,A.b)([(0,X.K)()],a.prototype,"fillMode",null),(0,A.b)([(0,X.K)()],a.prototype,"useLogarithmicDepth",null),(0,A.b)([(0,X.K)()],a.prototype,"transparencyMode",null)},12162:(E,t,z)=>{z.d(t,{A:()=>W,B:()=>S,C:()=>l,D:()=>y,F:()=>d,I:()=>x,M:()=>b,Q:()=>F,T:()=>L,V:()=>K,Z:()=>J,bb:()=>V,db:()=>r,e:()=>I,gb:()=>g,i:()=>h,ib:()=>O,l:()=>D,o:()=>H,r:()=>c,u:()=>a,v:()=>mE,y:()=>f});var A=z(11640),X=z(11856),R=z(11667),u=z(12108),p=z(12168);const C=X.Dt.Black(),Z={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function H(E,t,z){if(!E||E.LOGARITHMICDEPTH||E.indexOf&&E.indexOf("LOGARITHMICDEPTH")>=0){const E=z.activeCamera;1===E.mode&&A.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(E.maxZ+1)/Math.LN2))}}function h(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];z&&E.fogEnabled&&(!t||t.applyFog)&&0!==E.fogMode&&(z.setFloat4("vFogInfos",E.fogMode,E.fogStart,E.fogEnd,E.fogDensity),A?(E.fogColor.toLinearSpaceToRef(C,E.getEngine().useExactSrgbConversions),z.setColor3("vFogColor",C)):z.setColor3("vFogColor",E.fogColor))}function d(E,t,z,A,X,R,u,p,C,H){const h=E.numMaxInfluencers||E.numInfluencers;return h<=0?0:(t.push("#define MORPHTARGETS"),E.hasPositions&&t.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),E.hasNormals&&t.push("#define MORPHTARGETTEXTURE_HASNORMALS"),E.hasTangents&&t.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),E.hasUVs&&t.push("#define MORPHTARGETTEXTURE_HASUVS"),E.hasUV2s&&t.push("#define MORPHTARGETTEXTURE_HASUV2S"),E.hasColors&&t.push("#define MORPHTARGETTEXTURE_HASCOLORS"),E.supportsPositions&&X&&t.push("#define MORPHTARGETS_POSITION"),E.supportsNormals&&R&&t.push("#define MORPHTARGETS_NORMAL"),E.supportsTangents&&u&&t.push("#define MORPHTARGETS_TANGENT"),E.supportsUVs&&p&&t.push("#define MORPHTARGETS_UV"),E.supportsUV2s&&C&&t.push("#define MORPHTARGETS_UV2"),E.supportsColors&&H&&t.push("#define MORPHTARGETS_COLOR"),t.push("#define NUM_MORPH_INFLUENCERS "+h),E.isUsingTextureForTargets&&t.push("#define MORPHTARGETS_TEXTURE"),Z.NUM_MORPH_INFLUENCERS=h,Z.NORMAL=R,Z.TANGENT=u,Z.UV=p,Z.UV2=C,Z.COLOR=H,y(z,A,Z,X),h)}function y(E,t,z){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=z.NUM_MORPH_INFLUENCERS;if(u>0&&R.d.LastCreatedEngine){const p=R.d.LastCreatedEngine.getCaps().maxVertexAttribs,C=t.morphTargetManager;if(null!==C&&void 0!==C&&C.isUsingTextureForTargets)return;const Z=C&&C.supportsPositions&&X,H=C&&C.supportsNormals&&z.NORMAL,h=C&&C.supportsTangents&&z.TANGENT,d=C&&C.supportsUVs&&z.UV1,y=C&&C.supportsUV2s&&z.UV2,O=C&&C.supportsColors&&z.VERTEXCOLOR;for(let z=0;z<u;z++)Z&&E.push("position"+z),H&&E.push("normal"+z),h&&E.push("tangent"+z),d&&E.push("uv_"+z),y&&E.push("uv2_"+z),O&&E.push("color"+z),E.length>p&&A.d.Error("Cannot add more vertex attributes for mesh "+t.name)}}function O(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.push("world0"),E.push("world1"),E.push("world2"),E.push("world3"),t&&(E.push("previousWorld0"),E.push("previousWorld1"),E.push("previousWorld2"),E.push("previousWorld3"))}function c(E,t){const z=E.morphTargetManager;E&&z&&t.setFloatArray("morphTargetInfluences",z.influences)}function a(E,t){t.bindToEffect(E,"Scene")}function L(E,t,z){t._needUVs=!0,t[z]=!0,E.optimizeUVAllocation&&E.getTextureMatrix().isIdentityAs3x2()?(t[z+"DIRECTUV"]=E.coordinatesIndex+1,t["MAINUV"+(E.coordinatesIndex+1)]=!0):t[z+"DIRECTUV"]=0}function mE(E,t,z){const A=E.getTextureMatrix();t.Zp(z+"Matrix",A)}function W(E,t,z){z.BAKED_VERTEX_ANIMATION_TEXTURE&&z.INSTANCES&&E.push("bakedVertexAnimationSettingsInstanced")}function I(E,t,z){var A;if(t&&E&&(E.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(E.computeBonesUsingShaders=!1),E.useBones&&E.computeBonesUsingShaders&&E.skeleton)){const X=E.skeleton;if(X.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const z=X.getTransformMatrixTexture(E);t.setTexture("boneSampler",z),t.setFloat("boneTextureWidth",4*(X.bones.length+1))}else{const R=X.getTransformMatrices(E);R&&(t.setMatrices("mBones",R),z&&E.lE().prePassRenderer&&E.lE().prePassRenderer.getIndex(2)&&(z.previousBones[E.uniqueId]||(z.previousBones[E.uniqueId]=R.slice()),t.setMatrices("mPreviousBones",z.previousBones[E.uniqueId]),A=R,z.previousBones[E.uniqueId].set(A)))}}}function e(E,t,z,A,X){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];E._bindLight(t,z,A,X,R)}function D(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const R=Math.min(t.lightSources.length,X);for(let u=0;u<R;u++){e(t.lightSources[u],u,E,z,"boolean"===typeof A?A:A.SPECULARTERM,t.receiveShadows)}}function S(E,t,z,A){z.NUM_BONE_INFLUENCERS>0&&(A.addCPUSkinningFallback(0,t),E.push("matricesIndices"),E.push("matricesWeights"),z.NUM_BONE_INFLUENCERS>4&&(E.push("matricesIndicesExtra"),E.push("matricesWeightsExtra")))}function l(E,t){(t.INSTANCES||t.THIN_INSTANCES)&&O(E,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&E.push("instanceColor")}function f(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=0;for(let R=0;R<z&&E["LIGHT"+R];R++)R>0&&(X=A+R,t.addFallback(X,"LIGHT"+R)),E.SHADOWS||(E["SHADOW"+R]&&t.addFallback(A,"SHADOW"+R),E["SHADOWPCF"+R]&&t.addFallback(A,"SHADOWPCF"+R),E["SHADOWPCSS"+R]&&t.addFallback(A,"SHADOWPCSS"+R),E["SHADOWPOISSON"+R]&&t.addFallback(A,"SHADOWPOISSON"+R),E["SHADOWESM"+R]&&t.addFallback(A,"SHADOWESM"+R),E["SHADOWCLOSEESM"+R]&&t.addFallback(A,"SHADOWCLOSEESM"+R));return X++}function K(E,t,z,A,X,R,u){let p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];u._areMiscDirty&&(u.LOGARITHMICDEPTH=z,u.POINTSIZE=A,u.FOG=X&&function(E,t){return t.fogEnabled&&E.applyFog&&0!==t.fogMode}(E,t),u.NONUNIFORMSCALING=E.nonUniformScaling,u.ALPHATEST=R,u.DECAL_AFTER_DETAIL=p)}function F(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!z._areLightsDirty)return z._needNormals;let u=0;const p={needNormals:z._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(E.lightsEnabled&&!R)for(const Z of t.lightSources)if(B(E,t,Z,u,z,A,p),u++,u===X)break;z.SPECULARTERM=p.specularEnabled,z.SHADOWS=p.shadowEnabled;for(let Z=u;Z<X;Z++)void 0!==z["LIGHT"+Z]&&(z["LIGHT"+Z]=!1,z["HEMILIGHT"+Z]=!1,z["POINTLIGHT"+Z]=!1,z["DIRLIGHT"+Z]=!1,z["SPOTLIGHT"+Z]=!1,z["AREALIGHT"+Z]=!1,z["SHADOW"+Z]=!1,z["SHADOWCSM"+Z]=!1,z["SHADOWCSMDEBUG"+Z]=!1,z["SHADOWCSMNUM_CASCADES"+Z]=!1,z["SHADOWCSMUSESHADOWMAXZ"+Z]=!1,z["SHADOWCSMNOBLEND"+Z]=!1,z["SHADOWCSM_RIGHTHANDED"+Z]=!1,z["SHADOWPCF"+Z]=!1,z["SHADOWPCSS"+Z]=!1,z["SHADOWPOISSON"+Z]=!1,z["SHADOWESM"+Z]=!1,z["SHADOWCLOSEESM"+Z]=!1,z["SHADOWCUBE"+Z]=!1,z["SHADOWLOWQUALITY"+Z]=!1,z["SHADOWMEDIUMQUALITY"+Z]=!1);const C=E.getEngine().getCaps();return void 0===z.SHADOWFLOAT&&(p.needRebuild=!0),z.SHADOWFLOAT=p.shadowEnabled&&(C.textureFloatRender&&C.textureFloatLinearFiltering||C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering),z.LIGHTMAPEXCLUDED=p.lightmapMode,p.needRebuild&&z.rebuild(),p.needNormals}function B(E,t,z,A,X,R,p){switch(p.needNormals=!0,void 0===X["LIGHT"+A]&&(p.needRebuild=!0),X["LIGHT"+A]=!0,X["SPOTLIGHT"+A]=!1,X["HEMILIGHT"+A]=!1,X["POINTLIGHT"+A]=!1,X["DIRLIGHT"+A]=!1,X["AREALIGHT"+A]=!1,z.prepareLightSpecificDefines(X,A),X["LIGHT_FALLOFF_PHYSICAL"+A]=!1,X["LIGHT_FALLOFF_GLTF"+A]=!1,X["LIGHT_FALLOFF_STANDARD"+A]=!1,z.falloffType){case u.e.FALLOFF_GLTF:X["LIGHT_FALLOFF_GLTF"+A]=!0;break;case u.e.FALLOFF_PHYSICAL:X["LIGHT_FALLOFF_PHYSICAL"+A]=!0;break;case u.e.FALLOFF_STANDARD:X["LIGHT_FALLOFF_STANDARD"+A]=!0}if(R&&!z.uH.equalsFloats(0,0,0)&&(p.specularEnabled=!0),X["SHADOW"+A]=!1,X["SHADOWCSM"+A]=!1,X["SHADOWCSMDEBUG"+A]=!1,X["SHADOWCSMNUM_CASCADES"+A]=!1,X["SHADOWCSMUSESHADOWMAXZ"+A]=!1,X["SHADOWCSMNOBLEND"+A]=!1,X["SHADOWCSM_RIGHTHANDED"+A]=!1,X["SHADOWPCF"+A]=!1,X["SHADOWPCSS"+A]=!1,X["SHADOWPOISSON"+A]=!1,X["SHADOWESM"+A]=!1,X["SHADOWCLOSEESM"+A]=!1,X["SHADOWCUBE"+A]=!1,X["SHADOWLOWQUALITY"+A]=!1,X["SHADOWMEDIUMQUALITY"+A]=!1,t&&t.receiveShadows&&E.shadowsEnabled&&z.shadowEnabled){const t=z.getShadowGenerator(E.activeCamera)??z.getShadowGenerator();if(t){const E=t.getShadowMap();E&&E.renderList&&E.renderList.length>0&&(p.shadowEnabled=!0,t.prepareDefines(X,A))}}z.lightmapMode!=u.e.LIGHTMAP_DEFAULT?(p.lightmapMode=!0,X["LIGHTMAPEXCLUDED"+A]=!0,X["LIGHTMAPNOSPECULAR"+A]=z.lightmapMode==u.e.LIGHTMAP_SHADOWSONLY):(X["LIGHTMAPEXCLUDED"+A]=!1,X["LIGHTMAPNOSPECULAR"+A]=!1)}function b(E,t,z,A,X){let R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=function(E,t){let z=!1;if(E.activeCamera){const A=t.CAMERA_ORTHOGRAPHIC?1:0,X=t.CAMERA_PERSPECTIVE?1:0,R=1===E.activeCamera.mode?1:0,u=0===E.activeCamera.mode?1:0;(A^R||X^u)&&(t.CAMERA_ORTHOGRAPHIC=1===R,t.CAMERA_PERSPECTIVE=1===u,z=!0)}return z}(E,A);!1!==R&&(C=(0,p.h)(z,E,A)),A.DEPTHPREPASS!==!t.getColorWrite()&&(A.DEPTHPREPASS=!A.DEPTHPREPASS,C=!0),A.INSTANCES!==X&&(A.INSTANCES=X,C=!0),A.THIN_INSTANCES!==u&&(A.THIN_INSTANCES=u,C=!0),C&&A.markAsUnprocessed()}function x(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&E.isVerticesDataPresent("normal"),t._needNormals&&E.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let p=1;p<=6;++p)t["UV"+p]=!!t._needUVs&&E.isVerticesDataPresent(`uv${1===p?"":p}`);if(z){const z=E.useVertexColors&&E.isVerticesDataPresent("color");t.VERTEXCOLOR=z,t.VERTEXALPHA=E.hasVertexAlpha&&z&&R}return E.isVerticesDataPresent("instanceColor")&&(E.hasInstances||E.hasThinInstances)&&(t.INSTANCESCOLOR=!0),A&&function(E,t){if(E.useBones&&E.computeBonesUsingShaders&&E.skeleton){t.NUM_BONE_INFLUENCERS=E.numBoneInfluencers;const z=void 0!==t.BONETEXTURE;if(E.skeleton.isUsingTextureForMatrices&&z)t.BONETEXTURE=!0;else{t.BonesPerMesh=E.skeleton.bones.length+1,t.BONETEXTURE=!z&&void 0;const A=E.lE().prePassRenderer;if(A&&A.enabled){const z=-1===A.excludedSkinnedMesh.indexOf(E);t.BONES_VELOCITY_ENABLED=z}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}(E,t),X&&function(E,t){const z=E.morphTargetManager;z?(t.MORPHTARGETS_UV=z.supportsUVs&&t.UV1,t.MORPHTARGETS_UV2=z.supportsUV2s&&t.UV2,t.MORPHTARGETS_TANGENT=z.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=z.supportsNormals&&t.NORMAL,t.MORPHTARGETS_POSITION=z.supportsPositions,t.MORPHTARGETS_COLOR=z.supportsColors,t.MORPHTARGETTEXTURE_HASUVS=z.hasUVs,t.MORPHTARGETTEXTURE_HASUV2S=z.hasUV2s,t.MORPHTARGETTEXTURE_HASTANGENTS=z.hasTangents,t.MORPHTARGETTEXTURE_HASNORMALS=z.hasNormals,t.MORPHTARGETTEXTURE_HASPOSITIONS=z.hasPositions,t.MORPHTARGETTEXTURE_HASCOLORS=z.hasColors,t.NUM_MORPH_INFLUENCERS=z.numMaxInfluencers||z.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=z.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_UV2=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_POSITION=!1,t.MORPHTARGETS_COLOR=!1,t.MORPHTARGETTEXTURE_HASUVS=!1,t.MORPHTARGETTEXTURE_HASUV2S=!1,t.MORPHTARGETTEXTURE_HASTANGENTS=!1,t.MORPHTARGETTEXTURE_HASNORMALS=!1,t.MORPHTARGETTEXTURE_HASPOSITIONS=!1,t.MORPHTARGETTEXTURE_HAS_COLORS=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}(E,t),u&&function(E,t){const z=E.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!z||!z.isEnabled)}(E,t),!0}function J(E,t){if(E.activeCamera){const z=t.MULTIVIEW;t.MULTIVIEW=null!==E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=z&&t.markAsUnprocessed()}}function V(E,t,z){const A=t.ORDER_INDEPENDENT_TRANSPARENCY,X=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=E.useOrderIndependentTransparency&&z,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!E.getEngine().getCaps().textureFloatLinearFiltering,A===t.ORDER_INDEPENDENT_TRANSPARENCY&&X===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function r(E,t,z){const A=t.PREPASS;if(!t._arePrePassDirty)return;const X=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(E.prePassRenderer&&E.prePassRenderer.enabled&&z){t.PREPASS=!0,t.SCENE_MRT_COUNT=E.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=E.prePassRenderer.generateNormalsInWorldSpace,t.PREPASS_COLOR=!0,t.PREPASS_COLOR_INDEX=0;for(let z=0;z<X.length;z++){const A=E.prePassRenderer.getIndex(X[z].type);-1!==A?(t[X[z].define]=!0,t[X[z].index]=A):t[X[z].define]=!1}}else{t.PREPASS=!1;for(let E=0;E<X.length;E++)t[X[E].define]=!1}t.PREPASS!=A&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function i(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];X&&X.push("Light"+E),R||(t.push("vLightData"+E,"vLightDiffuse"+E,"vLightSpecular"+E,"vLightDirection"+E,"vLightWidth"+E,"vLightHeight"+E,"vLightFalloff"+E,"vLightGround"+E,"lightMatrix"+E,"shadowsInfo"+E,"depthValues"+E),z.push("shadowTexture"+E),z.push("depthTexture"+E),t.push("viewFrustumZ"+E,"cascadeBlendFactor"+E,"lightSizeUVCorrection"+E,"depthCorrection"+E,"penumbraDarkness"+E,"frustumLengths"+E),A&&(z.push("projectionLightTexture"+E),t.push("textureProjectionMatrix"+E)),u&&z.push("iesLightTexture"+E))}function g(E,t,z){let A,X,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(E.uniformsNames){const u=E;A=u.uniformsNames,X=u.uniformBuffersNames,t=u.samplers,z=u.defines,R=u.maxSimultaneousLights||0}else A=E,t||(t=[]);for(let u=0;u<R&&z["LIGHT"+u];u++)i(u,A,t,z["PROJECTEDLIGHTTEXTURE"+u],X,!1,z["IESLIGHTTEXTURE"+u]);z.NUM_MORPH_INFLUENCERS&&(A.push("morphTargetInfluences"),A.push("morphTargetCount")),z.BAKED_VERTEX_ANIMATION_TEXTURE&&(A.push("bakedVertexAnimationSettings"),A.push("bakedVertexAnimationTextureSizeInverted"),A.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},12116:(E,t,z)=>{z.d(t,{c:()=>R});var A=z(11812),X=z(12121);class R extends X.b{constructor(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(E,t,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new A.Matrix,this._storeEffectOnSubMeshes=z}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(E,t){return!!E&&(!this._storeEffectOnSubMeshes||(!E.Rp||0===E.Rp.length||this.isReadyForSubMesh(E,E.Rp[0],t)))}_isReadyForSubMesh(E){const t=E.materialDefines;return!(this.checkReadyOnEveryCall||!E.effect||!t||t._renderId!==this.lE().getRenderId())}bindOnlyWorldMatrix(E){this._activeEffect.setMatrix("world",E)}bindOnlyNormalMatrix(E){this._activeEffect.setMatrix("normalMatrix",E)}bind(E,t){t&&this.bindForSubMesh(E,t,t.Rp[0])}_afterBind(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0;super._afterBind(E,t,z),this.lE()._cachedEffect=t,z?z._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return z._drawWrapper._forceRebindOnNextCall||E.isCachedMaterialInvalid(this,t,A)}dispose(E,t,z){this._activeEffect=void 0,super.dispose(E,t,z)}}},12157:(E,t,z)=>{z.d(t,{b:()=>p,e:()=>C});var A=z(11792),X=z(11812),R=z(11801);class u{static extractMinAndMaxIndexed(E,t,z,A,X,R){for(let u=z;u<z+A;u++){const z=3*t[u],A=E[z],p=E[z+1],C=E[z+2];X.minimizeInPlaceFromFloats(A,p,C),R.maximizeInPlaceFromFloats(A,p,C)}}static extractMinAndMax(E,t,z,A,X,R){for(let u=t,p=t*A;u<t+z;u++,p+=A){const t=E[p],z=E[p+1],A=E[p+2];X.minimizeInPlaceFromFloats(t,z,A),R.maximizeInPlaceFromFloats(t,z,A)}}}function p(E,t,z,A){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const p=new X.Lt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new X.Lt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u.extractMinAndMaxIndexed(E,t,z,A,p,C),R&&(p.x-=p.x*R.x+R.y,p.y-=p.y*R.x+R.y,p.z-=p.z*R.x+R.y,C.x+=C.x*R.x+R.y,C.y+=C.y*R.x+R.y,C.z+=C.z*R.x+R.y),{minimum:p,maximum:C}}function C(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;const p=new X.Lt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new X.Lt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return R||(R=3),u.extractMinAndMax(E,t,z,R,p,C),A&&(p.x-=p.x*A.x+A.y,p.y-=p.y*A.x+A.y,p.z-=p.z*A.x+A.y,C.x+=C.x*A.x+A.y,C.y+=C.y*A.x+A.y,C.z+=C.z*A.x+A.y),{minimum:p,maximum:C}}(0,A.b)([R.d.filter((function(){for(var E=arguments.length,t=new Array(E),z=0;z<E;z++)t[z]=arguments[z];let[A,X]=t;return!Array.isArray(A)&&!Array.isArray(X)}))],u,"extractMinAndMaxIndexed",null),(0,A.b)([R.d.filter((function(){for(var E=arguments.length,t=new Array(E),z=0;z<E;z++)t[z]=arguments[z];let[A]=t;return!Array.isArray(A)}))],u,"extractMinAndMax",null)},12128:(E,t,z)=>{z.d(t,{d:()=>C});var A=z(11894),X=z(12132),R=z(12139),u=z(12157),p=z(11951);class C{get materialDefines(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(E=this._getDrawWrapper())||void 0===E?void 0:E.defines}set materialDefines(E){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=E}_getDrawWrapper(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E??this._engine.currentRenderPassId;let z=this._drawWrappers[E];return!z&&t&&(this._drawWrappers[E]=z=new p.b(this._mesh.lE().getEngine())),z}_removeDrawWrapper(E){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var z;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(z=this._drawWrappers[E])||void 0===z||z.dispose(t));this._drawWrappers[E]=void 0}get effect(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(E=this._getDrawWrapper())||void 0===E?void 0:E.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(E){this._mainDrawWrapperOverride=E}setEffect(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const X=this._drawWrapper;X.setEffect(E,t,A),void 0!==z&&(X.materialContext=z),E||(X.defines=null,X.materialContext=void 0)}resetDrawCache(E){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==E)return void this._removeDrawWrapper(E,!0,t);for(const E of this._drawWrappers)null===E||void 0===E||E.dispose(t)}this._drawWrappers=[]}static AddToMesh(E,t,z,A,X,R,u){return new C(E,t,z,A,X,R,u,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(E,t,z,A,X,R,u){let p=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],C=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=E,this.verticesStart=t,this.verticesCount=z,this.indexStart=A,this.indexCount=X,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=R,this._renderingMesh=u||R,C&&R.Rp.push(this),this._engine=this._mesh.lE().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=R.Rp.length-1,p&&(this.refreshBoundingInfo(),R.Hp(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(E){return this._boundingInfo=E,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const E=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return E||this._renderingMesh}oE(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return E&&this._mesh.lE()._hasDefaultMaterial?this._mesh.lE().defaultMaterial:null;if(this._isMultiMaterial(t)){const E=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==E&&(this._currentMaterial=E,this.resetDrawCache()),E}return t}_isMultiMaterial(E){return void 0!==E.getSubMaterial}refreshBoundingInfo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.hp)return this;if(E||(E=this._renderingMesh.getVerticesData(A.f.PositionKind)),!E)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const t=this._renderingMesh.dp();let z;if(0===this.indexStart&&this.indexCount===t.length){const E=this._renderingMesh.getBoundingInfo();z={minimum:E.minimum.clone(),maximum:E.maximum.clone()}}else z=(0,u.b)(E,t,this.indexStart,this.indexCount,this._renderingMesh.hp.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(z.minimum,z.maximum):this._boundingInfo=new R.c(z.minimum,z.maximum),this}_checkCollision(E){return this.getBoundingInfo()._checkCollision(E)}updateBoundingInfo(E){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(E),this}isInFrustum(E){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(E,this._mesh.Zh)}isCompletelyInFrustum(E){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(E)}render(E){return this._renderingMesh.render(this,E,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(E,t){if(!this._linesIndexBuffer){const z=6*Math.floor(this.indexCount/3),A=this.verticesStart+this.verticesCount>65535?new Uint32Array(z):new Uint16Array(z);let X=0;if(0===E.length)for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)A[X++]=E,A[X++]=E+1,A[X++]=E+1,A[X++]=E+2,A[X++]=E+2,A[X++]=E;else for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)A[X++]=E[t],A[X++]=E[t+1],A[X++]=E[t+1],A[X++]=E[t+2],A[X++]=E[t+2],A[X++]=E[t];this._linesIndexBuffer=t.createIndexBuffer(A),this._linesIndexCount=A.length}return this._linesIndexBuffer}canIntersects(E){const t=this.getBoundingInfo();return!!t&&E.intersectsBox(t.boundingBox)}intersects(E,t,z,A,X){const R=this.oE();if(!R)return null;let u=3,p=!1;switch(R.fillMode){case 3:case 5:case 6:case 8:return null;case 7:u=1,p=!0}return 4===R.fillMode?z.length?this._intersectLines(E,t,z,this._mesh.intersectionThreshold,A):this._intersectUnIndexedLines(E,t,z,this._mesh.intersectionThreshold,A):!z.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(E,t,z,A,X):this._intersectTriangles(E,t,z,u,p,A,X)}_intersectLines(E,t,z,A,R){let u=null;for(let p=this.indexStart;p<this.indexStart+this.indexCount;p+=2){const C=t[z[p]],Z=t[z[p+1]],H=E.intersectionSegment(C,Z,A);if(!(H<0)&&((R||!u||H<u.distance)&&(u=new X.e(null,null,H),u.faceId=p/2,R)))break}return u}_intersectUnIndexedLines(E,t,z,A,R){let u=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=2){const z=t[p],C=t[p+1],Z=E.intersectionSegment(z,C,A);if(!(Z<0)&&((R||!u||Z<u.distance)&&(u=new X.e(null,null,Z),u.faceId=p/2,R)))break}return u}_intersectTriangles(E,t,z,A,X,R,u){let p=null,C=-1;for(let Z=this.indexStart;Z<this.indexStart+this.indexCount-(3-A);Z+=A){C++;const A=z[Z],H=z[Z+1],h=z[Z+2];if(X&&4294967295===h){Z+=2;continue}const d=t[A],y=t[H],O=t[h];if(!d||!y||!O)continue;if(u&&!u(d,y,O,E,A,H,h))continue;const c=E.intersectsTriangle(d,y,O);if(c){if(c.distance<0)continue;if((R||!p||c.distance<p.distance)&&(p=c,p.faceId=C,R))break}}return p}_intersectUnIndexedTriangles(E,t,z,A,X){let R=null;for(let u=this.verticesStart;u<this.verticesStart+this.verticesCount;u+=3){const z=t[u],p=t[u+1],C=t[u+2];if(X&&!X(z,p,C,E,-1,-1,-1))continue;const Z=E.intersectsTriangle(z,p,C);if(Z){if(Z.distance<0)continue;if((A||!R||Z.distance<R.distance)&&(R=Z,R.faceId=u/3,A))break}}return R}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(E,t){const z=new C(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,E,t,!1);if(!this.IsGlobal){const E=this.getBoundingInfo();if(!E)return z;z._boundingInfo=new R.c(E.minimum,E.maximum)}return z}dispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.lE().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const t=this._mesh.Rp.indexOf(this);this._mesh.Rp.splice(t,1),this.resetDrawCache(void 0,E)}getClassName(){return"SubMesh"}static CreateFromIndices(E,t,z,A,X){let R=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=Number.MAX_VALUE,p=-Number.MAX_VALUE;const Z=(X||A).dp();for(let C=t;C<t+z;C++){const E=Z[C];E<u&&(u=E),E>p&&(p=E)}return new C(E,u,p-u+1,t,z,A,X,R)}}}}]);