"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[24],{12736:(E,H,d)=>{d.d(H,{d:()=>n});class n{constructor(E,H,d){this.bu=E,this.bv=H,this.distance=d,this.faceId=0,this.subMeshId=0}}},12746:(E,H,d)=>{d.d(H,{b:()=>g});var n=d(12399),Z=d(12384),I=d(12391);class g{constructor(E,H,d){this.vectors=(0,n.e)(8,Z.wH.Zero),this.center=Z.wH.Zero(),this.centerWorld=Z.wH.Zero(),this.extendSize=Z.wH.Zero(),this.extendSizeWorld=Z.wH.Zero(),this.directions=(0,n.e)(3,Z.wH.Zero),this.vectorsWorld=(0,n.e)(8,Z.wH.Zero),this.minimumWorld=Z.wH.Zero(),this.maximumWorld=Z.wH.Zero(),this.minimum=Z.wH.Zero(),this.maximum=Z.wH.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(E,H,d)}reConstruct(E,H,d){const n=E.x,I=E.y,g=E.z,l=H.x,r=H.y,t=H.z,S=this.vectors;this.minimum.en(n,I,g),this.maximum.en(l,r,t),S[0].en(n,I,g),S[1].en(l,r,t),S[2].en(l,I,g),S[3].en(n,r,g),S[4].en(n,I,t),S[5].en(l,r,g),S[6].en(n,r,t),S[7].en(l,I,t),H.addToRef(E,this.center).scaleInPlace(.5),H.subtractToRef(E,this.extendSize).scaleInPlace(.5),this._worldMatrix=d||Z.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(E){const H=g._TmpVector3,d=this.maximum.subtractToRef(this.minimum,H[0]),n=d.length();d.normalizeFromLength(n);const Z=n*E,I=d.scaleInPlace(.5*Z),l=this.center.subtractToRef(I,H[1]),r=this.center.addToRef(I,H[2]);return this.reConstruct(l,r,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){const H=this.minimumWorld,d=this.maximumWorld,n=this.directions,I=this.vectorsWorld,g=this.vectors;if(E.isIdentity()){H.l(this.minimum),d.l(this.maximum);for(let E=0;E<8;++E)I[E].l(g[E]);this.extendSizeWorld.l(this.extendSize),this.centerWorld.l(this.center)}else{H.ng(Number.MAX_VALUE),d.ng(-Number.MAX_VALUE);for(let n=0;n<8;++n){const l=I[n];Z.wH.TransformCoordinatesToRef(g[n],E,l),H.minimizeInPlace(l),d.maximizeInPlace(l)}d.subtractToRef(H,this.extendSizeWorld).scaleInPlace(.5),d.addToRef(H,this.centerWorld).scaleInPlace(.5)}Z.wH.FromArrayToRef(E.m,0,n[0]),Z.wH.FromArrayToRef(E.m,4,n[1]),Z.wH.FromArrayToRef(E.m,8,n[2]),this._worldMatrix=E}isInFrustum(E){return g.IsInFrustum(this.vectorsWorld,E)}isCompletelyInFrustum(E){return g.IsCompletelyInFrustum(this.vectorsWorld,E)}intersectsPoint(E){const H=this.minimumWorld,d=this.maximumWorld,n=H.x,Z=H.y,g=H.z,l=d.x,r=d.y,t=d.z,S=E.x,M=E.y,V=E.z,C=-I.c;return!(l-S<C||C>S-n)&&(!(r-M<C||C>M-Z)&&!(t-V<C||C>V-g))}intersectsSphere(E){return g.IntersectsSphere(this.minimumWorld,this.maximumWorld,E.centerWorld,E.radiusWorld)}intersectsMinMax(E,H){const d=this.minimumWorld,n=this.maximumWorld,Z=d.x,I=d.y,g=d.z,l=n.x,r=n.y,t=n.z,S=E.x,M=E.y,V=E.z,C=H.x,w=H.y,R=H.z;return!(l<S||Z>C)&&(!(r<M||I>w)&&!(t<V||g>R))}dispose(){var E,H;null===(E=this._drawWrapperFront)||void 0===E||E.dispose(),null===(H=this._drawWrapperBack)||void 0===H||H.dispose()}static Intersects(E,H){return E.intersectsMinMax(H.minimumWorld,H.maximumWorld)}static IntersectsSphere(E,H,d,n){const I=g._TmpVector3[0];Z.wH.ClampToRef(d,E,H,I);return Z.wH.DistanceSquared(d,I)<=n*n}static IsCompletelyInFrustum(E,H){for(let d=0;d<6;++d){const n=H[d];for(let H=0;H<8;++H)if(n.dotCoordinate(E[H])<0)return!1}return!0}static IsInFrustum(E,H){for(let d=0;d<6;++d){let n=!0;const Z=H[d];for(let H=0;H<8;++H)if(Z.dotCoordinate(E[H])>=0){n=!1;break}if(n)return!1}return!0}}g._TmpVector3=(0,n.e)(3,Z.wH.Zero)},12738:(E,H,d)=>{d.d(H,{e:()=>M});var n=d(12399),Z=d(12384),I=d(12746),g=d(12748);const l={min:0,max:0},r={min:0,max:0},t=(E,H,d)=>{const n=Z.wH.Dot(H.centerWorld,E),I=Math.abs(Z.wH.Dot(H.directions[0],E))*H.extendSize.x+Math.abs(Z.wH.Dot(H.directions[1],E))*H.extendSize.y+Math.abs(Z.wH.Dot(H.directions[2],E))*H.extendSize.z;d.min=n-I,d.max=n+I},S=(E,H,d)=>(t(E,H,l),t(E,d,r),!(l.min>r.max||r.min>l.max));class M{constructor(E,H,d){this._isLocked=!1,this.boundingBox=new I.b(E,H,d),this.boundingSphere=new g.b(E,H,d)}reConstruct(E,H,d){this.boundingBox.reConstruct(E,H,d),this.boundingSphere.reConstruct(E,H,d)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(E){this._isLocked=E}update(E){this._isLocked||(this.boundingBox._update(E),this.boundingSphere._update(E))}centerOn(E,H){const d=M._TmpVector3[0].l(E).MM(H),n=M._TmpVector3[1].l(E).addInPlace(H);return this.boundingBox.reConstruct(d,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(d,n,this.boundingBox.getWorldMatrix()),this}encapsulate(E){const H=Z.wH.Minimize(this.minimum,E),d=Z.wH.Maximize(this.maximum,E);return this.reConstruct(H,d,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(E){const H=Z.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(H);const d=Z.TmpVectors.wH[0];return Z.wH.TransformCoordinatesToRef(E.boundingBox.minimumWorld,H,d),this.encapsulate(d),Z.wH.TransformCoordinatesToRef(E.boundingBox.maximumWorld,H,d),this.encapsulate(d),this}scale(E){return this.boundingBox.scale(E),this.boundingSphere.scale(E),this}isInFrustum(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===H||3===H)&&this.boundingSphere.isCenterInFrustum(E))return!0;if(!this.boundingSphere.isInFrustum(E))return!1;return!(1!==H&&3!==H)||this.boundingBox.isInFrustum(E)}get diagonalLength(){const E=this.boundingBox;return E.maximumWorld.subtractToRef(E.minimumWorld,M._TmpVector3[0]).length()}isCompletelyInFrustum(E){return this.boundingBox.isCompletelyInFrustum(E)}_checkCollision(E){return E._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(E){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(E)&&!!this.boundingBox.intersectsPoint(E))}intersects(E,H){if(!g.b.Intersects(this.boundingSphere,E.boundingSphere))return!1;if(!I.b.Intersects(this.boundingBox,E.boundingBox))return!1;if(!H)return!0;const d=this.boundingBox,n=E.boundingBox;return!!S(d.directions[0],d,n)&&(!!S(d.directions[1],d,n)&&(!!S(d.directions[2],d,n)&&(!!S(n.directions[0],d,n)&&(!!S(n.directions[1],d,n)&&(!!S(n.directions[2],d,n)&&(!!S(Z.wH.Cross(d.directions[0],n.directions[0]),d,n)&&(!!S(Z.wH.Cross(d.directions[0],n.directions[1]),d,n)&&(!!S(Z.wH.Cross(d.directions[0],n.directions[2]),d,n)&&(!!S(Z.wH.Cross(d.directions[1],n.directions[0]),d,n)&&(!!S(Z.wH.Cross(d.directions[1],n.directions[1]),d,n)&&(!!S(Z.wH.Cross(d.directions[1],n.directions[2]),d,n)&&(!!S(Z.wH.Cross(d.directions[2],n.directions[0]),d,n)&&(!!S(Z.wH.Cross(d.directions[2],n.directions[1]),d,n)&&!!S(Z.wH.Cross(d.directions[2],n.directions[2]),d,n))))))))))))))}}M._TmpVector3=(0,n.e)(2,Z.wH.Zero)},12748:(E,H,d)=>{d.d(H,{b:()=>I});var n=d(12399),Z=d(12384);class I{constructor(E,H,d){this.center=Z.wH.Zero(),this.centerWorld=Z.wH.Zero(),this.minimum=Z.wH.Zero(),this.maximum=Z.wH.Zero(),this.reConstruct(E,H,d)}reConstruct(E,H,d){this.minimum.l(E),this.maximum.l(H);const n=Z.wH.Distance(E,H);H.addToRef(E,this.center).scaleInPlace(.5),this.radius=.5*n,this._update(d||Z.Matrix.IdentityReadOnly)}scale(E){const H=this.radius*E,d=I._TmpVector3,n=d[0].ng(H),Z=this.center.subtractToRef(n,d[1]),g=this.center.addToRef(n,d[2]);return this.reConstruct(Z,g,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){if(E.isIdentity())this.centerWorld.l(this.center),this.radiusWorld=this.radius;else{Z.wH.TransformCoordinatesToRef(this.center,E,this.centerWorld);const H=I._TmpVector3[0];Z.wH.TransformNormalFromFloatsToRef(1,1,1,E,H),this.radiusWorld=Math.max(Math.abs(H.x),Math.abs(H.y),Math.abs(H.z))*this.radius}}isInFrustum(E){const H=this.centerWorld,d=this.radiusWorld;for(let n=0;n<6;n++)if(E[n].dotCoordinate(H)<=-d)return!1;return!0}isCenterInFrustum(E){const H=this.centerWorld;for(let d=0;d<6;d++)if(E[d].dotCoordinate(H)<0)return!1;return!0}intersectsPoint(E){const H=Z.wH.DistanceSquared(this.centerWorld,E);return!(this.radiusWorld*this.radiusWorld<H)}static Intersects(E,H){const d=Z.wH.DistanceSquared(E.centerWorld,H.centerWorld),n=E.radiusWorld+H.radiusWorld;return!(n*n<d)}static CreateFromCenterAndRadius(E,H,d){this._TmpVector3[0].l(E),this._TmpVector3[1].en(0,0,H),this._TmpVector3[2].l(E),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].MM(this._TmpVector3[1]);const n=new I(this._TmpVector3[0],this._TmpVector3[2]);return n._worldMatrix=d||Z.Matrix.Identity(),n}}I._TmpVector3=(0,n.e)(3,Z.wH.Zero)},12768:(E,H,d)=>{function n(E){-1===E.indexOf("vClipPlane")&&E.push("vClipPlane"),-1===E.indexOf("vClipPlane2")&&E.push("vClipPlane2"),-1===E.indexOf("vClipPlane3")&&E.push("vClipPlane3"),-1===E.indexOf("vClipPlane4")&&E.push("vClipPlane4"),-1===E.indexOf("vClipPlane5")&&E.push("vClipPlane5"),-1===E.indexOf("vClipPlane6")&&E.push("vClipPlane6")}function Z(E,H,d){const n=!!(E.clipPlane??H.clipPlane),Z=!!(E.clipPlane2??H.clipPlane2),I=!!(E.clipPlane3??H.clipPlane3),g=!!(E.clipPlane4??H.clipPlane4),l=!!(E.clipPlane5??H.clipPlane5),r=!!(E.clipPlane6??H.clipPlane6);n&&d.push("#define CLIPPLANE"),Z&&d.push("#define CLIPPLANE2"),I&&d.push("#define CLIPPLANE3"),g&&d.push("#define CLIPPLANE4"),l&&d.push("#define CLIPPLANE5"),r&&d.push("#define CLIPPLANE6")}function I(E,H,d){let n=!1;const Z=!!(E.clipPlane??H.clipPlane),I=!!(E.clipPlane2??H.clipPlane2),g=!!(E.clipPlane3??H.clipPlane3),l=!!(E.clipPlane4??H.clipPlane4),r=!!(E.clipPlane5??H.clipPlane5),t=!!(E.clipPlane6??H.clipPlane6);return d.CLIPPLANE!==Z&&(d.CLIPPLANE=Z,n=!0),d.CLIPPLANE2!==I&&(d.CLIPPLANE2=I,n=!0),d.CLIPPLANE3!==g&&(d.CLIPPLANE3=g,n=!0),d.CLIPPLANE4!==l&&(d.CLIPPLANE4=l,n=!0),d.CLIPPLANE5!==r&&(d.CLIPPLANE5=r,n=!0),d.CLIPPLANE6!==t&&(d.CLIPPLANE6=t,n=!0),n}function g(E,H,d){let n=H.clipPlane??d.clipPlane;l(E,"vClipPlane",n),n=H.clipPlane2??d.clipPlane2,l(E,"vClipPlane2",n),n=H.clipPlane3??d.clipPlane3,l(E,"vClipPlane3",n),n=H.clipPlane4??d.clipPlane4,l(E,"vClipPlane4",n),n=H.clipPlane5??d.clipPlane5,l(E,"vClipPlane5",n),n=H.clipPlane6??d.clipPlane6,l(E,"vClipPlane6",n)}function l(E,H,d){d&&E.setFloat4(H,d.normal.x,d.normal.y,d.normal.z,d.d)}d.d(H,{e:()=>n,f:()=>g,j:()=>I,m:()=>Z})},12712:(E,H,d)=>{d.d(H,{c:()=>n});class n{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(E,H){this._defines[E]||(E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E),this._defines[E]=new Array),this._defines[E].push(H)}addCPUSkinningFallback(E,H){this._mesh=H,E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(E,H){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,E=E.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),H._bonesComputationForcedToCPU=!0;const d=this._mesh.fE();for(let E=0;E<d.meshes.length;E++){const n=d.meshes[E];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===H)n.computeBonesUsingShaders=!1;else if(n.od)for(const E of n.od){if(E.effect===H){n.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&n.computeBonesUsingShaders&&n.numBoneInfluencers>0&&(n.computeBonesUsingShaders=!1)}}else{const H=this._defines[this._currentRank];if(H)for(let d=0;d<H.length;d++)E=E.replace("#define "+H[d],"");this._currentRank++}return E}}},12729:(E,H,d)=>{d.d(H,{b:()=>Q});var n=d(12369),Z=d(12372),I=d(12228),g=d(12230),l=d(12268),r=d(12733),t=d(12656),S=d(12237),M=d(12439),V=d(12516),C=d(12428);class w{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(E){this._func=E}get funcRef(){return this._funcRef}set funcRef(E){this._funcRef=E}get funcMask(){return this._funcMask}set funcMask(E){this._funcMask=E}get opStencilFail(){return this._opStencilFail}set opStencilFail(E){this._opStencilFail=E}get opDepthFail(){return this._opDepthFail}set opDepthFail(E){this._opDepthFail=E}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(E){this._opStencilDepthPass=E}get mask(){return this._mask}set mask(E){this._mask=E}get enabled(){return this._enabled}set enabled(E){this._enabled=E}getClassName(){return"MaterialStencilState"}copyTo(E){C.c.Clone((()=>E),this)}serialize(){return C.c.Serialize(this)}parse(E,H,d){C.c.Parse((()=>this),E,H,d)}}(0,n.e)([(0,Z.K)()],w.prototype,"func",null),(0,n.e)([(0,Z.K)()],w.prototype,"funcRef",null),(0,n.e)([(0,Z.K)()],w.prototype,"funcMask",null),(0,n.e)([(0,Z.K)()],w.prototype,"opStencilFail",null),(0,n.e)([(0,Z.K)()],w.prototype,"opDepthFail",null),(0,n.e)([(0,Z.K)()],w.prototype,"opStencilDepthPass",null),(0,n.e)([(0,Z.K)()],w.prototype,"mask",null),(0,n.e)([(0,Z.K)()],w.prototype,"enabled",null);var R=d(12763);class Q{get _supportGlowLayer(){return!1}set _glowModeEnabled(E){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(E){if(this._alpha===E)return;const H=this._alpha;this._alpha=E,1!==H&&1!==E||this.HS(Q.MiscDirtyFlag+Q.PrePassDirtyFlag)}get alpha(){return this._alpha}set ln(E){this._backFaceCulling!==E&&(this._backFaceCulling=E,this.HS(Q.TextureDirtyFlag))}get ln(){return this._backFaceCulling}set cullBackFaces(E){this._cullBackFaces!==E&&(this._cullBackFaces=E,this.HS(Q.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(E){this._blockDirtyMechanism!==E&&(this._blockDirtyMechanism=E,E||this.BM())}atomicMaterialsUpdate(E){this.blockDirtyMechanism=!0;try{E(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(E){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(E)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new g.e),this._onBindObservable}set onBind(E){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(E)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new g.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new g.e),this._onEffectCreatedObservable}set alphaMode(E){this._alphaMode!==E&&(this._alphaMode=E,this.HS(Q.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(E){this._needDepthPrePass!==E&&(this._needDepthPrePass=E,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(E){this._fogEnabled!==E&&(this._fogEnabled=E,this.HS(Q.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case Q.WireFrameFillMode:case Q.LineListDrawMode:case Q.LineLoopDrawMode:case Q.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(E){this.fillMode=E?Q.WireFrameFillMode:Q.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case Q.PointFillMode:case Q.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(E){this.fillMode=E?Q.PointFillMode:Q.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(E){this._fillMode!==E&&(this._fillMode=E,this.HS(Q.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){const H=this.fE().getEngine().getCaps().fragmentDepthSupported;E&&!H&&S.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=E&&H,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(E){this._drawWrapper=E}constructor(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Qd=new g.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.ed=new w,this._useUBO=!1,this._fillMode=Q.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=E;const Z=H||l.b.LastCreatedScene;Z&&(this._scene=Z,this._dirtyCallbacks={},this._forceGLSL=n,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=E||I.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new V.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new t.c(this._scene.getEngine(),void 0,void 0,E),this._useUBO=this.fE().getEngine().supportsUniformBuffers,this._createUniformBuffer(),d||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),Q.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var E;const H=this.fE().getEngine();null===(E=this._uniformBuffer)||void 0===E||E.dispose(),H.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new t.c(H,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new t.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(E){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.BM(),this.checkReadyOnlyOnce=!0}unfreeze(){this.BM(),this.checkReadyOnlyOnce=!1}isReady(E,H){return!0}isReadyForSubMesh(E,H,d){const n=H.materialDefines;return!!n&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=n,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}fE(){return this._scene}_getEffectiveOrientation(E){return null!==this.sideOrientation?this.sideOrientation:E.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(E){this._transparencyMode!==E&&(this._transparencyMode=E,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===Q.MATERIAL_ALPHABLEND||this._transparencyMode===Q.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===Q.MATERIAL_ALPHATEST||this._transparencyMode===Q.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===Q.MATERIAL_OPAQUE||this._transparencyMode===Q.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsBlend:E.visibility<1||!this._disableAlphaBlending&&(E.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(E)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}BM(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H=this.fE().meshes;for(const d of H)if(d.od)for(const H of d.od)if(H.kE()===this)for(const d of H._drawWrappers)d&&this._materialContext===d.materialContext&&(d._wasPreviouslyReady=!1,d._wasPreviouslyUsingInstances=null,d._forceRebindOnNextCall=E);E&&this.HS(Q.AllDirtyFlag)}_preBind(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this._scene.getEngine(),n=(null==H?this.sideOrientation:H)===Q.ClockWiseSideOrientation;return d.enableEffect(E||this._getDrawWrapper()),d.setState(this.ln,this.zOffset,!1,n,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.ed,this.zOffsetUnits),n}bind(E,H){}buildUniformLayout(){const E=this._uniformBuffer;this._eventInfo.ubo=E,this._callbackPluginEventGeneric(8,this._eventInfo),E.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(E,H,d){const n=d._drawWrapper;this._eventInfo.subMesh=d,this._callbackPluginEventBindForSubMesh(this._eventInfo),n._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(E){}bindView(E){this._useUBO?this._needToBindSceneUbo=!0:E.setMatrix("view",this.fE().getViewMatrix())}bindViewProjection(E){this._useUBO?this._needToBindSceneUbo=!0:(E.setMatrix("viewProjection",this.fE().getTransformMatrix()),E.setMatrix("projection",this.fE().getProjectionMatrix()))}bindEyePosition(E,H){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(E,H)}_afterBind(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&H&&(this._needToBindSceneUbo=!1,(0,R.n)(H,this.fE().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=E?E.visibility:1,this._onBindObservable&&E&&this._onBindObservable.notifyObservers(E),this.disableDepthWrite){const E=this._scene.getEngine();this._cachedDepthWriteState=E.getDepthWrite(),E.setDepthWrite(!1)}if(this.disableColorWrite){const E=this._scene.getEngine();this._cachedColorWriteState=E.getColorWrite(),E.setColorWrite(!1)}if(0!==this.depthFunction){const E=this._scene.getEngine();this._cachedDepthFunctionState=E.getDepthFunction()||0,E.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(E){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=E,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(E){return null}_clonePlugins(E,H){const d={};if(this._serializePlugins(d),Q._ParsePlugins(d,E,this._scene,H),this.pluginManager)for(const n of this.pluginManager._plugins){const H=E.pluginManager.getPlugin(n.name);H&&n.copyTo(H)}}getBindedMeshes(){if(this.meshMap){const E=[];for(const H in this.meshMap){const d=this.meshMap[H];d&&E.push(d)}return E}return this._scene.meshes.filter((E=>E.material===this))}forceCompilation(E,H,d,n){const Z={clipPlane:!1,useInstances:!1,...d},I=this.fE(),g=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const l=()=>{if(!this._scene||!this._scene.getEngine())return;const d=I.clipPlane;if(Z.clipPlane&&(I.clipPlane=new M.d(0,0,0,1)),this._storeEffectOnSubMeshes){let d=!0,I=null;if(E.od){const H=new r.e(0,0,0,0,0,E,void 0,!1,!1);H.materialDefines&&(H.materialDefines._renderId=-1),this.isReadyForSubMesh(E,H,Z.useInstances)||(H.effect&&H.effect.getCompilationError()&&H.effect.allFallbacksProcessed()?I=H.effect.getCompilationError():(d=!1,setTimeout(l,16)))}d&&(this.allowShaderHotSwapping=g,I&&n&&n(I),H&&H(this))}else this.isReady()?(this.allowShaderHotSwapping=g,H&&H(this)):setTimeout(l,16);Z.clipPlane&&(I.clipPlane=d)};l()}async forceCompilationAsync(E,H){return await new Promise(((d,n)=>{this.forceCompilation(E,(()=>{d()}),H,(E=>{n(E)}))}))}HS(E){this.fE().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(Q._DirtyCallbackArray.length=0,E&Q.ImageProcessingDirtyFlag&&Q._DirtyCallbackArray.push(Q._ImageProcessingDirtyCallBack),E&Q.TextureDirtyFlag&&Q._DirtyCallbackArray.push(Q._TextureDirtyCallBack),E&Q.LightDirtyFlag&&Q._DirtyCallbackArray.push(Q._LightsDirtyCallBack),E&Q.FresnelDirtyFlag&&Q._DirtyCallbackArray.push(Q._FresnelDirtyCallBack),E&Q.AttributesDirtyFlag&&Q._DirtyCallbackArray.push(Q._AttributeDirtyCallBack),E&Q.MiscDirtyFlag&&Q._DirtyCallbackArray.push(Q._MiscDirtyCallBack),E&Q.PrePassDirtyFlag&&Q._DirtyCallbackArray.push(Q._PrePassDirtyCallBack),Q._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(Q._RunDirtyCallBacks),this.fE().resetCachedMaterial())}resetDrawCache(){const E=this.fE().meshes;for(const H of E)if(H.od)for(const E of H.od)E.kE()===this&&E.resetDrawCache()}_markAllSubMeshesAsDirty(E){const H=this.fE();if(H.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const d=H.meshes;for(const n of d)if(n.od)for(const d of n.od){if((d.kE()||(H._hasDefaultMaterial?H.defaultMaterial:null))===this)for(const H of d._drawWrappers)H&&H.defines&&H.defines.markAllAsDirty&&this._materialContext===H.materialContext&&E(H.defines)}}_markScenePrePassDirty(){if(this.fE().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const E=this.fE().enablePrePassRenderer();E&&E.HS()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(Q._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(Q._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(Q._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(Q._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(Q._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(Q._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(Q._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(Q._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(Q._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(Q._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const E=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Qd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(E)}))}}setPrePassRenderer(E){return!1}dispose(E,H,d){const n=this.fE();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),this._eventInfo.forceDisposeTextures=H,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const E=this._parentContainer.materials.indexOf(this);E>-1&&this._parentContainer.materials.splice(E,1),this._parentContainer=null}if(!0!==d)if(this.meshMap)for(const Z in this.meshMap){const E=this.meshMap[Z];this._disposeMeshResources(E)}else{const E=n.meshes;for(const H of E)this._disposeMeshResources(H)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Qd.notifyObservers(this),this.Qd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(E){if(!E)return;const H=E.Kd,d=E._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(E.od&&d)for(const Z of E.od){const E=Z._drawWrappers;for(let I=0;I<E.length;I++){var n;const g=null===(n=E[I])||void 0===n?void 0:n.effect;if(!g)continue;d[I]===this&&(null===H||void 0===H||H._releaseVertexArrayObject(g),Z._removeDrawWrapper(I,!0,!0))}}}else null===H||void 0===H||H._releaseVertexArrayObject(this._drawWrapper.effect);E.material!==this||E.sourceMesh||(E.material=null)}serialize(){const E=C.c.Serialize(this);return E.ed=this.ed.serialize(),E.uniqueId=this.uniqueId,this._serializePlugins(E),E}_serializePlugins(E){if(E.plugins={},this.pluginManager)for(const H of this.pluginManager._plugins)H.doNotSerialize||(E.plugins[H.getClassName()]=H.serialize())}static Parse(E,H,d){if(E.customType){if("BABYLON.PBRMaterial"===E.customType&&E.overloadedAlbedo&&(E.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return S.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else E.customType="BABYLON.StandardMaterial";const n=I.Tools.Instantiate(E.customType).Parse(E,H,d);return n._loadedUniqueId=E.uniqueId,n}static _ParsePlugins(E,H,d,n){if(E.plugins)for(const l in E.plugins){var Z,g;const r=E.plugins[l];let t=null===(Z=H.pluginManager)||void 0===Z?void 0:Z.getPlugin(r.name);if(!t){const E=I.Tools.Instantiate("BABYLON."+l);E&&(t=new E(H))}null===(g=t)||void 0===g||g.parse(r,d,n)}}}Q.TriangleFillMode=0,Q.WireFrameFillMode=1,Q.PointFillMode=2,Q.PointListDrawMode=3,Q.LineListDrawMode=4,Q.LineLoopDrawMode=5,Q.LineStripDrawMode=6,Q.TriangleStripDrawMode=7,Q.TriangleFanDrawMode=8,Q.ClockWiseSideOrientation=0,Q.CounterClockWiseSideOrientation=1,Q.ImageProcessingDirtyFlag=64,Q.TextureDirtyFlag=1,Q.LightDirtyFlag=2,Q.FresnelDirtyFlag=4,Q.AttributesDirtyFlag=8,Q.MiscDirtyFlag=16,Q.PrePassDirtyFlag=32,Q.AllDirtyFlag=127,Q.MATERIAL_OPAQUE=0,Q.MATERIAL_ALPHATEST=1,Q.MATERIAL_ALPHABLEND=2,Q.MATERIAL_ALPHATESTANDBLEND=3,Q.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,Q.MATERIAL_NORMALBLENDMETHOD_RNM=1,Q.OnEventObservable=new g.e,Q._AllDirtyCallBack=E=>E.markAllAsDirty(),Q._ImageProcessingDirtyCallBack=E=>E.markAsImageProcessingDirty(),Q._TextureDirtyCallBack=E=>E.markAsTexturesDirty(),Q._FresnelDirtyCallBack=E=>E.markAsFresnelDirty(),Q._MiscDirtyCallBack=E=>E.markAsMiscDirty(),Q._PrePassDirtyCallBack=E=>E.markAsPrePassDirty(),Q._LightsDirtyCallBack=E=>E.markAsLightDirty(),Q._AttributeDirtyCallBack=E=>E.markAsAttributesDirty(),Q._FresnelAndMiscDirtyCallBack=E=>{Q._FresnelDirtyCallBack(E),Q._MiscDirtyCallBack(E)},Q._TextureAndMiscDirtyCallBack=E=>{Q._TextureDirtyCallBack(E),Q._MiscDirtyCallBack(E)},Q._DirtyCallbackArray=[],Q._RunDirtyCallBacks=E=>{for(const H of Q._DirtyCallbackArray)H(E)},(0,n.e)([(0,Z.K)()],Q.prototype,"id",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"uniqueId",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"name",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"metadata",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"checkReadyOnEveryCall",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"checkReadyOnlyOnce",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"state",void 0),(0,n.e)([(0,Z.K)("alpha")],Q.prototype,"_alpha",void 0),(0,n.e)([(0,Z.K)("ln")],Q.prototype,"_backFaceCulling",void 0),(0,n.e)([(0,Z.K)("cullBackFaces")],Q.prototype,"_cullBackFaces",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"sideOrientation",void 0),(0,n.e)([(0,Z.K)("alphaMode")],Q.prototype,"_alphaMode",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"_needDepthPrePass",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"disableDepthWrite",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"disableColorWrite",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"forceDepthWrite",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"depthFunction",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"separateCullingPass",void 0),(0,n.e)([(0,Z.K)("fogEnabled")],Q.prototype,"_fogEnabled",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"pointSize",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"zOffset",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"zOffsetUnits",void 0),(0,n.e)([(0,Z.K)()],Q.prototype,"pointsCloud",null),(0,n.e)([(0,Z.K)()],Q.prototype,"fillMode",null),(0,n.e)([(0,Z.K)()],Q.prototype,"useLogarithmicDepth",null),(0,n.e)([(0,Z.K)()],Q.prototype,"transparencyMode",null)},12763:(E,H,d)=>{d.d(H,{$:()=>k,C:()=>C,E:()=>V,H:()=>c,K:()=>Y,L:()=>W,P:()=>L,S:()=>X,U:()=>u,X:()=>o,_:()=>F,ab:()=>w,b:()=>s,d:()=>M,g:()=>p,j:()=>S,m:()=>R,n:()=>Q,q:()=>D,r:()=>j,t:()=>e,w:()=>f,y:()=>P});var n=d(12237),Z=d(12437),I=d(12268),g=d(12703),l=d(12768);const r=Z.DH.Black(),t={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function S(E,H,d){if(!E||E.LOGARITHMICDEPTH||E.indexOf&&E.indexOf("LOGARITHMICDEPTH")>=0){const E=d.activeCamera;1===E.mode&&n.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),H.setFloat("logarithmicDepthConstant",2/(Math.log(E.maxZ+1)/Math.LN2))}}function M(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];d&&E.fogEnabled&&(!H||H.applyFog)&&0!==E.fogMode&&(d.setFloat4("vFogInfos",E.fogMode,E.fogStart,E.fogEnd,E.fogDensity),n?(E.fogColor.toLinearSpaceToRef(r,E.getEngine().useExactSrgbConversions),d.setColor3("vFogColor",r)):d.setColor3("vFogColor",E.fogColor))}function V(E,H,d,n,Z,I,g,l,r,S){const M=E.numMaxInfluencers||E.numInfluencers;return M<=0?0:(H.push("#define MORPHTARGETS"),E.hasPositions&&H.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),E.hasNormals&&H.push("#define MORPHTARGETTEXTURE_HASNORMALS"),E.hasTangents&&H.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),E.hasUVs&&H.push("#define MORPHTARGETTEXTURE_HASUVS"),E.hasUV2s&&H.push("#define MORPHTARGETTEXTURE_HASUV2S"),E.hasColors&&H.push("#define MORPHTARGETTEXTURE_HASCOLORS"),E.supportsPositions&&Z&&H.push("#define MORPHTARGETS_POSITION"),E.supportsNormals&&I&&H.push("#define MORPHTARGETS_NORMAL"),E.supportsTangents&&g&&H.push("#define MORPHTARGETS_TANGENT"),E.supportsUVs&&l&&H.push("#define MORPHTARGETS_UV"),E.supportsUV2s&&r&&H.push("#define MORPHTARGETS_UV2"),E.supportsColors&&S&&H.push("#define MORPHTARGETS_COLOR"),H.push("#define NUM_MORPH_INFLUENCERS "+M),E.isUsingTextureForTargets&&H.push("#define MORPHTARGETS_TEXTURE"),t.NUM_MORPH_INFLUENCERS=M,t.NORMAL=I,t.TANGENT=g,t.UV=l,t.UV2=r,t.COLOR=S,C(d,n,t,Z),M)}function C(E,H,d){let Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=d.NUM_MORPH_INFLUENCERS;if(g>0&&I.b.LastCreatedEngine){const l=I.b.LastCreatedEngine.getCaps().maxVertexAttribs,r=H.morphTargetManager;if(null!==r&&void 0!==r&&r.isUsingTextureForTargets)return;const t=r&&r.supportsPositions&&Z,S=r&&r.supportsNormals&&d.NORMAL,M=r&&r.supportsTangents&&d.TANGENT,V=r&&r.supportsUVs&&d.UV1,C=r&&r.supportsUV2s&&d.UV2,w=r&&r.supportsColors&&d.VERTEXCOLOR;for(let d=0;d<g;d++)t&&E.push("position"+d),S&&E.push("normal"+d),M&&E.push("tangent"+d),V&&E.push("uv_"+d),C&&E.push("uv2_"+d),w&&E.push("color"+d),E.length>l&&n.b.Error("Cannot add more vertex attributes for mesh "+H.name)}}function w(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.push("world0"),E.push("world1"),E.push("world2"),E.push("world3"),H&&(E.push("previousWorld0"),E.push("previousWorld1"),E.push("previousWorld2"),E.push("previousWorld3"))}function R(E,H){const d=E.morphTargetManager;E&&d&&H.setFloatArray("morphTargetInfluences",d.influences)}function Q(E,H){H.bindToEffect(E,"Scene")}function L(E,H,d){H._needUVs=!0,H[d]=!0,E.optimizeUVAllocation&&E.getTextureMatrix().isIdentityAs3x2()?(H[d+"DIRECTUV"]=E.coordinatesIndex+1,H["MAINUV"+(E.coordinatesIndex+1)]=!0):H[d+"DIRECTUV"]=0}function D(E,H,d){const n=E.getTextureMatrix();H.bd(d+"Matrix",n)}function e(E,H,d){d.BAKED_VERTEX_ANIMATION_TEXTURE&&d.INSTANCES&&E.push("bakedVertexAnimationSettingsInstanced")}function s(E,H,d){var n;if(H&&E&&(E.computeBonesUsingShaders&&H._bonesComputationForcedToCPU&&(E.computeBonesUsingShaders=!1),E.useBones&&E.computeBonesUsingShaders&&E.skeleton)){const Z=E.skeleton;if(Z.isUsingTextureForMatrices&&H.getUniformIndex("boneTextureWidth")>-1){const d=Z.getTransformMatrixTexture(E);H.setTexture("boneSampler",d),H.setFloat("boneTextureWidth",4*(Z.bones.length+1))}else{const I=Z.getTransformMatrices(E);I&&(H.setMatrices("mBones",I),d&&E.fE().prePassRenderer&&E.fE().prePassRenderer.getIndex(2)&&(d.previousBones[E.uniqueId]||(d.previousBones[E.uniqueId]=I.slice()),H.setMatrices("mPreviousBones",d.previousBones[E.uniqueId]),n=I,d.previousBones[E.uniqueId].set(n)))}}}function i(E,H,d,n,Z){let I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];E._bindLight(H,d,n,Z,I)}function p(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const I=Math.min(H.lightSources.length,Z);for(let g=0;g<I;g++){i(H.lightSources[g],g,E,d,"boolean"===typeof n?n:n.SPECULARTERM,H.receiveShadows)}}function f(E,H,d,n){d.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,H),E.push("matricesIndices"),E.push("matricesWeights"),d.NUM_BONE_INFLUENCERS>4&&(E.push("matricesIndicesExtra"),E.push("matricesWeightsExtra")))}function P(E,H){(H.INSTANCES||H.THIN_INSTANCES)&&w(E,!!H.PREPASS_VELOCITY),H.INSTANCESCOLOR&&E.push("instanceColor")}function j(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=0;for(let I=0;I<d&&E["LIGHT"+I];I++)I>0&&(Z=n+I,H.addFallback(Z,"LIGHT"+I)),E.SHADOWS||(E["SHADOW"+I]&&H.addFallback(n,"SHADOW"+I),E["SHADOWPCF"+I]&&H.addFallback(n,"SHADOWPCF"+I),E["SHADOWPCSS"+I]&&H.addFallback(n,"SHADOWPCSS"+I),E["SHADOWPOISSON"+I]&&H.addFallback(n,"SHADOWPOISSON"+I),E["SHADOWESM"+I]&&H.addFallback(n,"SHADOWESM"+I),E["SHADOWCLOSEESM"+I]&&H.addFallback(n,"SHADOWCLOSEESM"+I));return Z++}function X(E,H,d,n,Z,I,g){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];g._areMiscDirty&&(g.LOGARITHMICDEPTH=d,g.POINTSIZE=n,g.FOG=Z&&function(E,H){return H.fogEnabled&&E.applyFog&&0!==H.fogMode}(E,H),g.NONUNIFORMSCALING=E.nonUniformScaling,g.ALPHATEST=I,g.DECAL_AFTER_DETAIL=l)}function W(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!d._areLightsDirty)return d._needNormals;let g=0;const l={needNormals:d._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(E.lightsEnabled&&!I)for(const t of H.lightSources)if(U(E,H,t,g,d,n,l),g++,g===Z)break;d.SPECULARTERM=l.specularEnabled,d.SHADOWS=l.shadowEnabled;for(let t=g;t<Z;t++)void 0!==d["LIGHT"+t]&&(d["LIGHT"+t]=!1,d["HEMILIGHT"+t]=!1,d["POINTLIGHT"+t]=!1,d["DIRLIGHT"+t]=!1,d["SPOTLIGHT"+t]=!1,d["AREALIGHT"+t]=!1,d["SHADOW"+t]=!1,d["SHADOWCSM"+t]=!1,d["SHADOWCSMDEBUG"+t]=!1,d["SHADOWCSMNUM_CASCADES"+t]=!1,d["SHADOWCSMUSESHADOWMAXZ"+t]=!1,d["SHADOWCSMNOBLEND"+t]=!1,d["SHADOWCSM_RIGHTHANDED"+t]=!1,d["SHADOWPCF"+t]=!1,d["SHADOWPCSS"+t]=!1,d["SHADOWPOISSON"+t]=!1,d["SHADOWESM"+t]=!1,d["SHADOWCLOSEESM"+t]=!1,d["SHADOWCUBE"+t]=!1,d["SHADOWLOWQUALITY"+t]=!1,d["SHADOWMEDIUMQUALITY"+t]=!1);const r=E.getEngine().getCaps();return void 0===d.SHADOWFLOAT&&(l.needRebuild=!0),d.SHADOWFLOAT=l.shadowEnabled&&(r.textureFloatRender&&r.textureFloatLinearFiltering||r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering),d.LIGHTMAPEXCLUDED=l.lightmapMode,l.needRebuild&&d.rebuild(),l.needNormals}function U(E,H,d,n,Z,I,l){switch(l.needNormals=!0,void 0===Z["LIGHT"+n]&&(l.needRebuild=!0),Z["LIGHT"+n]=!0,Z["SPOTLIGHT"+n]=!1,Z["HEMILIGHT"+n]=!1,Z["POINTLIGHT"+n]=!1,Z["DIRLIGHT"+n]=!1,Z["AREALIGHT"+n]=!1,d.prepareLightSpecificDefines(Z,n),Z["LIGHT_FALLOFF_PHYSICAL"+n]=!1,Z["LIGHT_FALLOFF_GLTF"+n]=!1,Z["LIGHT_FALLOFF_STANDARD"+n]=!1,d.falloffType){case g.d.FALLOFF_GLTF:Z["LIGHT_FALLOFF_GLTF"+n]=!0;break;case g.d.FALLOFF_PHYSICAL:Z["LIGHT_FALLOFF_PHYSICAL"+n]=!0;break;case g.d.FALLOFF_STANDARD:Z["LIGHT_FALLOFF_STANDARD"+n]=!0}if(I&&!d.fS.equalsFloats(0,0,0)&&(l.specularEnabled=!0),Z["SHADOW"+n]=!1,Z["SHADOWCSM"+n]=!1,Z["SHADOWCSMDEBUG"+n]=!1,Z["SHADOWCSMNUM_CASCADES"+n]=!1,Z["SHADOWCSMUSESHADOWMAXZ"+n]=!1,Z["SHADOWCSMNOBLEND"+n]=!1,Z["SHADOWCSM_RIGHTHANDED"+n]=!1,Z["SHADOWPCF"+n]=!1,Z["SHADOWPCSS"+n]=!1,Z["SHADOWPOISSON"+n]=!1,Z["SHADOWESM"+n]=!1,Z["SHADOWCLOSEESM"+n]=!1,Z["SHADOWCUBE"+n]=!1,Z["SHADOWLOWQUALITY"+n]=!1,Z["SHADOWMEDIUMQUALITY"+n]=!1,H&&H.receiveShadows&&E.shadowsEnabled&&d.shadowEnabled){const H=d.getShadowGenerator(E.activeCamera)??d.getShadowGenerator();if(H){const E=H.getShadowMap();E&&E.renderList&&E.renderList.length>0&&(l.shadowEnabled=!0,H.prepareDefines(Z,n))}}d.lightmapMode!=g.d.LIGHTMAP_DEFAULT?(l.lightmapMode=!0,Z["LIGHTMAPEXCLUDED"+n]=!0,Z["LIGHTMAPNOSPECULAR"+n]=d.lightmapMode==g.d.LIGHTMAP_SHADOWSONLY):(Z["LIGHTMAPEXCLUDED"+n]=!1,Z["LIGHTMAPNOSPECULAR"+n]=!1)}function Y(E,H,d,n,Z){let I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=function(E,H){let d=!1;if(E.activeCamera){const n=H.CAMERA_ORTHOGRAPHIC?1:0,Z=H.CAMERA_PERSPECTIVE?1:0,I=1===E.activeCamera.mode?1:0,g=0===E.activeCamera.mode?1:0;(n^I||Z^g)&&(H.CAMERA_ORTHOGRAPHIC=1===I,H.CAMERA_PERSPECTIVE=1===g,d=!0)}return d}(E,n);!1!==I&&(r=(0,l.j)(d,E,n)),n.DEPTHPREPASS!==!H.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,r=!0),n.INSTANCES!==Z&&(n.INSTANCES=Z,r=!0),n.THIN_INSTANCES!==g&&(n.THIN_INSTANCES=g,r=!0),r&&n.markAsUnprocessed()}function c(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!H._areAttributesDirty&&H._needNormals===H._normals&&H._needUVs===H._uvs)return!1;H._normals=H._needNormals,H._uvs=H._needUVs,H.NORMAL=H._needNormals&&E.isVerticesDataPresent("normal"),H._needNormals&&E.isVerticesDataPresent("tangent")&&(H.TANGENT=!0);for(let l=1;l<=6;++l)H["UV"+l]=!!H._needUVs&&E.isVerticesDataPresent(`uv${1===l?"":l}`);if(d){const d=E.useVertexColors&&E.isVerticesDataPresent("color");H.VERTEXCOLOR=d,H.VERTEXALPHA=E.hasVertexAlpha&&d&&I}return E.isVerticesDataPresent("instanceColor")&&(E.hasInstances||E.hasThinInstances)&&(H.INSTANCESCOLOR=!0),n&&function(E,H){if(E.useBones&&E.computeBonesUsingShaders&&E.skeleton){H.NUM_BONE_INFLUENCERS=E.numBoneInfluencers;const d=void 0!==H.BONETEXTURE;if(E.skeleton.isUsingTextureForMatrices&&d)H.BONETEXTURE=!0;else{H.BonesPerMesh=E.skeleton.bones.length+1,H.BONETEXTURE=!d&&void 0;const n=E.fE().prePassRenderer;if(n&&n.enabled){const d=-1===n.excludedSkinnedMesh.indexOf(E);H.BONES_VELOCITY_ENABLED=d}}}else H.NUM_BONE_INFLUENCERS=0,H.BonesPerMesh=0,void 0!==H.BONETEXTURE&&(H.BONETEXTURE=!1)}(E,H),Z&&function(E,H){const d=E.morphTargetManager;d?(H.MORPHTARGETS_UV=d.supportsUVs&&H.UV1,H.MORPHTARGETS_UV2=d.supportsUV2s&&H.UV2,H.MORPHTARGETS_TANGENT=d.supportsTangents&&H.TANGENT,H.MORPHTARGETS_NORMAL=d.supportsNormals&&H.NORMAL,H.MORPHTARGETS_POSITION=d.supportsPositions,H.MORPHTARGETS_COLOR=d.supportsColors,H.MORPHTARGETTEXTURE_HASUVS=d.hasUVs,H.MORPHTARGETTEXTURE_HASUV2S=d.hasUV2s,H.MORPHTARGETTEXTURE_HASTANGENTS=d.hasTangents,H.MORPHTARGETTEXTURE_HASNORMALS=d.hasNormals,H.MORPHTARGETTEXTURE_HASPOSITIONS=d.hasPositions,H.MORPHTARGETTEXTURE_HASCOLORS=d.hasColors,H.NUM_MORPH_INFLUENCERS=d.numMaxInfluencers||d.numInfluencers,H.MORPHTARGETS=H.NUM_MORPH_INFLUENCERS>0,H.MORPHTARGETS_TEXTURE=d.isUsingTextureForTargets):(H.MORPHTARGETS_UV=!1,H.MORPHTARGETS_UV2=!1,H.MORPHTARGETS_TANGENT=!1,H.MORPHTARGETS_NORMAL=!1,H.MORPHTARGETS_POSITION=!1,H.MORPHTARGETS_COLOR=!1,H.MORPHTARGETTEXTURE_HASUVS=!1,H.MORPHTARGETTEXTURE_HASUV2S=!1,H.MORPHTARGETTEXTURE_HASTANGENTS=!1,H.MORPHTARGETTEXTURE_HASNORMALS=!1,H.MORPHTARGETTEXTURE_HASPOSITIONS=!1,H.MORPHTARGETTEXTURE_HAS_COLORS=!1,H.MORPHTARGETS=!1,H.NUM_MORPH_INFLUENCERS=0)}(E,H),g&&function(E,H){const d=E.bakedVertexAnimationManager;H.BAKED_VERTEX_ANIMATION_TEXTURE=!(!d||!d.isEnabled)}(E,H),!0}function u(E,H){if(E.activeCamera){const d=H.MULTIVIEW;H.MULTIVIEW=null!==E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1,H.MULTIVIEW!=d&&H.markAsUnprocessed()}}function o(E,H,d){const n=H.ORDER_INDEPENDENT_TRANSPARENCY,Z=H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;H.ORDER_INDEPENDENT_TRANSPARENCY=E.useOrderIndependentTransparency&&d,H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!E.getEngine().getCaps().textureFloatLinearFiltering,n===H.ORDER_INDEPENDENT_TRANSPARENCY&&Z===H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||H.markAsUnprocessed()}function F(E,H,d){const n=H.PREPASS;if(!H._arePrePassDirty)return;const Z=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(E.prePassRenderer&&E.prePassRenderer.enabled&&d){H.PREPASS=!0,H.SCENE_MRT_COUNT=E.prePassRenderer.mrtCount,H.PREPASS_NORMAL_WORLDSPACE=E.prePassRenderer.generateNormalsInWorldSpace,H.PREPASS_COLOR=!0,H.PREPASS_COLOR_INDEX=0;for(let d=0;d<Z.length;d++){const n=E.prePassRenderer.getIndex(Z[d].type);-1!==n?(H[Z[d].define]=!0,H[Z[d].index]=n):H[Z[d].define]=!1}}else{H.PREPASS=!1;for(let E=0;E<Z.length;E++)H[Z[E].define]=!1}H.PREPASS!=n&&(H.markAsUnprocessed(),H.markAsImageProcessingDirty())}function a(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Z&&Z.push("Light"+E),I||(H.push("vLightData"+E,"vLightDiffuse"+E,"vLightSpecular"+E,"vLightDirection"+E,"vLightWidth"+E,"vLightHeight"+E,"vLightFalloff"+E,"vLightGround"+E,"lightMatrix"+E,"shadowsInfo"+E,"depthValues"+E),d.push("shadowTexture"+E),d.push("depthTexture"+E),H.push("viewFrustumZ"+E,"cascadeBlendFactor"+E,"lightSizeUVCorrection"+E,"depthCorrection"+E,"penumbraDarkness"+E,"frustumLengths"+E),n&&(d.push("projectionLightTexture"+E),H.push("textureProjectionMatrix"+E)),g&&d.push("iesLightTexture"+E))}function k(E,H,d){let n,Z,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(E.uniformsNames){const g=E;n=g.uniformsNames,Z=g.uniformBuffersNames,H=g.samplers,d=g.defines,I=g.maxSimultaneousLights||0}else n=E,H||(H=[]);for(let g=0;g<I&&d["LIGHT"+g];g++)a(g,n,H,d["PROJECTEDLIGHTTEXTURE"+g],Z,!1,d["IESLIGHTTEXTURE"+g]);d.NUM_MORPH_INFLUENCERS&&(n.push("morphTargetInfluences"),n.push("morphTargetCount")),d.BAKED_VERTEX_ANIMATION_TEXTURE&&(n.push("bakedVertexAnimationSettings"),n.push("bakedVertexAnimationTextureSizeInverted"),n.push("bakedVertexAnimationTime"),H.push("bakedVertexAnimationTexture"))}},12721:(E,H,d)=>{d.d(H,{d:()=>I});var n=d(12384),Z=d(12729);class I extends Z.b{constructor(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(E,H,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new n.Matrix,this._storeEffectOnSubMeshes=d}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(E,H){return!!E&&(!this._storeEffectOnSubMeshes||(!E.od||0===E.od.length||this.isReadyForSubMesh(E,E.od[0],H)))}_isReadyForSubMesh(E){const H=E.materialDefines;return!(this.checkReadyOnEveryCall||!E.effect||!H||H._renderId!==this.fE().getRenderId())}bindOnlyWorldMatrix(E){this._activeEffect.setMatrix("world",E)}bindOnlyNormalMatrix(E){this._activeEffect.setMatrix("normalMatrix",E)}bind(E,H){H&&this.bindForSubMesh(E,H,H.od[0])}_afterBind(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;super._afterBind(E,H,d),this.fE()._cachedEffect=H,d?d._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return d._drawWrapper._forceRebindOnNextCall||E.isCachedMaterialInvalid(this,H,n)}dispose(E,H,d){this._activeEffect=void 0,super.dispose(E,H,d)}}},12754:(E,H,d)=>{d.d(H,{b:()=>l,e:()=>r});var n=d(12369),Z=d(12384),I=d(12372);class g{static extractMinAndMaxIndexed(E,H,d,n,Z,I){for(let g=d;g<d+n;g++){const d=3*H[g],n=E[d],l=E[d+1],r=E[d+2];Z.minimizeInPlaceFromFloats(n,l,r),I.maximizeInPlaceFromFloats(n,l,r)}}static extractMinAndMax(E,H,d,n,Z,I){for(let g=H,l=H*n;g<H+d;g++,l+=n){const H=E[l],d=E[l+1],n=E[l+2];Z.minimizeInPlaceFromFloats(H,d,n),I.maximizeInPlaceFromFloats(H,d,n)}}}function l(E,H,d,n){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=new Z.wH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new Z.wH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g.extractMinAndMaxIndexed(E,H,d,n,l,r),I&&(l.x-=l.x*I.x+I.y,l.y-=l.y*I.x+I.y,l.z-=l.z*I.x+I.y,r.x+=r.x*I.x+I.y,r.y+=r.y*I.x+I.y,r.z+=r.z*I.x+I.y),{minimum:l,maximum:r}}function r(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4?arguments[4]:void 0;const l=new Z.wH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new Z.wH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return I||(I=3),g.extractMinAndMax(E,H,d,I,l,r),n&&(l.x-=l.x*n.x+n.y,l.y-=l.y*n.x+n.y,l.z-=l.z*n.x+n.y,r.x+=r.x*n.x+n.y,r.y+=r.y*n.x+n.y,r.z+=r.z*n.x+n.y),{minimum:l,maximum:r}}(0,n.e)([I.d.filter((function(){for(var E=arguments.length,H=new Array(E),d=0;d<E;d++)H[d]=arguments[d];let[n,Z]=H;return!Array.isArray(n)&&!Array.isArray(Z)}))],g,"extractMinAndMaxIndexed",null),(0,n.e)([I.d.filter((function(){for(var E=arguments.length,H=new Array(E),d=0;d<E;d++)H[d]=arguments[d];let[n]=H;return!Array.isArray(n)}))],g,"extractMinAndMax",null)},12733:(E,H,d)=>{d.d(H,{e:()=>r});var n=d(12463),Z=d(12736),I=d(12738),g=d(12754),l=d(12516);class r{get materialDefines(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(E=this._getDrawWrapper())||void 0===E?void 0:E.defines}set materialDefines(E){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=E}_getDrawWrapper(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E??this._engine.currentRenderPassId;let d=this._drawWrappers[E];return!d&&H&&(this._drawWrappers[E]=d=new l.c(this._mesh.fE().getEngine())),d}_removeDrawWrapper(E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var d;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(d=this._drawWrappers[E])||void 0===d||d.dispose(H));this._drawWrappers[E]=void 0}get effect(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(E=this._getDrawWrapper())||void 0===E?void 0:E.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(E){this._mainDrawWrapperOverride=E}setEffect(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=this._drawWrapper;Z.setEffect(E,H,n),void 0!==d&&(Z.materialContext=d),E||(Z.defines=null,Z.materialContext=void 0)}resetDrawCache(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==E)return void this._removeDrawWrapper(E,!0,H);for(const E of this._drawWrappers)null===E||void 0===E||E.dispose(H)}this._drawWrappers=[]}static AddToMesh(E,H,d,n,Z,I,g){return new r(E,H,d,n,Z,I,g,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(E,H,d,n,Z,I,g){let l=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],r=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=E,this.verticesStart=H,this.verticesCount=d,this.indexStart=n,this.indexCount=Z,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=I,this._renderingMesh=g||I,r&&I.od.push(this),this._engine=this._mesh.fE().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=I.od.length-1,l&&(this.refreshBoundingInfo(),I.yd(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(E){return this._boundingInfo=E,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const E=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return E||this._renderingMesh}kE(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!H)return E&&this._mesh.fE()._hasDefaultMaterial?this._mesh.fE().defaultMaterial:null;if(this._isMultiMaterial(H)){const E=H.getSubMaterial(this.materialIndex);return this._currentMaterial!==E&&(this._currentMaterial=E,this.resetDrawCache()),E}return H}_isMultiMaterial(E){return void 0!==E.getSubMaterial}refreshBoundingInfo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Kd)return this;if(E||(E=this._renderingMesh.getVerticesData(n.g.PositionKind)),!E)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const H=this._renderingMesh.Nd();let d;if(0===this.indexStart&&this.indexCount===H.length){const E=this._renderingMesh.getBoundingInfo();d={minimum:E.minimum.clone(),maximum:E.maximum.clone()}}else d=(0,g.b)(E,H,this.indexStart,this.indexCount,this._renderingMesh.Kd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(d.minimum,d.maximum):this._boundingInfo=new I.e(d.minimum,d.maximum),this}_checkCollision(E){return this.getBoundingInfo()._checkCollision(E)}updateBoundingInfo(E){let H=this.getBoundingInfo();return H||(this.refreshBoundingInfo(),H=this.getBoundingInfo()),H&&H.update(E),this}isInFrustum(E){const H=this.getBoundingInfo();return!!H&&H.isInFrustum(E,this._mesh.PM)}isCompletelyInFrustum(E){const H=this.getBoundingInfo();return!!H&&H.isCompletelyInFrustum(E)}render(E){return this._renderingMesh.render(this,E,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(E,H){if(!this._linesIndexBuffer){const d=6*Math.floor(this.indexCount/3),n=this.verticesStart+this.verticesCount>65535?new Uint32Array(d):new Uint16Array(d);let Z=0;if(0===E.length)for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)n[Z++]=E,n[Z++]=E+1,n[Z++]=E+1,n[Z++]=E+2,n[Z++]=E+2,n[Z++]=E;else for(let H=this.indexStart;H<this.indexStart+this.indexCount;H+=3)n[Z++]=E[H],n[Z++]=E[H+1],n[Z++]=E[H+1],n[Z++]=E[H+2],n[Z++]=E[H+2],n[Z++]=E[H];this._linesIndexBuffer=H.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer}canIntersects(E){const H=this.getBoundingInfo();return!!H&&E.intersectsBox(H.boundingBox)}intersects(E,H,d,n,Z){const I=this.kE();if(!I)return null;let g=3,l=!1;switch(I.fillMode){case 3:case 5:case 6:case 8:return null;case 7:g=1,l=!0}return 4===I.fillMode?d.length?this._intersectLines(E,H,d,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(E,H,d,this._mesh.intersectionThreshold,n):!d.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(E,H,d,n,Z):this._intersectTriangles(E,H,d,g,l,n,Z)}_intersectLines(E,H,d,n,I){let g=null;for(let l=this.indexStart;l<this.indexStart+this.indexCount;l+=2){const r=H[d[l]],t=H[d[l+1]],S=E.intersectionSegment(r,t,n);if(!(S<0)&&((I||!g||S<g.distance)&&(g=new Z.d(null,null,S),g.faceId=l/2,I)))break}return g}_intersectUnIndexedLines(E,H,d,n,I){let g=null;for(let l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=2){const d=H[l],r=H[l+1],t=E.intersectionSegment(d,r,n);if(!(t<0)&&((I||!g||t<g.distance)&&(g=new Z.d(null,null,t),g.faceId=l/2,I)))break}return g}_intersectTriangles(E,H,d,n,Z,I,g){let l=null,r=-1;for(let t=this.indexStart;t<this.indexStart+this.indexCount-(3-n);t+=n){r++;const n=d[t],S=d[t+1],M=d[t+2];if(Z&&4294967295===M){t+=2;continue}const V=H[n],C=H[S],w=H[M];if(!V||!C||!w)continue;if(g&&!g(V,C,w,E,n,S,M))continue;const R=E.intersectsTriangle(V,C,w);if(R){if(R.distance<0)continue;if((I||!l||R.distance<l.distance)&&(l=R,l.faceId=r,I))break}}return l}_intersectUnIndexedTriangles(E,H,d,n,Z){let I=null;for(let g=this.verticesStart;g<this.verticesStart+this.verticesCount;g+=3){const d=H[g],l=H[g+1],r=H[g+2];if(Z&&!Z(d,l,r,E,-1,-1,-1))continue;const t=E.intersectsTriangle(d,l,r);if(t){if(t.distance<0)continue;if((n||!I||t.distance<I.distance)&&(I=t,I.faceId=g/3,n))break}}return I}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(E,H){const d=new r(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,E,H,!1);if(!this.IsGlobal){const E=this.getBoundingInfo();if(!E)return d;d._boundingInfo=new I.e(E.minimum,E.maximum)}return d}dispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.fE().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const H=this._mesh.od.indexOf(this);this._mesh.od.splice(H,1),this.resetDrawCache(void 0,E)}getClassName(){return"SubMesh"}static CreateFromIndices(E,H,d,n,Z){let I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=Number.MAX_VALUE,l=-Number.MAX_VALUE;const t=(Z||n).Nd();for(let r=H;r<H+d;r++){const E=t[r];E<g&&(g=E),E>l&&(l=E)}return new r(E,g,l-g+1,H,d,n,Z,I)}}}}]);