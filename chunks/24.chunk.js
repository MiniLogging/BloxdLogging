"use strict";(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[24],{12577:(I,O,C)=>{C.d(O,{e:()=>j});class j{constructor(I,O,C){this.bu=I,this.bv=O,this.distance=C,this.faceId=0,this.subMeshId=0}}},12582:(I,O,C)=>{C.d(O,{e:()=>y});var j=C(12276),K=C(12272),i=C(12274);class y{constructor(I,O,C){this.vectors=(0,j.e)(8,K.mC.Zero),this.center=K.mC.Zero(),this.centerWorld=K.mC.Zero(),this.extendSize=K.mC.Zero(),this.extendSizeWorld=K.mC.Zero(),this.directions=(0,j.e)(3,K.mC.Zero),this.vectorsWorld=(0,j.e)(8,K.mC.Zero),this.minimumWorld=K.mC.Zero(),this.maximumWorld=K.mC.Zero(),this.minimum=K.mC.Zero(),this.maximum=K.mC.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(I,O,C)}reConstruct(I,O,C){const j=I.x,i=I.y,y=I.z,S=O.x,U=O.y,p=O.z,N=this.vectors;this.minimum.cS(j,i,y),this.maximum.cS(S,U,p),N[0].cS(j,i,y),N[1].cS(S,U,p),N[2].cS(S,i,y),N[3].cS(j,U,y),N[4].cS(j,i,p),N[5].cS(S,U,y),N[6].cS(j,U,p),N[7].cS(S,i,p),O.addToRef(I,this.center).scaleInPlace(.5),O.subtractToRef(I,this.extendSize).scaleInPlace(.5),this._worldMatrix=C||K.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(I){const O=y._TmpVector3,C=this.maximum.subtractToRef(this.minimum,O[0]),j=C.length();C.normalizeFromLength(j);const K=j*I,i=C.scaleInPlace(.5*K),S=this.center.subtractToRef(i,O[1]),U=this.center.addToRef(i,O[2]);return this.reConstruct(S,U,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(I){const O=this.minimumWorld,C=this.maximumWorld,j=this.directions,i=this.vectorsWorld,y=this.vectors;if(I.isIdentity()){O.K(this.minimum),C.K(this.maximum);for(let I=0;I<8;++I)i[I].K(y[I]);this.extendSizeWorld.K(this.extendSize),this.centerWorld.K(this.center)}else{O.XS(Number.MAX_VALUE),C.XS(-Number.MAX_VALUE);for(let j=0;j<8;++j){const S=i[j];K.mC.TransformCoordinatesToRef(y[j],I,S),O.minimizeInPlace(S),C.maximizeInPlace(S)}C.subtractToRef(O,this.extendSizeWorld).scaleInPlace(.5),C.addToRef(O,this.centerWorld).scaleInPlace(.5)}K.mC.FromArrayToRef(I.m,0,j[0]),K.mC.FromArrayToRef(I.m,4,j[1]),K.mC.FromArrayToRef(I.m,8,j[2]),this._worldMatrix=I}isInFrustum(I){return y.IsInFrustum(this.vectorsWorld,I)}isCompletelyInFrustum(I){return y.IsCompletelyInFrustum(this.vectorsWorld,I)}intersectsPoint(I){const O=this.minimumWorld,C=this.maximumWorld,j=O.x,K=O.y,y=O.z,S=C.x,U=C.y,p=C.z,N=I.x,Q=I.y,s=I.z,Z=-i.d;return!(S-N<Z||Z>N-j)&&(!(U-Q<Z||Z>Q-K)&&!(p-s<Z||Z>s-y))}intersectsSphere(I){return y.IntersectsSphere(this.minimumWorld,this.maximumWorld,I.centerWorld,I.radiusWorld)}intersectsMinMax(I,O){const C=this.minimumWorld,j=this.maximumWorld,K=C.x,i=C.y,y=C.z,S=j.x,U=j.y,p=j.z,N=I.x,Q=I.y,s=I.z,Z=O.x,q=O.y,mI=O.z;return!(S<N||K>Z)&&(!(U<Q||i>q)&&!(p<s||y>mI))}dispose(){var I,O;null===(I=this._drawWrapperFront)||void 0===I||I.dispose(),null===(O=this._drawWrapperBack)||void 0===O||O.dispose()}static Intersects(I,O){return I.intersectsMinMax(O.minimumWorld,O.maximumWorld)}static IntersectsSphere(I,O,C,j){const i=y._TmpVector3[0];K.mC.ClampToRef(C,I,O,i);return K.mC.DistanceSquared(C,i)<=j*j}static IsCompletelyInFrustum(I,O){for(let C=0;C<6;++C){const j=O[C];for(let O=0;O<8;++O)if(j.dotCoordinate(I[O])<0)return!1}return!0}static IsInFrustum(I,O){for(let C=0;C<6;++C){let j=!0;const K=O[C];for(let O=0;O<8;++O)if(K.dotCoordinate(I[O])>=0){j=!1;break}if(j)return!1}return!0}}y._TmpVector3=(0,j.e)(3,K.mC.Zero)},12580:(I,O,C)=>{C.d(O,{e:()=>Q});var j=C(12276),K=C(12272),i=C(12582),y=C(12590);const S={min:0,max:0},U={min:0,max:0},p=(I,O,C)=>{const j=K.mC.Dot(O.centerWorld,I),i=Math.abs(K.mC.Dot(O.directions[0],I))*O.extendSize.x+Math.abs(K.mC.Dot(O.directions[1],I))*O.extendSize.y+Math.abs(K.mC.Dot(O.directions[2],I))*O.extendSize.z;C.min=j-i,C.max=j+i},N=(I,O,C)=>(p(I,O,S),p(I,C,U),!(S.min>U.max||U.min>S.max));class Q{constructor(I,O,C){this._isLocked=!1,this.boundingBox=new i.e(I,O,C),this.boundingSphere=new y.c(I,O,C)}reConstruct(I,O,C){this.boundingBox.reConstruct(I,O,C),this.boundingSphere.reConstruct(I,O,C)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(I){this._isLocked=I}update(I){this._isLocked||(this.boundingBox._update(I),this.boundingSphere._update(I))}centerOn(I,O){const C=Q._TmpVector3[0].K(I).OQ(O),j=Q._TmpVector3[1].K(I).addInPlace(O);return this.boundingBox.reConstruct(C,j,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(C,j,this.boundingBox.getWorldMatrix()),this}encapsulate(I){const O=K.mC.Minimize(this.minimum,I),C=K.mC.Maximize(this.maximum,I);return this.reConstruct(O,C,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(I){const O=K.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(O);const C=K.TmpVectors.mC[0];return K.mC.TransformCoordinatesToRef(I.boundingBox.minimumWorld,O,C),this.encapsulate(C),K.mC.TransformCoordinatesToRef(I.boundingBox.maximumWorld,O,C),this.encapsulate(C),this}scale(I){return this.boundingBox.scale(I),this.boundingSphere.scale(I),this}isInFrustum(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===O||3===O)&&this.boundingSphere.isCenterInFrustum(I))return!0;if(!this.boundingSphere.isInFrustum(I))return!1;return!(1!==O&&3!==O)||this.boundingBox.isInFrustum(I)}get diagonalLength(){const I=this.boundingBox;return I.maximumWorld.subtractToRef(I.minimumWorld,Q._TmpVector3[0]).length()}isCompletelyInFrustum(I){return this.boundingBox.isCompletelyInFrustum(I)}_checkCollision(I){return I._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(I){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(I)&&!!this.boundingBox.intersectsPoint(I))}intersects(I,O){if(!y.c.Intersects(this.boundingSphere,I.boundingSphere))return!1;if(!i.e.Intersects(this.boundingBox,I.boundingBox))return!1;if(!O)return!0;const C=this.boundingBox,j=I.boundingBox;return!!N(C.directions[0],C,j)&&(!!N(C.directions[1],C,j)&&(!!N(C.directions[2],C,j)&&(!!N(j.directions[0],C,j)&&(!!N(j.directions[1],C,j)&&(!!N(j.directions[2],C,j)&&(!!N(K.mC.Cross(C.directions[0],j.directions[0]),C,j)&&(!!N(K.mC.Cross(C.directions[0],j.directions[1]),C,j)&&(!!N(K.mC.Cross(C.directions[0],j.directions[2]),C,j)&&(!!N(K.mC.Cross(C.directions[1],j.directions[0]),C,j)&&(!!N(K.mC.Cross(C.directions[1],j.directions[1]),C,j)&&(!!N(K.mC.Cross(C.directions[1],j.directions[2]),C,j)&&(!!N(K.mC.Cross(C.directions[2],j.directions[0]),C,j)&&(!!N(K.mC.Cross(C.directions[2],j.directions[1]),C,j)&&!!N(K.mC.Cross(C.directions[2],j.directions[2]),C,j))))))))))))))}}Q._TmpVector3=(0,j.e)(2,K.mC.Zero)},12590:(I,O,C)=>{C.d(O,{c:()=>i});var j=C(12276),K=C(12272);class i{constructor(I,O,C){this.center=K.mC.Zero(),this.centerWorld=K.mC.Zero(),this.minimum=K.mC.Zero(),this.maximum=K.mC.Zero(),this.reConstruct(I,O,C)}reConstruct(I,O,C){this.minimum.K(I),this.maximum.K(O);const j=K.mC.Distance(I,O);O.addToRef(I,this.center).scaleInPlace(.5),this.radius=.5*j,this._update(C||K.Matrix.IdentityReadOnly)}scale(I){const O=this.radius*I,C=i._TmpVector3,j=C[0].XS(O),K=this.center.subtractToRef(j,C[1]),y=this.center.addToRef(j,C[2]);return this.reConstruct(K,y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(I){if(I.isIdentity())this.centerWorld.K(this.center),this.radiusWorld=this.radius;else{K.mC.TransformCoordinatesToRef(this.center,I,this.centerWorld);const O=i._TmpVector3[0];K.mC.TransformNormalFromFloatsToRef(1,1,1,I,O),this.radiusWorld=Math.max(Math.abs(O.x),Math.abs(O.y),Math.abs(O.z))*this.radius}}isInFrustum(I){const O=this.centerWorld,C=this.radiusWorld;for(let j=0;j<6;j++)if(I[j].dotCoordinate(O)<=-C)return!1;return!0}isCenterInFrustum(I){const O=this.centerWorld;for(let C=0;C<6;C++)if(I[C].dotCoordinate(O)<0)return!1;return!0}intersectsPoint(I){const O=K.mC.DistanceSquared(this.centerWorld,I);return!(this.radiusWorld*this.radiusWorld<O)}static Intersects(I,O){const C=K.mC.DistanceSquared(I.centerWorld,O.centerWorld),j=I.radiusWorld+O.radiusWorld;return!(j*j<C)}static CreateFromCenterAndRadius(I,O,C){this._TmpVector3[0].K(I),this._TmpVector3[1].cS(0,0,O),this._TmpVector3[2].K(I),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].OQ(this._TmpVector3[1]);const j=new i(this._TmpVector3[0],this._TmpVector3[2]);return j._worldMatrix=C||K.Matrix.Identity(),j}}i._TmpVector3=(0,j.e)(3,K.mC.Zero)},12599:(I,O,C)=>{function j(I){-1===I.indexOf("vClipPlane")&&I.push("vClipPlane"),-1===I.indexOf("vClipPlane2")&&I.push("vClipPlane2"),-1===I.indexOf("vClipPlane3")&&I.push("vClipPlane3"),-1===I.indexOf("vClipPlane4")&&I.push("vClipPlane4"),-1===I.indexOf("vClipPlane5")&&I.push("vClipPlane5"),-1===I.indexOf("vClipPlane6")&&I.push("vClipPlane6")}function K(I,O,C){const j=!!(I.clipPlane??O.clipPlane),K=!!(I.clipPlane2??O.clipPlane2),i=!!(I.clipPlane3??O.clipPlane3),y=!!(I.clipPlane4??O.clipPlane4),S=!!(I.clipPlane5??O.clipPlane5),U=!!(I.clipPlane6??O.clipPlane6);j&&C.push("#define CLIPPLANE"),K&&C.push("#define CLIPPLANE2"),i&&C.push("#define CLIPPLANE3"),y&&C.push("#define CLIPPLANE4"),S&&C.push("#define CLIPPLANE5"),U&&C.push("#define CLIPPLANE6")}function i(I,O,C){let j=!1;const K=!!(I.clipPlane??O.clipPlane),i=!!(I.clipPlane2??O.clipPlane2),y=!!(I.clipPlane3??O.clipPlane3),S=!!(I.clipPlane4??O.clipPlane4),U=!!(I.clipPlane5??O.clipPlane5),p=!!(I.clipPlane6??O.clipPlane6);return C.CLIPPLANE!==K&&(C.CLIPPLANE=K,j=!0),C.CLIPPLANE2!==i&&(C.CLIPPLANE2=i,j=!0),C.CLIPPLANE3!==y&&(C.CLIPPLANE3=y,j=!0),C.CLIPPLANE4!==S&&(C.CLIPPLANE4=S,j=!0),C.CLIPPLANE5!==U&&(C.CLIPPLANE5=U,j=!0),C.CLIPPLANE6!==p&&(C.CLIPPLANE6=p,j=!0),j}function y(I,O,C){let j=O.clipPlane??C.clipPlane;S(I,"vClipPlane",j),j=O.clipPlane2??C.clipPlane2,S(I,"vClipPlane2",j),j=O.clipPlane3??C.clipPlane3,S(I,"vClipPlane3",j),j=O.clipPlane4??C.clipPlane4,S(I,"vClipPlane4",j),j=O.clipPlane5??C.clipPlane5,S(I,"vClipPlane5",j),j=O.clipPlane6??C.clipPlane6,S(I,"vClipPlane6",j)}function S(I,O,C){C&&I.setFloat4(O,C.normal.x,C.normal.y,C.normal.z,C.d)}C.d(O,{d:()=>j,g:()=>y,i:()=>i,j:()=>K})},12556:(I,O,C)=>{C.d(O,{e:()=>j});class j{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(I,O){this._defines[I]||(I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I),this._defines[I]=new Array),this._defines[I].push(O)}addCPUSkinningFallback(I,O){this._mesh=O,I<this._currentRank&&(this._currentRank=I),I>this._maxRank&&(this._maxRank=I)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(I,O){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,I=I.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),O._bonesComputationForcedToCPU=!0;const C=this._mesh.nI();for(let I=0;I<C.meshes.length;I++){const j=C.meshes[I];if(j.material){if(j.computeBonesUsingShaders&&0!==j.numBoneInfluencers)if(j.material.getEffect()===O)j.computeBonesUsingShaders=!1;else if(j.ZS)for(const I of j.ZS){if(I.effect===O){j.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&j.computeBonesUsingShaders&&j.numBoneInfluencers>0&&(j.computeBonesUsingShaders=!1)}}else{const O=this._defines[this._currentRank];if(O)for(let C=0;C<O.length;C++)I=I.replace("#define "+O[C],"");this._currentRank++}return I}}},12568:(I,O,C)=>{C.d(O,{e:()=>E});var j=C(12250),K=C(12257),i=C(12083),y=C(12088),S=C(12132),U=C(12571),p=C(12511),N=C(12103),Q=C(12310),s=C(12380),Z=C(12296);class q{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(I){this._func=I}get funcRef(){return this._funcRef}set funcRef(I){this._funcRef=I}get funcMask(){return this._funcMask}set funcMask(I){this._funcMask=I}get opStencilFail(){return this._opStencilFail}set opStencilFail(I){this._opStencilFail=I}get opDepthFail(){return this._opDepthFail}set opDepthFail(I){this._opDepthFail=I}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(I){this._opStencilDepthPass=I}get mask(){return this._mask}set mask(I){this._mask=I}get enabled(){return this._enabled}set enabled(I){this._enabled=I}getClassName(){return"MaterialStencilState"}copyTo(I){Z.e.Clone((()=>I),this)}serialize(){return Z.e.Serialize(this)}parse(I,O,C){Z.e.Parse((()=>this),I,O,C)}}(0,j.e)([(0,K.E)()],q.prototype,"func",null),(0,j.e)([(0,K.E)()],q.prototype,"funcRef",null),(0,j.e)([(0,K.E)()],q.prototype,"funcMask",null),(0,j.e)([(0,K.E)()],q.prototype,"opStencilFail",null),(0,j.e)([(0,K.E)()],q.prototype,"opDepthFail",null),(0,j.e)([(0,K.E)()],q.prototype,"opStencilDepthPass",null),(0,j.e)([(0,K.E)()],q.prototype,"mask",null),(0,j.e)([(0,K.E)()],q.prototype,"enabled",null);var mI=C(12596);class E{get _supportGlowLayer(){return!1}set _glowModeEnabled(I){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(I){if(this._alpha===I)return;const O=this._alpha;this._alpha=I,1!==O&&1!==I||this.zp(E.MiscDirtyFlag+E.PrePassDirtyFlag)}get alpha(){return this._alpha}set oS(I){this._backFaceCulling!==I&&(this._backFaceCulling=I,this.zp(E.TextureDirtyFlag))}get oS(){return this._backFaceCulling}set cullBackFaces(I){this._cullBackFaces!==I&&(this._cullBackFaces=I,this.zp(E.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(I){this._blockDirtyMechanism!==I&&(this._blockDirtyMechanism=I,I||this.eQ())}atomicMaterialsUpdate(I){this.blockDirtyMechanism=!0;try{I(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(I){this._onDisposeObserver&&this.yS.remove(this._onDisposeObserver),this._onDisposeObserver=this.yS.add(I)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new y.c),this._onBindObservable}set onBind(I){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(I)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new y.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new y.c),this._onEffectCreatedObservable}set alphaMode(I){this._alphaMode!==I&&(this._alphaMode=I,this.zp(E.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(I){this._needDepthPrePass!==I&&(this._needDepthPrePass=I,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(I){this._fogEnabled!==I&&(this._fogEnabled=I,this.zp(E.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case E.WireFrameFillMode:case E.LineListDrawMode:case E.LineLoopDrawMode:case E.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(I){this.fillMode=I?E.WireFrameFillMode:E.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case E.PointFillMode:case E.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(I){this.fillMode=I?E.PointFillMode:E.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(I){this._fillMode!==I&&(this._fillMode=I,this.zp(E.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){const O=this.nI().getEngine().getCaps().fragmentDepthSupported;I&&!O&&N.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=I&&O,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(I){this._drawWrapper=I}constructor(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.yS=new y.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.SS=new q,this._useUBO=!1,this._fillMode=E.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=I;const K=O||S.e.LastCreatedScene;K&&(this._scene=K,this._dirtyCallbacks={},this._forceGLSL=j,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=I||i.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new s.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new p.c(this._scene.getEngine(),void 0,void 0,I),this._useUBO=this.nI().getEngine().supportsUniformBuffers,this._createUniformBuffer(),C||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),E.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var I;const O=this.nI().getEngine();null===(I=this._uniformBuffer)||void 0===I||I.dispose(),O.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new p.c(O,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new p.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(I){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.eQ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.eQ(),this.checkReadyOnlyOnce=!1}isReady(I,O){return!0}isReadyForSubMesh(I,O,C){const j=O.materialDefines;return!!j&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=j,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}nI(){return this._scene}_getEffectiveOrientation(I){return null!==this.sideOrientation?this.sideOrientation:I.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(I){this._transparencyMode!==I&&(this._transparencyMode=I,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===E.MATERIAL_ALPHABLEND||this._transparencyMode===E.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===E.MATERIAL_ALPHATEST||this._transparencyMode===E.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===E.MATERIAL_OPAQUE||this._transparencyMode===E.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(I){return this._hasTransparencyMode?this._transparencyModeIsBlend:I.visibility<1||!this._disableAlphaBlending&&(I.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(I){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(I)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}eQ(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.nI().meshes;for(const C of O)if(C.ZS)for(const O of C.ZS)if(O.DI()===this)for(const C of O._drawWrappers)C&&this._materialContext===C.materialContext&&(C._wasPreviouslyReady=!1,C._wasPreviouslyUsingInstances=null,C._forceRebindOnNextCall=I);I&&this.zp(E.AllDirtyFlag)}_preBind(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.getEngine(),j=(null==O?this.sideOrientation:O)===E.ClockWiseSideOrientation;return C.enableEffect(I||this._getDrawWrapper()),C.setState(this.oS,this.zOffset,!1,j,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.SS,this.zOffsetUnits),j}bind(I,O){}buildUniformLayout(){const I=this._uniformBuffer;this._eventInfo.ubo=I,this._callbackPluginEventGeneric(8,this._eventInfo),I.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(I,O,C){const j=C._drawWrapper;this._eventInfo.subMesh=C,this._callbackPluginEventBindForSubMesh(this._eventInfo),j._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(I){}bindView(I){this._useUBO?this._needToBindSceneUbo=!0:I.setMatrix("view",this.nI().getViewMatrix())}bindViewProjection(I){this._useUBO?this._needToBindSceneUbo=!0:(I.setMatrix("viewProjection",this.nI().getTransformMatrix()),I.setMatrix("projection",this.nI().getProjectionMatrix()))}bindEyePosition(I,O){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(I,O)}_afterBind(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&O&&(this._needToBindSceneUbo=!1,(0,mI.w)(O,this.nI().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=I?I.visibility:1,this._onBindObservable&&I&&this._onBindObservable.notifyObservers(I),this.disableDepthWrite){const I=this._scene.getEngine();this._cachedDepthWriteState=I.getDepthWrite(),I.setDepthWrite(!1)}if(this.disableColorWrite){const I=this._scene.getEngine();this._cachedColorWriteState=I.getColorWrite(),I.setColorWrite(!1)}if(0!==this.depthFunction){const I=this._scene.getEngine();this._cachedDepthFunctionState=I.getDepthFunction()||0,I.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(I){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=I,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(I){return null}_clonePlugins(I,O){const C={};if(this._serializePlugins(C),E._ParsePlugins(C,I,this._scene,O),this.pluginManager)for(const j of this.pluginManager._plugins){const O=I.pluginManager.getPlugin(j.name);O&&j.copyTo(O)}}getBindedMeshes(){if(this.meshMap){const I=[];for(const O in this.meshMap){const C=this.meshMap[O];C&&I.push(C)}return I}return this._scene.meshes.filter((I=>I.material===this))}forceCompilation(I,O,C,j){const K={clipPlane:!1,useInstances:!1,...C},i=this.nI(),y=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const S=()=>{if(!this._scene||!this._scene.getEngine())return;const C=i.clipPlane;if(K.clipPlane&&(i.clipPlane=new Q.e(0,0,0,1)),this._storeEffectOnSubMeshes){let C=!0,i=null;if(I.ZS){const O=new U.d(0,0,0,0,0,I,void 0,!1,!1);O.materialDefines&&(O.materialDefines._renderId=-1),this.isReadyForSubMesh(I,O,K.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?i=O.effect.getCompilationError():(C=!1,setTimeout(S,16)))}C&&(this.allowShaderHotSwapping=y,i&&j&&j(i),O&&O(this))}else this.isReady()?(this.allowShaderHotSwapping=y,O&&O(this)):setTimeout(S,16);K.clipPlane&&(i.clipPlane=C)};S()}async forceCompilationAsync(I,O){return await new Promise(((C,j)=>{this.forceCompilation(I,(()=>{C()}),O,(I=>{j(I)}))}))}zp(I){this.nI().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(E._DirtyCallbackArray.length=0,I&E.ImageProcessingDirtyFlag&&E._DirtyCallbackArray.push(E._ImageProcessingDirtyCallBack),I&E.TextureDirtyFlag&&E._DirtyCallbackArray.push(E._TextureDirtyCallBack),I&E.LightDirtyFlag&&E._DirtyCallbackArray.push(E._LightsDirtyCallBack),I&E.FresnelDirtyFlag&&E._DirtyCallbackArray.push(E._FresnelDirtyCallBack),I&E.AttributesDirtyFlag&&E._DirtyCallbackArray.push(E._AttributeDirtyCallBack),I&E.MiscDirtyFlag&&E._DirtyCallbackArray.push(E._MiscDirtyCallBack),I&E.PrePassDirtyFlag&&E._DirtyCallbackArray.push(E._PrePassDirtyCallBack),E._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(E._RunDirtyCallBacks),this.nI().resetCachedMaterial())}resetDrawCache(){const I=this.nI().meshes;for(const O of I)if(O.ZS)for(const I of O.ZS)I.DI()===this&&I.resetDrawCache()}_markAllSubMeshesAsDirty(I){const O=this.nI();if(O.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const C=O.meshes;for(const j of C)if(j.ZS)for(const C of j.ZS){if((C.DI()||(O._hasDefaultMaterial?O.defaultMaterial:null))===this)for(const O of C._drawWrappers)O&&O.defines&&O.defines.markAllAsDirty&&this._materialContext===O.materialContext&&I(O.defines)}}_markScenePrePassDirty(){if(this.nI().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const I=this.nI().enablePrePassRenderer();I&&I.zp()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(E._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(E._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(E._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(E._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(E._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(E._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(E._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(E._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(E._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(E._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const I=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.yS.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(I)}))}}setPrePassRenderer(I){return!1}dispose(I,O,C){const j=this.nI();if(j.stopAnimation(this),j.freeProcessedMaterials(),j.removeMaterial(this),this._eventInfo.forceDisposeTextures=O,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const I=this._parentContainer.materials.indexOf(this);I>-1&&this._parentContainer.materials.splice(I,1),this._parentContainer=null}if(!0!==C)if(this.meshMap)for(const K in this.meshMap){const I=this.meshMap[K];this._disposeMeshResources(I)}else{const I=j.meshes;for(const O of I)this._disposeMeshResources(O)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.yS.notifyObservers(this),this.yS.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(I){if(!I)return;const O=I.WS,C=I._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(I.ZS&&C)for(const K of I.ZS){const I=K._drawWrappers;for(let i=0;i<I.length;i++){var j;const y=null===(j=I[i])||void 0===j?void 0:j.effect;if(!y)continue;C[i]===this&&(null===O||void 0===O||O._releaseVertexArrayObject(y),K._removeDrawWrapper(i,!0,!0))}}}else null===O||void 0===O||O._releaseVertexArrayObject(this._drawWrapper.effect);I.material!==this||I.sourceMesh||(I.material=null)}serialize(){const I=Z.e.Serialize(this);return I.SS=this.SS.serialize(),I.uniqueId=this.uniqueId,this._serializePlugins(I),I}_serializePlugins(I){if(I.plugins={},this.pluginManager)for(const O of this.pluginManager._plugins)O.doNotSerialize||(I.plugins[O.getClassName()]=O.serialize())}static Parse(I,O,C){if(I.customType){if("BABYLON.PBRMaterial"===I.customType&&I.overloadedAlbedo&&(I.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return N.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else I.customType="BABYLON.StandardMaterial";const j=i.Tools.Instantiate(I.customType).Parse(I,O,C);return j._loadedUniqueId=I.uniqueId,j}static _ParsePlugins(I,O,C,j){if(I.plugins)for(const S in I.plugins){var K,y;const U=I.plugins[S];let p=null===(K=O.pluginManager)||void 0===K?void 0:K.getPlugin(U.name);if(!p){const I=i.Tools.Instantiate("BABYLON."+S);I&&(p=new I(O))}null===(y=p)||void 0===y||y.parse(U,C,j)}}}E.TriangleFillMode=0,E.WireFrameFillMode=1,E.PointFillMode=2,E.PointListDrawMode=3,E.LineListDrawMode=4,E.LineLoopDrawMode=5,E.LineStripDrawMode=6,E.TriangleStripDrawMode=7,E.TriangleFanDrawMode=8,E.ClockWiseSideOrientation=0,E.CounterClockWiseSideOrientation=1,E.ImageProcessingDirtyFlag=64,E.TextureDirtyFlag=1,E.LightDirtyFlag=2,E.FresnelDirtyFlag=4,E.AttributesDirtyFlag=8,E.MiscDirtyFlag=16,E.PrePassDirtyFlag=32,E.AllDirtyFlag=127,E.MATERIAL_OPAQUE=0,E.MATERIAL_ALPHATEST=1,E.MATERIAL_ALPHABLEND=2,E.MATERIAL_ALPHATESTANDBLEND=3,E.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,E.MATERIAL_NORMALBLENDMETHOD_RNM=1,E.OnEventObservable=new y.c,E._AllDirtyCallBack=I=>I.markAllAsDirty(),E._ImageProcessingDirtyCallBack=I=>I.markAsImageProcessingDirty(),E._TextureDirtyCallBack=I=>I.markAsTexturesDirty(),E._FresnelDirtyCallBack=I=>I.markAsFresnelDirty(),E._MiscDirtyCallBack=I=>I.markAsMiscDirty(),E._PrePassDirtyCallBack=I=>I.markAsPrePassDirty(),E._LightsDirtyCallBack=I=>I.markAsLightDirty(),E._AttributeDirtyCallBack=I=>I.markAsAttributesDirty(),E._FresnelAndMiscDirtyCallBack=I=>{E._FresnelDirtyCallBack(I),E._MiscDirtyCallBack(I)},E._TextureAndMiscDirtyCallBack=I=>{E._TextureDirtyCallBack(I),E._MiscDirtyCallBack(I)},E._DirtyCallbackArray=[],E._RunDirtyCallBacks=I=>{for(const O of E._DirtyCallbackArray)O(I)},(0,j.e)([(0,K.E)()],E.prototype,"id",void 0),(0,j.e)([(0,K.E)()],E.prototype,"uniqueId",void 0),(0,j.e)([(0,K.E)()],E.prototype,"name",void 0),(0,j.e)([(0,K.E)()],E.prototype,"metadata",void 0),(0,j.e)([(0,K.E)()],E.prototype,"checkReadyOnEveryCall",void 0),(0,j.e)([(0,K.E)()],E.prototype,"checkReadyOnlyOnce",void 0),(0,j.e)([(0,K.E)()],E.prototype,"state",void 0),(0,j.e)([(0,K.E)("alpha")],E.prototype,"_alpha",void 0),(0,j.e)([(0,K.E)("oS")],E.prototype,"_backFaceCulling",void 0),(0,j.e)([(0,K.E)("cullBackFaces")],E.prototype,"_cullBackFaces",void 0),(0,j.e)([(0,K.E)()],E.prototype,"sideOrientation",void 0),(0,j.e)([(0,K.E)("alphaMode")],E.prototype,"_alphaMode",void 0),(0,j.e)([(0,K.E)()],E.prototype,"_needDepthPrePass",void 0),(0,j.e)([(0,K.E)()],E.prototype,"disableDepthWrite",void 0),(0,j.e)([(0,K.E)()],E.prototype,"disableColorWrite",void 0),(0,j.e)([(0,K.E)()],E.prototype,"forceDepthWrite",void 0),(0,j.e)([(0,K.E)()],E.prototype,"depthFunction",void 0),(0,j.e)([(0,K.E)()],E.prototype,"separateCullingPass",void 0),(0,j.e)([(0,K.E)("fogEnabled")],E.prototype,"_fogEnabled",void 0),(0,j.e)([(0,K.E)()],E.prototype,"pointSize",void 0),(0,j.e)([(0,K.E)()],E.prototype,"zOffset",void 0),(0,j.e)([(0,K.E)()],E.prototype,"zOffsetUnits",void 0),(0,j.e)([(0,K.E)()],E.prototype,"pointsCloud",null),(0,j.e)([(0,K.E)()],E.prototype,"fillMode",null),(0,j.e)([(0,K.E)()],E.prototype,"useLogarithmicDepth",null),(0,j.e)([(0,K.E)()],E.prototype,"transparencyMode",null)},12596:(I,O,C)=>{C.d(O,{A:()=>r,E:()=>T,G:()=>W,I:()=>n,K:()=>X,N:()=>Z,Q:()=>s,U:()=>u,Y:()=>M,_:()=>b,cb:()=>h,d:()=>Y,gb:()=>H,h:()=>Q,ib:()=>J,l:()=>c,mb:()=>f,o:()=>N,ob:()=>l,qb:()=>D,s:()=>mI,sb:()=>q,w:()=>E});var j=C(12103),K=C(12307),i=C(12132),y=C(12553),S=C(12599);const U=K.WO.Black(),p={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function N(I,O,C){if(!I||I.LOGARITHMICDEPTH||I.indexOf&&I.indexOf("LOGARITHMICDEPTH")>=0){const I=C.activeCamera;1===I.mode&&j.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),O.setFloat("logarithmicDepthConstant",2/(Math.log(I.maxZ+1)/Math.LN2))}}function Q(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];C&&I.fogEnabled&&(!O||O.applyFog)&&0!==I.fogMode&&(C.setFloat4("vFogInfos",I.fogMode,I.fogStart,I.fogEnd,I.fogDensity),j?(I.fogColor.toLinearSpaceToRef(U,I.getEngine().useExactSrgbConversions),C.setColor3("vFogColor",U)):C.setColor3("vFogColor",I.fogColor))}function s(I,O,C,j,K,i,y,S,U,N){const Q=I.numMaxInfluencers||I.numInfluencers;return Q<=0?0:(O.push("#define MORPHTARGETS"),I.hasPositions&&O.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),I.hasNormals&&O.push("#define MORPHTARGETTEXTURE_HASNORMALS"),I.hasTangents&&O.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),I.hasUVs&&O.push("#define MORPHTARGETTEXTURE_HASUVS"),I.hasUV2s&&O.push("#define MORPHTARGETTEXTURE_HASUV2S"),I.hasColors&&O.push("#define MORPHTARGETTEXTURE_HASCOLORS"),I.supportsPositions&&K&&O.push("#define MORPHTARGETS_POSITION"),I.supportsNormals&&i&&O.push("#define MORPHTARGETS_NORMAL"),I.supportsTangents&&y&&O.push("#define MORPHTARGETS_TANGENT"),I.supportsUVs&&S&&O.push("#define MORPHTARGETS_UV"),I.supportsUV2s&&U&&O.push("#define MORPHTARGETS_UV2"),I.supportsColors&&N&&O.push("#define MORPHTARGETS_COLOR"),O.push("#define NUM_MORPH_INFLUENCERS "+Q),I.isUsingTextureForTargets&&O.push("#define MORPHTARGETS_TEXTURE"),p.NUM_MORPH_INFLUENCERS=Q,p.NORMAL=i,p.TANGENT=y,p.UV=S,p.UV2=U,p.COLOR=N,Z(C,j,p,K),Q)}function Z(I,O,C){let K=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=C.NUM_MORPH_INFLUENCERS;if(y>0&&i.e.LastCreatedEngine){const S=i.e.LastCreatedEngine.getCaps().maxVertexAttribs,U=O.morphTargetManager;if(null!==U&&void 0!==U&&U.isUsingTextureForTargets)return;const p=U&&U.supportsPositions&&K,N=U&&U.supportsNormals&&C.NORMAL,Q=U&&U.supportsTangents&&C.TANGENT,s=U&&U.supportsUVs&&C.UV1,Z=U&&U.supportsUV2s&&C.UV2,q=U&&U.supportsColors&&C.VERTEXCOLOR;for(let C=0;C<y;C++)p&&I.push("position"+C),N&&I.push("normal"+C),Q&&I.push("tangent"+C),s&&I.push("uv_"+C),Z&&I.push("uv2_"+C),q&&I.push("color"+C),I.length>S&&j.c.Error("Cannot add more vertex attributes for mesh "+O.name)}}function q(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I.push("world0"),I.push("world1"),I.push("world2"),I.push("world3"),O&&(I.push("previousWorld0"),I.push("previousWorld1"),I.push("previousWorld2"),I.push("previousWorld3"))}function mI(I,O){const C=I.morphTargetManager;I&&C&&O.setFloatArray("morphTargetInfluences",C.influences)}function E(I,O){O.bindToEffect(I,"Scene")}function h(I,O,C){O._needUVs=!0,O[C]=!0,I.optimizeUVAllocation&&I.getTextureMatrix().isIdentityAs3x2()?(O[C+"DIRECTUV"]=I.coordinatesIndex+1,O["MAINUV"+(I.coordinatesIndex+1)]=!0):O[C+"DIRECTUV"]=0}function r(I,O,C){const j=I.getTextureMatrix();O.hS(C+"Matrix",j)}function W(I,O,C){C.BAKED_VERTEX_ANIMATION_TEXTURE&&C.INSTANCES&&I.push("bakedVertexAnimationSettingsInstanced")}function Y(I,O,C){var j;if(O&&I&&(I.computeBonesUsingShaders&&O._bonesComputationForcedToCPU&&(I.computeBonesUsingShaders=!1),I.useBones&&I.computeBonesUsingShaders&&I.skeleton)){const K=I.skeleton;if(K.isUsingTextureForMatrices&&O.getUniformIndex("boneTextureWidth")>-1){const C=K.getTransformMatrixTexture(I);O.setTexture("boneSampler",C),O.setFloat("boneTextureWidth",4*(K.bones.length+1))}else{const i=K.getTransformMatrices(I);i&&(O.setMatrices("mBones",i),C&&I.nI().prePassRenderer&&I.nI().prePassRenderer.getIndex(2)&&(C.previousBones[I.uniqueId]||(C.previousBones[I.uniqueId]=i.slice()),O.setMatrices("mPreviousBones",C.previousBones[I.uniqueId]),j=i,C.previousBones[I.uniqueId].set(j)))}}}function o(I,O,C,j,K){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];I._bindLight(O,C,j,K,i)}function c(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const i=Math.min(O.lightSources.length,K);for(let y=0;y<i;y++){o(O.lightSources[y],y,I,C,"boolean"===typeof j?j:j.SPECULARTERM,O.receiveShadows)}}function n(I,O,C,j){C.NUM_BONE_INFLUENCERS>0&&(j.addCPUSkinningFallback(0,O),I.push("matricesIndices"),I.push("matricesWeights"),C.NUM_BONE_INFLUENCERS>4&&(I.push("matricesIndicesExtra"),I.push("matricesWeightsExtra")))}function X(I,O){(O.INSTANCES||O.THIN_INSTANCES)&&q(I,!!O.PREPASS_VELOCITY),O.INSTANCESCOLOR&&I.push("instanceColor")}function T(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=0;for(let i=0;i<C&&I["LIGHT"+i];i++)i>0&&(K=j+i,O.addFallback(K,"LIGHT"+i)),I.SHADOWS||(I["SHADOW"+i]&&O.addFallback(j,"SHADOW"+i),I["SHADOWPCF"+i]&&O.addFallback(j,"SHADOWPCF"+i),I["SHADOWPCSS"+i]&&O.addFallback(j,"SHADOWPCSS"+i),I["SHADOWPOISSON"+i]&&O.addFallback(j,"SHADOWPOISSON"+i),I["SHADOWESM"+i]&&O.addFallback(j,"SHADOWESM"+i),I["SHADOWCLOSEESM"+i]&&O.addFallback(j,"SHADOWCLOSEESM"+i));return K++}function H(I,O,C,j,K,i,y){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];y._areMiscDirty&&(y.LOGARITHMICDEPTH=C,y.POINTSIZE=j,y.FOG=K&&function(I,O){return O.fogEnabled&&I.applyFog&&0!==O.fogMode}(I,O),y.NONUNIFORMSCALING=I.nonUniformScaling,y.ALPHATEST=i,y.DECAL_AFTER_DETAIL=S)}function b(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!C._areLightsDirty)return C._needNormals;let y=0;const S={needNormals:C._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(I.lightsEnabled&&!i)for(const p of O.lightSources)if(a(I,O,p,y,C,j,S),y++,y===K)break;C.SPECULARTERM=S.specularEnabled,C.SHADOWS=S.shadowEnabled;for(let p=y;p<K;p++)void 0!==C["LIGHT"+p]&&(C["LIGHT"+p]=!1,C["HEMILIGHT"+p]=!1,C["POINTLIGHT"+p]=!1,C["DIRLIGHT"+p]=!1,C["SPOTLIGHT"+p]=!1,C["AREALIGHT"+p]=!1,C["SHADOW"+p]=!1,C["SHADOWCSM"+p]=!1,C["SHADOWCSMDEBUG"+p]=!1,C["SHADOWCSMNUM_CASCADES"+p]=!1,C["SHADOWCSMUSESHADOWMAXZ"+p]=!1,C["SHADOWCSMNOBLEND"+p]=!1,C["SHADOWCSM_RIGHTHANDED"+p]=!1,C["SHADOWPCF"+p]=!1,C["SHADOWPCSS"+p]=!1,C["SHADOWPOISSON"+p]=!1,C["SHADOWESM"+p]=!1,C["SHADOWCLOSEESM"+p]=!1,C["SHADOWCUBE"+p]=!1,C["SHADOWLOWQUALITY"+p]=!1,C["SHADOWMEDIUMQUALITY"+p]=!1);const U=I.getEngine().getCaps();return void 0===C.SHADOWFLOAT&&(S.needRebuild=!0),C.SHADOWFLOAT=S.shadowEnabled&&(U.textureFloatRender&&U.textureFloatLinearFiltering||U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering),C.LIGHTMAPEXCLUDED=S.lightmapMode,S.needRebuild&&C.rebuild(),S.needNormals}function a(I,O,C,j,K,i,S){switch(S.needNormals=!0,void 0===K["LIGHT"+j]&&(S.needRebuild=!0),K["LIGHT"+j]=!0,K["SPOTLIGHT"+j]=!1,K["HEMILIGHT"+j]=!1,K["POINTLIGHT"+j]=!1,K["DIRLIGHT"+j]=!1,K["AREALIGHT"+j]=!1,C.prepareLightSpecificDefines(K,j),K["LIGHT_FALLOFF_PHYSICAL"+j]=!1,K["LIGHT_FALLOFF_GLTF"+j]=!1,K["LIGHT_FALLOFF_STANDARD"+j]=!1,C.falloffType){case y.d.FALLOFF_GLTF:K["LIGHT_FALLOFF_GLTF"+j]=!0;break;case y.d.FALLOFF_PHYSICAL:K["LIGHT_FALLOFF_PHYSICAL"+j]=!0;break;case y.d.FALLOFF_STANDARD:K["LIGHT_FALLOFF_STANDARD"+j]=!0}if(i&&!C.ZN.equalsFloats(0,0,0)&&(S.specularEnabled=!0),K["SHADOW"+j]=!1,K["SHADOWCSM"+j]=!1,K["SHADOWCSMDEBUG"+j]=!1,K["SHADOWCSMNUM_CASCADES"+j]=!1,K["SHADOWCSMUSESHADOWMAXZ"+j]=!1,K["SHADOWCSMNOBLEND"+j]=!1,K["SHADOWCSM_RIGHTHANDED"+j]=!1,K["SHADOWPCF"+j]=!1,K["SHADOWPCSS"+j]=!1,K["SHADOWPOISSON"+j]=!1,K["SHADOWESM"+j]=!1,K["SHADOWCLOSEESM"+j]=!1,K["SHADOWCUBE"+j]=!1,K["SHADOWLOWQUALITY"+j]=!1,K["SHADOWMEDIUMQUALITY"+j]=!1,O&&O.receiveShadows&&I.shadowsEnabled&&C.shadowEnabled){const O=C.getShadowGenerator(I.activeCamera)??C.getShadowGenerator();if(O){const I=O.getShadowMap();I&&I.renderList&&I.renderList.length>0&&(S.shadowEnabled=!0,O.prepareDefines(K,j))}}C.lightmapMode!=y.d.LIGHTMAP_DEFAULT?(S.lightmapMode=!0,K["LIGHTMAPEXCLUDED"+j]=!0,K["LIGHTMAPNOSPECULAR"+j]=C.lightmapMode==y.d.LIGHTMAP_SHADOWSONLY):(K["LIGHTMAPEXCLUDED"+j]=!1,K["LIGHTMAPNOSPECULAR"+j]=!1)}function M(I,O,C,j,K){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=function(I,O){let C=!1;if(I.activeCamera){const j=O.CAMERA_ORTHOGRAPHIC?1:0,K=O.CAMERA_PERSPECTIVE?1:0,i=1===I.activeCamera.mode?1:0,y=0===I.activeCamera.mode?1:0;(j^i||K^y)&&(O.CAMERA_ORTHOGRAPHIC=1===i,O.CAMERA_PERSPECTIVE=1===y,C=!0)}return C}(I,j);!1!==i&&(U=(0,S.i)(C,I,j)),j.DEPTHPREPASS!==!O.getColorWrite()&&(j.DEPTHPREPASS=!j.DEPTHPREPASS,U=!0),j.INSTANCES!==K&&(j.INSTANCES=K,U=!0),j.THIN_INSTANCES!==y&&(j.THIN_INSTANCES=y,U=!0),U&&j.markAsUnprocessed()}function u(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!O._areAttributesDirty&&O._needNormals===O._normals&&O._needUVs===O._uvs)return!1;O._normals=O._needNormals,O._uvs=O._needUVs,O.NORMAL=O._needNormals&&I.isVerticesDataPresent("normal"),O._needNormals&&I.isVerticesDataPresent("tangent")&&(O.TANGENT=!0);for(let S=1;S<=6;++S)O["UV"+S]=!!O._needUVs&&I.isVerticesDataPresent(`uv${1===S?"":S}`);if(C){const C=I.useVertexColors&&I.isVerticesDataPresent("color");O.VERTEXCOLOR=C,O.VERTEXALPHA=I.hasVertexAlpha&&C&&i}return I.isVerticesDataPresent("instanceColor")&&(I.hasInstances||I.hasThinInstances)&&(O.INSTANCESCOLOR=!0),j&&function(I,O){if(I.useBones&&I.computeBonesUsingShaders&&I.skeleton){O.NUM_BONE_INFLUENCERS=I.numBoneInfluencers;const C=void 0!==O.BONETEXTURE;if(I.skeleton.isUsingTextureForMatrices&&C)O.BONETEXTURE=!0;else{O.BonesPerMesh=I.skeleton.bones.length+1,O.BONETEXTURE=!C&&void 0;const j=I.nI().prePassRenderer;if(j&&j.enabled){const C=-1===j.excludedSkinnedMesh.indexOf(I);O.BONES_VELOCITY_ENABLED=C}}}else O.NUM_BONE_INFLUENCERS=0,O.BonesPerMesh=0,void 0!==O.BONETEXTURE&&(O.BONETEXTURE=!1)}(I,O),K&&function(I,O){const C=I.morphTargetManager;C?(O.MORPHTARGETS_UV=C.supportsUVs&&O.UV1,O.MORPHTARGETS_UV2=C.supportsUV2s&&O.UV2,O.MORPHTARGETS_TANGENT=C.supportsTangents&&O.TANGENT,O.MORPHTARGETS_NORMAL=C.supportsNormals&&O.NORMAL,O.MORPHTARGETS_POSITION=C.supportsPositions,O.MORPHTARGETS_COLOR=C.supportsColors,O.MORPHTARGETTEXTURE_HASUVS=C.hasUVs,O.MORPHTARGETTEXTURE_HASUV2S=C.hasUV2s,O.MORPHTARGETTEXTURE_HASTANGENTS=C.hasTangents,O.MORPHTARGETTEXTURE_HASNORMALS=C.hasNormals,O.MORPHTARGETTEXTURE_HASPOSITIONS=C.hasPositions,O.MORPHTARGETTEXTURE_HASCOLORS=C.hasColors,O.NUM_MORPH_INFLUENCERS=C.numMaxInfluencers||C.numInfluencers,O.MORPHTARGETS=O.NUM_MORPH_INFLUENCERS>0,O.MORPHTARGETS_TEXTURE=C.isUsingTextureForTargets):(O.MORPHTARGETS_UV=!1,O.MORPHTARGETS_UV2=!1,O.MORPHTARGETS_TANGENT=!1,O.MORPHTARGETS_NORMAL=!1,O.MORPHTARGETS_POSITION=!1,O.MORPHTARGETS_COLOR=!1,O.MORPHTARGETTEXTURE_HASUVS=!1,O.MORPHTARGETTEXTURE_HASUV2S=!1,O.MORPHTARGETTEXTURE_HASTANGENTS=!1,O.MORPHTARGETTEXTURE_HASNORMALS=!1,O.MORPHTARGETTEXTURE_HASPOSITIONS=!1,O.MORPHTARGETTEXTURE_HAS_COLORS=!1,O.MORPHTARGETS=!1,O.NUM_MORPH_INFLUENCERS=0)}(I,O),y&&function(I,O){const C=I.bakedVertexAnimationManager;O.BAKED_VERTEX_ANIMATION_TEXTURE=!(!C||!C.isEnabled)}(I,O),!0}function J(I,O){if(I.activeCamera){const C=O.MULTIVIEW;O.MULTIVIEW=null!==I.activeCamera.outputRenderTarget&&I.activeCamera.outputRenderTarget.getViewCount()>1,O.MULTIVIEW!=C&&O.markAsUnprocessed()}}function f(I,O,C){const j=O.ORDER_INDEPENDENT_TRANSPARENCY,K=O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;O.ORDER_INDEPENDENT_TRANSPARENCY=I.useOrderIndependentTransparency&&C,O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!I.getEngine().getCaps().textureFloatLinearFiltering,j===O.ORDER_INDEPENDENT_TRANSPARENCY&&K===O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||O.markAsUnprocessed()}function l(I,O,C){const j=O.PREPASS;if(!O._arePrePassDirty)return;const K=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(I.prePassRenderer&&I.prePassRenderer.enabled&&C){O.PREPASS=!0,O.SCENE_MRT_COUNT=I.prePassRenderer.mrtCount,O.PREPASS_NORMAL_WORLDSPACE=I.prePassRenderer.generateNormalsInWorldSpace,O.PREPASS_COLOR=!0,O.PREPASS_COLOR_INDEX=0;for(let C=0;C<K.length;C++){const j=I.prePassRenderer.getIndex(K[C].type);-1!==j?(O[K[C].define]=!0,O[K[C].index]=j):O[K[C].define]=!1}}else{O.PREPASS=!1;for(let I=0;I<K.length;I++)O[K[I].define]=!1}O.PREPASS!=j&&(O.markAsUnprocessed(),O.markAsImageProcessingDirty())}function x(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];K&&K.push("Light"+I),i||(O.push("vLightData"+I,"vLightDiffuse"+I,"vLightSpecular"+I,"vLightDirection"+I,"vLightWidth"+I,"vLightHeight"+I,"vLightFalloff"+I,"vLightGround"+I,"lightMatrix"+I,"shadowsInfo"+I,"depthValues"+I),C.push("shadowTexture"+I),C.push("depthTexture"+I),O.push("viewFrustumZ"+I,"cascadeBlendFactor"+I,"lightSizeUVCorrection"+I,"depthCorrection"+I,"penumbraDarkness"+I,"frustumLengths"+I),j&&(C.push("projectionLightTexture"+I),O.push("textureProjectionMatrix"+I)),y&&C.push("iesLightTexture"+I))}function D(I,O,C){let j,K,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(I.uniformsNames){const y=I;j=y.uniformsNames,K=y.uniformBuffersNames,O=y.samplers,C=y.defines,i=y.maxSimultaneousLights||0}else j=I,O||(O=[]);for(let y=0;y<i&&C["LIGHT"+y];y++)x(y,j,O,C["PROJECTEDLIGHTTEXTURE"+y],K,!1,C["IESLIGHTTEXTURE"+y]);C.NUM_MORPH_INFLUENCERS&&(j.push("morphTargetInfluences"),j.push("morphTargetCount")),C.BAKED_VERTEX_ANIMATION_TEXTURE&&(j.push("bakedVertexAnimationSettings"),j.push("bakedVertexAnimationTextureSizeInverted"),j.push("bakedVertexAnimationTime"),O.push("bakedVertexAnimationTexture"))}},12565:(I,O,C)=>{C.d(O,{b:()=>i});var j=C(12272),K=C(12568);class i extends K.e{constructor(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(I,O,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new j.Matrix,this._storeEffectOnSubMeshes=C}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(I,O){return!!I&&(!this._storeEffectOnSubMeshes||(!I.ZS||0===I.ZS.length||this.isReadyForSubMesh(I,I.ZS[0],O)))}_isReadyForSubMesh(I){const O=I.materialDefines;return!(this.checkReadyOnEveryCall||!I.effect||!O||O._renderId!==this.nI().getRenderId())}bindOnlyWorldMatrix(I){this._activeEffect.setMatrix("world",I)}bindOnlyNormalMatrix(I){this._activeEffect.setMatrix("normalMatrix",I)}bind(I,O){O&&this.bindForSubMesh(I,O,O.ZS[0])}_afterBind(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;super._afterBind(I,O,C),this.nI()._cachedEffect=O,C?C._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return C._drawWrapper._forceRebindOnNextCall||I.isCachedMaterialInvalid(this,O,j)}dispose(I,O,C){this._activeEffect=void 0,super.dispose(I,O,C)}}},12594:(I,O,C)=>{C.d(O,{e:()=>S,g:()=>U});var j=C(12250),K=C(12272),i=C(12257);class y{static extractMinAndMaxIndexed(I,O,C,j,K,i){for(let y=C;y<C+j;y++){const C=3*O[y],j=I[C],S=I[C+1],U=I[C+2];K.minimizeInPlaceFromFloats(j,S,U),i.maximizeInPlaceFromFloats(j,S,U)}}static extractMinAndMax(I,O,C,j,K,i){for(let y=O,S=O*j;y<O+C;y++,S+=j){const O=I[S],C=I[S+1],j=I[S+2];K.minimizeInPlaceFromFloats(O,C,j),i.maximizeInPlaceFromFloats(O,C,j)}}}function S(I,O,C,j){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=new K.mC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new K.mC(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return y.extractMinAndMaxIndexed(I,O,C,j,S,U),i&&(S.x-=S.x*i.x+i.y,S.y-=S.y*i.x+i.y,S.z-=S.z*i.x+i.y,U.x+=U.x*i.x+i.y,U.y+=U.y*i.x+i.y,U.z+=U.z*i.x+i.y),{minimum:S,maximum:U}}function U(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;const S=new K.mC(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new K.mC(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return i||(i=3),y.extractMinAndMax(I,O,C,i,S,U),j&&(S.x-=S.x*j.x+j.y,S.y-=S.y*j.x+j.y,S.z-=S.z*j.x+j.y,U.x+=U.x*j.x+j.y,U.y+=U.y*j.x+j.y,U.z+=U.z*j.x+j.y),{minimum:S,maximum:U}}(0,j.e)([i.h.filter((function(){for(var I=arguments.length,O=new Array(I),C=0;C<I;C++)O[C]=arguments[C];let[j,K]=O;return!Array.isArray(j)&&!Array.isArray(K)}))],y,"extractMinAndMaxIndexed",null),(0,j.e)([i.h.filter((function(){for(var I=arguments.length,O=new Array(I),C=0;C<I;C++)O[C]=arguments[C];let[j]=O;return!Array.isArray(j)}))],y,"extractMinAndMax",null)},12571:(I,O,C)=>{C.d(O,{d:()=>U});var j=C(12329),K=C(12577),i=C(12580),y=C(12594),S=C(12380);class U{get materialDefines(){var I;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(I=this._getDrawWrapper())||void 0===I?void 0:I.defines}set materialDefines(I){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=I}_getDrawWrapper(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I??this._engine.currentRenderPassId;let C=this._drawWrappers[I];return!C&&O&&(this._drawWrappers[I]=C=new S.d(this._mesh.nI().getEngine())),C}_removeDrawWrapper(I){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var C;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(C=this._drawWrappers[I])||void 0===C||C.dispose(O));this._drawWrappers[I]=void 0}get effect(){var I;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(I=this._getDrawWrapper())||void 0===I?void 0:I.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(I){this._mainDrawWrapperOverride=I}setEffect(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const K=this._drawWrapper;K.setEffect(I,O,j),void 0!==C&&(K.materialContext=C),I||(K.defines=null,K.materialContext=void 0)}resetDrawCache(I){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==I)return void this._removeDrawWrapper(I,!0,O);for(const I of this._drawWrappers)null===I||void 0===I||I.dispose(O)}this._drawWrappers=[]}static AddToMesh(I,O,C,j,K,i,y){return new U(I,O,C,j,K,i,y,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(I,O,C,j,K,i,y){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=I,this.verticesStart=O,this.verticesCount=C,this.indexStart=j,this.indexCount=K,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=i,this._renderingMesh=y||i,U&&i.ZS.push(this),this._engine=this._mesh.nI().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=i.ZS.length-1,S&&(this.refreshBoundingInfo(),i.rS(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(I){return this._boundingInfo=I,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const I=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return I||this._renderingMesh}DI(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!O)return I&&this._mesh.nI()._hasDefaultMaterial?this._mesh.nI().defaultMaterial:null;if(this._isMultiMaterial(O)){const I=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==I&&(this._currentMaterial=I,this.resetDrawCache()),I}return O}_isMultiMaterial(I){return void 0!==I.getSubMaterial}refreshBoundingInfo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.WS)return this;if(I||(I=this._renderingMesh.getVerticesData(j.e.PositionKind)),!I)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const O=this._renderingMesh.YS();let C;if(0===this.indexStart&&this.indexCount===O.length){const I=this._renderingMesh.getBoundingInfo();C={minimum:I.minimum.clone(),maximum:I.maximum.clone()}}else C=(0,y.e)(I,O,this.indexStart,this.indexCount,this._renderingMesh.WS.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(C.minimum,C.maximum):this._boundingInfo=new i.e(C.minimum,C.maximum),this}_checkCollision(I){return this.getBoundingInfo()._checkCollision(I)}updateBoundingInfo(I){let O=this.getBoundingInfo();return O||(this.refreshBoundingInfo(),O=this.getBoundingInfo()),O&&O.update(I),this}isInFrustum(I){const O=this.getBoundingInfo();return!!O&&O.isInFrustum(I,this._mesh.qQ)}isCompletelyInFrustum(I){const O=this.getBoundingInfo();return!!O&&O.isCompletelyInFrustum(I)}render(I){return this._renderingMesh.render(this,I,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(I,O){if(!this._linesIndexBuffer){const C=6*Math.floor(this.indexCount/3),j=this.verticesStart+this.verticesCount>65535?new Uint32Array(C):new Uint16Array(C);let K=0;if(0===I.length)for(let I=this.indexStart;I<this.indexStart+this.indexCount;I+=3)j[K++]=I,j[K++]=I+1,j[K++]=I+1,j[K++]=I+2,j[K++]=I+2,j[K++]=I;else for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=3)j[K++]=I[O],j[K++]=I[O+1],j[K++]=I[O+1],j[K++]=I[O+2],j[K++]=I[O+2],j[K++]=I[O];this._linesIndexBuffer=O.createIndexBuffer(j),this._linesIndexCount=j.length}return this._linesIndexBuffer}canIntersects(I){const O=this.getBoundingInfo();return!!O&&I.intersectsBox(O.boundingBox)}intersects(I,O,C,j,K){const i=this.DI();if(!i)return null;let y=3,S=!1;switch(i.fillMode){case 3:case 5:case 6:case 8:return null;case 7:y=1,S=!0}return 4===i.fillMode?C.length?this._intersectLines(I,O,C,this._mesh.intersectionThreshold,j):this._intersectUnIndexedLines(I,O,C,this._mesh.intersectionThreshold,j):!C.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(I,O,C,j,K):this._intersectTriangles(I,O,C,y,S,j,K)}_intersectLines(I,O,C,j,i){let y=null;for(let S=this.indexStart;S<this.indexStart+this.indexCount;S+=2){const U=O[C[S]],p=O[C[S+1]],N=I.intersectionSegment(U,p,j);if(!(N<0)&&((i||!y||N<y.distance)&&(y=new K.e(null,null,N),y.faceId=S/2,i)))break}return y}_intersectUnIndexedLines(I,O,C,j,i){let y=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=2){const C=O[S],U=O[S+1],p=I.intersectionSegment(C,U,j);if(!(p<0)&&((i||!y||p<y.distance)&&(y=new K.e(null,null,p),y.faceId=S/2,i)))break}return y}_intersectTriangles(I,O,C,j,K,i,y){let S=null,U=-1;for(let p=this.indexStart;p<this.indexStart+this.indexCount-(3-j);p+=j){U++;const j=C[p],N=C[p+1],Q=C[p+2];if(K&&4294967295===Q){p+=2;continue}const s=O[j],Z=O[N],q=O[Q];if(!s||!Z||!q)continue;if(y&&!y(s,Z,q,I,j,N,Q))continue;const mI=I.intersectsTriangle(s,Z,q);if(mI){if(mI.distance<0)continue;if((i||!S||mI.distance<S.distance)&&(S=mI,S.faceId=U,i))break}}return S}_intersectUnIndexedTriangles(I,O,C,j,K){let i=null;for(let y=this.verticesStart;y<this.verticesStart+this.verticesCount;y+=3){const C=O[y],S=O[y+1],U=O[y+2];if(K&&!K(C,S,U,I,-1,-1,-1))continue;const p=I.intersectsTriangle(C,S,U);if(p){if(p.distance<0)continue;if((j||!i||p.distance<i.distance)&&(i=p,i.faceId=y/3,j))break}}return i}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(I,O){const C=new U(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,I,O,!1);if(!this.IsGlobal){const I=this.getBoundingInfo();if(!I)return C;C._boundingInfo=new i.e(I.minimum,I.maximum)}return C}dispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.nI().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const O=this._mesh.ZS.indexOf(this);this._mesh.ZS.splice(O,1),this.resetDrawCache(void 0,I)}getClassName(){return"SubMesh"}static CreateFromIndices(I,O,C,j,K){let i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=Number.MAX_VALUE,S=-Number.MAX_VALUE;const p=(K||j).YS();for(let U=O;U<O+C;U++){const I=p[U];I<y&&(y=I),I>S&&(S=I)}return new U(I,y,S-y+1,O,C,j,K,i)}}}}]);