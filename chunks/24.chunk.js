"use strict";(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[24],{11533:(G,A,j)=>{j.d(A,{b:()=>u});class u{constructor(G,A,j){this.bu=G,this.bv=A,this.distance=j,this.faceId=0,this.subMeshId=0}}},11543:(G,A,j)=>{j.d(A,{d:()=>x});var u=j(11228),k=j(11218),B=j(11222);class x{constructor(G,A,j){this.vectors=(0,u.e)(8,k.SA.Zero),this.center=k.SA.Zero(),this.centerWorld=k.SA.Zero(),this.extendSize=k.SA.Zero(),this.extendSizeWorld=k.SA.Zero(),this.directions=(0,u.e)(3,k.SA.Zero),this.vectorsWorld=(0,u.e)(8,k.SA.Zero),this.minimumWorld=k.SA.Zero(),this.maximumWorld=k.SA.Zero(),this.minimum=k.SA.Zero(),this.maximum=k.SA.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(G,A,j)}reConstruct(G,A,j){const u=G.x,B=G.y,x=G.z,s=A.x,O=A.y,d=A.z,h=this.vectors;this.minimum.Ys(u,B,x),this.maximum.Ys(s,O,d),h[0].Ys(u,B,x),h[1].Ys(s,O,d),h[2].Ys(s,B,x),h[3].Ys(u,O,x),h[4].Ys(u,B,d),h[5].Ys(s,O,x),h[6].Ys(u,O,d),h[7].Ys(s,B,d),A.addToRef(G,this.center).scaleInPlace(.5),A.subtractToRef(G,this.extendSize).scaleInPlace(.5),this._worldMatrix=j||k.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(G){const A=x._TmpVector3,j=this.maximum.subtractToRef(this.minimum,A[0]),u=j.length();j.normalizeFromLength(u);const k=u*G,B=j.scaleInPlace(.5*k),s=this.center.subtractToRef(B,A[1]),O=this.center.addToRef(B,A[2]);return this.reConstruct(s,O,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(G){const A=this.minimumWorld,j=this.maximumWorld,u=this.directions,B=this.vectorsWorld,x=this.vectors;if(G.isIdentity()){A.B(this.minimum),j.B(this.maximum);for(let G=0;G<8;++G)B[G].B(x[G]);this.extendSizeWorld.B(this.extendSize),this.centerWorld.B(this.center)}else{A.Qs(Number.MAX_VALUE),j.Qs(-Number.MAX_VALUE);for(let u=0;u<8;++u){const s=B[u];k.SA.TransformCoordinatesToRef(x[u],G,s),A.minimizeInPlace(s),j.maximizeInPlace(s)}j.subtractToRef(A,this.extendSizeWorld).scaleInPlace(.5),j.addToRef(A,this.centerWorld).scaleInPlace(.5)}k.SA.FromArrayToRef(G.m,0,u[0]),k.SA.FromArrayToRef(G.m,4,u[1]),k.SA.FromArrayToRef(G.m,8,u[2]),this._worldMatrix=G}isInFrustum(G){return x.IsInFrustum(this.vectorsWorld,G)}isCompletelyInFrustum(G){return x.IsCompletelyInFrustum(this.vectorsWorld,G)}intersectsPoint(G){const A=this.minimumWorld,j=this.maximumWorld,u=A.x,k=A.y,x=A.z,s=j.x,O=j.y,d=j.z,h=G.x,H=G.y,F=G.z,R=-B.d;return!(s-h<R||R>h-u)&&(!(O-H<R||R>H-k)&&!(d-F<R||R>F-x))}intersectsSphere(G){return x.IntersectsSphere(this.minimumWorld,this.maximumWorld,G.centerWorld,G.radiusWorld)}intersectsMinMax(G,A){const j=this.minimumWorld,u=this.maximumWorld,k=j.x,B=j.y,x=j.z,s=u.x,O=u.y,d=u.z,h=G.x,H=G.y,F=G.z,R=A.x,U=A.y,S=A.z;return!(s<h||k>R)&&(!(O<H||B>U)&&!(d<F||x>S))}dispose(){var G,A;null===(G=this._drawWrapperFront)||void 0===G||G.dispose(),null===(A=this._drawWrapperBack)||void 0===A||A.dispose()}static Intersects(G,A){return G.intersectsMinMax(A.minimumWorld,A.maximumWorld)}static IntersectsSphere(G,A,j,u){const B=x._TmpVector3[0];k.SA.ClampToRef(j,G,A,B);return k.SA.DistanceSquared(j,B)<=u*u}static IsCompletelyInFrustum(G,A){for(let j=0;j<6;++j){const u=A[j];for(let A=0;A<8;++A)if(u.dotCoordinate(G[A])<0)return!1}return!0}static IsInFrustum(G,A){for(let j=0;j<6;++j){let u=!0;const k=A[j];for(let A=0;A<8;++A)if(k.dotCoordinate(G[A])>=0){u=!1;break}if(u)return!1}return!0}}x._TmpVector3=(0,u.e)(3,k.SA.Zero)},11536:(G,A,j)=>{j.d(A,{d:()=>H});var u=j(11228),k=j(11218),B=j(11543),x=j(11550);const s={min:0,max:0},O={min:0,max:0},d=(G,A,j)=>{const u=k.SA.Dot(A.centerWorld,G),B=Math.abs(k.SA.Dot(A.directions[0],G))*A.extendSize.x+Math.abs(k.SA.Dot(A.directions[1],G))*A.extendSize.y+Math.abs(k.SA.Dot(A.directions[2],G))*A.extendSize.z;j.min=u-B,j.max=u+B},h=(G,A,j)=>(d(G,A,s),d(G,j,O),!(s.min>O.max||O.min>s.max));class H{constructor(G,A,j){this._isLocked=!1,this.boundingBox=new B.d(G,A,j),this.boundingSphere=new x.e(G,A,j)}reConstruct(G,A,j){this.boundingBox.reConstruct(G,A,j),this.boundingSphere.reConstruct(G,A,j)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(G){this._isLocked=G}update(G){this._isLocked||(this.boundingBox._update(G),this.boundingSphere._update(G))}centerOn(G,A){const j=H._TmpVector3[0].B(G).LH(A),u=H._TmpVector3[1].B(G).addInPlace(A);return this.boundingBox.reConstruct(j,u,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(j,u,this.boundingBox.getWorldMatrix()),this}encapsulate(G){const A=k.SA.Minimize(this.minimum,G),j=k.SA.Maximize(this.maximum,G);return this.reConstruct(A,j,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(G){const A=k.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(A);const j=k.TmpVectors.SA[0];return k.SA.TransformCoordinatesToRef(G.boundingBox.minimumWorld,A,j),this.encapsulate(j),k.SA.TransformCoordinatesToRef(G.boundingBox.maximumWorld,A,j),this.encapsulate(j),this}scale(G){return this.boundingBox.scale(G),this.boundingSphere.scale(G),this}isInFrustum(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===A||3===A)&&this.boundingSphere.isCenterInFrustum(G))return!0;if(!this.boundingSphere.isInFrustum(G))return!1;return!(1!==A&&3!==A)||this.boundingBox.isInFrustum(G)}get diagonalLength(){const G=this.boundingBox;return G.maximumWorld.subtractToRef(G.minimumWorld,H._TmpVector3[0]).length()}isCompletelyInFrustum(G){return this.boundingBox.isCompletelyInFrustum(G)}_checkCollision(G){return G._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(G){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(G)&&!!this.boundingBox.intersectsPoint(G))}intersects(G,A){if(!x.e.Intersects(this.boundingSphere,G.boundingSphere))return!1;if(!B.d.Intersects(this.boundingBox,G.boundingBox))return!1;if(!A)return!0;const j=this.boundingBox,u=G.boundingBox;return!!h(j.directions[0],j,u)&&(!!h(j.directions[1],j,u)&&(!!h(j.directions[2],j,u)&&(!!h(u.directions[0],j,u)&&(!!h(u.directions[1],j,u)&&(!!h(u.directions[2],j,u)&&(!!h(k.SA.Cross(j.directions[0],u.directions[0]),j,u)&&(!!h(k.SA.Cross(j.directions[0],u.directions[1]),j,u)&&(!!h(k.SA.Cross(j.directions[0],u.directions[2]),j,u)&&(!!h(k.SA.Cross(j.directions[1],u.directions[0]),j,u)&&(!!h(k.SA.Cross(j.directions[1],u.directions[1]),j,u)&&(!!h(k.SA.Cross(j.directions[1],u.directions[2]),j,u)&&(!!h(k.SA.Cross(j.directions[2],u.directions[0]),j,u)&&(!!h(k.SA.Cross(j.directions[2],u.directions[1]),j,u)&&!!h(k.SA.Cross(j.directions[2],u.directions[2]),j,u))))))))))))))}}H._TmpVector3=(0,u.e)(2,k.SA.Zero)},11550:(G,A,j)=>{j.d(A,{e:()=>B});var u=j(11228),k=j(11218);class B{constructor(G,A,j){this.center=k.SA.Zero(),this.centerWorld=k.SA.Zero(),this.minimum=k.SA.Zero(),this.maximum=k.SA.Zero(),this.reConstruct(G,A,j)}reConstruct(G,A,j){this.minimum.B(G),this.maximum.B(A);const u=k.SA.Distance(G,A);A.addToRef(G,this.center).scaleInPlace(.5),this.radius=.5*u,this._update(j||k.Matrix.IdentityReadOnly)}scale(G){const A=this.radius*G,j=B._TmpVector3,u=j[0].Qs(A),k=this.center.subtractToRef(u,j[1]),x=this.center.addToRef(u,j[2]);return this.reConstruct(k,x,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(G){if(G.isIdentity())this.centerWorld.B(this.center),this.radiusWorld=this.radius;else{k.SA.TransformCoordinatesToRef(this.center,G,this.centerWorld);const A=B._TmpVector3[0];k.SA.TransformNormalFromFloatsToRef(1,1,1,G,A),this.radiusWorld=Math.max(Math.abs(A.x),Math.abs(A.y),Math.abs(A.z))*this.radius}}isInFrustum(G){const A=this.centerWorld,j=this.radiusWorld;for(let u=0;u<6;u++)if(G[u].dotCoordinate(A)<=-j)return!1;return!0}isCenterInFrustum(G){const A=this.centerWorld;for(let j=0;j<6;j++)if(G[j].dotCoordinate(A)<0)return!1;return!0}intersectsPoint(G){const A=k.SA.DistanceSquared(this.centerWorld,G);return!(this.radiusWorld*this.radiusWorld<A)}static Intersects(G,A){const j=k.SA.DistanceSquared(G.centerWorld,A.centerWorld),u=G.radiusWorld+A.radiusWorld;return!(u*u<j)}static CreateFromCenterAndRadius(G,A,j){this._TmpVector3[0].B(G),this._TmpVector3[1].Ys(0,0,A),this._TmpVector3[2].B(G),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].LH(this._TmpVector3[1]);const u=new B(this._TmpVector3[0],this._TmpVector3[2]);return u._worldMatrix=j||k.Matrix.Identity(),u}}B._TmpVector3=(0,u.e)(3,k.SA.Zero)},11566:(G,A,j)=>{function u(G){-1===G.indexOf("vClipPlane")&&G.push("vClipPlane"),-1===G.indexOf("vClipPlane2")&&G.push("vClipPlane2"),-1===G.indexOf("vClipPlane3")&&G.push("vClipPlane3"),-1===G.indexOf("vClipPlane4")&&G.push("vClipPlane4"),-1===G.indexOf("vClipPlane5")&&G.push("vClipPlane5"),-1===G.indexOf("vClipPlane6")&&G.push("vClipPlane6")}function k(G,A,j){const u=!!(G.clipPlane??A.clipPlane),k=!!(G.clipPlane2??A.clipPlane2),B=!!(G.clipPlane3??A.clipPlane3),x=!!(G.clipPlane4??A.clipPlane4),s=!!(G.clipPlane5??A.clipPlane5),O=!!(G.clipPlane6??A.clipPlane6);u&&j.push("#define CLIPPLANE"),k&&j.push("#define CLIPPLANE2"),B&&j.push("#define CLIPPLANE3"),x&&j.push("#define CLIPPLANE4"),s&&j.push("#define CLIPPLANE5"),O&&j.push("#define CLIPPLANE6")}function B(G,A,j){let u=!1;const k=!!(G.clipPlane??A.clipPlane),B=!!(G.clipPlane2??A.clipPlane2),x=!!(G.clipPlane3??A.clipPlane3),s=!!(G.clipPlane4??A.clipPlane4),O=!!(G.clipPlane5??A.clipPlane5),d=!!(G.clipPlane6??A.clipPlane6);return j.CLIPPLANE!==k&&(j.CLIPPLANE=k,u=!0),j.CLIPPLANE2!==B&&(j.CLIPPLANE2=B,u=!0),j.CLIPPLANE3!==x&&(j.CLIPPLANE3=x,u=!0),j.CLIPPLANE4!==s&&(j.CLIPPLANE4=s,u=!0),j.CLIPPLANE5!==O&&(j.CLIPPLANE5=O,u=!0),j.CLIPPLANE6!==d&&(j.CLIPPLANE6=d,u=!0),u}function x(G,A,j){let u=A.clipPlane??j.clipPlane;s(G,"vClipPlane",u),u=A.clipPlane2??j.clipPlane2,s(G,"vClipPlane2",u),u=A.clipPlane3??j.clipPlane3,s(G,"vClipPlane3",u),u=A.clipPlane4??j.clipPlane4,s(G,"vClipPlane4",u),u=A.clipPlane5??j.clipPlane5,s(G,"vClipPlane5",u),u=A.clipPlane6??j.clipPlane6,s(G,"vClipPlane6",u)}function s(G,A,j){j&&G.setFloat4(A,j.normal.x,j.normal.y,j.normal.z,j.d)}j.d(A,{d:()=>u,g:()=>x,j:()=>B,k:()=>k})},11517:(G,A,j)=>{j.d(A,{e:()=>u});class u{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(G,A){this._defines[G]||(G<this._currentRank&&(this._currentRank=G),G>this._maxRank&&(this._maxRank=G),this._defines[G]=new Array),this._defines[G].push(A)}addCPUSkinningFallback(G,A){this._mesh=A,G<this._currentRank&&(this._currentRank=G),G>this._maxRank&&(this._maxRank=G)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(G,A){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,G=G.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),A._bonesComputationForcedToCPU=!0;const j=this._mesh.gG();for(let G=0;G<j.meshes.length;G++){const u=j.meshes[G];if(u.material){if(u.computeBonesUsingShaders&&0!==u.numBoneInfluencers)if(u.material.getEffect()===A)u.computeBonesUsingShaders=!1;else if(u.ds)for(const G of u.ds){if(G.effect===A){u.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&u.computeBonesUsingShaders&&u.numBoneInfluencers>0&&(u.computeBonesUsingShaders=!1)}}else{const A=this._defines[this._currentRank];if(A)for(let j=0;j<A.length;j++)G=G.replace("#define "+A[j],"");this._currentRank++}return G}}},11526:(G,A,j)=>{j.d(A,{b:()=>C});var u=j(11202),k=j(11204),B=j(11043),x=j(11050),s=j(11085),O=j(11531),d=j(11478),h=j(11065),H=j(11266),F=j(11333),R=j(11251);class U{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(G){this._func=G}get funcRef(){return this._funcRef}set funcRef(G){this._funcRef=G}get funcMask(){return this._funcMask}set funcMask(G){this._funcMask=G}get opStencilFail(){return this._opStencilFail}set opStencilFail(G){this._opStencilFail=G}get opDepthFail(){return this._opDepthFail}set opDepthFail(G){this._opDepthFail=G}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(G){this._opStencilDepthPass=G}get mask(){return this._mask}set mask(G){this._mask=G}get enabled(){return this._enabled}set enabled(G){this._enabled=G}getClassName(){return"MaterialStencilState"}copyTo(G){R.c.Clone((()=>G),this)}serialize(){return R.c.Serialize(this)}parse(G,A,j){R.c.Parse((()=>this),G,A,j)}}(0,u.b)([(0,k.L)()],U.prototype,"func",null),(0,u.b)([(0,k.L)()],U.prototype,"funcRef",null),(0,u.b)([(0,k.L)()],U.prototype,"funcMask",null),(0,u.b)([(0,k.L)()],U.prototype,"opStencilFail",null),(0,u.b)([(0,k.L)()],U.prototype,"opDepthFail",null),(0,u.b)([(0,k.L)()],U.prototype,"opStencilDepthPass",null),(0,u.b)([(0,k.L)()],U.prototype,"mask",null),(0,u.b)([(0,k.L)()],U.prototype,"enabled",null);var S=j(11560);class C{get _supportGlowLayer(){return!1}set _glowModeEnabled(G){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(G){if(this._alpha===G)return;const A=this._alpha;this._alpha=G,1!==A&&1!==G||this.bh(C.MiscDirtyFlag+C.PrePassDirtyFlag)}get alpha(){return this._alpha}set ts(G){this._backFaceCulling!==G&&(this._backFaceCulling=G,this.bh(C.TextureDirtyFlag))}get ts(){return this._backFaceCulling}set cullBackFaces(G){this._cullBackFaces!==G&&(this._cullBackFaces=G,this.bh(C.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(G){this._blockDirtyMechanism!==G&&(this._blockDirtyMechanism=G,G||this.pF())}atomicMaterialsUpdate(G){this.blockDirtyMechanism=!0;try{G(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(G){this._onDisposeObserver&&this.ks.remove(this._onDisposeObserver),this._onDisposeObserver=this.ks.add(G)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new x.b),this._onBindObservable}set onBind(G){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(G)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new x.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new x.b),this._onEffectCreatedObservable}set alphaMode(G){this._alphaMode!==G&&(this._alphaMode=G,this.bh(C.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(G){this._needDepthPrePass!==G&&(this._needDepthPrePass=G,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(G){this._fogEnabled!==G&&(this._fogEnabled=G,this.bh(C.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case C.WireFrameFillMode:case C.LineListDrawMode:case C.LineLoopDrawMode:case C.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(G){this.fillMode=G?C.WireFrameFillMode:C.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case C.PointFillMode:case C.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(G){this.fillMode=G?C.PointFillMode:C.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(G){this._fillMode!==G&&(this._fillMode=G,this.bh(C.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(G){const A=this.gG().getEngine().getCaps().fragmentDepthSupported;G&&!A&&h.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=G&&A,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(G){this._drawWrapper=G}constructor(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.ks=new x.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new U,this._useUBO=!1,this._fillMode=C.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=G;const k=A||s.d.LastCreatedScene;k&&(this._scene=k,this._dirtyCallbacks={},this._forceGLSL=u,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=G||B.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new F.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new d.b(this._scene.getEngine(),void 0,void 0,G),this._useUBO=this.gG().getEngine().supportsUniformBuffers,this._createUniformBuffer(),j||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),C.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var G;const A=this.gG().getEngine();null===(G=this._uniformBuffer)||void 0===G||G.dispose(),A.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new d.b(A,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new d.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(G){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.pF(),this.checkReadyOnlyOnce=!0}unfreeze(){this.pF(),this.checkReadyOnlyOnce=!1}isReady(G,A){return!0}isReadyForSubMesh(G,A,j){const u=A.materialDefines;return!!u&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=u,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}gG(){return this._scene}_getEffectiveOrientation(G){return null!==this.sideOrientation?this.sideOrientation:G.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(G){this._transparencyMode!==G&&(this._transparencyMode=G,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===C.MATERIAL_ALPHABLEND||this._transparencyMode===C.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===C.MATERIAL_ALPHATEST||this._transparencyMode===C.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===C.MATERIAL_OPAQUE||this._transparencyMode===C.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(G){return this._hasTransparencyMode?this._transparencyModeIsBlend:G.visibility<1||!this._disableAlphaBlending&&(G.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(G){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(G)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}pF(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A=this.gG().meshes;for(const j of A)if(j.ds)for(const A of j.ds)if(A.wG()===this)for(const j of A._drawWrappers)j&&this._materialContext===j.materialContext&&(j._wasPreviouslyReady=!1,j._wasPreviouslyUsingInstances=null,j._forceRebindOnNextCall=G);G&&this.bh(C.AllDirtyFlag)}_preBind(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.getEngine(),u=(null==A?this.sideOrientation:A)===C.ClockWiseSideOrientation;return j.enableEffect(G||this._getDrawWrapper()),j.setState(this.ts,this.zOffset,!1,u,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),u}bind(G,A){}buildUniformLayout(){const G=this._uniformBuffer;this._eventInfo.ubo=G,this._callbackPluginEventGeneric(8,this._eventInfo),G.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(G,A,j){const u=j._drawWrapper;this._eventInfo.subMesh=j,this._callbackPluginEventBindForSubMesh(this._eventInfo),u._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(G){}bindView(G){this._useUBO?this._needToBindSceneUbo=!0:G.setMatrix("view",this.gG().getViewMatrix())}bindViewProjection(G){this._useUBO?this._needToBindSceneUbo=!0:(G.setMatrix("viewProjection",this.gG().getTransformMatrix()),G.setMatrix("projection",this.gG().getProjectionMatrix()))}bindEyePosition(G,A){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(G,A)}_afterBind(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&A&&(this._needToBindSceneUbo=!1,(0,S.s)(A,this.gG().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=G?G.visibility:1,this._onBindObservable&&G&&this._onBindObservable.notifyObservers(G),this.disableDepthWrite){const G=this._scene.getEngine();this._cachedDepthWriteState=G.getDepthWrite(),G.setDepthWrite(!1)}if(this.disableColorWrite){const G=this._scene.getEngine();this._cachedColorWriteState=G.getColorWrite(),G.setColorWrite(!1)}if(0!==this.depthFunction){const G=this._scene.getEngine();this._cachedDepthFunctionState=G.getDepthFunction()||0,G.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(G){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=G,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(G){return null}_clonePlugins(G,A){const j={};if(this._serializePlugins(j),C._ParsePlugins(j,G,this._scene,A),this.pluginManager)for(const u of this.pluginManager._plugins){const A=G.pluginManager.getPlugin(u.name);A&&u.copyTo(A)}}getBindedMeshes(){if(this.meshMap){const G=[];for(const A in this.meshMap){const j=this.meshMap[A];j&&G.push(j)}return G}return this._scene.meshes.filter((G=>G.material===this))}forceCompilation(G,A,j,u){const k={clipPlane:!1,useInstances:!1,...j},B=this.gG(),x=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const s=()=>{if(!this._scene||!this._scene.getEngine())return;const j=B.clipPlane;if(k.clipPlane&&(B.clipPlane=new H.c(0,0,0,1)),this._storeEffectOnSubMeshes){let j=!0,B=null;if(G.ds){const A=new O.c(0,0,0,0,0,G,void 0,!1,!1);A.materialDefines&&(A.materialDefines._renderId=-1),this.isReadyForSubMesh(G,A,k.useInstances)||(A.effect&&A.effect.getCompilationError()&&A.effect.allFallbacksProcessed()?B=A.effect.getCompilationError():(j=!1,setTimeout(s,16)))}j&&(this.allowShaderHotSwapping=x,B&&u&&u(B),A&&A(this))}else this.isReady()?(this.allowShaderHotSwapping=x,A&&A(this)):setTimeout(s,16);k.clipPlane&&(B.clipPlane=j)};s()}async forceCompilationAsync(G,A){return await new Promise(((j,u)=>{this.forceCompilation(G,(()=>{j()}),A,(G=>{u(G)}))}))}bh(G){this.gG().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(C._DirtyCallbackArray.length=0,G&C.ImageProcessingDirtyFlag&&C._DirtyCallbackArray.push(C._ImageProcessingDirtyCallBack),G&C.TextureDirtyFlag&&C._DirtyCallbackArray.push(C._TextureDirtyCallBack),G&C.LightDirtyFlag&&C._DirtyCallbackArray.push(C._LightsDirtyCallBack),G&C.FresnelDirtyFlag&&C._DirtyCallbackArray.push(C._FresnelDirtyCallBack),G&C.AttributesDirtyFlag&&C._DirtyCallbackArray.push(C._AttributeDirtyCallBack),G&C.MiscDirtyFlag&&C._DirtyCallbackArray.push(C._MiscDirtyCallBack),G&C.PrePassDirtyFlag&&C._DirtyCallbackArray.push(C._PrePassDirtyCallBack),C._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(C._RunDirtyCallBacks),this.gG().resetCachedMaterial())}resetDrawCache(){const G=this.gG().meshes;for(const A of G)if(A.ds)for(const G of A.ds)G.wG()===this&&G.resetDrawCache()}_markAllSubMeshesAsDirty(G){const A=this.gG();if(A.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const j=A.meshes;for(const u of j)if(u.ds)for(const j of u.ds){if((j.wG()||(A._hasDefaultMaterial?A.defaultMaterial:null))===this)for(const A of j._drawWrappers)A&&A.defines&&A.defines.markAllAsDirty&&this._materialContext===A.materialContext&&G(A.defines)}}_markScenePrePassDirty(){if(this.gG().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const G=this.gG().enablePrePassRenderer();G&&G.bh()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(C._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(C._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(C._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(C._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(C._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(C._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(C._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(C._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(C._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(C._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const G=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.ks.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(G)}))}}setPrePassRenderer(G){return!1}dispose(G,A,j){const u=this.gG();if(u.stopAnimation(this),u.freeProcessedMaterials(),u.removeMaterial(this),this._eventInfo.forceDisposeTextures=A,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const G=this._parentContainer.materials.indexOf(this);G>-1&&this._parentContainer.materials.splice(G,1),this._parentContainer=null}if(!0!==j)if(this.meshMap)for(const k in this.meshMap){const G=this.meshMap[k];this._disposeMeshResources(G)}else{const G=u.meshes;for(const A of G)this._disposeMeshResources(A)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.ks.notifyObservers(this),this.ks.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(G){if(!G)return;const A=G.Ss,j=G._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(G.ds&&j)for(const k of G.ds){const G=k._drawWrappers;for(let B=0;B<G.length;B++){var u;const x=null===(u=G[B])||void 0===u?void 0:u.effect;if(!x)continue;j[B]===this&&(null===A||void 0===A||A._releaseVertexArrayObject(x),k._removeDrawWrapper(B,!0,!0))}}}else null===A||void 0===A||A._releaseVertexArrayObject(this._drawWrapper.effect);G.material!==this||G.sourceMesh||(G.material=null)}serialize(){const G=R.c.Serialize(this);return G.stencil=this.stencil.serialize(),G.uniqueId=this.uniqueId,this._serializePlugins(G),G}_serializePlugins(G){if(G.plugins={},this.pluginManager)for(const A of this.pluginManager._plugins)A.doNotSerialize||(G.plugins[A.getClassName()]=A.serialize())}static Parse(G,A,j){if(G.customType){if("BABYLON.PBRMaterial"===G.customType&&G.overloadedAlbedo&&(G.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else G.customType="BABYLON.StandardMaterial";const u=B.Tools.Instantiate(G.customType).Parse(G,A,j);return u._loadedUniqueId=G.uniqueId,u}static _ParsePlugins(G,A,j,u){if(G.plugins)for(const s in G.plugins){var k,x;const O=G.plugins[s];let d=null===(k=A.pluginManager)||void 0===k?void 0:k.getPlugin(O.name);if(!d){const G=B.Tools.Instantiate("BABYLON."+s);G&&(d=new G(A))}null===(x=d)||void 0===x||x.parse(O,j,u)}}}C.TriangleFillMode=0,C.WireFrameFillMode=1,C.PointFillMode=2,C.PointListDrawMode=3,C.LineListDrawMode=4,C.LineLoopDrawMode=5,C.LineStripDrawMode=6,C.TriangleStripDrawMode=7,C.TriangleFanDrawMode=8,C.ClockWiseSideOrientation=0,C.CounterClockWiseSideOrientation=1,C.ImageProcessingDirtyFlag=64,C.TextureDirtyFlag=1,C.LightDirtyFlag=2,C.FresnelDirtyFlag=4,C.AttributesDirtyFlag=8,C.MiscDirtyFlag=16,C.PrePassDirtyFlag=32,C.AllDirtyFlag=127,C.MATERIAL_OPAQUE=0,C.MATERIAL_ALPHATEST=1,C.MATERIAL_ALPHABLEND=2,C.MATERIAL_ALPHATESTANDBLEND=3,C.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,C.MATERIAL_NORMALBLENDMETHOD_RNM=1,C.OnEventObservable=new x.b,C._AllDirtyCallBack=G=>G.markAllAsDirty(),C._ImageProcessingDirtyCallBack=G=>G.markAsImageProcessingDirty(),C._TextureDirtyCallBack=G=>G.markAsTexturesDirty(),C._FresnelDirtyCallBack=G=>G.markAsFresnelDirty(),C._MiscDirtyCallBack=G=>G.markAsMiscDirty(),C._PrePassDirtyCallBack=G=>G.markAsPrePassDirty(),C._LightsDirtyCallBack=G=>G.markAsLightDirty(),C._AttributeDirtyCallBack=G=>G.markAsAttributesDirty(),C._FresnelAndMiscDirtyCallBack=G=>{C._FresnelDirtyCallBack(G),C._MiscDirtyCallBack(G)},C._TextureAndMiscDirtyCallBack=G=>{C._TextureDirtyCallBack(G),C._MiscDirtyCallBack(G)},C._DirtyCallbackArray=[],C._RunDirtyCallBacks=G=>{for(const A of C._DirtyCallbackArray)A(G)},(0,u.b)([(0,k.L)()],C.prototype,"id",void 0),(0,u.b)([(0,k.L)()],C.prototype,"uniqueId",void 0),(0,u.b)([(0,k.L)()],C.prototype,"name",void 0),(0,u.b)([(0,k.L)()],C.prototype,"metadata",void 0),(0,u.b)([(0,k.L)()],C.prototype,"checkReadyOnEveryCall",void 0),(0,u.b)([(0,k.L)()],C.prototype,"checkReadyOnlyOnce",void 0),(0,u.b)([(0,k.L)()],C.prototype,"state",void 0),(0,u.b)([(0,k.L)("alpha")],C.prototype,"_alpha",void 0),(0,u.b)([(0,k.L)("ts")],C.prototype,"_backFaceCulling",void 0),(0,u.b)([(0,k.L)("cullBackFaces")],C.prototype,"_cullBackFaces",void 0),(0,u.b)([(0,k.L)()],C.prototype,"sideOrientation",void 0),(0,u.b)([(0,k.L)("alphaMode")],C.prototype,"_alphaMode",void 0),(0,u.b)([(0,k.L)()],C.prototype,"_needDepthPrePass",void 0),(0,u.b)([(0,k.L)()],C.prototype,"disableDepthWrite",void 0),(0,u.b)([(0,k.L)()],C.prototype,"disableColorWrite",void 0),(0,u.b)([(0,k.L)()],C.prototype,"forceDepthWrite",void 0),(0,u.b)([(0,k.L)()],C.prototype,"depthFunction",void 0),(0,u.b)([(0,k.L)()],C.prototype,"separateCullingPass",void 0),(0,u.b)([(0,k.L)("fogEnabled")],C.prototype,"_fogEnabled",void 0),(0,u.b)([(0,k.L)()],C.prototype,"pointSize",void 0),(0,u.b)([(0,k.L)()],C.prototype,"zOffset",void 0),(0,u.b)([(0,k.L)()],C.prototype,"zOffsetUnits",void 0),(0,u.b)([(0,k.L)()],C.prototype,"pointsCloud",null),(0,u.b)([(0,k.L)()],C.prototype,"fillMode",null),(0,u.b)([(0,k.L)()],C.prototype,"useLogarithmicDepth",null),(0,u.b)([(0,k.L)()],C.prototype,"transparencyMode",null)},11560:(G,A,j)=>{j.d(A,{$:()=>W,D:()=>n,H:()=>D,I:()=>g,L:()=>R,M:()=>F,N:()=>o,P:()=>M,S:()=>r,W:()=>t,Z:()=>E,ab:()=>J,c:()=>Q,eb:()=>p,f:()=>H,ib:()=>l,j:()=>I,mb:()=>U,n:()=>h,r:()=>S,s:()=>C,v:()=>Y,z:()=>c});var u=j(11065),k=j(11262),B=j(11085),x=j(11512),s=j(11566);const O=k.nA.Black(),d={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function h(G,A,j){if(!G||G.LOGARITHMICDEPTH||G.indexOf&&G.indexOf("LOGARITHMICDEPTH")>=0){const G=j.activeCamera;1===G.mode&&u.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),A.setFloat("logarithmicDepthConstant",2/(Math.log(G.maxZ+1)/Math.LN2))}}function H(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];j&&G.fogEnabled&&(!A||A.applyFog)&&0!==G.fogMode&&(j.setFloat4("vFogInfos",G.fogMode,G.fogStart,G.fogEnd,G.fogDensity),u?(G.fogColor.toLinearSpaceToRef(O,G.getEngine().useExactSrgbConversions),j.setColor3("vFogColor",O)):j.setColor3("vFogColor",G.fogColor))}function F(G,A,j,u,k,B,x,s,O,h){const H=G.numMaxInfluencers||G.numInfluencers;return H<=0?0:(A.push("#define MORPHTARGETS"),G.hasPositions&&A.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),G.hasNormals&&A.push("#define MORPHTARGETTEXTURE_HASNORMALS"),G.hasTangents&&A.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),G.hasUVs&&A.push("#define MORPHTARGETTEXTURE_HASUVS"),G.hasUV2s&&A.push("#define MORPHTARGETTEXTURE_HASUV2S"),G.hasColors&&A.push("#define MORPHTARGETTEXTURE_HASCOLORS"),G.supportsPositions&&k&&A.push("#define MORPHTARGETS_POSITION"),G.supportsNormals&&B&&A.push("#define MORPHTARGETS_NORMAL"),G.supportsTangents&&x&&A.push("#define MORPHTARGETS_TANGENT"),G.supportsUVs&&s&&A.push("#define MORPHTARGETS_UV"),G.supportsUV2s&&O&&A.push("#define MORPHTARGETS_UV2"),G.supportsColors&&h&&A.push("#define MORPHTARGETS_COLOR"),A.push("#define NUM_MORPH_INFLUENCERS "+H),G.isUsingTextureForTargets&&A.push("#define MORPHTARGETS_TEXTURE"),d.NUM_MORPH_INFLUENCERS=H,d.NORMAL=B,d.TANGENT=x,d.UV=s,d.UV2=O,d.COLOR=h,R(j,u,d,k),H)}function R(G,A,j){let k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const x=j.NUM_MORPH_INFLUENCERS;if(x>0&&B.d.LastCreatedEngine){const s=B.d.LastCreatedEngine.getCaps().maxVertexAttribs,O=A.morphTargetManager;if(null!==O&&void 0!==O&&O.isUsingTextureForTargets)return;const d=O&&O.supportsPositions&&k,h=O&&O.supportsNormals&&j.NORMAL,H=O&&O.supportsTangents&&j.TANGENT,F=O&&O.supportsUVs&&j.UV1,R=O&&O.supportsUV2s&&j.UV2,U=O&&O.supportsColors&&j.VERTEXCOLOR;for(let j=0;j<x;j++)d&&G.push("position"+j),h&&G.push("normal"+j),H&&G.push("tangent"+j),F&&G.push("uv_"+j),R&&G.push("uv2_"+j),U&&G.push("color"+j),G.length>s&&u.e.Error("Cannot add more vertex attributes for mesh "+A.name)}}function U(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G.push("world0"),G.push("world1"),G.push("world2"),G.push("world3"),A&&(G.push("previousWorld0"),G.push("previousWorld1"),G.push("previousWorld2"),G.push("previousWorld3"))}function S(G,A){const j=G.morphTargetManager;G&&j&&A.setFloatArray("morphTargetInfluences",j.influences)}function C(G,A){A.bindToEffect(G,"Scene")}function t(G,A,j){A._needUVs=!0,A[j]=!0,G.optimizeUVAllocation&&G.getTextureMatrix().isIdentityAs3x2()?(A[j+"DIRECTUV"]=G.coordinatesIndex+1,A["MAINUV"+(G.coordinatesIndex+1)]=!0):A[j+"DIRECTUV"]=0}function Y(G,A,j){const u=G.getTextureMatrix();A.Rs(j+"Matrix",u)}function n(G,A,j){j.BAKED_VERTEX_ANIMATION_TEXTURE&&j.INSTANCES&&G.push("bakedVertexAnimationSettingsInstanced")}function Q(G,A,j){var u;if(A&&G&&(G.computeBonesUsingShaders&&A._bonesComputationForcedToCPU&&(G.computeBonesUsingShaders=!1),G.useBones&&G.computeBonesUsingShaders&&G.skeleton)){const k=G.skeleton;if(k.isUsingTextureForMatrices&&A.getUniformIndex("boneTextureWidth")>-1){const j=k.getTransformMatrixTexture(G);A.setTexture("boneSampler",j),A.setFloat("boneTextureWidth",4*(k.bones.length+1))}else{const B=k.getTransformMatrices(G);B&&(A.setMatrices("mBones",B),j&&G.gG().prePassRenderer&&G.gG().prePassRenderer.getIndex(2)&&(j.previousBones[G.uniqueId]||(j.previousBones[G.uniqueId]=B.slice()),A.setMatrices("mPreviousBones",j.previousBones[G.uniqueId]),u=B,j.previousBones[G.uniqueId].set(u)))}}}function X(G,A,j,u,k){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];G._bindLight(A,j,u,k,B)}function I(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const B=Math.min(A.lightSources.length,k);for(let x=0;x<B;x++){X(A.lightSources[x],x,G,j,"boolean"===typeof u?u:u.SPECULARTERM,A.receiveShadows)}}function D(G,A,j,u){j.NUM_BONE_INFLUENCERS>0&&(u.addCPUSkinningFallback(0,A),G.push("matricesIndices"),G.push("matricesWeights"),j.NUM_BONE_INFLUENCERS>4&&(G.push("matricesIndicesExtra"),G.push("matricesWeightsExtra")))}function g(G,A){(A.INSTANCES||A.THIN_INSTANCES)&&U(G,!!A.PREPASS_VELOCITY),A.INSTANCESCOLOR&&G.push("instanceColor")}function c(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=0;for(let B=0;B<j&&G["LIGHT"+B];B++)B>0&&(k=u+B,A.addFallback(k,"LIGHT"+B)),G.SHADOWS||(G["SHADOW"+B]&&A.addFallback(u,"SHADOW"+B),G["SHADOWPCF"+B]&&A.addFallback(u,"SHADOWPCF"+B),G["SHADOWPCSS"+B]&&A.addFallback(u,"SHADOWPCSS"+B),G["SHADOWPOISSON"+B]&&A.addFallback(u,"SHADOWPOISSON"+B),G["SHADOWESM"+B]&&A.addFallback(u,"SHADOWESM"+B),G["SHADOWCLOSEESM"+B]&&A.addFallback(u,"SHADOWCLOSEESM"+B));return k++}function E(G,A,j,u,k,B,x){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];x._areMiscDirty&&(x.LOGARITHMICDEPTH=j,x.POINTSIZE=u,x.FOG=k&&function(G,A){return A.fogEnabled&&G.applyFog&&0!==A.fogMode}(G,A),x.NONUNIFORMSCALING=G.nonUniformScaling,x.ALPHATEST=B,x.DECAL_AFTER_DETAIL=s)}function r(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!j._areLightsDirty)return j._needNormals;let x=0;const s={needNormals:j._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(G.lightsEnabled&&!B)for(const d of A.lightSources)if(b(G,A,d,x,j,u,s),x++,x===k)break;j.SPECULARTERM=s.specularEnabled,j.SHADOWS=s.shadowEnabled;for(let d=x;d<k;d++)void 0!==j["LIGHT"+d]&&(j["LIGHT"+d]=!1,j["HEMILIGHT"+d]=!1,j["POINTLIGHT"+d]=!1,j["DIRLIGHT"+d]=!1,j["SPOTLIGHT"+d]=!1,j["AREALIGHT"+d]=!1,j["SHADOW"+d]=!1,j["SHADOWCSM"+d]=!1,j["SHADOWCSMDEBUG"+d]=!1,j["SHADOWCSMNUM_CASCADES"+d]=!1,j["SHADOWCSMUSESHADOWMAXZ"+d]=!1,j["SHADOWCSMNOBLEND"+d]=!1,j["SHADOWCSM_RIGHTHANDED"+d]=!1,j["SHADOWPCF"+d]=!1,j["SHADOWPCSS"+d]=!1,j["SHADOWPOISSON"+d]=!1,j["SHADOWESM"+d]=!1,j["SHADOWCLOSEESM"+d]=!1,j["SHADOWCUBE"+d]=!1,j["SHADOWLOWQUALITY"+d]=!1,j["SHADOWMEDIUMQUALITY"+d]=!1);const O=G.getEngine().getCaps();return void 0===j.SHADOWFLOAT&&(s.needRebuild=!0),j.SHADOWFLOAT=s.shadowEnabled&&(O.textureFloatRender&&O.textureFloatLinearFiltering||O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering),j.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&j.rebuild(),s.needNormals}function b(G,A,j,u,k,B,s){switch(s.needNormals=!0,void 0===k["LIGHT"+u]&&(s.needRebuild=!0),k["LIGHT"+u]=!0,k["SPOTLIGHT"+u]=!1,k["HEMILIGHT"+u]=!1,k["POINTLIGHT"+u]=!1,k["DIRLIGHT"+u]=!1,k["AREALIGHT"+u]=!1,j.prepareLightSpecificDefines(k,u),k["LIGHT_FALLOFF_PHYSICAL"+u]=!1,k["LIGHT_FALLOFF_GLTF"+u]=!1,k["LIGHT_FALLOFF_STANDARD"+u]=!1,j.falloffType){case x.c.FALLOFF_GLTF:k["LIGHT_FALLOFF_GLTF"+u]=!0;break;case x.c.FALLOFF_PHYSICAL:k["LIGHT_FALLOFF_PHYSICAL"+u]=!0;break;case x.c.FALLOFF_STANDARD:k["LIGHT_FALLOFF_STANDARD"+u]=!0}if(B&&!j.sH.equalsFloats(0,0,0)&&(s.specularEnabled=!0),k["SHADOW"+u]=!1,k["SHADOWCSM"+u]=!1,k["SHADOWCSMDEBUG"+u]=!1,k["SHADOWCSMNUM_CASCADES"+u]=!1,k["SHADOWCSMUSESHADOWMAXZ"+u]=!1,k["SHADOWCSMNOBLEND"+u]=!1,k["SHADOWCSM_RIGHTHANDED"+u]=!1,k["SHADOWPCF"+u]=!1,k["SHADOWPCSS"+u]=!1,k["SHADOWPOISSON"+u]=!1,k["SHADOWESM"+u]=!1,k["SHADOWCLOSEESM"+u]=!1,k["SHADOWCUBE"+u]=!1,k["SHADOWLOWQUALITY"+u]=!1,k["SHADOWMEDIUMQUALITY"+u]=!1,A&&A.receiveShadows&&G.shadowsEnabled&&j.shadowEnabled){const A=j.getShadowGenerator(G.activeCamera)??j.getShadowGenerator();if(A){const G=A.getShadowMap();G&&G.renderList&&G.renderList.length>0&&(s.shadowEnabled=!0,A.prepareDefines(k,u))}}j.lightmapMode!=x.c.LIGHTMAP_DEFAULT?(s.lightmapMode=!0,k["LIGHTMAPEXCLUDED"+u]=!0,k["LIGHTMAPNOSPECULAR"+u]=j.lightmapMode==x.c.LIGHTMAP_SHADOWSONLY):(k["LIGHTMAPEXCLUDED"+u]=!1,k["LIGHTMAPNOSPECULAR"+u]=!1)}function M(G,A,j,u,k){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=function(G,A){let j=!1;if(G.activeCamera){const u=A.CAMERA_ORTHOGRAPHIC?1:0,k=A.CAMERA_PERSPECTIVE?1:0,B=1===G.activeCamera.mode?1:0,x=0===G.activeCamera.mode?1:0;(u^B||k^x)&&(A.CAMERA_ORTHOGRAPHIC=1===B,A.CAMERA_PERSPECTIVE=1===x,j=!0)}return j}(G,u);!1!==B&&(O=(0,s.j)(j,G,u)),u.DEPTHPREPASS!==!A.getColorWrite()&&(u.DEPTHPREPASS=!u.DEPTHPREPASS,O=!0),u.INSTANCES!==k&&(u.INSTANCES=k,O=!0),u.THIN_INSTANCES!==x&&(u.THIN_INSTANCES=x,O=!0),O&&u.markAsUnprocessed()}function o(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],x=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!A._areAttributesDirty&&A._needNormals===A._normals&&A._needUVs===A._uvs)return!1;A._normals=A._needNormals,A._uvs=A._needUVs,A.NORMAL=A._needNormals&&G.isVerticesDataPresent("normal"),A._needNormals&&G.isVerticesDataPresent("tangent")&&(A.TANGENT=!0);for(let s=1;s<=6;++s)A["UV"+s]=!!A._needUVs&&G.isVerticesDataPresent(`uv${1===s?"":s}`);if(j){const j=G.useVertexColors&&G.isVerticesDataPresent("color");A.VERTEXCOLOR=j,A.VERTEXALPHA=G.hasVertexAlpha&&j&&B}return G.isVerticesDataPresent("instanceColor")&&(G.hasInstances||G.hasThinInstances)&&(A.INSTANCESCOLOR=!0),u&&function(G,A){if(G.useBones&&G.computeBonesUsingShaders&&G.skeleton){A.NUM_BONE_INFLUENCERS=G.numBoneInfluencers;const j=void 0!==A.BONETEXTURE;if(G.skeleton.isUsingTextureForMatrices&&j)A.BONETEXTURE=!0;else{A.BonesPerMesh=G.skeleton.bones.length+1,A.BONETEXTURE=!j&&void 0;const u=G.gG().prePassRenderer;if(u&&u.enabled){const j=-1===u.excludedSkinnedMesh.indexOf(G);A.BONES_VELOCITY_ENABLED=j}}}else A.NUM_BONE_INFLUENCERS=0,A.BonesPerMesh=0,void 0!==A.BONETEXTURE&&(A.BONETEXTURE=!1)}(G,A),k&&function(G,A){const j=G.morphTargetManager;j?(A.MORPHTARGETS_UV=j.supportsUVs&&A.UV1,A.MORPHTARGETS_UV2=j.supportsUV2s&&A.UV2,A.MORPHTARGETS_TANGENT=j.supportsTangents&&A.TANGENT,A.MORPHTARGETS_NORMAL=j.supportsNormals&&A.NORMAL,A.MORPHTARGETS_POSITION=j.supportsPositions,A.MORPHTARGETS_COLOR=j.supportsColors,A.MORPHTARGETTEXTURE_HASUVS=j.hasUVs,A.MORPHTARGETTEXTURE_HASUV2S=j.hasUV2s,A.MORPHTARGETTEXTURE_HASTANGENTS=j.hasTangents,A.MORPHTARGETTEXTURE_HASNORMALS=j.hasNormals,A.MORPHTARGETTEXTURE_HASPOSITIONS=j.hasPositions,A.MORPHTARGETTEXTURE_HASCOLORS=j.hasColors,A.NUM_MORPH_INFLUENCERS=j.numMaxInfluencers||j.numInfluencers,A.MORPHTARGETS=A.NUM_MORPH_INFLUENCERS>0,A.MORPHTARGETS_TEXTURE=j.isUsingTextureForTargets):(A.MORPHTARGETS_UV=!1,A.MORPHTARGETS_UV2=!1,A.MORPHTARGETS_TANGENT=!1,A.MORPHTARGETS_NORMAL=!1,A.MORPHTARGETS_POSITION=!1,A.MORPHTARGETS_COLOR=!1,A.MORPHTARGETTEXTURE_HASUVS=!1,A.MORPHTARGETTEXTURE_HASUV2S=!1,A.MORPHTARGETTEXTURE_HASTANGENTS=!1,A.MORPHTARGETTEXTURE_HASNORMALS=!1,A.MORPHTARGETTEXTURE_HASPOSITIONS=!1,A.MORPHTARGETTEXTURE_HAS_COLORS=!1,A.MORPHTARGETS=!1,A.NUM_MORPH_INFLUENCERS=0)}(G,A),x&&function(G,A){const j=G.bakedVertexAnimationManager;A.BAKED_VERTEX_ANIMATION_TEXTURE=!(!j||!j.isEnabled)}(G,A),!0}function W(G,A){if(G.activeCamera){const j=A.MULTIVIEW;A.MULTIVIEW=null!==G.activeCamera.outputRenderTarget&&G.activeCamera.outputRenderTarget.getViewCount()>1,A.MULTIVIEW!=j&&A.markAsUnprocessed()}}function J(G,A,j){const u=A.ORDER_INDEPENDENT_TRANSPARENCY,k=A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;A.ORDER_INDEPENDENT_TRANSPARENCY=G.useOrderIndependentTransparency&&j,A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!G.getEngine().getCaps().textureFloatLinearFiltering,u===A.ORDER_INDEPENDENT_TRANSPARENCY&&k===A.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||A.markAsUnprocessed()}function p(G,A,j){const u=A.PREPASS;if(!A._arePrePassDirty)return;const k=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(G.prePassRenderer&&G.prePassRenderer.enabled&&j){A.PREPASS=!0,A.SCENE_MRT_COUNT=G.prePassRenderer.mrtCount,A.PREPASS_NORMAL_WORLDSPACE=G.prePassRenderer.generateNormalsInWorldSpace,A.PREPASS_COLOR=!0,A.PREPASS_COLOR_INDEX=0;for(let j=0;j<k.length;j++){const u=G.prePassRenderer.getIndex(k[j].type);-1!==u?(A[k[j].define]=!0,A[k[j].index]=u):A[k[j].define]=!1}}else{A.PREPASS=!1;for(let G=0;G<k.length;G++)A[k[G].define]=!1}A.PREPASS!=u&&(A.markAsUnprocessed(),A.markAsImageProcessingDirty())}function e(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6];k&&k.push("Light"+G),B||(A.push("vLightData"+G,"vLightDiffuse"+G,"vLightSpecular"+G,"vLightDirection"+G,"vLightWidth"+G,"vLightHeight"+G,"vLightFalloff"+G,"vLightGround"+G,"lightMatrix"+G,"shadowsInfo"+G,"depthValues"+G),j.push("shadowTexture"+G),j.push("depthTexture"+G),A.push("viewFrustumZ"+G,"cascadeBlendFactor"+G,"lightSizeUVCorrection"+G,"depthCorrection"+G,"penumbraDarkness"+G,"frustumLengths"+G),u&&(j.push("projectionLightTexture"+G),A.push("textureProjectionMatrix"+G)),x&&j.push("iesLightTexture"+G))}function l(G,A,j){let u,k,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(G.uniformsNames){const x=G;u=x.uniformsNames,k=x.uniformBuffersNames,A=x.samplers,j=x.defines,B=x.maxSimultaneousLights||0}else u=G,A||(A=[]);for(let x=0;x<B&&j["LIGHT"+x];x++)e(x,u,A,j["PROJECTEDLIGHTTEXTURE"+x],k,!1,j["IESLIGHTTEXTURE"+x]);j.NUM_MORPH_INFLUENCERS&&(u.push("morphTargetInfluences"),u.push("morphTargetCount")),j.BAKED_VERTEX_ANIMATION_TEXTURE&&(u.push("bakedVertexAnimationSettings"),u.push("bakedVertexAnimationTextureSizeInverted"),u.push("bakedVertexAnimationTime"),A.push("bakedVertexAnimationTexture"))}},11522:(G,A,j)=>{j.d(A,{d:()=>B});var u=j(11218),k=j(11526);class B extends k.b{constructor(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(G,A,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new u.Matrix,this._storeEffectOnSubMeshes=j}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(G,A){return!!G&&(!this._storeEffectOnSubMeshes||(!G.ds||0===G.ds.length||this.isReadyForSubMesh(G,G.ds[0],A)))}_isReadyForSubMesh(G){const A=G.materialDefines;return!(this.checkReadyOnEveryCall||!G.effect||!A||A._renderId!==this.gG().getRenderId())}bindOnlyWorldMatrix(G){this._activeEffect.setMatrix("world",G)}bindOnlyNormalMatrix(G){this._activeEffect.setMatrix("normalMatrix",G)}bind(G,A){A&&this.bindForSubMesh(G,A,A.ds[0])}_afterBind(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;super._afterBind(G,A,j),this.gG()._cachedEffect=A,j?j._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return j._drawWrapper._forceRebindOnNextCall||G.isCachedMaterialInvalid(this,A,u)}dispose(G,A,j){this._activeEffect=void 0,super.dispose(G,A,j)}}},11556:(G,A,j)=>{j.d(A,{d:()=>s,e:()=>O});var u=j(11202),k=j(11218),B=j(11204);class x{static extractMinAndMaxIndexed(G,A,j,u,k,B){for(let x=j;x<j+u;x++){const j=3*A[x],u=G[j],s=G[j+1],O=G[j+2];k.minimizeInPlaceFromFloats(u,s,O),B.maximizeInPlaceFromFloats(u,s,O)}}static extractMinAndMax(G,A,j,u,k,B){for(let x=A,s=A*u;x<A+j;x++,s+=u){const A=G[s],j=G[s+1],u=G[s+2];k.minimizeInPlaceFromFloats(A,j,u),B.maximizeInPlaceFromFloats(A,j,u)}}}function s(G,A,j,u){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const s=new k.SA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new k.SA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return x.extractMinAndMaxIndexed(G,A,j,u,s,O),B&&(s.x-=s.x*B.x+B.y,s.y-=s.y*B.x+B.y,s.z-=s.z*B.x+B.y,O.x+=O.x*B.x+B.y,O.y+=O.y*B.x+B.y,O.z+=O.z*B.x+B.y),{minimum:s,maximum:O}}function O(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4?arguments[4]:void 0;const s=new k.SA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new k.SA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B||(B=3),x.extractMinAndMax(G,A,j,B,s,O),u&&(s.x-=s.x*u.x+u.y,s.y-=s.y*u.x+u.y,s.z-=s.z*u.x+u.y,O.x+=O.x*u.x+u.y,O.y+=O.y*u.x+u.y,O.z+=O.z*u.x+u.y),{minimum:s,maximum:O}}(0,u.b)([B.d.filter((function(){for(var G=arguments.length,A=new Array(G),j=0;j<G;j++)A[j]=arguments[j];let[u,k]=A;return!Array.isArray(u)&&!Array.isArray(k)}))],x,"extractMinAndMaxIndexed",null),(0,u.b)([B.d.filter((function(){for(var G=arguments.length,A=new Array(G),j=0;j<G;j++)A[j]=arguments[j];let[u]=A;return!Array.isArray(u)}))],x,"extractMinAndMax",null)},11531:(G,A,j)=>{j.d(A,{c:()=>O});var u=j(11290),k=j(11533),B=j(11536),x=j(11556),s=j(11333);class O{get materialDefines(){var G;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(G=this._getDrawWrapper())||void 0===G?void 0:G.defines}set materialDefines(G){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=G}_getDrawWrapper(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G=G??this._engine.currentRenderPassId;let j=this._drawWrappers[G];return!j&&A&&(this._drawWrappers[G]=j=new s.c(this._mesh.gG().getEngine())),j}_removeDrawWrapper(G){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var j;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(j=this._drawWrappers[G])||void 0===j||j.dispose(A));this._drawWrappers[G]=void 0}get effect(){var G;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(G=this._getDrawWrapper())||void 0===G?void 0:G.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(G){this._mainDrawWrapperOverride=G}setEffect(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this._drawWrapper;k.setEffect(G,A,u),void 0!==j&&(k.materialContext=j),G||(k.defines=null,k.materialContext=void 0)}resetDrawCache(G){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==G)return void this._removeDrawWrapper(G,!0,A);for(const G of this._drawWrappers)null===G||void 0===G||G.dispose(A)}this._drawWrappers=[]}static AddToMesh(G,A,j,u,k,B,x){return new O(G,A,j,u,k,B,x,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(G,A,j,u,k,B,x){let s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],O=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=G,this.verticesStart=A,this.verticesCount=j,this.indexStart=u,this.indexCount=k,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=B,this._renderingMesh=x||B,O&&B.ds.push(this),this._engine=this._mesh.gG().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=B.ds.length-1,s&&(this.refreshBoundingInfo(),B.Us(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(G){return this._boundingInfo=G,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const G=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return G||this._renderingMesh}wG(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const A=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!A)return G&&this._mesh.gG()._hasDefaultMaterial?this._mesh.gG().defaultMaterial:null;if(this._isMultiMaterial(A)){const G=A.getSubMaterial(this.materialIndex);return this._currentMaterial!==G&&(this._currentMaterial=G,this.resetDrawCache()),G}return A}_isMultiMaterial(G){return void 0!==G.getSubMaterial}refreshBoundingInfo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Ss)return this;if(G||(G=this._renderingMesh.getVerticesData(u.h.PositionKind)),!G)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const A=this._renderingMesh.Cs();let j;if(0===this.indexStart&&this.indexCount===A.length){const G=this._renderingMesh.getBoundingInfo();j={minimum:G.minimum.clone(),maximum:G.maximum.clone()}}else j=(0,x.d)(G,A,this.indexStart,this.indexCount,this._renderingMesh.Ss.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(j.minimum,j.maximum):this._boundingInfo=new B.d(j.minimum,j.maximum),this}_checkCollision(G){return this.getBoundingInfo()._checkCollision(G)}updateBoundingInfo(G){let A=this.getBoundingInfo();return A||(this.refreshBoundingInfo(),A=this.getBoundingInfo()),A&&A.update(G),this}isInFrustum(G){const A=this.getBoundingInfo();return!!A&&A.isInFrustum(G,this._mesh.OF)}isCompletelyInFrustum(G){const A=this.getBoundingInfo();return!!A&&A.isCompletelyInFrustum(G)}render(G){return this._renderingMesh.render(this,G,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(G,A){if(!this._linesIndexBuffer){const j=6*Math.floor(this.indexCount/3),u=this.verticesStart+this.verticesCount>65535?new Uint32Array(j):new Uint16Array(j);let k=0;if(0===G.length)for(let G=this.indexStart;G<this.indexStart+this.indexCount;G+=3)u[k++]=G,u[k++]=G+1,u[k++]=G+1,u[k++]=G+2,u[k++]=G+2,u[k++]=G;else for(let A=this.indexStart;A<this.indexStart+this.indexCount;A+=3)u[k++]=G[A],u[k++]=G[A+1],u[k++]=G[A+1],u[k++]=G[A+2],u[k++]=G[A+2],u[k++]=G[A];this._linesIndexBuffer=A.createIndexBuffer(u),this._linesIndexCount=u.length}return this._linesIndexBuffer}canIntersects(G){const A=this.getBoundingInfo();return!!A&&G.intersectsBox(A.boundingBox)}intersects(G,A,j,u,k){const B=this.wG();if(!B)return null;let x=3,s=!1;switch(B.fillMode){case 3:case 5:case 6:case 8:return null;case 7:x=1,s=!0}return 4===B.fillMode?j.length?this._intersectLines(G,A,j,this._mesh.intersectionThreshold,u):this._intersectUnIndexedLines(G,A,j,this._mesh.intersectionThreshold,u):!j.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(G,A,j,u,k):this._intersectTriangles(G,A,j,x,s,u,k)}_intersectLines(G,A,j,u,B){let x=null;for(let s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){const O=A[j[s]],d=A[j[s+1]],h=G.intersectionSegment(O,d,u);if(!(h<0)&&((B||!x||h<x.distance)&&(x=new k.b(null,null,h),x.faceId=s/2,B)))break}return x}_intersectUnIndexedLines(G,A,j,u,B){let x=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){const j=A[s],O=A[s+1],d=G.intersectionSegment(j,O,u);if(!(d<0)&&((B||!x||d<x.distance)&&(x=new k.b(null,null,d),x.faceId=s/2,B)))break}return x}_intersectTriangles(G,A,j,u,k,B,x){let s=null,O=-1;for(let d=this.indexStart;d<this.indexStart+this.indexCount-(3-u);d+=u){O++;const u=j[d],h=j[d+1],H=j[d+2];if(k&&4294967295===H){d+=2;continue}const F=A[u],R=A[h],U=A[H];if(!F||!R||!U)continue;if(x&&!x(F,R,U,G,u,h,H))continue;const S=G.intersectsTriangle(F,R,U);if(S){if(S.distance<0)continue;if((B||!s||S.distance<s.distance)&&(s=S,s.faceId=O,B))break}}return s}_intersectUnIndexedTriangles(G,A,j,u,k){let B=null;for(let x=this.verticesStart;x<this.verticesStart+this.verticesCount;x+=3){const j=A[x],s=A[x+1],O=A[x+2];if(k&&!k(j,s,O,G,-1,-1,-1))continue;const d=G.intersectsTriangle(j,s,O);if(d){if(d.distance<0)continue;if((u||!B||d.distance<B.distance)&&(B=d,B.faceId=x/3,u))break}}return B}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(G,A){const j=new O(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,G,A,!1);if(!this.IsGlobal){const G=this.getBoundingInfo();if(!G)return j;j._boundingInfo=new B.d(G.minimum,G.maximum)}return j}dispose(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.gG().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const A=this._mesh.ds.indexOf(this);this._mesh.ds.splice(A,1),this.resetDrawCache(void 0,G)}getClassName(){return"SubMesh"}static CreateFromIndices(G,A,j,u,k){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],x=Number.MAX_VALUE,s=-Number.MAX_VALUE;const d=(k||u).Cs();for(let O=A;O<A+j;O++){const G=d[O];G<x&&(x=G),G>s&&(s=G)}return new O(G,x,s-x+1,A,j,u,k,B)}}}}]);