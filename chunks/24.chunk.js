"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[24],{11544:(o,H,n)=>{n.d(H,{c:()=>E});class E{constructor(o,H,n){this.bu=o,this.bv=H,this.distance=n,this.faceId=0,this.subMeshId=0}}},11554:(o,H,n)=>{n.d(H,{e:()=>O});var E=n(11201),k=n(11189),g=n(11196);class O{constructor(o,H,n){this.vectors=(0,E.b)(8,k.xH.Zero),this.center=k.xH.Zero(),this.centerWorld=k.xH.Zero(),this.extendSize=k.xH.Zero(),this.extendSizeWorld=k.xH.Zero(),this.directions=(0,E.b)(3,k.xH.Zero),this.vectorsWorld=(0,E.b)(8,k.xH.Zero),this.minimumWorld=k.xH.Zero(),this.maximumWorld=k.xH.Zero(),this.minimum=k.xH.Zero(),this.maximum=k.xH.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(o,H,n)}reConstruct(o,H,n){const E=o.x,g=o.y,O=o.z,Y=H.x,y=H.y,S=H.z,G=this.vectors;this.minimum.Wg(E,g,O),this.maximum.Wg(Y,y,S),G[0].Wg(E,g,O),G[1].Wg(Y,y,S),G[2].Wg(Y,g,O),G[3].Wg(E,y,O),G[4].Wg(E,g,S),G[5].Wg(Y,y,O),G[6].Wg(E,y,S),G[7].Wg(Y,g,S),H.addToRef(o,this.center).scaleInPlace(.5),H.subtractToRef(o,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||k.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(o){const H=O._TmpVector3,n=this.maximum.subtractToRef(this.minimum,H[0]),E=n.length();n.normalizeFromLength(E);const k=E*o,g=n.scaleInPlace(.5*k),Y=this.center.subtractToRef(g,H[1]),y=this.center.addToRef(g,H[2]);return this.reConstruct(Y,y,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(o){const H=this.minimumWorld,n=this.maximumWorld,E=this.directions,g=this.vectorsWorld,O=this.vectors;if(o.isIdentity()){H.S(this.minimum),n.S(this.maximum);for(let o=0;o<8;++o)g[o].S(O[o]);this.extendSizeWorld.S(this.extendSize),this.centerWorld.S(this.center)}else{H.AY(Number.MAX_VALUE),n.AY(-Number.MAX_VALUE);for(let E=0;E<8;++E){const Y=g[E];k.xH.TransformCoordinatesToRef(O[E],o,Y),H.minimizeInPlace(Y),n.maximizeInPlace(Y)}n.subtractToRef(H,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(H,this.centerWorld).scaleInPlace(.5)}k.xH.FromArrayToRef(o.m,0,E[0]),k.xH.FromArrayToRef(o.m,4,E[1]),k.xH.FromArrayToRef(o.m,8,E[2]),this._worldMatrix=o}isInFrustum(o){return O.IsInFrustum(this.vectorsWorld,o)}isCompletelyInFrustum(o){return O.IsCompletelyInFrustum(this.vectorsWorld,o)}intersectsPoint(o){const H=this.minimumWorld,n=this.maximumWorld,E=H.x,k=H.y,O=H.z,Y=n.x,y=n.y,S=n.z,G=o.x,c=o.y,A=o.z,l=-g.e;return!(Y-G<l||l>G-E)&&(!(y-c<l||l>c-k)&&!(S-A<l||l>A-O))}intersectsSphere(o){return O.IntersectsSphere(this.minimumWorld,this.maximumWorld,o.centerWorld,o.radiusWorld)}intersectsMinMax(o,H){const n=this.minimumWorld,E=this.maximumWorld,k=n.x,g=n.y,O=n.z,Y=E.x,y=E.y,S=E.z,G=o.x,c=o.y,A=o.z,l=H.x,x=H.y,z=H.z;return!(Y<G||k>l)&&(!(y<c||g>x)&&!(S<A||O>z))}dispose(){var o,H;null===(o=this._drawWrapperFront)||void 0===o||o.dispose(),null===(H=this._drawWrapperBack)||void 0===H||H.dispose()}static Intersects(o,H){return o.intersectsMinMax(H.minimumWorld,H.maximumWorld)}static IntersectsSphere(o,H,n,E){const g=O._TmpVector3[0];k.xH.ClampToRef(n,o,H,g);return k.xH.DistanceSquared(n,g)<=E*E}static IsCompletelyInFrustum(o,H){for(let n=0;n<6;++n){const E=H[n];for(let H=0;H<8;++H)if(E.dotCoordinate(o[H])<0)return!1}return!0}static IsInFrustum(o,H){for(let n=0;n<6;++n){let E=!0;const k=H[n];for(let H=0;H<8;++H)if(k.dotCoordinate(o[H])>=0){E=!1;break}if(E)return!1}return!0}}O._TmpVector3=(0,E.b)(3,k.xH.Zero)},11546:(o,H,n)=>{n.d(H,{e:()=>c});var E=n(11201),k=n(11189),g=n(11554),O=n(11557);const Y={min:0,max:0},y={min:0,max:0},S=(o,H,n)=>{const E=k.xH.Dot(H.centerWorld,o),g=Math.abs(k.xH.Dot(H.directions[0],o))*H.extendSize.x+Math.abs(k.xH.Dot(H.directions[1],o))*H.extendSize.y+Math.abs(k.xH.Dot(H.directions[2],o))*H.extendSize.z;n.min=E-g,n.max=E+g},G=(o,H,n)=>(S(o,H,Y),S(o,n,y),!(Y.min>y.max||y.min>Y.max));class c{constructor(o,H,n){this._isLocked=!1,this.boundingBox=new g.e(o,H,n),this.boundingSphere=new O.d(o,H,n)}reConstruct(o,H,n){this.boundingBox.reConstruct(o,H,n),this.boundingSphere.reConstruct(o,H,n)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(o){this._isLocked=o}update(o){this._isLocked||(this.boundingBox._update(o),this.boundingSphere._update(o))}centerOn(o,H){const n=c._TmpVector3[0].S(o).tG(H),E=c._TmpVector3[1].S(o).addInPlace(H);return this.boundingBox.reConstruct(n,E,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(n,E,this.boundingBox.getWorldMatrix()),this}encapsulate(o){const H=k.xH.Minimize(this.minimum,o),n=k.xH.Maximize(this.maximum,o);return this.reConstruct(H,n,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(o){const H=k.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(H);const n=k.TmpVectors.xH[0];return k.xH.TransformCoordinatesToRef(o.boundingBox.minimumWorld,H,n),this.encapsulate(n),k.xH.TransformCoordinatesToRef(o.boundingBox.maximumWorld,H,n),this.encapsulate(n),this}scale(o){return this.boundingBox.scale(o),this.boundingSphere.scale(o),this}isInFrustum(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===H||3===H)&&this.boundingSphere.isCenterInFrustum(o))return!0;if(!this.boundingSphere.isInFrustum(o))return!1;return!(1!==H&&3!==H)||this.boundingBox.isInFrustum(o)}get diagonalLength(){const o=this.boundingBox;return o.maximumWorld.subtractToRef(o.minimumWorld,c._TmpVector3[0]).length()}isCompletelyInFrustum(o){return this.boundingBox.isCompletelyInFrustum(o)}_checkCollision(o){return o._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(o){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(o)&&!!this.boundingBox.intersectsPoint(o))}intersects(o,H){if(!O.d.Intersects(this.boundingSphere,o.boundingSphere))return!1;if(!g.e.Intersects(this.boundingBox,o.boundingBox))return!1;if(!H)return!0;const n=this.boundingBox,E=o.boundingBox;return!!G(n.directions[0],n,E)&&(!!G(n.directions[1],n,E)&&(!!G(n.directions[2],n,E)&&(!!G(E.directions[0],n,E)&&(!!G(E.directions[1],n,E)&&(!!G(E.directions[2],n,E)&&(!!G(k.xH.Cross(n.directions[0],E.directions[0]),n,E)&&(!!G(k.xH.Cross(n.directions[0],E.directions[1]),n,E)&&(!!G(k.xH.Cross(n.directions[0],E.directions[2]),n,E)&&(!!G(k.xH.Cross(n.directions[1],E.directions[0]),n,E)&&(!!G(k.xH.Cross(n.directions[1],E.directions[1]),n,E)&&(!!G(k.xH.Cross(n.directions[1],E.directions[2]),n,E)&&(!!G(k.xH.Cross(n.directions[2],E.directions[0]),n,E)&&(!!G(k.xH.Cross(n.directions[2],E.directions[1]),n,E)&&!!G(k.xH.Cross(n.directions[2],E.directions[2]),n,E))))))))))))))}}c._TmpVector3=(0,E.b)(2,k.xH.Zero)},11557:(o,H,n)=>{n.d(H,{d:()=>g});var E=n(11201),k=n(11189);class g{constructor(o,H,n){this.center=k.xH.Zero(),this.centerWorld=k.xH.Zero(),this.minimum=k.xH.Zero(),this.maximum=k.xH.Zero(),this.reConstruct(o,H,n)}reConstruct(o,H,n){this.minimum.S(o),this.maximum.S(H);const E=k.xH.Distance(o,H);H.addToRef(o,this.center).scaleInPlace(.5),this.radius=.5*E,this._update(n||k.Matrix.IdentityReadOnly)}scale(o){const H=this.radius*o,n=g._TmpVector3,E=n[0].AY(H),k=this.center.subtractToRef(E,n[1]),O=this.center.addToRef(E,n[2]);return this.reConstruct(k,O,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(o){if(o.isIdentity())this.centerWorld.S(this.center),this.radiusWorld=this.radius;else{k.xH.TransformCoordinatesToRef(this.center,o,this.centerWorld);const H=g._TmpVector3[0];k.xH.TransformNormalFromFloatsToRef(1,1,1,o,H),this.radiusWorld=Math.max(Math.abs(H.x),Math.abs(H.y),Math.abs(H.z))*this.radius}}isInFrustum(o){const H=this.centerWorld,n=this.radiusWorld;for(let E=0;E<6;E++)if(o[E].dotCoordinate(H)<=-n)return!1;return!0}isCenterInFrustum(o){const H=this.centerWorld;for(let n=0;n<6;n++)if(o[n].dotCoordinate(H)<0)return!1;return!0}intersectsPoint(o){const H=k.xH.DistanceSquared(this.centerWorld,o);return!(this.radiusWorld*this.radiusWorld<H)}static Intersects(o,H){const n=k.xH.DistanceSquared(o.centerWorld,H.centerWorld),E=o.radiusWorld+H.radiusWorld;return!(E*E<n)}static CreateFromCenterAndRadius(o,H,n){this._TmpVector3[0].S(o),this._TmpVector3[1].Wg(0,0,H),this._TmpVector3[2].S(o),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].tG(this._TmpVector3[1]);const E=new g(this._TmpVector3[0],this._TmpVector3[2]);return E._worldMatrix=n||k.Matrix.Identity(),E}}g._TmpVector3=(0,E.b)(3,k.xH.Zero)},11565:(o,H,n)=>{function E(o){-1===o.indexOf("vClipPlane")&&o.push("vClipPlane"),-1===o.indexOf("vClipPlane2")&&o.push("vClipPlane2"),-1===o.indexOf("vClipPlane3")&&o.push("vClipPlane3"),-1===o.indexOf("vClipPlane4")&&o.push("vClipPlane4"),-1===o.indexOf("vClipPlane5")&&o.push("vClipPlane5"),-1===o.indexOf("vClipPlane6")&&o.push("vClipPlane6")}function k(o,H,n){const E=!!(o.clipPlane??H.clipPlane),k=!!(o.clipPlane2??H.clipPlane2),g=!!(o.clipPlane3??H.clipPlane3),O=!!(o.clipPlane4??H.clipPlane4),Y=!!(o.clipPlane5??H.clipPlane5),y=!!(o.clipPlane6??H.clipPlane6);E&&n.push("#define CLIPPLANE"),k&&n.push("#define CLIPPLANE2"),g&&n.push("#define CLIPPLANE3"),O&&n.push("#define CLIPPLANE4"),Y&&n.push("#define CLIPPLANE5"),y&&n.push("#define CLIPPLANE6")}function g(o,H,n){let E=!1;const k=!!(o.clipPlane??H.clipPlane),g=!!(o.clipPlane2??H.clipPlane2),O=!!(o.clipPlane3??H.clipPlane3),Y=!!(o.clipPlane4??H.clipPlane4),y=!!(o.clipPlane5??H.clipPlane5),S=!!(o.clipPlane6??H.clipPlane6);return n.CLIPPLANE!==k&&(n.CLIPPLANE=k,E=!0),n.CLIPPLANE2!==g&&(n.CLIPPLANE2=g,E=!0),n.CLIPPLANE3!==O&&(n.CLIPPLANE3=O,E=!0),n.CLIPPLANE4!==Y&&(n.CLIPPLANE4=Y,E=!0),n.CLIPPLANE5!==y&&(n.CLIPPLANE5=y,E=!0),n.CLIPPLANE6!==S&&(n.CLIPPLANE6=S,E=!0),E}function O(o,H,n){let E=H.clipPlane??n.clipPlane;Y(o,"vClipPlane",E),E=H.clipPlane2??n.clipPlane2,Y(o,"vClipPlane2",E),E=H.clipPlane3??n.clipPlane3,Y(o,"vClipPlane3",E),E=H.clipPlane4??n.clipPlane4,Y(o,"vClipPlane4",E),E=H.clipPlane5??n.clipPlane5,Y(o,"vClipPlane5",E),E=H.clipPlane6??n.clipPlane6,Y(o,"vClipPlane6",E)}function Y(o,H,n){n&&o.setFloat4(H,n.normal.x,n.normal.y,n.normal.z,n.d)}n.d(H,{e:()=>E,i:()=>O,l:()=>g,n:()=>k})},11520:(o,H,n)=>{n.d(H,{d:()=>E});class E{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(o,H){this._defines[o]||(o<this._currentRank&&(this._currentRank=o),o>this._maxRank&&(this._maxRank=o),this._defines[o]=new Array),this._defines[o].push(H)}addCPUSkinningFallback(o,H){this._mesh=H,o<this._currentRank&&(this._currentRank=o),o>this._maxRank&&(this._maxRank=o)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(o,H){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,o=o.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),H._bonesComputationForcedToCPU=!0;const n=this._mesh.bo();for(let o=0;o<n.meshes.length;o++){const E=n.meshes[o];if(E.material){if(E.computeBonesUsingShaders&&0!==E.numBoneInfluencers)if(E.material.getEffect()===H)E.computeBonesUsingShaders=!1;else if(E.jg)for(const o of E.jg){if(o.effect===H){E.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&E.computeBonesUsingShaders&&E.numBoneInfluencers>0&&(E.computeBonesUsingShaders=!1)}}else{const H=this._defines[this._currentRank];if(H)for(let n=0;n<H.length;n++)o=o.replace("#define "+H[n],"");this._currentRank++}return o}}},11529:(o,H,n)=>{n.d(H,{e:()=>V});var E=n(11170),k=n(11177),g=n(11024),O=n(11026),Y=n(11060),y=n(11538),S=n(11457),G=n(11038),c=n(11242),A=n(11310),l=n(11224);class x{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(o){this._func=o}get funcRef(){return this._funcRef}set funcRef(o){this._funcRef=o}get funcMask(){return this._funcMask}set funcMask(o){this._funcMask=o}get opStencilFail(){return this._opStencilFail}set opStencilFail(o){this._opStencilFail=o}get opDepthFail(){return this._opDepthFail}set opDepthFail(o){this._opDepthFail=o}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(o){this._opStencilDepthPass=o}get mask(){return this._mask}set mask(o){this._mask=o}get enabled(){return this._enabled}set enabled(o){this._enabled=o}getClassName(){return"MaterialStencilState"}copyTo(o){l.e.Clone((()=>o),this)}serialize(){return l.e.Serialize(this)}parse(o,H,n){l.e.Parse((()=>this),o,H,n)}}(0,E.c)([(0,k.P)()],x.prototype,"func",null),(0,E.c)([(0,k.P)()],x.prototype,"funcRef",null),(0,E.c)([(0,k.P)()],x.prototype,"funcMask",null),(0,E.c)([(0,k.P)()],x.prototype,"opStencilFail",null),(0,E.c)([(0,k.P)()],x.prototype,"opDepthFail",null),(0,E.c)([(0,k.P)()],x.prototype,"opStencilDepthPass",null),(0,E.c)([(0,k.P)()],x.prototype,"mask",null),(0,E.c)([(0,k.P)()],x.prototype,"enabled",null);var z=n(11562);class V{get _supportGlowLayer(){return!1}set _glowModeEnabled(o){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(o){if(this._alpha===o)return;const H=this._alpha;this._alpha=o,1!==H&&1!==o||this.KS(V.MiscDirtyFlag+V.PrePassDirtyFlag)}get alpha(){return this._alpha}set Rg(o){this._backFaceCulling!==o&&(this._backFaceCulling=o,this.KS(V.TextureDirtyFlag))}get Rg(){return this._backFaceCulling}set cullBackFaces(o){this._cullBackFaces!==o&&(this._cullBackFaces=o,this.KS(V.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(o){this._blockDirtyMechanism!==o&&(this._blockDirtyMechanism=o,o||this.lA())}atomicMaterialsUpdate(o){this.blockDirtyMechanism=!0;try{o(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(o){this._onDisposeObserver&&this.yg.remove(this._onDisposeObserver),this._onDisposeObserver=this.yg.add(o)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new O.d),this._onBindObservable}set onBind(o){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(o)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new O.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new O.d),this._onEffectCreatedObservable}set alphaMode(o){this._alphaMode!==o&&(this._alphaMode=o,this.KS(V.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(o){this._needDepthPrePass!==o&&(this._needDepthPrePass=o,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(o){this._fogEnabled!==o&&(this._fogEnabled=o,this.KS(V.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case V.WireFrameFillMode:case V.LineListDrawMode:case V.LineLoopDrawMode:case V.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(o){this.fillMode=o?V.WireFrameFillMode:V.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case V.PointFillMode:case V.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(o){this.fillMode=o?V.PointFillMode:V.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(o){this._fillMode!==o&&(this._fillMode=o,this.KS(V.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(o){const H=this.bo().getEngine().getCaps().fragmentDepthSupported;o&&!H&&G.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=o&&H,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(o){this._drawWrapper=o}constructor(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.yg=new O.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new x,this._useUBO=!1,this._fillMode=V.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=o;const k=H||Y.e.LastCreatedScene;k&&(this._scene=k,this._dirtyCallbacks={},this._forceGLSL=E,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=o||g.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new A.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new S.d(this._scene.getEngine(),void 0,void 0,o),this._useUBO=this.bo().getEngine().supportsUniformBuffers,this._createUniformBuffer(),n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),V.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var o;const H=this.bo().getEngine();null===(o=this._uniformBuffer)||void 0===o||o.dispose(),H.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new S.d(H,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new S.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(o){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.lA(),this.checkReadyOnlyOnce=!0}unfreeze(){this.lA(),this.checkReadyOnlyOnce=!1}isReady(o,H){return!0}isReadyForSubMesh(o,H,n){const E=H.materialDefines;return!!E&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=E,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}bo(){return this._scene}_getEffectiveOrientation(o){return null!==this.sideOrientation?this.sideOrientation:o.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(o){this._transparencyMode!==o&&(this._transparencyMode=o,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===V.MATERIAL_ALPHABLEND||this._transparencyMode===V.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===V.MATERIAL_ALPHATEST||this._transparencyMode===V.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===V.MATERIAL_OPAQUE||this._transparencyMode===V.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(o){return this._hasTransparencyMode?this._transparencyModeIsBlend:o.visibility<1||!this._disableAlphaBlending&&(o.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(o){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(o)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}lA(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H=this.bo().meshes;for(const n of H)if(n.jg)for(const H of n.jg)if(H.Co()===this)for(const n of H._drawWrappers)n&&this._materialContext===n.materialContext&&(n._wasPreviouslyReady=!1,n._wasPreviouslyUsingInstances=null,n._forceRebindOnNextCall=o);o&&this.KS(V.AllDirtyFlag)}_preBind(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.getEngine(),E=(null==H?this.sideOrientation:H)===V.ClockWiseSideOrientation;return n.enableEffect(o||this._getDrawWrapper()),n.setState(this.Rg,this.zOffset,!1,E,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),E}bind(o,H){}buildUniformLayout(){const o=this._uniformBuffer;this._eventInfo.ubo=o,this._callbackPluginEventGeneric(8,this._eventInfo),o.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(o,H,n){const E=n._drawWrapper;this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),E._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(o){}bindView(o){this._useUBO?this._needToBindSceneUbo=!0:o.setMatrix("view",this.bo().getViewMatrix())}bindViewProjection(o){this._useUBO?this._needToBindSceneUbo=!0:(o.setMatrix("viewProjection",this.bo().getTransformMatrix()),o.setMatrix("projection",this.bo().getProjectionMatrix()))}bindEyePosition(o,H){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(o,H)}_afterBind(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&H&&(this._needToBindSceneUbo=!1,(0,z.t)(H,this.bo().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=o?o.visibility:1,this._onBindObservable&&o&&this._onBindObservable.notifyObservers(o),this.disableDepthWrite){const o=this._scene.getEngine();this._cachedDepthWriteState=o.getDepthWrite(),o.setDepthWrite(!1)}if(this.disableColorWrite){const o=this._scene.getEngine();this._cachedColorWriteState=o.getColorWrite(),o.setColorWrite(!1)}if(0!==this.depthFunction){const o=this._scene.getEngine();this._cachedDepthFunctionState=o.getDepthFunction()||0,o.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(o){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=o,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(o){return null}_clonePlugins(o,H){const n={};if(this._serializePlugins(n),V._ParsePlugins(n,o,this._scene,H),this.pluginManager)for(const E of this.pluginManager._plugins){const H=o.pluginManager.getPlugin(E.name);H&&E.copyTo(H)}}getBindedMeshes(){if(this.meshMap){const o=[];for(const H in this.meshMap){const n=this.meshMap[H];n&&o.push(n)}return o}return this._scene.meshes.filter((o=>o.material===this))}forceCompilation(o,H,n,E){const k={clipPlane:!1,useInstances:!1,...n},g=this.bo(),O=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const Y=()=>{if(!this._scene||!this._scene.getEngine())return;const n=g.clipPlane;if(k.clipPlane&&(g.clipPlane=new c.c(0,0,0,1)),this._storeEffectOnSubMeshes){let n=!0,g=null;if(o.jg){const H=new y.d(0,0,0,0,0,o,void 0,!1,!1);H.materialDefines&&(H.materialDefines._renderId=-1),this.isReadyForSubMesh(o,H,k.useInstances)||(H.effect&&H.effect.getCompilationError()&&H.effect.allFallbacksProcessed()?g=H.effect.getCompilationError():(n=!1,setTimeout(Y,16)))}n&&(this.allowShaderHotSwapping=O,g&&E&&E(g),H&&H(this))}else this.isReady()?(this.allowShaderHotSwapping=O,H&&H(this)):setTimeout(Y,16);k.clipPlane&&(g.clipPlane=n)};Y()}async forceCompilationAsync(o,H){return await new Promise(((n,E)=>{this.forceCompilation(o,(()=>{n()}),H,(o=>{E(o)}))}))}KS(o){this.bo().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(V._DirtyCallbackArray.length=0,o&V.ImageProcessingDirtyFlag&&V._DirtyCallbackArray.push(V._ImageProcessingDirtyCallBack),o&V.TextureDirtyFlag&&V._DirtyCallbackArray.push(V._TextureDirtyCallBack),o&V.LightDirtyFlag&&V._DirtyCallbackArray.push(V._LightsDirtyCallBack),o&V.FresnelDirtyFlag&&V._DirtyCallbackArray.push(V._FresnelDirtyCallBack),o&V.AttributesDirtyFlag&&V._DirtyCallbackArray.push(V._AttributeDirtyCallBack),o&V.MiscDirtyFlag&&V._DirtyCallbackArray.push(V._MiscDirtyCallBack),o&V.PrePassDirtyFlag&&V._DirtyCallbackArray.push(V._PrePassDirtyCallBack),V._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(V._RunDirtyCallBacks),this.bo().resetCachedMaterial())}resetDrawCache(){const o=this.bo().meshes;for(const H of o)if(H.jg)for(const o of H.jg)o.Co()===this&&o.resetDrawCache()}_markAllSubMeshesAsDirty(o){const H=this.bo();if(H.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const n=H.meshes;for(const E of n)if(E.jg)for(const n of E.jg){if((n.Co()||(H._hasDefaultMaterial?H.defaultMaterial:null))===this)for(const H of n._drawWrappers)H&&H.defines&&H.defines.markAllAsDirty&&this._materialContext===H.materialContext&&o(H.defines)}}_markScenePrePassDirty(){if(this.bo().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const o=this.bo().enablePrePassRenderer();o&&o.KS()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(V._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(V._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(V._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(V._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(V._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(V._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(V._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(V._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(V._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(V._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const o=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.yg.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(o)}))}}setPrePassRenderer(o){return!1}dispose(o,H,n){const E=this.bo();if(E.stopAnimation(this),E.freeProcessedMaterials(),E.removeMaterial(this),this._eventInfo.forceDisposeTextures=H,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const o=this._parentContainer.materials.indexOf(this);o>-1&&this._parentContainer.materials.splice(o,1),this._parentContainer=null}if(!0!==n)if(this.meshMap)for(const k in this.meshMap){const o=this.meshMap[k];this._disposeMeshResources(o)}else{const o=E.meshes;for(const H of o)this._disposeMeshResources(H)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.yg.notifyObservers(this),this.yg.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(o){if(!o)return;const H=o.wg,n=o._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(o.jg&&n)for(const k of o.jg){const o=k._drawWrappers;for(let g=0;g<o.length;g++){var E;const O=null===(E=o[g])||void 0===E?void 0:E.effect;if(!O)continue;n[g]===this&&(null===H||void 0===H||H._releaseVertexArrayObject(O),k._removeDrawWrapper(g,!0,!0))}}}else null===H||void 0===H||H._releaseVertexArrayObject(this._drawWrapper.effect);o.material!==this||o.sourceMesh||(o.material=null)}serialize(){const o=l.e.Serialize(this);return o.stencil=this.stencil.serialize(),o.uniqueId=this.uniqueId,this._serializePlugins(o),o}_serializePlugins(o){if(o.plugins={},this.pluginManager)for(const H of this.pluginManager._plugins)H.doNotSerialize||(o.plugins[H.getClassName()]=H.serialize())}static Parse(o,H,n){if(o.customType){if("BABYLON.PBRMaterial"===o.customType&&o.overloadedAlbedo&&(o.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return G.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else o.customType="BABYLON.StandardMaterial";const E=g.Tools.Instantiate(o.customType).Parse(o,H,n);return E._loadedUniqueId=o.uniqueId,E}static _ParsePlugins(o,H,n,E){if(o.plugins)for(const Y in o.plugins){var k,O;const y=o.plugins[Y];let S=null===(k=H.pluginManager)||void 0===k?void 0:k.getPlugin(y.name);if(!S){const o=g.Tools.Instantiate("BABYLON."+Y);o&&(S=new o(H))}null===(O=S)||void 0===O||O.parse(y,n,E)}}}V.TriangleFillMode=0,V.WireFrameFillMode=1,V.PointFillMode=2,V.PointListDrawMode=3,V.LineListDrawMode=4,V.LineLoopDrawMode=5,V.LineStripDrawMode=6,V.TriangleStripDrawMode=7,V.TriangleFanDrawMode=8,V.ClockWiseSideOrientation=0,V.CounterClockWiseSideOrientation=1,V.ImageProcessingDirtyFlag=64,V.TextureDirtyFlag=1,V.LightDirtyFlag=2,V.FresnelDirtyFlag=4,V.AttributesDirtyFlag=8,V.MiscDirtyFlag=16,V.PrePassDirtyFlag=32,V.AllDirtyFlag=127,V.MATERIAL_OPAQUE=0,V.MATERIAL_ALPHATEST=1,V.MATERIAL_ALPHABLEND=2,V.MATERIAL_ALPHATESTANDBLEND=3,V.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,V.MATERIAL_NORMALBLENDMETHOD_RNM=1,V.OnEventObservable=new O.d,V._AllDirtyCallBack=o=>o.markAllAsDirty(),V._ImageProcessingDirtyCallBack=o=>o.markAsImageProcessingDirty(),V._TextureDirtyCallBack=o=>o.markAsTexturesDirty(),V._FresnelDirtyCallBack=o=>o.markAsFresnelDirty(),V._MiscDirtyCallBack=o=>o.markAsMiscDirty(),V._PrePassDirtyCallBack=o=>o.markAsPrePassDirty(),V._LightsDirtyCallBack=o=>o.markAsLightDirty(),V._AttributeDirtyCallBack=o=>o.markAsAttributesDirty(),V._FresnelAndMiscDirtyCallBack=o=>{V._FresnelDirtyCallBack(o),V._MiscDirtyCallBack(o)},V._TextureAndMiscDirtyCallBack=o=>{V._TextureDirtyCallBack(o),V._MiscDirtyCallBack(o)},V._DirtyCallbackArray=[],V._RunDirtyCallBacks=o=>{for(const H of V._DirtyCallbackArray)H(o)},(0,E.c)([(0,k.P)()],V.prototype,"id",void 0),(0,E.c)([(0,k.P)()],V.prototype,"uniqueId",void 0),(0,E.c)([(0,k.P)()],V.prototype,"name",void 0),(0,E.c)([(0,k.P)()],V.prototype,"metadata",void 0),(0,E.c)([(0,k.P)()],V.prototype,"checkReadyOnEveryCall",void 0),(0,E.c)([(0,k.P)()],V.prototype,"checkReadyOnlyOnce",void 0),(0,E.c)([(0,k.P)()],V.prototype,"state",void 0),(0,E.c)([(0,k.P)("alpha")],V.prototype,"_alpha",void 0),(0,E.c)([(0,k.P)("Rg")],V.prototype,"_backFaceCulling",void 0),(0,E.c)([(0,k.P)("cullBackFaces")],V.prototype,"_cullBackFaces",void 0),(0,E.c)([(0,k.P)()],V.prototype,"sideOrientation",void 0),(0,E.c)([(0,k.P)("alphaMode")],V.prototype,"_alphaMode",void 0),(0,E.c)([(0,k.P)()],V.prototype,"_needDepthPrePass",void 0),(0,E.c)([(0,k.P)()],V.prototype,"disableDepthWrite",void 0),(0,E.c)([(0,k.P)()],V.prototype,"disableColorWrite",void 0),(0,E.c)([(0,k.P)()],V.prototype,"forceDepthWrite",void 0),(0,E.c)([(0,k.P)()],V.prototype,"depthFunction",void 0),(0,E.c)([(0,k.P)()],V.prototype,"separateCullingPass",void 0),(0,E.c)([(0,k.P)("fogEnabled")],V.prototype,"_fogEnabled",void 0),(0,E.c)([(0,k.P)()],V.prototype,"pointSize",void 0),(0,E.c)([(0,k.P)()],V.prototype,"zOffset",void 0),(0,E.c)([(0,k.P)()],V.prototype,"zOffsetUnits",void 0),(0,E.c)([(0,k.P)()],V.prototype,"pointsCloud",null),(0,E.c)([(0,k.P)()],V.prototype,"fillMode",null),(0,E.c)([(0,k.P)()],V.prototype,"useLogarithmicDepth",null),(0,E.c)([(0,k.P)()],V.prototype,"transparencyMode",null)},11562:(o,H,n)=>{n.d(H,{$:()=>q,A:()=>h,E:()=>m,H:()=>P,I:()=>l,M:()=>A,Q:()=>f,S:()=>K,V:()=>Z,W:()=>J,Y:()=>e,Z:()=>B,ab:()=>D,bb:()=>a,c:()=>Q,f:()=>c,fb:()=>x,i:()=>j,l:()=>G,p:()=>z,t:()=>V,u:()=>N,w:()=>b});var E=n(11038),k=n(11238),g=n(11060),O=n(11515),Y=n(11565);const y=k.NH.Black(),S={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function G(o,H,n){if(!o||o.LOGARITHMICDEPTH||o.indexOf&&o.indexOf("LOGARITHMICDEPTH")>=0){const o=n.activeCamera;1===o.mode&&E.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),H.setFloat("logarithmicDepthConstant",2/(Math.log(o.maxZ+1)/Math.LN2))}}function c(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&o.fogEnabled&&(!H||H.applyFog)&&0!==o.fogMode&&(n.setFloat4("vFogInfos",o.fogMode,o.fogStart,o.fogEnd,o.fogDensity),E?(o.fogColor.toLinearSpaceToRef(y,o.getEngine().useExactSrgbConversions),n.setColor3("vFogColor",y)):n.setColor3("vFogColor",o.fogColor))}function A(o,H,n,E,k,g,O,Y,y,G){const c=o.numMaxInfluencers||o.numInfluencers;return c<=0?0:(H.push("#define MORPHTARGETS"),o.hasPositions&&H.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),o.hasNormals&&H.push("#define MORPHTARGETTEXTURE_HASNORMALS"),o.hasTangents&&H.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),o.hasUVs&&H.push("#define MORPHTARGETTEXTURE_HASUVS"),o.hasUV2s&&H.push("#define MORPHTARGETTEXTURE_HASUV2S"),o.hasColors&&H.push("#define MORPHTARGETTEXTURE_HASCOLORS"),o.supportsPositions&&k&&H.push("#define MORPHTARGETS_POSITION"),o.supportsNormals&&g&&H.push("#define MORPHTARGETS_NORMAL"),o.supportsTangents&&O&&H.push("#define MORPHTARGETS_TANGENT"),o.supportsUVs&&Y&&H.push("#define MORPHTARGETS_UV"),o.supportsUV2s&&y&&H.push("#define MORPHTARGETS_UV2"),o.supportsColors&&G&&H.push("#define MORPHTARGETS_COLOR"),H.push("#define NUM_MORPH_INFLUENCERS "+c),o.isUsingTextureForTargets&&H.push("#define MORPHTARGETS_TEXTURE"),S.NUM_MORPH_INFLUENCERS=c,S.NORMAL=g,S.TANGENT=O,S.UV=Y,S.UV2=y,S.COLOR=G,l(n,E,S,k),c)}function l(o,H,n){let k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=n.NUM_MORPH_INFLUENCERS;if(O>0&&g.e.LastCreatedEngine){const Y=g.e.LastCreatedEngine.getCaps().maxVertexAttribs,y=H.morphTargetManager;if(null!==y&&void 0!==y&&y.isUsingTextureForTargets)return;const S=y&&y.supportsPositions&&k,G=y&&y.supportsNormals&&n.NORMAL,c=y&&y.supportsTangents&&n.TANGENT,A=y&&y.supportsUVs&&n.UV1,l=y&&y.supportsUV2s&&n.UV2,x=y&&y.supportsColors&&n.VERTEXCOLOR;for(let n=0;n<O;n++)S&&o.push("position"+n),G&&o.push("normal"+n),c&&o.push("tangent"+n),A&&o.push("uv_"+n),l&&o.push("uv2_"+n),x&&o.push("color"+n),o.length>Y&&E.d.Error("Cannot add more vertex attributes for mesh "+H.name)}}function x(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"),H&&(o.push("previousWorld0"),o.push("previousWorld1"),o.push("previousWorld2"),o.push("previousWorld3"))}function z(o,H){const n=o.morphTargetManager;o&&n&&H.setFloatArray("morphTargetInfluences",n.influences)}function V(o,H){H.bindToEffect(o,"Scene")}function J(o,H,n){H._needUVs=!0,H[n]=!0,o.optimizeUVAllocation&&o.getTextureMatrix().isIdentityAs3x2()?(H[n+"DIRECTUV"]=o.coordinatesIndex+1,H["MAINUV"+(o.coordinatesIndex+1)]=!0):H[n+"DIRECTUV"]=0}function N(o,H,n){const E=o.getTextureMatrix();H.sg(n+"Matrix",E)}function h(o,H,n){n.BAKED_VERTEX_ANIMATION_TEXTURE&&n.INSTANCES&&o.push("bakedVertexAnimationSettingsInstanced")}function Q(o,H,n){var E;if(H&&o&&(o.computeBonesUsingShaders&&H._bonesComputationForcedToCPU&&(o.computeBonesUsingShaders=!1),o.useBones&&o.computeBonesUsingShaders&&o.skeleton)){const k=o.skeleton;if(k.isUsingTextureForMatrices&&H.getUniformIndex("boneTextureWidth")>-1){const n=k.getTransformMatrixTexture(o);H.setTexture("boneSampler",n),H.setFloat("boneTextureWidth",4*(k.bones.length+1))}else{const g=k.getTransformMatrices(o);g&&(H.setMatrices("mBones",g),n&&o.bo().prePassRenderer&&o.bo().prePassRenderer.getIndex(2)&&(n.previousBones[o.uniqueId]||(n.previousBones[o.uniqueId]=g.slice()),H.setMatrices("mPreviousBones",n.previousBones[o.uniqueId]),E=g,n.previousBones[o.uniqueId].set(E)))}}}function p(o,H,n,E,k){let g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];o._bindLight(H,n,E,k,g)}function j(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const g=Math.min(H.lightSources.length,k);for(let O=0;O<g;O++){p(H.lightSources[O],O,o,n,"boolean"===typeof E?E:E.SPECULARTERM,H.receiveShadows)}}function m(o,H,n,E){n.NUM_BONE_INFLUENCERS>0&&(E.addCPUSkinningFallback(0,H),o.push("matricesIndices"),o.push("matricesWeights"),n.NUM_BONE_INFLUENCERS>4&&(o.push("matricesIndicesExtra"),o.push("matricesWeightsExtra")))}function P(o,H){(H.INSTANCES||H.THIN_INSTANCES)&&x(o,!!H.PREPASS_VELOCITY),H.INSTANCESCOLOR&&o.push("instanceColor")}function b(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=0;for(let g=0;g<n&&o["LIGHT"+g];g++)g>0&&(k=E+g,H.addFallback(k,"LIGHT"+g)),o.SHADOWS||(o["SHADOW"+g]&&H.addFallback(E,"SHADOW"+g),o["SHADOWPCF"+g]&&H.addFallback(E,"SHADOWPCF"+g),o["SHADOWPCSS"+g]&&H.addFallback(E,"SHADOWPCSS"+g),o["SHADOWPOISSON"+g]&&H.addFallback(E,"SHADOWPOISSON"+g),o["SHADOWESM"+g]&&H.addFallback(E,"SHADOWESM"+g),o["SHADOWCLOSEESM"+g]&&H.addFallback(E,"SHADOWCLOSEESM"+g));return k++}function e(o,H,n,E,k,g,O){let Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];O._areMiscDirty&&(O.LOGARITHMICDEPTH=n,O.POINTSIZE=E,O.FOG=k&&function(o,H){return H.fogEnabled&&o.applyFog&&0!==H.fogMode}(o,H),O.NONUNIFORMSCALING=o.nonUniformScaling,O.ALPHATEST=g,O.DECAL_AFTER_DETAIL=Y)}function Z(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n._areLightsDirty)return n._needNormals;let O=0;const Y={needNormals:n._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(o.lightsEnabled&&!g)for(const S of H.lightSources)if(M(o,H,S,O,n,E,Y),O++,O===k)break;n.SPECULARTERM=Y.specularEnabled,n.SHADOWS=Y.shadowEnabled;for(let S=O;S<k;S++)void 0!==n["LIGHT"+S]&&(n["LIGHT"+S]=!1,n["HEMILIGHT"+S]=!1,n["POINTLIGHT"+S]=!1,n["DIRLIGHT"+S]=!1,n["SPOTLIGHT"+S]=!1,n["AREALIGHT"+S]=!1,n["SHADOW"+S]=!1,n["SHADOWCSM"+S]=!1,n["SHADOWCSMDEBUG"+S]=!1,n["SHADOWCSMNUM_CASCADES"+S]=!1,n["SHADOWCSMUSESHADOWMAXZ"+S]=!1,n["SHADOWCSMNOBLEND"+S]=!1,n["SHADOWCSM_RIGHTHANDED"+S]=!1,n["SHADOWPCF"+S]=!1,n["SHADOWPCSS"+S]=!1,n["SHADOWPOISSON"+S]=!1,n["SHADOWESM"+S]=!1,n["SHADOWCLOSEESM"+S]=!1,n["SHADOWCUBE"+S]=!1,n["SHADOWLOWQUALITY"+S]=!1,n["SHADOWMEDIUMQUALITY"+S]=!1);const y=o.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(Y.needRebuild=!0),n.SHADOWFLOAT=Y.shadowEnabled&&(y.textureFloatRender&&y.textureFloatLinearFiltering||y.textureHalfFloatRender&&y.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=Y.lightmapMode,Y.needRebuild&&n.rebuild(),Y.needNormals}function M(o,H,n,E,k,g,Y){switch(Y.needNormals=!0,void 0===k["LIGHT"+E]&&(Y.needRebuild=!0),k["LIGHT"+E]=!0,k["SPOTLIGHT"+E]=!1,k["HEMILIGHT"+E]=!1,k["POINTLIGHT"+E]=!1,k["DIRLIGHT"+E]=!1,k["AREALIGHT"+E]=!1,n.prepareLightSpecificDefines(k,E),k["LIGHT_FALLOFF_PHYSICAL"+E]=!1,k["LIGHT_FALLOFF_GLTF"+E]=!1,k["LIGHT_FALLOFF_STANDARD"+E]=!1,n.falloffType){case O.e.FALLOFF_GLTF:k["LIGHT_FALLOFF_GLTF"+E]=!0;break;case O.e.FALLOFF_PHYSICAL:k["LIGHT_FALLOFF_PHYSICAL"+E]=!0;break;case O.e.FALLOFF_STANDARD:k["LIGHT_FALLOFF_STANDARD"+E]=!0}if(g&&!n.LS.equalsFloats(0,0,0)&&(Y.specularEnabled=!0),k["SHADOW"+E]=!1,k["SHADOWCSM"+E]=!1,k["SHADOWCSMDEBUG"+E]=!1,k["SHADOWCSMNUM_CASCADES"+E]=!1,k["SHADOWCSMUSESHADOWMAXZ"+E]=!1,k["SHADOWCSMNOBLEND"+E]=!1,k["SHADOWCSM_RIGHTHANDED"+E]=!1,k["SHADOWPCF"+E]=!1,k["SHADOWPCSS"+E]=!1,k["SHADOWPOISSON"+E]=!1,k["SHADOWESM"+E]=!1,k["SHADOWCLOSEESM"+E]=!1,k["SHADOWCUBE"+E]=!1,k["SHADOWLOWQUALITY"+E]=!1,k["SHADOWMEDIUMQUALITY"+E]=!1,H&&H.receiveShadows&&o.shadowsEnabled&&n.shadowEnabled){const H=n.getShadowGenerator(o.activeCamera)??n.getShadowGenerator();if(H){const o=H.getShadowMap();o&&o.renderList&&o.renderList.length>0&&(Y.shadowEnabled=!0,H.prepareDefines(k,E))}}n.lightmapMode!=O.e.LIGHTMAP_DEFAULT?(Y.lightmapMode=!0,k["LIGHTMAPEXCLUDED"+E]=!0,k["LIGHTMAPNOSPECULAR"+E]=n.lightmapMode==O.e.LIGHTMAP_SHADOWSONLY):(k["LIGHTMAPEXCLUDED"+E]=!1,k["LIGHTMAPNOSPECULAR"+E]=!1)}function K(o,H,n,E,k){let g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=function(o,H){let n=!1;if(o.activeCamera){const E=H.CAMERA_ORTHOGRAPHIC?1:0,k=H.CAMERA_PERSPECTIVE?1:0,g=1===o.activeCamera.mode?1:0,O=0===o.activeCamera.mode?1:0;(E^g||k^O)&&(H.CAMERA_ORTHOGRAPHIC=1===g,H.CAMERA_PERSPECTIVE=1===O,n=!0)}return n}(o,E);!1!==g&&(y=(0,Y.l)(n,o,E)),E.DEPTHPREPASS!==!H.getColorWrite()&&(E.DEPTHPREPASS=!E.DEPTHPREPASS,y=!0),E.INSTANCES!==k&&(E.INSTANCES=k,y=!0),E.THIN_INSTANCES!==O&&(E.THIN_INSTANCES=O,y=!0),y&&E.markAsUnprocessed()}function f(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],O=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!H._areAttributesDirty&&H._needNormals===H._normals&&H._needUVs===H._uvs)return!1;H._normals=H._needNormals,H._uvs=H._needUVs,H.NORMAL=H._needNormals&&o.isVerticesDataPresent("normal"),H._needNormals&&o.isVerticesDataPresent("tangent")&&(H.TANGENT=!0);for(let Y=1;Y<=6;++Y)H["UV"+Y]=!!H._needUVs&&o.isVerticesDataPresent(`uv${1===Y?"":Y}`);if(n){const n=o.useVertexColors&&o.isVerticesDataPresent("color");H.VERTEXCOLOR=n,H.VERTEXALPHA=o.hasVertexAlpha&&n&&g}return o.isVerticesDataPresent("instanceColor")&&(o.hasInstances||o.hasThinInstances)&&(H.INSTANCESCOLOR=!0),E&&function(o,H){if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){H.NUM_BONE_INFLUENCERS=o.numBoneInfluencers;const n=void 0!==H.BONETEXTURE;if(o.skeleton.isUsingTextureForMatrices&&n)H.BONETEXTURE=!0;else{H.BonesPerMesh=o.skeleton.bones.length+1,H.BONETEXTURE=!n&&void 0;const E=o.bo().prePassRenderer;if(E&&E.enabled){const n=-1===E.excludedSkinnedMesh.indexOf(o);H.BONES_VELOCITY_ENABLED=n}}}else H.NUM_BONE_INFLUENCERS=0,H.BonesPerMesh=0,void 0!==H.BONETEXTURE&&(H.BONETEXTURE=!1)}(o,H),k&&function(o,H){const n=o.morphTargetManager;n?(H.MORPHTARGETS_UV=n.supportsUVs&&H.UV1,H.MORPHTARGETS_UV2=n.supportsUV2s&&H.UV2,H.MORPHTARGETS_TANGENT=n.supportsTangents&&H.TANGENT,H.MORPHTARGETS_NORMAL=n.supportsNormals&&H.NORMAL,H.MORPHTARGETS_POSITION=n.supportsPositions,H.MORPHTARGETS_COLOR=n.supportsColors,H.MORPHTARGETTEXTURE_HASUVS=n.hasUVs,H.MORPHTARGETTEXTURE_HASUV2S=n.hasUV2s,H.MORPHTARGETTEXTURE_HASTANGENTS=n.hasTangents,H.MORPHTARGETTEXTURE_HASNORMALS=n.hasNormals,H.MORPHTARGETTEXTURE_HASPOSITIONS=n.hasPositions,H.MORPHTARGETTEXTURE_HASCOLORS=n.hasColors,H.NUM_MORPH_INFLUENCERS=n.numMaxInfluencers||n.numInfluencers,H.MORPHTARGETS=H.NUM_MORPH_INFLUENCERS>0,H.MORPHTARGETS_TEXTURE=n.isUsingTextureForTargets):(H.MORPHTARGETS_UV=!1,H.MORPHTARGETS_UV2=!1,H.MORPHTARGETS_TANGENT=!1,H.MORPHTARGETS_NORMAL=!1,H.MORPHTARGETS_POSITION=!1,H.MORPHTARGETS_COLOR=!1,H.MORPHTARGETTEXTURE_HASUVS=!1,H.MORPHTARGETTEXTURE_HASUV2S=!1,H.MORPHTARGETTEXTURE_HASTANGENTS=!1,H.MORPHTARGETTEXTURE_HASNORMALS=!1,H.MORPHTARGETTEXTURE_HASPOSITIONS=!1,H.MORPHTARGETTEXTURE_HAS_COLORS=!1,H.MORPHTARGETS=!1,H.NUM_MORPH_INFLUENCERS=0)}(o,H),O&&function(o,H){const n=o.bakedVertexAnimationManager;H.BAKED_VERTEX_ANIMATION_TEXTURE=!(!n||!n.isEnabled)}(o,H),!0}function B(o,H){if(o.activeCamera){const n=H.MULTIVIEW;H.MULTIVIEW=null!==o.activeCamera.outputRenderTarget&&o.activeCamera.outputRenderTarget.getViewCount()>1,H.MULTIVIEW!=n&&H.markAsUnprocessed()}}function q(o,H,n){const E=H.ORDER_INDEPENDENT_TRANSPARENCY,k=H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;H.ORDER_INDEPENDENT_TRANSPARENCY=o.useOrderIndependentTransparency&&n,H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!o.getEngine().getCaps().textureFloatLinearFiltering,E===H.ORDER_INDEPENDENT_TRANSPARENCY&&k===H.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||H.markAsUnprocessed()}function D(o,H,n){const E=H.PREPASS;if(!H._arePrePassDirty)return;const k=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(o.prePassRenderer&&o.prePassRenderer.enabled&&n){H.PREPASS=!0,H.SCENE_MRT_COUNT=o.prePassRenderer.mrtCount,H.PREPASS_NORMAL_WORLDSPACE=o.prePassRenderer.generateNormalsInWorldSpace,H.PREPASS_COLOR=!0,H.PREPASS_COLOR_INDEX=0;for(let n=0;n<k.length;n++){const E=o.prePassRenderer.getIndex(k[n].type);-1!==E?(H[k[n].define]=!0,H[k[n].index]=E):H[k[n].define]=!1}}else{H.PREPASS=!1;for(let o=0;o<k.length;o++)H[k[o].define]=!1}H.PREPASS!=E&&(H.markAsUnprocessed(),H.markAsImageProcessingDirty())}function T(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6];k&&k.push("Light"+o),g||(H.push("vLightData"+o,"vLightDiffuse"+o,"vLightSpecular"+o,"vLightDirection"+o,"vLightWidth"+o,"vLightHeight"+o,"vLightFalloff"+o,"vLightGround"+o,"lightMatrix"+o,"shadowsInfo"+o,"depthValues"+o),n.push("shadowTexture"+o),n.push("depthTexture"+o),H.push("viewFrustumZ"+o,"cascadeBlendFactor"+o,"lightSizeUVCorrection"+o,"depthCorrection"+o,"penumbraDarkness"+o,"frustumLengths"+o),E&&(n.push("projectionLightTexture"+o),H.push("textureProjectionMatrix"+o)),O&&n.push("iesLightTexture"+o))}function a(o,H,n){let E,k,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(o.uniformsNames){const O=o;E=O.uniformsNames,k=O.uniformBuffersNames,H=O.samplers,n=O.defines,g=O.maxSimultaneousLights||0}else E=o,H||(H=[]);for(let O=0;O<g&&n["LIGHT"+O];O++)T(O,E,H,n["PROJECTEDLIGHTTEXTURE"+O],k,!1,n["IESLIGHTTEXTURE"+O]);n.NUM_MORPH_INFLUENCERS&&(E.push("morphTargetInfluences"),E.push("morphTargetCount")),n.BAKED_VERTEX_ANIMATION_TEXTURE&&(E.push("bakedVertexAnimationSettings"),E.push("bakedVertexAnimationTextureSizeInverted"),E.push("bakedVertexAnimationTime"),H.push("bakedVertexAnimationTexture"))}},11525:(o,H,n)=>{n.d(H,{b:()=>g});var E=n(11189),k=n(11529);class g extends k.e{constructor(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(o,H,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new E.Matrix,this._storeEffectOnSubMeshes=n}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(o,H){return!!o&&(!this._storeEffectOnSubMeshes||(!o.jg||0===o.jg.length||this.isReadyForSubMesh(o,o.jg[0],H)))}_isReadyForSubMesh(o){const H=o.materialDefines;return!(this.checkReadyOnEveryCall||!o.effect||!H||H._renderId!==this.bo().getRenderId())}bindOnlyWorldMatrix(o){this._activeEffect.setMatrix("world",o)}bindOnlyNormalMatrix(o){this._activeEffect.setMatrix("normalMatrix",o)}bind(o,H){H&&this.bindForSubMesh(o,H,H.jg[0])}_afterBind(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;super._afterBind(o,H,n),this.bo()._cachedEffect=H,n?n._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n._drawWrapper._forceRebindOnNextCall||o.isCachedMaterialInvalid(this,H,E)}dispose(o,H,n){this._activeEffect=void 0,super.dispose(o,H,n)}}},11559:(o,H,n)=>{n.d(H,{c:()=>Y,d:()=>y});var E=n(11170),k=n(11189),g=n(11177);class O{static extractMinAndMaxIndexed(o,H,n,E,k,g){for(let O=n;O<n+E;O++){const n=3*H[O],E=o[n],Y=o[n+1],y=o[n+2];k.minimizeInPlaceFromFloats(E,Y,y),g.maximizeInPlaceFromFloats(E,Y,y)}}static extractMinAndMax(o,H,n,E,k,g){for(let O=H,Y=H*E;O<H+n;O++,Y+=E){const H=o[Y],n=o[Y+1],E=o[Y+2];k.minimizeInPlaceFromFloats(H,n,E),g.maximizeInPlaceFromFloats(H,n,E)}}}function Y(o,H,n,E){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Y=new k.xH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new k.xH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return O.extractMinAndMaxIndexed(o,H,n,E,Y,y),g&&(Y.x-=Y.x*g.x+g.y,Y.y-=Y.y*g.x+g.y,Y.z-=Y.z*g.x+g.y,y.x+=y.x*g.x+g.y,y.y+=y.y*g.x+g.y,y.z+=y.z*g.x+g.y),{minimum:Y,maximum:y}}function y(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4?arguments[4]:void 0;const Y=new k.xH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new k.xH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g||(g=3),O.extractMinAndMax(o,H,n,g,Y,y),E&&(Y.x-=Y.x*E.x+E.y,Y.y-=Y.y*E.x+E.y,Y.z-=Y.z*E.x+E.y,y.x+=y.x*E.x+E.y,y.y+=y.y*E.x+E.y,y.z+=y.z*E.x+E.y),{minimum:Y,maximum:y}}(0,E.c)([g.h.filter((function(){for(var o=arguments.length,H=new Array(o),n=0;n<o;n++)H[n]=arguments[n];let[E,k]=H;return!Array.isArray(E)&&!Array.isArray(k)}))],O,"extractMinAndMaxIndexed",null),(0,E.c)([g.h.filter((function(){for(var o=arguments.length,H=new Array(o),n=0;n<o;n++)H[n]=arguments[n];let[E]=H;return!Array.isArray(E)}))],O,"extractMinAndMax",null)},11538:(o,H,n)=>{n.d(H,{d:()=>y});var E=n(11259),k=n(11544),g=n(11546),O=n(11559),Y=n(11310);class y{get materialDefines(){var o;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(o=this._getDrawWrapper())||void 0===o?void 0:o.defines}set materialDefines(o){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=o}_getDrawWrapper(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o=o??this._engine.currentRenderPassId;let n=this._drawWrappers[o];return!n&&H&&(this._drawWrappers[o]=n=new Y.c(this._mesh.bo().getEngine())),n}_removeDrawWrapper(o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(n=this._drawWrappers[o])||void 0===n||n.dispose(H));this._drawWrappers[o]=void 0}get effect(){var o;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(o=this._getDrawWrapper())||void 0===o?void 0:o.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(o){this._mainDrawWrapperOverride=o}setEffect(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this._drawWrapper;k.setEffect(o,H,E),void 0!==n&&(k.materialContext=n),o||(k.defines=null,k.materialContext=void 0)}resetDrawCache(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==o)return void this._removeDrawWrapper(o,!0,H);for(const o of this._drawWrappers)null===o||void 0===o||o.dispose(H)}this._drawWrappers=[]}static AddToMesh(o,H,n,E,k,g,O){return new y(o,H,n,E,k,g,O,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(o,H,n,E,k,g,O){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=o,this.verticesStart=H,this.verticesCount=n,this.indexStart=E,this.indexCount=k,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=g,this._renderingMesh=O||g,y&&g.jg.push(this),this._engine=this._mesh.bo().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=g.jg.length-1,Y&&(this.refreshBoundingInfo(),g.Ig(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(o){return this._boundingInfo=o,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const o=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return o||this._renderingMesh}Co(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!H)return o&&this._mesh.bo()._hasDefaultMaterial?this._mesh.bo().defaultMaterial:null;if(this._isMultiMaterial(H)){const o=H.getSubMaterial(this.materialIndex);return this._currentMaterial!==o&&(this._currentMaterial=o,this.resetDrawCache()),o}return H}_isMultiMaterial(o){return void 0!==o.getSubMaterial}refreshBoundingInfo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.wg)return this;if(o||(o=this._renderingMesh.getVerticesData(E.d.PositionKind)),!o)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const H=this._renderingMesh.dg();let n;if(0===this.indexStart&&this.indexCount===H.length){const o=this._renderingMesh.getBoundingInfo();n={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else n=(0,O.c)(o,H,this.indexStart,this.indexCount,this._renderingMesh.wg.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new g.e(n.minimum,n.maximum),this}_checkCollision(o){return this.getBoundingInfo()._checkCollision(o)}updateBoundingInfo(o){let H=this.getBoundingInfo();return H||(this.refreshBoundingInfo(),H=this.getBoundingInfo()),H&&H.update(o),this}isInFrustum(o){const H=this.getBoundingInfo();return!!H&&H.isInFrustum(o,this._mesh.nc)}isCompletelyInFrustum(o){const H=this.getBoundingInfo();return!!H&&H.isCompletelyInFrustum(o)}render(o){return this._renderingMesh.render(this,o,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(o,H){if(!this._linesIndexBuffer){const n=6*Math.floor(this.indexCount/3),E=this.verticesStart+this.verticesCount>65535?new Uint32Array(n):new Uint16Array(n);let k=0;if(0===o.length)for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)E[k++]=o,E[k++]=o+1,E[k++]=o+1,E[k++]=o+2,E[k++]=o+2,E[k++]=o;else for(let H=this.indexStart;H<this.indexStart+this.indexCount;H+=3)E[k++]=o[H],E[k++]=o[H+1],E[k++]=o[H+1],E[k++]=o[H+2],E[k++]=o[H+2],E[k++]=o[H];this._linesIndexBuffer=H.createIndexBuffer(E),this._linesIndexCount=E.length}return this._linesIndexBuffer}canIntersects(o){const H=this.getBoundingInfo();return!!H&&o.intersectsBox(H.boundingBox)}intersects(o,H,n,E,k){const g=this.Co();if(!g)return null;let O=3,Y=!1;switch(g.fillMode){case 3:case 5:case 6:case 8:return null;case 7:O=1,Y=!0}return 4===g.fillMode?n.length?this._intersectLines(o,H,n,this._mesh.intersectionThreshold,E):this._intersectUnIndexedLines(o,H,n,this._mesh.intersectionThreshold,E):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(o,H,n,E,k):this._intersectTriangles(o,H,n,O,Y,E,k)}_intersectLines(o,H,n,E,g){let O=null;for(let Y=this.indexStart;Y<this.indexStart+this.indexCount;Y+=2){const y=H[n[Y]],S=H[n[Y+1]],G=o.intersectionSegment(y,S,E);if(!(G<0)&&((g||!O||G<O.distance)&&(O=new k.c(null,null,G),O.faceId=Y/2,g)))break}return O}_intersectUnIndexedLines(o,H,n,E,g){let O=null;for(let Y=this.verticesStart;Y<this.verticesStart+this.verticesCount;Y+=2){const n=H[Y],y=H[Y+1],S=o.intersectionSegment(n,y,E);if(!(S<0)&&((g||!O||S<O.distance)&&(O=new k.c(null,null,S),O.faceId=Y/2,g)))break}return O}_intersectTriangles(o,H,n,E,k,g,O){let Y=null,y=-1;for(let S=this.indexStart;S<this.indexStart+this.indexCount-(3-E);S+=E){y++;const E=n[S],G=n[S+1],c=n[S+2];if(k&&4294967295===c){S+=2;continue}const A=H[E],l=H[G],x=H[c];if(!A||!l||!x)continue;if(O&&!O(A,l,x,o,E,G,c))continue;const z=o.intersectsTriangle(A,l,x);if(z){if(z.distance<0)continue;if((g||!Y||z.distance<Y.distance)&&(Y=z,Y.faceId=y,g))break}}return Y}_intersectUnIndexedTriangles(o,H,n,E,k){let g=null;for(let O=this.verticesStart;O<this.verticesStart+this.verticesCount;O+=3){const n=H[O],Y=H[O+1],y=H[O+2];if(k&&!k(n,Y,y,o,-1,-1,-1))continue;const S=o.intersectsTriangle(n,Y,y);if(S){if(S.distance<0)continue;if((E||!g||S.distance<g.distance)&&(g=S,g.faceId=O/3,E))break}}return g}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(o,H){const n=new y(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,o,H,!1);if(!this.IsGlobal){const o=this.getBoundingInfo();if(!o)return n;n._boundingInfo=new g.e(o.minimum,o.maximum)}return n}dispose(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.bo().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const H=this._mesh.jg.indexOf(this);this._mesh.jg.splice(H,1),this.resetDrawCache(void 0,o)}getClassName(){return"SubMesh"}static CreateFromIndices(o,H,n,E,k){let g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],O=Number.MAX_VALUE,Y=-Number.MAX_VALUE;const S=(k||E).dg();for(let y=H;y<H+n;y++){const o=S[y];o<O&&(O=o),o>Y&&(Y=o)}return new y(o,O,Y-O+1,H,n,E,k,g)}}}}]);