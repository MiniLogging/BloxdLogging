"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[24],{12888:(r,O,W)=>{W.d(O,{e:()=>q});class q{constructor(r,O,W){this.bu=r,this.bv=O,this.distance=W,this.faceId=0,this.subMeshId=0}}},12893:(r,O,W)=>{W.d(O,{e:()=>T});var q=W(12600),Q=W(12591),C=W(12595);class T{constructor(r,O,W){this.vectors=(0,q.d)(8,Q.eO.Zero),this.center=Q.eO.Zero(),this.centerWorld=Q.eO.Zero(),this.extendSize=Q.eO.Zero(),this.extendSizeWorld=Q.eO.Zero(),this.directions=(0,q.d)(3,Q.eO.Zero),this.vectorsWorld=(0,q.d)(8,Q.eO.Zero),this.minimumWorld=Q.eO.Zero(),this.maximumWorld=Q.eO.Zero(),this.minimum=Q.eO.Zero(),this.maximum=Q.eO.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(r,O,W)}reConstruct(r,O,W){const q=r.x,C=r.y,T=r.z,h=O.x,J=O.y,mr=O.z,d=this.vectors;this.minimum.zh(q,C,T),this.maximum.zh(h,J,mr),d[0].zh(q,C,T),d[1].zh(h,J,mr),d[2].zh(h,C,T),d[3].zh(q,J,T),d[4].zh(q,C,mr),d[5].zh(h,J,T),d[6].zh(q,J,mr),d[7].zh(h,C,mr),O.addToRef(r,this.center).scaleInPlace(.5),O.subtractToRef(r,this.extendSize).scaleInPlace(.5),this._worldMatrix=W||Q.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(r){const O=T._TmpVector3,W=this.maximum.subtractToRef(this.minimum,O[0]),q=W.length();W.normalizeFromLength(q);const Q=q*r,C=W.scaleInPlace(.5*Q),h=this.center.subtractToRef(C,O[1]),J=this.center.addToRef(C,O[2]);return this.reConstruct(h,J,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(r){const O=this.minimumWorld,W=this.maximumWorld,q=this.directions,C=this.vectorsWorld,T=this.vectors;if(r.isIdentity()){O.C(this.minimum),W.C(this.maximum);for(let r=0;r<8;++r)C[r].C(T[r]);this.extendSizeWorld.C(this.extendSize),this.centerWorld.C(this.center)}else{O.Mh(Number.MAX_VALUE),W.Mh(-Number.MAX_VALUE);for(let q=0;q<8;++q){const h=C[q];Q.eO.TransformCoordinatesToRef(T[q],r,h),O.minimizeInPlace(h),W.maximizeInPlace(h)}W.subtractToRef(O,this.extendSizeWorld).scaleInPlace(.5),W.addToRef(O,this.centerWorld).scaleInPlace(.5)}Q.eO.FromArrayToRef(r.m,0,q[0]),Q.eO.FromArrayToRef(r.m,4,q[1]),Q.eO.FromArrayToRef(r.m,8,q[2]),this._worldMatrix=r}isInFrustum(r){return T.IsInFrustum(this.vectorsWorld,r)}isCompletelyInFrustum(r){return T.IsCompletelyInFrustum(this.vectorsWorld,r)}intersectsPoint(r){const O=this.minimumWorld,W=this.maximumWorld,q=O.x,Q=O.y,T=O.z,h=W.x,J=W.y,mr=W.z,d=r.x,v=r.y,g=r.z,K=-C.c;return!(h-d<K||K>d-q)&&(!(J-v<K||K>v-Q)&&!(mr-g<K||K>g-T))}intersectsSphere(r){return T.IntersectsSphere(this.minimumWorld,this.maximumWorld,r.centerWorld,r.radiusWorld)}intersectsMinMax(r,O){const W=this.minimumWorld,q=this.maximumWorld,Q=W.x,C=W.y,T=W.z,h=q.x,J=q.y,mr=q.z,d=r.x,v=r.y,g=r.z,K=O.x,U=O.y,P=O.z;return!(h<d||Q>K)&&(!(J<v||C>U)&&!(mr<g||T>P))}dispose(){var r,O;null===(r=this._drawWrapperFront)||void 0===r||r.dispose(),null===(O=this._drawWrapperBack)||void 0===O||O.dispose()}static Intersects(r,O){return r.intersectsMinMax(O.minimumWorld,O.maximumWorld)}static IntersectsSphere(r,O,W,q){const C=T._TmpVector3[0];Q.eO.ClampToRef(W,r,O,C);return Q.eO.DistanceSquared(W,C)<=q*q}static IsCompletelyInFrustum(r,O){for(let W=0;W<6;++W){const q=O[W];for(let O=0;O<8;++O)if(q.dotCoordinate(r[O])<0)return!1}return!0}static IsInFrustum(r,O){for(let W=0;W<6;++W){let q=!0;const Q=O[W];for(let O=0;O<8;++O)if(Q.dotCoordinate(r[O])>=0){q=!1;break}if(q)return!1}return!0}}T._TmpVector3=(0,q.d)(3,Q.eO.Zero)},12890:(r,O,W)=>{W.d(O,{d:()=>v});var q=W(12600),Q=W(12591),C=W(12893),T=W(12900);const h={min:0,max:0},J={min:0,max:0},mr=(r,O,W)=>{const q=Q.eO.Dot(O.centerWorld,r),C=Math.abs(Q.eO.Dot(O.directions[0],r))*O.extendSize.x+Math.abs(Q.eO.Dot(O.directions[1],r))*O.extendSize.y+Math.abs(Q.eO.Dot(O.directions[2],r))*O.extendSize.z;W.min=q-C,W.max=q+C},d=(r,O,W)=>(mr(r,O,h),mr(r,W,J),!(h.min>J.max||J.min>h.max));class v{constructor(r,O,W){this._isLocked=!1,this.boundingBox=new C.e(r,O,W),this.boundingSphere=new T.c(r,O,W)}reConstruct(r,O,W){this.boundingBox.reConstruct(r,O,W),this.boundingSphere.reConstruct(r,O,W)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(r){this._isLocked=r}update(r){this._isLocked||(this.boundingBox._update(r),this.boundingSphere._update(r))}centerOn(r,O){const W=v._TmpVector3[0].C(r).yv(O),q=v._TmpVector3[1].C(r).addInPlace(O);return this.boundingBox.reConstruct(W,q,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(W,q,this.boundingBox.getWorldMatrix()),this}encapsulate(r){const O=Q.eO.Minimize(this.minimum,r),W=Q.eO.Maximize(this.maximum,r);return this.reConstruct(O,W,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(r){const O=Q.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(O);const W=Q.TmpVectors.eO[0];return Q.eO.TransformCoordinatesToRef(r.boundingBox.minimumWorld,O,W),this.encapsulate(W),Q.eO.TransformCoordinatesToRef(r.boundingBox.maximumWorld,O,W),this.encapsulate(W),this}scale(r){return this.boundingBox.scale(r),this.boundingSphere.scale(r),this}isInFrustum(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===O||3===O)&&this.boundingSphere.isCenterInFrustum(r))return!0;if(!this.boundingSphere.isInFrustum(r))return!1;return!(1!==O&&3!==O)||this.boundingBox.isInFrustum(r)}get diagonalLength(){const r=this.boundingBox;return r.maximumWorld.subtractToRef(r.minimumWorld,v._TmpVector3[0]).length()}isCompletelyInFrustum(r){return this.boundingBox.isCompletelyInFrustum(r)}_checkCollision(r){return r._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(r){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(r)&&!!this.boundingBox.intersectsPoint(r))}intersects(r,O){if(!T.c.Intersects(this.boundingSphere,r.boundingSphere))return!1;if(!C.e.Intersects(this.boundingBox,r.boundingBox))return!1;if(!O)return!0;const W=this.boundingBox,q=r.boundingBox;return!!d(W.directions[0],W,q)&&(!!d(W.directions[1],W,q)&&(!!d(W.directions[2],W,q)&&(!!d(q.directions[0],W,q)&&(!!d(q.directions[1],W,q)&&(!!d(q.directions[2],W,q)&&(!!d(Q.eO.Cross(W.directions[0],q.directions[0]),W,q)&&(!!d(Q.eO.Cross(W.directions[0],q.directions[1]),W,q)&&(!!d(Q.eO.Cross(W.directions[0],q.directions[2]),W,q)&&(!!d(Q.eO.Cross(W.directions[1],q.directions[0]),W,q)&&(!!d(Q.eO.Cross(W.directions[1],q.directions[1]),W,q)&&(!!d(Q.eO.Cross(W.directions[1],q.directions[2]),W,q)&&(!!d(Q.eO.Cross(W.directions[2],q.directions[0]),W,q)&&(!!d(Q.eO.Cross(W.directions[2],q.directions[1]),W,q)&&!!d(Q.eO.Cross(W.directions[2],q.directions[2]),W,q))))))))))))))}}v._TmpVector3=(0,q.d)(2,Q.eO.Zero)},12900:(r,O,W)=>{W.d(O,{c:()=>C});var q=W(12600),Q=W(12591);class C{constructor(r,O,W){this.center=Q.eO.Zero(),this.centerWorld=Q.eO.Zero(),this.minimum=Q.eO.Zero(),this.maximum=Q.eO.Zero(),this.reConstruct(r,O,W)}reConstruct(r,O,W){this.minimum.C(r),this.maximum.C(O);const q=Q.eO.Distance(r,O);O.addToRef(r,this.center).scaleInPlace(.5),this.radius=.5*q,this._update(W||Q.Matrix.IdentityReadOnly)}scale(r){const O=this.radius*r,W=C._TmpVector3,q=W[0].Mh(O),Q=this.center.subtractToRef(q,W[1]),T=this.center.addToRef(q,W[2]);return this.reConstruct(Q,T,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(r){if(r.isIdentity())this.centerWorld.C(this.center),this.radiusWorld=this.radius;else{Q.eO.TransformCoordinatesToRef(this.center,r,this.centerWorld);const O=C._TmpVector3[0];Q.eO.TransformNormalFromFloatsToRef(1,1,1,r,O),this.radiusWorld=Math.max(Math.abs(O.x),Math.abs(O.y),Math.abs(O.z))*this.radius}}isInFrustum(r){const O=this.centerWorld,W=this.radiusWorld;for(let q=0;q<6;q++)if(r[q].dotCoordinate(O)<=-W)return!1;return!0}isCenterInFrustum(r){const O=this.centerWorld;for(let W=0;W<6;W++)if(r[W].dotCoordinate(O)<0)return!1;return!0}intersectsPoint(r){const O=Q.eO.DistanceSquared(this.centerWorld,r);return!(this.radiusWorld*this.radiusWorld<O)}static Intersects(r,O){const W=Q.eO.DistanceSquared(r.centerWorld,O.centerWorld),q=r.radiusWorld+O.radiusWorld;return!(q*q<W)}static CreateFromCenterAndRadius(r,O,W){this._TmpVector3[0].C(r),this._TmpVector3[1].zh(0,0,O),this._TmpVector3[2].C(r),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].yv(this._TmpVector3[1]);const q=new C(this._TmpVector3[0],this._TmpVector3[2]);return q._worldMatrix=W||Q.Matrix.Identity(),q}}C._TmpVector3=(0,q.d)(3,Q.eO.Zero)},12917:(r,O,W)=>{function q(r){-1===r.indexOf("vClipPlane")&&r.push("vClipPlane"),-1===r.indexOf("vClipPlane2")&&r.push("vClipPlane2"),-1===r.indexOf("vClipPlane3")&&r.push("vClipPlane3"),-1===r.indexOf("vClipPlane4")&&r.push("vClipPlane4"),-1===r.indexOf("vClipPlane5")&&r.push("vClipPlane5"),-1===r.indexOf("vClipPlane6")&&r.push("vClipPlane6")}function Q(r,O,W){const q=!!(r.clipPlane??O.clipPlane),Q=!!(r.clipPlane2??O.clipPlane2),C=!!(r.clipPlane3??O.clipPlane3),T=!!(r.clipPlane4??O.clipPlane4),h=!!(r.clipPlane5??O.clipPlane5),J=!!(r.clipPlane6??O.clipPlane6);q&&W.push("#define CLIPPLANE"),Q&&W.push("#define CLIPPLANE2"),C&&W.push("#define CLIPPLANE3"),T&&W.push("#define CLIPPLANE4"),h&&W.push("#define CLIPPLANE5"),J&&W.push("#define CLIPPLANE6")}function C(r,O,W){let q=!1;const Q=!!(r.clipPlane??O.clipPlane),C=!!(r.clipPlane2??O.clipPlane2),T=!!(r.clipPlane3??O.clipPlane3),h=!!(r.clipPlane4??O.clipPlane4),J=!!(r.clipPlane5??O.clipPlane5),mr=!!(r.clipPlane6??O.clipPlane6);return W.CLIPPLANE!==Q&&(W.CLIPPLANE=Q,q=!0),W.CLIPPLANE2!==C&&(W.CLIPPLANE2=C,q=!0),W.CLIPPLANE3!==T&&(W.CLIPPLANE3=T,q=!0),W.CLIPPLANE4!==h&&(W.CLIPPLANE4=h,q=!0),W.CLIPPLANE5!==J&&(W.CLIPPLANE5=J,q=!0),W.CLIPPLANE6!==mr&&(W.CLIPPLANE6=mr,q=!0),q}function T(r,O,W){let q=O.clipPlane??W.clipPlane;h(r,"vClipPlane",q),q=O.clipPlane2??W.clipPlane2,h(r,"vClipPlane2",q),q=O.clipPlane3??W.clipPlane3,h(r,"vClipPlane3",q),q=O.clipPlane4??W.clipPlane4,h(r,"vClipPlane4",q),q=O.clipPlane5??W.clipPlane5,h(r,"vClipPlane5",q),q=O.clipPlane6??W.clipPlane6,h(r,"vClipPlane6",q)}function h(r,O,W){W&&r.setFloat4(O,W.normal.x,W.normal.y,W.normal.z,W.d)}W.d(O,{c:()=>q,f:()=>T,j:()=>C,m:()=>Q})},12868:(r,O,W)=>{W.d(O,{c:()=>q});class q{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(r,O){this._defines[r]||(r<this._currentRank&&(this._currentRank=r),r>this._maxRank&&(this._maxRank=r),this._defines[r]=new Array),this._defines[r].push(O)}addCPUSkinningFallback(r,O){this._mesh=O,r<this._currentRank&&(this._currentRank=r),r>this._maxRank&&(this._maxRank=r)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(r,O){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,r=r.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),O._bonesComputationForcedToCPU=!0;const W=this._mesh.Dr();for(let r=0;r<W.meshes.length;r++){const q=W.meshes[r];if(q.material){if(q.computeBonesUsingShaders&&0!==q.numBoneInfluencers)if(q.material.getEffect()===O)q.computeBonesUsingShaders=!1;else if(q.eh)for(const r of q.eh){if(r.effect===O){q.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&q.computeBonesUsingShaders&&q.numBoneInfluencers>0&&(q.computeBonesUsingShaders=!1)}}else{const O=this._defines[this._currentRank];if(O)for(let W=0;W<O.length;W++)r=r.replace("#define "+O[W],"");this._currentRank++}return r}}},12878:(r,O,W)=>{W.d(O,{d:()=>b});var q=W(12579),Q=W(12583),C=W(12428),T=W(12435),h=W(12484),J=W(12885),mr=W(12819),d=W(12453),v=W(12637),g=W(12707),K=W(12617);class U{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(r){this._func=r}get funcRef(){return this._funcRef}set funcRef(r){this._funcRef=r}get funcMask(){return this._funcMask}set funcMask(r){this._funcMask=r}get opStencilFail(){return this._opStencilFail}set opStencilFail(r){this._opStencilFail=r}get opDepthFail(){return this._opDepthFail}set opDepthFail(r){this._opDepthFail=r}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(r){this._opStencilDepthPass=r}get mask(){return this._mask}set mask(r){this._mask=r}get enabled(){return this._enabled}set enabled(r){this._enabled=r}getClassName(){return"MaterialStencilState"}copyTo(r){K.b.Clone((()=>r),this)}serialize(){return K.b.Serialize(this)}parse(r,O,W){K.b.Parse((()=>this),r,O,W)}}(0,q.b)([(0,Q.G)()],U.prototype,"func",null),(0,q.b)([(0,Q.G)()],U.prototype,"funcRef",null),(0,q.b)([(0,Q.G)()],U.prototype,"funcMask",null),(0,q.b)([(0,Q.G)()],U.prototype,"opStencilFail",null),(0,q.b)([(0,Q.G)()],U.prototype,"opDepthFail",null),(0,q.b)([(0,Q.G)()],U.prototype,"opStencilDepthPass",null),(0,q.b)([(0,Q.G)()],U.prototype,"mask",null),(0,q.b)([(0,Q.G)()],U.prototype,"enabled",null);var P=W(12915);class b{get _supportGlowLayer(){return!1}set _glowModeEnabled(r){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(r){if(this._alpha===r)return;const O=this._alpha;this._alpha=r,1!==O&&1!==r||this.mv(b.MiscDirtyFlag+b.PrePassDirtyFlag)}get alpha(){return this._alpha}set ph(r){this._backFaceCulling!==r&&(this._backFaceCulling=r,this.mv(b.TextureDirtyFlag))}get ph(){return this._backFaceCulling}set cullBackFaces(r){this._cullBackFaces!==r&&(this._cullBackFaces=r,this.mv(b.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(r){this._blockDirtyMechanism!==r&&(this._blockDirtyMechanism=r,r||this.wg())}atomicMaterialsUpdate(r){this.blockDirtyMechanism=!0;try{r(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(r){this._onDisposeObserver&&this.mJ.remove(this._onDisposeObserver),this._onDisposeObserver=this.mJ.add(r)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new T.d),this._onBindObservable}set onBind(r){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(r)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new T.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new T.d),this._onEffectCreatedObservable}set alphaMode(r){this._alphaMode!==r&&(this._alphaMode=r,this.mv(b.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(r){this._needDepthPrePass!==r&&(this._needDepthPrePass=r,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(r){this._fogEnabled!==r&&(this._fogEnabled=r,this.mv(b.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case b.WireFrameFillMode:case b.LineListDrawMode:case b.LineLoopDrawMode:case b.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(r){this.fillMode=r?b.WireFrameFillMode:b.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case b.PointFillMode:case b.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(r){this.fillMode=r?b.PointFillMode:b.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(r){this._fillMode!==r&&(this._fillMode=r,this.mv(b.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(r){const O=this.Dr().getEngine().getCaps().fragmentDepthSupported;r&&!O&&d.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=r&&O,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(r){this._drawWrapper=r}constructor(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.mJ=new T.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.dh=new U,this._useUBO=!1,this._fillMode=b.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=r;const Q=O||h.d.LastCreatedScene;Q&&(this._scene=Q,this._dirtyCallbacks={},this._forceGLSL=q,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=r||C.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new g.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new mr.d(this._scene.getEngine(),void 0,void 0,r),this._useUBO=this.Dr().getEngine().supportsUniformBuffers,this._createUniformBuffer(),W||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),b.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var r;const O=this.Dr().getEngine();null===(r=this._uniformBuffer)||void 0===r||r.dispose(),O.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new mr.d(O,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new mr.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(r){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.wg(),this.checkReadyOnlyOnce=!0}unfreeze(){this.wg(),this.checkReadyOnlyOnce=!1}isReady(r,O){return!0}isReadyForSubMesh(r,O,W){const q=O.materialDefines;return!!q&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Dr(){return this._scene}_getEffectiveOrientation(r){return null!==this.sideOrientation?this.sideOrientation:r.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(r){this._transparencyMode!==r&&(this._transparencyMode=r,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===b.MATERIAL_ALPHABLEND||this._transparencyMode===b.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===b.MATERIAL_ALPHATEST||this._transparencyMode===b.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===b.MATERIAL_OPAQUE||this._transparencyMode===b.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(r){return this._hasTransparencyMode?this._transparencyModeIsBlend:r.visibility<1||!this._disableAlphaBlending&&(r.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(r){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(r)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}wg(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this.Dr().meshes;for(const W of O)if(W.eh)for(const O of W.eh)if(O.ar()===this)for(const W of O._drawWrappers)W&&this._materialContext===W.materialContext&&(W._wasPreviouslyReady=!1,W._wasPreviouslyUsingInstances=null,W._forceRebindOnNextCall=r);r&&this.mv(b.AllDirtyFlag)}_preBind(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.getEngine(),q=(null==O?this.sideOrientation:O)===b.ClockWiseSideOrientation;return W.enableEffect(r||this._getDrawWrapper()),W.setState(this.ph,this.zOffset,!1,q,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.dh,this.zOffsetUnits),q}bind(r,O){}buildUniformLayout(){const r=this._uniformBuffer;this._eventInfo.ubo=r,this._callbackPluginEventGeneric(8,this._eventInfo),r.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(r,O,W){const q=W._drawWrapper;this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),q._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(r){}bindView(r){this._useUBO?this._needToBindSceneUbo=!0:r.setMatrix("view",this.Dr().getViewMatrix())}bindViewProjection(r){this._useUBO?this._needToBindSceneUbo=!0:(r.setMatrix("viewProjection",this.Dr().getTransformMatrix()),r.setMatrix("projection",this.Dr().getProjectionMatrix()))}bindEyePosition(r,O){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(r,O)}_afterBind(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&O&&(this._needToBindSceneUbo=!1,(0,P.r)(O,this.Dr().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=r?r.visibility:1,this._onBindObservable&&r&&this._onBindObservable.notifyObservers(r),this.disableDepthWrite){const r=this._scene.getEngine();this._cachedDepthWriteState=r.getDepthWrite(),r.setDepthWrite(!1)}if(this.disableColorWrite){const r=this._scene.getEngine();this._cachedColorWriteState=r.getColorWrite(),r.setColorWrite(!1)}if(0!==this.depthFunction){const r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(r){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=r,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(r){return null}_clonePlugins(r,O){const W={};if(this._serializePlugins(W),b._ParsePlugins(W,r,this._scene,O),this.pluginManager)for(const q of this.pluginManager._plugins){const O=r.pluginManager.getPlugin(q.name);O&&q.copyTo(O)}}getBindedMeshes(){if(this.meshMap){const r=[];for(const O in this.meshMap){const W=this.meshMap[O];W&&r.push(W)}return r}return this._scene.meshes.filter((r=>r.material===this))}forceCompilation(r,O,W,q){const Q={clipPlane:!1,useInstances:!1,...W},C=this.Dr(),T=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const h=()=>{if(!this._scene||!this._scene.getEngine())return;const W=C.clipPlane;if(Q.clipPlane&&(C.clipPlane=new v.c(0,0,0,1)),this._storeEffectOnSubMeshes){let W=!0,C=null;if(r.eh){const O=new J.e(0,0,0,0,0,r,void 0,!1,!1);O.materialDefines&&(O.materialDefines._renderId=-1),this.isReadyForSubMesh(r,O,Q.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?C=O.effect.getCompilationError():(W=!1,setTimeout(h,16)))}W&&(this.allowShaderHotSwapping=T,C&&q&&q(C),O&&O(this))}else this.isReady()?(this.allowShaderHotSwapping=T,O&&O(this)):setTimeout(h,16);Q.clipPlane&&(C.clipPlane=W)};h()}async forceCompilationAsync(r,O){return await new Promise(((W,q)=>{this.forceCompilation(r,(()=>{W()}),O,(r=>{q(r)}))}))}mv(r){this.Dr().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(b._DirtyCallbackArray.length=0,r&b.ImageProcessingDirtyFlag&&b._DirtyCallbackArray.push(b._ImageProcessingDirtyCallBack),r&b.TextureDirtyFlag&&b._DirtyCallbackArray.push(b._TextureDirtyCallBack),r&b.LightDirtyFlag&&b._DirtyCallbackArray.push(b._LightsDirtyCallBack),r&b.FresnelDirtyFlag&&b._DirtyCallbackArray.push(b._FresnelDirtyCallBack),r&b.AttributesDirtyFlag&&b._DirtyCallbackArray.push(b._AttributeDirtyCallBack),r&b.MiscDirtyFlag&&b._DirtyCallbackArray.push(b._MiscDirtyCallBack),r&b.PrePassDirtyFlag&&b._DirtyCallbackArray.push(b._PrePassDirtyCallBack),b._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(b._RunDirtyCallBacks),this.Dr().resetCachedMaterial())}resetDrawCache(){const r=this.Dr().meshes;for(const O of r)if(O.eh)for(const r of O.eh)r.ar()===this&&r.resetDrawCache()}_markAllSubMeshesAsDirty(r){const O=this.Dr();if(O.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const W=O.meshes;for(const q of W)if(q.eh)for(const W of q.eh){if((W.ar()||(O._hasDefaultMaterial?O.defaultMaterial:null))===this)for(const O of W._drawWrappers)O&&O.defines&&O.defines.markAllAsDirty&&this._materialContext===O.materialContext&&r(O.defines)}}_markScenePrePassDirty(){if(this.Dr().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const r=this.Dr().enablePrePassRenderer();r&&r.mv()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(b._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(b._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(b._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(b._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(b._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(b._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(b._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(b._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(b._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(b._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const r=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.mJ.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(r)}))}}setPrePassRenderer(r){return!1}dispose(r,O,W){const q=this.Dr();if(q.stopAnimation(this),q.freeProcessedMaterials(),q.removeMaterial(this),this._eventInfo.forceDisposeTextures=O,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const r=this._parentContainer.materials.indexOf(this);r>-1&&this._parentContainer.materials.splice(r,1),this._parentContainer=null}if(!0!==W)if(this.meshMap)for(const Q in this.meshMap){const r=this.meshMap[Q];this._disposeMeshResources(r)}else{const r=q.meshes;for(const O of r)this._disposeMeshResources(O)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.mJ.notifyObservers(this),this.mJ.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(r){if(!r)return;const O=r.Nh,W=r._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(r.eh&&W)for(const Q of r.eh){const r=Q._drawWrappers;for(let C=0;C<r.length;C++){var q;const T=null===(q=r[C])||void 0===q?void 0:q.effect;if(!T)continue;W[C]===this&&(null===O||void 0===O||O._releaseVertexArrayObject(T),Q._removeDrawWrapper(C,!0,!0))}}}else null===O||void 0===O||O._releaseVertexArrayObject(this._drawWrapper.effect);r.material!==this||r.sourceMesh||(r.material=null)}serialize(){const r=K.b.Serialize(this);return r.dh=this.dh.serialize(),r.uniqueId=this.uniqueId,this._serializePlugins(r),r}_serializePlugins(r){if(r.plugins={},this.pluginManager)for(const O of this.pluginManager._plugins)O.doNotSerialize||(r.plugins[O.getClassName()]=O.serialize())}static Parse(r,O,W){if(r.customType){if("BABYLON.PBRMaterial"===r.customType&&r.overloadedAlbedo&&(r.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else r.customType="BABYLON.StandardMaterial";const q=C.Tools.Instantiate(r.customType).Parse(r,O,W);return q._loadedUniqueId=r.uniqueId,q}static _ParsePlugins(r,O,W,q){if(r.plugins)for(const h in r.plugins){var Q,T;const J=r.plugins[h];let mr=null===(Q=O.pluginManager)||void 0===Q?void 0:Q.getPlugin(J.name);if(!mr){const r=C.Tools.Instantiate("BABYLON."+h);r&&(mr=new r(O))}null===(T=mr)||void 0===T||T.parse(J,W,q)}}}b.TriangleFillMode=0,b.WireFrameFillMode=1,b.PointFillMode=2,b.PointListDrawMode=3,b.LineListDrawMode=4,b.LineLoopDrawMode=5,b.LineStripDrawMode=6,b.TriangleStripDrawMode=7,b.TriangleFanDrawMode=8,b.ClockWiseSideOrientation=0,b.CounterClockWiseSideOrientation=1,b.ImageProcessingDirtyFlag=64,b.TextureDirtyFlag=1,b.LightDirtyFlag=2,b.FresnelDirtyFlag=4,b.AttributesDirtyFlag=8,b.MiscDirtyFlag=16,b.PrePassDirtyFlag=32,b.AllDirtyFlag=127,b.MATERIAL_OPAQUE=0,b.MATERIAL_ALPHATEST=1,b.MATERIAL_ALPHABLEND=2,b.MATERIAL_ALPHATESTANDBLEND=3,b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,b.MATERIAL_NORMALBLENDMETHOD_RNM=1,b.OnEventObservable=new T.d,b._AllDirtyCallBack=r=>r.markAllAsDirty(),b._ImageProcessingDirtyCallBack=r=>r.markAsImageProcessingDirty(),b._TextureDirtyCallBack=r=>r.markAsTexturesDirty(),b._FresnelDirtyCallBack=r=>r.markAsFresnelDirty(),b._MiscDirtyCallBack=r=>r.markAsMiscDirty(),b._PrePassDirtyCallBack=r=>r.markAsPrePassDirty(),b._LightsDirtyCallBack=r=>r.markAsLightDirty(),b._AttributeDirtyCallBack=r=>r.markAsAttributesDirty(),b._FresnelAndMiscDirtyCallBack=r=>{b._FresnelDirtyCallBack(r),b._MiscDirtyCallBack(r)},b._TextureAndMiscDirtyCallBack=r=>{b._TextureDirtyCallBack(r),b._MiscDirtyCallBack(r)},b._DirtyCallbackArray=[],b._RunDirtyCallBacks=r=>{for(const O of b._DirtyCallbackArray)O(r)},(0,q.b)([(0,Q.G)()],b.prototype,"id",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"uniqueId",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"name",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"metadata",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"checkReadyOnEveryCall",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"checkReadyOnlyOnce",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"state",void 0),(0,q.b)([(0,Q.G)("alpha")],b.prototype,"_alpha",void 0),(0,q.b)([(0,Q.G)("ph")],b.prototype,"_backFaceCulling",void 0),(0,q.b)([(0,Q.G)("cullBackFaces")],b.prototype,"_cullBackFaces",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"sideOrientation",void 0),(0,q.b)([(0,Q.G)("alphaMode")],b.prototype,"_alphaMode",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"_needDepthPrePass",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"disableDepthWrite",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"disableColorWrite",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"forceDepthWrite",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"depthFunction",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"separateCullingPass",void 0),(0,q.b)([(0,Q.G)("fogEnabled")],b.prototype,"_fogEnabled",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"pointSize",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"zOffset",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"zOffsetUnits",void 0),(0,q.b)([(0,Q.G)()],b.prototype,"pointsCloud",null),(0,q.b)([(0,Q.G)()],b.prototype,"fillMode",null),(0,q.b)([(0,Q.G)()],b.prototype,"useLogarithmicDepth",null),(0,q.b)([(0,Q.G)()],b.prototype,"transparencyMode",null)},12915:(r,O,W)=>{W.d(O,{A:()=>G,D:()=>N,E:()=>D,I:()=>K,J:()=>g,L:()=>s,P:()=>k,R:()=>L,U:()=>e,X:()=>z,_:()=>B,bb:()=>Z,cb:()=>E,e:()=>X,eb:()=>V,h:()=>v,hb:()=>U,k:()=>o,l:()=>d,n:()=>P,r:()=>b,v:()=>Y,z:()=>p});var q=W(12453),Q=W(12631),C=W(12484),T=W(12865),h=W(12917);const J=Q.SO.Black(),mr={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function d(r,O,W){if(!r||r.LOGARITHMICDEPTH||r.indexOf&&r.indexOf("LOGARITHMICDEPTH")>=0){const r=W.activeCamera;1===r.mode&&q.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),O.setFloat("logarithmicDepthConstant",2/(Math.log(r.maxZ+1)/Math.LN2))}}function v(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];W&&r.fogEnabled&&(!O||O.applyFog)&&0!==r.fogMode&&(W.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),q?(r.fogColor.toLinearSpaceToRef(J,r.getEngine().useExactSrgbConversions),W.setColor3("vFogColor",J)):W.setColor3("vFogColor",r.fogColor))}function g(r,O,W,q,Q,C,T,h,J,d){const v=r.numMaxInfluencers||r.numInfluencers;return v<=0?0:(O.push("#define MORPHTARGETS"),r.hasPositions&&O.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),r.hasNormals&&O.push("#define MORPHTARGETTEXTURE_HASNORMALS"),r.hasTangents&&O.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),r.hasUVs&&O.push("#define MORPHTARGETTEXTURE_HASUVS"),r.hasUV2s&&O.push("#define MORPHTARGETTEXTURE_HASUV2S"),r.hasColors&&O.push("#define MORPHTARGETTEXTURE_HASCOLORS"),r.supportsPositions&&Q&&O.push("#define MORPHTARGETS_POSITION"),r.supportsNormals&&C&&O.push("#define MORPHTARGETS_NORMAL"),r.supportsTangents&&T&&O.push("#define MORPHTARGETS_TANGENT"),r.supportsUVs&&h&&O.push("#define MORPHTARGETS_UV"),r.supportsUV2s&&J&&O.push("#define MORPHTARGETS_UV2"),r.supportsColors&&d&&O.push("#define MORPHTARGETS_COLOR"),O.push("#define NUM_MORPH_INFLUENCERS "+v),r.isUsingTextureForTargets&&O.push("#define MORPHTARGETS_TEXTURE"),mr.NUM_MORPH_INFLUENCERS=v,mr.NORMAL=C,mr.TANGENT=T,mr.UV=h,mr.UV2=J,mr.COLOR=d,K(W,q,mr,Q),v)}function K(r,O,W){let Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const T=W.NUM_MORPH_INFLUENCERS;if(T>0&&C.d.LastCreatedEngine){const h=C.d.LastCreatedEngine.getCaps().maxVertexAttribs,J=O.morphTargetManager;if(null!==J&&void 0!==J&&J.isUsingTextureForTargets)return;const mr=J&&J.supportsPositions&&Q,d=J&&J.supportsNormals&&W.NORMAL,v=J&&J.supportsTangents&&W.TANGENT,g=J&&J.supportsUVs&&W.UV1,K=J&&J.supportsUV2s&&W.UV2,U=J&&J.supportsColors&&W.VERTEXCOLOR;for(let W=0;W<T;W++)mr&&r.push("position"+W),d&&r.push("normal"+W),v&&r.push("tangent"+W),g&&r.push("uv_"+W),K&&r.push("uv2_"+W),U&&r.push("color"+W),r.length>h&&q.b.Error("Cannot add more vertex attributes for mesh "+O.name)}}function U(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"),O&&(r.push("previousWorld0"),r.push("previousWorld1"),r.push("previousWorld2"),r.push("previousWorld3"))}function P(r,O){const W=r.morphTargetManager;r&&W&&O.setFloatArray("morphTargetInfluences",W.influences)}function b(r,O){O.bindToEffect(r,"Scene")}function e(r,O,W){O._needUVs=!0,O[W]=!0,r.optimizeUVAllocation&&r.getTextureMatrix().isIdentityAs3x2()?(O[W+"DIRECTUV"]=r.coordinatesIndex+1,O["MAINUV"+(r.coordinatesIndex+1)]=!0):O[W+"DIRECTUV"]=0}function Y(r,O,W){const q=r.getTextureMatrix();O.Sh(W+"Matrix",q)}function G(r,O,W){W.BAKED_VERTEX_ANIMATION_TEXTURE&&W.INSTANCES&&r.push("bakedVertexAnimationSettingsInstanced")}function X(r,O,W){var q;if(O&&r&&(r.computeBonesUsingShaders&&O._bonesComputationForcedToCPU&&(r.computeBonesUsingShaders=!1),r.useBones&&r.computeBonesUsingShaders&&r.skeleton)){const Q=r.skeleton;if(Q.isUsingTextureForMatrices&&O.getUniformIndex("boneTextureWidth")>-1){const W=Q.getTransformMatrixTexture(r);O.setTexture("boneSampler",W),O.setFloat("boneTextureWidth",4*(Q.bones.length+1))}else{const C=Q.getTransformMatrices(r);C&&(O.setMatrices("mBones",C),W&&r.Dr().prePassRenderer&&r.Dr().prePassRenderer.getIndex(2)&&(W.previousBones[r.uniqueId]||(W.previousBones[r.uniqueId]=C.slice()),O.setMatrices("mPreviousBones",W.previousBones[r.uniqueId]),q=C,W.previousBones[r.uniqueId].set(q)))}}}function S(r,O,W,q,Q){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];r._bindLight(O,W,q,Q,C)}function o(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const C=Math.min(O.lightSources.length,Q);for(let T=0;T<C;T++){S(O.lightSources[T],T,r,W,"boolean"===typeof q?q:q.SPECULARTERM,O.receiveShadows)}}function N(r,O,W,q){W.NUM_BONE_INFLUENCERS>0&&(q.addCPUSkinningFallback(0,O),r.push("matricesIndices"),r.push("matricesWeights"),W.NUM_BONE_INFLUENCERS>4&&(r.push("matricesIndicesExtra"),r.push("matricesWeightsExtra")))}function D(r,O){(O.INSTANCES||O.THIN_INSTANCES)&&U(r,!!O.PREPASS_VELOCITY),O.INSTANCESCOLOR&&r.push("instanceColor")}function p(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=0;for(let C=0;C<W&&r["LIGHT"+C];C++)C>0&&(Q=q+C,O.addFallback(Q,"LIGHT"+C)),r.SHADOWS||(r["SHADOW"+C]&&O.addFallback(q,"SHADOW"+C),r["SHADOWPCF"+C]&&O.addFallback(q,"SHADOWPCF"+C),r["SHADOWPCSS"+C]&&O.addFallback(q,"SHADOWPCSS"+C),r["SHADOWPOISSON"+C]&&O.addFallback(q,"SHADOWPOISSON"+C),r["SHADOWESM"+C]&&O.addFallback(q,"SHADOWESM"+C),r["SHADOWCLOSEESM"+C]&&O.addFallback(q,"SHADOWCLOSEESM"+C));return Q++}function z(r,O,W,q,Q,C,T){let h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];T._areMiscDirty&&(T.LOGARITHMICDEPTH=W,T.POINTSIZE=q,T.FOG=Q&&function(r,O){return O.fogEnabled&&r.applyFog&&0!==O.fogMode}(r,O),T.NONUNIFORMSCALING=r.nonUniformScaling,T.ALPHATEST=C,T.DECAL_AFTER_DETAIL=h)}function L(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!W._areLightsDirty)return W._needNormals;let T=0;const h={needNormals:W._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(r.lightsEnabled&&!C)for(const mr of O.lightSources)if(M(r,O,mr,T,W,q,h),T++,T===Q)break;W.SPECULARTERM=h.specularEnabled,W.SHADOWS=h.shadowEnabled;for(let mr=T;mr<Q;mr++)void 0!==W["LIGHT"+mr]&&(W["LIGHT"+mr]=!1,W["HEMILIGHT"+mr]=!1,W["POINTLIGHT"+mr]=!1,W["DIRLIGHT"+mr]=!1,W["SPOTLIGHT"+mr]=!1,W["AREALIGHT"+mr]=!1,W["SHADOW"+mr]=!1,W["SHADOWCSM"+mr]=!1,W["SHADOWCSMDEBUG"+mr]=!1,W["SHADOWCSMNUM_CASCADES"+mr]=!1,W["SHADOWCSMUSESHADOWMAXZ"+mr]=!1,W["SHADOWCSMNOBLEND"+mr]=!1,W["SHADOWCSM_RIGHTHANDED"+mr]=!1,W["SHADOWPCF"+mr]=!1,W["SHADOWPCSS"+mr]=!1,W["SHADOWPOISSON"+mr]=!1,W["SHADOWESM"+mr]=!1,W["SHADOWCLOSEESM"+mr]=!1,W["SHADOWCUBE"+mr]=!1,W["SHADOWLOWQUALITY"+mr]=!1,W["SHADOWMEDIUMQUALITY"+mr]=!1);const J=r.getEngine().getCaps();return void 0===W.SHADOWFLOAT&&(h.needRebuild=!0),W.SHADOWFLOAT=h.shadowEnabled&&(J.textureFloatRender&&J.textureFloatLinearFiltering||J.textureHalfFloatRender&&J.textureHalfFloatLinearFiltering),W.LIGHTMAPEXCLUDED=h.lightmapMode,h.needRebuild&&W.rebuild(),h.needNormals}function M(r,O,W,q,Q,C,h){switch(h.needNormals=!0,void 0===Q["LIGHT"+q]&&(h.needRebuild=!0),Q["LIGHT"+q]=!0,Q["SPOTLIGHT"+q]=!1,Q["HEMILIGHT"+q]=!1,Q["POINTLIGHT"+q]=!1,Q["DIRLIGHT"+q]=!1,Q["AREALIGHT"+q]=!1,W.prepareLightSpecificDefines(Q,q),Q["LIGHT_FALLOFF_PHYSICAL"+q]=!1,Q["LIGHT_FALLOFF_GLTF"+q]=!1,Q["LIGHT_FALLOFF_STANDARD"+q]=!1,W.falloffType){case T.e.FALLOFF_GLTF:Q["LIGHT_FALLOFF_GLTF"+q]=!0;break;case T.e.FALLOFF_PHYSICAL:Q["LIGHT_FALLOFF_PHYSICAL"+q]=!0;break;case T.e.FALLOFF_STANDARD:Q["LIGHT_FALLOFF_STANDARD"+q]=!0}if(C&&!W.rv.equalsFloats(0,0,0)&&(h.specularEnabled=!0),Q["SHADOW"+q]=!1,Q["SHADOWCSM"+q]=!1,Q["SHADOWCSMDEBUG"+q]=!1,Q["SHADOWCSMNUM_CASCADES"+q]=!1,Q["SHADOWCSMUSESHADOWMAXZ"+q]=!1,Q["SHADOWCSMNOBLEND"+q]=!1,Q["SHADOWCSM_RIGHTHANDED"+q]=!1,Q["SHADOWPCF"+q]=!1,Q["SHADOWPCSS"+q]=!1,Q["SHADOWPOISSON"+q]=!1,Q["SHADOWESM"+q]=!1,Q["SHADOWCLOSEESM"+q]=!1,Q["SHADOWCUBE"+q]=!1,Q["SHADOWLOWQUALITY"+q]=!1,Q["SHADOWMEDIUMQUALITY"+q]=!1,O&&O.receiveShadows&&r.shadowsEnabled&&W.shadowEnabled){const O=W.getShadowGenerator(r.activeCamera)??W.getShadowGenerator();if(O){const r=O.getShadowMap();r&&r.renderList&&r.renderList.length>0&&(h.shadowEnabled=!0,O.prepareDefines(Q,q))}}W.lightmapMode!=T.e.LIGHTMAP_DEFAULT?(h.lightmapMode=!0,Q["LIGHTMAPEXCLUDED"+q]=!0,Q["LIGHTMAPNOSPECULAR"+q]=W.lightmapMode==T.e.LIGHTMAP_SHADOWSONLY):(Q["LIGHTMAPEXCLUDED"+q]=!1,Q["LIGHTMAPNOSPECULAR"+q]=!1)}function k(r,O,W,q,Q){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=function(r,O){let W=!1;if(r.activeCamera){const q=O.CAMERA_ORTHOGRAPHIC?1:0,Q=O.CAMERA_PERSPECTIVE?1:0,C=1===r.activeCamera.mode?1:0,T=0===r.activeCamera.mode?1:0;(q^C||Q^T)&&(O.CAMERA_ORTHOGRAPHIC=1===C,O.CAMERA_PERSPECTIVE=1===T,W=!0)}return W}(r,q);!1!==C&&(J=(0,h.j)(W,r,q)),q.DEPTHPREPASS!==!O.getColorWrite()&&(q.DEPTHPREPASS=!q.DEPTHPREPASS,J=!0),q.INSTANCES!==Q&&(q.INSTANCES=Q,J=!0),q.THIN_INSTANCES!==T&&(q.THIN_INSTANCES=T,J=!0),J&&q.markAsUnprocessed()}function s(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!O._areAttributesDirty&&O._needNormals===O._normals&&O._needUVs===O._uvs)return!1;O._normals=O._needNormals,O._uvs=O._needUVs,O.NORMAL=O._needNormals&&r.isVerticesDataPresent("normal"),O._needNormals&&r.isVerticesDataPresent("tangent")&&(O.TANGENT=!0);for(let h=1;h<=6;++h)O["UV"+h]=!!O._needUVs&&r.isVerticesDataPresent(`uv${1===h?"":h}`);if(W){const W=r.useVertexColors&&r.isVerticesDataPresent("color");O.VERTEXCOLOR=W,O.VERTEXALPHA=r.hasVertexAlpha&&W&&C}return r.isVerticesDataPresent("instanceColor")&&(r.hasInstances||r.hasThinInstances)&&(O.INSTANCESCOLOR=!0),q&&function(r,O){if(r.useBones&&r.computeBonesUsingShaders&&r.skeleton){O.NUM_BONE_INFLUENCERS=r.numBoneInfluencers;const W=void 0!==O.BONETEXTURE;if(r.skeleton.isUsingTextureForMatrices&&W)O.BONETEXTURE=!0;else{O.BonesPerMesh=r.skeleton.bones.length+1,O.BONETEXTURE=!W&&void 0;const q=r.Dr().prePassRenderer;if(q&&q.enabled){const W=-1===q.excludedSkinnedMesh.indexOf(r);O.BONES_VELOCITY_ENABLED=W}}}else O.NUM_BONE_INFLUENCERS=0,O.BonesPerMesh=0,void 0!==O.BONETEXTURE&&(O.BONETEXTURE=!1)}(r,O),Q&&function(r,O){const W=r.morphTargetManager;W?(O.MORPHTARGETS_UV=W.supportsUVs&&O.UV1,O.MORPHTARGETS_UV2=W.supportsUV2s&&O.UV2,O.MORPHTARGETS_TANGENT=W.supportsTangents&&O.TANGENT,O.MORPHTARGETS_NORMAL=W.supportsNormals&&O.NORMAL,O.MORPHTARGETS_POSITION=W.supportsPositions,O.MORPHTARGETS_COLOR=W.supportsColors,O.MORPHTARGETTEXTURE_HASUVS=W.hasUVs,O.MORPHTARGETTEXTURE_HASUV2S=W.hasUV2s,O.MORPHTARGETTEXTURE_HASTANGENTS=W.hasTangents,O.MORPHTARGETTEXTURE_HASNORMALS=W.hasNormals,O.MORPHTARGETTEXTURE_HASPOSITIONS=W.hasPositions,O.MORPHTARGETTEXTURE_HASCOLORS=W.hasColors,O.NUM_MORPH_INFLUENCERS=W.numMaxInfluencers||W.numInfluencers,O.MORPHTARGETS=O.NUM_MORPH_INFLUENCERS>0,O.MORPHTARGETS_TEXTURE=W.isUsingTextureForTargets):(O.MORPHTARGETS_UV=!1,O.MORPHTARGETS_UV2=!1,O.MORPHTARGETS_TANGENT=!1,O.MORPHTARGETS_NORMAL=!1,O.MORPHTARGETS_POSITION=!1,O.MORPHTARGETS_COLOR=!1,O.MORPHTARGETTEXTURE_HASUVS=!1,O.MORPHTARGETTEXTURE_HASUV2S=!1,O.MORPHTARGETTEXTURE_HASTANGENTS=!1,O.MORPHTARGETTEXTURE_HASNORMALS=!1,O.MORPHTARGETTEXTURE_HASPOSITIONS=!1,O.MORPHTARGETTEXTURE_HAS_COLORS=!1,O.MORPHTARGETS=!1,O.NUM_MORPH_INFLUENCERS=0)}(r,O),T&&function(r,O){const W=r.bakedVertexAnimationManager;O.BAKED_VERTEX_ANIMATION_TEXTURE=!(!W||!W.isEnabled)}(r,O),!0}function B(r,O){if(r.activeCamera){const W=O.MULTIVIEW;O.MULTIVIEW=null!==r.activeCamera.outputRenderTarget&&r.activeCamera.outputRenderTarget.getViewCount()>1,O.MULTIVIEW!=W&&O.markAsUnprocessed()}}function Z(r,O,W){const q=O.ORDER_INDEPENDENT_TRANSPARENCY,Q=O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;O.ORDER_INDEPENDENT_TRANSPARENCY=r.useOrderIndependentTransparency&&W,O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!r.getEngine().getCaps().textureFloatLinearFiltering,q===O.ORDER_INDEPENDENT_TRANSPARENCY&&Q===O.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||O.markAsUnprocessed()}function E(r,O,W){const q=O.PREPASS;if(!O._arePrePassDirty)return;const Q=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(r.prePassRenderer&&r.prePassRenderer.enabled&&W){O.PREPASS=!0,O.SCENE_MRT_COUNT=r.prePassRenderer.mrtCount,O.PREPASS_NORMAL_WORLDSPACE=r.prePassRenderer.generateNormalsInWorldSpace,O.PREPASS_COLOR=!0,O.PREPASS_COLOR_INDEX=0;for(let W=0;W<Q.length;W++){const q=r.prePassRenderer.getIndex(Q[W].type);-1!==q?(O[Q[W].define]=!0,O[Q[W].index]=q):O[Q[W].define]=!1}}else{O.PREPASS=!1;for(let r=0;r<Q.length;r++)O[Q[r].define]=!1}O.PREPASS!=q&&(O.markAsUnprocessed(),O.markAsImageProcessingDirty())}function R(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Q&&Q.push("Light"+r),C||(O.push("vLightData"+r,"vLightDiffuse"+r,"vLightSpecular"+r,"vLightDirection"+r,"vLightWidth"+r,"vLightHeight"+r,"vLightFalloff"+r,"vLightGround"+r,"lightMatrix"+r,"shadowsInfo"+r,"depthValues"+r),W.push("shadowTexture"+r),W.push("depthTexture"+r),O.push("viewFrustumZ"+r,"cascadeBlendFactor"+r,"lightSizeUVCorrection"+r,"depthCorrection"+r,"penumbraDarkness"+r,"frustumLengths"+r),q&&(W.push("projectionLightTexture"+r),O.push("textureProjectionMatrix"+r)),T&&W.push("iesLightTexture"+r))}function V(r,O,W){let q,Q,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(r.uniformsNames){const T=r;q=T.uniformsNames,Q=T.uniformBuffersNames,O=T.samplers,W=T.defines,C=T.maxSimultaneousLights||0}else q=r,O||(O=[]);for(let T=0;T<C&&W["LIGHT"+T];T++)R(T,q,O,W["PROJECTEDLIGHTTEXTURE"+T],Q,!1,W["IESLIGHTTEXTURE"+T]);W.NUM_MORPH_INFLUENCERS&&(q.push("morphTargetInfluences"),q.push("morphTargetCount")),W.BAKED_VERTEX_ANIMATION_TEXTURE&&(q.push("bakedVertexAnimationSettings"),q.push("bakedVertexAnimationTextureSizeInverted"),q.push("bakedVertexAnimationTime"),O.push("bakedVertexAnimationTexture"))}},12872:(r,O,W)=>{W.d(O,{e:()=>C});var q=W(12591),Q=W(12878);class C extends Q.d{constructor(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(r,O,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new q.Matrix,this._storeEffectOnSubMeshes=W}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(r,O){return!!r&&(!this._storeEffectOnSubMeshes||(!r.eh||0===r.eh.length||this.isReadyForSubMesh(r,r.eh[0],O)))}_isReadyForSubMesh(r){const O=r.materialDefines;return!(this.checkReadyOnEveryCall||!r.effect||!O||O._renderId!==this.Dr().getRenderId())}bindOnlyWorldMatrix(r){this._activeEffect.setMatrix("world",r)}bindOnlyNormalMatrix(r){this._activeEffect.setMatrix("normalMatrix",r)}bind(r,O){O&&this.bindForSubMesh(r,O,O.eh[0])}_afterBind(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;super._afterBind(r,O,W),this.Dr()._cachedEffect=O,W?W._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return W._drawWrapper._forceRebindOnNextCall||r.isCachedMaterialInvalid(this,O,q)}dispose(r,O,W){this._activeEffect=void 0,super.dispose(r,O,W)}}},12908:(r,O,W)=>{W.d(O,{d:()=>h,h:()=>J});var q=W(12579),Q=W(12591),C=W(12583);class T{static extractMinAndMaxIndexed(r,O,W,q,Q,C){for(let T=W;T<W+q;T++){const W=3*O[T],q=r[W],h=r[W+1],J=r[W+2];Q.minimizeInPlaceFromFloats(q,h,J),C.maximizeInPlaceFromFloats(q,h,J)}}static extractMinAndMax(r,O,W,q,Q,C){for(let T=O,h=O*q;T<O+W;T++,h+=q){const O=r[h],W=r[h+1],q=r[h+2];Q.minimizeInPlaceFromFloats(O,W,q),C.maximizeInPlaceFromFloats(O,W,q)}}}function h(r,O,W,q){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=new Q.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new Q.eO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return T.extractMinAndMaxIndexed(r,O,W,q,h,J),C&&(h.x-=h.x*C.x+C.y,h.y-=h.y*C.x+C.y,h.z-=h.z*C.x+C.y,J.x+=J.x*C.x+C.y,J.y+=J.y*C.x+C.y,J.z+=J.z*C.x+C.y),{minimum:h,maximum:J}}function J(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0;const h=new Q.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new Q.eO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return C||(C=3),T.extractMinAndMax(r,O,W,C,h,J),q&&(h.x-=h.x*q.x+q.y,h.y-=h.y*q.x+q.y,h.z-=h.z*q.x+q.y,J.x+=J.x*q.x+q.y,J.y+=J.y*q.x+q.y,J.z+=J.z*q.x+q.y),{minimum:h,maximum:J}}(0,q.b)([C.g.filter((function(){for(var r=arguments.length,O=new Array(r),W=0;W<r;W++)O[W]=arguments[W];let[q,Q]=O;return!Array.isArray(q)&&!Array.isArray(Q)}))],T,"extractMinAndMaxIndexed",null),(0,q.b)([C.g.filter((function(){for(var r=arguments.length,O=new Array(r),W=0;W<r;W++)O[W]=arguments[W];let[q]=O;return!Array.isArray(q)}))],T,"extractMinAndMax",null)},12885:(r,O,W)=>{W.d(O,{e:()=>J});var q=W(12660),Q=W(12888),C=W(12890),T=W(12908),h=W(12707);class J{get materialDefines(){var r;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(r=this._getDrawWrapper())||void 0===r?void 0:r.defines}set materialDefines(r){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=r}_getDrawWrapper(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r=r??this._engine.currentRenderPassId;let W=this._drawWrappers[r];return!W&&O&&(this._drawWrappers[r]=W=new h.d(this._mesh.Dr().getEngine())),W}_removeDrawWrapper(r){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var W;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(W=this._drawWrappers[r])||void 0===W||W.dispose(O));this._drawWrappers[r]=void 0}get effect(){var r;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(r=this._getDrawWrapper())||void 0===r?void 0:r.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(r){this._mainDrawWrapperOverride=r}setEffect(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=this._drawWrapper;Q.setEffect(r,O,q),void 0!==W&&(Q.materialContext=W),r||(Q.defines=null,Q.materialContext=void 0)}resetDrawCache(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==r)return void this._removeDrawWrapper(r,!0,O);for(const r of this._drawWrappers)null===r||void 0===r||r.dispose(O)}this._drawWrappers=[]}static AddToMesh(r,O,W,q,Q,C,T){return new J(r,O,W,q,Q,C,T,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(r,O,W,q,Q,C,T){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],J=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=r,this.verticesStart=O,this.verticesCount=W,this.indexStart=q,this.indexCount=Q,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=C,this._renderingMesh=T||C,J&&C.eh.push(this),this._engine=this._mesh.Dr().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=C.eh.length-1,h&&(this.refreshBoundingInfo(),C.oh(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(r){return this._boundingInfo=r,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const r=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return r||this._renderingMesh}ar(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!O)return r&&this._mesh.Dr()._hasDefaultMaterial?this._mesh.Dr().defaultMaterial:null;if(this._isMultiMaterial(O)){const r=O.getSubMaterial(this.materialIndex);return this._currentMaterial!==r&&(this._currentMaterial=r,this.resetDrawCache()),r}return O}_isMultiMaterial(r){return void 0!==r.getSubMaterial}refreshBoundingInfo(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Nh)return this;if(r||(r=this._renderingMesh.getVerticesData(q.i.PositionKind)),!r)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const O=this._renderingMesh.Dh();let W;if(0===this.indexStart&&this.indexCount===O.length){const r=this._renderingMesh.getBoundingInfo();W={minimum:r.minimum.clone(),maximum:r.maximum.clone()}}else W=(0,T.d)(r,O,this.indexStart,this.indexCount,this._renderingMesh.Nh.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new C.d(W.minimum,W.maximum),this}_checkCollision(r){return this.getBoundingInfo()._checkCollision(r)}updateBoundingInfo(r){let O=this.getBoundingInfo();return O||(this.refreshBoundingInfo(),O=this.getBoundingInfo()),O&&O.update(r),this}isInFrustum(r){const O=this.getBoundingInfo();return!!O&&O.isInFrustum(r,this._mesh.Og)}isCompletelyInFrustum(r){const O=this.getBoundingInfo();return!!O&&O.isCompletelyInFrustum(r)}render(r){return this._renderingMesh.render(this,r,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(r,O){if(!this._linesIndexBuffer){const W=6*Math.floor(this.indexCount/3),q=this.verticesStart+this.verticesCount>65535?new Uint32Array(W):new Uint16Array(W);let Q=0;if(0===r.length)for(let r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)q[Q++]=r,q[Q++]=r+1,q[Q++]=r+1,q[Q++]=r+2,q[Q++]=r+2,q[Q++]=r;else for(let O=this.indexStart;O<this.indexStart+this.indexCount;O+=3)q[Q++]=r[O],q[Q++]=r[O+1],q[Q++]=r[O+1],q[Q++]=r[O+2],q[Q++]=r[O+2],q[Q++]=r[O];this._linesIndexBuffer=O.createIndexBuffer(q),this._linesIndexCount=q.length}return this._linesIndexBuffer}canIntersects(r){const O=this.getBoundingInfo();return!!O&&r.intersectsBox(O.boundingBox)}intersects(r,O,W,q,Q){const C=this.ar();if(!C)return null;let T=3,h=!1;switch(C.fillMode){case 3:case 5:case 6:case 8:return null;case 7:T=1,h=!0}return 4===C.fillMode?W.length?this._intersectLines(r,O,W,this._mesh.intersectionThreshold,q):this._intersectUnIndexedLines(r,O,W,this._mesh.intersectionThreshold,q):!W.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(r,O,W,q,Q):this._intersectTriangles(r,O,W,T,h,q,Q)}_intersectLines(r,O,W,q,C){let T=null;for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=2){const J=O[W[h]],mr=O[W[h+1]],d=r.intersectionSegment(J,mr,q);if(!(d<0)&&((C||!T||d<T.distance)&&(T=new Q.e(null,null,d),T.faceId=h/2,C)))break}return T}_intersectUnIndexedLines(r,O,W,q,C){let T=null;for(let h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=2){const W=O[h],J=O[h+1],mr=r.intersectionSegment(W,J,q);if(!(mr<0)&&((C||!T||mr<T.distance)&&(T=new Q.e(null,null,mr),T.faceId=h/2,C)))break}return T}_intersectTriangles(r,O,W,q,Q,C,T){let h=null,J=-1;for(let mr=this.indexStart;mr<this.indexStart+this.indexCount-(3-q);mr+=q){J++;const q=W[mr],d=W[mr+1],v=W[mr+2];if(Q&&4294967295===v){mr+=2;continue}const g=O[q],K=O[d],U=O[v];if(!g||!K||!U)continue;if(T&&!T(g,K,U,r,q,d,v))continue;const P=r.intersectsTriangle(g,K,U);if(P){if(P.distance<0)continue;if((C||!h||P.distance<h.distance)&&(h=P,h.faceId=J,C))break}}return h}_intersectUnIndexedTriangles(r,O,W,q,Q){let C=null;for(let T=this.verticesStart;T<this.verticesStart+this.verticesCount;T+=3){const W=O[T],h=O[T+1],J=O[T+2];if(Q&&!Q(W,h,J,r,-1,-1,-1))continue;const mr=r.intersectsTriangle(W,h,J);if(mr){if(mr.distance<0)continue;if((q||!C||mr.distance<C.distance)&&(C=mr,C.faceId=T/3,q))break}}return C}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(r,O){const W=new J(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,r,O,!1);if(!this.IsGlobal){const r=this.getBoundingInfo();if(!r)return W;W._boundingInfo=new C.d(r.minimum,r.maximum)}return W}dispose(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Dr().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const O=this._mesh.eh.indexOf(this);this._mesh.eh.splice(O,1),this.resetDrawCache(void 0,r)}getClassName(){return"SubMesh"}static CreateFromIndices(r,O,W,q,Q){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=Number.MAX_VALUE,h=-Number.MAX_VALUE;const mr=(Q||q).Dh();for(let J=O;J<O+W;J++){const r=mr[J];r<T&&(T=r),r>h&&(h=r)}return new J(r,T,h-T+1,O,W,q,Q,C)}}}}]);