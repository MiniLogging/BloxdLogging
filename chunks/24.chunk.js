"use strict";(self.wx5iyvo7rvn=self.wx5iyvo7rvn||[]).push([[24],{11451:(P,e,n)=>{n.d(e,{e:()=>H});class H{constructor(P,e,n){this.bu=P,this.bv=e,this.distance=n,this.faceId=0,this.subMeshId=0}}},11462:(P,e,n)=>{n.d(e,{d:()=>k});var H=n(11143),S=n(11133),p=n(11140);class k{constructor(P,e,n){this.vectors=(0,H.e)(8,S.Ie.Zero),this.center=S.Ie.Zero(),this.centerWorld=S.Ie.Zero(),this.extendSize=S.Ie.Zero(),this.extendSizeWorld=S.Ie.Zero(),this.directions=(0,H.e)(3,S.Ie.Zero),this.vectorsWorld=(0,H.e)(8,S.Ie.Zero),this.minimumWorld=S.Ie.Zero(),this.maximumWorld=S.Ie.Zero(),this.minimum=S.Ie.Zero(),this.maximum=S.Ie.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(P,e,n)}reConstruct(P,e,n){const H=P.x,p=P.y,k=P.z,m=e.x,t=e.y,C=e.z,R=this.vectors;this.minimum.dp(H,p,k),this.maximum.dp(m,t,C),R[0].dp(H,p,k),R[1].dp(m,t,C),R[2].dp(m,p,k),R[3].dp(H,t,k),R[4].dp(H,p,C),R[5].dp(m,t,k),R[6].dp(H,t,C),R[7].dp(m,p,C),e.addToRef(P,this.center).scaleInPlace(.5),e.subtractToRef(P,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||S.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(P){const e=k._TmpVector3,n=this.maximum.subtractToRef(this.minimum,e[0]),H=n.length();n.normalizeFromLength(H);const S=H*P,p=n.scaleInPlace(.5*S),m=this.center.subtractToRef(p,e[1]),t=this.center.addToRef(p,e[2]);return this.reConstruct(m,t,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){const e=this.minimumWorld,n=this.maximumWorld,H=this.directions,p=this.vectorsWorld,k=this.vectors;if(P.isIdentity()){e.p(this.minimum),n.p(this.maximum);for(let P=0;P<8;++P)p[P].p(k[P]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{e.zm(Number.MAX_VALUE),n.zm(-Number.MAX_VALUE);for(let H=0;H<8;++H){const m=p[H];S.Ie.TransformCoordinatesToRef(k[H],P,m),e.minimizeInPlace(m),n.maximizeInPlace(m)}n.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(e,this.centerWorld).scaleInPlace(.5)}S.Ie.FromArrayToRef(P.m,0,H[0]),S.Ie.FromArrayToRef(P.m,4,H[1]),S.Ie.FromArrayToRef(P.m,8,H[2]),this._worldMatrix=P}isInFrustum(P){return k.IsInFrustum(this.vectorsWorld,P)}isCompletelyInFrustum(P){return k.IsCompletelyInFrustum(this.vectorsWorld,P)}intersectsPoint(P){const e=this.minimumWorld,n=this.maximumWorld,H=e.x,S=e.y,k=e.z,m=n.x,t=n.y,C=n.z,R=P.x,q=P.y,A=P.z,F=-p.c;return!(m-R<F||F>R-H)&&(!(t-q<F||F>q-S)&&!(C-A<F||F>A-k))}intersectsSphere(P){return k.IntersectsSphere(this.minimumWorld,this.maximumWorld,P.centerWorld,P.radiusWorld)}intersectsMinMax(P,e){const n=this.minimumWorld,H=this.maximumWorld,S=n.x,p=n.y,k=n.z,m=H.x,t=H.y,C=H.z,R=P.x,q=P.y,A=P.z,F=e.x,Y=e.y,j=e.z;return!(m<R||S>F)&&(!(t<q||p>Y)&&!(C<A||k>j))}dispose(){var P,e;null===(P=this._drawWrapperFront)||void 0===P||P.dispose(),null===(e=this._drawWrapperBack)||void 0===e||e.dispose()}static Intersects(P,e){return P.intersectsMinMax(e.minimumWorld,e.maximumWorld)}static IntersectsSphere(P,e,n,H){const p=k._TmpVector3[0];S.Ie.ClampToRef(n,P,e,p);return S.Ie.DistanceSquared(n,p)<=H*H}static IsCompletelyInFrustum(P,e){for(let n=0;n<6;++n){const H=e[n];for(let e=0;e<8;++e)if(H.dotCoordinate(P[e])<0)return!1}return!0}static IsInFrustum(P,e){for(let n=0;n<6;++n){let H=!0;const S=e[n];for(let e=0;e<8;++e)if(S.dotCoordinate(P[e])>=0){H=!1;break}if(H)return!1}return!0}}k._TmpVector3=(0,H.e)(3,S.Ie.Zero)},11457:(P,e,n)=>{n.d(e,{c:()=>q});var H=n(11143),S=n(11133),p=n(11462),k=n(11469);const m={min:0,max:0},t={min:0,max:0},C=(P,e,n)=>{const H=S.Ie.Dot(e.centerWorld,P),p=Math.abs(S.Ie.Dot(e.directions[0],P))*e.extendSize.x+Math.abs(S.Ie.Dot(e.directions[1],P))*e.extendSize.y+Math.abs(S.Ie.Dot(e.directions[2],P))*e.extendSize.z;n.min=H-p,n.max=H+p},R=(P,e,n)=>(C(P,e,m),C(P,n,t),!(m.min>t.max||t.min>m.max));class q{constructor(P,e,n){this._isLocked=!1,this.boundingBox=new p.d(P,e,n),this.boundingSphere=new k.b(P,e,n)}reConstruct(P,e,n){this.boundingBox.reConstruct(P,e,n),this.boundingSphere.reConstruct(P,e,n)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(P){this._isLocked=P}update(P){this._isLocked||(this.boundingBox._update(P),this.boundingSphere._update(P))}centerOn(P,e){const n=q._TmpVector3[0].p(P).MR(e),H=q._TmpVector3[1].p(P).addInPlace(e);return this.boundingBox.reConstruct(n,H,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(n,H,this.boundingBox.getWorldMatrix()),this}encapsulate(P){const e=S.Ie.Minimize(this.minimum,P),n=S.Ie.Maximize(this.maximum,P);return this.reConstruct(e,n,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(P){const e=S.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(e);const n=S.TmpVectors.Ie[0];return S.Ie.TransformCoordinatesToRef(P.boundingBox.minimumWorld,e,n),this.encapsulate(n),S.Ie.TransformCoordinatesToRef(P.boundingBox.maximumWorld,e,n),this.encapsulate(n),this}scale(P){return this.boundingBox.scale(P),this.boundingSphere.scale(P),this}isInFrustum(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===e||3===e)&&this.boundingSphere.isCenterInFrustum(P))return!0;if(!this.boundingSphere.isInFrustum(P))return!1;return!(1!==e&&3!==e)||this.boundingBox.isInFrustum(P)}get diagonalLength(){const P=this.boundingBox;return P.maximumWorld.subtractToRef(P.minimumWorld,q._TmpVector3[0]).length()}isCompletelyInFrustum(P){return this.boundingBox.isCompletelyInFrustum(P)}_checkCollision(P){return P._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(P){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(P)&&!!this.boundingBox.intersectsPoint(P))}intersects(P,e){if(!k.b.Intersects(this.boundingSphere,P.boundingSphere))return!1;if(!p.d.Intersects(this.boundingBox,P.boundingBox))return!1;if(!e)return!0;const n=this.boundingBox,H=P.boundingBox;return!!R(n.directions[0],n,H)&&(!!R(n.directions[1],n,H)&&(!!R(n.directions[2],n,H)&&(!!R(H.directions[0],n,H)&&(!!R(H.directions[1],n,H)&&(!!R(H.directions[2],n,H)&&(!!R(S.Ie.Cross(n.directions[0],H.directions[0]),n,H)&&(!!R(S.Ie.Cross(n.directions[0],H.directions[1]),n,H)&&(!!R(S.Ie.Cross(n.directions[0],H.directions[2]),n,H)&&(!!R(S.Ie.Cross(n.directions[1],H.directions[0]),n,H)&&(!!R(S.Ie.Cross(n.directions[1],H.directions[1]),n,H)&&(!!R(S.Ie.Cross(n.directions[1],H.directions[2]),n,H)&&(!!R(S.Ie.Cross(n.directions[2],H.directions[0]),n,H)&&(!!R(S.Ie.Cross(n.directions[2],H.directions[1]),n,H)&&!!R(S.Ie.Cross(n.directions[2],H.directions[2]),n,H))))))))))))))}}q._TmpVector3=(0,H.e)(2,S.Ie.Zero)},11469:(P,e,n)=>{n.d(e,{b:()=>p});var H=n(11143),S=n(11133);class p{constructor(P,e,n){this.center=S.Ie.Zero(),this.centerWorld=S.Ie.Zero(),this.minimum=S.Ie.Zero(),this.maximum=S.Ie.Zero(),this.reConstruct(P,e,n)}reConstruct(P,e,n){this.minimum.p(P),this.maximum.p(e);const H=S.Ie.Distance(P,e);e.addToRef(P,this.center).scaleInPlace(.5),this.radius=.5*H,this._update(n||S.Matrix.IdentityReadOnly)}scale(P){const e=this.radius*P,n=p._TmpVector3,H=n[0].zm(e),S=this.center.subtractToRef(H,n[1]),k=this.center.addToRef(H,n[2]);return this.reConstruct(S,k,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(P){if(P.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{S.Ie.TransformCoordinatesToRef(this.center,P,this.centerWorld);const e=p._TmpVector3[0];S.Ie.TransformNormalFromFloatsToRef(1,1,1,P,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}}isInFrustum(P){const e=this.centerWorld,n=this.radiusWorld;for(let H=0;H<6;H++)if(P[H].dotCoordinate(e)<=-n)return!1;return!0}isCenterInFrustum(P){const e=this.centerWorld;for(let n=0;n<6;n++)if(P[n].dotCoordinate(e)<0)return!1;return!0}intersectsPoint(P){const e=S.Ie.DistanceSquared(this.centerWorld,P);return!(this.radiusWorld*this.radiusWorld<e)}static Intersects(P,e){const n=S.Ie.DistanceSquared(P.centerWorld,e.centerWorld),H=P.radiusWorld+e.radiusWorld;return!(H*H<n)}static CreateFromCenterAndRadius(P,e,n){this._TmpVector3[0].p(P),this._TmpVector3[1].dp(0,0,e),this._TmpVector3[2].p(P),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].MR(this._TmpVector3[1]);const H=new p(this._TmpVector3[0],this._TmpVector3[2]);return H._worldMatrix=n||S.Matrix.Identity(),H}}p._TmpVector3=(0,H.e)(3,S.Ie.Zero)},11481:(P,e,n)=>{function H(P){-1===P.indexOf("vClipPlane")&&P.push("vClipPlane"),-1===P.indexOf("vClipPlane2")&&P.push("vClipPlane2"),-1===P.indexOf("vClipPlane3")&&P.push("vClipPlane3"),-1===P.indexOf("vClipPlane4")&&P.push("vClipPlane4"),-1===P.indexOf("vClipPlane5")&&P.push("vClipPlane5"),-1===P.indexOf("vClipPlane6")&&P.push("vClipPlane6")}function S(P,e,n){const H=!!(P.clipPlane??e.clipPlane),S=!!(P.clipPlane2??e.clipPlane2),p=!!(P.clipPlane3??e.clipPlane3),k=!!(P.clipPlane4??e.clipPlane4),m=!!(P.clipPlane5??e.clipPlane5),t=!!(P.clipPlane6??e.clipPlane6);H&&n.push("#define CLIPPLANE"),S&&n.push("#define CLIPPLANE2"),p&&n.push("#define CLIPPLANE3"),k&&n.push("#define CLIPPLANE4"),m&&n.push("#define CLIPPLANE5"),t&&n.push("#define CLIPPLANE6")}function p(P,e,n){let H=!1;const S=!!(P.clipPlane??e.clipPlane),p=!!(P.clipPlane2??e.clipPlane2),k=!!(P.clipPlane3??e.clipPlane3),m=!!(P.clipPlane4??e.clipPlane4),t=!!(P.clipPlane5??e.clipPlane5),C=!!(P.clipPlane6??e.clipPlane6);return n.CLIPPLANE!==S&&(n.CLIPPLANE=S,H=!0),n.CLIPPLANE2!==p&&(n.CLIPPLANE2=p,H=!0),n.CLIPPLANE3!==k&&(n.CLIPPLANE3=k,H=!0),n.CLIPPLANE4!==m&&(n.CLIPPLANE4=m,H=!0),n.CLIPPLANE5!==t&&(n.CLIPPLANE5=t,H=!0),n.CLIPPLANE6!==C&&(n.CLIPPLANE6=C,H=!0),H}function k(P,e,n){let H=e.clipPlane??n.clipPlane;m(P,"vClipPlane",H),H=e.clipPlane2??n.clipPlane2,m(P,"vClipPlane2",H),H=e.clipPlane3??n.clipPlane3,m(P,"vClipPlane3",H),H=e.clipPlane4??n.clipPlane4,m(P,"vClipPlane4",H),H=e.clipPlane5??n.clipPlane5,m(P,"vClipPlane5",H),H=e.clipPlane6??n.clipPlane6,m(P,"vClipPlane6",H)}function m(P,e,n){n&&P.setFloat4(e,n.normal.x,n.normal.y,n.normal.z,n.d)}n.d(e,{e:()=>H,g:()=>k,i:()=>p,k:()=>S})},11427:(P,e,n)=>{n.d(e,{d:()=>H});class H{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(P,e){this._defines[P]||(P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P),this._defines[P]=new Array),this._defines[P].push(e)}addCPUSkinningFallback(P,e){this._mesh=e,P<this._currentRank&&(this._currentRank=P),P>this._maxRank&&(this._maxRank=P)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(P,e){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,P=P.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),e._bonesComputationForcedToCPU=!0;const n=this._mesh.BP();for(let P=0;P<n.meshes.length;P++){const H=n.meshes[P];if(H.material){if(H.computeBonesUsingShaders&&0!==H.numBoneInfluencers)if(H.material.getEffect()===e)H.computeBonesUsingShaders=!1;else if(H.ye)for(const P of H.ye){if(P.effect===e){H.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&H.computeBonesUsingShaders&&H.numBoneInfluencers>0&&(H.computeBonesUsingShaders=!1)}}else{const e=this._defines[this._currentRank];if(e)for(let n=0;n<e.length;n++)P=P.replace("#define "+e[n],"");this._currentRank++}return P}}},11438:(P,e,n)=>{n.d(e,{c:()=>z});var H=n(11121),S=n(11125),p=n(10972),k=n(10976),m=n(11017),t=n(11443),C=n(11401),R=n(10988),q=n(11190),A=n(11263),F=n(11170);class Y{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(P){this._func=P}get funcRef(){return this._funcRef}set funcRef(P){this._funcRef=P}get funcMask(){return this._funcMask}set funcMask(P){this._funcMask=P}get opStencilFail(){return this._opStencilFail}set opStencilFail(P){this._opStencilFail=P}get opDepthFail(){return this._opDepthFail}set opDepthFail(P){this._opDepthFail=P}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(P){this._opStencilDepthPass=P}get mask(){return this._mask}set mask(P){this._mask=P}get enabled(){return this._enabled}set enabled(P){this._enabled=P}getClassName(){return"MaterialStencilState"}copyTo(P){F.c.Clone((()=>P),this)}serialize(){return F.c.Serialize(this)}parse(P,e,n){F.c.Parse((()=>this),P,e,n)}}(0,H.b)([(0,S.M)()],Y.prototype,"func",null),(0,H.b)([(0,S.M)()],Y.prototype,"funcRef",null),(0,H.b)([(0,S.M)()],Y.prototype,"funcMask",null),(0,H.b)([(0,S.M)()],Y.prototype,"opStencilFail",null),(0,H.b)([(0,S.M)()],Y.prototype,"opDepthFail",null),(0,H.b)([(0,S.M)()],Y.prototype,"opStencilDepthPass",null),(0,H.b)([(0,S.M)()],Y.prototype,"mask",null),(0,H.b)([(0,S.M)()],Y.prototype,"enabled",null);var j=n(11473);class z{get _supportGlowLayer(){return!1}set _glowModeEnabled(P){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(P){if(this._alpha===P)return;const e=this._alpha;this._alpha=P,1!==e&&1!==P||this.vC(z.MiscDirtyFlag+z.PrePassDirtyFlag)}get alpha(){return this._alpha}set ip(P){this._backFaceCulling!==P&&(this._backFaceCulling=P,this.vC(z.TextureDirtyFlag))}get ip(){return this._backFaceCulling}set cullBackFaces(P){this._cullBackFaces!==P&&(this._cullBackFaces=P,this.vC(z.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(P){this._blockDirtyMechanism!==P&&(this._blockDirtyMechanism=P,P||this.yq())}atomicMaterialsUpdate(P){this.blockDirtyMechanism=!0;try{P(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(P){this._onDisposeObserver&&this.ie.remove(this._onDisposeObserver),this._onDisposeObserver=this.ie.add(P)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new k.b),this._onBindObservable}set onBind(P){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(P)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new k.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new k.b),this._onEffectCreatedObservable}set alphaMode(P){this._alphaMode!==P&&(this._alphaMode=P,this.vC(z.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(P){this._needDepthPrePass!==P&&(this._needDepthPrePass=P,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(P){this._fogEnabled!==P&&(this._fogEnabled=P,this.vC(z.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case z.WireFrameFillMode:case z.LineListDrawMode:case z.LineLoopDrawMode:case z.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(P){this.fillMode=P?z.WireFrameFillMode:z.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case z.PointFillMode:case z.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(P){this.fillMode=P?z.PointFillMode:z.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(P){this._fillMode!==P&&(this._fillMode=P,this.vC(z.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){const e=this.BP().getEngine().getCaps().fragmentDepthSupported;P&&!e&&R.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=P&&e,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(P){this._drawWrapper=P}constructor(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.ie=new k.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Y,this._useUBO=!1,this._fillMode=z.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=P;const S=e||m.d.LastCreatedScene;S&&(this._scene=S,this._dirtyCallbacks={},this._forceGLSL=H,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=P||p.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new A.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new C.c(this._scene.getEngine(),void 0,void 0,P),this._useUBO=this.BP().getEngine().supportsUniformBuffers,this._createUniformBuffer(),n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),z.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var P;const e=this.BP().getEngine();null===(P=this._uniformBuffer)||void 0===P||P.dispose(),e.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new C.c(e,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new C.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(P){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.yq(),this.checkReadyOnlyOnce=!0}unfreeze(){this.yq(),this.checkReadyOnlyOnce=!1}isReady(P,e){return!0}isReadyForSubMesh(P,e,n){const H=e.materialDefines;return!!H&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=H,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}BP(){return this._scene}_getEffectiveOrientation(P){return null!==this.sideOrientation?this.sideOrientation:P.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(P){this._transparencyMode!==P&&(this._transparencyMode=P,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===z.MATERIAL_ALPHABLEND||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===z.MATERIAL_ALPHATEST||this._transparencyMode===z.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===z.MATERIAL_OPAQUE||this._transparencyMode===z.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsBlend:P.visibility<1||!this._disableAlphaBlending&&(P.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(P){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(P)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}yq(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.BP().meshes;for(const n of e)if(n.ye)for(const e of n.ye)if(e.yP()===this)for(const n of e._drawWrappers)n&&this._materialContext===n.materialContext&&(n._wasPreviouslyReady=!1,n._wasPreviouslyUsingInstances=null,n._forceRebindOnNextCall=P);P&&this.vC(z.AllDirtyFlag)}_preBind(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.getEngine(),H=(null==e?this.sideOrientation:e)===z.ClockWiseSideOrientation;return n.enableEffect(P||this._getDrawWrapper()),n.setState(this.ip,this.zOffset,!1,H,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),H}bind(P,e){}buildUniformLayout(){const P=this._uniformBuffer;this._eventInfo.ubo=P,this._callbackPluginEventGeneric(8,this._eventInfo),P.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(P,e,n){const H=n._drawWrapper;this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),H._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(P){}bindView(P){this._useUBO?this._needToBindSceneUbo=!0:P.setMatrix("view",this.BP().getViewMatrix())}bindViewProjection(P){this._useUBO?this._needToBindSceneUbo=!0:(P.setMatrix("viewProjection",this.BP().getTransformMatrix()),P.setMatrix("projection",this.BP().getProjectionMatrix()))}bindEyePosition(P,e){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(P,e)}_afterBind(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&e&&(this._needToBindSceneUbo=!1,(0,j.p)(e,this.BP().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=P?P.visibility:1,this._onBindObservable&&P&&this._onBindObservable.notifyObservers(P),this.disableDepthWrite){const P=this._scene.getEngine();this._cachedDepthWriteState=P.getDepthWrite(),P.setDepthWrite(!1)}if(this.disableColorWrite){const P=this._scene.getEngine();this._cachedColorWriteState=P.getColorWrite(),P.setColorWrite(!1)}if(0!==this.depthFunction){const P=this._scene.getEngine();this._cachedDepthFunctionState=P.getDepthFunction()||0,P.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(P){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=P,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(P){return null}_clonePlugins(P,e){const n={};if(this._serializePlugins(n),z._ParsePlugins(n,P,this._scene,e),this.pluginManager)for(const H of this.pluginManager._plugins){const e=P.pluginManager.getPlugin(H.name);e&&H.copyTo(e)}}getBindedMeshes(){if(this.meshMap){const P=[];for(const e in this.meshMap){const n=this.meshMap[e];n&&P.push(n)}return P}return this._scene.meshes.filter((P=>P.material===this))}forceCompilation(P,e,n,H){const S={clipPlane:!1,useInstances:!1,...n},p=this.BP(),k=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const m=()=>{if(!this._scene||!this._scene.getEngine())return;const n=p.clipPlane;if(S.clipPlane&&(p.clipPlane=new q.c(0,0,0,1)),this._storeEffectOnSubMeshes){let n=!0,p=null;if(P.ye){const e=new t.e(0,0,0,0,0,P,void 0,!1,!1);e.materialDefines&&(e.materialDefines._renderId=-1),this.isReadyForSubMesh(P,e,S.useInstances)||(e.effect&&e.effect.getCompilationError()&&e.effect.allFallbacksProcessed()?p=e.effect.getCompilationError():(n=!1,setTimeout(m,16)))}n&&(this.allowShaderHotSwapping=k,p&&H&&H(p),e&&e(this))}else this.isReady()?(this.allowShaderHotSwapping=k,e&&e(this)):setTimeout(m,16);S.clipPlane&&(p.clipPlane=n)};m()}async forceCompilationAsync(P,e){return await new Promise(((n,H)=>{this.forceCompilation(P,(()=>{n()}),e,(P=>{H(P)}))}))}vC(P){this.BP().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(z._DirtyCallbackArray.length=0,P&z.ImageProcessingDirtyFlag&&z._DirtyCallbackArray.push(z._ImageProcessingDirtyCallBack),P&z.TextureDirtyFlag&&z._DirtyCallbackArray.push(z._TextureDirtyCallBack),P&z.LightDirtyFlag&&z._DirtyCallbackArray.push(z._LightsDirtyCallBack),P&z.FresnelDirtyFlag&&z._DirtyCallbackArray.push(z._FresnelDirtyCallBack),P&z.AttributesDirtyFlag&&z._DirtyCallbackArray.push(z._AttributeDirtyCallBack),P&z.MiscDirtyFlag&&z._DirtyCallbackArray.push(z._MiscDirtyCallBack),P&z.PrePassDirtyFlag&&z._DirtyCallbackArray.push(z._PrePassDirtyCallBack),z._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(z._RunDirtyCallBacks),this.BP().resetCachedMaterial())}resetDrawCache(){const P=this.BP().meshes;for(const e of P)if(e.ye)for(const P of e.ye)P.yP()===this&&P.resetDrawCache()}_markAllSubMeshesAsDirty(P){const e=this.BP();if(e.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const n=e.meshes;for(const H of n)if(H.ye)for(const n of H.ye){if((n.yP()||(e._hasDefaultMaterial?e.defaultMaterial:null))===this)for(const e of n._drawWrappers)e&&e.defines&&e.defines.markAllAsDirty&&this._materialContext===e.materialContext&&P(e.defines)}}_markScenePrePassDirty(){if(this.BP().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const P=this.BP().enablePrePassRenderer();P&&P.vC()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(z._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(z._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(z._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(z._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(z._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(z._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(z._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(z._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(z._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(z._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const P=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.ie.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(P)}))}}setPrePassRenderer(P){return!1}dispose(P,e,n){const H=this.BP();if(H.stopAnimation(this),H.freeProcessedMaterials(),H.removeMaterial(this),this._eventInfo.forceDisposeTextures=e,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const P=this._parentContainer.materials.indexOf(this);P>-1&&this._parentContainer.materials.splice(P,1),this._parentContainer=null}if(!0!==n)if(this.meshMap)for(const S in this.meshMap){const P=this.meshMap[S];this._disposeMeshResources(P)}else{const P=H.meshes;for(const e of P)this._disposeMeshResources(e)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.ie.notifyObservers(this),this.ie.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(P){if(!P)return;const e=P.en,n=P._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(P.ye&&n)for(const S of P.ye){const P=S._drawWrappers;for(let p=0;p<P.length;p++){var H;const k=null===(H=P[p])||void 0===H?void 0:H.effect;if(!k)continue;n[p]===this&&(null===e||void 0===e||e._releaseVertexArrayObject(k),S._removeDrawWrapper(p,!0,!0))}}}else null===e||void 0===e||e._releaseVertexArrayObject(this._drawWrapper.effect);P.material!==this||P.sourceMesh||(P.material=null)}serialize(){const P=F.c.Serialize(this);return P.stencil=this.stencil.serialize(),P.uniqueId=this.uniqueId,this._serializePlugins(P),P}_serializePlugins(P){if(P.plugins={},this.pluginManager)for(const e of this.pluginManager._plugins)e.doNotSerialize||(P.plugins[e.getClassName()]=e.serialize())}static Parse(P,e,n){if(P.customType){if("BABYLON.PBRMaterial"===P.customType&&P.overloadedAlbedo&&(P.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return R.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else P.customType="BABYLON.StandardMaterial";const H=p.Tools.Instantiate(P.customType).Parse(P,e,n);return H._loadedUniqueId=P.uniqueId,H}static _ParsePlugins(P,e,n,H){if(P.plugins)for(const m in P.plugins){var S,k;const t=P.plugins[m];let C=null===(S=e.pluginManager)||void 0===S?void 0:S.getPlugin(t.name);if(!C){const P=p.Tools.Instantiate("BABYLON."+m);P&&(C=new P(e))}null===(k=C)||void 0===k||k.parse(t,n,H)}}}z.TriangleFillMode=0,z.WireFrameFillMode=1,z.PointFillMode=2,z.PointListDrawMode=3,z.LineListDrawMode=4,z.LineLoopDrawMode=5,z.LineStripDrawMode=6,z.TriangleStripDrawMode=7,z.TriangleFanDrawMode=8,z.ClockWiseSideOrientation=0,z.CounterClockWiseSideOrientation=1,z.ImageProcessingDirtyFlag=64,z.TextureDirtyFlag=1,z.LightDirtyFlag=2,z.FresnelDirtyFlag=4,z.AttributesDirtyFlag=8,z.MiscDirtyFlag=16,z.PrePassDirtyFlag=32,z.AllDirtyFlag=127,z.MATERIAL_OPAQUE=0,z.MATERIAL_ALPHATEST=1,z.MATERIAL_ALPHABLEND=2,z.MATERIAL_ALPHATESTANDBLEND=3,z.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,z.MATERIAL_NORMALBLENDMETHOD_RNM=1,z.OnEventObservable=new k.b,z._AllDirtyCallBack=P=>P.markAllAsDirty(),z._ImageProcessingDirtyCallBack=P=>P.markAsImageProcessingDirty(),z._TextureDirtyCallBack=P=>P.markAsTexturesDirty(),z._FresnelDirtyCallBack=P=>P.markAsFresnelDirty(),z._MiscDirtyCallBack=P=>P.markAsMiscDirty(),z._PrePassDirtyCallBack=P=>P.markAsPrePassDirty(),z._LightsDirtyCallBack=P=>P.markAsLightDirty(),z._AttributeDirtyCallBack=P=>P.markAsAttributesDirty(),z._FresnelAndMiscDirtyCallBack=P=>{z._FresnelDirtyCallBack(P),z._MiscDirtyCallBack(P)},z._TextureAndMiscDirtyCallBack=P=>{z._TextureDirtyCallBack(P),z._MiscDirtyCallBack(P)},z._DirtyCallbackArray=[],z._RunDirtyCallBacks=P=>{for(const e of z._DirtyCallbackArray)e(P)},(0,H.b)([(0,S.M)()],z.prototype,"id",void 0),(0,H.b)([(0,S.M)()],z.prototype,"uniqueId",void 0),(0,H.b)([(0,S.M)()],z.prototype,"name",void 0),(0,H.b)([(0,S.M)()],z.prototype,"metadata",void 0),(0,H.b)([(0,S.M)()],z.prototype,"checkReadyOnEveryCall",void 0),(0,H.b)([(0,S.M)()],z.prototype,"checkReadyOnlyOnce",void 0),(0,H.b)([(0,S.M)()],z.prototype,"state",void 0),(0,H.b)([(0,S.M)("alpha")],z.prototype,"_alpha",void 0),(0,H.b)([(0,S.M)("ip")],z.prototype,"_backFaceCulling",void 0),(0,H.b)([(0,S.M)("cullBackFaces")],z.prototype,"_cullBackFaces",void 0),(0,H.b)([(0,S.M)()],z.prototype,"sideOrientation",void 0),(0,H.b)([(0,S.M)("alphaMode")],z.prototype,"_alphaMode",void 0),(0,H.b)([(0,S.M)()],z.prototype,"_needDepthPrePass",void 0),(0,H.b)([(0,S.M)()],z.prototype,"disableDepthWrite",void 0),(0,H.b)([(0,S.M)()],z.prototype,"disableColorWrite",void 0),(0,H.b)([(0,S.M)()],z.prototype,"forceDepthWrite",void 0),(0,H.b)([(0,S.M)()],z.prototype,"depthFunction",void 0),(0,H.b)([(0,S.M)()],z.prototype,"separateCullingPass",void 0),(0,H.b)([(0,S.M)("fogEnabled")],z.prototype,"_fogEnabled",void 0),(0,H.b)([(0,S.M)()],z.prototype,"pointSize",void 0),(0,H.b)([(0,S.M)()],z.prototype,"zOffset",void 0),(0,H.b)([(0,S.M)()],z.prototype,"zOffsetUnits",void 0),(0,H.b)([(0,S.M)()],z.prototype,"pointsCloud",null),(0,H.b)([(0,S.M)()],z.prototype,"fillMode",null),(0,H.b)([(0,S.M)()],z.prototype,"useLogarithmicDepth",null),(0,H.b)([(0,S.M)()],z.prototype,"transparencyMode",null)},11473:(P,e,n)=>{n.d(e,{$:()=>y,A:()=>B,D:()=>l,G:()=>F,H:()=>A,I:()=>c,K:()=>Q,M:()=>d,P:()=>w,Q:()=>T,U:()=>r,W:()=>o,X:()=>G,bb:()=>Y,c:()=>O,g:()=>q,h:()=>i,i:()=>R,m:()=>j,p:()=>z,r:()=>J,t:()=>b,x:()=>I});var H=n(10988),S=n(11183),p=n(11017),k=n(11422),m=n(11481);const t=S.Ne.Black(),C={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function R(P,e,n){if(!P||P.LOGARITHMICDEPTH||P.indexOf&&P.indexOf("LOGARITHMICDEPTH")>=0){const P=n.activeCamera;1===P.mode&&H.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(P.maxZ+1)/Math.LN2))}}function q(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&P.fogEnabled&&(!e||e.applyFog)&&0!==P.fogMode&&(n.setFloat4("vFogInfos",P.fogMode,P.fogStart,P.fogEnd,P.fogDensity),H?(P.fogColor.toLinearSpaceToRef(t,P.getEngine().useExactSrgbConversions),n.setColor3("vFogColor",t)):n.setColor3("vFogColor",P.fogColor))}function A(P,e,n,H,S,p,k,m,t,R){const q=P.numMaxInfluencers||P.numInfluencers;return q<=0?0:(e.push("#define MORPHTARGETS"),P.hasPositions&&e.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),P.hasNormals&&e.push("#define MORPHTARGETTEXTURE_HASNORMALS"),P.hasTangents&&e.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),P.hasUVs&&e.push("#define MORPHTARGETTEXTURE_HASUVS"),P.hasUV2s&&e.push("#define MORPHTARGETTEXTURE_HASUV2S"),P.hasColors&&e.push("#define MORPHTARGETTEXTURE_HASCOLORS"),P.supportsPositions&&S&&e.push("#define MORPHTARGETS_POSITION"),P.supportsNormals&&p&&e.push("#define MORPHTARGETS_NORMAL"),P.supportsTangents&&k&&e.push("#define MORPHTARGETS_TANGENT"),P.supportsUVs&&m&&e.push("#define MORPHTARGETS_UV"),P.supportsUV2s&&t&&e.push("#define MORPHTARGETS_UV2"),P.supportsColors&&R&&e.push("#define MORPHTARGETS_COLOR"),e.push("#define NUM_MORPH_INFLUENCERS "+q),P.isUsingTextureForTargets&&e.push("#define MORPHTARGETS_TEXTURE"),C.NUM_MORPH_INFLUENCERS=q,C.NORMAL=p,C.TANGENT=k,C.UV=m,C.UV2=t,C.COLOR=R,F(n,H,C,S),q)}function F(P,e,n){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=n.NUM_MORPH_INFLUENCERS;if(k>0&&p.d.LastCreatedEngine){const m=p.d.LastCreatedEngine.getCaps().maxVertexAttribs,t=e.morphTargetManager;if(null!==t&&void 0!==t&&t.isUsingTextureForTargets)return;const C=t&&t.supportsPositions&&S,R=t&&t.supportsNormals&&n.NORMAL,q=t&&t.supportsTangents&&n.TANGENT,A=t&&t.supportsUVs&&n.UV1,F=t&&t.supportsUV2s&&n.UV2,Y=t&&t.supportsColors&&n.VERTEXCOLOR;for(let n=0;n<k;n++)C&&P.push("position"+n),R&&P.push("normal"+n),q&&P.push("tangent"+n),A&&P.push("uv_"+n),F&&P.push("uv2_"+n),Y&&P.push("color"+n),P.length>m&&H.c.Error("Cannot add more vertex attributes for mesh "+e.name)}}function Y(P){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P.push("world0"),P.push("world1"),P.push("world2"),P.push("world3"),e&&(P.push("previousWorld0"),P.push("previousWorld1"),P.push("previousWorld2"),P.push("previousWorld3"))}function j(P,e){const n=P.morphTargetManager;P&&n&&e.setFloatArray("morphTargetInfluences",n.influences)}function z(P,e){e.bindToEffect(P,"Scene")}function w(P,e,n){e._needUVs=!0,e[n]=!0,P.optimizeUVAllocation&&P.getTextureMatrix().isIdentityAs3x2()?(e[n+"DIRECTUV"]=P.coordinatesIndex+1,e["MAINUV"+(P.coordinatesIndex+1)]=!0):e[n+"DIRECTUV"]=0}function J(P,e,n){const H=P.getTextureMatrix();e.he(n+"Matrix",H)}function I(P,e,n){n.BAKED_VERTEX_ANIMATION_TEXTURE&&n.INSTANCES&&P.push("bakedVertexAnimationSettingsInstanced")}function O(P,e,n){var H;if(e&&P&&(P.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(P.computeBonesUsingShaders=!1),P.useBones&&P.computeBonesUsingShaders&&P.skeleton)){const S=P.skeleton;if(S.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){const n=S.getTransformMatrixTexture(P);e.setTexture("boneSampler",n),e.setFloat("boneTextureWidth",4*(S.bones.length+1))}else{const p=S.getTransformMatrices(P);p&&(e.setMatrices("mBones",p),n&&P.BP().prePassRenderer&&P.BP().prePassRenderer.getIndex(2)&&(n.previousBones[P.uniqueId]||(n.previousBones[P.uniqueId]=p.slice()),e.setMatrices("mPreviousBones",n.previousBones[P.uniqueId]),H=p,n.previousBones[P.uniqueId].set(H)))}}}function V(P,e,n,H,S){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];P._bindLight(e,n,H,S,p)}function i(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const p=Math.min(e.lightSources.length,S);for(let k=0;k<p;k++){V(e.lightSources[k],k,P,n,"boolean"===typeof H?H:H.SPECULARTERM,e.receiveShadows)}}function B(P,e,n,H){n.NUM_BONE_INFLUENCERS>0&&(H.addCPUSkinningFallback(0,e),P.push("matricesIndices"),P.push("matricesWeights"),n.NUM_BONE_INFLUENCERS>4&&(P.push("matricesIndicesExtra"),P.push("matricesWeightsExtra")))}function l(P,e){(e.INSTANCES||e.THIN_INSTANCES)&&Y(P,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&P.push("instanceColor")}function b(P,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=0;for(let p=0;p<n&&P["LIGHT"+p];p++)p>0&&(S=H+p,e.addFallback(S,"LIGHT"+p)),P.SHADOWS||(P["SHADOW"+p]&&e.addFallback(H,"SHADOW"+p),P["SHADOWPCF"+p]&&e.addFallback(H,"SHADOWPCF"+p),P["SHADOWPCSS"+p]&&e.addFallback(H,"SHADOWPCSS"+p),P["SHADOWPOISSON"+p]&&e.addFallback(H,"SHADOWPOISSON"+p),P["SHADOWESM"+p]&&e.addFallback(H,"SHADOWESM"+p),P["SHADOWCLOSEESM"+p]&&e.addFallback(H,"SHADOWCLOSEESM"+p));return S++}function T(P,e,n,H,S,p,k){let m=arguments.length>7&&void 0!==arguments[7]&&arguments[7];k._areMiscDirty&&(k.LOGARITHMICDEPTH=n,k.POINTSIZE=H,k.FOG=S&&function(P,e){return e.fogEnabled&&P.applyFog&&0!==e.fogMode}(P,e),k.NONUNIFORMSCALING=P.nonUniformScaling,k.ALPHATEST=p,k.DECAL_AFTER_DETAIL=m)}function d(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n._areLightsDirty)return n._needNormals;let k=0;const m={needNormals:n._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(P.lightsEnabled&&!p)for(const C of e.lightSources)if(N(P,e,C,k,n,H,m),k++,k===S)break;n.SPECULARTERM=m.specularEnabled,n.SHADOWS=m.shadowEnabled;for(let C=k;C<S;C++)void 0!==n["LIGHT"+C]&&(n["LIGHT"+C]=!1,n["HEMILIGHT"+C]=!1,n["POINTLIGHT"+C]=!1,n["DIRLIGHT"+C]=!1,n["SPOTLIGHT"+C]=!1,n["AREALIGHT"+C]=!1,n["SHADOW"+C]=!1,n["SHADOWCSM"+C]=!1,n["SHADOWCSMDEBUG"+C]=!1,n["SHADOWCSMNUM_CASCADES"+C]=!1,n["SHADOWCSMUSESHADOWMAXZ"+C]=!1,n["SHADOWCSMNOBLEND"+C]=!1,n["SHADOWCSM_RIGHTHANDED"+C]=!1,n["SHADOWPCF"+C]=!1,n["SHADOWPCSS"+C]=!1,n["SHADOWPOISSON"+C]=!1,n["SHADOWESM"+C]=!1,n["SHADOWCLOSEESM"+C]=!1,n["SHADOWCUBE"+C]=!1,n["SHADOWLOWQUALITY"+C]=!1,n["SHADOWMEDIUMQUALITY"+C]=!1);const t=P.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(m.needRebuild=!0),n.SHADOWFLOAT=m.shadowEnabled&&(t.textureFloatRender&&t.textureFloatLinearFiltering||t.textureHalfFloatRender&&t.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=m.lightmapMode,m.needRebuild&&n.rebuild(),m.needNormals}function N(P,e,n,H,S,p,m){switch(m.needNormals=!0,void 0===S["LIGHT"+H]&&(m.needRebuild=!0),S["LIGHT"+H]=!0,S["SPOTLIGHT"+H]=!1,S["HEMILIGHT"+H]=!1,S["POINTLIGHT"+H]=!1,S["DIRLIGHT"+H]=!1,S["AREALIGHT"+H]=!1,n.prepareLightSpecificDefines(S,H),S["LIGHT_FALLOFF_PHYSICAL"+H]=!1,S["LIGHT_FALLOFF_GLTF"+H]=!1,S["LIGHT_FALLOFF_STANDARD"+H]=!1,n.falloffType){case k.c.FALLOFF_GLTF:S["LIGHT_FALLOFF_GLTF"+H]=!0;break;case k.c.FALLOFF_PHYSICAL:S["LIGHT_FALLOFF_PHYSICAL"+H]=!0;break;case k.c.FALLOFF_STANDARD:S["LIGHT_FALLOFF_STANDARD"+H]=!0}if(p&&!n.tR.equalsFloats(0,0,0)&&(m.specularEnabled=!0),S["SHADOW"+H]=!1,S["SHADOWCSM"+H]=!1,S["SHADOWCSMDEBUG"+H]=!1,S["SHADOWCSMNUM_CASCADES"+H]=!1,S["SHADOWCSMUSESHADOWMAXZ"+H]=!1,S["SHADOWCSMNOBLEND"+H]=!1,S["SHADOWCSM_RIGHTHANDED"+H]=!1,S["SHADOWPCF"+H]=!1,S["SHADOWPCSS"+H]=!1,S["SHADOWPOISSON"+H]=!1,S["SHADOWESM"+H]=!1,S["SHADOWCLOSEESM"+H]=!1,S["SHADOWCUBE"+H]=!1,S["SHADOWLOWQUALITY"+H]=!1,S["SHADOWMEDIUMQUALITY"+H]=!1,e&&e.receiveShadows&&P.shadowsEnabled&&n.shadowEnabled){const e=n.getShadowGenerator(P.activeCamera)??n.getShadowGenerator();if(e){const P=e.getShadowMap();P&&P.renderList&&P.renderList.length>0&&(m.shadowEnabled=!0,e.prepareDefines(S,H))}}n.lightmapMode!=k.c.LIGHTMAP_DEFAULT?(m.lightmapMode=!0,S["LIGHTMAPEXCLUDED"+H]=!0,S["LIGHTMAPNOSPECULAR"+H]=n.lightmapMode==k.c.LIGHTMAP_SHADOWSONLY):(S["LIGHTMAPEXCLUDED"+H]=!1,S["LIGHTMAPNOSPECULAR"+H]=!1)}function Q(P,e,n,H,S){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=function(P,e){let n=!1;if(P.activeCamera){const H=e.CAMERA_ORTHOGRAPHIC?1:0,S=e.CAMERA_PERSPECTIVE?1:0,p=1===P.activeCamera.mode?1:0,k=0===P.activeCamera.mode?1:0;(H^p||S^k)&&(e.CAMERA_ORTHOGRAPHIC=1===p,e.CAMERA_PERSPECTIVE=1===k,n=!0)}return n}(P,H);!1!==p&&(t=(0,m.i)(n,P,H)),H.DEPTHPREPASS!==!e.getColorWrite()&&(H.DEPTHPREPASS=!H.DEPTHPREPASS,t=!0),H.INSTANCES!==S&&(H.INSTANCES=S,t=!0),H.THIN_INSTANCES!==k&&(H.THIN_INSTANCES=k,t=!0),t&&H.markAsUnprocessed()}function c(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&P.isVerticesDataPresent("normal"),e._needNormals&&P.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let m=1;m<=6;++m)e["UV"+m]=!!e._needUVs&&P.isVerticesDataPresent(`uv${1===m?"":m}`);if(n){const n=P.useVertexColors&&P.isVerticesDataPresent("color");e.VERTEXCOLOR=n,e.VERTEXALPHA=P.hasVertexAlpha&&n&&p}return P.isVerticesDataPresent("instanceColor")&&(P.hasInstances||P.hasThinInstances)&&(e.INSTANCESCOLOR=!0),H&&function(P,e){if(P.useBones&&P.computeBonesUsingShaders&&P.skeleton){e.NUM_BONE_INFLUENCERS=P.numBoneInfluencers;const n=void 0!==e.BONETEXTURE;if(P.skeleton.isUsingTextureForMatrices&&n)e.BONETEXTURE=!0;else{e.BonesPerMesh=P.skeleton.bones.length+1,e.BONETEXTURE=!n&&void 0;const H=P.BP().prePassRenderer;if(H&&H.enabled){const n=-1===H.excludedSkinnedMesh.indexOf(P);e.BONES_VELOCITY_ENABLED=n}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,void 0!==e.BONETEXTURE&&(e.BONETEXTURE=!1)}(P,e),S&&function(P,e){const n=P.morphTargetManager;n?(e.MORPHTARGETS_UV=n.supportsUVs&&e.UV1,e.MORPHTARGETS_UV2=n.supportsUV2s&&e.UV2,e.MORPHTARGETS_TANGENT=n.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=n.supportsNormals&&e.NORMAL,e.MORPHTARGETS_POSITION=n.supportsPositions,e.MORPHTARGETS_COLOR=n.supportsColors,e.MORPHTARGETTEXTURE_HASUVS=n.hasUVs,e.MORPHTARGETTEXTURE_HASUV2S=n.hasUV2s,e.MORPHTARGETTEXTURE_HASTANGENTS=n.hasTangents,e.MORPHTARGETTEXTURE_HASNORMALS=n.hasNormals,e.MORPHTARGETTEXTURE_HASPOSITIONS=n.hasPositions,e.MORPHTARGETTEXTURE_HASCOLORS=n.hasColors,e.NUM_MORPH_INFLUENCERS=n.numMaxInfluencers||n.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=n.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_UV2=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_POSITION=!1,e.MORPHTARGETS_COLOR=!1,e.MORPHTARGETTEXTURE_HASUVS=!1,e.MORPHTARGETTEXTURE_HASUV2S=!1,e.MORPHTARGETTEXTURE_HASTANGENTS=!1,e.MORPHTARGETTEXTURE_HASNORMALS=!1,e.MORPHTARGETTEXTURE_HASPOSITIONS=!1,e.MORPHTARGETTEXTURE_HAS_COLORS=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}(P,e),k&&function(P,e){const n=P.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!(!n||!n.isEnabled)}(P,e),!0}function r(P,e){if(P.activeCamera){const n=e.MULTIVIEW;e.MULTIVIEW=null!==P.activeCamera.outputRenderTarget&&P.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=n&&e.markAsUnprocessed()}}function o(P,e,n){const H=e.ORDER_INDEPENDENT_TRANSPARENCY,S=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=P.useOrderIndependentTransparency&&n,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!P.getEngine().getCaps().textureFloatLinearFiltering,H===e.ORDER_INDEPENDENT_TRANSPARENCY&&S===e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||e.markAsUnprocessed()}function G(P,e,n){const H=e.PREPASS;if(!e._arePrePassDirty)return;const S=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(P.prePassRenderer&&P.prePassRenderer.enabled&&n){e.PREPASS=!0,e.SCENE_MRT_COUNT=P.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=P.prePassRenderer.generateNormalsInWorldSpace,e.PREPASS_COLOR=!0,e.PREPASS_COLOR_INDEX=0;for(let n=0;n<S.length;n++){const H=P.prePassRenderer.getIndex(S[n].type);-1!==H?(e[S[n].define]=!0,e[S[n].index]=H):e[S[n].define]=!1}}else{e.PREPASS=!1;for(let P=0;P<S.length;P++)e[S[P].define]=!1}e.PREPASS!=H&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function g(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];S&&S.push("Light"+P),p||(e.push("vLightData"+P,"vLightDiffuse"+P,"vLightSpecular"+P,"vLightDirection"+P,"vLightWidth"+P,"vLightHeight"+P,"vLightFalloff"+P,"vLightGround"+P,"lightMatrix"+P,"shadowsInfo"+P,"depthValues"+P),n.push("shadowTexture"+P),n.push("depthTexture"+P),e.push("viewFrustumZ"+P,"cascadeBlendFactor"+P,"lightSizeUVCorrection"+P,"depthCorrection"+P,"penumbraDarkness"+P,"frustumLengths"+P),H&&(n.push("projectionLightTexture"+P),e.push("textureProjectionMatrix"+P)),k&&n.push("iesLightTexture"+P))}function y(P,e,n){let H,S,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(P.uniformsNames){const k=P;H=k.uniformsNames,S=k.uniformBuffersNames,e=k.samplers,n=k.defines,p=k.maxSimultaneousLights||0}else H=P,e||(e=[]);for(let k=0;k<p&&n["LIGHT"+k];k++)g(k,H,e,n["PROJECTEDLIGHTTEXTURE"+k],S,!1,n["IESLIGHTTEXTURE"+k]);n.NUM_MORPH_INFLUENCERS&&(H.push("morphTargetInfluences"),H.push("morphTargetCount")),n.BAKED_VERTEX_ANIMATION_TEXTURE&&(H.push("bakedVertexAnimationSettings"),H.push("bakedVertexAnimationTextureSizeInverted"),H.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}},11430:(P,e,n)=>{n.d(e,{d:()=>p});var H=n(11133),S=n(11438);class p extends S.c{constructor(P,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(P,e,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new H.Matrix,this._storeEffectOnSubMeshes=n}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(P,e){return!!P&&(!this._storeEffectOnSubMeshes||(!P.ye||0===P.ye.length||this.isReadyForSubMesh(P,P.ye[0],e)))}_isReadyForSubMesh(P){const e=P.materialDefines;return!(this.checkReadyOnEveryCall||!P.effect||!e||e._renderId!==this.BP().getRenderId())}bindOnlyWorldMatrix(P){this._activeEffect.setMatrix("world",P)}bindOnlyNormalMatrix(P){this._activeEffect.setMatrix("normalMatrix",P)}bind(P,e){e&&this.bindForSubMesh(P,e,e.ye[0])}_afterBind(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;super._afterBind(P,e,n),this.BP()._cachedEffect=e,n?n._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n._drawWrapper._forceRebindOnNextCall||P.isCachedMaterialInvalid(this,e,H)}dispose(P,e,n){this._activeEffect=void 0,super.dispose(P,e,n)}}},11471:(P,e,n)=>{n.d(e,{d:()=>m,h:()=>t});var H=n(11121),S=n(11133),p=n(11125);class k{static extractMinAndMaxIndexed(P,e,n,H,S,p){for(let k=n;k<n+H;k++){const n=3*e[k],H=P[n],m=P[n+1],t=P[n+2];S.minimizeInPlaceFromFloats(H,m,t),p.maximizeInPlaceFromFloats(H,m,t)}}static extractMinAndMax(P,e,n,H,S,p){for(let k=e,m=e*H;k<e+n;k++,m+=H){const e=P[m],n=P[m+1],H=P[m+2];S.minimizeInPlaceFromFloats(e,n,H),p.maximizeInPlaceFromFloats(e,n,H)}}}function m(P,e,n,H){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const m=new S.Ie(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new S.Ie(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return k.extractMinAndMaxIndexed(P,e,n,H,m,t),p&&(m.x-=m.x*p.x+p.y,m.y-=m.y*p.x+p.y,m.z-=m.z*p.x+p.y,t.x+=t.x*p.x+p.y,t.y+=t.y*p.x+p.y,t.z+=t.z*p.x+p.y),{minimum:m,maximum:t}}function t(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;const m=new S.Ie(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new S.Ie(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p||(p=3),k.extractMinAndMax(P,e,n,p,m,t),H&&(m.x-=m.x*H.x+H.y,m.y-=m.y*H.x+H.y,m.z-=m.z*H.x+H.y,t.x+=t.x*H.x+H.y,t.y+=t.y*H.x+H.y,t.z+=t.z*H.x+H.y),{minimum:m,maximum:t}}(0,H.b)([p.e.filter((function(){for(var P=arguments.length,e=new Array(P),n=0;n<P;n++)e[n]=arguments[n];let[H,S]=e;return!Array.isArray(H)&&!Array.isArray(S)}))],k,"extractMinAndMaxIndexed",null),(0,H.b)([p.e.filter((function(){for(var P=arguments.length,e=new Array(P),n=0;n<P;n++)e[n]=arguments[n];let[H]=e;return!Array.isArray(H)}))],k,"extractMinAndMax",null)},11443:(P,e,n)=>{n.d(e,{e:()=>t});var H=n(11213),S=n(11451),p=n(11457),k=n(11471),m=n(11263);class t{get materialDefines(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(P=this._getDrawWrapper())||void 0===P?void 0:P.defines}set materialDefines(P){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=P}_getDrawWrapper(P){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P=P??this._engine.currentRenderPassId;let n=this._drawWrappers[P];return!n&&e&&(this._drawWrappers[P]=n=new m.d(this._mesh.BP().getEngine())),n}_removeDrawWrapper(P){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(n=this._drawWrappers[P])||void 0===n||n.dispose(e));this._drawWrappers[P]=void 0}get effect(){var P;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(P=this._getDrawWrapper())||void 0===P?void 0:P.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(P){this._mainDrawWrapperOverride=P}setEffect(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=this._drawWrapper;S.setEffect(P,e,H),void 0!==n&&(S.materialContext=n),P||(S.defines=null,S.materialContext=void 0)}resetDrawCache(P){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==P)return void this._removeDrawWrapper(P,!0,e);for(const P of this._drawWrappers)null===P||void 0===P||P.dispose(e)}this._drawWrappers=[]}static AddToMesh(P,e,n,H,S,p,k){return new t(P,e,n,H,S,p,k,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(P,e,n,H,S,p,k){let m=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],t=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=P,this.verticesStart=e,this.verticesCount=n,this.indexStart=H,this.indexCount=S,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=p,this._renderingMesh=k||p,t&&p.ye.push(this),this._engine=this._mesh.BP().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=p.ye.length-1,m&&(this.refreshBoundingInfo(),p.De(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(P){return this._boundingInfo=P,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const P=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return P||this._renderingMesh}yP(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!e)return P&&this._mesh.BP()._hasDefaultMaterial?this._mesh.BP().defaultMaterial:null;if(this._isMultiMaterial(e)){const P=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==P&&(this._currentMaterial=P,this.resetDrawCache()),P}return e}_isMultiMaterial(P){return void 0!==P.getSubMaterial}refreshBoundingInfo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.en)return this;if(P||(P=this._renderingMesh.getVerticesData(H.g.PositionKind)),!P)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const e=this._renderingMesh.ln();let n;if(0===this.indexStart&&this.indexCount===e.length){const P=this._renderingMesh.getBoundingInfo();n={minimum:P.minimum.clone(),maximum:P.maximum.clone()}}else n=(0,k.d)(P,e,this.indexStart,this.indexCount,this._renderingMesh.en.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new p.c(n.minimum,n.maximum),this}_checkCollision(P){return this.getBoundingInfo()._checkCollision(P)}updateBoundingInfo(P){let e=this.getBoundingInfo();return e||(this.refreshBoundingInfo(),e=this.getBoundingInfo()),e&&e.update(P),this}isInFrustum(P){const e=this.getBoundingInfo();return!!e&&e.isInFrustum(P,this._mesh.Cq)}isCompletelyInFrustum(P){const e=this.getBoundingInfo();return!!e&&e.isCompletelyInFrustum(P)}render(P){return this._renderingMesh.render(this,P,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(P,e){if(!this._linesIndexBuffer){const n=6*Math.floor(this.indexCount/3),H=this.verticesStart+this.verticesCount>65535?new Uint32Array(n):new Uint16Array(n);let S=0;if(0===P.length)for(let P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)H[S++]=P,H[S++]=P+1,H[S++]=P+1,H[S++]=P+2,H[S++]=P+2,H[S++]=P;else for(let e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)H[S++]=P[e],H[S++]=P[e+1],H[S++]=P[e+1],H[S++]=P[e+2],H[S++]=P[e+2],H[S++]=P[e];this._linesIndexBuffer=e.createIndexBuffer(H),this._linesIndexCount=H.length}return this._linesIndexBuffer}canIntersects(P){const e=this.getBoundingInfo();return!!e&&P.intersectsBox(e.boundingBox)}intersects(P,e,n,H,S){const p=this.yP();if(!p)return null;let k=3,m=!1;switch(p.fillMode){case 3:case 5:case 6:case 8:return null;case 7:k=1,m=!0}return 4===p.fillMode?n.length?this._intersectLines(P,e,n,this._mesh.intersectionThreshold,H):this._intersectUnIndexedLines(P,e,n,this._mesh.intersectionThreshold,H):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(P,e,n,H,S):this._intersectTriangles(P,e,n,k,m,H,S)}_intersectLines(P,e,n,H,p){let k=null;for(let m=this.indexStart;m<this.indexStart+this.indexCount;m+=2){const t=e[n[m]],C=e[n[m+1]],R=P.intersectionSegment(t,C,H);if(!(R<0)&&((p||!k||R<k.distance)&&(k=new S.e(null,null,R),k.faceId=m/2,p)))break}return k}_intersectUnIndexedLines(P,e,n,H,p){let k=null;for(let m=this.verticesStart;m<this.verticesStart+this.verticesCount;m+=2){const n=e[m],t=e[m+1],C=P.intersectionSegment(n,t,H);if(!(C<0)&&((p||!k||C<k.distance)&&(k=new S.e(null,null,C),k.faceId=m/2,p)))break}return k}_intersectTriangles(P,e,n,H,S,p,k){let m=null,t=-1;for(let C=this.indexStart;C<this.indexStart+this.indexCount-(3-H);C+=H){t++;const H=n[C],R=n[C+1],q=n[C+2];if(S&&4294967295===q){C+=2;continue}const A=e[H],F=e[R],Y=e[q];if(!A||!F||!Y)continue;if(k&&!k(A,F,Y,P,H,R,q))continue;const j=P.intersectsTriangle(A,F,Y);if(j){if(j.distance<0)continue;if((p||!m||j.distance<m.distance)&&(m=j,m.faceId=t,p))break}}return m}_intersectUnIndexedTriangles(P,e,n,H,S){let p=null;for(let k=this.verticesStart;k<this.verticesStart+this.verticesCount;k+=3){const n=e[k],m=e[k+1],t=e[k+2];if(S&&!S(n,m,t,P,-1,-1,-1))continue;const C=P.intersectsTriangle(n,m,t);if(C){if(C.distance<0)continue;if((H||!p||C.distance<p.distance)&&(p=C,p.faceId=k/3,H))break}}return p}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(P,e){const n=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,P,e,!1);if(!this.IsGlobal){const P=this.getBoundingInfo();if(!P)return n;n._boundingInfo=new p.c(P.minimum,P.maximum)}return n}dispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.BP().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const e=this._mesh.ye.indexOf(this);this._mesh.ye.splice(e,1),this.resetDrawCache(void 0,P)}getClassName(){return"SubMesh"}static CreateFromIndices(P,e,n,H,S){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],k=Number.MAX_VALUE,m=-Number.MAX_VALUE;const C=(S||H).ln();for(let t=e;t<e+n;t++){const P=C[t];P<k&&(k=P),P>m&&(m=P)}return new t(P,k,m-k+1,e,n,H,S,p)}}}}]);