"use strict";(self["686i8587bmi"]=self["686i8587bmi"]||[]).push([[24],{13098:(h,d,T)=>{T.d(d,{b:()=>Y});class Y{constructor(h,d,T){this.bu=h,this.bv=d,this.distance=T,this.faceId=0,this.subMeshId=0}}},13110:(h,d,T)=>{T.d(d,{c:()=>n});var Y=T(12779),y=T(12765),C=T(12772);class n{constructor(h,d,T){this.vectors=(0,Y.e)(8,y.pd.Zero),this.center=y.pd.Zero(),this.centerWorld=y.pd.Zero(),this.extendSize=y.pd.Zero(),this.extendSizeWorld=y.pd.Zero(),this.directions=(0,Y.e)(3,y.pd.Zero),this.vectorsWorld=(0,Y.e)(8,y.pd.Zero),this.minimumWorld=y.pd.Zero(),this.maximumWorld=y.pd.Zero(),this.minimum=y.pd.Zero(),this.maximum=y.pd.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(h,d,T)}reConstruct(h,d,T){const Y=h.x,C=h.y,n=h.z,X=d.x,F=d.y,U=d.z,Z=this.vectors;this.minimum.ny(Y,C,n),this.maximum.ny(X,F,U),Z[0].ny(Y,C,n),Z[1].ny(X,F,U),Z[2].ny(X,C,n),Z[3].ny(Y,F,n),Z[4].ny(Y,C,U),Z[5].ny(X,F,n),Z[6].ny(Y,F,U),Z[7].ny(X,C,U),d.addToRef(h,this.center).scaleInPlace(.5),d.subtractToRef(h,this.extendSize).scaleInPlace(.5),this._worldMatrix=T||y.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(h){const d=n._TmpVector3,T=this.maximum.subtractToRef(this.minimum,d[0]),Y=T.length();T.normalizeFromLength(Y);const y=Y*h,C=T.scaleInPlace(.5*y),X=this.center.subtractToRef(C,d[1]),F=this.center.addToRef(C,d[2]);return this.reConstruct(X,F,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){const d=this.minimumWorld,T=this.maximumWorld,Y=this.directions,C=this.vectorsWorld,n=this.vectors;if(h.isIdentity()){d.C(this.minimum),T.C(this.maximum);for(let h=0;h<8;++h)C[h].C(n[h]);this.extendSizeWorld.C(this.extendSize),this.centerWorld.C(this.center)}else{d.XC(Number.MAX_VALUE),T.XC(-Number.MAX_VALUE);for(let Y=0;Y<8;++Y){const X=C[Y];y.pd.TransformCoordinatesToRef(n[Y],h,X),d.minimizeInPlace(X),T.maximizeInPlace(X)}T.subtractToRef(d,this.extendSizeWorld).scaleInPlace(.5),T.addToRef(d,this.centerWorld).scaleInPlace(.5)}y.pd.FromArrayToRef(h.m,0,Y[0]),y.pd.FromArrayToRef(h.m,4,Y[1]),y.pd.FromArrayToRef(h.m,8,Y[2]),this._worldMatrix=h}isInFrustum(h){return n.IsInFrustum(this.vectorsWorld,h)}isCompletelyInFrustum(h){return n.IsCompletelyInFrustum(this.vectorsWorld,h)}intersectsPoint(h){const d=this.minimumWorld,T=this.maximumWorld,Y=d.x,y=d.y,n=d.z,X=T.x,F=T.y,U=T.z,Z=h.x,S=h.y,r=h.z,c=-C.d;return!(X-Z<c||c>Z-Y)&&(!(F-S<c||c>S-y)&&!(U-r<c||c>r-n))}intersectsSphere(h){return n.IntersectsSphere(this.minimumWorld,this.maximumWorld,h.centerWorld,h.radiusWorld)}intersectsMinMax(h,d){const T=this.minimumWorld,Y=this.maximumWorld,y=T.x,C=T.y,n=T.z,X=Y.x,F=Y.y,U=Y.z,Z=h.x,S=h.y,r=h.z,c=d.x,O=d.y,f=d.z;return!(X<Z||y>c)&&(!(F<S||C>O)&&!(U<r||n>f))}dispose(){var h,d;null===(h=this._drawWrapperFront)||void 0===h||h.dispose(),null===(d=this._drawWrapperBack)||void 0===d||d.dispose()}static Intersects(h,d){return h.intersectsMinMax(d.minimumWorld,d.maximumWorld)}static IntersectsSphere(h,d,T,Y){const C=n._TmpVector3[0];y.pd.ClampToRef(T,h,d,C);return y.pd.DistanceSquared(T,C)<=Y*Y}static IsCompletelyInFrustum(h,d){for(let T=0;T<6;++T){const Y=d[T];for(let d=0;d<8;++d)if(Y.dotCoordinate(h[d])<0)return!1}return!0}static IsInFrustum(h,d){for(let T=0;T<6;++T){let Y=!0;const y=d[T];for(let d=0;d<8;++d)if(y.dotCoordinate(h[d])>=0){Y=!1;break}if(Y)return!1}return!0}}n._TmpVector3=(0,Y.e)(3,y.pd.Zero)},13107:(h,d,T)=>{T.d(d,{c:()=>S});var Y=T(12779),y=T(12765),C=T(13110),n=T(13113);const X={min:0,max:0},F={min:0,max:0},U=(h,d,T)=>{const Y=y.pd.Dot(d.centerWorld,h),C=Math.abs(y.pd.Dot(d.directions[0],h))*d.extendSize.x+Math.abs(y.pd.Dot(d.directions[1],h))*d.extendSize.y+Math.abs(y.pd.Dot(d.directions[2],h))*d.extendSize.z;T.min=Y-C,T.max=Y+C},Z=(h,d,T)=>(U(h,d,X),U(h,T,F),!(X.min>F.max||F.min>X.max));class S{constructor(h,d,T){this._isLocked=!1,this.boundingBox=new C.c(h,d,T),this.boundingSphere=new n.c(h,d,T)}reConstruct(h,d,T){this.boundingBox.reConstruct(h,d,T),this.boundingSphere.reConstruct(h,d,T)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(h){this._isLocked=h}update(h){this._isLocked||(this.boundingBox._update(h),this.boundingSphere._update(h))}centerOn(h,d){const T=S._TmpVector3[0].C(h).rS(d),Y=S._TmpVector3[1].C(h).addInPlace(d);return this.boundingBox.reConstruct(T,Y,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(T,Y,this.boundingBox.getWorldMatrix()),this}encapsulate(h){const d=y.pd.Minimize(this.minimum,h),T=y.pd.Maximize(this.maximum,h);return this.reConstruct(d,T,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(h){const d=y.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(d);const T=y.TmpVectors.pd[0];return y.pd.TransformCoordinatesToRef(h.boundingBox.minimumWorld,d,T),this.encapsulate(T),y.pd.TransformCoordinatesToRef(h.boundingBox.maximumWorld,d,T),this.encapsulate(T),this}scale(h){return this.boundingBox.scale(h),this.boundingSphere.scale(h),this}isInFrustum(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===d||3===d)&&this.boundingSphere.isCenterInFrustum(h))return!0;if(!this.boundingSphere.isInFrustum(h))return!1;return!(1!==d&&3!==d)||this.boundingBox.isInFrustum(h)}get diagonalLength(){const h=this.boundingBox;return h.maximumWorld.subtractToRef(h.minimumWorld,S._TmpVector3[0]).length()}isCompletelyInFrustum(h){return this.boundingBox.isCompletelyInFrustum(h)}_checkCollision(h){return h._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(h){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(h)&&!!this.boundingBox.intersectsPoint(h))}intersects(h,d){if(!n.c.Intersects(this.boundingSphere,h.boundingSphere))return!1;if(!C.c.Intersects(this.boundingBox,h.boundingBox))return!1;if(!d)return!0;const T=this.boundingBox,Y=h.boundingBox;return!!Z(T.directions[0],T,Y)&&(!!Z(T.directions[1],T,Y)&&(!!Z(T.directions[2],T,Y)&&(!!Z(Y.directions[0],T,Y)&&(!!Z(Y.directions[1],T,Y)&&(!!Z(Y.directions[2],T,Y)&&(!!Z(y.pd.Cross(T.directions[0],Y.directions[0]),T,Y)&&(!!Z(y.pd.Cross(T.directions[0],Y.directions[1]),T,Y)&&(!!Z(y.pd.Cross(T.directions[0],Y.directions[2]),T,Y)&&(!!Z(y.pd.Cross(T.directions[1],Y.directions[0]),T,Y)&&(!!Z(y.pd.Cross(T.directions[1],Y.directions[1]),T,Y)&&(!!Z(y.pd.Cross(T.directions[1],Y.directions[2]),T,Y)&&(!!Z(y.pd.Cross(T.directions[2],Y.directions[0]),T,Y)&&(!!Z(y.pd.Cross(T.directions[2],Y.directions[1]),T,Y)&&!!Z(y.pd.Cross(T.directions[2],Y.directions[2]),T,Y))))))))))))))}}S._TmpVector3=(0,Y.e)(2,y.pd.Zero)},13113:(h,d,T)=>{T.d(d,{c:()=>C});var Y=T(12779),y=T(12765);class C{constructor(h,d,T){this.center=y.pd.Zero(),this.centerWorld=y.pd.Zero(),this.minimum=y.pd.Zero(),this.maximum=y.pd.Zero(),this.reConstruct(h,d,T)}reConstruct(h,d,T){this.minimum.C(h),this.maximum.C(d);const Y=y.pd.Distance(h,d);d.addToRef(h,this.center).scaleInPlace(.5),this.radius=.5*Y,this._update(T||y.Matrix.IdentityReadOnly)}scale(h){const d=this.radius*h,T=C._TmpVector3,Y=T[0].XC(d),y=this.center.subtractToRef(Y,T[1]),n=this.center.addToRef(Y,T[2]);return this.reConstruct(y,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){if(h.isIdentity())this.centerWorld.C(this.center),this.radiusWorld=this.radius;else{y.pd.TransformCoordinatesToRef(this.center,h,this.centerWorld);const d=C._TmpVector3[0];y.pd.TransformNormalFromFloatsToRef(1,1,1,h,d),this.radiusWorld=Math.max(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z))*this.radius}}isInFrustum(h){const d=this.centerWorld,T=this.radiusWorld;for(let Y=0;Y<6;Y++)if(h[Y].dotCoordinate(d)<=-T)return!1;return!0}isCenterInFrustum(h){const d=this.centerWorld;for(let T=0;T<6;T++)if(h[T].dotCoordinate(d)<0)return!1;return!0}intersectsPoint(h){const d=y.pd.DistanceSquared(this.centerWorld,h);return!(this.radiusWorld*this.radiusWorld<d)}static Intersects(h,d){const T=y.pd.DistanceSquared(h.centerWorld,d.centerWorld),Y=h.radiusWorld+d.radiusWorld;return!(Y*Y<T)}static CreateFromCenterAndRadius(h,d,T){this._TmpVector3[0].C(h),this._TmpVector3[1].ny(0,0,d),this._TmpVector3[2].C(h),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].rS(this._TmpVector3[1]);const Y=new C(this._TmpVector3[0],this._TmpVector3[2]);return Y._worldMatrix=T||y.Matrix.Identity(),Y}}C._TmpVector3=(0,Y.e)(3,y.pd.Zero)},13132:(h,d,T)=>{function Y(h){-1===h.indexOf("vClipPlane")&&h.push("vClipPlane"),-1===h.indexOf("vClipPlane2")&&h.push("vClipPlane2"),-1===h.indexOf("vClipPlane3")&&h.push("vClipPlane3"),-1===h.indexOf("vClipPlane4")&&h.push("vClipPlane4"),-1===h.indexOf("vClipPlane5")&&h.push("vClipPlane5"),-1===h.indexOf("vClipPlane6")&&h.push("vClipPlane6")}function y(h,d,T){const Y=!!(h.clipPlane??d.clipPlane),y=!!(h.clipPlane2??d.clipPlane2),C=!!(h.clipPlane3??d.clipPlane3),n=!!(h.clipPlane4??d.clipPlane4),X=!!(h.clipPlane5??d.clipPlane5),F=!!(h.clipPlane6??d.clipPlane6);Y&&T.push("#define CLIPPLANE"),y&&T.push("#define CLIPPLANE2"),C&&T.push("#define CLIPPLANE3"),n&&T.push("#define CLIPPLANE4"),X&&T.push("#define CLIPPLANE5"),F&&T.push("#define CLIPPLANE6")}function C(h,d,T){let Y=!1;const y=!!(h.clipPlane??d.clipPlane),C=!!(h.clipPlane2??d.clipPlane2),n=!!(h.clipPlane3??d.clipPlane3),X=!!(h.clipPlane4??d.clipPlane4),F=!!(h.clipPlane5??d.clipPlane5),U=!!(h.clipPlane6??d.clipPlane6);return T.CLIPPLANE!==y&&(T.CLIPPLANE=y,Y=!0),T.CLIPPLANE2!==C&&(T.CLIPPLANE2=C,Y=!0),T.CLIPPLANE3!==n&&(T.CLIPPLANE3=n,Y=!0),T.CLIPPLANE4!==X&&(T.CLIPPLANE4=X,Y=!0),T.CLIPPLANE5!==F&&(T.CLIPPLANE5=F,Y=!0),T.CLIPPLANE6!==U&&(T.CLIPPLANE6=U,Y=!0),Y}function n(h,d,T){let Y=d.clipPlane??T.clipPlane;X(h,"vClipPlane",Y),Y=d.clipPlane2??T.clipPlane2,X(h,"vClipPlane2",Y),Y=d.clipPlane3??T.clipPlane3,X(h,"vClipPlane3",Y),Y=d.clipPlane4??T.clipPlane4,X(h,"vClipPlane4",Y),Y=d.clipPlane5??T.clipPlane5,X(h,"vClipPlane5",Y),Y=d.clipPlane6??T.clipPlane6,X(h,"vClipPlane6",Y)}function X(h,d,T){T&&h.setFloat4(d,T.normal.x,T.normal.y,T.normal.z,T.d)}T.d(d,{d:()=>Y,e:()=>n,g:()=>C,h:()=>y})},13081:(h,d,T)=>{T.d(d,{b:()=>Y});class Y{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(h,d){this._defines[h]||(h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h),this._defines[h]=new Array),this._defines[h].push(d)}addCPUSkinningFallback(h,d){this._mesh=d,h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(h,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,h=h.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;const T=this._mesh.Eh();for(let h=0;h<T.meshes.length;h++){const Y=T.meshes[h];if(Y.material){if(Y.computeBonesUsingShaders&&0!==Y.numBoneInfluencers)if(Y.material.getEffect()===d)Y.computeBonesUsingShaders=!1;else if(Y.ld)for(const h of Y.ld){if(h.effect===d){Y.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&Y.computeBonesUsingShaders&&Y.numBoneInfluencers>0&&(Y.computeBonesUsingShaders=!1)}}else{const d=this._defines[this._currentRank];if(d)for(let T=0;T<d.length;T++)h=h.replace("#define "+d[T],"");this._currentRank++}return h}}},13089:(h,d,T)=>{T.d(d,{d:()=>J});var Y=T(12750),y=T(12757),C=T(12574),n=T(12583),X=T(12625),F=T(13095),U=T(13019),Z=T(12596),S=T(12814),r=T(12875),c=T(12801);class O{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(h){this._func=h}get funcRef(){return this._funcRef}set funcRef(h){this._funcRef=h}get funcMask(){return this._funcMask}set funcMask(h){this._funcMask=h}get opStencilFail(){return this._opStencilFail}set opStencilFail(h){this._opStencilFail=h}get opDepthFail(){return this._opDepthFail}set opDepthFail(h){this._opDepthFail=h}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(h){this._opStencilDepthPass=h}get mask(){return this._mask}set mask(h){this._mask=h}get enabled(){return this._enabled}set enabled(h){this._enabled=h}getClassName(){return"MaterialStencilState"}copyTo(h){c.e.Clone((()=>h),this)}serialize(){return c.e.Serialize(this)}parse(h,d,T){c.e.Parse((()=>this),h,d,T)}}(0,Y.c)([(0,y.E)()],O.prototype,"func",null),(0,Y.c)([(0,y.E)()],O.prototype,"funcRef",null),(0,Y.c)([(0,y.E)()],O.prototype,"funcMask",null),(0,Y.c)([(0,y.E)()],O.prototype,"opStencilFail",null),(0,Y.c)([(0,y.E)()],O.prototype,"opDepthFail",null),(0,Y.c)([(0,y.E)()],O.prototype,"opStencilDepthPass",null),(0,Y.c)([(0,y.E)()],O.prototype,"mask",null),(0,Y.c)([(0,y.E)()],O.prototype,"enabled",null);var f=T(13124);class J{get _supportGlowLayer(){return!1}set _glowModeEnabled(h){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(h){if(this._alpha===h)return;const d=this._alpha;this._alpha=h,1!==d&&1!==h||this.YZ(J.MiscDirtyFlag+J.PrePassDirtyFlag)}get alpha(){return this._alpha}set td(h){this._backFaceCulling!==h&&(this._backFaceCulling=h,this.YZ(J.TextureDirtyFlag))}get td(){return this._backFaceCulling}set cullBackFaces(h){this._cullBackFaces!==h&&(this._cullBackFaces=h,this.YZ(J.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(h){this._blockDirtyMechanism!==h&&(this._blockDirtyMechanism=h,h||this.tS())}atomicMaterialsUpdate(h){this.blockDirtyMechanism=!0;try{h(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(h){this._onDisposeObserver&&this.zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.zd.add(h)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new n.e),this._onBindObservable}set onBind(h){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(h)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new n.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new n.e),this._onEffectCreatedObservable}set alphaMode(h){this._alphaMode!==h&&(this._alphaMode=h,this.YZ(J.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(h){this._needDepthPrePass!==h&&(this._needDepthPrePass=h,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(h){this._fogEnabled!==h&&(this._fogEnabled=h,this.YZ(J.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case J.WireFrameFillMode:case J.LineListDrawMode:case J.LineLoopDrawMode:case J.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(h){this.fillMode=h?J.WireFrameFillMode:J.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case J.PointFillMode:case J.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(h){this.fillMode=h?J.PointFillMode:J.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(h){this._fillMode!==h&&(this._fillMode=h,this.YZ(J.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){const d=this.Eh().getEngine().getCaps().fragmentDepthSupported;h&&!d&&Z.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=h&&d,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(h){this._drawWrapper=h}constructor(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.zd=new n.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.xd=new O,this._useUBO=!1,this._fillMode=J.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=h;const y=d||X.d.LastCreatedScene;y&&(this._scene=y,this._dirtyCallbacks={},this._forceGLSL=Y,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=h||C.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new r.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new U.d(this._scene.getEngine(),void 0,void 0,h),this._useUBO=this.Eh().getEngine().supportsUniformBuffers,this._createUniformBuffer(),T||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),J.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var h;const d=this.Eh().getEngine();null===(h=this._uniformBuffer)||void 0===h||h.dispose(),d.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new U.d(d,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new U.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(h){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.tS(),this.checkReadyOnlyOnce=!0}unfreeze(){this.tS(),this.checkReadyOnlyOnce=!1}isReady(h,d){return!0}isReadyForSubMesh(h,d,T){const Y=d.materialDefines;return!!Y&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Y,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Eh(){return this._scene}_getEffectiveOrientation(h){return null!==this.sideOrientation?this.sideOrientation:h.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(h){this._transparencyMode!==h&&(this._transparencyMode=h,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===J.MATERIAL_ALPHABLEND||this._transparencyMode===J.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===J.MATERIAL_ALPHATEST||this._transparencyMode===J.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===J.MATERIAL_OPAQUE||this._transparencyMode===J.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsBlend:h.visibility<1||!this._disableAlphaBlending&&(h.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(h)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}tS(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this.Eh().meshes;for(const T of d)if(T.ld)for(const d of T.ld)if(d.jh()===this)for(const T of d._drawWrappers)T&&this._materialContext===T.materialContext&&(T._wasPreviouslyReady=!1,T._wasPreviouslyUsingInstances=null,T._forceRebindOnNextCall=h);h&&this.YZ(J.AllDirtyFlag)}_preBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this._scene.getEngine(),Y=(null==d?this.sideOrientation:d)===J.ClockWiseSideOrientation;return T.enableEffect(h||this._getDrawWrapper()),T.setState(this.td,this.zOffset,!1,Y,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.xd,this.zOffsetUnits),Y}bind(h,d){}buildUniformLayout(){const h=this._uniformBuffer;this._eventInfo.ubo=h,this._callbackPluginEventGeneric(8,this._eventInfo),h.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(h,d,T){const Y=T._drawWrapper;this._eventInfo.subMesh=T,this._callbackPluginEventBindForSubMesh(this._eventInfo),Y._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(h){}bindView(h){this._useUBO?this._needToBindSceneUbo=!0:h.setMatrix("view",this.Eh().getViewMatrix())}bindViewProjection(h){this._useUBO?this._needToBindSceneUbo=!0:(h.setMatrix("viewProjection",this.Eh().getTransformMatrix()),h.setMatrix("projection",this.Eh().getProjectionMatrix()))}bindEyePosition(h,d){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(h,d)}_afterBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&d&&(this._needToBindSceneUbo=!1,(0,f.l)(d,this.Eh().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=h?h.visibility:1,this._onBindObservable&&h&&this._onBindObservable.notifyObservers(h),this.disableDepthWrite){const h=this._scene.getEngine();this._cachedDepthWriteState=h.getDepthWrite(),h.setDepthWrite(!1)}if(this.disableColorWrite){const h=this._scene.getEngine();this._cachedColorWriteState=h.getColorWrite(),h.setColorWrite(!1)}if(0!==this.depthFunction){const h=this._scene.getEngine();this._cachedDepthFunctionState=h.getDepthFunction()||0,h.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(h){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=h,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(h){return null}_clonePlugins(h,d){const T={};if(this._serializePlugins(T),J._ParsePlugins(T,h,this._scene,d),this.pluginManager)for(const Y of this.pluginManager._plugins){const d=h.pluginManager.getPlugin(Y.name);d&&Y.copyTo(d)}}getBindedMeshes(){if(this.meshMap){const h=[];for(const d in this.meshMap){const T=this.meshMap[d];T&&h.push(T)}return h}return this._scene.meshes.filter((h=>h.material===this))}forceCompilation(h,d,T,Y){const y={clipPlane:!1,useInstances:!1,...T},C=this.Eh(),n=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const X=()=>{if(!this._scene||!this._scene.getEngine())return;const T=C.clipPlane;if(y.clipPlane&&(C.clipPlane=new S.d(0,0,0,1)),this._storeEffectOnSubMeshes){let T=!0,C=null;if(h.ld){const d=new F.d(0,0,0,0,0,h,void 0,!1,!1);d.materialDefines&&(d.materialDefines._renderId=-1),this.isReadyForSubMesh(h,d,y.useInstances)||(d.effect&&d.effect.getCompilationError()&&d.effect.allFallbacksProcessed()?C=d.effect.getCompilationError():(T=!1,setTimeout(X,16)))}T&&(this.allowShaderHotSwapping=n,C&&Y&&Y(C),d&&d(this))}else this.isReady()?(this.allowShaderHotSwapping=n,d&&d(this)):setTimeout(X,16);y.clipPlane&&(C.clipPlane=T)};X()}async forceCompilationAsync(h,d){return await new Promise(((T,Y)=>{this.forceCompilation(h,(()=>{T()}),d,(h=>{Y(h)}))}))}YZ(h){this.Eh().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(J._DirtyCallbackArray.length=0,h&J.ImageProcessingDirtyFlag&&J._DirtyCallbackArray.push(J._ImageProcessingDirtyCallBack),h&J.TextureDirtyFlag&&J._DirtyCallbackArray.push(J._TextureDirtyCallBack),h&J.LightDirtyFlag&&J._DirtyCallbackArray.push(J._LightsDirtyCallBack),h&J.FresnelDirtyFlag&&J._DirtyCallbackArray.push(J._FresnelDirtyCallBack),h&J.AttributesDirtyFlag&&J._DirtyCallbackArray.push(J._AttributeDirtyCallBack),h&J.MiscDirtyFlag&&J._DirtyCallbackArray.push(J._MiscDirtyCallBack),h&J.PrePassDirtyFlag&&J._DirtyCallbackArray.push(J._PrePassDirtyCallBack),J._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(J._RunDirtyCallBacks),this.Eh().resetCachedMaterial())}resetDrawCache(){const h=this.Eh().meshes;for(const d of h)if(d.ld)for(const h of d.ld)h.jh()===this&&h.resetDrawCache()}_markAllSubMeshesAsDirty(h){const d=this.Eh();if(d.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const T=d.meshes;for(const Y of T)if(Y.ld)for(const T of Y.ld){if((T.jh()||(d._hasDefaultMaterial?d.defaultMaterial:null))===this)for(const d of T._drawWrappers)d&&d.defines&&d.defines.markAllAsDirty&&this._materialContext===d.materialContext&&h(d.defines)}}_markScenePrePassDirty(){if(this.Eh().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const h=this.Eh().enablePrePassRenderer();h&&h.YZ()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(J._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(J._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(J._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(J._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(J._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(J._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(J._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(J._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(J._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(J._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const h=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.zd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(h)}))}}setPrePassRenderer(h){return!1}dispose(h,d,T){const Y=this.Eh();if(Y.stopAnimation(this),Y.freeProcessedMaterials(),Y.removeMaterial(this),this._eventInfo.forceDisposeTextures=d,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const h=this._parentContainer.materials.indexOf(this);h>-1&&this._parentContainer.materials.splice(h,1),this._parentContainer=null}if(!0!==T)if(this.meshMap)for(const y in this.meshMap){const h=this.meshMap[y];this._disposeMeshResources(h)}else{const h=Y.meshes;for(const d of h)this._disposeMeshResources(d)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.zd.notifyObservers(this),this.zd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(h){if(!h)return;const d=h.Rd,T=h._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(h.ld&&T)for(const y of h.ld){const h=y._drawWrappers;for(let C=0;C<h.length;C++){var Y;const n=null===(Y=h[C])||void 0===Y?void 0:Y.effect;if(!n)continue;T[C]===this&&(null===d||void 0===d||d._releaseVertexArrayObject(n),y._removeDrawWrapper(C,!0,!0))}}}else null===d||void 0===d||d._releaseVertexArrayObject(this._drawWrapper.effect);h.material!==this||h.sourceMesh||(h.material=null)}serialize(){const h=c.e.Serialize(this);return h.xd=this.xd.serialize(),h.uniqueId=this.uniqueId,this._serializePlugins(h),h}_serializePlugins(h){if(h.plugins={},this.pluginManager)for(const d of this.pluginManager._plugins)d.doNotSerialize||(h.plugins[d.getClassName()]=d.serialize())}static Parse(h,d,T){if(h.customType){if("BABYLON.PBRMaterial"===h.customType&&h.overloadedAlbedo&&(h.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Z.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else h.customType="BABYLON.StandardMaterial";const Y=C.Tools.Instantiate(h.customType).Parse(h,d,T);return Y._loadedUniqueId=h.uniqueId,Y}static _ParsePlugins(h,d,T,Y){if(h.plugins)for(const X in h.plugins){var y,n;const F=h.plugins[X];let U=null===(y=d.pluginManager)||void 0===y?void 0:y.getPlugin(F.name);if(!U){const h=C.Tools.Instantiate("BABYLON."+X);h&&(U=new h(d))}null===(n=U)||void 0===n||n.parse(F,T,Y)}}}J.TriangleFillMode=0,J.WireFrameFillMode=1,J.PointFillMode=2,J.PointListDrawMode=3,J.LineListDrawMode=4,J.LineLoopDrawMode=5,J.LineStripDrawMode=6,J.TriangleStripDrawMode=7,J.TriangleFanDrawMode=8,J.ClockWiseSideOrientation=0,J.CounterClockWiseSideOrientation=1,J.ImageProcessingDirtyFlag=64,J.TextureDirtyFlag=1,J.LightDirtyFlag=2,J.FresnelDirtyFlag=4,J.AttributesDirtyFlag=8,J.MiscDirtyFlag=16,J.PrePassDirtyFlag=32,J.AllDirtyFlag=127,J.MATERIAL_OPAQUE=0,J.MATERIAL_ALPHATEST=1,J.MATERIAL_ALPHABLEND=2,J.MATERIAL_ALPHATESTANDBLEND=3,J.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,J.MATERIAL_NORMALBLENDMETHOD_RNM=1,J.OnEventObservable=new n.e,J._AllDirtyCallBack=h=>h.markAllAsDirty(),J._ImageProcessingDirtyCallBack=h=>h.markAsImageProcessingDirty(),J._TextureDirtyCallBack=h=>h.markAsTexturesDirty(),J._FresnelDirtyCallBack=h=>h.markAsFresnelDirty(),J._MiscDirtyCallBack=h=>h.markAsMiscDirty(),J._PrePassDirtyCallBack=h=>h.markAsPrePassDirty(),J._LightsDirtyCallBack=h=>h.markAsLightDirty(),J._AttributeDirtyCallBack=h=>h.markAsAttributesDirty(),J._FresnelAndMiscDirtyCallBack=h=>{J._FresnelDirtyCallBack(h),J._MiscDirtyCallBack(h)},J._TextureAndMiscDirtyCallBack=h=>{J._TextureDirtyCallBack(h),J._MiscDirtyCallBack(h)},J._DirtyCallbackArray=[],J._RunDirtyCallBacks=h=>{for(const d of J._DirtyCallbackArray)d(h)},(0,Y.c)([(0,y.E)()],J.prototype,"id",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"uniqueId",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"name",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"metadata",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"checkReadyOnEveryCall",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"checkReadyOnlyOnce",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"state",void 0),(0,Y.c)([(0,y.E)("alpha")],J.prototype,"_alpha",void 0),(0,Y.c)([(0,y.E)("td")],J.prototype,"_backFaceCulling",void 0),(0,Y.c)([(0,y.E)("cullBackFaces")],J.prototype,"_cullBackFaces",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"sideOrientation",void 0),(0,Y.c)([(0,y.E)("alphaMode")],J.prototype,"_alphaMode",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"_needDepthPrePass",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"disableDepthWrite",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"disableColorWrite",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"forceDepthWrite",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"depthFunction",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"separateCullingPass",void 0),(0,Y.c)([(0,y.E)("fogEnabled")],J.prototype,"_fogEnabled",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"pointSize",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"zOffset",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"zOffsetUnits",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"pointsCloud",null),(0,Y.c)([(0,y.E)()],J.prototype,"fillMode",null),(0,Y.c)([(0,y.E)()],J.prototype,"useLogarithmicDepth",null),(0,Y.c)([(0,y.E)()],J.prototype,"transparencyMode",null)},13124:(h,d,T)=>{T.d(d,{$:()=>l,A:()=>c,E:()=>r,G:()=>k,K:()=>p,L:()=>g,P:()=>W,Q:()=>x,T:()=>o,W:()=>u,Y:()=>N,c:()=>V,db:()=>O,e:()=>S,f:()=>w,i:()=>Z,k:()=>f,l:()=>J,n:()=>L,p:()=>z,s:()=>D,t:()=>s,w:()=>E});var Y=T(12596),y=T(12812),C=T(12625),n=T(13075),X=T(13132);const F=y.ed.Black(),U={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function Z(h,d,T){if(!h||h.LOGARITHMICDEPTH||h.indexOf&&h.indexOf("LOGARITHMICDEPTH")>=0){const h=T.activeCamera;1===h.mode&&Y.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),d.setFloat("logarithmicDepthConstant",2/(Math.log(h.maxZ+1)/Math.LN2))}}function S(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];T&&h.fogEnabled&&(!d||d.applyFog)&&0!==h.fogMode&&(T.setFloat4("vFogInfos",h.fogMode,h.fogStart,h.fogEnd,h.fogDensity),Y?(h.fogColor.toLinearSpaceToRef(F,h.getEngine().useExactSrgbConversions),T.setColor3("vFogColor",F)):T.setColor3("vFogColor",h.fogColor))}function r(h,d,T,Y,y,C,n,X,F,Z){const S=h.numMaxInfluencers||h.numInfluencers;return S<=0?0:(d.push("#define MORPHTARGETS"),h.hasPositions&&d.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),h.hasNormals&&d.push("#define MORPHTARGETTEXTURE_HASNORMALS"),h.hasTangents&&d.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),h.hasUVs&&d.push("#define MORPHTARGETTEXTURE_HASUVS"),h.hasUV2s&&d.push("#define MORPHTARGETTEXTURE_HASUV2S"),h.hasColors&&d.push("#define MORPHTARGETTEXTURE_HASCOLORS"),h.supportsPositions&&y&&d.push("#define MORPHTARGETS_POSITION"),h.supportsNormals&&C&&d.push("#define MORPHTARGETS_NORMAL"),h.supportsTangents&&n&&d.push("#define MORPHTARGETS_TANGENT"),h.supportsUVs&&X&&d.push("#define MORPHTARGETS_UV"),h.supportsUV2s&&F&&d.push("#define MORPHTARGETS_UV2"),h.supportsColors&&Z&&d.push("#define MORPHTARGETS_COLOR"),d.push("#define NUM_MORPH_INFLUENCERS "+S),h.isUsingTextureForTargets&&d.push("#define MORPHTARGETS_TEXTURE"),U.NUM_MORPH_INFLUENCERS=S,U.NORMAL=C,U.TANGENT=n,U.UV=X,U.UV2=F,U.COLOR=Z,c(T,Y,U,y),S)}function c(h,d,T){let y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=T.NUM_MORPH_INFLUENCERS;if(n>0&&C.d.LastCreatedEngine){const X=C.d.LastCreatedEngine.getCaps().maxVertexAttribs,F=d.morphTargetManager;if(null!==F&&void 0!==F&&F.isUsingTextureForTargets)return;const U=F&&F.supportsPositions&&y,Z=F&&F.supportsNormals&&T.NORMAL,S=F&&F.supportsTangents&&T.TANGENT,r=F&&F.supportsUVs&&T.UV1,c=F&&F.supportsUV2s&&T.UV2,O=F&&F.supportsColors&&T.VERTEXCOLOR;for(let T=0;T<n;T++)U&&h.push("position"+T),Z&&h.push("normal"+T),S&&h.push("tangent"+T),r&&h.push("uv_"+T),c&&h.push("uv2_"+T),O&&h.push("color"+T),h.length>X&&Y.c.Error("Cannot add more vertex attributes for mesh "+d.name)}}function O(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"),d&&(h.push("previousWorld0"),h.push("previousWorld1"),h.push("previousWorld2"),h.push("previousWorld3"))}function f(h,d){const T=h.morphTargetManager;h&&T&&d.setFloatArray("morphTargetInfluences",T.influences)}function J(h,d){d.bindToEffect(h,"Scene")}function W(h,d,T){d._needUVs=!0,d[T]=!0,h.optimizeUVAllocation&&h.getTextureMatrix().isIdentityAs3x2()?(d[T+"DIRECTUV"]=h.coordinatesIndex+1,d["MAINUV"+(h.coordinatesIndex+1)]=!0):d[T+"DIRECTUV"]=0}function L(h,d,T){const Y=h.getTextureMatrix();d.bd(T+"Matrix",Y)}function D(h,d,T){T.BAKED_VERTEX_ANIMATION_TEXTURE&&T.INSTANCES&&h.push("bakedVertexAnimationSettingsInstanced")}function V(h,d,T){var Y;if(d&&h&&(h.computeBonesUsingShaders&&d._bonesComputationForcedToCPU&&(h.computeBonesUsingShaders=!1),h.useBones&&h.computeBonesUsingShaders&&h.skeleton)){const y=h.skeleton;if(y.isUsingTextureForMatrices&&d.getUniformIndex("boneTextureWidth")>-1){const T=y.getTransformMatrixTexture(h);d.setTexture("boneSampler",T),d.setFloat("boneTextureWidth",4*(y.bones.length+1))}else{const C=y.getTransformMatrices(h);C&&(d.setMatrices("mBones",C),T&&h.Eh().prePassRenderer&&h.Eh().prePassRenderer.getIndex(2)&&(T.previousBones[h.uniqueId]||(T.previousBones[h.uniqueId]=C.slice()),d.setMatrices("mPreviousBones",T.previousBones[h.uniqueId]),Y=C,T.previousBones[h.uniqueId].set(Y)))}}}function i(h,d,T,Y,y){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];h._bindLight(d,T,Y,y,C)}function w(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const C=Math.min(d.lightSources.length,y);for(let n=0;n<C;n++){i(d.lightSources[n],n,h,T,"boolean"===typeof Y?Y:Y.SPECULARTERM,d.receiveShadows)}}function s(h,d,T,Y){T.NUM_BONE_INFLUENCERS>0&&(Y.addCPUSkinningFallback(0,d),h.push("matricesIndices"),h.push("matricesWeights"),T.NUM_BONE_INFLUENCERS>4&&(h.push("matricesIndicesExtra"),h.push("matricesWeightsExtra")))}function E(h,d){(d.INSTANCES||d.THIN_INSTANCES)&&O(h,!!d.PREPASS_VELOCITY),d.INSTANCESCOLOR&&h.push("instanceColor")}function z(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=0;for(let C=0;C<T&&h["LIGHT"+C];C++)C>0&&(y=Y+C,d.addFallback(y,"LIGHT"+C)),h.SHADOWS||(h["SHADOW"+C]&&d.addFallback(Y,"SHADOW"+C),h["SHADOWPCF"+C]&&d.addFallback(Y,"SHADOWPCF"+C),h["SHADOWPCSS"+C]&&d.addFallback(Y,"SHADOWPCSS"+C),h["SHADOWPOISSON"+C]&&d.addFallback(Y,"SHADOWPOISSON"+C),h["SHADOWESM"+C]&&d.addFallback(Y,"SHADOWESM"+C),h["SHADOWCLOSEESM"+C]&&d.addFallback(Y,"SHADOWCLOSEESM"+C));return y++}function x(h,d,T,Y,y,C,n){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];n._areMiscDirty&&(n.LOGARITHMICDEPTH=T,n.POINTSIZE=Y,n.FOG=y&&function(h,d){return d.fogEnabled&&h.applyFog&&0!==d.fogMode}(h,d),n.NONUNIFORMSCALING=h.nonUniformScaling,n.ALPHATEST=C,n.DECAL_AFTER_DETAIL=X)}function g(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!T._areLightsDirty)return T._needNormals;let n=0;const X={needNormals:T._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(h.lightsEnabled&&!C)for(const U of d.lightSources)if(H(h,d,U,n,T,Y,X),n++,n===y)break;T.SPECULARTERM=X.specularEnabled,T.SHADOWS=X.shadowEnabled;for(let U=n;U<y;U++)void 0!==T["LIGHT"+U]&&(T["LIGHT"+U]=!1,T["HEMILIGHT"+U]=!1,T["POINTLIGHT"+U]=!1,T["DIRLIGHT"+U]=!1,T["SPOTLIGHT"+U]=!1,T["AREALIGHT"+U]=!1,T["SHADOW"+U]=!1,T["SHADOWCSM"+U]=!1,T["SHADOWCSMDEBUG"+U]=!1,T["SHADOWCSMNUM_CASCADES"+U]=!1,T["SHADOWCSMUSESHADOWMAXZ"+U]=!1,T["SHADOWCSMNOBLEND"+U]=!1,T["SHADOWCSM_RIGHTHANDED"+U]=!1,T["SHADOWPCF"+U]=!1,T["SHADOWPCSS"+U]=!1,T["SHADOWPOISSON"+U]=!1,T["SHADOWESM"+U]=!1,T["SHADOWCLOSEESM"+U]=!1,T["SHADOWCUBE"+U]=!1,T["SHADOWLOWQUALITY"+U]=!1,T["SHADOWMEDIUMQUALITY"+U]=!1);const F=h.getEngine().getCaps();return void 0===T.SHADOWFLOAT&&(X.needRebuild=!0),T.SHADOWFLOAT=X.shadowEnabled&&(F.textureFloatRender&&F.textureFloatLinearFiltering||F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering),T.LIGHTMAPEXCLUDED=X.lightmapMode,X.needRebuild&&T.rebuild(),X.needNormals}function H(h,d,T,Y,y,C,X){switch(X.needNormals=!0,void 0===y["LIGHT"+Y]&&(X.needRebuild=!0),y["LIGHT"+Y]=!0,y["SPOTLIGHT"+Y]=!1,y["HEMILIGHT"+Y]=!1,y["POINTLIGHT"+Y]=!1,y["DIRLIGHT"+Y]=!1,y["AREALIGHT"+Y]=!1,T.prepareLightSpecificDefines(y,Y),y["LIGHT_FALLOFF_PHYSICAL"+Y]=!1,y["LIGHT_FALLOFF_GLTF"+Y]=!1,y["LIGHT_FALLOFF_STANDARD"+Y]=!1,T.falloffType){case n.b.FALLOFF_GLTF:y["LIGHT_FALLOFF_GLTF"+Y]=!0;break;case n.b.FALLOFF_PHYSICAL:y["LIGHT_FALLOFF_PHYSICAL"+Y]=!0;break;case n.b.FALLOFF_STANDARD:y["LIGHT_FALLOFF_STANDARD"+Y]=!0}if(C&&!T.EZ.equalsFloats(0,0,0)&&(X.specularEnabled=!0),y["SHADOW"+Y]=!1,y["SHADOWCSM"+Y]=!1,y["SHADOWCSMDEBUG"+Y]=!1,y["SHADOWCSMNUM_CASCADES"+Y]=!1,y["SHADOWCSMUSESHADOWMAXZ"+Y]=!1,y["SHADOWCSMNOBLEND"+Y]=!1,y["SHADOWCSM_RIGHTHANDED"+Y]=!1,y["SHADOWPCF"+Y]=!1,y["SHADOWPCSS"+Y]=!1,y["SHADOWPOISSON"+Y]=!1,y["SHADOWESM"+Y]=!1,y["SHADOWCLOSEESM"+Y]=!1,y["SHADOWCUBE"+Y]=!1,y["SHADOWLOWQUALITY"+Y]=!1,y["SHADOWMEDIUMQUALITY"+Y]=!1,d&&d.receiveShadows&&h.shadowsEnabled&&T.shadowEnabled){const d=T.getShadowGenerator(h.activeCamera)??T.getShadowGenerator();if(d){const h=d.getShadowMap();h&&h.renderList&&h.renderList.length>0&&(X.shadowEnabled=!0,d.prepareDefines(y,Y))}}T.lightmapMode!=n.b.LIGHTMAP_DEFAULT?(X.lightmapMode=!0,y["LIGHTMAPEXCLUDED"+Y]=!0,y["LIGHTMAPNOSPECULAR"+Y]=T.lightmapMode==n.b.LIGHTMAP_SHADOWSONLY):(y["LIGHTMAPEXCLUDED"+Y]=!1,y["LIGHTMAPNOSPECULAR"+Y]=!1)}function p(h,d,T,Y,y){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=function(h,d){let T=!1;if(h.activeCamera){const Y=d.CAMERA_ORTHOGRAPHIC?1:0,y=d.CAMERA_PERSPECTIVE?1:0,C=1===h.activeCamera.mode?1:0,n=0===h.activeCamera.mode?1:0;(Y^C||y^n)&&(d.CAMERA_ORTHOGRAPHIC=1===C,d.CAMERA_PERSPECTIVE=1===n,T=!0)}return T}(h,Y);!1!==C&&(F=(0,X.g)(T,h,Y)),Y.DEPTHPREPASS!==!d.getColorWrite()&&(Y.DEPTHPREPASS=!Y.DEPTHPREPASS,F=!0),Y.INSTANCES!==y&&(Y.INSTANCES=y,F=!0),Y.THIN_INSTANCES!==n&&(Y.THIN_INSTANCES=n,F=!0),F&&Y.markAsUnprocessed()}function k(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!d._areAttributesDirty&&d._needNormals===d._normals&&d._needUVs===d._uvs)return!1;d._normals=d._needNormals,d._uvs=d._needUVs,d.NORMAL=d._needNormals&&h.isVerticesDataPresent("normal"),d._needNormals&&h.isVerticesDataPresent("tangent")&&(d.TANGENT=!0);for(let X=1;X<=6;++X)d["UV"+X]=!!d._needUVs&&h.isVerticesDataPresent(`uv${1===X?"":X}`);if(T){const T=h.useVertexColors&&h.isVerticesDataPresent("color");d.VERTEXCOLOR=T,d.VERTEXALPHA=h.hasVertexAlpha&&T&&C}return h.isVerticesDataPresent("instanceColor")&&(h.hasInstances||h.hasThinInstances)&&(d.INSTANCESCOLOR=!0),Y&&function(h,d){if(h.useBones&&h.computeBonesUsingShaders&&h.skeleton){d.NUM_BONE_INFLUENCERS=h.numBoneInfluencers;const T=void 0!==d.BONETEXTURE;if(h.skeleton.isUsingTextureForMatrices&&T)d.BONETEXTURE=!0;else{d.BonesPerMesh=h.skeleton.bones.length+1,d.BONETEXTURE=!T&&void 0;const Y=h.Eh().prePassRenderer;if(Y&&Y.enabled){const T=-1===Y.excludedSkinnedMesh.indexOf(h);d.BONES_VELOCITY_ENABLED=T}}}else d.NUM_BONE_INFLUENCERS=0,d.BonesPerMesh=0,void 0!==d.BONETEXTURE&&(d.BONETEXTURE=!1)}(h,d),y&&function(h,d){const T=h.morphTargetManager;T?(d.MORPHTARGETS_UV=T.supportsUVs&&d.UV1,d.MORPHTARGETS_UV2=T.supportsUV2s&&d.UV2,d.MORPHTARGETS_TANGENT=T.supportsTangents&&d.TANGENT,d.MORPHTARGETS_NORMAL=T.supportsNormals&&d.NORMAL,d.MORPHTARGETS_POSITION=T.supportsPositions,d.MORPHTARGETS_COLOR=T.supportsColors,d.MORPHTARGETTEXTURE_HASUVS=T.hasUVs,d.MORPHTARGETTEXTURE_HASUV2S=T.hasUV2s,d.MORPHTARGETTEXTURE_HASTANGENTS=T.hasTangents,d.MORPHTARGETTEXTURE_HASNORMALS=T.hasNormals,d.MORPHTARGETTEXTURE_HASPOSITIONS=T.hasPositions,d.MORPHTARGETTEXTURE_HASCOLORS=T.hasColors,d.NUM_MORPH_INFLUENCERS=T.numMaxInfluencers||T.numInfluencers,d.MORPHTARGETS=d.NUM_MORPH_INFLUENCERS>0,d.MORPHTARGETS_TEXTURE=T.isUsingTextureForTargets):(d.MORPHTARGETS_UV=!1,d.MORPHTARGETS_UV2=!1,d.MORPHTARGETS_TANGENT=!1,d.MORPHTARGETS_NORMAL=!1,d.MORPHTARGETS_POSITION=!1,d.MORPHTARGETS_COLOR=!1,d.MORPHTARGETTEXTURE_HASUVS=!1,d.MORPHTARGETTEXTURE_HASUV2S=!1,d.MORPHTARGETTEXTURE_HASTANGENTS=!1,d.MORPHTARGETTEXTURE_HASNORMALS=!1,d.MORPHTARGETTEXTURE_HASPOSITIONS=!1,d.MORPHTARGETTEXTURE_HAS_COLORS=!1,d.MORPHTARGETS=!1,d.NUM_MORPH_INFLUENCERS=0)}(h,d),n&&function(h,d){const T=h.bakedVertexAnimationManager;d.BAKED_VERTEX_ANIMATION_TEXTURE=!(!T||!T.isEnabled)}(h,d),!0}function o(h,d){if(h.activeCamera){const T=d.MULTIVIEW;d.MULTIVIEW=null!==h.activeCamera.outputRenderTarget&&h.activeCamera.outputRenderTarget.getViewCount()>1,d.MULTIVIEW!=T&&d.markAsUnprocessed()}}function u(h,d,T){const Y=d.ORDER_INDEPENDENT_TRANSPARENCY,y=d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;d.ORDER_INDEPENDENT_TRANSPARENCY=h.useOrderIndependentTransparency&&T,d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!h.getEngine().getCaps().textureFloatLinearFiltering,Y===d.ORDER_INDEPENDENT_TRANSPARENCY&&y===d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||d.markAsUnprocessed()}function N(h,d,T){const Y=d.PREPASS;if(!d._arePrePassDirty)return;const y=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(h.prePassRenderer&&h.prePassRenderer.enabled&&T){d.PREPASS=!0,d.SCENE_MRT_COUNT=h.prePassRenderer.mrtCount,d.PREPASS_NORMAL_WORLDSPACE=h.prePassRenderer.generateNormalsInWorldSpace,d.PREPASS_COLOR=!0,d.PREPASS_COLOR_INDEX=0;for(let T=0;T<y.length;T++){const Y=h.prePassRenderer.getIndex(y[T].type);-1!==Y?(d[y[T].define]=!0,d[y[T].index]=Y):d[y[T].define]=!1}}else{d.PREPASS=!1;for(let h=0;h<y.length;h++)d[y[h].define]=!1}d.PREPASS!=Y&&(d.markAsUnprocessed(),d.markAsImageProcessingDirty())}function K(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];y&&y.push("Light"+h),C||(d.push("vLightData"+h,"vLightDiffuse"+h,"vLightSpecular"+h,"vLightDirection"+h,"vLightWidth"+h,"vLightHeight"+h,"vLightFalloff"+h,"vLightGround"+h,"lightMatrix"+h,"shadowsInfo"+h,"depthValues"+h),T.push("shadowTexture"+h),T.push("depthTexture"+h),d.push("viewFrustumZ"+h,"cascadeBlendFactor"+h,"lightSizeUVCorrection"+h,"depthCorrection"+h,"penumbraDarkness"+h,"frustumLengths"+h),Y&&(T.push("projectionLightTexture"+h),d.push("textureProjectionMatrix"+h)),n&&T.push("iesLightTexture"+h))}function l(h,d,T){let Y,y,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(h.uniformsNames){const n=h;Y=n.uniformsNames,y=n.uniformBuffersNames,d=n.samplers,T=n.defines,C=n.maxSimultaneousLights||0}else Y=h,d||(d=[]);for(let n=0;n<C&&T["LIGHT"+n];n++)K(n,Y,d,T["PROJECTEDLIGHTTEXTURE"+n],y,!1,T["IESLIGHTTEXTURE"+n]);T.NUM_MORPH_INFLUENCERS&&(Y.push("morphTargetInfluences"),Y.push("morphTargetCount")),T.BAKED_VERTEX_ANIMATION_TEXTURE&&(Y.push("bakedVertexAnimationSettings"),Y.push("bakedVertexAnimationTextureSizeInverted"),Y.push("bakedVertexAnimationTime"),d.push("bakedVertexAnimationTexture"))}},13084:(h,d,T)=>{T.d(d,{e:()=>C});var Y=T(12765),y=T(13089);class C extends y.d{constructor(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(h,d,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new Y.Matrix,this._storeEffectOnSubMeshes=T}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(h,d){return!!h&&(!this._storeEffectOnSubMeshes||(!h.ld||0===h.ld.length||this.isReadyForSubMesh(h,h.ld[0],d)))}_isReadyForSubMesh(h){const d=h.materialDefines;return!(this.checkReadyOnEveryCall||!h.effect||!d||d._renderId!==this.Eh().getRenderId())}bindOnlyWorldMatrix(h){this._activeEffect.setMatrix("world",h)}bindOnlyNormalMatrix(h){this._activeEffect.setMatrix("normalMatrix",h)}bind(h,d){d&&this.bindForSubMesh(h,d,d.ld[0])}_afterBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;super._afterBind(h,d,T),this.Eh()._cachedEffect=d,T?T._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return T._drawWrapper._forceRebindOnNextCall||h.isCachedMaterialInvalid(this,d,Y)}dispose(h,d,T){this._activeEffect=void 0,super.dispose(h,d,T)}}},13119:(h,d,T)=>{T.d(d,{e:()=>X,i:()=>F});var Y=T(12750),y=T(12765),C=T(12757);class n{static extractMinAndMaxIndexed(h,d,T,Y,y,C){for(let n=T;n<T+Y;n++){const T=3*d[n],Y=h[T],X=h[T+1],F=h[T+2];y.minimizeInPlaceFromFloats(Y,X,F),C.maximizeInPlaceFromFloats(Y,X,F)}}static extractMinAndMax(h,d,T,Y,y,C){for(let n=d,X=d*Y;n<d+T;n++,X+=Y){const d=h[X],T=h[X+1],Y=h[X+2];y.minimizeInPlaceFromFloats(d,T,Y),C.maximizeInPlaceFromFloats(d,T,Y)}}}function X(h,d,T,Y){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=new y.pd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new y.pd(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n.extractMinAndMaxIndexed(h,d,T,Y,X,F),C&&(X.x-=X.x*C.x+C.y,X.y-=X.y*C.x+C.y,X.z-=X.z*C.x+C.y,F.x+=F.x*C.x+C.y,F.y+=F.y*C.x+C.y,F.z+=F.z*C.x+C.y),{minimum:X,maximum:F}}function F(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0;const X=new y.pd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new y.pd(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return C||(C=3),n.extractMinAndMax(h,d,T,C,X,F),Y&&(X.x-=X.x*Y.x+Y.y,X.y-=X.y*Y.x+Y.y,X.z-=X.z*Y.x+Y.y,F.x+=F.x*Y.x+Y.y,F.y+=F.y*Y.x+Y.y,F.z+=F.z*Y.x+Y.y),{minimum:X,maximum:F}}(0,Y.c)([C.d.filter((function(){for(var h=arguments.length,d=new Array(h),T=0;T<h;T++)d[T]=arguments[T];let[Y,y]=d;return!Array.isArray(Y)&&!Array.isArray(y)}))],n,"extractMinAndMaxIndexed",null),(0,Y.c)([C.d.filter((function(){for(var h=arguments.length,d=new Array(h),T=0;T<h;T++)d[T]=arguments[T];let[Y]=d;return!Array.isArray(Y)}))],n,"extractMinAndMax",null)},13095:(h,d,T)=>{T.d(d,{d:()=>F});var Y=T(12835),y=T(13098),C=T(13107),n=T(13119),X=T(12875);class F{get materialDefines(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(h=this._getDrawWrapper())||void 0===h?void 0:h.defines}set materialDefines(h){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=h}_getDrawWrapper(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h??this._engine.currentRenderPassId;let T=this._drawWrappers[h];return!T&&d&&(this._drawWrappers[h]=T=new X.d(this._mesh.Eh().getEngine())),T}_removeDrawWrapper(h){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var T;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(T=this._drawWrappers[h])||void 0===T||T.dispose(d));this._drawWrappers[h]=void 0}get effect(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(h=this._getDrawWrapper())||void 0===h?void 0:h.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(h){this._mainDrawWrapperOverride=h}setEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=this._drawWrapper;y.setEffect(h,d,Y),void 0!==T&&(y.materialContext=T),h||(y.defines=null,y.materialContext=void 0)}resetDrawCache(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==h)return void this._removeDrawWrapper(h,!0,d);for(const h of this._drawWrappers)null===h||void 0===h||h.dispose(d)}this._drawWrappers=[]}static AddToMesh(h,d,T,Y,y,C,n){return new F(h,d,T,Y,y,C,n,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(h,d,T,Y,y,C,n){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],F=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=h,this.verticesStart=d,this.verticesCount=T,this.indexStart=Y,this.indexCount=y,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=C,this._renderingMesh=n||C,F&&C.ld.push(this),this._engine=this._mesh.Eh().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=C.ld.length-1,X&&(this.refreshBoundingInfo(),C.Md(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(h){return this._boundingInfo=h,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const h=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return h||this._renderingMesh}jh(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!d)return h&&this._mesh.Eh()._hasDefaultMaterial?this._mesh.Eh().defaultMaterial:null;if(this._isMultiMaterial(d)){const h=d.getSubMaterial(this.materialIndex);return this._currentMaterial!==h&&(this._currentMaterial=h,this.resetDrawCache()),h}return d}_isMultiMaterial(h){return void 0!==h.getSubMaterial}refreshBoundingInfo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Rd)return this;if(h||(h=this._renderingMesh.getVerticesData(Y.g.PositionKind)),!h)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const d=this._renderingMesh.Pd();let T;if(0===this.indexStart&&this.indexCount===d.length){const h=this._renderingMesh.getBoundingInfo();T={minimum:h.minimum.clone(),maximum:h.maximum.clone()}}else T=(0,n.e)(h,d,this.indexStart,this.indexCount,this._renderingMesh.Rd.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(T.minimum,T.maximum):this._boundingInfo=new C.c(T.minimum,T.maximum),this}_checkCollision(h){return this.getBoundingInfo()._checkCollision(h)}updateBoundingInfo(h){let d=this.getBoundingInfo();return d||(this.refreshBoundingInfo(),d=this.getBoundingInfo()),d&&d.update(h),this}isInFrustum(h){const d=this.getBoundingInfo();return!!d&&d.isInFrustum(h,this._mesh.zS)}isCompletelyInFrustum(h){const d=this.getBoundingInfo();return!!d&&d.isCompletelyInFrustum(h)}render(h){return this._renderingMesh.render(this,h,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(h,d){if(!this._linesIndexBuffer){const T=6*Math.floor(this.indexCount/3),Y=this.verticesStart+this.verticesCount>65535?new Uint32Array(T):new Uint16Array(T);let y=0;if(0===h.length)for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=3)Y[y++]=h,Y[y++]=h+1,Y[y++]=h+1,Y[y++]=h+2,Y[y++]=h+2,Y[y++]=h;else for(let d=this.indexStart;d<this.indexStart+this.indexCount;d+=3)Y[y++]=h[d],Y[y++]=h[d+1],Y[y++]=h[d+1],Y[y++]=h[d+2],Y[y++]=h[d+2],Y[y++]=h[d];this._linesIndexBuffer=d.createIndexBuffer(Y),this._linesIndexCount=Y.length}return this._linesIndexBuffer}canIntersects(h){const d=this.getBoundingInfo();return!!d&&h.intersectsBox(d.boundingBox)}intersects(h,d,T,Y,y){const C=this.jh();if(!C)return null;let n=3,X=!1;switch(C.fillMode){case 3:case 5:case 6:case 8:return null;case 7:n=1,X=!0}return 4===C.fillMode?T.length?this._intersectLines(h,d,T,this._mesh.intersectionThreshold,Y):this._intersectUnIndexedLines(h,d,T,this._mesh.intersectionThreshold,Y):!T.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(h,d,T,Y,y):this._intersectTriangles(h,d,T,n,X,Y,y)}_intersectLines(h,d,T,Y,C){let n=null;for(let X=this.indexStart;X<this.indexStart+this.indexCount;X+=2){const F=d[T[X]],U=d[T[X+1]],Z=h.intersectionSegment(F,U,Y);if(!(Z<0)&&((C||!n||Z<n.distance)&&(n=new y.b(null,null,Z),n.faceId=X/2,C)))break}return n}_intersectUnIndexedLines(h,d,T,Y,C){let n=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=2){const T=d[X],F=d[X+1],U=h.intersectionSegment(T,F,Y);if(!(U<0)&&((C||!n||U<n.distance)&&(n=new y.b(null,null,U),n.faceId=X/2,C)))break}return n}_intersectTriangles(h,d,T,Y,y,C,n){let X=null,F=-1;for(let U=this.indexStart;U<this.indexStart+this.indexCount-(3-Y);U+=Y){F++;const Y=T[U],Z=T[U+1],S=T[U+2];if(y&&4294967295===S){U+=2;continue}const r=d[Y],c=d[Z],O=d[S];if(!r||!c||!O)continue;if(n&&!n(r,c,O,h,Y,Z,S))continue;const f=h.intersectsTriangle(r,c,O);if(f){if(f.distance<0)continue;if((C||!X||f.distance<X.distance)&&(X=f,X.faceId=F,C))break}}return X}_intersectUnIndexedTriangles(h,d,T,Y,y){let C=null;for(let n=this.verticesStart;n<this.verticesStart+this.verticesCount;n+=3){const T=d[n],X=d[n+1],F=d[n+2];if(y&&!y(T,X,F,h,-1,-1,-1))continue;const U=h.intersectsTriangle(T,X,F);if(U){if(U.distance<0)continue;if((Y||!C||U.distance<C.distance)&&(C=U,C.faceId=n/3,Y))break}}return C}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(h,d){const T=new F(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,h,d,!1);if(!this.IsGlobal){const h=this.getBoundingInfo();if(!h)return T;T._boundingInfo=new C.c(h.minimum,h.maximum)}return T}dispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Eh().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const d=this._mesh.ld.indexOf(this);this._mesh.ld.splice(d,1),this.resetDrawCache(void 0,h)}getClassName(){return"SubMesh"}static CreateFromIndices(h,d,T,Y,y){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=Number.MAX_VALUE,X=-Number.MAX_VALUE;const U=(y||Y).Pd();for(let F=d;F<d+T;F++){const h=U[F];h<n&&(n=h),h>X&&(X=h)}return new F(h,n,X-n+1,d,T,Y,y,C)}}}}]);