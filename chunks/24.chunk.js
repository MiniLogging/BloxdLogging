"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[24],{13231:(z,u,U)=>{U.d(u,{b:()=>J});class J{constructor(z,u,U){this.bu=z,this.bv=u,this.distance=U,this.faceId=0,this.subMeshId=0}}},13245:(z,u,U)=>{U.d(u,{c:()=>g});var J=U(12926),v=U(12914),f=U(12917);class g{constructor(z,u,U){this.vectors=(0,J.e)(8,v.Eu.Zero),this.center=v.Eu.Zero(),this.centerWorld=v.Eu.Zero(),this.extendSize=v.Eu.Zero(),this.extendSizeWorld=v.Eu.Zero(),this.directions=(0,J.e)(3,v.Eu.Zero),this.vectorsWorld=(0,J.e)(8,v.Eu.Zero),this.minimumWorld=v.Eu.Zero(),this.maximumWorld=v.Eu.Zero(),this.minimum=v.Eu.Zero(),this.maximum=v.Eu.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(z,u,U)}reConstruct(z,u,U){const J=z.x,f=z.y,g=z.z,w=u.x,P=u.y,R=u.z,S=this.vectors;this.minimum.zg(J,f,g),this.maximum.zg(w,P,R),S[0].zg(J,f,g),S[1].zg(w,P,R),S[2].zg(w,f,g),S[3].zg(J,P,g),S[4].zg(J,f,R),S[5].zg(w,P,g),S[6].zg(J,P,R),S[7].zg(w,f,R),u.addToRef(z,this.center).scaleInPlace(.5),u.subtractToRef(z,this.extendSize).scaleInPlace(.5),this._worldMatrix=U||v.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(z){const u=g._TmpVector3,U=this.maximum.subtractToRef(this.minimum,u[0]),J=U.length();U.normalizeFromLength(J);const v=J*z,f=U.scaleInPlace(.5*v),w=this.center.subtractToRef(f,u[1]),P=this.center.addToRef(f,u[2]);return this.reConstruct(w,P,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){const u=this.minimumWorld,U=this.maximumWorld,J=this.directions,f=this.vectorsWorld,g=this.vectors;if(z.isIdentity()){u.v(this.minimum),U.v(this.maximum);for(let z=0;z<8;++z)f[z].v(g[z]);this.extendSizeWorld.v(this.extendSize),this.centerWorld.v(this.center)}else{u.fg(Number.MAX_VALUE),U.fg(-Number.MAX_VALUE);for(let J=0;J<8;++J){const w=f[J];v.Eu.TransformCoordinatesToRef(g[J],z,w),u.minimizeInPlace(w),U.maximizeInPlace(w)}U.subtractToRef(u,this.extendSizeWorld).scaleInPlace(.5),U.addToRef(u,this.centerWorld).scaleInPlace(.5)}v.Eu.FromArrayToRef(z.m,0,J[0]),v.Eu.FromArrayToRef(z.m,4,J[1]),v.Eu.FromArrayToRef(z.m,8,J[2]),this._worldMatrix=z}isInFrustum(z){return g.IsInFrustum(this.vectorsWorld,z)}isCompletelyInFrustum(z){return g.IsCompletelyInFrustum(this.vectorsWorld,z)}intersectsPoint(z){const u=this.minimumWorld,U=this.maximumWorld,J=u.x,v=u.y,g=u.z,w=U.x,P=U.y,R=U.z,S=z.x,d=z.y,mz=z.z,Z=-f.d;return!(w-S<Z||Z>S-J)&&(!(P-d<Z||Z>d-v)&&!(R-mz<Z||Z>mz-g))}intersectsSphere(z){return g.IntersectsSphere(this.minimumWorld,this.maximumWorld,z.centerWorld,z.radiusWorld)}intersectsMinMax(z,u){const U=this.minimumWorld,J=this.maximumWorld,v=U.x,f=U.y,g=U.z,w=J.x,P=J.y,R=J.z,S=z.x,d=z.y,mz=z.z,Z=u.x,A=u.y,E=u.z;return!(w<S||v>Z)&&(!(P<d||f>A)&&!(R<mz||g>E))}dispose(){var z,u;null===(z=this._drawWrapperFront)||void 0===z||z.dispose(),null===(u=this._drawWrapperBack)||void 0===u||u.dispose()}static Intersects(z,u){return z.intersectsMinMax(u.minimumWorld,u.maximumWorld)}static IntersectsSphere(z,u,U,J){const f=g._TmpVector3[0];v.Eu.ClampToRef(U,z,u,f);return v.Eu.DistanceSquared(U,f)<=J*J}static IsCompletelyInFrustum(z,u){for(let U=0;U<6;++U){const J=u[U];for(let u=0;u<8;++u)if(J.dotCoordinate(z[u])<0)return!1}return!0}static IsInFrustum(z,u){for(let U=0;U<6;++U){let J=!0;const v=u[U];for(let u=0;u<8;++u)if(v.dotCoordinate(z[u])>=0){J=!1;break}if(J)return!1}return!0}}g._TmpVector3=(0,J.e)(3,v.Eu.Zero)},13238:(z,u,U)=>{U.d(u,{b:()=>d});var J=U(12926),v=U(12914),f=U(13245),g=U(13250);const w={min:0,max:0},P={min:0,max:0},R=(z,u,U)=>{const J=v.Eu.Dot(u.centerWorld,z),f=Math.abs(v.Eu.Dot(u.directions[0],z))*u.extendSize.x+Math.abs(v.Eu.Dot(u.directions[1],z))*u.extendSize.y+Math.abs(v.Eu.Dot(u.directions[2],z))*u.extendSize.z;U.min=J-f,U.max=J+f},S=(z,u,U)=>(R(z,u,w),R(z,U,P),!(w.min>P.max||P.min>w.max));class d{constructor(z,u,U){this._isLocked=!1,this.boundingBox=new f.c(z,u,U),this.boundingSphere=new g.d(z,u,U)}reConstruct(z,u,U){this.boundingBox.reConstruct(z,u,U),this.boundingSphere.reConstruct(z,u,U)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(z){this._isLocked=z}update(z){this._isLocked||(this.boundingBox._update(z),this.boundingSphere._update(z))}centerOn(z,u){const U=d._TmpVector3[0].v(z).dm(u),J=d._TmpVector3[1].v(z).addInPlace(u);return this.boundingBox.reConstruct(U,J,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(U,J,this.boundingBox.getWorldMatrix()),this}encapsulate(z){const u=v.Eu.Minimize(this.minimum,z),U=v.Eu.Maximize(this.maximum,z);return this.reConstruct(u,U,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(z){const u=v.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(u);const U=v.TmpVectors.Eu[0];return v.Eu.TransformCoordinatesToRef(z.boundingBox.minimumWorld,u,U),this.encapsulate(U),v.Eu.TransformCoordinatesToRef(z.boundingBox.maximumWorld,u,U),this.encapsulate(U),this}scale(z){return this.boundingBox.scale(z),this.boundingSphere.scale(z),this}isInFrustum(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===u||3===u)&&this.boundingSphere.isCenterInFrustum(z))return!0;if(!this.boundingSphere.isInFrustum(z))return!1;return!(1!==u&&3!==u)||this.boundingBox.isInFrustum(z)}get diagonalLength(){const z=this.boundingBox;return z.maximumWorld.subtractToRef(z.minimumWorld,d._TmpVector3[0]).length()}isCompletelyInFrustum(z){return this.boundingBox.isCompletelyInFrustum(z)}_checkCollision(z){return z._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(z){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(z)&&!!this.boundingBox.intersectsPoint(z))}intersects(z,u){if(!g.d.Intersects(this.boundingSphere,z.boundingSphere))return!1;if(!f.c.Intersects(this.boundingBox,z.boundingBox))return!1;if(!u)return!0;const U=this.boundingBox,J=z.boundingBox;return!!S(U.directions[0],U,J)&&(!!S(U.directions[1],U,J)&&(!!S(U.directions[2],U,J)&&(!!S(J.directions[0],U,J)&&(!!S(J.directions[1],U,J)&&(!!S(J.directions[2],U,J)&&(!!S(v.Eu.Cross(U.directions[0],J.directions[0]),U,J)&&(!!S(v.Eu.Cross(U.directions[0],J.directions[1]),U,J)&&(!!S(v.Eu.Cross(U.directions[0],J.directions[2]),U,J)&&(!!S(v.Eu.Cross(U.directions[1],J.directions[0]),U,J)&&(!!S(v.Eu.Cross(U.directions[1],J.directions[1]),U,J)&&(!!S(v.Eu.Cross(U.directions[1],J.directions[2]),U,J)&&(!!S(v.Eu.Cross(U.directions[2],J.directions[0]),U,J)&&(!!S(v.Eu.Cross(U.directions[2],J.directions[1]),U,J)&&!!S(v.Eu.Cross(U.directions[2],J.directions[2]),U,J))))))))))))))}}d._TmpVector3=(0,J.e)(2,v.Eu.Zero)},13250:(z,u,U)=>{U.d(u,{d:()=>f});var J=U(12926),v=U(12914);class f{constructor(z,u,U){this.center=v.Eu.Zero(),this.centerWorld=v.Eu.Zero(),this.minimum=v.Eu.Zero(),this.maximum=v.Eu.Zero(),this.reConstruct(z,u,U)}reConstruct(z,u,U){this.minimum.v(z),this.maximum.v(u);const J=v.Eu.Distance(z,u);u.addToRef(z,this.center).scaleInPlace(.5),this.radius=.5*J,this._update(U||v.Matrix.IdentityReadOnly)}scale(z){const u=this.radius*z,U=f._TmpVector3,J=U[0].fg(u),v=this.center.subtractToRef(J,U[1]),g=this.center.addToRef(J,U[2]);return this.reConstruct(v,g,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){if(z.isIdentity())this.centerWorld.v(this.center),this.radiusWorld=this.radius;else{v.Eu.TransformCoordinatesToRef(this.center,z,this.centerWorld);const u=f._TmpVector3[0];v.Eu.TransformNormalFromFloatsToRef(1,1,1,z,u),this.radiusWorld=Math.max(Math.abs(u.x),Math.abs(u.y),Math.abs(u.z))*this.radius}}isInFrustum(z){const u=this.centerWorld,U=this.radiusWorld;for(let J=0;J<6;J++)if(z[J].dotCoordinate(u)<=-U)return!1;return!0}isCenterInFrustum(z){const u=this.centerWorld;for(let U=0;U<6;U++)if(z[U].dotCoordinate(u)<0)return!1;return!0}intersectsPoint(z){const u=v.Eu.DistanceSquared(this.centerWorld,z);return!(this.radiusWorld*this.radiusWorld<u)}static Intersects(z,u){const U=v.Eu.DistanceSquared(z.centerWorld,u.centerWorld),J=z.radiusWorld+u.radiusWorld;return!(J*J<U)}static CreateFromCenterAndRadius(z,u,U){this._TmpVector3[0].v(z),this._TmpVector3[1].zg(0,0,u),this._TmpVector3[2].v(z),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].dm(this._TmpVector3[1]);const J=new f(this._TmpVector3[0],this._TmpVector3[2]);return J._worldMatrix=U||v.Matrix.Identity(),J}}f._TmpVector3=(0,J.e)(3,v.Eu.Zero)},13266:(z,u,U)=>{function J(z){-1===z.indexOf("vClipPlane")&&z.push("vClipPlane"),-1===z.indexOf("vClipPlane2")&&z.push("vClipPlane2"),-1===z.indexOf("vClipPlane3")&&z.push("vClipPlane3"),-1===z.indexOf("vClipPlane4")&&z.push("vClipPlane4"),-1===z.indexOf("vClipPlane5")&&z.push("vClipPlane5"),-1===z.indexOf("vClipPlane6")&&z.push("vClipPlane6")}function v(z,u,U){var J,v,f,g,w,P;const R=!!(null!==(J=z.clipPlane)&&void 0!==J?J:u.clipPlane),S=!!(null!==(v=z.clipPlane2)&&void 0!==v?v:u.clipPlane2),d=!!(null!==(f=z.clipPlane3)&&void 0!==f?f:u.clipPlane3),mz=!!(null!==(g=z.clipPlane4)&&void 0!==g?g:u.clipPlane4),Z=!!(null!==(w=z.clipPlane5)&&void 0!==w?w:u.clipPlane5),A=!!(null!==(P=z.clipPlane6)&&void 0!==P?P:u.clipPlane6);R&&U.push("#define CLIPPLANE"),S&&U.push("#define CLIPPLANE2"),d&&U.push("#define CLIPPLANE3"),mz&&U.push("#define CLIPPLANE4"),Z&&U.push("#define CLIPPLANE5"),A&&U.push("#define CLIPPLANE6")}function f(z,u,U){var J,v,f,g,w,P;let R=!1;const S=!!(null!==(J=z.clipPlane)&&void 0!==J?J:u.clipPlane),d=!!(null!==(v=z.clipPlane2)&&void 0!==v?v:u.clipPlane2),mz=!!(null!==(f=z.clipPlane3)&&void 0!==f?f:u.clipPlane3),Z=!!(null!==(g=z.clipPlane4)&&void 0!==g?g:u.clipPlane4),A=!!(null!==(w=z.clipPlane5)&&void 0!==w?w:u.clipPlane5),E=!!(null!==(P=z.clipPlane6)&&void 0!==P?P:u.clipPlane6);return U.CLIPPLANE!==S&&(U.CLIPPLANE=S,R=!0),U.CLIPPLANE2!==d&&(U.CLIPPLANE2=d,R=!0),U.CLIPPLANE3!==mz&&(U.CLIPPLANE3=mz,R=!0),U.CLIPPLANE4!==Z&&(U.CLIPPLANE4=Z,R=!0),U.CLIPPLANE5!==A&&(U.CLIPPLANE5=A,R=!0),U.CLIPPLANE6!==E&&(U.CLIPPLANE6=E,R=!0),R}function g(z,u,U){var J,v,f,g,P,R;let S=null!==(J=u.clipPlane)&&void 0!==J?J:U.clipPlane;w(z,"vClipPlane",S),S=null!==(v=u.clipPlane2)&&void 0!==v?v:U.clipPlane2,w(z,"vClipPlane2",S),S=null!==(f=u.clipPlane3)&&void 0!==f?f:U.clipPlane3,w(z,"vClipPlane3",S),S=null!==(g=u.clipPlane4)&&void 0!==g?g:U.clipPlane4,w(z,"vClipPlane4",S),S=null!==(P=u.clipPlane5)&&void 0!==P?P:U.clipPlane5,w(z,"vClipPlane5",S),S=null!==(R=u.clipPlane6)&&void 0!==R?R:U.clipPlane6,w(z,"vClipPlane6",S)}function w(z,u,U){U&&z.setFloat4(u,U.normal.x,U.normal.y,U.normal.z,U.d)}U.d(u,{b:()=>J,f:()=>g,h:()=>f,k:()=>v})},13219:(z,u,U)=>{U.d(u,{d:()=>J});class J{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(z,u){this._defines[z]||(z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z),this._defines[z]=new Array),this._defines[z].push(u)}addCPUSkinningFallback(z,u){this._mesh=u,z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(z,u){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,z=z.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),u._bonesComputationForcedToCPU=!0;const U=this._mesh.Vz();for(let z=0;z<U.meshes.length;z++){const J=U.meshes[z];if(J.material){if(J.computeBonesUsingShaders&&0!==J.numBoneInfluencers)if(J.material.getEffect()===u)J.computeBonesUsingShaders=!1;else if(J.cf)for(const z of J.cf){if(z.effect===u){J.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&J.computeBonesUsingShaders&&J.numBoneInfluencers>0&&(J.computeBonesUsingShaders=!1)}}else{const u=this._defines[this._currentRank];if(u)for(let U=0;U<u.length;U++)z=z.replace("#define "+u[U],"");this._currentRank++}return z}}},13224:(z,u,U)=>{U.d(u,{e:()=>r});var J=U(21),v=U(12899),f=U(12901),g=U(12748),w=U(12756),P=U(12797),R=U(13226),S=U(13183),d=U(12760),mz=U(12976),Z=U(13035),A=U(12955);class E{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(z){this._func=z}get funcRef(){return this._funcRef}set funcRef(z){this._funcRef=z}get funcMask(){return this._funcMask}set funcMask(z){this._funcMask=z}get opStencilFail(){return this._opStencilFail}set opStencilFail(z){this._opStencilFail=z}get opDepthFail(){return this._opDepthFail}set opDepthFail(z){this._opDepthFail=z}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(z){this._opStencilDepthPass=z}get mask(){return this._mask}set mask(z){this._mask=z}get enabled(){return this._enabled}set enabled(z){this._enabled=z}getClassName(){return"MaterialStencilState"}copyTo(z){A.b.Clone((()=>z),this)}serialize(){return A.b.Serialize(this)}parse(z,u,U){A.b.Parse((()=>this),z,u,U)}}(0,v.b)([(0,f.K)()],E.prototype,"func",null),(0,v.b)([(0,f.K)()],E.prototype,"funcRef",null),(0,v.b)([(0,f.K)()],E.prototype,"funcMask",null),(0,v.b)([(0,f.K)()],E.prototype,"opStencilFail",null),(0,v.b)([(0,f.K)()],E.prototype,"opDepthFail",null),(0,v.b)([(0,f.K)()],E.prototype,"opStencilDepthPass",null),(0,v.b)([(0,f.K)()],E.prototype,"mask",null),(0,v.b)([(0,f.K)()],E.prototype,"enabled",null);var C=U(13261);class r{get _supportGlowLayer(){return!1}set _glowModeEnabled(z){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(z){if(this._alpha===z)return;const u=this._alpha;this._alpha=z,1!==u&&1!==z||this.LS(r.MiscDirtyFlag+r.PrePassDirtyFlag)}get alpha(){return this._alpha}set ef(z){this._backFaceCulling!==z&&(this._backFaceCulling=z,this.LS(r.TextureDirtyFlag))}get ef(){return this._backFaceCulling}set cullBackFaces(z){this._cullBackFaces!==z&&(this._cullBackFaces=z,this.LS(r.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(z){this._blockDirtyMechanism!==z&&(this._blockDirtyMechanism=z,z||this.UZ())}atomicMaterialsUpdate(z){this.blockDirtyMechanism=!0;try{z(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(z){this._onDisposeObserver&&this.Xf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Xf.add(z)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new w.e),this._onBindObservable}set onBind(z){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(z)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new w.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new w.e),this._onEffectCreatedObservable}set alphaMode(z){this._alphaMode!==z&&(this._alphaMode=z,this.LS(r.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(z){this._needDepthPrePass!==z&&(this._needDepthPrePass=z,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(z){this._fogEnabled!==z&&(this._fogEnabled=z,this.LS(r.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(z){this.fillMode=z?r.WireFrameFillMode:r.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(z){this.fillMode=z?r.PointFillMode:r.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(z){this._fillMode!==z&&(this._fillMode=z,this.LS(r.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){const u=this.Vz().getEngine().getCaps().fragmentDepthSupported;z&&!u&&d.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=z&&u,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(z){this._drawWrapper=z}constructor(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Xf=new w.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.tf=new E,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=z;const v=u||P.e.LastCreatedScene;v&&(this._scene=v,this._dirtyCallbacks={},this._forceGLSL=J,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=z||g.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new Z.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new S.e(this._scene.getEngine(),void 0,void 0,z),this._useUBO=this.Vz().getEngine().supportsUniformBuffers,this._createUniformBuffer(),U||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),r.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var z;const u=this.Vz().getEngine();null===(z=this._uniformBuffer)||void 0===z||z.dispose(),u.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new S.e(u,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new S.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(z){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.UZ(),this.checkReadyOnlyOnce=!0}unfreeze(){this.UZ(),this.checkReadyOnlyOnce=!1}isReady(z,u){return!0}isReadyForSubMesh(z,u,U){const J=u.materialDefines;return!!J&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=J,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Vz(){return this._scene}_getEffectiveOrientation(z){return null!==this.sideOrientation?this.sideOrientation:z.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(z){this._transparencyMode!==z&&(this._transparencyMode=z,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===r.MATERIAL_ALPHABLEND||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===r.MATERIAL_ALPHATEST||this._transparencyMode===r.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===r.MATERIAL_OPAQUE||this._transparencyMode===r.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(z){return this._hasTransparencyMode?this._transparencyModeIsBlend:z.visibility<1||!this._disableAlphaBlending&&(z.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(z){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(z)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}UZ(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.Vz().meshes;for(const U of u)if(U.cf)for(const u of U.cf)if(u.jz()===this)for(const U of u._drawWrappers)U&&this._materialContext===U.materialContext&&(U._wasPreviouslyReady=!1,U._wasPreviouslyUsingInstances=null,U._forceRebindOnNextCall=z);z&&this.LS(r.AllDirtyFlag)}_preBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this._scene.getEngine(),J=(null==u?this.sideOrientation:u)===r.ClockWiseSideOrientation;return U.enableEffect(z||this._getDrawWrapper()),U.setState(this.ef,this.zOffset,!1,J,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.tf,this.zOffsetUnits),J}bind(z,u){}buildUniformLayout(){const z=this._uniformBuffer;this._eventInfo.ubo=z,this._callbackPluginEventGeneric(8,this._eventInfo),z.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(z,u,U){const J=U._drawWrapper;this._eventInfo.subMesh=U,this._callbackPluginEventBindForSubMesh(this._eventInfo),J._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(z){}bindView(z){this._useUBO?this._needToBindSceneUbo=!0:z.setMatrix("view",this.Vz().getViewMatrix())}bindViewProjection(z){this._useUBO?this._needToBindSceneUbo=!0:(z.setMatrix("viewProjection",this.Vz().getTransformMatrix()),z.setMatrix("projection",this.Vz().getProjectionMatrix()))}bindEyePosition(z,u){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(z,u)}_afterBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&u&&(this._needToBindSceneUbo=!1,(0,C.m)(u,this.Vz().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=z?z.visibility:1,this._onBindObservable&&z&&this._onBindObservable.notifyObservers(z),this.disableDepthWrite){const z=this._scene.getEngine();this._cachedDepthWriteState=z.getDepthWrite(),z.setDepthWrite(!1)}if(this.disableColorWrite){const z=this._scene.getEngine();this._cachedColorWriteState=z.getColorWrite(),z.setColorWrite(!1)}if(0!==this.depthFunction){const z=this._scene.getEngine();this._cachedDepthFunctionState=z.getDepthFunction()||0,z.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(z){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=z,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(z){return null}_clonePlugins(z,u){const U={};if(this._serializePlugins(U),r._ParsePlugins(U,z,this._scene,u),this.pluginManager)for(const J of this.pluginManager._plugins){const u=z.pluginManager.getPlugin(J.name);u&&J.copyTo(u)}}getBindedMeshes(){if(this.meshMap){const z=[];for(const u in this.meshMap){const U=this.meshMap[u];U&&z.push(U)}return z}return this._scene.meshes.filter((z=>z.material===this))}forceCompilation(z,u,U,v){const f=(0,J.e)({clipPlane:!1,useInstances:!1},U),g=this.Vz(),w=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const P=()=>{if(!this._scene||!this._scene.getEngine())return;const U=g.clipPlane;if(f.clipPlane&&(g.clipPlane=new mz.d(0,0,0,1)),this._storeEffectOnSubMeshes){let U=!0,J=null;if(z.cf){const u=new R.d(0,0,0,0,0,z,void 0,!1,!1);u.materialDefines&&(u.materialDefines._renderId=-1),this.isReadyForSubMesh(z,u,f.useInstances)||(u.effect&&u.effect.getCompilationError()&&u.effect.allFallbacksProcessed()?J=u.effect.getCompilationError():(U=!1,setTimeout(P,16)))}U&&(this.allowShaderHotSwapping=w,J&&v&&v(J),u&&u(this))}else this.isReady()?(this.allowShaderHotSwapping=w,u&&u(this)):setTimeout(P,16);f.clipPlane&&(g.clipPlane=U)};P()}async forceCompilationAsync(z,u){return await new Promise(((U,J)=>{this.forceCompilation(z,(()=>{U()}),u,(z=>{J(z)}))}))}LS(z){this.Vz().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(r._DirtyCallbackArray.length=0,z&r.ImageProcessingDirtyFlag&&r._DirtyCallbackArray.push(r._ImageProcessingDirtyCallBack),z&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),z&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),z&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),z&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),z&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),z&r.PrePassDirtyFlag&&r._DirtyCallbackArray.push(r._PrePassDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.Vz().resetCachedMaterial())}resetDrawCache(){const z=this.Vz().meshes;for(const u of z)if(u.cf)for(const z of u.cf)z.jz()===this&&z.resetDrawCache()}_markAllSubMeshesAsDirty(z){const u=this.Vz();if(u.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const U=u.meshes;for(const J of U)if(J.cf)for(const U of J.cf){if((U.jz()||(u._hasDefaultMaterial?u.defaultMaterial:null))===this)for(const u of U._drawWrappers)u&&u.defines&&u.defines.markAllAsDirty&&this._materialContext===u.materialContext&&z(u.defines)}}_markScenePrePassDirty(){if(this.Vz().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const z=this.Vz().enablePrePassRenderer();z&&z.LS()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(r._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(r._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const z=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Xf.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(z)}))}}setPrePassRenderer(z){return!1}dispose(z,u,U){const J=this.Vz();if(J.stopAnimation(this),J.freeProcessedMaterials(),J.removeMaterial(this),this._eventInfo.forceDisposeTextures=u,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const z=this._parentContainer.materials.indexOf(this);z>-1&&this._parentContainer.materials.splice(z,1),this._parentContainer=null}if(!0!==U)if(this.meshMap)for(const v in this.meshMap){const z=this.meshMap[v];this._disposeMeshResources(z)}else{const z=J.meshes;for(const u of z)this._disposeMeshResources(u)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Xf.notifyObservers(this),this.Xf.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(z){if(!z)return;const u=z.nf,U=z._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(z.cf&&U)for(const v of z.cf){const z=v._drawWrappers;for(let f=0;f<z.length;f++){var J;const g=null===(J=z[f])||void 0===J?void 0:J.effect;if(!g)continue;U[f]===this&&(null===u||void 0===u||u._releaseVertexArrayObject(g),v._removeDrawWrapper(f,!0,!0))}}}else null===u||void 0===u||u._releaseVertexArrayObject(this._drawWrapper.effect);z.material!==this||z.sourceMesh||(z.material=null)}serialize(){const z=A.b.Serialize(this);return z.tf=this.tf.serialize(),z.uniqueId=this.uniqueId,this._serializePlugins(z),z}_serializePlugins(z){if(z.plugins={},this.pluginManager)for(const u of this.pluginManager._plugins)u.doNotSerialize||(z.plugins[u.getClassName()]=u.serialize())}static Parse(z,u,U){if(z.customType){if("BABYLON.PBRMaterial"===z.customType&&z.overloadedAlbedo&&(z.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else z.customType="BABYLON.StandardMaterial";const J=g.Tools.Instantiate(z.customType).Parse(z,u,U);return J._loadedUniqueId=z.uniqueId,J}static _ParsePlugins(z,u,U,J){if(z.plugins)for(const w in z.plugins){var v,f;const P=z.plugins[w];let R=null===(v=u.pluginManager)||void 0===v?void 0:v.getPlugin(P.name);if(!R){const z=g.Tools.Instantiate("BABYLON."+w);z&&(R=new z(u))}null===(f=R)||void 0===f||f.parse(P,U,J)}}}r.TriangleFillMode=0,r.WireFrameFillMode=1,r.PointFillMode=2,r.PointListDrawMode=3,r.LineListDrawMode=4,r.LineLoopDrawMode=5,r.LineStripDrawMode=6,r.TriangleStripDrawMode=7,r.TriangleFanDrawMode=8,r.ClockWiseSideOrientation=0,r.CounterClockWiseSideOrientation=1,r.ImageProcessingDirtyFlag=64,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.PrePassDirtyFlag=32,r.AllDirtyFlag=127,r.MATERIAL_OPAQUE=0,r.MATERIAL_ALPHATEST=1,r.MATERIAL_ALPHABLEND=2,r.MATERIAL_ALPHATESTANDBLEND=3,r.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,r.MATERIAL_NORMALBLENDMETHOD_RNM=1,r.OnEventObservable=new w.e,r._AllDirtyCallBack=z=>z.markAllAsDirty(),r._ImageProcessingDirtyCallBack=z=>z.markAsImageProcessingDirty(),r._TextureDirtyCallBack=z=>z.markAsTexturesDirty(),r._FresnelDirtyCallBack=z=>z.markAsFresnelDirty(),r._MiscDirtyCallBack=z=>z.markAsMiscDirty(),r._PrePassDirtyCallBack=z=>z.markAsPrePassDirty(),r._LightsDirtyCallBack=z=>z.markAsLightDirty(),r._AttributeDirtyCallBack=z=>z.markAsAttributesDirty(),r._FresnelAndMiscDirtyCallBack=z=>{r._FresnelDirtyCallBack(z),r._MiscDirtyCallBack(z)},r._TextureAndMiscDirtyCallBack=z=>{r._TextureDirtyCallBack(z),r._MiscDirtyCallBack(z)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=z=>{for(const u of r._DirtyCallbackArray)u(z)},(0,v.b)([(0,f.K)()],r.prototype,"id",void 0),(0,v.b)([(0,f.K)()],r.prototype,"uniqueId",void 0),(0,v.b)([(0,f.K)()],r.prototype,"name",void 0),(0,v.b)([(0,f.K)()],r.prototype,"metadata",void 0),(0,v.b)([(0,f.K)()],r.prototype,"checkReadyOnEveryCall",void 0),(0,v.b)([(0,f.K)()],r.prototype,"checkReadyOnlyOnce",void 0),(0,v.b)([(0,f.K)()],r.prototype,"state",void 0),(0,v.b)([(0,f.K)("alpha")],r.prototype,"_alpha",void 0),(0,v.b)([(0,f.K)("ef")],r.prototype,"_backFaceCulling",void 0),(0,v.b)([(0,f.K)("cullBackFaces")],r.prototype,"_cullBackFaces",void 0),(0,v.b)([(0,f.K)()],r.prototype,"sideOrientation",void 0),(0,v.b)([(0,f.K)("alphaMode")],r.prototype,"_alphaMode",void 0),(0,v.b)([(0,f.K)()],r.prototype,"_needDepthPrePass",void 0),(0,v.b)([(0,f.K)()],r.prototype,"disableDepthWrite",void 0),(0,v.b)([(0,f.K)()],r.prototype,"disableColorWrite",void 0),(0,v.b)([(0,f.K)()],r.prototype,"forceDepthWrite",void 0),(0,v.b)([(0,f.K)()],r.prototype,"depthFunction",void 0),(0,v.b)([(0,f.K)()],r.prototype,"separateCullingPass",void 0),(0,v.b)([(0,f.K)("fogEnabled")],r.prototype,"_fogEnabled",void 0),(0,v.b)([(0,f.K)()],r.prototype,"pointSize",void 0),(0,v.b)([(0,f.K)()],r.prototype,"zOffset",void 0),(0,v.b)([(0,f.K)()],r.prototype,"zOffsetUnits",void 0),(0,v.b)([(0,f.K)()],r.prototype,"pointsCloud",null),(0,v.b)([(0,f.K)()],r.prototype,"fillMode",null),(0,v.b)([(0,f.K)()],r.prototype,"useLogarithmicDepth",null),(0,v.b)([(0,f.K)()],r.prototype,"transparencyMode",null)},13261:(z,u,U)=>{U.d(u,{B:()=>p,C:()=>Y,D:()=>Q,F:()=>r,I:()=>x,K:()=>N,M:()=>D,N:()=>c,P:()=>j,Q:()=>A,d:()=>X,f:()=>d,g:()=>t,h:()=>S,l:()=>E,m:()=>C,n:()=>M,p:()=>O,q:()=>T,r:()=>V,u:()=>L,w:()=>Z,y:()=>mz});var J=U(12760),v=U(12967),f=U(12797),g=U(13217),w=U(13266);const P=v.Tu.Black(),R={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function S(z,u,U){if(!z||z.LOGARITHMICDEPTH||z.indexOf&&z.indexOf("LOGARITHMICDEPTH")>=0){const z=U.activeCamera;1===z.mode&&J.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),u.setFloat("logarithmicDepthConstant",2/(Math.log(z.maxZ+1)/Math.LN2))}}function d(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];U&&z.fogEnabled&&(!u||u.applyFog)&&0!==z.fogMode&&(U.setFloat4("vFogInfos",z.fogMode,z.fogStart,z.fogEnd,z.fogDensity),J?(z.fogColor.toLinearSpaceToRef(P,z.getEngine().useExactSrgbConversions),U.setColor3("vFogColor",P)):U.setColor3("vFogColor",z.fogColor))}function mz(z,u,U,J,v,f,g,w,P,S){const d=z.numMaxInfluencers||z.numInfluencers;return d<=0?0:(u.push("#define MORPHTARGETS"),z.hasPositions&&u.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),z.hasNormals&&u.push("#define MORPHTARGETTEXTURE_HASNORMALS"),z.hasTangents&&u.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),z.hasUVs&&u.push("#define MORPHTARGETTEXTURE_HASUVS"),z.hasUV2s&&u.push("#define MORPHTARGETTEXTURE_HASUV2S"),z.hasColors&&u.push("#define MORPHTARGETTEXTURE_HASCOLORS"),z.supportsPositions&&v&&u.push("#define MORPHTARGETS_POSITION"),z.supportsNormals&&f&&u.push("#define MORPHTARGETS_NORMAL"),z.supportsTangents&&g&&u.push("#define MORPHTARGETS_TANGENT"),z.supportsUVs&&w&&u.push("#define MORPHTARGETS_UV"),z.supportsUV2s&&P&&u.push("#define MORPHTARGETS_UV2"),z.supportsColors&&S&&u.push("#define MORPHTARGETS_COLOR"),u.push("#define NUM_MORPH_INFLUENCERS "+d),z.isUsingTextureForTargets&&u.push("#define MORPHTARGETS_TEXTURE"),R.NUM_MORPH_INFLUENCERS=d,R.NORMAL=f,R.TANGENT=g,R.UV=w,R.UV2=P,R.COLOR=S,Z(U,J,R,v),d)}function Z(z,u,U){let v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=U.NUM_MORPH_INFLUENCERS;if(g>0&&f.e.LastCreatedEngine){const w=f.e.LastCreatedEngine.getCaps().maxVertexAttribs,P=u.morphTargetManager;if(null!==P&&void 0!==P&&P.isUsingTextureForTargets)return;const R=P&&P.supportsPositions&&v,S=P&&P.supportsNormals&&U.NORMAL,d=P&&P.supportsTangents&&U.TANGENT,mz=P&&P.supportsUVs&&U.UV1,Z=P&&P.supportsUV2s&&U.UV2,A=P&&P.supportsColors&&U.VERTEXCOLOR;for(let U=0;U<g;U++)R&&z.push("position"+U),S&&z.push("normal"+U),d&&z.push("tangent"+U),mz&&z.push("uv_"+U),Z&&z.push("uv2_"+U),A&&z.push("color"+U),z.length>w&&J.d.Error("Cannot add more vertex attributes for mesh "+u.name)}}function A(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z.push("world0"),z.push("world1"),z.push("world2"),z.push("world3"),u&&(z.push("previousWorld0"),z.push("previousWorld1"),z.push("previousWorld2"),z.push("previousWorld3"))}function E(z,u){const U=z.morphTargetManager;z&&U&&u.setFloatArray("morphTargetInfluences",U.influences)}function C(z,u){u.bindToEffect(z,"Scene")}function r(z,u,U){u._needUVs=!0,u[U]=!0,z.optimizeUVAllocation&&z.getTextureMatrix().isIdentityAs3x2()?(u[U+"DIRECTUV"]=z.coordinatesIndex+1,u["MAINUV"+(z.coordinatesIndex+1)]=!0):u[U+"DIRECTUV"]=0}function M(z,u,U){const J=z.getTextureMatrix();u.Gf(U+"Matrix",J)}function T(z,u,U){U.BAKED_VERTEX_ANIMATION_TEXTURE&&U.INSTANCES&&z.push("bakedVertexAnimationSettingsInstanced")}function X(z,u,U){var J;if(u&&z&&(z.computeBonesUsingShaders&&u._bonesComputationForcedToCPU&&(z.computeBonesUsingShaders=!1),z.useBones&&z.computeBonesUsingShaders&&z.skeleton)){const v=z.skeleton;if(v.isUsingTextureForMatrices&&u.getUniformIndex("boneTextureWidth")>-1){const U=v.getTransformMatrixTexture(z);u.setTexture("boneSampler",U),u.setFloat("boneTextureWidth",4*(v.bones.length+1))}else{const f=v.getTransformMatrices(z);f&&(u.setMatrices("mBones",f),U&&z.Vz().prePassRenderer&&z.Vz().prePassRenderer.getIndex(2)&&(U.previousBones[z.uniqueId]||(U.previousBones[z.uniqueId]=f.slice()),u.setMatrices("mPreviousBones",U.previousBones[z.uniqueId]),J=f,U.previousBones[z.uniqueId].set(J)))}}}function h(z,u,U,J,v){let f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];z._bindLight(u,U,J,v,f)}function t(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const f=Math.min(u.lightSources.length,v);for(let g=0;g<f;g++){h(u.lightSources[g],g,z,U,"boolean"===typeof J?J:J.SPECULARTERM,u.receiveShadows)}}function V(z,u,U,J){U.NUM_BONE_INFLUENCERS>0&&(J.addCPUSkinningFallback(0,u),z.push("matricesIndices"),z.push("matricesWeights"),U.NUM_BONE_INFLUENCERS>4&&(z.push("matricesIndicesExtra"),z.push("matricesWeightsExtra")))}function L(z,u){(u.INSTANCES||u.THIN_INSTANCES)&&A(z,!!u.PREPASS_VELOCITY),u.INSTANCESCOLOR&&z.push("instanceColor")}function O(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=0;for(let f=0;f<U&&z["LIGHT"+f];f++)f>0&&(v=J+f,u.addFallback(v,"LIGHT"+f)),z.SHADOWS||(z["SHADOW"+f]&&u.addFallback(J,"SHADOW"+f),z["SHADOWPCF"+f]&&u.addFallback(J,"SHADOWPCF"+f),z["SHADOWPCSS"+f]&&u.addFallback(J,"SHADOWPCSS"+f),z["SHADOWPOISSON"+f]&&u.addFallback(J,"SHADOWPOISSON"+f),z["SHADOWESM"+f]&&u.addFallback(J,"SHADOWESM"+f),z["SHADOWCLOSEESM"+f]&&u.addFallback(J,"SHADOWCLOSEESM"+f));return v++}function x(z,u,U,J,v,f,g){let w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];g._areMiscDirty&&(g.LOGARITHMICDEPTH=U,g.POINTSIZE=J,g.FOG=v&&function(z,u){return u.fogEnabled&&z.applyFog&&0!==u.fogMode}(z,u),g.NONUNIFORMSCALING=z.nonUniformScaling,g.ALPHATEST=f,g.DECAL_AFTER_DETAIL=w)}function Q(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U._areLightsDirty)return U._needNormals;let g=0;const w={needNormals:U._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(z.lightsEnabled&&!f)for(const R of u.lightSources)if(K(z,u,R,g,U,J,w),g++,g===v)break;U.SPECULARTERM=w.specularEnabled,U.SHADOWS=w.shadowEnabled;for(let R=g;R<v;R++)void 0!==U["LIGHT"+R]&&(U["LIGHT"+R]=!1,U["HEMILIGHT"+R]=!1,U["POINTLIGHT"+R]=!1,U["DIRLIGHT"+R]=!1,U["SPOTLIGHT"+R]=!1,U["AREALIGHT"+R]=!1,U["SHADOW"+R]=!1,U["SHADOWCSM"+R]=!1,U["SHADOWCSMDEBUG"+R]=!1,U["SHADOWCSMNUM_CASCADES"+R]=!1,U["SHADOWCSMUSESHADOWMAXZ"+R]=!1,U["SHADOWCSMNOBLEND"+R]=!1,U["SHADOWCSM_RIGHTHANDED"+R]=!1,U["SHADOWPCF"+R]=!1,U["SHADOWPCSS"+R]=!1,U["SHADOWPOISSON"+R]=!1,U["SHADOWESM"+R]=!1,U["SHADOWCLOSEESM"+R]=!1,U["SHADOWCUBE"+R]=!1,U["SHADOWLOWQUALITY"+R]=!1,U["SHADOWMEDIUMQUALITY"+R]=!1);const P=z.getEngine().getCaps();return void 0===U.SHADOWFLOAT&&(w.needRebuild=!0),U.SHADOWFLOAT=w.shadowEnabled&&(P.textureFloatRender&&P.textureFloatLinearFiltering||P.textureHalfFloatRender&&P.textureHalfFloatLinearFiltering),U.LIGHTMAPEXCLUDED=w.lightmapMode,w.needRebuild&&U.rebuild(),w.needNormals}function K(z,u,U,J,v,f,w){switch(w.needNormals=!0,void 0===v["LIGHT"+J]&&(w.needRebuild=!0),v["LIGHT"+J]=!0,v["SPOTLIGHT"+J]=!1,v["HEMILIGHT"+J]=!1,v["POINTLIGHT"+J]=!1,v["DIRLIGHT"+J]=!1,v["AREALIGHT"+J]=!1,U.prepareLightSpecificDefines(v,J),v["LIGHT_FALLOFF_PHYSICAL"+J]=!1,v["LIGHT_FALLOFF_GLTF"+J]=!1,v["LIGHT_FALLOFF_STANDARD"+J]=!1,U.falloffType){case g.c.FALLOFF_GLTF:v["LIGHT_FALLOFF_GLTF"+J]=!0;break;case g.c.FALLOFF_PHYSICAL:v["LIGHT_FALLOFF_PHYSICAL"+J]=!0;break;case g.c.FALLOFF_STANDARD:v["LIGHT_FALLOFF_STANDARD"+J]=!0}if(f&&!U.sS.equalsFloats(0,0,0)&&(w.specularEnabled=!0),v["SHADOW"+J]=!1,v["SHADOWCSM"+J]=!1,v["SHADOWCSMDEBUG"+J]=!1,v["SHADOWCSMNUM_CASCADES"+J]=!1,v["SHADOWCSMUSESHADOWMAXZ"+J]=!1,v["SHADOWCSMNOBLEND"+J]=!1,v["SHADOWCSM_RIGHTHANDED"+J]=!1,v["SHADOWPCF"+J]=!1,v["SHADOWPCSS"+J]=!1,v["SHADOWPOISSON"+J]=!1,v["SHADOWESM"+J]=!1,v["SHADOWCLOSEESM"+J]=!1,v["SHADOWCUBE"+J]=!1,v["SHADOWLOWQUALITY"+J]=!1,v["SHADOWMEDIUMQUALITY"+J]=!1,u&&u.receiveShadows&&z.shadowsEnabled&&U.shadowEnabled){var P;const u=null!==(P=U.getShadowGenerator(z.activeCamera))&&void 0!==P?P:U.getShadowGenerator();if(u){const z=u.getShadowMap();z&&z.renderList&&z.renderList.length>0&&(w.shadowEnabled=!0,u.prepareDefines(v,J))}}U.lightmapMode!=g.c.LIGHTMAP_DEFAULT?(w.lightmapMode=!0,v["LIGHTMAPEXCLUDED"+J]=!0,v["LIGHTMAPNOSPECULAR"+J]=U.lightmapMode==g.c.LIGHTMAP_SHADOWSONLY):(v["LIGHTMAPEXCLUDED"+J]=!1,v["LIGHTMAPNOSPECULAR"+J]=!1)}function Y(z,u,U,J,v){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=function(z,u){let U=!1;if(z.activeCamera){const J=u.CAMERA_ORTHOGRAPHIC?1:0,v=u.CAMERA_PERSPECTIVE?1:0,f=1===z.activeCamera.mode?1:0,g=0===z.activeCamera.mode?1:0;(J^f||v^g)&&(u.CAMERA_ORTHOGRAPHIC=1===f,u.CAMERA_PERSPECTIVE=1===g,U=!0)}return U}(z,J);!1!==f&&(P=(0,w.h)(U,z,J)),J.DEPTHPREPASS!==!u.getColorWrite()&&(J.DEPTHPREPASS=!J.DEPTHPREPASS,P=!0),J.INSTANCES!==v&&(J.INSTANCES=v,P=!0),J.THIN_INSTANCES!==g&&(J.THIN_INSTANCES=g,P=!0),P&&J.markAsUnprocessed()}function p(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!u._areAttributesDirty&&u._needNormals===u._normals&&u._needUVs===u._uvs)return!1;u._normals=u._needNormals,u._uvs=u._needUVs,u.NORMAL=u._needNormals&&z.isVerticesDataPresent("normal"),u._needNormals&&z.isVerticesDataPresent("tangent")&&(u.TANGENT=!0);for(let w=1;w<=6;++w)u["UV"+w]=!!u._needUVs&&z.isVerticesDataPresent("uv".concat(1===w?"":w));if(U){const U=z.useVertexColors&&z.isVerticesDataPresent("color");u.VERTEXCOLOR=U,u.VERTEXALPHA=z.hasVertexAlpha&&U&&f}return z.isVerticesDataPresent("instanceColor")&&(z.hasInstances||z.hasThinInstances)&&(u.INSTANCESCOLOR=!0),J&&function(z,u){if(z.useBones&&z.computeBonesUsingShaders&&z.skeleton){u.NUM_BONE_INFLUENCERS=z.numBoneInfluencers;const U=void 0!==u.BONETEXTURE;if(z.skeleton.isUsingTextureForMatrices&&U)u.BONETEXTURE=!0;else{u.BonesPerMesh=z.skeleton.bones.length+1,u.BONETEXTURE=!U&&void 0;const J=z.Vz().prePassRenderer;if(J&&J.enabled){const U=-1===J.excludedSkinnedMesh.indexOf(z);u.BONES_VELOCITY_ENABLED=U}}}else u.NUM_BONE_INFLUENCERS=0,u.BonesPerMesh=0,void 0!==u.BONETEXTURE&&(u.BONETEXTURE=!1)}(z,u),v&&function(z,u){const U=z.morphTargetManager;U?(u.MORPHTARGETS_UV=U.supportsUVs&&u.UV1,u.MORPHTARGETS_UV2=U.supportsUV2s&&u.UV2,u.MORPHTARGETS_TANGENT=U.supportsTangents&&u.TANGENT,u.MORPHTARGETS_NORMAL=U.supportsNormals&&u.NORMAL,u.MORPHTARGETS_POSITION=U.supportsPositions,u.MORPHTARGETS_COLOR=U.supportsColors,u.MORPHTARGETTEXTURE_HASUVS=U.hasUVs,u.MORPHTARGETTEXTURE_HASUV2S=U.hasUV2s,u.MORPHTARGETTEXTURE_HASTANGENTS=U.hasTangents,u.MORPHTARGETTEXTURE_HASNORMALS=U.hasNormals,u.MORPHTARGETTEXTURE_HASPOSITIONS=U.hasPositions,u.MORPHTARGETTEXTURE_HASCOLORS=U.hasColors,u.NUM_MORPH_INFLUENCERS=U.numMaxInfluencers||U.numInfluencers,u.MORPHTARGETS=u.NUM_MORPH_INFLUENCERS>0,u.MORPHTARGETS_TEXTURE=U.isUsingTextureForTargets):(u.MORPHTARGETS_UV=!1,u.MORPHTARGETS_UV2=!1,u.MORPHTARGETS_TANGENT=!1,u.MORPHTARGETS_NORMAL=!1,u.MORPHTARGETS_POSITION=!1,u.MORPHTARGETS_COLOR=!1,u.MORPHTARGETTEXTURE_HASUVS=!1,u.MORPHTARGETTEXTURE_HASUV2S=!1,u.MORPHTARGETTEXTURE_HASTANGENTS=!1,u.MORPHTARGETTEXTURE_HASNORMALS=!1,u.MORPHTARGETTEXTURE_HASPOSITIONS=!1,u.MORPHTARGETTEXTURE_HAS_COLORS=!1,u.MORPHTARGETS=!1,u.NUM_MORPH_INFLUENCERS=0)}(z,u),g&&function(z,u){const U=z.bakedVertexAnimationManager;u.BAKED_VERTEX_ANIMATION_TEXTURE=!(!U||!U.isEnabled)}(z,u),!0}function N(z,u){if(z.activeCamera){const U=u.MULTIVIEW;u.MULTIVIEW=null!==z.activeCamera.outputRenderTarget&&z.activeCamera.outputRenderTarget.getViewCount()>1,u.MULTIVIEW!=U&&u.markAsUnprocessed()}}function D(z,u,U){const J=u.ORDER_INDEPENDENT_TRANSPARENCY,v=u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;u.ORDER_INDEPENDENT_TRANSPARENCY=z.useOrderIndependentTransparency&&U,u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!z.getEngine().getCaps().textureFloatLinearFiltering,J===u.ORDER_INDEPENDENT_TRANSPARENCY&&v===u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||u.markAsUnprocessed()}function c(z,u,U){const J=u.PREPASS;if(!u._arePrePassDirty)return;const v=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(z.prePassRenderer&&z.prePassRenderer.enabled&&U){u.PREPASS=!0,u.SCENE_MRT_COUNT=z.prePassRenderer.mrtCount,u.PREPASS_NORMAL_WORLDSPACE=z.prePassRenderer.generateNormalsInWorldSpace,u.PREPASS_COLOR=!0,u.PREPASS_COLOR_INDEX=0;for(let U=0;U<v.length;U++){const J=z.prePassRenderer.getIndex(v[U].type);-1!==J?(u[v[U].define]=!0,u[v[U].index]=J):u[v[U].define]=!1}}else{u.PREPASS=!1;for(let z=0;z<v.length;z++)u[v[z].define]=!1}u.PREPASS!=J&&(u.markAsUnprocessed(),u.markAsImageProcessingDirty())}function W(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];v&&v.push("Light"+z),f||(u.push("vLightData"+z,"vLightDiffuse"+z,"vLightSpecular"+z,"vLightDirection"+z,"vLightWidth"+z,"vLightHeight"+z,"vLightFalloff"+z,"vLightGround"+z,"lightMatrix"+z,"shadowsInfo"+z,"depthValues"+z),U.push("shadowTexture"+z),U.push("depthTexture"+z),u.push("viewFrustumZ"+z,"cascadeBlendFactor"+z,"lightSizeUVCorrection"+z,"depthCorrection"+z,"penumbraDarkness"+z,"frustumLengths"+z),J&&(U.push("projectionLightTexture"+z),u.push("textureProjectionMatrix"+z)),g&&U.push("iesLightTexture"+z))}function j(z,u,U){let J,v,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(z.uniformsNames){const g=z;J=g.uniformsNames,v=g.uniformBuffersNames,u=g.samplers,U=g.defines,f=g.maxSimultaneousLights||0}else J=z,u||(u=[]);for(let g=0;g<f&&U["LIGHT"+g];g++)W(g,J,u,U["PROJECTEDLIGHTTEXTURE"+g],v,!1,U["IESLIGHTTEXTURE"+g]);U.NUM_MORPH_INFLUENCERS&&(J.push("morphTargetInfluences"),J.push("morphTargetCount")),U.BAKED_VERTEX_ANIMATION_TEXTURE&&(J.push("bakedVertexAnimationSettings"),J.push("bakedVertexAnimationTextureSizeInverted"),J.push("bakedVertexAnimationTime"),u.push("bakedVertexAnimationTexture"))}},13221:(z,u,U)=>{U.d(u,{c:()=>f});var J=U(12914),v=U(13224);class f extends v.e{constructor(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(z,u,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new J.Matrix,this._storeEffectOnSubMeshes=U}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(z,u){return!!z&&(!this._storeEffectOnSubMeshes||(!z.cf||0===z.cf.length||this.isReadyForSubMesh(z,z.cf[0],u)))}_isReadyForSubMesh(z){const u=z.materialDefines;return!(this.checkReadyOnEveryCall||!z.effect||!u||u._renderId!==this.Vz().getRenderId())}bindOnlyWorldMatrix(z){this._activeEffect.setMatrix("world",z)}bindOnlyNormalMatrix(z){this._activeEffect.setMatrix("normalMatrix",z)}bind(z,u){u&&this.bindForSubMesh(z,u,u.cf[0])}_afterBind(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;super._afterBind(z,u,U),this.Vz()._cachedEffect=u,U?U._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return U._drawWrapper._forceRebindOnNextCall||z.isCachedMaterialInvalid(this,u,J)}dispose(z,u,U){this._activeEffect=void 0,super.dispose(z,u,U)}}},13252:(z,u,U)=>{U.d(u,{d:()=>w,e:()=>P});var J=U(12899),v=U(12914),f=U(12901);class g{static extractMinAndMaxIndexed(z,u,U,J,v,f){for(let g=U;g<U+J;g++){const U=3*u[g],J=z[U],w=z[U+1],P=z[U+2];v.minimizeInPlaceFromFloats(J,w,P),f.maximizeInPlaceFromFloats(J,w,P)}}static extractMinAndMax(z,u,U,J,v,f){for(let g=u,w=u*J;g<u+U;g++,w+=J){const u=z[w],U=z[w+1],J=z[w+2];v.minimizeInPlaceFromFloats(u,U,J),f.maximizeInPlaceFromFloats(u,U,J)}}}function w(z,u,U,J){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const w=new v.Eu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P=new v.Eu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g.extractMinAndMaxIndexed(z,u,U,J,w,P),f&&(w.x-=w.x*f.x+f.y,w.y-=w.y*f.x+f.y,w.z-=w.z*f.x+f.y,P.x+=P.x*f.x+f.y,P.y+=P.y*f.x+f.y,P.z+=P.z*f.x+f.y),{minimum:w,maximum:P}}function P(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4?arguments[4]:void 0;const w=new v.Eu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),P=new v.Eu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return f||(f=3),g.extractMinAndMax(z,u,U,f,w,P),J&&(w.x-=w.x*J.x+J.y,w.y-=w.y*J.x+J.y,w.z-=w.z*J.x+J.y,P.x+=P.x*J.x+J.y,P.y+=P.y*J.x+J.y,P.z+=P.z*J.x+J.y),{minimum:w,maximum:P}}(0,J.b)([f.g.filter((function(){for(var z=arguments.length,u=new Array(z),U=0;U<z;U++)u[U]=arguments[U];let[J,v]=u;return!Array.isArray(J)&&!Array.isArray(v)}))],g,"extractMinAndMaxIndexed",null),(0,J.b)([f.g.filter((function(){for(var z=arguments.length,u=new Array(z),U=0;U<z;U++)u[U]=arguments[U];let[J]=u;return!Array.isArray(J)}))],g,"extractMinAndMax",null)},13226:(z,u,U)=>{U.d(u,{d:()=>P});var J=U(13e3),v=U(13231),f=U(13238),g=U(13252),w=U(13035);class P{get materialDefines(){var z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(z=this._getDrawWrapper())||void 0===z?void 0:z.defines}set materialDefines(z){var u;(null!==(u=this._mainDrawWrapperOverride)&&void 0!==u?u:this._getDrawWrapper(void 0,!0)).defines=z}_getDrawWrapper(z){var u;let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=null!==(u=z)&&void 0!==u?u:this._engine.currentRenderPassId;let J=this._drawWrappers[z];return!J&&U&&(this._drawWrappers[z]=J=new w.d(this._mesh.Vz().getEngine())),J}_removeDrawWrapper(z){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var U;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(U=this._drawWrappers[z])||void 0===U||U.dispose(u));this._drawWrappers[z]=void 0}get effect(){var z,u;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(z=null===(u=this._getDrawWrapper())||void 0===u?void 0:u.effect)&&void 0!==z?z:null}get _drawWrapper(){var z;return null!==(z=this._mainDrawWrapperOverride)&&void 0!==z?z:this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(z){this._mainDrawWrapperOverride=z}setEffect(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=this._drawWrapper;v.setEffect(z,u,J),void 0!==U&&(v.materialContext=U),z||(v.defines=null,v.materialContext=void 0)}resetDrawCache(z){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==z)return void this._removeDrawWrapper(z,!0,u);for(const z of this._drawWrappers)null===z||void 0===z||z.dispose(u)}this._drawWrappers=[]}static AddToMesh(z,u,U,J,v,f,g){return new P(z,u,U,J,v,f,g,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(z,u,U,J,v,f,g){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],P=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=z,this.verticesStart=u,this.verticesCount=U,this.indexStart=J,this.indexCount=v,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=f,this._renderingMesh=g||f,P&&f.cf.push(this),this._engine=this._mesh.Vz().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=f.cf.length-1,w&&(this.refreshBoundingInfo(),f.af(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(z){return this._boundingInfo=z,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const z=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return z||this._renderingMesh}jz(){var z;let u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U=null!==(z=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==z?z:this._renderingMesh.material;if(!U)return u&&this._mesh.Vz()._hasDefaultMaterial?this._mesh.Vz().defaultMaterial:null;if(this._isMultiMaterial(U)){const z=U.getSubMaterial(this.materialIndex);return this._currentMaterial!==z&&(this._currentMaterial=z,this.resetDrawCache()),z}return U}_isMultiMaterial(z){return void 0!==z.getSubMaterial}refreshBoundingInfo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.nf)return this;if(z||(z=this._renderingMesh.getVerticesData(J.g.PositionKind)),!z)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const u=this._renderingMesh.lf();let U;if(0===this.indexStart&&this.indexCount===u.length){const z=this._renderingMesh.getBoundingInfo();U={minimum:z.minimum.clone(),maximum:z.maximum.clone()}}else U=(0,g.d)(z,u,this.indexStart,this.indexCount,this._renderingMesh.nf.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(U.minimum,U.maximum):this._boundingInfo=new f.b(U.minimum,U.maximum),this}_checkCollision(z){return this.getBoundingInfo()._checkCollision(z)}updateBoundingInfo(z){let u=this.getBoundingInfo();return u||(this.refreshBoundingInfo(),u=this.getBoundingInfo()),u&&u.update(z),this}isInFrustum(z){const u=this.getBoundingInfo();return!!u&&u.isInFrustum(z,this._mesh.Lm)}isCompletelyInFrustum(z){const u=this.getBoundingInfo();return!!u&&u.isCompletelyInFrustum(z)}render(z){return this._renderingMesh.render(this,z,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(z,u){if(!this._linesIndexBuffer){const U=6*Math.floor(this.indexCount/3),J=this.verticesStart+this.verticesCount>65535?new Uint32Array(U):new Uint16Array(U);let v=0;if(0===z.length)for(let z=this.indexStart;z<this.indexStart+this.indexCount;z+=3)J[v++]=z,J[v++]=z+1,J[v++]=z+1,J[v++]=z+2,J[v++]=z+2,J[v++]=z;else for(let u=this.indexStart;u<this.indexStart+this.indexCount;u+=3)J[v++]=z[u],J[v++]=z[u+1],J[v++]=z[u+1],J[v++]=z[u+2],J[v++]=z[u+2],J[v++]=z[u];this._linesIndexBuffer=u.createIndexBuffer(J),this._linesIndexCount=J.length}return this._linesIndexBuffer}canIntersects(z){const u=this.getBoundingInfo();return!!u&&z.intersectsBox(u.boundingBox)}intersects(z,u,U,J,v){const f=this.jz();if(!f)return null;let g=3,w=!1;switch(f.fillMode){case 3:case 5:case 6:case 8:return null;case 7:g=1,w=!0}return 4===f.fillMode?U.length?this._intersectLines(z,u,U,this._mesh.intersectionThreshold,J):this._intersectUnIndexedLines(z,u,U,this._mesh.intersectionThreshold,J):!U.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(z,u,U,J,v):this._intersectTriangles(z,u,U,g,w,J,v)}_intersectLines(z,u,U,J,f){let g=null;for(let w=this.indexStart;w<this.indexStart+this.indexCount;w+=2){const P=u[U[w]],R=u[U[w+1]],S=z.intersectionSegment(P,R,J);if(!(S<0)&&((f||!g||S<g.distance)&&(g=new v.b(null,null,S),g.faceId=w/2,f)))break}return g}_intersectUnIndexedLines(z,u,U,J,f){let g=null;for(let w=this.verticesStart;w<this.verticesStart+this.verticesCount;w+=2){const U=u[w],P=u[w+1],R=z.intersectionSegment(U,P,J);if(!(R<0)&&((f||!g||R<g.distance)&&(g=new v.b(null,null,R),g.faceId=w/2,f)))break}return g}_intersectTriangles(z,u,U,J,v,f,g){let w=null,P=-1;for(let R=this.indexStart;R<this.indexStart+this.indexCount-(3-J);R+=J){P++;const J=U[R],S=U[R+1],d=U[R+2];if(v&&4294967295===d){R+=2;continue}const mz=u[J],Z=u[S],A=u[d];if(!mz||!Z||!A)continue;if(g&&!g(mz,Z,A,z,J,S,d))continue;const E=z.intersectsTriangle(mz,Z,A);if(E){if(E.distance<0)continue;if((f||!w||E.distance<w.distance)&&(w=E,w.faceId=P,f))break}}return w}_intersectUnIndexedTriangles(z,u,U,J,v){let f=null;for(let g=this.verticesStart;g<this.verticesStart+this.verticesCount;g+=3){const U=u[g],w=u[g+1],P=u[g+2];if(v&&!v(U,w,P,z,-1,-1,-1))continue;const R=z.intersectsTriangle(U,w,P);if(R){if(R.distance<0)continue;if((J||!f||R.distance<f.distance)&&(f=R,f.faceId=g/3,J))break}}return f}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(z,u){const U=new P(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,z,u,!1);if(!this.IsGlobal){const z=this.getBoundingInfo();if(!z)return U;U._boundingInfo=new f.b(z.minimum,z.maximum)}return U}dispose(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Vz().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this._mesh.cf.indexOf(this);this._mesh.cf.splice(u,1),this.resetDrawCache(void 0,z)}getClassName(){return"SubMesh"}static CreateFromIndices(z,u,U,J,v){let f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=Number.MAX_VALUE,w=-Number.MAX_VALUE;const R=(v||J).lf();for(let P=u;P<u+U;P++){const z=R[P];z<g&&(g=z),z>w&&(w=z)}return new P(z,g,w-g+1,u,U,J,v,f)}}}}]);