"use strict";(self.u4k1rqylno=self.u4k1rqylno||[]).push([[24],{12053:(e,E,H)=>{H.d(E,{b:()=>N});class N{constructor(e,E,H){this.bu=e,this.bv=E,this.distance=H,this.faceId=0,this.subMeshId=0}}},12063:(e,E,H)=>{H.d(E,{b:()=>P});var N=H(11753),u=H(11738),z=H(11746);class P{constructor(e,E,H){this.vectors=(0,N.d)(8,u.jE.Zero),this.center=u.jE.Zero(),this.centerWorld=u.jE.Zero(),this.extendSize=u.jE.Zero(),this.extendSizeWorld=u.jE.Zero(),this.directions=(0,N.d)(3,u.jE.Zero),this.vectorsWorld=(0,N.d)(8,u.jE.Zero),this.minimumWorld=u.jE.Zero(),this.maximumWorld=u.jE.Zero(),this.minimum=u.jE.Zero(),this.maximum=u.jE.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,E,H)}reConstruct(e,E,H){const N=e.x,z=e.y,P=e.z,M=E.x,D=E.y,A=E.z,C=this.vectors;this.minimum.VM(N,z,P),this.maximum.VM(M,D,A),C[0].VM(N,z,P),C[1].VM(M,D,A),C[2].VM(M,z,P),C[3].VM(N,D,P),C[4].VM(N,z,A),C[5].VM(M,D,P),C[6].VM(N,D,A),C[7].VM(M,z,A),E.addToRef(e,this.center).scaleInPlace(.5),E.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=H||u.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(e){const E=P._TmpVector3,H=this.maximum.subtractToRef(this.minimum,E[0]),N=H.length();H.normalizeFromLength(N);const u=N*e,z=H.scaleInPlace(.5*u),M=this.center.subtractToRef(z,E[1]),D=this.center.addToRef(z,E[2]);return this.reConstruct(M,D,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){const E=this.minimumWorld,H=this.maximumWorld,N=this.directions,z=this.vectorsWorld,P=this.vectors;if(e.isIdentity()){E.P(this.minimum),H.P(this.maximum);for(let e=0;e<8;++e)z[e].P(P[e]);this.extendSizeWorld.P(this.extendSize),this.centerWorld.P(this.center)}else{E.jM(Number.MAX_VALUE),H.jM(-Number.MAX_VALUE);for(let N=0;N<8;++N){const M=z[N];u.jE.TransformCoordinatesToRef(P[N],e,M),E.minimizeInPlace(M),H.maximizeInPlace(M)}H.subtractToRef(E,this.extendSizeWorld).scaleInPlace(.5),H.addToRef(E,this.centerWorld).scaleInPlace(.5)}u.jE.FromArrayToRef(e.m,0,N[0]),u.jE.FromArrayToRef(e.m,4,N[1]),u.jE.FromArrayToRef(e.m,8,N[2]),this._worldMatrix=e}isInFrustum(e){return P.IsInFrustum(this.vectorsWorld,e)}isCompletelyInFrustum(e){return P.IsCompletelyInFrustum(this.vectorsWorld,e)}intersectsPoint(e){const E=this.minimumWorld,H=this.maximumWorld,N=E.x,u=E.y,P=E.z,M=H.x,D=H.y,A=H.z,C=e.x,i=e.y,V=e.z,U=-z.d;return!(M-C<U||U>C-N)&&(!(D-i<U||U>i-u)&&!(A-V<U||U>V-P))}intersectsSphere(e){return P.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)}intersectsMinMax(e,E){const H=this.minimumWorld,N=this.maximumWorld,u=H.x,z=H.y,P=H.z,M=N.x,D=N.y,A=N.z,C=e.x,i=e.y,V=e.z,U=E.x,j=E.y,F=E.z;return!(M<C||u>U)&&(!(D<i||z>j)&&!(A<V||P>F))}dispose(){var e,E;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(E=this._drawWrapperBack)||void 0===E||E.dispose()}static Intersects(e,E){return e.intersectsMinMax(E.minimumWorld,E.maximumWorld)}static IntersectsSphere(e,E,H,N){const z=P._TmpVector3[0];u.jE.ClampToRef(H,e,E,z);return u.jE.DistanceSquared(H,z)<=N*N}static IsCompletelyInFrustum(e,E){for(let H=0;H<6;++H){const N=E[H];for(let E=0;E<8;++E)if(N.dotCoordinate(e[E])<0)return!1}return!0}static IsInFrustum(e,E){for(let H=0;H<6;++H){let N=!0;const u=E[H];for(let E=0;E<8;++E)if(u.dotCoordinate(e[E])>=0){N=!1;break}if(N)return!1}return!0}}P._TmpVector3=(0,N.d)(3,u.jE.Zero)},12057:(e,E,H)=>{H.d(E,{b:()=>i});var N=H(11753),u=H(11738),z=H(12063),P=H(12069);const M={min:0,max:0},D={min:0,max:0},A=(e,E,H)=>{const N=u.jE.Dot(E.centerWorld,e),z=Math.abs(u.jE.Dot(E.directions[0],e))*E.extendSize.x+Math.abs(u.jE.Dot(E.directions[1],e))*E.extendSize.y+Math.abs(u.jE.Dot(E.directions[2],e))*E.extendSize.z;H.min=N-z,H.max=N+z},C=(e,E,H)=>(A(e,E,M),A(e,H,D),!(M.min>D.max||D.min>M.max));class i{constructor(e,E,H){this._isLocked=!1,this.boundingBox=new z.b(e,E,H),this.boundingSphere=new P.c(e,E,H)}reConstruct(e,E,H){this.boundingBox.reConstruct(e,E,H),this.boundingSphere.reConstruct(e,E,H)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e}update(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))}centerOn(e,E){const H=i._TmpVector3[0].P(e).JC(E),N=i._TmpVector3[1].P(e).addInPlace(E);return this.boundingBox.reConstruct(H,N,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(H,N,this.boundingBox.getWorldMatrix()),this}encapsulate(e){const E=u.jE.Minimize(this.minimum,e),H=u.jE.Maximize(this.maximum,e);return this.reConstruct(E,H,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(e){const E=u.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(E);const H=u.TmpVectors.jE[0];return u.jE.TransformCoordinatesToRef(e.boundingBox.minimumWorld,E,H),this.encapsulate(H),u.jE.TransformCoordinatesToRef(e.boundingBox.maximumWorld,E,H),this.encapsulate(H),this}scale(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this}isInFrustum(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===E||3===E)&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;return!(1!==E&&3!==E)||this.boundingBox.isInFrustum(e)}get diagonalLength(){const e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,i._TmpVector3[0]).length()}isCompletelyInFrustum(e){return this.boundingBox.isCompletelyInFrustum(e)}_checkCollision(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))}intersects(e,E){if(!P.c.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!z.b.Intersects(this.boundingBox,e.boundingBox))return!1;if(!E)return!0;const H=this.boundingBox,N=e.boundingBox;return!!C(H.directions[0],H,N)&&(!!C(H.directions[1],H,N)&&(!!C(H.directions[2],H,N)&&(!!C(N.directions[0],H,N)&&(!!C(N.directions[1],H,N)&&(!!C(N.directions[2],H,N)&&(!!C(u.jE.Cross(H.directions[0],N.directions[0]),H,N)&&(!!C(u.jE.Cross(H.directions[0],N.directions[1]),H,N)&&(!!C(u.jE.Cross(H.directions[0],N.directions[2]),H,N)&&(!!C(u.jE.Cross(H.directions[1],N.directions[0]),H,N)&&(!!C(u.jE.Cross(H.directions[1],N.directions[1]),H,N)&&(!!C(u.jE.Cross(H.directions[1],N.directions[2]),H,N)&&(!!C(u.jE.Cross(H.directions[2],N.directions[0]),H,N)&&(!!C(u.jE.Cross(H.directions[2],N.directions[1]),H,N)&&!!C(u.jE.Cross(H.directions[2],N.directions[2]),H,N))))))))))))))}}i._TmpVector3=(0,N.d)(2,u.jE.Zero)},12069:(e,E,H)=>{H.d(E,{c:()=>z});var N=H(11753),u=H(11738);class z{constructor(e,E,H){this.center=u.jE.Zero(),this.centerWorld=u.jE.Zero(),this.minimum=u.jE.Zero(),this.maximum=u.jE.Zero(),this.reConstruct(e,E,H)}reConstruct(e,E,H){this.minimum.P(e),this.maximum.P(E);const N=u.jE.Distance(e,E);E.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*N,this._update(H||u.Matrix.IdentityReadOnly)}scale(e){const E=this.radius*e,H=z._TmpVector3,N=H[0].jM(E),u=this.center.subtractToRef(N,H[1]),P=this.center.addToRef(N,H[2]);return this.reConstruct(u,P,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(e){if(e.isIdentity())this.centerWorld.P(this.center),this.radiusWorld=this.radius;else{u.jE.TransformCoordinatesToRef(this.center,e,this.centerWorld);const E=z._TmpVector3[0];u.jE.TransformNormalFromFloatsToRef(1,1,1,e,E),this.radiusWorld=Math.max(Math.abs(E.x),Math.abs(E.y),Math.abs(E.z))*this.radius}}isInFrustum(e){const E=this.centerWorld,H=this.radiusWorld;for(let N=0;N<6;N++)if(e[N].dotCoordinate(E)<=-H)return!1;return!0}isCenterInFrustum(e){const E=this.centerWorld;for(let H=0;H<6;H++)if(e[H].dotCoordinate(E)<0)return!1;return!0}intersectsPoint(e){const E=u.jE.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<E)}static Intersects(e,E){const H=u.jE.DistanceSquared(e.centerWorld,E.centerWorld),N=e.radiusWorld+E.radiusWorld;return!(N*N<H)}static CreateFromCenterAndRadius(e,E,H){this._TmpVector3[0].P(e),this._TmpVector3[1].VM(0,0,E),this._TmpVector3[2].P(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].JC(this._TmpVector3[1]);const N=new z(this._TmpVector3[0],this._TmpVector3[2]);return N._worldMatrix=H||u.Matrix.Identity(),N}}z._TmpVector3=(0,N.d)(3,u.jE.Zero)},12085:(e,E,H)=>{function N(e){-1===e.indexOf("vClipPlane")&&e.push("vClipPlane"),-1===e.indexOf("vClipPlane2")&&e.push("vClipPlane2"),-1===e.indexOf("vClipPlane3")&&e.push("vClipPlane3"),-1===e.indexOf("vClipPlane4")&&e.push("vClipPlane4"),-1===e.indexOf("vClipPlane5")&&e.push("vClipPlane5"),-1===e.indexOf("vClipPlane6")&&e.push("vClipPlane6")}function u(e,E,H){const N=!!(e.clipPlane??E.clipPlane),u=!!(e.clipPlane2??E.clipPlane2),z=!!(e.clipPlane3??E.clipPlane3),P=!!(e.clipPlane4??E.clipPlane4),M=!!(e.clipPlane5??E.clipPlane5),D=!!(e.clipPlane6??E.clipPlane6);N&&H.push("#define CLIPPLANE"),u&&H.push("#define CLIPPLANE2"),z&&H.push("#define CLIPPLANE3"),P&&H.push("#define CLIPPLANE4"),M&&H.push("#define CLIPPLANE5"),D&&H.push("#define CLIPPLANE6")}function z(e,E,H){let N=!1;const u=!!(e.clipPlane??E.clipPlane),z=!!(e.clipPlane2??E.clipPlane2),P=!!(e.clipPlane3??E.clipPlane3),M=!!(e.clipPlane4??E.clipPlane4),D=!!(e.clipPlane5??E.clipPlane5),A=!!(e.clipPlane6??E.clipPlane6);return H.CLIPPLANE!==u&&(H.CLIPPLANE=u,N=!0),H.CLIPPLANE2!==z&&(H.CLIPPLANE2=z,N=!0),H.CLIPPLANE3!==P&&(H.CLIPPLANE3=P,N=!0),H.CLIPPLANE4!==M&&(H.CLIPPLANE4=M,N=!0),H.CLIPPLANE5!==D&&(H.CLIPPLANE5=D,N=!0),H.CLIPPLANE6!==A&&(H.CLIPPLANE6=A,N=!0),N}function P(e,E,H){let N=E.clipPlane??H.clipPlane;M(e,"vClipPlane",N),N=E.clipPlane2??H.clipPlane2,M(e,"vClipPlane2",N),N=E.clipPlane3??H.clipPlane3,M(e,"vClipPlane3",N),N=E.clipPlane4??H.clipPlane4,M(e,"vClipPlane4",N),N=E.clipPlane5??H.clipPlane5,M(e,"vClipPlane5",N),N=E.clipPlane6??H.clipPlane6,M(e,"vClipPlane6",N)}function M(e,E,H){H&&e.setFloat4(E,H.normal.x,H.normal.y,H.normal.z,H.d)}H.d(E,{d:()=>N,f:()=>P,h:()=>z,j:()=>u})},12042:(e,E,H)=>{H.d(E,{d:()=>N});class N{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(e,E){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(E)}addCPUSkinningFallback(e,E){this._mesh=E,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(e,E){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),E._bonesComputationForcedToCPU=!0;const H=this._mesh.fe();for(let e=0;e<H.meshes.length;e++){const N=H.meshes[e];if(N.material){if(N.computeBonesUsingShaders&&0!==N.numBoneInfluencers)if(N.material.getEffect()===E)N.computeBonesUsingShaders=!1;else if(N.NM)for(const e of N.NM){if(e.effect===E){N.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&N.computeBonesUsingShaders&&N.numBoneInfluencers>0&&(N.computeBonesUsingShaders=!1)}}else{const E=this._defines[this._currentRank];if(E)for(let H=0;H<E.length;H++)e=e.replace("#define "+E[H],"");this._currentRank++}return e}}},12047:(e,E,H)=>{H.d(E,{e:()=>h});var N=H(11717),u=H(11723),z=H(11532),P=H(11541),M=H(11579),D=H(12051),A=H(11986),C=H(11548),i=H(11796),V=H(11851),U=H(11776);class j{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(e){this._func=e}get funcRef(){return this._funcRef}set funcRef(e){this._funcRef=e}get funcMask(){return this._funcMask}set funcMask(e){this._funcMask=e}get opStencilFail(){return this._opStencilFail}set opStencilFail(e){this._opStencilFail=e}get opDepthFail(){return this._opDepthFail}set opDepthFail(e){this._opDepthFail=e}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(e){this._opStencilDepthPass=e}get mask(){return this._mask}set mask(e){this._mask=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}getClassName(){return"MaterialStencilState"}copyTo(e){U.d.Clone((()=>e),this)}serialize(){return U.d.Serialize(this)}parse(e,E,H){U.d.Parse((()=>this),e,E,H)}}(0,N.e)([(0,u.S)()],j.prototype,"func",null),(0,N.e)([(0,u.S)()],j.prototype,"funcRef",null),(0,N.e)([(0,u.S)()],j.prototype,"funcMask",null),(0,N.e)([(0,u.S)()],j.prototype,"opStencilFail",null),(0,N.e)([(0,u.S)()],j.prototype,"opDepthFail",null),(0,N.e)([(0,u.S)()],j.prototype,"opStencilDepthPass",null),(0,N.e)([(0,u.S)()],j.prototype,"mask",null),(0,N.e)([(0,u.S)()],j.prototype,"enabled",null);var F=H(12080);class h{get _supportGlowLayer(){return!1}set _glowModeEnabled(e){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(e){if(this._alpha===e)return;const E=this._alpha;this._alpha=e,1!==E&&1!==e||this.vA(h.MiscDirtyFlag+h.PrePassDirtyFlag)}get alpha(){return this._alpha}set iM(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.vA(h.TextureDirtyFlag))}get iM(){return this._backFaceCulling}set cullBackFaces(e){this._cullBackFaces!==e&&(this._cullBackFaces=e,this.vA(h.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(e){this._blockDirtyMechanism!==e&&(this._blockDirtyMechanism=e,e||this.Li())}atomicMaterialsUpdate(e){this.blockDirtyMechanism=!0;try{e(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(e){this._onDisposeObserver&&this.cP.remove(this._onDisposeObserver),this._onDisposeObserver=this.cP.add(e)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new P.d),this._onBindObservable}set onBind(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new P.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new P.d),this._onEffectCreatedObservable}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.vA(h.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.vA(h.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(e){this.fillMode=e?h.WireFrameFillMode:h.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(e){this.fillMode=e?h.PointFillMode:h.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(e){this._fillMode!==e&&(this._fillMode=e,this.vA(h.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(e){const E=this.fe().getEngine().getCaps().fragmentDepthSupported;e&&!E&&C.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=e&&E,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(e){this._drawWrapper=e}constructor(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.cP=new P.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.nP=new j,this._useUBO=!1,this._fillMode=h.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=e;const u=E||M.d.LastCreatedScene;u&&(this._scene=u,this._dirtyCallbacks={},this._forceGLSL=N,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=e||z.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new V.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new A.d(this._scene.getEngine(),void 0,void 0,e),this._useUBO=this.fe().getEngine().supportsUniformBuffers,this._createUniformBuffer(),H||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),h.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var e;const E=this.fe().getEngine();null===(e=this._uniformBuffer)||void 0===e||e.dispose(),E.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new A.d(E,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new A.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(e){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Li(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Li(),this.checkReadyOnlyOnce=!1}isReady(e,E){return!0}isReadyForSubMesh(e,E,H){const N=E.materialDefines;return!!N&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}fe(){return this._scene}_getEffectiveOrientation(e){return null!==this.sideOrientation?this.sideOrientation:e.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===h.MATERIAL_ALPHABLEND||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===h.MATERIAL_ALPHATEST||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===h.MATERIAL_OPAQUE||this._transparencyMode===h.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsBlend:e.visibility<1||!this._disableAlphaBlending&&(e.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(e){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Li(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E=this.fe().meshes;for(const H of E)if(H.NM)for(const E of H.NM)if(E.Te()===this)for(const H of E._drawWrappers)H&&this._materialContext===H.materialContext&&(H._wasPreviouslyReady=!1,H._wasPreviouslyUsingInstances=null,H._forceRebindOnNextCall=e);e&&this.vA(h.AllDirtyFlag)}_preBind(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.getEngine(),N=(null==E?this.sideOrientation:E)===h.ClockWiseSideOrientation;return H.enableEffect(e||this._getDrawWrapper()),H.setState(this.iM,this.zOffset,!1,N,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.nP,this.zOffsetUnits),N}bind(e,E){}buildUniformLayout(){const e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(8,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(e,E,H){const N=H._drawWrapper;this._eventInfo.subMesh=H,this._callbackPluginEventBindForSubMesh(this._eventInfo),N._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(e){}bindView(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.fe().getViewMatrix())}bindViewProjection(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.fe().getTransformMatrix()),e.setMatrix("projection",this.fe().getProjectionMatrix()))}bindEyePosition(e,E){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,E)}_afterBind(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&E&&(this._needToBindSceneUbo=!1,(0,F.n)(E,this.fe().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){const e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){const e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(0!==this.depthFunction){const e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(e){return null}_clonePlugins(e,E){const H={};if(this._serializePlugins(H),h._ParsePlugins(H,e,this._scene,E),this.pluginManager)for(const N of this.pluginManager._plugins){const E=e.pluginManager.getPlugin(N.name);E&&N.copyTo(E)}}getBindedMeshes(){if(this.meshMap){const e=[];for(const E in this.meshMap){const H=this.meshMap[E];H&&e.push(H)}return e}return this._scene.meshes.filter((e=>e.material===this))}forceCompilation(e,E,H,N){const u={clipPlane:!1,useInstances:!1,...H},z=this.fe(),P=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const M=()=>{if(!this._scene||!this._scene.getEngine())return;const H=z.clipPlane;if(u.clipPlane&&(z.clipPlane=new i.b(0,0,0,1)),this._storeEffectOnSubMeshes){let H=!0,z=null;if(e.NM){const E=new D.e(0,0,0,0,0,e,void 0,!1,!1);E.materialDefines&&(E.materialDefines._renderId=-1),this.isReadyForSubMesh(e,E,u.useInstances)||(E.effect&&E.effect.getCompilationError()&&E.effect.allFallbacksProcessed()?z=E.effect.getCompilationError():(H=!1,setTimeout(M,16)))}H&&(this.allowShaderHotSwapping=P,z&&N&&N(z),E&&E(this))}else this.isReady()?(this.allowShaderHotSwapping=P,E&&E(this)):setTimeout(M,16);u.clipPlane&&(z.clipPlane=H)};M()}async forceCompilationAsync(e,E){return await new Promise(((H,N)=>{this.forceCompilation(e,(()=>{H()}),E,(e=>{N(e)}))}))}vA(e){this.fe().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(h._DirtyCallbackArray.length=0,e&h.ImageProcessingDirtyFlag&&h._DirtyCallbackArray.push(h._ImageProcessingDirtyCallBack),e&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),e&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),e&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),e&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),e&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),e&h.PrePassDirtyFlag&&h._DirtyCallbackArray.push(h._PrePassDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.fe().resetCachedMaterial())}resetDrawCache(){const e=this.fe().meshes;for(const E of e)if(E.NM)for(const e of E.NM)e.Te()===this&&e.resetDrawCache()}_markAllSubMeshesAsDirty(e){const E=this.fe();if(E.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const H=E.meshes;for(const N of H)if(N.NM)for(const H of N.NM){if((H.Te()||(E._hasDefaultMaterial?E.defaultMaterial:null))===this)for(const E of H._drawWrappers)E&&E.defines&&E.defines.markAllAsDirty&&this._materialContext===E.materialContext&&e(E.defines)}}_markScenePrePassDirty(){if(this.fe().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const e=this.fe().enablePrePassRenderer();e&&e.vA()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(h._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(h._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const e=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.cP.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(e)}))}}setPrePassRenderer(e){return!1}dispose(e,E,H){const N=this.fe();if(N.stopAnimation(this),N.freeProcessedMaterials(),N.removeMaterial(this),this._eventInfo.forceDisposeTextures=E,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const e=this._parentContainer.materials.indexOf(this);e>-1&&this._parentContainer.materials.splice(e,1),this._parentContainer=null}if(!0!==H)if(this.meshMap)for(const u in this.meshMap){const e=this.meshMap[u];this._disposeMeshResources(e)}else{const e=N.meshes;for(const E of e)this._disposeMeshResources(E)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.cP.notifyObservers(this),this.cP.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(e){if(!e)return;const E=e.AM,H=e._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(e.NM&&H)for(const u of e.NM){const e=u._drawWrappers;for(let z=0;z<e.length;z++){var N;const P=null===(N=e[z])||void 0===N?void 0:N.effect;if(!P)continue;H[z]===this&&(null===E||void 0===E||E._releaseVertexArrayObject(P),u._removeDrawWrapper(z,!0,!0))}}}else null===E||void 0===E||E._releaseVertexArrayObject(this._drawWrapper.effect);e.material!==this||e.sourceMesh||(e.material=null)}serialize(){const e=U.d.Serialize(this);return e.nP=this.nP.serialize(),e.uniqueId=this.uniqueId,this._serializePlugins(e),e}_serializePlugins(e){if(e.plugins={},this.pluginManager)for(const E of this.pluginManager._plugins)E.doNotSerialize||(e.plugins[E.getClassName()]=E.serialize())}static Parse(e,E,H){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return C.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";const N=z.Tools.Instantiate(e.customType).Parse(e,E,H);return N._loadedUniqueId=e.uniqueId,N}static _ParsePlugins(e,E,H,N){if(e.plugins)for(const M in e.plugins){var u,P;const D=e.plugins[M];let A=null===(u=E.pluginManager)||void 0===u?void 0:u.getPlugin(D.name);if(!A){const e=z.Tools.Instantiate("BABYLON."+M);e&&(A=new e(E))}null===(P=A)||void 0===P||P.parse(D,H,N)}}}h.TriangleFillMode=0,h.WireFrameFillMode=1,h.PointFillMode=2,h.PointListDrawMode=3,h.LineListDrawMode=4,h.LineLoopDrawMode=5,h.LineStripDrawMode=6,h.TriangleStripDrawMode=7,h.TriangleFanDrawMode=8,h.ClockWiseSideOrientation=0,h.CounterClockWiseSideOrientation=1,h.ImageProcessingDirtyFlag=64,h.TextureDirtyFlag=1,h.LightDirtyFlag=2,h.FresnelDirtyFlag=4,h.AttributesDirtyFlag=8,h.MiscDirtyFlag=16,h.PrePassDirtyFlag=32,h.AllDirtyFlag=127,h.MATERIAL_OPAQUE=0,h.MATERIAL_ALPHATEST=1,h.MATERIAL_ALPHABLEND=2,h.MATERIAL_ALPHATESTANDBLEND=3,h.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,h.MATERIAL_NORMALBLENDMETHOD_RNM=1,h.OnEventObservable=new P.d,h._AllDirtyCallBack=e=>e.markAllAsDirty(),h._ImageProcessingDirtyCallBack=e=>e.markAsImageProcessingDirty(),h._TextureDirtyCallBack=e=>e.markAsTexturesDirty(),h._FresnelDirtyCallBack=e=>e.markAsFresnelDirty(),h._MiscDirtyCallBack=e=>e.markAsMiscDirty(),h._PrePassDirtyCallBack=e=>e.markAsPrePassDirty(),h._LightsDirtyCallBack=e=>e.markAsLightDirty(),h._AttributeDirtyCallBack=e=>e.markAsAttributesDirty(),h._FresnelAndMiscDirtyCallBack=e=>{h._FresnelDirtyCallBack(e),h._MiscDirtyCallBack(e)},h._TextureAndMiscDirtyCallBack=e=>{h._TextureDirtyCallBack(e),h._MiscDirtyCallBack(e)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=e=>{for(const E of h._DirtyCallbackArray)E(e)},(0,N.e)([(0,u.S)()],h.prototype,"id",void 0),(0,N.e)([(0,u.S)()],h.prototype,"uniqueId",void 0),(0,N.e)([(0,u.S)()],h.prototype,"name",void 0),(0,N.e)([(0,u.S)()],h.prototype,"metadata",void 0),(0,N.e)([(0,u.S)()],h.prototype,"checkReadyOnEveryCall",void 0),(0,N.e)([(0,u.S)()],h.prototype,"checkReadyOnlyOnce",void 0),(0,N.e)([(0,u.S)()],h.prototype,"state",void 0),(0,N.e)([(0,u.S)("alpha")],h.prototype,"_alpha",void 0),(0,N.e)([(0,u.S)("iM")],h.prototype,"_backFaceCulling",void 0),(0,N.e)([(0,u.S)("cullBackFaces")],h.prototype,"_cullBackFaces",void 0),(0,N.e)([(0,u.S)()],h.prototype,"sideOrientation",void 0),(0,N.e)([(0,u.S)("alphaMode")],h.prototype,"_alphaMode",void 0),(0,N.e)([(0,u.S)()],h.prototype,"_needDepthPrePass",void 0),(0,N.e)([(0,u.S)()],h.prototype,"disableDepthWrite",void 0),(0,N.e)([(0,u.S)()],h.prototype,"disableColorWrite",void 0),(0,N.e)([(0,u.S)()],h.prototype,"forceDepthWrite",void 0),(0,N.e)([(0,u.S)()],h.prototype,"depthFunction",void 0),(0,N.e)([(0,u.S)()],h.prototype,"separateCullingPass",void 0),(0,N.e)([(0,u.S)("fogEnabled")],h.prototype,"_fogEnabled",void 0),(0,N.e)([(0,u.S)()],h.prototype,"pointSize",void 0),(0,N.e)([(0,u.S)()],h.prototype,"zOffset",void 0),(0,N.e)([(0,u.S)()],h.prototype,"zOffsetUnits",void 0),(0,N.e)([(0,u.S)()],h.prototype,"pointsCloud",null),(0,N.e)([(0,u.S)()],h.prototype,"fillMode",null),(0,N.e)([(0,u.S)()],h.prototype,"useLogarithmicDepth",null),(0,N.e)([(0,u.S)()],h.prototype,"transparencyMode",null)},12080:(e,E,H)=>{H.d(E,{C:()=>U,G:()=>V,K:()=>K,N:()=>b,P:()=>o,Q:()=>S,U:()=>p,X:()=>l,_:()=>O,bb:()=>v,c:()=>W,d:()=>i,db:()=>T,eb:()=>j,h:()=>Y,j:()=>C,m:()=>F,n:()=>h,r:()=>X,s:()=>s,u:()=>a,y:()=>f,z:()=>w});var N=H(11548),u=H(11789),z=H(11579),P=H(12035),M=H(12085);const D=u.XE.Black(),A={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function C(e,E,H){if(!e||e.LOGARITHMICDEPTH||e.indexOf&&e.indexOf("LOGARITHMICDEPTH")>=0){const e=H.activeCamera;1===e.mode&&N.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),E.setFloat("logarithmicDepthConstant",2/(Math.log(e.maxZ+1)/Math.LN2))}}function i(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];H&&e.fogEnabled&&(!E||E.applyFog)&&0!==e.fogMode&&(H.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),N?(e.fogColor.toLinearSpaceToRef(D,e.getEngine().useExactSrgbConversions),H.setColor3("vFogColor",D)):H.setColor3("vFogColor",e.fogColor))}function V(e,E,H,N,u,z,P,M,D,C){const i=e.numMaxInfluencers||e.numInfluencers;return i<=0?0:(E.push("#define MORPHTARGETS"),e.hasPositions&&E.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),e.hasNormals&&E.push("#define MORPHTARGETTEXTURE_HASNORMALS"),e.hasTangents&&E.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),e.hasUVs&&E.push("#define MORPHTARGETTEXTURE_HASUVS"),e.hasUV2s&&E.push("#define MORPHTARGETTEXTURE_HASUV2S"),e.hasColors&&E.push("#define MORPHTARGETTEXTURE_HASCOLORS"),e.supportsPositions&&u&&E.push("#define MORPHTARGETS_POSITION"),e.supportsNormals&&z&&E.push("#define MORPHTARGETS_NORMAL"),e.supportsTangents&&P&&E.push("#define MORPHTARGETS_TANGENT"),e.supportsUVs&&M&&E.push("#define MORPHTARGETS_UV"),e.supportsUV2s&&D&&E.push("#define MORPHTARGETS_UV2"),e.supportsColors&&C&&E.push("#define MORPHTARGETS_COLOR"),E.push("#define NUM_MORPH_INFLUENCERS "+i),e.isUsingTextureForTargets&&E.push("#define MORPHTARGETS_TEXTURE"),A.NUM_MORPH_INFLUENCERS=i,A.NORMAL=z,A.TANGENT=P,A.UV=M,A.UV2=D,A.COLOR=C,U(H,N,A,u),i)}function U(e,E,H){let u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const P=H.NUM_MORPH_INFLUENCERS;if(P>0&&z.d.LastCreatedEngine){const M=z.d.LastCreatedEngine.getCaps().maxVertexAttribs,D=E.morphTargetManager;if(null!==D&&void 0!==D&&D.isUsingTextureForTargets)return;const A=D&&D.supportsPositions&&u,C=D&&D.supportsNormals&&H.NORMAL,i=D&&D.supportsTangents&&H.TANGENT,V=D&&D.supportsUVs&&H.UV1,U=D&&D.supportsUV2s&&H.UV2,j=D&&D.supportsColors&&H.VERTEXCOLOR;for(let H=0;H<P;H++)A&&e.push("position"+H),C&&e.push("normal"+H),i&&e.push("tangent"+H),V&&e.push("uv_"+H),U&&e.push("uv2_"+H),j&&e.push("color"+H),e.length>M&&N.d.Error("Cannot add more vertex attributes for mesh "+E.name)}}function j(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),E&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))}function F(e,E){const H=e.morphTargetManager;e&&H&&E.setFloatArray("morphTargetInfluences",H.influences)}function h(e,E){E.bindToEffect(e,"Scene")}function S(e,E,H){E._needUVs=!0,E[H]=!0,e.optimizeUVAllocation&&e.getTextureMatrix().isIdentityAs3x2()?(E[H+"DIRECTUV"]=e.coordinatesIndex+1,E["MAINUV"+(e.coordinatesIndex+1)]=!0):E[H+"DIRECTUV"]=0}function X(e,E,H){const N=e.getTextureMatrix();E.MM(H+"Matrix",N)}function a(e,E,H){H.BAKED_VERTEX_ANIMATION_TEXTURE&&H.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")}function W(e,E,H){var N;if(E&&e&&(e.computeBonesUsingShaders&&E._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){const u=e.skeleton;if(u.isUsingTextureForMatrices&&E.getUniformIndex("boneTextureWidth")>-1){const H=u.getTransformMatrixTexture(e);E.setTexture("boneSampler",H),E.setFloat("boneTextureWidth",4*(u.bones.length+1))}else{const z=u.getTransformMatrices(e);z&&(E.setMatrices("mBones",z),H&&e.fe().prePassRenderer&&e.fe().prePassRenderer.getIndex(2)&&(H.previousBones[e.uniqueId]||(H.previousBones[e.uniqueId]=z.slice()),E.setMatrices("mPreviousBones",H.previousBones[e.uniqueId]),N=z,H.previousBones[e.uniqueId].set(N)))}}}function r(e,E,H,N,u){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e._bindLight(E,H,N,u,z)}function Y(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const z=Math.min(E.lightSources.length,u);for(let P=0;P<z;P++){r(E.lightSources[P],P,e,H,"boolean"===typeof N?N:N.SPECULARTERM,E.receiveShadows)}}function f(e,E,H,N){H.NUM_BONE_INFLUENCERS>0&&(N.addCPUSkinningFallback(0,E),e.push("matricesIndices"),e.push("matricesWeights"),H.NUM_BONE_INFLUENCERS>4&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra")))}function w(e,E){(E.INSTANCES||E.THIN_INSTANCES)&&j(e,!!E.PREPASS_VELOCITY),E.INSTANCESCOLOR&&e.push("instanceColor")}function s(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=0;for(let z=0;z<H&&e["LIGHT"+z];z++)z>0&&(u=N+z,E.addFallback(u,"LIGHT"+z)),e.SHADOWS||(e["SHADOW"+z]&&E.addFallback(N,"SHADOW"+z),e["SHADOWPCF"+z]&&E.addFallback(N,"SHADOWPCF"+z),e["SHADOWPCSS"+z]&&E.addFallback(N,"SHADOWPCSS"+z),e["SHADOWPOISSON"+z]&&E.addFallback(N,"SHADOWPOISSON"+z),e["SHADOWESM"+z]&&E.addFallback(N,"SHADOWESM"+z),e["SHADOWCLOSEESM"+z]&&E.addFallback(N,"SHADOWCLOSEESM"+z));return u++}function p(e,E,H,N,u,z,P){let M=arguments.length>7&&void 0!==arguments[7]&&arguments[7];P._areMiscDirty&&(P.LOGARITHMICDEPTH=H,P.POINTSIZE=N,P.FOG=u&&function(e,E){return E.fogEnabled&&e.applyFog&&0!==E.fogMode}(e,E),P.NONUNIFORMSCALING=e.nonUniformScaling,P.ALPHATEST=z,P.DECAL_AFTER_DETAIL=M)}function o(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H._areLightsDirty)return H._needNormals;let P=0;const M={needNormals:H._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!z)for(const A of E.lightSources)if(y(e,E,A,P,H,N,M),P++,P===u)break;H.SPECULARTERM=M.specularEnabled,H.SHADOWS=M.shadowEnabled;for(let A=P;A<u;A++)void 0!==H["LIGHT"+A]&&(H["LIGHT"+A]=!1,H["HEMILIGHT"+A]=!1,H["POINTLIGHT"+A]=!1,H["DIRLIGHT"+A]=!1,H["SPOTLIGHT"+A]=!1,H["AREALIGHT"+A]=!1,H["SHADOW"+A]=!1,H["SHADOWCSM"+A]=!1,H["SHADOWCSMDEBUG"+A]=!1,H["SHADOWCSMNUM_CASCADES"+A]=!1,H["SHADOWCSMUSESHADOWMAXZ"+A]=!1,H["SHADOWCSMNOBLEND"+A]=!1,H["SHADOWCSM_RIGHTHANDED"+A]=!1,H["SHADOWPCF"+A]=!1,H["SHADOWPCSS"+A]=!1,H["SHADOWPOISSON"+A]=!1,H["SHADOWESM"+A]=!1,H["SHADOWCLOSEESM"+A]=!1,H["SHADOWCUBE"+A]=!1,H["SHADOWLOWQUALITY"+A]=!1,H["SHADOWMEDIUMQUALITY"+A]=!1);const D=e.getEngine().getCaps();return void 0===H.SHADOWFLOAT&&(M.needRebuild=!0),H.SHADOWFLOAT=M.shadowEnabled&&(D.textureFloatRender&&D.textureFloatLinearFiltering||D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering),H.LIGHTMAPEXCLUDED=M.lightmapMode,M.needRebuild&&H.rebuild(),M.needNormals}function y(e,E,H,N,u,z,M){switch(M.needNormals=!0,void 0===u["LIGHT"+N]&&(M.needRebuild=!0),u["LIGHT"+N]=!0,u["SPOTLIGHT"+N]=!1,u["HEMILIGHT"+N]=!1,u["POINTLIGHT"+N]=!1,u["DIRLIGHT"+N]=!1,u["AREALIGHT"+N]=!1,H.prepareLightSpecificDefines(u,N),u["LIGHT_FALLOFF_PHYSICAL"+N]=!1,u["LIGHT_FALLOFF_GLTF"+N]=!1,u["LIGHT_FALLOFF_STANDARD"+N]=!1,H.falloffType){case P.c.FALLOFF_GLTF:u["LIGHT_FALLOFF_GLTF"+N]=!0;break;case P.c.FALLOFF_PHYSICAL:u["LIGHT_FALLOFF_PHYSICAL"+N]=!0;break;case P.c.FALLOFF_STANDARD:u["LIGHT_FALLOFF_STANDARD"+N]=!0}if(z&&!H.NC.equalsFloats(0,0,0)&&(M.specularEnabled=!0),u["SHADOW"+N]=!1,u["SHADOWCSM"+N]=!1,u["SHADOWCSMDEBUG"+N]=!1,u["SHADOWCSMNUM_CASCADES"+N]=!1,u["SHADOWCSMUSESHADOWMAXZ"+N]=!1,u["SHADOWCSMNOBLEND"+N]=!1,u["SHADOWCSM_RIGHTHANDED"+N]=!1,u["SHADOWPCF"+N]=!1,u["SHADOWPCSS"+N]=!1,u["SHADOWPOISSON"+N]=!1,u["SHADOWESM"+N]=!1,u["SHADOWCLOSEESM"+N]=!1,u["SHADOWCUBE"+N]=!1,u["SHADOWLOWQUALITY"+N]=!1,u["SHADOWMEDIUMQUALITY"+N]=!1,E&&E.receiveShadows&&e.shadowsEnabled&&H.shadowEnabled){const E=H.getShadowGenerator(e.activeCamera)??H.getShadowGenerator();if(E){const e=E.getShadowMap();e&&e.renderList&&e.renderList.length>0&&(M.shadowEnabled=!0,E.prepareDefines(u,N))}}H.lightmapMode!=P.c.LIGHTMAP_DEFAULT?(M.lightmapMode=!0,u["LIGHTMAPEXCLUDED"+N]=!0,u["LIGHTMAPNOSPECULAR"+N]=H.lightmapMode==P.c.LIGHTMAP_SHADOWSONLY):(u["LIGHTMAPEXCLUDED"+N]=!1,u["LIGHTMAPNOSPECULAR"+N]=!1)}function b(e,E,H,N,u){let z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=function(e,E){let H=!1;if(e.activeCamera){const N=E.CAMERA_ORTHOGRAPHIC?1:0,u=E.CAMERA_PERSPECTIVE?1:0,z=1===e.activeCamera.mode?1:0,P=0===e.activeCamera.mode?1:0;(N^z||u^P)&&(E.CAMERA_ORTHOGRAPHIC=1===z,E.CAMERA_PERSPECTIVE=1===P,H=!0)}return H}(e,N);!1!==z&&(D=(0,M.h)(H,e,N)),N.DEPTHPREPASS!==!E.getColorWrite()&&(N.DEPTHPREPASS=!N.DEPTHPREPASS,D=!0),N.INSTANCES!==u&&(N.INSTANCES=u,D=!0),N.THIN_INSTANCES!==P&&(N.THIN_INSTANCES=P,D=!0),D&&N.markAsUnprocessed()}function K(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],P=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!E._areAttributesDirty&&E._needNormals===E._normals&&E._needUVs===E._uvs)return!1;E._normals=E._needNormals,E._uvs=E._needUVs,E.NORMAL=E._needNormals&&e.isVerticesDataPresent("normal"),E._needNormals&&e.isVerticesDataPresent("tangent")&&(E.TANGENT=!0);for(let M=1;M<=6;++M)E["UV"+M]=!!E._needUVs&&e.isVerticesDataPresent(`uv${1===M?"":M}`);if(H){const H=e.useVertexColors&&e.isVerticesDataPresent("color");E.VERTEXCOLOR=H,E.VERTEXALPHA=e.hasVertexAlpha&&H&&z}return e.isVerticesDataPresent("instanceColor")&&(e.hasInstances||e.hasThinInstances)&&(E.INSTANCESCOLOR=!0),N&&function(e,E){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){E.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;const H=void 0!==E.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&H)E.BONETEXTURE=!0;else{E.BonesPerMesh=e.skeleton.bones.length+1,E.BONETEXTURE=!H&&void 0;const N=e.fe().prePassRenderer;if(N&&N.enabled){const H=-1===N.excludedSkinnedMesh.indexOf(e);E.BONES_VELOCITY_ENABLED=H}}}else E.NUM_BONE_INFLUENCERS=0,E.BonesPerMesh=0,void 0!==E.BONETEXTURE&&(E.BONETEXTURE=!1)}(e,E),u&&function(e,E){const H=e.morphTargetManager;H?(E.MORPHTARGETS_UV=H.supportsUVs&&E.UV1,E.MORPHTARGETS_UV2=H.supportsUV2s&&E.UV2,E.MORPHTARGETS_TANGENT=H.supportsTangents&&E.TANGENT,E.MORPHTARGETS_NORMAL=H.supportsNormals&&E.NORMAL,E.MORPHTARGETS_POSITION=H.supportsPositions,E.MORPHTARGETS_COLOR=H.supportsColors,E.MORPHTARGETTEXTURE_HASUVS=H.hasUVs,E.MORPHTARGETTEXTURE_HASUV2S=H.hasUV2s,E.MORPHTARGETTEXTURE_HASTANGENTS=H.hasTangents,E.MORPHTARGETTEXTURE_HASNORMALS=H.hasNormals,E.MORPHTARGETTEXTURE_HASPOSITIONS=H.hasPositions,E.MORPHTARGETTEXTURE_HASCOLORS=H.hasColors,E.NUM_MORPH_INFLUENCERS=H.numMaxInfluencers||H.numInfluencers,E.MORPHTARGETS=E.NUM_MORPH_INFLUENCERS>0,E.MORPHTARGETS_TEXTURE=H.isUsingTextureForTargets):(E.MORPHTARGETS_UV=!1,E.MORPHTARGETS_UV2=!1,E.MORPHTARGETS_TANGENT=!1,E.MORPHTARGETS_NORMAL=!1,E.MORPHTARGETS_POSITION=!1,E.MORPHTARGETS_COLOR=!1,E.MORPHTARGETTEXTURE_HASUVS=!1,E.MORPHTARGETTEXTURE_HASUV2S=!1,E.MORPHTARGETTEXTURE_HASTANGENTS=!1,E.MORPHTARGETTEXTURE_HASNORMALS=!1,E.MORPHTARGETTEXTURE_HASPOSITIONS=!1,E.MORPHTARGETTEXTURE_HAS_COLORS=!1,E.MORPHTARGETS=!1,E.NUM_MORPH_INFLUENCERS=0)}(e,E),P&&function(e,E){const H=e.bakedVertexAnimationManager;E.BAKED_VERTEX_ANIMATION_TEXTURE=!(!H||!H.isEnabled)}(e,E),!0}function l(e,E){if(e.activeCamera){const H=E.MULTIVIEW;E.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,E.MULTIVIEW!=H&&E.markAsUnprocessed()}}function O(e,E,H){const N=E.ORDER_INDEPENDENT_TRANSPARENCY,u=E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;E.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&H,E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,N===E.ORDER_INDEPENDENT_TRANSPARENCY&&u===E.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||E.markAsUnprocessed()}function v(e,E,H){const N=E.PREPASS;if(!E._arePrePassDirty)return;const u=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&H){E.PREPASS=!0,E.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount,E.PREPASS_NORMAL_WORLDSPACE=e.prePassRenderer.generateNormalsInWorldSpace,E.PREPASS_COLOR=!0,E.PREPASS_COLOR_INDEX=0;for(let H=0;H<u.length;H++){const N=e.prePassRenderer.getIndex(u[H].type);-1!==N?(E[u[H].define]=!0,E[u[H].index]=N):E[u[H].define]=!1}}else{E.PREPASS=!1;for(let e=0;e<u.length;e++)E[u[e].define]=!1}E.PREPASS!=N&&(E.markAsUnprocessed(),E.markAsImageProcessingDirty())}function R(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6];u&&u.push("Light"+e),z||(E.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightWidth"+e,"vLightHeight"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),H.push("shadowTexture"+e),H.push("depthTexture"+e),E.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),N&&(H.push("projectionLightTexture"+e),E.push("textureProjectionMatrix"+e)),P&&H.push("iesLightTexture"+e))}function T(e,E,H){let N,u,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(e.uniformsNames){const P=e;N=P.uniformsNames,u=P.uniformBuffersNames,E=P.samplers,H=P.defines,z=P.maxSimultaneousLights||0}else N=e,E||(E=[]);for(let P=0;P<z&&H["LIGHT"+P];P++)R(P,N,E,H["PROJECTEDLIGHTTEXTURE"+P],u,!1,H["IESLIGHTTEXTURE"+P]);H.NUM_MORPH_INFLUENCERS&&(N.push("morphTargetInfluences"),N.push("morphTargetCount")),H.BAKED_VERTEX_ANIMATION_TEXTURE&&(N.push("bakedVertexAnimationSettings"),N.push("bakedVertexAnimationTextureSizeInverted"),N.push("bakedVertexAnimationTime"),E.push("bakedVertexAnimationTexture"))}},12045:(e,E,H)=>{H.d(E,{e:()=>z});var N=H(11738),u=H(12047);class z extends u.e{constructor(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,E,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new N.Matrix,this._storeEffectOnSubMeshes=H}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(e,E){return!!e&&(!this._storeEffectOnSubMeshes||(!e.NM||0===e.NM.length||this.isReadyForSubMesh(e,e.NM[0],E)))}_isReadyForSubMesh(e){const E=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!E||E._renderId!==this.fe().getRenderId())}bindOnlyWorldMatrix(e){this._activeEffect.setMatrix("world",e)}bindOnlyNormalMatrix(e){this._activeEffect.setMatrix("normalMatrix",e)}bind(e,E){E&&this.bindForSubMesh(e,E,E.NM[0])}_afterBind(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;super._afterBind(e,E,H),this.fe()._cachedEffect=E,H?H._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return H._drawWrapper._forceRebindOnNextCall||e.isCachedMaterialInvalid(this,E,N)}dispose(e,E,H){this._activeEffect=void 0,super.dispose(e,E,H)}}},12072:(e,E,H)=>{H.d(E,{e:()=>M,i:()=>D});var N=H(11717),u=H(11738),z=H(11723);class P{static extractMinAndMaxIndexed(e,E,H,N,u,z){for(let P=H;P<H+N;P++){const H=3*E[P],N=e[H],M=e[H+1],D=e[H+2];u.minimizeInPlaceFromFloats(N,M,D),z.maximizeInPlaceFromFloats(N,M,D)}}static extractMinAndMax(e,E,H,N,u,z){for(let P=E,M=E*N;P<E+H;P++,M+=N){const E=e[M],H=e[M+1],N=e[M+2];u.minimizeInPlaceFromFloats(E,H,N),z.maximizeInPlaceFromFloats(E,H,N)}}}function M(e,E,H,N){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const M=new u.jE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D=new u.jE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return P.extractMinAndMaxIndexed(e,E,H,N,M,D),z&&(M.x-=M.x*z.x+z.y,M.y-=M.y*z.x+z.y,M.z-=M.z*z.x+z.y,D.x+=D.x*z.x+z.y,D.y+=D.y*z.x+z.y,D.z+=D.z*z.x+z.y),{minimum:M,maximum:D}}function D(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4?arguments[4]:void 0;const M=new u.jE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D=new u.jE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return z||(z=3),P.extractMinAndMax(e,E,H,z,M,D),N&&(M.x-=M.x*N.x+N.y,M.y-=M.y*N.x+N.y,M.z-=M.z*N.x+N.y,D.x+=D.x*N.x+N.y,D.y+=D.y*N.x+N.y,D.z+=D.z*N.x+N.y),{minimum:M,maximum:D}}(0,N.e)([z.h.filter((function(){for(var e=arguments.length,E=new Array(e),H=0;H<e;H++)E[H]=arguments[H];let[N,u]=E;return!Array.isArray(N)&&!Array.isArray(u)}))],P,"extractMinAndMaxIndexed",null),(0,N.e)([z.h.filter((function(){for(var e=arguments.length,E=new Array(e),H=0;H<e;H++)E[H]=arguments[H];let[N]=E;return!Array.isArray(N)}))],P,"extractMinAndMax",null)},12051:(e,E,H)=>{H.d(E,{e:()=>D});var N=H(11818),u=H(12053),z=H(12057),P=H(12072),M=H(11851);class D{get materialDefines(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines}set materialDefines(e){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=e}_getDrawWrapper(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=e??this._engine.currentRenderPassId;let H=this._drawWrappers[e];return!H&&E&&(this._drawWrappers[e]=H=new M.d(this._mesh.fe().getEngine())),H}_removeDrawWrapper(e){let E=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var H;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(H=this._drawWrappers[e])||void 0===H||H.dispose(E));this._drawWrappers[e]=void 0}get effect(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(e=this._getDrawWrapper())||void 0===e?void 0:e.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=this._drawWrapper;u.setEffect(e,E,N),void 0!==H&&(u.materialContext=H),e||(u.defines=null,u.materialContext=void 0)}resetDrawCache(e){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e,!0,E);for(const e of this._drawWrappers)null===e||void 0===e||e.dispose(E)}this._drawWrappers=[]}static AddToMesh(e,E,H,N,u,z,P){return new D(e,E,H,N,u,z,P,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(e,E,H,N,u,z,P){let M=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],D=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=e,this.verticesStart=E,this.verticesCount=H,this.indexStart=N,this.indexCount=u,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=z,this._renderingMesh=P||z,D&&z.NM.push(this),this._engine=this._mesh.fe().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=z.NM.length-1,M&&(this.refreshBoundingInfo(),z.DM(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}Te(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!E)return e&&this._mesh.fe()._hasDefaultMaterial?this._mesh.fe().defaultMaterial:null;if(this._isMultiMaterial(E)){const e=E.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this.resetDrawCache()),e}return E}_isMultiMaterial(e){return void 0!==e.getSubMaterial}refreshBoundingInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.AM)return this;if(e||(e=this._renderingMesh.getVerticesData(N.g.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const E=this._renderingMesh.CM();let H;if(0===this.indexStart&&this.indexCount===E.length){const e=this._renderingMesh.getBoundingInfo();H={minimum:e.minimum.clone(),maximum:e.maximum.clone()}}else H=(0,P.e)(e,E,this.indexStart,this.indexCount,this._renderingMesh.AM.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(H.minimum,H.maximum):this._boundingInfo=new z.b(H.minimum,H.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let E=this.getBoundingInfo();return E||(this.refreshBoundingInfo(),E=this.getBoundingInfo()),E&&E.update(e),this}isInFrustum(e){const E=this.getBoundingInfo();return!!E&&E.isInFrustum(e,this._mesh.zi)}isCompletelyInFrustum(e){const E=this.getBoundingInfo();return!!E&&E.isCompletelyInFrustum(e)}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,E){if(!this._linesIndexBuffer){const H=6*Math.floor(this.indexCount/3),N=this.verticesStart+this.verticesCount>65535?new Uint32Array(H):new Uint16Array(H);let u=0;if(0===e.length)for(let e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)N[u++]=e,N[u++]=e+1,N[u++]=e+1,N[u++]=e+2,N[u++]=e+2,N[u++]=e;else for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)N[u++]=e[E],N[u++]=e[E+1],N[u++]=e[E+1],N[u++]=e[E+2],N[u++]=e[E+2],N[u++]=e[E];this._linesIndexBuffer=E.createIndexBuffer(N),this._linesIndexCount=N.length}return this._linesIndexBuffer}canIntersects(e){const E=this.getBoundingInfo();return!!E&&e.intersectsBox(E.boundingBox)}intersects(e,E,H,N,u){const z=this.Te();if(!z)return null;let P=3,M=!1;switch(z.fillMode){case 3:case 5:case 6:case 8:return null;case 7:P=1,M=!0}return 4===z.fillMode?H.length?this._intersectLines(e,E,H,this._mesh.intersectionThreshold,N):this._intersectUnIndexedLines(e,E,H,this._mesh.intersectionThreshold,N):!H.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,E,H,N,u):this._intersectTriangles(e,E,H,P,M,N,u)}_intersectLines(e,E,H,N,z){let P=null;for(let M=this.indexStart;M<this.indexStart+this.indexCount;M+=2){const D=E[H[M]],A=E[H[M+1]],C=e.intersectionSegment(D,A,N);if(!(C<0)&&((z||!P||C<P.distance)&&(P=new u.b(null,null,C),P.faceId=M/2,z)))break}return P}_intersectUnIndexedLines(e,E,H,N,z){let P=null;for(let M=this.verticesStart;M<this.verticesStart+this.verticesCount;M+=2){const H=E[M],D=E[M+1],A=e.intersectionSegment(H,D,N);if(!(A<0)&&((z||!P||A<P.distance)&&(P=new u.b(null,null,A),P.faceId=M/2,z)))break}return P}_intersectTriangles(e,E,H,N,u,z,P){let M=null,D=-1;for(let A=this.indexStart;A<this.indexStart+this.indexCount-(3-N);A+=N){D++;const N=H[A],C=H[A+1],i=H[A+2];if(u&&4294967295===i){A+=2;continue}const V=E[N],U=E[C],j=E[i];if(!V||!U||!j)continue;if(P&&!P(V,U,j,e,N,C,i))continue;const F=e.intersectsTriangle(V,U,j);if(F){if(F.distance<0)continue;if((z||!M||F.distance<M.distance)&&(M=F,M.faceId=D,z))break}}return M}_intersectUnIndexedTriangles(e,E,H,N,u){let z=null;for(let P=this.verticesStart;P<this.verticesStart+this.verticesCount;P+=3){const H=E[P],M=E[P+1],D=E[P+2];if(u&&!u(H,M,D,e,-1,-1,-1))continue;const A=e.intersectsTriangle(H,M,D);if(A){if(A.distance<0)continue;if((N||!z||A.distance<z.distance)&&(z=A,z.faceId=P/3,N))break}}return z}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,E){const H=new D(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,E,!1);if(!this.IsGlobal){const e=this.getBoundingInfo();if(!e)return H;H._boundingInfo=new z.b(e.minimum,e.maximum)}return H}dispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.fe().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const E=this._mesh.NM.indexOf(this);this._mesh.NM.splice(E,1),this.resetDrawCache(void 0,e)}getClassName(){return"SubMesh"}static CreateFromIndices(e,E,H,N,u){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],P=Number.MAX_VALUE,M=-Number.MAX_VALUE;const A=(u||N).CM();for(let D=E;D<E+H;D++){const e=A[D];e<P&&(P=e),e>M&&(M=e)}return new D(e,P,M-P+1,E,H,N,u,z)}}}}]);