"use strict";(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[24],{13070:(t,b,Z)=>{Z.d(b,{c:()=>J});class J{constructor(t,b,Z){this.bu=t,this.bv=b,this.distance=Z,this.faceId=0,this.subMeshId=0}}},13084:(t,b,Z)=>{Z.d(b,{b:()=>v});var J=Z(12742),S=Z(12735),P=Z(12737);class v{constructor(t,b,Z){this.vectors=(0,J.c)(8,S.JZ.Zero),this.center=S.JZ.Zero(),this.centerWorld=S.JZ.Zero(),this.extendSize=S.JZ.Zero(),this.extendSizeWorld=S.JZ.Zero(),this.directions=(0,J.c)(3,S.JZ.Zero),this.vectorsWorld=(0,J.c)(8,S.JZ.Zero),this.minimumWorld=S.JZ.Zero(),this.maximumWorld=S.JZ.Zero(),this.minimum=S.JZ.Zero(),this.maximum=S.JZ.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,b,Z)}reConstruct(t,b,Z){const J=t.x,P=t.y,v=t.z,h=b.x,C=b.y,Y=b.z,g=this.vectors;this.minimum.Ab(J,P,v),this.maximum.Ab(h,C,Y),g[0].Ab(J,P,v),g[1].Ab(h,C,Y),g[2].Ab(h,P,v),g[3].Ab(J,C,v),g[4].Ab(J,P,Y),g[5].Ab(h,C,v),g[6].Ab(J,C,Y),g[7].Ab(h,P,Y),b.addToRef(t,this.center).scaleInPlace(.5),b.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=Z||S.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(t){const b=v._TmpVector3,Z=this.maximum.subtractToRef(this.minimum,b[0]),J=Z.length();Z.normalizeFromLength(J);const S=J*t,P=Z.scaleInPlace(.5*S),h=this.center.subtractToRef(P,b[1]),C=this.center.addToRef(P,b[2]);return this.reConstruct(h,C,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){const b=this.minimumWorld,Z=this.maximumWorld,J=this.directions,P=this.vectorsWorld,v=this.vectors;if(t.isIdentity()){b.S(this.minimum),Z.S(this.maximum);for(let t=0;t<8;++t)P[t].S(v[t]);this.extendSizeWorld.S(this.extendSize),this.centerWorld.S(this.center)}else{b.Lb(Number.MAX_VALUE),Z.Lb(-Number.MAX_VALUE);for(let J=0;J<8;++J){const h=P[J];S.JZ.TransformCoordinatesToRef(v[J],t,h),b.minimizeInPlace(h),Z.maximizeInPlace(h)}Z.subtractToRef(b,this.extendSizeWorld).scaleInPlace(.5),Z.addToRef(b,this.centerWorld).scaleInPlace(.5)}S.JZ.FromArrayToRef(t.m,0,J[0]),S.JZ.FromArrayToRef(t.m,4,J[1]),S.JZ.FromArrayToRef(t.m,8,J[2]),this._worldMatrix=t}isInFrustum(t){return v.IsInFrustum(this.vectorsWorld,t)}isCompletelyInFrustum(t){return v.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsPoint(t){const b=this.minimumWorld,Z=this.maximumWorld,J=b.x,S=b.y,v=b.z,h=Z.x,C=Z.y,Y=Z.z,g=t.x,I=t.y,r=t.z,M=-P.e;return!(h-g<M||M>g-J)&&(!(C-I<M||M>I-S)&&!(Y-r<M||M>r-v))}intersectsSphere(t){return v.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}intersectsMinMax(t,b){const Z=this.minimumWorld,J=this.maximumWorld,S=Z.x,P=Z.y,v=Z.z,h=J.x,C=J.y,Y=J.z,g=t.x,I=t.y,r=t.z,M=b.x,T=b.y,a=b.z;return!(h<g||S>M)&&(!(C<I||P>T)&&!(Y<r||v>a))}dispose(){var t,b;null===(t=this._drawWrapperFront)||void 0===t||t.dispose(),null===(b=this._drawWrapperBack)||void 0===b||b.dispose()}static Intersects(t,b){return t.intersectsMinMax(b.minimumWorld,b.maximumWorld)}static IntersectsSphere(t,b,Z,J){const P=v._TmpVector3[0];S.JZ.ClampToRef(Z,t,b,P);return S.JZ.DistanceSquared(Z,P)<=J*J}static IsCompletelyInFrustum(t,b){for(let Z=0;Z<6;++Z){const J=b[Z];for(let b=0;b<8;++b)if(J.dotCoordinate(t[b])<0)return!1}return!0}static IsInFrustum(t,b){for(let Z=0;Z<6;++Z){let J=!0;const S=b[Z];for(let b=0;b<8;++b)if(S.dotCoordinate(t[b])>=0){J=!1;break}if(J)return!1}return!0}}v._TmpVector3=(0,J.c)(3,S.JZ.Zero)},13079:(t,b,Z)=>{Z.d(b,{d:()=>I});var J=Z(12742),S=Z(12735),P=Z(13084),v=Z(13087);const h={min:0,max:0},C={min:0,max:0},Y=(t,b,Z)=>{const J=S.JZ.Dot(b.centerWorld,t),P=Math.abs(S.JZ.Dot(b.directions[0],t))*b.extendSize.x+Math.abs(S.JZ.Dot(b.directions[1],t))*b.extendSize.y+Math.abs(S.JZ.Dot(b.directions[2],t))*b.extendSize.z;Z.min=J-P,Z.max=J+P},g=(t,b,Z)=>(Y(t,b,h),Y(t,Z,C),!(h.min>C.max||C.min>h.max));class I{constructor(t,b,Z){this._isLocked=!1,this.boundingBox=new P.b(t,b,Z),this.boundingSphere=new v.e(t,b,Z)}reConstruct(t,b,Z){this.boundingBox.reConstruct(t,b,Z),this.boundingSphere.reConstruct(t,b,Z)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}update(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}centerOn(t,b){const Z=I._TmpVector3[0].S(t).XI(b),J=I._TmpVector3[1].S(t).addInPlace(b);return this.boundingBox.reConstruct(Z,J,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(Z,J,this.boundingBox.getWorldMatrix()),this}encapsulate(t){const b=S.JZ.Minimize(this.minimum,t),Z=S.JZ.Maximize(this.maximum,t);return this.reConstruct(b,Z,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(t){const b=S.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(b);const Z=S.TmpVectors.JZ[0];return S.JZ.TransformCoordinatesToRef(t.boundingBox.minimumWorld,b,Z),this.encapsulate(Z),S.JZ.TransformCoordinatesToRef(t.boundingBox.maximumWorld,b,Z),this.encapsulate(Z),this}scale(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}isInFrustum(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===b||3===b)&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;return!(1!==b&&3!==b)||this.boundingBox.isInFrustum(t)}get diagonalLength(){const t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,I._TmpVector3[0]).length()}isCompletelyInFrustum(t){return this.boundingBox.isCompletelyInFrustum(t)}_checkCollision(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))}intersects(t,b){if(!v.e.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!P.b.Intersects(this.boundingBox,t.boundingBox))return!1;if(!b)return!0;const Z=this.boundingBox,J=t.boundingBox;return!!g(Z.directions[0],Z,J)&&(!!g(Z.directions[1],Z,J)&&(!!g(Z.directions[2],Z,J)&&(!!g(J.directions[0],Z,J)&&(!!g(J.directions[1],Z,J)&&(!!g(J.directions[2],Z,J)&&(!!g(S.JZ.Cross(Z.directions[0],J.directions[0]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[0],J.directions[1]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[0],J.directions[2]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[1],J.directions[0]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[1],J.directions[1]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[1],J.directions[2]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[2],J.directions[0]),Z,J)&&(!!g(S.JZ.Cross(Z.directions[2],J.directions[1]),Z,J)&&!!g(S.JZ.Cross(Z.directions[2],J.directions[2]),Z,J))))))))))))))}}I._TmpVector3=(0,J.c)(2,S.JZ.Zero)},13087:(t,b,Z)=>{Z.d(b,{e:()=>P});var J=Z(12742),S=Z(12735);class P{constructor(t,b,Z){this.center=S.JZ.Zero(),this.centerWorld=S.JZ.Zero(),this.minimum=S.JZ.Zero(),this.maximum=S.JZ.Zero(),this.reConstruct(t,b,Z)}reConstruct(t,b,Z){this.minimum.S(t),this.maximum.S(b);const J=S.JZ.Distance(t,b);b.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*J,this._update(Z||S.Matrix.IdentityReadOnly)}scale(t){const b=this.radius*t,Z=P._TmpVector3,J=Z[0].Lb(b),S=this.center.subtractToRef(J,Z[1]),v=this.center.addToRef(J,Z[2]);return this.reConstruct(S,v,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){if(t.isIdentity())this.centerWorld.S(this.center),this.radiusWorld=this.radius;else{S.JZ.TransformCoordinatesToRef(this.center,t,this.centerWorld);const b=P._TmpVector3[0];S.JZ.TransformNormalFromFloatsToRef(1,1,1,t,b),this.radiusWorld=Math.max(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z))*this.radius}}isInFrustum(t){const b=this.centerWorld,Z=this.radiusWorld;for(let J=0;J<6;J++)if(t[J].dotCoordinate(b)<=-Z)return!1;return!0}isCenterInFrustum(t){const b=this.centerWorld;for(let Z=0;Z<6;Z++)if(t[Z].dotCoordinate(b)<0)return!1;return!0}intersectsPoint(t){const b=S.JZ.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<b)}static Intersects(t,b){const Z=S.JZ.DistanceSquared(t.centerWorld,b.centerWorld),J=t.radiusWorld+b.radiusWorld;return!(J*J<Z)}static CreateFromCenterAndRadius(t,b,Z){this._TmpVector3[0].S(t),this._TmpVector3[1].Ab(0,0,b),this._TmpVector3[2].S(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].XI(this._TmpVector3[1]);const J=new P(this._TmpVector3[0],this._TmpVector3[2]);return J._worldMatrix=Z||S.Matrix.Identity(),J}}P._TmpVector3=(0,J.c)(3,S.JZ.Zero)},13107:(t,b,Z)=>{function J(t){-1===t.indexOf("vClipPlane")&&t.push("vClipPlane"),-1===t.indexOf("vClipPlane2")&&t.push("vClipPlane2"),-1===t.indexOf("vClipPlane3")&&t.push("vClipPlane3"),-1===t.indexOf("vClipPlane4")&&t.push("vClipPlane4"),-1===t.indexOf("vClipPlane5")&&t.push("vClipPlane5"),-1===t.indexOf("vClipPlane6")&&t.push("vClipPlane6")}function S(t,b,Z){const J=!!(t.clipPlane??b.clipPlane),S=!!(t.clipPlane2??b.clipPlane2),P=!!(t.clipPlane3??b.clipPlane3),v=!!(t.clipPlane4??b.clipPlane4),h=!!(t.clipPlane5??b.clipPlane5),C=!!(t.clipPlane6??b.clipPlane6);J&&Z.push("#define CLIPPLANE"),S&&Z.push("#define CLIPPLANE2"),P&&Z.push("#define CLIPPLANE3"),v&&Z.push("#define CLIPPLANE4"),h&&Z.push("#define CLIPPLANE5"),C&&Z.push("#define CLIPPLANE6")}function P(t,b,Z){let J=!1;const S=!!(t.clipPlane??b.clipPlane),P=!!(t.clipPlane2??b.clipPlane2),v=!!(t.clipPlane3??b.clipPlane3),h=!!(t.clipPlane4??b.clipPlane4),C=!!(t.clipPlane5??b.clipPlane5),Y=!!(t.clipPlane6??b.clipPlane6);return Z.CLIPPLANE!==S&&(Z.CLIPPLANE=S,J=!0),Z.CLIPPLANE2!==P&&(Z.CLIPPLANE2=P,J=!0),Z.CLIPPLANE3!==v&&(Z.CLIPPLANE3=v,J=!0),Z.CLIPPLANE4!==h&&(Z.CLIPPLANE4=h,J=!0),Z.CLIPPLANE5!==C&&(Z.CLIPPLANE5=C,J=!0),Z.CLIPPLANE6!==Y&&(Z.CLIPPLANE6=Y,J=!0),J}function v(t,b,Z){let J=b.clipPlane??Z.clipPlane;h(t,"vClipPlane",J),J=b.clipPlane2??Z.clipPlane2,h(t,"vClipPlane2",J),J=b.clipPlane3??Z.clipPlane3,h(t,"vClipPlane3",J),J=b.clipPlane4??Z.clipPlane4,h(t,"vClipPlane4",J),J=b.clipPlane5??Z.clipPlane5,h(t,"vClipPlane5",J),J=b.clipPlane6??Z.clipPlane6,h(t,"vClipPlane6",J)}function h(t,b,Z){Z&&t.setFloat4(b,Z.normal.x,Z.normal.y,Z.normal.z,Z.d)}Z.d(b,{c:()=>J,f:()=>v,i:()=>P,k:()=>S})},13040:(t,b,Z)=>{Z.d(b,{b:()=>J});class J{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(t,b){this._defines[t]||(t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t),this._defines[t]=new Array),this._defines[t].push(b)}addCPUSkinningFallback(t,b){this._mesh=b,t<this._currentRank&&(this._currentRank=t),t>this._maxRank&&(this._maxRank=t)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(t,b){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),b._bonesComputationForcedToCPU=!0;const Z=this._mesh.et();for(let t=0;t<Z.meshes.length;t++){const J=Z.meshes[t];if(J.material){if(J.computeBonesUsingShaders&&0!==J.numBoneInfluencers)if(J.material.getEffect()===b)J.computeBonesUsingShaders=!1;else if(J.Wb)for(const t of J.Wb){if(t.effect===b){J.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&J.computeBonesUsingShaders&&J.numBoneInfluencers>0&&(J.computeBonesUsingShaders=!1)}}else{const b=this._defines[this._currentRank];if(b)for(let Z=0;Z<b.length;Z++)t=t.replace("#define "+b[Z],"");this._currentRank++}return t}}},13052:(t,b,Z)=>{Z.d(b,{c:()=>k});var J=Z(12721),S=Z(12726),P=Z(12549),v=Z(12551),h=Z(12585),C=Z(13061),Y=Z(13e3),g=Z(12557),I=Z(12778),r=Z(12848),M=Z(12760);class T{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(t){this._func=t}get funcRef(){return this._funcRef}set funcRef(t){this._funcRef=t}get funcMask(){return this._funcMask}set funcMask(t){this._funcMask=t}get opStencilFail(){return this._opStencilFail}set opStencilFail(t){this._opStencilFail=t}get opDepthFail(){return this._opDepthFail}set opDepthFail(t){this._opDepthFail=t}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(t){this._opStencilDepthPass=t}get mask(){return this._mask}set mask(t){this._mask=t}get enabled(){return this._enabled}set enabled(t){this._enabled=t}getClassName(){return"MaterialStencilState"}copyTo(t){M.d.Clone((()=>t),this)}serialize(){return M.d.Serialize(this)}parse(t,b,Z){M.d.Parse((()=>this),t,b,Z)}}(0,J.e)([(0,S.N)()],T.prototype,"func",null),(0,J.e)([(0,S.N)()],T.prototype,"funcRef",null),(0,J.e)([(0,S.N)()],T.prototype,"funcMask",null),(0,J.e)([(0,S.N)()],T.prototype,"opStencilFail",null),(0,J.e)([(0,S.N)()],T.prototype,"opDepthFail",null),(0,J.e)([(0,S.N)()],T.prototype,"opStencilDepthPass",null),(0,J.e)([(0,S.N)()],T.prototype,"mask",null),(0,J.e)([(0,S.N)()],T.prototype,"enabled",null);var a=Z(13098);class k{get _supportGlowLayer(){return!1}set _glowModeEnabled(t){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(t){if(this._alpha===t)return;const b=this._alpha;this._alpha=t,1!==b&&1!==t||this.og(k.MiscDirtyFlag+k.PrePassDirtyFlag)}get alpha(){return this._alpha}set Nb(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.og(k.TextureDirtyFlag))}get Nb(){return this._backFaceCulling}set cullBackFaces(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.og(k.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(t){this._blockDirtyMechanism!==t&&(this._blockDirtyMechanism=t,t||this.nr())}atomicMaterialsUpdate(t){this.blockDirtyMechanism=!0;try{t(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(t){this._onDisposeObserver&&this.lb.remove(this._onDisposeObserver),this._onDisposeObserver=this.lb.add(t)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new v.d),this._onBindObservable}set onBind(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new v.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new v.d),this._onEffectCreatedObservable}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.og(k.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.og(k.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case k.WireFrameFillMode:case k.LineListDrawMode:case k.LineLoopDrawMode:case k.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(t){this.fillMode=t?k.WireFrameFillMode:k.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case k.PointFillMode:case k.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(t){this.fillMode=t?k.PointFillMode:k.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(t){this._fillMode!==t&&(this._fillMode=t,this.og(k.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){const b=this.et().getEngine().getCaps().fragmentDepthSupported;t&&!b&&g.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=t&&b,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(t){this._drawWrapper=t}constructor(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.lb=new v.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Ub=new T,this._useUBO=!1,this._fillMode=k.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=t;const S=b||h.e.LastCreatedScene;S&&(this._scene=S,this._dirtyCallbacks={},this._forceGLSL=J,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||P.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new r.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new Y.e(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.et().getEngine().supportsUniformBuffers,this._createUniformBuffer(),Z||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),k.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var t;const b=this.et().getEngine();null===(t=this._uniformBuffer)||void 0===t||t.dispose(),b.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new Y.e(b,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new Y.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(t){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.nr(),this.checkReadyOnlyOnce=!0}unfreeze(){this.nr(),this.checkReadyOnlyOnce=!1}isReady(t,b){return!0}isReadyForSubMesh(t,b,Z){const J=b.materialDefines;return!!J&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=J,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}et(){return this._scene}_getEffectiveOrientation(t){return null!==this.sideOrientation?this.sideOrientation:t.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===k.MATERIAL_ALPHABLEND||this._transparencyMode===k.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===k.MATERIAL_ALPHATEST||this._transparencyMode===k.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===k.MATERIAL_OPAQUE||this._transparencyMode===k.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(t){return this._hasTransparencyMode?this._transparencyModeIsBlend:t.visibility<1||!this._disableAlphaBlending&&(t.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(t){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}nr(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.et().meshes;for(const Z of b)if(Z.Wb)for(const b of Z.Wb)if(b.Kt()===this)for(const Z of b._drawWrappers)Z&&this._materialContext===Z.materialContext&&(Z._wasPreviouslyReady=!1,Z._wasPreviouslyUsingInstances=null,Z._forceRebindOnNextCall=t);t&&this.og(k.AllDirtyFlag)}_preBind(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.getEngine(),J=(null==b?this.sideOrientation:b)===k.ClockWiseSideOrientation;return Z.enableEffect(t||this._getDrawWrapper()),Z.setState(this.Nb,this.zOffset,!1,J,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Ub,this.zOffsetUnits),J}bind(t,b){}buildUniformLayout(){const t=this._uniformBuffer;this._eventInfo.ubo=t,this._callbackPluginEventGeneric(8,this._eventInfo),t.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(t,b,Z){const J=Z._drawWrapper;this._eventInfo.subMesh=Z,this._callbackPluginEventBindForSubMesh(this._eventInfo),J._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(t){}bindView(t){this._useUBO?this._needToBindSceneUbo=!0:t.setMatrix("view",this.et().getViewMatrix())}bindViewProjection(t){this._useUBO?this._needToBindSceneUbo=!0:(t.setMatrix("viewProjection",this.et().getTransformMatrix()),t.setMatrix("projection",this.et().getProjectionMatrix()))}bindEyePosition(t,b){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(t,b)}_afterBind(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&b&&(this._needToBindSceneUbo=!1,(0,a.q)(b,this.et().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=t?t.visibility:1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){const t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}if(this.disableColorWrite){const t=this._scene.getEngine();this._cachedColorWriteState=t.getColorWrite(),t.setColorWrite(!1)}if(0!==this.depthFunction){const t=this._scene.getEngine();this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(t){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=t,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(t){return null}_clonePlugins(t,b){const Z={};if(this._serializePlugins(Z),k._ParsePlugins(Z,t,this._scene,b),this.pluginManager)for(const J of this.pluginManager._plugins){const b=t.pluginManager.getPlugin(J.name);b&&J.copyTo(b)}}getBindedMeshes(){if(this.meshMap){const t=[];for(const b in this.meshMap){const Z=this.meshMap[b];Z&&t.push(Z)}return t}return this._scene.meshes.filter((t=>t.material===this))}forceCompilation(t,b,Z,J){const S={clipPlane:!1,useInstances:!1,...Z},P=this.et(),v=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const h=()=>{if(!this._scene||!this._scene.getEngine())return;const Z=P.clipPlane;if(S.clipPlane&&(P.clipPlane=new I.c(0,0,0,1)),this._storeEffectOnSubMeshes){let Z=!0,P=null;if(t.Wb){const b=new C.c(0,0,0,0,0,t,void 0,!1,!1);b.materialDefines&&(b.materialDefines._renderId=-1),this.isReadyForSubMesh(t,b,S.useInstances)||(b.effect&&b.effect.getCompilationError()&&b.effect.allFallbacksProcessed()?P=b.effect.getCompilationError():(Z=!1,setTimeout(h,16)))}Z&&(this.allowShaderHotSwapping=v,P&&J&&J(P),b&&b(this))}else this.isReady()?(this.allowShaderHotSwapping=v,b&&b(this)):setTimeout(h,16);S.clipPlane&&(P.clipPlane=Z)};h()}async forceCompilationAsync(t,b){return await new Promise(((Z,J)=>{this.forceCompilation(t,(()=>{Z()}),b,(t=>{J(t)}))}))}og(t){this.et().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(k._DirtyCallbackArray.length=0,t&k.ImageProcessingDirtyFlag&&k._DirtyCallbackArray.push(k._ImageProcessingDirtyCallBack),t&k.TextureDirtyFlag&&k._DirtyCallbackArray.push(k._TextureDirtyCallBack),t&k.LightDirtyFlag&&k._DirtyCallbackArray.push(k._LightsDirtyCallBack),t&k.FresnelDirtyFlag&&k._DirtyCallbackArray.push(k._FresnelDirtyCallBack),t&k.AttributesDirtyFlag&&k._DirtyCallbackArray.push(k._AttributeDirtyCallBack),t&k.MiscDirtyFlag&&k._DirtyCallbackArray.push(k._MiscDirtyCallBack),t&k.PrePassDirtyFlag&&k._DirtyCallbackArray.push(k._PrePassDirtyCallBack),k._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(k._RunDirtyCallBacks),this.et().resetCachedMaterial())}resetDrawCache(){const t=this.et().meshes;for(const b of t)if(b.Wb)for(const t of b.Wb)t.Kt()===this&&t.resetDrawCache()}_markAllSubMeshesAsDirty(t){const b=this.et();if(b.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const Z=b.meshes;for(const J of Z)if(J.Wb)for(const Z of J.Wb){if((Z.Kt()||(b._hasDefaultMaterial?b.defaultMaterial:null))===this)for(const b of Z._drawWrappers)b&&b.defines&&b.defines.markAllAsDirty&&this._materialContext===b.materialContext&&t(b.defines)}}_markScenePrePassDirty(){if(this.et().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.et().enablePrePassRenderer();t&&t.og()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(k._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(k._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(k._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(k._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(k._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(k._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(k._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(k._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(k._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(k._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const t=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.lb.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(t)}))}}setPrePassRenderer(t){return!1}dispose(t,b,Z){const J=this.et();if(J.stopAnimation(this),J.freeProcessedMaterials(),J.removeMaterial(this),this._eventInfo.forceDisposeTextures=b,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const t=this._parentContainer.materials.indexOf(this);t>-1&&this._parentContainer.materials.splice(t,1),this._parentContainer=null}if(!0!==Z)if(this.meshMap)for(const S in this.meshMap){const t=this.meshMap[S];this._disposeMeshResources(t)}else{const t=J.meshes;for(const b of t)this._disposeMeshResources(b)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.lb.notifyObservers(this),this.lb.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(t){if(!t)return;const b=t.qb,Z=t._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(t.Wb&&Z)for(const S of t.Wb){const t=S._drawWrappers;for(let P=0;P<t.length;P++){var J;const v=null===(J=t[P])||void 0===J?void 0:J.effect;if(!v)continue;Z[P]===this&&(null===b||void 0===b||b._releaseVertexArrayObject(v),S._removeDrawWrapper(P,!0,!0))}}}else null===b||void 0===b||b._releaseVertexArrayObject(this._drawWrapper.effect);t.material!==this||t.sourceMesh||(t.material=null)}serialize(){const t=M.d.Serialize(this);return t.Ub=this.Ub.serialize(),t.uniqueId=this.uniqueId,this._serializePlugins(t),t}_serializePlugins(t){if(t.plugins={},this.pluginManager)for(const b of this.pluginManager._plugins)b.doNotSerialize||(t.plugins[b.getClassName()]=b.serialize())}static Parse(t,b,Z){if(t.customType){if("BABYLON.PBRMaterial"===t.customType&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return g.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else t.customType="BABYLON.StandardMaterial";const J=P.Tools.Instantiate(t.customType).Parse(t,b,Z);return J._loadedUniqueId=t.uniqueId,J}static _ParsePlugins(t,b,Z,J){if(t.plugins)for(const h in t.plugins){var S,v;const C=t.plugins[h];let Y=null===(S=b.pluginManager)||void 0===S?void 0:S.getPlugin(C.name);if(!Y){const t=P.Tools.Instantiate("BABYLON."+h);t&&(Y=new t(b))}null===(v=Y)||void 0===v||v.parse(C,Z,J)}}}k.TriangleFillMode=0,k.WireFrameFillMode=1,k.PointFillMode=2,k.PointListDrawMode=3,k.LineListDrawMode=4,k.LineLoopDrawMode=5,k.LineStripDrawMode=6,k.TriangleStripDrawMode=7,k.TriangleFanDrawMode=8,k.ClockWiseSideOrientation=0,k.CounterClockWiseSideOrientation=1,k.ImageProcessingDirtyFlag=64,k.TextureDirtyFlag=1,k.LightDirtyFlag=2,k.FresnelDirtyFlag=4,k.AttributesDirtyFlag=8,k.MiscDirtyFlag=16,k.PrePassDirtyFlag=32,k.AllDirtyFlag=127,k.MATERIAL_OPAQUE=0,k.MATERIAL_ALPHATEST=1,k.MATERIAL_ALPHABLEND=2,k.MATERIAL_ALPHATESTANDBLEND=3,k.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,k.MATERIAL_NORMALBLENDMETHOD_RNM=1,k.OnEventObservable=new v.d,k._AllDirtyCallBack=t=>t.markAllAsDirty(),k._ImageProcessingDirtyCallBack=t=>t.markAsImageProcessingDirty(),k._TextureDirtyCallBack=t=>t.markAsTexturesDirty(),k._FresnelDirtyCallBack=t=>t.markAsFresnelDirty(),k._MiscDirtyCallBack=t=>t.markAsMiscDirty(),k._PrePassDirtyCallBack=t=>t.markAsPrePassDirty(),k._LightsDirtyCallBack=t=>t.markAsLightDirty(),k._AttributeDirtyCallBack=t=>t.markAsAttributesDirty(),k._FresnelAndMiscDirtyCallBack=t=>{k._FresnelDirtyCallBack(t),k._MiscDirtyCallBack(t)},k._TextureAndMiscDirtyCallBack=t=>{k._TextureDirtyCallBack(t),k._MiscDirtyCallBack(t)},k._DirtyCallbackArray=[],k._RunDirtyCallBacks=t=>{for(const b of k._DirtyCallbackArray)b(t)},(0,J.e)([(0,S.N)()],k.prototype,"id",void 0),(0,J.e)([(0,S.N)()],k.prototype,"uniqueId",void 0),(0,J.e)([(0,S.N)()],k.prototype,"name",void 0),(0,J.e)([(0,S.N)()],k.prototype,"metadata",void 0),(0,J.e)([(0,S.N)()],k.prototype,"checkReadyOnEveryCall",void 0),(0,J.e)([(0,S.N)()],k.prototype,"checkReadyOnlyOnce",void 0),(0,J.e)([(0,S.N)()],k.prototype,"state",void 0),(0,J.e)([(0,S.N)("alpha")],k.prototype,"_alpha",void 0),(0,J.e)([(0,S.N)("Nb")],k.prototype,"_backFaceCulling",void 0),(0,J.e)([(0,S.N)("cullBackFaces")],k.prototype,"_cullBackFaces",void 0),(0,J.e)([(0,S.N)()],k.prototype,"sideOrientation",void 0),(0,J.e)([(0,S.N)("alphaMode")],k.prototype,"_alphaMode",void 0),(0,J.e)([(0,S.N)()],k.prototype,"_needDepthPrePass",void 0),(0,J.e)([(0,S.N)()],k.prototype,"disableDepthWrite",void 0),(0,J.e)([(0,S.N)()],k.prototype,"disableColorWrite",void 0),(0,J.e)([(0,S.N)()],k.prototype,"forceDepthWrite",void 0),(0,J.e)([(0,S.N)()],k.prototype,"depthFunction",void 0),(0,J.e)([(0,S.N)()],k.prototype,"separateCullingPass",void 0),(0,J.e)([(0,S.N)("fogEnabled")],k.prototype,"_fogEnabled",void 0),(0,J.e)([(0,S.N)()],k.prototype,"pointSize",void 0),(0,J.e)([(0,S.N)()],k.prototype,"zOffset",void 0),(0,J.e)([(0,S.N)()],k.prototype,"zOffsetUnits",void 0),(0,J.e)([(0,S.N)()],k.prototype,"pointsCloud",null),(0,J.e)([(0,S.N)()],k.prototype,"fillMode",null),(0,J.e)([(0,S.N)()],k.prototype,"useLogarithmicDepth",null),(0,J.e)([(0,S.N)()],k.prototype,"transparencyMode",null)},13098:(t,b,Z)=>{Z.d(b,{B:()=>o,D:()=>O,E:()=>M,I:()=>r,M:()=>n,P:()=>V,Q:()=>W,R:()=>u,U:()=>e,X:()=>y,_:()=>d,ab:()=>s,d:()=>E,db:()=>Q,g:()=>I,gb:()=>T,k:()=>H,m:()=>g,n:()=>a,q:()=>k,s:()=>l,v:()=>p,z:()=>U});var J=Z(12557),S=Z(12775),P=Z(12585),v=Z(13031),h=Z(13107);const C=S.hZ.Black(),Y={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function g(t,b,Z){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){const t=Z.activeCamera;1===t.mode&&J.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),b.setFloat("logarithmicDepthConstant",2/(Math.log(t.maxZ+1)/Math.LN2))}}function I(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Z&&t.fogEnabled&&(!b||b.applyFog)&&0!==t.fogMode&&(Z.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),J?(t.fogColor.toLinearSpaceToRef(C,t.getEngine().useExactSrgbConversions),Z.setColor3("vFogColor",C)):Z.setColor3("vFogColor",t.fogColor))}function r(t,b,Z,J,S,P,v,h,C,g){const I=t.numMaxInfluencers||t.numInfluencers;return I<=0?0:(b.push("#define MORPHTARGETS"),t.hasPositions&&b.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),t.hasNormals&&b.push("#define MORPHTARGETTEXTURE_HASNORMALS"),t.hasTangents&&b.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),t.hasUVs&&b.push("#define MORPHTARGETTEXTURE_HASUVS"),t.hasUV2s&&b.push("#define MORPHTARGETTEXTURE_HASUV2S"),t.hasColors&&b.push("#define MORPHTARGETTEXTURE_HASCOLORS"),t.supportsPositions&&S&&b.push("#define MORPHTARGETS_POSITION"),t.supportsNormals&&P&&b.push("#define MORPHTARGETS_NORMAL"),t.supportsTangents&&v&&b.push("#define MORPHTARGETS_TANGENT"),t.supportsUVs&&h&&b.push("#define MORPHTARGETS_UV"),t.supportsUV2s&&C&&b.push("#define MORPHTARGETS_UV2"),t.supportsColors&&g&&b.push("#define MORPHTARGETS_COLOR"),b.push("#define NUM_MORPH_INFLUENCERS "+I),t.isUsingTextureForTargets&&b.push("#define MORPHTARGETS_TEXTURE"),Y.NUM_MORPH_INFLUENCERS=I,Y.NORMAL=P,Y.TANGENT=v,Y.UV=h,Y.UV2=C,Y.COLOR=g,M(Z,J,Y,S),I)}function M(t,b,Z){let S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=Z.NUM_MORPH_INFLUENCERS;if(v>0&&P.e.LastCreatedEngine){const h=P.e.LastCreatedEngine.getCaps().maxVertexAttribs,C=b.morphTargetManager;if(null!==C&&void 0!==C&&C.isUsingTextureForTargets)return;const Y=C&&C.supportsPositions&&S,g=C&&C.supportsNormals&&Z.NORMAL,I=C&&C.supportsTangents&&Z.TANGENT,r=C&&C.supportsUVs&&Z.UV1,M=C&&C.supportsUV2s&&Z.UV2,T=C&&C.supportsColors&&Z.VERTEXCOLOR;for(let Z=0;Z<v;Z++)Y&&t.push("position"+Z),g&&t.push("normal"+Z),I&&t.push("tangent"+Z),r&&t.push("uv_"+Z),M&&t.push("uv2_"+Z),T&&t.push("color"+Z),t.length>h&&J.c.Error("Cannot add more vertex attributes for mesh "+b.name)}}function T(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),b&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function a(t,b){const Z=t.morphTargetManager;t&&Z&&b.setFloatArray("morphTargetInfluences",Z.influences)}function k(t,b){b.bindToEffect(t,"Scene")}function u(t,b,Z){b._needUVs=!0,b[Z]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(b[Z+"DIRECTUV"]=t.coordinatesIndex+1,b["MAINUV"+(t.coordinatesIndex+1)]=!0):b[Z+"DIRECTUV"]=0}function l(t,b,Z){const J=t.getTextureMatrix();b.yb(Z+"Matrix",J)}function U(t,b,Z){Z.BAKED_VERTEX_ANIMATION_TEXTURE&&Z.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function E(t,b,Z){var J;if(b&&t&&(t.computeBonesUsingShaders&&b._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){const S=t.skeleton;if(S.isUsingTextureForMatrices&&b.getUniformIndex("boneTextureWidth")>-1){const Z=S.getTransformMatrixTexture(t);b.setTexture("boneSampler",Z),b.setFloat("boneTextureWidth",4*(S.bones.length+1))}else{const P=S.getTransformMatrices(t);P&&(b.setMatrices("mBones",P),Z&&t.et().prePassRenderer&&t.et().prePassRenderer.getIndex(2)&&(Z.previousBones[t.uniqueId]||(Z.previousBones[t.uniqueId]=P.slice()),b.setMatrices("mPreviousBones",Z.previousBones[t.uniqueId]),J=P,Z.previousBones[t.uniqueId].set(J)))}}}function c(t,b,Z,J,S){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];t._bindLight(b,Z,J,S,P)}function H(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const P=Math.min(b.lightSources.length,S);for(let v=0;v<P;v++){c(b.lightSources[v],v,t,Z,"boolean"===typeof J?J:J.SPECULARTERM,b.receiveShadows)}}function o(t,b,Z,J){Z.NUM_BONE_INFLUENCERS>0&&(J.addCPUSkinningFallback(0,b),t.push("matricesIndices"),t.push("matricesWeights"),Z.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function O(t,b){(b.INSTANCES||b.THIN_INSTANCES)&&T(t,!!b.PREPASS_VELOCITY),b.INSTANCESCOLOR&&t.push("instanceColor")}function p(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=0;for(let P=0;P<Z&&t["LIGHT"+P];P++)P>0&&(S=J+P,b.addFallback(S,"LIGHT"+P)),t.SHADOWS||(t["SHADOW"+P]&&b.addFallback(J,"SHADOW"+P),t["SHADOWPCF"+P]&&b.addFallback(J,"SHADOWPCF"+P),t["SHADOWPCSS"+P]&&b.addFallback(J,"SHADOWPCSS"+P),t["SHADOWPOISSON"+P]&&b.addFallback(J,"SHADOWPOISSON"+P),t["SHADOWESM"+P]&&b.addFallback(J,"SHADOWESM"+P),t["SHADOWCLOSEESM"+P]&&b.addFallback(J,"SHADOWCLOSEESM"+P));return S++}function e(t,b,Z,J,S,P,v){let h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];v._areMiscDirty&&(v.LOGARITHMICDEPTH=Z,v.POINTSIZE=J,v.FOG=S&&function(t,b){return b.fogEnabled&&t.applyFog&&0!==b.fogMode}(t,b),v.NONUNIFORMSCALING=t.nonUniformScaling,v.ALPHATEST=P,v.DECAL_AFTER_DETAIL=h)}function W(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z._areLightsDirty)return Z._needNormals;let v=0;const h={needNormals:Z._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!P)for(const Y of b.lightSources)if(j(t,b,Y,v,Z,J,h),v++,v===S)break;Z.SPECULARTERM=h.specularEnabled,Z.SHADOWS=h.shadowEnabled;for(let Y=v;Y<S;Y++)void 0!==Z["LIGHT"+Y]&&(Z["LIGHT"+Y]=!1,Z["HEMILIGHT"+Y]=!1,Z["POINTLIGHT"+Y]=!1,Z["DIRLIGHT"+Y]=!1,Z["SPOTLIGHT"+Y]=!1,Z["AREALIGHT"+Y]=!1,Z["SHADOW"+Y]=!1,Z["SHADOWCSM"+Y]=!1,Z["SHADOWCSMDEBUG"+Y]=!1,Z["SHADOWCSMNUM_CASCADES"+Y]=!1,Z["SHADOWCSMUSESHADOWMAXZ"+Y]=!1,Z["SHADOWCSMNOBLEND"+Y]=!1,Z["SHADOWCSM_RIGHTHANDED"+Y]=!1,Z["SHADOWPCF"+Y]=!1,Z["SHADOWPCSS"+Y]=!1,Z["SHADOWPOISSON"+Y]=!1,Z["SHADOWESM"+Y]=!1,Z["SHADOWCLOSEESM"+Y]=!1,Z["SHADOWCUBE"+Y]=!1,Z["SHADOWLOWQUALITY"+Y]=!1,Z["SHADOWMEDIUMQUALITY"+Y]=!1);const C=t.getEngine().getCaps();return void 0===Z.SHADOWFLOAT&&(h.needRebuild=!0),Z.SHADOWFLOAT=h.shadowEnabled&&(C.textureFloatRender&&C.textureFloatLinearFiltering||C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering),Z.LIGHTMAPEXCLUDED=h.lightmapMode,h.needRebuild&&Z.rebuild(),h.needNormals}function j(t,b,Z,J,S,P,h){switch(h.needNormals=!0,void 0===S["LIGHT"+J]&&(h.needRebuild=!0),S["LIGHT"+J]=!0,S["SPOTLIGHT"+J]=!1,S["HEMILIGHT"+J]=!1,S["POINTLIGHT"+J]=!1,S["DIRLIGHT"+J]=!1,S["AREALIGHT"+J]=!1,Z.prepareLightSpecificDefines(S,J),S["LIGHT_FALLOFF_PHYSICAL"+J]=!1,S["LIGHT_FALLOFF_GLTF"+J]=!1,S["LIGHT_FALLOFF_STANDARD"+J]=!1,Z.falloffType){case v.e.FALLOFF_GLTF:S["LIGHT_FALLOFF_GLTF"+J]=!0;break;case v.e.FALLOFF_PHYSICAL:S["LIGHT_FALLOFF_PHYSICAL"+J]=!0;break;case v.e.FALLOFF_STANDARD:S["LIGHT_FALLOFF_STANDARD"+J]=!0}if(P&&!Z.bI.equalsFloats(0,0,0)&&(h.specularEnabled=!0),S["SHADOW"+J]=!1,S["SHADOWCSM"+J]=!1,S["SHADOWCSMDEBUG"+J]=!1,S["SHADOWCSMNUM_CASCADES"+J]=!1,S["SHADOWCSMUSESHADOWMAXZ"+J]=!1,S["SHADOWCSMNOBLEND"+J]=!1,S["SHADOWCSM_RIGHTHANDED"+J]=!1,S["SHADOWPCF"+J]=!1,S["SHADOWPCSS"+J]=!1,S["SHADOWPOISSON"+J]=!1,S["SHADOWESM"+J]=!1,S["SHADOWCLOSEESM"+J]=!1,S["SHADOWCUBE"+J]=!1,S["SHADOWLOWQUALITY"+J]=!1,S["SHADOWMEDIUMQUALITY"+J]=!1,b&&b.receiveShadows&&t.shadowsEnabled&&Z.shadowEnabled){const b=Z.getShadowGenerator(t.activeCamera)??Z.getShadowGenerator();if(b){const t=b.getShadowMap();t&&t.renderList&&t.renderList.length>0&&(h.shadowEnabled=!0,b.prepareDefines(S,J))}}Z.lightmapMode!=v.e.LIGHTMAP_DEFAULT?(h.lightmapMode=!0,S["LIGHTMAPEXCLUDED"+J]=!0,S["LIGHTMAPNOSPECULAR"+J]=Z.lightmapMode==v.e.LIGHTMAP_SHADOWSONLY):(S["LIGHTMAPEXCLUDED"+J]=!1,S["LIGHTMAPNOSPECULAR"+J]=!1)}function V(t,b,Z,J,S){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=function(t,b){let Z=!1;if(t.activeCamera){const J=b.CAMERA_ORTHOGRAPHIC?1:0,S=b.CAMERA_PERSPECTIVE?1:0,P=1===t.activeCamera.mode?1:0,v=0===t.activeCamera.mode?1:0;(J^P||S^v)&&(b.CAMERA_ORTHOGRAPHIC=1===P,b.CAMERA_PERSPECTIVE=1===v,Z=!0)}return Z}(t,J);!1!==P&&(C=(0,h.i)(Z,t,J)),J.DEPTHPREPASS!==!b.getColorWrite()&&(J.DEPTHPREPASS=!J.DEPTHPREPASS,C=!0),J.INSTANCES!==S&&(J.INSTANCES=S,C=!0),J.THIN_INSTANCES!==v&&(J.THIN_INSTANCES=v,C=!0),C&&J.markAsUnprocessed()}function n(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!b._areAttributesDirty&&b._needNormals===b._normals&&b._needUVs===b._uvs)return!1;b._normals=b._needNormals,b._uvs=b._needUVs,b.NORMAL=b._needNormals&&t.isVerticesDataPresent("normal"),b._needNormals&&t.isVerticesDataPresent("tangent")&&(b.TANGENT=!0);for(let h=1;h<=6;++h)b["UV"+h]=!!b._needUVs&&t.isVerticesDataPresent(`uv${1===h?"":h}`);if(Z){const Z=t.useVertexColors&&t.isVerticesDataPresent("color");b.VERTEXCOLOR=Z,b.VERTEXALPHA=t.hasVertexAlpha&&Z&&P}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(b.INSTANCESCOLOR=!0),J&&function(t,b){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){b.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;const Z=void 0!==b.BONETEXTURE;if(t.skeleton.isUsingTextureForMatrices&&Z)b.BONETEXTURE=!0;else{b.BonesPerMesh=t.skeleton.bones.length+1,b.BONETEXTURE=!Z&&void 0;const J=t.et().prePassRenderer;if(J&&J.enabled){const Z=-1===J.excludedSkinnedMesh.indexOf(t);b.BONES_VELOCITY_ENABLED=Z}}}else b.NUM_BONE_INFLUENCERS=0,b.BonesPerMesh=0,void 0!==b.BONETEXTURE&&(b.BONETEXTURE=!1)}(t,b),S&&function(t,b){const Z=t.morphTargetManager;Z?(b.MORPHTARGETS_UV=Z.supportsUVs&&b.UV1,b.MORPHTARGETS_UV2=Z.supportsUV2s&&b.UV2,b.MORPHTARGETS_TANGENT=Z.supportsTangents&&b.TANGENT,b.MORPHTARGETS_NORMAL=Z.supportsNormals&&b.NORMAL,b.MORPHTARGETS_POSITION=Z.supportsPositions,b.MORPHTARGETS_COLOR=Z.supportsColors,b.MORPHTARGETTEXTURE_HASUVS=Z.hasUVs,b.MORPHTARGETTEXTURE_HASUV2S=Z.hasUV2s,b.MORPHTARGETTEXTURE_HASTANGENTS=Z.hasTangents,b.MORPHTARGETTEXTURE_HASNORMALS=Z.hasNormals,b.MORPHTARGETTEXTURE_HASPOSITIONS=Z.hasPositions,b.MORPHTARGETTEXTURE_HASCOLORS=Z.hasColors,b.NUM_MORPH_INFLUENCERS=Z.numMaxInfluencers||Z.numInfluencers,b.MORPHTARGETS=b.NUM_MORPH_INFLUENCERS>0,b.MORPHTARGETS_TEXTURE=Z.isUsingTextureForTargets):(b.MORPHTARGETS_UV=!1,b.MORPHTARGETS_UV2=!1,b.MORPHTARGETS_TANGENT=!1,b.MORPHTARGETS_NORMAL=!1,b.MORPHTARGETS_POSITION=!1,b.MORPHTARGETS_COLOR=!1,b.MORPHTARGETTEXTURE_HASUVS=!1,b.MORPHTARGETTEXTURE_HASUV2S=!1,b.MORPHTARGETTEXTURE_HASTANGENTS=!1,b.MORPHTARGETTEXTURE_HASNORMALS=!1,b.MORPHTARGETTEXTURE_HASPOSITIONS=!1,b.MORPHTARGETTEXTURE_HAS_COLORS=!1,b.MORPHTARGETS=!1,b.NUM_MORPH_INFLUENCERS=0)}(t,b),v&&function(t,b){const Z=t.bakedVertexAnimationManager;b.BAKED_VERTEX_ANIMATION_TEXTURE=!(!Z||!Z.isEnabled)}(t,b),!0}function y(t,b){if(t.activeCamera){const Z=b.MULTIVIEW;b.MULTIVIEW=null!==t.activeCamera.outputRenderTarget&&t.activeCamera.outputRenderTarget.getViewCount()>1,b.MULTIVIEW!=Z&&b.markAsUnprocessed()}}function d(t,b,Z){const J=b.ORDER_INDEPENDENT_TRANSPARENCY,S=b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;b.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&Z,b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,J===b.ORDER_INDEPENDENT_TRANSPARENCY&&S===b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||b.markAsUnprocessed()}function s(t,b,Z){const J=b.PREPASS;if(!b._arePrePassDirty)return;const S=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&Z){b.PREPASS=!0,b.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,b.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,b.PREPASS_COLOR=!0,b.PREPASS_COLOR_INDEX=0;for(let Z=0;Z<S.length;Z++){const J=t.prePassRenderer.getIndex(S[Z].type);-1!==J?(b[S[Z].define]=!0,b[S[Z].index]=J):b[S[Z].define]=!1}}else{b.PREPASS=!1;for(let t=0;t<S.length;t++)b[S[t].define]=!1}b.PREPASS!=J&&(b.markAsUnprocessed(),b.markAsImageProcessingDirty())}function q(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6];S&&S.push("Light"+t),P||(b.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightWidth"+t,"vLightHeight"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),Z.push("shadowTexture"+t),Z.push("depthTexture"+t),b.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),J&&(Z.push("projectionLightTexture"+t),b.push("textureProjectionMatrix"+t)),v&&Z.push("iesLightTexture"+t))}function Q(t,b,Z){let J,S,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(t.uniformsNames){const v=t;J=v.uniformsNames,S=v.uniformBuffersNames,b=v.samplers,Z=v.defines,P=v.maxSimultaneousLights||0}else J=t,b||(b=[]);for(let v=0;v<P&&Z["LIGHT"+v];v++)q(v,J,b,Z["PROJECTEDLIGHTTEXTURE"+v],S,!1,Z["IESLIGHTTEXTURE"+v]);Z.NUM_MORPH_INFLUENCERS&&(J.push("morphTargetInfluences"),J.push("morphTargetCount")),Z.BAKED_VERTEX_ANIMATION_TEXTURE&&(J.push("bakedVertexAnimationSettings"),J.push("bakedVertexAnimationTextureSizeInverted"),J.push("bakedVertexAnimationTime"),b.push("bakedVertexAnimationTexture"))}},13046:(t,b,Z)=>{Z.d(b,{b:()=>P});var J=Z(12735),S=Z(13052);class P extends S.c{constructor(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(t,b,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new J.Matrix,this._storeEffectOnSubMeshes=Z}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(t,b){return!!t&&(!this._storeEffectOnSubMeshes||(!t.Wb||0===t.Wb.length||this.isReadyForSubMesh(t,t.Wb[0],b)))}_isReadyForSubMesh(t){const b=t.materialDefines;return!(this.checkReadyOnEveryCall||!t.effect||!b||b._renderId!==this.et().getRenderId())}bindOnlyWorldMatrix(t){this._activeEffect.setMatrix("world",t)}bindOnlyNormalMatrix(t){this._activeEffect.setMatrix("normalMatrix",t)}bind(t,b){b&&this.bindForSubMesh(t,b,b.Wb[0])}_afterBind(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;super._afterBind(t,b,Z),this.et()._cachedEffect=b,Z?Z._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Z._drawWrapper._forceRebindOnNextCall||t.isCachedMaterialInvalid(this,b,J)}dispose(t,b,Z){this._activeEffect=void 0,super.dispose(t,b,Z)}}},13089:(t,b,Z)=>{Z.d(b,{e:()=>h,h:()=>C});var J=Z(12721),S=Z(12735),P=Z(12726);class v{static extractMinAndMaxIndexed(t,b,Z,J,S,P){for(let v=Z;v<Z+J;v++){const Z=3*b[v],J=t[Z],h=t[Z+1],C=t[Z+2];S.minimizeInPlaceFromFloats(J,h,C),P.maximizeInPlaceFromFloats(J,h,C)}}static extractMinAndMax(t,b,Z,J,S,P){for(let v=b,h=b*J;v<b+Z;v++,h+=J){const b=t[h],Z=t[h+1],J=t[h+2];S.minimizeInPlaceFromFloats(b,Z,J),P.maximizeInPlaceFromFloats(b,Z,J)}}}function h(t,b,Z,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const h=new S.JZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new S.JZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return v.extractMinAndMaxIndexed(t,b,Z,J,h,C),P&&(h.x-=h.x*P.x+P.y,h.y-=h.y*P.x+P.y,h.z-=h.z*P.x+P.y,C.x+=C.x*P.x+P.y,C.y+=C.y*P.x+P.y,C.z+=C.z*P.x+P.y),{minimum:h,maximum:C}}function C(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0;const h=new S.JZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new S.JZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return P||(P=3),v.extractMinAndMax(t,b,Z,P,h,C),J&&(h.x-=h.x*J.x+J.y,h.y-=h.y*J.x+J.y,h.z-=h.z*J.x+J.y,C.x+=C.x*J.x+J.y,C.y+=C.y*J.x+J.y,C.z+=C.z*J.x+J.y),{minimum:h,maximum:C}}(0,J.e)([P.e.filter((function(){for(var t=arguments.length,b=new Array(t),Z=0;Z<t;Z++)b[Z]=arguments[Z];let[J,S]=b;return!Array.isArray(J)&&!Array.isArray(S)}))],v,"extractMinAndMaxIndexed",null),(0,J.e)([P.e.filter((function(){for(var t=arguments.length,b=new Array(t),Z=0;Z<t;Z++)b[Z]=arguments[Z];let[J]=b;return!Array.isArray(J)}))],v,"extractMinAndMax",null)},13061:(t,b,Z)=>{Z.d(b,{c:()=>C});var J=Z(12800),S=Z(13070),P=Z(13079),v=Z(13089),h=Z(12848);class C{get materialDefines(){var t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(t=this._getDrawWrapper())||void 0===t?void 0:t.defines}set materialDefines(t){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=t}_getDrawWrapper(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t??this._engine.currentRenderPassId;let Z=this._drawWrappers[t];return!Z&&b&&(this._drawWrappers[t]=Z=new h.e(this._mesh.et().getEngine())),Z}_removeDrawWrapper(t){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var Z;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(Z=this._drawWrappers[t])||void 0===Z||Z.dispose(b));this._drawWrappers[t]=void 0}get effect(){var t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(t=this._getDrawWrapper())||void 0===t?void 0:t.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(t){this._mainDrawWrapperOverride=t}setEffect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=this._drawWrapper;S.setEffect(t,b,J),void 0!==Z&&(S.materialContext=Z),t||(S.defines=null,S.materialContext=void 0)}resetDrawCache(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==t)return void this._removeDrawWrapper(t,!0,b);for(const t of this._drawWrappers)null===t||void 0===t||t.dispose(b)}this._drawWrappers=[]}static AddToMesh(t,b,Z,J,S,P,v){return new C(t,b,Z,J,S,P,v,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(t,b,Z,J,S,P,v){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],C=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=t,this.verticesStart=b,this.verticesCount=Z,this.indexStart=J,this.indexCount=S,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=P,this._renderingMesh=v||P,C&&P.Wb.push(this),this._engine=this._mesh.et().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=P.Wb.length-1,h&&(this.refreshBoundingInfo(),P.sb(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(t){return this._boundingInfo=t,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh}Kt(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!b)return t&&this._mesh.et()._hasDefaultMaterial?this._mesh.et().defaultMaterial:null;if(this._isMultiMaterial(b)){const t=b.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this.resetDrawCache()),t}return b}_isMultiMaterial(t){return void 0!==t.getSubMaterial}refreshBoundingInfo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.qb)return this;if(t||(t=this._renderingMesh.getVerticesData(J.g.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const b=this._renderingMesh.Qb();let Z;if(0===this.indexStart&&this.indexCount===b.length){const t=this._renderingMesh.getBoundingInfo();Z={minimum:t.minimum.clone(),maximum:t.maximum.clone()}}else Z=(0,v.e)(t,b,this.indexStart,this.indexCount,this._renderingMesh.qb.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(Z.minimum,Z.maximum):this._boundingInfo=new P.d(Z.minimum,Z.maximum),this}_checkCollision(t){return this.getBoundingInfo()._checkCollision(t)}updateBoundingInfo(t){let b=this.getBoundingInfo();return b||(this.refreshBoundingInfo(),b=this.getBoundingInfo()),b&&b.update(t),this}isInFrustum(t){const b=this.getBoundingInfo();return!!b&&b.isInFrustum(t,this._mesh.Jr)}isCompletelyInFrustum(t){const b=this.getBoundingInfo();return!!b&&b.isCompletelyInFrustum(t)}render(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(t,b){if(!this._linesIndexBuffer){const Z=6*Math.floor(this.indexCount/3),J=this.verticesStart+this.verticesCount>65535?new Uint32Array(Z):new Uint16Array(Z);let S=0;if(0===t.length)for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)J[S++]=t,J[S++]=t+1,J[S++]=t+1,J[S++]=t+2,J[S++]=t+2,J[S++]=t;else for(let b=this.indexStart;b<this.indexStart+this.indexCount;b+=3)J[S++]=t[b],J[S++]=t[b+1],J[S++]=t[b+1],J[S++]=t[b+2],J[S++]=t[b+2],J[S++]=t[b];this._linesIndexBuffer=b.createIndexBuffer(J),this._linesIndexCount=J.length}return this._linesIndexBuffer}canIntersects(t){const b=this.getBoundingInfo();return!!b&&t.intersectsBox(b.boundingBox)}intersects(t,b,Z,J,S){const P=this.Kt();if(!P)return null;let v=3,h=!1;switch(P.fillMode){case 3:case 5:case 6:case 8:return null;case 7:v=1,h=!0}return 4===P.fillMode?Z.length?this._intersectLines(t,b,Z,this._mesh.intersectionThreshold,J):this._intersectUnIndexedLines(t,b,Z,this._mesh.intersectionThreshold,J):!Z.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,b,Z,J,S):this._intersectTriangles(t,b,Z,v,h,J,S)}_intersectLines(t,b,Z,J,P){let v=null;for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=2){const C=b[Z[h]],Y=b[Z[h+1]],g=t.intersectionSegment(C,Y,J);if(!(g<0)&&((P||!v||g<v.distance)&&(v=new S.c(null,null,g),v.faceId=h/2,P)))break}return v}_intersectUnIndexedLines(t,b,Z,J,P){let v=null;for(let h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=2){const Z=b[h],C=b[h+1],Y=t.intersectionSegment(Z,C,J);if(!(Y<0)&&((P||!v||Y<v.distance)&&(v=new S.c(null,null,Y),v.faceId=h/2,P)))break}return v}_intersectTriangles(t,b,Z,J,S,P,v){let h=null,C=-1;for(let Y=this.indexStart;Y<this.indexStart+this.indexCount-(3-J);Y+=J){C++;const J=Z[Y],g=Z[Y+1],I=Z[Y+2];if(S&&4294967295===I){Y+=2;continue}const r=b[J],M=b[g],T=b[I];if(!r||!M||!T)continue;if(v&&!v(r,M,T,t,J,g,I))continue;const a=t.intersectsTriangle(r,M,T);if(a){if(a.distance<0)continue;if((P||!h||a.distance<h.distance)&&(h=a,h.faceId=C,P))break}}return h}_intersectUnIndexedTriangles(t,b,Z,J,S){let P=null;for(let v=this.verticesStart;v<this.verticesStart+this.verticesCount;v+=3){const Z=b[v],h=b[v+1],C=b[v+2];if(S&&!S(Z,h,C,t,-1,-1,-1))continue;const Y=t.intersectsTriangle(Z,h,C);if(Y){if(Y.distance<0)continue;if((J||!P||Y.distance<P.distance)&&(P=Y,P.faceId=v/3,J))break}}return P}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(t,b){const Z=new C(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,b,!1);if(!this.IsGlobal){const t=this.getBoundingInfo();if(!t)return Z;Z._boundingInfo=new P.d(t.minimum,t.maximum)}return Z}dispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.et().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const b=this._mesh.Wb.indexOf(this);this._mesh.Wb.splice(b,1),this.resetDrawCache(void 0,t)}getClassName(){return"SubMesh"}static CreateFromIndices(t,b,Z,J,S){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],v=Number.MAX_VALUE,h=-Number.MAX_VALUE;const Y=(S||J).Qb();for(let C=b;C<b+Z;C++){const t=Y[C];t<v&&(v=t),t>h&&(h=t)}return new C(t,v,h-v+1,b,Z,J,S,P)}}}}]);