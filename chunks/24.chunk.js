"use strict";(self.ufnpnb83drd=self.ufnpnb83drd||[]).push([[24],{12672:(E,U,g)=>{g.d(U,{d:()=>N});class N{constructor(E,U,g){this.bu=E,this.bv=U,this.distance=g,this.faceId=0,this.subMeshId=0}}},12682:(E,U,g)=>{g.d(U,{d:()=>S});var N=g(12345),L=g(12334),D=g(12336);class S{constructor(E,U,g){this.vectors=(0,N.b)(8,L.dU.Zero),this.center=L.dU.Zero(),this.centerWorld=L.dU.Zero(),this.extendSize=L.dU.Zero(),this.extendSizeWorld=L.dU.Zero(),this.directions=(0,N.b)(3,L.dU.Zero),this.vectorsWorld=(0,N.b)(8,L.dU.Zero),this.minimumWorld=L.dU.Zero(),this.maximumWorld=L.dU.Zero(),this.minimum=L.dU.Zero(),this.maximum=L.dU.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(E,U,g)}reConstruct(E,U,g){const N=E.x,D=E.y,S=E.z,u=U.x,s=U.y,C=U.z,B=this.vectors;this.minimum.du(N,D,S),this.maximum.du(u,s,C),B[0].du(N,D,S),B[1].du(u,s,C),B[2].du(u,D,S),B[3].du(N,s,S),B[4].du(N,D,C),B[5].du(u,s,S),B[6].du(N,s,C),B[7].du(u,D,C),U.addToRef(E,this.center).scaleInPlace(.5),U.subtractToRef(E,this.extendSize).scaleInPlace(.5),this._worldMatrix=g||L.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(E){const U=S._TmpVector3,g=this.maximum.subtractToRef(this.minimum,U[0]),N=g.length();g.normalizeFromLength(N);const L=N*E,D=g.scaleInPlace(.5*L),u=this.center.subtractToRef(D,U[1]),s=this.center.addToRef(D,U[2]);return this.reConstruct(u,s,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){const U=this.minimumWorld,g=this.maximumWorld,N=this.directions,D=this.vectorsWorld,S=this.vectors;if(E.isIdentity()){U.D(this.minimum),g.D(this.maximum);for(let E=0;E<8;++E)D[E].D(S[E]);this.extendSizeWorld.D(this.extendSize),this.centerWorld.D(this.center)}else{U.yu(Number.MAX_VALUE),g.yu(-Number.MAX_VALUE);for(let N=0;N<8;++N){const u=D[N];L.dU.TransformCoordinatesToRef(S[N],E,u),U.minimizeInPlace(u),g.maximizeInPlace(u)}g.subtractToRef(U,this.extendSizeWorld).scaleInPlace(.5),g.addToRef(U,this.centerWorld).scaleInPlace(.5)}L.dU.FromArrayToRef(E.m,0,N[0]),L.dU.FromArrayToRef(E.m,4,N[1]),L.dU.FromArrayToRef(E.m,8,N[2]),this._worldMatrix=E}isInFrustum(E){return S.IsInFrustum(this.vectorsWorld,E)}isCompletelyInFrustum(E){return S.IsCompletelyInFrustum(this.vectorsWorld,E)}intersectsPoint(E){const U=this.minimumWorld,g=this.maximumWorld,N=U.x,L=U.y,S=U.z,u=g.x,s=g.y,C=g.z,B=E.x,P=E.y,F=E.z,f=-D.c;return!(u-B<f||f>B-N)&&(!(s-P<f||f>P-L)&&!(C-F<f||f>F-S))}intersectsSphere(E){return S.IntersectsSphere(this.minimumWorld,this.maximumWorld,E.centerWorld,E.radiusWorld)}intersectsMinMax(E,U){const g=this.minimumWorld,N=this.maximumWorld,L=g.x,D=g.y,S=g.z,u=N.x,s=N.y,C=N.z,B=E.x,P=E.y,F=E.z,f=U.x,d=U.y,I=U.z;return!(u<B||L>f)&&(!(s<P||D>d)&&!(C<F||S>I))}dispose(){var E,U;null===(E=this._drawWrapperFront)||void 0===E||E.dispose(),null===(U=this._drawWrapperBack)||void 0===U||U.dispose()}static Intersects(E,U){return E.intersectsMinMax(U.minimumWorld,U.maximumWorld)}static IntersectsSphere(E,U,g,N){const D=S._TmpVector3[0];L.dU.ClampToRef(g,E,U,D);return L.dU.DistanceSquared(g,D)<=N*N}static IsCompletelyInFrustum(E,U){for(let g=0;g<6;++g){const N=U[g];for(let U=0;U<8;++U)if(N.dotCoordinate(E[U])<0)return!1}return!0}static IsInFrustum(E,U){for(let g=0;g<6;++g){let N=!0;const L=U[g];for(let U=0;U<8;++U)if(L.dotCoordinate(E[U])>=0){N=!1;break}if(N)return!1}return!0}}S._TmpVector3=(0,N.b)(3,L.dU.Zero)},12675:(E,U,g)=>{g.d(U,{b:()=>P});var N=g(12345),L=g(12334),D=g(12682),S=g(12684);const u={min:0,max:0},s={min:0,max:0},C=(E,U,g)=>{const N=L.dU.Dot(U.centerWorld,E),D=Math.abs(L.dU.Dot(U.directions[0],E))*U.extendSize.x+Math.abs(L.dU.Dot(U.directions[1],E))*U.extendSize.y+Math.abs(L.dU.Dot(U.directions[2],E))*U.extendSize.z;g.min=N-D,g.max=N+D},B=(E,U,g)=>(C(E,U,u),C(E,g,s),!(u.min>s.max||s.min>u.max));class P{constructor(E,U,g){this._isLocked=!1,this.boundingBox=new D.d(E,U,g),this.boundingSphere=new S.d(E,U,g)}reConstruct(E,U,g){this.boundingBox.reConstruct(E,U,g),this.boundingSphere.reConstruct(E,U,g)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(E){this._isLocked=E}update(E){this._isLocked||(this.boundingBox._update(E),this.boundingSphere._update(E))}centerOn(E,U){const g=P._TmpVector3[0].D(E).iB(U),N=P._TmpVector3[1].D(E).addInPlace(U);return this.boundingBox.reConstruct(g,N,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(g,N,this.boundingBox.getWorldMatrix()),this}encapsulate(E){const U=L.dU.Minimize(this.minimum,E),g=L.dU.Maximize(this.maximum,E);return this.reConstruct(U,g,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(E){const U=L.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(U);const g=L.TmpVectors.dU[0];return L.dU.TransformCoordinatesToRef(E.boundingBox.minimumWorld,U,g),this.encapsulate(g),L.dU.TransformCoordinatesToRef(E.boundingBox.maximumWorld,U,g),this.encapsulate(g),this}scale(E){return this.boundingBox.scale(E),this.boundingSphere.scale(E),this}isInFrustum(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===U||3===U)&&this.boundingSphere.isCenterInFrustum(E))return!0;if(!this.boundingSphere.isInFrustum(E))return!1;return!(1!==U&&3!==U)||this.boundingBox.isInFrustum(E)}get diagonalLength(){const E=this.boundingBox;return E.maximumWorld.subtractToRef(E.minimumWorld,P._TmpVector3[0]).length()}isCompletelyInFrustum(E){return this.boundingBox.isCompletelyInFrustum(E)}_checkCollision(E){return E._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(E){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(E)&&!!this.boundingBox.intersectsPoint(E))}intersects(E,U){if(!S.d.Intersects(this.boundingSphere,E.boundingSphere))return!1;if(!D.d.Intersects(this.boundingBox,E.boundingBox))return!1;if(!U)return!0;const g=this.boundingBox,N=E.boundingBox;return!!B(g.directions[0],g,N)&&(!!B(g.directions[1],g,N)&&(!!B(g.directions[2],g,N)&&(!!B(N.directions[0],g,N)&&(!!B(N.directions[1],g,N)&&(!!B(N.directions[2],g,N)&&(!!B(L.dU.Cross(g.directions[0],N.directions[0]),g,N)&&(!!B(L.dU.Cross(g.directions[0],N.directions[1]),g,N)&&(!!B(L.dU.Cross(g.directions[0],N.directions[2]),g,N)&&(!!B(L.dU.Cross(g.directions[1],N.directions[0]),g,N)&&(!!B(L.dU.Cross(g.directions[1],N.directions[1]),g,N)&&(!!B(L.dU.Cross(g.directions[1],N.directions[2]),g,N)&&(!!B(L.dU.Cross(g.directions[2],N.directions[0]),g,N)&&(!!B(L.dU.Cross(g.directions[2],N.directions[1]),g,N)&&!!B(L.dU.Cross(g.directions[2],N.directions[2]),g,N))))))))))))))}}P._TmpVector3=(0,N.b)(2,L.dU.Zero)},12684:(E,U,g)=>{g.d(U,{d:()=>D});var N=g(12345),L=g(12334);class D{constructor(E,U,g){this.center=L.dU.Zero(),this.centerWorld=L.dU.Zero(),this.minimum=L.dU.Zero(),this.maximum=L.dU.Zero(),this.reConstruct(E,U,g)}reConstruct(E,U,g){this.minimum.D(E),this.maximum.D(U);const N=L.dU.Distance(E,U);U.addToRef(E,this.center).scaleInPlace(.5),this.radius=.5*N,this._update(g||L.Matrix.IdentityReadOnly)}scale(E){const U=this.radius*E,g=D._TmpVector3,N=g[0].yu(U),L=this.center.subtractToRef(N,g[1]),S=this.center.addToRef(N,g[2]);return this.reConstruct(L,S,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(E){if(E.isIdentity())this.centerWorld.D(this.center),this.radiusWorld=this.radius;else{L.dU.TransformCoordinatesToRef(this.center,E,this.centerWorld);const U=D._TmpVector3[0];L.dU.TransformNormalFromFloatsToRef(1,1,1,E,U),this.radiusWorld=Math.max(Math.abs(U.x),Math.abs(U.y),Math.abs(U.z))*this.radius}}isInFrustum(E){const U=this.centerWorld,g=this.radiusWorld;for(let N=0;N<6;N++)if(E[N].dotCoordinate(U)<=-g)return!1;return!0}isCenterInFrustum(E){const U=this.centerWorld;for(let g=0;g<6;g++)if(E[g].dotCoordinate(U)<0)return!1;return!0}intersectsPoint(E){const U=L.dU.DistanceSquared(this.centerWorld,E);return!(this.radiusWorld*this.radiusWorld<U)}static Intersects(E,U){const g=L.dU.DistanceSquared(E.centerWorld,U.centerWorld),N=E.radiusWorld+U.radiusWorld;return!(N*N<g)}static CreateFromCenterAndRadius(E,U,g){this._TmpVector3[0].D(E),this._TmpVector3[1].du(0,0,U),this._TmpVector3[2].D(E),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].iB(this._TmpVector3[1]);const N=new D(this._TmpVector3[0],this._TmpVector3[2]);return N._worldMatrix=g||L.Matrix.Identity(),N}}D._TmpVector3=(0,N.b)(3,L.dU.Zero)},12699:(E,U,g)=>{function N(E){-1===E.indexOf("vClipPlane")&&E.push("vClipPlane"),-1===E.indexOf("vClipPlane2")&&E.push("vClipPlane2"),-1===E.indexOf("vClipPlane3")&&E.push("vClipPlane3"),-1===E.indexOf("vClipPlane4")&&E.push("vClipPlane4"),-1===E.indexOf("vClipPlane5")&&E.push("vClipPlane5"),-1===E.indexOf("vClipPlane6")&&E.push("vClipPlane6")}function L(E,U,g){const N=!!(E.clipPlane??U.clipPlane),L=!!(E.clipPlane2??U.clipPlane2),D=!!(E.clipPlane3??U.clipPlane3),S=!!(E.clipPlane4??U.clipPlane4),u=!!(E.clipPlane5??U.clipPlane5),s=!!(E.clipPlane6??U.clipPlane6);N&&g.push("#define CLIPPLANE"),L&&g.push("#define CLIPPLANE2"),D&&g.push("#define CLIPPLANE3"),S&&g.push("#define CLIPPLANE4"),u&&g.push("#define CLIPPLANE5"),s&&g.push("#define CLIPPLANE6")}function D(E,U,g){let N=!1;const L=!!(E.clipPlane??U.clipPlane),D=!!(E.clipPlane2??U.clipPlane2),S=!!(E.clipPlane3??U.clipPlane3),u=!!(E.clipPlane4??U.clipPlane4),s=!!(E.clipPlane5??U.clipPlane5),C=!!(E.clipPlane6??U.clipPlane6);return g.CLIPPLANE!==L&&(g.CLIPPLANE=L,N=!0),g.CLIPPLANE2!==D&&(g.CLIPPLANE2=D,N=!0),g.CLIPPLANE3!==S&&(g.CLIPPLANE3=S,N=!0),g.CLIPPLANE4!==u&&(g.CLIPPLANE4=u,N=!0),g.CLIPPLANE5!==s&&(g.CLIPPLANE5=s,N=!0),g.CLIPPLANE6!==C&&(g.CLIPPLANE6=C,N=!0),N}function S(E,U,g){let N=U.clipPlane??g.clipPlane;u(E,"vClipPlane",N),N=U.clipPlane2??g.clipPlane2,u(E,"vClipPlane2",N),N=U.clipPlane3??g.clipPlane3,u(E,"vClipPlane3",N),N=U.clipPlane4??g.clipPlane4,u(E,"vClipPlane4",N),N=U.clipPlane5??g.clipPlane5,u(E,"vClipPlane5",N),N=U.clipPlane6??g.clipPlane6,u(E,"vClipPlane6",N)}function u(E,U,g){g&&E.setFloat4(U,g.normal.x,g.normal.y,g.normal.z,g.d)}g.d(U,{d:()=>N,e:()=>S,g:()=>D,k:()=>L})},12646:(E,U,g)=>{g.d(U,{b:()=>N});class N{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(E,U){this._defines[E]||(E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E),this._defines[E]=new Array),this._defines[E].push(U)}addCPUSkinningFallback(E,U){this._mesh=U,E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(E,U){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,E=E.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),U._bonesComputationForcedToCPU=!0;const g=this._mesh.tE();for(let E=0;E<g.meshes.length;E++){const N=g.meshes[E];if(N.material){if(N.computeBonesUsingShaders&&0!==N.numBoneInfluencers)if(N.material.getEffect()===U)N.computeBonesUsingShaders=!1;else if(N.Wg)for(const E of N.Wg){if(E.effect===U){N.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&N.computeBonesUsingShaders&&N.numBoneInfluencers>0&&(N.computeBonesUsingShaders=!1)}}else{const U=this._defines[this._currentRank];if(U)for(let g=0;g<U.length;g++)E=E.replace("#define "+U[g],"");this._currentRank++}return E}}},12656:(E,U,g)=>{g.d(U,{b:()=>y});var N=g(12320),L=g(12322),D=g(12165),S=g(12174),u=g(12205),s=g(12664),C=g(12598),B=g(12186),P=g(12382),F=g(12450),f=g(12367);class d{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(E){this._func=E}get funcRef(){return this._funcRef}set funcRef(E){this._funcRef=E}get funcMask(){return this._funcMask}set funcMask(E){this._funcMask=E}get opStencilFail(){return this._opStencilFail}set opStencilFail(E){this._opStencilFail=E}get opDepthFail(){return this._opDepthFail}set opDepthFail(E){this._opDepthFail=E}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(E){this._opStencilDepthPass=E}get mask(){return this._mask}set mask(E){this._mask=E}get enabled(){return this._enabled}set enabled(E){this._enabled=E}getClassName(){return"MaterialStencilState"}copyTo(E){f.b.Clone((()=>E),this)}serialize(){return f.b.Serialize(this)}parse(E,U,g){f.b.Parse((()=>this),E,U,g)}}(0,N.e)([(0,L.E)()],d.prototype,"func",null),(0,N.e)([(0,L.E)()],d.prototype,"funcRef",null),(0,N.e)([(0,L.E)()],d.prototype,"funcMask",null),(0,N.e)([(0,L.E)()],d.prototype,"opStencilFail",null),(0,N.e)([(0,L.E)()],d.prototype,"opDepthFail",null),(0,N.e)([(0,L.E)()],d.prototype,"opStencilDepthPass",null),(0,N.e)([(0,L.E)()],d.prototype,"mask",null),(0,N.e)([(0,L.E)()],d.prototype,"enabled",null);var I=g(12693);class y{get _supportGlowLayer(){return!1}set _glowModeEnabled(E){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(E){if(this._alpha===E)return;const U=this._alpha;this._alpha=E,1!==U&&1!==E||this.qC(y.MiscDirtyFlag+y.PrePassDirtyFlag)}get alpha(){return this._alpha}set fu(E){this._backFaceCulling!==E&&(this._backFaceCulling=E,this.qC(y.TextureDirtyFlag))}get fu(){return this._backFaceCulling}set cullBackFaces(E){this._cullBackFaces!==E&&(this._cullBackFaces=E,this.qC(y.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(E){this._blockDirtyMechanism!==E&&(this._blockDirtyMechanism=E,E||this.wP())}atomicMaterialsUpdate(E){this.blockDirtyMechanism=!0;try{E(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(E){this._onDisposeObserver&&this.hg.remove(this._onDisposeObserver),this._onDisposeObserver=this.hg.add(E)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.b),this._onBindObservable}set onBind(E){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(E)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new S.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new S.b),this._onEffectCreatedObservable}set alphaMode(E){this._alphaMode!==E&&(this._alphaMode=E,this.qC(y.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(E){this._needDepthPrePass!==E&&(this._needDepthPrePass=E,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(E){this._fogEnabled!==E&&(this._fogEnabled=E,this.qC(y.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case y.WireFrameFillMode:case y.LineListDrawMode:case y.LineLoopDrawMode:case y.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(E){this.fillMode=E?y.WireFrameFillMode:y.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case y.PointFillMode:case y.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(E){this.fillMode=E?y.PointFillMode:y.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(E){this._fillMode!==E&&(this._fillMode=E,this.qC(y.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(E){const U=this.tE().getEngine().getCaps().fragmentDepthSupported;E&&!U&&B.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=E&&U,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(E){this._drawWrapper=E}constructor(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.hg=new S.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Vg=new d,this._useUBO=!1,this._fillMode=y.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=E;const L=U||u.b.LastCreatedScene;L&&(this._scene=L,this._dirtyCallbacks={},this._forceGLSL=N,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=E||D.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new F.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new C.e(this._scene.getEngine(),void 0,void 0,E),this._useUBO=this.tE().getEngine().supportsUniformBuffers,this._createUniformBuffer(),g||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),y.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var E;const U=this.tE().getEngine();null===(E=this._uniformBuffer)||void 0===E||E.dispose(),U.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new C.e(U,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new C.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(E){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.wP(),this.checkReadyOnlyOnce=!0}unfreeze(){this.wP(),this.checkReadyOnlyOnce=!1}isReady(E,U){return!0}isReadyForSubMesh(E,U,g){const N=U.materialDefines;return!!N&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}tE(){return this._scene}_getEffectiveOrientation(E){return null!==this.sideOrientation?this.sideOrientation:E.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(E){this._transparencyMode!==E&&(this._transparencyMode=E,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===y.MATERIAL_ALPHABLEND||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===y.MATERIAL_ALPHATEST||this._transparencyMode===y.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===y.MATERIAL_OPAQUE||this._transparencyMode===y.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsBlend:E.visibility<1||!this._disableAlphaBlending&&(E.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(E){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(E)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}wP(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this.tE().meshes;for(const g of U)if(g.Wg)for(const U of g.Wg)if(U.aE()===this)for(const g of U._drawWrappers)g&&this._materialContext===g.materialContext&&(g._wasPreviouslyReady=!1,g._wasPreviouslyUsingInstances=null,g._forceRebindOnNextCall=E);E&&this.qC(y.AllDirtyFlag)}_preBind(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=this._scene.getEngine(),N=(null==U?this.sideOrientation:U)===y.ClockWiseSideOrientation;return g.enableEffect(E||this._getDrawWrapper()),g.setState(this.fu,this.zOffset,!1,N,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Vg,this.zOffsetUnits),N}bind(E,U){}buildUniformLayout(){const E=this._uniformBuffer;this._eventInfo.ubo=E,this._callbackPluginEventGeneric(8,this._eventInfo),E.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(E,U,g){const N=g._drawWrapper;this._eventInfo.subMesh=g,this._callbackPluginEventBindForSubMesh(this._eventInfo),N._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(E){}bindView(E){this._useUBO?this._needToBindSceneUbo=!0:E.setMatrix("view",this.tE().getViewMatrix())}bindViewProjection(E){this._useUBO?this._needToBindSceneUbo=!0:(E.setMatrix("viewProjection",this.tE().getTransformMatrix()),E.setMatrix("projection",this.tE().getProjectionMatrix()))}bindEyePosition(E,U){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(E,U)}_afterBind(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&U&&(this._needToBindSceneUbo=!1,(0,I.p)(U,this.tE().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=E?E.visibility:1,this._onBindObservable&&E&&this._onBindObservable.notifyObservers(E),this.disableDepthWrite){const E=this._scene.getEngine();this._cachedDepthWriteState=E.getDepthWrite(),E.setDepthWrite(!1)}if(this.disableColorWrite){const E=this._scene.getEngine();this._cachedColorWriteState=E.getColorWrite(),E.setColorWrite(!1)}if(0!==this.depthFunction){const E=this._scene.getEngine();this._cachedDepthFunctionState=E.getDepthFunction()||0,E.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(E){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=E,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(E){return null}_clonePlugins(E,U){const g={};if(this._serializePlugins(g),y._ParsePlugins(g,E,this._scene,U),this.pluginManager)for(const N of this.pluginManager._plugins){const U=E.pluginManager.getPlugin(N.name);U&&N.copyTo(U)}}getBindedMeshes(){if(this.meshMap){const E=[];for(const U in this.meshMap){const g=this.meshMap[U];g&&E.push(g)}return E}return this._scene.meshes.filter((E=>E.material===this))}forceCompilation(E,U,g,N){const L={clipPlane:!1,useInstances:!1,...g},D=this.tE(),S=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const u=()=>{if(!this._scene||!this._scene.getEngine())return;const g=D.clipPlane;if(L.clipPlane&&(D.clipPlane=new P.c(0,0,0,1)),this._storeEffectOnSubMeshes){let g=!0,D=null;if(E.Wg){const U=new s.b(0,0,0,0,0,E,void 0,!1,!1);U.materialDefines&&(U.materialDefines._renderId=-1),this.isReadyForSubMesh(E,U,L.useInstances)||(U.effect&&U.effect.getCompilationError()&&U.effect.allFallbacksProcessed()?D=U.effect.getCompilationError():(g=!1,setTimeout(u,16)))}g&&(this.allowShaderHotSwapping=S,D&&N&&N(D),U&&U(this))}else this.isReady()?(this.allowShaderHotSwapping=S,U&&U(this)):setTimeout(u,16);L.clipPlane&&(D.clipPlane=g)};u()}async forceCompilationAsync(E,U){return await new Promise(((g,N)=>{this.forceCompilation(E,(()=>{g()}),U,(E=>{N(E)}))}))}qC(E){this.tE().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(y._DirtyCallbackArray.length=0,E&y.ImageProcessingDirtyFlag&&y._DirtyCallbackArray.push(y._ImageProcessingDirtyCallBack),E&y.TextureDirtyFlag&&y._DirtyCallbackArray.push(y._TextureDirtyCallBack),E&y.LightDirtyFlag&&y._DirtyCallbackArray.push(y._LightsDirtyCallBack),E&y.FresnelDirtyFlag&&y._DirtyCallbackArray.push(y._FresnelDirtyCallBack),E&y.AttributesDirtyFlag&&y._DirtyCallbackArray.push(y._AttributeDirtyCallBack),E&y.MiscDirtyFlag&&y._DirtyCallbackArray.push(y._MiscDirtyCallBack),E&y.PrePassDirtyFlag&&y._DirtyCallbackArray.push(y._PrePassDirtyCallBack),y._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(y._RunDirtyCallBacks),this.tE().resetCachedMaterial())}resetDrawCache(){const E=this.tE().meshes;for(const U of E)if(U.Wg)for(const E of U.Wg)E.aE()===this&&E.resetDrawCache()}_markAllSubMeshesAsDirty(E){const U=this.tE();if(U.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const g=U.meshes;for(const N of g)if(N.Wg)for(const g of N.Wg){if((g.aE()||(U._hasDefaultMaterial?U.defaultMaterial:null))===this)for(const U of g._drawWrappers)U&&U.defines&&U.defines.markAllAsDirty&&this._materialContext===U.materialContext&&E(U.defines)}}_markScenePrePassDirty(){if(this.tE().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const E=this.tE().enablePrePassRenderer();E&&E.qC()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(y._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(y._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(y._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(y._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(y._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(y._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(y._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(y._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(y._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(y._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const E=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.hg.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(E)}))}}setPrePassRenderer(E){return!1}dispose(E,U,g){const N=this.tE();if(N.stopAnimation(this),N.freeProcessedMaterials(),N.removeMaterial(this),this._eventInfo.forceDisposeTextures=U,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const E=this._parentContainer.materials.indexOf(this);E>-1&&this._parentContainer.materials.splice(E,1),this._parentContainer=null}if(!0!==g)if(this.meshMap)for(const L in this.meshMap){const E=this.meshMap[L];this._disposeMeshResources(E)}else{const E=N.meshes;for(const U of E)this._disposeMeshResources(U)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.hg.notifyObservers(this),this.hg.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(E){if(!E)return;const U=E.XL,g=E._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(E.Wg&&g)for(const L of E.Wg){const E=L._drawWrappers;for(let D=0;D<E.length;D++){var N;const S=null===(N=E[D])||void 0===N?void 0:N.effect;if(!S)continue;g[D]===this&&(null===U||void 0===U||U._releaseVertexArrayObject(S),L._removeDrawWrapper(D,!0,!0))}}}else null===U||void 0===U||U._releaseVertexArrayObject(this._drawWrapper.effect);E.material!==this||E.sourceMesh||(E.material=null)}serialize(){const E=f.b.Serialize(this);return E.Vg=this.Vg.serialize(),E.uniqueId=this.uniqueId,this._serializePlugins(E),E}_serializePlugins(E){if(E.plugins={},this.pluginManager)for(const U of this.pluginManager._plugins)U.doNotSerialize||(E.plugins[U.getClassName()]=U.serialize())}static Parse(E,U,g){if(E.customType){if("BABYLON.PBRMaterial"===E.customType&&E.overloadedAlbedo&&(E.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return B.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else E.customType="BABYLON.StandardMaterial";const N=D.Tools.Instantiate(E.customType).Parse(E,U,g);return N._loadedUniqueId=E.uniqueId,N}static _ParsePlugins(E,U,g,N){if(E.plugins)for(const u in E.plugins){var L,S;const s=E.plugins[u];let C=null===(L=U.pluginManager)||void 0===L?void 0:L.getPlugin(s.name);if(!C){const E=D.Tools.Instantiate("BABYLON."+u);E&&(C=new E(U))}null===(S=C)||void 0===S||S.parse(s,g,N)}}}y.TriangleFillMode=0,y.WireFrameFillMode=1,y.PointFillMode=2,y.PointListDrawMode=3,y.LineListDrawMode=4,y.LineLoopDrawMode=5,y.LineStripDrawMode=6,y.TriangleStripDrawMode=7,y.TriangleFanDrawMode=8,y.ClockWiseSideOrientation=0,y.CounterClockWiseSideOrientation=1,y.ImageProcessingDirtyFlag=64,y.TextureDirtyFlag=1,y.LightDirtyFlag=2,y.FresnelDirtyFlag=4,y.AttributesDirtyFlag=8,y.MiscDirtyFlag=16,y.PrePassDirtyFlag=32,y.AllDirtyFlag=127,y.MATERIAL_OPAQUE=0,y.MATERIAL_ALPHATEST=1,y.MATERIAL_ALPHABLEND=2,y.MATERIAL_ALPHATESTANDBLEND=3,y.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,y.MATERIAL_NORMALBLENDMETHOD_RNM=1,y.OnEventObservable=new S.b,y._AllDirtyCallBack=E=>E.markAllAsDirty(),y._ImageProcessingDirtyCallBack=E=>E.markAsImageProcessingDirty(),y._TextureDirtyCallBack=E=>E.markAsTexturesDirty(),y._FresnelDirtyCallBack=E=>E.markAsFresnelDirty(),y._MiscDirtyCallBack=E=>E.markAsMiscDirty(),y._PrePassDirtyCallBack=E=>E.markAsPrePassDirty(),y._LightsDirtyCallBack=E=>E.markAsLightDirty(),y._AttributeDirtyCallBack=E=>E.markAsAttributesDirty(),y._FresnelAndMiscDirtyCallBack=E=>{y._FresnelDirtyCallBack(E),y._MiscDirtyCallBack(E)},y._TextureAndMiscDirtyCallBack=E=>{y._TextureDirtyCallBack(E),y._MiscDirtyCallBack(E)},y._DirtyCallbackArray=[],y._RunDirtyCallBacks=E=>{for(const U of y._DirtyCallbackArray)U(E)},(0,N.e)([(0,L.E)()],y.prototype,"id",void 0),(0,N.e)([(0,L.E)()],y.prototype,"uniqueId",void 0),(0,N.e)([(0,L.E)()],y.prototype,"name",void 0),(0,N.e)([(0,L.E)()],y.prototype,"metadata",void 0),(0,N.e)([(0,L.E)()],y.prototype,"checkReadyOnEveryCall",void 0),(0,N.e)([(0,L.E)()],y.prototype,"checkReadyOnlyOnce",void 0),(0,N.e)([(0,L.E)()],y.prototype,"state",void 0),(0,N.e)([(0,L.E)("alpha")],y.prototype,"_alpha",void 0),(0,N.e)([(0,L.E)("fu")],y.prototype,"_backFaceCulling",void 0),(0,N.e)([(0,L.E)("cullBackFaces")],y.prototype,"_cullBackFaces",void 0),(0,N.e)([(0,L.E)()],y.prototype,"sideOrientation",void 0),(0,N.e)([(0,L.E)("alphaMode")],y.prototype,"_alphaMode",void 0),(0,N.e)([(0,L.E)()],y.prototype,"_needDepthPrePass",void 0),(0,N.e)([(0,L.E)()],y.prototype,"disableDepthWrite",void 0),(0,N.e)([(0,L.E)()],y.prototype,"disableColorWrite",void 0),(0,N.e)([(0,L.E)()],y.prototype,"forceDepthWrite",void 0),(0,N.e)([(0,L.E)()],y.prototype,"depthFunction",void 0),(0,N.e)([(0,L.E)()],y.prototype,"separateCullingPass",void 0),(0,N.e)([(0,L.E)("fogEnabled")],y.prototype,"_fogEnabled",void 0),(0,N.e)([(0,L.E)()],y.prototype,"pointSize",void 0),(0,N.e)([(0,L.E)()],y.prototype,"zOffset",void 0),(0,N.e)([(0,L.E)()],y.prototype,"zOffsetUnits",void 0),(0,N.e)([(0,L.E)()],y.prototype,"pointsCloud",null),(0,N.e)([(0,L.E)()],y.prototype,"fillMode",null),(0,N.e)([(0,L.E)()],y.prototype,"useLogarithmicDepth",null),(0,N.e)([(0,L.E)()],y.prototype,"transparencyMode",null)},12693:(E,U,g)=>{g.d(U,{B:()=>G,D:()=>f,F:()=>F,G:()=>r,K:()=>c,M:()=>v,O:()=>h,Q:()=>T,T:()=>j,W:()=>Z,_:()=>A,ab:()=>a,bb:()=>d,e:()=>x,f:()=>P,j:()=>Y,k:()=>B,o:()=>I,p:()=>y,t:()=>V,x:()=>b,y:()=>e,z:()=>t});var N=g(12186),L=g(12379),D=g(12205),S=g(12644),u=g(12699);const s=L.VU.Black(),C={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function B(E,U,g){if(!E||E.LOGARITHMICDEPTH||E.indexOf&&E.indexOf("LOGARITHMICDEPTH")>=0){const E=g.activeCamera;1===E.mode&&N.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),U.setFloat("logarithmicDepthConstant",2/(Math.log(E.maxZ+1)/Math.LN2))}}function P(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];g&&E.fogEnabled&&(!U||U.applyFog)&&0!==E.fogMode&&(g.setFloat4("vFogInfos",E.fogMode,E.fogStart,E.fogEnd,E.fogDensity),N?(E.fogColor.toLinearSpaceToRef(s,E.getEngine().useExactSrgbConversions),g.setColor3("vFogColor",s)):g.setColor3("vFogColor",E.fogColor))}function F(E,U,g,N,L,D,S,u,s,B){const P=E.numMaxInfluencers||E.numInfluencers;return P<=0?0:(U.push("#define MORPHTARGETS"),E.hasPositions&&U.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),E.hasNormals&&U.push("#define MORPHTARGETTEXTURE_HASNORMALS"),E.hasTangents&&U.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),E.hasUVs&&U.push("#define MORPHTARGETTEXTURE_HASUVS"),E.hasUV2s&&U.push("#define MORPHTARGETTEXTURE_HASUV2S"),E.hasColors&&U.push("#define MORPHTARGETTEXTURE_HASCOLORS"),E.supportsPositions&&L&&U.push("#define MORPHTARGETS_POSITION"),E.supportsNormals&&D&&U.push("#define MORPHTARGETS_NORMAL"),E.supportsTangents&&S&&U.push("#define MORPHTARGETS_TANGENT"),E.supportsUVs&&u&&U.push("#define MORPHTARGETS_UV"),E.supportsUV2s&&s&&U.push("#define MORPHTARGETS_UV2"),E.supportsColors&&B&&U.push("#define MORPHTARGETS_COLOR"),U.push("#define NUM_MORPH_INFLUENCERS "+P),E.isUsingTextureForTargets&&U.push("#define MORPHTARGETS_TEXTURE"),C.NUM_MORPH_INFLUENCERS=P,C.NORMAL=D,C.TANGENT=S,C.UV=u,C.UV2=s,C.COLOR=B,f(g,N,C,L),P)}function f(E,U,g){let L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=g.NUM_MORPH_INFLUENCERS;if(S>0&&D.b.LastCreatedEngine){const u=D.b.LastCreatedEngine.getCaps().maxVertexAttribs,s=U.morphTargetManager;if(null!==s&&void 0!==s&&s.isUsingTextureForTargets)return;const C=s&&s.supportsPositions&&L,B=s&&s.supportsNormals&&g.NORMAL,P=s&&s.supportsTangents&&g.TANGENT,F=s&&s.supportsUVs&&g.UV1,f=s&&s.supportsUV2s&&g.UV2,d=s&&s.supportsColors&&g.VERTEXCOLOR;for(let g=0;g<S;g++)C&&E.push("position"+g),B&&E.push("normal"+g),P&&E.push("tangent"+g),F&&E.push("uv_"+g),f&&E.push("uv2_"+g),d&&E.push("color"+g),E.length>u&&N.d.Error("Cannot add more vertex attributes for mesh "+U.name)}}function d(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E.push("world0"),E.push("world1"),E.push("world2"),E.push("world3"),U&&(E.push("previousWorld0"),E.push("previousWorld1"),E.push("previousWorld2"),E.push("previousWorld3"))}function I(E,U){const g=E.morphTargetManager;E&&g&&U.setFloatArray("morphTargetInfluences",g.influences)}function y(E,U){U.bindToEffect(E,"Scene")}function h(E,U,g){U._needUVs=!0,U[g]=!0,E.optimizeUVAllocation&&E.getTextureMatrix().isIdentityAs3x2()?(U[g+"DIRECTUV"]=E.coordinatesIndex+1,U["MAINUV"+(E.coordinatesIndex+1)]=!0):U[g+"DIRECTUV"]=0}function V(E,U,g){const N=E.getTextureMatrix();U.zg(g+"Matrix",N)}function e(E,U,g){g.BAKED_VERTEX_ANIMATION_TEXTURE&&g.INSTANCES&&E.push("bakedVertexAnimationSettingsInstanced")}function x(E,U,g){var N;if(U&&E&&(E.computeBonesUsingShaders&&U._bonesComputationForcedToCPU&&(E.computeBonesUsingShaders=!1),E.useBones&&E.computeBonesUsingShaders&&E.skeleton)){const L=E.skeleton;if(L.isUsingTextureForMatrices&&U.getUniformIndex("boneTextureWidth")>-1){const g=L.getTransformMatrixTexture(E);U.setTexture("boneSampler",g),U.setFloat("boneTextureWidth",4*(L.bones.length+1))}else{const D=L.getTransformMatrices(E);D&&(U.setMatrices("mBones",D),g&&E.tE().prePassRenderer&&E.tE().prePassRenderer.getIndex(2)&&(g.previousBones[E.uniqueId]||(g.previousBones[E.uniqueId]=D.slice()),U.setMatrices("mPreviousBones",g.previousBones[E.uniqueId]),N=D,g.previousBones[E.uniqueId].set(N)))}}}function l(E,U,g,N,L){let D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];E._bindLight(U,g,N,L,D)}function Y(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const D=Math.min(U.lightSources.length,L);for(let S=0;S<D;S++){l(U.lightSources[S],S,E,g,"boolean"===typeof N?N:N.SPECULARTERM,U.receiveShadows)}}function t(E,U,g,N){g.NUM_BONE_INFLUENCERS>0&&(N.addCPUSkinningFallback(0,U),E.push("matricesIndices"),E.push("matricesWeights"),g.NUM_BONE_INFLUENCERS>4&&(E.push("matricesIndicesExtra"),E.push("matricesWeightsExtra")))}function G(E,U){(U.INSTANCES||U.THIN_INSTANCES)&&d(E,!!U.PREPASS_VELOCITY),U.INSTANCESCOLOR&&E.push("instanceColor")}function b(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=0;for(let D=0;D<g&&E["LIGHT"+D];D++)D>0&&(L=N+D,U.addFallback(L,"LIGHT"+D)),E.SHADOWS||(E["SHADOW"+D]&&U.addFallback(N,"SHADOW"+D),E["SHADOWPCF"+D]&&U.addFallback(N,"SHADOWPCF"+D),E["SHADOWPCSS"+D]&&U.addFallback(N,"SHADOWPCSS"+D),E["SHADOWPOISSON"+D]&&U.addFallback(N,"SHADOWPOISSON"+D),E["SHADOWESM"+D]&&U.addFallback(N,"SHADOWESM"+D),E["SHADOWCLOSEESM"+D]&&U.addFallback(N,"SHADOWCLOSEESM"+D));return L++}function T(E,U,g,N,L,D,S){let u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];S._areMiscDirty&&(S.LOGARITHMICDEPTH=g,S.POINTSIZE=N,S.FOG=L&&function(E,U){return U.fogEnabled&&E.applyFog&&0!==U.fogMode}(E,U),S.NONUNIFORMSCALING=E.nonUniformScaling,S.ALPHATEST=D,S.DECAL_AFTER_DETAIL=u)}function v(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!g._areLightsDirty)return g._needNormals;let S=0;const u={needNormals:g._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(E.lightsEnabled&&!D)for(const C of U.lightSources)if(o(E,U,C,S,g,N,u),S++,S===L)break;g.SPECULARTERM=u.specularEnabled,g.SHADOWS=u.shadowEnabled;for(let C=S;C<L;C++)void 0!==g["LIGHT"+C]&&(g["LIGHT"+C]=!1,g["HEMILIGHT"+C]=!1,g["POINTLIGHT"+C]=!1,g["DIRLIGHT"+C]=!1,g["SPOTLIGHT"+C]=!1,g["AREALIGHT"+C]=!1,g["SHADOW"+C]=!1,g["SHADOWCSM"+C]=!1,g["SHADOWCSMDEBUG"+C]=!1,g["SHADOWCSMNUM_CASCADES"+C]=!1,g["SHADOWCSMUSESHADOWMAXZ"+C]=!1,g["SHADOWCSMNOBLEND"+C]=!1,g["SHADOWCSM_RIGHTHANDED"+C]=!1,g["SHADOWPCF"+C]=!1,g["SHADOWPCSS"+C]=!1,g["SHADOWPOISSON"+C]=!1,g["SHADOWESM"+C]=!1,g["SHADOWCLOSEESM"+C]=!1,g["SHADOWCUBE"+C]=!1,g["SHADOWLOWQUALITY"+C]=!1,g["SHADOWMEDIUMQUALITY"+C]=!1);const s=E.getEngine().getCaps();return void 0===g.SHADOWFLOAT&&(u.needRebuild=!0),g.SHADOWFLOAT=u.shadowEnabled&&(s.textureFloatRender&&s.textureFloatLinearFiltering||s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering),g.LIGHTMAPEXCLUDED=u.lightmapMode,u.needRebuild&&g.rebuild(),u.needNormals}function o(E,U,g,N,L,D,u){switch(u.needNormals=!0,void 0===L["LIGHT"+N]&&(u.needRebuild=!0),L["LIGHT"+N]=!0,L["SPOTLIGHT"+N]=!1,L["HEMILIGHT"+N]=!1,L["POINTLIGHT"+N]=!1,L["DIRLIGHT"+N]=!1,L["AREALIGHT"+N]=!1,g.prepareLightSpecificDefines(L,N),L["LIGHT_FALLOFF_PHYSICAL"+N]=!1,L["LIGHT_FALLOFF_GLTF"+N]=!1,L["LIGHT_FALLOFF_STANDARD"+N]=!1,g.falloffType){case S.c.FALLOFF_GLTF:L["LIGHT_FALLOFF_GLTF"+N]=!0;break;case S.c.FALLOFF_PHYSICAL:L["LIGHT_FALLOFF_PHYSICAL"+N]=!0;break;case S.c.FALLOFF_STANDARD:L["LIGHT_FALLOFF_STANDARD"+N]=!0}if(D&&!g.uB.equalsFloats(0,0,0)&&(u.specularEnabled=!0),L["SHADOW"+N]=!1,L["SHADOWCSM"+N]=!1,L["SHADOWCSMDEBUG"+N]=!1,L["SHADOWCSMNUM_CASCADES"+N]=!1,L["SHADOWCSMUSESHADOWMAXZ"+N]=!1,L["SHADOWCSMNOBLEND"+N]=!1,L["SHADOWCSM_RIGHTHANDED"+N]=!1,L["SHADOWPCF"+N]=!1,L["SHADOWPCSS"+N]=!1,L["SHADOWPOISSON"+N]=!1,L["SHADOWESM"+N]=!1,L["SHADOWCLOSEESM"+N]=!1,L["SHADOWCUBE"+N]=!1,L["SHADOWLOWQUALITY"+N]=!1,L["SHADOWMEDIUMQUALITY"+N]=!1,U&&U.receiveShadows&&E.shadowsEnabled&&g.shadowEnabled){const U=g.getShadowGenerator(E.activeCamera)??g.getShadowGenerator();if(U){const E=U.getShadowMap();E&&E.renderList&&E.renderList.length>0&&(u.shadowEnabled=!0,U.prepareDefines(L,N))}}g.lightmapMode!=S.c.LIGHTMAP_DEFAULT?(u.lightmapMode=!0,L["LIGHTMAPEXCLUDED"+N]=!0,L["LIGHTMAPNOSPECULAR"+N]=g.lightmapMode==S.c.LIGHTMAP_SHADOWSONLY):(L["LIGHTMAPEXCLUDED"+N]=!1,L["LIGHTMAPNOSPECULAR"+N]=!1)}function c(E,U,g,N,L){let D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=function(E,U){let g=!1;if(E.activeCamera){const N=U.CAMERA_ORTHOGRAPHIC?1:0,L=U.CAMERA_PERSPECTIVE?1:0,D=1===E.activeCamera.mode?1:0,S=0===E.activeCamera.mode?1:0;(N^D||L^S)&&(U.CAMERA_ORTHOGRAPHIC=1===D,U.CAMERA_PERSPECTIVE=1===S,g=!0)}return g}(E,N);!1!==D&&(s=(0,u.g)(g,E,N)),N.DEPTHPREPASS!==!U.getColorWrite()&&(N.DEPTHPREPASS=!N.DEPTHPREPASS,s=!0),N.INSTANCES!==L&&(N.INSTANCES=L,s=!0),N.THIN_INSTANCES!==S&&(N.THIN_INSTANCES=S,s=!0),s&&N.markAsUnprocessed()}function r(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!U._areAttributesDirty&&U._needNormals===U._normals&&U._needUVs===U._uvs)return!1;U._normals=U._needNormals,U._uvs=U._needUVs,U.NORMAL=U._needNormals&&E.isVerticesDataPresent("normal"),U._needNormals&&E.isVerticesDataPresent("tangent")&&(U.TANGENT=!0);for(let u=1;u<=6;++u)U["UV"+u]=!!U._needUVs&&E.isVerticesDataPresent(`uv${1===u?"":u}`);if(g){const g=E.useVertexColors&&E.isVerticesDataPresent("color");U.VERTEXCOLOR=g,U.VERTEXALPHA=E.hasVertexAlpha&&g&&D}return E.isVerticesDataPresent("instanceColor")&&(E.hasInstances||E.hasThinInstances)&&(U.INSTANCESCOLOR=!0),N&&function(E,U){if(E.useBones&&E.computeBonesUsingShaders&&E.skeleton){U.NUM_BONE_INFLUENCERS=E.numBoneInfluencers;const g=void 0!==U.BONETEXTURE;if(E.skeleton.isUsingTextureForMatrices&&g)U.BONETEXTURE=!0;else{U.BonesPerMesh=E.skeleton.bones.length+1,U.BONETEXTURE=!g&&void 0;const N=E.tE().prePassRenderer;if(N&&N.enabled){const g=-1===N.excludedSkinnedMesh.indexOf(E);U.BONES_VELOCITY_ENABLED=g}}}else U.NUM_BONE_INFLUENCERS=0,U.BonesPerMesh=0,void 0!==U.BONETEXTURE&&(U.BONETEXTURE=!1)}(E,U),L&&function(E,U){const g=E.morphTargetManager;g?(U.MORPHTARGETS_UV=g.supportsUVs&&U.UV1,U.MORPHTARGETS_UV2=g.supportsUV2s&&U.UV2,U.MORPHTARGETS_TANGENT=g.supportsTangents&&U.TANGENT,U.MORPHTARGETS_NORMAL=g.supportsNormals&&U.NORMAL,U.MORPHTARGETS_POSITION=g.supportsPositions,U.MORPHTARGETS_COLOR=g.supportsColors,U.MORPHTARGETTEXTURE_HASUVS=g.hasUVs,U.MORPHTARGETTEXTURE_HASUV2S=g.hasUV2s,U.MORPHTARGETTEXTURE_HASTANGENTS=g.hasTangents,U.MORPHTARGETTEXTURE_HASNORMALS=g.hasNormals,U.MORPHTARGETTEXTURE_HASPOSITIONS=g.hasPositions,U.MORPHTARGETTEXTURE_HASCOLORS=g.hasColors,U.NUM_MORPH_INFLUENCERS=g.numMaxInfluencers||g.numInfluencers,U.MORPHTARGETS=U.NUM_MORPH_INFLUENCERS>0,U.MORPHTARGETS_TEXTURE=g.isUsingTextureForTargets):(U.MORPHTARGETS_UV=!1,U.MORPHTARGETS_UV2=!1,U.MORPHTARGETS_TANGENT=!1,U.MORPHTARGETS_NORMAL=!1,U.MORPHTARGETS_POSITION=!1,U.MORPHTARGETS_COLOR=!1,U.MORPHTARGETTEXTURE_HASUVS=!1,U.MORPHTARGETTEXTURE_HASUV2S=!1,U.MORPHTARGETTEXTURE_HASTANGENTS=!1,U.MORPHTARGETTEXTURE_HASNORMALS=!1,U.MORPHTARGETTEXTURE_HASPOSITIONS=!1,U.MORPHTARGETTEXTURE_HAS_COLORS=!1,U.MORPHTARGETS=!1,U.NUM_MORPH_INFLUENCERS=0)}(E,U),S&&function(E,U){const g=E.bakedVertexAnimationManager;U.BAKED_VERTEX_ANIMATION_TEXTURE=!(!g||!g.isEnabled)}(E,U),!0}function j(E,U){if(E.activeCamera){const g=U.MULTIVIEW;U.MULTIVIEW=null!==E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1,U.MULTIVIEW!=g&&U.markAsUnprocessed()}}function Z(E,U,g){const N=U.ORDER_INDEPENDENT_TRANSPARENCY,L=U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;U.ORDER_INDEPENDENT_TRANSPARENCY=E.useOrderIndependentTransparency&&g,U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!E.getEngine().getCaps().textureFloatLinearFiltering,N===U.ORDER_INDEPENDENT_TRANSPARENCY&&L===U.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||U.markAsUnprocessed()}function A(E,U,g){const N=U.PREPASS;if(!U._arePrePassDirty)return;const L=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(E.prePassRenderer&&E.prePassRenderer.enabled&&g){U.PREPASS=!0,U.SCENE_MRT_COUNT=E.prePassRenderer.mrtCount,U.PREPASS_NORMAL_WORLDSPACE=E.prePassRenderer.generateNormalsInWorldSpace,U.PREPASS_COLOR=!0,U.PREPASS_COLOR_INDEX=0;for(let g=0;g<L.length;g++){const N=E.prePassRenderer.getIndex(L[g].type);-1!==N?(U[L[g].define]=!0,U[L[g].index]=N):U[L[g].define]=!1}}else{U.PREPASS=!1;for(let E=0;E<L.length;E++)U[L[E].define]=!1}U.PREPASS!=N&&(U.markAsUnprocessed(),U.markAsImageProcessingDirty())}function w(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];L&&L.push("Light"+E),D||(U.push("vLightData"+E,"vLightDiffuse"+E,"vLightSpecular"+E,"vLightDirection"+E,"vLightWidth"+E,"vLightHeight"+E,"vLightFalloff"+E,"vLightGround"+E,"lightMatrix"+E,"shadowsInfo"+E,"depthValues"+E),g.push("shadowTexture"+E),g.push("depthTexture"+E),U.push("viewFrustumZ"+E,"cascadeBlendFactor"+E,"lightSizeUVCorrection"+E,"depthCorrection"+E,"penumbraDarkness"+E,"frustumLengths"+E),N&&(g.push("projectionLightTexture"+E),U.push("textureProjectionMatrix"+E)),S&&g.push("iesLightTexture"+E))}function a(E,U,g){let N,L,D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(E.uniformsNames){const S=E;N=S.uniformsNames,L=S.uniformBuffersNames,U=S.samplers,g=S.defines,D=S.maxSimultaneousLights||0}else N=E,U||(U=[]);for(let S=0;S<D&&g["LIGHT"+S];S++)w(S,N,U,g["PROJECTEDLIGHTTEXTURE"+S],L,!1,g["IESLIGHTTEXTURE"+S]);g.NUM_MORPH_INFLUENCERS&&(N.push("morphTargetInfluences"),N.push("morphTargetCount")),g.BAKED_VERTEX_ANIMATION_TEXTURE&&(N.push("bakedVertexAnimationSettings"),N.push("bakedVertexAnimationTextureSizeInverted"),N.push("bakedVertexAnimationTime"),U.push("bakedVertexAnimationTexture"))}},12652:(E,U,g)=>{g.d(U,{e:()=>D});var N=g(12334),L=g(12656);class D extends L.b{constructor(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(E,U,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new N.Matrix,this._storeEffectOnSubMeshes=g}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(E,U){return!!E&&(!this._storeEffectOnSubMeshes||(!E.Wg||0===E.Wg.length||this.isReadyForSubMesh(E,E.Wg[0],U)))}_isReadyForSubMesh(E){const U=E.materialDefines;return!(this.checkReadyOnEveryCall||!E.effect||!U||U._renderId!==this.tE().getRenderId())}bindOnlyWorldMatrix(E){this._activeEffect.setMatrix("world",E)}bindOnlyNormalMatrix(E){this._activeEffect.setMatrix("normalMatrix",E)}bind(E,U){U&&this.bindForSubMesh(E,U,U.Wg[0])}_afterBind(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0;super._afterBind(E,U,g),this.tE()._cachedEffect=U,g?g._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return g._drawWrapper._forceRebindOnNextCall||E.isCachedMaterialInvalid(this,U,N)}dispose(E,U,g){this._activeEffect=void 0,super.dispose(E,U,g)}}},12686:(E,U,g)=>{g.d(U,{c:()=>u,g:()=>s});var N=g(12320),L=g(12334),D=g(12322);class S{static extractMinAndMaxIndexed(E,U,g,N,L,D){for(let S=g;S<g+N;S++){const g=3*U[S],N=E[g],u=E[g+1],s=E[g+2];L.minimizeInPlaceFromFloats(N,u,s),D.maximizeInPlaceFromFloats(N,u,s)}}static extractMinAndMax(E,U,g,N,L,D){for(let S=U,u=U*N;S<U+g;S++,u+=N){const U=E[u],g=E[u+1],N=E[u+2];L.minimizeInPlaceFromFloats(U,g,N),D.maximizeInPlaceFromFloats(U,g,N)}}}function u(E,U,g,N){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const u=new L.dU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new L.dU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return S.extractMinAndMaxIndexed(E,U,g,N,u,s),D&&(u.x-=u.x*D.x+D.y,u.y-=u.y*D.x+D.y,u.z-=u.z*D.x+D.y,s.x+=s.x*D.x+D.y,s.y+=s.y*D.x+D.y,s.z+=s.z*D.x+D.y),{minimum:u,maximum:s}}function s(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4?arguments[4]:void 0;const u=new L.dU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new L.dU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return D||(D=3),S.extractMinAndMax(E,U,g,D,u,s),N&&(u.x-=u.x*N.x+N.y,u.y-=u.y*N.x+N.y,u.z-=u.z*N.x+N.y,s.x+=s.x*N.x+N.y,s.y+=s.y*N.x+N.y,s.z+=s.z*N.x+N.y),{minimum:u,maximum:s}}(0,N.e)([D.e.filter((function(){for(var E=arguments.length,U=new Array(E),g=0;g<E;g++)U[g]=arguments[g];let[N,L]=U;return!Array.isArray(N)&&!Array.isArray(L)}))],S,"extractMinAndMaxIndexed",null),(0,N.e)([D.e.filter((function(){for(var E=arguments.length,U=new Array(E),g=0;g<E;g++)U[g]=arguments[g];let[N]=U;return!Array.isArray(N)}))],S,"extractMinAndMax",null)},12664:(E,U,g)=>{g.d(U,{b:()=>s});var N=g(12407),L=g(12672),D=g(12675),S=g(12686),u=g(12450);class s{get materialDefines(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(E=this._getDrawWrapper())||void 0===E?void 0:E.defines}set materialDefines(E){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=E}_getDrawWrapper(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E=E??this._engine.currentRenderPassId;let g=this._drawWrappers[E];return!g&&U&&(this._drawWrappers[E]=g=new u.c(this._mesh.tE().getEngine())),g}_removeDrawWrapper(E){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var g;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(g=this._drawWrappers[E])||void 0===g||g.dispose(U));this._drawWrappers[E]=void 0}get effect(){var E;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(E=this._getDrawWrapper())||void 0===E?void 0:E.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(E){this._mainDrawWrapperOverride=E}setEffect(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=this._drawWrapper;L.setEffect(E,U,N),void 0!==g&&(L.materialContext=g),E||(L.defines=null,L.materialContext=void 0)}resetDrawCache(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==E)return void this._removeDrawWrapper(E,!0,U);for(const E of this._drawWrappers)null===E||void 0===E||E.dispose(U)}this._drawWrappers=[]}static AddToMesh(E,U,g,N,L,D,S){return new s(E,U,g,N,L,D,S,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(E,U,g,N,L,D,S){let u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=E,this.verticesStart=U,this.verticesCount=g,this.indexStart=N,this.indexCount=L,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=D,this._renderingMesh=S||D,s&&D.Wg.push(this),this._engine=this._mesh.tE().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=D.Wg.length-1,u&&(this.refreshBoundingInfo(),D.pg(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(E){return this._boundingInfo=E,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const E=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return E||this._renderingMesh}aE(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const U=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!U)return E&&this._mesh.tE()._hasDefaultMaterial?this._mesh.tE().defaultMaterial:null;if(this._isMultiMaterial(U)){const E=U.getSubMaterial(this.materialIndex);return this._currentMaterial!==E&&(this._currentMaterial=E,this.resetDrawCache()),E}return U}_isMultiMaterial(E){return void 0!==E.getSubMaterial}refreshBoundingInfo(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.XL)return this;if(E||(E=this._renderingMesh.getVerticesData(N.f.PositionKind)),!E)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const U=this._renderingMesh.CD();let g;if(0===this.indexStart&&this.indexCount===U.length){const E=this._renderingMesh.getBoundingInfo();g={minimum:E.minimum.clone(),maximum:E.maximum.clone()}}else g=(0,S.c)(E,U,this.indexStart,this.indexCount,this._renderingMesh.XL.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(g.minimum,g.maximum):this._boundingInfo=new D.b(g.minimum,g.maximum),this}_checkCollision(E){return this.getBoundingInfo()._checkCollision(E)}updateBoundingInfo(E){let U=this.getBoundingInfo();return U||(this.refreshBoundingInfo(),U=this.getBoundingInfo()),U&&U.update(E),this}isInFrustum(E){const U=this.getBoundingInfo();return!!U&&U.isInFrustum(E,this._mesh.sP)}isCompletelyInFrustum(E){const U=this.getBoundingInfo();return!!U&&U.isCompletelyInFrustum(E)}render(E){return this._renderingMesh.render(this,E,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(E,U){if(!this._linesIndexBuffer){const g=6*Math.floor(this.indexCount/3),N=this.verticesStart+this.verticesCount>65535?new Uint32Array(g):new Uint16Array(g);let L=0;if(0===E.length)for(let E=this.indexStart;E<this.indexStart+this.indexCount;E+=3)N[L++]=E,N[L++]=E+1,N[L++]=E+1,N[L++]=E+2,N[L++]=E+2,N[L++]=E;else for(let U=this.indexStart;U<this.indexStart+this.indexCount;U+=3)N[L++]=E[U],N[L++]=E[U+1],N[L++]=E[U+1],N[L++]=E[U+2],N[L++]=E[U+2],N[L++]=E[U];this._linesIndexBuffer=U.createIndexBuffer(N),this._linesIndexCount=N.length}return this._linesIndexBuffer}canIntersects(E){const U=this.getBoundingInfo();return!!U&&E.intersectsBox(U.boundingBox)}intersects(E,U,g,N,L){const D=this.aE();if(!D)return null;let S=3,u=!1;switch(D.fillMode){case 3:case 5:case 6:case 8:return null;case 7:S=1,u=!0}return 4===D.fillMode?g.length?this._intersectLines(E,U,g,this._mesh.intersectionThreshold,N):this._intersectUnIndexedLines(E,U,g,this._mesh.intersectionThreshold,N):!g.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(E,U,g,N,L):this._intersectTriangles(E,U,g,S,u,N,L)}_intersectLines(E,U,g,N,D){let S=null;for(let u=this.indexStart;u<this.indexStart+this.indexCount;u+=2){const s=U[g[u]],C=U[g[u+1]],B=E.intersectionSegment(s,C,N);if(!(B<0)&&((D||!S||B<S.distance)&&(S=new L.d(null,null,B),S.faceId=u/2,D)))break}return S}_intersectUnIndexedLines(E,U,g,N,D){let S=null;for(let u=this.verticesStart;u<this.verticesStart+this.verticesCount;u+=2){const g=U[u],s=U[u+1],C=E.intersectionSegment(g,s,N);if(!(C<0)&&((D||!S||C<S.distance)&&(S=new L.d(null,null,C),S.faceId=u/2,D)))break}return S}_intersectTriangles(E,U,g,N,L,D,S){let u=null,s=-1;for(let C=this.indexStart;C<this.indexStart+this.indexCount-(3-N);C+=N){s++;const N=g[C],B=g[C+1],P=g[C+2];if(L&&4294967295===P){C+=2;continue}const F=U[N],f=U[B],d=U[P];if(!F||!f||!d)continue;if(S&&!S(F,f,d,E,N,B,P))continue;const I=E.intersectsTriangle(F,f,d);if(I){if(I.distance<0)continue;if((D||!u||I.distance<u.distance)&&(u=I,u.faceId=s,D))break}}return u}_intersectUnIndexedTriangles(E,U,g,N,L){let D=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=3){const g=U[S],u=U[S+1],s=U[S+2];if(L&&!L(g,u,s,E,-1,-1,-1))continue;const C=E.intersectsTriangle(g,u,s);if(C){if(C.distance<0)continue;if((N||!D||C.distance<D.distance)&&(D=C,D.faceId=S/3,N))break}}return D}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(E,U){const g=new s(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,E,U,!1);if(!this.IsGlobal){const E=this.getBoundingInfo();if(!E)return g;g._boundingInfo=new D.b(E.minimum,E.maximum)}return g}dispose(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.tE().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const U=this._mesh.Wg.indexOf(this);this._mesh.Wg.splice(U,1),this.resetDrawCache(void 0,E)}getClassName(){return"SubMesh"}static CreateFromIndices(E,U,g,N,L){let D=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=Number.MAX_VALUE,u=-Number.MAX_VALUE;const C=(L||N).CD();for(let s=U;s<U+g;s++){const E=C[s];E<S&&(S=E),E>u&&(u=E)}return new s(E,S,u-S+1,U,g,N,L,D)}}}}]);