"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[24],{12045:(w,o,H)=>{H.d(o,{b:()=>h});class h{constructor(w,o,H){this.bu=w,this.bv=o,this.distance=H,this.faceId=0,this.subMeshId=0}}},12055:(w,o,H)=>{H.d(o,{c:()=>D});var h=H(11727),E=H(11720),e=H(11722);class D{constructor(w,o,H){this.vectors=(0,h.c)(8,E.io.Zero),this.center=E.io.Zero(),this.centerWorld=E.io.Zero(),this.extendSize=E.io.Zero(),this.extendSizeWorld=E.io.Zero(),this.directions=(0,h.c)(3,E.io.Zero),this.vectorsWorld=(0,h.c)(8,E.io.Zero),this.minimumWorld=E.io.Zero(),this.maximumWorld=E.io.Zero(),this.minimum=E.io.Zero(),this.maximum=E.io.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(w,o,H)}reConstruct(w,o,H){const h=w.x,e=w.y,D=w.z,t=o.x,X=o.y,L=o.z,A=this.vectors;this.minimum.We(h,e,D),this.maximum.We(t,X,L),A[0].We(h,e,D),A[1].We(t,X,L),A[2].We(t,e,D),A[3].We(h,X,D),A[4].We(h,e,L),A[5].We(t,X,D),A[6].We(h,X,L),A[7].We(t,e,L),o.addToRef(w,this.center).scaleInPlace(.5),o.subtractToRef(w,this.extendSize).scaleInPlace(.5),this._worldMatrix=H||E.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(w){const o=D._TmpVector3,H=this.maximum.subtractToRef(this.minimum,o[0]),h=H.length();H.normalizeFromLength(h);const E=h*w,e=H.scaleInPlace(.5*E),t=this.center.subtractToRef(e,o[1]),X=this.center.addToRef(e,o[2]);return this.reConstruct(t,X,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){const o=this.minimumWorld,H=this.maximumWorld,h=this.directions,e=this.vectorsWorld,D=this.vectors;if(w.isIdentity()){o.t(this.minimum),H.t(this.maximum);for(let w=0;w<8;++w)e[w].t(D[w]);this.extendSizeWorld.t(this.extendSize),this.centerWorld.t(this.center)}else{o.Ge(Number.MAX_VALUE),H.Ge(-Number.MAX_VALUE);for(let h=0;h<8;++h){const t=e[h];E.io.TransformCoordinatesToRef(D[h],w,t),o.minimizeInPlace(t),H.maximizeInPlace(t)}H.subtractToRef(o,this.extendSizeWorld).scaleInPlace(.5),H.addToRef(o,this.centerWorld).scaleInPlace(.5)}E.io.FromArrayToRef(w.m,0,h[0]),E.io.FromArrayToRef(w.m,4,h[1]),E.io.FromArrayToRef(w.m,8,h[2]),this._worldMatrix=w}isInFrustum(w){return D.IsInFrustum(this.vectorsWorld,w)}isCompletelyInFrustum(w){return D.IsCompletelyInFrustum(this.vectorsWorld,w)}intersectsPoint(w){const o=this.minimumWorld,H=this.maximumWorld,h=o.x,E=o.y,D=o.z,t=H.x,X=H.y,L=H.z,A=w.x,y=w.y,z=w.z,C=-e.c;return!(t-A<C||C>A-h)&&(!(X-y<C||C>y-E)&&!(L-z<C||C>z-D))}intersectsSphere(w){return D.IntersectsSphere(this.minimumWorld,this.maximumWorld,w.centerWorld,w.radiusWorld)}intersectsMinMax(w,o){const H=this.minimumWorld,h=this.maximumWorld,E=H.x,e=H.y,D=H.z,t=h.x,X=h.y,L=h.z,A=w.x,y=w.y,z=w.z,C=o.x,Q=o.y,M=o.z;return!(t<A||E>C)&&(!(X<y||e>Q)&&!(L<z||D>M))}dispose(){var w,o;null===(w=this._drawWrapperFront)||void 0===w||w.dispose(),null===(o=this._drawWrapperBack)||void 0===o||o.dispose()}static Intersects(w,o){return w.intersectsMinMax(o.minimumWorld,o.maximumWorld)}static IntersectsSphere(w,o,H,h){const e=D._TmpVector3[0];E.io.ClampToRef(H,w,o,e);return E.io.DistanceSquared(H,e)<=h*h}static IsCompletelyInFrustum(w,o){for(let H=0;H<6;++H){const h=o[H];for(let o=0;o<8;++o)if(h.dotCoordinate(w[o])<0)return!1}return!0}static IsInFrustum(w,o){for(let H=0;H<6;++H){let h=!0;const E=o[H];for(let o=0;o<8;++o)if(E.dotCoordinate(w[o])>=0){h=!1;break}if(h)return!1}return!0}}D._TmpVector3=(0,h.c)(3,E.io.Zero)},12052:(w,o,H)=>{H.d(o,{c:()=>y});var h=H(11727),E=H(11720),e=H(12055),D=H(12063);const t={min:0,max:0},X={min:0,max:0},L=(w,o,H)=>{const h=E.io.Dot(o.centerWorld,w),e=Math.abs(E.io.Dot(o.directions[0],w))*o.extendSize.x+Math.abs(E.io.Dot(o.directions[1],w))*o.extendSize.y+Math.abs(E.io.Dot(o.directions[2],w))*o.extendSize.z;H.min=h-e,H.max=h+e},A=(w,o,H)=>(L(w,o,t),L(w,H,X),!(t.min>X.max||X.min>t.max));class y{constructor(w,o,H){this._isLocked=!1,this.boundingBox=new e.c(w,o,H),this.boundingSphere=new D.d(w,o,H)}reConstruct(w,o,H){this.boundingBox.reConstruct(w,o,H),this.boundingSphere.reConstruct(w,o,H)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(w){this._isLocked=w}update(w){this._isLocked||(this.boundingBox._update(w),this.boundingSphere._update(w))}centerOn(w,o){const H=y._TmpVector3[0].t(w).wy(o),h=y._TmpVector3[1].t(w).addInPlace(o);return this.boundingBox.reConstruct(H,h,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(H,h,this.boundingBox.getWorldMatrix()),this}encapsulate(w){const o=E.io.Minimize(this.minimum,w),H=E.io.Maximize(this.maximum,w);return this.reConstruct(o,H,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(w){const o=E.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(o);const H=E.TmpVectors.io[0];return E.io.TransformCoordinatesToRef(w.boundingBox.minimumWorld,o,H),this.encapsulate(H),E.io.TransformCoordinatesToRef(w.boundingBox.maximumWorld,o,H),this.encapsulate(H),this}scale(w){return this.boundingBox.scale(w),this.boundingSphere.scale(w),this}isInFrustum(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===o||3===o)&&this.boundingSphere.isCenterInFrustum(w))return!0;if(!this.boundingSphere.isInFrustum(w))return!1;return!(1!==o&&3!==o)||this.boundingBox.isInFrustum(w)}get diagonalLength(){const w=this.boundingBox;return w.maximumWorld.subtractToRef(w.minimumWorld,y._TmpVector3[0]).length()}isCompletelyInFrustum(w){return this.boundingBox.isCompletelyInFrustum(w)}_checkCollision(w){return w._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(w){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(w)&&!!this.boundingBox.intersectsPoint(w))}intersects(w,o){if(!D.d.Intersects(this.boundingSphere,w.boundingSphere))return!1;if(!e.c.Intersects(this.boundingBox,w.boundingBox))return!1;if(!o)return!0;const H=this.boundingBox,h=w.boundingBox;return!!A(H.directions[0],H,h)&&(!!A(H.directions[1],H,h)&&(!!A(H.directions[2],H,h)&&(!!A(h.directions[0],H,h)&&(!!A(h.directions[1],H,h)&&(!!A(h.directions[2],H,h)&&(!!A(E.io.Cross(H.directions[0],h.directions[0]),H,h)&&(!!A(E.io.Cross(H.directions[0],h.directions[1]),H,h)&&(!!A(E.io.Cross(H.directions[0],h.directions[2]),H,h)&&(!!A(E.io.Cross(H.directions[1],h.directions[0]),H,h)&&(!!A(E.io.Cross(H.directions[1],h.directions[1]),H,h)&&(!!A(E.io.Cross(H.directions[1],h.directions[2]),H,h)&&(!!A(E.io.Cross(H.directions[2],h.directions[0]),H,h)&&(!!A(E.io.Cross(H.directions[2],h.directions[1]),H,h)&&!!A(E.io.Cross(H.directions[2],h.directions[2]),H,h))))))))))))))}}y._TmpVector3=(0,h.c)(2,E.io.Zero)},12063:(w,o,H)=>{H.d(o,{d:()=>e});var h=H(11727),E=H(11720);class e{constructor(w,o,H){this.center=E.io.Zero(),this.centerWorld=E.io.Zero(),this.minimum=E.io.Zero(),this.maximum=E.io.Zero(),this.reConstruct(w,o,H)}reConstruct(w,o,H){this.minimum.t(w),this.maximum.t(o);const h=E.io.Distance(w,o);o.addToRef(w,this.center).scaleInPlace(.5),this.radius=.5*h,this._update(H||E.Matrix.IdentityReadOnly)}scale(w){const o=this.radius*w,H=e._TmpVector3,h=H[0].Ge(o),E=this.center.subtractToRef(h,H[1]),D=this.center.addToRef(h,H[2]);return this.reConstruct(E,D,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(w){if(w.isIdentity())this.centerWorld.t(this.center),this.radiusWorld=this.radius;else{E.io.TransformCoordinatesToRef(this.center,w,this.centerWorld);const o=e._TmpVector3[0];E.io.TransformNormalFromFloatsToRef(1,1,1,w,o),this.radiusWorld=Math.max(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z))*this.radius}}isInFrustum(w){const o=this.centerWorld,H=this.radiusWorld;for(let h=0;h<6;h++)if(w[h].dotCoordinate(o)<=-H)return!1;return!0}isCenterInFrustum(w){const o=this.centerWorld;for(let H=0;H<6;H++)if(w[H].dotCoordinate(o)<0)return!1;return!0}intersectsPoint(w){const o=E.io.DistanceSquared(this.centerWorld,w);return!(this.radiusWorld*this.radiusWorld<o)}static Intersects(w,o){const H=E.io.DistanceSquared(w.centerWorld,o.centerWorld),h=w.radiusWorld+o.radiusWorld;return!(h*h<H)}static CreateFromCenterAndRadius(w,o,H){this._TmpVector3[0].t(w),this._TmpVector3[1].We(0,0,o),this._TmpVector3[2].t(w),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].wy(this._TmpVector3[1]);const h=new e(this._TmpVector3[0],this._TmpVector3[2]);return h._worldMatrix=H||E.Matrix.Identity(),h}}e._TmpVector3=(0,h.c)(3,E.io.Zero)},12077:(w,o,H)=>{function h(w){-1===w.indexOf("vClipPlane")&&w.push("vClipPlane"),-1===w.indexOf("vClipPlane2")&&w.push("vClipPlane2"),-1===w.indexOf("vClipPlane3")&&w.push("vClipPlane3"),-1===w.indexOf("vClipPlane4")&&w.push("vClipPlane4"),-1===w.indexOf("vClipPlane5")&&w.push("vClipPlane5"),-1===w.indexOf("vClipPlane6")&&w.push("vClipPlane6")}function E(w,o,H){const h=!!(w.clipPlane??o.clipPlane),E=!!(w.clipPlane2??o.clipPlane2),e=!!(w.clipPlane3??o.clipPlane3),D=!!(w.clipPlane4??o.clipPlane4),t=!!(w.clipPlane5??o.clipPlane5),X=!!(w.clipPlane6??o.clipPlane6);h&&H.push("#define CLIPPLANE"),E&&H.push("#define CLIPPLANE2"),e&&H.push("#define CLIPPLANE3"),D&&H.push("#define CLIPPLANE4"),t&&H.push("#define CLIPPLANE5"),X&&H.push("#define CLIPPLANE6")}function e(w,o,H){let h=!1;const E=!!(w.clipPlane??o.clipPlane),e=!!(w.clipPlane2??o.clipPlane2),D=!!(w.clipPlane3??o.clipPlane3),t=!!(w.clipPlane4??o.clipPlane4),X=!!(w.clipPlane5??o.clipPlane5),L=!!(w.clipPlane6??o.clipPlane6);return H.CLIPPLANE!==E&&(H.CLIPPLANE=E,h=!0),H.CLIPPLANE2!==e&&(H.CLIPPLANE2=e,h=!0),H.CLIPPLANE3!==D&&(H.CLIPPLANE3=D,h=!0),H.CLIPPLANE4!==t&&(H.CLIPPLANE4=t,h=!0),H.CLIPPLANE5!==X&&(H.CLIPPLANE5=X,h=!0),H.CLIPPLANE6!==L&&(H.CLIPPLANE6=L,h=!0),h}function D(w,o,H){let h=o.clipPlane??H.clipPlane;t(w,"vClipPlane",h),h=o.clipPlane2??H.clipPlane2,t(w,"vClipPlane2",h),h=o.clipPlane3??H.clipPlane3,t(w,"vClipPlane3",h),h=o.clipPlane4??H.clipPlane4,t(w,"vClipPlane4",h),h=o.clipPlane5??H.clipPlane5,t(w,"vClipPlane5",h),h=o.clipPlane6??H.clipPlane6,t(w,"vClipPlane6",h)}function t(w,o,H){H&&w.setFloat4(o,H.normal.x,H.normal.y,H.normal.z,H.d)}H.d(o,{c:()=>h,e:()=>D,g:()=>e,j:()=>E})},12022:(w,o,H)=>{H.d(o,{e:()=>h});class h{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(w,o){this._defines[w]||(w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w),this._defines[w]=new Array),this._defines[w].push(o)}addCPUSkinningFallback(w,o){this._mesh=o,w<this._currentRank&&(this._currentRank=w),w>this._maxRank&&(this._maxRank=w)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(w,o){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,w=w.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),o._bonesComputationForcedToCPU=!0;const H=this._mesh.Ow();for(let w=0;w<H.meshes.length;w++){const h=H.meshes[w];if(h.material){if(h.computeBonesUsingShaders&&0!==h.numBoneInfluencers)if(h.material.getEffect()===o)h.computeBonesUsingShaders=!1;else if(h.Le)for(const w of h.Le){if(w.effect===o){h.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&h.computeBonesUsingShaders&&h.numBoneInfluencers>0&&(h.computeBonesUsingShaders=!1)}}else{const o=this._defines[this._currentRank];if(o)for(let H=0;H<o.length;H++)w=w.replace("#define "+o[H],"");this._currentRank++}return w}}},12033:(w,o,H)=>{H.d(o,{e:()=>i});var h=H(11697),E=H(11702),e=H(11531),D=H(11540),t=H(11571),X=H(12038),L=H(11978),A=H(11551),y=H(11766),z=H(11831),C=H(11745);class Q{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(w){this._func=w}get funcRef(){return this._funcRef}set funcRef(w){this._funcRef=w}get funcMask(){return this._funcMask}set funcMask(w){this._funcMask=w}get opStencilFail(){return this._opStencilFail}set opStencilFail(w){this._opStencilFail=w}get opDepthFail(){return this._opDepthFail}set opDepthFail(w){this._opDepthFail=w}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(w){this._opStencilDepthPass=w}get mask(){return this._mask}set mask(w){this._mask=w}get enabled(){return this._enabled}set enabled(w){this._enabled=w}getClassName(){return"MaterialStencilState"}copyTo(w){C.e.Clone((()=>w),this)}serialize(){return C.e.Serialize(this)}parse(w,o,H){C.e.Parse((()=>this),w,o,H)}}(0,h.b)([(0,E.B)()],Q.prototype,"func",null),(0,h.b)([(0,E.B)()],Q.prototype,"funcRef",null),(0,h.b)([(0,E.B)()],Q.prototype,"funcMask",null),(0,h.b)([(0,E.B)()],Q.prototype,"opStencilFail",null),(0,h.b)([(0,E.B)()],Q.prototype,"opDepthFail",null),(0,h.b)([(0,E.B)()],Q.prototype,"opStencilDepthPass",null),(0,h.b)([(0,E.B)()],Q.prototype,"mask",null),(0,h.b)([(0,E.B)()],Q.prototype,"enabled",null);var M=H(12072);class i{get _supportGlowLayer(){return!1}set _glowModeEnabled(w){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(w){if(this._alpha===w)return;const o=this._alpha;this._alpha=w,1!==o&&1!==w||this.dL(i.MiscDirtyFlag+i.PrePassDirtyFlag)}get alpha(){return this._alpha}set Oe(w){this._backFaceCulling!==w&&(this._backFaceCulling=w,this.dL(i.TextureDirtyFlag))}get Oe(){return this._backFaceCulling}set cullBackFaces(w){this._cullBackFaces!==w&&(this._cullBackFaces=w,this.dL(i.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(w){this._blockDirtyMechanism!==w&&(this._blockDirtyMechanism=w,w||this.Ky())}atomicMaterialsUpdate(w){this.blockDirtyMechanism=!0;try{w(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(w){this._onDisposeObserver&&this.me.remove(this._onDisposeObserver),this._onDisposeObserver=this.me.add(w)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new D.b),this._onBindObservable}set onBind(w){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(w)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new D.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new D.b),this._onEffectCreatedObservable}set alphaMode(w){this._alphaMode!==w&&(this._alphaMode=w,this.dL(i.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(w){this._needDepthPrePass!==w&&(this._needDepthPrePass=w,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(w){this._fogEnabled!==w&&(this._fogEnabled=w,this.dL(i.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case i.WireFrameFillMode:case i.LineListDrawMode:case i.LineLoopDrawMode:case i.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(w){this.fillMode=w?i.WireFrameFillMode:i.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case i.PointFillMode:case i.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(w){this.fillMode=w?i.PointFillMode:i.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(w){this._fillMode!==w&&(this._fillMode=w,this.dL(i.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){const o=this.Ow().getEngine().getCaps().fragmentDepthSupported;w&&!o&&A.d.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=w&&o,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(w){this._drawWrapper=w}constructor(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.me=new D.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Q,this._useUBO=!1,this._fillMode=i.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=w;const E=o||t.e.LastCreatedScene;E&&(this._scene=E,this._dirtyCallbacks={},this._forceGLSL=h,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=w||e.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new z.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new L.c(this._scene.getEngine(),void 0,void 0,w),this._useUBO=this.Ow().getEngine().supportsUniformBuffers,this._createUniformBuffer(),H||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),i.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var w;const o=this.Ow().getEngine();null===(w=this._uniformBuffer)||void 0===w||w.dispose(),o.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new L.c(o,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new L.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(w){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Ky(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Ky(),this.checkReadyOnlyOnce=!1}isReady(w,o){return!0}isReadyForSubMesh(w,o,H){const h=o.materialDefines;return!!h&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=h,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Ow(){return this._scene}_getEffectiveOrientation(w){return null!==this.sideOrientation?this.sideOrientation:w.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(w){this._transparencyMode!==w&&(this._transparencyMode=w,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===i.MATERIAL_ALPHABLEND||this._transparencyMode===i.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===i.MATERIAL_ALPHATEST||this._transparencyMode===i.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===i.MATERIAL_OPAQUE||this._transparencyMode===i.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsBlend:w.visibility<1||!this._disableAlphaBlending&&(w.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(w){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(w)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Ky(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o=this.Ow().meshes;for(const H of o)if(H.Le)for(const o of H.Le)if(o.jw()===this)for(const H of o._drawWrappers)H&&this._materialContext===H.materialContext&&(H._wasPreviouslyReady=!1,H._wasPreviouslyUsingInstances=null,H._forceRebindOnNextCall=w);w&&this.dL(i.AllDirtyFlag)}_preBind(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.getEngine(),h=(null==o?this.sideOrientation:o)===i.ClockWiseSideOrientation;return H.enableEffect(w||this._getDrawWrapper()),H.setState(this.Oe,this.zOffset,!1,h,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),h}bind(w,o){}buildUniformLayout(){const w=this._uniformBuffer;this._eventInfo.ubo=w,this._callbackPluginEventGeneric(8,this._eventInfo),w.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(w,o,H){const h=H._drawWrapper;this._eventInfo.subMesh=H,this._callbackPluginEventBindForSubMesh(this._eventInfo),h._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(w){}bindView(w){this._useUBO?this._needToBindSceneUbo=!0:w.setMatrix("view",this.Ow().getViewMatrix())}bindViewProjection(w){this._useUBO?this._needToBindSceneUbo=!0:(w.setMatrix("viewProjection",this.Ow().getTransformMatrix()),w.setMatrix("projection",this.Ow().getProjectionMatrix()))}bindEyePosition(w,o){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(w,o)}_afterBind(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&o&&(this._needToBindSceneUbo=!1,(0,M.n)(o,this.Ow().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=w?w.visibility:1,this._onBindObservable&&w&&this._onBindObservable.notifyObservers(w),this.disableDepthWrite){const w=this._scene.getEngine();this._cachedDepthWriteState=w.getDepthWrite(),w.setDepthWrite(!1)}if(this.disableColorWrite){const w=this._scene.getEngine();this._cachedColorWriteState=w.getColorWrite(),w.setColorWrite(!1)}if(0!==this.depthFunction){const w=this._scene.getEngine();this._cachedDepthFunctionState=w.getDepthFunction()||0,w.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(w){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=w,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(w){return null}_clonePlugins(w,o){const H={};if(this._serializePlugins(H),i._ParsePlugins(H,w,this._scene,o),this.pluginManager)for(const h of this.pluginManager._plugins){const o=w.pluginManager.getPlugin(h.name);o&&h.copyTo(o)}}getBindedMeshes(){if(this.meshMap){const w=[];for(const o in this.meshMap){const H=this.meshMap[o];H&&w.push(H)}return w}return this._scene.meshes.filter((w=>w.material===this))}forceCompilation(w,o,H,h){const E={clipPlane:!1,useInstances:!1,...H},e=this.Ow(),D=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const t=()=>{if(!this._scene||!this._scene.getEngine())return;const H=e.clipPlane;if(E.clipPlane&&(e.clipPlane=new y.c(0,0,0,1)),this._storeEffectOnSubMeshes){let H=!0,e=null;if(w.Le){const o=new X.c(0,0,0,0,0,w,void 0,!1,!1);o.materialDefines&&(o.materialDefines._renderId=-1),this.isReadyForSubMesh(w,o,E.useInstances)||(o.effect&&o.effect.getCompilationError()&&o.effect.allFallbacksProcessed()?e=o.effect.getCompilationError():(H=!1,setTimeout(t,16)))}H&&(this.allowShaderHotSwapping=D,e&&h&&h(e),o&&o(this))}else this.isReady()?(this.allowShaderHotSwapping=D,o&&o(this)):setTimeout(t,16);E.clipPlane&&(e.clipPlane=H)};t()}async forceCompilationAsync(w,o){return await new Promise(((H,h)=>{this.forceCompilation(w,(()=>{H()}),o,(w=>{h(w)}))}))}dL(w){this.Ow().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(i._DirtyCallbackArray.length=0,w&i.ImageProcessingDirtyFlag&&i._DirtyCallbackArray.push(i._ImageProcessingDirtyCallBack),w&i.TextureDirtyFlag&&i._DirtyCallbackArray.push(i._TextureDirtyCallBack),w&i.LightDirtyFlag&&i._DirtyCallbackArray.push(i._LightsDirtyCallBack),w&i.FresnelDirtyFlag&&i._DirtyCallbackArray.push(i._FresnelDirtyCallBack),w&i.AttributesDirtyFlag&&i._DirtyCallbackArray.push(i._AttributeDirtyCallBack),w&i.MiscDirtyFlag&&i._DirtyCallbackArray.push(i._MiscDirtyCallBack),w&i.PrePassDirtyFlag&&i._DirtyCallbackArray.push(i._PrePassDirtyCallBack),i._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(i._RunDirtyCallBacks),this.Ow().resetCachedMaterial())}resetDrawCache(){const w=this.Ow().meshes;for(const o of w)if(o.Le)for(const w of o.Le)w.jw()===this&&w.resetDrawCache()}_markAllSubMeshesAsDirty(w){const o=this.Ow();if(o.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const H=o.meshes;for(const h of H)if(h.Le)for(const H of h.Le){if((H.jw()||(o._hasDefaultMaterial?o.defaultMaterial:null))===this)for(const o of H._drawWrappers)o&&o.defines&&o.defines.markAllAsDirty&&this._materialContext===o.materialContext&&w(o.defines)}}_markScenePrePassDirty(){if(this.Ow().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const w=this.Ow().enablePrePassRenderer();w&&w.dL()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(i._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(i._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(i._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(i._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(i._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(i._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(i._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(i._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(i._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(i._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const w=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.me.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(w)}))}}setPrePassRenderer(w){return!1}dispose(w,o,H){const h=this.Ow();if(h.stopAnimation(this),h.freeProcessedMaterials(),h.removeMaterial(this),this._eventInfo.forceDisposeTextures=o,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const w=this._parentContainer.materials.indexOf(this);w>-1&&this._parentContainer.materials.splice(w,1),this._parentContainer=null}if(!0!==H)if(this.meshMap)for(const E in this.meshMap){const w=this.meshMap[E];this._disposeMeshResources(w)}else{const w=h.meshes;for(const o of w)this._disposeMeshResources(o)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.me.notifyObservers(this),this.me.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(w){if(!w)return;const o=w.re,H=w._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(w.Le&&H)for(const E of w.Le){const w=E._drawWrappers;for(let e=0;e<w.length;e++){var h;const D=null===(h=w[e])||void 0===h?void 0:h.effect;if(!D)continue;H[e]===this&&(null===o||void 0===o||o._releaseVertexArrayObject(D),E._removeDrawWrapper(e,!0,!0))}}}else null===o||void 0===o||o._releaseVertexArrayObject(this._drawWrapper.effect);w.material!==this||w.sourceMesh||(w.material=null)}serialize(){const w=C.e.Serialize(this);return w.stencil=this.stencil.serialize(),w.uniqueId=this.uniqueId,this._serializePlugins(w),w}_serializePlugins(w){if(w.plugins={},this.pluginManager)for(const o of this.pluginManager._plugins)o.doNotSerialize||(w.plugins[o.getClassName()]=o.serialize())}static Parse(w,o,H){if(w.customType){if("BABYLON.PBRMaterial"===w.customType&&w.overloadedAlbedo&&(w.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return A.d.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else w.customType="BABYLON.StandardMaterial";const h=e.Tools.Instantiate(w.customType).Parse(w,o,H);return h._loadedUniqueId=w.uniqueId,h}static _ParsePlugins(w,o,H,h){if(w.plugins)for(const t in w.plugins){var E,D;const X=w.plugins[t];let L=null===(E=o.pluginManager)||void 0===E?void 0:E.getPlugin(X.name);if(!L){const w=e.Tools.Instantiate("BABYLON."+t);w&&(L=new w(o))}null===(D=L)||void 0===D||D.parse(X,H,h)}}}i.TriangleFillMode=0,i.WireFrameFillMode=1,i.PointFillMode=2,i.PointListDrawMode=3,i.LineListDrawMode=4,i.LineLoopDrawMode=5,i.LineStripDrawMode=6,i.TriangleStripDrawMode=7,i.TriangleFanDrawMode=8,i.ClockWiseSideOrientation=0,i.CounterClockWiseSideOrientation=1,i.ImageProcessingDirtyFlag=64,i.TextureDirtyFlag=1,i.LightDirtyFlag=2,i.FresnelDirtyFlag=4,i.AttributesDirtyFlag=8,i.MiscDirtyFlag=16,i.PrePassDirtyFlag=32,i.AllDirtyFlag=127,i.MATERIAL_OPAQUE=0,i.MATERIAL_ALPHATEST=1,i.MATERIAL_ALPHABLEND=2,i.MATERIAL_ALPHATESTANDBLEND=3,i.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,i.MATERIAL_NORMALBLENDMETHOD_RNM=1,i.OnEventObservable=new D.b,i._AllDirtyCallBack=w=>w.markAllAsDirty(),i._ImageProcessingDirtyCallBack=w=>w.markAsImageProcessingDirty(),i._TextureDirtyCallBack=w=>w.markAsTexturesDirty(),i._FresnelDirtyCallBack=w=>w.markAsFresnelDirty(),i._MiscDirtyCallBack=w=>w.markAsMiscDirty(),i._PrePassDirtyCallBack=w=>w.markAsPrePassDirty(),i._LightsDirtyCallBack=w=>w.markAsLightDirty(),i._AttributeDirtyCallBack=w=>w.markAsAttributesDirty(),i._FresnelAndMiscDirtyCallBack=w=>{i._FresnelDirtyCallBack(w),i._MiscDirtyCallBack(w)},i._TextureAndMiscDirtyCallBack=w=>{i._TextureDirtyCallBack(w),i._MiscDirtyCallBack(w)},i._DirtyCallbackArray=[],i._RunDirtyCallBacks=w=>{for(const o of i._DirtyCallbackArray)o(w)},(0,h.b)([(0,E.B)()],i.prototype,"id",void 0),(0,h.b)([(0,E.B)()],i.prototype,"uniqueId",void 0),(0,h.b)([(0,E.B)()],i.prototype,"name",void 0),(0,h.b)([(0,E.B)()],i.prototype,"metadata",void 0),(0,h.b)([(0,E.B)()],i.prototype,"checkReadyOnEveryCall",void 0),(0,h.b)([(0,E.B)()],i.prototype,"checkReadyOnlyOnce",void 0),(0,h.b)([(0,E.B)()],i.prototype,"state",void 0),(0,h.b)([(0,E.B)("alpha")],i.prototype,"_alpha",void 0),(0,h.b)([(0,E.B)("Oe")],i.prototype,"_backFaceCulling",void 0),(0,h.b)([(0,E.B)("cullBackFaces")],i.prototype,"_cullBackFaces",void 0),(0,h.b)([(0,E.B)()],i.prototype,"sideOrientation",void 0),(0,h.b)([(0,E.B)("alphaMode")],i.prototype,"_alphaMode",void 0),(0,h.b)([(0,E.B)()],i.prototype,"_needDepthPrePass",void 0),(0,h.b)([(0,E.B)()],i.prototype,"disableDepthWrite",void 0),(0,h.b)([(0,E.B)()],i.prototype,"disableColorWrite",void 0),(0,h.b)([(0,E.B)()],i.prototype,"forceDepthWrite",void 0),(0,h.b)([(0,E.B)()],i.prototype,"depthFunction",void 0),(0,h.b)([(0,E.B)()],i.prototype,"separateCullingPass",void 0),(0,h.b)([(0,E.B)("fogEnabled")],i.prototype,"_fogEnabled",void 0),(0,h.b)([(0,E.B)()],i.prototype,"pointSize",void 0),(0,h.b)([(0,E.B)()],i.prototype,"zOffset",void 0),(0,h.b)([(0,E.B)()],i.prototype,"zOffsetUnits",void 0),(0,h.b)([(0,E.B)()],i.prototype,"pointsCloud",null),(0,h.b)([(0,E.B)()],i.prototype,"fillMode",null),(0,h.b)([(0,E.B)()],i.prototype,"useLogarithmicDepth",null),(0,h.b)([(0,E.B)()],i.prototype,"transparencyMode",null)},12072:(w,o,H)=>{H.d(o,{C:()=>C,G:()=>z,I:()=>g,L:()=>J,M:()=>W,O:()=>s,P:()=>c,Q:()=>b,T:()=>p,W:()=>f,Z:()=>j,bb:()=>Q,e:()=>k,f:()=>y,g:()=>l,h:()=>A,k:()=>M,n:()=>i,q:()=>V,u:()=>S,v:()=>r,y:()=>O,z:()=>T});var h=H(11551),E=H(11757),e=H(11571),D=H(12016),t=H(12077);const X=E.ko.Black(),L={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function A(w,o,H){if(!w||w.LOGARITHMICDEPTH||w.indexOf&&w.indexOf("LOGARITHMICDEPTH")>=0){const w=H.activeCamera;1===w.mode&&h.d.Error("Logarithmic depth is not compatible with orthographic cameras!",20),o.setFloat("logarithmicDepthConstant",2/(Math.log(w.maxZ+1)/Math.LN2))}}function y(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];H&&w.fogEnabled&&(!o||o.applyFog)&&0!==w.fogMode&&(H.setFloat4("vFogInfos",w.fogMode,w.fogStart,w.fogEnd,w.fogDensity),h?(w.fogColor.toLinearSpaceToRef(X,w.getEngine().useExactSrgbConversions),H.setColor3("vFogColor",X)):H.setColor3("vFogColor",w.fogColor))}function z(w,o,H,h,E,e,D,t,X,A){const y=w.numMaxInfluencers||w.numInfluencers;return y<=0?0:(o.push("#define MORPHTARGETS"),w.hasPositions&&o.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),w.hasNormals&&o.push("#define MORPHTARGETTEXTURE_HASNORMALS"),w.hasTangents&&o.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),w.hasUVs&&o.push("#define MORPHTARGETTEXTURE_HASUVS"),w.hasUV2s&&o.push("#define MORPHTARGETTEXTURE_HASUV2S"),w.hasColors&&o.push("#define MORPHTARGETTEXTURE_HASCOLORS"),w.supportsPositions&&E&&o.push("#define MORPHTARGETS_POSITION"),w.supportsNormals&&e&&o.push("#define MORPHTARGETS_NORMAL"),w.supportsTangents&&D&&o.push("#define MORPHTARGETS_TANGENT"),w.supportsUVs&&t&&o.push("#define MORPHTARGETS_UV"),w.supportsUV2s&&X&&o.push("#define MORPHTARGETS_UV2"),w.supportsColors&&A&&o.push("#define MORPHTARGETS_COLOR"),o.push("#define NUM_MORPH_INFLUENCERS "+y),w.isUsingTextureForTargets&&o.push("#define MORPHTARGETS_TEXTURE"),L.NUM_MORPH_INFLUENCERS=y,L.NORMAL=e,L.TANGENT=D,L.UV=t,L.UV2=X,L.COLOR=A,C(H,h,L,E),y)}function C(w,o,H){let E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const D=H.NUM_MORPH_INFLUENCERS;if(D>0&&e.e.LastCreatedEngine){const t=e.e.LastCreatedEngine.getCaps().maxVertexAttribs,X=o.morphTargetManager;if(null!==X&&void 0!==X&&X.isUsingTextureForTargets)return;const L=X&&X.supportsPositions&&E,A=X&&X.supportsNormals&&H.NORMAL,y=X&&X.supportsTangents&&H.TANGENT,z=X&&X.supportsUVs&&H.UV1,C=X&&X.supportsUV2s&&H.UV2,Q=X&&X.supportsColors&&H.VERTEXCOLOR;for(let H=0;H<D;H++)L&&w.push("position"+H),A&&w.push("normal"+H),y&&w.push("tangent"+H),z&&w.push("uv_"+H),C&&w.push("uv2_"+H),Q&&w.push("color"+H),w.length>t&&h.d.Error("Cannot add more vertex attributes for mesh "+o.name)}}function Q(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w.push("world0"),w.push("world1"),w.push("world2"),w.push("world3"),o&&(w.push("previousWorld0"),w.push("previousWorld1"),w.push("previousWorld2"),w.push("previousWorld3"))}function M(w,o){const H=w.morphTargetManager;w&&H&&o.setFloatArray("morphTargetInfluences",H.influences)}function i(w,o){o.bindToEffect(w,"Scene")}function s(w,o,H){o._needUVs=!0,o[H]=!0,w.optimizeUVAllocation&&w.getTextureMatrix().isIdentityAs3x2()?(o[H+"DIRECTUV"]=w.coordinatesIndex+1,o["MAINUV"+(w.coordinatesIndex+1)]=!0):o[H+"DIRECTUV"]=0}function V(w,o,H){const h=w.getTextureMatrix();o.ie(H+"Matrix",h)}function r(w,o,H){H.BAKED_VERTEX_ANIMATION_TEXTURE&&H.INSTANCES&&w.push("bakedVertexAnimationSettingsInstanced")}function k(w,o,H){var h;if(o&&w&&(w.computeBonesUsingShaders&&o._bonesComputationForcedToCPU&&(w.computeBonesUsingShaders=!1),w.useBones&&w.computeBonesUsingShaders&&w.skeleton)){const E=w.skeleton;if(E.isUsingTextureForMatrices&&o.getUniformIndex("boneTextureWidth")>-1){const H=E.getTransformMatrixTexture(w);o.setTexture("boneSampler",H),o.setFloat("boneTextureWidth",4*(E.bones.length+1))}else{const e=E.getTransformMatrices(w);e&&(o.setMatrices("mBones",e),H&&w.Ow().prePassRenderer&&w.Ow().prePassRenderer.getIndex(2)&&(H.previousBones[w.uniqueId]||(H.previousBones[w.uniqueId]=e.slice()),o.setMatrices("mPreviousBones",H.previousBones[w.uniqueId]),h=e,H.previousBones[w.uniqueId].set(h)))}}}function P(w,o,H,h,E){let e=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];w._bindLight(o,H,h,E,e)}function l(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const e=Math.min(o.lightSources.length,E);for(let D=0;D<e;D++){P(o.lightSources[D],D,w,H,"boolean"===typeof h?h:h.SPECULARTERM,o.receiveShadows)}}function O(w,o,H,h){H.NUM_BONE_INFLUENCERS>0&&(h.addCPUSkinningFallback(0,o),w.push("matricesIndices"),w.push("matricesWeights"),H.NUM_BONE_INFLUENCERS>4&&(w.push("matricesIndicesExtra"),w.push("matricesWeightsExtra")))}function T(w,o){(o.INSTANCES||o.THIN_INSTANCES)&&Q(w,!!o.PREPASS_VELOCITY),o.INSTANCESCOLOR&&w.push("instanceColor")}function S(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=0;for(let e=0;e<H&&w["LIGHT"+e];e++)e>0&&(E=h+e,o.addFallback(E,"LIGHT"+e)),w.SHADOWS||(w["SHADOW"+e]&&o.addFallback(h,"SHADOW"+e),w["SHADOWPCF"+e]&&o.addFallback(h,"SHADOWPCF"+e),w["SHADOWPCSS"+e]&&o.addFallback(h,"SHADOWPCSS"+e),w["SHADOWPOISSON"+e]&&o.addFallback(h,"SHADOWPOISSON"+e),w["SHADOWESM"+e]&&o.addFallback(h,"SHADOWESM"+e),w["SHADOWCLOSEESM"+e]&&o.addFallback(h,"SHADOWCLOSEESM"+e));return E++}function c(w,o,H,h,E,e,D){let t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];D._areMiscDirty&&(D.LOGARITHMICDEPTH=H,D.POINTSIZE=h,D.FOG=E&&function(w,o){return o.fogEnabled&&w.applyFog&&0!==o.fogMode}(w,o),D.NONUNIFORMSCALING=w.nonUniformScaling,D.ALPHATEST=e,D.DECAL_AFTER_DETAIL=t)}function W(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H._areLightsDirty)return H._needNormals;let D=0;const t={needNormals:H._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(w.lightsEnabled&&!e)for(const L of o.lightSources)if(B(w,o,L,D,H,h,t),D++,D===E)break;H.SPECULARTERM=t.specularEnabled,H.SHADOWS=t.shadowEnabled;for(let L=D;L<E;L++)void 0!==H["LIGHT"+L]&&(H["LIGHT"+L]=!1,H["HEMILIGHT"+L]=!1,H["POINTLIGHT"+L]=!1,H["DIRLIGHT"+L]=!1,H["SPOTLIGHT"+L]=!1,H["AREALIGHT"+L]=!1,H["SHADOW"+L]=!1,H["SHADOWCSM"+L]=!1,H["SHADOWCSMDEBUG"+L]=!1,H["SHADOWCSMNUM_CASCADES"+L]=!1,H["SHADOWCSMUSESHADOWMAXZ"+L]=!1,H["SHADOWCSMNOBLEND"+L]=!1,H["SHADOWCSM_RIGHTHANDED"+L]=!1,H["SHADOWPCF"+L]=!1,H["SHADOWPCSS"+L]=!1,H["SHADOWPOISSON"+L]=!1,H["SHADOWESM"+L]=!1,H["SHADOWCLOSEESM"+L]=!1,H["SHADOWCUBE"+L]=!1,H["SHADOWLOWQUALITY"+L]=!1,H["SHADOWMEDIUMQUALITY"+L]=!1);const X=w.getEngine().getCaps();return void 0===H.SHADOWFLOAT&&(t.needRebuild=!0),H.SHADOWFLOAT=t.shadowEnabled&&(X.textureFloatRender&&X.textureFloatLinearFiltering||X.textureHalfFloatRender&&X.textureHalfFloatLinearFiltering),H.LIGHTMAPEXCLUDED=t.lightmapMode,t.needRebuild&&H.rebuild(),t.needNormals}function B(w,o,H,h,E,e,t){switch(t.needNormals=!0,void 0===E["LIGHT"+h]&&(t.needRebuild=!0),E["LIGHT"+h]=!0,E["SPOTLIGHT"+h]=!1,E["HEMILIGHT"+h]=!1,E["POINTLIGHT"+h]=!1,E["DIRLIGHT"+h]=!1,E["AREALIGHT"+h]=!1,H.prepareLightSpecificDefines(E,h),E["LIGHT_FALLOFF_PHYSICAL"+h]=!1,E["LIGHT_FALLOFF_GLTF"+h]=!1,E["LIGHT_FALLOFF_STANDARD"+h]=!1,H.falloffType){case D.d.FALLOFF_GLTF:E["LIGHT_FALLOFF_GLTF"+h]=!0;break;case D.d.FALLOFF_PHYSICAL:E["LIGHT_FALLOFF_PHYSICAL"+h]=!0;break;case D.d.FALLOFF_STANDARD:E["LIGHT_FALLOFF_STANDARD"+h]=!0}if(e&&!H.zA.equalsFloats(0,0,0)&&(t.specularEnabled=!0),E["SHADOW"+h]=!1,E["SHADOWCSM"+h]=!1,E["SHADOWCSMDEBUG"+h]=!1,E["SHADOWCSMNUM_CASCADES"+h]=!1,E["SHADOWCSMUSESHADOWMAXZ"+h]=!1,E["SHADOWCSMNOBLEND"+h]=!1,E["SHADOWCSM_RIGHTHANDED"+h]=!1,E["SHADOWPCF"+h]=!1,E["SHADOWPCSS"+h]=!1,E["SHADOWPOISSON"+h]=!1,E["SHADOWESM"+h]=!1,E["SHADOWCLOSEESM"+h]=!1,E["SHADOWCUBE"+h]=!1,E["SHADOWLOWQUALITY"+h]=!1,E["SHADOWMEDIUMQUALITY"+h]=!1,o&&o.receiveShadows&&w.shadowsEnabled&&H.shadowEnabled){const o=H.getShadowGenerator(w.activeCamera)??H.getShadowGenerator();if(o){const w=o.getShadowMap();w&&w.renderList&&w.renderList.length>0&&(t.shadowEnabled=!0,o.prepareDefines(E,h))}}H.lightmapMode!=D.d.LIGHTMAP_DEFAULT?(t.lightmapMode=!0,E["LIGHTMAPEXCLUDED"+h]=!0,E["LIGHTMAPNOSPECULAR"+h]=H.lightmapMode==D.d.LIGHTMAP_SHADOWSONLY):(E["LIGHTMAPEXCLUDED"+h]=!1,E["LIGHTMAPNOSPECULAR"+h]=!1)}function J(w,o,H,h,E){let e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=function(w,o){let H=!1;if(w.activeCamera){const h=o.CAMERA_ORTHOGRAPHIC?1:0,E=o.CAMERA_PERSPECTIVE?1:0,e=1===w.activeCamera.mode?1:0,D=0===w.activeCamera.mode?1:0;(h^e||E^D)&&(o.CAMERA_ORTHOGRAPHIC=1===e,o.CAMERA_PERSPECTIVE=1===D,H=!0)}return H}(w,h);!1!==e&&(X=(0,t.g)(H,w,h)),h.DEPTHPREPASS!==!o.getColorWrite()&&(h.DEPTHPREPASS=!h.DEPTHPREPASS,X=!0),h.INSTANCES!==E&&(h.INSTANCES=E,X=!0),h.THIN_INSTANCES!==D&&(h.THIN_INSTANCES=D,X=!0),X&&h.markAsUnprocessed()}function g(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],e=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],D=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!o._areAttributesDirty&&o._needNormals===o._normals&&o._needUVs===o._uvs)return!1;o._normals=o._needNormals,o._uvs=o._needUVs,o.NORMAL=o._needNormals&&w.isVerticesDataPresent("normal"),o._needNormals&&w.isVerticesDataPresent("tangent")&&(o.TANGENT=!0);for(let t=1;t<=6;++t)o["UV"+t]=!!o._needUVs&&w.isVerticesDataPresent(`uv${1===t?"":t}`);if(H){const H=w.useVertexColors&&w.isVerticesDataPresent("color");o.VERTEXCOLOR=H,o.VERTEXALPHA=w.hasVertexAlpha&&H&&e}return w.isVerticesDataPresent("instanceColor")&&(w.hasInstances||w.hasThinInstances)&&(o.INSTANCESCOLOR=!0),h&&function(w,o){if(w.useBones&&w.computeBonesUsingShaders&&w.skeleton){o.NUM_BONE_INFLUENCERS=w.numBoneInfluencers;const H=void 0!==o.BONETEXTURE;if(w.skeleton.isUsingTextureForMatrices&&H)o.BONETEXTURE=!0;else{o.BonesPerMesh=w.skeleton.bones.length+1,o.BONETEXTURE=!H&&void 0;const h=w.Ow().prePassRenderer;if(h&&h.enabled){const H=-1===h.excludedSkinnedMesh.indexOf(w);o.BONES_VELOCITY_ENABLED=H}}}else o.NUM_BONE_INFLUENCERS=0,o.BonesPerMesh=0,void 0!==o.BONETEXTURE&&(o.BONETEXTURE=!1)}(w,o),E&&function(w,o){const H=w.morphTargetManager;H?(o.MORPHTARGETS_UV=H.supportsUVs&&o.UV1,o.MORPHTARGETS_UV2=H.supportsUV2s&&o.UV2,o.MORPHTARGETS_TANGENT=H.supportsTangents&&o.TANGENT,o.MORPHTARGETS_NORMAL=H.supportsNormals&&o.NORMAL,o.MORPHTARGETS_POSITION=H.supportsPositions,o.MORPHTARGETS_COLOR=H.supportsColors,o.MORPHTARGETTEXTURE_HASUVS=H.hasUVs,o.MORPHTARGETTEXTURE_HASUV2S=H.hasUV2s,o.MORPHTARGETTEXTURE_HASTANGENTS=H.hasTangents,o.MORPHTARGETTEXTURE_HASNORMALS=H.hasNormals,o.MORPHTARGETTEXTURE_HASPOSITIONS=H.hasPositions,o.MORPHTARGETTEXTURE_HASCOLORS=H.hasColors,o.NUM_MORPH_INFLUENCERS=H.numMaxInfluencers||H.numInfluencers,o.MORPHTARGETS=o.NUM_MORPH_INFLUENCERS>0,o.MORPHTARGETS_TEXTURE=H.isUsingTextureForTargets):(o.MORPHTARGETS_UV=!1,o.MORPHTARGETS_UV2=!1,o.MORPHTARGETS_TANGENT=!1,o.MORPHTARGETS_NORMAL=!1,o.MORPHTARGETS_POSITION=!1,o.MORPHTARGETS_COLOR=!1,o.MORPHTARGETTEXTURE_HASUVS=!1,o.MORPHTARGETTEXTURE_HASUV2S=!1,o.MORPHTARGETTEXTURE_HASTANGENTS=!1,o.MORPHTARGETTEXTURE_HASNORMALS=!1,o.MORPHTARGETTEXTURE_HASPOSITIONS=!1,o.MORPHTARGETTEXTURE_HAS_COLORS=!1,o.MORPHTARGETS=!1,o.NUM_MORPH_INFLUENCERS=0)}(w,o),D&&function(w,o){const H=w.bakedVertexAnimationManager;o.BAKED_VERTEX_ANIMATION_TEXTURE=!(!H||!H.isEnabled)}(w,o),!0}function b(w,o){if(w.activeCamera){const H=o.MULTIVIEW;o.MULTIVIEW=null!==w.activeCamera.outputRenderTarget&&w.activeCamera.outputRenderTarget.getViewCount()>1,o.MULTIVIEW!=H&&o.markAsUnprocessed()}}function p(w,o,H){const h=o.ORDER_INDEPENDENT_TRANSPARENCY,E=o.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;o.ORDER_INDEPENDENT_TRANSPARENCY=w.useOrderIndependentTransparency&&H,o.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!w.getEngine().getCaps().textureFloatLinearFiltering,h===o.ORDER_INDEPENDENT_TRANSPARENCY&&E===o.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||o.markAsUnprocessed()}function f(w,o,H){const h=o.PREPASS;if(!o._arePrePassDirty)return;const E=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(w.prePassRenderer&&w.prePassRenderer.enabled&&H){o.PREPASS=!0,o.SCENE_MRT_COUNT=w.prePassRenderer.mrtCount,o.PREPASS_NORMAL_WORLDSPACE=w.prePassRenderer.generateNormalsInWorldSpace,o.PREPASS_COLOR=!0,o.PREPASS_COLOR_INDEX=0;for(let H=0;H<E.length;H++){const h=w.prePassRenderer.getIndex(E[H].type);-1!==h?(o[E[H].define]=!0,o[E[H].index]=h):o[E[H].define]=!1}}else{o.PREPASS=!1;for(let w=0;w<E.length;w++)o[E[w].define]=!1}o.PREPASS!=h&&(o.markAsUnprocessed(),o.markAsImageProcessingDirty())}function N(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]&&arguments[6];E&&E.push("Light"+w),e||(o.push("vLightData"+w,"vLightDiffuse"+w,"vLightSpecular"+w,"vLightDirection"+w,"vLightWidth"+w,"vLightHeight"+w,"vLightFalloff"+w,"vLightGround"+w,"lightMatrix"+w,"shadowsInfo"+w,"depthValues"+w),H.push("shadowTexture"+w),H.push("depthTexture"+w),o.push("viewFrustumZ"+w,"cascadeBlendFactor"+w,"lightSizeUVCorrection"+w,"depthCorrection"+w,"penumbraDarkness"+w,"frustumLengths"+w),h&&(H.push("projectionLightTexture"+w),o.push("textureProjectionMatrix"+w)),D&&H.push("iesLightTexture"+w))}function j(w,o,H){let h,E,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(w.uniformsNames){const D=w;h=D.uniformsNames,E=D.uniformBuffersNames,o=D.samplers,H=D.defines,e=D.maxSimultaneousLights||0}else h=w,o||(o=[]);for(let D=0;D<e&&H["LIGHT"+D];D++)N(D,h,o,H["PROJECTEDLIGHTTEXTURE"+D],E,!1,H["IESLIGHTTEXTURE"+D]);H.NUM_MORPH_INFLUENCERS&&(h.push("morphTargetInfluences"),h.push("morphTargetCount")),H.BAKED_VERTEX_ANIMATION_TEXTURE&&(h.push("bakedVertexAnimationSettings"),h.push("bakedVertexAnimationTextureSizeInverted"),h.push("bakedVertexAnimationTime"),o.push("bakedVertexAnimationTexture"))}},12027:(w,o,H)=>{H.d(o,{b:()=>e});var h=H(11720),E=H(12033);class e extends E.e{constructor(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(w,o,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new h.Matrix,this._storeEffectOnSubMeshes=H}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(w,o){return!!w&&(!this._storeEffectOnSubMeshes||(!w.Le||0===w.Le.length||this.isReadyForSubMesh(w,w.Le[0],o)))}_isReadyForSubMesh(w){const o=w.materialDefines;return!(this.checkReadyOnEveryCall||!w.effect||!o||o._renderId!==this.Ow().getRenderId())}bindOnlyWorldMatrix(w){this._activeEffect.setMatrix("world",w)}bindOnlyNormalMatrix(w){this._activeEffect.setMatrix("normalMatrix",w)}bind(w,o){o&&this.bindForSubMesh(w,o,o.Le[0])}_afterBind(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;super._afterBind(w,o,H),this.Ow()._cachedEffect=o,H?H._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return H._drawWrapper._forceRebindOnNextCall||w.isCachedMaterialInvalid(this,o,h)}dispose(w,o,H){this._activeEffect=void 0,super.dispose(w,o,H)}}},12068:(w,o,H)=>{H.d(o,{c:()=>t,e:()=>X});var h=H(11697),E=H(11720),e=H(11702);class D{static extractMinAndMaxIndexed(w,o,H,h,E,e){for(let D=H;D<H+h;D++){const H=3*o[D],h=w[H],t=w[H+1],X=w[H+2];E.minimizeInPlaceFromFloats(h,t,X),e.maximizeInPlaceFromFloats(h,t,X)}}static extractMinAndMax(w,o,H,h,E,e){for(let D=o,t=o*h;D<o+H;D++,t+=h){const o=w[t],H=w[t+1],h=w[t+2];E.minimizeInPlaceFromFloats(o,H,h),e.maximizeInPlaceFromFloats(o,H,h)}}}function t(w,o,H,h){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const t=new E.io(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new E.io(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return D.extractMinAndMaxIndexed(w,o,H,h,t,X),e&&(t.x-=t.x*e.x+e.y,t.y-=t.y*e.x+e.y,t.z-=t.z*e.x+e.y,X.x+=X.x*e.x+e.y,X.y+=X.y*e.x+e.y,X.z+=X.z*e.x+e.y),{minimum:t,maximum:X}}function X(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4?arguments[4]:void 0;const t=new E.io(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),X=new E.io(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e||(e=3),D.extractMinAndMax(w,o,H,e,t,X),h&&(t.x-=t.x*h.x+h.y,t.y-=t.y*h.x+h.y,t.z-=t.z*h.x+h.y,X.x+=X.x*h.x+h.y,X.y+=X.y*h.x+h.y,X.z+=X.z*h.x+h.y),{minimum:t,maximum:X}}(0,h.b)([e.f.filter((function(){for(var w=arguments.length,o=new Array(w),H=0;H<w;H++)o[H]=arguments[H];let[h,E]=o;return!Array.isArray(h)&&!Array.isArray(E)}))],D,"extractMinAndMaxIndexed",null),(0,h.b)([e.f.filter((function(){for(var w=arguments.length,o=new Array(w),H=0;H<w;H++)o[H]=arguments[H];let[h]=o;return!Array.isArray(h)}))],D,"extractMinAndMax",null)},12038:(w,o,H)=>{H.d(o,{c:()=>X});var h=H(11780),E=H(12045),e=H(12052),D=H(12068),t=H(11831);class X{get materialDefines(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(w=this._getDrawWrapper())||void 0===w?void 0:w.defines}set materialDefines(w){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=w}_getDrawWrapper(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w??this._engine.currentRenderPassId;let H=this._drawWrappers[w];return!H&&o&&(this._drawWrappers[w]=H=new t.e(this._mesh.Ow().getEngine())),H}_removeDrawWrapper(w){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var H;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(H=this._drawWrappers[w])||void 0===H||H.dispose(o));this._drawWrappers[w]=void 0}get effect(){var w;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(w=this._getDrawWrapper())||void 0===w?void 0:w.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(w){this._mainDrawWrapperOverride=w}setEffect(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this._drawWrapper;E.setEffect(w,o,h),void 0!==H&&(E.materialContext=H),w||(E.defines=null,E.materialContext=void 0)}resetDrawCache(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==w)return void this._removeDrawWrapper(w,!0,o);for(const w of this._drawWrappers)null===w||void 0===w||w.dispose(o)}this._drawWrappers=[]}static AddToMesh(w,o,H,h,E,e,D){return new X(w,o,H,h,E,e,D,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(w,o,H,h,E,e,D){let t=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],X=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=w,this.verticesStart=o,this.verticesCount=H,this.indexStart=h,this.indexCount=E,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=e,this._renderingMesh=D||e,X&&e.Le.push(this),this._engine=this._mesh.Ow().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=e.Le.length-1,t&&(this.refreshBoundingInfo(),e.se(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(w){return this._boundingInfo=w,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const w=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return w||this._renderingMesh}jw(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const o=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!o)return w&&this._mesh.Ow()._hasDefaultMaterial?this._mesh.Ow().defaultMaterial:null;if(this._isMultiMaterial(o)){const w=o.getSubMaterial(this.materialIndex);return this._currentMaterial!==w&&(this._currentMaterial=w,this.resetDrawCache()),w}return o}_isMultiMaterial(w){return void 0!==w.getSubMaterial}refreshBoundingInfo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.re)return this;if(w||(w=this._renderingMesh.getVerticesData(h.e.PositionKind)),!w)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const o=this._renderingMesh.ke();let H;if(0===this.indexStart&&this.indexCount===o.length){const w=this._renderingMesh.getBoundingInfo();H={minimum:w.minimum.clone(),maximum:w.maximum.clone()}}else H=(0,D.c)(w,o,this.indexStart,this.indexCount,this._renderingMesh.re.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(H.minimum,H.maximum):this._boundingInfo=new e.c(H.minimum,H.maximum),this}_checkCollision(w){return this.getBoundingInfo()._checkCollision(w)}updateBoundingInfo(w){let o=this.getBoundingInfo();return o||(this.refreshBoundingInfo(),o=this.getBoundingInfo()),o&&o.update(w),this}isInFrustum(w){const o=this.getBoundingInfo();return!!o&&o.isInFrustum(w,this._mesh.Cy)}isCompletelyInFrustum(w){const o=this.getBoundingInfo();return!!o&&o.isCompletelyInFrustum(w)}render(w){return this._renderingMesh.render(this,w,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(w,o){if(!this._linesIndexBuffer){const H=6*Math.floor(this.indexCount/3),h=this.verticesStart+this.verticesCount>65535?new Uint32Array(H):new Uint16Array(H);let E=0;if(0===w.length)for(let w=this.indexStart;w<this.indexStart+this.indexCount;w+=3)h[E++]=w,h[E++]=w+1,h[E++]=w+1,h[E++]=w+2,h[E++]=w+2,h[E++]=w;else for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)h[E++]=w[o],h[E++]=w[o+1],h[E++]=w[o+1],h[E++]=w[o+2],h[E++]=w[o+2],h[E++]=w[o];this._linesIndexBuffer=o.createIndexBuffer(h),this._linesIndexCount=h.length}return this._linesIndexBuffer}canIntersects(w){const o=this.getBoundingInfo();return!!o&&w.intersectsBox(o.boundingBox)}intersects(w,o,H,h,E){const e=this.jw();if(!e)return null;let D=3,t=!1;switch(e.fillMode){case 3:case 5:case 6:case 8:return null;case 7:D=1,t=!0}return 4===e.fillMode?H.length?this._intersectLines(w,o,H,this._mesh.intersectionThreshold,h):this._intersectUnIndexedLines(w,o,H,this._mesh.intersectionThreshold,h):!H.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(w,o,H,h,E):this._intersectTriangles(w,o,H,D,t,h,E)}_intersectLines(w,o,H,h,e){let D=null;for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=2){const X=o[H[t]],L=o[H[t+1]],A=w.intersectionSegment(X,L,h);if(!(A<0)&&((e||!D||A<D.distance)&&(D=new E.b(null,null,A),D.faceId=t/2,e)))break}return D}_intersectUnIndexedLines(w,o,H,h,e){let D=null;for(let t=this.verticesStart;t<this.verticesStart+this.verticesCount;t+=2){const H=o[t],X=o[t+1],L=w.intersectionSegment(H,X,h);if(!(L<0)&&((e||!D||L<D.distance)&&(D=new E.b(null,null,L),D.faceId=t/2,e)))break}return D}_intersectTriangles(w,o,H,h,E,e,D){let t=null,X=-1;for(let L=this.indexStart;L<this.indexStart+this.indexCount-(3-h);L+=h){X++;const h=H[L],A=H[L+1],y=H[L+2];if(E&&4294967295===y){L+=2;continue}const z=o[h],C=o[A],Q=o[y];if(!z||!C||!Q)continue;if(D&&!D(z,C,Q,w,h,A,y))continue;const M=w.intersectsTriangle(z,C,Q);if(M){if(M.distance<0)continue;if((e||!t||M.distance<t.distance)&&(t=M,t.faceId=X,e))break}}return t}_intersectUnIndexedTriangles(w,o,H,h,E){let e=null;for(let D=this.verticesStart;D<this.verticesStart+this.verticesCount;D+=3){const H=o[D],t=o[D+1],X=o[D+2];if(E&&!E(H,t,X,w,-1,-1,-1))continue;const L=w.intersectsTriangle(H,t,X);if(L){if(L.distance<0)continue;if((h||!e||L.distance<e.distance)&&(e=L,e.faceId=D/3,h))break}}return e}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(w,o){const H=new X(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,w,o,!1);if(!this.IsGlobal){const w=this.getBoundingInfo();if(!w)return H;H._boundingInfo=new e.c(w.minimum,w.maximum)}return H}dispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Ow().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const o=this._mesh.Le.indexOf(this);this._mesh.Le.splice(o,1),this.resetDrawCache(void 0,w)}getClassName(){return"SubMesh"}static CreateFromIndices(w,o,H,h,E){let e=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],D=Number.MAX_VALUE,t=-Number.MAX_VALUE;const L=(E||h).ke();for(let X=o;X<o+H;X++){const w=L[X];w<D&&(D=w),w>t&&(t=w)}return new X(w,D,t-D+1,o,H,h,E,e)}}}}]);