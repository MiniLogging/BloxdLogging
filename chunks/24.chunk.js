"use strict";(self.agop5zpabxv=self.agop5zpabxv||[]).push([[24],{12655:(H,u,J)=>{J.d(u,{e:()=>O});class O{constructor(H,u,J){this.bu=H,this.bv=u,this.distance=J,this.faceId=0,this.subMeshId=0}}},12664:(H,u,J)=>{J.d(u,{d:()=>w});var O=J(12345),U=J(12338),h=J(12343);class w{constructor(H,u,J){this.vectors=(0,O.b)(8,U.lu.Zero),this.center=U.lu.Zero(),this.centerWorld=U.lu.Zero(),this.extendSize=U.lu.Zero(),this.extendSizeWorld=U.lu.Zero(),this.directions=(0,O.b)(3,U.lu.Zero),this.vectorsWorld=(0,O.b)(8,U.lu.Zero),this.minimumWorld=U.lu.Zero(),this.maximumWorld=U.lu.Zero(),this.minimum=U.lu.Zero(),this.maximum=U.lu.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(H,u,J)}reConstruct(H,u,J){const O=H.x,h=H.y,w=H.z,g=u.x,B=u.y,b=u.z,d=this.vectors;this.minimum.kg(O,h,w),this.maximum.kg(g,B,b),d[0].kg(O,h,w),d[1].kg(g,B,b),d[2].kg(g,h,w),d[3].kg(O,B,w),d[4].kg(O,h,b),d[5].kg(g,B,w),d[6].kg(O,B,b),d[7].kg(g,h,b),u.addToRef(H,this.center).scaleInPlace(.5),u.subtractToRef(H,this.extendSize).scaleInPlace(.5),this._worldMatrix=J||U.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(H){const u=w._TmpVector3,J=this.maximum.subtractToRef(this.minimum,u[0]),O=J.length();J.normalizeFromLength(O);const U=O*H,h=J.scaleInPlace(.5*U),g=this.center.subtractToRef(h,u[1]),B=this.center.addToRef(h,u[2]);return this.reConstruct(g,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(H){const u=this.minimumWorld,J=this.maximumWorld,O=this.directions,h=this.vectorsWorld,w=this.vectors;if(H.isIdentity()){u.O(this.minimum),J.O(this.maximum);for(let H=0;H<8;++H)h[H].O(w[H]);this.extendSizeWorld.O(this.extendSize),this.centerWorld.O(this.center)}else{u.jg(Number.MAX_VALUE),J.jg(-Number.MAX_VALUE);for(let O=0;O<8;++O){const g=h[O];U.lu.TransformCoordinatesToRef(w[O],H,g),u.minimizeInPlace(g),J.maximizeInPlace(g)}J.subtractToRef(u,this.extendSizeWorld).scaleInPlace(.5),J.addToRef(u,this.centerWorld).scaleInPlace(.5)}U.lu.FromArrayToRef(H.m,0,O[0]),U.lu.FromArrayToRef(H.m,4,O[1]),U.lu.FromArrayToRef(H.m,8,O[2]),this._worldMatrix=H}isInFrustum(H){return w.IsInFrustum(this.vectorsWorld,H)}isCompletelyInFrustum(H){return w.IsCompletelyInFrustum(this.vectorsWorld,H)}intersectsPoint(H){const u=this.minimumWorld,J=this.maximumWorld,O=u.x,U=u.y,w=u.z,g=J.x,B=J.y,b=J.z,d=H.x,G=H.y,P=H.z,mH=-h.d;return!(g-d<mH||mH>d-O)&&(!(B-G<mH||mH>G-U)&&!(b-P<mH||mH>P-w))}intersectsSphere(H){return w.IntersectsSphere(this.minimumWorld,this.maximumWorld,H.centerWorld,H.radiusWorld)}intersectsMinMax(H,u){const J=this.minimumWorld,O=this.maximumWorld,U=J.x,h=J.y,w=J.z,g=O.x,B=O.y,b=O.z,d=H.x,G=H.y,P=H.z,mH=u.x,l=u.y,r=u.z;return!(g<d||U>mH)&&(!(B<G||h>l)&&!(b<P||w>r))}dispose(){var H,u;null===(H=this._drawWrapperFront)||void 0===H||H.dispose(),null===(u=this._drawWrapperBack)||void 0===u||u.dispose()}static Intersects(H,u){return H.intersectsMinMax(u.minimumWorld,u.maximumWorld)}static IntersectsSphere(H,u,J,O){const h=w._TmpVector3[0];U.lu.ClampToRef(J,H,u,h);return U.lu.DistanceSquared(J,h)<=O*O}static IsCompletelyInFrustum(H,u){for(let J=0;J<6;++J){const O=u[J];for(let u=0;u<8;++u)if(O.dotCoordinate(H[u])<0)return!1}return!0}static IsInFrustum(H,u){for(let J=0;J<6;++J){let O=!0;const U=u[J];for(let u=0;u<8;++u)if(U.dotCoordinate(H[u])>=0){O=!1;break}if(O)return!1}return!0}}w._TmpVector3=(0,O.b)(3,U.lu.Zero)},12659:(H,u,J)=>{J.d(u,{d:()=>G});var O=J(12345),U=J(12338),h=J(12664),w=J(12666);const g={min:0,max:0},B={min:0,max:0},b=(H,u,J)=>{const O=U.lu.Dot(u.centerWorld,H),h=Math.abs(U.lu.Dot(u.directions[0],H))*u.extendSize.x+Math.abs(U.lu.Dot(u.directions[1],H))*u.extendSize.y+Math.abs(U.lu.Dot(u.directions[2],H))*u.extendSize.z;J.min=O-h,J.max=O+h},d=(H,u,J)=>(b(H,u,g),b(H,J,B),!(g.min>B.max||B.min>g.max));class G{constructor(H,u,J){this._isLocked=!1,this.boundingBox=new h.d(H,u,J),this.boundingSphere=new w.b(H,u,J)}reConstruct(H,u,J){this.boundingBox.reConstruct(H,u,J),this.boundingSphere.reConstruct(H,u,J)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(H){this._isLocked=H}update(H){this._isLocked||(this.boundingBox._update(H),this.boundingSphere._update(H))}centerOn(H,u){const J=G._TmpVector3[0].O(H).jP(u),O=G._TmpVector3[1].O(H).addInPlace(u);return this.boundingBox.reConstruct(J,O,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(J,O,this.boundingBox.getWorldMatrix()),this}encapsulate(H){const u=U.lu.Minimize(this.minimum,H),J=U.lu.Maximize(this.maximum,H);return this.reConstruct(u,J,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(H){const u=U.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(u);const J=U.TmpVectors.lu[0];return U.lu.TransformCoordinatesToRef(H.boundingBox.minimumWorld,u,J),this.encapsulate(J),U.lu.TransformCoordinatesToRef(H.boundingBox.maximumWorld,u,J),this.encapsulate(J),this}scale(H){return this.boundingBox.scale(H),this.boundingSphere.scale(H),this}isInFrustum(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===u||3===u)&&this.boundingSphere.isCenterInFrustum(H))return!0;if(!this.boundingSphere.isInFrustum(H))return!1;return!(1!==u&&3!==u)||this.boundingBox.isInFrustum(H)}get diagonalLength(){const H=this.boundingBox;return H.maximumWorld.subtractToRef(H.minimumWorld,G._TmpVector3[0]).length()}isCompletelyInFrustum(H){return this.boundingBox.isCompletelyInFrustum(H)}_checkCollision(H){return H._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(H){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(H)&&!!this.boundingBox.intersectsPoint(H))}intersects(H,u){if(!w.b.Intersects(this.boundingSphere,H.boundingSphere))return!1;if(!h.d.Intersects(this.boundingBox,H.boundingBox))return!1;if(!u)return!0;const J=this.boundingBox,O=H.boundingBox;return!!d(J.directions[0],J,O)&&(!!d(J.directions[1],J,O)&&(!!d(J.directions[2],J,O)&&(!!d(O.directions[0],J,O)&&(!!d(O.directions[1],J,O)&&(!!d(O.directions[2],J,O)&&(!!d(U.lu.Cross(J.directions[0],O.directions[0]),J,O)&&(!!d(U.lu.Cross(J.directions[0],O.directions[1]),J,O)&&(!!d(U.lu.Cross(J.directions[0],O.directions[2]),J,O)&&(!!d(U.lu.Cross(J.directions[1],O.directions[0]),J,O)&&(!!d(U.lu.Cross(J.directions[1],O.directions[1]),J,O)&&(!!d(U.lu.Cross(J.directions[1],O.directions[2]),J,O)&&(!!d(U.lu.Cross(J.directions[2],O.directions[0]),J,O)&&(!!d(U.lu.Cross(J.directions[2],O.directions[1]),J,O)&&!!d(U.lu.Cross(J.directions[2],O.directions[2]),J,O))))))))))))))}}G._TmpVector3=(0,O.b)(2,U.lu.Zero)},12666:(H,u,J)=>{J.d(u,{b:()=>h});var O=J(12345),U=J(12338);class h{constructor(H,u,J){this.center=U.lu.Zero(),this.centerWorld=U.lu.Zero(),this.minimum=U.lu.Zero(),this.maximum=U.lu.Zero(),this.reConstruct(H,u,J)}reConstruct(H,u,J){this.minimum.O(H),this.maximum.O(u);const O=U.lu.Distance(H,u);u.addToRef(H,this.center).scaleInPlace(.5),this.radius=.5*O,this._update(J||U.Matrix.IdentityReadOnly)}scale(H){const u=this.radius*H,J=h._TmpVector3,O=J[0].jg(u),U=this.center.subtractToRef(O,J[1]),w=this.center.addToRef(O,J[2]);return this.reConstruct(U,w,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(H){if(H.isIdentity())this.centerWorld.O(this.center),this.radiusWorld=this.radius;else{U.lu.TransformCoordinatesToRef(this.center,H,this.centerWorld);const u=h._TmpVector3[0];U.lu.TransformNormalFromFloatsToRef(1,1,1,H,u),this.radiusWorld=Math.max(Math.abs(u.x),Math.abs(u.y),Math.abs(u.z))*this.radius}}isInFrustum(H){const u=this.centerWorld,J=this.radiusWorld;for(let O=0;O<6;O++)if(H[O].dotCoordinate(u)<=-J)return!1;return!0}isCenterInFrustum(H){const u=this.centerWorld;for(let J=0;J<6;J++)if(H[J].dotCoordinate(u)<0)return!1;return!0}intersectsPoint(H){const u=U.lu.DistanceSquared(this.centerWorld,H);return!(this.radiusWorld*this.radiusWorld<u)}static Intersects(H,u){const J=U.lu.DistanceSquared(H.centerWorld,u.centerWorld),O=H.radiusWorld+u.radiusWorld;return!(O*O<J)}static CreateFromCenterAndRadius(H,u,J){this._TmpVector3[0].O(H),this._TmpVector3[1].kg(0,0,u),this._TmpVector3[2].O(H),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].jP(this._TmpVector3[1]);const O=new h(this._TmpVector3[0],this._TmpVector3[2]);return O._worldMatrix=J||U.Matrix.Identity(),O}}h._TmpVector3=(0,O.b)(3,U.lu.Zero)},12675:(H,u,J)=>{function O(H){-1===H.indexOf("vClipPlane")&&H.push("vClipPlane"),-1===H.indexOf("vClipPlane2")&&H.push("vClipPlane2"),-1===H.indexOf("vClipPlane3")&&H.push("vClipPlane3"),-1===H.indexOf("vClipPlane4")&&H.push("vClipPlane4"),-1===H.indexOf("vClipPlane5")&&H.push("vClipPlane5"),-1===H.indexOf("vClipPlane6")&&H.push("vClipPlane6")}function U(H,u,J){const O=!!(H.clipPlane??u.clipPlane),U=!!(H.clipPlane2??u.clipPlane2),h=!!(H.clipPlane3??u.clipPlane3),w=!!(H.clipPlane4??u.clipPlane4),g=!!(H.clipPlane5??u.clipPlane5),B=!!(H.clipPlane6??u.clipPlane6);O&&J.push("#define CLIPPLANE"),U&&J.push("#define CLIPPLANE2"),h&&J.push("#define CLIPPLANE3"),w&&J.push("#define CLIPPLANE4"),g&&J.push("#define CLIPPLANE5"),B&&J.push("#define CLIPPLANE6")}function h(H,u,J){let O=!1;const U=!!(H.clipPlane??u.clipPlane),h=!!(H.clipPlane2??u.clipPlane2),w=!!(H.clipPlane3??u.clipPlane3),g=!!(H.clipPlane4??u.clipPlane4),B=!!(H.clipPlane5??u.clipPlane5),b=!!(H.clipPlane6??u.clipPlane6);return J.CLIPPLANE!==U&&(J.CLIPPLANE=U,O=!0),J.CLIPPLANE2!==h&&(J.CLIPPLANE2=h,O=!0),J.CLIPPLANE3!==w&&(J.CLIPPLANE3=w,O=!0),J.CLIPPLANE4!==g&&(J.CLIPPLANE4=g,O=!0),J.CLIPPLANE5!==B&&(J.CLIPPLANE5=B,O=!0),J.CLIPPLANE6!==b&&(J.CLIPPLANE6=b,O=!0),O}function w(H,u,J){let O=u.clipPlane??J.clipPlane;g(H,"vClipPlane",O),O=u.clipPlane2??J.clipPlane2,g(H,"vClipPlane2",O),O=u.clipPlane3??J.clipPlane3,g(H,"vClipPlane3",O),O=u.clipPlane4??J.clipPlane4,g(H,"vClipPlane4",O),O=u.clipPlane5??J.clipPlane5,g(H,"vClipPlane5",O),O=u.clipPlane6??J.clipPlane6,g(H,"vClipPlane6",O)}function g(H,u,J){J&&H.setFloat4(u,J.normal.x,J.normal.y,J.normal.z,J.d)}J.d(u,{e:()=>O,f:()=>w,i:()=>h,l:()=>U})},12641:(H,u,J)=>{J.d(u,{e:()=>O});class O{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(H,u){this._defines[H]||(H<this._currentRank&&(this._currentRank=H),H>this._maxRank&&(this._maxRank=H),this._defines[H]=new Array),this._defines[H].push(u)}addCPUSkinningFallback(H,u){this._mesh=u,H<this._currentRank&&(this._currentRank=H),H>this._maxRank&&(this._maxRank=H)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(H,u){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,H=H.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),u._bonesComputationForcedToCPU=!0;const J=this._mesh.ZH();for(let H=0;H<J.meshes.length;H++){const O=J.meshes[H];if(O.material){if(O.computeBonesUsingShaders&&0!==O.numBoneInfluencers)if(O.material.getEffect()===u)O.computeBonesUsingShaders=!1;else if(O.mg)for(const H of O.mg){if(H.effect===u){O.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&O.computeBonesUsingShaders&&O.numBoneInfluencers>0&&(O.computeBonesUsingShaders=!1)}}else{const u=this._defines[this._currentRank];if(u)for(let J=0;J<u.length;J++)H=H.replace("#define "+u[J],"");this._currentRank++}return H}}},12651:(H,u,J)=>{J.d(u,{b:()=>p});var O=J(12324),U=J(12329),h=J(12171),w=J(12175),g=J(12203),B=J(12653),b=J(12602),d=J(12185),G=J(12388),P=J(12445),mH=J(12365);class l{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(H){this._func=H}get funcRef(){return this._funcRef}set funcRef(H){this._funcRef=H}get funcMask(){return this._funcMask}set funcMask(H){this._funcMask=H}get opStencilFail(){return this._opStencilFail}set opStencilFail(H){this._opStencilFail=H}get opDepthFail(){return this._opDepthFail}set opDepthFail(H){this._opDepthFail=H}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(H){this._opStencilDepthPass=H}get mask(){return this._mask}set mask(H){this._mask=H}get enabled(){return this._enabled}set enabled(H){this._enabled=H}getClassName(){return"MaterialStencilState"}copyTo(H){mH.d.Clone((()=>H),this)}serialize(){return mH.d.Serialize(this)}parse(H,u,J){mH.d.Parse((()=>this),H,u,J)}}(0,O.c)([(0,U.I)()],l.prototype,"func",null),(0,O.c)([(0,U.I)()],l.prototype,"funcRef",null),(0,O.c)([(0,U.I)()],l.prototype,"funcMask",null),(0,O.c)([(0,U.I)()],l.prototype,"opStencilFail",null),(0,O.c)([(0,U.I)()],l.prototype,"opDepthFail",null),(0,O.c)([(0,U.I)()],l.prototype,"opStencilDepthPass",null),(0,O.c)([(0,U.I)()],l.prototype,"mask",null),(0,O.c)([(0,U.I)()],l.prototype,"enabled",null);var r=J(12673);class p{get _supportGlowLayer(){return!1}set _glowModeEnabled(H){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(H){if(this._alpha===H)return;const u=this._alpha;this._alpha=H,1!==u&&1!==H||this.BG(p.MiscDirtyFlag+p.PrePassDirtyFlag)}get alpha(){return this._alpha}set ag(H){this._backFaceCulling!==H&&(this._backFaceCulling=H,this.BG(p.TextureDirtyFlag))}get ag(){return this._backFaceCulling}set cullBackFaces(H){this._cullBackFaces!==H&&(this._cullBackFaces=H,this.BG(p.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(H){this._blockDirtyMechanism!==H&&(this._blockDirtyMechanism=H,H||this.gm())}atomicMaterialsUpdate(H){this.blockDirtyMechanism=!0;try{H(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(H){this._onDisposeObserver&&this.nh.remove(this._onDisposeObserver),this._onDisposeObserver=this.nh.add(H)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new w.b),this._onBindObservable}set onBind(H){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(H)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new w.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new w.b),this._onEffectCreatedObservable}set alphaMode(H){this._alphaMode!==H&&(this._alphaMode=H,this.BG(p.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(H){this._needDepthPrePass!==H&&(this._needDepthPrePass=H,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(H){this._fogEnabled!==H&&(this._fogEnabled=H,this.BG(p.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case p.WireFrameFillMode:case p.LineListDrawMode:case p.LineLoopDrawMode:case p.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(H){this.fillMode=H?p.WireFrameFillMode:p.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case p.PointFillMode:case p.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(H){this.fillMode=H?p.PointFillMode:p.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(H){this._fillMode!==H&&(this._fillMode=H,this.BG(p.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(H){const u=this.ZH().getEngine().getCaps().fragmentDepthSupported;H&&!u&&d.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=H&&u,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(H){this._drawWrapper=H}constructor(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.nh=new w.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.Rh=new l,this._useUBO=!1,this._fillMode=p.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=H;const U=u||g.e.LastCreatedScene;U&&(this._scene=U,this._dirtyCallbacks={},this._forceGLSL=O,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=H||h.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new P.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new b.b(this._scene.getEngine(),void 0,void 0,H),this._useUBO=this.ZH().getEngine().supportsUniformBuffers,this._createUniformBuffer(),J||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),p.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var H;const u=this.ZH().getEngine();null===(H=this._uniformBuffer)||void 0===H||H.dispose(),u.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new b.b(u,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new b.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(H){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.gm(),this.checkReadyOnlyOnce=!0}unfreeze(){this.gm(),this.checkReadyOnlyOnce=!1}isReady(H,u){return!0}isReadyForSubMesh(H,u,J){const O=u.materialDefines;return!!O&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=O,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}ZH(){return this._scene}_getEffectiveOrientation(H){return null!==this.sideOrientation?this.sideOrientation:H.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(H){this._transparencyMode!==H&&(this._transparencyMode=H,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===p.MATERIAL_ALPHABLEND||this._transparencyMode===p.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===p.MATERIAL_ALPHATEST||this._transparencyMode===p.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===p.MATERIAL_OPAQUE||this._transparencyMode===p.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(H){return this._hasTransparencyMode?this._transparencyModeIsBlend:H.visibility<1||!this._disableAlphaBlending&&(H.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(H){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(H)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}gm(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this.ZH().meshes;for(const J of u)if(J.mg)for(const u of J.mg)if(u.XH()===this)for(const J of u._drawWrappers)J&&this._materialContext===J.materialContext&&(J._wasPreviouslyReady=!1,J._wasPreviouslyUsingInstances=null,J._forceRebindOnNextCall=H);H&&this.BG(p.AllDirtyFlag)}_preBind(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=this._scene.getEngine(),O=(null==u?this.sideOrientation:u)===p.ClockWiseSideOrientation;return J.enableEffect(H||this._getDrawWrapper()),J.setState(this.ag,this.zOffset,!1,O,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.Rh,this.zOffsetUnits),O}bind(H,u){}buildUniformLayout(){const H=this._uniformBuffer;this._eventInfo.ubo=H,this._callbackPluginEventGeneric(8,this._eventInfo),H.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(H,u,J){const O=J._drawWrapper;this._eventInfo.subMesh=J,this._callbackPluginEventBindForSubMesh(this._eventInfo),O._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(H){}bindView(H){this._useUBO?this._needToBindSceneUbo=!0:H.setMatrix("view",this.ZH().getViewMatrix())}bindViewProjection(H){this._useUBO?this._needToBindSceneUbo=!0:(H.setMatrix("viewProjection",this.ZH().getTransformMatrix()),H.setMatrix("projection",this.ZH().getProjectionMatrix()))}bindEyePosition(H,u){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(H,u)}_afterBind(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&u&&(this._needToBindSceneUbo=!1,(0,r.o)(u,this.ZH().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=H?H.visibility:1,this._onBindObservable&&H&&this._onBindObservable.notifyObservers(H),this.disableDepthWrite){const H=this._scene.getEngine();this._cachedDepthWriteState=H.getDepthWrite(),H.setDepthWrite(!1)}if(this.disableColorWrite){const H=this._scene.getEngine();this._cachedColorWriteState=H.getColorWrite(),H.setColorWrite(!1)}if(0!==this.depthFunction){const H=this._scene.getEngine();this._cachedDepthFunctionState=H.getDepthFunction()||0,H.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(H){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=H,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(H){return null}_clonePlugins(H,u){const J={};if(this._serializePlugins(J),p._ParsePlugins(J,H,this._scene,u),this.pluginManager)for(const O of this.pluginManager._plugins){const u=H.pluginManager.getPlugin(O.name);u&&O.copyTo(u)}}getBindedMeshes(){if(this.meshMap){const H=[];for(const u in this.meshMap){const J=this.meshMap[u];J&&H.push(J)}return H}return this._scene.meshes.filter((H=>H.material===this))}forceCompilation(H,u,J,O){const U={clipPlane:!1,useInstances:!1,...J},h=this.ZH(),w=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const g=()=>{if(!this._scene||!this._scene.getEngine())return;const J=h.clipPlane;if(U.clipPlane&&(h.clipPlane=new G.d(0,0,0,1)),this._storeEffectOnSubMeshes){let J=!0,h=null;if(H.mg){const u=new B.c(0,0,0,0,0,H,void 0,!1,!1);u.materialDefines&&(u.materialDefines._renderId=-1),this.isReadyForSubMesh(H,u,U.useInstances)||(u.effect&&u.effect.getCompilationError()&&u.effect.allFallbacksProcessed()?h=u.effect.getCompilationError():(J=!1,setTimeout(g,16)))}J&&(this.allowShaderHotSwapping=w,h&&O&&O(h),u&&u(this))}else this.isReady()?(this.allowShaderHotSwapping=w,u&&u(this)):setTimeout(g,16);U.clipPlane&&(h.clipPlane=J)};g()}async forceCompilationAsync(H,u){return await new Promise(((J,O)=>{this.forceCompilation(H,(()=>{J()}),u,(H=>{O(H)}))}))}BG(H){this.ZH().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(p._DirtyCallbackArray.length=0,H&p.ImageProcessingDirtyFlag&&p._DirtyCallbackArray.push(p._ImageProcessingDirtyCallBack),H&p.TextureDirtyFlag&&p._DirtyCallbackArray.push(p._TextureDirtyCallBack),H&p.LightDirtyFlag&&p._DirtyCallbackArray.push(p._LightsDirtyCallBack),H&p.FresnelDirtyFlag&&p._DirtyCallbackArray.push(p._FresnelDirtyCallBack),H&p.AttributesDirtyFlag&&p._DirtyCallbackArray.push(p._AttributeDirtyCallBack),H&p.MiscDirtyFlag&&p._DirtyCallbackArray.push(p._MiscDirtyCallBack),H&p.PrePassDirtyFlag&&p._DirtyCallbackArray.push(p._PrePassDirtyCallBack),p._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(p._RunDirtyCallBacks),this.ZH().resetCachedMaterial())}resetDrawCache(){const H=this.ZH().meshes;for(const u of H)if(u.mg)for(const H of u.mg)H.XH()===this&&H.resetDrawCache()}_markAllSubMeshesAsDirty(H){const u=this.ZH();if(u.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const J=u.meshes;for(const O of J)if(O.mg)for(const J of O.mg){if((J.XH()||(u._hasDefaultMaterial?u.defaultMaterial:null))===this)for(const u of J._drawWrappers)u&&u.defines&&u.defines.markAllAsDirty&&this._materialContext===u.materialContext&&H(u.defines)}}_markScenePrePassDirty(){if(this.ZH().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const H=this.ZH().enablePrePassRenderer();H&&H.BG()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(p._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(p._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(p._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(p._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(p._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(p._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(p._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(p._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(p._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(p._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const H=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.nh.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(H)}))}}setPrePassRenderer(H){return!1}dispose(H,u,J){const O=this.ZH();if(O.stopAnimation(this),O.freeProcessedMaterials(),O.removeMaterial(this),this._eventInfo.forceDisposeTextures=u,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const H=this._parentContainer.materials.indexOf(this);H>-1&&this._parentContainer.materials.splice(H,1),this._parentContainer=null}if(!0!==J)if(this.meshMap)for(const U in this.meshMap){const H=this.meshMap[U];this._disposeMeshResources(H)}else{const H=O.meshes;for(const u of H)this._disposeMeshResources(u)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.nh.notifyObservers(this),this.nh.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(H){if(!H)return;const u=H.Gg,J=H._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(H.mg&&J)for(const U of H.mg){const H=U._drawWrappers;for(let h=0;h<H.length;h++){var O;const w=null===(O=H[h])||void 0===O?void 0:O.effect;if(!w)continue;J[h]===this&&(null===u||void 0===u||u._releaseVertexArrayObject(w),U._removeDrawWrapper(h,!0,!0))}}}else null===u||void 0===u||u._releaseVertexArrayObject(this._drawWrapper.effect);H.material!==this||H.sourceMesh||(H.material=null)}serialize(){const H=mH.d.Serialize(this);return H.Rh=this.Rh.serialize(),H.uniqueId=this.uniqueId,this._serializePlugins(H),H}_serializePlugins(H){if(H.plugins={},this.pluginManager)for(const u of this.pluginManager._plugins)u.doNotSerialize||(H.plugins[u.getClassName()]=u.serialize())}static Parse(H,u,J){if(H.customType){if("BABYLON.PBRMaterial"===H.customType&&H.overloadedAlbedo&&(H.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else H.customType="BABYLON.StandardMaterial";const O=h.Tools.Instantiate(H.customType).Parse(H,u,J);return O._loadedUniqueId=H.uniqueId,O}static _ParsePlugins(H,u,J,O){if(H.plugins)for(const g in H.plugins){var U,w;const B=H.plugins[g];let b=null===(U=u.pluginManager)||void 0===U?void 0:U.getPlugin(B.name);if(!b){const H=h.Tools.Instantiate("BABYLON."+g);H&&(b=new H(u))}null===(w=b)||void 0===w||w.parse(B,J,O)}}}p.TriangleFillMode=0,p.WireFrameFillMode=1,p.PointFillMode=2,p.PointListDrawMode=3,p.LineListDrawMode=4,p.LineLoopDrawMode=5,p.LineStripDrawMode=6,p.TriangleStripDrawMode=7,p.TriangleFanDrawMode=8,p.ClockWiseSideOrientation=0,p.CounterClockWiseSideOrientation=1,p.ImageProcessingDirtyFlag=64,p.TextureDirtyFlag=1,p.LightDirtyFlag=2,p.FresnelDirtyFlag=4,p.AttributesDirtyFlag=8,p.MiscDirtyFlag=16,p.PrePassDirtyFlag=32,p.AllDirtyFlag=127,p.MATERIAL_OPAQUE=0,p.MATERIAL_ALPHATEST=1,p.MATERIAL_ALPHABLEND=2,p.MATERIAL_ALPHATESTANDBLEND=3,p.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,p.MATERIAL_NORMALBLENDMETHOD_RNM=1,p.OnEventObservable=new w.b,p._AllDirtyCallBack=H=>H.markAllAsDirty(),p._ImageProcessingDirtyCallBack=H=>H.markAsImageProcessingDirty(),p._TextureDirtyCallBack=H=>H.markAsTexturesDirty(),p._FresnelDirtyCallBack=H=>H.markAsFresnelDirty(),p._MiscDirtyCallBack=H=>H.markAsMiscDirty(),p._PrePassDirtyCallBack=H=>H.markAsPrePassDirty(),p._LightsDirtyCallBack=H=>H.markAsLightDirty(),p._AttributeDirtyCallBack=H=>H.markAsAttributesDirty(),p._FresnelAndMiscDirtyCallBack=H=>{p._FresnelDirtyCallBack(H),p._MiscDirtyCallBack(H)},p._TextureAndMiscDirtyCallBack=H=>{p._TextureDirtyCallBack(H),p._MiscDirtyCallBack(H)},p._DirtyCallbackArray=[],p._RunDirtyCallBacks=H=>{for(const u of p._DirtyCallbackArray)u(H)},(0,O.c)([(0,U.I)()],p.prototype,"id",void 0),(0,O.c)([(0,U.I)()],p.prototype,"uniqueId",void 0),(0,O.c)([(0,U.I)()],p.prototype,"name",void 0),(0,O.c)([(0,U.I)()],p.prototype,"metadata",void 0),(0,O.c)([(0,U.I)()],p.prototype,"checkReadyOnEveryCall",void 0),(0,O.c)([(0,U.I)()],p.prototype,"checkReadyOnlyOnce",void 0),(0,O.c)([(0,U.I)()],p.prototype,"state",void 0),(0,O.c)([(0,U.I)("alpha")],p.prototype,"_alpha",void 0),(0,O.c)([(0,U.I)("ag")],p.prototype,"_backFaceCulling",void 0),(0,O.c)([(0,U.I)("cullBackFaces")],p.prototype,"_cullBackFaces",void 0),(0,O.c)([(0,U.I)()],p.prototype,"sideOrientation",void 0),(0,O.c)([(0,U.I)("alphaMode")],p.prototype,"_alphaMode",void 0),(0,O.c)([(0,U.I)()],p.prototype,"_needDepthPrePass",void 0),(0,O.c)([(0,U.I)()],p.prototype,"disableDepthWrite",void 0),(0,O.c)([(0,U.I)()],p.prototype,"disableColorWrite",void 0),(0,O.c)([(0,U.I)()],p.prototype,"forceDepthWrite",void 0),(0,O.c)([(0,U.I)()],p.prototype,"depthFunction",void 0),(0,O.c)([(0,U.I)()],p.prototype,"separateCullingPass",void 0),(0,O.c)([(0,U.I)("fogEnabled")],p.prototype,"_fogEnabled",void 0),(0,O.c)([(0,U.I)()],p.prototype,"pointSize",void 0),(0,O.c)([(0,U.I)()],p.prototype,"zOffset",void 0),(0,O.c)([(0,U.I)()],p.prototype,"zOffsetUnits",void 0),(0,O.c)([(0,U.I)()],p.prototype,"pointsCloud",null),(0,O.c)([(0,U.I)()],p.prototype,"fillMode",null),(0,O.c)([(0,U.I)()],p.prototype,"useLogarithmicDepth",null),(0,O.c)([(0,U.I)()],p.prototype,"transparencyMode",null)},12673:(H,u,J)=>{J.d(u,{A:()=>Y,C:()=>mH,F:()=>P,G:()=>c,K:()=>e,N:()=>A,P:()=>a,T:()=>s,U:()=>n,V:()=>V,W:()=>T,X:()=>X,Z:()=>l,b:()=>j,c:()=>G,d:()=>L,h:()=>d,l:()=>r,o:()=>p,r:()=>k,t:()=>F,v:()=>C,y:()=>Z});var O=J(12185),U=J(12379),h=J(12203),w=J(12636),g=J(12675);const B=U.ku.Black(),b={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function d(H,u,J){if(!H||H.LOGARITHMICDEPTH||H.indexOf&&H.indexOf("LOGARITHMICDEPTH")>=0){const H=J.activeCamera;1===H.mode&&O.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),u.setFloat("logarithmicDepthConstant",2/(Math.log(H.maxZ+1)/Math.LN2))}}function G(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];J&&H.fogEnabled&&(!u||u.applyFog)&&0!==H.fogMode&&(J.setFloat4("vFogInfos",H.fogMode,H.fogStart,H.fogEnd,H.fogDensity),O?(H.fogColor.toLinearSpaceToRef(B,H.getEngine().useExactSrgbConversions),J.setColor3("vFogColor",B)):J.setColor3("vFogColor",H.fogColor))}function P(H,u,J,O,U,h,w,g,B,d){const G=H.numMaxInfluencers||H.numInfluencers;return G<=0?0:(u.push("#define MORPHTARGETS"),H.hasPositions&&u.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),H.hasNormals&&u.push("#define MORPHTARGETTEXTURE_HASNORMALS"),H.hasTangents&&u.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),H.hasUVs&&u.push("#define MORPHTARGETTEXTURE_HASUVS"),H.hasUV2s&&u.push("#define MORPHTARGETTEXTURE_HASUV2S"),H.hasColors&&u.push("#define MORPHTARGETTEXTURE_HASCOLORS"),H.supportsPositions&&U&&u.push("#define MORPHTARGETS_POSITION"),H.supportsNormals&&h&&u.push("#define MORPHTARGETS_NORMAL"),H.supportsTangents&&w&&u.push("#define MORPHTARGETS_TANGENT"),H.supportsUVs&&g&&u.push("#define MORPHTARGETS_UV"),H.supportsUV2s&&B&&u.push("#define MORPHTARGETS_UV2"),H.supportsColors&&d&&u.push("#define MORPHTARGETS_COLOR"),u.push("#define NUM_MORPH_INFLUENCERS "+G),H.isUsingTextureForTargets&&u.push("#define MORPHTARGETS_TEXTURE"),b.NUM_MORPH_INFLUENCERS=G,b.NORMAL=h,b.TANGENT=w,b.UV=g,b.UV2=B,b.COLOR=d,mH(J,O,b,U),G)}function mH(H,u,J){let U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=J.NUM_MORPH_INFLUENCERS;if(w>0&&h.e.LastCreatedEngine){const g=h.e.LastCreatedEngine.getCaps().maxVertexAttribs,B=u.morphTargetManager;if(null!==B&&void 0!==B&&B.isUsingTextureForTargets)return;const b=B&&B.supportsPositions&&U,d=B&&B.supportsNormals&&J.NORMAL,G=B&&B.supportsTangents&&J.TANGENT,P=B&&B.supportsUVs&&J.UV1,mH=B&&B.supportsUV2s&&J.UV2,l=B&&B.supportsColors&&J.VERTEXCOLOR;for(let J=0;J<w;J++)b&&H.push("position"+J),d&&H.push("normal"+J),G&&H.push("tangent"+J),P&&H.push("uv_"+J),mH&&H.push("uv2_"+J),l&&H.push("color"+J),H.length>g&&O.b.Error("Cannot add more vertex attributes for mesh "+u.name)}}function l(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H.push("world0"),H.push("world1"),H.push("world2"),H.push("world3"),u&&(H.push("previousWorld0"),H.push("previousWorld1"),H.push("previousWorld2"),H.push("previousWorld3"))}function r(H,u){const J=H.morphTargetManager;H&&J&&u.setFloatArray("morphTargetInfluences",J.influences)}function p(H,u){u.bindToEffect(H,"Scene")}function a(H,u,J){u._needUVs=!0,u[J]=!0,H.optimizeUVAllocation&&H.getTextureMatrix().isIdentityAs3x2()?(u[J+"DIRECTUV"]=H.coordinatesIndex+1,u["MAINUV"+(H.coordinatesIndex+1)]=!0):u[J+"DIRECTUV"]=0}function k(H,u,J){const O=H.getTextureMatrix();u.wg(J+"Matrix",O)}function C(H,u,J){J.BAKED_VERTEX_ANIMATION_TEXTURE&&J.INSTANCES&&H.push("bakedVertexAnimationSettingsInstanced")}function j(H,u,J){var O;if(u&&H&&(H.computeBonesUsingShaders&&u._bonesComputationForcedToCPU&&(H.computeBonesUsingShaders=!1),H.useBones&&H.computeBonesUsingShaders&&H.skeleton)){const U=H.skeleton;if(U.isUsingTextureForMatrices&&u.getUniformIndex("boneTextureWidth")>-1){const J=U.getTransformMatrixTexture(H);u.setTexture("boneSampler",J),u.setFloat("boneTextureWidth",4*(U.bones.length+1))}else{const h=U.getTransformMatrices(H);h&&(u.setMatrices("mBones",h),J&&H.ZH().prePassRenderer&&H.ZH().prePassRenderer.getIndex(2)&&(J.previousBones[H.uniqueId]||(J.previousBones[H.uniqueId]=h.slice()),u.setMatrices("mPreviousBones",J.previousBones[H.uniqueId]),O=h,J.previousBones[H.uniqueId].set(O)))}}}function M(H,u,J,O,U){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];H._bindLight(u,J,O,U,h)}function L(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const h=Math.min(u.lightSources.length,U);for(let w=0;w<h;w++){M(u.lightSources[w],w,H,J,"boolean"===typeof O?O:O.SPECULARTERM,u.receiveShadows)}}function Z(H,u,J,O){J.NUM_BONE_INFLUENCERS>0&&(O.addCPUSkinningFallback(0,u),H.push("matricesIndices"),H.push("matricesWeights"),J.NUM_BONE_INFLUENCERS>4&&(H.push("matricesIndicesExtra"),H.push("matricesWeightsExtra")))}function Y(H,u){(u.INSTANCES||u.THIN_INSTANCES)&&l(H,!!u.PREPASS_VELOCITY),u.INSTANCESCOLOR&&H.push("instanceColor")}function F(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=0;for(let h=0;h<J&&H["LIGHT"+h];h++)h>0&&(U=O+h,u.addFallback(U,"LIGHT"+h)),H.SHADOWS||(H["SHADOW"+h]&&u.addFallback(O,"SHADOW"+h),H["SHADOWPCF"+h]&&u.addFallback(O,"SHADOWPCF"+h),H["SHADOWPCSS"+h]&&u.addFallback(O,"SHADOWPCSS"+h),H["SHADOWPOISSON"+h]&&u.addFallback(O,"SHADOWPOISSON"+h),H["SHADOWESM"+h]&&u.addFallback(O,"SHADOWESM"+h),H["SHADOWCLOSEESM"+h]&&u.addFallback(O,"SHADOWCLOSEESM"+h));return U++}function s(H,u,J,O,U,h,w){let g=arguments.length>7&&void 0!==arguments[7]&&arguments[7];w._areMiscDirty&&(w.LOGARITHMICDEPTH=J,w.POINTSIZE=O,w.FOG=U&&function(H,u){return u.fogEnabled&&H.applyFog&&0!==u.fogMode}(H,u),w.NONUNIFORMSCALING=H.nonUniformScaling,w.ALPHATEST=h,w.DECAL_AFTER_DETAIL=g)}function A(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!J._areLightsDirty)return J._needNormals;let w=0;const g={needNormals:J._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(H.lightsEnabled&&!h)for(const b of u.lightSources)if(t(H,u,b,w,J,O,g),w++,w===U)break;J.SPECULARTERM=g.specularEnabled,J.SHADOWS=g.shadowEnabled;for(let b=w;b<U;b++)void 0!==J["LIGHT"+b]&&(J["LIGHT"+b]=!1,J["HEMILIGHT"+b]=!1,J["POINTLIGHT"+b]=!1,J["DIRLIGHT"+b]=!1,J["SPOTLIGHT"+b]=!1,J["AREALIGHT"+b]=!1,J["SHADOW"+b]=!1,J["SHADOWCSM"+b]=!1,J["SHADOWCSMDEBUG"+b]=!1,J["SHADOWCSMNUM_CASCADES"+b]=!1,J["SHADOWCSMUSESHADOWMAXZ"+b]=!1,J["SHADOWCSMNOBLEND"+b]=!1,J["SHADOWCSM_RIGHTHANDED"+b]=!1,J["SHADOWPCF"+b]=!1,J["SHADOWPCSS"+b]=!1,J["SHADOWPOISSON"+b]=!1,J["SHADOWESM"+b]=!1,J["SHADOWCLOSEESM"+b]=!1,J["SHADOWCUBE"+b]=!1,J["SHADOWLOWQUALITY"+b]=!1,J["SHADOWMEDIUMQUALITY"+b]=!1);const B=H.getEngine().getCaps();return void 0===J.SHADOWFLOAT&&(g.needRebuild=!0),J.SHADOWFLOAT=g.shadowEnabled&&(B.textureFloatRender&&B.textureFloatLinearFiltering||B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering),J.LIGHTMAPEXCLUDED=g.lightmapMode,g.needRebuild&&J.rebuild(),g.needNormals}function t(H,u,J,O,U,h,g){switch(g.needNormals=!0,void 0===U["LIGHT"+O]&&(g.needRebuild=!0),U["LIGHT"+O]=!0,U["SPOTLIGHT"+O]=!1,U["HEMILIGHT"+O]=!1,U["POINTLIGHT"+O]=!1,U["DIRLIGHT"+O]=!1,U["AREALIGHT"+O]=!1,J.prepareLightSpecificDefines(U,O),U["LIGHT_FALLOFF_PHYSICAL"+O]=!1,U["LIGHT_FALLOFF_GLTF"+O]=!1,U["LIGHT_FALLOFF_STANDARD"+O]=!1,J.falloffType){case w.b.FALLOFF_GLTF:U["LIGHT_FALLOFF_GLTF"+O]=!0;break;case w.b.FALLOFF_PHYSICAL:U["LIGHT_FALLOFF_PHYSICAL"+O]=!0;break;case w.b.FALLOFF_STANDARD:U["LIGHT_FALLOFF_STANDARD"+O]=!0}if(h&&!J.cG.equalsFloats(0,0,0)&&(g.specularEnabled=!0),U["SHADOW"+O]=!1,U["SHADOWCSM"+O]=!1,U["SHADOWCSMDEBUG"+O]=!1,U["SHADOWCSMNUM_CASCADES"+O]=!1,U["SHADOWCSMUSESHADOWMAXZ"+O]=!1,U["SHADOWCSMNOBLEND"+O]=!1,U["SHADOWCSM_RIGHTHANDED"+O]=!1,U["SHADOWPCF"+O]=!1,U["SHADOWPCSS"+O]=!1,U["SHADOWPOISSON"+O]=!1,U["SHADOWESM"+O]=!1,U["SHADOWCLOSEESM"+O]=!1,U["SHADOWCUBE"+O]=!1,U["SHADOWLOWQUALITY"+O]=!1,U["SHADOWMEDIUMQUALITY"+O]=!1,u&&u.receiveShadows&&H.shadowsEnabled&&J.shadowEnabled){const u=J.getShadowGenerator(H.activeCamera)??J.getShadowGenerator();if(u){const H=u.getShadowMap();H&&H.renderList&&H.renderList.length>0&&(g.shadowEnabled=!0,u.prepareDefines(U,O))}}J.lightmapMode!=w.b.LIGHTMAP_DEFAULT?(g.lightmapMode=!0,U["LIGHTMAPEXCLUDED"+O]=!0,U["LIGHTMAPNOSPECULAR"+O]=J.lightmapMode==w.b.LIGHTMAP_SHADOWSONLY):(U["LIGHTMAPEXCLUDED"+O]=!1,U["LIGHTMAPNOSPECULAR"+O]=!1)}function e(H,u,J,O,U){let h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=function(H,u){let J=!1;if(H.activeCamera){const O=u.CAMERA_ORTHOGRAPHIC?1:0,U=u.CAMERA_PERSPECTIVE?1:0,h=1===H.activeCamera.mode?1:0,w=0===H.activeCamera.mode?1:0;(O^h||U^w)&&(u.CAMERA_ORTHOGRAPHIC=1===h,u.CAMERA_PERSPECTIVE=1===w,J=!0)}return J}(H,O);!1!==h&&(B=(0,g.i)(J,H,O)),O.DEPTHPREPASS!==!u.getColorWrite()&&(O.DEPTHPREPASS=!O.DEPTHPREPASS,B=!0),O.INSTANCES!==U&&(O.INSTANCES=U,B=!0),O.THIN_INSTANCES!==w&&(O.THIN_INSTANCES=w,B=!0),B&&O.markAsUnprocessed()}function c(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!u._areAttributesDirty&&u._needNormals===u._normals&&u._needUVs===u._uvs)return!1;u._normals=u._needNormals,u._uvs=u._needUVs,u.NORMAL=u._needNormals&&H.isVerticesDataPresent("normal"),u._needNormals&&H.isVerticesDataPresent("tangent")&&(u.TANGENT=!0);for(let g=1;g<=6;++g)u["UV"+g]=!!u._needUVs&&H.isVerticesDataPresent(`uv${1===g?"":g}`);if(J){const J=H.useVertexColors&&H.isVerticesDataPresent("color");u.VERTEXCOLOR=J,u.VERTEXALPHA=H.hasVertexAlpha&&J&&h}return H.isVerticesDataPresent("instanceColor")&&(H.hasInstances||H.hasThinInstances)&&(u.INSTANCESCOLOR=!0),O&&function(H,u){if(H.useBones&&H.computeBonesUsingShaders&&H.skeleton){u.NUM_BONE_INFLUENCERS=H.numBoneInfluencers;const J=void 0!==u.BONETEXTURE;if(H.skeleton.isUsingTextureForMatrices&&J)u.BONETEXTURE=!0;else{u.BonesPerMesh=H.skeleton.bones.length+1,u.BONETEXTURE=!J&&void 0;const O=H.ZH().prePassRenderer;if(O&&O.enabled){const J=-1===O.excludedSkinnedMesh.indexOf(H);u.BONES_VELOCITY_ENABLED=J}}}else u.NUM_BONE_INFLUENCERS=0,u.BonesPerMesh=0,void 0!==u.BONETEXTURE&&(u.BONETEXTURE=!1)}(H,u),U&&function(H,u){const J=H.morphTargetManager;J?(u.MORPHTARGETS_UV=J.supportsUVs&&u.UV1,u.MORPHTARGETS_UV2=J.supportsUV2s&&u.UV2,u.MORPHTARGETS_TANGENT=J.supportsTangents&&u.TANGENT,u.MORPHTARGETS_NORMAL=J.supportsNormals&&u.NORMAL,u.MORPHTARGETS_POSITION=J.supportsPositions,u.MORPHTARGETS_COLOR=J.supportsColors,u.MORPHTARGETTEXTURE_HASUVS=J.hasUVs,u.MORPHTARGETTEXTURE_HASUV2S=J.hasUV2s,u.MORPHTARGETTEXTURE_HASTANGENTS=J.hasTangents,u.MORPHTARGETTEXTURE_HASNORMALS=J.hasNormals,u.MORPHTARGETTEXTURE_HASPOSITIONS=J.hasPositions,u.MORPHTARGETTEXTURE_HASCOLORS=J.hasColors,u.NUM_MORPH_INFLUENCERS=J.numMaxInfluencers||J.numInfluencers,u.MORPHTARGETS=u.NUM_MORPH_INFLUENCERS>0,u.MORPHTARGETS_TEXTURE=J.isUsingTextureForTargets):(u.MORPHTARGETS_UV=!1,u.MORPHTARGETS_UV2=!1,u.MORPHTARGETS_TANGENT=!1,u.MORPHTARGETS_NORMAL=!1,u.MORPHTARGETS_POSITION=!1,u.MORPHTARGETS_COLOR=!1,u.MORPHTARGETTEXTURE_HASUVS=!1,u.MORPHTARGETTEXTURE_HASUV2S=!1,u.MORPHTARGETTEXTURE_HASTANGENTS=!1,u.MORPHTARGETTEXTURE_HASNORMALS=!1,u.MORPHTARGETTEXTURE_HASPOSITIONS=!1,u.MORPHTARGETTEXTURE_HAS_COLORS=!1,u.MORPHTARGETS=!1,u.NUM_MORPH_INFLUENCERS=0)}(H,u),w&&function(H,u){const J=H.bakedVertexAnimationManager;u.BAKED_VERTEX_ANIMATION_TEXTURE=!(!J||!J.isEnabled)}(H,u),!0}function n(H,u){if(H.activeCamera){const J=u.MULTIVIEW;u.MULTIVIEW=null!==H.activeCamera.outputRenderTarget&&H.activeCamera.outputRenderTarget.getViewCount()>1,u.MULTIVIEW!=J&&u.markAsUnprocessed()}}function V(H,u,J){const O=u.ORDER_INDEPENDENT_TRANSPARENCY,U=u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;u.ORDER_INDEPENDENT_TRANSPARENCY=H.useOrderIndependentTransparency&&J,u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!H.getEngine().getCaps().textureFloatLinearFiltering,O===u.ORDER_INDEPENDENT_TRANSPARENCY&&U===u.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||u.markAsUnprocessed()}function T(H,u,J){const O=u.PREPASS;if(!u._arePrePassDirty)return;const U=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(H.prePassRenderer&&H.prePassRenderer.enabled&&J){u.PREPASS=!0,u.SCENE_MRT_COUNT=H.prePassRenderer.mrtCount,u.PREPASS_NORMAL_WORLDSPACE=H.prePassRenderer.generateNormalsInWorldSpace,u.PREPASS_COLOR=!0,u.PREPASS_COLOR_INDEX=0;for(let J=0;J<U.length;J++){const O=H.prePassRenderer.getIndex(U[J].type);-1!==O?(u[U[J].define]=!0,u[U[J].index]=O):u[U[J].define]=!1}}else{u.PREPASS=!1;for(let H=0;H<U.length;H++)u[U[H].define]=!1}u.PREPASS!=O&&(u.markAsUnprocessed(),u.markAsImageProcessingDirty())}function R(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];U&&U.push("Light"+H),h||(u.push("vLightData"+H,"vLightDiffuse"+H,"vLightSpecular"+H,"vLightDirection"+H,"vLightWidth"+H,"vLightHeight"+H,"vLightFalloff"+H,"vLightGround"+H,"lightMatrix"+H,"shadowsInfo"+H,"depthValues"+H),J.push("shadowTexture"+H),J.push("depthTexture"+H),u.push("viewFrustumZ"+H,"cascadeBlendFactor"+H,"lightSizeUVCorrection"+H,"depthCorrection"+H,"penumbraDarkness"+H,"frustumLengths"+H),O&&(J.push("projectionLightTexture"+H),u.push("textureProjectionMatrix"+H)),w&&J.push("iesLightTexture"+H))}function X(H,u,J){let O,U,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(H.uniformsNames){const w=H;O=w.uniformsNames,U=w.uniformBuffersNames,u=w.samplers,J=w.defines,h=w.maxSimultaneousLights||0}else O=H,u||(u=[]);for(let w=0;w<h&&J["LIGHT"+w];w++)R(w,O,u,J["PROJECTEDLIGHTTEXTURE"+w],U,!1,J["IESLIGHTTEXTURE"+w]);J.NUM_MORPH_INFLUENCERS&&(O.push("morphTargetInfluences"),O.push("morphTargetCount")),J.BAKED_VERTEX_ANIMATION_TEXTURE&&(O.push("bakedVertexAnimationSettings"),O.push("bakedVertexAnimationTextureSizeInverted"),O.push("bakedVertexAnimationTime"),u.push("bakedVertexAnimationTexture"))}},12645:(H,u,J)=>{J.d(u,{c:()=>h});var O=J(12338),U=J(12651);class h extends U.b{constructor(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(H,u,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new O.Matrix,this._storeEffectOnSubMeshes=J}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(H,u){return!!H&&(!this._storeEffectOnSubMeshes||(!H.mg||0===H.mg.length||this.isReadyForSubMesh(H,H.mg[0],u)))}_isReadyForSubMesh(H){const u=H.materialDefines;return!(this.checkReadyOnEveryCall||!H.effect||!u||u._renderId!==this.ZH().getRenderId())}bindOnlyWorldMatrix(H){this._activeEffect.setMatrix("world",H)}bindOnlyNormalMatrix(H){this._activeEffect.setMatrix("normalMatrix",H)}bind(H,u){u&&this.bindForSubMesh(H,u,u.mg[0])}_afterBind(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0;super._afterBind(H,u,J),this.ZH()._cachedEffect=u,J?J._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return J._drawWrapper._forceRebindOnNextCall||H.isCachedMaterialInvalid(this,u,O)}dispose(H,u,J){this._activeEffect=void 0,super.dispose(H,u,J)}}},12668:(H,u,J)=>{J.d(u,{e:()=>g,i:()=>B});var O=J(12324),U=J(12338),h=J(12329);class w{static extractMinAndMaxIndexed(H,u,J,O,U,h){for(let w=J;w<J+O;w++){const J=3*u[w],O=H[J],g=H[J+1],B=H[J+2];U.minimizeInPlaceFromFloats(O,g,B),h.maximizeInPlaceFromFloats(O,g,B)}}static extractMinAndMax(H,u,J,O,U,h){for(let w=u,g=u*O;w<u+J;w++,g+=O){const u=H[g],J=H[g+1],O=H[g+2];U.minimizeInPlaceFromFloats(u,J,O),h.maximizeInPlaceFromFloats(u,J,O)}}}function g(H,u,J,O){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const g=new U.lu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new U.lu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return w.extractMinAndMaxIndexed(H,u,J,O,g,B),h&&(g.x-=g.x*h.x+h.y,g.y-=g.y*h.x+h.y,g.z-=g.z*h.x+h.y,B.x+=B.x*h.x+h.y,B.y+=B.y*h.x+h.y,B.z+=B.z*h.x+h.y),{minimum:g,maximum:B}}function B(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;const g=new U.lu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new U.lu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return h||(h=3),w.extractMinAndMax(H,u,J,h,g,B),O&&(g.x-=g.x*O.x+O.y,g.y-=g.y*O.x+O.y,g.z-=g.z*O.x+O.y,B.x+=B.x*O.x+O.y,B.y+=B.y*O.x+O.y,B.z+=B.z*O.x+O.y),{minimum:g,maximum:B}}(0,O.c)([h.f.filter((function(){for(var H=arguments.length,u=new Array(H),J=0;J<H;J++)u[J]=arguments[J];let[O,U]=u;return!Array.isArray(O)&&!Array.isArray(U)}))],w,"extractMinAndMaxIndexed",null),(0,O.c)([h.f.filter((function(){for(var H=arguments.length,u=new Array(H),J=0;J<H;J++)u[J]=arguments[J];let[O]=u;return!Array.isArray(O)}))],w,"extractMinAndMax",null)},12653:(H,u,J)=>{J.d(u,{c:()=>B});var O=J(12410),U=J(12655),h=J(12659),w=J(12668),g=J(12445);class B{get materialDefines(){var H;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(H=this._getDrawWrapper())||void 0===H?void 0:H.defines}set materialDefines(H){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=H}_getDrawWrapper(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H=H??this._engine.currentRenderPassId;let J=this._drawWrappers[H];return!J&&u&&(this._drawWrappers[H]=J=new g.c(this._mesh.ZH().getEngine())),J}_removeDrawWrapper(H){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var J;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(J=this._drawWrappers[H])||void 0===J||J.dispose(u));this._drawWrappers[H]=void 0}get effect(){var H;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(H=this._getDrawWrapper())||void 0===H?void 0:H.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(H){this._mainDrawWrapperOverride=H}setEffect(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=this._drawWrapper;U.setEffect(H,u,O),void 0!==J&&(U.materialContext=J),H||(U.defines=null,U.materialContext=void 0)}resetDrawCache(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==H)return void this._removeDrawWrapper(H,!0,u);for(const H of this._drawWrappers)null===H||void 0===H||H.dispose(u)}this._drawWrappers=[]}static AddToMesh(H,u,J,O,U,h,w){return new B(H,u,J,O,U,h,w,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(H,u,J,O,U,h,w){let g=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],B=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=H,this.verticesStart=u,this.verticesCount=J,this.indexStart=O,this.indexCount=U,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=w||h,B&&h.mg.push(this),this._engine=this._mesh.ZH().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=h.mg.length-1,g&&(this.refreshBoundingInfo(),h.dg(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(H){return this._boundingInfo=H,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const H=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return H||this._renderingMesh}XH(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!u)return H&&this._mesh.ZH()._hasDefaultMaterial?this._mesh.ZH().defaultMaterial:null;if(this._isMultiMaterial(u)){const H=u.getSubMaterial(this.materialIndex);return this._currentMaterial!==H&&(this._currentMaterial=H,this.resetDrawCache()),H}return u}_isMultiMaterial(H){return void 0!==H.getSubMaterial}refreshBoundingInfo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Gg)return this;if(H||(H=this._renderingMesh.getVerticesData(O.d.PositionKind)),!H)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const u=this._renderingMesh.rg();let J;if(0===this.indexStart&&this.indexCount===u.length){const H=this._renderingMesh.getBoundingInfo();J={minimum:H.minimum.clone(),maximum:H.maximum.clone()}}else J=(0,w.e)(H,u,this.indexStart,this.indexCount,this._renderingMesh.Gg.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(J.minimum,J.maximum):this._boundingInfo=new h.d(J.minimum,J.maximum),this}_checkCollision(H){return this.getBoundingInfo()._checkCollision(H)}updateBoundingInfo(H){let u=this.getBoundingInfo();return u||(this.refreshBoundingInfo(),u=this.getBoundingInfo()),u&&u.update(H),this}isInFrustum(H){const u=this.getBoundingInfo();return!!u&&u.isInFrustum(H,this._mesh.TP)}isCompletelyInFrustum(H){const u=this.getBoundingInfo();return!!u&&u.isCompletelyInFrustum(H)}render(H){return this._renderingMesh.render(this,H,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(H,u){if(!this._linesIndexBuffer){const J=6*Math.floor(this.indexCount/3),O=this.verticesStart+this.verticesCount>65535?new Uint32Array(J):new Uint16Array(J);let U=0;if(0===H.length)for(let H=this.indexStart;H<this.indexStart+this.indexCount;H+=3)O[U++]=H,O[U++]=H+1,O[U++]=H+1,O[U++]=H+2,O[U++]=H+2,O[U++]=H;else for(let u=this.indexStart;u<this.indexStart+this.indexCount;u+=3)O[U++]=H[u],O[U++]=H[u+1],O[U++]=H[u+1],O[U++]=H[u+2],O[U++]=H[u+2],O[U++]=H[u];this._linesIndexBuffer=u.createIndexBuffer(O),this._linesIndexCount=O.length}return this._linesIndexBuffer}canIntersects(H){const u=this.getBoundingInfo();return!!u&&H.intersectsBox(u.boundingBox)}intersects(H,u,J,O,U){const h=this.XH();if(!h)return null;let w=3,g=!1;switch(h.fillMode){case 3:case 5:case 6:case 8:return null;case 7:w=1,g=!0}return 4===h.fillMode?J.length?this._intersectLines(H,u,J,this._mesh.intersectionThreshold,O):this._intersectUnIndexedLines(H,u,J,this._mesh.intersectionThreshold,O):!J.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(H,u,J,O,U):this._intersectTriangles(H,u,J,w,g,O,U)}_intersectLines(H,u,J,O,h){let w=null;for(let g=this.indexStart;g<this.indexStart+this.indexCount;g+=2){const B=u[J[g]],b=u[J[g+1]],d=H.intersectionSegment(B,b,O);if(!(d<0)&&((h||!w||d<w.distance)&&(w=new U.e(null,null,d),w.faceId=g/2,h)))break}return w}_intersectUnIndexedLines(H,u,J,O,h){let w=null;for(let g=this.verticesStart;g<this.verticesStart+this.verticesCount;g+=2){const J=u[g],B=u[g+1],b=H.intersectionSegment(J,B,O);if(!(b<0)&&((h||!w||b<w.distance)&&(w=new U.e(null,null,b),w.faceId=g/2,h)))break}return w}_intersectTriangles(H,u,J,O,U,h,w){let g=null,B=-1;for(let b=this.indexStart;b<this.indexStart+this.indexCount-(3-O);b+=O){B++;const O=J[b],d=J[b+1],G=J[b+2];if(U&&4294967295===G){b+=2;continue}const P=u[O],mH=u[d],l=u[G];if(!P||!mH||!l)continue;if(w&&!w(P,mH,l,H,O,d,G))continue;const r=H.intersectsTriangle(P,mH,l);if(r){if(r.distance<0)continue;if((h||!g||r.distance<g.distance)&&(g=r,g.faceId=B,h))break}}return g}_intersectUnIndexedTriangles(H,u,J,O,U){let h=null;for(let w=this.verticesStart;w<this.verticesStart+this.verticesCount;w+=3){const J=u[w],g=u[w+1],B=u[w+2];if(U&&!U(J,g,B,H,-1,-1,-1))continue;const b=H.intersectsTriangle(J,g,B);if(b){if(b.distance<0)continue;if((O||!h||b.distance<h.distance)&&(h=b,h.faceId=w/3,O))break}}return h}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(H,u){const J=new B(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,H,u,!1);if(!this.IsGlobal){const H=this.getBoundingInfo();if(!H)return J;J._boundingInfo=new h.d(H.minimum,H.maximum)}return J}dispose(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.ZH().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this._mesh.mg.indexOf(this);this._mesh.mg.splice(u,1),this.resetDrawCache(void 0,H)}getClassName(){return"SubMesh"}static CreateFromIndices(H,u,J,O,U){let h=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=Number.MAX_VALUE,g=-Number.MAX_VALUE;const b=(U||O).rg();for(let B=u;B<u+J;B++){const H=b[B];H<w&&(w=H),H>g&&(g=H)}return new B(H,w,g-w+1,u,J,O,U,h)}}}}]);