"use strict";(self.xeuzlpp225k=self.xeuzlpp225k||[]).push([[24],{11625:(k,Q,i)=>{i.d(Q,{e:()=>Z});class Z{constructor(k,Q,i){this.bu=k,this.bv=Q,this.distance=i,this.faceId=0,this.subMeshId=0}}},11633:(k,Q,i)=>{i.d(Q,{c:()=>B});var Z=i(11307),U=i(11298),C=i(11304);class B{constructor(k,Q,i){this.vectors=(0,Z.c)(8,U.zQ.Zero),this.center=U.zQ.Zero(),this.centerWorld=U.zQ.Zero(),this.extendSize=U.zQ.Zero(),this.extendSizeWorld=U.zQ.Zero(),this.directions=(0,Z.c)(3,U.zQ.Zero),this.vectorsWorld=(0,Z.c)(8,U.zQ.Zero),this.minimumWorld=U.zQ.Zero(),this.maximumWorld=U.zQ.Zero(),this.minimum=U.zQ.Zero(),this.maximum=U.zQ.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(k,Q,i)}reConstruct(k,Q,i){const Z=k.x,C=k.y,B=k.z,o=Q.x,m=Q.y,O=Q.z,J=this.vectors;this.minimum.Go(Z,C,B),this.maximum.Go(o,m,O),J[0].Go(Z,C,B),J[1].Go(o,m,O),J[2].Go(o,C,B),J[3].Go(Z,m,B),J[4].Go(Z,C,O),J[5].Go(o,m,B),J[6].Go(Z,m,O),J[7].Go(o,C,O),Q.addToRef(k,this.center).scaleInPlace(.5),Q.subtractToRef(k,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||U.Matrix.IdentityReadOnly,this._update(this._worldMatrix)}scale(k){const Q=B._TmpVector3,i=this.maximum.subtractToRef(this.minimum,Q[0]),Z=i.length();i.normalizeFromLength(Z);const U=Z*k,C=i.scaleInPlace(.5*U),o=this.center.subtractToRef(C,Q[1]),m=this.center.addToRef(C,Q[2]);return this.reConstruct(o,m,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(k){const Q=this.minimumWorld,i=this.maximumWorld,Z=this.directions,C=this.vectorsWorld,B=this.vectors;if(k.isIdentity()){Q.B(this.minimum),i.B(this.maximum);for(let k=0;k<8;++k)C[k].B(B[k]);this.extendSizeWorld.B(this.extendSize),this.centerWorld.B(this.center)}else{Q.eo(Number.MAX_VALUE),i.eo(-Number.MAX_VALUE);for(let Z=0;Z<8;++Z){const o=C[Z];U.zQ.TransformCoordinatesToRef(B[Z],k,o),Q.minimizeInPlace(o),i.maximizeInPlace(o)}i.subtractToRef(Q,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(Q,this.centerWorld).scaleInPlace(.5)}U.zQ.FromArrayToRef(k.m,0,Z[0]),U.zQ.FromArrayToRef(k.m,4,Z[1]),U.zQ.FromArrayToRef(k.m,8,Z[2]),this._worldMatrix=k}isInFrustum(k){return B.IsInFrustum(this.vectorsWorld,k)}isCompletelyInFrustum(k){return B.IsCompletelyInFrustum(this.vectorsWorld,k)}intersectsPoint(k){const Q=this.minimumWorld,i=this.maximumWorld,Z=Q.x,U=Q.y,B=Q.z,o=i.x,m=i.y,O=i.z,J=k.x,G=k.y,H=k.z,e=-C.e;return!(o-J<e||e>J-Z)&&(!(m-G<e||e>G-U)&&!(O-H<e||e>H-B))}intersectsSphere(k){return B.IntersectsSphere(this.minimumWorld,this.maximumWorld,k.centerWorld,k.radiusWorld)}intersectsMinMax(k,Q){const i=this.minimumWorld,Z=this.maximumWorld,U=i.x,C=i.y,B=i.z,o=Z.x,m=Z.y,O=Z.z,J=k.x,G=k.y,H=k.z,e=Q.x,F=Q.y,z=Q.z;return!(o<J||U>e)&&(!(m<G||C>F)&&!(O<H||B>z))}dispose(){var k,Q;null===(k=this._drawWrapperFront)||void 0===k||k.dispose(),null===(Q=this._drawWrapperBack)||void 0===Q||Q.dispose()}static Intersects(k,Q){return k.intersectsMinMax(Q.minimumWorld,Q.maximumWorld)}static IntersectsSphere(k,Q,i,Z){const C=B._TmpVector3[0];U.zQ.ClampToRef(i,k,Q,C);return U.zQ.DistanceSquared(i,C)<=Z*Z}static IsCompletelyInFrustum(k,Q){for(let i=0;i<6;++i){const Z=Q[i];for(let Q=0;Q<8;++Q)if(Z.dotCoordinate(k[Q])<0)return!1}return!0}static IsInFrustum(k,Q){for(let i=0;i<6;++i){let Z=!0;const U=Q[i];for(let Q=0;Q<8;++Q)if(U.dotCoordinate(k[Q])>=0){Z=!1;break}if(Z)return!1}return!0}}B._TmpVector3=(0,Z.c)(3,U.zQ.Zero)},11631:(k,Q,i)=>{i.d(Q,{c:()=>G});var Z=i(11307),U=i(11298),C=i(11633),B=i(11641);const o={min:0,max:0},m={min:0,max:0},O=(k,Q,i)=>{const Z=U.zQ.Dot(Q.centerWorld,k),C=Math.abs(U.zQ.Dot(Q.directions[0],k))*Q.extendSize.x+Math.abs(U.zQ.Dot(Q.directions[1],k))*Q.extendSize.y+Math.abs(U.zQ.Dot(Q.directions[2],k))*Q.extendSize.z;i.min=Z-C,i.max=Z+C},J=(k,Q,i)=>(O(k,Q,o),O(k,i,m),!(o.min>m.max||m.min>o.max));class G{constructor(k,Q,i){this._isLocked=!1,this.boundingBox=new C.c(k,Q,i),this.boundingSphere=new B.d(k,Q,i)}reConstruct(k,Q,i){this.boundingBox.reConstruct(k,Q,i),this.boundingSphere.reConstruct(k,Q,i)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(k){this._isLocked=k}update(k){this._isLocked||(this.boundingBox._update(k),this.boundingSphere._update(k))}centerOn(k,Q){const i=G._TmpVector3[0].B(k).tJ(Q),Z=G._TmpVector3[1].B(k).addInPlace(Q);return this.boundingBox.reConstruct(i,Z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,Z,this.boundingBox.getWorldMatrix()),this}encapsulate(k){const Q=U.zQ.Minimize(this.minimum,k),i=U.zQ.Maximize(this.maximum,k);return this.reConstruct(Q,i,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(k){const Q=U.TmpVectors.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(Q);const i=U.TmpVectors.zQ[0];return U.zQ.TransformCoordinatesToRef(k.boundingBox.minimumWorld,Q,i),this.encapsulate(i),U.zQ.TransformCoordinatesToRef(k.boundingBox.maximumWorld,Q,i),this.encapsulate(i),this}scale(k){return this.boundingBox.scale(k),this.boundingSphere.scale(k),this}isInFrustum(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===Q||3===Q)&&this.boundingSphere.isCenterInFrustum(k))return!0;if(!this.boundingSphere.isInFrustum(k))return!1;return!(1!==Q&&3!==Q)||this.boundingBox.isInFrustum(k)}get diagonalLength(){const k=this.boundingBox;return k.maximumWorld.subtractToRef(k.minimumWorld,G._TmpVector3[0]).length()}isCompletelyInFrustum(k){return this.boundingBox.isCompletelyInFrustum(k)}_checkCollision(k){return k._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(k){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(k)&&!!this.boundingBox.intersectsPoint(k))}intersects(k,Q){if(!B.d.Intersects(this.boundingSphere,k.boundingSphere))return!1;if(!C.c.Intersects(this.boundingBox,k.boundingBox))return!1;if(!Q)return!0;const i=this.boundingBox,Z=k.boundingBox;return!!J(i.directions[0],i,Z)&&(!!J(i.directions[1],i,Z)&&(!!J(i.directions[2],i,Z)&&(!!J(Z.directions[0],i,Z)&&(!!J(Z.directions[1],i,Z)&&(!!J(Z.directions[2],i,Z)&&(!!J(U.zQ.Cross(i.directions[0],Z.directions[0]),i,Z)&&(!!J(U.zQ.Cross(i.directions[0],Z.directions[1]),i,Z)&&(!!J(U.zQ.Cross(i.directions[0],Z.directions[2]),i,Z)&&(!!J(U.zQ.Cross(i.directions[1],Z.directions[0]),i,Z)&&(!!J(U.zQ.Cross(i.directions[1],Z.directions[1]),i,Z)&&(!!J(U.zQ.Cross(i.directions[1],Z.directions[2]),i,Z)&&(!!J(U.zQ.Cross(i.directions[2],Z.directions[0]),i,Z)&&(!!J(U.zQ.Cross(i.directions[2],Z.directions[1]),i,Z)&&!!J(U.zQ.Cross(i.directions[2],Z.directions[2]),i,Z))))))))))))))}}G._TmpVector3=(0,Z.c)(2,U.zQ.Zero)},11641:(k,Q,i)=>{i.d(Q,{d:()=>C});var Z=i(11307),U=i(11298);class C{constructor(k,Q,i){this.center=U.zQ.Zero(),this.centerWorld=U.zQ.Zero(),this.minimum=U.zQ.Zero(),this.maximum=U.zQ.Zero(),this.reConstruct(k,Q,i)}reConstruct(k,Q,i){this.minimum.B(k),this.maximum.B(Q);const Z=U.zQ.Distance(k,Q);Q.addToRef(k,this.center).scaleInPlace(.5),this.radius=.5*Z,this._update(i||U.Matrix.IdentityReadOnly)}scale(k){const Q=this.radius*k,i=C._TmpVector3,Z=i[0].eo(Q),U=this.center.subtractToRef(Z,i[1]),B=this.center.addToRef(Z,i[2]);return this.reConstruct(U,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(k){if(k.isIdentity())this.centerWorld.B(this.center),this.radiusWorld=this.radius;else{U.zQ.TransformCoordinatesToRef(this.center,k,this.centerWorld);const Q=C._TmpVector3[0];U.zQ.TransformNormalFromFloatsToRef(1,1,1,k,Q),this.radiusWorld=Math.max(Math.abs(Q.x),Math.abs(Q.y),Math.abs(Q.z))*this.radius}}isInFrustum(k){const Q=this.centerWorld,i=this.radiusWorld;for(let Z=0;Z<6;Z++)if(k[Z].dotCoordinate(Q)<=-i)return!1;return!0}isCenterInFrustum(k){const Q=this.centerWorld;for(let i=0;i<6;i++)if(k[i].dotCoordinate(Q)<0)return!1;return!0}intersectsPoint(k){const Q=U.zQ.DistanceSquared(this.centerWorld,k);return!(this.radiusWorld*this.radiusWorld<Q)}static Intersects(k,Q){const i=U.zQ.DistanceSquared(k.centerWorld,Q.centerWorld),Z=k.radiusWorld+Q.radiusWorld;return!(Z*Z<i)}static CreateFromCenterAndRadius(k,Q,i){this._TmpVector3[0].B(k),this._TmpVector3[1].Go(0,0,Q),this._TmpVector3[2].B(k),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].tJ(this._TmpVector3[1]);const Z=new C(this._TmpVector3[0],this._TmpVector3[2]);return Z._worldMatrix=i||U.Matrix.Identity(),Z}}C._TmpVector3=(0,Z.c)(3,U.zQ.Zero)},11657:(k,Q,i)=>{function Z(k){-1===k.indexOf("vClipPlane")&&k.push("vClipPlane"),-1===k.indexOf("vClipPlane2")&&k.push("vClipPlane2"),-1===k.indexOf("vClipPlane3")&&k.push("vClipPlane3"),-1===k.indexOf("vClipPlane4")&&k.push("vClipPlane4"),-1===k.indexOf("vClipPlane5")&&k.push("vClipPlane5"),-1===k.indexOf("vClipPlane6")&&k.push("vClipPlane6")}function U(k,Q,i){const Z=!!(k.clipPlane??Q.clipPlane),U=!!(k.clipPlane2??Q.clipPlane2),C=!!(k.clipPlane3??Q.clipPlane3),B=!!(k.clipPlane4??Q.clipPlane4),o=!!(k.clipPlane5??Q.clipPlane5),m=!!(k.clipPlane6??Q.clipPlane6);Z&&i.push("#define CLIPPLANE"),U&&i.push("#define CLIPPLANE2"),C&&i.push("#define CLIPPLANE3"),B&&i.push("#define CLIPPLANE4"),o&&i.push("#define CLIPPLANE5"),m&&i.push("#define CLIPPLANE6")}function C(k,Q,i){let Z=!1;const U=!!(k.clipPlane??Q.clipPlane),C=!!(k.clipPlane2??Q.clipPlane2),B=!!(k.clipPlane3??Q.clipPlane3),o=!!(k.clipPlane4??Q.clipPlane4),m=!!(k.clipPlane5??Q.clipPlane5),O=!!(k.clipPlane6??Q.clipPlane6);return i.CLIPPLANE!==U&&(i.CLIPPLANE=U,Z=!0),i.CLIPPLANE2!==C&&(i.CLIPPLANE2=C,Z=!0),i.CLIPPLANE3!==B&&(i.CLIPPLANE3=B,Z=!0),i.CLIPPLANE4!==o&&(i.CLIPPLANE4=o,Z=!0),i.CLIPPLANE5!==m&&(i.CLIPPLANE5=m,Z=!0),i.CLIPPLANE6!==O&&(i.CLIPPLANE6=O,Z=!0),Z}function B(k,Q,i){let Z=Q.clipPlane??i.clipPlane;o(k,"vClipPlane",Z),Z=Q.clipPlane2??i.clipPlane2,o(k,"vClipPlane2",Z),Z=Q.clipPlane3??i.clipPlane3,o(k,"vClipPlane3",Z),Z=Q.clipPlane4??i.clipPlane4,o(k,"vClipPlane4",Z),Z=Q.clipPlane5??i.clipPlane5,o(k,"vClipPlane5",Z),Z=Q.clipPlane6??i.clipPlane6,o(k,"vClipPlane6",Z)}function o(k,Q,i){i&&k.setFloat4(Q,i.normal.x,i.normal.y,i.normal.z,i.d)}i.d(Q,{c:()=>Z,g:()=>B,h:()=>C,i:()=>U})},11603:(k,Q,i)=>{i.d(Q,{e:()=>Z});class Z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(k,Q){this._defines[k]||(k<this._currentRank&&(this._currentRank=k),k>this._maxRank&&(this._maxRank=k),this._defines[k]=new Array),this._defines[k].push(Q)}addCPUSkinningFallback(k,Q){this._mesh=Q,k<this._currentRank&&(this._currentRank=k),k>this._maxRank&&(this._maxRank=k)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(k,Q){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,k=k.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),Q._bonesComputationForcedToCPU=!0;const i=this._mesh.sk();for(let k=0;k<i.meshes.length;k++){const Z=i.meshes[k];if(Z.material){if(Z.computeBonesUsingShaders&&0!==Z.numBoneInfluencers)if(Z.material.getEffect()===Q)Z.computeBonesUsingShaders=!1;else if(Z.io)for(const k of Z.io){if(k.effect===Q){Z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&Z.computeBonesUsingShaders&&Z.numBoneInfluencers>0&&(Z.computeBonesUsingShaders=!1)}}else{const Q=this._defines[this._currentRank];if(Q)for(let i=0;i<Q.length;i++)k=k.replace("#define "+Q[i],"");this._currentRank++}return k}}},11615:(k,Q,i)=>{i.d(Q,{c:()=>E});var Z=i(11280),U=i(11289),C=i(11119),B=i(11122),o=i(11157),m=i(11621),O=i(11555),J=i(11134),G=i(11355),H=i(11414),e=i(11334);class F{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(k){this._func=k}get funcRef(){return this._funcRef}set funcRef(k){this._funcRef=k}get funcMask(){return this._funcMask}set funcMask(k){this._funcMask=k}get opStencilFail(){return this._opStencilFail}set opStencilFail(k){this._opStencilFail=k}get opDepthFail(){return this._opDepthFail}set opDepthFail(k){this._opDepthFail=k}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(k){this._opStencilDepthPass=k}get mask(){return this._mask}set mask(k){this._mask=k}get enabled(){return this._enabled}set enabled(k){this._enabled=k}getClassName(){return"MaterialStencilState"}copyTo(k){e.d.Clone((()=>k),this)}serialize(){return e.d.Serialize(this)}parse(k,Q,i){e.d.Parse((()=>this),k,Q,i)}}(0,Z.c)([(0,U.L)()],F.prototype,"func",null),(0,Z.c)([(0,U.L)()],F.prototype,"funcRef",null),(0,Z.c)([(0,U.L)()],F.prototype,"funcMask",null),(0,Z.c)([(0,U.L)()],F.prototype,"opStencilFail",null),(0,Z.c)([(0,U.L)()],F.prototype,"opDepthFail",null),(0,Z.c)([(0,U.L)()],F.prototype,"opStencilDepthPass",null),(0,Z.c)([(0,U.L)()],F.prototype,"mask",null),(0,Z.c)([(0,U.L)()],F.prototype,"enabled",null);var z=i(11652);class E{get _supportGlowLayer(){return!1}set _glowModeEnabled(k){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(k){if(this._alpha===k)return;const Q=this._alpha;this._alpha=k,1!==Q&&1!==k||this.DO(E.MiscDirtyFlag+E.PrePassDirtyFlag)}get alpha(){return this._alpha}set Jo(k){this._backFaceCulling!==k&&(this._backFaceCulling=k,this.DO(E.TextureDirtyFlag))}get Jo(){return this._backFaceCulling}set cullBackFaces(k){this._cullBackFaces!==k&&(this._cullBackFaces=k,this.DO(E.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(k){this._blockDirtyMechanism!==k&&(this._blockDirtyMechanism=k,k||this.pG())}atomicMaterialsUpdate(k){this.blockDirtyMechanism=!0;try{k(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(k){this._onDisposeObserver&&this.gi.remove(this._onDisposeObserver),this._onDisposeObserver=this.gi.add(k)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.c),this._onBindObservable}set onBind(k){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(k)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new B.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new B.c),this._onEffectCreatedObservable}set alphaMode(k){this._alphaMode!==k&&(this._alphaMode=k,this.DO(E.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(k){this._needDepthPrePass!==k&&(this._needDepthPrePass=k,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(k){this._fogEnabled!==k&&(this._fogEnabled=k,this.DO(E.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case E.WireFrameFillMode:case E.LineListDrawMode:case E.LineLoopDrawMode:case E.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(k){this.fillMode=k?E.WireFrameFillMode:E.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case E.PointFillMode:case E.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(k){this.fillMode=k?E.PointFillMode:E.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(k){this._fillMode!==k&&(this._fillMode=k,this.DO(E.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(k){const Q=this.sk().getEngine().getCaps().fragmentDepthSupported;k&&!Q&&J.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=k&&Q,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(k){this._drawWrapper=k}constructor(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.gi=new B.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new F,this._useUBO=!1,this._fillMode=E.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=k;const U=Q||o.b.LastCreatedScene;U&&(this._scene=U,this._dirtyCallbacks={},this._forceGLSL=Z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=k||C.Tools.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new H.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new O.c(this._scene.getEngine(),void 0,void 0,k),this._useUBO=this.sk().getEngine().supportsUniformBuffers,this._createUniformBuffer(),i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),E.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var k;const Q=this.sk().getEngine();null===(k=this._uniformBuffer)||void 0===k||k.dispose(),Q.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new O.c(Q,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new O.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(k){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.pG(),this.checkReadyOnlyOnce=!0}unfreeze(){this.pG(),this.checkReadyOnlyOnce=!1}isReady(k,Q){return!0}isReadyForSubMesh(k,Q,i){const Z=Q.materialDefines;return!!Z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}sk(){return this._scene}_getEffectiveOrientation(k){return null!==this.sideOrientation?this.sideOrientation:k.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(k){this._transparencyMode!==k&&(this._transparencyMode=k,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===E.MATERIAL_ALPHABLEND||this._transparencyMode===E.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===E.MATERIAL_ALPHATEST||this._transparencyMode===E.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===E.MATERIAL_OPAQUE||this._transparencyMode===E.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(k){return this._hasTransparencyMode?this._transparencyModeIsBlend:k.visibility<1||!this._disableAlphaBlending&&(k.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(k){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(k)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}pG(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q=this.sk().meshes;for(const i of Q)if(i.io)for(const Q of i.io)if(Q.Dk()===this)for(const i of Q._drawWrappers)i&&this._materialContext===i.materialContext&&(i._wasPreviouslyReady=!1,i._wasPreviouslyUsingInstances=null,i._forceRebindOnNextCall=k);k&&this.DO(E.AllDirtyFlag)}_preBind(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.getEngine(),Z=(null==Q?this.sideOrientation:Q)===E.ClockWiseSideOrientation;return i.enableEffect(k||this._getDrawWrapper()),i.setState(this.Jo,this.zOffset,!1,Z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),Z}bind(k,Q){}buildUniformLayout(){const k=this._uniformBuffer;this._eventInfo.ubo=k,this._callbackPluginEventGeneric(8,this._eventInfo),k.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(k,Q,i){const Z=i._drawWrapper;this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),Z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(k){}bindView(k){this._useUBO?this._needToBindSceneUbo=!0:k.setMatrix("view",this.sk().getViewMatrix())}bindViewProjection(k){this._useUBO?this._needToBindSceneUbo=!0:(k.setMatrix("viewProjection",this.sk().getTransformMatrix()),k.setMatrix("projection",this.sk().getProjectionMatrix()))}bindEyePosition(k,Q){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(k,Q)}_afterBind(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&Q&&(this._needToBindSceneUbo=!1,(0,z.l)(Q,this.sk().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=k?k.visibility:1,this._onBindObservable&&k&&this._onBindObservable.notifyObservers(k),this.disableDepthWrite){const k=this._scene.getEngine();this._cachedDepthWriteState=k.getDepthWrite(),k.setDepthWrite(!1)}if(this.disableColorWrite){const k=this._scene.getEngine();this._cachedColorWriteState=k.getColorWrite(),k.setColorWrite(!1)}if(0!==this.depthFunction){const k=this._scene.getEngine();this._cachedDepthFunctionState=k.getDepthFunction()||0,k.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(k){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=k,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(k){return null}_clonePlugins(k,Q){const i={};if(this._serializePlugins(i),E._ParsePlugins(i,k,this._scene,Q),this.pluginManager)for(const Z of this.pluginManager._plugins){const Q=k.pluginManager.getPlugin(Z.name);Q&&Z.copyTo(Q)}}getBindedMeshes(){if(this.meshMap){const k=[];for(const Q in this.meshMap){const i=this.meshMap[Q];i&&k.push(i)}return k}return this._scene.meshes.filter((k=>k.material===this))}forceCompilation(k,Q,i,Z){const U={clipPlane:!1,useInstances:!1,...i},C=this.sk(),B=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const o=()=>{if(!this._scene||!this._scene.getEngine())return;const i=C.clipPlane;if(U.clipPlane&&(C.clipPlane=new G.b(0,0,0,1)),this._storeEffectOnSubMeshes){let i=!0,C=null;if(k.io){const Q=new m.b(0,0,0,0,0,k,void 0,!1,!1);Q.materialDefines&&(Q.materialDefines._renderId=-1),this.isReadyForSubMesh(k,Q,U.useInstances)||(Q.effect&&Q.effect.getCompilationError()&&Q.effect.allFallbacksProcessed()?C=Q.effect.getCompilationError():(i=!1,setTimeout(o,16)))}i&&(this.allowShaderHotSwapping=B,C&&Z&&Z(C),Q&&Q(this))}else this.isReady()?(this.allowShaderHotSwapping=B,Q&&Q(this)):setTimeout(o,16);U.clipPlane&&(C.clipPlane=i)};o()}async forceCompilationAsync(k,Q){return await new Promise(((i,Z)=>{this.forceCompilation(k,(()=>{i()}),Q,(k=>{Z(k)}))}))}DO(k){this.sk().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(E._DirtyCallbackArray.length=0,k&E.ImageProcessingDirtyFlag&&E._DirtyCallbackArray.push(E._ImageProcessingDirtyCallBack),k&E.TextureDirtyFlag&&E._DirtyCallbackArray.push(E._TextureDirtyCallBack),k&E.LightDirtyFlag&&E._DirtyCallbackArray.push(E._LightsDirtyCallBack),k&E.FresnelDirtyFlag&&E._DirtyCallbackArray.push(E._FresnelDirtyCallBack),k&E.AttributesDirtyFlag&&E._DirtyCallbackArray.push(E._AttributeDirtyCallBack),k&E.MiscDirtyFlag&&E._DirtyCallbackArray.push(E._MiscDirtyCallBack),k&E.PrePassDirtyFlag&&E._DirtyCallbackArray.push(E._PrePassDirtyCallBack),E._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(E._RunDirtyCallBacks),this.sk().resetCachedMaterial())}resetDrawCache(){const k=this.sk().meshes;for(const Q of k)if(Q.io)for(const k of Q.io)k.Dk()===this&&k.resetDrawCache()}_markAllSubMeshesAsDirty(k){const Q=this.sk();if(Q.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const i=Q.meshes;for(const Z of i)if(Z.io)for(const i of Z.io){if((i.Dk()||(Q._hasDefaultMaterial?Q.defaultMaterial:null))===this)for(const Q of i._drawWrappers)Q&&Q.defines&&Q.defines.markAllAsDirty&&this._materialContext===Q.materialContext&&k(Q.defines)}}_markScenePrePassDirty(){if(this.sk().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const k=this.sk().enablePrePassRenderer();k&&k.DO()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(E._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(E._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(E._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(E._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(E._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(E._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(E._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(E._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(E._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(E._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const k=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.gi.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(k)}))}}setPrePassRenderer(k){return!1}dispose(k,Q,i){const Z=this.sk();if(Z.stopAnimation(this),Z.freeProcessedMaterials(),Z.removeMaterial(this),this._eventInfo.forceDisposeTextures=Q,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const k=this._parentContainer.materials.indexOf(this);k>-1&&this._parentContainer.materials.splice(k,1),this._parentContainer=null}if(!0!==i)if(this.meshMap)for(const U in this.meshMap){const k=this.meshMap[U];this._disposeMeshResources(k)}else{const k=Z.meshes;for(const Q of k)this._disposeMeshResources(Q)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.gi.notifyObservers(this),this.gi.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(k){if(!k)return;const Q=k.mo,i=k._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(k.io&&i)for(const U of k.io){const k=U._drawWrappers;for(let C=0;C<k.length;C++){var Z;const B=null===(Z=k[C])||void 0===Z?void 0:Z.effect;if(!B)continue;i[C]===this&&(null===Q||void 0===Q||Q._releaseVertexArrayObject(B),U._removeDrawWrapper(C,!0,!0))}}}else null===Q||void 0===Q||Q._releaseVertexArrayObject(this._drawWrapper.effect);k.material!==this||k.sourceMesh||(k.material=null)}serialize(){const k=e.d.Serialize(this);return k.stencil=this.stencil.serialize(),k.uniqueId=this.uniqueId,this._serializePlugins(k),k}_serializePlugins(k){if(k.plugins={},this.pluginManager)for(const Q of this.pluginManager._plugins)Q.doNotSerialize||(k.plugins[Q.getClassName()]=Q.serialize())}static Parse(k,Q,i){if(k.customType){if("BABYLON.PBRMaterial"===k.customType&&k.overloadedAlbedo&&(k.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return J.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else k.customType="BABYLON.StandardMaterial";const Z=C.Tools.Instantiate(k.customType).Parse(k,Q,i);return Z._loadedUniqueId=k.uniqueId,Z}static _ParsePlugins(k,Q,i,Z){if(k.plugins)for(const o in k.plugins){var U,B;const m=k.plugins[o];let O=null===(U=Q.pluginManager)||void 0===U?void 0:U.getPlugin(m.name);if(!O){const k=C.Tools.Instantiate("BABYLON."+o);k&&(O=new k(Q))}null===(B=O)||void 0===B||B.parse(m,i,Z)}}}E.TriangleFillMode=0,E.WireFrameFillMode=1,E.PointFillMode=2,E.PointListDrawMode=3,E.LineListDrawMode=4,E.LineLoopDrawMode=5,E.LineStripDrawMode=6,E.TriangleStripDrawMode=7,E.TriangleFanDrawMode=8,E.ClockWiseSideOrientation=0,E.CounterClockWiseSideOrientation=1,E.ImageProcessingDirtyFlag=64,E.TextureDirtyFlag=1,E.LightDirtyFlag=2,E.FresnelDirtyFlag=4,E.AttributesDirtyFlag=8,E.MiscDirtyFlag=16,E.PrePassDirtyFlag=32,E.AllDirtyFlag=127,E.MATERIAL_OPAQUE=0,E.MATERIAL_ALPHATEST=1,E.MATERIAL_ALPHABLEND=2,E.MATERIAL_ALPHATESTANDBLEND=3,E.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,E.MATERIAL_NORMALBLENDMETHOD_RNM=1,E.OnEventObservable=new B.c,E._AllDirtyCallBack=k=>k.markAllAsDirty(),E._ImageProcessingDirtyCallBack=k=>k.markAsImageProcessingDirty(),E._TextureDirtyCallBack=k=>k.markAsTexturesDirty(),E._FresnelDirtyCallBack=k=>k.markAsFresnelDirty(),E._MiscDirtyCallBack=k=>k.markAsMiscDirty(),E._PrePassDirtyCallBack=k=>k.markAsPrePassDirty(),E._LightsDirtyCallBack=k=>k.markAsLightDirty(),E._AttributeDirtyCallBack=k=>k.markAsAttributesDirty(),E._FresnelAndMiscDirtyCallBack=k=>{E._FresnelDirtyCallBack(k),E._MiscDirtyCallBack(k)},E._TextureAndMiscDirtyCallBack=k=>{E._TextureDirtyCallBack(k),E._MiscDirtyCallBack(k)},E._DirtyCallbackArray=[],E._RunDirtyCallBacks=k=>{for(const Q of E._DirtyCallbackArray)Q(k)},(0,Z.c)([(0,U.L)()],E.prototype,"id",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"uniqueId",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"name",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"metadata",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"checkReadyOnEveryCall",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"checkReadyOnlyOnce",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"state",void 0),(0,Z.c)([(0,U.L)("alpha")],E.prototype,"_alpha",void 0),(0,Z.c)([(0,U.L)("Jo")],E.prototype,"_backFaceCulling",void 0),(0,Z.c)([(0,U.L)("cullBackFaces")],E.prototype,"_cullBackFaces",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"sideOrientation",void 0),(0,Z.c)([(0,U.L)("alphaMode")],E.prototype,"_alphaMode",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"_needDepthPrePass",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"disableDepthWrite",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"disableColorWrite",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"forceDepthWrite",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"depthFunction",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"separateCullingPass",void 0),(0,Z.c)([(0,U.L)("fogEnabled")],E.prototype,"_fogEnabled",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"pointSize",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"zOffset",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"zOffsetUnits",void 0),(0,Z.c)([(0,U.L)()],E.prototype,"pointsCloud",null),(0,Z.c)([(0,U.L)()],E.prototype,"fillMode",null),(0,Z.c)([(0,U.L)()],E.prototype,"useLogarithmicDepth",null),(0,Z.c)([(0,U.L)()],E.prototype,"transparencyMode",null)},11652:(k,Q,i)=>{i.d(Q,{$:()=>b,D:()=>e,E:()=>H,H:()=>v,K:()=>K,L:()=>j,O:()=>l,S:()=>a,T:()=>N,X:()=>X,Y:()=>p,c:()=>f,cb:()=>F,e:()=>G,h:()=>y,j:()=>J,k:()=>z,l:()=>E,m:()=>h,o:()=>u,s:()=>c,w:()=>L,z:()=>s});var Z=i(11134),U=i(11348),C=i(11157),B=i(11600),o=i(11657);const m=U.cQ.Black(),O={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function J(k,Q,i){if(!k||k.LOGARITHMICDEPTH||k.indexOf&&k.indexOf("LOGARITHMICDEPTH")>=0){const k=i.activeCamera;1===k.mode&&Z.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),Q.setFloat("logarithmicDepthConstant",2/(Math.log(k.maxZ+1)/Math.LN2))}}function G(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i&&k.fogEnabled&&(!Q||Q.applyFog)&&0!==k.fogMode&&(i.setFloat4("vFogInfos",k.fogMode,k.fogStart,k.fogEnd,k.fogDensity),Z?(k.fogColor.toLinearSpaceToRef(m,k.getEngine().useExactSrgbConversions),i.setColor3("vFogColor",m)):i.setColor3("vFogColor",k.fogColor))}function H(k,Q,i,Z,U,C,B,o,m,J){const G=k.numMaxInfluencers||k.numInfluencers;return G<=0?0:(Q.push("#define MORPHTARGETS"),k.hasPositions&&Q.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),k.hasNormals&&Q.push("#define MORPHTARGETTEXTURE_HASNORMALS"),k.hasTangents&&Q.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),k.hasUVs&&Q.push("#define MORPHTARGETTEXTURE_HASUVS"),k.hasUV2s&&Q.push("#define MORPHTARGETTEXTURE_HASUV2S"),k.hasColors&&Q.push("#define MORPHTARGETTEXTURE_HASCOLORS"),k.supportsPositions&&U&&Q.push("#define MORPHTARGETS_POSITION"),k.supportsNormals&&C&&Q.push("#define MORPHTARGETS_NORMAL"),k.supportsTangents&&B&&Q.push("#define MORPHTARGETS_TANGENT"),k.supportsUVs&&o&&Q.push("#define MORPHTARGETS_UV"),k.supportsUV2s&&m&&Q.push("#define MORPHTARGETS_UV2"),k.supportsColors&&J&&Q.push("#define MORPHTARGETS_COLOR"),Q.push("#define NUM_MORPH_INFLUENCERS "+G),k.isUsingTextureForTargets&&Q.push("#define MORPHTARGETS_TEXTURE"),O.NUM_MORPH_INFLUENCERS=G,O.NORMAL=C,O.TANGENT=B,O.UV=o,O.UV2=m,O.COLOR=J,e(i,Z,O,U),G)}function e(k,Q,i){let U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=i.NUM_MORPH_INFLUENCERS;if(B>0&&C.b.LastCreatedEngine){const o=C.b.LastCreatedEngine.getCaps().maxVertexAttribs,m=Q.morphTargetManager;if(null!==m&&void 0!==m&&m.isUsingTextureForTargets)return;const O=m&&m.supportsPositions&&U,J=m&&m.supportsNormals&&i.NORMAL,G=m&&m.supportsTangents&&i.TANGENT,H=m&&m.supportsUVs&&i.UV1,e=m&&m.supportsUV2s&&i.UV2,F=m&&m.supportsColors&&i.VERTEXCOLOR;for(let i=0;i<B;i++)O&&k.push("position"+i),J&&k.push("normal"+i),G&&k.push("tangent"+i),H&&k.push("uv_"+i),e&&k.push("uv2_"+i),F&&k.push("color"+i),k.length>o&&Z.c.Error("Cannot add more vertex attributes for mesh "+Q.name)}}function F(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.push("world0"),k.push("world1"),k.push("world2"),k.push("world3"),Q&&(k.push("previousWorld0"),k.push("previousWorld1"),k.push("previousWorld2"),k.push("previousWorld3"))}function z(k,Q){const i=k.morphTargetManager;k&&i&&Q.setFloatArray("morphTargetInfluences",i.influences)}function E(k,Q){Q.bindToEffect(k,"Scene")}function l(k,Q,i){Q._needUVs=!0,Q[i]=!0,k.optimizeUVAllocation&&k.getTextureMatrix().isIdentityAs3x2()?(Q[i+"DIRECTUV"]=k.coordinatesIndex+1,Q["MAINUV"+(k.coordinatesIndex+1)]=!0):Q[i+"DIRECTUV"]=0}function h(k,Q,i){const Z=k.getTextureMatrix();Q.Bo(i+"Matrix",Z)}function c(k,Q,i){i.BAKED_VERTEX_ANIMATION_TEXTURE&&i.INSTANCES&&k.push("bakedVertexAnimationSettingsInstanced")}function f(k,Q,i){var Z;if(Q&&k&&(k.computeBonesUsingShaders&&Q._bonesComputationForcedToCPU&&(k.computeBonesUsingShaders=!1),k.useBones&&k.computeBonesUsingShaders&&k.skeleton)){const U=k.skeleton;if(U.isUsingTextureForMatrices&&Q.getUniformIndex("boneTextureWidth")>-1){const i=U.getTransformMatrixTexture(k);Q.setTexture("boneSampler",i),Q.setFloat("boneTextureWidth",4*(U.bones.length+1))}else{const C=U.getTransformMatrices(k);C&&(Q.setMatrices("mBones",C),i&&k.sk().prePassRenderer&&k.sk().prePassRenderer.getIndex(2)&&(i.previousBones[k.uniqueId]||(i.previousBones[k.uniqueId]=C.slice()),Q.setMatrices("mPreviousBones",i.previousBones[k.uniqueId]),Z=C,i.previousBones[k.uniqueId].set(Z)))}}}function Y(k,Q,i,Z,U){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];k._bindLight(Q,i,Z,U,C)}function y(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const C=Math.min(Q.lightSources.length,U);for(let B=0;B<C;B++){Y(Q.lightSources[B],B,k,i,"boolean"===typeof Z?Z:Z.SPECULARTERM,Q.receiveShadows)}}function L(k,Q,i,Z){i.NUM_BONE_INFLUENCERS>0&&(Z.addCPUSkinningFallback(0,Q),k.push("matricesIndices"),k.push("matricesWeights"),i.NUM_BONE_INFLUENCERS>4&&(k.push("matricesIndicesExtra"),k.push("matricesWeightsExtra")))}function s(k,Q){(Q.INSTANCES||Q.THIN_INSTANCES)&&F(k,!!Q.PREPASS_VELOCITY),Q.INSTANCESCOLOR&&k.push("instanceColor")}function u(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=0;for(let C=0;C<i&&k["LIGHT"+C];C++)C>0&&(U=Z+C,Q.addFallback(U,"LIGHT"+C)),k.SHADOWS||(k["SHADOW"+C]&&Q.addFallback(Z,"SHADOW"+C),k["SHADOWPCF"+C]&&Q.addFallback(Z,"SHADOWPCF"+C),k["SHADOWPCSS"+C]&&Q.addFallback(Z,"SHADOWPCSS"+C),k["SHADOWPOISSON"+C]&&Q.addFallback(Z,"SHADOWPOISSON"+C),k["SHADOWESM"+C]&&Q.addFallback(Z,"SHADOWESM"+C),k["SHADOWCLOSEESM"+C]&&Q.addFallback(Z,"SHADOWCLOSEESM"+C));return U++}function a(k,Q,i,Z,U,C,B){let o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];B._areMiscDirty&&(B.LOGARITHMICDEPTH=i,B.POINTSIZE=Z,B.FOG=U&&function(k,Q){return Q.fogEnabled&&k.applyFog&&0!==Q.fogMode}(k,Q),B.NONUNIFORMSCALING=k.nonUniformScaling,B.ALPHATEST=C,B.DECAL_AFTER_DETAIL=o)}function j(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i._areLightsDirty)return i._needNormals;let B=0;const o={needNormals:i._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(k.lightsEnabled&&!C)for(const O of Q.lightSources)if(T(k,Q,O,B,i,Z,o),B++,B===U)break;i.SPECULARTERM=o.specularEnabled,i.SHADOWS=o.shadowEnabled;for(let O=B;O<U;O++)void 0!==i["LIGHT"+O]&&(i["LIGHT"+O]=!1,i["HEMILIGHT"+O]=!1,i["POINTLIGHT"+O]=!1,i["DIRLIGHT"+O]=!1,i["SPOTLIGHT"+O]=!1,i["AREALIGHT"+O]=!1,i["SHADOW"+O]=!1,i["SHADOWCSM"+O]=!1,i["SHADOWCSMDEBUG"+O]=!1,i["SHADOWCSMNUM_CASCADES"+O]=!1,i["SHADOWCSMUSESHADOWMAXZ"+O]=!1,i["SHADOWCSMNOBLEND"+O]=!1,i["SHADOWCSM_RIGHTHANDED"+O]=!1,i["SHADOWPCF"+O]=!1,i["SHADOWPCSS"+O]=!1,i["SHADOWPOISSON"+O]=!1,i["SHADOWESM"+O]=!1,i["SHADOWCLOSEESM"+O]=!1,i["SHADOWCUBE"+O]=!1,i["SHADOWLOWQUALITY"+O]=!1,i["SHADOWMEDIUMQUALITY"+O]=!1);const m=k.getEngine().getCaps();return void 0===i.SHADOWFLOAT&&(o.needRebuild=!0),i.SHADOWFLOAT=o.shadowEnabled&&(m.textureFloatRender&&m.textureFloatLinearFiltering||m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=o.lightmapMode,o.needRebuild&&i.rebuild(),o.needNormals}function T(k,Q,i,Z,U,C,o){switch(o.needNormals=!0,void 0===U["LIGHT"+Z]&&(o.needRebuild=!0),U["LIGHT"+Z]=!0,U["SPOTLIGHT"+Z]=!1,U["HEMILIGHT"+Z]=!1,U["POINTLIGHT"+Z]=!1,U["DIRLIGHT"+Z]=!1,U["AREALIGHT"+Z]=!1,i.prepareLightSpecificDefines(U,Z),U["LIGHT_FALLOFF_PHYSICAL"+Z]=!1,U["LIGHT_FALLOFF_GLTF"+Z]=!1,U["LIGHT_FALLOFF_STANDARD"+Z]=!1,i.falloffType){case B.e.FALLOFF_GLTF:U["LIGHT_FALLOFF_GLTF"+Z]=!0;break;case B.e.FALLOFF_PHYSICAL:U["LIGHT_FALLOFF_PHYSICAL"+Z]=!0;break;case B.e.FALLOFF_STANDARD:U["LIGHT_FALLOFF_STANDARD"+Z]=!0}if(C&&!i.BJ.equalsFloats(0,0,0)&&(o.specularEnabled=!0),U["SHADOW"+Z]=!1,U["SHADOWCSM"+Z]=!1,U["SHADOWCSMDEBUG"+Z]=!1,U["SHADOWCSMNUM_CASCADES"+Z]=!1,U["SHADOWCSMUSESHADOWMAXZ"+Z]=!1,U["SHADOWCSMNOBLEND"+Z]=!1,U["SHADOWCSM_RIGHTHANDED"+Z]=!1,U["SHADOWPCF"+Z]=!1,U["SHADOWPCSS"+Z]=!1,U["SHADOWPOISSON"+Z]=!1,U["SHADOWESM"+Z]=!1,U["SHADOWCLOSEESM"+Z]=!1,U["SHADOWCUBE"+Z]=!1,U["SHADOWLOWQUALITY"+Z]=!1,U["SHADOWMEDIUMQUALITY"+Z]=!1,Q&&Q.receiveShadows&&k.shadowsEnabled&&i.shadowEnabled){const Q=i.getShadowGenerator(k.activeCamera)??i.getShadowGenerator();if(Q){const k=Q.getShadowMap();k&&k.renderList&&k.renderList.length>0&&(o.shadowEnabled=!0,Q.prepareDefines(U,Z))}}i.lightmapMode!=B.e.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,U["LIGHTMAPEXCLUDED"+Z]=!0,U["LIGHTMAPNOSPECULAR"+Z]=i.lightmapMode==B.e.LIGHTMAP_SHADOWSONLY):(U["LIGHTMAPEXCLUDED"+Z]=!1,U["LIGHTMAPNOSPECULAR"+Z]=!1)}function K(k,Q,i,Z,U){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=function(k,Q){let i=!1;if(k.activeCamera){const Z=Q.CAMERA_ORTHOGRAPHIC?1:0,U=Q.CAMERA_PERSPECTIVE?1:0,C=1===k.activeCamera.mode?1:0,B=0===k.activeCamera.mode?1:0;(Z^C||U^B)&&(Q.CAMERA_ORTHOGRAPHIC=1===C,Q.CAMERA_PERSPECTIVE=1===B,i=!0)}return i}(k,Z);!1!==C&&(m=(0,o.h)(i,k,Z)),Z.DEPTHPREPASS!==!Q.getColorWrite()&&(Z.DEPTHPREPASS=!Z.DEPTHPREPASS,m=!0),Z.INSTANCES!==U&&(Z.INSTANCES=U,m=!0),Z.THIN_INSTANCES!==B&&(Z.THIN_INSTANCES=B,m=!0),m&&Z.markAsUnprocessed()}function v(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!Q._areAttributesDirty&&Q._needNormals===Q._normals&&Q._needUVs===Q._uvs)return!1;Q._normals=Q._needNormals,Q._uvs=Q._needUVs,Q.NORMAL=Q._needNormals&&k.isVerticesDataPresent("normal"),Q._needNormals&&k.isVerticesDataPresent("tangent")&&(Q.TANGENT=!0);for(let o=1;o<=6;++o)Q["UV"+o]=!!Q._needUVs&&k.isVerticesDataPresent(`uv${1===o?"":o}`);if(i){const i=k.useVertexColors&&k.isVerticesDataPresent("color");Q.VERTEXCOLOR=i,Q.VERTEXALPHA=k.hasVertexAlpha&&i&&C}return k.isVerticesDataPresent("instanceColor")&&(k.hasInstances||k.hasThinInstances)&&(Q.INSTANCESCOLOR=!0),Z&&function(k,Q){if(k.useBones&&k.computeBonesUsingShaders&&k.skeleton){Q.NUM_BONE_INFLUENCERS=k.numBoneInfluencers;const i=void 0!==Q.BONETEXTURE;if(k.skeleton.isUsingTextureForMatrices&&i)Q.BONETEXTURE=!0;else{Q.BonesPerMesh=k.skeleton.bones.length+1,Q.BONETEXTURE=!i&&void 0;const Z=k.sk().prePassRenderer;if(Z&&Z.enabled){const i=-1===Z.excludedSkinnedMesh.indexOf(k);Q.BONES_VELOCITY_ENABLED=i}}}else Q.NUM_BONE_INFLUENCERS=0,Q.BonesPerMesh=0,void 0!==Q.BONETEXTURE&&(Q.BONETEXTURE=!1)}(k,Q),U&&function(k,Q){const i=k.morphTargetManager;i?(Q.MORPHTARGETS_UV=i.supportsUVs&&Q.UV1,Q.MORPHTARGETS_UV2=i.supportsUV2s&&Q.UV2,Q.MORPHTARGETS_TANGENT=i.supportsTangents&&Q.TANGENT,Q.MORPHTARGETS_NORMAL=i.supportsNormals&&Q.NORMAL,Q.MORPHTARGETS_POSITION=i.supportsPositions,Q.MORPHTARGETS_COLOR=i.supportsColors,Q.MORPHTARGETTEXTURE_HASUVS=i.hasUVs,Q.MORPHTARGETTEXTURE_HASUV2S=i.hasUV2s,Q.MORPHTARGETTEXTURE_HASTANGENTS=i.hasTangents,Q.MORPHTARGETTEXTURE_HASNORMALS=i.hasNormals,Q.MORPHTARGETTEXTURE_HASPOSITIONS=i.hasPositions,Q.MORPHTARGETTEXTURE_HASCOLORS=i.hasColors,Q.NUM_MORPH_INFLUENCERS=i.numMaxInfluencers||i.numInfluencers,Q.MORPHTARGETS=Q.NUM_MORPH_INFLUENCERS>0,Q.MORPHTARGETS_TEXTURE=i.isUsingTextureForTargets):(Q.MORPHTARGETS_UV=!1,Q.MORPHTARGETS_UV2=!1,Q.MORPHTARGETS_TANGENT=!1,Q.MORPHTARGETS_NORMAL=!1,Q.MORPHTARGETS_POSITION=!1,Q.MORPHTARGETS_COLOR=!1,Q.MORPHTARGETTEXTURE_HASUVS=!1,Q.MORPHTARGETTEXTURE_HASUV2S=!1,Q.MORPHTARGETTEXTURE_HASTANGENTS=!1,Q.MORPHTARGETTEXTURE_HASNORMALS=!1,Q.MORPHTARGETTEXTURE_HASPOSITIONS=!1,Q.MORPHTARGETTEXTURE_HAS_COLORS=!1,Q.MORPHTARGETS=!1,Q.NUM_MORPH_INFLUENCERS=0)}(k,Q),B&&function(k,Q){const i=k.bakedVertexAnimationManager;Q.BAKED_VERTEX_ANIMATION_TEXTURE=!(!i||!i.isEnabled)}(k,Q),!0}function N(k,Q){if(k.activeCamera){const i=Q.MULTIVIEW;Q.MULTIVIEW=null!==k.activeCamera.outputRenderTarget&&k.activeCamera.outputRenderTarget.getViewCount()>1,Q.MULTIVIEW!=i&&Q.markAsUnprocessed()}}function X(k,Q,i){const Z=Q.ORDER_INDEPENDENT_TRANSPARENCY,U=Q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;Q.ORDER_INDEPENDENT_TRANSPARENCY=k.useOrderIndependentTransparency&&i,Q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!k.getEngine().getCaps().textureFloatLinearFiltering,Z===Q.ORDER_INDEPENDENT_TRANSPARENCY&&U===Q.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||Q.markAsUnprocessed()}function p(k,Q,i){const Z=Q.PREPASS;if(!Q._arePrePassDirty)return;const U=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(k.prePassRenderer&&k.prePassRenderer.enabled&&i){Q.PREPASS=!0,Q.SCENE_MRT_COUNT=k.prePassRenderer.mrtCount,Q.PREPASS_NORMAL_WORLDSPACE=k.prePassRenderer.generateNormalsInWorldSpace,Q.PREPASS_COLOR=!0,Q.PREPASS_COLOR_INDEX=0;for(let i=0;i<U.length;i++){const Z=k.prePassRenderer.getIndex(U[i].type);-1!==Z?(Q[U[i].define]=!0,Q[U[i].index]=Z):Q[U[i].define]=!1}}else{Q.PREPASS=!1;for(let k=0;k<U.length;k++)Q[U[k].define]=!1}Q.PREPASS!=Z&&(Q.markAsUnprocessed(),Q.markAsImageProcessingDirty())}function d(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];U&&U.push("Light"+k),C||(Q.push("vLightData"+k,"vLightDiffuse"+k,"vLightSpecular"+k,"vLightDirection"+k,"vLightWidth"+k,"vLightHeight"+k,"vLightFalloff"+k,"vLightGround"+k,"lightMatrix"+k,"shadowsInfo"+k,"depthValues"+k),i.push("shadowTexture"+k),i.push("depthTexture"+k),Q.push("viewFrustumZ"+k,"cascadeBlendFactor"+k,"lightSizeUVCorrection"+k,"depthCorrection"+k,"penumbraDarkness"+k,"frustumLengths"+k),Z&&(i.push("projectionLightTexture"+k),Q.push("textureProjectionMatrix"+k)),B&&i.push("iesLightTexture"+k))}function b(k,Q,i){let Z,U,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(k.uniformsNames){const B=k;Z=B.uniformsNames,U=B.uniformBuffersNames,Q=B.samplers,i=B.defines,C=B.maxSimultaneousLights||0}else Z=k,Q||(Q=[]);for(let B=0;B<C&&i["LIGHT"+B];B++)d(B,Z,Q,i["PROJECTEDLIGHTTEXTURE"+B],U,!1,i["IESLIGHTTEXTURE"+B]);i.NUM_MORPH_INFLUENCERS&&(Z.push("morphTargetInfluences"),Z.push("morphTargetCount")),i.BAKED_VERTEX_ANIMATION_TEXTURE&&(Z.push("bakedVertexAnimationSettings"),Z.push("bakedVertexAnimationTextureSizeInverted"),Z.push("bakedVertexAnimationTime"),Q.push("bakedVertexAnimationTexture"))}},11607:(k,Q,i)=>{i.d(Q,{c:()=>C});var Z=i(11298),U=i(11615);class C extends U.c{constructor(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(k,Q,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new Z.Matrix,this._storeEffectOnSubMeshes=i}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(k,Q){return!!k&&(!this._storeEffectOnSubMeshes||(!k.io||0===k.io.length||this.isReadyForSubMesh(k,k.io[0],Q)))}_isReadyForSubMesh(k){const Q=k.materialDefines;return!(this.checkReadyOnEveryCall||!k.effect||!Q||Q._renderId!==this.sk().getRenderId())}bindOnlyWorldMatrix(k){this._activeEffect.setMatrix("world",k)}bindOnlyNormalMatrix(k){this._activeEffect.setMatrix("normalMatrix",k)}bind(k,Q){Q&&this.bindForSubMesh(k,Q,Q.io[0])}_afterBind(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;super._afterBind(k,Q,i),this.sk()._cachedEffect=Q,i?i._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i._drawWrapper._forceRebindOnNextCall||k.isCachedMaterialInvalid(this,Q,Z)}dispose(k,Q,i){this._activeEffect=void 0,super.dispose(k,Q,i)}}},11647:(k,Q,i)=>{i.d(Q,{d:()=>o,g:()=>m});var Z=i(11280),U=i(11298),C=i(11289);class B{static extractMinAndMaxIndexed(k,Q,i,Z,U,C){for(let B=i;B<i+Z;B++){const i=3*Q[B],Z=k[i],o=k[i+1],m=k[i+2];U.minimizeInPlaceFromFloats(Z,o,m),C.maximizeInPlaceFromFloats(Z,o,m)}}static extractMinAndMax(k,Q,i,Z,U,C){for(let B=Q,o=Q*Z;B<Q+i;B++,o+=Z){const Q=k[o],i=k[o+1],Z=k[o+2];U.minimizeInPlaceFromFloats(Q,i,Z),C.maximizeInPlaceFromFloats(Q,i,Z)}}}function o(k,Q,i,Z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const o=new U.zQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new U.zQ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B.extractMinAndMaxIndexed(k,Q,i,Z,o,m),C&&(o.x-=o.x*C.x+C.y,o.y-=o.y*C.x+C.y,o.z-=o.z*C.x+C.y,m.x+=m.x*C.x+C.y,m.y+=m.y*C.x+C.y,m.z+=m.z*C.x+C.y),{minimum:o,maximum:m}}function m(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0;const o=new U.zQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new U.zQ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return C||(C=3),B.extractMinAndMax(k,Q,i,C,o,m),Z&&(o.x-=o.x*Z.x+Z.y,o.y-=o.y*Z.x+Z.y,o.z-=o.z*Z.x+Z.y,m.x+=m.x*Z.x+Z.y,m.y+=m.y*Z.x+Z.y,m.z+=m.z*Z.x+Z.y),{minimum:o,maximum:m}}(0,Z.c)([C.h.filter((function(){for(var k=arguments.length,Q=new Array(k),i=0;i<k;i++)Q[i]=arguments[i];let[Z,U]=Q;return!Array.isArray(Z)&&!Array.isArray(U)}))],B,"extractMinAndMaxIndexed",null),(0,Z.c)([C.h.filter((function(){for(var k=arguments.length,Q=new Array(k),i=0;i<k;i++)Q[i]=arguments[i];let[Z]=Q;return!Array.isArray(Z)}))],B,"extractMinAndMax",null)},11621:(k,Q,i)=>{i.d(Q,{b:()=>m});var Z=i(11378),U=i(11625),C=i(11631),B=i(11647),o=i(11414);class m{get materialDefines(){var k;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(k=this._getDrawWrapper())||void 0===k?void 0:k.defines}set materialDefines(k){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=k}_getDrawWrapper(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k=k??this._engine.currentRenderPassId;let i=this._drawWrappers[k];return!i&&Q&&(this._drawWrappers[k]=i=new o.b(this._mesh.sk().getEngine())),i}_removeDrawWrapper(k){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(i=this._drawWrappers[k])||void 0===i||i.dispose(Q));this._drawWrappers[k]=void 0}get effect(){var k;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(k=this._getDrawWrapper())||void 0===k?void 0:k.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(k){this._mainDrawWrapperOverride=k}setEffect(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=this._drawWrapper;U.setEffect(k,Q,Z),void 0!==i&&(U.materialContext=i),k||(U.defines=null,U.materialContext=void 0)}resetDrawCache(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==k)return void this._removeDrawWrapper(k,!0,Q);for(const k of this._drawWrappers)null===k||void 0===k||k.dispose(Q)}this._drawWrappers=[]}static AddToMesh(k,Q,i,Z,U,C,B){return new m(k,Q,i,Z,U,C,B,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(k,Q,i,Z,U,C,B){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],m=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=k,this.verticesStart=Q,this.verticesCount=i,this.indexStart=Z,this.indexCount=U,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=C,this._renderingMesh=B||C,m&&C.io.push(this),this._engine=this._mesh.sk().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=C.io.length-1,o&&(this.refreshBoundingInfo(),C.oo(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(k){return this._boundingInfo=k,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const k=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return k||this._renderingMesh}Dk(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const Q=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!Q)return k&&this._mesh.sk()._hasDefaultMaterial?this._mesh.sk().defaultMaterial:null;if(this._isMultiMaterial(Q)){const k=Q.getSubMaterial(this.materialIndex);return this._currentMaterial!==k&&(this._currentMaterial=k,this.resetDrawCache()),k}return Q}_isMultiMaterial(k){return void 0!==k.getSubMaterial}refreshBoundingInfo(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.mo)return this;if(k||(k=this._renderingMesh.getVerticesData(Z.h.PositionKind)),!k)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const Q=this._renderingMesh.Oo();let i;if(0===this.indexStart&&this.indexCount===Q.length){const k=this._renderingMesh.getBoundingInfo();i={minimum:k.minimum.clone(),maximum:k.maximum.clone()}}else i=(0,B.d)(k,Q,this.indexStart,this.indexCount,this._renderingMesh.mo.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new C.c(i.minimum,i.maximum),this}_checkCollision(k){return this.getBoundingInfo()._checkCollision(k)}updateBoundingInfo(k){let Q=this.getBoundingInfo();return Q||(this.refreshBoundingInfo(),Q=this.getBoundingInfo()),Q&&Q.update(k),this}isInFrustum(k){const Q=this.getBoundingInfo();return!!Q&&Q.isInFrustum(k,this._mesh.oG)}isCompletelyInFrustum(k){const Q=this.getBoundingInfo();return!!Q&&Q.isCompletelyInFrustum(k)}render(k){return this._renderingMesh.render(this,k,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(k,Q){if(!this._linesIndexBuffer){const i=6*Math.floor(this.indexCount/3),Z=this.verticesStart+this.verticesCount>65535?new Uint32Array(i):new Uint16Array(i);let U=0;if(0===k.length)for(let k=this.indexStart;k<this.indexStart+this.indexCount;k+=3)Z[U++]=k,Z[U++]=k+1,Z[U++]=k+1,Z[U++]=k+2,Z[U++]=k+2,Z[U++]=k;else for(let Q=this.indexStart;Q<this.indexStart+this.indexCount;Q+=3)Z[U++]=k[Q],Z[U++]=k[Q+1],Z[U++]=k[Q+1],Z[U++]=k[Q+2],Z[U++]=k[Q+2],Z[U++]=k[Q];this._linesIndexBuffer=Q.createIndexBuffer(Z),this._linesIndexCount=Z.length}return this._linesIndexBuffer}canIntersects(k){const Q=this.getBoundingInfo();return!!Q&&k.intersectsBox(Q.boundingBox)}intersects(k,Q,i,Z,U){const C=this.Dk();if(!C)return null;let B=3,o=!1;switch(C.fillMode){case 3:case 5:case 6:case 8:return null;case 7:B=1,o=!0}return 4===C.fillMode?i.length?this._intersectLines(k,Q,i,this._mesh.intersectionThreshold,Z):this._intersectUnIndexedLines(k,Q,i,this._mesh.intersectionThreshold,Z):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(k,Q,i,Z,U):this._intersectTriangles(k,Q,i,B,o,Z,U)}_intersectLines(k,Q,i,Z,C){let B=null;for(let o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){const m=Q[i[o]],O=Q[i[o+1]],J=k.intersectionSegment(m,O,Z);if(!(J<0)&&((C||!B||J<B.distance)&&(B=new U.e(null,null,J),B.faceId=o/2,C)))break}return B}_intersectUnIndexedLines(k,Q,i,Z,C){let B=null;for(let o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){const i=Q[o],m=Q[o+1],O=k.intersectionSegment(i,m,Z);if(!(O<0)&&((C||!B||O<B.distance)&&(B=new U.e(null,null,O),B.faceId=o/2,C)))break}return B}_intersectTriangles(k,Q,i,Z,U,C,B){let o=null,m=-1;for(let O=this.indexStart;O<this.indexStart+this.indexCount-(3-Z);O+=Z){m++;const Z=i[O],J=i[O+1],G=i[O+2];if(U&&4294967295===G){O+=2;continue}const H=Q[Z],e=Q[J],F=Q[G];if(!H||!e||!F)continue;if(B&&!B(H,e,F,k,Z,J,G))continue;const z=k.intersectsTriangle(H,e,F);if(z){if(z.distance<0)continue;if((C||!o||z.distance<o.distance)&&(o=z,o.faceId=m,C))break}}return o}_intersectUnIndexedTriangles(k,Q,i,Z,U){let C=null;for(let B=this.verticesStart;B<this.verticesStart+this.verticesCount;B+=3){const i=Q[B],o=Q[B+1],m=Q[B+2];if(U&&!U(i,o,m,k,-1,-1,-1))continue;const O=k.intersectsTriangle(i,o,m);if(O){if(O.distance<0)continue;if((Z||!C||O.distance<C.distance)&&(C=O,C.faceId=B/3,Z))break}}return C}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(k,Q){const i=new m(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,k,Q,!1);if(!this.IsGlobal){const k=this.getBoundingInfo();if(!k)return i;i._boundingInfo=new C.c(k.minimum,k.maximum)}return i}dispose(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.sk().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const Q=this._mesh.io.indexOf(this);this._mesh.io.splice(Q,1),this.resetDrawCache(void 0,k)}getClassName(){return"SubMesh"}static CreateFromIndices(k,Q,i,Z,U){let C=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=Number.MAX_VALUE,o=-Number.MAX_VALUE;const O=(U||Z).Oo();for(let m=Q;m<Q+i;m++){const k=O[m];k<B&&(B=k),k>o&&(o=k)}return new m(k,B,o-B+1,Q,i,Z,U,C)}}}}]);