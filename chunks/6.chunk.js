"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10383:(d,m,g)=>{var V=g(1482),u=g(1053);u.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(u.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=V.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((d=>{this._texture._sphericalPolynomial=d,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(d){this._texture&&(this._texture._sphericalPolynomial=d)},enumerable:!0,configurable:!0})},10386:(d,m,g)=>{g.r(m),g.d(m,{Dispose:()=>Q,DumpData:()=>Y,DumpDataAsync:()=>X,DumpFramebuffer:()=>U,DumpTools:()=>B});var V=g(1503),u=g(1190),D=g(1045),j=g(1037);let z,s=null;async function U(d,m,g,V){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;const z=await g.readPixels(0,0,d,m);Y(d,m,new Uint8Array(z.buffer),V,u,D,!0,void 0,j)}function X(d,m,g){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return new Promise((s=>{Y(d,m,g,(d=>s(d)),V,u,D,j,z)}))}function Y(d,m,U,X){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8?arguments[8]:void 0;(async function(){return s||(s=new Promise(((d,m)=>{let u,D=null;const s={ee:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(g.bind(g,1401)).then((U=>{let{ThinEngine:X}=U;try{u=new OffscreenCanvas(100,100),D=new X(u,!1,s)}catch(B){u=document.createElement("canvas"),D=new X(u,!1,s)}j.b.Instances.pop(),j.b.OnEnginesDisposedObservable.add((d=>{D&&d!==D&&!D.u&&0===j.b.Instances.length&&Q()})),D.getCaps().parallelShaderCompile=void 0;const Y=new V.c(D);g.e(32).then(g.bind(g,11089)).then((g=>{let{passPixelShader:j}=g;if(!D)return void m("Engine is not defined");const s=new V.e({td:D,name:j.name,fragmentShader:j.shader,samplerNames:["textureSampler"]});z={canvas:u,td:D,renderer:Y,wrapper:s},d(z)}))})).catch(m)}))),await s})().then((g=>{if(g.td.setSize(d,m,!0),U instanceof Float32Array){const d=new Uint8Array(U.length);let m=U.length;for(;m--;){const g=U[m];d[m]=Math.round(255*(0,D.b)(g))}U=d}const V=g.td.createRawTexture(U,d,m,5,!1,!i,1);g.renderer.setViewport(),g.renderer.applyEffectWrapper(g.wrapper),g.wrapper.effect._bindTexture("textureSampler",V),g.renderer.draw(),C?u.f.ToBlob(g.canvas,(d=>{const m=new FileReader;m.onload=d=>{const m=d.target.result;X&&X(m)},m.readAsArrayBuffer(d)}),Y,L):u.f.EncodeScreenshotCanvasData(g.canvas,X,Y,B,L),V.dispose()}))}function Q(){var d;z?(z.wrapper.dispose(),z.renderer.dispose(),z.td.dispose()):null===(d=s)||void 0===d||d.then((d=>{d.wrapper.dispose(),d.renderer.dispose(),d.td.dispose()}));s=null,z=null}const B={DumpData:Y,DumpDataAsync:X,DumpFramebuffer:U,Dispose:Q};u.f.DumpData=Y,u.f.DumpDataAsync=X,u.f.DumpFramebuffer=U},10370:(d,m,g)=>{g.d(m,{c:()=>i,e:()=>O,i:()=>c,m:()=>A});var V=g(1190),u=g(1012),D=g(1045),j=g(1454),z=g(1135),s=g(1053),U=(g(1188),g(1499)),X=g(1102);g(10376),g(10383),g(10386);const Y="image/png",Q=2,B=[134,22,135,150,246,214,150,54];function i(d){const m=new DataView(d.buffer,d.byteOffset,d.byteLength);let g=0;for(let j=0;j<B.length;j++)if(m.getUint8(g++)!==B[j])return X.c.Error("Not a babylon environment map"),null;let V="",u=0;for(;u=m.getUint8(g++);)V+=String.fromCharCode(u);let D=JSON.parse(V);return D=C(D),D.ze&&(D.ze.specularDataPosition=g,D.ze.lodGenerationScale=D.ze.lodGenerationScale||.8),D}function C(d){if(d.version>Q)throw new Error(`Unsupported babylon environment map version "${d.version}". Latest supported version is "${Q}".`);return 2===d.version?d:d={...d,version:2,imageType:Y}}function L(d,m){const g=(m=C(m)).ze;let V=Math.log2(m.width);if(V=Math.round(V)+1,g.mipmaps.length!==6*V)throw new Error(`Unsupported specular mipmaps number "${g.mipmaps.length}"`);const u=new Array(V);for(let D=0;D<V;D++){u[D]=new Array(6);for(let m=0;m<6;m++){const V=g.mipmaps[6*D+m];u[D][m]=new Uint8Array(d.buffer,d.byteOffset+g.specularDataPosition+V.position,V.length)}}return u}function O(d,m,g){const V=(g=C(g)).ze;if(!V)return Promise.resolve();d._lodGenerationScale=V.lodGenerationScale;return J(d,L(m,g),g.imageType)}function R(d,m,g,V,u,D,j,z,s,U,X){return new Promise(((Y,Q)=>{if(g){const g=m.createTexture(null,!0,!0,null,1,null,(d=>{Q(d)}),d);null===V||void 0===V||V.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{V.externalTextureSamplerBinding=!0,V.onApply=V=>{V._bindTexture("textureSampler",g),V.setFloat2("scale",1,m._features.needsInvertingBitmap&&d instanceof ImageBitmap?-1:1)},m.scenes.length&&(m.scenes[0].postProcessManager.directRender([V],U,!0,D,j),m.restoreDefaultFramebuffer(),g.dispose(),URL.revokeObjectURL(u),Y())}))}))}else{if(m._uploadImageToTexture(X,d,D,j),z){const g=s[j];g&&m._uploadImageToTexture(g._texture,d,D,0)}Y()}}))}async function J(d,m){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y;if(!V.f.IsExponentOfTwo(d.width))throw new Error("Texture size must be a power of two");const j=(0,D.h)(d.width)+1,X=d.getEngine();let Q=!1,B=!1,i=null,C=null,L=null;const O=X.getCaps();d.format=5,d.type=0,d.generateMipMaps=!0,d._cachedAnisotropicFilteringLevel=null,X.updateTextureSamplingMode(3,d),O.textureLOD?X._features.supportRenderAndCopyToLodForFloatTextures?O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(Q=!0,d.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(Q=!0,d.type=1):Q=!1:(Q=!1,B=!0,L={});let J=0;if(Q)X.isWebGPU?(J=1,await g.e(17).then(g.bind(g,12359))):await g.e(24).then(g.bind(g,12363)),i=new U.b("rgbdDecode","rgbdDecode",null,null,1,null,3,X,!1,void 0,d.type,void 0,null,!1,void 0,J),d._isRGBD=!1,d.invertY=!1,C=X.createRenderTargetCubeTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:d.type,format:5});else if(d._isRGBD=!0,d.invertY=!0,B){const m=3,g=d._lodGenerationScale,V=d._lodGenerationOffset;for(let u=0;u<m;u++){const D=(j-1)*g+V,U=V+(D-V)*(1-u/(m-1)),Y=Math.round(Math.min(Math.max(U,0),D)),Q=new z.d(X,2);Q.isCube=!0,Q.invertY=!0,Q.generateMipMaps=!1,X.updateTextureSamplingMode(2,Q);const B=new s.c(null);switch(B._isCube=!0,B._texture=Q,L[Y]=B,u){case 0:d._lodTextureLow=B;break;case 1:d._lodTextureMid=B;break;case 2:d._lodTextureHigh=B}}}const c=[];for(let g=0;g<m.length;g++)for(let V=0;V<6;V++){const D=m[g][V],j=new Blob([D],{type:u}),z=URL.createObjectURL(j);let s;if(X._features.forceBitmapOverHTMLImageElement)s=X.createImageBitmap(j,{premultiplyAlpha:"none"}).then((m=>R(m,X,Q,i,z,V,g,B,L,C,d)));else{const m=new Image;m.src=z,s=new Promise(((u,D)=>{m.onload=()=>{R(m,X,Q,i,z,V,g,B,L,C,d).then((()=>u())).catch((d=>{D(d)}))},m.onerror=d=>{D(d)}}))}c.push(s)}if(m.length<j){let g;const V=Math.pow(2,j-1-m.length),u=V*V*4;switch(d.type){case 0:g=new Uint8Array(u);break;case 2:g=new Uint16Array(u);break;case 1:g=new Float32Array(u)}for(let D=m.length;D<j;D++)for(let m=0;m<6;m++)X._uploadArrayBufferViewToTexture(d,g,m,D)}return Promise.all(c).then((()=>{C&&(X._releaseTexture(d),C._swapAndDie(d)),i&&i.dispose(),B&&(d._lodTextureHigh&&d._lodTextureHigh._texture&&(d._lodTextureHigh._texture.isReady=!0),d._lodTextureMid&&d._lodTextureMid._texture&&(d._lodTextureMid._texture.isReady=!0),d._lodTextureLow&&d._lodTextureLow._texture&&(d._lodTextureLow._texture.isReady=!0))}))}function c(d,m){const g=(m=C(m)).irradiance;if(!g)return;const V=new j.f;u.m.FromArrayToRef(g.x,0,V.x),u.m.FromArrayToRef(g.y,0,V.y),u.m.FromArrayToRef(g.z,0,V.z),u.m.FromArrayToRef(g.xx,0,V.xx),u.m.FromArrayToRef(g.yy,0,V.yy),u.m.FromArrayToRef(g.zz,0,V.zz),u.m.FromArrayToRef(g.yz,0,V.yz),u.m.FromArrayToRef(g.zx,0,V.zx),u.m.FromArrayToRef(g.xy,0,V.xy),d._sphericalPolynomial=V}function A(d,m,g,V,u){const D=J(d.getEngine().createRawCubeTexture(null,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression),m).then((()=>d));return d.onRebuildCallback=d=>({proxy:D,isReady:!0,isAsync:!0}),d._source=13,d._bufferViewArrayArray=m,d._lodGenerationScale=V,d._lodGenerationOffset=u,d._sphericalPolynomial=g,J(d,m).then((()=>(d.isReady=!0,d)))}},10376:(d,m,g)=>{g.d(m,{d:()=>D});var V=g(1499),u=g(1484);class D{static ExpandRGBDTexture(d){const m=d._texture;if(!m||!d.isRGBD)return;const u=m.getEngine(),D=u.getCaps(),j=m.isReady;let z=!1;D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering?(z=!0,m.type=2):D.textureFloatRender&&D.textureFloatLinearFiltering&&(z=!0,m.type=1),z&&(m.isReady=!1,m._isRGBD=!1,m.invertY=!1);const s=async()=>{const D=u.isWebGPU,j=D?1:0;m.isReady=!1,D?await Promise.all([g.e(17).then(g.bind(g,12359)),g.e(18).then(g.bind(g,12365))]):await Promise.all([g.e(24).then(g.bind(g,12363)),g.e(25).then(g.bind(g,12367))]);const z=new V.b("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,m.type,void 0,null,!1,void 0,j);z.externalTextureSamplerBinding=!0;const s=u.createRenderTargetTexture(m.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:m.samplingMode,type:m.type,format:5});z.onEffectCreatedObservable.addOnce((g=>{g.executeWhenCompiled((()=>{z.onApply=d=>{d._bindTexture("textureSampler",m),d.setFloat2("scale",1,1)},d.va().postProcessManager.directRender([z],s,!0),u.restoreDefaultFramebuffer(),u._releaseTexture(m),z&&z.dispose(),s._swapAndDie(m),m.isReady=!0}))}))};z&&(j?s():d.onLoadObservable.addOnce(s))}static EncodeTextureToRGBD(d,m){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,u.e)("rgbdEncode",d,m,g,1,5)}}}}]);