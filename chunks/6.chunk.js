"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10285:(L,J,o)=>{var g=o(1524),V=o(1017);V.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(V.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=g.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((L=>{this._texture._sphericalPolynomial=L,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(L){this._texture&&(this._texture._sphericalPolynomial=L)},enumerable:!0,configurable:!0})},10294:(L,J,o)=>{o.r(J),o.d(J,{Dispose:()=>U,DumpData:()=>v,DumpDataAsync:()=>C,DumpFramebuffer:()=>Z,DumpTools:()=>k});var g=o(1543),V=o(1193),q=o(1011),I=o(1008);let b,D=null;async function Z(L,J,o,g){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,I=arguments.length>6?arguments[6]:void 0;const b=await o.readPixels(0,0,L,J);v(L,J,new Uint8Array(b.buffer),g,V,q,!0,void 0,I)}function C(L,J,o){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",V=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],I=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0;return new Promise((D=>{v(L,J,o,(L=>D(L)),g,V,q,I,b)}))}function v(L,J,Z,C){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7],T=arguments.length>8?arguments[8]:void 0;(async function(){return D||(D=new Promise(((L,J)=>{let V,q=null;const D={je:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,1431)).then((Z=>{let{ThinEngine:C}=Z;try{V=new OffscreenCanvas(100,100),q=new C(V,!1,D)}catch(k){V=document.createElement("canvas"),q=new C(V,!1,D)}I.d.Instances.pop(),I.d.OnEnginesDisposedObservable.add((L=>{q&&L!==q&&!q.u&&0===I.d.Instances.length&&U()})),q.getCaps().parallelShaderCompile=void 0;const v=new g.c(q);o.e(32).then(o.bind(o,10981)).then((o=>{let{passPixelShader:I}=o;if(!q)return void J("Engine is not defined");const D=new g.e({rd:q,name:I.name,fragmentShader:I.shader,samplerNames:["textureSampler"]});b={canvas:V,rd:q,renderer:v,wrapper:D},L(b)}))})).catch(J)}))),await D})().then((o=>{if(o.rd.setSize(L,J,!0),Z instanceof Float32Array){const L=new Uint8Array(Z.length);let J=Z.length;for(;J--;){const o=Z[J];L[J]=Math.round(255*(0,q.c)(o))}Z=L}const g=o.rd.createRawTexture(Z,L,J,5,!1,!H,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",g),o.renderer.draw(),e?V.c.ToBlob(o.canvas,(L=>{const J=new FileReader;J.onload=L=>{const J=L.target.result;C&&C(J)},J.readAsArrayBuffer(L)}),v,T):V.c.EncodeScreenshotCanvasData(o.canvas,C,v,k,T),g.dispose()}))}function U(){var L;b?(b.wrapper.dispose(),b.renderer.dispose(),b.rd.dispose()):null===(L=D)||void 0===L||L.then((L=>{L.wrapper.dispose(),L.renderer.dispose(),L.rd.dispose()}));D=null,b=null}const k={DumpData:v,DumpDataAsync:C,DumpFramebuffer:Z,Dispose:U};V.c.DumpData=v,V.c.DumpDataAsync=C,V.c.DumpFramebuffer=Z},10271:(L,J,o)=>{o.d(J,{b:()=>H,d:()=>O,e:()=>S,h:()=>y});var g=o(1193),V=o(982),q=o(1011),I=o(1489),b=o(1122),D=o(1017),Z=(o(1186),o(1536)),C=o(1082);o(10279),o(10285),o(10294);const v="image/png",U=2,k=[134,22,135,150,246,214,150,54];function H(L){const J=new DataView(L.buffer,L.byteOffset,L.byteLength);let o=0;for(let I=0;I<k.length;I++)if(J.getUint8(o++)!==k[I])return C.e.Error("Not a babylon environment map"),null;let g="",V=0;for(;V=J.getUint8(o++);)g+=String.fromCharCode(V);let q=JSON.parse(g);return q=e(q),q.De&&(q.De.specularDataPosition=o,q.De.lodGenerationScale=q.De.lodGenerationScale||.8),q}function e(L){if(L.version>U)throw new Error(`Unsupported babylon environment map version "${L.version}". Latest supported version is "${U}".`);return 2===L.version?L:L={...L,version:2,imageType:v}}function T(L,J){const o=(J=e(J)).De;let g=Math.log2(J.width);if(g=Math.round(g)+1,o.mipmaps.length!==6*g)throw new Error(`Unsupported specular mipmaps number "${o.mipmaps.length}"`);const V=new Array(g);for(let q=0;q<g;q++){V[q]=new Array(6);for(let J=0;J<6;J++){const g=o.mipmaps[6*q+J];V[q][J]=new Uint8Array(L.buffer,L.byteOffset+o.specularDataPosition+g.position,g.length)}}return V}function O(L,J,o){const g=(o=e(o)).De;if(!g)return Promise.resolve();L._lodGenerationScale=g.lodGenerationScale;return a(L,T(J,o),o.imageType)}function l(L,J,o,g,V,q,I,b,D,Z,C){return new Promise(((v,U)=>{if(o){const o=J.createTexture(null,!0,!0,null,1,null,(L=>{U(L)}),L);null===g||void 0===g||g.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{g.externalTextureSamplerBinding=!0,g.onApply=g=>{g._bindTexture("textureSampler",o),g.setFloat2("scale",1,J._features.needsInvertingBitmap&&L instanceof ImageBitmap?-1:1)},J.scenes.length&&(J.scenes[0].postProcessManager.directRender([g],Z,!0,q,I),J.restoreDefaultFramebuffer(),o.dispose(),URL.revokeObjectURL(V),v())}))}))}else{if(J._uploadImageToTexture(C,L,q,I),b){const o=D[I];o&&J._uploadImageToTexture(o._texture,L,q,0)}v()}}))}async function a(L,J){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;if(!g.c.IsExponentOfTwo(L.width))throw new Error("Texture size must be a power of two");const I=(0,q.h)(L.width)+1,C=L.getEngine();let U=!1,k=!1,H=null,e=null,T=null;const O=C.getCaps();L.format=5,L.type=0,L.generateMipMaps=!0,L._cachedAnisotropicFilteringLevel=null,C.updateTextureSamplingMode(3,L),O.textureLOD?C._features.supportRenderAndCopyToLodForFloatTextures?O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(U=!0,L.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(U=!0,L.type=1):U=!1:(U=!1,k=!0,T={});let a=0;if(U)C.isWebGPU?(a=1,await o.e(17).then(o.bind(o,12581))):await o.e(24).then(o.bind(o,12590)),H=new Z.b("rgbdDecode","rgbdDecode",null,null,1,null,3,C,!1,void 0,L.type,void 0,null,!1,void 0,a),L._isRGBD=!1,L.invertY=!1,e=C.createRenderTargetCubeTexture(L.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:L.type,format:5});else if(L._isRGBD=!0,L.invertY=!0,k){const J=3,o=L._lodGenerationScale,g=L._lodGenerationOffset;for(let V=0;V<J;V++){const q=(I-1)*o+g,Z=g+(q-g)*(1-V/(J-1)),v=Math.round(Math.min(Math.max(Z,0),q)),U=new b.e(C,2);U.isCube=!0,U.invertY=!0,U.generateMipMaps=!1,C.updateTextureSamplingMode(2,U);const k=new D.b(null);switch(k._isCube=!0,k._texture=U,T[v]=k,V){case 0:L._lodTextureLow=k;break;case 1:L._lodTextureMid=k;break;case 2:L._lodTextureHigh=k}}}const S=[];for(let o=0;o<J.length;o++)for(let g=0;g<6;g++){const q=J[o][g],I=new Blob([q],{type:V}),b=URL.createObjectURL(I);let D;if(C._features.forceBitmapOverHTMLImageElement)D=C.createImageBitmap(I,{premultiplyAlpha:"none"}).then((J=>l(J,C,U,H,b,g,o,k,T,e,L)));else{const J=new Image;J.src=b,D=new Promise(((V,q)=>{J.onload=()=>{l(J,C,U,H,b,g,o,k,T,e,L).then((()=>V())).catch((L=>{q(L)}))},J.onerror=L=>{q(L)}}))}S.push(D)}if(J.length<I){let o;const g=Math.pow(2,I-1-J.length),V=g*g*4;switch(L.type){case 0:o=new Uint8Array(V);break;case 2:o=new Uint16Array(V);break;case 1:o=new Float32Array(V)}for(let q=J.length;q<I;q++)for(let J=0;J<6;J++)C._uploadArrayBufferViewToTexture(L,o,J,q)}return Promise.all(S).then((()=>{e&&(C._releaseTexture(L),e._swapAndDie(L)),H&&H.dispose(),k&&(L._lodTextureHigh&&L._lodTextureHigh._texture&&(L._lodTextureHigh._texture.isReady=!0),L._lodTextureMid&&L._lodTextureMid._texture&&(L._lodTextureMid._texture.isReady=!0),L._lodTextureLow&&L._lodTextureLow._texture&&(L._lodTextureLow._texture.isReady=!0))}))}function S(L,J){const o=(J=e(J)).irradiance;if(!o)return;const g=new I.g;V.o.FromArrayToRef(o.x,0,g.x),V.o.FromArrayToRef(o.y,0,g.y),V.o.FromArrayToRef(o.z,0,g.z),V.o.FromArrayToRef(o.xx,0,g.xx),V.o.FromArrayToRef(o.yy,0,g.yy),V.o.FromArrayToRef(o.zz,0,g.zz),V.o.FromArrayToRef(o.yz,0,g.yz),V.o.FromArrayToRef(o.zx,0,g.zx),V.o.FromArrayToRef(o.xy,0,g.xy),L._sphericalPolynomial=g}function y(L,J,o,g,V){const q=a(L.getEngine().createRawCubeTexture(null,L.width,L.format,L.type,L.generateMipMaps,L.invertY,L.samplingMode,L._compression),J).then((()=>L));return L.onRebuildCallback=L=>({proxy:q,isReady:!0,isAsync:!0}),L._source=13,L._bufferViewArrayArray=J,L._lodGenerationScale=g,L._lodGenerationOffset=V,L._sphericalPolynomial=o,a(L,J).then((()=>(L.isReady=!0,L)))}},10279:(L,J,o)=>{o.d(J,{e:()=>q});var g=o(1536),V=o(1527);class q{static ExpandRGBDTexture(L){const J=L._texture;if(!J||!L.isRGBD)return;const V=J.getEngine(),q=V.getCaps(),I=J.isReady;let b=!1;q.textureHalfFloatRender&&q.textureHalfFloatLinearFiltering?(b=!0,J.type=2):q.textureFloatRender&&q.textureFloatLinearFiltering&&(b=!0,J.type=1),b&&(J.isReady=!1,J._isRGBD=!1,J.invertY=!1);const D=async()=>{const q=V.isWebGPU,I=q?1:0;J.isReady=!1,q?await Promise.all([o.e(17).then(o.bind(o,12581)),o.e(18).then(o.bind(o,12593))]):await Promise.all([o.e(24).then(o.bind(o,12590)),o.e(25).then(o.bind(o,12597))]);const b=new g.b("rgbdDecode","rgbdDecode",null,null,1,null,3,V,!1,void 0,J.type,void 0,null,!1,void 0,I);b.externalTextureSamplerBinding=!0;const D=V.createRenderTargetTexture(J.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:J.samplingMode,type:J.type,format:5});b.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{b.onApply=L=>{L._bindTexture("textureSampler",J),L.setFloat2("scale",1,1)},L.va().postProcessManager.directRender([b],D,!0),V.restoreDefaultFramebuffer(),V._releaseTexture(J),b&&b.dispose(),D._swapAndDie(J),J.isReady=!0}))}))};b&&(I?D():L.onLoadObservable.addOnce(D))}static EncodeTextureToRGBD(L,J){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,V.d)("rgbdEncode",L,J,o,1,5)}}}}]);