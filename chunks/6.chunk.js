"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10721:(O,q,s)=>{var Z=s(1498),D=s(1026);D.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(D.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Z.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((O=>{this._texture._sphericalPolynomial=O,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(O){this._texture&&(this._texture._sphericalPolynomial=O)},enumerable:!0,configurable:!0})},10727:(O,q,s)=>{s.r(q),s.d(q,{Dispose:()=>r,DumpData:()=>n,DumpDataAsync:()=>h,DumpFramebuffer:()=>w,DumpTools:()=>j});var Z=s(1521),D=s(1183),B=s(1022),P=s(1019);let y,o=null;async function w(O,q,s,Z){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,P=arguments.length>6?arguments[6]:void 0;const y=await s.readPixels(0,0,O,q);n(O,q,new Uint8Array(y.buffer),Z,D,B,!0,void 0,P)}function h(O,q,s){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",D=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7?arguments[7]:void 0;return new Promise((o=>{n(O,q,s,(O=>o(O)),Z,D,B,P,y)}))}function n(O,q,w,h){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return o||(o=new Promise(((O,q)=>{let D,B=null;const o={$e:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(s.bind(s,1417)).then((w=>{let{ThinEngine:h}=w;try{D=new OffscreenCanvas(100,100),B=new h(D,!1,o)}catch(j){D=document.createElement("canvas"),B=new h(D,!1,o)}P.c.Instances.pop(),P.c.OnEnginesDisposedObservable.add((O=>{B&&O!==B&&!B.u&&0===P.c.Instances.length&&r()})),B.getCaps().parallelShaderCompile=void 0;const n=new Z.e(B);s.e(32).then(s.bind(s,11399)).then((s=>{let{passPixelShader:P}=s;if(!B)return void q("Engine is not defined");const o=new Z.h({Lb:B,name:P.name,fragmentShader:P.shader,samplerNames:["textureSampler"]});y={canvas:D,Lb:B,renderer:n,wrapper:o},O(y)}))})).catch(q)}))),await o})().then((s=>{if(s.Lb.setSize(O,q,!0),w instanceof Float32Array){const O=new Uint8Array(w.length);let q=w.length;for(;q--;){const s=w[q];O[q]=Math.round(255*(0,B.e)(s))}w=O}const Z=s.Lb.createRawTexture(w,O,q,5,!1,!f,1);s.renderer.setViewport(),s.renderer.applyEffectWrapper(s.wrapper),s.wrapper.effect._bindTexture("textureSampler",Z),s.renderer.draw(),u?D.f.ToBlob(s.canvas,(O=>{const q=new FileReader;q.onload=O=>{const q=O.target.result;h&&h(q)},q.readAsArrayBuffer(O)}),n,c):D.f.EncodeScreenshotCanvasData(s.canvas,h,n,j,c),Z.dispose()}))}function r(){var O;y?(y.wrapper.dispose(),y.renderer.dispose(),y.Lb.dispose()):null===(O=o)||void 0===O||O.then((O=>{O.wrapper.dispose(),O.renderer.dispose(),O.Lb.dispose()}));o=null,y=null}const j={DumpData:n,DumpDataAsync:h,DumpFramebuffer:w,Dispose:r};D.f.DumpData=n,D.f.DumpDataAsync=h,D.f.DumpFramebuffer=w},10710:(O,q,s)=>{s.d(q,{e:()=>f,i:()=>W,k:()=>R,n:()=>N});var Z=s(1183),D=s(993),B=s(1022),P=s(1466),y=s(1114),o=s(1026),w=(s(1178),s(1517)),h=s(1077);s(10715),s(10721),s(10727);const n="image/png",r=2,j=[134,22,135,150,246,214,150,54];function f(O){const q=new DataView(O.buffer,O.byteOffset,O.byteLength);let s=0;for(let P=0;P<j.length;P++)if(q.getUint8(s++)!==j[P])return h.d.Error("Not a babylon environment map"),null;let Z="",D=0;for(;D=q.getUint8(s++);)Z+=String.fromCharCode(D);let B=JSON.parse(Z);return B=u(B),B.Ie&&(B.Ie.specularDataPosition=s,B.Ie.lodGenerationScale=B.Ie.lodGenerationScale||.8),B}function u(O){if(O.version>r)throw new Error(`Unsupported babylon environment map version "${O.version}". Latest supported version is "${r}".`);return 2===O.version?O:O={...O,version:2,imageType:n}}function c(O,q){const s=(q=u(q)).Ie;let Z=Math.log2(q.width);if(Z=Math.round(Z)+1,s.mipmaps.length!==6*Z)throw new Error(`Unsupported specular mipmaps number "${s.mipmaps.length}"`);const D=new Array(Z);for(let B=0;B<Z;B++){D[B]=new Array(6);for(let q=0;q<6;q++){const Z=s.mipmaps[6*B+q];D[B][q]=new Uint8Array(O.buffer,O.byteOffset+s.specularDataPosition+Z.position,Z.length)}}return D}function W(O,q,s){const Z=(s=u(s)).Ie;if(!Z)return Promise.resolve();O._lodGenerationScale=Z.lodGenerationScale;return g(O,c(q,s),s.imageType)}function m(O,q,s,Z,D,B,P,y,o,w,h){return new Promise(((n,r)=>{if(s){const s=q.createTexture(null,!0,!0,null,1,null,(O=>{r(O)}),O);null===Z||void 0===Z||Z.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled((()=>{Z.externalTextureSamplerBinding=!0,Z.onApply=Z=>{Z._bindTexture("textureSampler",s),Z.setFloat2("scale",1,q._features.needsInvertingBitmap&&O instanceof ImageBitmap?-1:1)},q.scenes.length&&(q.scenes[0].postProcessManager.directRender([Z],w,!0,B,P),q.restoreDefaultFramebuffer(),s.dispose(),URL.revokeObjectURL(D),n())}))}))}else{if(q._uploadImageToTexture(h,O,B,P),y){const s=o[P];s&&q._uploadImageToTexture(s._texture,O,B,0)}n()}}))}async function g(O,q){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;if(!Z.f.IsExponentOfTwo(O.width))throw new Error("Texture size must be a power of two");const P=(0,B.o)(O.width)+1,h=O.getEngine();let r=!1,j=!1,f=null,u=null,c=null;const W=h.getCaps();O.format=5,O.type=0,O.generateMipMaps=!0,O._cachedAnisotropicFilteringLevel=null,h.updateTextureSamplingMode(3,O),W.textureLOD?h._features.supportRenderAndCopyToLodForFloatTextures?W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering?(r=!0,O.type=2):W.textureFloatRender&&W.textureFloatLinearFiltering&&(r=!0,O.type=1):r=!1:(r=!1,j=!0,c={});let g=0;if(r)h.isWebGPU?(g=1,await s.e(17).then(s.bind(s,12956))):await s.e(24).then(s.bind(s,12961)),f=new w.b("rgbdDecode","rgbdDecode",null,null,1,null,3,h,!1,void 0,O.type,void 0,null,!1,void 0,g),O._isRGBD=!1,O.invertY=!1,u=h.createRenderTargetCubeTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:O.type,format:5});else if(O._isRGBD=!0,O.invertY=!0,j){const q=3,s=O._lodGenerationScale,Z=O._lodGenerationOffset;for(let D=0;D<q;D++){const B=(P-1)*s+Z,w=Z+(B-Z)*(1-D/(q-1)),n=Math.round(Math.min(Math.max(w,0),B)),r=new y.d(h,2);r.isCube=!0,r.invertY=!0,r.generateMipMaps=!1,h.updateTextureSamplingMode(2,r);const j=new o.e(null);switch(j._isCube=!0,j._texture=r,c[n]=j,D){case 0:O._lodTextureLow=j;break;case 1:O._lodTextureMid=j;break;case 2:O._lodTextureHigh=j}}}const R=[];for(let s=0;s<q.length;s++)for(let Z=0;Z<6;Z++){const B=q[s][Z],P=new Blob([B],{type:D}),y=URL.createObjectURL(P);let o;if(h._features.forceBitmapOverHTMLImageElement)o=h.createImageBitmap(P,{premultiplyAlpha:"none"}).then((q=>m(q,h,r,f,y,Z,s,j,c,u,O)));else{const q=new Image;q.src=y,o=new Promise(((D,B)=>{q.onload=()=>{m(q,h,r,f,y,Z,s,j,c,u,O).then((()=>D())).catch((O=>{B(O)}))},q.onerror=O=>{B(O)}}))}R.push(o)}if(q.length<P){let s;const Z=Math.pow(2,P-1-q.length),D=Z*Z*4;switch(O.type){case 0:s=new Uint8Array(D);break;case 2:s=new Uint16Array(D);break;case 1:s=new Float32Array(D)}for(let B=q.length;B<P;B++)for(let q=0;q<6;q++)h._uploadArrayBufferViewToTexture(O,s,q,B)}return Promise.all(R).then((()=>{u&&(h._releaseTexture(O),u._swapAndDie(O)),f&&f.dispose(),j&&(O._lodTextureHigh&&O._lodTextureHigh._texture&&(O._lodTextureHigh._texture.isReady=!0),O._lodTextureMid&&O._lodTextureMid._texture&&(O._lodTextureMid._texture.isReady=!0),O._lodTextureLow&&O._lodTextureLow._texture&&(O._lodTextureLow._texture.isReady=!0))}))}function R(O,q){const s=(q=u(q)).irradiance;if(!s)return;const Z=new P.f;D.n.FromArrayToRef(s.x,0,Z.x),D.n.FromArrayToRef(s.y,0,Z.y),D.n.FromArrayToRef(s.z,0,Z.z),D.n.FromArrayToRef(s.xx,0,Z.xx),D.n.FromArrayToRef(s.yy,0,Z.yy),D.n.FromArrayToRef(s.zz,0,Z.zz),D.n.FromArrayToRef(s.yz,0,Z.yz),D.n.FromArrayToRef(s.zx,0,Z.zx),D.n.FromArrayToRef(s.xy,0,Z.xy),O._sphericalPolynomial=Z}function N(O,q,s,Z,D){const B=g(O.getEngine().createRawCubeTexture(null,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression),q).then((()=>O));return O.onRebuildCallback=O=>({proxy:B,isReady:!0,isAsync:!0}),O._source=13,O._bufferViewArrayArray=q,O._lodGenerationScale=Z,O._lodGenerationOffset=D,O._sphericalPolynomial=s,g(O,q).then((()=>(O.isReady=!0,O)))}},10715:(O,q,s)=>{s.d(q,{b:()=>B});var Z=s(1517),D=s(1506);class B{static ExpandRGBDTexture(O){const q=O._texture;if(!q||!O.isRGBD)return;const D=q.getEngine(),B=D.getCaps(),P=q.isReady;let y=!1;B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(y=!0,q.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(y=!0,q.type=1),y&&(q.isReady=!1,q._isRGBD=!1,q.invertY=!1);const o=async()=>{const B=D.isWebGPU,P=B?1:0;q.isReady=!1,B?await Promise.all([s.e(17).then(s.bind(s,12956)),s.e(18).then(s.bind(s,12968))]):await Promise.all([s.e(24).then(s.bind(s,12961)),s.e(25).then(s.bind(s,12974))]);const y=new Z.b("rgbdDecode","rgbdDecode",null,null,1,null,3,D,!1,void 0,q.type,void 0,null,!1,void 0,P);y.externalTextureSamplerBinding=!0;const o=D.createRenderTargetTexture(q.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:q.samplingMode,type:q.type,format:5});y.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled((()=>{y.onApply=O=>{O._bindTexture("textureSampler",q),O.setFloat2("scale",1,1)},O.va().postProcessManager.directRender([y],o,!0),D.restoreDefaultFramebuffer(),D._releaseTexture(q),y&&y.dispose(),o._swapAndDie(q),q.isReady=!0}))}))};y&&(P?o():O.onLoadObservable.addOnce(o))}static EncodeTextureToRGBD(O,q){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,D.d)("rgbdEncode",O,q,s,1,5)}}}}]);