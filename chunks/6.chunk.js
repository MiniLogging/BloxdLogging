"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10317:(r,L,M)=>{var S=M(1425),T=M(981);T.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(T.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=S.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((r=>{this._texture._sphericalPolynomial=r,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(r){this._texture&&(this._texture._sphericalPolynomial=r)},enumerable:!0,configurable:!0})},10319:(r,L,M)=>{M.r(L),M.d(L,{Dispose:()=>t,DumpData:()=>f,DumpDataAsync:()=>J,DumpFramebuffer:()=>u,DumpTools:()=>o});var S=M(1447),T=M(1120),C=M(977),y=M(968);let s,v=null;async function u(r,L,M,S){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const s=await M.readPixels(0,0,r,L);f(r,L,new Uint8Array(s.buffer),S,T,C,!0,void 0,y)}function J(r,L,M){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",T=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0;return new Promise((v=>{f(r,L,M,(r=>v(r)),S,T,C,y,s)}))}function f(r,L,u,J){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],G=arguments.length>8?arguments[8]:void 0;(async function(){return v||(v=new Promise(((r,L)=>{let T,C=null;const v={Ne:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(M.bind(M,1358)).then((u=>{let{ThinEngine:J}=u;try{T=new OffscreenCanvas(100,100),C=new J(T,!1,v)}catch(o){T=document.createElement("canvas"),C=new J(T,!1,v)}y.c.Instances.pop(),y.c.OnEnginesDisposedObservable.add((r=>{C&&r!==C&&!C.u&&0===y.c.Instances.length&&t()})),C.getCaps().parallelShaderCompile=void 0;const f=new S.c(C);M.e(32).then(M.bind(M,11020)).then((M=>{let{passPixelShader:y}=M;if(!C)return void L("Engine is not defined");const v=new S.f({jb:C,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});s={canvas:T,jb:C,renderer:f,wrapper:v},r(s)}))})).catch(L)}))),await v})().then((M=>{if(M.jb.setSize(r,L,!0),u instanceof Float32Array){const r=new Uint8Array(u.length);let L=u.length;for(;L--;){const M=u[L];r[L]=Math.round(255*(0,C.d)(M))}u=r}const S=M.jb.createRawTexture(u,r,L,5,!1,!h,1);M.renderer.setViewport(),M.renderer.applyEffectWrapper(M.wrapper),M.wrapper.effect._bindTexture("textureSampler",S),M.renderer.draw(),U?T.g.ToBlob(M.canvas,(r=>{const L=new FileReader;L.onload=r=>{const L=r.target.result;J&&J(L)},L.readAsArrayBuffer(r)}),f,G):T.g.EncodeScreenshotCanvasData(M.canvas,J,f,o,G),S.dispose()}))}function t(){var r;s?(s.wrapper.dispose(),s.renderer.dispose(),s.jb.dispose()):null===(r=v)||void 0===r||r.then((r=>{r.wrapper.dispose(),r.renderer.dispose(),r.jb.dispose()}));v=null,s=null}const o={DumpData:f,DumpDataAsync:J,DumpFramebuffer:u,Dispose:t};T.g.DumpData=f,T.g.DumpDataAsync=J,T.g.DumpFramebuffer=u},10312:(r,L,M)=>{M.d(L,{b:()=>h,d:()=>W,g:()=>w,k:()=>j});var S=M(1120),T=M(945),C=M(977),y=M(1397),s=M(1060),v=M(981),u=(M(1114),M(1439)),J=M(1027);M(10315),M(10317),M(10319);const f="image/png",t=2,o=[134,22,135,150,246,214,150,54];function h(r){const L=new DataView(r.buffer,r.byteOffset,r.byteLength);let M=0;for(let y=0;y<o.length;y++)if(L.getUint8(M++)!==o[y])return J.c.Error("Not a babylon environment map"),null;let S="",T=0;for(;T=L.getUint8(M++);)S+=String.fromCharCode(T);let C=JSON.parse(S);return C=U(C),C.ve&&(C.ve.specularDataPosition=M,C.ve.lodGenerationScale=C.ve.lodGenerationScale||.8),C}function U(r){if(r.version>t)throw new Error(`Unsupported babylon environment map version "${r.version}". Latest supported version is "${t}".`);return 2===r.version?r:r={...r,version:2,imageType:f}}function G(r,L){const M=(L=U(L)).ve;let S=Math.log2(L.width);if(S=Math.round(S)+1,M.mipmaps.length!==6*S)throw new Error(`Unsupported specular mipmaps number "${M.mipmaps.length}"`);const T=new Array(S);for(let C=0;C<S;C++){T[C]=new Array(6);for(let L=0;L<6;L++){const S=M.mipmaps[6*C+L];T[C][L]=new Uint8Array(r.buffer,r.byteOffset+M.specularDataPosition+S.position,S.length)}}return T}function W(r,L,M){const S=(M=U(M)).ve;if(!S)return Promise.resolve();r._lodGenerationScale=S.lodGenerationScale;return e(r,G(L,M),M.imageType)}function l(r,L,M,S,T,C,y,s,v,u,J){return new Promise(((f,t)=>{if(M){const M=L.createTexture(null,!0,!0,null,1,null,(r=>{t(r)}),r);null===S||void 0===S||S.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled((()=>{S.externalTextureSamplerBinding=!0,S.onApply=S=>{S._bindTexture("textureSampler",M),S.setFloat2("scale",1,L._features.needsInvertingBitmap&&r instanceof ImageBitmap?-1:1)},L.scenes.length&&(L.scenes[0].postProcessManager.directRender([S],u,!0,C,y),L.restoreDefaultFramebuffer(),M.dispose(),URL.revokeObjectURL(T),f())}))}))}else{if(L._uploadImageToTexture(J,r,C,y),s){const M=v[y];M&&L._uploadImageToTexture(M._texture,r,C,0)}f()}}))}async function e(r,L){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;if(!S.g.IsExponentOfTwo(r.width))throw new Error("Texture size must be a power of two");const y=(0,C.m)(r.width)+1,J=r.getEngine();let t=!1,o=!1,h=null,U=null,G=null;const W=J.getCaps();r.format=5,r.type=0,r.generateMipMaps=!0,r._cachedAnisotropicFilteringLevel=null,J.updateTextureSamplingMode(3,r),W.textureLOD?J._features.supportRenderAndCopyToLodForFloatTextures?W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering?(t=!0,r.type=2):W.textureFloatRender&&W.textureFloatLinearFiltering&&(t=!0,r.type=1):t=!1:(t=!1,o=!0,G={});let e=0;if(t)J.isWebGPU?(e=1,await M.e(17).then(M.bind(M,12588))):await M.e(24).then(M.bind(M,12590)),h=new u.b("rgbdDecode","rgbdDecode",null,null,1,null,3,J,!1,void 0,r.type,void 0,null,!1,void 0,e),r._isRGBD=!1,r.invertY=!1,U=J.createRenderTargetCubeTexture(r.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:r.type,format:5});else if(r._isRGBD=!0,r.invertY=!0,o){const L=3,M=r._lodGenerationScale,S=r._lodGenerationOffset;for(let T=0;T<L;T++){const C=(y-1)*M+S,u=S+(C-S)*(1-T/(L-1)),f=Math.round(Math.min(Math.max(u,0),C)),t=new s.b(J,2);t.isCube=!0,t.invertY=!0,t.generateMipMaps=!1,J.updateTextureSamplingMode(2,t);const o=new v.c(null);switch(o._isCube=!0,o._texture=t,G[f]=o,T){case 0:r._lodTextureLow=o;break;case 1:r._lodTextureMid=o;break;case 2:r._lodTextureHigh=o}}}const w=[];for(let M=0;M<L.length;M++)for(let S=0;S<6;S++){const C=L[M][S],y=new Blob([C],{type:T}),s=URL.createObjectURL(y);let v;if(J._features.forceBitmapOverHTMLImageElement)v=J.createImageBitmap(y,{premultiplyAlpha:"none"}).then((L=>l(L,J,t,h,s,S,M,o,G,U,r)));else{const L=new Image;L.src=s,v=new Promise(((T,C)=>{L.onload=()=>{l(L,J,t,h,s,S,M,o,G,U,r).then((()=>T())).catch((r=>{C(r)}))},L.onerror=r=>{C(r)}}))}w.push(v)}if(L.length<y){let M;const S=Math.pow(2,y-1-L.length),T=S*S*4;switch(r.type){case 0:M=new Uint8Array(T);break;case 2:M=new Uint16Array(T);break;case 1:M=new Float32Array(T)}for(let C=L.length;C<y;C++)for(let L=0;L<6;L++)J._uploadArrayBufferViewToTexture(r,M,L,C)}return Promise.all(w).then((()=>{U&&(J._releaseTexture(r),U._swapAndDie(r)),h&&h.dispose(),o&&(r._lodTextureHigh&&r._lodTextureHigh._texture&&(r._lodTextureHigh._texture.isReady=!0),r._lodTextureMid&&r._lodTextureMid._texture&&(r._lodTextureMid._texture.isReady=!0),r._lodTextureLow&&r._lodTextureLow._texture&&(r._lodTextureLow._texture.isReady=!0))}))}function w(r,L){const M=(L=U(L)).irradiance;if(!M)return;const S=new y.f;T.m.FromArrayToRef(M.x,0,S.x),T.m.FromArrayToRef(M.y,0,S.y),T.m.FromArrayToRef(M.z,0,S.z),T.m.FromArrayToRef(M.xx,0,S.xx),T.m.FromArrayToRef(M.yy,0,S.yy),T.m.FromArrayToRef(M.zz,0,S.zz),T.m.FromArrayToRef(M.yz,0,S.yz),T.m.FromArrayToRef(M.zx,0,S.zx),T.m.FromArrayToRef(M.xy,0,S.xy),r._sphericalPolynomial=S}function j(r,L,M,S,T){const C=e(r.getEngine().createRawCubeTexture(null,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression),L).then((()=>r));return r.onRebuildCallback=r=>({proxy:C,isReady:!0,isAsync:!0}),r._source=13,r._bufferViewArrayArray=L,r._lodGenerationScale=S,r._lodGenerationOffset=T,r._sphericalPolynomial=M,e(r,L).then((()=>(r.isReady=!0,r)))}},10315:(r,L,M)=>{M.d(L,{b:()=>C});var S=M(1439),T=M(1434);class C{static ExpandRGBDTexture(r){const L=r._texture;if(!L||!r.isRGBD)return;const T=L.getEngine(),C=T.getCaps(),y=L.isReady;let s=!1;C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(s=!0,L.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(s=!0,L.type=1),s&&(L.isReady=!1,L._isRGBD=!1,L.invertY=!1);const v=async()=>{const C=T.isWebGPU,y=C?1:0;L.isReady=!1,C?await Promise.all([M.e(17).then(M.bind(M,12588)),M.e(18).then(M.bind(M,12595))]):await Promise.all([M.e(24).then(M.bind(M,12590)),M.e(25).then(M.bind(M,12598))]);const s=new S.b("rgbdDecode","rgbdDecode",null,null,1,null,3,T,!1,void 0,L.type,void 0,null,!1,void 0,y);s.externalTextureSamplerBinding=!0;const v=T.createRenderTargetTexture(L.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:L.samplingMode,type:L.type,format:5});s.onEffectCreatedObservable.addOnce((M=>{M.executeWhenCompiled((()=>{s.onApply=r=>{r._bindTexture("textureSampler",L),r.setFloat2("scale",1,1)},r.va().postProcessManager.directRender([s],v,!0),T.restoreDefaultFramebuffer(),T._releaseTexture(L),s&&s.dispose(),v._swapAndDie(L),L.isReady=!0}))}))};s&&(y?v():r.onLoadObservable.addOnce(v))}static EncodeTextureToRGBD(r,L){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,T.c)("rgbdEncode",r,L,M,1,5)}}}}]);