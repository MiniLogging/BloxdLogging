"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10676:(t,b,Y)=>{var o=Y(1583),x=Y(1066);x.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(x.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=o.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((t=>{this._texture._sphericalPolynomial=t,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(t){this._texture&&(this._texture._sphericalPolynomial=t)},enumerable:!0,configurable:!0})},10678:(t,b,Y)=>{Y.r(b),Y.d(b,{Dispose:()=>p,DumpData:()=>C,DumpDataAsync:()=>U,DumpFramebuffer:()=>E,DumpTools:()=>W});var o=Y(1606),x=Y(1265),F=Y(1058),r=Y(1051);let R,d=null;async function E(t,b,Y,o){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;const R=await Y.readPixels(0,0,t,b);C(t,b,new Uint8Array(R.buffer),o,x,F,!0,void 0,r)}function U(t,b,Y){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7?arguments[7]:void 0;return new Promise((d=>{C(t,b,Y,(t=>d(t)),o,x,F,r,R)}))}function C(t,b,E,U){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8?arguments[8]:void 0;(async function(){return d||(d=new Promise(((t,b)=>{let x,F=null;const d={re:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Y.bind(Y,1502)).then((E=>{let{ThinEngine:U}=E;try{x=new OffscreenCanvas(100,100),F=new U(x,!1,d)}catch(W){x=document.createElement("canvas"),F=new U(x,!1,d)}r.d.Instances.pop(),r.d.OnEnginesDisposedObservable.add((t=>{F&&t!==F&&!F.u&&0===r.d.Instances.length&&p()})),F.getCaps().parallelShaderCompile=void 0;const C=new o.c(F);Y.e(32).then(Y.bind(Y,11382)).then((Y=>{let{passPixelShader:r}=Y;if(!F)return void b("Engine is not defined");const d=new o.e({Id:F,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});R={canvas:x,Id:F,renderer:C,wrapper:d},t(R)}))})).catch(b)}))),await d})().then((Y=>{if(Y.Id.setSize(t,b,!0),E instanceof Float32Array){const t=new Uint8Array(E.length);let b=E.length;for(;b--;){const Y=E[b];t[b]=Math.round(255*(0,F.e)(Y))}E=t}const o=Y.Id.createRawTexture(E,t,b,5,!1,!T,1);Y.renderer.setViewport(),Y.renderer.applyEffectWrapper(Y.wrapper),Y.wrapper.effect._bindTexture("textureSampler",o),Y.renderer.draw(),y?x.f.ToBlob(Y.canvas,(t=>{const b=new FileReader;b.onload=t=>{const b=t.target.result;U&&U(b)},b.readAsArrayBuffer(t)}),C,v):x.f.EncodeScreenshotCanvasData(Y.canvas,U,C,W,v),o.dispose()}))}function p(){var t;R?(R.wrapper.dispose(),R.renderer.dispose(),R.Id.dispose()):null===(t=d)||void 0===t||t.then((t=>{t.wrapper.dispose(),t.renderer.dispose(),t.Id.dispose()}));d=null,R=null}const W={DumpData:C,DumpDataAsync:U,DumpFramebuffer:E,Dispose:p};x.f.DumpData=C,x.f.DumpDataAsync=U,x.f.DumpFramebuffer=E},10663:(t,b,Y)=>{Y.d(b,{e:()=>T,g:()=>B,i:()=>K,k:()=>L});var o=Y(1265),x=Y(1019),F=Y(1058),r=Y(1558),R=Y(1199),d=Y(1066),E=(Y(1260),Y(1599)),U=Y(1144);Y(10669),Y(10676),Y(10678);const C="image/png",p=2,W=[134,22,135,150,246,214,150,54];function T(t){const b=new DataView(t.buffer,t.byteOffset,t.byteLength);let Y=0;for(let r=0;r<W.length;r++)if(b.getUint8(Y++)!==W[r])return U.b.Error("Not a babylon environment map"),null;let o="",x=0;for(;x=b.getUint8(Y++);)o+=String.fromCharCode(x);let F=JSON.parse(o);return F=y(F),F.Ie&&(F.Ie.specularDataPosition=Y,F.Ie.lodGenerationScale=F.Ie.lodGenerationScale||.8),F}function y(t){if(t.version>p)throw new Error(`Unsupported babylon environment map version "${t.version}". Latest supported version is "${p}".`);return 2===t.version?t:t={...t,version:2,imageType:C}}function v(t,b){const Y=(b=y(b)).Ie;let o=Math.log2(b.width);if(o=Math.round(o)+1,Y.mipmaps.length!==6*o)throw new Error(`Unsupported specular mipmaps number "${Y.mipmaps.length}"`);const x=new Array(o);for(let F=0;F<o;F++){x[F]=new Array(6);for(let b=0;b<6;b++){const o=Y.mipmaps[6*F+b];x[F][b]=new Uint8Array(t.buffer,t.byteOffset+Y.specularDataPosition+o.position,o.length)}}return x}function B(t,b,Y){const o=(Y=y(Y)).Ie;if(!o)return Promise.resolve();t._lodGenerationScale=o.lodGenerationScale;return m(t,v(b,Y),Y.imageType)}function J(t,b,Y,o,x,F,r,R,d,E,U){return new Promise(((C,p)=>{if(Y){const Y=b.createTexture(null,!0,!0,null,1,null,(t=>{p(t)}),t);null===o||void 0===o||o.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled((()=>{o.externalTextureSamplerBinding=!0,o.onApply=o=>{o._bindTexture("textureSampler",Y),o.setFloat2("scale",1,b._features.needsInvertingBitmap&&t instanceof ImageBitmap?-1:1)},b.scenes.length&&(b.scenes[0].postProcessManager.directRender([o],E,!0,F,r),b.restoreDefaultFramebuffer(),Y.dispose(),URL.revokeObjectURL(x),C())}))}))}else{if(b._uploadImageToTexture(U,t,F,r),R){const Y=d[r];Y&&b._uploadImageToTexture(Y._texture,t,F,0)}C()}}))}async function m(t,b){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C;if(!o.f.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");const r=(0,F.l)(t.width)+1,U=t.getEngine();let p=!1,W=!1,T=null,y=null,v=null;const B=U.getCaps();t.format=5,t.type=0,t.generateMipMaps=!0,t._cachedAnisotropicFilteringLevel=null,U.updateTextureSamplingMode(3,t),B.textureLOD?U._features.supportRenderAndCopyToLodForFloatTextures?B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(p=!0,t.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(p=!0,t.type=1):p=!1:(p=!1,W=!0,v={});let m=0;if(p)U.isWebGPU?(m=1,await Y.e(17).then(Y.bind(Y,12946))):await Y.e(24).then(Y.bind(Y,12955)),T=new E.b("rgbdDecode","rgbdDecode",null,null,1,null,3,U,!1,void 0,t.type,void 0,null,!1,void 0,m),t._isRGBD=!1,t.invertY=!1,y=U.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:t.type,format:5});else if(t._isRGBD=!0,t.invertY=!0,W){const b=3,Y=t._lodGenerationScale,o=t._lodGenerationOffset;for(let x=0;x<b;x++){const F=(r-1)*Y+o,E=o+(F-o)*(1-x/(b-1)),C=Math.round(Math.min(Math.max(E,0),F)),p=new R.e(U,2);p.isCube=!0,p.invertY=!0,p.generateMipMaps=!1,U.updateTextureSamplingMode(2,p);const W=new d.b(null);switch(W._isCube=!0,W._texture=p,v[C]=W,x){case 0:t._lodTextureLow=W;break;case 1:t._lodTextureMid=W;break;case 2:t._lodTextureHigh=W}}}const K=[];for(let Y=0;Y<b.length;Y++)for(let o=0;o<6;o++){const F=b[Y][o],r=new Blob([F],{type:x}),R=URL.createObjectURL(r);let d;if(U._features.forceBitmapOverHTMLImageElement)d=U.createImageBitmap(r,{premultiplyAlpha:"none"}).then((b=>J(b,U,p,T,R,o,Y,W,v,y,t)));else{const b=new Image;b.src=R,d=new Promise(((x,F)=>{b.onload=()=>{J(b,U,p,T,R,o,Y,W,v,y,t).then((()=>x())).catch((t=>{F(t)}))},b.onerror=t=>{F(t)}}))}K.push(d)}if(b.length<r){let Y;const o=Math.pow(2,r-1-b.length),x=o*o*4;switch(t.type){case 0:Y=new Uint8Array(x);break;case 2:Y=new Uint16Array(x);break;case 1:Y=new Float32Array(x)}for(let F=b.length;F<r;F++)for(let b=0;b<6;b++)U._uploadArrayBufferViewToTexture(t,Y,b,F)}return Promise.all(K).then((()=>{y&&(U._releaseTexture(t),y._swapAndDie(t)),T&&T.dispose(),W&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))}))}function K(t,b){const Y=(b=y(b)).irradiance;if(!Y)return;const o=new r.i;x.l.FromArrayToRef(Y.x,0,o.x),x.l.FromArrayToRef(Y.y,0,o.y),x.l.FromArrayToRef(Y.z,0,o.z),x.l.FromArrayToRef(Y.xx,0,o.xx),x.l.FromArrayToRef(Y.yy,0,o.yy),x.l.FromArrayToRef(Y.zz,0,o.zz),x.l.FromArrayToRef(Y.yz,0,o.yz),x.l.FromArrayToRef(Y.zx,0,o.zx),x.l.FromArrayToRef(Y.xy,0,o.xy),t._sphericalPolynomial=o}function L(t,b,Y,o,x){const F=m(t.getEngine().createRawCubeTexture(null,t.width,t.format,t.type,t.generateMipMaps,t.invertY,t.samplingMode,t._compression),b).then((()=>t));return t.onRebuildCallback=t=>({proxy:F,isReady:!0,isAsync:!0}),t._source=13,t._bufferViewArrayArray=b,t._lodGenerationScale=o,t._lodGenerationOffset=x,t._sphericalPolynomial=Y,m(t,b).then((()=>(t.isReady=!0,t)))}},10669:(t,b,Y)=>{Y.d(b,{d:()=>F});var o=Y(1599),x=Y(1591);class F{static ExpandRGBDTexture(t){const b=t._texture;if(!b||!t.isRGBD)return;const x=b.getEngine(),F=x.getCaps(),r=b.isReady;let R=!1;F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?(R=!0,b.type=2):F.textureFloatRender&&F.textureFloatLinearFiltering&&(R=!0,b.type=1),R&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const d=async()=>{const F=x.isWebGPU,r=F?1:0;b.isReady=!1,F?await Promise.all([Y.e(17).then(Y.bind(Y,12946)),Y.e(18).then(Y.bind(Y,12957))]):await Promise.all([Y.e(24).then(Y.bind(Y,12955)),Y.e(25).then(Y.bind(Y,12962))]);const R=new o.b("rgbdDecode","rgbdDecode",null,null,1,null,3,x,!1,void 0,b.type,void 0,null,!1,void 0,r);R.externalTextureSamplerBinding=!0;const d=x.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});R.onEffectCreatedObservable.addOnce((Y=>{Y.executeWhenCompiled((()=>{R.onApply=t=>{t._bindTexture("textureSampler",b),t.setFloat2("scale",1,1)},t.va().postProcessManager.directRender([R],d,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(b),R&&R.dispose(),d._swapAndDie(b),b.isReady=!0}))}))};R&&(r?d():t.onLoadObservable.addOnce(d))}static EncodeTextureToRGBD(t,b){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,x.c)("rgbdEncode",t,b,Y,1,5)}}}}]);