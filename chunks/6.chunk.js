"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10947:(o,i,p)=>{var b=p(1456),k=p(1012);k.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(k.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=b.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((o=>{this._texture._sphericalPolynomial=o,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(o){this._texture&&(this._texture._sphericalPolynomial=o)},enumerable:!0,configurable:!0})},10953:(o,i,p)=>{p.r(i),p.d(i,{Dispose:()=>O,DumpData:()=>G,DumpDataAsync:()=>a,DumpFramebuffer:()=>J,DumpTools:()=>C});var b=p(1479),k=p(1175),u=p(1008),j=p(1003);let z,g=null;async function J(o,i,p,b){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;const z=await p.readPixels(0,0,o,i);G(o,i,new Uint8Array(z.buffer),b,k,u,!0,void 0,j)}function a(o,i,p){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return new Promise((g=>{G(o,i,p,(o=>g(o)),b,k,u,j,z)}))}function G(o,i,J,a){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return g||(g=new Promise(((o,i)=>{let k,u=null;const g={pf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(p.bind(p,1387)).then((J=>{let{ThinEngine:a}=J;try{k=new OffscreenCanvas(100,100),u=new a(k,!1,g)}catch(C){k=document.createElement("canvas"),u=new a(k,!1,g)}j.e.Instances.pop(),j.e.OnEnginesDisposedObservable.add((o=>{u&&o!==u&&!u.u&&0===j.e.Instances.length&&O()})),u.getCaps().parallelShaderCompile=void 0;const G=new b.c(u);p.e(32).then(p.bind(p,11643)).then((p=>{let{passPixelShader:j}=p;if(!u)return void i("Engine is not defined");const g=new b.e({Hb:u,name:j.name,fragmentShader:j.shader,samplerNames:["textureSampler"]});z={canvas:k,Hb:u,renderer:G,wrapper:g},o(z)}))})).catch(i)}))),await g})().then((p=>{if(p.Hb.setSize(o,i,!0),J instanceof Float32Array){const o=new Uint8Array(J.length);let i=J.length;for(;i--;){const p=J[i];o[i]=Math.round(255*(0,u.d)(p))}J=o}const b=p.Hb.createRawTexture(J,o,i,5,!1,!l,1);p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",b),p.renderer.draw(),R?k.h.ToBlob(p.canvas,(o=>{const i=new FileReader;i.onload=o=>{const i=o.target.result;a&&a(i)},i.readAsArrayBuffer(o)}),G,E):k.h.EncodeScreenshotCanvasData(p.canvas,a,G,C,E),b.dispose()}))}function O(){var o;z?(z.wrapper.dispose(),z.renderer.dispose(),z.Hb.dispose()):null===(o=g)||void 0===o||o.then((o=>{o.wrapper.dispose(),o.renderer.dispose(),o.Hb.dispose()}));g=null,z=null}const C={DumpData:G,DumpDataAsync:a,DumpFramebuffer:J,Dispose:O};k.h.DumpData=G,k.h.DumpDataAsync=a,k.h.DumpFramebuffer=J},10935:(o,i,p)=>{p.d(i,{d:()=>l,f:()=>F,j:()=>M,m:()=>T});var b=p(1175),k=p(977),u=p(1008),j=p(1431),z=p(1108),g=p(1012),J=(p(1172),p(1475)),a=p(1059);p(10944),p(10947),p(10953);const G="image/png",O=2,C=[134,22,135,150,246,214,150,54];function l(o){const i=new DataView(o.buffer,o.byteOffset,o.byteLength);let p=0;for(let j=0;j<C.length;j++)if(i.getUint8(p++)!==C[j])return a.c.Error("Not a babylon environment map"),null;let b="",k=0;for(;k=i.getUint8(p++);)b+=String.fromCharCode(k);let u=JSON.parse(b);return u=R(u),u.We&&(u.We.specularDataPosition=p,u.We.lodGenerationScale=u.We.lodGenerationScale||.8),u}function R(o){if(o.version>O)throw new Error(`Unsupported babylon environment map version "${o.version}". Latest supported version is "${O}".`);return 2===o.version?o:o={...o,version:2,imageType:G}}function E(o,i){const p=(i=R(i)).We;let b=Math.log2(i.width);if(b=Math.round(b)+1,p.mipmaps.length!==6*b)throw new Error(`Unsupported specular mipmaps number "${p.mipmaps.length}"`);const k=new Array(b);for(let u=0;u<b;u++){k[u]=new Array(6);for(let i=0;i<6;i++){const b=p.mipmaps[6*u+i];k[u][i]=new Uint8Array(o.buffer,o.byteOffset+p.specularDataPosition+b.position,b.length)}}return k}function F(o,i,p){const b=(p=R(p)).We;if(!b)return Promise.resolve();o._lodGenerationScale=b.lodGenerationScale;return W(o,E(i,p),p.imageType)}function e(o,i,p,b,k,u,j,z,g,J,a){return new Promise(((G,O)=>{if(p){const p=i.createTexture(null,!0,!0,null,1,null,(o=>{O(o)}),o);null===b||void 0===b||b.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{b.externalTextureSamplerBinding=!0,b.onApply=b=>{b._bindTexture("textureSampler",p),b.setFloat2("scale",1,i._features.needsInvertingBitmap&&o instanceof ImageBitmap?-1:1)},i.scenes.length&&(i.scenes[0].postProcessManager.directRender([b],J,!0,u,j),i.restoreDefaultFramebuffer(),p.dispose(),URL.revokeObjectURL(k),G())}))}))}else{if(i._uploadImageToTexture(a,o,u,j),z){const p=g[j];p&&i._uploadImageToTexture(p._texture,o,u,0)}G()}}))}async function W(o,i){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G;if(!b.h.IsExponentOfTwo(o.width))throw new Error("Texture size must be a power of two");const j=(0,u.j)(o.width)+1,a=o.getEngine();let O=!1,C=!1,l=null,R=null,E=null;const F=a.getCaps();o.format=5,o.type=0,o.generateMipMaps=!0,o._cachedAnisotropicFilteringLevel=null,a.updateTextureSamplingMode(3,o),F.textureLOD?a._features.supportRenderAndCopyToLodForFloatTextures?F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?(O=!0,o.type=2):F.textureFloatRender&&F.textureFloatLinearFiltering&&(O=!0,o.type=1):O=!1:(O=!1,C=!0,E={});let W=0;if(O)a.isWebGPU?(W=1,await p.e(17).then(p.bind(p,13266))):await p.e(24).then(p.bind(p,13275)),l=new J.d("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,o.type,void 0,null,!1,void 0,W),o._isRGBD=!1,o.invertY=!1,R=a.createRenderTargetCubeTexture(o.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:o.type,format:5});else if(o._isRGBD=!0,o.invertY=!0,C){const i=3,p=o._lodGenerationScale,b=o._lodGenerationOffset;for(let k=0;k<i;k++){const u=(j-1)*p+b,J=b+(u-b)*(1-k/(i-1)),G=Math.round(Math.min(Math.max(J,0),u)),O=new z.e(a,2);O.isCube=!0,O.invertY=!0,O.generateMipMaps=!1,a.updateTextureSamplingMode(2,O);const C=new g.c(null);switch(C._isCube=!0,C._texture=O,E[G]=C,k){case 0:o._lodTextureLow=C;break;case 1:o._lodTextureMid=C;break;case 2:o._lodTextureHigh=C}}}const M=[];for(let p=0;p<i.length;p++)for(let b=0;b<6;b++){const u=i[p][b],j=new Blob([u],{type:k}),z=URL.createObjectURL(j);let g;if(a._features.forceBitmapOverHTMLImageElement)g=a.createImageBitmap(j,{premultiplyAlpha:"none"}).then((i=>e(i,a,O,l,z,b,p,C,E,R,o)));else{const i=new Image;i.src=z,g=new Promise(((k,u)=>{i.onload=()=>{e(i,a,O,l,z,b,p,C,E,R,o).then((()=>k())).catch((o=>{u(o)}))},i.onerror=o=>{u(o)}}))}M.push(g)}if(i.length<j){let p;const b=Math.pow(2,j-1-i.length),k=b*b*4;switch(o.type){case 0:p=new Uint8Array(k);break;case 2:p=new Uint16Array(k);break;case 1:p=new Float32Array(k)}for(let u=i.length;u<j;u++)for(let i=0;i<6;i++)a._uploadArrayBufferViewToTexture(o,p,i,u)}return Promise.all(M).then((()=>{R&&(a._releaseTexture(o),R._swapAndDie(o)),l&&l.dispose(),C&&(o._lodTextureHigh&&o._lodTextureHigh._texture&&(o._lodTextureHigh._texture.isReady=!0),o._lodTextureMid&&o._lodTextureMid._texture&&(o._lodTextureMid._texture.isReady=!0),o._lodTextureLow&&o._lodTextureLow._texture&&(o._lodTextureLow._texture.isReady=!0))}))}function M(o,i){const p=(i=R(i)).irradiance;if(!p)return;const b=new j.e;k.i.FromArrayToRef(p.x,0,b.x),k.i.FromArrayToRef(p.y,0,b.y),k.i.FromArrayToRef(p.z,0,b.z),k.i.FromArrayToRef(p.xx,0,b.xx),k.i.FromArrayToRef(p.yy,0,b.yy),k.i.FromArrayToRef(p.zz,0,b.zz),k.i.FromArrayToRef(p.yz,0,b.yz),k.i.FromArrayToRef(p.zx,0,b.zx),k.i.FromArrayToRef(p.xy,0,b.xy),o._sphericalPolynomial=b}function T(o,i,p,b,k){const u=W(o.getEngine().createRawCubeTexture(null,o.width,o.format,o.type,o.generateMipMaps,o.invertY,o.samplingMode,o._compression),i).then((()=>o));return o.onRebuildCallback=o=>({proxy:u,isReady:!0,isAsync:!0}),o._source=13,o._bufferViewArrayArray=i,o._lodGenerationScale=b,o._lodGenerationOffset=k,o._sphericalPolynomial=p,W(o,i).then((()=>(o.isReady=!0,o)))}},10944:(o,i,p)=>{p.d(i,{b:()=>u});var b=p(1475),k=p(1465);class u{static ExpandRGBDTexture(o){const i=o._texture;if(!i||!o.isRGBD)return;const k=i.getEngine(),u=k.getCaps(),j=i.isReady;let z=!1;u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(z=!0,i.type=2):u.textureFloatRender&&u.textureFloatLinearFiltering&&(z=!0,i.type=1),z&&(i.isReady=!1,i._isRGBD=!1,i.invertY=!1);const g=async()=>{const u=k.isWebGPU,j=u?1:0;i.isReady=!1,u?await Promise.all([p.e(17).then(p.bind(p,13266)),p.e(18).then(p.bind(p,13277))]):await Promise.all([p.e(24).then(p.bind(p,13275)),p.e(25).then(p.bind(p,13285))]);const z=new b.d("rgbdDecode","rgbdDecode",null,null,1,null,3,k,!1,void 0,i.type,void 0,null,!1,void 0,j);z.externalTextureSamplerBinding=!0;const g=k.createRenderTargetTexture(i.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i.samplingMode,type:i.type,format:5});z.onEffectCreatedObservable.addOnce((p=>{p.executeWhenCompiled((()=>{z.onApply=o=>{o._bindTexture("textureSampler",i),o.setFloat2("scale",1,1)},o.va().postProcessManager.directRender([z],g,!0),k.restoreDefaultFramebuffer(),k._releaseTexture(i),z&&z.dispose(),g._swapAndDie(i),i.isReady=!0}))}))};z&&(j?g():o.onLoadObservable.addOnce(g))}static EncodeTextureToRGBD(o,i){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,k.b)("rgbdEncode",o,i,p,1,5)}}}}]);