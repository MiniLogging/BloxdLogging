"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10687:(j,S,h)=>{var m=h(1463),I=h(1007);I.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(I.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=m.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((j=>{this._texture._sphericalPolynomial=j,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(j){this._texture&&(this._texture._sphericalPolynomial=j)},enumerable:!0,configurable:!0})},10689:(j,S,h)=>{h.r(S),h.d(S,{Dispose:()=>p,DumpData:()=>O,DumpDataAsync:()=>M,DumpFramebuffer:()=>a,DumpTools:()=>e});var m=h(1479),I=h(1166),d=h(1005),U=h(1001);let f,r=null;async function a(j,S,h,m){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const f=await h.readPixels(0,0,j,S);O(j,S,new Uint8Array(f.buffer),m,I,d,!0,void 0,U)}function M(j,S,h){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7?arguments[7]:void 0;return new Promise((r=>{O(j,S,h,(j=>r(j)),m,I,d,U,f)}))}function O(j,S,a,M){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((j,S)=>{let I,d=null;const r={Se:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,1399)).then((a=>{let{ThinEngine:M}=a;try{I=new OffscreenCanvas(100,100),d=new M(I,!1,r)}catch(e){I=document.createElement("canvas"),d=new M(I,!1,r)}U.d.Instances.pop(),U.d.OnEnginesDisposedObservable.add((j=>{d&&j!==d&&!d.u&&0===U.d.Instances.length&&p()})),d.getCaps().parallelShaderCompile=void 0;const O=new m.c(d);h.e(32).then(h.bind(h,11434)).then((h=>{let{passPixelShader:U}=h;if(!d)return void S("Engine is not defined");const r=new m.f({pb:d,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});f={canvas:I,pb:d,renderer:O,wrapper:r},j(f)}))})).catch(S)}))),await r})().then((h=>{if(h.pb.setSize(j,S,!0),a instanceof Float32Array){const j=new Uint8Array(a.length);let S=a.length;for(;S--;){const h=a[S];j[S]=Math.round(255*(0,d.d)(h))}a=j}const m=h.pb.createRawTexture(a,j,S,5,!1,!w,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",m),h.renderer.draw(),l?I.e.ToBlob(h.canvas,(j=>{const S=new FileReader;S.onload=j=>{const S=j.target.result;M&&M(S)},S.readAsArrayBuffer(j)}),O,P):I.e.EncodeScreenshotCanvasData(h.canvas,M,O,e,P),m.dispose()}))}function p(){var j;f?(f.wrapper.dispose(),f.renderer.dispose(),f.pb.dispose()):null===(j=r)||void 0===j||j.then((j=>{j.wrapper.dispose(),j.renderer.dispose(),j.pb.dispose()}));r=null,f=null}const e={DumpData:O,DumpDataAsync:M,DumpFramebuffer:a,Dispose:p};I.e.DumpData=O,I.e.DumpDataAsync=M,I.e.DumpFramebuffer=a},10680:(j,S,h)=>{h.d(S,{c:()=>w,d:()=>v,e:()=>i,h:()=>N});var m=h(1166),I=h(970),d=h(1005),U=h(1442),f=h(1091),r=h(1007),a=(h(1160),h(1475)),M=h(1050);h(10685),h(10687),h(10689);const O="image/png",p=2,e=[134,22,135,150,246,214,150,54];function w(j){const S=new DataView(j.buffer,j.byteOffset,j.byteLength);let h=0;for(let U=0;U<e.length;U++)if(S.getUint8(h++)!==e[U])return M.b.Error("Not a babylon environment map"),null;let m="",I=0;for(;I=S.getUint8(h++);)m+=String.fromCharCode(I);let d=JSON.parse(m);return d=l(d),d.ze&&(d.ze.specularDataPosition=h,d.ze.lodGenerationScale=d.ze.lodGenerationScale||.8),d}function l(j){if(j.version>p)throw new Error(`Unsupported babylon environment map version "${j.version}". Latest supported version is "${p}".`);return 2===j.version?j:j={...j,version:2,imageType:O}}function P(j,S){const h=(S=l(S)).ze;let m=Math.log2(S.width);if(m=Math.round(m)+1,h.mipmaps.length!==6*m)throw new Error(`Unsupported specular mipmaps number "${h.mipmaps.length}"`);const I=new Array(m);for(let d=0;d<m;d++){I[d]=new Array(6);for(let S=0;S<6;S++){const m=h.mipmaps[6*d+S];I[d][S]=new Uint8Array(j.buffer,j.byteOffset+h.specularDataPosition+m.position,m.length)}}return I}function v(j,S,h){const m=(h=l(h)).ze;if(!m)return Promise.resolve();j._lodGenerationScale=m.lodGenerationScale;return R(j,P(S,h),h.imageType)}function o(j,S,h,m,I,d,U,f,r,a,M){return new Promise(((O,p)=>{if(h){const h=S.createTexture(null,!0,!0,null,1,null,(j=>{p(j)}),j);null===m||void 0===m||m.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{m.externalTextureSamplerBinding=!0,m.onApply=m=>{m._bindTexture("textureSampler",h),m.setFloat2("scale",1,S._features.needsInvertingBitmap&&j instanceof ImageBitmap?-1:1)},S.scenes.length&&(S.scenes[0].postProcessManager.directRender([m],a,!0,d,U),S.restoreDefaultFramebuffer(),h.dispose(),URL.revokeObjectURL(I),O())}))}))}else{if(S._uploadImageToTexture(M,j,d,U),f){const h=r[U];h&&S._uploadImageToTexture(h._texture,j,d,0)}O()}}))}async function R(j,S){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O;if(!m.e.IsExponentOfTwo(j.width))throw new Error("Texture size must be a power of two");const U=(0,d.n)(j.width)+1,M=j.getEngine();let p=!1,e=!1,w=null,l=null,P=null;const v=M.getCaps();j.format=5,j.type=0,j.generateMipMaps=!0,j._cachedAnisotropicFilteringLevel=null,M.updateTextureSamplingMode(3,j),v.textureLOD?M._features.supportRenderAndCopyToLodForFloatTextures?v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering?(p=!0,j.type=2):v.textureFloatRender&&v.textureFloatLinearFiltering&&(p=!0,j.type=1):p=!1:(p=!1,e=!0,P={});let R=0;if(p)M.isWebGPU?(R=1,await h.e(17).then(h.bind(h,13026))):await h.e(24).then(h.bind(h,13033)),w=new a.d("rgbdDecode","rgbdDecode",null,null,1,null,3,M,!1,void 0,j.type,void 0,null,!1,void 0,R),j._isRGBD=!1,j.invertY=!1,l=M.createRenderTargetCubeTexture(j.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:j.type,format:5});else if(j._isRGBD=!0,j.invertY=!0,e){const S=3,h=j._lodGenerationScale,m=j._lodGenerationOffset;for(let I=0;I<S;I++){const d=(U-1)*h+m,a=m+(d-m)*(1-I/(S-1)),O=Math.round(Math.min(Math.max(a,0),d)),p=new f.b(M,2);p.isCube=!0,p.invertY=!0,p.generateMipMaps=!1,M.updateTextureSamplingMode(2,p);const e=new r.c(null);switch(e._isCube=!0,e._texture=p,P[O]=e,I){case 0:j._lodTextureLow=e;break;case 1:j._lodTextureMid=e;break;case 2:j._lodTextureHigh=e}}}const i=[];for(let h=0;h<S.length;h++)for(let m=0;m<6;m++){const d=S[h][m],U=new Blob([d],{type:I}),f=URL.createObjectURL(U);let r;if(M._features.forceBitmapOverHTMLImageElement)r=M.createImageBitmap(U,{premultiplyAlpha:"none"}).then((S=>o(S,M,p,w,f,m,h,e,P,l,j)));else{const S=new Image;S.src=f,r=new Promise(((I,d)=>{S.onload=()=>{o(S,M,p,w,f,m,h,e,P,l,j).then((()=>I())).catch((j=>{d(j)}))},S.onerror=j=>{d(j)}}))}i.push(r)}if(S.length<U){let h;const m=Math.pow(2,U-1-S.length),I=m*m*4;switch(j.type){case 0:h=new Uint8Array(I);break;case 2:h=new Uint16Array(I);break;case 1:h=new Float32Array(I)}for(let d=S.length;d<U;d++)for(let S=0;S<6;S++)M._uploadArrayBufferViewToTexture(j,h,S,d)}return Promise.all(i).then((()=>{l&&(M._releaseTexture(j),l._swapAndDie(j)),w&&w.dispose(),e&&(j._lodTextureHigh&&j._lodTextureHigh._texture&&(j._lodTextureHigh._texture.isReady=!0),j._lodTextureMid&&j._lodTextureMid._texture&&(j._lodTextureMid._texture.isReady=!0),j._lodTextureLow&&j._lodTextureLow._texture&&(j._lodTextureLow._texture.isReady=!0))}))}function i(j,S){const h=(S=l(S)).irradiance;if(!h)return;const m=new U.h;I.m.FromArrayToRef(h.x,0,m.x),I.m.FromArrayToRef(h.y,0,m.y),I.m.FromArrayToRef(h.z,0,m.z),I.m.FromArrayToRef(h.xx,0,m.xx),I.m.FromArrayToRef(h.yy,0,m.yy),I.m.FromArrayToRef(h.zz,0,m.zz),I.m.FromArrayToRef(h.yz,0,m.yz),I.m.FromArrayToRef(h.zx,0,m.zx),I.m.FromArrayToRef(h.xy,0,m.xy),j._sphericalPolynomial=m}function N(j,S,h,m,I){const d=R(j.getEngine().createRawCubeTexture(null,j.width,j.format,j.type,j.generateMipMaps,j.invertY,j.samplingMode,j._compression),S).then((()=>j));return j.onRebuildCallback=j=>({proxy:d,isReady:!0,isAsync:!0}),j._source=13,j._bufferViewArrayArray=S,j._lodGenerationScale=m,j._lodGenerationOffset=I,j._sphericalPolynomial=h,R(j,S).then((()=>(j.isReady=!0,j)))}},10685:(j,S,h)=>{h.d(S,{d:()=>d});var m=h(1475),I=h(1465);class d{static ExpandRGBDTexture(j){const S=j._texture;if(!S||!j.isRGBD)return;const I=S.getEngine(),d=I.getCaps(),U=S.isReady;let f=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(f=!0,S.type=2):d.textureFloatRender&&d.textureFloatLinearFiltering&&(f=!0,S.type=1),f&&(S.isReady=!1,S._isRGBD=!1,S.invertY=!1);const r=async()=>{const d=I.isWebGPU,U=d?1:0;S.isReady=!1,d?await Promise.all([h.e(17).then(h.bind(h,13026)),h.e(18).then(h.bind(h,13039))]):await Promise.all([h.e(24).then(h.bind(h,13033)),h.e(25).then(h.bind(h,13041))]);const f=new m.d("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,S.type,void 0,null,!1,void 0,U);f.externalTextureSamplerBinding=!0;const r=I.createRenderTargetTexture(S.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:S.samplingMode,type:S.type,format:5});f.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{f.onApply=j=>{j._bindTexture("textureSampler",S),j.setFloat2("scale",1,1)},j.va().postProcessManager.directRender([f],r,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(S),f&&f.dispose(),r._swapAndDie(S),S.isReady=!0}))}))};f&&(U?r():j.onLoadObservable.addOnce(r))}static EncodeTextureToRGBD(j,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,I.c)("rgbdEncode",j,S,h,1,5)}}}}]);