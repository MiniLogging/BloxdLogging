"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10447:(U,b,e)=>{var K=e(1483),p=e(981);p.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(p.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=K.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((U=>{this._texture._sphericalPolynomial=U,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(U){this._texture&&(this._texture._sphericalPolynomial=U)},enumerable:!0,configurable:!0})},10453:(U,b,e)=>{e.r(b),e.d(b,{Dispose:()=>f,DumpData:()=>W,DumpDataAsync:()=>r,DumpFramebuffer:()=>u,DumpTools:()=>l});var K=e(1509),p=e(1147),m=e(979),i=e(975);let D,S=null;async function u(U,b,e,K){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const D=await e.readPixels(0,0,U,b);W(U,b,new Uint8Array(D.buffer),K,p,m,!0,void 0,i)}function r(U,b,e){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0;return new Promise((S=>{W(U,b,e,(U=>S(U)),K,p,m,i,D)}))}function W(U,b,u,r){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return S||(S=new Promise(((U,b)=>{let p,m=null;const S={Ye:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,1395)).then((u=>{let{ThinEngine:r}=u;try{p=new OffscreenCanvas(100,100),m=new r(p,!1,S)}catch(l){p=document.createElement("canvas"),m=new r(p,!1,S)}i.e.Instances.pop(),i.e.OnEnginesDisposedObservable.add((U=>{m&&U!==m&&!m.u&&0===i.e.Instances.length&&f()})),m.getCaps().parallelShaderCompile=void 0;const W=new K.d(m);e.e(32).then(e.bind(e,11131)).then((e=>{let{passPixelShader:i}=e;if(!m)return void b("Engine is not defined");const S=new K.f({Jb:m,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});D={canvas:p,Jb:m,renderer:W,wrapper:S},U(D)}))})).catch(b)}))),await S})().then((e=>{if(e.Jb.setSize(U,b,!0),u instanceof Float32Array){const U=new Uint8Array(u.length);let b=u.length;for(;b--;){const e=u[b];U[b]=Math.round(255*(0,m.b)(e))}u=U}const K=e.Jb.createRawTexture(u,U,b,5,!1,!P,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",K),e.renderer.draw(),G?p.g.ToBlob(e.canvas,(U=>{const b=new FileReader;b.onload=U=>{const b=U.target.result;r&&r(b)},b.readAsArrayBuffer(U)}),W,E):p.g.EncodeScreenshotCanvasData(e.canvas,r,W,l,E),K.dispose()}))}function f(){var U;D?(D.wrapper.dispose(),D.renderer.dispose(),D.Jb.dispose()):null===(U=S)||void 0===U||U.then((U=>{U.wrapper.dispose(),U.renderer.dispose(),U.Jb.dispose()}));S=null,D=null}const l={DumpData:W,DumpDataAsync:r,DumpFramebuffer:u,Dispose:f};p.g.DumpData=W,p.g.DumpDataAsync=r,p.g.DumpFramebuffer=u},10436:(U,b,e)=>{e.d(b,{b:()=>P,d:()=>A,f:()=>M,i:()=>Z});var K=e(1147),p=e(951),m=e(979),i=e(1452),D=e(1082),S=e(981),u=(e(1144),e(1500)),r=e(1032);e(10438),e(10447),e(10453);const W="image/png",f=2,l=[134,22,135,150,246,214,150,54];function P(U){const b=new DataView(U.buffer,U.byteOffset,U.byteLength);let e=0;for(let i=0;i<l.length;i++)if(b.getUint8(e++)!==l[i])return r.b.Error("Not a babylon environment map"),null;let K="",p=0;for(;p=b.getUint8(e++);)K+=String.fromCharCode(p);let m=JSON.parse(K);return m=G(m),m.De&&(m.De.specularDataPosition=e,m.De.lodGenerationScale=m.De.lodGenerationScale||.8),m}function G(U){if(U.version>f)throw new Error(`Unsupported babylon environment map version "${U.version}". Latest supported version is "${f}".`);return 2===U.version?U:U={...U,version:2,imageType:W}}function E(U,b){const e=(b=G(b)).De;let K=Math.log2(b.width);if(K=Math.round(K)+1,e.mipmaps.length!==6*K)throw new Error(`Unsupported specular mipmaps number "${e.mipmaps.length}"`);const p=new Array(K);for(let m=0;m<K;m++){p[m]=new Array(6);for(let b=0;b<6;b++){const K=e.mipmaps[6*m+b];p[m][b]=new Uint8Array(U.buffer,U.byteOffset+e.specularDataPosition+K.position,K.length)}}return p}function A(U,b,e){const K=(e=G(e)).De;if(!K)return Promise.resolve();U._lodGenerationScale=K.lodGenerationScale;return V(U,E(b,e),e.imageType)}function Y(U,b,e,K,p,m,i,D,S,u,r){return new Promise(((W,f)=>{if(e){const e=b.createTexture(null,!0,!0,null,1,null,(U=>{f(U)}),U);null===K||void 0===K||K.onEffectCreatedObservable.addOnce((D=>{D.executeWhenCompiled((()=>{K.externalTextureSamplerBinding=!0,K.onApply=K=>{K._bindTexture("textureSampler",e),K.setFloat2("scale",1,b._features.needsInvertingBitmap&&U instanceof ImageBitmap?-1:1)},b.scenes.length&&(b.scenes[0].postProcessManager.directRender([K],u,!0,m,i),b.restoreDefaultFramebuffer(),e.dispose(),URL.revokeObjectURL(p),W())}))}))}else{if(b._uploadImageToTexture(r,U,m,i),D){const e=S[i];e&&b._uploadImageToTexture(e._texture,U,m,0)}W()}}))}async function V(U,b){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W;if(!K.g.IsExponentOfTwo(U.width))throw new Error("Texture size must be a power of two");const i=(0,m.i)(U.width)+1,r=U.getEngine();let f=!1,l=!1,P=null,G=null,E=null;const A=r.getCaps();U.format=5,U.type=0,U.generateMipMaps=!0,U._cachedAnisotropicFilteringLevel=null,r.updateTextureSamplingMode(3,U),A.textureLOD?r._features.supportRenderAndCopyToLodForFloatTextures?A.textureHalfFloatRender&&A.textureHalfFloatLinearFiltering?(f=!0,U.type=2):A.textureFloatRender&&A.textureFloatLinearFiltering&&(f=!0,U.type=1):f=!1:(f=!1,l=!0,E={});let V=0;if(f)r.isWebGPU?(V=1,await e.e(17).then(e.bind(e,12665))):await e.e(24).then(e.bind(e,12668)),P=new u.e("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,U.type,void 0,null,!1,void 0,V),U._isRGBD=!1,U.invertY=!1,G=r.createRenderTargetCubeTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:U.type,format:5});else if(U._isRGBD=!0,U.invertY=!0,l){const b=3,e=U._lodGenerationScale,K=U._lodGenerationOffset;for(let p=0;p<b;p++){const m=(i-1)*e+K,u=K+(m-K)*(1-p/(b-1)),W=Math.round(Math.min(Math.max(u,0),m)),f=new D.c(r,2);f.isCube=!0,f.invertY=!0,f.generateMipMaps=!1,r.updateTextureSamplingMode(2,f);const l=new S.d(null);switch(l._isCube=!0,l._texture=f,E[W]=l,p){case 0:U._lodTextureLow=l;break;case 1:U._lodTextureMid=l;break;case 2:U._lodTextureHigh=l}}}const M=[];for(let e=0;e<b.length;e++)for(let K=0;K<6;K++){const m=b[e][K],i=new Blob([m],{type:p}),D=URL.createObjectURL(i);let S;if(r._features.forceBitmapOverHTMLImageElement)S=r.createImageBitmap(i,{premultiplyAlpha:"none"}).then((b=>Y(b,r,f,P,D,K,e,l,E,G,U)));else{const b=new Image;b.src=D,S=new Promise(((p,m)=>{b.onload=()=>{Y(b,r,f,P,D,K,e,l,E,G,U).then((()=>p())).catch((U=>{m(U)}))},b.onerror=U=>{m(U)}}))}M.push(S)}if(b.length<i){let e;const K=Math.pow(2,i-1-b.length),p=K*K*4;switch(U.type){case 0:e=new Uint8Array(p);break;case 2:e=new Uint16Array(p);break;case 1:e=new Float32Array(p)}for(let m=b.length;m<i;m++)for(let b=0;b<6;b++)r._uploadArrayBufferViewToTexture(U,e,b,m)}return Promise.all(M).then((()=>{G&&(r._releaseTexture(U),G._swapAndDie(U)),P&&P.dispose(),l&&(U._lodTextureHigh&&U._lodTextureHigh._texture&&(U._lodTextureHigh._texture.isReady=!0),U._lodTextureMid&&U._lodTextureMid._texture&&(U._lodTextureMid._texture.isReady=!0),U._lodTextureLow&&U._lodTextureLow._texture&&(U._lodTextureLow._texture.isReady=!0))}))}function M(U,b){const e=(b=G(b)).irradiance;if(!e)return;const K=new i.f;p.o.FromArrayToRef(e.x,0,K.x),p.o.FromArrayToRef(e.y,0,K.y),p.o.FromArrayToRef(e.z,0,K.z),p.o.FromArrayToRef(e.xx,0,K.xx),p.o.FromArrayToRef(e.yy,0,K.yy),p.o.FromArrayToRef(e.zz,0,K.zz),p.o.FromArrayToRef(e.yz,0,K.yz),p.o.FromArrayToRef(e.zx,0,K.zx),p.o.FromArrayToRef(e.xy,0,K.xy),U._sphericalPolynomial=K}function Z(U,b,e,K,p){const m=V(U.getEngine().createRawCubeTexture(null,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression),b).then((()=>U));return U.onRebuildCallback=U=>({proxy:m,isReady:!0,isAsync:!0}),U._source=13,U._bufferViewArrayArray=b,U._lodGenerationScale=K,U._lodGenerationOffset=p,U._sphericalPolynomial=e,V(U,b).then((()=>(U.isReady=!0,U)))}},10438:(U,b,e)=>{e.d(b,{c:()=>m});var K=e(1500),p=e(1489);class m{static ExpandRGBDTexture(U){const b=U._texture;if(!b||!U.isRGBD)return;const p=b.getEngine(),m=p.getCaps(),i=b.isReady;let D=!1;m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering?(D=!0,b.type=2):m.textureFloatRender&&m.textureFloatLinearFiltering&&(D=!0,b.type=1),D&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const S=async()=>{const m=p.isWebGPU,i=m?1:0;b.isReady=!1,m?await Promise.all([e.e(17).then(e.bind(e,12665)),e.e(18).then(e.bind(e,12671))]):await Promise.all([e.e(24).then(e.bind(e,12668)),e.e(25).then(e.bind(e,12676))]);const D=new K.e("rgbdDecode","rgbdDecode",null,null,1,null,3,p,!1,void 0,b.type,void 0,null,!1,void 0,i);D.externalTextureSamplerBinding=!0;const S=p.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});D.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{D.onApply=U=>{U._bindTexture("textureSampler",b),U.setFloat2("scale",1,1)},U.va().postProcessManager.directRender([D],S,!0),p.restoreDefaultFramebuffer(),p._releaseTexture(b),D&&D.dispose(),S._swapAndDie(b),b.isReady=!0}))}))};D&&(i?S():U.onLoadObservable.addOnce(S))}static EncodeTextureToRGBD(U,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.c)("rgbdEncode",U,b,e,1,5)}}}}]);