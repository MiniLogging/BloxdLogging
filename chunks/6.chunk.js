"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10352:(R,N,q)=>{var w=q(1491),u=q(1007);u.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(u.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=w.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((R=>{this._texture._sphericalPolynomial=R,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(R){this._texture&&(this._texture._sphericalPolynomial=R)},enumerable:!0,configurable:!0})},10354:(R,N,q)=>{q.r(N),q.d(N,{Dispose:()=>F,DumpData:()=>j,DumpDataAsync:()=>a,DumpFramebuffer:()=>y,DumpTools:()=>S});var w=q(1515),u=q(1177),M=q(1001),v=q(997);let G,J=null;async function y(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",M=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0;const G=await q.readPixels(0,0,R,N);j(R,N,new Uint8Array(G.buffer),w,u,M,!0,void 0,v)}function a(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0;return new Promise((J=>{j(R,N,q,(R=>J(R)),w,u,M,v,G)}))}function j(R,N,y,a){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",S=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],k=arguments.length>8?arguments[8]:void 0;(async function(){return J||(J=new Promise(((R,N)=>{let u,M=null;const J={fe:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(q.bind(q,1411)).then((y=>{let{ThinEngine:a}=y;try{u=new OffscreenCanvas(100,100),M=new a(u,!1,J)}catch(S){u=document.createElement("canvas"),M=new a(u,!1,J)}v.e.Instances.pop(),v.e.OnEnginesDisposedObservable.add((R=>{M&&R!==M&&!M.u&&0===v.e.Instances.length&&F()})),M.getCaps().parallelShaderCompile=void 0;const j=new w.b(M);q.e(32).then(q.bind(q,11023)).then((q=>{let{passPixelShader:v}=q;if(!M)return void N("Engine is not defined");const J=new w.e({vd:M,name:v.name,fragmentShader:v.shader,samplerNames:["textureSampler"]});G={canvas:u,vd:M,renderer:j,wrapper:J},R(G)}))})).catch(N)}))),await J})().then((q=>{if(q.vd.setSize(R,N,!0),y instanceof Float32Array){const R=new Uint8Array(y.length);let N=y.length;for(;N--;){const q=y[N];R[N]=Math.round(255*(0,M.b)(q))}y=R}const w=q.vd.createRawTexture(y,R,N,5,!1,!H,1);q.renderer.setViewport(),q.renderer.applyEffectWrapper(q.wrapper),q.wrapper.effect._bindTexture("textureSampler",w),q.renderer.draw(),W?u.i.ToBlob(q.canvas,(R=>{const N=new FileReader;N.onload=R=>{const N=R.target.result;a&&a(N)},N.readAsArrayBuffer(R)}),j,k):u.i.EncodeScreenshotCanvasData(q.canvas,a,j,S,k),w.dispose()}))}function F(){var R;G?(G.wrapper.dispose(),G.renderer.dispose(),G.vd.dispose()):null===(R=J)||void 0===R||R.then((R=>{R.wrapper.dispose(),R.renderer.dispose(),R.vd.dispose()}));J=null,G=null}const S={DumpData:j,DumpDataAsync:a,DumpFramebuffer:y,Dispose:F};u.i.DumpData=j,u.i.DumpDataAsync=a,u.i.DumpFramebuffer=y},10341:(R,N,q)=>{q.d(N,{b:()=>H,c:()=>C,g:()=>r,h:()=>Z});var w=q(1177),u=q(966),M=q(1001),v=q(1450),G=q(1104),J=q(1007),y=(q(1174),q(1510)),a=q(1056);q(10349),q(10352),q(10354);const j="image/png",F=2,S=[134,22,135,150,246,214,150,54];function H(R){const N=new DataView(R.buffer,R.byteOffset,R.byteLength);let q=0;for(let v=0;v<S.length;v++)if(N.getUint8(q++)!==S[v])return a.e.Error("Not a babylon environment map"),null;let w="",u=0;for(;u=N.getUint8(q++);)w+=String.fromCharCode(u);let M=JSON.parse(w);return M=W(M),M.ye&&(M.ye.specularDataPosition=q,M.ye.lodGenerationScale=M.ye.lodGenerationScale||.8),M}function W(R){if(R.version>F)throw new Error(`Unsupported babylon environment map version "${R.version}". Latest supported version is "${F}".`);return 2===R.version?R:R={...R,version:2,imageType:j}}function k(R,N){const q=(N=W(N)).ye;let w=Math.log2(N.width);if(w=Math.round(w)+1,q.mipmaps.length!==6*w)throw new Error(`Unsupported specular mipmaps number "${q.mipmaps.length}"`);const u=new Array(w);for(let M=0;M<w;M++){u[M]=new Array(6);for(let N=0;N<6;N++){const w=q.mipmaps[6*M+N];u[M][N]=new Uint8Array(R.buffer,R.byteOffset+q.specularDataPosition+w.position,w.length)}}return u}function C(R,N,q){const w=(q=W(q)).ye;if(!w)return Promise.resolve();R._lodGenerationScale=w.lodGenerationScale;return K(R,k(N,q),q.imageType)}function e(R,N,q,w,u,M,v,G,J,y,a){return new Promise(((j,F)=>{if(q){const q=N.createTexture(null,!0,!0,null,1,null,(R=>{F(R)}),R);null===w||void 0===w||w.onEffectCreatedObservable.addOnce((G=>{G.executeWhenCompiled((()=>{w.externalTextureSamplerBinding=!0,w.onApply=w=>{w._bindTexture("textureSampler",q),w.setFloat2("scale",1,N._features.needsInvertingBitmap&&R instanceof ImageBitmap?-1:1)},N.scenes.length&&(N.scenes[0].postProcessManager.directRender([w],y,!0,M,v),N.restoreDefaultFramebuffer(),q.dispose(),URL.revokeObjectURL(u),j())}))}))}else{if(N._uploadImageToTexture(a,R,M,v),G){const q=J[v];q&&N._uploadImageToTexture(q._texture,R,M,0)}j()}}))}async function K(R,N){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j;if(!w.i.IsExponentOfTwo(R.width))throw new Error("Texture size must be a power of two");const v=(0,M.l)(R.width)+1,a=R.getEngine();let F=!1,S=!1,H=null,W=null,k=null;const C=a.getCaps();R.format=5,R.type=0,R.generateMipMaps=!0,R._cachedAnisotropicFilteringLevel=null,a.updateTextureSamplingMode(3,R),C.textureLOD?a._features.supportRenderAndCopyToLodForFloatTextures?C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(F=!0,R.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(F=!0,R.type=1):F=!1:(F=!1,S=!0,k={});let K=0;if(F)a.isWebGPU?(K=1,await q.e(17).then(q.bind(q,12611))):await q.e(24).then(q.bind(q,12618)),H=new y.c("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,R.type,void 0,null,!1,void 0,K),R._isRGBD=!1,R.invertY=!1,W=a.createRenderTargetCubeTexture(R.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:R.type,format:5});else if(R._isRGBD=!0,R.invertY=!0,S){const N=3,q=R._lodGenerationScale,w=R._lodGenerationOffset;for(let u=0;u<N;u++){const M=(v-1)*q+w,y=w+(M-w)*(1-u/(N-1)),j=Math.round(Math.min(Math.max(y,0),M)),F=new G.d(a,2);F.isCube=!0,F.invertY=!0,F.generateMipMaps=!1,a.updateTextureSamplingMode(2,F);const S=new J.b(null);switch(S._isCube=!0,S._texture=F,k[j]=S,u){case 0:R._lodTextureLow=S;break;case 1:R._lodTextureMid=S;break;case 2:R._lodTextureHigh=S}}}const r=[];for(let q=0;q<N.length;q++)for(let w=0;w<6;w++){const M=N[q][w],v=new Blob([M],{type:u}),G=URL.createObjectURL(v);let J;if(a._features.forceBitmapOverHTMLImageElement)J=a.createImageBitmap(v,{premultiplyAlpha:"none"}).then((N=>e(N,a,F,H,G,w,q,S,k,W,R)));else{const N=new Image;N.src=G,J=new Promise(((u,M)=>{N.onload=()=>{e(N,a,F,H,G,w,q,S,k,W,R).then((()=>u())).catch((R=>{M(R)}))},N.onerror=R=>{M(R)}}))}r.push(J)}if(N.length<v){let q;const w=Math.pow(2,v-1-N.length),u=w*w*4;switch(R.type){case 0:q=new Uint8Array(u);break;case 2:q=new Uint16Array(u);break;case 1:q=new Float32Array(u)}for(let M=N.length;M<v;M++)for(let N=0;N<6;N++)a._uploadArrayBufferViewToTexture(R,q,N,M)}return Promise.all(r).then((()=>{W&&(a._releaseTexture(R),W._swapAndDie(R)),H&&H.dispose(),S&&(R._lodTextureHigh&&R._lodTextureHigh._texture&&(R._lodTextureHigh._texture.isReady=!0),R._lodTextureMid&&R._lodTextureMid._texture&&(R._lodTextureMid._texture.isReady=!0),R._lodTextureLow&&R._lodTextureLow._texture&&(R._lodTextureLow._texture.isReady=!0))}))}function r(R,N){const q=(N=W(N)).irradiance;if(!q)return;const w=new v.h;u.m.FromArrayToRef(q.x,0,w.x),u.m.FromArrayToRef(q.y,0,w.y),u.m.FromArrayToRef(q.z,0,w.z),u.m.FromArrayToRef(q.xx,0,w.xx),u.m.FromArrayToRef(q.yy,0,w.yy),u.m.FromArrayToRef(q.zz,0,w.zz),u.m.FromArrayToRef(q.yz,0,w.yz),u.m.FromArrayToRef(q.zx,0,w.zx),u.m.FromArrayToRef(q.xy,0,w.xy),R._sphericalPolynomial=w}function Z(R,N,q,w,u){const M=K(R.getEngine().createRawCubeTexture(null,R.width,R.format,R.type,R.generateMipMaps,R.invertY,R.samplingMode,R._compression),N).then((()=>R));return R.onRebuildCallback=R=>({proxy:M,isReady:!0,isAsync:!0}),R._source=13,R._bufferViewArrayArray=N,R._lodGenerationScale=w,R._lodGenerationOffset=u,R._sphericalPolynomial=q,K(R,N).then((()=>(R.isReady=!0,R)))}},10349:(R,N,q)=>{q.d(N,{c:()=>M});var w=q(1510),u=q(1496);class M{static ExpandRGBDTexture(R){const N=R._texture;if(!N||!R.isRGBD)return;const u=N.getEngine(),M=u.getCaps(),v=N.isReady;let G=!1;M.textureHalfFloatRender&&M.textureHalfFloatLinearFiltering?(G=!0,N.type=2):M.textureFloatRender&&M.textureFloatLinearFiltering&&(G=!0,N.type=1),G&&(N.isReady=!1,N._isRGBD=!1,N.invertY=!1);const J=async()=>{const M=u.isWebGPU,v=M?1:0;N.isReady=!1,M?await Promise.all([q.e(17).then(q.bind(q,12611)),q.e(18).then(q.bind(q,12626))]):await Promise.all([q.e(24).then(q.bind(q,12618)),q.e(25).then(q.bind(q,12629))]);const G=new w.c("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,N.type,void 0,null,!1,void 0,v);G.externalTextureSamplerBinding=!0;const J=u.createRenderTargetTexture(N.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:N.samplingMode,type:N.type,format:5});G.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled((()=>{G.onApply=R=>{R._bindTexture("textureSampler",N),R.setFloat2("scale",1,1)},R.va().postProcessManager.directRender([G],J,!0),u.restoreDefaultFramebuffer(),u._releaseTexture(N),G&&G.dispose(),J._swapAndDie(N),N.isReady=!0}))}))};G&&(v?J():R.onLoadObservable.addOnce(J))}static EncodeTextureToRGBD(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,u.e)("rgbdEncode",R,N,q,1,5)}}}}]);