"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{11018:(b,o,l)=>{var g=l(1571),I=l(1092);I.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(I.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=g.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((b=>{this._texture._sphericalPolynomial=b,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(b){this._texture&&(this._texture._sphericalPolynomial=b)},enumerable:!0,configurable:!0})},11025:(b,o,l)=>{l.r(o),l.d(o,{Dispose:()=>C,DumpData:()=>w,DumpDataAsync:()=>A,DumpFramebuffer:()=>t,DumpTools:()=>U});var g=l(1599),I=l(1262),v=l(1089),W=l(1086);let n,T=null;async function t(b,o,l,g){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,W=arguments.length>6?arguments[6]:void 0;const n=await l.readPixels(0,0,b,o);w(b,o,new Uint8Array(n.buffer),g,I,v,!0,void 0,W)}function A(b,o,l){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0;return new Promise((T=>{w(b,o,l,(b=>T(b)),g,I,v,W,n)}))}function w(b,o,t,A){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8?arguments[8]:void 0;(async function(){return T||(T=new Promise(((b,o)=>{let I,v=null;const T={ff:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,1489)).then((t=>{let{ThinEngine:A}=t;try{I=new OffscreenCanvas(100,100),v=new A(I,!1,T)}catch(U){I=document.createElement("canvas"),v=new A(I,!1,T)}W.e.Instances.pop(),W.e.OnEnginesDisposedObservable.add((b=>{v&&b!==v&&!v.u&&0===W.e.Instances.length&&C()})),v.getCaps().parallelShaderCompile=void 0;const w=new g.c(v);l.e(32).then(l.bind(l,11724)).then((l=>{let{passPixelShader:W}=l;if(!v)return void o("Engine is not defined");const T=new g.d({mb:v,name:W.name,fragmentShader:W.shader,samplerNames:["textureSampler"]});n={canvas:I,mb:v,renderer:w,wrapper:T},b(n)}))})).catch(o)}))),await T})().then((l=>{if(l.mb.setSize(b,o,!0),t instanceof Float32Array){const b=new Uint8Array(t.length);let o=t.length;for(;o--;){const l=t[o];b[o]=Math.round(255*(0,v.b)(l))}t=b}const g=l.mb.createRawTexture(t,b,o,5,!1,!m,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",g),l.renderer.draw(),N?I.c.ToBlob(l.canvas,(b=>{const o=new FileReader;o.onload=b=>{const o=b.target.result;A&&A(o)},o.readAsArrayBuffer(b)}),w,x):I.c.EncodeScreenshotCanvasData(l.canvas,A,w,U,x),g.dispose()}))}function C(){var b;n?(n.wrapper.dispose(),n.renderer.dispose(),n.mb.dispose()):null===(b=T)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.mb.dispose()}));T=null,n=null}const U={DumpData:w,DumpDataAsync:A,DumpFramebuffer:t,Dispose:C};I.c.DumpData=w,I.c.DumpDataAsync=A,I.c.DumpFramebuffer=t},11008:(b,o,l)=>{l.d(o,{e:()=>m,f:()=>k,i:()=>c,m:()=>G});var g=l(1262),I=l(1054),v=l(1089),W=l(1537),n=l(1186),T=l(1092),t=(l(1256),l(1593)),A=l(1137);l(11015),l(11018),l(11025);const w="image/png",C=2,U=[134,22,135,150,246,214,150,54];function m(b){const o=new DataView(b.buffer,b.byteOffset,b.byteLength);let l=0;for(let W=0;W<U.length;W++)if(o.getUint8(l++)!==U[W])return A.d.Error("Not a babylon environment map"),null;let g="",I=0;for(;I=o.getUint8(l++);)g+=String.fromCharCode(I);let v=JSON.parse(g);return v=N(v),v.Me&&(v.Me.specularDataPosition=l,v.Me.lodGenerationScale=v.Me.lodGenerationScale||.8),v}function N(b){if(b.version>C)throw new Error(`Unsupported babylon environment map version "${b.version}". Latest supported version is "${C}".`);return 2===b.version?b:b={...b,version:2,imageType:w}}function x(b,o){const l=(o=N(o)).Me;let g=Math.log2(o.width);if(g=Math.round(g)+1,l.mipmaps.length!==6*g)throw new Error(`Unsupported specular mipmaps number "${l.mipmaps.length}"`);const I=new Array(g);for(let v=0;v<g;v++){I[v]=new Array(6);for(let o=0;o<6;o++){const g=l.mipmaps[6*v+o];I[v][o]=new Uint8Array(b.buffer,b.byteOffset+l.specularDataPosition+g.position,g.length)}}return I}function k(b,o,l){const g=(l=N(l)).Me;if(!g)return Promise.resolve();b._lodGenerationScale=g.lodGenerationScale;return a(b,x(o,l),l.imageType)}function D(b,o,l,g,I,v,W,n,T,t,A){return new Promise(((w,C)=>{if(l){const l=o.createTexture(null,!0,!0,null,1,null,(b=>{C(b)}),b);null===g||void 0===g||g.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{g.externalTextureSamplerBinding=!0,g.onApply=g=>{g._bindTexture("textureSampler",l),g.setFloat2("scale",1,o._features.needsInvertingBitmap&&b instanceof ImageBitmap?-1:1)},o.scenes.length&&(o.scenes[0].postProcessManager.directRender([g],t,!0,v,W),o.restoreDefaultFramebuffer(),l.dispose(),URL.revokeObjectURL(I),w())}))}))}else{if(o._uploadImageToTexture(A,b,v,W),n){const l=T[W];l&&o._uploadImageToTexture(l._texture,b,v,0)}w()}}))}async function a(b,o){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;if(!g.c.IsExponentOfTwo(b.width))throw new Error("Texture size must be a power of two");const W=(0,v.i)(b.width)+1,A=b.getEngine();let C=!1,U=!1,m=null,N=null,x=null;const k=A.getCaps();b.format=5,b.type=0,b.generateMipMaps=!0,b._cachedAnisotropicFilteringLevel=null,A.updateTextureSamplingMode(3,b),k.textureLOD?A._features.supportRenderAndCopyToLodForFloatTextures?k.textureHalfFloatRender&&k.textureHalfFloatLinearFiltering?(C=!0,b.type=2):k.textureFloatRender&&k.textureFloatLinearFiltering&&(C=!0,b.type=1):C=!1:(C=!1,U=!0,x={});let a=0;if(C)A.isWebGPU?(a=1,await l.e(17).then(l.bind(l,13312))):await l.e(24).then(l.bind(l,13318)),m=new t.e("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,b.type,void 0,null,!1,void 0,a),b._isRGBD=!1,b.invertY=!1,N=A.createRenderTargetCubeTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:b.type,format:5});else if(b._isRGBD=!0,b.invertY=!0,U){const o=3,l=b._lodGenerationScale,g=b._lodGenerationOffset;for(let I=0;I<o;I++){const v=(W-1)*l+g,t=g+(v-g)*(1-I/(o-1)),w=Math.round(Math.min(Math.max(t,0),v)),C=new n.e(A,2);C.isCube=!0,C.invertY=!0,C.generateMipMaps=!1,A.updateTextureSamplingMode(2,C);const U=new T.b(null);switch(U._isCube=!0,U._texture=C,x[w]=U,I){case 0:b._lodTextureLow=U;break;case 1:b._lodTextureMid=U;break;case 2:b._lodTextureHigh=U}}}const c=[];for(let l=0;l<o.length;l++)for(let g=0;g<6;g++){const v=o[l][g],W=new Blob([v],{type:I}),n=URL.createObjectURL(W);let T;if(A._features.forceBitmapOverHTMLImageElement)T=A.createImageBitmap(W,{premultiplyAlpha:"none"}).then((o=>D(o,A,C,m,n,g,l,U,x,N,b)));else{const o=new Image;o.src=n,T=new Promise(((I,v)=>{o.onload=()=>{D(o,A,C,m,n,g,l,U,x,N,b).then((()=>I())).catch((b=>{v(b)}))},o.onerror=b=>{v(b)}}))}c.push(T)}if(o.length<W){let l;const g=Math.pow(2,W-1-o.length),I=g*g*4;switch(b.type){case 0:l=new Uint8Array(I);break;case 2:l=new Uint16Array(I);break;case 1:l=new Float32Array(I)}for(let v=o.length;v<W;v++)for(let o=0;o<6;o++)A._uploadArrayBufferViewToTexture(b,l,o,v)}return Promise.all(c).then((()=>{N&&(A._releaseTexture(b),N._swapAndDie(b)),m&&m.dispose(),U&&(b._lodTextureHigh&&b._lodTextureHigh._texture&&(b._lodTextureHigh._texture.isReady=!0),b._lodTextureMid&&b._lodTextureMid._texture&&(b._lodTextureMid._texture.isReady=!0),b._lodTextureLow&&b._lodTextureLow._texture&&(b._lodTextureLow._texture.isReady=!0))}))}function c(b,o){const l=(o=N(o)).irradiance;if(!l)return;const g=new W.f;I.l.FromArrayToRef(l.x,0,g.x),I.l.FromArrayToRef(l.y,0,g.y),I.l.FromArrayToRef(l.z,0,g.z),I.l.FromArrayToRef(l.xx,0,g.xx),I.l.FromArrayToRef(l.yy,0,g.yy),I.l.FromArrayToRef(l.zz,0,g.zz),I.l.FromArrayToRef(l.yz,0,g.yz),I.l.FromArrayToRef(l.zx,0,g.zx),I.l.FromArrayToRef(l.xy,0,g.xy),b._sphericalPolynomial=g}function G(b,o,l,g,I){const v=a(b.getEngine().createRawCubeTexture(null,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression),o).then((()=>b));return b.onRebuildCallback=b=>({proxy:v,isReady:!0,isAsync:!0}),b._source=13,b._bufferViewArrayArray=o,b._lodGenerationScale=g,b._lodGenerationOffset=I,b._sphericalPolynomial=l,a(b,o).then((()=>(b.isReady=!0,b)))}},11015:(b,o,l)=>{l.d(o,{d:()=>v});var g=l(1593),I=l(1580);class v{static ExpandRGBDTexture(b){const o=b._texture;if(!o||!b.isRGBD)return;const I=o.getEngine(),v=I.getCaps(),W=o.isReady;let n=!1;v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering?(n=!0,o.type=2):v.textureFloatRender&&v.textureFloatLinearFiltering&&(n=!0,o.type=1),n&&(o.isReady=!1,o._isRGBD=!1,o.invertY=!1);const T=async()=>{const v=I.isWebGPU,W=v?1:0;o.isReady=!1,v?await Promise.all([l.e(17).then(l.bind(l,13312)),l.e(18).then(l.bind(l,13322))]):await Promise.all([l.e(24).then(l.bind(l,13318)),l.e(25).then(l.bind(l,13329))]);const n=new g.e("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,o.type,void 0,null,!1,void 0,W);n.externalTextureSamplerBinding=!0;const T=I.createRenderTargetTexture(o.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:o.samplingMode,type:o.type,format:5});n.onEffectCreatedObservable.addOnce((l=>{l.executeWhenCompiled((()=>{n.onApply=b=>{b._bindTexture("textureSampler",o),b.setFloat2("scale",1,1)},b.va().postProcessManager.directRender([n],T,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(o),n&&n.dispose(),T._swapAndDie(o),o.isReady=!0}))}))};n&&(W?T():b.onLoadObservable.addOnce(T))}static EncodeTextureToRGBD(b,o){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,I.e)("rgbdEncode",b,o,l,1,5)}}}}]);