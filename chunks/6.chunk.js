"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10116:(V,H,t)=>{var I=t(1452),Z=t(966);Z.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(Z.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=I.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},10119:(V,H,t)=>{t.r(H),t.d(H,{Dispose:()=>J,DumpData:()=>a,DumpDataAsync:()=>d,DumpFramebuffer:()=>E,DumpTools:()=>O});var I=t(1469),Z=t(1145),h=t(960),f=t(958);let m,K=null;async function E(V,H,t,I){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;const m=await t.readPixels(0,0,V,H);a(V,H,new Uint8Array(m.buffer),I,Z,h,!0,void 0,f)}function d(V,H,t){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Z=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7?arguments[7]:void 0;return new Promise((K=>{a(V,H,t,(V=>K(V)),I,Z,h,f,m)}))}function a(V,H,E,d){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8?arguments[8]:void 0;(async function(){return K||(K=new Promise(((V,H)=>{let Z,h=null;const K={Xe:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(t.bind(t,1370)).then((E=>{let{ThinEngine:d}=E;try{Z=new OffscreenCanvas(100,100),h=new d(Z,!1,K)}catch(O){Z=document.createElement("canvas"),h=new d(Z,!1,K)}f.e.Instances.pop(),f.e.OnEnginesDisposedObservable.add((V=>{h&&V!==h&&!h.u&&0===f.e.Instances.length&&J()})),h.getCaps().parallelShaderCompile=void 0;const a=new I.b(h);t.e(32).then(t.bind(t,10806)).then((t=>{let{passPixelShader:f}=t;if(!h)return void H("Engine is not defined");const K=new I.f({ob:h,name:f.name,fragmentShader:f.shader,samplerNames:["textureSampler"]});m={canvas:Z,ob:h,renderer:a,wrapper:K},V(m)}))})).catch(H)}))),await K})().then((t=>{if(t.ob.setSize(V,H,!0),E instanceof Float32Array){const V=new Uint8Array(E.length);let H=E.length;for(;H--;){const t=E[H];V[H]=Math.round(255*(0,h.b)(t))}E=V}const I=t.ob.createRawTexture(E,V,H,5,!1,!C,1);t.renderer.setViewport(),t.renderer.applyEffectWrapper(t.wrapper),t.wrapper.effect._bindTexture("textureSampler",I),t.renderer.draw(),S?Z.f.ToBlob(t.canvas,(V=>{const H=new FileReader;H.onload=V=>{const H=V.target.result;d&&d(H)},H.readAsArrayBuffer(V)}),a,v):Z.f.EncodeScreenshotCanvasData(t.canvas,d,a,O,v),I.dispose()}))}function J(){var V;m?(m.wrapper.dispose(),m.renderer.dispose(),m.ob.dispose()):null===(V=K)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.ob.dispose()}));K=null,m=null}const O={DumpData:a,DumpDataAsync:d,DumpFramebuffer:E,Dispose:J};Z.f.DumpData=a,Z.f.DumpDataAsync=d,Z.f.DumpFramebuffer=E},10106:(V,H,t)=>{t.d(H,{d:()=>C,f:()=>Q,i:()=>c,l:()=>o});var I=t(1145),Z=t(943),h=t(960),f=t(1430),m=t(1075),K=t(966),E=(t(1139),t(1466)),d=t(1023);t(10110),t(10116),t(10119);const a="image/png",J=2,O=[134,22,135,150,246,214,150,54];function C(V){const H=new DataView(V.buffer,V.byteOffset,V.byteLength);let t=0;for(let f=0;f<O.length;f++)if(H.getUint8(t++)!==O[f])return d.c.Error("Not a babylon environment map"),null;let I="",Z=0;for(;Z=H.getUint8(t++);)I+=String.fromCharCode(Z);let h=JSON.parse(I);return h=S(h),h.Ae&&(h.Ae.specularDataPosition=t,h.Ae.lodGenerationScale=h.Ae.lodGenerationScale||.8),h}function S(V){if(V.version>J)throw new Error(`Unsupported babylon environment map version "${V.version}". Latest supported version is "${J}".`);return 2===V.version?V:V={...V,version:2,imageType:a}}function v(V,H){const t=(H=S(H)).Ae;let I=Math.log2(H.width);if(I=Math.round(I)+1,t.mipmaps.length!==6*I)throw new Error(`Unsupported specular mipmaps number "${t.mipmaps.length}"`);const Z=new Array(I);for(let h=0;h<I;h++){Z[h]=new Array(6);for(let H=0;H<6;H++){const I=t.mipmaps[6*h+H];Z[h][H]=new Uint8Array(V.buffer,V.byteOffset+t.specularDataPosition+I.position,I.length)}}return Z}function Q(V,H,t){const I=(t=S(t)).Ae;if(!I)return Promise.resolve();V._lodGenerationScale=I.lodGenerationScale;return W(V,v(H,t),t.imageType)}function e(V,H,t,I,Z,h,f,m,K,E,d){return new Promise(((a,J)=>{if(t){const t=H.createTexture(null,!0,!0,null,1,null,(V=>{J(V)}),V);null===I||void 0===I||I.onEffectCreatedObservable.addOnce((m=>{m.executeWhenCompiled((()=>{I.externalTextureSamplerBinding=!0,I.onApply=I=>{I._bindTexture("textureSampler",t),I.setFloat2("scale",1,H._features.needsInvertingBitmap&&V instanceof ImageBitmap?-1:1)},H.scenes.length&&(H.scenes[0].postProcessManager.directRender([I],E,!0,h,f),H.restoreDefaultFramebuffer(),t.dispose(),URL.revokeObjectURL(Z),a())}))}))}else{if(H._uploadImageToTexture(d,V,h,f),m){const t=K[f];t&&H._uploadImageToTexture(t._texture,V,h,0)}a()}}))}async function W(V,H){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;if(!I.f.IsExponentOfTwo(V.width))throw new Error("Texture size must be a power of two");const f=(0,h.k)(V.width)+1,d=V.getEngine();let J=!1,O=!1,C=null,S=null,v=null;const Q=d.getCaps();V.format=5,V.type=0,V.generateMipMaps=!0,V._cachedAnisotropicFilteringLevel=null,d.updateTextureSamplingMode(3,V),Q.textureLOD?d._features.supportRenderAndCopyToLodForFloatTextures?Q.textureHalfFloatRender&&Q.textureHalfFloatLinearFiltering?(J=!0,V.type=2):Q.textureFloatRender&&Q.textureFloatLinearFiltering&&(J=!0,V.type=1):J=!1:(J=!1,O=!0,v={});let W=0;if(J)d.isWebGPU?(W=1,await t.e(17).then(t.bind(t,12430))):await t.e(24).then(t.bind(t,12434)),C=new E.d("rgbdDecode","rgbdDecode",null,null,1,null,3,d,!1,void 0,V.type,void 0,null,!1,void 0,W),V._isRGBD=!1,V.invertY=!1,S=d.createRenderTargetCubeTexture(V.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:V.type,format:5});else if(V._isRGBD=!0,V.invertY=!0,O){const H=3,t=V._lodGenerationScale,I=V._lodGenerationOffset;for(let Z=0;Z<H;Z++){const h=(f-1)*t+I,E=I+(h-I)*(1-Z/(H-1)),a=Math.round(Math.min(Math.max(E,0),h)),J=new m.e(d,2);J.isCube=!0,J.invertY=!0,J.generateMipMaps=!1,d.updateTextureSamplingMode(2,J);const O=new K.b(null);switch(O._isCube=!0,O._texture=J,v[a]=O,Z){case 0:V._lodTextureLow=O;break;case 1:V._lodTextureMid=O;break;case 2:V._lodTextureHigh=O}}}const c=[];for(let t=0;t<H.length;t++)for(let I=0;I<6;I++){const h=H[t][I],f=new Blob([h],{type:Z}),m=URL.createObjectURL(f);let K;if(d._features.forceBitmapOverHTMLImageElement)K=d.createImageBitmap(f,{premultiplyAlpha:"none"}).then((H=>e(H,d,J,C,m,I,t,O,v,S,V)));else{const H=new Image;H.src=m,K=new Promise(((Z,h)=>{H.onload=()=>{e(H,d,J,C,m,I,t,O,v,S,V).then((()=>Z())).catch((V=>{h(V)}))},H.onerror=V=>{h(V)}}))}c.push(K)}if(H.length<f){let t;const I=Math.pow(2,f-1-H.length),Z=I*I*4;switch(V.type){case 0:t=new Uint8Array(Z);break;case 2:t=new Uint16Array(Z);break;case 1:t=new Float32Array(Z)}for(let h=H.length;h<f;h++)for(let H=0;H<6;H++)d._uploadArrayBufferViewToTexture(V,t,H,h)}return Promise.all(c).then((()=>{S&&(d._releaseTexture(V),S._swapAndDie(V)),C&&C.dispose(),O&&(V._lodTextureHigh&&V._lodTextureHigh._texture&&(V._lodTextureHigh._texture.isReady=!0),V._lodTextureMid&&V._lodTextureMid._texture&&(V._lodTextureMid._texture.isReady=!0),V._lodTextureLow&&V._lodTextureLow._texture&&(V._lodTextureLow._texture.isReady=!0))}))}function c(V,H){const t=(H=S(H)).irradiance;if(!t)return;const I=new f.f;Z.o.FromArrayToRef(t.x,0,I.x),Z.o.FromArrayToRef(t.y,0,I.y),Z.o.FromArrayToRef(t.z,0,I.z),Z.o.FromArrayToRef(t.xx,0,I.xx),Z.o.FromArrayToRef(t.yy,0,I.yy),Z.o.FromArrayToRef(t.zz,0,I.zz),Z.o.FromArrayToRef(t.yz,0,I.yz),Z.o.FromArrayToRef(t.zx,0,I.zx),Z.o.FromArrayToRef(t.xy,0,I.xy),V._sphericalPolynomial=I}function o(V,H,t,I,Z){const h=W(V.getEngine().createRawCubeTexture(null,V.width,V.format,V.type,V.generateMipMaps,V.invertY,V.samplingMode,V._compression),H).then((()=>V));return V.onRebuildCallback=V=>({proxy:h,isReady:!0,isAsync:!0}),V._source=13,V._bufferViewArrayArray=H,V._lodGenerationScale=I,V._lodGenerationOffset=Z,V._sphericalPolynomial=t,W(V,H).then((()=>(V.isReady=!0,V)))}},10110:(V,H,t)=>{t.d(H,{c:()=>h});var I=t(1466),Z=t(1455);class h{static ExpandRGBDTexture(V){const H=V._texture;if(!H||!V.isRGBD)return;const Z=H.getEngine(),h=Z.getCaps(),f=H.isReady;let m=!1;h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(m=!0,H.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(m=!0,H.type=1),m&&(H.isReady=!1,H._isRGBD=!1,H.invertY=!1);const K=async()=>{const h=Z.isWebGPU,f=h?1:0;H.isReady=!1,h?await Promise.all([t.e(17).then(t.bind(t,12430)),t.e(18).then(t.bind(t,12441))]):await Promise.all([t.e(24).then(t.bind(t,12434)),t.e(25).then(t.bind(t,12450))]);const m=new I.d("rgbdDecode","rgbdDecode",null,null,1,null,3,Z,!1,void 0,H.type,void 0,null,!1,void 0,f);m.externalTextureSamplerBinding=!0;const K=Z.createRenderTargetTexture(H.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:H.samplingMode,type:H.type,format:5});m.onEffectCreatedObservable.addOnce((t=>{t.executeWhenCompiled((()=>{m.onApply=V=>{V._bindTexture("textureSampler",H),V.setFloat2("scale",1,1)},V.va().postProcessManager.directRender([m],K,!0),Z.restoreDefaultFramebuffer(),Z._releaseTexture(H),m&&m.dispose(),K._swapAndDie(H),H.isReady=!0}))}))};m&&(f?K():V.onLoadObservable.addOnce(K))}static EncodeTextureToRGBD(V,H){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,Z.e)("rgbdEncode",V,H,t,1,5)}}}}]);