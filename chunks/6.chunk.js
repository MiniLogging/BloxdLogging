"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10263:(N,Z,d)=>{var X=d(1409),I=d(1002);I.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(I.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=X.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((N=>{this._texture._sphericalPolynomial=N,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(N){this._texture&&(this._texture._sphericalPolynomial=N)},enumerable:!0,configurable:!0})},10267:(N,Z,d)=>{d.r(Z),d.d(Z,{Dispose:()=>D,DumpData:()=>B,DumpDataAsync:()=>j,DumpFramebuffer:()=>e,DumpTools:()=>v});var X=d(1432),I=d(1133),m=d(994),z=d(986);let w,S=null;async function e(N,Z,d,X){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;const w=await d.readPixels(0,0,N,Z);B(N,Z,new Uint8Array(w.buffer),X,I,m,!0,void 0,z)}function j(N,Z,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return new Promise((S=>{B(N,Z,d,(N=>S(N)),X,I,m,z,w)}))}function B(N,Z,e,j){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return S||(S=new Promise(((N,Z)=>{let I,m=null;const S={Ne:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(d.bind(d,1324)).then((e=>{let{ThinEngine:j}=e;try{I=new OffscreenCanvas(100,100),m=new j(I,!1,S)}catch(v){I=document.createElement("canvas"),m=new j(I,!1,S)}z.e.Instances.pop(),z.e.OnEnginesDisposedObservable.add((N=>{m&&N!==m&&!m.u&&0===z.e.Instances.length&&D()})),m.getCaps().parallelShaderCompile=void 0;const B=new X.e(m);d.e(32).then(d.bind(d,10947)).then((d=>{let{passPixelShader:z}=d;if(!m)return void Z("Engine is not defined");const S=new X.i({kb:m,name:z.name,fragmentShader:z.shader,samplerNames:["textureSampler"]});w={canvas:I,kb:m,renderer:B,wrapper:S},N(w)}))})).catch(Z)}))),await S})().then((d=>{if(d.kb.setSize(N,Z,!0),e instanceof Float32Array){const N=new Uint8Array(e.length);let Z=e.length;for(;Z--;){const d=e[Z];N[Z]=Math.round(255*(0,m.e)(d))}e=N}const X=d.kb.createRawTexture(e,N,Z,5,!1,!T,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",X),d.renderer.draw(),k?I.g.ToBlob(d.canvas,(N=>{const Z=new FileReader;Z.onload=N=>{const Z=N.target.result;j&&j(Z)},Z.readAsArrayBuffer(N)}),B,h):I.g.EncodeScreenshotCanvasData(d.canvas,j,B,v,h),X.dispose()}))}function D(){var N;w?(w.wrapper.dispose(),w.renderer.dispose(),w.kb.dispose()):null===(N=S)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.kb.dispose()}));S=null,w=null}const v={DumpData:B,DumpDataAsync:j,DumpFramebuffer:e,Dispose:D};I.g.DumpData=B,I.g.DumpDataAsync=j,I.g.DumpFramebuffer=e},10248:(N,Z,d)=>{d.d(Z,{c:()=>T,d:()=>U,e:()=>Q,f:()=>A});var X=d(1133),I=d(960),m=d(994),z=d(1378),w=d(1080),S=d(1002),e=(d(1131),d(1428)),j=d(1051);d(10256),d(10263),d(10267);const B="image/png",D=2,v=[134,22,135,150,246,214,150,54];function T(N){const Z=new DataView(N.buffer,N.byteOffset,N.byteLength);let d=0;for(let z=0;z<v.length;z++)if(Z.getUint8(d++)!==v[z])return j.e.Error("Not a babylon environment map"),null;let X="",I=0;for(;I=Z.getUint8(d++);)X+=String.fromCharCode(I);let m=JSON.parse(X);return m=k(m),m.te&&(m.te.specularDataPosition=d,m.te.lodGenerationScale=m.te.lodGenerationScale||.8),m}function k(N){if(N.version>D)throw new Error(`Unsupported babylon environment map version "${N.version}". Latest supported version is "${D}".`);return 2===N.version?N:N={...N,version:2,imageType:B}}function h(N,Z){const d=(Z=k(Z)).te;let X=Math.log2(Z.width);if(X=Math.round(X)+1,d.mipmaps.length!==6*X)throw new Error(`Unsupported specular mipmaps number "${d.mipmaps.length}"`);const I=new Array(X);for(let m=0;m<X;m++){I[m]=new Array(6);for(let Z=0;Z<6;Z++){const X=d.mipmaps[6*m+Z];I[m][Z]=new Uint8Array(N.buffer,N.byteOffset+d.specularDataPosition+X.position,X.length)}}return I}function U(N,Z,d){const X=(d=k(d)).te;if(!X)return Promise.resolve();N._lodGenerationScale=X.lodGenerationScale;return M(N,h(Z,d),d.imageType)}function C(N,Z,d,X,I,m,z,w,S,e,j){return new Promise(((B,D)=>{if(d){const d=Z.createTexture(null,!0,!0,null,1,null,(N=>{D(N)}),N);null===X||void 0===X||X.onEffectCreatedObservable.addOnce((w=>{w.executeWhenCompiled((()=>{X.externalTextureSamplerBinding=!0,X.onApply=X=>{X._bindTexture("textureSampler",d),X.setFloat2("scale",1,Z._features.needsInvertingBitmap&&N instanceof ImageBitmap?-1:1)},Z.scenes.length&&(Z.scenes[0].postProcessManager.directRender([X],e,!0,m,z),Z.restoreDefaultFramebuffer(),d.dispose(),URL.revokeObjectURL(I),B())}))}))}else{if(Z._uploadImageToTexture(j,N,m,z),w){const d=S[z];d&&Z._uploadImageToTexture(d._texture,N,m,0)}B()}}))}async function M(N,Z){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B;if(!X.g.IsExponentOfTwo(N.width))throw new Error("Texture size must be a power of two");const z=(0,m.k)(N.width)+1,j=N.getEngine();let D=!1,v=!1,T=null,k=null,h=null;const U=j.getCaps();N.format=5,N.type=0,N.generateMipMaps=!0,N._cachedAnisotropicFilteringLevel=null,j.updateTextureSamplingMode(3,N),U.textureLOD?j._features.supportRenderAndCopyToLodForFloatTextures?U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering?(D=!0,N.type=2):U.textureFloatRender&&U.textureFloatLinearFiltering&&(D=!0,N.type=1):D=!1:(D=!1,v=!0,h={});let M=0;if(D)j.isWebGPU?(M=1,await d.e(17).then(d.bind(d,12301))):await d.e(24).then(d.bind(d,12309)),T=new e.e("rgbdDecode","rgbdDecode",null,null,1,null,3,j,!1,void 0,N.type,void 0,null,!1,void 0,M),N._isRGBD=!1,N.invertY=!1,k=j.createRenderTargetCubeTexture(N.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:N.type,format:5});else if(N._isRGBD=!0,N.invertY=!0,v){const Z=3,d=N._lodGenerationScale,X=N._lodGenerationOffset;for(let I=0;I<Z;I++){const m=(z-1)*d+X,e=X+(m-X)*(1-I/(Z-1)),B=Math.round(Math.min(Math.max(e,0),m)),D=new w.d(j,2);D.isCube=!0,D.invertY=!0,D.generateMipMaps=!1,j.updateTextureSamplingMode(2,D);const v=new S.b(null);switch(v._isCube=!0,v._texture=D,h[B]=v,I){case 0:N._lodTextureLow=v;break;case 1:N._lodTextureMid=v;break;case 2:N._lodTextureHigh=v}}}const Q=[];for(let d=0;d<Z.length;d++)for(let X=0;X<6;X++){const m=Z[d][X],z=new Blob([m],{type:I}),w=URL.createObjectURL(z);let S;if(j._features.forceBitmapOverHTMLImageElement)S=j.createImageBitmap(z,{premultiplyAlpha:"none"}).then((Z=>C(Z,j,D,T,w,X,d,v,h,k,N)));else{const Z=new Image;Z.src=w,S=new Promise(((I,m)=>{Z.onload=()=>{C(Z,j,D,T,w,X,d,v,h,k,N).then((()=>I())).catch((N=>{m(N)}))},Z.onerror=N=>{m(N)}}))}Q.push(S)}if(Z.length<z){let d;const X=Math.pow(2,z-1-Z.length),I=X*X*4;switch(N.type){case 0:d=new Uint8Array(I);break;case 2:d=new Uint16Array(I);break;case 1:d=new Float32Array(I)}for(let m=Z.length;m<z;m++)for(let Z=0;Z<6;Z++)j._uploadArrayBufferViewToTexture(N,d,Z,m)}return Promise.all(Q).then((()=>{k&&(j._releaseTexture(N),k._swapAndDie(N)),T&&T.dispose(),v&&(N._lodTextureHigh&&N._lodTextureHigh._texture&&(N._lodTextureHigh._texture.isReady=!0),N._lodTextureMid&&N._lodTextureMid._texture&&(N._lodTextureMid._texture.isReady=!0),N._lodTextureLow&&N._lodTextureLow._texture&&(N._lodTextureLow._texture.isReady=!0))}))}function Q(N,Z){const d=(Z=k(Z)).irradiance;if(!d)return;const X=new z.e;I.n.FromArrayToRef(d.x,0,X.x),I.n.FromArrayToRef(d.y,0,X.y),I.n.FromArrayToRef(d.z,0,X.z),I.n.FromArrayToRef(d.xx,0,X.xx),I.n.FromArrayToRef(d.yy,0,X.yy),I.n.FromArrayToRef(d.zz,0,X.zz),I.n.FromArrayToRef(d.yz,0,X.yz),I.n.FromArrayToRef(d.zx,0,X.zx),I.n.FromArrayToRef(d.xy,0,X.xy),N._sphericalPolynomial=X}function A(N,Z,d,X,I){const m=M(N.getEngine().createRawCubeTexture(null,N.width,N.format,N.type,N.generateMipMaps,N.invertY,N.samplingMode,N._compression),Z).then((()=>N));return N.onRebuildCallback=N=>({proxy:m,isReady:!0,isAsync:!0}),N._source=13,N._bufferViewArrayArray=Z,N._lodGenerationScale=X,N._lodGenerationOffset=I,N._sphericalPolynomial=d,M(N,Z).then((()=>(N.isReady=!0,N)))}},10256:(N,Z,d)=>{d.d(Z,{b:()=>m});var X=d(1428),I=d(1414);class m{static ExpandRGBDTexture(N){const Z=N._texture;if(!Z||!N.isRGBD)return;const I=Z.getEngine(),m=I.getCaps(),z=Z.isReady;let w=!1;m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering?(w=!0,Z.type=2):m.textureFloatRender&&m.textureFloatLinearFiltering&&(w=!0,Z.type=1),w&&(Z.isReady=!1,Z._isRGBD=!1,Z.invertY=!1);const S=async()=>{const m=I.isWebGPU,z=m?1:0;Z.isReady=!1,m?await Promise.all([d.e(17).then(d.bind(d,12301)),d.e(18).then(d.bind(d,12318))]):await Promise.all([d.e(24).then(d.bind(d,12309)),d.e(25).then(d.bind(d,12324))]);const w=new X.e("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,Z.type,void 0,null,!1,void 0,z);w.externalTextureSamplerBinding=!0;const S=I.createRenderTargetTexture(Z.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Z.samplingMode,type:Z.type,format:5});w.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled((()=>{w.onApply=N=>{N._bindTexture("textureSampler",Z),N.setFloat2("scale",1,1)},N.va().postProcessManager.directRender([w],S,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(Z),w&&w.dispose(),S._swapAndDie(Z),Z.isReady=!0}))}))};w&&(z?S():N.onLoadObservable.addOnce(S))}static EncodeTextureToRGBD(N,Z){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,I.c)("rgbdEncode",N,Z,d,1,5)}}}}]);