"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10626:(p,O,E)=>{var e=E(1487),x=E(1029);x.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(x.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=e.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((p=>{this._texture._sphericalPolynomial=p,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(p){this._texture&&(this._texture._sphericalPolynomial=p)},enumerable:!0,configurable:!0})},10629:(p,O,E)=>{E.r(O),E.d(O,{Dispose:()=>Z,DumpData:()=>D,DumpDataAsync:()=>s,DumpFramebuffer:()=>B,DumpTools:()=>m});var e=E(1500),x=E(1177),F=E(1027),q=E(1025);let a,Y=null;async function B(p,O,E,e){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const a=await E.readPixels(0,0,p,O);D(p,O,new Uint8Array(a.buffer),e,x,F,!0,void 0,q)}function s(p,O,E){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return new Promise((Y=>{D(p,O,E,(p=>Y(p)),e,x,F,q,a)}))}function D(p,O,B,s){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8?arguments[8]:void 0;(async function(){return Y||(Y=new Promise(((p,O)=>{let x,F=null;const Y={uf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(E.bind(E,1402)).then((B=>{let{ThinEngine:s}=B;try{x=new OffscreenCanvas(100,100),F=new s(x,!1,Y)}catch(m){x=document.createElement("canvas"),F=new s(x,!1,Y)}q.c.Instances.pop(),q.c.OnEnginesDisposedObservable.add((p=>{F&&p!==F&&!F.u&&0===q.c.Instances.length&&Z()})),F.getCaps().parallelShaderCompile=void 0;const D=new e.d(F);E.e(32).then(E.bind(E,11263)).then((E=>{let{passPixelShader:q}=E;if(!F)return void O("Engine is not defined");const Y=new e.e({Ob:F,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});a={canvas:x,Ob:F,renderer:D,wrapper:Y},p(a)}))})).catch(O)}))),await Y})().then((E=>{if(E.Ob.setSize(p,O,!0),B instanceof Float32Array){const p=new Uint8Array(B.length);let O=B.length;for(;O--;){const E=B[O];p[O]=Math.round(255*(0,F.b)(E))}B=p}const e=E.Ob.createRawTexture(B,p,O,5,!1,!h,1);E.renderer.setViewport(),E.renderer.applyEffectWrapper(E.wrapper),E.wrapper.effect._bindTexture("textureSampler",e),E.renderer.draw(),T?x.d.ToBlob(E.canvas,(p=>{const O=new FileReader;O.onload=p=>{const O=p.target.result;s&&s(O)},O.readAsArrayBuffer(p)}),D,A):x.d.EncodeScreenshotCanvasData(E.canvas,s,D,m,A),e.dispose()}))}function Z(){var p;a?(a.wrapper.dispose(),a.renderer.dispose(),a.Ob.dispose()):null===(p=Y)||void 0===p||p.then((p=>{p.wrapper.dispose(),p.renderer.dispose(),p.Ob.dispose()}));Y=null,a=null}const m={DumpData:D,DumpDataAsync:s,DumpFramebuffer:B,Dispose:Z};x.d.DumpData=D,x.d.DumpDataAsync=s,x.d.DumpFramebuffer=B},10616:(p,O,E)=>{E.d(O,{b:()=>h,f:()=>H,h:()=>Q,k:()=>W});var e=E(1177),x=E(995),F=E(1027),q=E(1457),a=E(1104),Y=E(1029),B=(E(1168),E(1498)),s=E(1065);E(10620),E(10626),E(10629);const D="image/png",Z=2,m=[134,22,135,150,246,214,150,54];function h(p){const O=new DataView(p.buffer,p.byteOffset,p.byteLength);let E=0;for(let q=0;q<m.length;q++)if(O.getUint8(E++)!==m[q])return s.b.Error("Not a babylon environment map"),null;let e="",x=0;for(;x=O.getUint8(E++);)e+=String.fromCharCode(x);let F=JSON.parse(e);return F=T(F),F.Ze&&(F.Ze.specularDataPosition=E,F.Ze.lodGenerationScale=F.Ze.lodGenerationScale||.8),F}function T(p){if(p.version>Z)throw new Error(`Unsupported babylon environment map version "${p.version}". Latest supported version is "${Z}".`);return 2===p.version?p:p={...p,version:2,imageType:D}}function A(p,O){const E=(O=T(O)).Ze;let e=Math.log2(O.width);if(e=Math.round(e)+1,E.mipmaps.length!==6*e)throw new Error(`Unsupported specular mipmaps number "${E.mipmaps.length}"`);const x=new Array(e);for(let F=0;F<e;F++){x[F]=new Array(6);for(let O=0;O<6;O++){const e=E.mipmaps[6*F+O];x[F][O]=new Uint8Array(p.buffer,p.byteOffset+E.specularDataPosition+e.position,e.length)}}return x}function H(p,O,E){const e=(E=T(E)).Ze;if(!e)return Promise.resolve();p._lodGenerationScale=e.lodGenerationScale;return r(p,A(O,E),E.imageType)}function t(p,O,E,e,x,F,q,a,Y,B,s){return new Promise(((D,Z)=>{if(E){const E=O.createTexture(null,!0,!0,null,1,null,(p=>{Z(p)}),p);null===e||void 0===e||e.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{e.externalTextureSamplerBinding=!0,e.onApply=e=>{e._bindTexture("textureSampler",E),e.setFloat2("scale",1,O._features.needsInvertingBitmap&&p instanceof ImageBitmap?-1:1)},O.scenes.length&&(O.scenes[0].postProcessManager.directRender([e],B,!0,F,q),O.restoreDefaultFramebuffer(),E.dispose(),URL.revokeObjectURL(x),D())}))}))}else{if(O._uploadImageToTexture(s,p,F,q),a){const E=Y[q];E&&O._uploadImageToTexture(E._texture,p,F,0)}D()}}))}async function r(p,O){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D;if(!e.d.IsExponentOfTwo(p.width))throw new Error("Texture size must be a power of two");const q=(0,F.g)(p.width)+1,s=p.getEngine();let Z=!1,m=!1,h=null,T=null,A=null;const H=s.getCaps();p.format=5,p.type=0,p.generateMipMaps=!0,p._cachedAnisotropicFilteringLevel=null,s.updateTextureSamplingMode(3,p),H.textureLOD?s._features.supportRenderAndCopyToLodForFloatTextures?H.textureHalfFloatRender&&H.textureHalfFloatLinearFiltering?(Z=!0,p.type=2):H.textureFloatRender&&H.textureFloatLinearFiltering&&(Z=!0,p.type=1):Z=!1:(Z=!1,m=!0,A={});let r=0;if(Z)s.isWebGPU?(r=1,await E.e(17).then(E.bind(E,12832))):await E.e(24).then(E.bind(E,12834)),h=new B.c("rgbdDecode","rgbdDecode",null,null,1,null,3,s,!1,void 0,p.type,void 0,null,!1,void 0,r),p._isRGBD=!1,p.invertY=!1,T=s.createRenderTargetCubeTexture(p.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:p.type,format:5});else if(p._isRGBD=!0,p.invertY=!0,m){const O=3,E=p._lodGenerationScale,e=p._lodGenerationOffset;for(let x=0;x<O;x++){const F=(q-1)*E+e,B=e+(F-e)*(1-x/(O-1)),D=Math.round(Math.min(Math.max(B,0),F)),Z=new a.d(s,2);Z.isCube=!0,Z.invertY=!0,Z.generateMipMaps=!1,s.updateTextureSamplingMode(2,Z);const m=new Y.d(null);switch(m._isCube=!0,m._texture=Z,A[D]=m,x){case 0:p._lodTextureLow=m;break;case 1:p._lodTextureMid=m;break;case 2:p._lodTextureHigh=m}}}const Q=[];for(let E=0;E<O.length;E++)for(let e=0;e<6;e++){const F=O[E][e],q=new Blob([F],{type:x}),a=URL.createObjectURL(q);let Y;if(s._features.forceBitmapOverHTMLImageElement)Y=s.createImageBitmap(q,{premultiplyAlpha:"none"}).then((O=>t(O,s,Z,h,a,e,E,m,A,T,p)));else{const O=new Image;O.src=a,Y=new Promise(((x,F)=>{O.onload=()=>{t(O,s,Z,h,a,e,E,m,A,T,p).then((()=>x())).catch((p=>{F(p)}))},O.onerror=p=>{F(p)}}))}Q.push(Y)}if(O.length<q){let E;const e=Math.pow(2,q-1-O.length),x=e*e*4;switch(p.type){case 0:E=new Uint8Array(x);break;case 2:E=new Uint16Array(x);break;case 1:E=new Float32Array(x)}for(let F=O.length;F<q;F++)for(let O=0;O<6;O++)s._uploadArrayBufferViewToTexture(p,E,O,F)}return Promise.all(Q).then((()=>{T&&(s._releaseTexture(p),T._swapAndDie(p)),h&&h.dispose(),m&&(p._lodTextureHigh&&p._lodTextureHigh._texture&&(p._lodTextureHigh._texture.isReady=!0),p._lodTextureMid&&p._lodTextureMid._texture&&(p._lodTextureMid._texture.isReady=!0),p._lodTextureLow&&p._lodTextureLow._texture&&(p._lodTextureLow._texture.isReady=!0))}))}function Q(p,O){const E=(O=T(O)).irradiance;if(!E)return;const e=new q.i;x.n.FromArrayToRef(E.x,0,e.x),x.n.FromArrayToRef(E.y,0,e.y),x.n.FromArrayToRef(E.z,0,e.z),x.n.FromArrayToRef(E.xx,0,e.xx),x.n.FromArrayToRef(E.yy,0,e.yy),x.n.FromArrayToRef(E.zz,0,e.zz),x.n.FromArrayToRef(E.yz,0,e.yz),x.n.FromArrayToRef(E.zx,0,e.zx),x.n.FromArrayToRef(E.xy,0,e.xy),p._sphericalPolynomial=e}function W(p,O,E,e,x){const F=r(p.getEngine().createRawCubeTexture(null,p.width,p.format,p.type,p.generateMipMaps,p.invertY,p.samplingMode,p._compression),O).then((()=>p));return p.onRebuildCallback=p=>({proxy:F,isReady:!0,isAsync:!0}),p._source=13,p._bufferViewArrayArray=O,p._lodGenerationScale=e,p._lodGenerationOffset=x,p._sphericalPolynomial=E,r(p,O).then((()=>(p.isReady=!0,p)))}},10620:(p,O,E)=>{E.d(O,{b:()=>F});var e=E(1498),x=E(1491);class F{static ExpandRGBDTexture(p){const O=p._texture;if(!O||!p.isRGBD)return;const x=O.getEngine(),F=x.getCaps(),q=O.isReady;let a=!1;F.textureHalfFloatRender&&F.textureHalfFloatLinearFiltering?(a=!0,O.type=2):F.textureFloatRender&&F.textureFloatLinearFiltering&&(a=!0,O.type=1),a&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const Y=async()=>{const F=x.isWebGPU,q=F?1:0;O.isReady=!1,F?await Promise.all([E.e(17).then(E.bind(E,12832)),E.e(18).then(E.bind(E,12841))]):await Promise.all([E.e(24).then(E.bind(E,12834)),E.e(25).then(E.bind(E,12844))]);const a=new e.c("rgbdDecode","rgbdDecode",null,null,1,null,3,x,!1,void 0,O.type,void 0,null,!1,void 0,q);a.externalTextureSamplerBinding=!0;const Y=x.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});a.onEffectCreatedObservable.addOnce((E=>{E.executeWhenCompiled((()=>{a.onApply=p=>{p._bindTexture("textureSampler",O),p.setFloat2("scale",1,1)},p.va().postProcessManager.directRender([a],Y,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(O),a&&a.dispose(),Y._swapAndDie(O),O.isReady=!0}))}))};a&&(q?Y():p.onLoadObservable.addOnce(Y))}static EncodeTextureToRGBD(p,O){let E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,x.e)("rgbdEncode",p,O,E,1,5)}}}}]);