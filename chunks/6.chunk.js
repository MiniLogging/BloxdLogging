"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[6,7],{10202:(b,G,i)=>{var g=i(1541),c=i(1050);c.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(c.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=g.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((b=>{this._texture._sphericalPolynomial=b,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(b){this._texture&&(this._texture._sphericalPolynomial=b)},enumerable:!0,configurable:!0})},10211:(b,G,i)=>{i.r(G),i.d(G,{Dispose:()=>o,DumpData:()=>q,DumpDataAsync:()=>J,DumpFramebuffer:()=>Y,DumpTools:()=>s});var g=i(1563),c=i(1224),V=i(1045),z=i(1036);let E,Z=null;async function Y(b,G,i,g){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",V=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;const E=await i.readPixels(0,0,b,G);q(b,G,new Uint8Array(E.buffer),g,c,V,!0,void 0,z)}function J(b,G,i){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;return new Promise((Z=>{q(b,G,i,(b=>Z(b)),g,c,V,z,E)}))}function q(b,G,Y,J){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",s=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8?arguments[8]:void 0;(async function(){return Z||(Z=new Promise(((b,G)=>{let c,V=null;const Z={je:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,1448)).then((Y=>{let{ThinEngine:J}=Y;try{c=new OffscreenCanvas(100,100),V=new J(c,!1,Z)}catch(s){c=document.createElement("canvas"),V=new J(c,!1,Z)}z.c.Instances.pop(),z.c.OnEnginesDisposedObservable.add((b=>{V&&b!==V&&!V.u&&0===z.c.Instances.length&&o()})),V.getCaps().parallelShaderCompile=void 0;const q=new g.c(V);i.e(32).then(i.bind(i,10915)).then((i=>{let{passPixelShader:z}=i;if(!V)return void G("Engine is not defined");const Z=new g.e({zd:V,name:z.name,fragmentShader:z.shader,samplerNames:["textureSampler"]});E={canvas:c,zd:V,renderer:q,wrapper:Z},b(E)}))})).catch(G)}))),await Z})().then((i=>{if(i.zd.setSize(b,G,!0),Y instanceof Float32Array){const b=new Uint8Array(Y.length);let G=Y.length;for(;G--;){const i=Y[G];b[G]=Math.round(255*(0,V.e)(i))}Y=b}const g=i.zd.createRawTexture(Y,b,G,5,!1,!F,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",g),i.renderer.draw(),l?c.g.ToBlob(i.canvas,(b=>{const G=new FileReader;G.onload=b=>{const G=b.target.result;J&&J(G)},G.readAsArrayBuffer(b)}),q,v):c.g.EncodeScreenshotCanvasData(i.canvas,J,q,s,v),g.dispose()}))}function o(){var b;E?(E.wrapper.dispose(),E.renderer.dispose(),E.zd.dispose()):null===(b=Z)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.zd.dispose()}));Z=null,E=null}const s={DumpData:q,DumpDataAsync:J,DumpFramebuffer:Y,Dispose:o};c.g.DumpData=q,c.g.DumpDataAsync=J,c.g.DumpFramebuffer=Y},10190:(b,G,i)=>{i.d(G,{b:()=>F,e:()=>u,f:()=>M,i:()=>A});var g=i(1224),c=i(1014),V=i(1045),z=i(1499),E=i(1155),Z=i(1050),Y=(i(1219),i(1556)),J=i(1112);i(10194),i(10202),i(10211);const q="image/png",o=2,s=[134,22,135,150,246,214,150,54];function F(b){const G=new DataView(b.buffer,b.byteOffset,b.byteLength);let i=0;for(let z=0;z<s.length;z++)if(G.getUint8(i++)!==s[z])return J.b.Error("Not a babylon environment map"),null;let g="",c=0;for(;c=G.getUint8(i++);)g+=String.fromCharCode(c);let V=JSON.parse(g);return V=l(V),V.Fe&&(V.Fe.specularDataPosition=i,V.Fe.lodGenerationScale=V.Fe.lodGenerationScale||.8),V}function l(b){if(b.version>o)throw new Error(`Unsupported babylon environment map version "${b.version}". Latest supported version is "${o}".`);return 2===b.version?b:b={...b,version:2,imageType:q}}function v(b,G){const i=(G=l(G)).Fe;let g=Math.log2(G.width);if(g=Math.round(g)+1,i.mipmaps.length!==6*g)throw new Error(`Unsupported specular mipmaps number "${i.mipmaps.length}"`);const c=new Array(g);for(let V=0;V<g;V++){c[V]=new Array(6);for(let G=0;G<6;G++){const g=i.mipmaps[6*V+G];c[V][G]=new Uint8Array(b.buffer,b.byteOffset+i.specularDataPosition+g.position,g.length)}}return c}function u(b,G,i){const g=(i=l(i)).Fe;if(!g)return Promise.resolve();b._lodGenerationScale=g.lodGenerationScale;return x(b,v(G,i),i.imageType)}function W(b,G,i,g,c,V,z,E,Z,Y,J){return new Promise(((q,o)=>{if(i){const i=G.createTexture(null,!0,!0,null,1,null,(b=>{o(b)}),b);null===g||void 0===g||g.onEffectCreatedObservable.addOnce((E=>{E.executeWhenCompiled((()=>{g.externalTextureSamplerBinding=!0,g.onApply=g=>{g._bindTexture("textureSampler",i),g.setFloat2("scale",1,G._features.needsInvertingBitmap&&b instanceof ImageBitmap?-1:1)},G.scenes.length&&(G.scenes[0].postProcessManager.directRender([g],Y,!0,V,z),G.restoreDefaultFramebuffer(),i.dispose(),URL.revokeObjectURL(c),q())}))}))}else{if(G._uploadImageToTexture(J,b,V,z),E){const i=Z[z];i&&G._uploadImageToTexture(i._texture,b,V,0)}q()}}))}async function x(b,G){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q;if(!g.g.IsExponentOfTwo(b.width))throw new Error("Texture size must be a power of two");const z=(0,V.n)(b.width)+1,J=b.getEngine();let o=!1,s=!1,F=null,l=null,v=null;const u=J.getCaps();b.format=5,b.type=0,b.generateMipMaps=!0,b._cachedAnisotropicFilteringLevel=null,J.updateTextureSamplingMode(3,b),u.textureLOD?J._features.supportRenderAndCopyToLodForFloatTextures?u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(o=!0,b.type=2):u.textureFloatRender&&u.textureFloatLinearFiltering&&(o=!0,b.type=1):o=!1:(o=!1,s=!0,v={});let x=0;if(o)J.isWebGPU?(x=1,await i.e(17).then(i.bind(i,12535))):await i.e(24).then(i.bind(i,12542)),F=new Y.b("rgbdDecode","rgbdDecode",null,null,1,null,3,J,!1,void 0,b.type,void 0,null,!1,void 0,x),b._isRGBD=!1,b.invertY=!1,l=J.createRenderTargetCubeTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:b.type,format:5});else if(b._isRGBD=!0,b.invertY=!0,s){const G=3,i=b._lodGenerationScale,g=b._lodGenerationOffset;for(let c=0;c<G;c++){const V=(z-1)*i+g,Y=g+(V-g)*(1-c/(G-1)),q=Math.round(Math.min(Math.max(Y,0),V)),o=new E.d(J,2);o.isCube=!0,o.invertY=!0,o.generateMipMaps=!1,J.updateTextureSamplingMode(2,o);const s=new Z.b(null);switch(s._isCube=!0,s._texture=o,v[q]=s,c){case 0:b._lodTextureLow=s;break;case 1:b._lodTextureMid=s;break;case 2:b._lodTextureHigh=s}}}const M=[];for(let i=0;i<G.length;i++)for(let g=0;g<6;g++){const V=G[i][g],z=new Blob([V],{type:c}),E=URL.createObjectURL(z);let Z;if(J._features.forceBitmapOverHTMLImageElement)Z=J.createImageBitmap(z,{premultiplyAlpha:"none"}).then((G=>W(G,J,o,F,E,g,i,s,v,l,b)));else{const G=new Image;G.src=E,Z=new Promise(((c,V)=>{G.onload=()=>{W(G,J,o,F,E,g,i,s,v,l,b).then((()=>c())).catch((b=>{V(b)}))},G.onerror=b=>{V(b)}}))}M.push(Z)}if(G.length<z){let i;const g=Math.pow(2,z-1-G.length),c=g*g*4;switch(b.type){case 0:i=new Uint8Array(c);break;case 2:i=new Uint16Array(c);break;case 1:i=new Float32Array(c)}for(let V=G.length;V<z;V++)for(let G=0;G<6;G++)J._uploadArrayBufferViewToTexture(b,i,G,V)}return Promise.all(M).then((()=>{l&&(J._releaseTexture(b),l._swapAndDie(b)),F&&F.dispose(),s&&(b._lodTextureHigh&&b._lodTextureHigh._texture&&(b._lodTextureHigh._texture.isReady=!0),b._lodTextureMid&&b._lodTextureMid._texture&&(b._lodTextureMid._texture.isReady=!0),b._lodTextureLow&&b._lodTextureLow._texture&&(b._lodTextureLow._texture.isReady=!0))}))}function M(b,G){const i=(G=l(G)).irradiance;if(!i)return;const g=new z.i;c.l.FromArrayToRef(i.x,0,g.x),c.l.FromArrayToRef(i.y,0,g.y),c.l.FromArrayToRef(i.z,0,g.z),c.l.FromArrayToRef(i.xx,0,g.xx),c.l.FromArrayToRef(i.yy,0,g.yy),c.l.FromArrayToRef(i.zz,0,g.zz),c.l.FromArrayToRef(i.yz,0,g.yz),c.l.FromArrayToRef(i.zx,0,g.zx),c.l.FromArrayToRef(i.xy,0,g.xy),b._sphericalPolynomial=g}function A(b,G,i,g,c){const V=x(b.getEngine().createRawCubeTexture(null,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression),G).then((()=>b));return b.onRebuildCallback=b=>({proxy:V,isReady:!0,isAsync:!0}),b._source=13,b._bufferViewArrayArray=G,b._lodGenerationScale=g,b._lodGenerationOffset=c,b._sphericalPolynomial=i,x(b,G).then((()=>(b.isReady=!0,b)))}},10194:(b,G,i)=>{i.d(G,{c:()=>V});var g=i(1556),c=i(1545);class V{static ExpandRGBDTexture(b){const G=b._texture;if(!G||!b.isRGBD)return;const c=G.getEngine(),V=c.getCaps(),z=G.isReady;let E=!1;V.textureHalfFloatRender&&V.textureHalfFloatLinearFiltering?(E=!0,G.type=2):V.textureFloatRender&&V.textureFloatLinearFiltering&&(E=!0,G.type=1),E&&(G.isReady=!1,G._isRGBD=!1,G.invertY=!1);const Z=async()=>{const V=c.isWebGPU,z=V?1:0;G.isReady=!1,V?await Promise.all([i.e(17).then(i.bind(i,12535)),i.e(18).then(i.bind(i,12548))]):await Promise.all([i.e(24).then(i.bind(i,12542)),i.e(25).then(i.bind(i,12551))]);const E=new g.b("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,G.type,void 0,null,!1,void 0,z);E.externalTextureSamplerBinding=!0;const Z=c.createRenderTargetTexture(G.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:G.samplingMode,type:G.type,format:5});E.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{E.onApply=b=>{b._bindTexture("textureSampler",G),b.setFloat2("scale",1,1)},b.va().postProcessManager.directRender([E],Z,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(G),E&&E.dispose(),Z._swapAndDie(G),G.isReady=!0}))}))};E&&(z?Z():b.onLoadObservable.addOnce(Z))}static EncodeTextureToRGBD(b,G){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,c.e)("rgbdEncode",b,G,i,1,5)}}}}]);