"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[31],{13651:(w,p,e)=>{e.r(p),e.d(p,{_HDRTextureLoader:()=>X});var r=e(11023);class I{static ConvertPanoramaToCubemap(w,p,e,r){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!w)throw"ConvertPanoramaToCubemap: input cannot be null";if(w.length!=p*e*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(r,this.FACE_FRONT,w,p,e,I),back:this.CreateCubemapTexture(r,this.FACE_BACK,w,p,e,I),left:this.CreateCubemapTexture(r,this.FACE_LEFT,w,p,e,I),right:this.CreateCubemapTexture(r,this.FACE_RIGHT,w,p,e,I),up:this.CreateCubemapTexture(r,this.FACE_UP,w,p,e,I),down:this.CreateCubemapTexture(r,this.FACE_DOWN,w,p,e,I),size:r,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(w,p,e,r,I){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=new ArrayBuffer(w*w*4*3),q=new Float32Array(f),E=d?Math.max(1,Math.round(r/4/w)):1,j=1/E,X=j*j,k=p[1].Je(p[0]).scale(j/w),m=p[3].Je(p[2]).scale(j/w),J=1/w;let K=0;for(let y=0;y<w;y++)for(let d=0;d<E;d++){let d=p[0],f=p[2];for(let p=0;p<w;p++)for(let j=0;j<E;j++){const E=f.Je(d).scale(K).add(d);E.normalize();const j=this.CalcProjectionSpherical(E,e,r,I);q[y*w*3+3*p+0]+=j.r*X,q[y*w*3+3*p+1]+=j.g*X,q[y*w*3+3*p+2]+=j.b*X,d=d.add(k),f=f.add(m)}K+=J*j}return q}static CalcProjectionSpherical(w,p,e,r){let I=Math.atan2(w.z,w.x);const d=Math.acos(w.y);for(;I<-Math.PI;)I+=2*Math.PI;for(;I>Math.PI;)I-=2*Math.PI;let f=I/Math.PI;const q=d/Math.PI;f=.5*f+.5;let E=Math.round(f*e);E<0?E=0:E>=e&&(E=e-1);let j=Math.round(q*r);j<0?j=0:j>=r&&(j=r-1);const X=r-j-1;return{r:p[X*e*3+3*E+0],g:p[X*e*3+3*E+1],b:p[X*e*3+3*E+2]}}}function d(w,p,e,r,I,d){I>0?(I=function(w,p){return p>1023?w*Math.pow(2,1023)*Math.pow(2,p-1023):p<-1074?w*Math.pow(2,-1074)*Math.pow(2,p+1074):w*Math.pow(2,p)}(1,I-136),w[d+0]=p*I,w[d+1]=e*I,w[d+2]=r*I):(w[d+0]=0,w[d+1]=0,w[d+2]=0)}function f(w,p){let e="",r="";for(let I=p;I<w.length-p&&(r=String.fromCharCode(w[I]),"\n"!=r);I++)e+=r;return e}function q(w){let p=0,e=0,r=f(w,0);if("#"!=r[0]||"?"!=r[1])throw"Bad HDR Format.";let I=!1,d=!1,q=0;do{q+=r.length+1,r=f(w,q),"FORMAT=32-bit_rle_rgbe"==r?d=!0:0==r.length&&(I=!0)}while(!I);if(!d)throw"HDR Bad header format, unsupported FORMAT";q+=r.length+1,r=f(w,q);const E=/^-Y (.*) \+X (.*)$/g.exec(r);if(!E||E.length<3)throw"HDR Bad header format, no size";if(e=parseInt(E[2]),p=parseInt(E[1]),e<8||e>32767)throw"HDR Bad header format, unsupported size";return q+=r.length+1,{height:p,width:e,dataPosition:q}}function E(w,p){return function(w,p){let e=p.height;const r=p.width;let I,f,q,E,X,k=p.dataPosition,m=0,J=0,K=0;const y=new ArrayBuffer(4*r),c=new Uint8Array(y),s=new ArrayBuffer(p.width*p.height*4*3),O=new Float32Array(s);for(;e>0;){if(I=w[k++],f=w[k++],q=w[k++],E=w[k++],2!=I||2!=f||128&q||p.width<8||p.width>32767)return j(w,p);if((q<<8|E)!=r)throw"HDR Bad header format, wrong scan line width";for(m=0,K=0;K<4;K++)for(J=(K+1)*r;m<J;)if(I=w[k++],f=w[k++],I>128){if(X=I-128,0==X||X>J-m)throw"HDR Bad Format, bad scanline data (run)";for(;X-- >0;)c[m++]=f}else{if(X=I,0==X||X>J-m)throw"HDR Bad Format, bad scanline data (non-run)";if(c[m++]=f,--X>0)for(let p=0;p<X;p++)c[m++]=w[k++]}for(K=0;K<r;K++)I=c[K],f=c[K+r],q=c[K+2*r],E=c[K+3*r],d(O,I,f,q,E,(p.height-e)*r*3+3*K);e--}return O}(w,p)}function j(w,p){let e=p.height;const r=p.width;let I,f,q,E,j,X=p.dataPosition;const k=new ArrayBuffer(p.width*p.height*4*3),m=new Float32Array(k);for(;e>0;){for(j=0;j<p.width;j++)I=w[X++],f=w[X++],q=w[X++],E=w[X++],d(m,I,f,q,E,(p.height-e)*r*3+3*j);e--}return m}I.FACE_LEFT=[new r.k(-1,-1,-1),new r.k(1,-1,-1),new r.k(-1,1,-1),new r.k(1,1,-1)],I.FACE_RIGHT=[new r.k(1,-1,1),new r.k(-1,-1,1),new r.k(1,1,1),new r.k(-1,1,1)],I.FACE_FRONT=[new r.k(1,-1,-1),new r.k(1,-1,1),new r.k(1,1,-1),new r.k(1,1,1)],I.FACE_BACK=[new r.k(-1,-1,1),new r.k(-1,-1,-1),new r.k(-1,1,1),new r.k(-1,1,-1)],I.FACE_DOWN=[new r.k(1,1,-1),new r.k(1,1,1),new r.k(-1,1,-1),new r.k(-1,1,1)],I.FACE_UP=[new r.k(-1,-1,-1),new r.k(-1,-1,1),new r.k(1,-1,-1),new r.k(1,-1,1)];class X{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(w,p,e){const r=new Uint8Array(w.buffer,w.byteOffset,w.byteLength),I=q(r),d=E(r,I),f=I.width*I.height,j=new Float32Array(4*f);for(let q=0;q<f;q+=1)j[4*q]=d[3*q],j[4*q+1]=d[3*q+1],j[4*q+2]=d[3*q+2],j[4*q+3]=1;e(I.width,I.height,p.generateMipMaps,!1,(()=>{const w=p.getEngine();p.type=1,p.format=5,p._gammaSpace=!1,w._uploadDataToTextureDirectly(p,j)}))}}}}]);