"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[31],{13348:(h,d,m)=>{m.r(d),m.d(d,{_HDRTextureLoader:()=>M});var j=m(11058);class A{static ConvertPanoramaToCubemap(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!h)throw"ConvertPanoramaToCubemap: input cannot be null";if(h.length!=d*m*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(j,this.FACE_FRONT,h,d,m,A),back:this.CreateCubemapTexture(j,this.FACE_BACK,h,d,m,A),left:this.CreateCubemapTexture(j,this.FACE_LEFT,h,d,m,A),right:this.CreateCubemapTexture(j,this.FACE_RIGHT,h,d,m,A),up:this.CreateCubemapTexture(j,this.FACE_UP,h,d,m,A),down:this.CreateCubemapTexture(j,this.FACE_DOWN,h,d,m,A),size:j,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=new ArrayBuffer(h*h*4*3),a=new Float32Array(w),D=b?Math.max(1,Math.round(j/4/h)):1,S=1/D,M=S*S,q=d[1].fm(d[0]).scale(S/h),E=d[3].fm(d[2]).scale(S/h),I=1/h;let R=0;for(let Z=0;Z<h;Z++)for(let b=0;b<D;b++){let b=d[0],w=d[2];for(let d=0;d<h;d++)for(let S=0;S<D;S++){const D=w.fm(b).scale(R).add(b);D.normalize();const S=this.CalcProjectionSpherical(D,m,j,A);a[Z*h*3+3*d+0]+=S.r*M,a[Z*h*3+3*d+1]+=S.g*M,a[Z*h*3+3*d+2]+=S.b*M,b=b.add(q),w=w.add(E)}R+=I*S}return a}static CalcProjectionSpherical(h,d,m,j){let A=Math.atan2(h.z,h.x);const b=Math.acos(h.y);for(;A<-Math.PI;)A+=2*Math.PI;for(;A>Math.PI;)A-=2*Math.PI;let w=A/Math.PI;const a=b/Math.PI;w=.5*w+.5;let D=Math.round(w*m);D<0?D=0:D>=m&&(D=m-1);let S=Math.round(a*j);S<0?S=0:S>=j&&(S=j-1);const M=j-S-1;return{r:d[M*m*3+3*D+0],g:d[M*m*3+3*D+1],b:d[M*m*3+3*D+2]}}}function b(h,d,m,j,A,b){A>0?(A=function(h,d){return d>1023?h*Math.pow(2,1023)*Math.pow(2,d-1023):d<-1074?h*Math.pow(2,-1074)*Math.pow(2,d+1074):h*Math.pow(2,d)}(1,A-136),h[b+0]=d*A,h[b+1]=m*A,h[b+2]=j*A):(h[b+0]=0,h[b+1]=0,h[b+2]=0)}function w(h,d){let m="",j="";for(let A=d;A<h.length-d&&(j=String.fromCharCode(h[A]),"\n"!=j);A++)m+=j;return m}function a(h){let d=0,m=0,j=w(h,0);if("#"!=j[0]||"?"!=j[1])throw"Bad HDR Format.";let A=!1,b=!1,a=0;do{a+=j.length+1,j=w(h,a),"FORMAT=32-bit_rle_rgbe"==j?b=!0:0==j.length&&(A=!0)}while(!A);if(!b)throw"HDR Bad header format, unsupported FORMAT";a+=j.length+1,j=w(h,a);const D=/^-Y (.*) \+X (.*)$/g.exec(j);if(!D||D.length<3)throw"HDR Bad header format, no size";if(m=parseInt(D[2]),d=parseInt(D[1]),m<8||m>32767)throw"HDR Bad header format, unsupported size";return a+=j.length+1,{height:d,width:m,dataPosition:a}}function D(h,d){return function(h,d){let m=d.height;const j=d.width;let A,w,a,D,M,q=d.dataPosition,E=0,I=0,R=0;const Z=new ArrayBuffer(4*j),L=new Uint8Array(Z),B=new ArrayBuffer(d.width*d.height*4*3),V=new Float32Array(B);for(;m>0;){if(A=h[q++],w=h[q++],a=h[q++],D=h[q++],2!=A||2!=w||128&a||d.width<8||d.width>32767)return S(h,d);if((a<<8|D)!=j)throw"HDR Bad header format, wrong scan line width";for(E=0,R=0;R<4;R++)for(I=(R+1)*j;E<I;)if(A=h[q++],w=h[q++],A>128){if(M=A-128,0==M||M>I-E)throw"HDR Bad Format, bad scanline data (run)";for(;M-- >0;)L[E++]=w}else{if(M=A,0==M||M>I-E)throw"HDR Bad Format, bad scanline data (non-run)";if(L[E++]=w,--M>0)for(let d=0;d<M;d++)L[E++]=h[q++]}for(R=0;R<j;R++)A=L[R],w=L[R+j],a=L[R+2*j],D=L[R+3*j],b(V,A,w,a,D,(d.height-m)*j*3+3*R);m--}return V}(h,d)}function S(h,d){let m=d.height;const j=d.width;let A,w,a,D,S,M=d.dataPosition;const q=new ArrayBuffer(d.width*d.height*4*3),E=new Float32Array(q);for(;m>0;){for(S=0;S<d.width;S++)A=h[M++],w=h[M++],a=h[M++],D=h[M++],b(E,A,w,a,D,(d.height-m)*j*3+3*S);m--}return E}A.FACE_LEFT=[new j.i(-1,-1,-1),new j.i(1,-1,-1),new j.i(-1,1,-1),new j.i(1,1,-1)],A.FACE_RIGHT=[new j.i(1,-1,1),new j.i(-1,-1,1),new j.i(1,1,1),new j.i(-1,1,1)],A.FACE_FRONT=[new j.i(1,-1,-1),new j.i(1,-1,1),new j.i(1,1,-1),new j.i(1,1,1)],A.FACE_BACK=[new j.i(-1,-1,1),new j.i(-1,-1,-1),new j.i(-1,1,1),new j.i(-1,1,-1)],A.FACE_DOWN=[new j.i(1,1,-1),new j.i(1,1,1),new j.i(-1,1,-1),new j.i(-1,1,1)],A.FACE_UP=[new j.i(-1,-1,-1),new j.i(-1,-1,1),new j.i(1,-1,-1),new j.i(1,-1,1)];class M{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(h,d,m){const j=new Uint8Array(h.buffer,h.byteOffset,h.byteLength),A=a(j),b=D(j,A),w=A.width*A.height,S=new Float32Array(4*w);for(let a=0;a<w;a+=1)S[4*a]=b[3*a],S[4*a+1]=b[3*a+1],S[4*a+2]=b[3*a+2],S[4*a+3]=1;m(A.width,A.height,d.generateMipMaps,!1,(()=>{const h=d.getEngine();d.type=1,d.format=5,d._gammaSpace=!1,h._uploadDataToTextureDirectly(d,S)}))}}}}]);