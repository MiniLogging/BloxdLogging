"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[48],{13366:(B,o,e)=>{e.r(o),e.d(o,{AnimationGroup:()=>R,TargetedAnimation:()=>W});var k=e(12329),d=e(497),f=e(539),J=e(650),Z=e(12325),t=e(690);class h{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(B,o,e,d){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=o,this._target=B,this._scene=e,this._host=d,this._activeTargets=[],o._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===k.e.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=t.d.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const B={frame:0,value:this._minValue};this._keys.splice(0,0,B)}if(this._target instanceof Array){let B=0;for(const o of this._target)this._preparePath(o,B),this._getOriginalValues(B),B++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const f=o.getEvents();f&&f.length>0&&f.forEach((B=>{this._events.push(B._clone())})),this._enableBlending=B&&B.animationPropertiesOverride?B.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this._animation.targetPropertyPath;if(e.length>1){let k=B;for(let B=0;B<e.length-1;B++){const o=e[B];if(k=k[o],void 0===k)throw new Error(`Invalid property (${o}) in property path (${e.join(".")})`)}this._targetPath=e[e.length-1],this._activeTargets[o]=k}else this._targetPath=e[0],this._activeTargets[o]=B;if(void 0===this._activeTargets[o][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${e.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let B=0;for(const o of this._target)void 0!==this._originalValue[B]&&this._setValue(o,this._activeTargets[B],this._originalValue[B],-1,B),B++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let B=0;B<this._events.length;B++)this._events[B].isDone=!1}isStopped(){return this._stopped}dispose(){const B=this._animation.runtimeAnimations.indexOf(this);B>-1&&this._animation.runtimeAnimations.splice(B,1)}setValue(B,o){if(this._targetIsArray)for(let e=0;e<this._target.length;e++){const k=this._target[e];this._setValue(k,this._activeTargets[e],B,o,e)}else this._setValue(this._target,this._directTarget,B,o,0)}_getOriginalValues(){let B,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=this._activeTargets[o];B=e.getLocalMatrix&&"_matrix"===this._targetPath?e.getLocalMatrix():e[this._targetPath],B&&B.clone?this._originalValue[o]=B.clone():this._originalValue[o]=B}_registerTargetForLateAnimationBinding(B,o){const e=B.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(e),e._lateAnimationHolders||(e._lateAnimationHolders={}),e._lateAnimationHolders[B.targetPath]||(e._lateAnimationHolders[B.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:o}),B.isAdditive?(e._lateAnimationHolders[B.targetPath].additiveAnimations.push(B),e._lateAnimationHolders[B.targetPath].totalAdditiveWeight+=B.weight):(e._lateAnimationHolders[B.targetPath].animations.push(B),e._lateAnimationHolders[B.targetPath].totalWeight+=B.weight)}_setValue(B,o,e,d,f){if(this._currentActiveTarget=o,this._weight=d,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const B=o[this._targetPath];B.clone?this._originalBlendValue=B.clone():this._originalBlendValue=B}this._originalBlendValue.m?k.e.AllowMatrixDecomposeForInterpolation?this._currentValue?t.d.DecomposeLerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=t.d.DecomposeLerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue?t.d.LerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=t.d.Lerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue=k.e._UniversalLerp(this._originalBlendValue,e,this._blendingFactor);const d=B&&B.animationPropertiesOverride?B.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=d}else this._currentValue?this._currentValue.p?this._currentValue.p(e):this._currentValue=e:null!==e&&void 0!==e&&e.clone?this._currentValue=e.clone():this._currentValue=e;-1!==d?this._registerTargetForLateAnimationBinding(this,this._originalValue[f]):this._animationState.loopMode===k.e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[f],o[this._targetPath]):o[this._targetPath]=this._originalValue[f]+this._currentValue:o[this._targetPath]=this._currentValue,B.Ji&&B.Ji(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const e=this._animation.getKeys();B<e[0].frame?B=e[0].frame:B>e[e.length-1].frame&&(B=e[e.length-1].frame);const k=this._events;if(k.length)for(let f=0;f<k.length;f++)k[f].onlyOnce||(k[f].isDone=k[f].frame<B);this._currentFrame=B;const d=this._animation._interpolate(B,this._animationState);this.setValue(d,o)}_prepareForSpeedRatioChange(B){const o=this._previousElapsedTime*(this._animation.framePerSecond*B)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-o}animate(B,o,e,d,f){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const Z=this._animation,t=Z.targetPropertyPath;if(!t||t.length<1)return this._stopped=!0,!1;let h=!0;(o<this._minFrame||o>this._maxFrame)&&(o=this._minFrame),(e<this._minFrame||e>this._maxFrame)&&(e=this._maxFrame);const O=e-o;let K,w=B*(Z.framePerSecond*f)/1e3+this._absoluteFrameOffset,u=0,L=!1;const H=d&&this._animationState.loopMode===k.e.ANIMATIONLOOPMODE_YOYO;if(H){const B=(w-o)/O,e=Math.sin(B*Math.PI);w=Math.abs(e)*O+o;const k=e>=0?1:-1;this._yoyoDirection!==k&&(L=!0),this._yoyoDirection=k}if(this._previousElapsedTime=B,this._previousAbsoluteFrame=w,!d&&e>=o&&(w>=O&&f>0||w<=0&&f<0))h=!1,u=Z._getKeyValue(this._maxValue);else if(!d&&o>=e&&(w<=O&&f<0||w>=0&&f>0))h=!1,u=Z._getKeyValue(this._minValue);else if(this._animationState.loopMode!==k.e.ANIMATIONLOOPMODE_CYCLE){const B=e.toString()+o.toString();if(!this._offsetsCache[B]){this._animationState.repeatCount=0,this._animationState.loopMode=k.e.ANIMATIONLOOPMODE_CYCLE;const d=Z._interpolate(o,this._animationState),f=Z._interpolate(e,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),Z.dataType){case k.e.ANIMATIONTYPE_FLOAT:this._offsetsCache[B]=f-d;break;case k.e.ANIMATIONTYPE_QUATERNION:case k.e.ANIMATIONTYPE_VECTOR3:case k.e.ANIMATIONTYPE_VECTOR2:case k.e.ANIMATIONTYPE_SIZE:case k.e.ANIMATIONTYPE_COLOR3:this._offsetsCache[B]=f.Ag(d)}this._highLimitsCache[B]=f}u=this._highLimitsCache[B],K=this._offsetsCache[B]}if(void 0===K)switch(Z.dataType){case k.e.ANIMATIONTYPE_FLOAT:K=0;break;case k.e.ANIMATIONTYPE_QUATERNION:K=k.l;break;case k.e.ANIMATIONTYPE_VECTOR3:K=k.t;break;case k.e.ANIMATIONTYPE_VECTOR2:K=k.q;break;case k.e.ANIMATIONTYPE_SIZE:K=k.n;break;case k.e.ANIMATIONTYPE_COLOR3:K=k.f;break;case k.e.ANIMATIONTYPE_COLOR4:K=k.h}let n;if(this._host&&this._host.syncRoot){const B=this._host.syncRoot;n=o+O*((B.masterFrame-B.fromFrame)/(B.toFrame-B.fromFrame))}else n=w>0&&o>e||w<0&&o<e?h&&0!==O?e+w%O:o:h&&0!==O?o+w%O:e;const W=this._events;if(!H&&(f>0&&this.currentFrame>n||f<0&&this.currentFrame<n)||H&&L){this._onLoop();for(let B=0;B<W.length;B++)W[B].onlyOnce||(W[B].isDone=!1);this._animationState.key=f>0?0:Z.getKeys().length-1}this._currentFrame=n,this._animationState.repeatCount=0===O?0:w/O|0,this._animationState.highLimitValue=u,this._animationState.offsetValue=K;const R=Z._interpolate(n,this._animationState);if(this.setValue(R,J),W.length)for(let k=0;k<W.length;k++)if(O>=0&&n>=W[k].frame&&W[k].frame>=o||O<0&&n<=W[k].frame&&W[k].frame<=o){const B=W[k];B.isDone||(B.onlyOnce&&(W.splice(k,1),k--),B.isDone=!0,B.action(n))}return h||(this._stopped=!0),h}}var O=e(522);class K{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(B){this._weight=-1!==B?Math.min(Math.max(B,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(B){for(let o=0;o<this._runtimeAnimations.length;o++){this._runtimeAnimations[o]._prepareForSpeedRatioChange(B)}this._speedRatio=B,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,Z=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0,O=arguments.length>9&&void 0!==arguments[9]&&arguments[9],K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=o,this.fromFrame=e,this.toFrame=k,this.loopAnimation=f,this.onAnimationEnd=Z,this.onAnimationLoop=h,this.isAdditive=O,this.playOrder=K,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.Hk=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new d.e,this.onAnimationLoopObservable=new d.e,this._scene=B,t&&this.appendAnimations(o,t),this._speedRatio=J,B._activeAnimatables.push(this)}syncWith(B){if(this._syncRoot=B,B){const B=this._scene._activeAnimatables.indexOf(this);B>-1&&(this._scene._activeAnimatables.splice(B,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(B,o){for(let e=0;e<o.length;e++){const k=o[e],d=new h(B,k,this._scene,this);d._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(d)}}getAnimationByTargetProperty(B){const o=this._runtimeAnimations;for(let e=0;e<o.length;e++)if(o[e].animation.targetProperty===B)return o[e].animation;return null}getRuntimeAnimationByTargetProperty(B){const o=this._runtimeAnimations;for(let e=0;e<o.length;e++)if(o[e].animation.targetProperty===B)return o[e];return null}reset(){const B=this._runtimeAnimations;for(let o=0;o<B.length;o++)B[o].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(B){const o=this._runtimeAnimations;for(let e=0;e<o.length;e++)o[e].animation.enableBlending=!0,o[e].animation.blendingSpeed=B}disableBlending(){const B=this._runtimeAnimations;for(let o=0;o<B.length;o++)B[o].animation.enableBlending=!1}goToFrame(B){const o=this._runtimeAnimations;if(o[0]){const e=o[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??o[0].currentFrame;const k=0===this.speedRatio?0:(B-this._frameToSyncFromJump)/e*1e3/this.speedRatio;this._manualJumpDelay=-k}for(let e=0;e<o.length;e++)o[e].goToFrame(B,this._weight);this._goToFrame=B}get paused(){return this.Hk}pause(){this.Hk||(this.Hk=!0)}restart(){this.Hk=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(B,o){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B||o){const d=this._scene._activeAnimatables.indexOf(this);if(d>-1){const f=this._runtimeAnimations;for(let e=f.length-1;e>=0;e--){const k=f[e];B&&k.animation.name!=B||(o&&!o(k.target)||(k.dispose(),f.splice(e,1)))}0==f.length&&(e||this._scene._activeAnimatables.splice(d,1),k||this._raiseOnAnimationEnd())}}else{const B=this._scene._activeAnimatables.indexOf(this);if(B>-1){e||this._scene._activeAnimatables.splice(B,1);const o=this._runtimeAnimations;for(let B=0;B<o.length;B++)o[B].dispose();this._runtimeAnimations.length=0,k||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise((B=>{this.onAnimationEndObservable.add((()=>{B(this)}),void 0,void 0,this,!0)}))}_animate(B){if(this.Hk)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=B),!0;if(null===this._localDelayOffset?(this._localDelayOffset=B,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=B-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let o=!1;const e=this._runtimeAnimations;let k;for(k=0;k<e.length;k++){const d=e[k].animate(B-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);o=o||d}if(this.animationStarted=o,!o){if(this.disposeOnEnd)for(k=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(k,1),k=0;k<e.length;k++)e[k].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return o}}function w(B){if(0===B.totalWeight&&0===B.totalAdditiveWeight)return B.originalValue;let o=1;const e=t.j.Ni[0],k=t.j.Ni[1],d=t.j.Quaternion[0];let f=0;const J=B.animations[0],Z=B.originalValue;let h=1,O=!1;if(B.totalWeight<1)h=1-B.totalWeight,Z.decompose(k,d,e);else{if(f=1,o=B.totalWeight,h=J.weight/o,1==h){if(!B.totalAdditiveWeight)return J.currentValue;O=!0}J.currentValue.decompose(k,d,e)}if(!O){k.scaleInPlace(h),e.scaleInPlace(h),d.scaleInPlace(h);for(let J=f;J<B.animations.length;J++){const f=B.animations[J];if(0===f.weight)continue;h=f.weight/o;const Z=t.j.Ni[2],O=t.j.Ni[3],K=t.j.Quaternion[1];f.currentValue.decompose(O,K,Z),O.scaleAndAddToRef(h,k),K.scaleAndAddToRef(t.f.Dot(d,K)>0?h:-h,d),Z.scaleAndAddToRef(h,e)}d.normalize()}for(let w=0;w<B.additiveAnimations.length;w++){const o=B.additiveAnimations[w];if(0===o.weight)continue;const f=t.j.Ni[2],J=t.j.Ni[3],Z=t.j.Quaternion[1];o.currentValue.decompose(J,Z,f),J.multiplyToRef(k,J),t.o.LerpToRef(k,J,o.weight,k),d.multiplyToRef(Z,Z),t.f.SlerpToRef(d,Z,o.weight,d),f.scaleAndAddToRef(o.weight,e)}const K=J?J._animationState.workValue:t.j.Matrix[0].clone();return t.d.ComposeToRef(k,d,e,K),K}function u(B,o){if(0===B.totalWeight&&0===B.totalAdditiveWeight)return o;const e=B.animations[0],k=B.originalValue;let d=o;if(0===B.totalWeight&&B.totalAdditiveWeight>0)d.p(k);else if(1===B.animations.length){if(t.f.SlerpToRef(k,e.currentValue,Math.min(1,B.totalWeight),d),0===B.totalAdditiveWeight)return d}else if(B.animations.length>1){let e,f,J=1;if(B.totalWeight<1){const o=1-B.totalWeight;e=[],f=[],e.push(k),f.push(o)}else{if(2===B.animations.length&&(t.f.SlerpToRef(B.animations[0].currentValue,B.animations[1].currentValue,B.animations[1].weight/B.totalWeight,o),0===B.totalAdditiveWeight))return o;e=[],f=[],J=B.totalWeight}for(let o=0;o<B.animations.length;o++){const k=B.animations[o];e.push(k.currentValue),f.push(k.weight/J)}let Z=0;for(let B=0;B<e.length;)B?(Z+=f[B],t.f.SlerpToRef(d,e[B],f[B]/Z,d),B++):(t.f.SlerpToRef(e[B],e[B+1],f[B+1]/(f[B]+f[B+1]),o),d=o,Z=f[B]+f[B+1],B+=2)}for(let f=0;f<B.additiveAnimations.length;f++){const o=B.additiveAnimations[f];0!==o.weight&&(d.multiplyToRef(o.currentValue,t.j.Quaternion[0]),t.f.SlerpToRef(d,t.j.Quaternion[0],o.weight,d))}return d}var L,H,n=e(2115);L=n.b,(H=Z.c)&&(H.prototype.copyAnimationRange=function(B,o,e){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new k.e(this.name,"_matrix",B.animations[0].framePerSecond,k.e.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const J=B.animations[0].getRange(o);if(!J)return!1;const Z=J.from,t=J.to,h=B.animations[0].getKeys(),O=B.length,K=B.getParent(),w=this.getParent(),u=d&&K&&O&&this.length&&O!==this.length,L=u&&w&&K?w.length/K.length:1,H=d&&!w&&f&&(1!==f.x||1!==f.y||1!==f.z),n=this.animations[0].getKeys();let W,R,I;for(let k=0,T=h.length;k<T;k++)W=h[k],W.frame>=Z&&W.frame<=t&&(d?(I=W.value.clone(),u?(R=I.getTranslation(),I.setTranslation(R.scaleInPlace(L))):H&&f?(R=I.getTranslation(),I.setTranslation(R.multiplyInPlace(f))):I=W.value):I=W.value,n.push({frame:W.frame+e,value:I}));return this.animations[0].createRange(o,Z+e,t+e),!0}),L&&(L.prototype._animate=function(B){if(!this.animationsEnabled)return;const o=O.e.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=o}this.deltaTime=void 0!==B?B:this.useConstantAnimationDeltaTime?16:(o-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=o;const e=this._activeAnimatables;if(0===e.length)return;this._animationTime+=this.deltaTime;const d=this._animationTime;for(let k=0;k<e.length;k++){const B=e[k];!B._animate(d)&&B.disposeOnEnd&&k--}!function(B){if(B._registeredForLateAnimationBindings.length){for(let o=0;o<B._registeredForLateAnimationBindings.length;o++){const e=B._registeredForLateAnimationBindings.data[o];for(const B in e._lateAnimationHolders){const o=e._lateAnimationHolders[B],d=o.animations[0],f=o.originalValue;if(void 0===f||null===f)continue;const J=k.e.AllowMatrixDecomposeForInterpolation&&f.m;let Z=e[B];if(J)Z=w(o);else if(void 0!==f.w)Z=u(o,Z||t.f.Identity());else{let B=0,e=1;const J=d&&d._animationState.loopMode===k.e.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(o.totalWeight<1)Z=J?f.clone?f.clone():f:d&&f.scale?f.scale(1-o.totalWeight):d?f*(1-o.totalWeight):f.clone?f.clone():f;else if(d){e=o.totalWeight;const k=d.weight/e;Z=1!==k?d.currentValue.scale?d.currentValue.scale(k):d.currentValue*k:d.currentValue,J&&(Z.addToRef?Z.addToRef(f,Z):Z+=f),B=1}for(let k=B;k<o.animations.length;k++){const B=o.animations[k],d=B.weight/e;d&&(B.currentValue.scaleAndAddToRef?B.currentValue.scaleAndAddToRef(d,Z):Z+=B.currentValue*d)}for(let k=0;k<o.additiveAnimations.length;k++){const B=o.additiveAnimations[k],e=B.weight;e&&(B.currentValue.scaleAndAddToRef?B.currentValue.scaleAndAddToRef(e,Z):Z+=B.currentValue*e)}}e[B]=Z}e._lateAnimationHolders={}}B._registeredForLateAnimationBindings.reset()}}(this)},L.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((B,o)=>B.playOrder-o.playOrder))},L.prototype.beginWeightedAnimation=function(B,o,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,J=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const K=this.beginAnimation(B,o,e,d,f,J,Z,!1,t,h,O);return K.weight=k,K},L.prototype.beginAnimation=function(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,f=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,Z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],t=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(d<0){const B=o;o=e,e=B,d=-d}o>e&&(d=-d),Z&&this.stopAnimation(B,void 0,t),J||(J=new K(this,B,o,e,k,d,f,void 0,h,O));const w=!t||t(B);if(B.animations&&w&&J.appendAnimations(B,B.animations),B.getAnimatables){const O=B.getAnimatables();for(let B=0;B<O.length;B++)this.beginAnimation(O[B],o,e,k,d,f,J,Z,t,h)}return J.reset(),J},L.prototype.beginHierarchyAnimation=function(B,o,e,k,d){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,J=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0,t=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=arguments.length>9?arguments[9]:void 0,O=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const K=B.getDescendants(o),w=[];w.push(this.beginAnimation(B,e,k,d,f,J,Z,t,h,void 0,O));for(const u of K)w.push(this.beginAnimation(u,e,k,d,f,J,Z,t,h,void 0,O));return w},L.prototype.beginDirectAnimation=function(B,o,e,k,d){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(f<0){const B=e;e=k,k=B,f=-f}return e>k&&(f=-f),new K(this,B,e,k,d,f,arguments.length>6?arguments[6]:void 0,o,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},L.prototype.beginDirectHierarchyAnimation=function(B,o,e,k,d,f,J,Z,t){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const O=B.getDescendants(o),K=[];K.push(this.beginDirectAnimation(B,e,k,d,f,J,Z,t,h));for(const w of O)K.push(this.beginDirectAnimation(w,e,k,d,f,J,Z,t,h));return K},L.prototype.getAnimatableByTarget=function(B){for(let o=0;o<this._activeAnimatables.length;o++)if(this._activeAnimatables[o].target===B)return this._activeAnimatables[o];return null},L.prototype.getAllAnimatablesByTarget=function(B){const o=[];for(let e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].target===B&&o.push(this._activeAnimatables[e]);return o},L.prototype.stopAnimation=function(B,o,e){const k=this.getAllAnimatablesByTarget(B);for(const d of k)d.stop(o,e)},L.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let B=0;B<this._activeAnimatables.length;B++)this._activeAnimatables[B].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const B of this.animationGroups)B.stop()});class W{getClassName(){return"TargetedAnimation"}serialize(){const B={};return B.animation=this.animation.serialize(),B.targetId=this.target.id,B}}class R{get mask(){return this._mask}set mask(B){this._mask!==B&&(this._mask=B,this.syncWithMask(!0))}syncWithMask(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||B){this._numActiveAnimatables=0;for(let B=0;B<this._animatables.length;++B){const o=this._animatables[B];!this.mask||this.mask.disabled||this.mask.retainsTarget(o.target.name)?(this._numActiveAnimatables++,o.paused&&o.restart()):o.paused||o.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let B=0;B<this._animatables.length;++B){const o=this._animatables[B];this.mask.retainsTarget(o.target.name)||(o.stop(),this._animatables.splice(B,1),--B)}for(let B=0;B<this._targetedAnimations.length;B++){const o=this._targetedAnimations[B];this.mask.retainsTarget(o.target.name)||(this._targetedAnimations.splice(B,1),--B)}}}get from(){return this._from}set from(B){if(this._from!==B){this._from=B;for(let B=0;B<this._animatables.length;B++){this._animatables[B].fromFrame=this._from}}}get to(){return this._to}set to(B){if(this._to!==B){this._to=B;for(let B=0;B<this._animatables.length;B++){this._animatables[B].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(B){if(this._speedRatio!==B){this._speedRatio=B;for(let B=0;B<this._animatables.length;B++){this._animatables[B].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(B){if(this._loopAnimation!==B){this._loopAnimation=B;for(let B=0;B<this._animatables.length;B++){this._animatables[B].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(B){if(this._isAdditive!==B){this._isAdditive=B;for(let B=0;B<this._animatables.length;B++){this._animatables[B].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(B){this._weight!==B&&(this._weight=B,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(B){if(this._playOrder!==B&&(this._playOrder=B,this._animatables.length>0)){for(let B=0;B<this._animatables.length;B++)this._animatables[B].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(B){if(this._enableBlending!==B&&(this._enableBlending=B,null!==B))for(let o=0;o<this._targetedAnimations.length;++o)this._targetedAnimations[o].animation.enableBlending=B}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(B){if(this._blendingSpeed!==B&&(this._blendingSpeed=B,null!==B))for(let o=0;o<this._targetedAnimations.length;++o)this._targetedAnimations[o].animation.blendingSpeed=B}getLength(B,o){B=B??this._from;return((o=o??this._to)-B)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(B){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3?arguments[3]:void 0;if(0===B.length)return null;k=k??B[0].weight;let d=Number.MAX_VALUE,f=-Number.MAX_VALUE;if(e)for(const Z of B)Z.from<d&&(d=Z.from),Z.to>f&&(f=Z.to);const J=new R(B[0].name+"_merged",B[0]._scene,k);for(const Z of B){e&&Z.normalize(d,f);for(const B of Z.targetedAnimations)J.addTargetedAnimation(B.animation,B.target);o&&Z.dispose()}return J}constructor(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=B,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new d.e,this.onAnimationLoopObservable=new d.e,this.onAnimationGroupLoopObservable=new d.e,this.onAnimationGroupEndObservable=new d.e,this.onAnimationGroupPauseObservable=new d.e,this.onAnimationGroupPlayObservable=new d.e,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=o||f.c.LastCreatedScene,this._weight=e,this._playOrder=k,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(B,o){const e=new W;e.animation=B,e.target=o;const k=B.getKeys();return this._from>k[0].frame&&(this._from=k[0].frame),this._to<k[k.length-1].frame&&(this._to=k[k.length-1].frame),null!==this._enableBlending&&(B.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(B.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(e),this._shouldStart=!0,e}removeTargetedAnimation(B){for(let o=this._targetedAnimations.length-1;o>-1;o--){this._targetedAnimations[o].animation===B&&this._targetedAnimations.splice(o,1)}}normalize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==B&&(B=this._from),null==o&&(o=this._to);for(let e=0;e<this._targetedAnimations.length;e++){const k=this._targetedAnimations[e].animation.getKeys(),d=k[0],f=k[k.length-1];if(d.frame>B){const o={frame:B,value:d.value,inTangent:d.inTangent,outTangent:d.outTangent,interpolation:d.interpolation};k.splice(0,0,o)}if(f.frame<o){const B={frame:o,value:f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation};k.push(B)}}return this._from=B,this._to=o,this}_processLoop(B,o,e){B.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(o),this._animationLoopFlags[e]||(this._animationLoopFlags[e]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=B,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let f=0;f<this._targetedAnimations.length;f++){const J=this._targetedAnimations[f],Z=this._scene.beginDirectAnimation(J.target,[J.animation],void 0!==e?e:this._from,void 0!==k?k:this._to,B,o,void 0,void 0,void 0!==d?d:this._isAdditive);Z.weight=this._weight,Z.playOrder=this._playOrder,Z.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(J),this._checkAnimationGroupEnded(Z)},this._processLoop(Z,J,f),this._animatables.push(Z)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=o,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let B=0;B<this._animatables.length;B++){this._animatables[B].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(B){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==B&&(this.loopAnimation=B),this.restart()):(this.stop(),this.start(B,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let B=0;B<this._animatables.length;B++){this._animatables[B].reset()}return this}restart(){if(!this._isStarted)return this;for(let B=0;B<this._animatables.length;B++){this._animatables[B].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const o=this._animatables.slice();for(let k=0;k<o.length;k++)o[k].stop(void 0,void 0,!0,B);let e=0;for(let k=0;k<this._scene._activeAnimatables.length;k++){const o=this._scene._activeAnimatables[k];o._runtimeAnimations.length>0?this._scene._activeAnimatables[e++]=o:B&&this._checkAnimationGroupEnded(o,B)}return this._scene._activeAnimatables.length=e,this._isStarted=!1,this}setWeightForAllAnimatables(B){for(let o=0;o<this._animatables.length;o++){this._animatables[o].weight=B}return this}syncAllAnimationsWith(B){for(let o=0;o<this._animatables.length;o++){this._animatables[o].syncWith(B)}return this}goToFrame(B){if(!this._isStarted)return this;for(let o=0;o<this._animatables.length;o++){this._animatables[o].goToFrame(B)}return this}getCurrentFrame(){var B;return(null===(B=this.animatables[0])||void 0===B?void 0:B.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const B=this._scene.animationGroups.indexOf(this);if(B>-1&&this._scene.animationGroups.splice(B,1),this._parentContainer){const B=this._parentContainer.animationGroups.indexOf(this);B>-1&&this._parentContainer.animationGroups.splice(B,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._animatables.indexOf(B);e>-1&&this._animatables.splice(e,1),0===this._animatables.length&&(this._isStarted=!1,o||this.onAnimationGroupEndObservable.notifyObservers(this))}clone(B,o){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=new R(B||this.name,this._scene,this._weight,this._playOrder);k._from=this.from,k._to=this.to,k._speedRatio=this.speedRatio,k._loopAnimation=this.loopAnimation,k._isAdditive=this.isAdditive,k._enableBlending=this.enableBlending,k._blendingSpeed=this.blendingSpeed,k.metadata=this.metadata,k.mask=this.mask;for(const d of this._targetedAnimations)k.addTargetedAnimation(e?d.animation.clone():d.animation,o?o(d.target):d.target);return k}serialize(){const B={};B.name=this.name,B.from=this.from,B.to=this.to,B.speedRatio=this.speedRatio,B.loopAnimation=this.loopAnimation,B.isAdditive=this.isAdditive,B.weight=this.weight,B.playOrder=this.playOrder,B.enableBlending=this.enableBlending,B.blendingSpeed=this.blendingSpeed,B.targetedAnimations=[];for(let o=0;o<this.targetedAnimations.length;o++){const e=this.targetedAnimations[o];B.targetedAnimations[o]=e.serialize()}return J.e&&J.e.HasTags(this)&&(B.tags=J.e.GetTags(this)),this.metadata&&(B.metadata=this.metadata),B}static Parse(B,o){const e=new R(B.name,o,B.weight,B.playOrder);for(let d=0;d<B.targetedAnimations.length;d++){const f=B.targetedAnimations[d],J=k.e.Parse(f.animation),Z=f.targetId;if("influence"===f.animation.property){const B=o.getMorphTargetById(Z);B&&e.addTargetedAnimation(J,B)}else{const B=o.getNodeById(Z);null!=B&&e.addTargetedAnimation(J,B)}}return J.e&&J.e.AddTagsTo(e,B.tags),null!==B.from&&null!==B.to&&e.normalize(B.from,B.to),void 0!==B.speedRatio&&(e._speedRatio=B.speedRatio),void 0!==B.loopAnimation&&(e._loopAnimation=B.loopAnimation),void 0!==B.isAdditive&&(e._isAdditive=B.isAdditive),void 0!==B.weight&&(e._weight=B.weight),void 0!==B.playOrder&&(e._playOrder=B.playOrder),void 0!==B.enableBlending&&(e._enableBlending=B.enableBlending),void 0!==B.blendingSpeed&&(e._blendingSpeed=B.blendingSpeed),void 0!==B.metadata&&(e.metadata=B.metadata),e}static MakeAnimationAdditive(B,o,e){let d;d="object"===typeof o?o:{referenceFrame:o,range:e,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let f=B;d.cloneOriginalAnimationGroup&&(f=B.clone(d.clonedAnimationGroupName||f.name));const J=f.targetedAnimations;for(let Z=0;Z<J.length;Z++){const B=J[Z];B.animation=k.e.MakeAnimationAdditive(B.animation,d)}if(f.isAdditive=!0,d.clipKeys){let B=Number.MAX_VALUE,o=-Number.MAX_VALUE;const e=f.targetedAnimations;for(let k=0;k<e.length;k++){const d=e[k].animation.getKeys();B>d[0].frame&&(B=d[0].frame),o<d[d.length-1].frame&&(o=d[d.length-1].frame)}f._from=B,f._to=o}return f}static ClipKeys(B,o,e,k,d){const f=B.clone(k||B.name);return R.ClipKeysInPlace(f,o,e,d)}static ClipKeysInPlace(B,o,e,k){return R.ClipInPlace(B,o,e,k,!1)}static ClipFrames(B,o,e,k,d){const f=B.clone(k||B.name);return R.ClipFramesInPlace(f,o,e,d)}static ClipFramesInPlace(B,o,e,k){return R.ClipInPlace(B,o,e,k,!0)}static ClipInPlace(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=Number.MAX_VALUE,J=-Number.MAX_VALUE;const Z=B.targetedAnimations;for(let t=0;t<Z.length;t++){const B=Z[t],h=k?B.animation:B.animation.clone();d&&(h.createKeyForFrame(o),h.createKeyForFrame(e));const O=h.getKeys(),K=[];let w=Number.MAX_VALUE;for(let k=0;k<O.length;k++){const B=O[k];if(!d&&k>=o&&k<=e||d&&B.frame>=o&&B.frame<=e){const o={frame:B.frame,value:B.value.clone?B.value.clone():B.value,inTangent:B.inTangent,outTangent:B.outTangent,interpolation:B.interpolation,lockedTangent:B.lockedTangent};w===Number.MAX_VALUE&&(w=o.frame),o.frame-=w,K.push(o)}}0!==K.length?(f>K[0].frame&&(f=K[0].frame),J<K[K.length-1].frame&&(J=K[K.length-1].frame),h.setKeys(K,!0),B.animation=h):(Z.splice(t,1),t--)}return B._from=f,B._to=J,B}getClassName(){return"AnimationGroup"}toString(B){let o="Name: "+this.name;return o+=", type: "+this.getClassName(),B&&(o+=", from: "+this._from,o+=", to: "+this._to,o+=", isStarted: "+this._isStarted,o+=", speedRatio: "+this._speedRatio,o+=", targetedAnimations length: "+this._targetedAnimations.length,o+=", animatables length: "+this._animatables),o}}}}]);