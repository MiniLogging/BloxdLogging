"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[48],{13685:(f,z,w)=>{w.r(z),w.d(z,{AnimationGroup:()=>B,TargetedAnimation:()=>d});var S=w(12647),C=w(527),E=w(580),F=w(676),J=w(12638),x=w(720);class u{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(f,z,w,C){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=z,this._target=f,this._scene=w,this._host=C,this._activeTargets=[],z._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===S.c.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=x.b.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const f={frame:0,value:this._minValue};this._keys.splice(0,0,f)}if(this._target instanceof Array){let f=0;for(const z of this._target)this._preparePath(z,f),this._getOriginalValues(f),f++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const E=z.getEvents();E&&E.length>0&&E.forEach((f=>{this._events.push(f._clone())})),this._enableBlending=f&&f.animationPropertiesOverride?f.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const w=this._animation.targetPropertyPath;if(w.length>1){let S=f;for(let f=0;f<w.length-1;f++){const z=w[f];if(S=S[z],void 0===S)throw new Error(`Invalid property (${z}) in property path (${w.join(".")})`)}this._targetPath=w[w.length-1],this._activeTargets[z]=S}else this._targetPath=w[0],this._activeTargets[z]=f;if(void 0===this._activeTargets[z][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${w.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let f=0;for(const z of this._target)void 0!==this._originalValue[f]&&this._setValue(z,this._activeTargets[f],this._originalValue[f],-1,f),f++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let f=0;f<this._events.length;f++)this._events[f].isDone=!1}isStopped(){return this._stopped}dispose(){const f=this._animation.runtimeAnimations.indexOf(this);f>-1&&this._animation.runtimeAnimations.splice(f,1)}setValue(f,z){if(this._targetIsArray)for(let w=0;w<this._target.length;w++){const S=this._target[w];this._setValue(S,this._activeTargets[w],f,z,w)}else this._setValue(this._target,this._directTarget,f,z,0)}_getOriginalValues(){let f,z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const w=this._activeTargets[z];f=w.getLocalMatrix&&"_matrix"===this._targetPath?w.getLocalMatrix():w[this._targetPath],f&&f.clone?this._originalValue[z]=f.clone():this._originalValue[z]=f}_registerTargetForLateAnimationBinding(f,z){const w=f.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(w),w._lateAnimationHolders||(w._lateAnimationHolders={}),w._lateAnimationHolders[f.targetPath]||(w._lateAnimationHolders[f.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:z}),f.isAdditive?(w._lateAnimationHolders[f.targetPath].additiveAnimations.push(f),w._lateAnimationHolders[f.targetPath].totalAdditiveWeight+=f.weight):(w._lateAnimationHolders[f.targetPath].animations.push(f),w._lateAnimationHolders[f.targetPath].totalWeight+=f.weight)}_setValue(f,z,w,C,E){if(this._currentActiveTarget=z,this._weight=C,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const f=z[this._targetPath];f.clone?this._originalBlendValue=f.clone():this._originalBlendValue=f}this._originalBlendValue.m?S.c.AllowMatrixDecomposeForInterpolation?this._currentValue?x.b.DecomposeLerpToRef(this._originalBlendValue,w,this._blendingFactor,this._currentValue):this._currentValue=x.b.DecomposeLerp(this._originalBlendValue,w,this._blendingFactor):this._currentValue?x.b.LerpToRef(this._originalBlendValue,w,this._blendingFactor,this._currentValue):this._currentValue=x.b.Lerp(this._originalBlendValue,w,this._blendingFactor):this._currentValue=S.c._UniversalLerp(this._originalBlendValue,w,this._blendingFactor);const C=f&&f.animationPropertiesOverride?f.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=C}else this._currentValue?this._currentValue.p?this._currentValue.p(w):this._currentValue=w:null!==w&&void 0!==w&&w.clone?this._currentValue=w.clone():this._currentValue=w;-1!==C?this._registerTargetForLateAnimationBinding(this,this._originalValue[E]):this._animationState.loopMode===S.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[E],z[this._targetPath]):z[this._targetPath]=this._originalValue[E]+this._currentValue:z[this._targetPath]=this._currentValue,f.ak&&f.ak(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const w=this._animation.getKeys();f<w[0].frame?f=w[0].frame:f>w[w.length-1].frame&&(f=w[w.length-1].frame);const S=this._events;if(S.length)for(let E=0;E<S.length;E++)S[E].onlyOnce||(S[E].isDone=S[E].frame<f);this._currentFrame=f;const C=this._animation._interpolate(f,this._animationState);this.setValue(C,z)}_prepareForSpeedRatioChange(f){const z=this._previousElapsedTime*(this._animation.framePerSecond*f)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-z}animate(f,z,w,C,E){let F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const J=this._animation,x=J.targetPropertyPath;if(!x||x.length<1)return this._stopped=!0,!1;let u=!0;(z<this._minFrame||z>this._maxFrame)&&(z=this._minFrame),(w<this._minFrame||w>this._maxFrame)&&(w=this._maxFrame);const h=w-z;let X,K=f*(J.framePerSecond*E)/1e3+this._absoluteFrameOffset,c=0,y=!1;const e=C&&this._animationState.loopMode===S.c.ANIMATIONLOOPMODE_YOYO;if(e){const f=(K-z)/h,w=Math.sin(f*Math.PI);K=Math.abs(w)*h+z;const S=w>=0?1:-1;this._yoyoDirection!==S&&(y=!0),this._yoyoDirection=S}if(this._previousElapsedTime=f,this._previousAbsoluteFrame=K,!C&&w>=z&&(K>=h&&E>0||K<=0&&E<0))u=!1,c=J._getKeyValue(this._maxValue);else if(!C&&z>=w&&(K<=h&&E<0||K>=0&&E>0))u=!1,c=J._getKeyValue(this._minValue);else if(this._animationState.loopMode!==S.c.ANIMATIONLOOPMODE_CYCLE){const f=w.toString()+z.toString();if(!this._offsetsCache[f]){this._animationState.repeatCount=0,this._animationState.loopMode=S.c.ANIMATIONLOOPMODE_CYCLE;const C=J._interpolate(z,this._animationState),E=J._interpolate(w,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),J.dataType){case S.c.ANIMATIONTYPE_FLOAT:this._offsetsCache[f]=E-C;break;case S.c.ANIMATIONTYPE_QUATERNION:case S.c.ANIMATIONTYPE_VECTOR3:case S.c.ANIMATIONTYPE_VECTOR2:case S.c.ANIMATIONTYPE_SIZE:case S.c.ANIMATIONTYPE_COLOR3:this._offsetsCache[f]=E.te(C)}this._highLimitsCache[f]=E}c=this._highLimitsCache[f],X=this._offsetsCache[f]}if(void 0===X)switch(J.dataType){case S.c.ANIMATIONTYPE_FLOAT:X=0;break;case S.c.ANIMATIONTYPE_QUATERNION:X=S.m;break;case S.c.ANIMATIONTYPE_VECTOR3:X=S.t;break;case S.c.ANIMATIONTYPE_VECTOR2:X=S.s;break;case S.c.ANIMATIONTYPE_SIZE:X=S.o;break;case S.c.ANIMATIONTYPE_COLOR3:X=S.g;break;case S.c.ANIMATIONTYPE_COLOR4:X=S.k}let O;if(this._host&&this._host.syncRoot){const f=this._host.syncRoot;O=z+h*((f.masterFrame-f.fromFrame)/(f.toFrame-f.fromFrame))}else O=K>0&&z>w||K<0&&z<w?u&&0!==h?w+K%h:z:u&&0!==h?z+K%h:w;const d=this._events;if(!e&&(E>0&&this.currentFrame>O||E<0&&this.currentFrame<O)||e&&y){this._onLoop();for(let f=0;f<d.length;f++)d[f].onlyOnce||(d[f].isDone=!1);this._animationState.key=E>0?0:J.getKeys().length-1}this._currentFrame=O,this._animationState.repeatCount=0===h?0:K/h|0,this._animationState.highLimitValue=c,this._animationState.offsetValue=X;const B=J._interpolate(O,this._animationState);if(this.setValue(B,F),d.length)for(let S=0;S<d.length;S++)if(h>=0&&O>=d[S].frame&&d[S].frame>=z||h<0&&O<=d[S].frame&&d[S].frame<=z){const f=d[S];f.isDone||(f.onlyOnce&&(d.splice(S,1),S--),f.isDone=!0,f.action(O))}return u||(this._stopped=!0),u}}var h=w(560);class X{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(f){this._weight=-1!==f?Math.min(Math.max(f,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(f){for(let z=0;z<this._runtimeAnimations.length;z++){this._runtimeAnimations[z]._prepareForSpeedRatioChange(f)}this._speedRatio=f,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,J=arguments.length>6?arguments[6]:void 0,x=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=z,this.fromFrame=w,this.toFrame=S,this.loopAnimation=E,this.onAnimationEnd=J,this.onAnimationLoop=u,this.isAdditive=h,this.playOrder=X,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.Xj=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new C.c,this.onAnimationLoopObservable=new C.c,this._scene=f,x&&this.appendAnimations(z,x),this._speedRatio=F,f._activeAnimatables.push(this)}syncWith(f){if(this._syncRoot=f,f){const f=this._scene._activeAnimatables.indexOf(this);f>-1&&(this._scene._activeAnimatables.splice(f,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(f,z){for(let w=0;w<z.length;w++){const S=z[w],C=new u(f,S,this._scene,this);C._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(C)}}getAnimationByTargetProperty(f){const z=this._runtimeAnimations;for(let w=0;w<z.length;w++)if(z[w].animation.targetProperty===f)return z[w].animation;return null}getRuntimeAnimationByTargetProperty(f){const z=this._runtimeAnimations;for(let w=0;w<z.length;w++)if(z[w].animation.targetProperty===f)return z[w];return null}reset(){const f=this._runtimeAnimations;for(let z=0;z<f.length;z++)f[z].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(f){const z=this._runtimeAnimations;for(let w=0;w<z.length;w++)z[w].animation.enableBlending=!0,z[w].animation.blendingSpeed=f}disableBlending(){const f=this._runtimeAnimations;for(let z=0;z<f.length;z++)f[z].animation.enableBlending=!1}goToFrame(f){const z=this._runtimeAnimations;if(z[0]){const w=z[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??z[0].currentFrame;const S=0===this.speedRatio?0:(f-this._frameToSyncFromJump)/w*1e3/this.speedRatio;this._manualJumpDelay=-S}for(let w=0;w<z.length;w++)z[w].goToFrame(f,this._weight);this._goToFrame=f}get paused(){return this.Xj}pause(){this.Xj||(this.Xj=!0)}restart(){this.Xj=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f||z){const C=this._scene._activeAnimatables.indexOf(this);if(C>-1){const E=this._runtimeAnimations;for(let w=E.length-1;w>=0;w--){const S=E[w];f&&S.animation.name!=f||(z&&!z(S.target)||(S.dispose(),E.splice(w,1)))}0==E.length&&(w||this._scene._activeAnimatables.splice(C,1),S||this._raiseOnAnimationEnd())}}else{const f=this._scene._activeAnimatables.indexOf(this);if(f>-1){w||this._scene._activeAnimatables.splice(f,1);const z=this._runtimeAnimations;for(let f=0;f<z.length;f++)z[f].dispose();this._runtimeAnimations.length=0,S||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise((f=>{this.onAnimationEndObservable.add((()=>{f(this)}),void 0,void 0,this,!0)}))}_animate(f){if(this.Xj)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=f),!0;if(null===this._localDelayOffset?(this._localDelayOffset=f,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=f-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let z=!1;const w=this._runtimeAnimations;let S;for(S=0;S<w.length;S++){const C=w[S].animate(f-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);z=z||C}if(this.animationStarted=z,!z){if(this.disposeOnEnd)for(S=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(S,1),S=0;S<w.length;S++)w[S].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return z}}function K(f){if(0===f.totalWeight&&0===f.totalAdditiveWeight)return f.originalValue;let z=1;const w=x.j.ek[0],S=x.j.ek[1],C=x.j.Quaternion[0];let E=0;const F=f.animations[0],J=f.originalValue;let u=1,h=!1;if(f.totalWeight<1)u=1-f.totalWeight,J.decompose(S,C,w);else{if(E=1,z=f.totalWeight,u=F.weight/z,1==u){if(!f.totalAdditiveWeight)return F.currentValue;h=!0}F.currentValue.decompose(S,C,w)}if(!h){S.scaleInPlace(u),w.scaleInPlace(u),C.scaleInPlace(u);for(let F=E;F<f.animations.length;F++){const E=f.animations[F];if(0===E.weight)continue;u=E.weight/z;const J=x.j.ek[2],h=x.j.ek[3],X=x.j.Quaternion[1];E.currentValue.decompose(h,X,J),h.scaleAndAddToRef(u,S),X.scaleAndAddToRef(x.f.Dot(C,X)>0?u:-u,C),J.scaleAndAddToRef(u,w)}C.normalize()}for(let K=0;K<f.additiveAnimations.length;K++){const z=f.additiveAnimations[K];if(0===z.weight)continue;const E=x.j.ek[2],F=x.j.ek[3],J=x.j.Quaternion[1];z.currentValue.decompose(F,J,E),F.multiplyToRef(S,F),x.n.LerpToRef(S,F,z.weight,S),C.multiplyToRef(J,J),x.f.SlerpToRef(C,J,z.weight,C),E.scaleAndAddToRef(z.weight,w)}const X=F?F._animationState.workValue:x.j.Matrix[0].clone();return x.b.ComposeToRef(S,C,w,X),X}function c(f,z){if(0===f.totalWeight&&0===f.totalAdditiveWeight)return z;const w=f.animations[0],S=f.originalValue;let C=z;if(0===f.totalWeight&&f.totalAdditiveWeight>0)C.p(S);else if(1===f.animations.length){if(x.f.SlerpToRef(S,w.currentValue,Math.min(1,f.totalWeight),C),0===f.totalAdditiveWeight)return C}else if(f.animations.length>1){let w,E,F=1;if(f.totalWeight<1){const z=1-f.totalWeight;w=[],E=[],w.push(S),E.push(z)}else{if(2===f.animations.length&&(x.f.SlerpToRef(f.animations[0].currentValue,f.animations[1].currentValue,f.animations[1].weight/f.totalWeight,z),0===f.totalAdditiveWeight))return z;w=[],E=[],F=f.totalWeight}for(let z=0;z<f.animations.length;z++){const S=f.animations[z];w.push(S.currentValue),E.push(S.weight/F)}let J=0;for(let f=0;f<w.length;)f?(J+=E[f],x.f.SlerpToRef(C,w[f],E[f]/J,C),f++):(x.f.SlerpToRef(w[f],w[f+1],E[f+1]/(E[f]+E[f+1]),z),C=z,J=E[f]+E[f+1],f+=2)}for(let E=0;E<f.additiveAnimations.length;E++){const z=f.additiveAnimations[E];0!==z.weight&&(C.multiplyToRef(z.currentValue,x.j.Quaternion[0]),x.f.SlerpToRef(C,x.j.Quaternion[0],z.weight,C))}return C}var y,e,O=w(2386);y=O.c,(e=J.b)&&(e.prototype.copyAnimationRange=function(f,z,w){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new S.c(this.name,"_matrix",f.animations[0].framePerSecond,S.c.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const F=f.animations[0].getRange(z);if(!F)return!1;const J=F.from,x=F.to,u=f.animations[0].getKeys(),h=f.length,X=f.getParent(),K=this.getParent(),c=C&&X&&h&&this.length&&h!==this.length,y=c&&K&&X?K.length/X.length:1,e=C&&!K&&E&&(1!==E.x||1!==E.y||1!==E.z),O=this.animations[0].getKeys();let d,B,V;for(let S=0,W=u.length;S<W;S++)d=u[S],d.frame>=J&&d.frame<=x&&(C?(V=d.value.clone(),c?(B=V.getTranslation(),V.setTranslation(B.scaleInPlace(y))):e&&E?(B=V.getTranslation(),V.setTranslation(B.multiplyInPlace(E))):V=d.value):V=d.value,O.push({frame:d.frame+w,value:V}));return this.animations[0].createRange(z,J+w,x+w),!0}),y&&(y.prototype._animate=function(f){if(!this.animationsEnabled)return;const z=h.d.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=z}this.deltaTime=void 0!==f?f:this.useConstantAnimationDeltaTime?16:(z-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=z;const w=this._activeAnimatables;if(0===w.length)return;this._animationTime+=this.deltaTime;const C=this._animationTime;for(let S=0;S<w.length;S++){const f=w[S];!f._animate(C)&&f.disposeOnEnd&&S--}!function(f){if(f._registeredForLateAnimationBindings.length){for(let z=0;z<f._registeredForLateAnimationBindings.length;z++){const w=f._registeredForLateAnimationBindings.data[z];for(const f in w._lateAnimationHolders){const z=w._lateAnimationHolders[f],C=z.animations[0],E=z.originalValue;if(void 0===E||null===E)continue;const F=S.c.AllowMatrixDecomposeForInterpolation&&E.m;let J=w[f];if(F)J=K(z);else if(void 0!==E.w)J=c(z,J||x.f.Identity());else{let f=0,w=1;const F=C&&C._animationState.loopMode===S.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(z.totalWeight<1)J=F?E.clone?E.clone():E:C&&E.scale?E.scale(1-z.totalWeight):C?E*(1-z.totalWeight):E.clone?E.clone():E;else if(C){w=z.totalWeight;const S=C.weight/w;J=1!==S?C.currentValue.scale?C.currentValue.scale(S):C.currentValue*S:C.currentValue,F&&(J.addToRef?J.addToRef(E,J):J+=E),f=1}for(let S=f;S<z.animations.length;S++){const f=z.animations[S],C=f.weight/w;C&&(f.currentValue.scaleAndAddToRef?f.currentValue.scaleAndAddToRef(C,J):J+=f.currentValue*C)}for(let S=0;S<z.additiveAnimations.length;S++){const f=z.additiveAnimations[S],w=f.weight;w&&(f.currentValue.scaleAndAddToRef?f.currentValue.scaleAndAddToRef(w,J):J+=f.currentValue*w)}}w[f]=J}w._lateAnimationHolders={}}f._registeredForLateAnimationBindings.reset()}}(this)},y.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((f,z)=>f.playOrder-z.playOrder))},y.prototype.beginWeightedAnimation=function(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,F=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const X=this.beginAnimation(f,z,w,C,E,F,J,!1,x,u,h);return X.weight=S,X},y.prototype.beginAnimation=function(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,E=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],x=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,h=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(C<0){const f=z;z=w,w=f,C=-C}z>w&&(C=-C),J&&this.stopAnimation(f,void 0,x),F||(F=new X(this,f,z,w,S,C,E,void 0,u,h));const K=!x||x(f);if(f.animations&&K&&F.appendAnimations(f,f.animations),f.getAnimatables){const h=f.getAnimatables();for(let f=0;f<h.length;f++)this.beginAnimation(h[f],z,w,S,C,E,F,J,x,u)}return F.reset(),F},y.prototype.beginHierarchyAnimation=function(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,F=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,x=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=arguments.length>9?arguments[9]:void 0,h=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const X=f.getDescendants(z),K=[];K.push(this.beginAnimation(f,w,S,C,E,F,J,x,u,void 0,h));for(const c of X)K.push(this.beginAnimation(c,w,S,C,E,F,J,x,u,void 0,h));return K},y.prototype.beginDirectAnimation=function(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(E<0){const f=w;w=S,S=f,E=-E}return w>S&&(E=-E),new X(this,f,w,S,C,E,arguments.length>6?arguments[6]:void 0,z,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},y.prototype.beginDirectHierarchyAnimation=function(f,z,w,S,C,E,F,J,x){let u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const h=f.getDescendants(z),X=[];X.push(this.beginDirectAnimation(f,w,S,C,E,F,J,x,u));for(const K of h)X.push(this.beginDirectAnimation(K,w,S,C,E,F,J,x,u));return X},y.prototype.getAnimatableByTarget=function(f){for(let z=0;z<this._activeAnimatables.length;z++)if(this._activeAnimatables[z].target===f)return this._activeAnimatables[z];return null},y.prototype.getAllAnimatablesByTarget=function(f){const z=[];for(let w=0;w<this._activeAnimatables.length;w++)this._activeAnimatables[w].target===f&&z.push(this._activeAnimatables[w]);return z},y.prototype.stopAnimation=function(f,z,w){const S=this.getAllAnimatablesByTarget(f);for(const C of S)C.stop(z,w)},y.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let f=0;f<this._activeAnimatables.length;f++)this._activeAnimatables[f].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const f of this.animationGroups)f.stop()});class d{getClassName(){return"TargetedAnimation"}serialize(){const f={};return f.animation=this.animation.serialize(),f.targetId=this.target.id,f}}class B{get mask(){return this._mask}set mask(f){this._mask!==f&&(this._mask=f,this.syncWithMask(!0))}syncWithMask(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||f){this._numActiveAnimatables=0;for(let f=0;f<this._animatables.length;++f){const z=this._animatables[f];!this.mask||this.mask.disabled||this.mask.retainsTarget(z.target.name)?(this._numActiveAnimatables++,z.paused&&z.restart()):z.paused||z.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let f=0;f<this._animatables.length;++f){const z=this._animatables[f];this.mask.retainsTarget(z.target.name)||(z.stop(),this._animatables.splice(f,1),--f)}for(let f=0;f<this._targetedAnimations.length;f++){const z=this._targetedAnimations[f];this.mask.retainsTarget(z.target.name)||(this._targetedAnimations.splice(f,1),--f)}}}get from(){return this._from}set from(f){if(this._from!==f){this._from=f;for(let f=0;f<this._animatables.length;f++){this._animatables[f].fromFrame=this._from}}}get to(){return this._to}set to(f){if(this._to!==f){this._to=f;for(let f=0;f<this._animatables.length;f++){this._animatables[f].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(f){if(this._speedRatio!==f){this._speedRatio=f;for(let f=0;f<this._animatables.length;f++){this._animatables[f].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(f){if(this._loopAnimation!==f){this._loopAnimation=f;for(let f=0;f<this._animatables.length;f++){this._animatables[f].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(f){if(this._isAdditive!==f){this._isAdditive=f;for(let f=0;f<this._animatables.length;f++){this._animatables[f].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(f){this._weight!==f&&(this._weight=f,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(f){if(this._playOrder!==f&&(this._playOrder=f,this._animatables.length>0)){for(let f=0;f<this._animatables.length;f++)this._animatables[f].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(f){if(this._enableBlending!==f&&(this._enableBlending=f,null!==f))for(let z=0;z<this._targetedAnimations.length;++z)this._targetedAnimations[z].animation.enableBlending=f}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(f){if(this._blendingSpeed!==f&&(this._blendingSpeed=f,null!==f))for(let z=0;z<this._targetedAnimations.length;++z)this._targetedAnimations[z].animation.blendingSpeed=f}getLength(f,z){f=f??this._from;return((z=z??this._to)-f)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;if(0===f.length)return null;S=S??f[0].weight;let C=Number.MAX_VALUE,E=-Number.MAX_VALUE;if(w)for(const J of f)J.from<C&&(C=J.from),J.to>E&&(E=J.to);const F=new B(f[0].name+"_merged",f[0]._scene,S);for(const J of f){w&&J.normalize(C,E);for(const f of J.targetedAnimations)F.addTargetedAnimation(f.animation,f.target);z&&J.dispose()}return F}constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=f,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new C.c,this.onAnimationLoopObservable=new C.c,this.onAnimationGroupLoopObservable=new C.c,this.onAnimationGroupEndObservable=new C.c,this.onAnimationGroupPauseObservable=new C.c,this.onAnimationGroupPlayObservable=new C.c,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=z||E.c.LastCreatedScene,this._weight=w,this._playOrder=S,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(f,z){const w=new d;w.animation=f,w.target=z;const S=f.getKeys();return this._from>S[0].frame&&(this._from=S[0].frame),this._to<S[S.length-1].frame&&(this._to=S[S.length-1].frame),null!==this._enableBlending&&(f.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(f.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(w),this._shouldStart=!0,w}removeTargetedAnimation(f){for(let z=this._targetedAnimations.length-1;z>-1;z--){this._targetedAnimations[z].animation===f&&this._targetedAnimations.splice(z,1)}}normalize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==f&&(f=this._from),null==z&&(z=this._to);for(let w=0;w<this._targetedAnimations.length;w++){const S=this._targetedAnimations[w].animation.getKeys(),C=S[0],E=S[S.length-1];if(C.frame>f){const z={frame:f,value:C.value,inTangent:C.inTangent,outTangent:C.outTangent,interpolation:C.interpolation};S.splice(0,0,z)}if(E.frame<z){const f={frame:z,value:E.value,inTangent:E.inTangent,outTangent:E.outTangent,interpolation:E.interpolation};S.push(f)}}return this._from=f,this._to=z,this}_processLoop(f,z,w){f.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(z),this._animationLoopFlags[w]||(this._animationLoopFlags[w]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=f,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let E=0;E<this._targetedAnimations.length;E++){const F=this._targetedAnimations[E],J=this._scene.beginDirectAnimation(F.target,[F.animation],void 0!==w?w:this._from,void 0!==S?S:this._to,f,z,void 0,void 0,void 0!==C?C:this._isAdditive);J.weight=this._weight,J.playOrder=this._playOrder,J.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(F),this._checkAnimationGroupEnded(J)},this._processLoop(J,F,E),this._animatables.push(J)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=z,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let f=0;f<this._animatables.length;f++){this._animatables[f].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(f){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==f&&(this.loopAnimation=f),this.restart()):(this.stop(),this.start(f,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let f=0;f<this._animatables.length;f++){this._animatables[f].reset()}return this}restart(){if(!this._isStarted)return this;for(let f=0;f<this._animatables.length;f++){this._animatables[f].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const z=this._animatables.slice();for(let S=0;S<z.length;S++)z[S].stop(void 0,void 0,!0,f);let w=0;for(let S=0;S<this._scene._activeAnimatables.length;S++){const z=this._scene._activeAnimatables[S];z._runtimeAnimations.length>0?this._scene._activeAnimatables[w++]=z:f&&this._checkAnimationGroupEnded(z,f)}return this._scene._activeAnimatables.length=w,this._isStarted=!1,this}setWeightForAllAnimatables(f){for(let z=0;z<this._animatables.length;z++){this._animatables[z].weight=f}return this}syncAllAnimationsWith(f){for(let z=0;z<this._animatables.length;z++){this._animatables[z].syncWith(f)}return this}goToFrame(f){if(!this._isStarted)return this;for(let z=0;z<this._animatables.length;z++){this._animatables[z].goToFrame(f)}return this}getCurrentFrame(){var f;return(null===(f=this.animatables[0])||void 0===f?void 0:f.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const f=this._scene.animationGroups.indexOf(this);if(f>-1&&this._scene.animationGroups.splice(f,1),this._parentContainer){const f=this._parentContainer.animationGroups.indexOf(this);f>-1&&this._parentContainer.animationGroups.splice(f,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const w=this._animatables.indexOf(f);w>-1&&this._animatables.splice(w,1),0===this._animatables.length&&(this._isStarted=!1,z||this.onAnimationGroupEndObservable.notifyObservers(this))}clone(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=new B(f||this.name,this._scene,this._weight,this._playOrder);S._from=this.from,S._to=this.to,S._speedRatio=this.speedRatio,S._loopAnimation=this.loopAnimation,S._isAdditive=this.isAdditive,S._enableBlending=this.enableBlending,S._blendingSpeed=this.blendingSpeed,S.metadata=this.metadata,S.mask=this.mask;for(const C of this._targetedAnimations)S.addTargetedAnimation(w?C.animation.clone():C.animation,z?z(C.target):C.target);return S}serialize(){const f={};f.name=this.name,f.from=this.from,f.to=this.to,f.speedRatio=this.speedRatio,f.loopAnimation=this.loopAnimation,f.isAdditive=this.isAdditive,f.weight=this.weight,f.playOrder=this.playOrder,f.enableBlending=this.enableBlending,f.blendingSpeed=this.blendingSpeed,f.targetedAnimations=[];for(let z=0;z<this.targetedAnimations.length;z++){const w=this.targetedAnimations[z];f.targetedAnimations[z]=w.serialize()}return F.e&&F.e.HasTags(this)&&(f.tags=F.e.GetTags(this)),this.metadata&&(f.metadata=this.metadata),f}static Parse(f,z){const w=new B(f.name,z,f.weight,f.playOrder);for(let C=0;C<f.targetedAnimations.length;C++){const E=f.targetedAnimations[C],F=S.c.Parse(E.animation),J=E.targetId;if("influence"===E.animation.property){const f=z.getMorphTargetById(J);f&&w.addTargetedAnimation(F,f)}else{const f=z.getNodeById(J);null!=f&&w.addTargetedAnimation(F,f)}}return F.e&&F.e.AddTagsTo(w,f.tags),null!==f.from&&null!==f.to&&w.normalize(f.from,f.to),void 0!==f.speedRatio&&(w._speedRatio=f.speedRatio),void 0!==f.loopAnimation&&(w._loopAnimation=f.loopAnimation),void 0!==f.isAdditive&&(w._isAdditive=f.isAdditive),void 0!==f.weight&&(w._weight=f.weight),void 0!==f.playOrder&&(w._playOrder=f.playOrder),void 0!==f.enableBlending&&(w._enableBlending=f.enableBlending),void 0!==f.blendingSpeed&&(w._blendingSpeed=f.blendingSpeed),void 0!==f.metadata&&(w.metadata=f.metadata),w}static MakeAnimationAdditive(f,z,w){let C;C="object"===typeof z?z:{referenceFrame:z,range:w,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let E=f;C.cloneOriginalAnimationGroup&&(E=f.clone(C.clonedAnimationGroupName||E.name));const F=E.targetedAnimations;for(let J=0;J<F.length;J++){const f=F[J];f.animation=S.c.MakeAnimationAdditive(f.animation,C)}if(E.isAdditive=!0,C.clipKeys){let f=Number.MAX_VALUE,z=-Number.MAX_VALUE;const w=E.targetedAnimations;for(let S=0;S<w.length;S++){const C=w[S].animation.getKeys();f>C[0].frame&&(f=C[0].frame),z<C[C.length-1].frame&&(z=C[C.length-1].frame)}E._from=f,E._to=z}return E}static ClipKeys(f,z,w,S,C){const E=f.clone(S||f.name);return B.ClipKeysInPlace(E,z,w,C)}static ClipKeysInPlace(f,z,w,S){return B.ClipInPlace(f,z,w,S,!1)}static ClipFrames(f,z,w,S,C){const E=f.clone(S||f.name);return B.ClipFramesInPlace(E,z,w,C)}static ClipFramesInPlace(f,z,w,S){return B.ClipInPlace(f,z,w,S,!0)}static ClipInPlace(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=Number.MAX_VALUE,F=-Number.MAX_VALUE;const J=f.targetedAnimations;for(let x=0;x<J.length;x++){const f=J[x],u=S?f.animation:f.animation.clone();C&&(u.createKeyForFrame(z),u.createKeyForFrame(w));const h=u.getKeys(),X=[];let K=Number.MAX_VALUE;for(let S=0;S<h.length;S++){const f=h[S];if(!C&&S>=z&&S<=w||C&&f.frame>=z&&f.frame<=w){const z={frame:f.frame,value:f.value.clone?f.value.clone():f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation,lockedTangent:f.lockedTangent};K===Number.MAX_VALUE&&(K=z.frame),z.frame-=K,X.push(z)}}0!==X.length?(E>X[0].frame&&(E=X[0].frame),F<X[X.length-1].frame&&(F=X[X.length-1].frame),u.setKeys(X,!0),f.animation=u):(J.splice(x,1),x--)}return f._from=E,f._to=F,f}getClassName(){return"AnimationGroup"}toString(f){let z="Name: "+this.name;return z+=", type: "+this.getClassName(),f&&(z+=", from: "+this._from,z+=", to: "+this._to,z+=", isStarted: "+this._isStarted,z+=", speedRatio: "+this._speedRatio,z+=", targetedAnimations length: "+this._targetedAnimations.length,z+=", animatables length: "+this._animatables),z}}}}]);