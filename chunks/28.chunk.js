"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[28,29],{13483:(C,U,K)=>{var m=K(11773),O=K(11679),X=K(11709),A=K(11793),e=K(11735),t=K(11779);e.b.prototype._partialLoadFile=function(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(C,(C=>{K[U]=C,K._internalCount++,6===K._internalCount&&m(K)}),void 0,void 0,!0,((C,U)=>{O&&C&&O(C.status+" "+C.statusText,U)}))},e.b.prototype._cascadeLoadFiles=function(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=[];O._internalCount=0;for(let X=0;X<6;X++)this._partialLoadFile(K[X],X,O,U,m)},e.b.prototype._cascadeLoadImgs=function(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5?arguments[5]:void 0;const A=[];A._internalCount=0;for(let e=0;e<6;e++)this._partialLoadImg(m[e],e,A,C,U,K,O,X)},e.b.prototype._partialLoadImg=function(C,U,K,m,O,e){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7?arguments[7]:void 0;const j=(0,A.d)();(0,X.r)(C,(C=>{K[U]=C,K._internalCount++,m&&m.removePendingData(j),6===K._internalCount&&e&&e(O,K)}),((C,U)=>{m&&m.removePendingData(j),t&&t(C,U)}),m?m.offlineProvider:null,z),m&&m.addPendingData(j)},e.b.prototype.createCubeTextureBase=function(C,U,K,X){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,Q=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,V=arguments.length>14&&void 0!==arguments[14]&&arguments[14],f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const F=b||new m.d(this,7);F.isCube=!0,F.url=C,F.generateMipMaps=!X,F._lodGenerationScale=E,F._lodGenerationOffset=u,F._useSRGBBuffer=!!V&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!X),F!==b&&(F.label=C.substring(0,60)),this._doNotHandleContextLost||(F._extension=j,F._files=K,F._buffer=f);const Z=C;this._transformTextureUrl&&!b&&(C=this._transformTextureUrl(C));const P=j??function(C){const U=C.split("?")[0],K=U.lastIndexOf(".");return K>-1?U.substring(K).toLowerCase():""}(C),H=(0,t.b)(P),d=(C,U)=>{F.dispose(),e?e(C,U):C&&O.d.Warn(C)},T=(m,e)=>{C===Z?m&&d(m.status+" "+m.statusText,e):(O.d.Warn(`Failed to load ${C}, falling back to the ${Z}`),this.createCubeTextureBase(Z,U,K,!!X,A,d,z,j,p,E,u,F,v,Q,V,f))};if(H)H.then((m=>{const O=C=>{v&&v(F,C),m.loadCubeData(C,F,p,A,((C,U)=>{d(C,U)}))};f?O(f):K&&6===K.length?m.supportCascades?this._cascadeLoadFiles(U,(C=>O(C.map((C=>new Uint8Array(C))))),K,d):d("Textures type does not support cascades."):this._loadFile(C,(C=>O(new Uint8Array(C))),void 0,void 0,!0,T)}));else{if(!K||0===K.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(U,F,((C,U)=>{Q&&Q(C,U)}),K,d)}return this._internalTexturesCache.push(F),F}},14230:(C,U,K)=>{K.r(U),K.d(U,{_DDSTextureLoader:()=>X});var m=K(12018),O=K(14237);class X{constructor(){this.supportCascades=!0}loadCubeData(C,U,K,X){const A=U.getEngine();let e,t=!1,z=1e3;if(Array.isArray(C))for(let m=0;m<C.length;m++){const K=C[m];e=O.DDSTools.GetDDSInfo(K),U.width=e.width,U.height=e.height,t=(e.isRGB||e.isLuminance||e.mipmapCount>1)&&U.generateMipMaps,A._unpackFlipY(e.isCompressed),O.DDSTools.UploadDDSLevels(A,U,K,e,t,6,-1,m),e.isFourCC||1!==e.mipmapCount?z=e.mipmapCount-1:A.generateMipMapsForCubemap(U)}else{const X=C;e=O.DDSTools.GetDDSInfo(X),U.width=e.width,U.height=e.height,K&&(e.sphericalPolynomial=new m.g),t=(e.isRGB||e.isLuminance||e.mipmapCount>1)&&U.generateMipMaps,A._unpackFlipY(e.isCompressed),O.DDSTools.UploadDDSLevels(A,U,X,e,t,6),e.isFourCC||1!==e.mipmapCount?z=e.mipmapCount-1:A.generateMipMapsForCubemap(U,!1)}A._setCubeMapTextureParams(U,t,z),U.isReady=!0,U.onLoadedObservable.notifyObservers(U),U.onLoadedObservable.clear(),X&&X({isDDS:!0,width:U.width,info:e,data:C,texture:U})}loadData(C,U,K){const m=O.DDSTools.GetDDSInfo(C),X=(m.isRGB||m.isLuminance||m.mipmapCount>1)&&U.generateMipMaps&&Math.max(m.width,m.height)>>m.mipmapCount-1===1;K(m.width,m.height,X,m.isFourCC,(()=>{O.DDSTools.UploadDDSLevels(U.getEngine(),U,C,m,X,1)}))}}},12354:(C,U,K)=>{K.d(U,{e:()=>z});var m=K(11827),O=K(11846),X=K(12018),A=K(11835),e=K(11879);class t{constructor(C,U,K,m){this.name=C,this.worldAxisForNormal=U,this.worldAxisForFileX=K,this.worldAxisForFileY=m}}class z{static ConvertCubeMapTextureToSphericalPolynomial(C){var U;if(!C.isCube)return null;null===(U=C.dC())||void 0===U||U.getEngine().flushFramebuffer();const K=C.getSize().width,m=C.readPixels(0,void 0,void 0,!1),O=C.readPixels(1,void 0,void 0,!1);let X,A;C.isRenderTarget?(X=C.readPixels(3,void 0,void 0,!1),A=C.readPixels(2,void 0,void 0,!1)):(X=C.readPixels(2,void 0,void 0,!1),A=C.readPixels(3,void 0,void 0,!1));const e=C.readPixels(4,void 0,void 0,!1),t=C.readPixels(5,void 0,void 0,!1),z=C.gammaSpace;let j=0;return 1!=C.textureType&&2!=C.textureType||(j=1),new Promise((C=>{Promise.all([O,m,X,A,e,t]).then((U=>{let[m,O,X,A,e,t]=U;const p={size:K,right:O,left:m,up:X,down:A,front:e,back:t,format:5,type:j,gammaSpace:z};C(this.ConvertCubeMapToSphericalPolynomial(p))}))}))}static _AreaElement(C,U){return Math.atan2(C*U,Math.sqrt(C*C+U*U+1))}static ConvertCubeMapToSphericalPolynomial(C){const U=new X.d;let K=0;const m=2/C.size,t=m,z=.5*m,j=z-1;for(let X=0;X<6;X++){const p=this._FileFaces[X],E=C[p.name];let u=j;const b=5===C.format?4:3;for(let X=0;X<C.size;X++){let v=j;for(let t=0;t<C.size;t++){const j=p.worldAxisForFileX.scale(v).add(p.worldAxisForFileY.scale(u)).add(p.worldAxisForNormal);j.normalize();const Q=this._AreaElement(v-z,u-z)-this._AreaElement(v-z,u+z)-this._AreaElement(v+z,u-z)+this._AreaElement(v+z,u+z);let V=E[X*C.size*b+t*b+0],f=E[X*C.size*b+t*b+1],F=E[X*C.size*b+t*b+2];isNaN(V)&&(V=0),isNaN(f)&&(f=0),isNaN(F)&&(F=0),0===C.type&&(V/=255,f/=255,F/=255),C.gammaSpace&&(V=Math.pow((0,O.Clamp)(V),A.j),f=Math.pow((0,O.Clamp)(f),A.j),F=Math.pow((0,O.Clamp)(F),A.j));const Z=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const C=Math.max(V,f,F);if(C>Z){const U=Z/C;V*=U,f*=U,F*=U}}else V=(0,O.Clamp)(V,0,Z),f=(0,O.Clamp)(f,0,Z),F=(0,O.Clamp)(F,0,Z);const P=new e.fU(V,f,F);U.addLight(j,P,Q),K+=Q,v+=m}u+=t}}const p=6*(4*Math.PI)/6/K;return U.scaleInPlace(p),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),X.g.FromHarmonics(U)}}z._FileFaces=[new t("right",new m.bU(1,0,0),new m.bU(0,0,-1),new m.bU(0,-1,0)),new t("left",new m.bU(-1,0,0),new m.bU(0,0,1),new m.bU(0,-1,0)),new t("up",new m.bU(0,1,0),new m.bU(1,0,0),new m.bU(0,0,1)),new t("down",new m.bU(0,-1,0),new m.bU(1,0,0),new m.bU(0,0,-1)),new t("front",new m.bU(0,0,1),new m.bU(1,0,0),new m.bU(0,-1,0)),new t("back",new m.bU(0,0,-1),new m.bU(-1,0,0),new m.bU(0,-1,0))],z.MAX_HDRI_VALUE=4096,z.PRESERVE_CLAMPED_COLORS=!1},14237:(C,U,K)=>{K.d(U,{DDSTools:()=>b});var m=K(11846),O=K(11679),X=K(12354),A=K(12067);K(13483);const e=131072,t=131072;function z(C){return C.charCodeAt(0)+(C.charCodeAt(1)<<8)+(C.charCodeAt(2)<<16)+(C.charCodeAt(3)<<24)}const j=z("DXT1"),p=z("DXT3"),E=z("DXT5"),u=z("DX10");class b{static GetDDSInfo(C){const U=new Int32Array(C.buffer,C.byteOffset,31),K=new Int32Array(C.buffer,C.byteOffset,35);let m=1;U[2]&e&&(m=Math.max(1,U[7]));const O=U[21],X=O===u?K[32]:0;let A=0;switch(O){case 113:A=2;break;case 116:A=1;break;case u:if(10===X){A=2;break}if(2===X){A=1;break}}return{width:U[4],height:U[3],mipmapCount:m,isFourCC:4===(4&U[20]),isRGB:64===(64&U[20]),isLuminance:(U[20]&t)===t,isCube:512===(512&U[28]),isCompressed:O===j||O===p||O===E,dxgiFormat:X,textureType:A}}static _GetHalfFloatAsFloatRGBAArrayBuffer(C,U,K,m,O,X){const e=new Float32Array(m),t=new Uint16Array(O,K);let z=0;for(let j=0;j<U;j++)for(let U=0;U<C;U++){const K=4*(U+j*C);e[z]=(0,A.g)(t[K]),e[z+1]=(0,A.g)(t[K+1]),e[z+2]=(0,A.g)(t[K+2]),b.StoreLODInAlphaChannel?e[z+3]=X:e[z+3]=(0,A.g)(t[K+3]),z+=4}return e}static _GetHalfFloatRGBAArrayBuffer(C,U,K,m,O,X){if(b.StoreLODInAlphaChannel){const e=new Uint16Array(m),t=new Uint16Array(O,K);let z=0;for(let K=0;K<U;K++)for(let U=0;U<C;U++){const m=4*(U+K*C);e[z]=t[m],e[z+1]=t[m+1],e[z+2]=t[m+2],e[z+3]=(0,A.n)(X),z+=4}return e}return new Uint16Array(O,K,m)}static _GetFloatRGBAArrayBuffer(C,U,K,m,O,X){if(b.StoreLODInAlphaChannel){const A=new Float32Array(m),e=new Float32Array(O,K);let t=0;for(let K=0;K<U;K++)for(let U=0;U<C;U++){const m=4*(U+K*C);A[t]=e[m],A[t+1]=e[m+1],A[t+2]=e[m+2],A[t+3]=X,t+=4}return A}return new Float32Array(O,K,m)}static _GetFloatAsHalfFloatRGBAArrayBuffer(C,U,K,m,O,X){const e=new Uint16Array(m),t=new Float32Array(O,K);let z=0;for(let j=0;j<U;j++)for(let U=0;U<C;U++)e[z]=(0,A.n)(t[z]),e[z+1]=(0,A.n)(t[z+1]),e[z+2]=(0,A.n)(t[z+2]),b.StoreLODInAlphaChannel?e[z+3]=(0,A.n)(X):e[z+3]=(0,A.n)(t[z+3]),z+=4;return e}static _GetFloatAsUIntRGBAArrayBuffer(C,U,K,O,X,A){const e=new Uint8Array(O),t=new Float32Array(X,K);let z=0;for(let j=0;j<U;j++)for(let U=0;U<C;U++){const K=4*(U+j*C);e[z]=255*(0,m.Clamp)(t[K]),e[z+1]=255*(0,m.Clamp)(t[K+1]),e[z+2]=255*(0,m.Clamp)(t[K+2]),b.StoreLODInAlphaChannel?e[z+3]=A:e[z+3]=255*(0,m.Clamp)(t[K+3]),z+=4}return e}static _GetHalfFloatAsUIntRGBAArrayBuffer(C,U,K,O,X,e){const t=new Uint8Array(O),z=new Uint16Array(X,K);let j=0;for(let p=0;p<U;p++)for(let U=0;U<C;U++){const K=4*(U+p*C);t[j]=255*(0,m.Clamp)((0,A.g)(z[K])),t[j+1]=255*(0,m.Clamp)((0,A.g)(z[K+1])),t[j+2]=255*(0,m.Clamp)((0,A.g)(z[K+2])),b.StoreLODInAlphaChannel?t[j+3]=e:t[j+3]=255*(0,m.Clamp)((0,A.g)(z[K+3])),j+=4}return t}static _GetRGBAArrayBuffer(C,U,K,m,O,X,A,e,t){const z=new Uint8Array(m),j=new Uint8Array(O,K);let p=0;for(let E=0;E<U;E++)for(let U=0;U<C;U++){const K=4*(U+E*C);z[p]=j[K+X],z[p+1]=j[K+A],z[p+2]=j[K+e],z[p+3]=j[K+t],p+=4}return z}static _ExtractLongWordOrder(C){return 0===C||255===C||-16777216===C?0:1+b._ExtractLongWordOrder(C>>8)}static _GetRGBArrayBuffer(C,U,K,m,O,X,A,e){const t=new Uint8Array(m),z=new Uint8Array(O,K);let j=0;for(let p=0;p<U;p++)for(let U=0;U<C;U++){const K=3*(U+p*C);t[j]=z[K+X],t[j+1]=z[K+A],t[j+2]=z[K+e],j+=3}return t}static _GetLuminanceArrayBuffer(C,U,K,m,O){const X=new Uint8Array(m),A=new Uint8Array(O,K);let e=0;for(let t=0;t<U;t++)for(let U=0;U<C;U++){const K=U+t*C;X[e]=A[K],e++}return X}static UploadDDSLevels(C,U,K,m,A,t){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,v=arguments.length>7?arguments[7]:void 0,Q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],V=null;m.sphericalPolynomial&&(V=[]);const f=!!C.getCaps().s3tc;U.generateMipMaps=A;const F=new Int32Array(K.buffer,K.byteOffset,31);let Z,P,H,d,T,y,a,r=0,i=0,D=1;if(542327876!==F[0])return void O.d.Error("Invalid magic number in DDS header");if(!m.isFourCC&&!m.isRGB&&!m.isLuminance)return void O.d.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(m.isCompressed&&!f)return void O.d.Error("Compressed textures are not supported on this platform.");let l=F[22];d=F[1]+4;let G=!1;if(m.isFourCC)switch(Z=F[21],Z){case j:D=8,i=33777;break;case p:D=16,i=33778;break;case E:D=16,i=33779;break;case 113:G=!0,l=64;break;case 116:G=!0,l=128;break;case u:{d+=20;let C=!1;switch(m.dxgiFormat){case 10:G=!0,l=64,C=!0;break;case 2:G=!0,l=128,C=!0;break;case 88:m.isRGB=!0,m.isFourCC=!1,l=32,C=!0}if(C)break}default:return void O.d.Error(["Unsupported FourCC code:",(J=Z,String.fromCharCode(255&J,J>>8&255,J>>16&255,J>>24&255))])}var J;const o=b._ExtractLongWordOrder(F[23]),B=b._ExtractLongWordOrder(F[24]),k=b._ExtractLongWordOrder(F[25]),w=b._ExtractLongWordOrder(F[26]);G&&(i=C._getRGBABufferInternalSizedFormat(m.textureType)),y=1,F[2]&e&&!1!==A&&(y=Math.max(1,F[7]));const h=v||0,c=C.getCaps();for(let O=h;O<t;O++){for(P=F[4],H=F[3],a=0;a<y;++a){if(-1===z||z===a){const X=-1===z?a:0;if(!m.isCompressed&&m.isFourCC){U.format=5,r=P*H*4;let m=null;if(C._badOS||C._badDesktopOS||!c.textureHalfFloat&&!c.textureFloat)128===l?(m=b._GetFloatAsUIntRGBAArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,X),V&&0==X&&V.push(b._GetFloatRGBAArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,X))):64===l&&(m=b._GetHalfFloatAsUIntRGBAArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,X),V&&0==X&&V.push(b._GetHalfFloatAsFloatRGBAArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,X))),U.type=0;else{const C=c.textureFloat&&(Q&&c.textureFloatLinearFiltering||!Q),O=c.textureHalfFloat&&(Q&&c.textureHalfFloatLinearFiltering||!Q),A=(128===l||64===l&&!O)&&C?1:(64===l||128===l&&!C)&&O?2:0;let e,t=null;if(128===l)switch(A){case 1:e=b._GetFloatRGBAArrayBuffer,t=null;break;case 2:e=b._GetFloatAsHalfFloatRGBAArrayBuffer,t=b._GetFloatRGBAArrayBuffer;break;case 0:e=b._GetFloatAsUIntRGBAArrayBuffer,t=b._GetFloatRGBAArrayBuffer}else switch(A){case 1:e=b._GetHalfFloatAsFloatRGBAArrayBuffer,t=null;break;case 2:e=b._GetHalfFloatRGBAArrayBuffer,t=b._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:e=b._GetHalfFloatAsUIntRGBAArrayBuffer,t=b._GetHalfFloatAsFloatRGBAArrayBuffer}U.type=A,m=e(P,H,K.byteOffset+d,r,K.buffer,X),V&&0==X&&V.push(t?t(P,H,K.byteOffset+d,r,K.buffer,X):m)}m&&C._uploadDataToTextureDirectly(U,m,O,X)}else if(m.isRGB)U.type=0,24===l?(U.format=4,r=P*H*3,T=b._GetRGBArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,o,B,k),C._uploadDataToTextureDirectly(U,T,O,X)):(U.format=5,r=P*H*4,T=b._GetRGBAArrayBuffer(P,H,K.byteOffset+d,r,K.buffer,o,B,k,w),C._uploadDataToTextureDirectly(U,T,O,X));else if(m.isLuminance){const m=C._getUnpackAlignement(),A=P;r=Math.floor((P+m-1)/m)*m*(H-1)+A,T=b._GetLuminanceArrayBuffer(P,H,K.byteOffset+d,r,K.buffer),U.format=1,U.type=0,C._uploadDataToTextureDirectly(U,T,O,X)}else r=Math.max(4,P)/4*Math.max(4,H)/4*D,T=new Uint8Array(K.buffer,K.byteOffset+d,r),U.type=0,C._uploadCompressedDataToTextureDirectly(U,i,P,H,T,O,X)}d+=l?P*H*(l/8):r,P*=.5,H*=.5,P=Math.max(1,P),H=Math.max(1,H)}if(void 0!==v)break}V&&V.length>0?m.sphericalPolynomial=X.e.ConvertCubeMapToSphericalPolynomial({size:F[4],right:V[0],left:V[1],up:V[2],down:V[3],front:V[4],back:V[5],format:5,type:1,gammaSpace:!1}):m.sphericalPolynomial=void 0}}b.StoreLODInAlphaChannel=!1}}]);