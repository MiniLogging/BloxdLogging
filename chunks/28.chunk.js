"use strict";(self.h66iwo8dvgq=self.h66iwo8dvgq||[]).push([[28,29],{13595:(b,X,P)=>{var Q=P(11787),S=P(11700),d=P(11738),N=P(11804),a=P(11760),u=P(11792);a.c.prototype._partialLoadFile=function(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(b,(b=>{P[X]=b,P._internalCount++,6===P._internalCount&&Q(P)}),void 0,void 0,!0,((b,X)=>{S&&b&&S(b.status+" "+b.statusText,X)}))},a.c.prototype._cascadeLoadFiles=function(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=[];S._internalCount=0;for(let d=0;d<6;d++)this._partialLoadFile(P[d],d,S,X,Q)},a.c.prototype._cascadeLoadImgs=function(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5?arguments[5]:void 0;const N=[];N._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(Q[a],a,N,b,X,P,S,d)},a.c.prototype._partialLoadImg=function(b,X,P,Q,S,a){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0;const f=(0,N.b)();(0,d.p)(b,(b=>{P[X]=b,P._internalCount++,Q&&Q.removePendingData(f),6===P._internalCount&&a&&a(S,P)}),((b,X)=>{Q&&Q.removePendingData(f),u&&u(b,X)}),Q?Q.offlineProvider:null,w),Q&&Q.addPendingData(f)},a.c.prototype.createCubeTextureBase=function(b,X,P,d){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,O=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,t=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],W=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const n=D||new Q.e(this,7);n.isCube=!0,n.url=b,n.generateMipMaps=!d,n._lodGenerationScale=e,n._lodGenerationOffset=Y,n._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!d),n!==D&&(n.label=b.substring(0,60)),this._doNotHandleContextLost||(n._extension=f,n._files=P,n._buffer=W);const y=b;this._transformTextureUrl&&!D&&(b=this._transformTextureUrl(b));const h=f??function(b){const X=b.split("?")[0],P=X.lastIndexOf(".");return P>-1?X.substring(P).toLowerCase():""}(b),L=(0,u.e)(h),Z=(b,X)=>{n.dispose(),a?a(b,X):b&&S.b.Warn(b)},v=(Q,a)=>{b===y?Q&&Z(Q.status+" "+Q.statusText,a):(S.b.Warn(`Failed to load ${b}, falling back to the ${y}`),this.createCubeTextureBase(y,X,P,!!d,N,Z,w,f,O,e,Y,n,E,t,B,W))};if(L)L.then((Q=>{const S=b=>{E&&E(n,b),Q.loadCubeData(b,n,O,N,((b,X)=>{Z(b,X)}))};W?S(W):P&&6===P.length?Q.supportCascades?this._cascadeLoadFiles(X,(b=>S(b.map((b=>new Uint8Array(b))))),P,Z):Z("Textures type does not support cascades."):this._loadFile(b,(b=>S(new Uint8Array(b))),void 0,void 0,!0,v)}));else{if(!P||0===P.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(X,n,((b,X)=>{t&&t(b,X)}),P,Z)}return this._internalTexturesCache.push(n),n}},14357:(b,X,P)=>{P.r(X),P.d(X,{_DDSTextureLoader:()=>d});var Q=P(12032),S=P(14362);class d{constructor(){this.supportCascades=!0}loadCubeData(b,X,P,d){const N=X.getEngine();let a,u=!1,w=1e3;if(Array.isArray(b))for(let Q=0;Q<b.length;Q++){const P=b[Q];a=S.DDSTools.GetDDSInfo(P),X.width=a.width,X.height=a.height,u=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&X.generateMipMaps,N._unpackFlipY(a.isCompressed),S.DDSTools.UploadDDSLevels(N,X,P,a,u,6,-1,Q),a.isFourCC||1!==a.mipmapCount?w=a.mipmapCount-1:N.generateMipMapsForCubemap(X)}else{const d=b;a=S.DDSTools.GetDDSInfo(d),X.width=a.width,X.height=a.height,P&&(a.sphericalPolynomial=new Q.d),u=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&X.generateMipMaps,N._unpackFlipY(a.isCompressed),S.DDSTools.UploadDDSLevels(N,X,d,a,u,6),a.isFourCC||1!==a.mipmapCount?w=a.mipmapCount-1:N.generateMipMapsForCubemap(X,!1)}N._setCubeMapTextureParams(X,u,w),X.isReady=!0,X.onLoadedObservable.notifyObservers(X),X.onLoadedObservable.clear(),d&&d({isDDS:!0,width:X.width,info:a,data:b,texture:X})}loadData(b,X,P){const Q=S.DDSTools.GetDDSInfo(b),d=(Q.isRGB||Q.isLuminance||Q.mipmapCount>1)&&X.generateMipMaps&&Math.max(Q.width,Q.height)>>Q.mipmapCount-1===1;P(Q.width,Q.height,d,Q.isFourCC,(()=>{S.DDSTools.UploadDDSLevels(X.getEngine(),X,b,Q,d,1)}))}}},12383:(b,X,P)=>{P.d(X,{e:()=>w});var Q=P(11834),S=P(11844),d=P(12032),N=P(11836),a=P(11878);class u{constructor(b,X,P,Q){this.name=b,this.worldAxisForNormal=X,this.worldAxisForFileX=P,this.worldAxisForFileY=Q}}class w{static ConvertCubeMapTextureToSphericalPolynomial(b){var X;if(!b.isCube)return null;null===(X=b.Ab())||void 0===X||X.getEngine().flushFramebuffer();const P=b.getSize().width,Q=b.readPixels(0,void 0,void 0,!1),S=b.readPixels(1,void 0,void 0,!1);let d,N;b.isRenderTarget?(d=b.readPixels(3,void 0,void 0,!1),N=b.readPixels(2,void 0,void 0,!1)):(d=b.readPixels(2,void 0,void 0,!1),N=b.readPixels(3,void 0,void 0,!1));const a=b.readPixels(4,void 0,void 0,!1),u=b.readPixels(5,void 0,void 0,!1),w=b.gammaSpace;let f=0;return 1!=b.textureType&&2!=b.textureType||(f=1),new Promise((b=>{Promise.all([S,Q,d,N,a,u]).then((X=>{let[Q,S,d,N,a,u]=X;const O={size:P,right:S,left:Q,up:d,down:N,front:a,back:u,format:5,type:f,gammaSpace:w};b(this.ConvertCubeMapToSphericalPolynomial(O))}))}))}static _AreaElement(b,X){return Math.atan2(b*X,Math.sqrt(b*b+X*X+1))}static ConvertCubeMapToSphericalPolynomial(b){const X=new d.c;let P=0;const Q=2/b.size,u=Q,w=.5*Q,f=w-1;for(let d=0;d<6;d++){const O=this._FileFaces[d],e=b[O.name];let Y=f;const D=5===b.format?4:3;for(let d=0;d<b.size;d++){let E=f;for(let u=0;u<b.size;u++){const f=O.worldAxisForFileX.scale(E).add(O.worldAxisForFileY.scale(Y)).add(O.worldAxisForNormal);f.normalize();const t=this._AreaElement(E-w,Y-w)-this._AreaElement(E-w,Y+w)-this._AreaElement(E+w,Y-w)+this._AreaElement(E+w,Y+w);let B=e[d*b.size*D+u*D+0],W=e[d*b.size*D+u*D+1],n=e[d*b.size*D+u*D+2];isNaN(B)&&(B=0),isNaN(W)&&(W=0),isNaN(n)&&(n=0),0===b.type&&(B/=255,W/=255,n/=255),b.gammaSpace&&(B=Math.pow((0,S.Clamp)(B),N.k),W=Math.pow((0,S.Clamp)(W),N.k),n=Math.pow((0,S.Clamp)(n),N.k));const y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const b=Math.max(B,W,n);if(b>y){const X=y/b;B*=X,W*=X,n*=X}}else B=(0,S.Clamp)(B,0,y),W=(0,S.Clamp)(W,0,y),n=(0,S.Clamp)(n,0,y);const h=new a.yX(B,W,n);X.addLight(f,h,t),P+=t,E+=Q}Y+=u}}const O=6*(4*Math.PI)/6/P;return X.scaleInPlace(O),X.convertIncidentRadianceToIrradiance(),X.convertIrradianceToLambertianRadiance(),d.d.FromHarmonics(X)}}w._FileFaces=[new u("right",new Q.tX(1,0,0),new Q.tX(0,0,-1),new Q.tX(0,-1,0)),new u("left",new Q.tX(-1,0,0),new Q.tX(0,0,1),new Q.tX(0,-1,0)),new u("up",new Q.tX(0,1,0),new Q.tX(1,0,0),new Q.tX(0,0,1)),new u("down",new Q.tX(0,-1,0),new Q.tX(1,0,0),new Q.tX(0,0,-1)),new u("front",new Q.tX(0,0,1),new Q.tX(1,0,0),new Q.tX(0,-1,0)),new u("back",new Q.tX(0,0,-1),new Q.tX(-1,0,0),new Q.tX(0,-1,0))],w.MAX_HDRI_VALUE=4096,w.PRESERVE_CLAMPED_COLORS=!1},14362:(b,X,P)=>{P.d(X,{DDSTools:()=>D});var Q=P(11844),S=P(11700),d=P(12383),N=P(12081);P(13595);const a=131072,u=131072;function w(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}const f=w("DXT1"),O=w("DXT3"),e=w("DXT5"),Y=w("DX10");class D{static GetDDSInfo(b){const X=new Int32Array(b.buffer,b.byteOffset,31),P=new Int32Array(b.buffer,b.byteOffset,35);let Q=1;X[2]&a&&(Q=Math.max(1,X[7]));const S=X[21],d=S===Y?P[32]:0;let N=0;switch(S){case 113:N=2;break;case 116:N=1;break;case Y:if(10===d){N=2;break}if(2===d){N=1;break}}return{width:X[4],height:X[3],mipmapCount:Q,isFourCC:4===(4&X[20]),isRGB:64===(64&X[20]),isLuminance:(X[20]&u)===u,isCube:512===(512&X[28]),isCompressed:S===f||S===O||S===e,dxgiFormat:d,textureType:N}}static _GetHalfFloatAsFloatRGBAArrayBuffer(b,X,P,Q,S,d){const a=new Float32Array(Q),u=new Uint16Array(S,P);let w=0;for(let f=0;f<X;f++)for(let X=0;X<b;X++){const P=4*(X+f*b);a[w]=(0,N.h)(u[P]),a[w+1]=(0,N.h)(u[P+1]),a[w+2]=(0,N.h)(u[P+2]),D.StoreLODInAlphaChannel?a[w+3]=d:a[w+3]=(0,N.h)(u[P+3]),w+=4}return a}static _GetHalfFloatRGBAArrayBuffer(b,X,P,Q,S,d){if(D.StoreLODInAlphaChannel){const a=new Uint16Array(Q),u=new Uint16Array(S,P);let w=0;for(let P=0;P<X;P++)for(let X=0;X<b;X++){const Q=4*(X+P*b);a[w]=u[Q],a[w+1]=u[Q+1],a[w+2]=u[Q+2],a[w+3]=(0,N.p)(d),w+=4}return a}return new Uint16Array(S,P,Q)}static _GetFloatRGBAArrayBuffer(b,X,P,Q,S,d){if(D.StoreLODInAlphaChannel){const N=new Float32Array(Q),a=new Float32Array(S,P);let u=0;for(let P=0;P<X;P++)for(let X=0;X<b;X++){const Q=4*(X+P*b);N[u]=a[Q],N[u+1]=a[Q+1],N[u+2]=a[Q+2],N[u+3]=d,u+=4}return N}return new Float32Array(S,P,Q)}static _GetFloatAsHalfFloatRGBAArrayBuffer(b,X,P,Q,S,d){const a=new Uint16Array(Q),u=new Float32Array(S,P);let w=0;for(let f=0;f<X;f++)for(let X=0;X<b;X++)a[w]=(0,N.p)(u[w]),a[w+1]=(0,N.p)(u[w+1]),a[w+2]=(0,N.p)(u[w+2]),D.StoreLODInAlphaChannel?a[w+3]=(0,N.p)(d):a[w+3]=(0,N.p)(u[w+3]),w+=4;return a}static _GetFloatAsUIntRGBAArrayBuffer(b,X,P,S,d,N){const a=new Uint8Array(S),u=new Float32Array(d,P);let w=0;for(let f=0;f<X;f++)for(let X=0;X<b;X++){const P=4*(X+f*b);a[w]=255*(0,Q.Clamp)(u[P]),a[w+1]=255*(0,Q.Clamp)(u[P+1]),a[w+2]=255*(0,Q.Clamp)(u[P+2]),D.StoreLODInAlphaChannel?a[w+3]=N:a[w+3]=255*(0,Q.Clamp)(u[P+3]),w+=4}return a}static _GetHalfFloatAsUIntRGBAArrayBuffer(b,X,P,S,d,a){const u=new Uint8Array(S),w=new Uint16Array(d,P);let f=0;for(let O=0;O<X;O++)for(let X=0;X<b;X++){const P=4*(X+O*b);u[f]=255*(0,Q.Clamp)((0,N.h)(w[P])),u[f+1]=255*(0,Q.Clamp)((0,N.h)(w[P+1])),u[f+2]=255*(0,Q.Clamp)((0,N.h)(w[P+2])),D.StoreLODInAlphaChannel?u[f+3]=a:u[f+3]=255*(0,Q.Clamp)((0,N.h)(w[P+3])),f+=4}return u}static _GetRGBAArrayBuffer(b,X,P,Q,S,d,N,a,u){const w=new Uint8Array(Q),f=new Uint8Array(S,P);let O=0;for(let e=0;e<X;e++)for(let X=0;X<b;X++){const P=4*(X+e*b);w[O]=f[P+d],w[O+1]=f[P+N],w[O+2]=f[P+a],w[O+3]=f[P+u],O+=4}return w}static _ExtractLongWordOrder(b){return 0===b||255===b||-16777216===b?0:1+D._ExtractLongWordOrder(b>>8)}static _GetRGBArrayBuffer(b,X,P,Q,S,d,N,a){const u=new Uint8Array(Q),w=new Uint8Array(S,P);let f=0;for(let O=0;O<X;O++)for(let X=0;X<b;X++){const P=3*(X+O*b);u[f]=w[P+d],u[f+1]=w[P+N],u[f+2]=w[P+a],f+=3}return u}static _GetLuminanceArrayBuffer(b,X,P,Q,S){const d=new Uint8Array(Q),N=new Uint8Array(S,P);let a=0;for(let u=0;u<X;u++)for(let X=0;X<b;X++){const P=X+u*b;d[a]=N[P],a++}return d}static UploadDDSLevels(b,X,P,Q,N,u){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,E=arguments.length>7?arguments[7]:void 0,t=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],B=null;Q.sphericalPolynomial&&(B=[]);const W=!!b.getCaps().s3tc;X.generateMipMaps=N;const n=new Int32Array(P.buffer,P.byteOffset,31);let y,h,L,Z,v,A,o,K=0,T=0,q=1;if(542327876!==n[0])return void S.b.Error("Invalid magic number in DDS header");if(!Q.isFourCC&&!Q.isRGB&&!Q.isLuminance)return void S.b.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(Q.isCompressed&&!W)return void S.b.Error("Compressed textures are not supported on this platform.");let V=n[22];Z=n[1]+4;let i=!1;if(Q.isFourCC)switch(y=n[21],y){case f:q=8,T=33777;break;case O:q=16,T=33778;break;case e:q=16,T=33779;break;case 113:i=!0,V=64;break;case 116:i=!0,V=128;break;case Y:{Z+=20;let b=!1;switch(Q.dxgiFormat){case 10:i=!0,V=64,b=!0;break;case 2:i=!0,V=128,b=!0;break;case 88:Q.isRGB=!0,Q.isFourCC=!1,V=32,b=!0}if(b)break}default:return void S.b.Error(["Unsupported FourCC code:",(x=y,String.fromCharCode(255&x,x>>8&255,x>>16&255,x>>24&255))])}var x;const H=D._ExtractLongWordOrder(n[23]),C=D._ExtractLongWordOrder(n[24]),p=D._ExtractLongWordOrder(n[25]),k=D._ExtractLongWordOrder(n[26]);i&&(T=b._getRGBABufferInternalSizedFormat(Q.textureType)),A=1,n[2]&a&&!1!==N&&(A=Math.max(1,n[7]));const z=E||0,U=b.getCaps();for(let S=z;S<u;S++){for(h=n[4],L=n[3],o=0;o<A;++o){if(-1===w||w===o){const d=-1===w?o:0;if(!Q.isCompressed&&Q.isFourCC){X.format=5,K=h*L*4;let Q=null;if(b._badOS||b._badDesktopOS||!U.textureHalfFloat&&!U.textureFloat)128===V?(Q=D._GetFloatAsUIntRGBAArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,d),B&&0==d&&B.push(D._GetFloatRGBAArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,d))):64===V&&(Q=D._GetHalfFloatAsUIntRGBAArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,d),B&&0==d&&B.push(D._GetHalfFloatAsFloatRGBAArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,d))),X.type=0;else{const b=U.textureFloat&&(t&&U.textureFloatLinearFiltering||!t),S=U.textureHalfFloat&&(t&&U.textureHalfFloatLinearFiltering||!t),N=(128===V||64===V&&!S)&&b?1:(64===V||128===V&&!b)&&S?2:0;let a,u=null;if(128===V)switch(N){case 1:a=D._GetFloatRGBAArrayBuffer,u=null;break;case 2:a=D._GetFloatAsHalfFloatRGBAArrayBuffer,u=D._GetFloatRGBAArrayBuffer;break;case 0:a=D._GetFloatAsUIntRGBAArrayBuffer,u=D._GetFloatRGBAArrayBuffer}else switch(N){case 1:a=D._GetHalfFloatAsFloatRGBAArrayBuffer,u=null;break;case 2:a=D._GetHalfFloatRGBAArrayBuffer,u=D._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:a=D._GetHalfFloatAsUIntRGBAArrayBuffer,u=D._GetHalfFloatAsFloatRGBAArrayBuffer}X.type=N,Q=a(h,L,P.byteOffset+Z,K,P.buffer,d),B&&0==d&&B.push(u?u(h,L,P.byteOffset+Z,K,P.buffer,d):Q)}Q&&b._uploadDataToTextureDirectly(X,Q,S,d)}else if(Q.isRGB)X.type=0,24===V?(X.format=4,K=h*L*3,v=D._GetRGBArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,H,C,p),b._uploadDataToTextureDirectly(X,v,S,d)):(X.format=5,K=h*L*4,v=D._GetRGBAArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer,H,C,p,k),b._uploadDataToTextureDirectly(X,v,S,d));else if(Q.isLuminance){const Q=b._getUnpackAlignement(),N=h;K=Math.floor((h+Q-1)/Q)*Q*(L-1)+N,v=D._GetLuminanceArrayBuffer(h,L,P.byteOffset+Z,K,P.buffer),X.format=1,X.type=0,b._uploadDataToTextureDirectly(X,v,S,d)}else K=Math.max(4,h)/4*Math.max(4,L)/4*q,v=new Uint8Array(P.buffer,P.byteOffset+Z,K),X.type=0,b._uploadCompressedDataToTextureDirectly(X,T,h,L,v,S,d)}Z+=V?h*L*(V/8):K,h*=.5,L*=.5,h=Math.max(1,h),L=Math.max(1,L)}if(void 0!==E)break}B&&B.length>0?Q.sphericalPolynomial=d.e.ConvertCubeMapToSphericalPolynomial({size:n[4],right:B[0],left:B[1],up:B[2],down:B[3],front:B[4],back:B[5],format:5,type:1,gammaSpace:!1}):Q.sphericalPolynomial=void 0}}D.StoreLODInAlphaChannel=!1}}]);