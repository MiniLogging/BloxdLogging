"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[23],{12103:(C,U,K)=>{K.d(U,{b:()=>X});var m=K(11827),O=K(11905);class X{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var C;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||K&&!this.pickedMesh.isVerticesDataPresent(O.d.NormalKind))return null;let X,A=this.pickedMesh.je();0===(null===(C=A)||void 0===C?void 0:C.length)&&(A=null);const e=m.TmpVectors.bU[0],t=m.TmpVectors.bU[1],z=m.TmpVectors.bU[2];if(K){const C=this.pickedMesh.getVerticesData(O.d.NormalKind);let U=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId],e):e.Ee(C[3*this.faceId*3],C[3*this.faceId*3+1],C[3*this.faceId*3+2]),K=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId+1],t):t.Ee(C[3*(3*this.faceId+1)],C[3*(3*this.faceId+1)+1],C[3*(3*this.faceId+1)+2]),j=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId+2],z):z.Ee(C[3*(3*this.faceId+2)],C[3*(3*this.faceId+2)+1],C[3*(3*this.faceId+2)+2]);U=U.scale(this.bu),K=K.scale(this.bv),j=j.scale(1-this.bu-this.bv),X=new m.bU(U.x+K.x+j.x,U.y+K.y+j.y,U.z+K.z+j.z)}else{const C=this.pickedMesh.getVerticesData(O.d.PositionKind),U=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId],e):e.Ee(C[3*this.faceId*3],C[3*this.faceId*3+1],C[3*this.faceId*3+2]),K=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId+1],t):t.Ee(C[3*(3*this.faceId+1)],C[3*(3*this.faceId+1)+1],C[3*(3*this.faceId+1)+2]),j=A?m.bU.FromArrayToRef(C,3*A[3*this.faceId+2],z):z.Ee(C[3*(3*this.faceId+2)],C[3*(3*this.faceId+2)+1],C[3*(3*this.faceId+2)+2]),p=U.vU(K),E=j.vU(K);X=m.bU.Cross(p,E)}const j=(C,U)=>{if(-1!==this.thinInstanceIndex){const K=C.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];K&&m.bU.TransformNormalToRef(U,K,U)}let K=C.getWorldMatrix();C.nonUniformScaling&&(m.TmpVectors.Matrix[0].m(K),K=m.TmpVectors.Matrix[0],K.setTranslationFromFloats(0,0,0),K.invert(),K.transposeToRef(m.TmpVectors.Matrix[1]),K=m.TmpVectors.Matrix[1]),m.bU.TransformNormalToRef(U,K,U)};if(U&&j(this.pickedMesh,X),this.ray){const C=m.TmpVectors.bU[0].m(X);U||j(this.pickedMesh,C),m.bU.Dot(C,this.ray.direction)>0&&X.negateInPlace()}return X.normalize(),X}getTextureCoordinates(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.d.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(C))return null;const U=this.pickedMesh.je();if(!U)return null;const K=this.pickedMesh.getVerticesData(C);if(!K)return null;let X=m.Vector2.FU(K,2*U[3*this.faceId]),A=m.Vector2.FU(K,2*U[3*this.faceId+1]),e=m.Vector2.FU(K,2*U[3*this.faceId+2]);return X=X.scale(this.bu),A=A.scale(this.bv),e=e.scale(1-this.bu-this.bv),new m.Vector2(X.x+A.x+e.x,X.y+A.y+e.y)}}},12131:(C,U,K)=>{var m;K.d(U,{e:()=>O}),function(C){C[C.PointerMove=0]="PointerMove",C[C.PointerDown=1]="PointerDown",C[C.PointerUp=2]="PointerUp"}(m||(m={}));class O{}O.DOM_DELTA_PIXEL=0,O.DOM_DELTA_LINE=1,O.DOM_DELTA_PAGE=2},12123:(C,U,K)=>{K.d(U,{e:()=>m,i:()=>X,m:()=>O});class m{}m.KEYDOWN=1,m.KEYUP=2;class O{constructor(C,U){this.type=C,this.event=U}}class X extends O{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(C){this.skipOnKeyboardObservable=C}constructor(C,U){super(C,U),this.type=C,this.event=U,this.skipOnKeyboardObservable=!1}}},12116:(C,U,K)=>{K.d(U,{b:()=>O,e:()=>A,i:()=>e});var m=K(11827);class O{}O.POINTERDOWN=1,O.POINTERUP=2,O.POINTERMOVE=4,O.POINTERWHEEL=8,O.POINTERPICK=16,O.POINTERTAP=32,O.POINTERDOUBLETAP=64;class X{constructor(C,U){this.type=C,this.event=U}}class A extends X{constructor(C,U,K,O){super(C,U),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new m.Vector2(K,O)}}class e extends X{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(C,U),this._pickInfo=K,this._inputManager=m}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},12144:(C,U,K)=>{K.d(U,{e:()=>m});class m{static CompareLightsPriority(C,U){return C.shadowEnabled!==U.shadowEnabled?(U.shadowEnabled?1:0)-(C.shadowEnabled?1:0):U.renderPriority-C.renderPriority}}m.FALLOFF_DEFAULT=0,m.FALLOFF_PHYSICAL=1,m.FALLOFF_GLTF=2,m.FALLOFF_STANDARD=3,m.LIGHTMAP_DEFAULT=0,m.LIGHTMAP_SPECULAR=1,m.LIGHTMAP_SHADOWSONLY=2,m.INTENSITYMODE_AUTOMATIC=0,m.INTENSITYMODE_LUMINOUSPOWER=1,m.INTENSITYMODE_LUMINOUSINTENSITY=2,m.INTENSITYMODE_ILLUMINANCE=3,m.INTENSITYMODE_LUMINANCE=4,m.LIGHTTYPEID_POINTLIGHT=0,m.LIGHTTYPEID_DIRECTIONALLIGHT=1,m.LIGHTTYPEID_SPOTLIGHT=2,m.LIGHTTYPEID_HEMISPHERICLIGHT=3,m.LIGHTTYPEID_RECT_AREALIGHT=4},12086:(C,U,K)=>{function m(C){C.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}K.d(U,{e:()=>m})},12093:(C,U,K)=>{K.d(U,{b:()=>X,e:()=>O});var m=K(12086);function O(C,U){U.EXPOSURE&&C.push("exposureLinear"),U.CONTRAST&&C.push("contrast"),U.COLORGRADING&&C.push("colorTransformSettings"),(U.VIGNETTE||U.DITHER)&&C.push("vInverseScreenSize"),U.VIGNETTE&&(C.push("vignetteSettings1"),C.push("vignetteSettings2")),U.COLORCURVES&&(0,m.e)(C),U.DITHER&&C.push("ditherIntensity")}function X(C,U){U.COLORGRADING&&C.push("txColorTransform")}},12084:(C,U,K)=>{K.d(U,{c:()=>u});var m=K(11810),O=K(11818),X=K(11663),A=K(11879),e=K(11863),t=K(12086);class z{constructor(){this._dirty=!0,this._tempColor=new A.ve(0,0,0,0),this._globalCurve=new A.ve(0,0,0,0),this._highlightsCurve=new A.ve(0,0,0,0),this._midtonesCurve=new A.ve(0,0,0,0),this._shadowsCurve=new A.ve(0,0,0,0),this._positiveCurve=new A.ve(0,0,0,0),this._negativeCurve=new A.ve(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(C){this._globalHue=C,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(C){this._globalDensity=C,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(C){this._globalSaturation=C,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(C){this._globalExposure=C,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(C){this._highlightsHue=C,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(C){this._highlightsDensity=C,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(C){this._highlightsSaturation=C,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(C){this._highlightsExposure=C,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(C){this._midtonesHue=C,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(C){this._midtonesDensity=C,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(C){this._midtonesSaturation=C,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(C){this._midtonesExposure=C,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(C){this._shadowsHue=C,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(C){this._shadowsDensity=C,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(C){this._shadowsSaturation=C,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(C){this._shadowsExposure=C,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";C._dirty&&(C._dirty=!1,C._getColorGradingDataToRef(C._globalHue,C._globalDensity,C._globalSaturation,C._globalExposure,C._globalCurve),C._getColorGradingDataToRef(C._highlightsHue,C._highlightsDensity,C._highlightsSaturation,C._highlightsExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._highlightsCurve),C._getColorGradingDataToRef(C._midtonesHue,C._midtonesDensity,C._midtonesSaturation,C._midtonesExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._midtonesCurve),C._getColorGradingDataToRef(C._shadowsHue,C._shadowsDensity,C._shadowsSaturation,C._shadowsExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._shadowsCurve),C._highlightsCurve.subtractToRef(C._midtonesCurve,C._positiveCurve),C._midtonesCurve.subtractToRef(C._shadowsCurve,C._negativeCurve)),U&&(U.setFloat4(K,C._positiveCurve.r,C._positiveCurve.g,C._positiveCurve.b,C._positiveCurve.a),U.setFloat4(m,C._midtonesCurve.r,C._midtonesCurve.g,C._midtonesCurve.b,C._midtonesCurve.a),U.setFloat4(O,C._negativeCurve.r,C._negativeCurve.g,C._negativeCurve.b,C._negativeCurve.a))}_getColorGradingDataToRef(C,U,K,m,O){null!=C&&(C=z._Clamp(C,0,360),U=z._Clamp(U,-100,100),K=z._Clamp(K,-100,100),m=z._Clamp(m,-100,100),U=z._ApplyColorGradingSliderNonlinear(U),U*=.5,m=z._ApplyColorGradingSliderNonlinear(m),U<0&&(U*=-1,C=(C+180)%360),z._FromHSBToRef(C,U,50+.25*m,O),O.scaleToRef(2,O),O.a=1+.01*K)}static _ApplyColorGradingSliderNonlinear(C){C/=100;let U=Math.abs(C);return U=Math.pow(U,2),C<0&&(U*=-1),U*=100,U}static _FromHSBToRef(C,U,K,m){let O=z._Clamp(C,0,360);const X=z._Clamp(U/100,0,1),A=z._Clamp(K/100,0,1);if(0===X)m.r=A,m.g=A,m.b=A;else{O/=60;const C=Math.floor(O),U=O-C,K=A*(1-X),e=A*(1-X*U),t=A*(1-X*(1-U));switch(C){case 0:m.r=A,m.g=t,m.b=K;break;case 1:m.r=e,m.g=A,m.b=K;break;case 2:m.r=K,m.g=A,m.b=t;break;case 3:m.r=K,m.g=e,m.b=A;break;case 4:m.r=t,m.g=K,m.b=A;break;default:m.r=A,m.g=K,m.b=e}}m.a=1}static _Clamp(C,U,K){return Math.min(Math.max(C,U),K)}clone(){return e.c.Clone((()=>new z),this)}serialize(){return e.c.Serialize(this)}static Parse(C){return e.c.Parse((()=>new z),C,null,null)}}z.PrepareUniforms=t.e,(0,m.d)([(0,O.O)()],z.prototype,"_globalHue",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_globalDensity",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_globalSaturation",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_globalExposure",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_highlightsHue",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_highlightsDensity",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_highlightsSaturation",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_highlightsExposure",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_midtonesHue",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_midtonesDensity",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_midtonesSaturation",void 0),(0,m.d)([(0,O.O)()],z.prototype,"_midtonesExposure",void 0),e.c._ColorCurvesParser=z.Parse;var j=K(11802),p=K(12093),E=K(11789);class u{constructor(){this.colorCurves=new z,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=u.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new A.ve(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=u.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new X.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(C){this._colorCurvesEnabled!==C&&(this._colorCurvesEnabled=C,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(C){this._colorGradingTexture!==C&&(this._colorGradingTexture=C,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(C){this._colorGradingEnabled!==C&&(this._colorGradingEnabled=C,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(C){this._colorGradingWithGreenDepth!==C&&(this._colorGradingWithGreenDepth=C,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(C){this._colorGradingBGR!==C&&(this._colorGradingBGR=C,this._updateParameters())}get exposure(){return this._exposure}set exposure(C){this._exposure!==C&&(this._exposure=C,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(C){this._toneMappingEnabled!==C&&(this._toneMappingEnabled=C,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(C){this._toneMappingType!==C&&(this._toneMappingType=C,this._updateParameters())}get contrast(){return this._contrast}set contrast(C){this._contrast!==C&&(this._contrast=C,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(C){this.vignetteCenterY=C}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(C){this.vignetteCenterX=C}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(C){this._vignetteBlendMode!==C&&(this._vignetteBlendMode=C,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(C){this._vignetteEnabled!==C&&(this._vignetteEnabled=C,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(C){this._ditheringEnabled!==C&&(this._ditheringEnabled=C,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(C){this._ditheringIntensity!==C&&(this._ditheringIntensity=C,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(C){this._skipFinalColorClamp!==C&&(this._skipFinalColorClamp=C,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(C){this._applyByPostProcess!==C&&(this._applyByPostProcess=C,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(C){this._isEnabled!==C&&(this._isEnabled=C,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(C){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return C.VIGNETTE=!1,C.TONEMAPPING=0,C.CONTRAST=!1,C.EXPOSURE=!1,C.COLORCURVES=!1,C.COLORGRADING=!1,C.COLORGRADING3D=!1,C.DITHER=!1,C.IMAGEPROCESSING=!1,C.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(C.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(C.VIGNETTE=this.vignetteEnabled,C.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===u._VIGNETTEMODE_MULTIPLY,C.VIGNETTEBLENDMODEOPAQUE=!C.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case u.TONEMAPPING_KHR_PBR_NEUTRAL:C.TONEMAPPING=3;break;case u.TONEMAPPING_ACES:C.TONEMAPPING=2;break;default:C.TONEMAPPING=1}else C.TONEMAPPING=0;C.CONTRAST=1!==this.contrast,C.EXPOSURE=1!==this.exposure,C.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,C.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,C.COLORGRADING?C.COLORGRADING3D=this.colorGradingTexture.is3D:C.COLORGRADING3D=!1,C.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,C.SAMPLER3DBGRMAP=this.colorGradingBGR,C.DITHER=this._ditheringEnabled,C.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,C.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,C.IMAGEPROCESSING=C.VIGNETTE||!!C.TONEMAPPING||C.CONTRAST||C.EXPOSURE||C.COLORCURVES||C.COLORGRADING||C.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(C,U){if(this._colorCurvesEnabled&&this.colorCurves&&z.Bind(this.colorCurves,C),this._vignetteEnabled||this._ditheringEnabled){const K=1/(this.outputTextureWidth||C.getEngine().getRenderWidth()),m=1/(this.outputTextureHeight||C.getEngine().getRenderHeight());if(C.setFloat2("vInverseScreenSize",K,m),this._ditheringEnabled&&C.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const O=null!=U?U:m/K;let X=Math.tan(.5*this.vignetteCameraFov),A=X*O;const e=Math.sqrt(A*X);A=(0,j.i)(A,e,this.vignetteStretch),X=(0,j.i)(X,e,this.vignetteStretch),C.setFloat4("vignetteSettings1",A,X,-A*this.vignetteCenterX,-X*this.vignetteCenterY);const t=-2*this.vignetteWeight;C.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,t)}}if(C.setFloat("exposureLinear",this.exposure),C.setFloat("contrast",this.contrast),this.colorGradingTexture){C.setTexture("txColorTransform",this.colorGradingTexture);const U=this.colorGradingTexture.getSize().height;C.setFloat4("colorTransformSettings",(U-1)/U,.5/U,U,this.colorGradingTexture.level)}}clone(){return e.c.Clone((()=>new u),this)}serialize(){return e.c.Serialize(this)}static Parse(C){const U=e.c.Parse((()=>new u),C,null,null);return void 0!==C.vignetteCentreX&&(U.vignetteCenterX=C.vignetteCentreX),void 0!==C.vignetteCentreY&&(U.vignetteCenterY=C.vignetteCentreY),U}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}u.TONEMAPPING_STANDARD=0,u.TONEMAPPING_ACES=1,u.TONEMAPPING_KHR_PBR_NEUTRAL=2,u.PrepareUniforms=p.e,u.PrepareSamplers=p.b,u._VIGNETTEMODE_MULTIPLY=0,u._VIGNETTEMODE_OPAQUE=1,(0,m.d)([(0,O.k)()],u.prototype,"colorCurves",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_colorCurvesEnabled",void 0),(0,m.d)([(0,O.D)("colorGradingTexture")],u.prototype,"_colorGradingTexture",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_colorGradingEnabled",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_colorGradingWithGreenDepth",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_colorGradingBGR",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_exposure",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_toneMappingEnabled",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_toneMappingType",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_contrast",void 0),(0,m.d)([(0,O.O)()],u.prototype,"vignetteStretch",void 0),(0,m.d)([(0,O.O)()],u.prototype,"vignetteCenterX",void 0),(0,m.d)([(0,O.O)()],u.prototype,"vignetteCenterY",void 0),(0,m.d)([(0,O.O)()],u.prototype,"vignetteWeight",void 0),(0,m.d)([(0,O.s)()],u.prototype,"vignetteColor",void 0),(0,m.d)([(0,O.O)()],u.prototype,"vignetteCameraFov",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_vignetteBlendMode",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_vignetteEnabled",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_ditheringEnabled",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_ditheringIntensity",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_skipFinalColorClamp",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_applyByPostProcess",void 0),(0,m.d)([(0,O.O)()],u.prototype,"_isEnabled",void 0),(0,m.d)([(0,O.O)()],u.prototype,"outputTextureWidth",void 0),(0,m.d)([(0,O.O)()],u.prototype,"outputTextureHeight",void 0),e.c._ImageProcessingConfigurationParser=u.Parse,(0,E.h)("BABYLON.ImageProcessingConfiguration",u)},12099:(C,U,K)=>{K.d(U,{b:()=>X});var m=K(11679),O=K(11660);class X{constructor(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=C,this._noUBO=!C.supportsUniformBuffers||O,this._dynamic=K,this._name=m??"no-name",this._data=U||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.ee=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.ee=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(C){let U;if(U=C<=2?C:4,this._uniformLocationPointer%U!==0){const C=this._uniformLocationPointer;this._uniformLocationPointer+=U-this._uniformLocationPointer%U;const K=this._uniformLocationPointer-C;for(let U=0;U<K;U++)this._data.push(0)}}addUniform(C,U){let K,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[C]){if(m>0){if(U instanceof Array)throw"addUniform should not be use with Array in UBO: "+C;if(this._fillAlignment(4),this._uniformArraySizes[C]={strideSize:U,arraySize:m},16==U)U*=m;else{U=U*m+(4-U)*m}K=[];for(let C=0;C<U;C++)K.push(0)}else{if(U instanceof Array)K=U,U=K.length;else{K=[];for(let C=0;C<U;C++)K.push(0)}this._fillAlignment(U)}this._uniformSizes[C]=U,this._uniformLocations[C]=this._uniformLocationPointer,this._uniformLocationPointer+=U;for(let C=0;C<U;C++)this._data.push(K[C]);this._needSync=!0}}addMatrix(C,U){this.addUniform(C,Array.prototype.slice.call(U.Oe()))}addFloat2(C,U,K){const m=[U,K];this.addUniform(C,m)}addFloat3(C,U,K,m){const O=[U,K,m];this.addUniform(C,O)}addColor3(C,U){const K=[U.r,U.g,U.b];this.addUniform(C,K)}addColor4(C,U,K){const m=[U.r,U.g,U.b,K];this.addUniform(C,m)}addVector3(C,U){const K=[U.x,U.y,U.z];this.addUniform(C,K)}addMatrix3x3(C){this.addUniform(C,12)}addMatrix2x2(C){this.addUniform(C,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const C=[];let U=0;for(const K in this._uniformLocations)if(C.push(K),10===++U)break;return C.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(C,U){for(let K=0;K<C.length;++K)if(C[K]!==U[K])return!1;return!0}_copyBuffer(C,U){for(let K=0;K<C.length;++K)U[K]=C[K]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(X._UpdatedUbosInFrame[this._name]||(X._UpdatedUbosInFrame[this._name]=0),X._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(C,U,K){this._checkNewFrame();let O=this._uniformLocations[C];if(void 0===O){if(this._buffer)return void m.d.Error("Cannot add an uniform after UBO has been created. uniformName="+C);this.addUniform(C,K),O=this._uniformLocations[C]}if(this._buffer||this.create(),this._dynamic)for(let m=0;m<K;m++)this._bufferData[O+m]=U[m];else{let C=!1;for(let m=0;m<K;m++)(16===K&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[O+m]!==Math.fround(U[m]))&&(C=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[O+m]=U[m]);this._needSync=this._needSync||C}}updateUniformArray(C,U,K){this._checkNewFrame();const X=this._uniformLocations[C];if(void 0===X)return void m.d.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const A=this._uniformArraySizes[C];if(this._dynamic)for(let m=0;m<K;m++)this._bufferData[X+m]=U[m];else{let C=!1,m=0,e=0;for(let t=0;t<K;t++)if(this._bufferData[X+4*e+m]!==O.Tools.FloatRound(U[t])&&(C=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[X+4*e+m]=U[t]),m++,m===A.strideSize){for(;m<4;m++)this._bufferData[X+4*e+m]=0;m=0,e++}this._needSync=this._needSync||C}}_cacheMatrix(C,U){this._checkNewFrame();const K=this._valueCache[C],m=U.updateFlag;return(void 0===K||K!==m)&&(this._valueCache[C]=m,!0)}_updateMatrix3x3ForUniform(C,U){for(let K=0;K<3;K++)X._TempBuffer[4*K]=U[3*K],X._TempBuffer[4*K+1]=U[3*K+1],X._TempBuffer[4*K+2]=U[3*K+2],X._TempBuffer[4*K+3]=0;this.updateUniform(C,X._TempBuffer,12)}_updateMatrix3x3ForEffect(C,U){this._currentEffect.setMatrix3x3(C,U)}_updateMatrix2x2ForEffect(C,U){this._currentEffect.setMatrix2x2(C,U)}_updateMatrix2x2ForUniform(C,U){for(let K=0;K<2;K++)X._TempBuffer[4*K]=U[2*K],X._TempBuffer[4*K+1]=U[2*K+1],X._TempBuffer[4*K+2]=0,X._TempBuffer[4*K+3]=0;this.updateUniform(C,X._TempBuffer,8)}_updateFloatForEffect(C,U){this._currentEffect.setFloat(C,U)}_updateFloatForUniform(C,U){X._TempBuffer[0]=U,this.updateUniform(C,X._TempBuffer,1)}_updateFloat2ForEffect(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(C+m,U,K)}_updateFloat2ForUniform(C,U,K){X._TempBuffer[0]=U,X._TempBuffer[1]=K,this.updateUniform(C,X._TempBuffer,2)}_updateFloat3ForEffect(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(C+O,U,K,m)}_updateFloat3ForUniform(C,U,K,m){X._TempBuffer[0]=U,X._TempBuffer[1]=K,X._TempBuffer[2]=m,this.updateUniform(C,X._TempBuffer,3)}_updateFloat4ForEffect(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(C+X,U,K,m,O)}_updateFloat4ForUniform(C,U,K,m,O){X._TempBuffer[0]=U,X._TempBuffer[1]=K,X._TempBuffer[2]=m,X._TempBuffer[3]=O,this.updateUniform(C,X._TempBuffer,4)}_updateFloatArrayForEffect(C,U){this._currentEffect.setFloatArray(C,U)}_updateFloatArrayForUniform(C,U){this.updateUniformArray(C,U,U.length)}_updateArrayForEffect(C,U){this._currentEffect.setArray(C,U)}_updateArrayForUniform(C,U){this.updateUniformArray(C,U,U.length)}_updateIntArrayForEffect(C,U){this._currentEffect.setIntArray(C,U)}_updateIntArrayForUniform(C,U){X._TempBufferInt32View.set(U),this.updateUniformArray(C,X._TempBuffer,U.length)}_updateUIntArrayForEffect(C,U){this._currentEffect.setUIntArray(C,U)}_updateUIntArrayForUniform(C,U){X._TempBufferUInt32View.set(U),this.updateUniformArray(C,X._TempBuffer,U.length)}_updateMatrixForEffect(C,U){this._currentEffect.setMatrix(C,U)}_updateMatrixForUniform(C,U){this._cacheMatrix(C,U)&&this.updateUniform(C,U.Oe(),16)}_updateMatricesForEffect(C,U){this._currentEffect.setMatrices(C,U)}_updateMatricesForUniform(C,U){this.updateUniform(C,U,U.length)}_updateVector3ForEffect(C,U){this._currentEffect.setVector3(C,U)}_updateVector3ForUniform(C,U){X._TempBuffer[0]=U.x,X._TempBuffer[1]=U.y,X._TempBuffer[2]=U.z,this.updateUniform(C,X._TempBuffer,3)}_updateVector4ForEffect(C,U){this._currentEffect.setVector4(C,U)}_updateVector4ForUniform(C,U){X._TempBuffer[0]=U.x,X._TempBuffer[1]=U.y,X._TempBuffer[2]=U.z,X._TempBuffer[3]=U.w,this.updateUniform(C,X._TempBuffer,4)}_updateColor3ForEffect(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(C+K,U)}_updateColor3ForUniform(C,U){X._TempBuffer[0]=U.r,X._TempBuffer[1]=U.g,X._TempBuffer[2]=U.b,this.updateUniform(C,X._TempBuffer,3)}_updateColor4ForEffect(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(C+m,U,K)}_updateDirectColor4ForEffect(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(C+K,U)}_updateColor4ForUniform(C,U,K){X._TempBuffer[0]=U.r,X._TempBuffer[1]=U.g,X._TempBuffer[2]=U.b,X._TempBuffer[3]=K,this.updateUniform(C,X._TempBuffer,4)}_updateDirectColor4ForUniform(C,U){X._TempBuffer[0]=U.r,X._TempBuffer[1]=U.g,X._TempBuffer[2]=U.b,X._TempBuffer[3]=U.a,this.updateUniform(C,X._TempBuffer,4)}_updateIntForEffect(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(C+K,U)}_updateIntForUniform(C,U){X._TempBufferInt32View[0]=U,this.updateUniform(C,X._TempBuffer,1)}_updateInt2ForEffect(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(C+m,U,K)}_updateInt2ForUniform(C,U,K){X._TempBufferInt32View[0]=U,X._TempBufferInt32View[1]=K,this.updateUniform(C,X._TempBuffer,2)}_updateInt3ForEffect(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(C+O,U,K,m)}_updateInt3ForUniform(C,U,K,m){X._TempBufferInt32View[0]=U,X._TempBufferInt32View[1]=K,X._TempBufferInt32View[2]=m,this.updateUniform(C,X._TempBuffer,3)}_updateInt4ForEffect(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(C+X,U,K,m,O)}_updateInt4ForUniform(C,U,K,m,O){X._TempBufferInt32View[0]=U,X._TempBufferInt32View[1]=K,X._TempBufferInt32View[2]=m,X._TempBufferInt32View[3]=O,this.updateUniform(C,X._TempBuffer,4)}_updateUIntForEffect(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(C+K,U)}_updateUIntForUniform(C,U){X._TempBufferUInt32View[0]=U,this.updateUniform(C,X._TempBuffer,1)}_updateUInt2ForEffect(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(C+m,U,K)}_updateUInt2ForUniform(C,U,K){X._TempBufferUInt32View[0]=U,X._TempBufferUInt32View[1]=K,this.updateUniform(C,X._TempBuffer,2)}_updateUInt3ForEffect(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(C+O,U,K,m)}_updateUInt3ForUniform(C,U,K,m){X._TempBufferUInt32View[0]=U,X._TempBufferUInt32View[1]=K,X._TempBufferUInt32View[2]=m,this.updateUniform(C,X._TempBuffer,3)}_updateUInt4ForEffect(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(C+X,U,K,m,O)}_updateUInt4ForUniform(C,U,K,m,O){X._TempBufferUInt32View[0]=U,X._TempBufferUInt32View[1]=K,X._TempBufferUInt32View[2]=m,X._TempBufferUInt32View[3]=O,this.updateUniform(C,X._TempBuffer,4)}setTexture(C,U){this._currentEffect.setTexture(C,U)}setTextureArray(C,U){this._currentEffect.setTextureArray(C,U)}bindTexture(C,U){this._currentEffect._bindTexture(C,U)}updateUniformDirectly(C,U){this.updateUniform(C,U,U.length),this.update()}bindToEffect(C,U){this._currentEffect=C,this._currentEffectName=U}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(C){if(!this._buffers)return this._buffer===C;for(let U=0;U<this._buffers.length;++U){if(this._buffers[U][0]===C)return this._bufferIndex=U,this._buffer=C,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[U][1]&&this._bufferData.set(this._buffers[U][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const C=this._engine._uniformBuffers,U=C.indexOf(this);if(-1!==U&&(C[U]=C[C.length-1],C.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let K=0;K<this._buffers.length;++K){const C=this._buffers[K][0];this._engine._releaseBuffer(C)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}X._UpdatedUbosInFrame={},X._MAX_UNIFORM_SIZE=256,X._TempBuffer=new Float32Array(X._MAX_UNIFORM_SIZE),X._TempBufferInt32View=new Int32Array(X._TempBuffer.buffer),X._TempBufferUInt32View=new Uint32Array(X._TempBuffer.buffer)},12142:(C,U,K)=>{K.d(U,{e:()=>m});class m{static get UniqueId(){const C=this._UniqueIdCounter;return this._UniqueIdCounter++,C}}m._UniqueIdCounter=1},12138:(C,U,K)=>{K.d(U,{e:()=>m});class m{}m._IsPickingAvailable=!1},12078:(C,U,K)=>{K.d(U,{b:()=>CC});var m=K(11660),O=K(11688),X=K(11663),A=K(11930);class e{constructor(){this._count=0,this._data={}}m(C){this.clear(),C.forEach(((C,U)=>this.add(C,U)))}get(C){const U=this._data[C];if(void 0!==U)return U}getOrAddWithFactory(C,U){let K=this.get(C);return void 0!==K||(K=U(C),K&&this.add(C,K)),K}getOrAdd(C,U){const K=this.get(C);return void 0!==K?K:(this.add(C,U),U)}contains(C){return void 0!==this._data[C]}add(C,U){return void 0===this._data[C]&&(this._data[C]=U,++this._count,!0)}set(C,U){return void 0!==this._data[C]&&(this._data[C]=U,!0)}getAndRemove(C){const U=this.get(C);return void 0!==U?(delete this._data[C],--this._count,U):null}remove(C){return!!this.contains(C)&&(delete this._data[C],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(C){for(const U in this._data){C(U,this._data[U])}}first(C){for(const U in this._data){const K=C(U,this._data[U]);if(K)return K}return null}}var t=K(11872),z=K(11827),j=K(12084),p=K(12099),E=K(12103);class u{constructor(C,U,K,m,O,X){this.source=C,this.pointerX=U,this.pointerY=K,this.meshUnderPointer=m,this.sourceEvent=O,this.additionalData=X}static CreateNew(C,U,K){const m=C.dC();return new u(C,m.pointerX,m.pointerY,m.meshUnderPointer||C,U,K)}static CreateNewFromSprite(C,U,K,m){return new u(C,U.pointerX,U.pointerY,U.meshUnderPointer,K,m)}static CreateNewFromScene(C,U){return new u(null,C.pointerX,C.pointerY,C.meshUnderPointer,U)}static CreateNewFromPrimitive(C,U,K,m){return new u(C,U.x,U.y,null,K,m)}}var b=K(11900),v=K(11923),Q=K(12109),V=K(11670),f=K(11703),F=K(11696),Z=K(12116);class P{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const C in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,C))return!0;return!1}static get HasPickTriggers(){for(const C in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,C)){const U=parseInt(C);if(U>=1&&U<=7)return!0}return!1}static HasSpecificTrigger(C){for(const U in P.Triggers)if(Object.prototype.hasOwnProperty.call(P.Triggers,U)){if(parseInt(U)===C)return!0}return!1}}P.Triggers={};var H,d,T,y,a,r,i,D=K(12123);!function(C){C[C.Generic=0]="Generic",C[C.Keyboard=1]="Keyboard",C[C.Mouse=2]="Mouse",C[C.Touch=3]="Touch",C[C.DualShock=4]="DualShock",C[C.Xbox=5]="Xbox",C[C.Switch=6]="Switch",C[C.DualSense=7]="DualSense"}(H||(H={})),function(C){C[C.Horizontal=0]="Horizontal",C[C.Vertical=1]="Vertical",C[C.LeftClick=2]="LeftClick",C[C.MiddleClick=3]="MiddleClick",C[C.RightClick=4]="RightClick",C[C.BrowserBack=5]="BrowserBack",C[C.BrowserForward=6]="BrowserForward",C[C.MouseWheelX=7]="MouseWheelX",C[C.MouseWheelY=8]="MouseWheelY",C[C.MouseWheelZ=9]="MouseWheelZ",C[C.Move=12]="Move"}(d||(d={})),function(C){C[C.Horizontal=0]="Horizontal",C[C.Vertical=1]="Vertical",C[C.LeftClick=2]="LeftClick",C[C.MiddleClick=3]="MiddleClick",C[C.RightClick=4]="RightClick",C[C.BrowserBack=5]="BrowserBack",C[C.BrowserForward=6]="BrowserForward",C[C.MouseWheelX=7]="MouseWheelX",C[C.MouseWheelY=8]="MouseWheelY",C[C.MouseWheelZ=9]="MouseWheelZ",C[C.DeltaHorizontal=10]="DeltaHorizontal",C[C.DeltaVertical=11]="DeltaVertical"}(T||(T={})),function(C){C[C.Cross=0]="Cross",C[C.Circle=1]="Circle",C[C.Square=2]="Square",C[C.Triangle=3]="Triangle",C[C.L1=4]="L1",C[C.R1=5]="R1",C[C.L2=6]="L2",C[C.R2=7]="R2",C[C.Share=8]="Share",C[C.Options=9]="Options",C[C.L3=10]="L3",C[C.R3=11]="R3",C[C.DPadUp=12]="DPadUp",C[C.DPadDown=13]="DPadDown",C[C.DPadLeft=14]="DPadLeft",C[C.DPadRight=15]="DPadRight",C[C.Home=16]="Home",C[C.TouchPad=17]="TouchPad",C[C.LStickXAxis=18]="LStickXAxis",C[C.LStickYAxis=19]="LStickYAxis",C[C.RStickXAxis=20]="RStickXAxis",C[C.RStickYAxis=21]="RStickYAxis"}(y||(y={})),function(C){C[C.Cross=0]="Cross",C[C.Circle=1]="Circle",C[C.Square=2]="Square",C[C.Triangle=3]="Triangle",C[C.L1=4]="L1",C[C.R1=5]="R1",C[C.L2=6]="L2",C[C.R2=7]="R2",C[C.Create=8]="Create",C[C.Options=9]="Options",C[C.L3=10]="L3",C[C.R3=11]="R3",C[C.DPadUp=12]="DPadUp",C[C.DPadDown=13]="DPadDown",C[C.DPadLeft=14]="DPadLeft",C[C.DPadRight=15]="DPadRight",C[C.Home=16]="Home",C[C.TouchPad=17]="TouchPad",C[C.LStickXAxis=18]="LStickXAxis",C[C.LStickYAxis=19]="LStickYAxis",C[C.RStickXAxis=20]="RStickXAxis",C[C.RStickYAxis=21]="RStickYAxis"}(a||(a={})),function(C){C[C.A=0]="A",C[C.B=1]="B",C[C.X=2]="X",C[C.Y=3]="Y",C[C.LB=4]="LB",C[C.RB=5]="RB",C[C.LT=6]="LT",C[C.RT=7]="RT",C[C.Back=8]="Back",C[C.Start=9]="Start",C[C.LS=10]="LS",C[C.RS=11]="RS",C[C.DPadUp=12]="DPadUp",C[C.DPadDown=13]="DPadDown",C[C.DPadLeft=14]="DPadLeft",C[C.DPadRight=15]="DPadRight",C[C.Home=16]="Home",C[C.LStickXAxis=17]="LStickXAxis",C[C.LStickYAxis=18]="LStickYAxis",C[C.RStickXAxis=19]="RStickXAxis",C[C.RStickYAxis=20]="RStickYAxis"}(r||(r={})),function(C){C[C.B=0]="B",C[C.A=1]="A",C[C.Y=2]="Y",C[C.X=3]="X",C[C.L=4]="L",C[C.R=5]="R",C[C.ZL=6]="ZL",C[C.ZR=7]="ZR",C[C.Minus=8]="Minus",C[C.Plus=9]="Plus",C[C.LS=10]="LS",C[C.RS=11]="RS",C[C.DPadUp=12]="DPadUp",C[C.DPadDown=13]="DPadDown",C[C.DPadLeft=14]="DPadLeft",C[C.DPadRight=15]="DPadRight",C[C.Home=16]="Home",C[C.Capture=17]="Capture",C[C.LStickXAxis=18]="LStickXAxis",C[C.LStickYAxis=19]="LStickYAxis",C[C.RStickXAxis=20]="RStickXAxis",C[C.RStickYAxis=21]="RStickYAxis"}(i||(i={}));var l=K(12131);class G{static CreateDeviceEvent(C,U,K,m,O,X,A){switch(C){case H.Keyboard:return this._CreateKeyboardEvent(K,m,O,X);case H.Mouse:if(K===d.MouseWheelX||K===d.MouseWheelY||K===d.MouseWheelZ)return this._CreateWheelEvent(C,U,K,m,O,X);case H.Touch:return this._CreatePointerEvent(C,U,K,m,O,X,A);default:throw`Unable to generate event for device ${H[C]}`}}static _CreatePointerEvent(C,U,K,m,O,X,A){const e=this._CreateMouseEvent(C,U,K,m,O,X);C===H.Mouse?(e.deviceType=H.Mouse,e.pointerId=1,e.pointerType="mouse"):(e.deviceType=H.Touch,e.pointerId=A??U,e.pointerType="touch");let t=0;return t+=O.pollInput(C,U,d.LeftClick),t+=2*O.pollInput(C,U,d.RightClick),t+=4*O.pollInput(C,U,d.MiddleClick),e.buttons=t,K===d.Move?e.type="pointermove":K>=d.LeftClick&&K<=d.RightClick&&(e.type=1===m?"pointerdown":"pointerup",e.button=K-2),e}static _CreateWheelEvent(C,U,K,m,O,X){const A=this._CreateMouseEvent(C,U,K,m,O,X);switch(A.pointerId=1,A.type="wheel",A.deltaMode=l.e.DOM_DELTA_PIXEL,A.deltaX=0,A.deltaY=0,A.deltaZ=0,K){case d.MouseWheelX:A.deltaX=m;break;case d.MouseWheelY:A.deltaY=m;break;case d.MouseWheelZ:A.deltaZ=m}return A}static _CreateMouseEvent(C,U,K,m,O,X){const A=this._CreateEvent(X),e=O.pollInput(C,U,d.Horizontal),t=O.pollInput(C,U,d.Vertical);return X?(A.movementX=0,A.movementY=0,A.offsetX=A.movementX-X.getBoundingClientRect().x,A.offsetY=A.movementY-X.getBoundingClientRect().y):(A.movementX=O.pollInput(C,U,10),A.movementY=O.pollInput(C,U,11),A.offsetX=0,A.offsetY=0),this._CheckNonCharacterKeys(A,O),A.clientX=e,A.clientY=t,A.x=e,A.y=t,A.deviceType=C,A.deviceSlot=U,A.inputIndex=K,A}static _CreateKeyboardEvent(C,U,K,m){const O=this._CreateEvent(m);return this._CheckNonCharacterKeys(O,K),O.deviceType=H.Keyboard,O.deviceSlot=0,O.inputIndex=C,O.type=1===U?"keydown":"keyup",O.key=String.fromCharCode(C),O.keyCode=C,O}static _CheckNonCharacterKeys(C,U){const K=U.isDeviceAvailable(H.Keyboard),m=K&&1===U.pollInput(H.Keyboard,0,18),O=K&&1===U.pollInput(H.Keyboard,0,17),X=K&&(1===U.pollInput(H.Keyboard,0,91)||1===U.pollInput(H.Keyboard,0,92)||1===U.pollInput(H.Keyboard,0,93)),A=K&&1===U.pollInput(H.Keyboard,0,16);C.altKey=m,C.ctrlKey=O,C.metaKey=X,C.shiftKey=A}static _CreateEvent(C){const U={preventDefault:()=>{}};return U.target=C,U}}class J{constructor(C,U,K){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(C,U,((C,U,m,O)=>{const X=G.CreateDeviceEvent(C,U,m,O,this);K(C,U,X)})):this._createDummyNativeInput()}pollInput(C,U,K){return this._nativeInput.pollInput(C,U,K)}isDeviceAvailable(C){return C===H.Mouse||C===H.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const o=Object.keys(d).length/2;class B{constructor(C,U,K,O){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=m.Tools.IsSafari(),this._usingMacOs=(0,V.f)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=C=>{},this._keyboardUpEvent=C=>{},this._keyboardBlurEvent=C=>{},this._pointerMoveEvent=C=>{},this._pointerDownEvent=C=>{},this._pointerUpEvent=C=>{},this._pointerCancelEvent=C=>{},this._pointerCancelTouch=C=>{},this._pointerLeaveEvent=C=>{},this._pointerWheelEvent=C=>{},this._pointerBlurEvent=C=>{},this._pointerMacOsChromeOutEvent=C=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,V.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,V.f)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=C=>{},this._gamepadDisconnectedEvent=C=>{},this._eventPrefix=m.Tools.GetPointerPrefix(C),this._engine=C,this._onDeviceConnected=U,this._onDeviceDisconnected=K,this._onInputChanged=O,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(C,U,K){const O=this._inputs[C][U];if(!O)throw`Unable to find device ${H[C]}`;C>=H.DualShock&&C<=H.DualSense&&this._updateDevice(C,U,K);const X=O[K];if(void 0===X)throw`Unable to find input ${K} for device ${H[C]} in slot ${U}`;return K===d.Move&&m.Tools.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),X}isDeviceAvailable(C){return void 0!==this._inputs[C]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const C=null===this||void 0===this?void 0:this._engine.getInputElement();if(C&&(!this._eventsAttached||this._elementToAttachTo!==C)){if(this._disableEvents(),this._inputs)for(const C of this._inputs)if(C)for(const U in C){const K=C[+U];if(K)for(let C=0;C<K.length;C++)K[C]=0}this._elementToAttachTo=C,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"MA",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const C=navigator.getGamepads();for(const U of C)U&&this._addGamePad(U)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(H.Mouse,0,0,0)}_addGamePad(C){const U=this._getGamepadDeviceType(C.id),K=C.index;this._gamepads=this._gamepads||new Array(C.index+1),this._registerDevice(U,K,C.buttons.length+C.axes.length),this._gamepads[K]=U}_addPointerDevice(C,U,K,m){this._pointerActive||(this._pointerActive=!0),this._registerDevice(C,U,o);const O=this._inputs[C][U];O[0]=K,O[1]=m}_registerDevice(C,U,K){if(void 0===U)throw`Unable to register device ${H[C]} to undefined slot.`;if(this._inputs[C]||(this._inputs[C]={}),!this._inputs[C][U]){const m=new Array(K);m.fill(0),this._inputs[C][U]=m,this._onDeviceConnected(C,U)}}_unregisterDevice(C,U){this._inputs[C][U]&&(delete this._inputs[C][U],this._onDeviceDisconnected(C,U))}_handleKeyActions(){this._keyboardDownEvent=C=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(H.Keyboard,0,255));const U=this._inputs[H.Keyboard][0];if(U){U[C.keyCode]=1;const K=C;K.inputIndex=C.keyCode,this._usingMacOs&&C.metaKey&&"Meta"!==C.key&&(this._metaKeys.includes(C.keyCode)||this._metaKeys.push(C.keyCode)),this._onInputChanged(H.Keyboard,0,K)}},this._keyboardUpEvent=C=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(H.Keyboard,0,255));const U=this._inputs[H.Keyboard][0];if(U){U[C.keyCode]=0;const K=C;if(K.inputIndex=C.keyCode,this._usingMacOs&&"Meta"===C.key&&this._metaKeys.length>0){for(const C of this._metaKeys){const K=G.CreateDeviceEvent(H.Keyboard,0,C,0,this,this._elementToAttachTo);U[C]=0,this._onInputChanged(H.Keyboard,0,K)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(H.Keyboard,0,K)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const C=this._inputs[H.Keyboard][0];for(let U=0;U<C.length;U++)if(0!==C[U]){C[U]=0;const K=G.CreateDeviceEvent(H.Keyboard,0,U,0,this,this._elementToAttachTo);this._onInputChanged(H.Keyboard,0,K)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,V.f)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let m=0;m<this._maxTouchPoints;m++)this._activeTouchIds[m]=-1;this._pointerMoveEvent=C=>{const U=this._getPointerType(C);let K=U===H.Mouse?0:this._activeTouchIds.indexOf(C.pointerId);if(U===H.Touch&&-1===K){const O=this._activeTouchIds.indexOf(-1);if(!(O>=0))return void m.Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);K=O,this._activeTouchIds[O]=C.pointerId,this._onDeviceConnected(U,K)}this._inputs[U]||(this._inputs[U]={}),this._inputs[U][K]||this._addPointerDevice(U,K,C.clientX,C.clientY);const O=this._inputs[U][K];if(O){const m=C;m.inputIndex=d.Move,O[d.Horizontal]=C.clientX,O[d.Vertical]=C.clientY,U===H.Touch&&0===O[d.LeftClick]&&(O[d.LeftClick]=1),void 0===C.pointerId&&(C.pointerId=this._mouseId),this._onInputChanged(U,K,m),this._usingSafari||-1===C.button||(m.inputIndex=C.button+2,O[C.button+2]=O[C.button+2]?0:1,this._onInputChanged(U,K,m))}},this._pointerDownEvent=C=>{const U=this._getPointerType(C);let K=U===H.Mouse?0:C.pointerId;if(U===H.Touch){let U=this._activeTouchIds.indexOf(C.pointerId);if(-1===U&&(U=this._activeTouchIds.indexOf(-1)),!(U>=0))return void m.Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);K=U,this._activeTouchIds[U]=C.pointerId}this._inputs[U]||(this._inputs[U]={}),this._inputs[U][K]?U===H.Touch&&this._onDeviceConnected(U,K):this._addPointerDevice(U,K,C.clientX,C.clientY);const O=this._inputs[U][K];if(O){const m=O[d.Horizontal],A=O[d.Vertical];if(U===H.Mouse){if(void 0===C.pointerId&&(C.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(X){}}else if(C.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(C.pointerId)}catch(X){}O[d.Horizontal]=C.clientX,O[d.Vertical]=C.clientY,O[C.button+2]=1;const e=C;e.inputIndex=C.button+2,this._onInputChanged(U,K,e),m===C.clientX&&A===C.clientY||(e.inputIndex=d.Move,this._onInputChanged(U,K,e))}},this._pointerUpEvent=C=>{var U;const K=this._getPointerType(C),m=K===H.Mouse?0:this._activeTouchIds.indexOf(C.pointerId);if(K===H.Touch){if(-1===m)return;this._activeTouchIds[m]=-1}const O=null===(U=this._inputs[K])||void 0===U?void 0:U[m];let X=C.button,A=O&&0!==O[X+2];if(!A&&this._isUsingFirefox&&this._usingMacOs&&O&&(X=2===X?0:2,A=0!==O[X+2]),A){var e,t,z,j;const U=O[d.Horizontal],A=O[d.Vertical];O[d.Horizontal]=C.clientX,O[d.Vertical]=C.clientY,O[X+2]=0;const p=C;void 0===C.pointerId&&(C.pointerId=this._mouseId),U===C.clientX&&A===C.clientY||(p.inputIndex=d.Move,this._onInputChanged(K,m,p)),p.inputIndex=X+2,K===H.Mouse&&this._mouseId>=0&&null!==(e=(t=this._elementToAttachTo).hasPointerCapture)&&void 0!==e&&e.call(t,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):C.pointerId&&null!==(z=(j=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(j,C.pointerId)&&this._elementToAttachTo.releasePointerCapture(C.pointerId),this._onInputChanged(K,m,p),K===H.Touch&&this._onDeviceDisconnected(K,m)}},this._pointerCancelTouch=C=>{var U,K;const m=this._activeTouchIds.indexOf(C);if(-1===m)return;null!==(U=(K=this._elementToAttachTo).hasPointerCapture)&&void 0!==U&&U.call(K,C)&&this._elementToAttachTo.releasePointerCapture(C),this._inputs[H.Touch][m][d.LeftClick]=0;const O=G.CreateDeviceEvent(H.Touch,m,d.LeftClick,0,this,this._elementToAttachTo,C);this._onInputChanged(H.Touch,m,O),this._activeTouchIds[m]=-1,this._onDeviceDisconnected(H.Touch,m)},this._pointerCancelEvent=C=>{if("mouse"===C.pointerType){var U,K;const C=this._inputs[H.Mouse][0];this._mouseId>=0&&null!==(U=(K=this._elementToAttachTo).hasPointerCapture)&&void 0!==U&&U.call(K,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let U=d.LeftClick;U<=d.BrowserForward;U++)if(1===C[U]){C[U]=0;const K=G.CreateDeviceEvent(H.Mouse,0,U,0,this,this._elementToAttachTo);this._onInputChanged(H.Mouse,0,K)}}else this._pointerCancelTouch(C.pointerId)},this._pointerLeaveEvent=C=>{"pen"===C.pointerType&&this._pointerCancelTouch(C.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let C=!1;const U=function(){};try{const K=Object.defineProperty({},"passive",{get:function(){C=!0}});this._elementToAttachTo.addEventListener("test",U,K),this._elementToAttachTo.removeEventListener("test",U,K)}catch(K){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(H.Mouse)){var C,U;const K=this._inputs[H.Mouse][0];this._mouseId>=0&&null!==(C=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==C&&C.call(U,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let C=d.LeftClick;C<=d.BrowserForward;C++)if(1===K[C]){K[C]=0;const U=G.CreateDeviceEvent(H.Mouse,0,C,0,this,this._elementToAttachTo);this._onInputChanged(H.Mouse,0,U)}}if(this.isDeviceAvailable(H.Touch)){const C=this._inputs[H.Touch];for(let U=0;U<this._activeTouchIds.length;U++){var K,m,O;const X=this._activeTouchIds[U];if(null!==(K=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==K&&K.call(m,X)&&this._elementToAttachTo.releasePointerCapture(X),-1!==X&&1===(null===(O=C[U])||void 0===O?void 0:O[d.LeftClick])){C[U][d.LeftClick]=0;const K=G.CreateDeviceEvent(H.Touch,U,d.LeftClick,0,this,this._elementToAttachTo,X);this._onInputChanged(H.Touch,U,K),this._activeTouchIds[U]=-1,this._onDeviceDisconnected(H.Touch,U)}}}},this._pointerWheelEvent=C=>{const U=H.Mouse;this._inputs[U]||(this._inputs[U]=[]),this._inputs[U][0]||(this._pointerActive=!0,this._registerDevice(U,0,o));const K=this._inputs[U][0];if(K){K[d.MouseWheelX]=C.deltaX||0,K[d.MouseWheelY]=C.deltaY||C.wheelDelta||0,K[d.MouseWheelZ]=C.deltaZ||0;const m=C;void 0===C.pointerId&&(C.pointerId=this._mouseId),0!==K[d.MouseWheelX]&&(m.inputIndex=d.MouseWheelX,this._onInputChanged(U,0,m)),0!==K[d.MouseWheelY]&&(m.inputIndex=d.MouseWheelY,this._onInputChanged(U,0,m)),0!==K[d.MouseWheelZ]&&(m.inputIndex=d.MouseWheelZ,this._onInputChanged(U,0,m))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=C=>{C.buttons>1&&this._pointerCancelEvent(C)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"MA",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!C&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(H.Mouse)){const C=this._inputs[H.Mouse][0];C[d.MouseWheelX]=0,C[d.MouseWheelY]=0,C[d.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=C=>{this._addGamePad(C.gamepad)},this._gamepadDisconnectedEvent=C=>{if(this._gamepads){const U=this._getGamepadDeviceType(C.gamepad.id),K=C.gamepad.index;this._unregisterDevice(U,K),delete this._gamepads[K]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(C,U,K){const m=navigator.getGamepads()[U];if(m&&C===this._gamepads[U]){const O=this._inputs[C][U];K>=m.buttons.length?O[K]=m.axes[K-m.buttons.length].valueOf():O[K]=m.buttons[K].value}}_getGamepadDeviceType(C){return-1!==C.indexOf("054c")?-1!==C.indexOf("0ce6")?H.DualSense:H.DualShock:-1!==C.indexOf("Xbox One")||-1!==C.search("Xbox 360")||-1!==C.search("xinput")?H.Xbox:-1!==C.indexOf("057e")?H.Switch:H.Generic}_getPointerType(C){let U=H.Mouse;return("touch"===C.pointerType||"pen"===C.pointerType||C.touches)&&(U=H.Touch),U}}class k{constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=U,this.deviceSlot=K,this.onInputChangedObservable=new X.b,this._deviceInputSystem=C}getInput(C){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,C)}}class w{constructor(C){this._registeredManagers=new Array,this._refCount=0,this.registerManager=C=>{for(let U=0;U<this._devices.length;U++){const K=this._devices[U];for(const m in K){const K=+m;C._addDevice(new k(this._deviceInputSystem,U,K))}}this._registeredManagers.push(C)},this.unregisterManager=C=>{const U=this._registeredManagers.indexOf(C);U>-1&&this._registeredManagers.splice(U,1)};const U=Object.keys(H).length/2;this._devices=new Array(U);const K=(C,U)=>{this._devices[C]||(this._devices[C]=new Array),this._devices[C][U]||(this._devices[C][U]=U);for(const K of this._registeredManagers){const m=new k(this._deviceInputSystem,C,U);K._addDevice(m)}},m=(C,U)=>{var K;null!==(K=this._devices[C])&&void 0!==K&&K[U]&&delete this._devices[C][U];for(const m of this._registeredManagers)m._removeDevice(C,U)},O=(C,U,K)=>{if(K)for(const m of this._registeredManagers)m._onInputChanged(C,U,K)};"undefined"!==typeof _native?this._deviceInputSystem=new J(K,m,O):this._deviceInputSystem=new B(C,K,m,O)}dispose(){this._deviceInputSystem.dispose()}}class h{getDeviceSource(C,U){if(void 0===U){if(void 0===this._firstDevice[C])return null;U=this._firstDevice[C]}return this._devices[C]&&void 0!==this._devices[C][U]?this._devices[C][U]:null}getDeviceSources(C){return this._devices[C]?this._devices[C].filter((C=>!!C)):[]}constructor(C){const U=Object.keys(H).length/2;this._devices=new Array(U),this._firstDevice=new Array(U),this._engine=C,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new w(C)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new X.b((C=>{for(const U of this._devices)if(U)for(const K of U)K&&this.onDeviceConnectedObservable.notifyObserver(C,K)})),this.onDeviceDisconnectedObservable=new X.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=C.RA.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.RA.remove(this._onDisposeObserver)}_addDevice(C){this._devices[C.deviceType]||(this._devices[C.deviceType]=[]),this._devices[C.deviceType][C.deviceSlot]||(this._devices[C.deviceType][C.deviceSlot]=C,this._updateFirstDevices(C.deviceType)),this.onDeviceConnectedObservable.notifyObservers(C)}_removeDevice(C,U){var K,m;const O=null===(K=this._devices[C])||void 0===K?void 0:K[U];this.onDeviceDisconnectedObservable.notifyObservers(O),null!==(m=this._devices[C])&&void 0!==m&&m[U]&&delete this._devices[C][U],this._updateFirstDevices(C)}_onInputChanged(C,U,K){var m,O;null===(m=this._devices[C])||void 0===m||null===(O=m[U])||void 0===O||O.onInputChangedObservable.notifyObservers(K)}_updateFirstDevices(C){switch(C){case H.Keyboard:case H.Mouse:this._firstDevice[C]=0;break;case H.Touch:case H.DualSense:case H.DualShock:case H.Xbox:case H.Switch:case H.Generic:{delete this._firstDevice[C];const U=this._devices[C];if(U)for(let K=0;K<U.length;K++)if(U[K]){this._firstDevice[C]=K;break}break}}}}var c=K(12138);class N{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get TO(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(C){this._singleClick=C}set TO(C){this._doubleClick=C}set hasSwiped(C){this._hasSwiped=C}set ignore(C){this._ignore=C}}class g{constructor(C){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new z.Vector2(0,0),this._previousStartingPointerPosition=new z.Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=C||f.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(C){return this._meshUnderPointerId[C]||null}get unTranslatedPointer(){return new z.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(C){this._pointerX=C}get pointerY(){return this._pointerY}set pointerY(C){this._pointerY=C}_updatePointerPosition(C){const U=this._scene.getEngine().getInputElementClientRect();U&&(this._pointerX=C.clientX-U.left,this._pointerY=C.clientY-U.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(C,U){const K=this._scene,m=K.getEngine(),O=m.getInputElement();O&&(O.tabIndex=m.canvasTabIndex,K.doNotHandleCursors||(O.style.cursor=K.defaultCursor)),this._setCursorAndPointerOverMesh(C,U,K);for(const t of K._pointerMoveStage){var X;const K=!(null===(X=C=C||this._pickMove(U))||void 0===X||!X.pickedMesh);C=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,C,K,O)}const A=U.inputIndex>=d.MouseWheelX&&U.inputIndex<=d.MouseWheelZ?Z.b.POINTERWHEEL:Z.b.POINTERMOVE;let e;K.onPointerMove&&(C=C||this._pickMove(U),K.onPointerMove(U,C,A)),C?(e=new Z.i(A,U,C),this._setRayOnPointerInfo(C,U)):(e=new Z.i(A,U,null,this),this._movePointerInfo=e),K.onPointerObservable.hasObservers()&&K.onPointerObservable.notifyObservers(e,A)}_setRayOnPointerInfo(C,U){const K=this._scene;C&&c.e._IsPickingAvailable&&(C.ray||(C.ray=K.createPickingRay(U.offsetX,U.offsetY,z.Matrix.Identity(),K.activeCamera)))}_addCameraPointerObserver(C,U){return this._cameraObserverCount++,this._scene.onPointerObservable.add(C,U)}_removeCameraPointerObserver(C){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(C)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(C,U,K){const m=this._scene,O=new Z.e(K,U,this._unTranslatedPointerX,this._unTranslatedPointerY);return C&&(O.originalPickingInfo=C,O.ray=C.ray,"xr-near"===U.pointerType&&C.originMesh&&(O.nearInteractionPickingInfo=C)),m.onPrePointerObservable.notifyObservers(O,K),!!O.skipOnPointerObservable}_pickMove(C){const U=this._scene,K=U.EK(this._unTranslatedPointerX,this._unTranslatedPointerY,U.pointerMovePredicate,U.pointerMoveFastCheck,U.cameraToUseForPointers,U.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(K,C,U),K}_setCursorAndPointerOverMesh(C,U,K){const m=K.getEngine().getInputElement();if(null!==C&&void 0!==C&&C.pickedMesh){if(this.setPointerOverMesh(C.pickedMesh,U.pointerId,C,U),!K.doNotHandleCursors&&m&&this._pointerOverMesh){const C=this._pointerOverMesh._getActionManagerForTrigger();C&&C.hasPointerTriggers&&(m.style.cursor=C.hoverCursor||K.hoverCursor)}}else this.setPointerOverMesh(null,U.pointerId,C,U)}simulatePointerMove(C,U){const K=new PointerEvent("pointermove",U);K.inputIndex=d.Move,this._checkPrePointerObservable(C,K,Z.b.POINTERMOVE)||this._processPointerMove(C,K)}simulatePointerDown(C,U){const K=new PointerEvent("pointerdown",U);K.inputIndex=K.button+2,this._checkPrePointerObservable(C,K,Z.b.POINTERDOWN)||this._processPointerDown(C,K)}_processPointerDown(C,U){var K;const m=this._scene;if(null!==(K=C)&&void 0!==K&&K.pickedMesh){this._pickedDownMesh=C.pickedMesh;const K=C.pickedMesh._getActionManagerForTrigger();if(K){if(K.hasPickTriggers)switch(K.processTrigger(5,new u(C.pickedMesh,m.pointerX,m.pointerY,C.pickedMesh,U,C)),U.button){case 0:K.processTrigger(2,new u(C.pickedMesh,m.pointerX,m.pointerY,C.pickedMesh,U,C));break;case 1:K.processTrigger(4,new u(C.pickedMesh,m.pointerX,m.pointerY,C.pickedMesh,U,C));break;case 2:K.processTrigger(3,new u(C.pickedMesh,m.pointerX,m.pointerY,C.pickedMesh,U,C))}K.hasSpecificTrigger(8)&&window.setTimeout((()=>{const C=m.EK(this._unTranslatedPointerX,this._unTranslatedPointerY,(C=>C.xt&&C.isVisible&&C.isReady()&&C.actionManager&&C.actionManager.hasSpecificTrigger(8)&&C===this._pickedDownMesh),!1,m.cameraToUseForPointers);null!==C&&void 0!==C&&C.pickedMesh&&K&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>g.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,K.processTrigger(8,u.CreateNew(C.pickedMesh,U)))}),g.LongPressDelay)}}else for(const A of m._pointerDownStage)C=A.action(this._unTranslatedPointerX,this._unTranslatedPointerY,C,U,!1);let O;const X=Z.b.POINTERDOWN;C?(m.onPointerDown&&m.onPointerDown(U,C,X),O=new Z.i(X,U,C),this._setRayOnPointerInfo(C,U)):O=new Z.i(X,U,null,this),m.onPointerObservable.hasObservers()&&m.onPointerObservable.notifyObservers(O,X)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(C,U,K){const m=new PointerEvent("pointerup",U);m.inputIndex=d.Move;const O=new N;K?O.TO=!0:O.singleClick=!0,this._checkPrePointerObservable(C,m,Z.b.POINTERUP)||this._processPointerUp(C,m,O)}_processPointerUp(C,U,K){var m;const O=this._scene;if(null!==(m=C)&&void 0!==m&&m.pickedMesh){if(this._pickedUpMesh=C.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(O.onPointerPick&&O.onPointerPick(U,C),K.singleClick&&!K.ignore&&O.onPointerObservable.observers.length>this._cameraObserverCount)){const K=Z.b.POINTERPICK,m=new Z.i(K,U,C);this._setRayOnPointerInfo(C,U),O.onPointerObservable.notifyObservers(m,K)}const m=C.pickedMesh._getActionManagerForTrigger();if(m&&!K.ignore){m.processTrigger(7,u.CreateNew(C.pickedMesh,U,C)),!K.hasSwiped&&K.singleClick&&m.processTrigger(1,u.CreateNew(C.pickedMesh,U,C));const O=C.pickedMesh._getActionManagerForTrigger(6);K.TO&&O&&O.processTrigger(6,u.CreateNew(C.pickedMesh,U,C))}}else if(!K.ignore)for(const X of O._pointerUpStage)C=X.action(this._unTranslatedPointerX,this._unTranslatedPointerY,C,U,K.TO);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const C=this._pickedDownMesh._getActionManagerForTrigger(16);C&&C.processTrigger(16,u.CreateNew(this._pickedDownMesh,U))}if(!K.ignore){const m=new Z.i(Z.b.POINTERUP,U,C);if(this._setRayOnPointerInfo(C,U),O.onPointerObservable.notifyObservers(m,Z.b.POINTERUP),O.onPointerUp&&O.onPointerUp(U,C,Z.b.POINTERUP),!K.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let m=0;if(K.singleClick?m=Z.b.POINTERTAP:K.TO&&(m=Z.b.POINTERDOUBLETAP),m){const K=new Z.i(m,U,C);O.onPointerObservable.hasObservers()&&O.onPointerObservable.hasSpecificMask(m)&&O.onPointerObservable.notifyObservers(K,m)}}}}isPointerCaptured(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[C]}attachControl(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=this._scene,X=O.getEngine();m||(m=X.getInputElement()),this._alreadyAttached&&this.Np(),m&&(this._alreadyAttachedTo=m),this._deviceSourceManager=new h(X),this._initActionManager=C=>{if(!this._meshPickProceed){const U=O.skipPointerUpPicking||0===O._registeredActions&&!this._checkForPicking()&&!O.onPointerUp?null:O.EK(this._unTranslatedPointerX,this._unTranslatedPointerY,O.pointerUpPredicate,O.pointerUpFastCheck,O.cameraToUseForPointers,O.pointerUpTrianglePredicate);this._currentPickResult=U,U&&(C=U.hit&&U.pickedMesh?U.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return C},this._delayedSimpleClick=(C,U,K)=>{if((Date.now()-this._previousStartingPointerTime>g.DoubleClickDelay&&!this._doubleClickOccured||C!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,U.singleClick=!0,U.ignore=!1,this._delayedClicks[C])){const U=this._delayedClicks[C].evt,K=Z.b.POINTERTAP,m=new Z.i(K,U,this._currentPickResult);O.onPointerObservable.hasObservers()&&O.onPointerObservable.hasSpecificMask(K)&&O.onPointerObservable.notifyObservers(m,K),this._delayedClicks[C]=null}},this._initClickEvent=(C,U,K,m)=>{const O=new N;this._currentPickResult=null;let X=null,A=C.hasSpecificMask(Z.b.POINTERPICK)||U.hasSpecificMask(Z.b.POINTERPICK)||C.hasSpecificMask(Z.b.POINTERTAP)||U.hasSpecificMask(Z.b.POINTERTAP)||C.hasSpecificMask(Z.b.POINTERDOUBLETAP)||U.hasSpecificMask(Z.b.POINTERDOUBLETAP);!A&&P&&(X=this._initActionManager(X,O),X&&(A=X.hasPickTriggers));let e=!1;if(A=A&&!this._isMultiTouchGesture,A){const A=K.button;if(O.hasSwiped=this._isPointerSwiping(),!O.hasSwiped){let j=!g.ExclusiveDoubleClickMode;if(j||(j=!C.hasSpecificMask(Z.b.POINTERDOUBLETAP)&&!U.hasSpecificMask(Z.b.POINTERDOUBLETAP),j&&!P.HasSpecificTrigger(6)&&(X=this._initActionManager(X,O),X&&(j=!X.hasSpecificTrigger(6)))),j)(Date.now()-this._previousStartingPointerTime>g.DoubleClickDelay||A!==this._previousButtonPressed)&&(O.singleClick=!0,m(O,this._currentPickResult),e=!0);else{const C={evt:K,clickInfo:O,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,A,O,m),g.DoubleClickDelay)};this._delayedClicks[A]=C}let p=C.hasSpecificMask(Z.b.POINTERDOUBLETAP)||U.hasSpecificMask(Z.b.POINTERDOUBLETAP);if(!p&&P.HasSpecificTrigger(6)&&(X=this._initActionManager(X,O),X&&(p=X.hasSpecificTrigger(6))),p)if(A===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<g.DoubleClickDelay&&!this._doubleClickOccured){if(O.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=A,g.ExclusiveDoubleClickMode){var t;if(this._delayedClicks[A])clearTimeout(null===(t=this._delayedClicks[A])||void 0===t?void 0:t.timeoutId),this._delayedClicks[A]=null;m(O,this._previousPickResult)}else m(O,this._currentPickResult);else{var z;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,O.TO=!0,O.ignore=!1,g.ExclusiveDoubleClickMode&&this._delayedClicks[A])clearTimeout(null===(z=this._delayedClicks[A])||void 0===z?void 0:z.timeoutId),this._delayedClicks[A]=null;m(O,this._currentPickResult)}e=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=A}}e||m(O,this._currentPickResult)},this._onPointerMove=C=>{if(this._updatePointerPosition(C),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>g.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>g.DragMovementThreshold),X.isPointerLock&&X._verifyPointerLock(),this._checkPrePointerObservable(null,C,C.inputIndex>=d.MouseWheelX&&C.inputIndex<=d.MouseWheelZ?Z.b.POINTERWHEEL:Z.b.POINTERMOVE))return;if(!O.cameraToUseForPointers&&!O.activeCamera)return;if(O.xp)return void this._processPointerMove(new E.b,C);O.pointerMovePredicate||(O.pointerMovePredicate=C=>C.xt&&C.isVisible&&C.isReady()&&C.isEnabled()&&(C.enablePointerMoveEvents||O.constantlyUpdateMeshUnderPointer||null!==C._getActionManagerForTrigger())&&(!O.cameraToUseForPointers||0!==(O.cameraToUseForPointers.layerMask&C.layerMask)));const U=O._registeredActions>0||O.constantlyUpdateMeshUnderPointer?this._pickMove(C):null;this._processPointerMove(U,C)},this._onPointerDown=C=>{const U=this._activePointerIds.indexOf(-1);if(-1===U?this._activePointerIds.push(C.pointerId):this._activePointerIds[U]=C.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,g.ExclusiveDoubleClickMode)for(let m=0;m<this._delayedClicks.length;m++)if(this._delayedClicks[m])if(C.button===m){var K;clearTimeout(null===(K=this._delayedClicks[m])||void 0===K?void 0:K.timeoutId)}else{const C=this._delayedClicks[m].clickInfo;this._doubleClickOccured=!1,C.singleClick=!0,C.ignore=!1;const U=this._delayedClicks[m].evt,K=Z.b.POINTERTAP,X=new Z.i(K,U,this._currentPickResult);O.onPointerObservable.hasObservers()&&O.onPointerObservable.hasSpecificMask(K)&&O.onPointerObservable.notifyObservers(X,K),this._delayedClicks[m]=null}if(this._updatePointerPosition(C),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=C.button),O.preventDefaultOnPointerDown&&m&&(C.preventDefault(),m.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,C,Z.b.POINTERDOWN))return;if(!O.cameraToUseForPointers&&!O.activeCamera)return;let X;this._pointerCaptures[C.pointerId]=!0,O.pointerDownPredicate||(O.pointerDownPredicate=C=>C.xt&&C.isVisible&&C.isReady()&&C.isEnabled()&&(!O.cameraToUseForPointers||0!==(O.cameraToUseForPointers.layerMask&C.layerMask))),this._pickedDownMesh=null,X=O.skipPointerDownPicking||0===O._registeredActions&&!this._checkForPicking()&&!O.onPointerDown?new E.b:O.EK(this._unTranslatedPointerX,this._unTranslatedPointerY,O.pointerDownPredicate,O.pointerDownFastCheck,O.cameraToUseForPointers,O.pointerDownTrianglePredicate),this._processPointerDown(X,C)},this._onPointerUp=C=>{const U=this._activePointerIds.indexOf(C.pointerId);-1!==U&&(this._activePointerIds[U]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(C),O.preventDefaultOnPointerUp&&m&&(C.preventDefault(),m.focus()),this._initClickEvent(O.onPrePointerObservable,O.onPointerObservable,C,((U,K)=>{if(O.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!U.ignore)){if(this._checkPrePointerObservable(null,C,Z.b.POINTERUP))return this._swipeButtonPressed===C.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===C.buttons&&(this._pointerCaptures[C.pointerId]=!1));U.hasSwiped||(U.singleClick&&O.onPrePointerObservable.hasSpecificMask(Z.b.POINTERTAP)&&this._checkPrePointerObservable(null,C,Z.b.POINTERTAP)&&(this._skipPointerTap=!0),U.TO&&O.onPrePointerObservable.hasSpecificMask(Z.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,C,Z.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[C.pointerId]?(0===C.buttons&&(this._pointerCaptures[C.pointerId]=!1),(O.cameraToUseForPointers||O.activeCamera)&&(O.pointerUpPredicate||(O.pointerUpPredicate=C=>C.xt&&C.isVisible&&C.isReady()&&C.isEnabled()&&(!O.cameraToUseForPointers||0!==(O.cameraToUseForPointers.layerMask&C.layerMask))),!this._meshPickProceed&&(P&&P.HasTriggers||this._checkForPicking()||O.onPointerUp)&&this._initActionManager(null,U),K||(K=this._currentPickResult),this._processPointerUp(K,C,U),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===C.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===C.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=C=>{const U=D.e.KEYDOWN;if(O.onPreKeyboardObservable.hasObservers()){const K=new D.i(U,C);if(O.onPreKeyboardObservable.notifyObservers(K,U),K.skipOnKeyboardObservable)return}if(O.onKeyboardObservable.hasObservers()){const K=new D.m(U,C);O.onKeyboardObservable.notifyObservers(K,U)}O.actionManager&&O.actionManager.processTrigger(14,u.CreateNewFromScene(O,C))},this._onKeyUp=C=>{const U=D.e.KEYUP;if(O.onPreKeyboardObservable.hasObservers()){const K=new D.i(U,C);if(O.onPreKeyboardObservable.notifyObservers(K,U),K.skipOnKeyboardObservable)return}if(O.onKeyboardObservable.hasObservers()){const K=new D.m(U,C);O.onKeyboardObservable.notifyObservers(K,U)}O.actionManager&&O.actionManager.processTrigger(15,u.CreateNewFromScene(O,C))},this._deviceSourceManager.onDeviceConnectedObservable.add((m=>{m.deviceType===H.Mouse?m.onInputChangedObservable.add((O=>{this._originMouseEvent=O,O.inputIndex===d.LeftClick||O.inputIndex===d.MiddleClick||O.inputIndex===d.RightClick||O.inputIndex===d.BrowserBack||O.inputIndex===d.BrowserForward?U&&1===m.getInput(O.inputIndex)?this._onPointerDown(O):C&&0===m.getInput(O.inputIndex)&&this._onPointerUp(O):K&&(O.inputIndex===d.Move?this._onPointerMove(O):O.inputIndex!==d.MouseWheelX&&O.inputIndex!==d.MouseWheelY&&O.inputIndex!==d.MouseWheelZ||this._onPointerMove(O))})):m.deviceType===H.Touch?m.onInputChangedObservable.add((O=>{O.inputIndex===d.LeftClick&&(U&&1===m.getInput(O.inputIndex)?(this._onPointerDown(O),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):C&&0===m.getInput(O.inputIndex)&&(this._onPointerUp(O),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),K&&O.inputIndex===d.Move&&this._onPointerMove(O)})):m.deviceType===H.Keyboard&&m.onInputChangedObservable.add((C=>{"keydown"===C.type?this._onKeyDown(C):"keyup"===C.type&&this._onKeyUp(C)}))})),this._alreadyAttached=!0}Np(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,m=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[U]===C&&(!C||!C._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const O=this._meshUnderPointerId[U];let X;O&&(X=O._getActionManagerForTrigger(10),X&&X.processTrigger(10,new u(O,this._pointerX,this._pointerY,C,m,{pointerId:U}))),C?(this._meshUnderPointerId[U]=C,this._pointerOverMesh=C,X=C._getActionManagerForTrigger(9),X&&X.processTrigger(9,new u(C,this._pointerX,this._pointerY,C,m,{pointerId:U,pickResult:K}))):(delete this._meshUnderPointerId[U],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:C,pointerId:U})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(C){this._pointerOverMesh===C&&(this._pointerOverMesh=null),this._pickedDownMesh===C&&(this._pickedDownMesh=null),this._pickedUpMesh===C&&(this._pickedUpMesh=null);for(const U in this._meshUnderPointerId)this._meshUnderPointerId[U]===C&&delete this._meshUnderPointerId[U]}}g.DragMovementThreshold=10,g.LongPressDelay=500,g.DoubleClickDelay=300,g.ExclusiveDoubleClickMode=!1;var M=K(12053),L=K(11879),Y=K(12036),W=K(12142),x=K(11709),n=K(12144),S=K(11844);class s{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.xp=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var R,q=K(11679),I=K(11789);!function(C){C[C.BackwardCompatible=0]="BackwardCompatible",C[C.Intermediate=1]="Intermediate",C[C.Aggressive=2]="Aggressive"}(R||(R={}));class CC{static DefaultMaterialFactory(C){throw(0,F.b)("VU")}static CollisionCoordinatorFactory(){throw(0,F.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(C){C!==this._clearColor&&(this._clearColor=C,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(C){if(C!==this._performancePriority){switch(this._performancePriority=C,C){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.xp=!1,this.Ke=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.xp=!0,this.Ke=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.xp=!0,this.Ke=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(C)}}set forceWireframe(C){this._forceWireframe!==C&&(this._forceWireframe=C,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(C){this._skipFrustumClipping!==C&&(this._skipFrustumClipping=C)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(C){this._forcePointsCloud!==C&&(this._forcePointsCloud=C,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(C){this._environmentTexture!==C&&(this._environmentTexture=C,this.onEnvironmentTextureChangedObservable.notifyObservers(C),this.markAllMaterialsAsDirty(1))}getNodes(){let C=[];C=C.concat(this.meshes),C=C.concat(this.lights),C=C.concat(this.cameras),C=C.concat(this.transformNodes);for(const U of this.skeletons)C=C.concat(U.bones);return C}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(C){this._animationPropertiesOverride=C}set onDispose(C){this._onDisposeObserver&&this.RA.remove(this._onDisposeObserver),this._onDisposeObserver=this.RA.add(C)}set beforeRender(C){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),C&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(C))}set afterRender(C){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),C&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(C))}set beforeCameraRender(C){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(C)}set afterCameraRender(C){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(C)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(C){this._pointerPickingConfiguration.pointerDownPredicate=C}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(C){this._pointerPickingConfiguration.pointerUpPredicate=C}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(C){this._pointerPickingConfiguration.pointerMovePredicate=C}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(C){this._pointerPickingConfiguration.pointerDownFastCheck=C}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(C){this._pointerPickingConfiguration.pointerUpFastCheck=C}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(C){this._pointerPickingConfiguration.pointerMoveFastCheck=C}get xp(){return this._pointerPickingConfiguration.xp}set xp(C){this._pointerPickingConfiguration.xp=C}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(C){this._pointerPickingConfiguration.skipPointerDownPicking=C}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(C){this._pointerPickingConfiguration.skipPointerUpPicking=C}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return g.DragMovementThreshold}static set DragMovementThreshold(C){g.DragMovementThreshold=C}static get LongPressDelay(){return g.LongPressDelay}static set LongPressDelay(C){g.LongPressDelay=C}static get DoubleClickDelay(){return g.DoubleClickDelay}static set DoubleClickDelay(C){g.DoubleClickDelay=C}static get ExclusiveDoubleClickMode(){return g.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(C){g.ExclusiveDoubleClickMode=C}bindEyePosition(C){var U;let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(U=this.activeCamera)||void 0===U?void 0:U.globalPosition)??z.bU.ZeroReadOnly,X=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return z.TmpVectors.Vector4[0].set(O.x,O.y,O.z,X?-1:1),C&&(m?C.setFloat3(K,z.TmpVectors.Vector4[0].x,z.TmpVectors.Vector4[0].y,z.TmpVectors.Vector4[0].z):C.setVector4(K,z.TmpVectors.Vector4[0])),z.TmpVectors.Vector4[0]}finalizeSceneUbo(){const C=this.getSceneUniformBuffer(),U=this.bindEyePosition(null);return C.updateFloat4("vEyePosition",U.x,U.y,U.z,U.w),C.update(),C}set useRightHandedSystem(C){this._useRightHandedSystem!==C&&(this._useRightHandedSystem=C,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(C){this._currentStepId=C}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(C){this._fogEnabled!==C&&(this._fogEnabled=C,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(C){this._fogMode!==C&&(this._fogMode=C,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(C){this._shadowsEnabled!==C&&(this._shadowsEnabled=C,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(C){this._lightsEnabled!==C&&(this._lightsEnabled=C,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(C){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),C&&(this._unObserveActiveCameras=(0,S.k)(C,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=C}get activeCamera(){return this._activeCamera}set activeCamera(C){C!==this._activeCamera&&(this._activeCamera=C,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return CC.DefaultMaterialFactory!==CC._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.bp||(this.bp=CC.DefaultMaterialFactory(this)),this.bp}set defaultMaterial(C){this.bp=C}set texturesEnabled(C){this._texturesEnabled!==C&&(this._texturesEnabled=C,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(C){if(this._frameGraph)return this._frameGraph=C,void(C||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=C,C&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(C){this._skeletonsEnabled!==C&&(this._skeletonsEnabled=C,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=CC.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const C of this._transientComponents)C.register();this._transientComponents.length=0}}SA(C){this._components.push(C),this._transientComponents.push(C);const U=C;U.addFromContainer&&U.serialize&&this._serializableComponents.push(U)}_getComponent(C){for(const U of this._components)if(U.name===C)return U;return null}get uniqueId(){return this._uniqueId}constructor(C,U){this._inputManager=new g(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ke=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new L.ve(.2,.2,.3,1),this.onClearColorChangedObservable=new X.b,this.ambientColor=new L.fU(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new X.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.AE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.NE=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.RA=new X.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new X.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new X.b,this.onAfterRenderCameraObservable=new X.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new X.b,this.onAfterAnimationsObservable=new X.b,this.onBeforeDrawPhaseObservable=new X.b,this.onAfterDrawPhaseObservable=new X.b,this.onReadyObservable=new X.b,this.onBeforeCameraRenderObservable=new X.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new X.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new X.b,this.onAfterActiveMeshesEvaluationObservable=new X.b,this.onBeforeParticlesRenderingObservable=new X.b,this.onAfterParticlesRenderingObservable=new X.b,this.onDataLoadedObservable=new X.b,this.onNewCameraAddedObservable=new X.b,this.onCameraRemovedObservable=new X.b,this.onNewLightAddedObservable=new X.b,this.onLightRemovedObservable=new X.b,this.onNewGeometryAddedObservable=new X.b,this.onGeometryRemovedObservable=new X.b,this.onNewTransformNodeAddedObservable=new X.b,this.onTransformNodeRemovedObservable=new X.b,this.onNewMeshAddedObservable=new X.b,this.onMeshRemovedObservable=new X.b,this.onNewSkeletonAddedObservable=new X.b,this.onSkeletonRemovedObservable=new X.b,this.onNewMaterialAddedObservable=new X.b,this.onNewMultiMaterialAddedObservable=new X.b,this.onMaterialRemovedObservable=new X.b,this.onMultiMaterialRemovedObservable=new X.b,this.onNewTextureAddedObservable=new X.b,this.onTextureRemovedObservable=new X.b,this.onBeforeRenderTargetsRenderObservable=new X.b,this.onAfterRenderTargetsRenderObservable=new X.b,this.onBeforeStepObservable=new X.b,this.onAfterStepObservable=new X.b,this.onActiveCameraChanged=new X.b,this.onActiveCamerasChanged=new X.b,this.onBeforeRenderingGroupObservable=new X.b,this.onAfterRenderingGroupObservable=new X.b,this.onMeshImportedObservable=new X.b,this.onAnimationFileImportedObservable=new X.b,this.onEnvironmentTextureChangedObservable=new X.b,this.onMeshUnderPointerUpdatedObservable=new X.b,this._registeredForLateAnimationBindings=new A.b(256),this._pointerPickingConfiguration=new s,this.onPrePointerObservable=new X.b,this.onPointerObservable=new X.b,this.onPreKeyboardObservable=new X.b,this.onKeyboardObservable=new X.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=CC.FOGMODE_NONE,this.fogColor=new L.fU(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new z.bU(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new A.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new M.d,this._activeIndices=new M.d,this._activeParticles=new M.d,this._activeBones=new M.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new A.d(256),this._processedMaterials=new A.d(256),this._renderTargets=new A.b(256),this._materialsRenderTargets=new A.b(256),this._activeParticleSystems=new A.d(256),this._activeSkeletons=new A.b(32),this._softwareSkinnedMeshes=new A.b(32),this._activeAnimatables=new Array,this._transformMatrix=z.Matrix.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=Q.e.Create(),this._beforeClearStage=Q.e.Create(),this._beforeRenderTargetClearStage=Q.e.Create(),this._gatherRenderTargetsStage=Q.e.Create(),this._gatherActiveCameraRenderTargetsStage=Q.e.Create(),this._isReadyForMeshStage=Q.e.Create(),this._beforeEvaluateActiveMeshStage=Q.e.Create(),this._evaluateSubMeshStage=Q.e.Create(),this._preActiveMeshStage=Q.e.Create(),this._cameraDrawRenderTargetStage=Q.e.Create(),this._beforeCameraDrawStage=Q.e.Create(),this._beforeRenderTargetDrawStage=Q.e.Create(),this._beforeRenderingGroupDrawStage=Q.e.Create(),this._beforeRenderingMeshStage=Q.e.Create(),this._afterRenderingMeshStage=Q.e.Create(),this._afterRenderingGroupDrawStage=Q.e.Create(),this._afterCameraDrawStage=Q.e.Create(),this._afterCameraPostProcessStage=Q.e.Create(),this._afterRenderTargetDrawStage=Q.e.Create(),this._afterRenderTargetPostProcessStage=Q.e.Create(),this._afterRenderStage=Q.e.Create(),this._pointerMoveStage=Q.e.Create(),this._pointerDownStage=Q.e.Create(),this._pointerUpStage=Q.e.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const K={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...U};C=this._engine=C||f.c.LastCreatedEngine,K.virtual?C._virtualScenes.push(this):(f.c._LastCreatedScene=this,C.scenes.push(this)),this._uid=null,this._renderingManager=new v.b(this),b.c&&(this.postProcessManager=new b.c(this)),(0,V.g)()&&this.attachControl(),this._createUbo(),j.c&&(this._imageProcessingConfiguration=new j.c),this.setDefaultCandidateProviders(),K.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=K.useMaterialMeshMap,this.useClonedMeshMap=K.useClonedMeshMap,U&&U.virtual||C.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(C){return this._defaultSubMeshCandidates.data=C.me,this._defaultSubMeshCandidates.length=C.me.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=C=>this._getDefaultSubMeshCandidates(C),this.getIntersectingSubMeshCandidates=(C,U)=>this._getDefaultSubMeshCandidates(C),this.getCollidingSubMeshCandidates=(C,U)=>this._getDefaultSubMeshCandidates(C)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(C){this._inputManager.pointerX=C}get pointerY(){return this._inputManager.pointerY}set pointerY(C){this._inputManager.pointerY=C}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==U||this._cachedMaterial!==C||this._cachedVisibility!==K}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(C,U){return this._inputManager.simulatePointerMove(C,U),this}simulatePointerDown(C,U){return this._inputManager.simulatePointerDown(C,U),this}simulatePointerUp(C,U,K){return this._inputManager.simulatePointerUp(C,U,K),this}isPointerCaptured(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(C)}attachControl(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(C,U,K)}Np(){this._inputManager.Np()}isReady(){var C,U;let K,m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const O=this.getEngine(),X=O.currentRenderPassId;O.currentRenderPassId=(null===(C=this.activeCamera)||void 0===C?void 0:C.renderPassId)??X;let A=!0;for(this._pendingData.length>0&&(A=!1),null===(U=this.prePassRenderer)||void 0===U||U.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&A&&(A=this.depthPeelingRenderer.isReady()),m&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),K=0;K<this.meshes.length;K++){const C=this.meshes[K];if(!C.me||0===C.me.length)continue;if(!C.isReady(!0)){A=!1;continue}const U=C.hasThinInstances||"InstancedMesh"===C.getClassName()||"InstancedLinesMesh"===C.getClassName()||O.getCaps().instancedArrays&&C.instances.length>0;for(const K of this._isReadyForMeshStage)K.action(C,U)||(A=!1);if(!m)continue;const X=C.material||this.defaultMaterial;if(X)if(X._storeEffectOnSubMeshes)for(const K of C.me){const C=K.kC();C&&C.hasRenderTargetTextures&&null!=C.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(C)&&(this._processedMaterials.push(C),this._materialsRenderTargets.concatWithNoDuplicate(C.getRenderTargetTextures()))}else X.hasRenderTargetTextures&&null!=X.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(X)&&(this._processedMaterials.push(X),this._materialsRenderTargets.concatWithNoDuplicate(X.getRenderTargetTextures()))}if(m)for(K=0;K<this._materialsRenderTargets.length;++K){this._materialsRenderTargets.data[K].isReadyForRendering()||(A=!1)}for(K=0;K<this.geometries.length;K++){2===this.geometries[K].delayLoadState&&(A=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const e of this.activeCameras)e.isReady(!0)||(A=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(A=!1));for(const e of this.AE)e.isReady()||(A=!1);if(this.layers)for(const e of this.layers)e.isReady()||(A=!1);if(this.effectLayers)for(const e of this.effectLayers)e.isLayerReady()||(A=!1);return O.areAllEffectsReady()||(A=!1),O.currentRenderPassId=X,A}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(C){this.onBeforeRenderObservable.add(C)}unregisterBeforeRender(C){this.onBeforeRenderObservable.removeCallback(C)}registerAfterRender(C){this.onAfterRenderObservable.add(C)}unregisterAfterRender(C){this.onAfterRenderObservable.removeCallback(C)}_executeOnceBeforeRender(C){const U=()=>{C(),setTimeout((()=>{this.unregisterBeforeRender(U)}))};this.registerBeforeRender(U)}executeOnceBeforeRender(C,U){void 0!==U?setTimeout((()=>{this._executeOnceBeforeRender(C)}),U):this._executeOnceBeforeRender(C)}addPendingData(C){this._pendingData.push(C)}removePendingData(C){const U=this.isLoading,K=this._pendingData.indexOf(C);-1!==K&&this._pendingData.splice(K,1),U&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(C),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(U)}async whenReadyAsync(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((U=>{this.executeWhenReady((()=>{U()}),C)}))}_checkIsReady(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(C)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(C)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=O.c.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(C,U,K,m){K||m||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===C.updateFlag&&this._projectionUpdateFlag===U.updateFlag||(this._viewUpdateFlag=C.updateFlag,this._projectionUpdateFlag=U.updateFlag,this._viewMatrix=C,this._projectionMatrix=U,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Y.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Y.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(K,m):this._sceneUbo.useUbo&&(this._sceneUbo.ee("viewProjection",this._transformMatrix),this._sceneUbo.ee("view",this._viewMatrix),this._sceneUbo.ee("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(C){const U=new p.b(this._engine,void 0,!1,C??"QU");return U.addUniform("viewProjection",16),U.addUniform("view",16),U.addUniform("projection",16),U.addUniform("vEyePosition",4),U}setSceneUniformBuffer(C){this._sceneUbo=C,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return W.e.UniqueId}Ej(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(C),C._resyncLightSources(),C.parent||C._addToSceneRootNodes(),m.Tools.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(C)})),U)){const U=C.getChildMeshes();for(const C of U)this.Ej(C)}}pj(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const K=this.meshes.indexOf(C);if(-1!==K&&(this.meshes.splice(K,1),C.parent||C._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(C),this.onMeshRemovedObservable.notifyObservers(C),U){const U=C.getChildMeshes();for(const C of U)this.pj(C)}return K}addTransformNode(C){this._blockEntityCollection||C.dC()===this&&-1!==C._indexInSceneTransformNodesArray||(C._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(C),C.parent||C._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(C))}removeTransformNode(C){const U=C._indexInSceneTransformNodesArray;if(-1!==U){if(U!==this.transformNodes.length-1){const C=this.transformNodes[this.transformNodes.length-1];this.transformNodes[U]=C,C._indexInSceneTransformNodesArray=U}C._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),C.parent||C._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(C),U}removeSkeleton(C){const U=this.skeletons.indexOf(C);return-1!==U&&(this.skeletons.splice(U,1),this.onSkeletonRemovedObservable.notifyObservers(C),this._executeActiveContainerCleanup(this._activeSkeletons)),U}removeMorphTargetManager(C){const U=this.morphTargetManagers.indexOf(C);return-1!==U&&this.morphTargetManagers.splice(U,1),U}removeLight(C){const U=this.lights.indexOf(C);if(-1!==U){for(const U of this.meshes)U._removeLightSource(C,!1);this.lights.splice(U,1),this.sortLightsByPriority(),C.parent||C._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(C),U}removeCamera(C){const U=this.cameras.indexOf(C);if(-1!==U&&(this.cameras.splice(U,1),C.parent||C._removeFromSceneRootNodes()),this.activeCameras){const U=this.activeCameras.indexOf(C);-1!==U&&this.activeCameras.splice(U,1)}return this.activeCamera===C&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(C),U}removeParticleSystem(C){const U=this.AE.indexOf(C);return-1!==U&&(this.AE.splice(U,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),U}removeAnimation(C){const U=this.animations.indexOf(C);return-1!==U&&this.animations.splice(U,1),U}stopAnimation(C,U,K){}removeAnimationGroup(C){const U=this.animationGroups.indexOf(C);return-1!==U&&this.animationGroups.splice(U,1),U}removeMultiMaterial(C){const U=this.multiMaterials.indexOf(C);return-1!==U&&this.multiMaterials.splice(U,1),this.onMultiMaterialRemovedObservable.notifyObservers(C),U}removeMaterial(C){const U=C._indexInSceneMaterialArray;if(-1!==U&&U<this.materials.length){if(U!==this.materials.length-1){const C=this.materials[this.materials.length-1];this.materials[U]=C,C._indexInSceneMaterialArray=U}C._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(C),U}removeActionManager(C){const U=this.actionManagers.indexOf(C);return-1!==U&&this.actionManagers.splice(U,1),U}removeTexture(C){const U=this.textures.indexOf(C);return-1!==U&&this.textures.splice(U,1),this.onTextureRemovedObservable.notifyObservers(C),U}addLight(C){if(!this._blockEntityCollection){this.lights.push(C),this.sortLightsByPriority(),C.parent||C._addToSceneRootNodes();for(const U of this.meshes)-1===U.lightSources.indexOf(C)&&(U.lightSources.push(C),U._resyncLightSources());m.Tools.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(C)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(n.e.CompareLightsPriority)}addCamera(C){this._blockEntityCollection||(this.cameras.push(C),m.Tools.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(C)})),C.parent||C._addToSceneRootNodes())}addSkeleton(C){this._blockEntityCollection||(this.skeletons.push(C),m.Tools.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(C)})))}addParticleSystem(C){this._blockEntityCollection||this.AE.push(C)}addAnimation(C){this._blockEntityCollection||this.animations.push(C)}addAnimationGroup(C){this._blockEntityCollection||this.animationGroups.push(C)}addMultiMaterial(C){this._blockEntityCollection||(this.multiMaterials.push(C),m.Tools.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(C)})))}addMaterial(C){this._blockEntityCollection||C.dC()===this&&-1!==C._indexInSceneMaterialArray||(C._indexInSceneMaterialArray=this.materials.length,this.materials.push(C),m.Tools.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(C)})))}addMorphTargetManager(C){this._blockEntityCollection||this.morphTargetManagers.push(C)}addGeometry(C){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[C.uniqueId]=this.geometries.length),this.geometries.push(C))}addActionManager(C){this.actionManagers.push(C)}addTexture(C){this._blockEntityCollection||(this.textures.push(C),this.onNewTextureAddedObservable.notifyObservers(C))}switchActiveCamera(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Np(),this.activeCamera=C,U&&C.attachControl())}setActiveCameraById(C){const U=this.getCameraById(C);return U?(this.activeCamera=U,U):null}setActiveCameraByName(C){const U=this.getCameraByName(C);return U?(this.activeCamera=U,U):null}getAnimationGroupByName(C){for(let U=0;U<this.animationGroups.length;U++)if(this.animationGroups[U].name===C)return this.animationGroups[U];return null}_getMaterial(C,U){for(let K=0;K<this.materials.length;K++){const C=this.materials[K];if(U(C))return C}if(C)for(let K=0;K<this.multiMaterials.length;K++){const C=this.multiMaterials[K];if(U(C))return C}return null}getMaterialByUniqueID(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(C,U)}getMaterialByUniqueId(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.uniqueId===C))}getMaterialById(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.id===C))}getMaterialByName(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.name===C))}getLastMaterialById(C){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let K=this.materials.length-1;K>=0;K--)if(this.materials[K].id===C)return this.materials[K];if(U)for(let K=this.multiMaterials.length-1;K>=0;K--)if(this.multiMaterials[K].id===C)return this.multiMaterials[K];return null}getTextureByUniqueId(C){for(let U=0;U<this.textures.length;U++)if(this.textures[U].uniqueId===C)return this.textures[U];return null}getTextureByName(C){for(let U=0;U<this.textures.length;U++)if(this.textures[U].name===C)return this.textures[U];return null}getCameraById(C){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].id===C)return this.cameras[U];return null}getCameraByUniqueId(C){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].uniqueId===C)return this.cameras[U];return null}getCameraByName(C){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].name===C)return this.cameras[U];return null}getBoneById(C){for(let U=0;U<this.skeletons.length;U++){const K=this.skeletons[U];for(let U=0;U<K.bones.length;U++)if(K.bones[U].id===C)return K.bones[U]}return null}getBoneByName(C){for(let U=0;U<this.skeletons.length;U++){const K=this.skeletons[U];for(let U=0;U<K.bones.length;U++)if(K.bones[U].name===C)return K.bones[U]}return null}getLightByName(C){for(let U=0;U<this.lights.length;U++)if(this.lights[U].name===C)return this.lights[U];return null}getLightById(C){for(let U=0;U<this.lights.length;U++)if(this.lights[U].id===C)return this.lights[U];return null}getLightByUniqueId(C){for(let U=0;U<this.lights.length;U++)if(this.lights[U].uniqueId===C)return this.lights[U];return null}getParticleSystemById(C){for(let U=0;U<this.AE.length;U++)if(this.AE[U].id===C)return this.AE[U];return null}getGeometryById(C){for(let U=0;U<this.geometries.length;U++)if(this.geometries[U].id===C)return this.geometries[U];return null}_getGeometryByUniqueId(C){if(this._geometriesByUniqueId){const U=this._geometriesByUniqueId[C];if(void 0!==U)return this.geometries[U]}else for(let U=0;U<this.geometries.length;U++)if(this.geometries[U].uniqueId===C)return this.geometries[U];return null}getFrameGraphByName(C){for(let U=0;U<this.frameGraphs.length;U++)if(this.frameGraphs[U].name===C)return this.frameGraphs[U];return null}pushGeometry(C,U){return!(!U&&this._getGeometryByUniqueId(C.uniqueId))&&(this.addGeometry(C),m.Tools.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(C)})),!0)}removeGeometry(C){let U;if(this._geometriesByUniqueId){if(U=this._geometriesByUniqueId[C.uniqueId],void 0===U)return!1}else if(U=this.geometries.indexOf(C),U<0)return!1;if(U!==this.geometries.length-1){const C=this.geometries[this.geometries.length-1];C&&(this.geometries[U]=C,this._geometriesByUniqueId&&(this._geometriesByUniqueId[C.uniqueId]=U))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[C.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(C),!0}getGeometries(){return this.geometries}getMeshById(C){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].id===C)return this.meshes[U];return null}getMeshesById(C){return this.meshes.filter((function(U){return U.id===C}))}getTransformNodeById(C){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].id===C)return this.transformNodes[U];return null}getTransformNodeByUniqueId(C){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].uniqueId===C)return this.transformNodes[U];return null}getTransformNodesById(C){return this.transformNodes.filter((function(U){return U.id===C}))}getMeshByUniqueId(C){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].uniqueId===C)return this.meshes[U];return null}getLastMeshById(C){for(let U=this.meshes.length-1;U>=0;U--)if(this.meshes[U].id===C)return this.meshes[U];return null}getLastTransformNodeById(C){for(let U=this.transformNodes.length-1;U>=0;U--)if(this.transformNodes[U].id===C)return this.transformNodes[U];return null}getLastEntryById(C){let U;for(U=this.meshes.length-1;U>=0;U--)if(this.meshes[U].id===C)return this.meshes[U];for(U=this.transformNodes.length-1;U>=0;U--)if(this.transformNodes[U].id===C)return this.transformNodes[U];for(U=this.cameras.length-1;U>=0;U--)if(this.cameras[U].id===C)return this.cameras[U];for(U=this.lights.length-1;U>=0;U--)if(this.lights[U].id===C)return this.lights[U];return null}getNodeById(C){const U=this.getMeshById(C);if(U)return U;const K=this.getTransformNodeById(C);if(K)return K;const m=this.getLightById(C);if(m)return m;const O=this.getCameraById(C);if(O)return O;const X=this.getBoneById(C);return X||null}getNodeByName(C){const U=this.getMeshByName(C);if(U)return U;const K=this.getTransformNodeByName(C);if(K)return K;const m=this.getLightByName(C);if(m)return m;const O=this.getCameraByName(C);if(O)return O;const X=this.getBoneByName(C);return X||null}getMeshByName(C){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].name===C)return this.meshes[U];return null}getTransformNodeByName(C){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].name===C)return this.transformNodes[U];return null}getLastSkeletonById(C){for(let U=this.skeletons.length-1;U>=0;U--)if(this.skeletons[U].id===C)return this.skeletons[U];return null}getSkeletonByUniqueId(C){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].uniqueId===C)return this.skeletons[U];return null}getSkeletonById(C){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].id===C)return this.skeletons[U];return null}getSkeletonByName(C){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].name===C)return this.skeletons[U];return null}getMorphTargetManagerById(C){for(let U=0;U<this.morphTargetManagers.length;U++)if(this.morphTargetManagers[U].uniqueId===C)return this.morphTargetManagers[U];return null}getMorphTargetById(C){for(let U=0;U<this.morphTargetManagers.length;++U){const K=this.morphTargetManagers[U];for(let U=0;U<K.numTargets;++U){const m=K.getTarget(U);if(m.id===C)return m}}return null}getMorphTargetByName(C){for(let U=0;U<this.morphTargetManagers.length;++U){const K=this.morphTargetManagers[U];for(let U=0;U<K.numTargets;++U){const m=K.getTarget(U);if(m.name===C)return m}}return null}getPostProcessByName(C){for(let U=0;U<this.postProcesses.length;++U){const K=this.postProcesses[U];if(K.name===C)return K}return null}isActiveMesh(C){return-1!==this._activeMeshes.indexOf(C)}get uid(){return this._uid||(this._uid=m.Tools.RandomId()),this._uid}addExternalData(C,U){return this._externalData||(this._externalData=new e),this._externalData.add(C,U)}getExternalData(C){return this._externalData?this._externalData.get(C):null}getOrAddExternalDataWithFactory(C,U){return this._externalData||(this._externalData=new e),this._externalData.getOrAddWithFactory(C,U)}removeExternalData(C){return this._externalData.remove(C)}_evaluateSubMesh(C,U,K,m){if(m||C.isInFrustum(this._frustumPlanes)){for(const m of this._evaluateSubMeshStage)m.action(U,C);const K=C.kC();null!==K&&void 0!==K&&(K.hasRenderTargetTextures&&null!=K.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(K)&&(this._processedMaterials.push(K),this._materialsRenderTargets.concatWithNoDuplicate(K.getRenderTargetTextures())),this._renderingManager.dispatch(C,U,K))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(C){this._preventFreeActiveMeshesAndRenderingGroups!==C&&(C&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=C)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let C=0;C<this.activeCameras.length;C++){const U=this.activeCameras[C];U&&U._activeMeshes&&U._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let C=0;C<this.textures.length;C++){const U=this.textures[C];U&&U.renderList&&U.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0,m=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=O,this._skipEvaluateActiveMeshesCompletely=C,m)for(let C=0;C<this._activeMeshes.length;C++)this._activeMeshes.data[C]._freeze();U&&U()}else K&&K("No active camera found")})),this}unfreezeActiveMeshes(){for(let C=0;C<this.meshes.length;C++){const U=this.meshes[C];U._internalAbstractMeshDataInfo&&(U._internalAbstractMeshDataInfo._isActive=!1)}for(let C=0;C<this._activeMeshes.length;C++)this._activeMeshes.data[C]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(C){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>C.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var C;if(this._activeMeshes.length>0)null===(C=this.activeCamera)||void 0===C||C._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const C=this._activeMeshes.length;for(let U=0;U<C;U++){this._activeMeshes.data[U].te()}}if(this._activeParticleSystems){const C=this._activeParticleSystems.length;for(let U=0;U<C;U++)this._activeParticleSystems.data[U].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const m of this._beforeEvaluateActiveMeshStage)m.action();const U=this.getActiveMeshCandidates(),K=U.length;for(let m=0;m<K;m++){const C=U.data[m];let K=C._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(K?K[1]=-1:(K=[C,-1],C._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,K)),C.isBlocked)continue;if(this._totalVertices.addCount(C.getTotalVertices(),!1),!C.isReady()||!C.isEnabled()||C.ue.hasAZeroComponent)continue;C.te(),C.actionManager&&C.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(C);let O=this.customLODSelector?this.customLODSelector(C,this.activeCamera):C.getLOD(this.activeCamera);if(K[0]=O,K[1]=this._frameId,void 0!==O&&null!==O&&(O!==C&&0!==O.billboardMode&&O.te(),C._preActivate(),C.isVisible&&C.visibility>0&&0!==(C.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||C.xz||C.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(C),this.activeCamera._activeMeshes.push(C),O!==C&&O._activate(this._renderId,!1);for(const U of this._preActiveMeshStage)U.action(C);C._activate(this._renderId,!1)&&(C.isAnInstance?C._internalAbstractMeshDataInfo._actAsRegularMesh&&(O=C):O._internalAbstractMeshDataInfo._onlyForInstances=!1,O._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(C,O)),C._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let C=0;C<this.AE.length;C++){const U=this.AE[C];if(!U.isStarted()||!U.mU)continue;const K=U.mU;K.position&&!K.isEnabled()||(this._activeParticleSystems.push(U),U.animate(),this._renderingManager.dispatchParticles(U))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(C){this._skeletonsEnabled&&C.skeleton&&(this._activeSkeletons.pushNoDuplicate(C.skeleton)&&(C.skeleton.prepare(),this._activeBones.addCount(C.skeleton.bones.length,!1)),C.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(C)&&this.frameGraph&&C.applySkeleton(C.skeleton))}_activeMesh(C,U){this._prepareSkeleton(U);let K=C.hasInstances||C.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||U.xz;if(U&&U.me&&U.me.length>0){const m=this.getActiveSubMeshCandidates(U),O=m.length;K=K||1===O;for(let X=0;X<O;X++){const O=m.data[X];this._evaluateSubMesh(O,U,C,K)}}}updateTransformMatrix(C){const U=this.activeCamera;if(U)if(U._renderingMultiview){const K=U._rigCameras[0],m=U._rigCameras[1];this.setTransformMatrix(K.getViewMatrix(),K.getProjectionMatrix(C),m.getViewMatrix(),m.getProjectionMatrix(C))}else this.setTransformMatrix(U.getViewMatrix(),U.getProjectionMatrix(C))}_bindFrameBuffer(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(C&&C._multiviewTexture?C._multiviewTexture._bindFrameBuffer():C&&C.outputRenderTarget?C.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),U&&this._clearFrameBuffer(C)}_clearFrameBuffer(C){if(C&&C._multiviewTexture);else if(C&&C.outputRenderTarget&&!C._renderingMultiview){const U=C.outputRenderTarget;U.onClearObservable.hasObservers()?U.onClearObservable.notifyObservers(this._engine):U.skipInitialClear||C.isRightCamera||(this.Ke&&this._engine.clear(U.clearColor||this._clearColor,!U._cleared,!0,!0),U._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(C,U){var K;let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(C&&C._skipRendering)return;const X=this._engine;if(this._activeCamera=C,!this.activeCamera)throw new Error("Active camera not set");if(X.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&O){let U=!0;C._renderingMultiview&&C.outputRenderTarget&&(U=C.outputRenderTarget.skipInitialClear,this.Ke&&(this._defaultFrameBufferCleared=!1,C.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),C._renderingMultiview&&C.outputRenderTarget&&(C.outputRenderTarget.skipInitialClear=U)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let m=0;m<this._softwareSkinnedMeshes.length;m++){const C=this._softwareSkinnedMeshes.data[m];C.applySkeleton(C.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),C.customRenderTargets&&C.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(C.customRenderTargets),U&&U.customRenderTargets&&U.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(U.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const m of this._gatherActiveCameraRenderTargetsStage)m.action(this._renderTargets);let A=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){m.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let C=0;C<this._renderTargets.length;C++){const U=this._renderTargets.data[C];if(U._shouldRender()){this._renderId++;const C=U.activeCamera&&U.activeCamera!==this.activeCamera;U.render(C,this.dumpNextRenderTargets),A=!0}}m.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const C of this._cameraDrawRenderTargetStage)A=C.action(this.activeCamera)||A;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(K=C.outputRenderTarget)||void 0===K?void 0:K.renderPassId)??C.renderPassId??0,A&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||C._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const m of this._beforeCameraDrawStage)m.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),X.snapshotRendering&&1===X.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const m of this._afterCameraDrawStage)m.action(this.activeCamera);if(this.postProcessManager&&!C._multiviewTexture){const U=C.outputRenderTarget?C.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(C.isIntermediate,U)}for(const m of this._afterCameraPostProcessStage)m.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===C.cameraRigMode||C._renderingMultiview)return C._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(C,void 0,U),void this.onAfterRenderCameraObservable.notifyObservers(C);if(C._useMultiviewToSingleView)this._renderMultiviewToSingleView(C);else{this.onBeforeCameraRenderObservable.notifyObservers(C);for(let U=0;U<C._rigCameras.length;U++)this._renderForCamera(C._rigCameras[U],C)}this._activeCamera=C,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(C)}_checkIntersections(){for(let C=0;C<this._meshesForIntersections.length;C++){const U=this._meshesForIntersections.data[C];if(U.actionManager)for(let C=0;U.actionManager&&C<U.actionManager.actions.length;C++){const K=U.actionManager.actions[C];if(12===K.trigger||13===K.trigger){const C=K.getTriggerParameter(),m=C.mesh?C.mesh:C,O=m.intersectsMesh(U,C.usePreciseIntersection),X=U._intersectionsInProgress.indexOf(m);O&&-1===X?12===K.trigger?(K._executeCurrent(u.CreateNew(U,void 0,m)),U._intersectionsInProgress.push(m)):13===K.trigger&&U._intersectionsInProgress.push(m):!O&&X>-1&&(13===K.trigger&&K._executeCurrent(u.CreateNew(U,void 0,m)),U.actionManager.hasSpecificTrigger(13,(C=>{const U=C.mesh?C.mesh:C;return m===U}))&&13!==K.trigger||U._intersectionsInProgress.splice(X,1))}}}}_advancePhysicsEngineStep(C){}_animate(C){}animate(){if(this._engine.isDeterministicLockStep()){let C=Math.max(CC.MinDeltaTime,Math.min(this._engine.getDeltaTime(),CC.MaxDeltaTime))+this._timeAccumulator;const U=this._engine.getTimeStep(),K=1e3/U/1e3;let m=0;const O=this._engine.getLockstepMaxSteps();let X=Math.floor(C/U);for(X=Math.min(X,O);C>0&&m<X;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=U*K,this._animate(U),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(U),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,m++,C-=U;this._timeAccumulator=C<0?0:C}else{const C=this.useConstantAnimationDeltaTime?16:Math.max(CC.MinDeltaTime,Math.min(this._engine.getDeltaTime(),CC.MaxDeltaTime));this._animationRatio=.06*C,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(C)}}_clear(){(this.autoClearDepthAndStencil||this.Ke)&&this._engine.clear(this._clearColor,this.Ke||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(C){var U;if(null===C||void 0===C||!C.outputRenderTarget||null!==C&&void 0!==C&&C.isRigCamera||(C.outputRenderTarget._cleared=!1),null!==C&&void 0!==C&&null!==(U=C.rigCameras)&&void 0!==U&&U.length)for(let K=0;K<C.rigCameras.length;++K){const U=C.rigCameras[K].outputRenderTarget;U&&(U._cleared=!1)}}resetDrawCache(C){if(this.meshes)for(const U of this.meshes)U.resetDrawCache(C)}_renderWithFrameGraph(){var C;let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),U)for(const O of this.cameras)if(O.update(),0!==O.cameraRigMode)for(let C=0;C<O._rigCameras.length;C++)O._rigCameras[C].update();this.onBeforeRenderObservable.notifyObservers(this);for(const O of this._beforeClearStage)O.action();const K=this.getActiveMeshCandidates(),m=K.length;for(let O=0;O<m;O++){const C=K.data[O];C.isBlocked||(this._totalVertices.addCount(C.getTotalVertices(),!1),C.isReady()&&C.isEnabled()&&!C.ue.hasAZeroComponent&&(C.te(),C.actionManager&&C.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(C)))}if(this.particlesEnabled)for(let O=0;O<this.AE.length;O++){const C=this.AE[O];if(!C.isStarted()||!C.mU)continue;const U=C.mU;U.position&&!U.isEnabled()||(this._activeParticleSystems.push(C),C.animate())}null===(C=this.frameGraph)||void 0===C||C.execute()}_renderRenderTarget(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,C._shouldRender()){if(this._renderId++,this.activeCamera=U,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),C.render(K,m)}this._intermediateRendering=!1}render(){var C;let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.A){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(C=this.activeCameras)&&void 0!==C&&C.length)for(const C of this.activeCameras)this._checkCameraRenderTarget(C);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),K||this.animate();for(const C of this._beforeCameraUpdateStage)C.action();if(U)if(this.activeCameras&&this.activeCameras.length>0)for(let C=0;C<this.activeCameras.length;C++){const U=this.activeCameras[C];if(U.update(),0!==U.cameraRigMode)for(let C=0;C<U._rigCameras.length;C++)U._rigCameras[C].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let C=0;C<this.activeCamera._rigCameras.length;C++)this.activeCamera._rigCameras[C].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(U,K);else{var O;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const C=null!==(O=this.activeCameras)&&void 0!==O&&O.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){m.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let U=0;U<this.customRenderTargets.length;U++){const K=this.customRenderTargets[U],m=K.activeCamera||this.activeCamera;this._renderRenderTarget(K,m,C!==m,this.dumpNextRenderTargets)}m.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===C||void 0===C?void 0:C.renderPassId)??0,this.activeCamera=C,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const U of this._beforeClearStage)U.action();this._clearFrameBuffer(this.activeCamera);for(const U of this._gatherRenderTargetsStage)U.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let U=0;U<this.activeCameras.length;U++)this._processSubCameras(this.activeCameras[U],U>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const C of this._afterRenderStage)C.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let C=0;C<this._toBeDisposed.length;C++){const U=this._toBeDisposed[C];U&&U.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let C=0;C<this.materials.length;C++)this.materials[C].freeze()}unfreezeMaterials(){for(let C=0;C<this.materials.length;C++)this.materials[C].unfreeze()}dispose(){if(this.A)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const C of this._activeAnimatables)C.onAnimationEndObservable.clear(),C.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const C=this._activeRequests.slice();for(const O of C)O.abort();this._activeRequests.length=0;try{this.RA.notifyObservers(this)}catch(m){q.d.Error("An error occurred while calling onDisposeObservable!",m)}this.Np();if(this._engine.getInputElement())for(let O=0;O<this.cameras.length;O++)this.cameras[O].Np();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.bp&&this.bp.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(C=>C.dispose(!0))),this._disposeList(this.transformNodes,(C=>C.dispose(!0)));const U=this.cameras;this._disposeList(U),this._disposeList(this.AE),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let K=this._engine.scenes.indexOf(this);if(K>-1&&this._engine.scenes.splice(K,1),f.c._LastCreatedScene===this){f.c._LastCreatedScene=null;let C=f.c.Instances.length-1;for(;C>=0;){const U=f.c.Instances[C];if(U.scenes.length>0){f.c._LastCreatedScene=U.scenes[this._engine.scenes.length-1];break}C--}}K=this._engine._virtualScenes.indexOf(this),K>-1&&this._engine._virtualScenes.splice(K,1),this._engine.wipeCaches(!0),this.RA.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(C,U){const K=C.slice(0);U=U??(C=>C.dispose());for(const m of K)U(m);C.length=0}get A(){return this._isDisposed}clearCachedVertexData(){for(let C=0;C<this.meshes.length;C++){const U=this.meshes[C].ze;U&&U.clearCachedData()}}cleanCachedTextureBuffer(){for(const C of this.textures){C._buffer&&(C._buffer=null)}}getWorldExtends(C){const U=new z.bU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new z.bU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);C=C||(()=>!0);const m=this.meshes.filter(C);for(const O of m){if(O.te(!0),!O.me||0===O.me.length||O.infiniteDistance)continue;const C=O.getBoundingInfo(),m=C.boundingBox.minimumWorld,X=C.boundingBox.maximumWorld;z.bU.CheckExtends(m,U,K),z.bU.CheckExtends(X,U,K)}return{min:U,max:K}}createPickingRay(C,U,K,m){throw(0,F.b)("Ray")}createPickingRayToRef(C,U,K,m,O){throw(0,F.b)("Ray")}createPickingRayInCameraSpace(C,U,K){throw(0,F.b)("Ray")}createPickingRayInCameraSpaceToRef(C,U,K,m){throw(0,F.b)("Ray")}EK(C,U,K,m,O,X){const A=(0,F.b)("Ray",!0);return A&&q.d.Warn(A),new E.b}pickWithBoundingInfo(C,U,K,m,O){const X=(0,F.b)("Ray",!0);return X&&q.d.Warn(X),new E.b}pickWithRay(C,U,K,m){throw(0,F.b)("Ray")}multiPick(C,U,K,m,O){throw(0,F.b)("Ray")}multiPickWithRay(C,U,K){throw(0,F.b)("Ray")}setPointerOverMesh(C,U,K){this._inputManager.setPointerOverMesh(C,U,K)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const C of this.geometries)C._rebuild();for(const C of this.meshes)C._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const C of this._components)C.rebuild();for(const C of this.AE)C.rebuild();if(this.spriteManagers)for(const C of this.spriteManagers)C.rebuild()}_rebuildTextures(){for(const C of this.textures)C._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(C,U,K){if(void 0===U)return C;const m=[];for(const O in C){const X=C[O];t.d&&t.d.MatchesQuery(X,U)&&(!K||K(X))&&m.push(X)}return m}getMeshesByTags(C,U){return this._getByTags(this.meshes,C,U)}getCamerasByTags(C,U){return this._getByTags(this.cameras,C,U)}getLightsByTags(C,U){return this._getByTags(this.lights,C,U)}getMaterialByTags(C,U){return this._getByTags(this.materials,C,U).concat(this._getByTags(this.multiMaterials,C,U))}getTransformNodesByTags(C,U){return this._getByTags(this.transformNodes,C,U)}setRenderingOrder(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(C,U,K,m)}setRenderingAutoClearDepthStencil(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],m=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(C,U,K,m)}getAutoClearDepthStencilSetup(C){return this._renderingManager.getAutoClearDepthStencilSetup(C)}_forceBlockMaterialDirtyMechanism(C){this._blockMaterialDirtyMechanism=C}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(C){this._blockMaterialDirtyMechanism!==C&&(this._blockMaterialDirtyMechanism=C,C||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(C,U){if(!this._blockMaterialDirtyMechanism)for(const K of this.materials)U&&!U(K)||K.Iz(C)}_loadFile(C,U,K,m,O,X,A){const e=(0,x.n)(C,U,K,m?this.offlineProvider:void 0,O,X,A);return this._activeRequests.push(e),e.onCompleteObservable.add((C=>{this._activeRequests.splice(this._activeRequests.indexOf(C),1)})),e}async _loadFileAsync(C,U,K,m,O){return await new Promise(((X,A)=>{this._loadFile(C,(C=>{X(C)}),U,K,m,((C,U)=>{A(U)}),O)}))}_requestFile(C,U,K,m,O,X,A){const e=(0,x.w)(C,U,K,m?this.offlineProvider:void 0,O,X,A);return this._activeRequests.push(e),e.onCompleteObservable.add((C=>{this._activeRequests.splice(this._activeRequests.indexOf(C),1)})),e}async _requestFileAsync(C,U,K,m,O){return await new Promise(((X,A)=>{this._requestFile(C,(C=>{X(C)}),U,K,m,(C=>{A(C)}),O)}))}_readFile(C,U,K,m,O){const X=(0,x.t)(C,U,K,m,O);return this._activeRequests.push(X),X.onCompleteObservable.add((C=>{this._activeRequests.splice(this._activeRequests.indexOf(C),1)})),X}async _readFileAsync(C,U,K){return await new Promise(((m,O)=>{this._readFile(C,(C=>{m(C)}),U,K,(C=>{O(C)}))}))}getPerfCollector(){throw(0,F.b)("performanceViewerSceneExtension")}setActiveCameraByID(C){return this.setActiveCameraById(C)}getMaterialByID(C){return this.getMaterialById(C)}getLastMaterialByID(C){return this.getLastMaterialById(C)}getTextureByUniqueID(C){return this.getTextureByUniqueId(C)}getCameraByID(C){return this.getCameraById(C)}getCameraByUniqueID(C){return this.getCameraByUniqueId(C)}getBoneByID(C){return this.getBoneById(C)}getLightByID(C){return this.getLightById(C)}getLightByUniqueID(C){return this.getLightByUniqueId(C)}getParticleSystemByID(C){return this.getParticleSystemById(C)}getGeometryByID(C){return this.getGeometryById(C)}getMeshByID(C){return this.getMeshById(C)}getMeshByUniqueID(C){return this.getMeshByUniqueId(C)}getLastMeshByID(C){return this.getLastMeshById(C)}getMeshesByID(C){return this.getMeshesById(C)}getTransformNodeByID(C){return this.getTransformNodeById(C)}getTransformNodeByUniqueID(C){return this.getTransformNodeByUniqueId(C)}getTransformNodesByID(C){return this.getTransformNodesById(C)}getNodeByID(C){return this.getNodeById(C)}getLastEntryByID(C){return this.getLastEntryById(C)}getLastSkeletonByID(C){return this.getLastSkeletonById(C)}}CC.FOGMODE_NONE=0,CC.FOGMODE_EXP=1,CC.FOGMODE_EXP2=2,CC.FOGMODE_LINEAR=3,CC.MinDeltaTime=1,CC.MaxDeltaTime=1e3,CC._OriginalDefaultMaterialFactory=CC.DefaultMaterialFactory,(0,I.h)("BABYLON.Scene",CC)},12109:(C,U,K)=>{K.d(U,{d:()=>m,e:()=>O});class m{}m.NAME_EFFECTLAYER="EffectLayer",m.NAME_LAYER="Layer",m.NAME_LENSFLARESYSTEM="LensFlareSystem",m.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",m.NAME_PARTICLESYSTEM="Pe",m.NAME_GAMEPAD="Gamepad",m.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",m.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",m.NAME_PREPASSRENDERER="PrePassRenderer",m.NAME_DEPTHRENDERER="DepthRenderer",m.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",m.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",m.NAME_SPRITE="Sprite",m.NAME_SUBSURFACE="SubSurface",m.NAME_OUTLINERENDERER="Outline",m.NAME_PROCEDURALTEXTURE="ProceduralTexture",m.NAME_SHADOWGENERATOR="ShadowGenerator",m.NAME_OCTREE="Te",m.NAME_PHYSICSENGINE="PhysicsEngine",m.NAME_AUDIO="Audio",m.NAME_FLUIDRENDERER="FluidRenderer",m.NAME_IBLCDFGENERATOR="iblCDFGenerator",m.STEP_ISREADYFORMESH_EFFECTLAYER=0,m.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,m.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,m.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,m.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,m.STEP_BEFORECAMERADRAW_PREPASS=0,m.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,m.STEP_BEFORECAMERADRAW_LAYER=2,m.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,m.STEP_BEFORERENDERTARGETDRAW_LAYER=1,m.STEP_BEFORERENDERINGMESH_PREPASS=0,m.STEP_BEFORERENDERINGMESH_OUTLINE=1,m.STEP_AFTERRENDERINGMESH_PREPASS=0,m.STEP_AFTERRENDERINGMESH_OUTLINE=1,m.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,m.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,m.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,m.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,m.STEP_BEFORECLEAR_PREPASS=1,m.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,m.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,m.STEP_AFTERRENDERTARGETDRAW_LAYER=1,m.STEP_AFTERCAMERADRAW_PREPASS=0,m.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,m.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,m.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,m.STEP_AFTERCAMERADRAW_LAYER=4,m.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,m.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,m.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,m.STEP_AFTERRENDER_AUDIO=0,m.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,m.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,m.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,m.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,m.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,m.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,m.STEP_POINTERMOVE_SPRITE=0,m.STEP_POINTERDOWN_SPRITE=0,m.STEP_POINTERUP_SPRITE=0;class O extends Array{constructor(C){super(...C)}static Create(){return Object.create(O.prototype)}registerStep(C,U,K){let m=0,O=Number.MAX_VALUE;for(;m<this.length;m++){if(O=this[m].index,C<O)break}this.splice(m,0,{index:C,component:U,action:K.bind(U)})}clear(){this.length=0}}}}]);