"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[23],{12687:(t,U,y)=>{y.d(U,{c:()=>Y});var I=y(12386),r=y(12480);class Y{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var t;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||y&&!this.pickedMesh.isVerticesDataPresent(r.e.NormalKind))return null;let Y,mt=this.pickedMesh.jX();0===(null===(t=mt)||void 0===t?void 0:t.length)&&(mt=null);const X=I.TmpVectors.DU[0],P=I.TmpVectors.DU[1],G=I.TmpVectors.DU[2];if(y){const t=this.pickedMesh.getVerticesData(r.e.NormalKind);let U=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId],X):X.aX(t[3*this.faceId*3],t[3*this.faceId*3+1],t[3*this.faceId*3+2]),y=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId+1],P):P.aX(t[3*(3*this.faceId+1)],t[3*(3*this.faceId+1)+1],t[3*(3*this.faceId+1)+2]),M=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId+2],G):G.aX(t[3*(3*this.faceId+2)],t[3*(3*this.faceId+2)+1],t[3*(3*this.faceId+2)+2]);U=U.scale(this.bu),y=y.scale(this.bv),M=M.scale(1-this.bu-this.bv),Y=new I.DU(U.x+y.x+M.x,U.y+y.y+M.y,U.z+y.z+M.z)}else{const t=this.pickedMesh.getVerticesData(r.e.PositionKind),U=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId],X):X.aX(t[3*this.faceId*3],t[3*this.faceId*3+1],t[3*this.faceId*3+2]),y=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId+1],P):P.aX(t[3*(3*this.faceId+1)],t[3*(3*this.faceId+1)+1],t[3*(3*this.faceId+1)+2]),M=mt?I.DU.FromArrayToRef(t,3*mt[3*this.faceId+2],G):G.aX(t[3*(3*this.faceId+2)],t[3*(3*this.faceId+2)+1],t[3*(3*this.faceId+2)+2]),L=U.lU(y),h=M.lU(y);Y=I.DU.Cross(L,h)}const M=(t,U)=>{if(-1!==this.thinInstanceIndex){const y=t.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];y&&I.DU.TransformNormalToRef(U,y,U)}let y=t.getWorldMatrix();t.nonUniformScaling&&(I.TmpVectors.Matrix[0].Y(y),y=I.TmpVectors.Matrix[0],y.setTranslationFromFloats(0,0,0),y.invert(),y.transposeToRef(I.TmpVectors.Matrix[1]),y=I.TmpVectors.Matrix[1]),I.DU.TransformNormalToRef(U,y,U)};if(U&&M(this.pickedMesh,Y),this.ray){const t=I.TmpVectors.DU[0].Y(Y);U||M(this.pickedMesh,t),I.DU.Dot(t,this.ray.direction)>0&&Y.negateInPlace()}return Y.normalize(),Y}getTextureCoordinates(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.e.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t))return null;const U=this.pickedMesh.jX();if(!U)return null;const y=this.pickedMesh.getVerticesData(t);if(!y)return null;let Y=I.Vector2.pU(y,2*U[3*this.faceId]),mt=I.Vector2.pU(y,2*U[3*this.faceId+1]),X=I.Vector2.pU(y,2*U[3*this.faceId+2]);return Y=Y.scale(this.bu),mt=mt.scale(this.bv),X=X.scale(1-this.bu-this.bv),new I.Vector2(Y.x+mt.x+X.x,Y.y+mt.y+X.y)}}},12708:(t,U,y)=>{var I;y.d(U,{d:()=>r}),function(t){t[t.PointerMove=0]="PointerMove",t[t.PointerDown=1]="PointerDown",t[t.PointerUp=2]="PointerUp"}(I||(I={}));class r{}r.DOM_DELTA_PIXEL=0,r.DOM_DELTA_LINE=1,r.DOM_DELTA_PAGE=2},12706:(t,U,y)=>{y.d(U,{b:()=>I,c:()=>Y,e:()=>r});class I{}I.KEYDOWN=1,I.KEYUP=2;class r{constructor(t,U){this.type=t,this.event=U}}class Y extends r{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(t){this.skipOnKeyboardObservable=t}constructor(t,U){super(t,U),this.type=t,this.event=U,this.skipOnKeyboardObservable=!1}}},12698:(t,U,y)=>{y.d(U,{d:()=>r,f:()=>mt,i:()=>X});var I=y(12386);class r{}r.POINTERDOWN=1,r.POINTERUP=2,r.POINTERMOVE=4,r.POINTERWHEEL=8,r.POINTERPICK=16,r.POINTERTAP=32,r.POINTERDOUBLETAP=64;class Y{constructor(t,U){this.type=t,this.event=U}}class mt extends Y{constructor(t,U,y,r){super(t,U),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new I.Vector2(y,r)}}class X extends Y{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(t,U),this._pickInfo=y,this._inputManager=I}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},12727:(t,U,y)=>{y.d(U,{d:()=>I});class I{static CompareLightsPriority(t,U){return t.shadowEnabled!==U.shadowEnabled?(U.shadowEnabled?1:0)-(t.shadowEnabled?1:0):U.renderPriority-t.renderPriority}}I.FALLOFF_DEFAULT=0,I.FALLOFF_PHYSICAL=1,I.FALLOFF_GLTF=2,I.FALLOFF_STANDARD=3,I.LIGHTMAP_DEFAULT=0,I.LIGHTMAP_SPECULAR=1,I.LIGHTMAP_SHADOWSONLY=2,I.INTENSITYMODE_AUTOMATIC=0,I.INTENSITYMODE_LUMINOUSPOWER=1,I.INTENSITYMODE_LUMINOUSINTENSITY=2,I.INTENSITYMODE_ILLUMINANCE=3,I.INTENSITYMODE_LUMINANCE=4,I.LIGHTTYPEID_POINTLIGHT=0,I.LIGHTTYPEID_DIRECTIONALLIGHT=1,I.LIGHTTYPEID_SPOTLIGHT=2,I.LIGHTTYPEID_HEMISPHERICLIGHT=3,I.LIGHTTYPEID_RECT_AREALIGHT=4},12665:(t,U,y)=>{function I(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}y.d(U,{c:()=>I})},12671:(t,U,y)=>{y.d(U,{d:()=>Y,h:()=>r});var I=y(12665);function r(t,U){U.EXPOSURE&&t.push("exposureLinear"),U.CONTRAST&&t.push("contrast"),U.COLORGRADING&&t.push("colorTransformSettings"),(U.VIGNETTE||U.DITHER)&&t.push("vInverseScreenSize"),U.VIGNETTE&&(t.push("vignetteSettings1"),t.push("vignetteSettings2")),U.COLORCURVES&&(0,I.c)(t),U.DITHER&&t.push("ditherIntensity")}function Y(t,U){U.COLORGRADING&&t.push("txColorTransform")}},12662:(t,U,y)=>{y.d(U,{e:()=>Q});var I=y(12366),r=y(12375),Y=y(12204),mt=y(12442),X=y(12426),P=y(12665);class G{constructor(){this._dirty=!0,this._tempColor=new mt.HX(0,0,0,0),this._globalCurve=new mt.HX(0,0,0,0),this._highlightsCurve=new mt.HX(0,0,0,0),this._midtonesCurve=new mt.HX(0,0,0,0),this._shadowsCurve=new mt.HX(0,0,0,0),this._positiveCurve=new mt.HX(0,0,0,0),this._negativeCurve=new mt.HX(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(t){this._globalHue=t,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(t){this._globalDensity=t,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(t){this._globalSaturation=t,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(t){this._globalExposure=t,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(t){this._highlightsHue=t,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(t){this._highlightsDensity=t,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(t){this._highlightsSaturation=t,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(t){this._highlightsExposure=t,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(t){this._midtonesHue=t,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(t){this._midtonesDensity=t,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(t){this._midtonesSaturation=t,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(t){this._midtonesExposure=t,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(t){this._shadowsHue=t,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(t){this._shadowsDensity=t,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(t){this._shadowsSaturation=t,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(t){this._shadowsExposure=t,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";t._dirty&&(t._dirty=!1,t._getColorGradingDataToRef(t._globalHue,t._globalDensity,t._globalSaturation,t._globalExposure,t._globalCurve),t._getColorGradingDataToRef(t._highlightsHue,t._highlightsDensity,t._highlightsSaturation,t._highlightsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._highlightsCurve),t._getColorGradingDataToRef(t._midtonesHue,t._midtonesDensity,t._midtonesSaturation,t._midtonesExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._midtonesCurve),t._getColorGradingDataToRef(t._shadowsHue,t._shadowsDensity,t._shadowsSaturation,t._shadowsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._shadowsCurve),t._highlightsCurve.subtractToRef(t._midtonesCurve,t._positiveCurve),t._midtonesCurve.subtractToRef(t._shadowsCurve,t._negativeCurve)),U&&(U.setFloat4(y,t._positiveCurve.r,t._positiveCurve.g,t._positiveCurve.b,t._positiveCurve.a),U.setFloat4(I,t._midtonesCurve.r,t._midtonesCurve.g,t._midtonesCurve.b,t._midtonesCurve.a),U.setFloat4(r,t._negativeCurve.r,t._negativeCurve.g,t._negativeCurve.b,t._negativeCurve.a))}_getColorGradingDataToRef(t,U,y,I,r){null!=t&&(t=G._Clamp(t,0,360),U=G._Clamp(U,-100,100),y=G._Clamp(y,-100,100),I=G._Clamp(I,-100,100),U=G._ApplyColorGradingSliderNonlinear(U),U*=.5,I=G._ApplyColorGradingSliderNonlinear(I),U<0&&(U*=-1,t=(t+180)%360),G._FromHSBToRef(t,U,50+.25*I,r),r.scaleToRef(2,r),r.a=1+.01*y)}static _ApplyColorGradingSliderNonlinear(t){t/=100;let U=Math.abs(t);return U=Math.pow(U,2),t<0&&(U*=-1),U*=100,U}static _FromHSBToRef(t,U,y,I){let r=G._Clamp(t,0,360);const Y=G._Clamp(U/100,0,1),mt=G._Clamp(y/100,0,1);if(0===Y)I.r=mt,I.g=mt,I.b=mt;else{r/=60;const t=Math.floor(r),U=r-t,y=mt*(1-Y),X=mt*(1-Y*U),P=mt*(1-Y*(1-U));switch(t){case 0:I.r=mt,I.g=P,I.b=y;break;case 1:I.r=X,I.g=mt,I.b=y;break;case 2:I.r=y,I.g=mt,I.b=P;break;case 3:I.r=y,I.g=X,I.b=mt;break;case 4:I.r=P,I.g=y,I.b=mt;break;default:I.r=mt,I.g=y,I.b=X}}I.a=1}static _Clamp(t,U,y){return Math.min(Math.max(t,U),y)}clone(){return X.b.Clone((()=>new G),this)}serialize(){return X.b.Serialize(this)}static Parse(t){return X.b.Parse((()=>new G),t,null,null)}}G.PrepareUniforms=P.c,(0,I.b)([(0,r.I)()],G.prototype,"_globalHue",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_globalDensity",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_globalSaturation",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_globalExposure",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_highlightsHue",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_highlightsDensity",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_highlightsSaturation",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_highlightsExposure",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_midtonesHue",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_midtonesDensity",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_midtonesSaturation",void 0),(0,I.b)([(0,r.I)()],G.prototype,"_midtonesExposure",void 0),X.b._ColorCurvesParser=G.Parse;var M=y(12349),L=y(12671),h=y(12338);class Q{constructor(){this.colorCurves=new G,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=Q.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new mt.HX(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=Q.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new Y.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(t){this._colorCurvesEnabled!==t&&(this._colorCurvesEnabled=t,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(t){this._colorGradingTexture!==t&&(this._colorGradingTexture=t,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(t){this._colorGradingEnabled!==t&&(this._colorGradingEnabled=t,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(t){this._colorGradingWithGreenDepth!==t&&(this._colorGradingWithGreenDepth=t,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(t){this._colorGradingBGR!==t&&(this._colorGradingBGR=t,this._updateParameters())}get exposure(){return this._exposure}set exposure(t){this._exposure!==t&&(this._exposure=t,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(t){this._toneMappingEnabled!==t&&(this._toneMappingEnabled=t,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(t){this._toneMappingType!==t&&(this._toneMappingType=t,this._updateParameters())}get contrast(){return this._contrast}set contrast(t){this._contrast!==t&&(this._contrast=t,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(t){this.vignetteCenterY=t}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(t){this.vignetteCenterX=t}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(t){this._vignetteBlendMode!==t&&(this._vignetteBlendMode=t,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(t){this._vignetteEnabled!==t&&(this._vignetteEnabled=t,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(t){this._ditheringEnabled!==t&&(this._ditheringEnabled=t,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(t){this._ditheringIntensity!==t&&(this._ditheringIntensity=t,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(t){this._skipFinalColorClamp!==t&&(this._skipFinalColorClamp=t,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(t){this._applyByPostProcess!==t&&(this._applyByPostProcess=t,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(t){this._isEnabled!==t&&(this._isEnabled=t,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(t){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=0,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.DITHER=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===Q._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case Q.TONEMAPPING_KHR_PBR_NEUTRAL:t.TONEMAPPING=3;break;case Q.TONEMAPPING_ACES:t.TONEMAPPING=2;break;default:t.TONEMAPPING=1}else t.TONEMAPPING=0;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.DITHER=this._ditheringEnabled,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||!!t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING||t.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(t,U){if(this._colorCurvesEnabled&&this.colorCurves&&G.Bind(this.colorCurves,t),this._vignetteEnabled||this._ditheringEnabled){const y=1/(this.outputTextureWidth||t.getEngine().getRenderWidth()),I=1/(this.outputTextureHeight||t.getEngine().getRenderHeight());if(t.setFloat2("vInverseScreenSize",y,I),this._ditheringEnabled&&t.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const r=null!=U?U:I/y;let Y=Math.tan(.5*this.vignetteCameraFov),mt=Y*r;const X=Math.sqrt(mt*Y);mt=(0,M.h)(mt,X,this.vignetteStretch),Y=(0,M.h)(Y,X,this.vignetteStretch),t.setFloat4("vignetteSettings1",mt,Y,-mt*this.vignetteCenterX,-Y*this.vignetteCenterY);const P=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,P)}}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);const U=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(U-1)/U,.5/U,U,this.colorGradingTexture.level)}}clone(){return X.b.Clone((()=>new Q),this)}serialize(){return X.b.Serialize(this)}static Parse(t){const U=X.b.Parse((()=>new Q),t,null,null);return void 0!==t.vignetteCentreX&&(U.vignetteCenterX=t.vignetteCentreX),void 0!==t.vignetteCentreY&&(U.vignetteCenterY=t.vignetteCentreY),U}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}Q.TONEMAPPING_STANDARD=0,Q.TONEMAPPING_ACES=1,Q.TONEMAPPING_KHR_PBR_NEUTRAL=2,Q.PrepareUniforms=L.h,Q.PrepareSamplers=L.d,Q._VIGNETTEMODE_MULTIPLY=0,Q._VIGNETTEMODE_OPAQUE=1,(0,I.b)([(0,r.i)()],Q.prototype,"colorCurves",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_colorCurvesEnabled",void 0),(0,I.b)([(0,r.B)("colorGradingTexture")],Q.prototype,"_colorGradingTexture",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_colorGradingEnabled",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_colorGradingWithGreenDepth",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_colorGradingBGR",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_exposure",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_toneMappingEnabled",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_toneMappingType",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_contrast",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"vignetteStretch",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"vignetteCenterX",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"vignetteCenterY",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"vignetteWeight",void 0),(0,I.b)([(0,r.n)()],Q.prototype,"vignetteColor",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"vignetteCameraFov",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_vignetteBlendMode",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_vignetteEnabled",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_ditheringEnabled",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_ditheringIntensity",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_skipFinalColorClamp",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_applyByPostProcess",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"_isEnabled",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"outputTextureWidth",void 0),(0,I.b)([(0,r.I)()],Q.prototype,"outputTextureHeight",void 0),X.b._ImageProcessingConfigurationParser=Q.Parse,(0,h.f)("BABYLON.ImageProcessingConfiguration",Q)},12679:(t,U,y)=>{y.d(U,{b:()=>Y});var I=y(12221),r=y(12198);class Y{constructor(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers||r,this._dynamic=y,this._name=I??"no-name",this._data=U||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.fX=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.fX=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(t){let U;if(U=t<=2?t:4,this._uniformLocationPointer%U!==0){const t=this._uniformLocationPointer;this._uniformLocationPointer+=U-this._uniformLocationPointer%U;const y=this._uniformLocationPointer-t;for(let U=0;U<y;U++)this._data.push(0)}}addUniform(t,U){let y,I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[t]){if(I>0){if(U instanceof Array)throw"addUniform should not be use with Array in UBO: "+t;if(this._fillAlignment(4),this._uniformArraySizes[t]={strideSize:U,arraySize:I},16==U)U*=I;else{U=U*I+(4-U)*I}y=[];for(let t=0;t<U;t++)y.push(0)}else{if(U instanceof Array)y=U,U=y.length;else{y=[];for(let t=0;t<U;t++)y.push(0)}this._fillAlignment(U)}this._uniformSizes[t]=U,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=U;for(let t=0;t<U;t++)this._data.push(y[t]);this._needSync=!0}}addMatrix(t,U){this.addUniform(t,Array.prototype.slice.call(U.bX()))}addFloat2(t,U,y){const I=[U,y];this.addUniform(t,I)}addFloat3(t,U,y,I){const r=[U,y,I];this.addUniform(t,r)}addColor3(t,U){const y=[U.r,U.g,U.b];this.addUniform(t,y)}addColor4(t,U,y){const I=[U.r,U.g,U.b,y];this.addUniform(t,I)}addVector3(t,U){const y=[U.x,U.y,U.z];this.addUniform(t,y)}addMatrix3x3(t){this.addUniform(t,12)}addMatrix2x2(t){this.addUniform(t,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const t=[];let U=0;for(const y in this._uniformLocations)if(t.push(y),10===++U)break;return t.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(t,U){for(let y=0;y<t.length;++y)if(t[y]!==U[y])return!1;return!0}_copyBuffer(t,U){for(let y=0;y<t.length;++y)U[y]=t[y]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(Y._UpdatedUbosInFrame[this._name]||(Y._UpdatedUbosInFrame[this._name]=0),Y._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(t,U,y){this._checkNewFrame();let r=this._uniformLocations[t];if(void 0===r){if(this._buffer)return void I.b.Error("Cannot add an uniform after UBO has been created. uniformName="+t);this.addUniform(t,y),r=this._uniformLocations[t]}if(this._buffer||this.create(),this._dynamic)for(let I=0;I<y;I++)this._bufferData[r+I]=U[I];else{let t=!1;for(let I=0;I<y;I++)(16===y&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[r+I]!==Math.fround(U[I]))&&(t=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+I]=U[I]);this._needSync=this._needSync||t}}updateUniformArray(t,U,y){this._checkNewFrame();const Y=this._uniformLocations[t];if(void 0===Y)return void I.b.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const mt=this._uniformArraySizes[t];if(this._dynamic)for(let I=0;I<y;I++)this._bufferData[Y+I]=U[I];else{let t=!1,I=0,X=0;for(let P=0;P<y;P++)if(this._bufferData[Y+4*X+I]!==r.Tools.FloatRound(U[P])&&(t=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[Y+4*X+I]=U[P]),I++,I===mt.strideSize){for(;I<4;I++)this._bufferData[Y+4*X+I]=0;I=0,X++}this._needSync=this._needSync||t}}_cacheMatrix(t,U){this._checkNewFrame();const y=this._valueCache[t],I=U.updateFlag;return(void 0===y||y!==I)&&(this._valueCache[t]=I,!0)}_updateMatrix3x3ForUniform(t,U){for(let y=0;y<3;y++)Y._TempBuffer[4*y]=U[3*y],Y._TempBuffer[4*y+1]=U[3*y+1],Y._TempBuffer[4*y+2]=U[3*y+2],Y._TempBuffer[4*y+3]=0;this.updateUniform(t,Y._TempBuffer,12)}_updateMatrix3x3ForEffect(t,U){this._currentEffect.setMatrix3x3(t,U)}_updateMatrix2x2ForEffect(t,U){this._currentEffect.setMatrix2x2(t,U)}_updateMatrix2x2ForUniform(t,U){for(let y=0;y<2;y++)Y._TempBuffer[4*y]=U[2*y],Y._TempBuffer[4*y+1]=U[2*y+1],Y._TempBuffer[4*y+2]=0,Y._TempBuffer[4*y+3]=0;this.updateUniform(t,Y._TempBuffer,8)}_updateFloatForEffect(t,U){this._currentEffect.setFloat(t,U)}_updateFloatForUniform(t,U){Y._TempBuffer[0]=U,this.updateUniform(t,Y._TempBuffer,1)}_updateFloat2ForEffect(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(t+I,U,y)}_updateFloat2ForUniform(t,U,y){Y._TempBuffer[0]=U,Y._TempBuffer[1]=y,this.updateUniform(t,Y._TempBuffer,2)}_updateFloat3ForEffect(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(t+r,U,y,I)}_updateFloat3ForUniform(t,U,y,I){Y._TempBuffer[0]=U,Y._TempBuffer[1]=y,Y._TempBuffer[2]=I,this.updateUniform(t,Y._TempBuffer,3)}_updateFloat4ForEffect(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(t+Y,U,y,I,r)}_updateFloat4ForUniform(t,U,y,I,r){Y._TempBuffer[0]=U,Y._TempBuffer[1]=y,Y._TempBuffer[2]=I,Y._TempBuffer[3]=r,this.updateUniform(t,Y._TempBuffer,4)}_updateFloatArrayForEffect(t,U){this._currentEffect.setFloatArray(t,U)}_updateFloatArrayForUniform(t,U){this.updateUniformArray(t,U,U.length)}_updateArrayForEffect(t,U){this._currentEffect.setArray(t,U)}_updateArrayForUniform(t,U){this.updateUniformArray(t,U,U.length)}_updateIntArrayForEffect(t,U){this._currentEffect.setIntArray(t,U)}_updateIntArrayForUniform(t,U){Y._TempBufferInt32View.set(U),this.updateUniformArray(t,Y._TempBuffer,U.length)}_updateUIntArrayForEffect(t,U){this._currentEffect.setUIntArray(t,U)}_updateUIntArrayForUniform(t,U){Y._TempBufferUInt32View.set(U),this.updateUniformArray(t,Y._TempBuffer,U.length)}_updateMatrixForEffect(t,U){this._currentEffect.setMatrix(t,U)}_updateMatrixForUniform(t,U){this._cacheMatrix(t,U)&&this.updateUniform(t,U.bX(),16)}_updateMatricesForEffect(t,U){this._currentEffect.setMatrices(t,U)}_updateMatricesForUniform(t,U){this.updateUniform(t,U,U.length)}_updateVector3ForEffect(t,U){this._currentEffect.setVector3(t,U)}_updateVector3ForUniform(t,U){Y._TempBuffer[0]=U.x,Y._TempBuffer[1]=U.y,Y._TempBuffer[2]=U.z,this.updateUniform(t,Y._TempBuffer,3)}_updateVector4ForEffect(t,U){this._currentEffect.setVector4(t,U)}_updateVector4ForUniform(t,U){Y._TempBuffer[0]=U.x,Y._TempBuffer[1]=U.y,Y._TempBuffer[2]=U.z,Y._TempBuffer[3]=U.w,this.updateUniform(t,Y._TempBuffer,4)}_updateColor3ForEffect(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(t+y,U)}_updateColor3ForUniform(t,U){Y._TempBuffer[0]=U.r,Y._TempBuffer[1]=U.g,Y._TempBuffer[2]=U.b,this.updateUniform(t,Y._TempBuffer,3)}_updateColor4ForEffect(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(t+I,U,y)}_updateDirectColor4ForEffect(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(t+y,U)}_updateColor4ForUniform(t,U,y){Y._TempBuffer[0]=U.r,Y._TempBuffer[1]=U.g,Y._TempBuffer[2]=U.b,Y._TempBuffer[3]=y,this.updateUniform(t,Y._TempBuffer,4)}_updateDirectColor4ForUniform(t,U){Y._TempBuffer[0]=U.r,Y._TempBuffer[1]=U.g,Y._TempBuffer[2]=U.b,Y._TempBuffer[3]=U.a,this.updateUniform(t,Y._TempBuffer,4)}_updateIntForEffect(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(t+y,U)}_updateIntForUniform(t,U){Y._TempBufferInt32View[0]=U,this.updateUniform(t,Y._TempBuffer,1)}_updateInt2ForEffect(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(t+I,U,y)}_updateInt2ForUniform(t,U,y){Y._TempBufferInt32View[0]=U,Y._TempBufferInt32View[1]=y,this.updateUniform(t,Y._TempBuffer,2)}_updateInt3ForEffect(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(t+r,U,y,I)}_updateInt3ForUniform(t,U,y,I){Y._TempBufferInt32View[0]=U,Y._TempBufferInt32View[1]=y,Y._TempBufferInt32View[2]=I,this.updateUniform(t,Y._TempBuffer,3)}_updateInt4ForEffect(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(t+Y,U,y,I,r)}_updateInt4ForUniform(t,U,y,I,r){Y._TempBufferInt32View[0]=U,Y._TempBufferInt32View[1]=y,Y._TempBufferInt32View[2]=I,Y._TempBufferInt32View[3]=r,this.updateUniform(t,Y._TempBuffer,4)}_updateUIntForEffect(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(t+y,U)}_updateUIntForUniform(t,U){Y._TempBufferUInt32View[0]=U,this.updateUniform(t,Y._TempBuffer,1)}_updateUInt2ForEffect(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(t+I,U,y)}_updateUInt2ForUniform(t,U,y){Y._TempBufferUInt32View[0]=U,Y._TempBufferUInt32View[1]=y,this.updateUniform(t,Y._TempBuffer,2)}_updateUInt3ForEffect(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(t+r,U,y,I)}_updateUInt3ForUniform(t,U,y,I){Y._TempBufferUInt32View[0]=U,Y._TempBufferUInt32View[1]=y,Y._TempBufferUInt32View[2]=I,this.updateUniform(t,Y._TempBuffer,3)}_updateUInt4ForEffect(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(t+Y,U,y,I,r)}_updateUInt4ForUniform(t,U,y,I,r){Y._TempBufferUInt32View[0]=U,Y._TempBufferUInt32View[1]=y,Y._TempBufferUInt32View[2]=I,Y._TempBufferUInt32View[3]=r,this.updateUniform(t,Y._TempBuffer,4)}setTexture(t,U){this._currentEffect.setTexture(t,U)}setTextureArray(t,U){this._currentEffect.setTextureArray(t,U)}bindTexture(t,U){this._currentEffect._bindTexture(t,U)}updateUniformDirectly(t,U){this.updateUniform(t,U,U.length),this.update()}bindToEffect(t,U){this._currentEffect=t,this._currentEffectName=U}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(t){if(!this._buffers)return this._buffer===t;for(let U=0;U<this._buffers.length;++U){if(this._buffers[U][0]===t)return this._bufferIndex=U,this._buffer=t,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[U][1]&&this._bufferData.set(this._buffers[U][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const t=this._engine._uniformBuffers,U=t.indexOf(this);if(-1!==U&&(t[U]=t[t.length-1],t.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let y=0;y<this._buffers.length;++y){const t=this._buffers[y][0];this._engine._releaseBuffer(t)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}Y._UpdatedUbosInFrame={},Y._MAX_UNIFORM_SIZE=256,Y._TempBuffer=new Float32Array(Y._MAX_UNIFORM_SIZE),Y._TempBufferInt32View=new Int32Array(Y._TempBuffer.buffer),Y._TempBufferUInt32View=new Uint32Array(Y._TempBuffer.buffer)},12718:(t,U,y)=>{y.d(U,{e:()=>I});class I{static get UniqueId(){const t=this._UniqueIdCounter;return this._UniqueIdCounter++,t}}I._UniqueIdCounter=1},12716:(t,U,y)=>{y.d(U,{c:()=>I});class I{}I._IsPickingAvailable=!1},12653:(t,U,y)=>{y.d(U,{e:()=>tt});var I=y(12198),r=y(12234),Y=y(12204),mt=y(12496);class X{constructor(){this._count=0,this._data={}}Y(t){this.clear(),t.forEach(((t,U)=>this.add(t,U)))}get(t){const U=this._data[t];if(void 0!==U)return U}getOrAddWithFactory(t,U){let y=this.get(t);return void 0!==y||(y=U(t),y&&this.add(t,y)),y}getOrAdd(t,U){const y=this.get(t);return void 0!==y?y:(this.add(t,U),U)}contains(t){return void 0!==this._data[t]}add(t,U){return void 0===this._data[t]&&(this._data[t]=U,++this._count,!0)}set(t,U){return void 0!==this._data[t]&&(this._data[t]=U,!0)}getAndRemove(t){const U=this.get(t);return void 0!==U?(delete this._data[t],--this._count,U):null}remove(t){return!!this.contains(t)&&(delete this._data[t],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(t){for(const U in this._data){t(U,this._data[U])}}first(t){for(const U in this._data){const y=t(U,this._data[U]);if(y)return y}return null}}var P=y(12434),G=y(12386),M=y(12662),L=y(12679),h=y(12687);class Q{constructor(t,U,y,I,r,Y){this.source=t,this.pointerX=U,this.pointerY=y,this.meshUnderPointer=I,this.sourceEvent=r,this.additionalData=Y}static CreateNew(t,U,y){const I=t.St();return new Q(t,I.pointerX,I.pointerY,I.meshUnderPointer||t,U,y)}static CreateNewFromSprite(t,U,y,I){return new Q(t,U.pointerX,U.pointerY,U.meshUnderPointer,y,I)}static CreateNewFromScene(t,U){return new Q(null,t.pointerX,t.pointerY,t.meshUnderPointer,U)}static CreateNewFromPrimitive(t,U,y,I){return new Q(t,U.x,U.y,null,y,I)}}var F=y(12472),E=y(12493),w=y(12694),D=y(12212),l=y(12250),g=y(12242),B=y(12698);class b{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const t in b.Triggers)if(Object.prototype.hasOwnProperty.call(b.Triggers,t))return!0;return!1}static get HasPickTriggers(){for(const t in b.Triggers)if(Object.prototype.hasOwnProperty.call(b.Triggers,t)){const U=parseInt(t);if(U>=1&&U<=7)return!0}return!1}static HasSpecificTrigger(t){for(const U in b.Triggers)if(Object.prototype.hasOwnProperty.call(b.Triggers,U)){if(parseInt(U)===t)return!0}return!1}}b.Triggers={};var p,c,f,S,N,j,J,a=y(12706);!function(t){t[t.Generic=0]="Generic",t[t.Keyboard=1]="Keyboard",t[t.Mouse=2]="Mouse",t[t.Touch=3]="Touch",t[t.DualShock=4]="DualShock",t[t.Xbox=5]="Xbox",t[t.Switch=6]="Switch",t[t.DualSense=7]="DualSense"}(p||(p={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.LeftClick=2]="LeftClick",t[t.MiddleClick=3]="MiddleClick",t[t.RightClick=4]="RightClick",t[t.BrowserBack=5]="BrowserBack",t[t.BrowserForward=6]="BrowserForward",t[t.MouseWheelX=7]="MouseWheelX",t[t.MouseWheelY=8]="MouseWheelY",t[t.MouseWheelZ=9]="MouseWheelZ",t[t.Move=12]="Move"}(c||(c={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.LeftClick=2]="LeftClick",t[t.MiddleClick=3]="MiddleClick",t[t.RightClick=4]="RightClick",t[t.BrowserBack=5]="BrowserBack",t[t.BrowserForward=6]="BrowserForward",t[t.MouseWheelX=7]="MouseWheelX",t[t.MouseWheelY=8]="MouseWheelY",t[t.MouseWheelZ=9]="MouseWheelZ",t[t.DeltaHorizontal=10]="DeltaHorizontal",t[t.DeltaVertical=11]="DeltaVertical"}(f||(f={})),function(t){t[t.Cross=0]="Cross",t[t.Circle=1]="Circle",t[t.Square=2]="Square",t[t.Triangle=3]="Triangle",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.L2=6]="L2",t[t.R2=7]="R2",t[t.Share=8]="Share",t[t.Options=9]="Options",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.TouchPad=17]="TouchPad",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(S||(S={})),function(t){t[t.Cross=0]="Cross",t[t.Circle=1]="Circle",t[t.Square=2]="Square",t[t.Triangle=3]="Triangle",t[t.L1=4]="L1",t[t.R1=5]="R1",t[t.L2=6]="L2",t[t.R2=7]="R2",t[t.Create=8]="Create",t[t.Options=9]="Options",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.TouchPad=17]="TouchPad",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(N||(N={})),function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.LB=4]="LB",t[t.RB=5]="RB",t[t.LT=6]="LT",t[t.RT=7]="RT",t[t.Back=8]="Back",t[t.Start=9]="Start",t[t.LS=10]="LS",t[t.RS=11]="RS",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.LStickXAxis=17]="LStickXAxis",t[t.LStickYAxis=18]="LStickYAxis",t[t.RStickXAxis=19]="RStickXAxis",t[t.RStickYAxis=20]="RStickYAxis"}(j||(j={})),function(t){t[t.B=0]="B",t[t.A=1]="A",t[t.Y=2]="Y",t[t.X=3]="X",t[t.L=4]="L",t[t.R=5]="R",t[t.ZL=6]="ZL",t[t.ZR=7]="ZR",t[t.Minus=8]="Minus",t[t.Plus=9]="Plus",t[t.LS=10]="LS",t[t.RS=11]="RS",t[t.DPadUp=12]="DPadUp",t[t.DPadDown=13]="DPadDown",t[t.DPadLeft=14]="DPadLeft",t[t.DPadRight=15]="DPadRight",t[t.Home=16]="Home",t[t.Capture=17]="Capture",t[t.LStickXAxis=18]="LStickXAxis",t[t.LStickYAxis=19]="LStickYAxis",t[t.RStickXAxis=20]="RStickXAxis",t[t.RStickYAxis=21]="RStickYAxis"}(J||(J={}));var d=y(12708);class q{static CreateDeviceEvent(t,U,y,I,r,Y,mt){switch(t){case p.Keyboard:return this._CreateKeyboardEvent(y,I,r,Y);case p.Mouse:if(y===c.MouseWheelX||y===c.MouseWheelY||y===c.MouseWheelZ)return this._CreateWheelEvent(t,U,y,I,r,Y);case p.Touch:return this._CreatePointerEvent(t,U,y,I,r,Y,mt);default:throw`Unable to generate event for device ${p[t]}`}}static _CreatePointerEvent(t,U,y,I,r,Y,mt){const X=this._CreateMouseEvent(t,U,y,I,r,Y);t===p.Mouse?(X.deviceType=p.Mouse,X.pointerId=1,X.pointerType="mouse"):(X.deviceType=p.Touch,X.pointerId=mt??U,X.pointerType="touch");let P=0;return P+=r.pollInput(t,U,c.LeftClick),P+=2*r.pollInput(t,U,c.RightClick),P+=4*r.pollInput(t,U,c.MiddleClick),X.buttons=P,y===c.Move?X.type="pointermove":y>=c.LeftClick&&y<=c.RightClick&&(X.type=1===I?"pointerdown":"pointerup",X.button=y-2),X}static _CreateWheelEvent(t,U,y,I,r,Y){const mt=this._CreateMouseEvent(t,U,y,I,r,Y);switch(mt.pointerId=1,mt.type="wheel",mt.deltaMode=d.d.DOM_DELTA_PIXEL,mt.deltaX=0,mt.deltaY=0,mt.deltaZ=0,y){case c.MouseWheelX:mt.deltaX=I;break;case c.MouseWheelY:mt.deltaY=I;break;case c.MouseWheelZ:mt.deltaZ=I}return mt}static _CreateMouseEvent(t,U,y,I,r,Y){const mt=this._CreateEvent(Y),X=r.pollInput(t,U,c.Horizontal),P=r.pollInput(t,U,c.Vertical);return Y?(mt.movementX=0,mt.movementY=0,mt.offsetX=mt.movementX-Y.getBoundingClientRect().x,mt.offsetY=mt.movementY-Y.getBoundingClientRect().y):(mt.movementX=r.pollInput(t,U,10),mt.movementY=r.pollInput(t,U,11),mt.offsetX=0,mt.offsetY=0),this._CheckNonCharacterKeys(mt,r),mt.clientX=X,mt.clientY=P,mt.x=X,mt.y=P,mt.deviceType=t,mt.deviceSlot=U,mt.inputIndex=y,mt}static _CreateKeyboardEvent(t,U,y,I){const r=this._CreateEvent(I);return this._CheckNonCharacterKeys(r,y),r.deviceType=p.Keyboard,r.deviceSlot=0,r.inputIndex=t,r.type=1===U?"keydown":"keyup",r.key=String.fromCharCode(t),r.keyCode=t,r}static _CheckNonCharacterKeys(t,U){const y=U.isDeviceAvailable(p.Keyboard),I=y&&1===U.pollInput(p.Keyboard,0,18),r=y&&1===U.pollInput(p.Keyboard,0,17),Y=y&&(1===U.pollInput(p.Keyboard,0,91)||1===U.pollInput(p.Keyboard,0,92)||1===U.pollInput(p.Keyboard,0,93)),mt=y&&1===U.pollInput(p.Keyboard,0,16);t.altKey=I,t.ctrlKey=r,t.metaKey=Y,t.shiftKey=mt}static _CreateEvent(t){const U={preventDefault:()=>{}};return U.target=t,U}}class H{constructor(t,U,y){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(t,U,((t,U,I,r)=>{const Y=q.CreateDeviceEvent(t,U,I,r,this);y(t,U,Y)})):this._createDummyNativeInput()}pollInput(t,U,y){return this._nativeInput.pollInput(t,U,y)}isDeviceAvailable(t){return t===p.Mouse||t===p.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const e=Object.keys(c).length/2;class o{constructor(t,U,y,r){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=I.Tools.IsSafari(),this._usingMacOs=(0,D.l)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=t=>{},this._keyboardUpEvent=t=>{},this._keyboardBlurEvent=t=>{},this._pointerMoveEvent=t=>{},this._pointerDownEvent=t=>{},this._pointerUpEvent=t=>{},this._pointerCancelEvent=t=>{},this._pointerCancelTouch=t=>{},this._pointerLeaveEvent=t=>{},this._pointerWheelEvent=t=>{},this._pointerBlurEvent=t=>{},this._pointerMacOsChromeOutEvent=t=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,D.l)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,D.l)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=t=>{},this._gamepadDisconnectedEvent=t=>{},this._eventPrefix=I.Tools.GetPointerPrefix(t),this._engine=t,this._onDeviceConnected=U,this._onDeviceDisconnected=y,this._onInputChanged=r,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(t,U,y){const r=this._inputs[t][U];if(!r)throw`Unable to find device ${p[t]}`;t>=p.DualShock&&t<=p.DualSense&&this._updateDevice(t,U,y);const Y=r[y];if(void 0===Y)throw`Unable to find input ${y} for device ${p[t]} in slot ${U}`;return y===c.Move&&I.Tools.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),Y}isDeviceAvailable(t){return void 0!==this._inputs[t]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const t=null===this||void 0===this?void 0:this._engine.getInputElement();if(t&&(!this._eventsAttached||this._elementToAttachTo!==t)){if(this._disableEvents(),this._inputs)for(const t of this._inputs)if(t)for(const U in t){const y=t[+U];if(y)for(let t=0;t<y.length;t++)y[t]=0}this._elementToAttachTo=t,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"PX",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const t=navigator.getGamepads();for(const U of t)U&&this._addGamePad(U)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(p.Mouse,0,0,0)}_addGamePad(t){const U=this._getGamepadDeviceType(t.id),y=t.index;this._gamepads=this._gamepads||new Array(t.index+1),this._registerDevice(U,y,t.buttons.length+t.axes.length),this._gamepads[y]=U}_addPointerDevice(t,U,y,I){this._pointerActive||(this._pointerActive=!0),this._registerDevice(t,U,e);const r=this._inputs[t][U];r[0]=y,r[1]=I}_registerDevice(t,U,y){if(void 0===U)throw`Unable to register device ${p[t]} to undefined slot.`;if(this._inputs[t]||(this._inputs[t]={}),!this._inputs[t][U]){const I=new Array(y);I.fill(0),this._inputs[t][U]=I,this._onDeviceConnected(t,U)}}_unregisterDevice(t,U){this._inputs[t][U]&&(delete this._inputs[t][U],this._onDeviceDisconnected(t,U))}_handleKeyActions(){this._keyboardDownEvent=t=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(p.Keyboard,0,255));const U=this._inputs[p.Keyboard][0];if(U){U[t.keyCode]=1;const y=t;y.inputIndex=t.keyCode,this._usingMacOs&&t.metaKey&&"Meta"!==t.key&&(this._metaKeys.includes(t.keyCode)||this._metaKeys.push(t.keyCode)),this._onInputChanged(p.Keyboard,0,y)}},this._keyboardUpEvent=t=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(p.Keyboard,0,255));const U=this._inputs[p.Keyboard][0];if(U){U[t.keyCode]=0;const y=t;if(y.inputIndex=t.keyCode,this._usingMacOs&&"Meta"===t.key&&this._metaKeys.length>0){for(const t of this._metaKeys){const y=q.CreateDeviceEvent(p.Keyboard,0,t,0,this,this._elementToAttachTo);U[t]=0,this._onInputChanged(p.Keyboard,0,y)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(p.Keyboard,0,y)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const t=this._inputs[p.Keyboard][0];for(let U=0;U<t.length;U++)if(0!==t[U]){t[U]=0;const y=q.CreateDeviceEvent(p.Keyboard,0,U,0,this,this._elementToAttachTo);this._onInputChanged(p.Keyboard,0,y)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,D.l)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let I=0;I<this._maxTouchPoints;I++)this._activeTouchIds[I]=-1;this._pointerMoveEvent=t=>{const U=this._getPointerType(t);let y=U===p.Mouse?0:this._activeTouchIds.indexOf(t.pointerId);if(U===p.Touch&&-1===y){const r=this._activeTouchIds.indexOf(-1);if(!(r>=0))return void I.Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=r,this._activeTouchIds[r]=t.pointerId,this._onDeviceConnected(U,y)}this._inputs[U]||(this._inputs[U]={}),this._inputs[U][y]||this._addPointerDevice(U,y,t.clientX,t.clientY);const r=this._inputs[U][y];if(r){const I=t;I.inputIndex=c.Move,r[c.Horizontal]=t.clientX,r[c.Vertical]=t.clientY,U===p.Touch&&0===r[c.LeftClick]&&(r[c.LeftClick]=1),void 0===t.pointerId&&(t.pointerId=this._mouseId),this._onInputChanged(U,y,I),this._usingSafari||-1===t.button||(I.inputIndex=t.button+2,r[t.button+2]=r[t.button+2]?0:1,this._onInputChanged(U,y,I))}},this._pointerDownEvent=t=>{const U=this._getPointerType(t);let y=U===p.Mouse?0:t.pointerId;if(U===p.Touch){let U=this._activeTouchIds.indexOf(t.pointerId);if(-1===U&&(U=this._activeTouchIds.indexOf(-1)),!(U>=0))return void I.Tools.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);y=U,this._activeTouchIds[U]=t.pointerId}this._inputs[U]||(this._inputs[U]={}),this._inputs[U][y]?U===p.Touch&&this._onDeviceConnected(U,y):this._addPointerDevice(U,y,t.clientX,t.clientY);const r=this._inputs[U][y];if(r){const I=r[c.Horizontal],mt=r[c.Vertical];if(U===p.Mouse){if(void 0===t.pointerId&&(t.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(Y){}}else if(t.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(t.pointerId)}catch(Y){}r[c.Horizontal]=t.clientX,r[c.Vertical]=t.clientY,r[t.button+2]=1;const X=t;X.inputIndex=t.button+2,this._onInputChanged(U,y,X),I===t.clientX&&mt===t.clientY||(X.inputIndex=c.Move,this._onInputChanged(U,y,X))}},this._pointerUpEvent=t=>{var U;const y=this._getPointerType(t),I=y===p.Mouse?0:this._activeTouchIds.indexOf(t.pointerId);if(y===p.Touch){if(-1===I)return;this._activeTouchIds[I]=-1}const r=null===(U=this._inputs[y])||void 0===U?void 0:U[I];let Y=t.button,mt=r&&0!==r[Y+2];if(!mt&&this._isUsingFirefox&&this._usingMacOs&&r&&(Y=2===Y?0:2,mt=0!==r[Y+2]),mt){var X,P,G,M;const U=r[c.Horizontal],mt=r[c.Vertical];r[c.Horizontal]=t.clientX,r[c.Vertical]=t.clientY,r[Y+2]=0;const L=t;void 0===t.pointerId&&(t.pointerId=this._mouseId),U===t.clientX&&mt===t.clientY||(L.inputIndex=c.Move,this._onInputChanged(y,I,L)),L.inputIndex=Y+2,y===p.Mouse&&this._mouseId>=0&&null!==(X=(P=this._elementToAttachTo).hasPointerCapture)&&void 0!==X&&X.call(P,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):t.pointerId&&null!==(G=(M=this._elementToAttachTo).hasPointerCapture)&&void 0!==G&&G.call(M,t.pointerId)&&this._elementToAttachTo.releasePointerCapture(t.pointerId),this._onInputChanged(y,I,L),y===p.Touch&&this._onDeviceDisconnected(y,I)}},this._pointerCancelTouch=t=>{var U,y;const I=this._activeTouchIds.indexOf(t);if(-1===I)return;null!==(U=(y=this._elementToAttachTo).hasPointerCapture)&&void 0!==U&&U.call(y,t)&&this._elementToAttachTo.releasePointerCapture(t),this._inputs[p.Touch][I][c.LeftClick]=0;const r=q.CreateDeviceEvent(p.Touch,I,c.LeftClick,0,this,this._elementToAttachTo,t);this._onInputChanged(p.Touch,I,r),this._activeTouchIds[I]=-1,this._onDeviceDisconnected(p.Touch,I)},this._pointerCancelEvent=t=>{if("mouse"===t.pointerType){var U,y;const t=this._inputs[p.Mouse][0];this._mouseId>=0&&null!==(U=(y=this._elementToAttachTo).hasPointerCapture)&&void 0!==U&&U.call(y,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let U=c.LeftClick;U<=c.BrowserForward;U++)if(1===t[U]){t[U]=0;const y=q.CreateDeviceEvent(p.Mouse,0,U,0,this,this._elementToAttachTo);this._onInputChanged(p.Mouse,0,y)}}else this._pointerCancelTouch(t.pointerId)},this._pointerLeaveEvent=t=>{"pen"===t.pointerType&&this._pointerCancelTouch(t.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let t=!1;const U=function(){};try{const y=Object.defineProperty({},"passive",{get:function(){t=!0}});this._elementToAttachTo.addEventListener("test",U,y),this._elementToAttachTo.removeEventListener("test",U,y)}catch(y){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(p.Mouse)){var t,U;const y=this._inputs[p.Mouse][0];this._mouseId>=0&&null!==(t=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==t&&t.call(U,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=c.LeftClick;t<=c.BrowserForward;t++)if(1===y[t]){y[t]=0;const U=q.CreateDeviceEvent(p.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(p.Mouse,0,U)}}if(this.isDeviceAvailable(p.Touch)){const t=this._inputs[p.Touch];for(let U=0;U<this._activeTouchIds.length;U++){var y,I,r;const Y=this._activeTouchIds[U];if(null!==(y=(I=this._elementToAttachTo).hasPointerCapture)&&void 0!==y&&y.call(I,Y)&&this._elementToAttachTo.releasePointerCapture(Y),-1!==Y&&1===(null===(r=t[U])||void 0===r?void 0:r[c.LeftClick])){t[U][c.LeftClick]=0;const y=q.CreateDeviceEvent(p.Touch,U,c.LeftClick,0,this,this._elementToAttachTo,Y);this._onInputChanged(p.Touch,U,y),this._activeTouchIds[U]=-1,this._onDeviceDisconnected(p.Touch,U)}}}},this._pointerWheelEvent=t=>{const U=p.Mouse;this._inputs[U]||(this._inputs[U]=[]),this._inputs[U][0]||(this._pointerActive=!0,this._registerDevice(U,0,e));const y=this._inputs[U][0];if(y){y[c.MouseWheelX]=t.deltaX||0,y[c.MouseWheelY]=t.deltaY||t.wheelDelta||0,y[c.MouseWheelZ]=t.deltaZ||0;const I=t;void 0===t.pointerId&&(t.pointerId=this._mouseId),0!==y[c.MouseWheelX]&&(I.inputIndex=c.MouseWheelX,this._onInputChanged(U,0,I)),0!==y[c.MouseWheelY]&&(I.inputIndex=c.MouseWheelY,this._onInputChanged(U,0,I)),0!==y[c.MouseWheelZ]&&(I.inputIndex=c.MouseWheelZ,this._onInputChanged(U,0,I))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=t=>{t.buttons>1&&this._pointerCancelEvent(t)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"PX",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!t&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(p.Mouse)){const t=this._inputs[p.Mouse][0];t[c.MouseWheelX]=0,t[c.MouseWheelY]=0,t[c.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=t=>{this._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=t=>{if(this._gamepads){const U=this._getGamepadDeviceType(t.gamepad.id),y=t.gamepad.index;this._unregisterDevice(U,y),delete this._gamepads[y]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(t,U,y){const I=navigator.getGamepads()[U];if(I&&t===this._gamepads[U]){const r=this._inputs[t][U];y>=I.buttons.length?r[y]=I.axes[y-I.buttons.length].valueOf():r[y]=I.buttons[y].value}}_getGamepadDeviceType(t){return-1!==t.indexOf("054c")?-1!==t.indexOf("0ce6")?p.DualSense:p.DualShock:-1!==t.indexOf("Xbox One")||-1!==t.search("Xbox 360")||-1!==t.search("xinput")?p.Xbox:-1!==t.indexOf("057e")?p.Switch:p.Generic}_getPointerType(t){let U=p.Mouse;return("touch"===t.pointerType||"pen"===t.pointerType||t.touches)&&(U=p.Touch),U}}class V{constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=U,this.deviceSlot=y,this.onInputChangedObservable=new Y.b,this._deviceInputSystem=t}getInput(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)}}class n{constructor(t){this._registeredManagers=new Array,this._refCount=0,this.registerManager=t=>{for(let U=0;U<this._devices.length;U++){const y=this._devices[U];for(const I in y){const y=+I;t._addDevice(new V(this._deviceInputSystem,U,y))}}this._registeredManagers.push(t)},this.unregisterManager=t=>{const U=this._registeredManagers.indexOf(t);U>-1&&this._registeredManagers.splice(U,1)};const U=Object.keys(p).length/2;this._devices=new Array(U);const y=(t,U)=>{this._devices[t]||(this._devices[t]=new Array),this._devices[t][U]||(this._devices[t][U]=U);for(const y of this._registeredManagers){const I=new V(this._deviceInputSystem,t,U);y._addDevice(I)}},I=(t,U)=>{var y;null!==(y=this._devices[t])&&void 0!==y&&y[U]&&delete this._devices[t][U];for(const I of this._registeredManagers)I._removeDevice(t,U)},r=(t,U,y)=>{if(y)for(const I of this._registeredManagers)I._onInputChanged(t,U,y)};"undefined"!==typeof _native?this._deviceInputSystem=new H(y,I,r):this._deviceInputSystem=new o(t,y,I,r)}dispose(){this._deviceInputSystem.dispose()}}class i{getDeviceSource(t,U){if(void 0===U){if(void 0===this._firstDevice[t])return null;U=this._firstDevice[t]}return this._devices[t]&&void 0!==this._devices[t][U]?this._devices[t][U]:null}getDeviceSources(t){return this._devices[t]?this._devices[t].filter((t=>!!t)):[]}constructor(t){const U=Object.keys(p).length/2;this._devices=new Array(U),this._firstDevice=new Array(U),this._engine=t,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new n(t)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new Y.b((t=>{for(const U of this._devices)if(U)for(const y of U)y&&this.onDeviceConnectedObservable.notifyObserver(t,y)})),this.onDeviceDisconnectedObservable=new Y.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=t.FX.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.FX.remove(this._onDisposeObserver)}_addDevice(t){this._devices[t.deviceType]||(this._devices[t.deviceType]=[]),this._devices[t.deviceType][t.deviceSlot]||(this._devices[t.deviceType][t.deviceSlot]=t,this._updateFirstDevices(t.deviceType)),this.onDeviceConnectedObservable.notifyObservers(t)}_removeDevice(t,U){var y,I;const r=null===(y=this._devices[t])||void 0===y?void 0:y[U];this.onDeviceDisconnectedObservable.notifyObservers(r),null!==(I=this._devices[t])&&void 0!==I&&I[U]&&delete this._devices[t][U],this._updateFirstDevices(t)}_onInputChanged(t,U,y){var I,r;null===(I=this._devices[t])||void 0===I||null===(r=I[U])||void 0===r||r.onInputChangedObservable.notifyObservers(y)}_updateFirstDevices(t){switch(t){case p.Keyboard:case p.Mouse:this._firstDevice[t]=0;break;case p.Touch:case p.DualSense:case p.DualShock:case p.Xbox:case p.Switch:case p.Generic:{delete this._firstDevice[t];const U=this._devices[t];if(U)for(let y=0;y<U.length;y++)if(U[y]){this._firstDevice[t]=y;break}break}}}}var v=y(12716);class O{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get cI(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(t){this._singleClick=t}set cI(t){this._doubleClick=t}set hasSwiped(t){this._hasSwiped=t}set ignore(t){this._ignore=t}}class k{constructor(t){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new G.Vector2(0,0),this._previousStartingPointerPosition=new G.Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=t||l.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(t){return this._meshUnderPointerId[t]||null}get unTranslatedPointer(){return new G.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(t){this._pointerX=t}get pointerY(){return this._pointerY}set pointerY(t){this._pointerY=t}_updatePointerPosition(t){const U=this._scene.getEngine().getInputElementClientRect();U&&(this._pointerX=t.clientX-U.left,this._pointerY=t.clientY-U.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(t,U){const y=this._scene,I=y.getEngine(),r=I.getInputElement();r&&(r.tabIndex=I.canvasTabIndex,y.doNotHandleCursors||(r.style.cursor=y.defaultCursor)),this._setCursorAndPointerOverMesh(t,U,y);for(const P of y._pointerMoveStage){var Y;const y=!(null===(Y=t=t||this._pickMove(U))||void 0===Y||!Y.pickedMesh);t=P.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,y,r)}const mt=U.inputIndex>=c.MouseWheelX&&U.inputIndex<=c.MouseWheelZ?B.d.POINTERWHEEL:B.d.POINTERMOVE;let X;y.onPointerMove&&(t=t||this._pickMove(U),y.onPointerMove(U,t,mt)),t?(X=new B.i(mt,U,t),this._setRayOnPointerInfo(t,U)):(X=new B.i(mt,U,null,this),this._movePointerInfo=X),y.onPointerObservable.hasObservers()&&y.onPointerObservable.notifyObservers(X,mt)}_setRayOnPointerInfo(t,U){const y=this._scene;t&&v.c._IsPickingAvailable&&(t.ray||(t.ray=y.createPickingRay(U.offsetX,U.offsetY,G.Matrix.Identity(),y.activeCamera)))}_addCameraPointerObserver(t,U){return this._cameraObserverCount++,this._scene.onPointerObservable.add(t,U)}_removeCameraPointerObserver(t){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(t)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(t,U,y){const I=this._scene,r=new B.f(y,U,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(r.originalPickingInfo=t,r.ray=t.ray,"xr-near"===U.pointerType&&t.originMesh&&(r.nearInteractionPickingInfo=t)),I.onPrePointerObservable.notifyObservers(r,y),!!r.skipOnPointerObservable}_pickMove(t){const U=this._scene,y=U.wy(this._unTranslatedPointerX,this._unTranslatedPointerY,U.pointerMovePredicate,U.pointerMoveFastCheck,U.cameraToUseForPointers,U.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(y,t,U),y}_setCursorAndPointerOverMesh(t,U,y){const I=y.getEngine().getInputElement();if(null!==t&&void 0!==t&&t.pickedMesh){if(this.setPointerOverMesh(t.pickedMesh,U.pointerId,t,U),!y.doNotHandleCursors&&I&&this._pointerOverMesh){const t=this._pointerOverMesh._getActionManagerForTrigger();t&&t.hasPointerTriggers&&(I.style.cursor=t.hoverCursor||y.hoverCursor)}}else this.setPointerOverMesh(null,U.pointerId,t,U)}simulatePointerMove(t,U){const y=new PointerEvent("pointermove",U);y.inputIndex=c.Move,this._checkPrePointerObservable(t,y,B.d.POINTERMOVE)||this._processPointerMove(t,y)}simulatePointerDown(t,U){const y=new PointerEvent("pointerdown",U);y.inputIndex=y.button+2,this._checkPrePointerObservable(t,y,B.d.POINTERDOWN)||this._processPointerDown(t,y)}_processPointerDown(t,U){var y;const I=this._scene;if(null!==(y=t)&&void 0!==y&&y.pickedMesh){this._pickedDownMesh=t.pickedMesh;const y=t.pickedMesh._getActionManagerForTrigger();if(y){if(y.hasPickTriggers)switch(y.processTrigger(5,new Q(t.pickedMesh,I.pointerX,I.pointerY,t.pickedMesh,U,t)),U.button){case 0:y.processTrigger(2,new Q(t.pickedMesh,I.pointerX,I.pointerY,t.pickedMesh,U,t));break;case 1:y.processTrigger(4,new Q(t.pickedMesh,I.pointerX,I.pointerY,t.pickedMesh,U,t));break;case 2:y.processTrigger(3,new Q(t.pickedMesh,I.pointerX,I.pointerY,t.pickedMesh,U,t))}y.hasSpecificTrigger(8)&&window.setTimeout((()=>{const t=I.wy(this._unTranslatedPointerX,this._unTranslatedPointerY,(t=>t.KP&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(8)&&t===this._pickedDownMesh),!1,I.cameraToUseForPointers);null!==t&&void 0!==t&&t.pickedMesh&&y&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>k.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,y.processTrigger(8,Q.CreateNew(t.pickedMesh,U)))}),k.LongPressDelay)}}else for(const mt of I._pointerDownStage)t=mt.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,U,!1);let r;const Y=B.d.POINTERDOWN;t?(I.onPointerDown&&I.onPointerDown(U,t,Y),r=new B.i(Y,U,t),this._setRayOnPointerInfo(t,U)):r=new B.i(Y,U,null,this),I.onPointerObservable.hasObservers()&&I.onPointerObservable.notifyObservers(r,Y)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(t,U,y){const I=new PointerEvent("pointerup",U);I.inputIndex=c.Move;const r=new O;y?r.cI=!0:r.singleClick=!0,this._checkPrePointerObservable(t,I,B.d.POINTERUP)||this._processPointerUp(t,I,r)}_processPointerUp(t,U,y){var I;const r=this._scene;if(null!==(I=t)&&void 0!==I&&I.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(U,t),y.singleClick&&!y.ignore&&r.onPointerObservable.observers.length>this._cameraObserverCount)){const y=B.d.POINTERPICK,I=new B.i(y,U,t);this._setRayOnPointerInfo(t,U),r.onPointerObservable.notifyObservers(I,y)}const I=t.pickedMesh._getActionManagerForTrigger();if(I&&!y.ignore){I.processTrigger(7,Q.CreateNew(t.pickedMesh,U,t)),!y.hasSwiped&&y.singleClick&&I.processTrigger(1,Q.CreateNew(t.pickedMesh,U,t));const r=t.pickedMesh._getActionManagerForTrigger(6);y.cI&&r&&r.processTrigger(6,Q.CreateNew(t.pickedMesh,U,t))}}else if(!y.ignore)for(const Y of r._pointerUpStage)t=Y.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,U,y.cI);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const t=this._pickedDownMesh._getActionManagerForTrigger(16);t&&t.processTrigger(16,Q.CreateNew(this._pickedDownMesh,U))}if(!y.ignore){const I=new B.i(B.d.POINTERUP,U,t);if(this._setRayOnPointerInfo(t,U),r.onPointerObservable.notifyObservers(I,B.d.POINTERUP),r.onPointerUp&&r.onPointerUp(U,t,B.d.POINTERUP),!y.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let I=0;if(y.singleClick?I=B.d.POINTERTAP:y.cI&&(I=B.d.POINTERDOUBLETAP),I){const y=new B.i(I,U,t);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(I)&&r.onPointerObservable.notifyObservers(y,I)}}}}isPointerCaptured(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[t]}attachControl(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this._scene,Y=r.getEngine();I||(I=Y.getInputElement()),this._alreadyAttached&&this.vL(),I&&(this._alreadyAttachedTo=I),this._deviceSourceManager=new i(Y),this._initActionManager=t=>{if(!this._meshPickProceed){const U=r.skipPointerUpPicking||0===r._registeredActions&&!this._checkForPicking()&&!r.onPointerUp?null:r.wy(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerUpPredicate,r.pointerUpFastCheck,r.cameraToUseForPointers,r.pointerUpTrianglePredicate);this._currentPickResult=U,U&&(t=U.hit&&U.pickedMesh?U.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return t},this._delayedSimpleClick=(t,U,y)=>{if((Date.now()-this._previousStartingPointerTime>k.DoubleClickDelay&&!this._doubleClickOccured||t!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,U.singleClick=!0,U.ignore=!1,this._delayedClicks[t])){const U=this._delayedClicks[t].evt,y=B.d.POINTERTAP,I=new B.i(y,U,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(y)&&r.onPointerObservable.notifyObservers(I,y),this._delayedClicks[t]=null}},this._initClickEvent=(t,U,y,I)=>{const r=new O;this._currentPickResult=null;let Y=null,mt=t.hasSpecificMask(B.d.POINTERPICK)||U.hasSpecificMask(B.d.POINTERPICK)||t.hasSpecificMask(B.d.POINTERTAP)||U.hasSpecificMask(B.d.POINTERTAP)||t.hasSpecificMask(B.d.POINTERDOUBLETAP)||U.hasSpecificMask(B.d.POINTERDOUBLETAP);!mt&&b&&(Y=this._initActionManager(Y,r),Y&&(mt=Y.hasPickTriggers));let X=!1;if(mt=mt&&!this._isMultiTouchGesture,mt){const mt=y.button;if(r.hasSwiped=this._isPointerSwiping(),!r.hasSwiped){let M=!k.ExclusiveDoubleClickMode;if(M||(M=!t.hasSpecificMask(B.d.POINTERDOUBLETAP)&&!U.hasSpecificMask(B.d.POINTERDOUBLETAP),M&&!b.HasSpecificTrigger(6)&&(Y=this._initActionManager(Y,r),Y&&(M=!Y.hasSpecificTrigger(6)))),M)(Date.now()-this._previousStartingPointerTime>k.DoubleClickDelay||mt!==this._previousButtonPressed)&&(r.singleClick=!0,I(r,this._currentPickResult),X=!0);else{const t={evt:y,clickInfo:r,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,mt,r,I),k.DoubleClickDelay)};this._delayedClicks[mt]=t}let L=t.hasSpecificMask(B.d.POINTERDOUBLETAP)||U.hasSpecificMask(B.d.POINTERDOUBLETAP);if(!L&&b.HasSpecificTrigger(6)&&(Y=this._initActionManager(Y,r),Y&&(L=Y.hasSpecificTrigger(6))),L)if(mt===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<k.DoubleClickDelay&&!this._doubleClickOccured){if(r.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=mt,k.ExclusiveDoubleClickMode){var P;if(this._delayedClicks[mt])clearTimeout(null===(P=this._delayedClicks[mt])||void 0===P?void 0:P.timeoutId),this._delayedClicks[mt]=null;I(r,this._previousPickResult)}else I(r,this._currentPickResult);else{var G;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,r.cI=!0,r.ignore=!1,k.ExclusiveDoubleClickMode&&this._delayedClicks[mt])clearTimeout(null===(G=this._delayedClicks[mt])||void 0===G?void 0:G.timeoutId),this._delayedClicks[mt]=null;I(r,this._currentPickResult)}X=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=mt}}X||I(r,this._currentPickResult)},this._onPointerMove=t=>{if(this._updatePointerPosition(t),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>k.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>k.DragMovementThreshold),Y.isPointerLock&&Y._verifyPointerLock(),this._checkPrePointerObservable(null,t,t.inputIndex>=c.MouseWheelX&&t.inputIndex<=c.MouseWheelZ?B.d.POINTERWHEEL:B.d.POINTERMOVE))return;if(!r.cameraToUseForPointers&&!r.activeCamera)return;if(r.WL)return void this._processPointerMove(new h.c,t);r.pointerMovePredicate||(r.pointerMovePredicate=t=>t.KP&&t.isVisible&&t.isReady()&&t.isEnabled()&&(t.enablePointerMoveEvents||r.constantlyUpdateMeshUnderPointer||null!==t._getActionManagerForTrigger())&&(!r.cameraToUseForPointers||0!==(r.cameraToUseForPointers.layerMask&t.layerMask)));const U=r._registeredActions>0||r.constantlyUpdateMeshUnderPointer?this._pickMove(t):null;this._processPointerMove(U,t)},this._onPointerDown=t=>{const U=this._activePointerIds.indexOf(-1);if(-1===U?this._activePointerIds.push(t.pointerId):this._activePointerIds[U]=t.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,k.ExclusiveDoubleClickMode)for(let I=0;I<this._delayedClicks.length;I++)if(this._delayedClicks[I])if(t.button===I){var y;clearTimeout(null===(y=this._delayedClicks[I])||void 0===y?void 0:y.timeoutId)}else{const t=this._delayedClicks[I].clickInfo;this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1;const U=this._delayedClicks[I].evt,y=B.d.POINTERTAP,Y=new B.i(y,U,this._currentPickResult);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(y)&&r.onPointerObservable.notifyObservers(Y,y),this._delayedClicks[I]=null}if(this._updatePointerPosition(t),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=t.button),r.preventDefaultOnPointerDown&&I&&(t.preventDefault(),I.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,t,B.d.POINTERDOWN))return;if(!r.cameraToUseForPointers&&!r.activeCamera)return;let Y;this._pointerCaptures[t.pointerId]=!0,r.pointerDownPredicate||(r.pointerDownPredicate=t=>t.KP&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!r.cameraToUseForPointers||0!==(r.cameraToUseForPointers.layerMask&t.layerMask))),this._pickedDownMesh=null,Y=r.skipPointerDownPicking||0===r._registeredActions&&!this._checkForPicking()&&!r.onPointerDown?new h.c:r.wy(this._unTranslatedPointerX,this._unTranslatedPointerY,r.pointerDownPredicate,r.pointerDownFastCheck,r.cameraToUseForPointers,r.pointerDownTrianglePredicate),this._processPointerDown(Y,t)},this._onPointerUp=t=>{const U=this._activePointerIds.indexOf(t.pointerId);-1!==U&&(this._activePointerIds[U]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(t),r.preventDefaultOnPointerUp&&I&&(t.preventDefault(),I.focus()),this._initClickEvent(r.onPrePointerObservable,r.onPointerObservable,t,((U,y)=>{if(r.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!U.ignore)){if(this._checkPrePointerObservable(null,t,B.d.POINTERUP))return this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===t.buttons&&(this._pointerCaptures[t.pointerId]=!1));U.hasSwiped||(U.singleClick&&r.onPrePointerObservable.hasSpecificMask(B.d.POINTERTAP)&&this._checkPrePointerObservable(null,t,B.d.POINTERTAP)&&(this._skipPointerTap=!0),U.cI&&r.onPrePointerObservable.hasSpecificMask(B.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,t,B.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[t.pointerId]?(0===t.buttons&&(this._pointerCaptures[t.pointerId]=!1),(r.cameraToUseForPointers||r.activeCamera)&&(r.pointerUpPredicate||(r.pointerUpPredicate=t=>t.KP&&t.isVisible&&t.isReady()&&t.isEnabled()&&(!r.cameraToUseForPointers||0!==(r.cameraToUseForPointers.layerMask&t.layerMask))),!this._meshPickProceed&&(b&&b.HasTriggers||this._checkForPicking()||r.onPointerUp)&&this._initActionManager(null,U),y||(y=this._currentPickResult),this._processPointerUp(y,t,U),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===t.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=t=>{const U=a.b.KEYDOWN;if(r.onPreKeyboardObservable.hasObservers()){const y=new a.c(U,t);if(r.onPreKeyboardObservable.notifyObservers(y,U),y.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const y=new a.e(U,t);r.onKeyboardObservable.notifyObservers(y,U)}r.actionManager&&r.actionManager.processTrigger(14,Q.CreateNewFromScene(r,t))},this._onKeyUp=t=>{const U=a.b.KEYUP;if(r.onPreKeyboardObservable.hasObservers()){const y=new a.c(U,t);if(r.onPreKeyboardObservable.notifyObservers(y,U),y.skipOnKeyboardObservable)return}if(r.onKeyboardObservable.hasObservers()){const y=new a.e(U,t);r.onKeyboardObservable.notifyObservers(y,U)}r.actionManager&&r.actionManager.processTrigger(15,Q.CreateNewFromScene(r,t))},this._deviceSourceManager.onDeviceConnectedObservable.add((I=>{I.deviceType===p.Mouse?I.onInputChangedObservable.add((r=>{this._originMouseEvent=r,r.inputIndex===c.LeftClick||r.inputIndex===c.MiddleClick||r.inputIndex===c.RightClick||r.inputIndex===c.BrowserBack||r.inputIndex===c.BrowserForward?U&&1===I.getInput(r.inputIndex)?this._onPointerDown(r):t&&0===I.getInput(r.inputIndex)&&this._onPointerUp(r):y&&(r.inputIndex===c.Move?this._onPointerMove(r):r.inputIndex!==c.MouseWheelX&&r.inputIndex!==c.MouseWheelY&&r.inputIndex!==c.MouseWheelZ||this._onPointerMove(r))})):I.deviceType===p.Touch?I.onInputChangedObservable.add((r=>{r.inputIndex===c.LeftClick&&(U&&1===I.getInput(r.inputIndex)?(this._onPointerDown(r),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):t&&0===I.getInput(r.inputIndex)&&(this._onPointerUp(r),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),y&&r.inputIndex===c.Move&&this._onPointerMove(r)})):I.deviceType===p.Keyboard&&I.onInputChangedObservable.add((t=>{"keydown"===t.type?this._onKeyDown(t):"keyup"===t.type&&this._onKeyUp(t)}))})),this._alreadyAttached=!0}vL(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,y=arguments.length>2?arguments[2]:void 0,I=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[U]===t&&(!t||!t._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const r=this._meshUnderPointerId[U];let Y;r&&(Y=r._getActionManagerForTrigger(10),Y&&Y.processTrigger(10,new Q(r,this._pointerX,this._pointerY,t,I,{pointerId:U}))),t?(this._meshUnderPointerId[U]=t,this._pointerOverMesh=t,Y=t._getActionManagerForTrigger(9),Y&&Y.processTrigger(9,new Q(t,this._pointerX,this._pointerY,t,I,{pointerId:U,pickResult:y}))):(delete this._meshUnderPointerId[U],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:t,pointerId:U})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(t){this._pointerOverMesh===t&&(this._pointerOverMesh=null),this._pickedDownMesh===t&&(this._pickedDownMesh=null),this._pickedUpMesh===t&&(this._pickedUpMesh=null);for(const U in this._meshUnderPointerId)this._meshUnderPointerId[U]===t&&delete this._meshUnderPointerId[U]}}k.DragMovementThreshold=10,k.LongPressDelay=500,k.DoubleClickDelay=300,k.ExclusiveDoubleClickMode=!1;var s=y(12629),x=y(12442),Z=y(12618),W=y(12718),A=y(12253),K=y(12727),C=y(12399);class R{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.WL=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var u,T=y(12221),z=y(12338);!function(t){t[t.BackwardCompatible=0]="BackwardCompatible",t[t.Intermediate=1]="Intermediate",t[t.Aggressive=2]="Aggressive"}(u||(u={}));class tt{static DefaultMaterialFactory(t){throw(0,g.c)("BU")}static CollisionCoordinatorFactory(){throw(0,g.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(t){t!==this._clearColor&&(this._clearColor=t,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(t){if(t!==this._performancePriority){switch(this._performancePriority=t,t){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.WL=!1,this.gX=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.WL=!0,this.gX=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.WL=!0,this.gX=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(t)}}set forceWireframe(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(t){this._skipFrustumClipping!==t&&(this._skipFrustumClipping=t)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.onEnvironmentTextureChangedObservable.notifyObservers(t),this.markAllMaterialsAsDirty(1))}getNodes(){let t=[];t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes);for(const U of this.skeletons)t=t.concat(U.bones);return t}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}set onDispose(t){this._onDisposeObserver&&this.FX.remove(this._onDisposeObserver),this._onDisposeObserver=this.FX.add(t)}set beforeRender(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),t&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t))}set afterRender(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),t&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(t))}set beforeCameraRender(t){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(t)}set afterCameraRender(t){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(t)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(t){this._pointerPickingConfiguration.pointerDownPredicate=t}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(t){this._pointerPickingConfiguration.pointerUpPredicate=t}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(t){this._pointerPickingConfiguration.pointerMovePredicate=t}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(t){this._pointerPickingConfiguration.pointerDownFastCheck=t}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(t){this._pointerPickingConfiguration.pointerUpFastCheck=t}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(t){this._pointerPickingConfiguration.pointerMoveFastCheck=t}get WL(){return this._pointerPickingConfiguration.WL}set WL(t){this._pointerPickingConfiguration.WL=t}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(t){this._pointerPickingConfiguration.skipPointerDownPicking=t}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(t){this._pointerPickingConfiguration.skipPointerUpPicking=t}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return k.DragMovementThreshold}static set DragMovementThreshold(t){k.DragMovementThreshold=t}static get LongPressDelay(){return k.LongPressDelay}static set LongPressDelay(t){k.LongPressDelay=t}static get DoubleClickDelay(){return k.DoubleClickDelay}static set DoubleClickDelay(t){k.DoubleClickDelay=t}static get ExclusiveDoubleClickMode(){return k.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(t){k.ExclusiveDoubleClickMode=t}bindEyePosition(t){var U;let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",I=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(U=this.activeCamera)||void 0===U?void 0:U.globalPosition)??G.DU.ZeroReadOnly,Y=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return G.TmpVectors.Vector4[0].set(r.x,r.y,r.z,Y?-1:1),t&&(I?t.setFloat3(y,G.TmpVectors.Vector4[0].x,G.TmpVectors.Vector4[0].y,G.TmpVectors.Vector4[0].z):t.setVector4(y,G.TmpVectors.Vector4[0])),G.TmpVectors.Vector4[0]}finalizeSceneUbo(){const t=this.getSceneUniformBuffer(),U=this.bindEyePosition(null);return t.updateFloat4("vEyePosition",U.x,U.y,U.z,U.w),t.update(),t}set useRightHandedSystem(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(t){this._currentStepId=t}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(t){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),t&&(this._unObserveActiveCameras=(0,C.j)(t,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=t}get activeCamera(){return this._activeCamera}set activeCamera(t){t!==this._activeCamera&&(this._activeCamera=t,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return tt.DefaultMaterialFactory!==tt._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.FL||(this.FL=tt.DefaultMaterialFactory(this)),this.FL}set defaultMaterial(t){this.FL=t}set texturesEnabled(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(t){if(this._frameGraph)return this._frameGraph=t,void(t||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=t,t&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=tt.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const t of this._transientComponents)t.register();this._transientComponents.length=0}}IX(t){this._components.push(t),this._transientComponents.push(t);const U=t;U.addFromContainer&&U.serialize&&this._serializableComponents.push(U)}_getComponent(t){for(const U of this._components)if(U.name===t)return U;return null}get uniqueId(){return this._uniqueId}constructor(t,U){this._inputManager=new k(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.gX=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new x.HX(.2,.2,.3,1),this.onClearColorChangedObservable=new Y.b,this.ambientColor=new x.bU(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new Y.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.mQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.YQ=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.FX=new Y.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new Y.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new Y.b,this.onAfterRenderCameraObservable=new Y.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new Y.b,this.onAfterAnimationsObservable=new Y.b,this.onBeforeDrawPhaseObservable=new Y.b,this.onAfterDrawPhaseObservable=new Y.b,this.onReadyObservable=new Y.b,this.onBeforeCameraRenderObservable=new Y.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new Y.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new Y.b,this.onAfterActiveMeshesEvaluationObservable=new Y.b,this.onBeforeParticlesRenderingObservable=new Y.b,this.onAfterParticlesRenderingObservable=new Y.b,this.onDataLoadedObservable=new Y.b,this.onNewCameraAddedObservable=new Y.b,this.onCameraRemovedObservable=new Y.b,this.onNewLightAddedObservable=new Y.b,this.onLightRemovedObservable=new Y.b,this.onNewGeometryAddedObservable=new Y.b,this.onGeometryRemovedObservable=new Y.b,this.onNewTransformNodeAddedObservable=new Y.b,this.onTransformNodeRemovedObservable=new Y.b,this.onNewMeshAddedObservable=new Y.b,this.onMeshRemovedObservable=new Y.b,this.onNewSkeletonAddedObservable=new Y.b,this.onSkeletonRemovedObservable=new Y.b,this.onNewMaterialAddedObservable=new Y.b,this.onNewMultiMaterialAddedObservable=new Y.b,this.onMaterialRemovedObservable=new Y.b,this.onMultiMaterialRemovedObservable=new Y.b,this.onNewTextureAddedObservable=new Y.b,this.onTextureRemovedObservable=new Y.b,this.onBeforeRenderTargetsRenderObservable=new Y.b,this.onAfterRenderTargetsRenderObservable=new Y.b,this.onBeforeStepObservable=new Y.b,this.onAfterStepObservable=new Y.b,this.onActiveCameraChanged=new Y.b,this.onActiveCamerasChanged=new Y.b,this.onBeforeRenderingGroupObservable=new Y.b,this.onAfterRenderingGroupObservable=new Y.b,this.onMeshImportedObservable=new Y.b,this.onAnimationFileImportedObservable=new Y.b,this.onEnvironmentTextureChangedObservable=new Y.b,this.onMeshUnderPointerUpdatedObservable=new Y.b,this._registeredForLateAnimationBindings=new mt.d(256),this._pointerPickingConfiguration=new R,this.onPrePointerObservable=new Y.b,this.onPointerObservable=new Y.b,this.onPreKeyboardObservable=new Y.b,this.onKeyboardObservable=new Y.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=tt.FOGMODE_NONE,this.fogColor=new x.bU(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new G.DU(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new mt.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new s.e,this._activeIndices=new s.e,this._activeParticles=new s.e,this._activeBones=new s.e,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new mt.e(256),this._processedMaterials=new mt.e(256),this._renderTargets=new mt.d(256),this._materialsRenderTargets=new mt.d(256),this._activeParticleSystems=new mt.e(256),this._activeSkeletons=new mt.d(32),this._softwareSkinnedMeshes=new mt.d(32),this._activeAnimatables=new Array,this._transformMatrix=G.Matrix.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=w.d.Create(),this._beforeClearStage=w.d.Create(),this._beforeRenderTargetClearStage=w.d.Create(),this._gatherRenderTargetsStage=w.d.Create(),this._gatherActiveCameraRenderTargetsStage=w.d.Create(),this._isReadyForMeshStage=w.d.Create(),this._beforeEvaluateActiveMeshStage=w.d.Create(),this._evaluateSubMeshStage=w.d.Create(),this._preActiveMeshStage=w.d.Create(),this._cameraDrawRenderTargetStage=w.d.Create(),this._beforeCameraDrawStage=w.d.Create(),this._beforeRenderTargetDrawStage=w.d.Create(),this._beforeRenderingGroupDrawStage=w.d.Create(),this._beforeRenderingMeshStage=w.d.Create(),this._afterRenderingMeshStage=w.d.Create(),this._afterRenderingGroupDrawStage=w.d.Create(),this._afterCameraDrawStage=w.d.Create(),this._afterCameraPostProcessStage=w.d.Create(),this._afterRenderTargetDrawStage=w.d.Create(),this._afterRenderTargetPostProcessStage=w.d.Create(),this._afterRenderStage=w.d.Create(),this._pointerMoveStage=w.d.Create(),this._pointerDownStage=w.d.Create(),this._pointerUpStage=w.d.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const y={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...U};t=this._engine=t||l.d.LastCreatedEngine,y.virtual?t._virtualScenes.push(this):(l.d._LastCreatedScene=this,t.scenes.push(this)),this._uid=null,this._renderingManager=new E.d(this),F.b&&(this.postProcessManager=new F.b(this)),(0,D.p)()&&this.attachControl(),this._createUbo(),M.e&&(this._imageProcessingConfiguration=new M.e),this.setDefaultCandidateProviders(),y.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=y.useMaterialMeshMap,this.useClonedMeshMap=y.useClonedMeshMap,U&&U.virtual||t.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(t){return this._defaultSubMeshCandidates.data=t.BX,this._defaultSubMeshCandidates.length=t.BX.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=t=>this._getDefaultSubMeshCandidates(t),this.getIntersectingSubMeshCandidates=(t,U)=>this._getDefaultSubMeshCandidates(t),this.getCollidingSubMeshCandidates=(t,U)=>this._getDefaultSubMeshCandidates(t)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(t){this._inputManager.pointerX=t}get pointerY(){return this._inputManager.pointerY}set pointerY(t){this._inputManager.pointerY=t}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==U||this._cachedMaterial!==t||this._cachedVisibility!==y}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(t,U){return this._inputManager.simulatePointerMove(t,U),this}simulatePointerDown(t,U){return this._inputManager.simulatePointerDown(t,U),this}simulatePointerUp(t,U,y){return this._inputManager.simulatePointerUp(t,U,y),this}isPointerCaptured(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(t)}attachControl(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(t,U,y)}vL(){this._inputManager.vL()}isReady(){var t,U;let y,I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const r=this.getEngine(),Y=r.currentRenderPassId;r.currentRenderPassId=(null===(t=this.activeCamera)||void 0===t?void 0:t.renderPassId)??Y;let mt=!0;for(this._pendingData.length>0&&(mt=!1),null===(U=this.prePassRenderer)||void 0===U||U.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&mt&&(mt=this.depthPeelingRenderer.isReady()),I&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),y=0;y<this.meshes.length;y++){const t=this.meshes[y];if(!t.BX||0===t.BX.length)continue;if(!t.isReady(!0)){mt=!1;continue}const U=t.hasThinInstances||"InstancedMesh"===t.getClassName()||"InstancedLinesMesh"===t.getClassName()||r.getCaps().instancedArrays&&t.instances.length>0;for(const y of this._isReadyForMeshStage)y.action(t,U)||(mt=!1);if(!I)continue;const Y=t.material||this.defaultMaterial;if(Y)if(Y._storeEffectOnSubMeshes)for(const y of t.BX){const t=y.vt();t&&t.hasRenderTargetTextures&&null!=t.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(t)&&(this._processedMaterials.push(t),this._materialsRenderTargets.concatWithNoDuplicate(t.getRenderTargetTextures()))}else Y.hasRenderTargetTextures&&null!=Y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(Y)&&(this._processedMaterials.push(Y),this._materialsRenderTargets.concatWithNoDuplicate(Y.getRenderTargetTextures()))}if(I)for(y=0;y<this._materialsRenderTargets.length;++y){this._materialsRenderTargets.data[y].isReadyForRendering()||(mt=!1)}for(y=0;y<this.geometries.length;y++){2===this.geometries[y].delayLoadState&&(mt=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const X of this.activeCameras)X.isReady(!0)||(mt=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(mt=!1));for(const X of this.mQ)X.isReady()||(mt=!1);if(this.layers)for(const X of this.layers)X.isReady()||(mt=!1);if(this.effectLayers)for(const X of this.effectLayers)X.isLayerReady()||(mt=!1);return r.areAllEffectsReady()||(mt=!1),r.currentRenderPassId=Y,mt}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(t){this.onBeforeRenderObservable.add(t)}unregisterBeforeRender(t){this.onBeforeRenderObservable.removeCallback(t)}registerAfterRender(t){this.onAfterRenderObservable.add(t)}unregisterAfterRender(t){this.onAfterRenderObservable.removeCallback(t)}_executeOnceBeforeRender(t){const U=()=>{t(),setTimeout((()=>{this.unregisterBeforeRender(U)}))};this.registerBeforeRender(U)}executeOnceBeforeRender(t,U){void 0!==U?setTimeout((()=>{this._executeOnceBeforeRender(t)}),U):this._executeOnceBeforeRender(t)}addPendingData(t){this._pendingData.push(t)}removePendingData(t){const U=this.isLoading,y=this._pendingData.indexOf(t);-1!==y&&this._pendingData.splice(y,1),U&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(t),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(U)}async whenReadyAsync(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((U=>{this.executeWhenReady((()=>{U()}),t)}))}_checkIsReady(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(t)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(t)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=r.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(t,U,y,I){y||I||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===t.updateFlag&&this._projectionUpdateFlag===U.updateFlag||(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=U.updateFlag,this._viewMatrix=t,this._projectionMatrix=U,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?Z.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Z.c.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(y,I):this._sceneUbo.useUbo&&(this._sceneUbo.fX("viewProjection",this._transformMatrix),this._sceneUbo.fX("view",this._viewMatrix),this._sceneUbo.fX("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(t){const U=new L.b(this._engine,void 0,!1,t??"gU");return U.addUniform("viewProjection",16),U.addUniform("view",16),U.addUniform("projection",16),U.addUniform("vEyePosition",4),U}setSceneUniformBuffer(t){this._sceneUbo=t,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return W.e.UniqueId}LM(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(t),t._resyncLightSources(),t.parent||t._addToSceneRootNodes(),I.Tools.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(t)})),U)){const U=t.getChildMeshes();for(const t of U)this.LM(t)}}MM(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const y=this.meshes.indexOf(t);if(-1!==y&&(this.meshes.splice(y,1),t.parent||t._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(t),this.onMeshRemovedObservable.notifyObservers(t),U){const U=t.getChildMeshes();for(const t of U)this.MM(t)}return y}addTransformNode(t){this._blockEntityCollection||t.St()===this&&-1!==t._indexInSceneTransformNodesArray||(t._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(t),t.parent||t._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(t))}removeTransformNode(t){const U=t._indexInSceneTransformNodesArray;if(-1!==U){if(U!==this.transformNodes.length-1){const t=this.transformNodes[this.transformNodes.length-1];this.transformNodes[U]=t,t._indexInSceneTransformNodesArray=U}t._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),t.parent||t._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(t),U}removeSkeleton(t){const U=this.skeletons.indexOf(t);return-1!==U&&(this.skeletons.splice(U,1),this.onSkeletonRemovedObservable.notifyObservers(t),this._executeActiveContainerCleanup(this._activeSkeletons)),U}removeMorphTargetManager(t){const U=this.morphTargetManagers.indexOf(t);return-1!==U&&this.morphTargetManagers.splice(U,1),U}removeLight(t){const U=this.lights.indexOf(t);if(-1!==U){for(const U of this.meshes)U._removeLightSource(t,!1);this.lights.splice(U,1),this.sortLightsByPriority(),t.parent||t._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(t),U}removeCamera(t){const U=this.cameras.indexOf(t);if(-1!==U&&(this.cameras.splice(U,1),t.parent||t._removeFromSceneRootNodes()),this.activeCameras){const U=this.activeCameras.indexOf(t);-1!==U&&this.activeCameras.splice(U,1)}return this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),U}removeParticleSystem(t){const U=this.mQ.indexOf(t);return-1!==U&&(this.mQ.splice(U,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),U}removeAnimation(t){const U=this.animations.indexOf(t);return-1!==U&&this.animations.splice(U,1),U}stopAnimation(t,U,y){}removeAnimationGroup(t){const U=this.animationGroups.indexOf(t);return-1!==U&&this.animationGroups.splice(U,1),U}removeMultiMaterial(t){const U=this.multiMaterials.indexOf(t);return-1!==U&&this.multiMaterials.splice(U,1),this.onMultiMaterialRemovedObservable.notifyObservers(t),U}removeMaterial(t){const U=t._indexInSceneMaterialArray;if(-1!==U&&U<this.materials.length){if(U!==this.materials.length-1){const t=this.materials[this.materials.length-1];this.materials[U]=t,t._indexInSceneMaterialArray=U}t._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),U}removeActionManager(t){const U=this.actionManagers.indexOf(t);return-1!==U&&this.actionManagers.splice(U,1),U}removeTexture(t){const U=this.textures.indexOf(t);return-1!==U&&this.textures.splice(U,1),this.onTextureRemovedObservable.notifyObservers(t),U}addLight(t){if(!this._blockEntityCollection){this.lights.push(t),this.sortLightsByPriority(),t.parent||t._addToSceneRootNodes();for(const U of this.meshes)-1===U.lightSources.indexOf(t)&&(U.lightSources.push(t),U._resyncLightSources());I.Tools.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(t)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(K.d.CompareLightsPriority)}addCamera(t){this._blockEntityCollection||(this.cameras.push(t),I.Tools.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(t)})),t.parent||t._addToSceneRootNodes())}addSkeleton(t){this._blockEntityCollection||(this.skeletons.push(t),I.Tools.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(t)})))}addParticleSystem(t){this._blockEntityCollection||this.mQ.push(t)}addAnimation(t){this._blockEntityCollection||this.animations.push(t)}addAnimationGroup(t){this._blockEntityCollection||this.animationGroups.push(t)}addMultiMaterial(t){this._blockEntityCollection||(this.multiMaterials.push(t),I.Tools.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(t)})))}addMaterial(t){this._blockEntityCollection||t.St()===this&&-1!==t._indexInSceneMaterialArray||(t._indexInSceneMaterialArray=this.materials.length,this.materials.push(t),I.Tools.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(t)})))}addMorphTargetManager(t){this._blockEntityCollection||this.morphTargetManagers.push(t)}addGeometry(t){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t))}addActionManager(t){this.actionManagers.push(t)}addTexture(t){this._blockEntityCollection||(this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t))}switchActiveCamera(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.vL(),this.activeCamera=t,U&&t.attachControl())}setActiveCameraById(t){const U=this.getCameraById(t);return U?(this.activeCamera=U,U):null}setActiveCameraByName(t){const U=this.getCameraByName(t);return U?(this.activeCamera=U,U):null}getAnimationGroupByName(t){for(let U=0;U<this.animationGroups.length;U++)if(this.animationGroups[U].name===t)return this.animationGroups[U];return null}_getMaterial(t,U){for(let y=0;y<this.materials.length;y++){const t=this.materials[y];if(U(t))return t}if(t)for(let y=0;y<this.multiMaterials.length;y++){const t=this.multiMaterials[y];if(U(t))return t}return null}getMaterialByUniqueID(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(t,U)}getMaterialByUniqueId(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.uniqueId===t))}getMaterialById(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.id===t))}getMaterialByName(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(U,(U=>U.name===t))}getLastMaterialById(t){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let y=this.materials.length-1;y>=0;y--)if(this.materials[y].id===t)return this.materials[y];if(U)for(let y=this.multiMaterials.length-1;y>=0;y--)if(this.multiMaterials[y].id===t)return this.multiMaterials[y];return null}getTextureByUniqueId(t){for(let U=0;U<this.textures.length;U++)if(this.textures[U].uniqueId===t)return this.textures[U];return null}getTextureByName(t){for(let U=0;U<this.textures.length;U++)if(this.textures[U].name===t)return this.textures[U];return null}getCameraById(t){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].id===t)return this.cameras[U];return null}getCameraByUniqueId(t){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].uniqueId===t)return this.cameras[U];return null}getCameraByName(t){for(let U=0;U<this.cameras.length;U++)if(this.cameras[U].name===t)return this.cameras[U];return null}getBoneById(t){for(let U=0;U<this.skeletons.length;U++){const y=this.skeletons[U];for(let U=0;U<y.bones.length;U++)if(y.bones[U].id===t)return y.bones[U]}return null}getBoneByName(t){for(let U=0;U<this.skeletons.length;U++){const y=this.skeletons[U];for(let U=0;U<y.bones.length;U++)if(y.bones[U].name===t)return y.bones[U]}return null}getLightByName(t){for(let U=0;U<this.lights.length;U++)if(this.lights[U].name===t)return this.lights[U];return null}getLightById(t){for(let U=0;U<this.lights.length;U++)if(this.lights[U].id===t)return this.lights[U];return null}getLightByUniqueId(t){for(let U=0;U<this.lights.length;U++)if(this.lights[U].uniqueId===t)return this.lights[U];return null}getParticleSystemById(t){for(let U=0;U<this.mQ.length;U++)if(this.mQ[U].id===t)return this.mQ[U];return null}getGeometryById(t){for(let U=0;U<this.geometries.length;U++)if(this.geometries[U].id===t)return this.geometries[U];return null}_getGeometryByUniqueId(t){if(this._geometriesByUniqueId){const U=this._geometriesByUniqueId[t];if(void 0!==U)return this.geometries[U]}else for(let U=0;U<this.geometries.length;U++)if(this.geometries[U].uniqueId===t)return this.geometries[U];return null}getFrameGraphByName(t){for(let U=0;U<this.frameGraphs.length;U++)if(this.frameGraphs[U].name===t)return this.frameGraphs[U];return null}pushGeometry(t,U){return!(!U&&this._getGeometryByUniqueId(t.uniqueId))&&(this.addGeometry(t),I.Tools.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(t)})),!0)}removeGeometry(t){let U;if(this._geometriesByUniqueId){if(U=this._geometriesByUniqueId[t.uniqueId],void 0===U)return!1}else if(U=this.geometries.indexOf(t),U<0)return!1;if(U!==this.geometries.length-1){const t=this.geometries[this.geometries.length-1];t&&(this.geometries[U]=t,this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=U))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[t.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0}getGeometries(){return this.geometries}getMeshById(t){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].id===t)return this.meshes[U];return null}getMeshesById(t){return this.meshes.filter((function(U){return U.id===t}))}getTransformNodeById(t){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].id===t)return this.transformNodes[U];return null}getTransformNodeByUniqueId(t){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].uniqueId===t)return this.transformNodes[U];return null}getTransformNodesById(t){return this.transformNodes.filter((function(U){return U.id===t}))}getMeshByUniqueId(t){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].uniqueId===t)return this.meshes[U];return null}getLastMeshById(t){for(let U=this.meshes.length-1;U>=0;U--)if(this.meshes[U].id===t)return this.meshes[U];return null}getLastTransformNodeById(t){for(let U=this.transformNodes.length-1;U>=0;U--)if(this.transformNodes[U].id===t)return this.transformNodes[U];return null}getLastEntryById(t){let U;for(U=this.meshes.length-1;U>=0;U--)if(this.meshes[U].id===t)return this.meshes[U];for(U=this.transformNodes.length-1;U>=0;U--)if(this.transformNodes[U].id===t)return this.transformNodes[U];for(U=this.cameras.length-1;U>=0;U--)if(this.cameras[U].id===t)return this.cameras[U];for(U=this.lights.length-1;U>=0;U--)if(this.lights[U].id===t)return this.lights[U];return null}getNodeById(t){const U=this.getMeshById(t);if(U)return U;const y=this.getTransformNodeById(t);if(y)return y;const I=this.getLightById(t);if(I)return I;const r=this.getCameraById(t);if(r)return r;const Y=this.getBoneById(t);return Y||null}getNodeByName(t){const U=this.getMeshByName(t);if(U)return U;const y=this.getTransformNodeByName(t);if(y)return y;const I=this.getLightByName(t);if(I)return I;const r=this.getCameraByName(t);if(r)return r;const Y=this.getBoneByName(t);return Y||null}getMeshByName(t){for(let U=0;U<this.meshes.length;U++)if(this.meshes[U].name===t)return this.meshes[U];return null}getTransformNodeByName(t){for(let U=0;U<this.transformNodes.length;U++)if(this.transformNodes[U].name===t)return this.transformNodes[U];return null}getLastSkeletonById(t){for(let U=this.skeletons.length-1;U>=0;U--)if(this.skeletons[U].id===t)return this.skeletons[U];return null}getSkeletonByUniqueId(t){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].uniqueId===t)return this.skeletons[U];return null}getSkeletonById(t){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].id===t)return this.skeletons[U];return null}getSkeletonByName(t){for(let U=0;U<this.skeletons.length;U++)if(this.skeletons[U].name===t)return this.skeletons[U];return null}getMorphTargetManagerById(t){for(let U=0;U<this.morphTargetManagers.length;U++)if(this.morphTargetManagers[U].uniqueId===t)return this.morphTargetManagers[U];return null}getMorphTargetById(t){for(let U=0;U<this.morphTargetManagers.length;++U){const y=this.morphTargetManagers[U];for(let U=0;U<y.numTargets;++U){const I=y.getTarget(U);if(I.id===t)return I}}return null}getMorphTargetByName(t){for(let U=0;U<this.morphTargetManagers.length;++U){const y=this.morphTargetManagers[U];for(let U=0;U<y.numTargets;++U){const I=y.getTarget(U);if(I.name===t)return I}}return null}getPostProcessByName(t){for(let U=0;U<this.postProcesses.length;++U){const y=this.postProcesses[U];if(y.name===t)return y}return null}isActiveMesh(t){return-1!==this._activeMeshes.indexOf(t)}get uid(){return this._uid||(this._uid=I.Tools.RandomId()),this._uid}addExternalData(t,U){return this._externalData||(this._externalData=new X),this._externalData.add(t,U)}getExternalData(t){return this._externalData?this._externalData.get(t):null}getOrAddExternalDataWithFactory(t,U){return this._externalData||(this._externalData=new X),this._externalData.getOrAddWithFactory(t,U)}removeExternalData(t){return this._externalData.remove(t)}_evaluateSubMesh(t,U,y,I){if(I||t.isInFrustum(this._frustumPlanes)){for(const I of this._evaluateSubMeshStage)I.action(U,t);const y=t.vt();null!==y&&void 0!==y&&(y.hasRenderTargetTextures&&null!=y.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(y)&&(this._processedMaterials.push(y),this._materialsRenderTargets.concatWithNoDuplicate(y.getRenderTargetTextures())),this._renderingManager.dispatch(t,U,y))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(t){this._preventFreeActiveMeshesAndRenderingGroups!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=t)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let t=0;t<this.activeCameras.length;t++){const U=this.activeCameras[t];U&&U._activeMeshes&&U._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let t=0;t<this.textures.length;t++){const U=this.textures[t];U&&U.renderList&&U.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0,I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=r,this._skipEvaluateActiveMeshesCompletely=t,I)for(let t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._freeze();U&&U()}else y&&y("No active camera found")})),this}unfreezeActiveMeshes(){for(let t=0;t<this.meshes.length;t++){const U=this.meshes[t];U._internalAbstractMeshDataInfo&&(U._internalAbstractMeshDataInfo._isActive=!1)}for(let t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(t){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>t.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var t;if(this._activeMeshes.length>0)null===(t=this.activeCamera)||void 0===t||t._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const t=this._activeMeshes.length;for(let U=0;U<t;U++){this._activeMeshes.data[U].SX()}}if(this._activeParticleSystems){const t=this._activeParticleSystems.length;for(let U=0;U<t;U++)this._activeParticleSystems.data[U].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const I of this._beforeEvaluateActiveMeshStage)I.action();const U=this.getActiveMeshCandidates(),y=U.length;for(let I=0;I<y;I++){const t=U.data[I];let y=t._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(y?y[1]=-1:(y=[t,-1],t._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,y)),t.isBlocked)continue;if(this._totalVertices.addCount(t.getTotalVertices(),!1),!t.isReady()||!t.isEnabled()||t.dX.hasAZeroComponent)continue;t.SX(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t);let r=this.customLODSelector?this.customLODSelector(t,this.activeCamera):t.getLOD(this.activeCamera);if(y[0]=r,y[1]=this._frameId,void 0!==r&&null!==r&&(r!==t&&0!==r.billboardMode&&r.SX(),t._preActivate(),t.isVisible&&t.visibility>0&&0!==(t.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||t.WG||t.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(t),this.activeCamera._activeMeshes.push(t),r!==t&&r._activate(this._renderId,!1);for(const U of this._preActiveMeshStage)U.action(t);t._activate(this._renderId,!1)&&(t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(r=t):r._internalAbstractMeshDataInfo._onlyForInstances=!1,r._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(t,r)),t._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let t=0;t<this.mQ.length;t++){const U=this.mQ[t];if(!U.isStarted()||!U.my)continue;const y=U.my;y.position&&!y.isEnabled()||(this._activeParticleSystems.push(U),U.animate(),this._renderingManager.dispatchParticles(U))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(t){this._skeletonsEnabled&&t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)&&this.frameGraph&&t.applySkeleton(t.skeleton))}_activeMesh(t,U){this._prepareSkeleton(U);let y=t.hasInstances||t.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||U.WG;if(U&&U.BX&&U.BX.length>0){const I=this.getActiveSubMeshCandidates(U),r=I.length;y=y||1===r;for(let Y=0;Y<r;Y++){const r=I.data[Y];this._evaluateSubMesh(r,U,t,y)}}}updateTransformMatrix(t){const U=this.activeCamera;if(U)if(U._renderingMultiview){const y=U._rigCameras[0],I=U._rigCameras[1];this.setTransformMatrix(y.getViewMatrix(),y.getProjectionMatrix(t),I.getViewMatrix(),I.getProjectionMatrix(t))}else this.setTransformMatrix(U.getViewMatrix(),U.getProjectionMatrix(t))}_bindFrameBuffer(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(t&&t._multiviewTexture?t._multiviewTexture._bindFrameBuffer():t&&t.outputRenderTarget?t.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),U&&this._clearFrameBuffer(t)}_clearFrameBuffer(t){if(t&&t._multiviewTexture);else if(t&&t.outputRenderTarget&&!t._renderingMultiview){const U=t.outputRenderTarget;U.onClearObservable.hasObservers()?U.onClearObservable.notifyObservers(this._engine):U.skipInitialClear||t.isRightCamera||(this.gX&&this._engine.clear(U.clearColor||this._clearColor,!U._cleared,!0,!0),U._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(t,U){var y;let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&t._skipRendering)return;const Y=this._engine;if(this._activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");if(Y.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&r){let U=!0;t._renderingMultiview&&t.outputRenderTarget&&(U=t.outputRenderTarget.skipInitialClear,this.gX&&(this._defaultFrameBufferCleared=!1,t.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),t._renderingMultiview&&t.outputRenderTarget&&(t.outputRenderTarget.skipInitialClear=U)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let I=0;I<this._softwareSkinnedMeshes.length;I++){const t=this._softwareSkinnedMeshes.data[I];t.applySkeleton(t.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),U&&U.customRenderTargets&&U.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(U.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const I of this._gatherActiveCameraRenderTargetsStage)I.action(this._renderTargets);let mt=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){I.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let t=0;t<this._renderTargets.length;t++){const U=this._renderTargets.data[t];if(U._shouldRender()){this._renderId++;const t=U.activeCamera&&U.activeCamera!==this.activeCamera;U.render(t,this.dumpNextRenderTargets),mt=!0}}I.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const t of this._cameraDrawRenderTargetStage)mt=t.action(this.activeCamera)||mt;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(y=t.outputRenderTarget)||void 0===y?void 0:y.renderPassId)??t.renderPassId??0,mt&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||t._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const I of this._beforeCameraDrawStage)I.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),Y.snapshotRendering&&1===Y.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const I of this._afterCameraDrawStage)I.action(this.activeCamera);if(this.postProcessManager&&!t._multiviewTexture){const U=t.outputRenderTarget?t.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(t.isIntermediate,U)}for(const I of this._afterCameraPostProcessStage)I.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===t.cameraRigMode||t._renderingMultiview)return t._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(t,void 0,U),void this.onAfterRenderCameraObservable.notifyObservers(t);if(t._useMultiviewToSingleView)this._renderMultiviewToSingleView(t);else{this.onBeforeCameraRenderObservable.notifyObservers(t);for(let U=0;U<t._rigCameras.length;U++)this._renderForCamera(t._rigCameras[U],t)}this._activeCamera=t,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(t)}_checkIntersections(){for(let t=0;t<this._meshesForIntersections.length;t++){const U=this._meshesForIntersections.data[t];if(U.actionManager)for(let t=0;U.actionManager&&t<U.actionManager.actions.length;t++){const y=U.actionManager.actions[t];if(12===y.trigger||13===y.trigger){const t=y.getTriggerParameter(),I=t.mesh?t.mesh:t,r=I.intersectsMesh(U,t.usePreciseIntersection),Y=U._intersectionsInProgress.indexOf(I);r&&-1===Y?12===y.trigger?(y._executeCurrent(Q.CreateNew(U,void 0,I)),U._intersectionsInProgress.push(I)):13===y.trigger&&U._intersectionsInProgress.push(I):!r&&Y>-1&&(13===y.trigger&&y._executeCurrent(Q.CreateNew(U,void 0,I)),U.actionManager.hasSpecificTrigger(13,(t=>{const U=t.mesh?t.mesh:t;return I===U}))&&13!==y.trigger||U._intersectionsInProgress.splice(Y,1))}}}}_advancePhysicsEngineStep(t){}_animate(t){}animate(){if(this._engine.isDeterministicLockStep()){let t=Math.max(tt.MinDeltaTime,Math.min(this._engine.getDeltaTime(),tt.MaxDeltaTime))+this._timeAccumulator;const U=this._engine.getTimeStep(),y=1e3/U/1e3;let I=0;const r=this._engine.getLockstepMaxSteps();let Y=Math.floor(t/U);for(Y=Math.min(Y,r);t>0&&I<Y;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=U*y,this._animate(U),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(U),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,I++,t-=U;this._timeAccumulator=t<0?0:t}else{const t=this.useConstantAnimationDeltaTime?16:Math.max(tt.MinDeltaTime,Math.min(this._engine.getDeltaTime(),tt.MaxDeltaTime));this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}}_clear(){(this.autoClearDepthAndStencil||this.gX)&&this._engine.clear(this._clearColor,this.gX||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(t){var U;if(null===t||void 0===t||!t.outputRenderTarget||null!==t&&void 0!==t&&t.isRigCamera||(t.outputRenderTarget._cleared=!1),null!==t&&void 0!==t&&null!==(U=t.rigCameras)&&void 0!==U&&U.length)for(let y=0;y<t.rigCameras.length;++y){const U=t.rigCameras[y].outputRenderTarget;U&&(U._cleared=!1)}}resetDrawCache(t){if(this.meshes)for(const U of this.meshes)U.resetDrawCache(t)}_renderWithFrameGraph(){var t;let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),U)for(const r of this.cameras)if(r.update(),0!==r.cameraRigMode)for(let t=0;t<r._rigCameras.length;t++)r._rigCameras[t].update();this.onBeforeRenderObservable.notifyObservers(this);for(const r of this._beforeClearStage)r.action();const y=this.getActiveMeshCandidates(),I=y.length;for(let r=0;r<I;r++){const t=y.data[r];t.isBlocked||(this._totalVertices.addCount(t.getTotalVertices(),!1),t.isReady()&&t.isEnabled()&&!t.dX.hasAZeroComponent&&(t.SX(),t.actionManager&&t.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(t)))}if(this.particlesEnabled)for(let r=0;r<this.mQ.length;r++){const t=this.mQ[r];if(!t.isStarted()||!t.my)continue;const U=t.my;U.position&&!U.isEnabled()||(this._activeParticleSystems.push(t),t.animate())}null===(t=this.frameGraph)||void 0===t||t.execute()}_renderRenderTarget(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,t._shouldRender()){if(this._renderId++,this.activeCamera=U,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),t.render(y,I)}this._intermediateRendering=!1}render(){var t;let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.G){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(t=this.activeCameras)&&void 0!==t&&t.length)for(const t of this.activeCameras)this._checkCameraRenderTarget(t);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),y||this.animate();for(const t of this._beforeCameraUpdateStage)t.action();if(U)if(this.activeCameras&&this.activeCameras.length>0)for(let t=0;t<this.activeCameras.length;t++){const U=this.activeCameras[t];if(U.update(),0!==U.cameraRigMode)for(let t=0;t<U._rigCameras.length;t++)U._rigCameras[t].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let t=0;t<this.activeCamera._rigCameras.length;t++)this.activeCamera._rigCameras[t].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(U,y);else{var r;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const t=null!==(r=this.activeCameras)&&void 0!==r&&r.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){I.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let U=0;U<this.customRenderTargets.length;U++){const y=this.customRenderTargets[U],I=y.activeCamera||this.activeCamera;this._renderRenderTarget(y,I,t!==I,this.dumpNextRenderTargets)}I.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===t||void 0===t?void 0:t.renderPassId)??0,this.activeCamera=t,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const U of this._beforeClearStage)U.action();this._clearFrameBuffer(this.activeCamera);for(const U of this._gatherRenderTargetsStage)U.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let U=0;U<this.activeCameras.length;U++)this._processSubCameras(this.activeCameras[U],U>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const t of this._afterRenderStage)t.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let t=0;t<this._toBeDisposed.length;t++){const U=this._toBeDisposed[t];U&&U.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let t=0;t<this.materials.length;t++)this.materials[t].freeze()}unfreezeMaterials(){for(let t=0;t<this.materials.length;t++)this.materials[t].unfreeze()}dispose(){if(this.G)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const t of this._activeAnimatables)t.onAnimationEndObservable.clear(),t.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const t=this._activeRequests.slice();for(const r of t)r.abort();this._activeRequests.length=0;try{this.FX.notifyObservers(this)}catch(I){T.b.Error("An error occurred while calling onDisposeObservable!",I)}this.vL();if(this._engine.getInputElement())for(let r=0;r<this.cameras.length;r++)this.cameras[r].vL();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.FL&&this.FL.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(t=>t.dispose(!0))),this._disposeList(this.transformNodes,(t=>t.dispose(!0)));const U=this.cameras;this._disposeList(U),this._disposeList(this.mQ),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let y=this._engine.scenes.indexOf(this);if(y>-1&&this._engine.scenes.splice(y,1),l.d._LastCreatedScene===this){l.d._LastCreatedScene=null;let t=l.d.Instances.length-1;for(;t>=0;){const U=l.d.Instances[t];if(U.scenes.length>0){l.d._LastCreatedScene=U.scenes[this._engine.scenes.length-1];break}t--}}y=this._engine._virtualScenes.indexOf(this),y>-1&&this._engine._virtualScenes.splice(y,1),this._engine.wipeCaches(!0),this.FX.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(t,U){const y=t.slice(0);U=U??(t=>t.dispose());for(const I of y)U(I);t.length=0}get G(){return this._isDisposed}clearCachedVertexData(){for(let t=0;t<this.meshes.length;t++){const U=this.meshes[t].NX;U&&U.clearCachedData()}}cleanCachedTextureBuffer(){for(const t of this.textures){t._buffer&&(t._buffer=null)}}getWorldExtends(t){const U=new G.DU(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new G.DU(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);t=t||(()=>!0);const I=this.meshes.filter(t);for(const r of I){if(r.SX(!0),!r.BX||0===r.BX.length||r.infiniteDistance)continue;const t=r.getBoundingInfo(),I=t.boundingBox.minimumWorld,Y=t.boundingBox.maximumWorld;G.DU.CheckExtends(I,U,y),G.DU.CheckExtends(Y,U,y)}return{min:U,max:y}}createPickingRay(t,U,y,I){throw(0,g.c)("Ray")}createPickingRayToRef(t,U,y,I,r){throw(0,g.c)("Ray")}createPickingRayInCameraSpace(t,U,y){throw(0,g.c)("Ray")}createPickingRayInCameraSpaceToRef(t,U,y,I){throw(0,g.c)("Ray")}wy(t,U,y,I,r,Y){const mt=(0,g.c)("Ray",!0);return mt&&T.b.Warn(mt),new h.c}pickWithBoundingInfo(t,U,y,I,r){const Y=(0,g.c)("Ray",!0);return Y&&T.b.Warn(Y),new h.c}pickWithRay(t,U,y,I){throw(0,g.c)("Ray")}multiPick(t,U,y,I,r){throw(0,g.c)("Ray")}multiPickWithRay(t,U,y){throw(0,g.c)("Ray")}setPointerOverMesh(t,U,y){this._inputManager.setPointerOverMesh(t,U,y)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const t of this._components)t.rebuild();for(const t of this.mQ)t.rebuild();if(this.spriteManagers)for(const t of this.spriteManagers)t.rebuild()}_rebuildTextures(){for(const t of this.textures)t._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(t,U,y){if(void 0===U)return t;const I=[];for(const r in t){const Y=t[r];P.d&&P.d.MatchesQuery(Y,U)&&(!y||y(Y))&&I.push(Y)}return I}getMeshesByTags(t,U){return this._getByTags(this.meshes,t,U)}getCamerasByTags(t,U){return this._getByTags(this.cameras,t,U)}getLightsByTags(t,U){return this._getByTags(this.lights,t,U)}getMaterialByTags(t,U){return this._getByTags(this.materials,t,U).concat(this._getByTags(this.multiMaterials,t,U))}getTransformNodesByTags(t,U){return this._getByTags(this.transformNodes,t,U)}setRenderingOrder(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(t,U,y,I)}setRenderingAutoClearDepthStencil(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(t,U,y,I)}getAutoClearDepthStencilSetup(t){return this._renderingManager.getAutoClearDepthStencilSetup(t)}_forceBlockMaterialDirtyMechanism(t){this._blockMaterialDirtyMechanism=t}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(t,U){if(!this._blockMaterialDirtyMechanism)for(const y of this.materials)U&&!U(y)||y.TG(t)}_loadFile(t,U,y,I,r,Y,mt){const X=(0,A.t)(t,U,y,I?this.offlineProvider:void 0,r,Y,mt);return this._activeRequests.push(X),X.onCompleteObservable.add((t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)})),X}async _loadFileAsync(t,U,y,I,r){return await new Promise(((Y,mt)=>{this._loadFile(t,(t=>{Y(t)}),U,y,I,((t,U)=>{mt(U)}),r)}))}_requestFile(t,U,y,I,r,Y,mt){const X=(0,A.z)(t,U,y,I?this.offlineProvider:void 0,r,Y,mt);return this._activeRequests.push(X),X.onCompleteObservable.add((t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)})),X}async _requestFileAsync(t,U,y,I,r){return await new Promise(((Y,mt)=>{this._requestFile(t,(t=>{Y(t)}),U,y,I,(t=>{mt(t)}),r)}))}_readFile(t,U,y,I,r){const Y=(0,A.x)(t,U,y,I,r);return this._activeRequests.push(Y),Y.onCompleteObservable.add((t=>{this._activeRequests.splice(this._activeRequests.indexOf(t),1)})),Y}async _readFileAsync(t,U,y){return await new Promise(((I,r)=>{this._readFile(t,(t=>{I(t)}),U,y,(t=>{r(t)}))}))}getPerfCollector(){throw(0,g.c)("performanceViewerSceneExtension")}setActiveCameraByID(t){return this.setActiveCameraById(t)}getMaterialByID(t){return this.getMaterialById(t)}getLastMaterialByID(t){return this.getLastMaterialById(t)}getTextureByUniqueID(t){return this.getTextureByUniqueId(t)}getCameraByID(t){return this.getCameraById(t)}getCameraByUniqueID(t){return this.getCameraByUniqueId(t)}getBoneByID(t){return this.getBoneById(t)}getLightByID(t){return this.getLightById(t)}getLightByUniqueID(t){return this.getLightByUniqueId(t)}getParticleSystemByID(t){return this.getParticleSystemById(t)}getGeometryByID(t){return this.getGeometryById(t)}getMeshByID(t){return this.getMeshById(t)}getMeshByUniqueID(t){return this.getMeshByUniqueId(t)}getLastMeshByID(t){return this.getLastMeshById(t)}getMeshesByID(t){return this.getMeshesById(t)}getTransformNodeByID(t){return this.getTransformNodeById(t)}getTransformNodeByUniqueID(t){return this.getTransformNodeByUniqueId(t)}getTransformNodesByID(t){return this.getTransformNodesById(t)}getNodeByID(t){return this.getNodeById(t)}getLastEntryByID(t){return this.getLastEntryById(t)}getLastSkeletonByID(t){return this.getLastSkeletonById(t)}}tt.FOGMODE_NONE=0,tt.FOGMODE_EXP=1,tt.FOGMODE_EXP2=2,tt.FOGMODE_LINEAR=3,tt.MinDeltaTime=1,tt.MaxDeltaTime=1e3,tt._OriginalDefaultMaterialFactory=tt.DefaultMaterialFactory,(0,z.f)("BABYLON.Scene",tt)},12694:(t,U,y)=>{y.d(U,{b:()=>I,d:()=>r});class I{}I.NAME_EFFECTLAYER="EffectLayer",I.NAME_LAYER="Layer",I.NAME_LENSFLARESYSTEM="LensFlareSystem",I.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",I.NAME_PARTICLESYSTEM="mh",I.NAME_GAMEPAD="Gamepad",I.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",I.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",I.NAME_PREPASSRENDERER="PrePassRenderer",I.NAME_DEPTHRENDERER="DepthRenderer",I.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",I.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",I.NAME_SPRITE="Sprite",I.NAME_SUBSURFACE="SubSurface",I.NAME_OUTLINERENDERER="Outline",I.NAME_PROCEDURALTEXTURE="ProceduralTexture",I.NAME_SHADOWGENERATOR="ShadowGenerator",I.NAME_OCTREE="rh",I.NAME_PHYSICSENGINE="PhysicsEngine",I.NAME_AUDIO="Audio",I.NAME_FLUIDRENDERER="FluidRenderer",I.NAME_IBLCDFGENERATOR="iblCDFGenerator",I.STEP_ISREADYFORMESH_EFFECTLAYER=0,I.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,I.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,I.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,I.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,I.STEP_BEFORECAMERADRAW_PREPASS=0,I.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,I.STEP_BEFORECAMERADRAW_LAYER=2,I.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,I.STEP_BEFORERENDERTARGETDRAW_LAYER=1,I.STEP_BEFORERENDERINGMESH_PREPASS=0,I.STEP_BEFORERENDERINGMESH_OUTLINE=1,I.STEP_AFTERRENDERINGMESH_PREPASS=0,I.STEP_AFTERRENDERINGMESH_OUTLINE=1,I.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,I.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,I.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,I.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,I.STEP_BEFORECLEAR_PREPASS=1,I.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,I.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,I.STEP_AFTERRENDERTARGETDRAW_LAYER=1,I.STEP_AFTERCAMERADRAW_PREPASS=0,I.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,I.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,I.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,I.STEP_AFTERCAMERADRAW_LAYER=4,I.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,I.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,I.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,I.STEP_AFTERRENDER_AUDIO=0,I.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,I.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,I.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,I.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,I.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,I.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,I.STEP_POINTERMOVE_SPRITE=0,I.STEP_POINTERDOWN_SPRITE=0,I.STEP_POINTERUP_SPRITE=0;class r extends Array{constructor(t){super(...t)}static Create(){return Object.create(r.prototype)}registerStep(t,U,y){let I=0,r=Number.MAX_VALUE;for(;I<this.length;I++){if(r=this[I].index,t<r)break}this.splice(I,0,{index:t,component:U,action:y.bind(U)})}clear(){this.length=0}}}}]);