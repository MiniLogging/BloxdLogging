"use strict";(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[49],{13575:(I,E,j)=>{j.r(E),j.d(E,{_HDRTextureLoader:()=>P});var e=j(11117);class w{static ConvertPanoramaToCubemap(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!I)throw"ConvertPanoramaToCubemap: input cannot be null";if(I.length!=E*j*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(e,this.FACE_FRONT,I,E,j,w),back:this.CreateCubemapTexture(e,this.FACE_BACK,I,E,j,w),left:this.CreateCubemapTexture(e,this.FACE_LEFT,I,E,j,w),right:this.CreateCubemapTexture(e,this.FACE_RIGHT,I,E,j,w),up:this.CreateCubemapTexture(e,this.FACE_UP,I,E,j,w),down:this.CreateCubemapTexture(e,this.FACE_DOWN,I,E,j,w),size:e,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(I,E,j,e,w){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=new ArrayBuffer(I*I*4*3),t=new Float32Array(h),U=z?Math.max(1,Math.round(e/4/I)):1,R=1/U,P=R*R,o=E[1].FE(E[0]).scale(R/I),Z=E[3].FE(E[2]).scale(R/I),c=1/I;let K=0;for(let L=0;L<I;L++)for(let z=0;z<U;z++){let z=E[0],h=E[2];for(let E=0;E<I;E++)for(let R=0;R<U;R++){const U=h.FE(z).scale(K).add(z);U.normalize();const R=this.CalcProjectionSpherical(U,j,e,w);t[L*I*3+3*E+0]+=R.r*P,t[L*I*3+3*E+1]+=R.g*P,t[L*I*3+3*E+2]+=R.b*P,z=z.add(o),h=h.add(Z)}K+=c*R}return t}static CalcProjectionSpherical(I,E,j,e){let w=Math.atan2(I.z,I.x);const z=Math.acos(I.y);for(;w<-Math.PI;)w+=2*Math.PI;for(;w>Math.PI;)w-=2*Math.PI;let h=w/Math.PI;const t=z/Math.PI;h=.5*h+.5;let U=Math.round(h*j);U<0?U=0:U>=j&&(U=j-1);let R=Math.round(t*e);R<0?R=0:R>=e&&(R=e-1);const P=e-R-1;return{r:E[P*j*3+3*U+0],g:E[P*j*3+3*U+1],b:E[P*j*3+3*U+2]}}}function z(I,E,j,e,w,z){w>0?(w=function(I,E){return E>1023?I*Math.pow(2,1023)*Math.pow(2,E-1023):E<-1074?I*Math.pow(2,-1074)*Math.pow(2,E+1074):I*Math.pow(2,E)}(1,w-136),I[z+0]=E*w,I[z+1]=j*w,I[z+2]=e*w):(I[z+0]=0,I[z+1]=0,I[z+2]=0)}function h(I,E){let j="",e="";for(let w=E;w<I.length-E&&(e=String.fromCharCode(I[w]),"\n"!=e);w++)j+=e;return j}function t(I){let E=0,j=0,e=h(I,0);if("#"!=e[0]||"?"!=e[1])throw"Bad HDR Format.";let w=!1,z=!1,t=0;do{t+=e.length+1,e=h(I,t),"FORMAT=32-bit_rle_rgbe"==e?z=!0:0==e.length&&(w=!0)}while(!w);if(!z)throw"HDR Bad header format, unsupported FORMAT";t+=e.length+1,e=h(I,t);const U=/^-Y (.*) \+X (.*)$/g.exec(e);if(!U||U.length<3)throw"HDR Bad header format, no size";if(j=parseInt(U[2]),E=parseInt(U[1]),j<8||j>32767)throw"HDR Bad header format, unsupported size";return t+=e.length+1,{height:E,width:j,dataPosition:t}}function U(I,E){return function(I,E){let j=E.height;const e=E.width;let w,h,t,U,P,o=E.dataPosition,Z=0,c=0,K=0;const L=new ArrayBuffer(4*e),F=new Uint8Array(L),C=new ArrayBuffer(E.width*E.height*4*3),X=new Float32Array(C);for(;j>0;){if(w=I[o++],h=I[o++],t=I[o++],U=I[o++],2!=w||2!=h||128&t||E.width<8||E.width>32767)return R(I,E);if((t<<8|U)!=e)throw"HDR Bad header format, wrong scan line width";for(Z=0,K=0;K<4;K++)for(c=(K+1)*e;Z<c;)if(w=I[o++],h=I[o++],w>128){if(P=w-128,0==P||P>c-Z)throw"HDR Bad Format, bad scanline data (run)";for(;P-- >0;)F[Z++]=h}else{if(P=w,0==P||P>c-Z)throw"HDR Bad Format, bad scanline data (non-run)";if(F[Z++]=h,--P>0)for(let E=0;E<P;E++)F[Z++]=I[o++]}for(K=0;K<e;K++)w=F[K],h=F[K+e],t=F[K+2*e],U=F[K+3*e],z(X,w,h,t,U,(E.height-j)*e*3+3*K);j--}return X}(I,E)}function R(I,E){let j=E.height;const e=E.width;let w,h,t,U,R,P=E.dataPosition;const o=new ArrayBuffer(E.width*E.height*4*3),Z=new Float32Array(o);for(;j>0;){for(R=0;R<E.width;R++)w=I[P++],h=I[P++],t=I[P++],U=I[P++],z(Z,w,h,t,U,(E.height-j)*e*3+3*R);j--}return Z}w.FACE_LEFT=[new e.LE(-1,-1,-1),new e.LE(1,-1,-1),new e.LE(-1,1,-1),new e.LE(1,1,-1)],w.FACE_RIGHT=[new e.LE(1,-1,1),new e.LE(-1,-1,1),new e.LE(1,1,1),new e.LE(-1,1,1)],w.FACE_FRONT=[new e.LE(1,-1,-1),new e.LE(1,-1,1),new e.LE(1,1,-1),new e.LE(1,1,1)],w.FACE_BACK=[new e.LE(-1,-1,1),new e.LE(-1,-1,-1),new e.LE(-1,1,1),new e.LE(-1,1,-1)],w.FACE_DOWN=[new e.LE(1,1,-1),new e.LE(1,1,1),new e.LE(-1,1,-1),new e.LE(-1,1,1)],w.FACE_UP=[new e.LE(-1,-1,-1),new e.LE(-1,-1,1),new e.LE(1,-1,-1),new e.LE(1,-1,1)];class P{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(I,E,j){const e=new Uint8Array(I.buffer,I.byteOffset,I.byteLength),w=t(e),z=U(e,w),h=w.width*w.height,R=new Float32Array(4*h);for(let t=0;t<h;t+=1)R[4*t]=z[3*t],R[4*t+1]=z[3*t+1],R[4*t+2]=z[3*t+2],R[4*t+3]=1;j(w.width,w.height,E.generateMipMaps,!1,(()=>{const I=E.getEngine();E.type=1,E.format=5,E._gammaSpace=!1,I._uploadDataToTextureDirectly(E,R)}))}}}}]);