"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[49],{15077:(mm,o,u)=>{u.r(o),u.d(o,{_HDRTextureLoader:()=>z});var f=u(12740);class B{static ConvertPanoramaToCubemap(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!mm)throw"ConvertPanoramaToCubemap: input cannot be null";if(mm.length!=o*u*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(f,this.FACE_FRONT,mm,o,u,B),back:this.CreateCubemapTexture(f,this.FACE_BACK,mm,o,u,B),left:this.CreateCubemapTexture(f,this.FACE_LEFT,mm,o,u,B),right:this.CreateCubemapTexture(f,this.FACE_RIGHT,mm,o,u,B),up:this.CreateCubemapTexture(f,this.FACE_UP,mm,o,u,B),down:this.CreateCubemapTexture(f,this.FACE_DOWN,mm,o,u,B),size:f,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=new ArrayBuffer(mm*mm*4*3),w=new Float32Array(r),p=O?Math.max(1,Math.round(f/4/mm)):1,K=1/p,z=K*K,Y=o[1].Qo(o[0]).scale(K/mm),q=o[3].Qo(o[2]).scale(K/mm),x=1/mm;let H=0;for(let E=0;E<mm;E++)for(let O=0;O<p;O++){let O=o[0],r=o[2];for(let o=0;o<mm;o++)for(let K=0;K<p;K++){const p=r.Qo(O).scale(H).add(O);p.normalize();const K=this.CalcProjectionSpherical(p,u,f,B);w[E*mm*3+3*o+0]+=K.r*z,w[E*mm*3+3*o+1]+=K.g*z,w[E*mm*3+3*o+2]+=K.b*z,O=O.add(Y),r=r.add(q)}H+=x*K}return w}static CalcProjectionSpherical(mm,o,u,f){let B=Math.atan2(mm.z,mm.x);const O=Math.acos(mm.y);for(;B<-Math.PI;)B+=2*Math.PI;for(;B>Math.PI;)B-=2*Math.PI;let r=B/Math.PI;const w=O/Math.PI;r=.5*r+.5;let p=Math.round(r*u);p<0?p=0:p>=u&&(p=u-1);let K=Math.round(w*f);K<0?K=0:K>=f&&(K=f-1);const z=f-K-1;return{r:o[z*u*3+3*p+0],g:o[z*u*3+3*p+1],b:o[z*u*3+3*p+2]}}}function O(mm,o,u,f,B,O){B>0?(B=function(mm,o){return o>1023?mm*Math.pow(2,1023)*Math.pow(2,o-1023):o<-1074?mm*Math.pow(2,-1074)*Math.pow(2,o+1074):mm*Math.pow(2,o)}(1,B-136),mm[O+0]=o*B,mm[O+1]=u*B,mm[O+2]=f*B):(mm[O+0]=0,mm[O+1]=0,mm[O+2]=0)}function r(mm,o){let u="",f="";for(let B=o;B<mm.length-o&&(f=String.fromCharCode(mm[B]),"\n"!=f);B++)u+=f;return u}function w(mm){let o=0,u=0,f=r(mm,0);if("#"!=f[0]||"?"!=f[1])throw"Bad HDR Format.";let B=!1,O=!1,w=0;do{w+=f.length+1,f=r(mm,w),"FORMAT=32-bit_rle_rgbe"==f?O=!0:0==f.length&&(B=!0)}while(!B);if(!O)throw"HDR Bad header format, unsupported FORMAT";w+=f.length+1,f=r(mm,w);const p=/^-Y (.*) \+X (.*)$/g.exec(f);if(!p||p.length<3)throw"HDR Bad header format, no size";if(u=parseInt(p[2]),o=parseInt(p[1]),u<8||u>32767)throw"HDR Bad header format, unsupported size";return w+=f.length+1,{height:o,width:u,dataPosition:w}}function p(mm,o){return function(mm,o){let u=o.height;const f=o.width;let B,r,w,p,z,Y=o.dataPosition,q=0,x=0,H=0;const E=new ArrayBuffer(4*f),M=new Uint8Array(E),l=new ArrayBuffer(o.width*o.height*4*3),t=new Float32Array(l);for(;u>0;){if(B=mm[Y++],r=mm[Y++],w=mm[Y++],p=mm[Y++],2!=B||2!=r||128&w||o.width<8||o.width>32767)return K(mm,o);if((w<<8|p)!=f)throw"HDR Bad header format, wrong scan line width";for(q=0,H=0;H<4;H++)for(x=(H+1)*f;q<x;)if(B=mm[Y++],r=mm[Y++],B>128){if(z=B-128,0==z||z>x-q)throw"HDR Bad Format, bad scanline data (run)";for(;z-- >0;)M[q++]=r}else{if(z=B,0==z||z>x-q)throw"HDR Bad Format, bad scanline data (non-run)";if(M[q++]=r,--z>0)for(let o=0;o<z;o++)M[q++]=mm[Y++]}for(H=0;H<f;H++)B=M[H],r=M[H+f],w=M[H+2*f],p=M[H+3*f],O(t,B,r,w,p,(o.height-u)*f*3+3*H);u--}return t}(mm,o)}function K(mm,o){let u=o.height;const f=o.width;let B,r,w,p,K,z=o.dataPosition;const Y=new ArrayBuffer(o.width*o.height*4*3),q=new Float32Array(Y);for(;u>0;){for(K=0;K<o.width;K++)B=mm[z++],r=mm[z++],w=mm[z++],p=mm[z++],O(q,B,r,w,p,(o.height-u)*f*3+3*K);u--}return q}B.FACE_LEFT=[new f.lo(-1,-1,-1),new f.lo(1,-1,-1),new f.lo(-1,1,-1),new f.lo(1,1,-1)],B.FACE_RIGHT=[new f.lo(1,-1,1),new f.lo(-1,-1,1),new f.lo(1,1,1),new f.lo(-1,1,1)],B.FACE_FRONT=[new f.lo(1,-1,-1),new f.lo(1,-1,1),new f.lo(1,1,-1),new f.lo(1,1,1)],B.FACE_BACK=[new f.lo(-1,-1,1),new f.lo(-1,-1,-1),new f.lo(-1,1,1),new f.lo(-1,1,-1)],B.FACE_DOWN=[new f.lo(1,1,-1),new f.lo(1,1,1),new f.lo(-1,1,-1),new f.lo(-1,1,1)],B.FACE_UP=[new f.lo(-1,-1,-1),new f.lo(-1,-1,1),new f.lo(1,-1,-1),new f.lo(1,-1,1)];class z{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(mm,o,u){const f=new Uint8Array(mm.buffer,mm.byteOffset,mm.byteLength),B=w(f),O=p(f,B),r=B.width*B.height,K=new Float32Array(4*r);for(let w=0;w<r;w+=1)K[4*w]=O[3*w],K[4*w+1]=O[3*w+1],K[4*w+2]=O[3*w+2],K[4*w+3]=1;u(B.width,B.height,o.generateMipMaps,!1,(()=>{const mm=o.getEngine();o.type=1,o.format=5,o._gammaSpace=!1,mm._uploadDataToTextureDirectly(o,K)}))}}}}]);