"use strict";(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[49],{13818:(B,E,v)=>{v.r(E),v.d(E,{_HDRTextureLoader:()=>h});var z=v(11380);class o{static ConvertPanoramaToCubemap(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!B)throw"ConvertPanoramaToCubemap: input cannot be null";if(B.length!=E*v*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(z,this.FACE_FRONT,B,E,v,o),back:this.CreateCubemapTexture(z,this.FACE_BACK,B,E,v,o),left:this.CreateCubemapTexture(z,this.FACE_LEFT,B,E,v,o),right:this.CreateCubemapTexture(z,this.FACE_RIGHT,B,E,v,o),up:this.CreateCubemapTexture(z,this.FACE_UP,B,E,v,o),down:this.CreateCubemapTexture(z,this.FACE_DOWN,B,E,v,o),size:z,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(B,E,v,z,o){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=new ArrayBuffer(B*B*4*3),S=new Float32Array(c),x=q?Math.max(1,Math.round(z/4/B)):1,D=1/x,h=D*D,y=E[1].YE(E[0]).scale(D/B),Q=E[3].YE(E[2]).scale(D/B),P=1/B;let G=0;for(let Y=0;Y<B;Y++)for(let q=0;q<x;q++){let q=E[0],c=E[2];for(let E=0;E<B;E++)for(let D=0;D<x;D++){const x=c.YE(q).scale(G).add(q);x.normalize();const D=this.CalcProjectionSpherical(x,v,z,o);S[Y*B*3+3*E+0]+=D.r*h,S[Y*B*3+3*E+1]+=D.g*h,S[Y*B*3+3*E+2]+=D.b*h,q=q.add(y),c=c.add(Q)}G+=P*D}return S}static CalcProjectionSpherical(B,E,v,z){let o=Math.atan2(B.z,B.x);const q=Math.acos(B.y);for(;o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;let c=o/Math.PI;const S=q/Math.PI;c=.5*c+.5;let x=Math.round(c*v);x<0?x=0:x>=v&&(x=v-1);let D=Math.round(S*z);D<0?D=0:D>=z&&(D=z-1);const h=z-D-1;return{r:E[h*v*3+3*x+0],g:E[h*v*3+3*x+1],b:E[h*v*3+3*x+2]}}}function q(B,E,v,z,o,q){o>0?(o=function(B,E){return E>1023?B*Math.pow(2,1023)*Math.pow(2,E-1023):E<-1074?B*Math.pow(2,-1074)*Math.pow(2,E+1074):B*Math.pow(2,E)}(1,o-136),B[q+0]=E*o,B[q+1]=v*o,B[q+2]=z*o):(B[q+0]=0,B[q+1]=0,B[q+2]=0)}function c(B,E){let v="",z="";for(let o=E;o<B.length-E&&(z=String.fromCharCode(B[o]),"\n"!=z);o++)v+=z;return v}function S(B){let E=0,v=0,z=c(B,0);if("#"!=z[0]||"?"!=z[1])throw"Bad HDR Format.";let o=!1,q=!1,S=0;do{S+=z.length+1,z=c(B,S),"FORMAT=32-bit_rle_rgbe"==z?q=!0:0==z.length&&(o=!0)}while(!o);if(!q)throw"HDR Bad header format, unsupported FORMAT";S+=z.length+1,z=c(B,S);const x=/^-Y (.*) \+X (.*)$/g.exec(z);if(!x||x.length<3)throw"HDR Bad header format, no size";if(v=parseInt(x[2]),E=parseInt(x[1]),v<8||v>32767)throw"HDR Bad header format, unsupported size";return S+=z.length+1,{height:E,width:v,dataPosition:S}}function x(B,E){return function(B,E){let v=E.height;const z=E.width;let o,c,S,x,h,y=E.dataPosition,Q=0,P=0,G=0;const Y=new ArrayBuffer(4*z),a=new Uint8Array(Y),m=new ArrayBuffer(E.width*E.height*4*3),g=new Float32Array(m);for(;v>0;){if(o=B[y++],c=B[y++],S=B[y++],x=B[y++],2!=o||2!=c||128&S||E.width<8||E.width>32767)return D(B,E);if((S<<8|x)!=z)throw"HDR Bad header format, wrong scan line width";for(Q=0,G=0;G<4;G++)for(P=(G+1)*z;Q<P;)if(o=B[y++],c=B[y++],o>128){if(h=o-128,0==h||h>P-Q)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)a[Q++]=c}else{if(h=o,0==h||h>P-Q)throw"HDR Bad Format, bad scanline data (non-run)";if(a[Q++]=c,--h>0)for(let E=0;E<h;E++)a[Q++]=B[y++]}for(G=0;G<z;G++)o=a[G],c=a[G+z],S=a[G+2*z],x=a[G+3*z],q(g,o,c,S,x,(E.height-v)*z*3+3*G);v--}return g}(B,E)}function D(B,E){let v=E.height;const z=E.width;let o,c,S,x,D,h=E.dataPosition;const y=new ArrayBuffer(E.width*E.height*4*3),Q=new Float32Array(y);for(;v>0;){for(D=0;D<E.width;D++)o=B[h++],c=B[h++],S=B[h++],x=B[h++],q(Q,o,c,S,x,(E.height-v)*z*3+3*D);v--}return Q}o.FACE_LEFT=[new z.GE(-1,-1,-1),new z.GE(1,-1,-1),new z.GE(-1,1,-1),new z.GE(1,1,-1)],o.FACE_RIGHT=[new z.GE(1,-1,1),new z.GE(-1,-1,1),new z.GE(1,1,1),new z.GE(-1,1,1)],o.FACE_FRONT=[new z.GE(1,-1,-1),new z.GE(1,-1,1),new z.GE(1,1,-1),new z.GE(1,1,1)],o.FACE_BACK=[new z.GE(-1,-1,1),new z.GE(-1,-1,-1),new z.GE(-1,1,1),new z.GE(-1,1,-1)],o.FACE_DOWN=[new z.GE(1,1,-1),new z.GE(1,1,1),new z.GE(-1,1,-1),new z.GE(-1,1,1)],o.FACE_UP=[new z.GE(-1,-1,-1),new z.GE(-1,-1,1),new z.GE(1,-1,-1),new z.GE(1,-1,1)];class h{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(B,E,v){const z=new Uint8Array(B.buffer,B.byteOffset,B.byteLength),o=S(z),q=x(z,o),c=o.width*o.height,D=new Float32Array(4*c);for(let S=0;S<c;S+=1)D[4*S]=q[3*S],D[4*S+1]=q[3*S+1],D[4*S+2]=q[3*S+2],D[4*S+3]=1;v(o.width,o.height,E.generateMipMaps,!1,(()=>{const B=E.getEngine();E.type=1,E.format=5,E._gammaSpace=!1,B._uploadDataToTextureDirectly(E,D)}))}}}}]);