"use strict";(self.ex92n20nlz8=self.ex92n20nlz8||[]).push([[49],{15010:(I,g,b)=>{b.r(g),b.d(g,{_HDRTextureLoader:()=>G});var e=b(12590);class c{static ConvertPanoramaToCubemap(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!I)throw"ConvertPanoramaToCubemap: input cannot be null";if(I.length!=g*b*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(e,this.FACE_FRONT,I,g,b,c),back:this.CreateCubemapTexture(e,this.FACE_BACK,I,g,b,c),left:this.CreateCubemapTexture(e,this.FACE_LEFT,I,g,b,c),right:this.CreateCubemapTexture(e,this.FACE_RIGHT,I,g,b,c),up:this.CreateCubemapTexture(e,this.FACE_UP,I,g,b,c),down:this.CreateCubemapTexture(e,this.FACE_DOWN,I,g,b,c),size:e,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(I,g,b,e,c){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=new ArrayBuffer(I*I*4*3),J=new Float32Array(M),o=z?Math.max(1,Math.round(e/4/I)):1,n=1/o,G=n*n,D=g[1].ag(g[0]).scale(n/I),p=g[3].ag(g[2]).scale(n/I),x=1/I;let Z=0;for(let k=0;k<I;k++)for(let z=0;z<o;z++){let z=g[0],M=g[2];for(let g=0;g<I;g++)for(let n=0;n<o;n++){const o=M.ag(z).scale(Z).add(z);o.normalize();const n=this.CalcProjectionSpherical(o,b,e,c);J[k*I*3+3*g+0]+=n.r*G,J[k*I*3+3*g+1]+=n.g*G,J[k*I*3+3*g+2]+=n.b*G,z=z.add(D),M=M.add(p)}Z+=x*n}return J}static CalcProjectionSpherical(I,g,b,e){let c=Math.atan2(I.z,I.x);const z=Math.acos(I.y);for(;c<-Math.PI;)c+=2*Math.PI;for(;c>Math.PI;)c-=2*Math.PI;let M=c/Math.PI;const J=z/Math.PI;M=.5*M+.5;let o=Math.round(M*b);o<0?o=0:o>=b&&(o=b-1);let n=Math.round(J*e);n<0?n=0:n>=e&&(n=e-1);const G=e-n-1;return{r:g[G*b*3+3*o+0],g:g[G*b*3+3*o+1],b:g[G*b*3+3*o+2]}}}function z(I,g,b,e,c,z){c>0?(c=function(I,g){return g>1023?I*Math.pow(2,1023)*Math.pow(2,g-1023):g<-1074?I*Math.pow(2,-1074)*Math.pow(2,g+1074):I*Math.pow(2,g)}(1,c-136),I[z+0]=g*c,I[z+1]=b*c,I[z+2]=e*c):(I[z+0]=0,I[z+1]=0,I[z+2]=0)}function M(I,g){let b="",e="";for(let c=g;c<I.length-g&&(e=String.fromCharCode(I[c]),"\n"!=e);c++)b+=e;return b}function J(I){let g=0,b=0,e=M(I,0);if("#"!=e[0]||"?"!=e[1])throw"Bad HDR Format.";let c=!1,z=!1,J=0;do{J+=e.length+1,e=M(I,J),"FORMAT=32-bit_rle_rgbe"==e?z=!0:0==e.length&&(c=!0)}while(!c);if(!z)throw"HDR Bad header format, unsupported FORMAT";J+=e.length+1,e=M(I,J);const o=/^-Y (.*) \+X (.*)$/g.exec(e);if(!o||o.length<3)throw"HDR Bad header format, no size";if(b=parseInt(o[2]),g=parseInt(o[1]),b<8||b>32767)throw"HDR Bad header format, unsupported size";return J+=e.length+1,{height:g,width:b,dataPosition:J}}function o(I,g){return function(I,g){let b=g.height;const e=g.width;let c,M,J,o,G,D=g.dataPosition,p=0,x=0,Z=0;const k=new ArrayBuffer(4*e),S=new Uint8Array(k),f=new ArrayBuffer(g.width*g.height*4*3),V=new Float32Array(f);for(;b>0;){if(c=I[D++],M=I[D++],J=I[D++],o=I[D++],2!=c||2!=M||128&J||g.width<8||g.width>32767)return n(I,g);if((J<<8|o)!=e)throw"HDR Bad header format, wrong scan line width";for(p=0,Z=0;Z<4;Z++)for(x=(Z+1)*e;p<x;)if(c=I[D++],M=I[D++],c>128){if(G=c-128,0==G||G>x-p)throw"HDR Bad Format, bad scanline data (run)";for(;G-- >0;)S[p++]=M}else{if(G=c,0==G||G>x-p)throw"HDR Bad Format, bad scanline data (non-run)";if(S[p++]=M,--G>0)for(let g=0;g<G;g++)S[p++]=I[D++]}for(Z=0;Z<e;Z++)c=S[Z],M=S[Z+e],J=S[Z+2*e],o=S[Z+3*e],z(V,c,M,J,o,(g.height-b)*e*3+3*Z);b--}return V}(I,g)}function n(I,g){let b=g.height;const e=g.width;let c,M,J,o,n,G=g.dataPosition;const D=new ArrayBuffer(g.width*g.height*4*3),p=new Float32Array(D);for(;b>0;){for(n=0;n<g.width;n++)c=I[G++],M=I[G++],J=I[G++],o=I[G++],z(p,c,M,J,o,(g.height-b)*e*3+3*n);b--}return p}c.FACE_LEFT=[new e.Vg(-1,-1,-1),new e.Vg(1,-1,-1),new e.Vg(-1,1,-1),new e.Vg(1,1,-1)],c.FACE_RIGHT=[new e.Vg(1,-1,1),new e.Vg(-1,-1,1),new e.Vg(1,1,1),new e.Vg(-1,1,1)],c.FACE_FRONT=[new e.Vg(1,-1,-1),new e.Vg(1,-1,1),new e.Vg(1,1,-1),new e.Vg(1,1,1)],c.FACE_BACK=[new e.Vg(-1,-1,1),new e.Vg(-1,-1,-1),new e.Vg(-1,1,1),new e.Vg(-1,1,-1)],c.FACE_DOWN=[new e.Vg(1,1,-1),new e.Vg(1,1,1),new e.Vg(-1,1,-1),new e.Vg(-1,1,1)],c.FACE_UP=[new e.Vg(-1,-1,-1),new e.Vg(-1,-1,1),new e.Vg(1,-1,-1),new e.Vg(1,-1,1)];class G{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(I,g,b){const e=new Uint8Array(I.buffer,I.byteOffset,I.byteLength),c=J(e),z=o(e,c),M=c.width*c.height,n=new Float32Array(4*M);for(let J=0;J<M;J+=1)n[4*J]=z[3*J],n[4*J+1]=z[3*J+1],n[4*J+2]=z[3*J+2],n[4*J+3]=1;b(c.width,c.height,g.generateMipMaps,!1,(()=>{const I=g.getEngine();g.type=1,g.format=5,g._gammaSpace=!1,I._uploadDataToTextureDirectly(g,n)}))}}}}]);