"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[49],{13581:(g,w,q)=>{q.r(w),q.d(w,{_HDRTextureLoader:()=>t});var R=q(11180);class o{static ConvertPanoramaToCubemap(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!g)throw"ConvertPanoramaToCubemap: input cannot be null";if(g.length!=w*q*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(R,this.FACE_FRONT,g,w,q,o),back:this.CreateCubemapTexture(R,this.FACE_BACK,g,w,q,o),left:this.CreateCubemapTexture(R,this.FACE_LEFT,g,w,q,o),right:this.CreateCubemapTexture(R,this.FACE_RIGHT,g,w,q,o),up:this.CreateCubemapTexture(R,this.FACE_UP,g,w,q,o),down:this.CreateCubemapTexture(R,this.FACE_DOWN,g,w,q,o),size:R,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(g,w,q,R,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=new ArrayBuffer(g*g*4*3),i=new Float32Array(S),T=r?Math.max(1,Math.round(R/4/g)):1,z=1/T,t=z*z,m=w[1].yw(w[0]).scale(z/g),e=w[3].yw(w[2]).scale(z/g),y=1/g;let L=0;for(let A=0;A<g;A++)for(let r=0;r<T;r++){let r=w[0],S=w[2];for(let w=0;w<g;w++)for(let z=0;z<T;z++){const T=S.yw(r).scale(L).add(r);T.normalize();const z=this.CalcProjectionSpherical(T,q,R,o);i[A*g*3+3*w+0]+=z.r*t,i[A*g*3+3*w+1]+=z.g*t,i[A*g*3+3*w+2]+=z.b*t,r=r.add(m),S=S.add(e)}L+=y*z}return i}static CalcProjectionSpherical(g,w,q,R){let o=Math.atan2(g.z,g.x);const r=Math.acos(g.y);for(;o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;let S=o/Math.PI;const i=r/Math.PI;S=.5*S+.5;let T=Math.round(S*q);T<0?T=0:T>=q&&(T=q-1);let z=Math.round(i*R);z<0?z=0:z>=R&&(z=R-1);const t=R-z-1;return{r:w[t*q*3+3*T+0],g:w[t*q*3+3*T+1],b:w[t*q*3+3*T+2]}}}function r(g,w,q,R,o,r){o>0?(o=function(g,w){return w>1023?g*Math.pow(2,1023)*Math.pow(2,w-1023):w<-1074?g*Math.pow(2,-1074)*Math.pow(2,w+1074):g*Math.pow(2,w)}(1,o-136),g[r+0]=w*o,g[r+1]=q*o,g[r+2]=R*o):(g[r+0]=0,g[r+1]=0,g[r+2]=0)}function S(g,w){let q="",R="";for(let o=w;o<g.length-w&&(R=String.fromCharCode(g[o]),"\n"!=R);o++)q+=R;return q}function i(g){let w=0,q=0,R=S(g,0);if("#"!=R[0]||"?"!=R[1])throw"Bad HDR Format.";let o=!1,r=!1,i=0;do{i+=R.length+1,R=S(g,i),"FORMAT=32-bit_rle_rgbe"==R?r=!0:0==R.length&&(o=!0)}while(!o);if(!r)throw"HDR Bad header format, unsupported FORMAT";i+=R.length+1,R=S(g,i);const T=/^-Y (.*) \+X (.*)$/g.exec(R);if(!T||T.length<3)throw"HDR Bad header format, no size";if(q=parseInt(T[2]),w=parseInt(T[1]),q<8||q>32767)throw"HDR Bad header format, unsupported size";return i+=R.length+1,{height:w,width:q,dataPosition:i}}function T(g,w){return function(g,w){let q=w.height;const R=w.width;let o,S,i,T,t,m=w.dataPosition,e=0,y=0,L=0;const A=new ArrayBuffer(4*R),l=new Uint8Array(A),J=new ArrayBuffer(w.width*w.height*4*3),x=new Float32Array(J);for(;q>0;){if(o=g[m++],S=g[m++],i=g[m++],T=g[m++],2!=o||2!=S||128&i||w.width<8||w.width>32767)return z(g,w);if((i<<8|T)!=R)throw"HDR Bad header format, wrong scan line width";for(e=0,L=0;L<4;L++)for(y=(L+1)*R;e<y;)if(o=g[m++],S=g[m++],o>128){if(t=o-128,0==t||t>y-e)throw"HDR Bad Format, bad scanline data (run)";for(;t-- >0;)l[e++]=S}else{if(t=o,0==t||t>y-e)throw"HDR Bad Format, bad scanline data (non-run)";if(l[e++]=S,--t>0)for(let w=0;w<t;w++)l[e++]=g[m++]}for(L=0;L<R;L++)o=l[L],S=l[L+R],i=l[L+2*R],T=l[L+3*R],r(x,o,S,i,T,(w.height-q)*R*3+3*L);q--}return x}(g,w)}function z(g,w){let q=w.height;const R=w.width;let o,S,i,T,z,t=w.dataPosition;const m=new ArrayBuffer(w.width*w.height*4*3),e=new Float32Array(m);for(;q>0;){for(z=0;z<w.width;z++)o=g[t++],S=g[t++],i=g[t++],T=g[t++],r(e,o,S,i,T,(w.height-q)*R*3+3*z);q--}return e}o.FACE_LEFT=[new R.ew(-1,-1,-1),new R.ew(1,-1,-1),new R.ew(-1,1,-1),new R.ew(1,1,-1)],o.FACE_RIGHT=[new R.ew(1,-1,1),new R.ew(-1,-1,1),new R.ew(1,1,1),new R.ew(-1,1,1)],o.FACE_FRONT=[new R.ew(1,-1,-1),new R.ew(1,-1,1),new R.ew(1,1,-1),new R.ew(1,1,1)],o.FACE_BACK=[new R.ew(-1,-1,1),new R.ew(-1,-1,-1),new R.ew(-1,1,1),new R.ew(-1,1,-1)],o.FACE_DOWN=[new R.ew(1,1,-1),new R.ew(1,1,1),new R.ew(-1,1,-1),new R.ew(-1,1,1)],o.FACE_UP=[new R.ew(-1,-1,-1),new R.ew(-1,-1,1),new R.ew(1,-1,-1),new R.ew(1,-1,1)];class t{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(g,w,q){const R=new Uint8Array(g.buffer,g.byteOffset,g.byteLength),o=i(R),r=T(R,o),S=o.width*o.height,z=new Float32Array(4*S);for(let i=0;i<S;i+=1)z[4*i]=r[3*i],z[4*i+1]=r[3*i+1],z[4*i+2]=r[3*i+2],z[4*i+3]=1;q(o.width,o.height,w.generateMipMaps,!1,(()=>{const g=w.getEngine();w.type=1,w.format=5,w._gammaSpace=!1,g._uploadDataToTextureDirectly(w,z)}))}}}}]);