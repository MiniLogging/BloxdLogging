"use strict";(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[49],{14810:(N,U,V)=>{V.r(U),V.d(U,{_HDRTextureLoader:()=>E});var A=V(12383);class t{static ConvertPanoramaToCubemap(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!N)throw"ConvertPanoramaToCubemap: input cannot be null";if(N.length!=U*V*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(A,this.FACE_FRONT,N,U,V,t),back:this.CreateCubemapTexture(A,this.FACE_BACK,N,U,V,t),left:this.CreateCubemapTexture(A,this.FACE_LEFT,N,U,V,t),right:this.CreateCubemapTexture(A,this.FACE_RIGHT,N,U,V,t),up:this.CreateCubemapTexture(A,this.FACE_UP,N,U,V,t),down:this.CreateCubemapTexture(A,this.FACE_DOWN,N,U,V,t),size:A,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(N,U,V,A,t){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=new ArrayBuffer(N*N*4*3),i=new Float32Array(q),z=n?Math.max(1,Math.round(A/4/N)):1,S=1/z,E=S*S,p=U[1].xU(U[0]).scale(S/N),k=U[3].xU(U[2]).scale(S/N),B=1/N;let C=0;for(let x=0;x<N;x++)for(let n=0;n<z;n++){let n=U[0],q=U[2];for(let U=0;U<N;U++)for(let S=0;S<z;S++){const z=q.xU(n).scale(C).add(n);z.normalize();const S=this.CalcProjectionSpherical(z,V,A,t);i[x*N*3+3*U+0]+=S.r*E,i[x*N*3+3*U+1]+=S.g*E,i[x*N*3+3*U+2]+=S.b*E,n=n.add(p),q=q.add(k)}C+=B*S}return i}static CalcProjectionSpherical(N,U,V,A){let t=Math.atan2(N.z,N.x);const n=Math.acos(N.y);for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;let q=t/Math.PI;const i=n/Math.PI;q=.5*q+.5;let z=Math.round(q*V);z<0?z=0:z>=V&&(z=V-1);let S=Math.round(i*A);S<0?S=0:S>=A&&(S=A-1);const E=A-S-1;return{r:U[E*V*3+3*z+0],g:U[E*V*3+3*z+1],b:U[E*V*3+3*z+2]}}}function n(N,U,V,A,t,n){t>0?(t=function(N,U){return U>1023?N*Math.pow(2,1023)*Math.pow(2,U-1023):U<-1074?N*Math.pow(2,-1074)*Math.pow(2,U+1074):N*Math.pow(2,U)}(1,t-136),N[n+0]=U*t,N[n+1]=V*t,N[n+2]=A*t):(N[n+0]=0,N[n+1]=0,N[n+2]=0)}function q(N,U){let V="",A="";for(let t=U;t<N.length-U&&(A=String.fromCharCode(N[t]),"\n"!=A);t++)V+=A;return V}function i(N){let U=0,V=0,A=q(N,0);if("#"!=A[0]||"?"!=A[1])throw"Bad HDR Format.";let t=!1,n=!1,i=0;do{i+=A.length+1,A=q(N,i),"FORMAT=32-bit_rle_rgbe"==A?n=!0:0==A.length&&(t=!0)}while(!t);if(!n)throw"HDR Bad header format, unsupported FORMAT";i+=A.length+1,A=q(N,i);const z=/^-Y (.*) \+X (.*)$/g.exec(A);if(!z||z.length<3)throw"HDR Bad header format, no size";if(V=parseInt(z[2]),U=parseInt(z[1]),V<8||V>32767)throw"HDR Bad header format, unsupported size";return i+=A.length+1,{height:U,width:V,dataPosition:i}}function z(N,U){return function(N,U){let V=U.height;const A=U.width;let t,q,i,z,E,p=U.dataPosition,k=0,B=0,C=0;const x=new ArrayBuffer(4*A),J=new Uint8Array(x),d=new ArrayBuffer(U.width*U.height*4*3),r=new Float32Array(d);for(;V>0;){if(t=N[p++],q=N[p++],i=N[p++],z=N[p++],2!=t||2!=q||128&i||U.width<8||U.width>32767)return S(N,U);if((i<<8|z)!=A)throw"HDR Bad header format, wrong scan line width";for(k=0,C=0;C<4;C++)for(B=(C+1)*A;k<B;)if(t=N[p++],q=N[p++],t>128){if(E=t-128,0==E||E>B-k)throw"HDR Bad Format, bad scanline data (run)";for(;E-- >0;)J[k++]=q}else{if(E=t,0==E||E>B-k)throw"HDR Bad Format, bad scanline data (non-run)";if(J[k++]=q,--E>0)for(let U=0;U<E;U++)J[k++]=N[p++]}for(C=0;C<A;C++)t=J[C],q=J[C+A],i=J[C+2*A],z=J[C+3*A],n(r,t,q,i,z,(U.height-V)*A*3+3*C);V--}return r}(N,U)}function S(N,U){let V=U.height;const A=U.width;let t,q,i,z,S,E=U.dataPosition;const p=new ArrayBuffer(U.width*U.height*4*3),k=new Float32Array(p);for(;V>0;){for(S=0;S<U.width;S++)t=N[E++],q=N[E++],i=N[E++],z=N[E++],n(k,t,q,i,z,(U.height-V)*A*3+3*S);V--}return k}t.FACE_LEFT=[new A.CU(-1,-1,-1),new A.CU(1,-1,-1),new A.CU(-1,1,-1),new A.CU(1,1,-1)],t.FACE_RIGHT=[new A.CU(1,-1,1),new A.CU(-1,-1,1),new A.CU(1,1,1),new A.CU(-1,1,1)],t.FACE_FRONT=[new A.CU(1,-1,-1),new A.CU(1,-1,1),new A.CU(1,1,-1),new A.CU(1,1,1)],t.FACE_BACK=[new A.CU(-1,-1,1),new A.CU(-1,-1,-1),new A.CU(-1,1,1),new A.CU(-1,1,-1)],t.FACE_DOWN=[new A.CU(1,1,-1),new A.CU(1,1,1),new A.CU(-1,1,-1),new A.CU(-1,1,1)],t.FACE_UP=[new A.CU(-1,-1,-1),new A.CU(-1,-1,1),new A.CU(1,-1,-1),new A.CU(1,-1,1)];class E{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(N,U,V){const A=new Uint8Array(N.buffer,N.byteOffset,N.byteLength),t=i(A),n=z(A,t),q=t.width*t.height,S=new Float32Array(4*q);for(let i=0;i<q;i+=1)S[4*i]=n[3*i],S[4*i+1]=n[3*i+1],S[4*i+2]=n[3*i+2],S[4*i+3]=1;V(t.width,t.height,U.generateMipMaps,!1,(()=>{const N=U.getEngine();U.type=1,U.format=5,U._gammaSpace=!1,N._uploadDataToTextureDirectly(U,S)}))}}}}]);