"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[49],{15077:(r,O,W)=>{W.r(O),W.d(O,{_HDRTextureLoader:()=>d});var q=W(12591);class Q{static ConvertPanoramaToCubemap(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!r)throw"ConvertPanoramaToCubemap: input cannot be null";if(r.length!=O*W*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(q,this.FACE_FRONT,r,O,W,Q),back:this.CreateCubemapTexture(q,this.FACE_BACK,r,O,W,Q),left:this.CreateCubemapTexture(q,this.FACE_LEFT,r,O,W,Q),right:this.CreateCubemapTexture(q,this.FACE_RIGHT,r,O,W,Q),up:this.CreateCubemapTexture(q,this.FACE_UP,r,O,W,Q),down:this.CreateCubemapTexture(q,this.FACE_DOWN,r,O,W,Q),size:q,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(r,O,W,q,Q){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=new ArrayBuffer(r*r*4*3),h=new Float32Array(T),J=C?Math.max(1,Math.round(q/4/r)):1,mr=1/J,d=mr*mr,v=O[1].YO(O[0]).scale(mr/r),g=O[3].YO(O[2]).scale(mr/r),K=1/r;let U=0;for(let P=0;P<r;P++)for(let C=0;C<J;C++){let C=O[0],T=O[2];for(let O=0;O<r;O++)for(let mr=0;mr<J;mr++){const J=T.YO(C).scale(U).add(C);J.normalize();const mr=this.CalcProjectionSpherical(J,W,q,Q);h[P*r*3+3*O+0]+=mr.r*d,h[P*r*3+3*O+1]+=mr.g*d,h[P*r*3+3*O+2]+=mr.b*d,C=C.add(v),T=T.add(g)}U+=K*mr}return h}static CalcProjectionSpherical(r,O,W,q){let Q=Math.atan2(r.z,r.x);const C=Math.acos(r.y);for(;Q<-Math.PI;)Q+=2*Math.PI;for(;Q>Math.PI;)Q-=2*Math.PI;let T=Q/Math.PI;const h=C/Math.PI;T=.5*T+.5;let J=Math.round(T*W);J<0?J=0:J>=W&&(J=W-1);let mr=Math.round(h*q);mr<0?mr=0:mr>=q&&(mr=q-1);const d=q-mr-1;return{r:O[d*W*3+3*J+0],g:O[d*W*3+3*J+1],b:O[d*W*3+3*J+2]}}}function C(r,O,W,q,Q,C){Q>0?(Q=function(r,O){return O>1023?r*Math.pow(2,1023)*Math.pow(2,O-1023):O<-1074?r*Math.pow(2,-1074)*Math.pow(2,O+1074):r*Math.pow(2,O)}(1,Q-136),r[C+0]=O*Q,r[C+1]=W*Q,r[C+2]=q*Q):(r[C+0]=0,r[C+1]=0,r[C+2]=0)}function T(r,O){let W="",q="";for(let Q=O;Q<r.length-O&&(q=String.fromCharCode(r[Q]),"\n"!=q);Q++)W+=q;return W}function h(r){let O=0,W=0,q=T(r,0);if("#"!=q[0]||"?"!=q[1])throw"Bad HDR Format.";let Q=!1,C=!1,h=0;do{h+=q.length+1,q=T(r,h),"FORMAT=32-bit_rle_rgbe"==q?C=!0:0==q.length&&(Q=!0)}while(!Q);if(!C)throw"HDR Bad header format, unsupported FORMAT";h+=q.length+1,q=T(r,h);const J=/^-Y (.*) \+X (.*)$/g.exec(q);if(!J||J.length<3)throw"HDR Bad header format, no size";if(W=parseInt(J[2]),O=parseInt(J[1]),W<8||W>32767)throw"HDR Bad header format, unsupported size";return h+=q.length+1,{height:O,width:W,dataPosition:h}}function J(r,O){return function(r,O){let W=O.height;const q=O.width;let Q,T,h,J,d,v=O.dataPosition,g=0,K=0,U=0;const P=new ArrayBuffer(4*q),b=new Uint8Array(P),e=new ArrayBuffer(O.width*O.height*4*3),Y=new Float32Array(e);for(;W>0;){if(Q=r[v++],T=r[v++],h=r[v++],J=r[v++],2!=Q||2!=T||128&h||O.width<8||O.width>32767)return mr(r,O);if((h<<8|J)!=q)throw"HDR Bad header format, wrong scan line width";for(g=0,U=0;U<4;U++)for(K=(U+1)*q;g<K;)if(Q=r[v++],T=r[v++],Q>128){if(d=Q-128,0==d||d>K-g)throw"HDR Bad Format, bad scanline data (run)";for(;d-- >0;)b[g++]=T}else{if(d=Q,0==d||d>K-g)throw"HDR Bad Format, bad scanline data (non-run)";if(b[g++]=T,--d>0)for(let O=0;O<d;O++)b[g++]=r[v++]}for(U=0;U<q;U++)Q=b[U],T=b[U+q],h=b[U+2*q],J=b[U+3*q],C(Y,Q,T,h,J,(O.height-W)*q*3+3*U);W--}return Y}(r,O)}function mr(r,O){let W=O.height;const q=O.width;let Q,T,h,J,mr,d=O.dataPosition;const v=new ArrayBuffer(O.width*O.height*4*3),g=new Float32Array(v);for(;W>0;){for(mr=0;mr<O.width;mr++)Q=r[d++],T=r[d++],h=r[d++],J=r[d++],C(g,Q,T,h,J,(O.height-W)*q*3+3*mr);W--}return g}Q.FACE_LEFT=[new q.eO(-1,-1,-1),new q.eO(1,-1,-1),new q.eO(-1,1,-1),new q.eO(1,1,-1)],Q.FACE_RIGHT=[new q.eO(1,-1,1),new q.eO(-1,-1,1),new q.eO(1,1,1),new q.eO(-1,1,1)],Q.FACE_FRONT=[new q.eO(1,-1,-1),new q.eO(1,-1,1),new q.eO(1,1,-1),new q.eO(1,1,1)],Q.FACE_BACK=[new q.eO(-1,-1,1),new q.eO(-1,-1,-1),new q.eO(-1,1,1),new q.eO(-1,1,-1)],Q.FACE_DOWN=[new q.eO(1,1,-1),new q.eO(1,1,1),new q.eO(-1,1,-1),new q.eO(-1,1,1)],Q.FACE_UP=[new q.eO(-1,-1,-1),new q.eO(-1,-1,1),new q.eO(1,-1,-1),new q.eO(1,-1,1)];class d{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(r,O,W){const q=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),Q=h(q),C=J(q,Q),T=Q.width*Q.height,mr=new Float32Array(4*T);for(let h=0;h<T;h+=1)mr[4*h]=C[3*h],mr[4*h+1]=C[3*h+1],mr[4*h+2]=C[3*h+2],mr[4*h+3]=1;W(Q.width,Q.height,O.generateMipMaps,!1,(()=>{const r=O.getEngine();O.type=1,O.format=5,O._gammaSpace=!1,r._uploadDataToTextureDirectly(O,mr)}))}}}}]);