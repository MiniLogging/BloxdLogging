"use strict";(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[49],{15422:(Y,c,h)=>{h.r(c),h.d(c,{_HDRTextureLoader:()=>W});var C=h(12869);class E{static ConvertPanoramaToCubemap(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!Y)throw"ConvertPanoramaToCubemap: input cannot be null";if(Y.length!=c*h*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(C,this.FACE_FRONT,Y,c,h,E),back:this.CreateCubemapTexture(C,this.FACE_BACK,Y,c,h,E),left:this.CreateCubemapTexture(C,this.FACE_LEFT,Y,c,h,E),right:this.CreateCubemapTexture(C,this.FACE_RIGHT,Y,c,h,E),up:this.CreateCubemapTexture(C,this.FACE_UP,Y,c,h,E),down:this.CreateCubemapTexture(C,this.FACE_DOWN,Y,c,h,E),size:C,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(Y,c,h,C,E){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=new ArrayBuffer(Y*Y*4*3),b=new Float32Array(Q),H=N?Math.max(1,Math.round(C/4/Y)):1,w=1/H,W=w*w,q=c[1].Hh(c[0]).scale(w/Y),k=c[3].Hh(c[2]).scale(w/Y),M=1/Y;let p=0;for(let P=0;P<Y;P++)for(let N=0;N<H;N++){let N=c[0],Q=c[2];for(let c=0;c<Y;c++)for(let w=0;w<H;w++){const H=Q.Hh(N).scale(p).add(N);H.normalize();const w=this.CalcProjectionSpherical(H,h,C,E);b[P*Y*3+3*c+0]+=w.r*W,b[P*Y*3+3*c+1]+=w.g*W,b[P*Y*3+3*c+2]+=w.b*W,N=N.add(q),Q=Q.add(k)}p+=M*w}return b}static CalcProjectionSpherical(Y,c,h,C){let E=Math.atan2(Y.z,Y.x);const N=Math.acos(Y.y);for(;E<-Math.PI;)E+=2*Math.PI;for(;E>Math.PI;)E-=2*Math.PI;let Q=E/Math.PI;const b=N/Math.PI;Q=.5*Q+.5;let H=Math.round(Q*h);H<0?H=0:H>=h&&(H=h-1);let w=Math.round(b*C);w<0?w=0:w>=C&&(w=C-1);const W=C-w-1;return{r:c[W*h*3+3*H+0],g:c[W*h*3+3*H+1],b:c[W*h*3+3*H+2]}}}function N(Y,c,h,C,E,N){E>0?(E=function(Y,c){return c>1023?Y*Math.pow(2,1023)*Math.pow(2,c-1023):c<-1074?Y*Math.pow(2,-1074)*Math.pow(2,c+1074):Y*Math.pow(2,c)}(1,E-136),Y[N+0]=c*E,Y[N+1]=h*E,Y[N+2]=C*E):(Y[N+0]=0,Y[N+1]=0,Y[N+2]=0)}function Q(Y,c){let h="",C="";for(let E=c;E<Y.length-c&&(C=String.fromCharCode(Y[E]),"\n"!=C);E++)h+=C;return h}function b(Y){let c=0,h=0,C=Q(Y,0);if("#"!=C[0]||"?"!=C[1])throw"Bad HDR Format.";let E=!1,N=!1,b=0;do{b+=C.length+1,C=Q(Y,b),"FORMAT=32-bit_rle_rgbe"==C?N=!0:0==C.length&&(E=!0)}while(!E);if(!N)throw"HDR Bad header format, unsupported FORMAT";b+=C.length+1,C=Q(Y,b);const H=/^-Y (.*) \+X (.*)$/g.exec(C);if(!H||H.length<3)throw"HDR Bad header format, no size";if(h=parseInt(H[2]),c=parseInt(H[1]),h<8||h>32767)throw"HDR Bad header format, unsupported size";return b+=C.length+1,{height:c,width:h,dataPosition:b}}function H(Y,c){return function(Y,c){let h=c.height;const C=c.width;let E,Q,b,H,W,q=c.dataPosition,k=0,M=0,p=0;const P=new ArrayBuffer(4*C),y=new Uint8Array(P),d=new ArrayBuffer(c.width*c.height*4*3),D=new Float32Array(d);for(;h>0;){if(E=Y[q++],Q=Y[q++],b=Y[q++],H=Y[q++],2!=E||2!=Q||128&b||c.width<8||c.width>32767)return w(Y,c);if((b<<8|H)!=C)throw"HDR Bad header format, wrong scan line width";for(k=0,p=0;p<4;p++)for(M=(p+1)*C;k<M;)if(E=Y[q++],Q=Y[q++],E>128){if(W=E-128,0==W||W>M-k)throw"HDR Bad Format, bad scanline data (run)";for(;W-- >0;)y[k++]=Q}else{if(W=E,0==W||W>M-k)throw"HDR Bad Format, bad scanline data (non-run)";if(y[k++]=Q,--W>0)for(let c=0;c<W;c++)y[k++]=Y[q++]}for(p=0;p<C;p++)E=y[p],Q=y[p+C],b=y[p+2*C],H=y[p+3*C],N(D,E,Q,b,H,(c.height-h)*C*3+3*p);h--}return D}(Y,c)}function w(Y,c){let h=c.height;const C=c.width;let E,Q,b,H,w,W=c.dataPosition;const q=new ArrayBuffer(c.width*c.height*4*3),k=new Float32Array(q);for(;h>0;){for(w=0;w<c.width;w++)E=Y[W++],Q=Y[W++],b=Y[W++],H=Y[W++],N(k,E,Q,b,H,(c.height-h)*C*3+3*w);h--}return k}E.FACE_LEFT=[new C.bh(-1,-1,-1),new C.bh(1,-1,-1),new C.bh(-1,1,-1),new C.bh(1,1,-1)],E.FACE_RIGHT=[new C.bh(1,-1,1),new C.bh(-1,-1,1),new C.bh(1,1,1),new C.bh(-1,1,1)],E.FACE_FRONT=[new C.bh(1,-1,-1),new C.bh(1,-1,1),new C.bh(1,1,-1),new C.bh(1,1,1)],E.FACE_BACK=[new C.bh(-1,-1,1),new C.bh(-1,-1,-1),new C.bh(-1,1,1),new C.bh(-1,1,-1)],E.FACE_DOWN=[new C.bh(1,1,-1),new C.bh(1,1,1),new C.bh(-1,1,-1),new C.bh(-1,1,1)],E.FACE_UP=[new C.bh(-1,-1,-1),new C.bh(-1,-1,1),new C.bh(1,-1,-1),new C.bh(1,-1,1)];class W{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(Y,c,h){const C=new Uint8Array(Y.buffer,Y.byteOffset,Y.byteLength),E=b(C),N=H(C,E),Q=E.width*E.height,w=new Float32Array(4*Q);for(let b=0;b<Q;b+=1)w[4*b]=N[3*b],w[4*b+1]=N[3*b+1],w[4*b+2]=N[3*b+2],w[4*b+3]=1;h(E.width,E.height,c.generateMipMaps,!1,(()=>{const Y=c.getEngine();c.type=1,c.format=5,c._gammaSpace=!1,Y._uploadDataToTextureDirectly(c,w)}))}}}}]);