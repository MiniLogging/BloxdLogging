"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[49],{14619:(t,U,y)=>{y.r(U),y.d(U,{_HDRTextureLoader:()=>M});var I=y(12386);class r{static ConvertPanoramaToCubemap(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=U*y*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(I,this.FACE_FRONT,t,U,y,r),back:this.CreateCubemapTexture(I,this.FACE_BACK,t,U,y,r),left:this.CreateCubemapTexture(I,this.FACE_LEFT,t,U,y,r),right:this.CreateCubemapTexture(I,this.FACE_RIGHT,t,U,y,r),up:this.CreateCubemapTexture(I,this.FACE_UP,t,U,y,r),down:this.CreateCubemapTexture(I,this.FACE_DOWN,t,U,y,r),size:I,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const mt=new ArrayBuffer(t*t*4*3),X=new Float32Array(mt),P=Y?Math.max(1,Math.round(I/4/t)):1,G=1/P,M=G*G,L=U[1].lU(U[0]).scale(G/t),h=U[3].lU(U[2]).scale(G/t),Q=1/t;let F=0;for(let E=0;E<t;E++)for(let Y=0;Y<P;Y++){let Y=U[0],mt=U[2];for(let U=0;U<t;U++)for(let G=0;G<P;G++){const P=mt.lU(Y).scale(F).add(Y);P.normalize();const G=this.CalcProjectionSpherical(P,y,I,r);X[E*t*3+3*U+0]+=G.r*M,X[E*t*3+3*U+1]+=G.g*M,X[E*t*3+3*U+2]+=G.b*M,Y=Y.add(L),mt=mt.add(h)}F+=Q*G}return X}static CalcProjectionSpherical(t,U,y,I){let r=Math.atan2(t.z,t.x);const Y=Math.acos(t.y);for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;let mt=r/Math.PI;const X=Y/Math.PI;mt=.5*mt+.5;let P=Math.round(mt*y);P<0?P=0:P>=y&&(P=y-1);let G=Math.round(X*I);G<0?G=0:G>=I&&(G=I-1);const M=I-G-1;return{r:U[M*y*3+3*P+0],g:U[M*y*3+3*P+1],b:U[M*y*3+3*P+2]}}}function Y(t,U,y,I,r,Y){r>0?(r=function(t,U){return U>1023?t*Math.pow(2,1023)*Math.pow(2,U-1023):U<-1074?t*Math.pow(2,-1074)*Math.pow(2,U+1074):t*Math.pow(2,U)}(1,r-136),t[Y+0]=U*r,t[Y+1]=y*r,t[Y+2]=I*r):(t[Y+0]=0,t[Y+1]=0,t[Y+2]=0)}function mt(t,U){let y="",I="";for(let r=U;r<t.length-U&&(I=String.fromCharCode(t[r]),"\n"!=I);r++)y+=I;return y}function X(t){let U=0,y=0,I=mt(t,0);if("#"!=I[0]||"?"!=I[1])throw"Bad HDR Format.";let r=!1,Y=!1,X=0;do{X+=I.length+1,I=mt(t,X),"FORMAT=32-bit_rle_rgbe"==I?Y=!0:0==I.length&&(r=!0)}while(!r);if(!Y)throw"HDR Bad header format, unsupported FORMAT";X+=I.length+1,I=mt(t,X);const P=/^-Y (.*) \+X (.*)$/g.exec(I);if(!P||P.length<3)throw"HDR Bad header format, no size";if(y=parseInt(P[2]),U=parseInt(P[1]),y<8||y>32767)throw"HDR Bad header format, unsupported size";return X+=I.length+1,{height:U,width:y,dataPosition:X}}function P(t,U){return function(t,U){let y=U.height;const I=U.width;let r,mt,X,P,M,L=U.dataPosition,h=0,Q=0,F=0;const E=new ArrayBuffer(4*I),w=new Uint8Array(E),D=new ArrayBuffer(U.width*U.height*4*3),l=new Float32Array(D);for(;y>0;){if(r=t[L++],mt=t[L++],X=t[L++],P=t[L++],2!=r||2!=mt||128&X||U.width<8||U.width>32767)return G(t,U);if((X<<8|P)!=I)throw"HDR Bad header format, wrong scan line width";for(h=0,F=0;F<4;F++)for(Q=(F+1)*I;h<Q;)if(r=t[L++],mt=t[L++],r>128){if(M=r-128,0==M||M>Q-h)throw"HDR Bad Format, bad scanline data (run)";for(;M-- >0;)w[h++]=mt}else{if(M=r,0==M||M>Q-h)throw"HDR Bad Format, bad scanline data (non-run)";if(w[h++]=mt,--M>0)for(let U=0;U<M;U++)w[h++]=t[L++]}for(F=0;F<I;F++)r=w[F],mt=w[F+I],X=w[F+2*I],P=w[F+3*I],Y(l,r,mt,X,P,(U.height-y)*I*3+3*F);y--}return l}(t,U)}function G(t,U){let y=U.height;const I=U.width;let r,mt,X,P,G,M=U.dataPosition;const L=new ArrayBuffer(U.width*U.height*4*3),h=new Float32Array(L);for(;y>0;){for(G=0;G<U.width;G++)r=t[M++],mt=t[M++],X=t[M++],P=t[M++],Y(h,r,mt,X,P,(U.height-y)*I*3+3*G);y--}return h}r.FACE_LEFT=[new I.DU(-1,-1,-1),new I.DU(1,-1,-1),new I.DU(-1,1,-1),new I.DU(1,1,-1)],r.FACE_RIGHT=[new I.DU(1,-1,1),new I.DU(-1,-1,1),new I.DU(1,1,1),new I.DU(-1,1,1)],r.FACE_FRONT=[new I.DU(1,-1,-1),new I.DU(1,-1,1),new I.DU(1,1,-1),new I.DU(1,1,1)],r.FACE_BACK=[new I.DU(-1,-1,1),new I.DU(-1,-1,-1),new I.DU(-1,1,1),new I.DU(-1,1,-1)],r.FACE_DOWN=[new I.DU(1,1,-1),new I.DU(1,1,1),new I.DU(-1,1,-1),new I.DU(-1,1,1)],r.FACE_UP=[new I.DU(-1,-1,-1),new I.DU(-1,-1,1),new I.DU(1,-1,-1),new I.DU(1,-1,1)];class M{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(t,U,y){const I=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=X(I),Y=P(I,r),mt=r.width*r.height,G=new Float32Array(4*mt);for(let X=0;X<mt;X+=1)G[4*X]=Y[3*X],G[4*X+1]=Y[3*X+1],G[4*X+2]=Y[3*X+2],G[4*X+3]=1;y(r.width,r.height,U.generateMipMaps,!1,(()=>{const t=U.getEngine();U.type=1,U.format=5,U._gammaSpace=!1,t._uploadDataToTextureDirectly(U,G)}))}}}}]);