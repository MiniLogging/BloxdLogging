"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[49],{15002:(g,i,a)=>{a.r(i),a.d(i,{_HDRTextureLoader:()=>F});var n=a(12452);class L{static ConvertPanoramaToCubemap(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!g)throw"ConvertPanoramaToCubemap: input cannot be null";if(g.length!=i*a*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(n,this.FACE_FRONT,g,i,a,L),back:this.CreateCubemapTexture(n,this.FACE_BACK,g,i,a,L),left:this.CreateCubemapTexture(n,this.FACE_LEFT,g,i,a,L),right:this.CreateCubemapTexture(n,this.FACE_RIGHT,g,i,a,L),up:this.CreateCubemapTexture(n,this.FACE_UP,g,i,a,L),down:this.CreateCubemapTexture(n,this.FACE_DOWN,g,i,a,L),size:n,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(g,i,a,n,L){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=new ArrayBuffer(g*g*4*3),k=new Float32Array(b),e=d?Math.max(1,Math.round(n/4/g)):1,N=1/e,F=N*N,I=i[1].ci(i[0]).scale(N/g),j=i[3].ci(i[2]).scale(N/g),y=1/g;let B=0;for(let c=0;c<g;c++)for(let d=0;d<e;d++){let d=i[0],b=i[2];for(let i=0;i<g;i++)for(let N=0;N<e;N++){const e=b.ci(d).scale(B).add(d);e.normalize();const N=this.CalcProjectionSpherical(e,a,n,L);k[c*g*3+3*i+0]+=N.r*F,k[c*g*3+3*i+1]+=N.g*F,k[c*g*3+3*i+2]+=N.b*F,d=d.add(I),b=b.add(j)}B+=y*N}return k}static CalcProjectionSpherical(g,i,a,n){let L=Math.atan2(g.z,g.x);const d=Math.acos(g.y);for(;L<-Math.PI;)L+=2*Math.PI;for(;L>Math.PI;)L-=2*Math.PI;let b=L/Math.PI;const k=d/Math.PI;b=.5*b+.5;let e=Math.round(b*a);e<0?e=0:e>=a&&(e=a-1);let N=Math.round(k*n);N<0?N=0:N>=n&&(N=n-1);const F=n-N-1;return{r:i[F*a*3+3*e+0],g:i[F*a*3+3*e+1],b:i[F*a*3+3*e+2]}}}function d(g,i,a,n,L,d){L>0?(L=function(g,i){return i>1023?g*Math.pow(2,1023)*Math.pow(2,i-1023):i<-1074?g*Math.pow(2,-1074)*Math.pow(2,i+1074):g*Math.pow(2,i)}(1,L-136),g[d+0]=i*L,g[d+1]=a*L,g[d+2]=n*L):(g[d+0]=0,g[d+1]=0,g[d+2]=0)}function b(g,i){let a="",n="";for(let L=i;L<g.length-i&&(n=String.fromCharCode(g[L]),"\n"!=n);L++)a+=n;return a}function k(g){let i=0,a=0,n=b(g,0);if("#"!=n[0]||"?"!=n[1])throw"Bad HDR Format.";let L=!1,d=!1,k=0;do{k+=n.length+1,n=b(g,k),"FORMAT=32-bit_rle_rgbe"==n?d=!0:0==n.length&&(L=!0)}while(!L);if(!d)throw"HDR Bad header format, unsupported FORMAT";k+=n.length+1,n=b(g,k);const e=/^-Y (.*) \+X (.*)$/g.exec(n);if(!e||e.length<3)throw"HDR Bad header format, no size";if(a=parseInt(e[2]),i=parseInt(e[1]),a<8||a>32767)throw"HDR Bad header format, unsupported size";return k+=n.length+1,{height:i,width:a,dataPosition:k}}function e(g,i){return function(g,i){let a=i.height;const n=i.width;let L,b,k,e,F,I=i.dataPosition,j=0,y=0,B=0;const c=new ArrayBuffer(4*n),D=new Uint8Array(c),p=new ArrayBuffer(i.width*i.height*4*3),R=new Float32Array(p);for(;a>0;){if(L=g[I++],b=g[I++],k=g[I++],e=g[I++],2!=L||2!=b||128&k||i.width<8||i.width>32767)return N(g,i);if((k<<8|e)!=n)throw"HDR Bad header format, wrong scan line width";for(j=0,B=0;B<4;B++)for(y=(B+1)*n;j<y;)if(L=g[I++],b=g[I++],L>128){if(F=L-128,0==F||F>y-j)throw"HDR Bad Format, bad scanline data (run)";for(;F-- >0;)D[j++]=b}else{if(F=L,0==F||F>y-j)throw"HDR Bad Format, bad scanline data (non-run)";if(D[j++]=b,--F>0)for(let i=0;i<F;i++)D[j++]=g[I++]}for(B=0;B<n;B++)L=D[B],b=D[B+n],k=D[B+2*n],e=D[B+3*n],d(R,L,b,k,e,(i.height-a)*n*3+3*B);a--}return R}(g,i)}function N(g,i){let a=i.height;const n=i.width;let L,b,k,e,N,F=i.dataPosition;const I=new ArrayBuffer(i.width*i.height*4*3),j=new Float32Array(I);for(;a>0;){for(N=0;N<i.width;N++)L=g[F++],b=g[F++],k=g[F++],e=g[F++],d(j,L,b,k,e,(i.height-a)*n*3+3*N);a--}return j}L.FACE_LEFT=[new n.Bi(-1,-1,-1),new n.Bi(1,-1,-1),new n.Bi(-1,1,-1),new n.Bi(1,1,-1)],L.FACE_RIGHT=[new n.Bi(1,-1,1),new n.Bi(-1,-1,1),new n.Bi(1,1,1),new n.Bi(-1,1,1)],L.FACE_FRONT=[new n.Bi(1,-1,-1),new n.Bi(1,-1,1),new n.Bi(1,1,-1),new n.Bi(1,1,1)],L.FACE_BACK=[new n.Bi(-1,-1,1),new n.Bi(-1,-1,-1),new n.Bi(-1,1,1),new n.Bi(-1,1,-1)],L.FACE_DOWN=[new n.Bi(1,1,-1),new n.Bi(1,1,1),new n.Bi(-1,1,-1),new n.Bi(-1,1,1)],L.FACE_UP=[new n.Bi(-1,-1,-1),new n.Bi(-1,-1,1),new n.Bi(1,-1,-1),new n.Bi(1,-1,1)];class F{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(g,i,a){const n=new Uint8Array(g.buffer,g.byteOffset,g.byteLength),L=k(n),d=e(n,L),b=L.width*L.height,N=new Float32Array(4*b);for(let k=0;k<b;k+=1)N[4*k]=d[3*k],N[4*k+1]=d[3*k+1],N[4*k+2]=d[3*k+2],N[4*k+3]=1;a(L.width,L.height,i.generateMipMaps,!1,(()=>{const g=i.getEngine();i.type=1,i.format=5,i._gammaSpace=!1,g._uploadDataToTextureDirectly(i,N)}))}}}}]);