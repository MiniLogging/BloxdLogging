"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[49],{14621:(i,x,e)=>{e.r(x),e.d(x,{_HDRTextureLoader:()=>g});var j=e(12250);class E{static ConvertPanoramaToCubemap(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!i)throw"ConvertPanoramaToCubemap: input cannot be null";if(i.length!=x*e*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(j,this.FACE_FRONT,i,x,e,E),back:this.CreateCubemapTexture(j,this.FACE_BACK,i,x,e,E),left:this.CreateCubemapTexture(j,this.FACE_LEFT,i,x,e,E),right:this.CreateCubemapTexture(j,this.FACE_RIGHT,i,x,e,E),up:this.CreateCubemapTexture(j,this.FACE_UP,i,x,e,E),down:this.CreateCubemapTexture(j,this.FACE_DOWN,i,x,e,E),size:j,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(i,x,e,j,E){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=new ArrayBuffer(i*i*4*3),J=new Float32Array(Y),u=a?Math.max(1,Math.round(j/4/i)):1,b=1/u,g=b*b,A=x[1].Cx(x[0]).scale(b/i),K=x[3].Cx(x[2]).scale(b/i),L=1/i;let o=0;for(let M=0;M<i;M++)for(let a=0;a<u;a++){let a=x[0],Y=x[2];for(let x=0;x<i;x++)for(let b=0;b<u;b++){const u=Y.Cx(a).scale(o).add(a);u.normalize();const b=this.CalcProjectionSpherical(u,e,j,E);J[M*i*3+3*x+0]+=b.r*g,J[M*i*3+3*x+1]+=b.g*g,J[M*i*3+3*x+2]+=b.b*g,a=a.add(A),Y=Y.add(K)}o+=L*b}return J}static CalcProjectionSpherical(i,x,e,j){let E=Math.atan2(i.z,i.x);const a=Math.acos(i.y);for(;E<-Math.PI;)E+=2*Math.PI;for(;E>Math.PI;)E-=2*Math.PI;let Y=E/Math.PI;const J=a/Math.PI;Y=.5*Y+.5;let u=Math.round(Y*e);u<0?u=0:u>=e&&(u=e-1);let b=Math.round(J*j);b<0?b=0:b>=j&&(b=j-1);const g=j-b-1;return{r:x[g*e*3+3*u+0],g:x[g*e*3+3*u+1],b:x[g*e*3+3*u+2]}}}function a(i,x,e,j,E,a){E>0?(E=function(i,x){return x>1023?i*Math.pow(2,1023)*Math.pow(2,x-1023):x<-1074?i*Math.pow(2,-1074)*Math.pow(2,x+1074):i*Math.pow(2,x)}(1,E-136),i[a+0]=x*E,i[a+1]=e*E,i[a+2]=j*E):(i[a+0]=0,i[a+1]=0,i[a+2]=0)}function Y(i,x){let e="",j="";for(let E=x;E<i.length-x&&(j=String.fromCharCode(i[E]),"\n"!=j);E++)e+=j;return e}function J(i){let x=0,e=0,j=Y(i,0);if("#"!=j[0]||"?"!=j[1])throw"Bad HDR Format.";let E=!1,a=!1,J=0;do{J+=j.length+1,j=Y(i,J),"FORMAT=32-bit_rle_rgbe"==j?a=!0:0==j.length&&(E=!0)}while(!E);if(!a)throw"HDR Bad header format, unsupported FORMAT";J+=j.length+1,j=Y(i,J);const u=/^-Y (.*) \+X (.*)$/g.exec(j);if(!u||u.length<3)throw"HDR Bad header format, no size";if(e=parseInt(u[2]),x=parseInt(u[1]),e<8||e>32767)throw"HDR Bad header format, unsupported size";return J+=j.length+1,{height:x,width:e,dataPosition:J}}function u(i,x){return function(i,x){let e=x.height;const j=x.width;let E,Y,J,u,g,A=x.dataPosition,K=0,L=0,o=0;const M=new ArrayBuffer(4*j),z=new Uint8Array(M),T=new ArrayBuffer(x.width*x.height*4*3),Q=new Float32Array(T);for(;e>0;){if(E=i[A++],Y=i[A++],J=i[A++],u=i[A++],2!=E||2!=Y||128&J||x.width<8||x.width>32767)return b(i,x);if((J<<8|u)!=j)throw"HDR Bad header format, wrong scan line width";for(K=0,o=0;o<4;o++)for(L=(o+1)*j;K<L;)if(E=i[A++],Y=i[A++],E>128){if(g=E-128,0==g||g>L-K)throw"HDR Bad Format, bad scanline data (run)";for(;g-- >0;)z[K++]=Y}else{if(g=E,0==g||g>L-K)throw"HDR Bad Format, bad scanline data (non-run)";if(z[K++]=Y,--g>0)for(let x=0;x<g;x++)z[K++]=i[A++]}for(o=0;o<j;o++)E=z[o],Y=z[o+j],J=z[o+2*j],u=z[o+3*j],a(Q,E,Y,J,u,(x.height-e)*j*3+3*o);e--}return Q}(i,x)}function b(i,x){let e=x.height;const j=x.width;let E,Y,J,u,b,g=x.dataPosition;const A=new ArrayBuffer(x.width*x.height*4*3),K=new Float32Array(A);for(;e>0;){for(b=0;b<x.width;b++)E=i[g++],Y=i[g++],J=i[g++],u=i[g++],a(K,E,Y,J,u,(x.height-e)*j*3+3*b);e--}return K}E.FACE_LEFT=[new j.KJ(-1,-1,-1),new j.KJ(1,-1,-1),new j.KJ(-1,1,-1),new j.KJ(1,1,-1)],E.FACE_RIGHT=[new j.KJ(1,-1,1),new j.KJ(-1,-1,1),new j.KJ(1,1,1),new j.KJ(-1,1,1)],E.FACE_FRONT=[new j.KJ(1,-1,-1),new j.KJ(1,-1,1),new j.KJ(1,1,-1),new j.KJ(1,1,1)],E.FACE_BACK=[new j.KJ(-1,-1,1),new j.KJ(-1,-1,-1),new j.KJ(-1,1,1),new j.KJ(-1,1,-1)],E.FACE_DOWN=[new j.KJ(1,1,-1),new j.KJ(1,1,1),new j.KJ(-1,1,-1),new j.KJ(-1,1,1)],E.FACE_UP=[new j.KJ(-1,-1,-1),new j.KJ(-1,-1,1),new j.KJ(1,-1,-1),new j.KJ(1,-1,1)];class g{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(i,x,e){const j=new Uint8Array(i.buffer,i.byteOffset,i.byteLength),E=J(j),a=u(j,E),Y=E.width*E.height,b=new Float32Array(4*Y);for(let J=0;J<Y;J+=1)b[4*J]=a[3*J],b[4*J+1]=a[3*J+1],b[4*J+2]=a[3*J+2],b[4*J+3]=1;e(E.width,E.height,x.generateMipMaps,!1,(()=>{const i=x.getEngine();x.type=1,x.format=5,x._gammaSpace=!1,i._uploadDataToTextureDirectly(x,b)}))}}}}]);