"use strict";(self["9jl1vn4ei5r"]=self["9jl1vn4ei5r"]||[]).push([[49],{14183:(M,p,b)=>{b.r(p),b.d(p,{_HDRTextureLoader:()=>H});var Q=b(11796);class q{static ConvertPanoramaToCubemap(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!M)throw"ConvertPanoramaToCubemap: input cannot be null";if(M.length!=p*b*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(Q,this.FACE_FRONT,M,p,b,q),back:this.CreateCubemapTexture(Q,this.FACE_BACK,M,p,b,q),left:this.CreateCubemapTexture(Q,this.FACE_LEFT,M,p,b,q),right:this.CreateCubemapTexture(Q,this.FACE_RIGHT,M,p,b,q),up:this.CreateCubemapTexture(Q,this.FACE_UP,M,p,b,q),down:this.CreateCubemapTexture(Q,this.FACE_DOWN,M,p,b,q),size:Q,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(M,p,b,Q,q){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=new ArrayBuffer(M*M*4*3),u=new Float32Array(k),T=B?Math.max(1,Math.round(Q/4/M)):1,O=1/T,H=O*O,F=p[1].jp(p[0]).scale(O/M),o=p[3].jp(p[2]).scale(O/M),W=1/M;let i=0;for(let A=0;A<M;A++)for(let B=0;B<T;B++){let B=p[0],k=p[2];for(let p=0;p<M;p++)for(let O=0;O<T;O++){const T=k.jp(B).scale(i).add(B);T.normalize();const O=this.CalcProjectionSpherical(T,b,Q,q);u[A*M*3+3*p+0]+=O.r*H,u[A*M*3+3*p+1]+=O.g*H,u[A*M*3+3*p+2]+=O.b*H,B=B.add(F),k=k.add(o)}i+=W*O}return u}static CalcProjectionSpherical(M,p,b,Q){let q=Math.atan2(M.z,M.x);const B=Math.acos(M.y);for(;q<-Math.PI;)q+=2*Math.PI;for(;q>Math.PI;)q-=2*Math.PI;let k=q/Math.PI;const u=B/Math.PI;k=.5*k+.5;let T=Math.round(k*b);T<0?T=0:T>=b&&(T=b-1);let O=Math.round(u*Q);O<0?O=0:O>=Q&&(O=Q-1);const H=Q-O-1;return{r:p[H*b*3+3*T+0],g:p[H*b*3+3*T+1],b:p[H*b*3+3*T+2]}}}function B(M,p,b,Q,q,B){q>0?(q=function(M,p){return p>1023?M*Math.pow(2,1023)*Math.pow(2,p-1023):p<-1074?M*Math.pow(2,-1074)*Math.pow(2,p+1074):M*Math.pow(2,p)}(1,q-136),M[B+0]=p*q,M[B+1]=b*q,M[B+2]=Q*q):(M[B+0]=0,M[B+1]=0,M[B+2]=0)}function k(M,p){let b="",Q="";for(let q=p;q<M.length-p&&(Q=String.fromCharCode(M[q]),"\n"!=Q);q++)b+=Q;return b}function u(M){let p=0,b=0,Q=k(M,0);if("#"!=Q[0]||"?"!=Q[1])throw"Bad HDR Format.";let q=!1,B=!1,u=0;do{u+=Q.length+1,Q=k(M,u),"FORMAT=32-bit_rle_rgbe"==Q?B=!0:0==Q.length&&(q=!0)}while(!q);if(!B)throw"HDR Bad header format, unsupported FORMAT";u+=Q.length+1,Q=k(M,u);const T=/^-Y (.*) \+X (.*)$/g.exec(Q);if(!T||T.length<3)throw"HDR Bad header format, no size";if(b=parseInt(T[2]),p=parseInt(T[1]),b<8||b>32767)throw"HDR Bad header format, unsupported size";return u+=Q.length+1,{height:p,width:b,dataPosition:u}}function T(M,p){return function(M,p){let b=p.height;const Q=p.width;let q,k,u,T,H,F=p.dataPosition,o=0,W=0,i=0;const A=new ArrayBuffer(4*Q),j=new Uint8Array(A),K=new ArrayBuffer(p.width*p.height*4*3),D=new Float32Array(K);for(;b>0;){if(q=M[F++],k=M[F++],u=M[F++],T=M[F++],2!=q||2!=k||128&u||p.width<8||p.width>32767)return O(M,p);if((u<<8|T)!=Q)throw"HDR Bad header format, wrong scan line width";for(o=0,i=0;i<4;i++)for(W=(i+1)*Q;o<W;)if(q=M[F++],k=M[F++],q>128){if(H=q-128,0==H||H>W-o)throw"HDR Bad Format, bad scanline data (run)";for(;H-- >0;)j[o++]=k}else{if(H=q,0==H||H>W-o)throw"HDR Bad Format, bad scanline data (non-run)";if(j[o++]=k,--H>0)for(let p=0;p<H;p++)j[o++]=M[F++]}for(i=0;i<Q;i++)q=j[i],k=j[i+Q],u=j[i+2*Q],T=j[i+3*Q],B(D,q,k,u,T,(p.height-b)*Q*3+3*i);b--}return D}(M,p)}function O(M,p){let b=p.height;const Q=p.width;let q,k,u,T,O,H=p.dataPosition;const F=new ArrayBuffer(p.width*p.height*4*3),o=new Float32Array(F);for(;b>0;){for(O=0;O<p.width;O++)q=M[H++],k=M[H++],u=M[H++],T=M[H++],B(o,q,k,u,T,(p.height-b)*Q*3+3*O);b--}return o}q.FACE_LEFT=[new Q.Ap(-1,-1,-1),new Q.Ap(1,-1,-1),new Q.Ap(-1,1,-1),new Q.Ap(1,1,-1)],q.FACE_RIGHT=[new Q.Ap(1,-1,1),new Q.Ap(-1,-1,1),new Q.Ap(1,1,1),new Q.Ap(-1,1,1)],q.FACE_FRONT=[new Q.Ap(1,-1,-1),new Q.Ap(1,-1,1),new Q.Ap(1,1,-1),new Q.Ap(1,1,1)],q.FACE_BACK=[new Q.Ap(-1,-1,1),new Q.Ap(-1,-1,-1),new Q.Ap(-1,1,1),new Q.Ap(-1,1,-1)],q.FACE_DOWN=[new Q.Ap(1,1,-1),new Q.Ap(1,1,1),new Q.Ap(-1,1,-1),new Q.Ap(-1,1,1)],q.FACE_UP=[new Q.Ap(-1,-1,-1),new Q.Ap(-1,-1,1),new Q.Ap(1,-1,-1),new Q.Ap(1,-1,1)];class H{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(M,p,b){const Q=new Uint8Array(M.buffer,M.byteOffset,M.byteLength),q=u(Q),B=T(Q,q),k=q.width*q.height,O=new Float32Array(4*k);for(let u=0;u<k;u+=1)O[4*u]=B[3*u],O[4*u+1]=B[3*u+1],O[4*u+2]=B[3*u+2],O[4*u+3]=1;b(q.width,q.height,p.generateMipMaps,!1,(()=>{const M=p.getEngine();p.type=1,p.format=5,p._gammaSpace=!1,M._uploadDataToTextureDirectly(p,O)}))}}}}]);