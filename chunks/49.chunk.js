"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[49],{14132:(c,r,D)=>{D.r(r),D.d(r,{_HDRTextureLoader:()=>M});var W=D(11683);class B{static ConvertPanoramaToCubemap(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!c)throw"ConvertPanoramaToCubemap: input cannot be null";if(c.length!=r*D*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(W,this.FACE_FRONT,c,r,D,B),back:this.CreateCubemapTexture(W,this.FACE_BACK,c,r,D,B),left:this.CreateCubemapTexture(W,this.FACE_LEFT,c,r,D,B),right:this.CreateCubemapTexture(W,this.FACE_RIGHT,c,r,D,B),up:this.CreateCubemapTexture(W,this.FACE_UP,c,r,D,B),down:this.CreateCubemapTexture(W,this.FACE_DOWN,c,r,D,B),size:W,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(c,r,D,W,B){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=new ArrayBuffer(c*c*4*3),a=new Float32Array(u),H=t?Math.max(1,Math.round(W/4/c)):1,x=1/H,M=x*x,E=r[1].Jr(r[0]).scale(x/c),m=r[3].Jr(r[2]).scale(x/c),Y=1/c;let v=0;for(let k=0;k<c;k++)for(let t=0;t<H;t++){let t=r[0],u=r[2];for(let r=0;r<c;r++)for(let x=0;x<H;x++){const H=u.Jr(t).scale(v).add(t);H.normalize();const x=this.CalcProjectionSpherical(H,D,W,B);a[k*c*3+3*r+0]+=x.r*M,a[k*c*3+3*r+1]+=x.g*M,a[k*c*3+3*r+2]+=x.b*M,t=t.add(E),u=u.add(m)}v+=Y*x}return a}static CalcProjectionSpherical(c,r,D,W){let B=Math.atan2(c.z,c.x);const t=Math.acos(c.y);for(;B<-Math.PI;)B+=2*Math.PI;for(;B>Math.PI;)B-=2*Math.PI;let u=B/Math.PI;const a=t/Math.PI;u=.5*u+.5;let H=Math.round(u*D);H<0?H=0:H>=D&&(H=D-1);let x=Math.round(a*W);x<0?x=0:x>=W&&(x=W-1);const M=W-x-1;return{r:r[M*D*3+3*H+0],g:r[M*D*3+3*H+1],b:r[M*D*3+3*H+2]}}}function t(c,r,D,W,B,t){B>0?(B=function(c,r){return r>1023?c*Math.pow(2,1023)*Math.pow(2,r-1023):r<-1074?c*Math.pow(2,-1074)*Math.pow(2,r+1074):c*Math.pow(2,r)}(1,B-136),c[t+0]=r*B,c[t+1]=D*B,c[t+2]=W*B):(c[t+0]=0,c[t+1]=0,c[t+2]=0)}function u(c,r){let D="",W="";for(let B=r;B<c.length-r&&(W=String.fromCharCode(c[B]),"\n"!=W);B++)D+=W;return D}function a(c){let r=0,D=0,W=u(c,0);if("#"!=W[0]||"?"!=W[1])throw"Bad HDR Format.";let B=!1,t=!1,a=0;do{a+=W.length+1,W=u(c,a),"FORMAT=32-bit_rle_rgbe"==W?t=!0:0==W.length&&(B=!0)}while(!B);if(!t)throw"HDR Bad header format, unsupported FORMAT";a+=W.length+1,W=u(c,a);const H=/^-Y (.*) \+X (.*)$/g.exec(W);if(!H||H.length<3)throw"HDR Bad header format, no size";if(D=parseInt(H[2]),r=parseInt(H[1]),D<8||D>32767)throw"HDR Bad header format, unsupported size";return a+=W.length+1,{height:r,width:D,dataPosition:a}}function H(c,r){return function(c,r){let D=r.height;const W=r.width;let B,u,a,H,M,E=r.dataPosition,m=0,Y=0,v=0;const k=new ArrayBuffer(4*W),w=new Uint8Array(k),Z=new ArrayBuffer(r.width*r.height*4*3),J=new Float32Array(Z);for(;D>0;){if(B=c[E++],u=c[E++],a=c[E++],H=c[E++],2!=B||2!=u||128&a||r.width<8||r.width>32767)return x(c,r);if((a<<8|H)!=W)throw"HDR Bad header format, wrong scan line width";for(m=0,v=0;v<4;v++)for(Y=(v+1)*W;m<Y;)if(B=c[E++],u=c[E++],B>128){if(M=B-128,0==M||M>Y-m)throw"HDR Bad Format, bad scanline data (run)";for(;M-- >0;)w[m++]=u}else{if(M=B,0==M||M>Y-m)throw"HDR Bad Format, bad scanline data (non-run)";if(w[m++]=u,--M>0)for(let r=0;r<M;r++)w[m++]=c[E++]}for(v=0;v<W;v++)B=w[v],u=w[v+W],a=w[v+2*W],H=w[v+3*W],t(J,B,u,a,H,(r.height-D)*W*3+3*v);D--}return J}(c,r)}function x(c,r){let D=r.height;const W=r.width;let B,u,a,H,x,M=r.dataPosition;const E=new ArrayBuffer(r.width*r.height*4*3),m=new Float32Array(E);for(;D>0;){for(x=0;x<r.width;x++)B=c[M++],u=c[M++],a=c[M++],H=c[M++],t(m,B,u,a,H,(r.height-D)*W*3+3*x);D--}return m}B.FACE_LEFT=[new W.Zr(-1,-1,-1),new W.Zr(1,-1,-1),new W.Zr(-1,1,-1),new W.Zr(1,1,-1)],B.FACE_RIGHT=[new W.Zr(1,-1,1),new W.Zr(-1,-1,1),new W.Zr(1,1,1),new W.Zr(-1,1,1)],B.FACE_FRONT=[new W.Zr(1,-1,-1),new W.Zr(1,-1,1),new W.Zr(1,1,-1),new W.Zr(1,1,1)],B.FACE_BACK=[new W.Zr(-1,-1,1),new W.Zr(-1,-1,-1),new W.Zr(-1,1,1),new W.Zr(-1,1,-1)],B.FACE_DOWN=[new W.Zr(1,1,-1),new W.Zr(1,1,1),new W.Zr(-1,1,-1),new W.Zr(-1,1,1)],B.FACE_UP=[new W.Zr(-1,-1,-1),new W.Zr(-1,-1,1),new W.Zr(1,-1,-1),new W.Zr(1,-1,1)];class M{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(c,r,D){const W=new Uint8Array(c.buffer,c.byteOffset,c.byteLength),B=a(W),t=H(W,B),u=B.width*B.height,x=new Float32Array(4*u);for(let a=0;a<u;a+=1)x[4*a]=t[3*a],x[4*a+1]=t[3*a+1],x[4*a+2]=t[3*a+2],x[4*a+3]=1;D(B.width,B.height,r.generateMipMaps,!1,(()=>{const c=r.getEngine();r.type=1,r.format=5,r._gammaSpace=!1,c._uploadDataToTextureDirectly(r,x)}))}}}}]);