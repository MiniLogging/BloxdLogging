"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[49],{14898:(e,d,v)=>{v.r(d),v.d(d,{_HDRTextureLoader:()=>V});var P=v(12420);class p{static ConvertPanoramaToCubemap(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=d*v*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(P,this.FACE_FRONT,e,d,v,p),back:this.CreateCubemapTexture(P,this.FACE_BACK,e,d,v,p),left:this.CreateCubemapTexture(P,this.FACE_LEFT,e,d,v,p),right:this.CreateCubemapTexture(P,this.FACE_RIGHT,e,d,v,p),up:this.CreateCubemapTexture(P,this.FACE_UP,e,d,v,p),down:this.CreateCubemapTexture(P,this.FACE_DOWN,e,d,v,p),size:P,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(e,d,v,P,p){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=new ArrayBuffer(e*e*4*3),X=new Float32Array(B),z=L?Math.max(1,Math.round(P/4/e)):1,W=1/z,V=W*W,k=d[1].Zd(d[0]).scale(W/e),g=d[3].Zd(d[2]).scale(W/e),F=1/e;let w=0;for(let G=0;G<e;G++)for(let L=0;L<z;L++){let L=d[0],B=d[2];for(let d=0;d<e;d++)for(let W=0;W<z;W++){const z=B.Zd(L).scale(w).add(L);z.normalize();const W=this.CalcProjectionSpherical(z,v,P,p);X[G*e*3+3*d+0]+=W.r*V,X[G*e*3+3*d+1]+=W.g*V,X[G*e*3+3*d+2]+=W.b*V,L=L.add(k),B=B.add(g)}w+=F*W}return X}static CalcProjectionSpherical(e,d,v,P){let p=Math.atan2(e.z,e.x);const L=Math.acos(e.y);for(;p<-Math.PI;)p+=2*Math.PI;for(;p>Math.PI;)p-=2*Math.PI;let B=p/Math.PI;const X=L/Math.PI;B=.5*B+.5;let z=Math.round(B*v);z<0?z=0:z>=v&&(z=v-1);let W=Math.round(X*P);W<0?W=0:W>=P&&(W=P-1);const V=P-W-1;return{r:d[V*v*3+3*z+0],g:d[V*v*3+3*z+1],b:d[V*v*3+3*z+2]}}}function L(e,d,v,P,p,L){p>0?(p=function(e,d){return d>1023?e*Math.pow(2,1023)*Math.pow(2,d-1023):d<-1074?e*Math.pow(2,-1074)*Math.pow(2,d+1074):e*Math.pow(2,d)}(1,p-136),e[L+0]=d*p,e[L+1]=v*p,e[L+2]=P*p):(e[L+0]=0,e[L+1]=0,e[L+2]=0)}function B(e,d){let v="",P="";for(let p=d;p<e.length-d&&(P=String.fromCharCode(e[p]),"\n"!=P);p++)v+=P;return v}function X(e){let d=0,v=0,P=B(e,0);if("#"!=P[0]||"?"!=P[1])throw"Bad HDR Format.";let p=!1,L=!1,X=0;do{X+=P.length+1,P=B(e,X),"FORMAT=32-bit_rle_rgbe"==P?L=!0:0==P.length&&(p=!0)}while(!p);if(!L)throw"HDR Bad header format, unsupported FORMAT";X+=P.length+1,P=B(e,X);const z=/^-Y (.*) \+X (.*)$/g.exec(P);if(!z||z.length<3)throw"HDR Bad header format, no size";if(v=parseInt(z[2]),d=parseInt(z[1]),v<8||v>32767)throw"HDR Bad header format, unsupported size";return X+=P.length+1,{height:d,width:v,dataPosition:X}}function z(e,d){return function(e,d){let v=d.height;const P=d.width;let p,B,X,z,V,k=d.dataPosition,g=0,F=0,w=0;const G=new ArrayBuffer(4*P),U=new Uint8Array(G),D=new ArrayBuffer(d.width*d.height*4*3),C=new Float32Array(D);for(;v>0;){if(p=e[k++],B=e[k++],X=e[k++],z=e[k++],2!=p||2!=B||128&X||d.width<8||d.width>32767)return W(e,d);if((X<<8|z)!=P)throw"HDR Bad header format, wrong scan line width";for(g=0,w=0;w<4;w++)for(F=(w+1)*P;g<F;)if(p=e[k++],B=e[k++],p>128){if(V=p-128,0==V||V>F-g)throw"HDR Bad Format, bad scanline data (run)";for(;V-- >0;)U[g++]=B}else{if(V=p,0==V||V>F-g)throw"HDR Bad Format, bad scanline data (non-run)";if(U[g++]=B,--V>0)for(let d=0;d<V;d++)U[g++]=e[k++]}for(w=0;w<P;w++)p=U[w],B=U[w+P],X=U[w+2*P],z=U[w+3*P],L(C,p,B,X,z,(d.height-v)*P*3+3*w);v--}return C}(e,d)}function W(e,d){let v=d.height;const P=d.width;let p,B,X,z,W,V=d.dataPosition;const k=new ArrayBuffer(d.width*d.height*4*3),g=new Float32Array(k);for(;v>0;){for(W=0;W<d.width;W++)p=e[V++],B=e[V++],X=e[V++],z=e[V++],L(g,p,B,X,z,(d.height-v)*P*3+3*W);v--}return g}p.FACE_LEFT=[new P.mv(-1,-1,-1),new P.mv(1,-1,-1),new P.mv(-1,1,-1),new P.mv(1,1,-1)],p.FACE_RIGHT=[new P.mv(1,-1,1),new P.mv(-1,-1,1),new P.mv(1,1,1),new P.mv(-1,1,1)],p.FACE_FRONT=[new P.mv(1,-1,-1),new P.mv(1,-1,1),new P.mv(1,1,-1),new P.mv(1,1,1)],p.FACE_BACK=[new P.mv(-1,-1,1),new P.mv(-1,-1,-1),new P.mv(-1,1,1),new P.mv(-1,1,-1)],p.FACE_DOWN=[new P.mv(1,1,-1),new P.mv(1,1,1),new P.mv(-1,1,-1),new P.mv(-1,1,1)],p.FACE_UP=[new P.mv(-1,-1,-1),new P.mv(-1,-1,1),new P.mv(1,-1,-1),new P.mv(1,-1,1)];class V{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(e,d,v){const P=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),p=X(P),L=z(P,p),B=p.width*p.height,W=new Float32Array(4*B);for(let X=0;X<B;X+=1)W[4*X]=L[3*X],W[4*X+1]=L[3*X+1],W[4*X+2]=L[3*X+2],W[4*X+3]=1;v(p.width,p.height,d.generateMipMaps,!1,(()=>{const e=d.getEngine();d.type=1,d.format=5,d._gammaSpace=!1,e._uploadDataToTextureDirectly(d,W)}))}}}}]);