"use strict";(self.rsqbdnwe5e=self.rsqbdnwe5e||[]).push([[49],{14804:(N,p,T)=>{T.r(p),T.d(p,{_HDRTextureLoader:()=>H});var A=T(12371);class a{static ConvertPanoramaToCubemap(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!N)throw"ConvertPanoramaToCubemap: input cannot be null";if(N.length!=p*T*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(A,this.FACE_FRONT,N,p,T,a),back:this.CreateCubemapTexture(A,this.FACE_BACK,N,p,T,a),left:this.CreateCubemapTexture(A,this.FACE_LEFT,N,p,T,a),right:this.CreateCubemapTexture(A,this.FACE_RIGHT,N,p,T,a),up:this.CreateCubemapTexture(A,this.FACE_UP,N,p,T,a),down:this.CreateCubemapTexture(A,this.FACE_DOWN,N,p,T,a),size:A,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(N,p,T,A,a){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=new ArrayBuffer(N*N*4*3),X=new Float32Array(U),y=C?Math.max(1,Math.round(A/4/N)):1,e=1/y,H=e*e,M=p[1].Ip(p[0]).scale(e/N),b=p[3].Ip(p[2]).scale(e/N),l=1/N;let k=0;for(let x=0;x<N;x++)for(let C=0;C<y;C++){let C=p[0],U=p[2];for(let p=0;p<N;p++)for(let e=0;e<y;e++){const y=U.Ip(C).scale(k).add(C);y.normalize();const e=this.CalcProjectionSpherical(y,T,A,a);X[x*N*3+3*p+0]+=e.r*H,X[x*N*3+3*p+1]+=e.g*H,X[x*N*3+3*p+2]+=e.b*H,C=C.add(M),U=U.add(b)}k+=l*e}return X}static CalcProjectionSpherical(N,p,T,A){let a=Math.atan2(N.z,N.x);const C=Math.acos(N.y);for(;a<-Math.PI;)a+=2*Math.PI;for(;a>Math.PI;)a-=2*Math.PI;let U=a/Math.PI;const X=C/Math.PI;U=.5*U+.5;let y=Math.round(U*T);y<0?y=0:y>=T&&(y=T-1);let e=Math.round(X*A);e<0?e=0:e>=A&&(e=A-1);const H=A-e-1;return{r:p[H*T*3+3*y+0],g:p[H*T*3+3*y+1],b:p[H*T*3+3*y+2]}}}function C(N,p,T,A,a,C){a>0?(a=function(N,p){return p>1023?N*Math.pow(2,1023)*Math.pow(2,p-1023):p<-1074?N*Math.pow(2,-1074)*Math.pow(2,p+1074):N*Math.pow(2,p)}(1,a-136),N[C+0]=p*a,N[C+1]=T*a,N[C+2]=A*a):(N[C+0]=0,N[C+1]=0,N[C+2]=0)}function U(N,p){let T="",A="";for(let a=p;a<N.length-p&&(A=String.fromCharCode(N[a]),"\n"!=A);a++)T+=A;return T}function X(N){let p=0,T=0,A=U(N,0);if("#"!=A[0]||"?"!=A[1])throw"Bad HDR Format.";let a=!1,C=!1,X=0;do{X+=A.length+1,A=U(N,X),"FORMAT=32-bit_rle_rgbe"==A?C=!0:0==A.length&&(a=!0)}while(!a);if(!C)throw"HDR Bad header format, unsupported FORMAT";X+=A.length+1,A=U(N,X);const y=/^-Y (.*) \+X (.*)$/g.exec(A);if(!y||y.length<3)throw"HDR Bad header format, no size";if(T=parseInt(y[2]),p=parseInt(y[1]),T<8||T>32767)throw"HDR Bad header format, unsupported size";return X+=A.length+1,{height:p,width:T,dataPosition:X}}function y(N,p){return function(N,p){let T=p.height;const A=p.width;let a,U,X,y,H,M=p.dataPosition,b=0,l=0,k=0;const x=new ArrayBuffer(4*A),I=new Uint8Array(x),L=new ArrayBuffer(p.width*p.height*4*3),n=new Float32Array(L);for(;T>0;){if(a=N[M++],U=N[M++],X=N[M++],y=N[M++],2!=a||2!=U||128&X||p.width<8||p.width>32767)return e(N,p);if((X<<8|y)!=A)throw"HDR Bad header format, wrong scan line width";for(b=0,k=0;k<4;k++)for(l=(k+1)*A;b<l;)if(a=N[M++],U=N[M++],a>128){if(H=a-128,0==H||H>l-b)throw"HDR Bad Format, bad scanline data (run)";for(;H-- >0;)I[b++]=U}else{if(H=a,0==H||H>l-b)throw"HDR Bad Format, bad scanline data (non-run)";if(I[b++]=U,--H>0)for(let p=0;p<H;p++)I[b++]=N[M++]}for(k=0;k<A;k++)a=I[k],U=I[k+A],X=I[k+2*A],y=I[k+3*A],C(n,a,U,X,y,(p.height-T)*A*3+3*k);T--}return n}(N,p)}function e(N,p){let T=p.height;const A=p.width;let a,U,X,y,e,H=p.dataPosition;const M=new ArrayBuffer(p.width*p.height*4*3),b=new Float32Array(M);for(;T>0;){for(e=0;e<p.width;e++)a=N[H++],U=N[H++],X=N[H++],y=N[H++],C(b,a,U,X,y,(p.height-T)*A*3+3*e);T--}return b}a.FACE_LEFT=[new A.xp(-1,-1,-1),new A.xp(1,-1,-1),new A.xp(-1,1,-1),new A.xp(1,1,-1)],a.FACE_RIGHT=[new A.xp(1,-1,1),new A.xp(-1,-1,1),new A.xp(1,1,1),new A.xp(-1,1,1)],a.FACE_FRONT=[new A.xp(1,-1,-1),new A.xp(1,-1,1),new A.xp(1,1,-1),new A.xp(1,1,1)],a.FACE_BACK=[new A.xp(-1,-1,1),new A.xp(-1,-1,-1),new A.xp(-1,1,1),new A.xp(-1,1,-1)],a.FACE_DOWN=[new A.xp(1,1,-1),new A.xp(1,1,1),new A.xp(-1,1,-1),new A.xp(-1,1,1)],a.FACE_UP=[new A.xp(-1,-1,-1),new A.xp(-1,-1,1),new A.xp(1,-1,-1),new A.xp(1,-1,1)];class H{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(N,p,T){const A=new Uint8Array(N.buffer,N.byteOffset,N.byteLength),a=X(A),C=y(A,a),U=a.width*a.height,e=new Float32Array(4*U);for(let X=0;X<U;X+=1)e[4*X]=C[3*X],e[4*X+1]=C[3*X+1],e[4*X+2]=C[3*X+2],e[4*X+3]=1;T(a.width,a.height,p.generateMipMaps,!1,(()=>{const N=p.getEngine();p.type=1,p.format=5,p._gammaSpace=!1,N._uploadDataToTextureDirectly(p,e)}))}}}}]);